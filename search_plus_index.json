{"./":{"url":"./","title":"Introduction","keywords":"","body":" Table of Contents generated with DocToc life is hard, make it easier Introduction The other docs build mocp from Source Code goagent configuration windows build vim/gvim from source code colorful windows command line life is hard, make it easier Introduction [!NOTE] This is a book powered by imarslo. The other docs build mocp from Source Code Precondiction Error and Solucton Error: BerkeleyDB (libdb) not found decoder.c:22:18: fatal error: ltdl.h FATAL_ERROR: No valid sound driver! goagent configuration Offical Website Latest Version Install Configuration Run GoAgent Older Version How to install 如何安装 Q&A windows build vim/gvim from source code Compile vim/gvim by source code Precondiction Compile and Install Make compiled vim as default text editor Q&A colorful windows command line Colorful Prompt Needed Tools and files Steps Specified Font Specified Cursor Size Set aliases in cmd Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:07 "},"artifactory/artifactory.html":{"url":"artifactory/artifactory.html","title":"artifactory","keywords":"","body":" Table of Contents generated with DocToc reference integration with pipeline aql configuration reference integration with pipeline Scripted Pipeline Syntax Jenkins Pipeline Examples aql Jenkins Artifactory Plugin AQL download latest artifact matching pattern $pair = \"$($art_user):$($art_pass)\" Write-Verbose \"Attempting to convert Artifactory credentials to a base64 string for automation\" $encodedCreds = [System.Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes($pair)) $basicAuthValue = \"Basic $encodedCreds\" $headers = @{ Authorization = $basicAuthValue } Write-Host \"Attempting to perform a AQL search.\" $aql_search = $art_base_url + \"/api/search/aql\" Write-Host \"Building aql query with the following parameters, groupID: $group_id, artifactID: $artifact_id, version: $version, classifier: $classifier and repos: $art_generic_repokey.\" $aql_query = 'items.find({\"repo\":\"' + $art_generic_repokey + '\",\"$or\":[{\"$and\":[{\"path\":{\"$match\":\"' + $group_id + '/' + $artifact_id + '/' + $version + '\"},\"name\":{\"$match\":\"' + $artifact_id + '*' + $classifier + '*.' + $extension + '\"}}]}]}).sort({\"$desc\":[\"modified\"]}).limit(1)' Write-Host \"Built the following aql query: '$aql_query' .\" $aql_content = Invoke-RestMethod -Uri $aql_search -Headers $headers -Method Post -Body $aql_query -ContentType 'text/plain' Write-Host \"Attempting to submit the aql query to the following artifactory server: $art_base_url.\" $aql_results = ($aql_content).results Write-Host \"Attempting to parse query results and build the artifact download uri.\" $aql_repo,$aql_path,$aql_name = ($aql_results).repo,($aql_results).path,($aql_results).name $artifactDownloadUri = $art_base_url + '/' + $aql_repo + '/' + $aql_path + '/' + $aql_name Write-Host \"Found the following uri: $artifactDownloadUri !!\" if ($artifactMimeType -eq 'application/zip' -or $extension -eq 'zip') { Write-Verbose \"Attempting to save the artifact to $download_dir/$art_dist_name.zip\" Invoke-RestMethod -Uri $artifactDownloadUri -Headers $headers -OutFile \"$download_dir/$art_dist_name.zip\" } configuration allow partial folder in particular repo Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:07 "},"artifactory/api.html":{"url":"artifactory/api.html","title":"api","keywords":"","body":" Table of Contents generated with DocToc variable repo check repo exists Build Info List all timestamps in ${buildName} List specific build-info filter \"buildInfo.env.JOB_NAME\" in all builds delete all in my-repo 4 weeks ago trash can empty trash can list items in trash can builds rotation by api/build/retention promote property search deploy deploy single artifacts deploy bundle artifact variable $ rtUrl='https://my.artifactory.com/artifactory' $ repoName='my-repo' $ buildName='my - repo' $ buildNumber=12345 $ curlOpt=\"-s -g --netrc-file ~/.marslo/.netrc\" repo check repo exists $ /usr/bin/curl ${curlOpt} \\ -X GET \"${rtUrl}/api/repositories\" \\ | jq .[].key \\ | grep \"${repo}\" Build Info List all timestamps in ${buildName} $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X GET ${rtUrl}/api/build/${buildsNumbers} \\ | jq .buildsNumbers[].started List specific build-info $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X GET ${rtUrl}/api/build/${buildNazme}/${buildNumber} get start timestampe$ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X GET ${rtUrl}/api/build/${buildNazme}/${buildNumber} \\ | jq .buildInfo.started \"2020-09-30T02:38:32.264-0700\" filter \"buildInfo.env.JOB_NAME\" in all builds $ BUILD_NAME='my - job' $ RT_URL='https://my.artifactory.com/artifactory' $ for i in $(curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}\" | jq -r '.[][]?.uri' ); do echo \"~~~> ${i}\" curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}${i}\" | jq --raw-output '.buildInfo.properties.\"buildInfo.env.JOB_NAME\"' echo '' done or #!/usr/bin/env bash BUILD_NAME='my - build' CURL_OPT=\"-sg --netrc-file $HOME/.marslo/.netrc\" RT_URL='https://my.artifactory.com/artifactory' for bid in $(curl ${CURL_OPT} -X GET \"${RT_URL}/api/build/${BUILD_NAME}\" | jq -r '.[][]?.uri'); do curl ${CURL_OPT} -X GET \"${RT_URL}/api/build/${BUILD_NAME}${bid}\" \\ | jq -r '.buildInfo.properties | select(.\"buildInfo.env.JOB_NAME\" | contains(\"marslo\"))' \\ | jq -r '[.\"buildInfo.env.JOB_NAME\" , .\"buildInfo.env.BUILD_URL\"]' done filter \"buildInfo.env.JOB_NAME\" by keyword $ BUILD_ID='/297' $ curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}${BUILD_ID}\" \\ | jq -r '.buildInfo.properties | select(.\"buildInfo.env.JOB_NAME\" | contains(\"marslo\"))' \\ | jq -r '.\"buildInfo.env.JOB_NAME\"' marslo/rc filter both \"buildInfo.env.BUILD_URL\" and \"buildInfo.env.JOB_NAME\" if JOB_NAME contains keyword $ curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}${BUILD_ID}\" \\ | jq -r '.buildInfo.properties | select(.\"buildInfo.env.JOB_NAME\" | contains(\"marslo\"))' \\ | jq -r '[.\"buildInfo.env.JOB_NAME\" , .\"buildInfo.env.BUILD_URL\"]' [ \"marslo/rc\", \"https://my.jenkins.com/job/marslo/job/rc/297/\" ] delete all in my-repo 4 weeks ago find.aql$ cat find.aql items.find({ \"repo\": \"my-repo\", \"type\" : \"folder\" , \"depth\" : \"1\", \"created\" : { \"$before\" : \"4w\" } }) delete artifacts and buildinfo rtURL='https://my.artifactory.com/artifactory' cibuild='my-jenkins-build' repo='my-repo' curlOpt= '-s -g --netrc-file ~/.marslo/.netrc' for _i in $(curl ${curlOpt} -X POST ${curlOpt} ${rtURL}/api/search/aql -T find.aql | jq --raw-output .results[].name); do curl ${curlOpt} -X DELETE \"${rtURL}/${repo}/${_i}\" curl ${curlOpt} -X DELETE \"${rtURL}/api/build/${cibuild}?buildNumbers=${_i}&artifacts=1\" curl ${curlOpt} -X DELETE \"${rtUrl}/api/trash/clean/${repo}/${_i}\" curl ${curlOpt} -X DELETE \"${rtUrl}/api/trash/clean/artifactory-build-info\" done trash can empty trash can $ curl -s \\ -g \\ --netrc-file ~/.marslo/.netrc' \\ -X POST \\ \"${rtUrl}/api/trash/empty\" list items in trash can $ curl -s \\ -g \\ --netrc-file ~/.marslo/.netrc' \\ -X GET \\ \"${rtURL}/api/storage/auto-trashcan\" | jq .children[].uri builds rotation by api/build/retention $ date -d 'now - 2 months' +%s%3N 1597232120161 $ date -d @$(echo '1597232120161' | rev | cut -c4- | rev) Wed Aug 12 19:35:20 CST 2020 $ cat rotation.json { \"deleteBuildArtifacts\" : true , \"count\" : 3 , \"minimumBuildDate\" : 1597232120161 , \"buildNumbersNotToBeDiscarded\" : [] } $ curl -s \\ -g \\ -X POST \\ -d @rotation.json \\ -H \"Content-Type: application/json\" \\ --netrc-file ~/.marslo/.netrc' \\ \"https://my.artifactory.com/artifactory/api/build/retention/build%20-%20name?async=false\" promote reference: How do I promote a build using the REST-API? build promotion $ cat promot.json { \"status\": \"released\", \"ciUser\": \"ci-user\", \"dryRun\" : false, \"targetRepo\" : \"my-repo-release\", \"copy\": true, \"artifacts\" : true, \"dependencies\" : true, \"scopes\" : [ \"compile\", \"runtime\" ], \"properties\": { \"release-name\": [\"marslo-test\"] } } $ curl -s \\ -g \\ -i \\ -k \\ -H \"Content-type:application/json\" \\ -d @promot.json \\ -X POST \\ '${rtURL}/api/build/promote/${buildName}/' property add property $ path='libs-release-local/pkg' $ properties=$('os=win,linux|qa=done' | sed 's:|:%7C:') $ curl -s \\ -g \\ -I \\ --netrc-file ~/.marslo/.netrc \\ -X PUT \\ '${rtURL}/storage/${repoName}-local/${path}?properties=${properties}&recursive=1' get result $ curl -sgI \\ --netrc-file ~/.marslo/.netrc \\ -X PUT \\ '${rtURL}/storage/${repoName}-local/${path}?properties=${properties}&recursive=1' \\ | sed -rn 's:^HTTP/2\\s?([0-9]+)\\s?:\\1:gp' 204 # or 400 # or 404 search via pattern search $ pattern='*/pkg/*/*.jar' $ curl -s \\ -g \\ -k \\ --netrc-file ~/.marslo/.netrc \\ -X GET \\ \"${rtURL}/search/pattern?pattern=${repoName}-local:${pattern}\" via aql search $ curl -s \\ -k \\ -X POST \\ -H 'Content-Type:text/plain' \\ 'https://artifactory.domain.com/artifactory/api/search/aql' \\ -d 'builds.find({ \"name\": \"my - build - dev\", \"created\": {\"$before\": \"3days\"} }).sort({\"$desc\": [\"created\"]}).limit(1) ' deploy deploy single artifacts deploy bundle artifact $ curl -g \\ -s \\ -SL \\ -H \"X-Explode-Archive-Atomic: true\" \\ -X PUT \\ \"https://artifactory.domain.com/artifactory///\" \\ -T .[zip\\|tar.gz\\|tgz] Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:07 "},"artifactory/cli.html":{"url":"artifactory/cli.html","title":"cli","keywords":"","body":" Table of Contents generated with DocToc CLI setup CLI for jFrog Artifactory configuration ping Discarding Old Builds from Artifactory search with aql CLI setup reference: JFrog CLI INSTALL JFROG CLI jfrog/jfrog-cli npm $ npm i -g jfrog-cli-go homebrew $ brew install jfrog-cli-go docker $ docker run docker.bintray.io/jfrog/jfrog-cli-go:latest jfrog CLI for jFrog Artifactory reference: CLI for JFrog Artifactory commands abbreviation config c ping p upload u download dl copy cp move mv delete del search s set-props sp delete-props delp curl cl build-collect-env bce build-publish bp build-promote bpr build-clean bc build-scan bs build-discard bdi repo-template rpt repo-create rc repo-update ru repo-delete rdel configuration setup in local $ jfrog rt c myrt --url=https://my.artifactory.com/artifactory --apikey=*********** JFrog Distribution URL (Optional): For commands which don't use external tools or the JFrog Distribution service, JFrog CLI supports replacing the configured username and password/API key with automatically created access token that's refreshed hourly. Enable this setting? (y/n) [y]? n Is the Artifactory reverse proxy configured to accept a client certificate? (y/n) [n]? n or$ jfrog rt c myrt --url=https://my.artifactory.com/artifactory --user=myaccount --password=mypassword JFrog Distribution URL (Optional): For commands which don't use external tools or the JFrog Distribution service, JFrog CLI supports replacing the configured username and password/API key with automatically created access token that's refreshed hourly. Enable this setting? (y/n) [y]? n Is the Artifactory reverse proxy configured to accept a client certificate? (y/n) [n]? n [Info] Encrypting password... setup in docker $ docker run -it \\ --rm \\ -v $(PWD):/root docker.bintray.io/jfrog/jfrog-cli-go \\ jfrog rt c prod --url=https://my.artifactory.com/artifactory --user=myaccount --password=mypassword show configuration $ jfrog rt c show Server ID: myrt Url: https://my.artifactory.com/artifactory/ API key: *************** Default: true ping check configuration or remote server$ jfrog rt p --server-id=myrt OK Discarding Old Builds from Artifactory clean build info and artifacts 30 days before $ jfrog rt use myrt $ jfrog rt bdi --max-days=30 --delete-artifacts=true \"my-job-build\" using cli via docker $ docker run \\ -it \\ --rm \\ -v $(PWD):/root docker.bintray.io/jfrog/jfrog-cli-go \\ jfrog rt bdi --max-days=45 --delete-artifacts 'ci - buildinfo - name' search with aql Jfrog artifactory delete folder of containing artifacts after remove them $ cat spec.json { \"files\": [{ \"aql\": { \"items.find\": { \"repo\": \"my-repo\", \"type\":\"folder\", \"depth\" : \"1\", \"created\": { \"$before\": \"15d\" } } } }] } $ jfrog rt s --spec spec.json delete with aql search$ jfrog rt del --spec spec.json Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:07 "},"artifactory/aql.html":{"url":"artifactory/aql.html","title":"aql","keywords":"","body":" Table of Contents generated with DocToc AQL Relative Time Operators find items (folder) some times ago by aql AQL Relative Time Operators aqlCleanup.groovy Advanced Cleanup Using Artifactory Query Language (AQL) AQL supports specifying time intervals for queries using relative time. In other words, the time interval for the query will always be relative to the time that the query is run, so you don't have to change or formulate the time period, in some other way, each time the query is run. For example, you may want to run a query over the last day, or for the time period up to two weeks ago. Relative time is specified using the following two operators: operators paraphrase $before The query is run over complete period up to specified time. $last The query is run over period from the specified time until the query is run Time periods are specified with a number and one of the following suffixes: time period suffixes milliseconds \"mills\", \"ms\" seconds \"seconds\", \"s\" minutes \"minutes\" days \"days\", \"d\" weeks \"weeks\", \"w\" months \"months\", \"mo\" years \"years\", \"y\" find items (folder) some times ago by aql e.g. find root folder && 4 weeks ago (by using -T, --upload-file) write a file without indent space $ cat find.aql items.find ({ \"repo\": \"my-repo\", \"type\" : \"folder\" , \"depth\" : \"1\", \"created\" : { \"$before\" : \"4w\" } }) $ curl [-s] \\ -X POST \\ -uadmin:password https://my.artifactory.com/artifactory/api/search/aql \\ -T find.aql -T, --upload-file This transfers the specified local file to the remote URL. If there is no file part in the specified URL, curl will append the local file name. NOTE that you must use a trailing / on the last directory to really prove to Curl that there is no file name or curl will think that your last directory name is the remote file name to use. That will most likely cause the upload operation to fail. If this is used on an HTTP(S) server, the PUT command will be used. Use the file name \"-\" (a single dash) to use stdin instead of a given file. Alternately, the file name \".\" (a single period) may be specified instead of \"-\" to use stdin in non-blocking mode to allow reading server output while stdin is being uploaded. You can specify one -T, --upload-file for each URL on the command line. Each -T, --upload- file + URL pair specifies what to upload and to where. curl also supports \"globbing\" of the -T, --upload-file argument, meaning that you can upload multiple files to a single URL by using the same URL globbing style supported in the URL, like this: curl --upload-file \"{file1,file2}\" http://www.example.com or even curl -T \"img[1-1000].png\" ftp://ftp.example.com/upload/ search by using -d, --data $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X POST https://my.artifactory.com/artifactory/api/search/aql \\ -H \"Content-Type: text/plain\" \\ -d \"\"\"items.find ({ \\\"repo\\\": \\\"my-repo\\\", \\\"type\\\" : \\\"folder\\\" , \\\"depth\\\" : \\\"1\\\", \\\"created\\\" : { \\\"\\$before\\\" : \\\"4mo\\\" } }) \"\"\" $ cat ~/.marslo/.netrc machine my.artifactory.com login admin password password d, --data (HTTP) Sends the specified data in a POST request to the HTTP server, in the same way that a browser does when a user has filled in an HTML form and presses the submit button. This will cause curl to pass the data to the server using the content-type application/x-www-form- urlencoded. Compare to -F, --form. --data-raw is almost the same but does not have a special interpretation of the @ character. To post data purely binary, you should instead use the --data-binary option. To URL-encode the value of a form field you may use --data-urlencode. If any of these options is used more than once on the same command line, the data pieces specified will be merged together with a separating &-symbol. Thus, using '-d name=daniel -d skill=lousy' would generate a post chunk that looks like 'name=daniel&skill=lousy'. If you start the data with the letter @, the rest should be a file name to read the data from, or - if you want curl to read the data from stdin. Multiple files can also be speci- fied. Posting data from a file named from a file like that, carriage returns and newlines will be stripped out. If you don't want the @ character to have a special interpretation use --data-raw instead. See also --data-binary and --data-urlencode and --data-raw. This option overrides -F, --form and -I, --head and -T, --upload-file. or $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X POST https://my.artifactory.com/artifactory/api/search/aql \\ -H \"Content-Type: text/plain\" \\ -d \"\"\"items.find ({ \\ \\\"repo\\\": \\\"my-repo\\\", \\ \\\"type\\\" : \\\"folder\\\" , \\ \\\"depth\\\" : \\\"1\\\", \\ \\\"created\\\" : { \\\"\\$before\\\" : \\\"4mo\\\" } \\ }) \"\"\" \\ | jq --raw-output .results[].name? or (with sort and limit) Artifactory query language (AQL). How to write a not match query with $nmatch $ curl -X POST \\ -k \\ -H 'Content-Type:text/plain' \\ -i \\ 'https://my.artifactory.com/artifactory/api/search/aql' \\ -d 'items.find ({ \"repo\": \"wukong-precommit-local\", \"type\" : \"folder\" , \"depth\" : \"1\", \"created\" : { \"$before\" : \"3days\" } }).sort({\"$desc\":[\"created\"]}).limit(1) ' or -d @ JFrog Artifactory REST API in 5min $ cat builds.json builds.find({ \"name\" : \"ci - build - name\", \"created\" : { \"$before\" : \"10d\" } }) $ curl -s \\ -g \\ -d @builds.json \\ -H \"Content-Type: text/plain\" \\ -X POST \"https://${rtURL}/api/search/aql\" Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:07 "},"cheatsheet/good.html":{"url":"cheatsheet/good.html","title":"cheatsheet","keywords":"","body":" Table of Contents generated with DocToc time & date download and extract extract jar compress get cookie from firefox echo 256 colors directory diff commands bash ldapsearch time & date show cal $ cal -y | tr '\\n' '|' | sed \"s/^/ /;s/$/ /;s/ $(date +%e) / $(date +%e | sed 's/./#/g') /$(date +%m | sed s/^0//)\" | tr '|' '\\n' 2014 January February March Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 1 1 5 6 7 8 9 10 11 2 3 4 5 6 7 8 2 3 4 5 6 7 8 12 13 14 15 16 17 18 9 10 11 12 13 14 15 9 10 11 12 13 14 15 19 20 21 22 23 24 25 16 17 18 19 20 21 22 16 17 ## 19 20 21 22 26 27 28 29 30 31 23 24 25 26 27 28 23 24 25 26 27 28 29 30 31 April May June Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 5 1 2 3 1 2 3 4 5 6 7 6 7 8 9 10 11 12 4 5 6 7 8 9 10 8 9 10 11 12 13 14 13 14 15 16 17 18 19 11 12 13 14 15 16 17 15 16 17 18 19 20 21 20 21 22 23 24 25 26 18 19 20 21 22 23 24 22 23 24 25 26 27 28 27 28 29 30 25 26 27 28 29 30 31 29 30 July August September Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 5 1 2 1 2 3 4 5 6 6 7 8 9 10 11 12 3 4 5 6 7 8 9 7 8 9 10 11 12 13 13 14 15 16 17 18 19 10 11 12 13 14 15 16 14 15 16 17 18 19 20 20 21 22 23 24 25 26 17 18 19 20 21 22 23 21 22 23 24 25 26 27 27 28 29 30 31 24 25 26 27 28 29 30 28 29 30 31 October November December Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 1 1 2 3 4 5 6 5 6 7 8 9 10 11 2 3 4 5 6 7 8 7 8 9 10 11 12 13 12 13 14 15 16 17 18 9 10 11 12 13 14 15 14 15 16 17 18 19 20 19 20 21 22 23 24 25 16 17 18 19 20 21 22 21 22 23 24 25 26 27 26 27 28 29 30 31 23 24 25 26 27 28 29 28 29 30 31 30 synchronize date and time with a server over ssh (Inspired from commandlinefu.com) $ date --set=\"$(ssh [username]@[sshserver] date)\" download and extract *.gz $ wget -O - http://example.com/a.gz | tar xz *.zip $ curl -fsSL https://services.gradle.org/distributions/gradle-4.7-all.zip | bsdtar xzf - -C with zip password$ curl -fsSL \\ -u: \\ https://path/to/file.zip \\ | bsdtar -xzf- --passphrase - -C *.tar.gz $ curl -fsSL https://path/to/file.tar.gz | tar xzf - -C example$ curl -fsSL \\ -j \\ -k \\ -L \\ -H \"Cookie: oraclelicense=accept-securebackup-cookie\" \\ http://download.oracle.com/otn-pub/java/jdk/8u181-b13/96a7b8442fe848ef90c96a2fad6ed6d1/jdk-8u181-linux-x64.tar.gz \\ | tar xzf - -C '/opt/java' check file without extract $ tar -Oxvf myfile.tgz path/to/my.sh | less extract jar $ unzip .jar -d Delete files from JAR without unzip$ zip -d .jar compress zip package with dot-file .[^.]* $ zip name.zip * .[^.]*' shopt -s dotglob $ shopt -s dotglob $ zip name.zip * . $ zip -r name.zip . remove dot-file without skipping '..' '.' issue shopt -s dotglob $ shopt -s dotglob $ rm [-rf] * using shopt -u dotglob to turn dotglob off .[^.]* $ rm [-rf] .[^.]* .[!.]* $ rm [-rf] .[!.]* .??* $ rm [-rf] .??* get cookie from firefox $ grep -oP '\"url\":\"\\K[^\"]+' $(ls -t ~/.mozilla/firefox/*/sessionstore.js | sed q) echo 256 colors $ for i in {0..255}; do echo -e \"\\e[38;05;${i}m${i}\"; done | column -c 80 -s ' '; echo -e \"\\e[m\" # or $ yes \"$(seq 1 255)\" | while read i; do printf \"\\x1b[48;5;${i}m\\n\"; sleep .01; done directory diff diff --suppress-common-lines -y commands PWD's secrets $ l | grep bc lrwxrwxrwx 1 marslo marslo 37 Mar 4 00:25 bc -> /home/marslo/Tools/Git/BrowserConfig// $ cd bc/ $ pwd -L /home/marslo/bc $ pwd -P /home/marslo/Tools/Git/BrowserConfig list the command beginning with $ compgen -c \"system-config-\" system-config-authentication system-config-authentication system-config-date system-config-firewall system-config-firewall-tui system-config-kdump system-config-keyboard system-config-keyboard system-config-network system-config-network system-config-network-cmd system-config-network-cmd system-config-network-tui system-config-printer system-config-printer-applet system-config-services system-config-services system-config-users searching for commands without knowing their exact names $ apropos editor | head Git::SVN::Editor (3pm) - commit driver for \"git svn set-tree\" and dcommit INIFILE (1) - OpenLink Virtuoso Opensource ini File Editor atobm (1) - bitmap editor and converter utilities for the X Window System bitmap (1) - bitmap editor and converter utilities for the X Window System bmtoa (1) - bitmap editor and converter utilities for the X Window System ed (1) - line-oriented text editor editor (1) - Nano's ANOther editor, an enhanced free Pico clone editres (1) - a dynamic resource editor for X Toolkit applications ex (1) - Vi IMproved, a programmers text editor gedit (1) - text editor for the GNOME Desktop show some command periodically $ whatch --interval 1 ls -alt rename $ l total 4.0K -rw-r--r-- 1 marslo marslo 10 Feb 21 00:43 a.b $ rename -v 's/\\./_/g' * a.b renamed as a_b $ l total 4.0K -rw-r--r-- 1 marslo marslo 10 Feb 21 00:43 a_b clear $ printf \"\\ec\" use less as tail -f $ less +F batch move -I replace-str $ mkdir backup-folder && ls | grep -Ze \".*rar\" | xargs -d '\\n' -I {} mv {} backup-folder batch copy reference: Hack 22. Xargs Command Examples $ ls -1 a/b/* 11 12 | xargs cp -t copy-target-folder/ bash bash alias $ echo ${BASH_ALIASES[ls]} ls --color=always bash - get bash login log $ bash -l -v run with only one startup file $ bash -i --rcfile=\"$HOME/.marslo/.imarslo\" ldapsearch reference: ldapsearch Examples The ldapsearch Tool Querying AD with ldapsearch-LLL # just a particular way to display the results -H ldap://wspace.mydomain.com # the URL where the LDAP server listens -x # use simple authentication, not SASL -D 'user1' # the account to use to authenticate to LDAP -w 'user1password' # the password that goes with the account on the previous line -E pr=1000/noprompt # ask the server for all pages, don't stop after one -b 'ou=mydomain,dc=wspace,dc=mydomain,dc=com' # the base of the search. We don't want results from e.g. 'ou=blah,dc=wspace,dc=mydomain,dc=com' '(&(objectClass=person)(uidNumber=*))' # Ask for any entry that has attributes objectClass=person and uidNumber has a value SAMAccountName uid uidNumber # Show only these attributes search specific user Info : ldap url : ldaps://ldap.mydomain.com:636 base search base : dc=mydomain,dc=com login user : user1 / user1password search : user2 $ ldapsearch \\ -LLL \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ CN='user2' or insert password via interactive mode ( -W )$ ldapsearch \\ -LLL \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'dc=mydomain,dc=com' \\ -W \\ -D 'user1' \\ CN='user2' search DN field of particular user (user2) $ ldapsearch \\ [-LLL \\] -H 'ldaps://ldap.mydomain.com:636' \\ -b 'dc=mydomain,dc=com' \\ -x \\ -D 'user1' \\ -w 'user1password' \\ CN='user2' \\ DN filter all SAMAccountName, uid and uidNumber under base DN (OU=Person,DC=mydomain,DC=com) $ ldapsearch \\ -LLL \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'ou=Workers,dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ -E 'pr=1000/noprompt' \\ '(&(objectClass=user)(sAMAccountName=*))' \\ SAMAccountName uid uidNumber DN filter particular group $ ldapsearch \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'OU=DL,OU=Groups,OU=GLOBAL,OU=Sites,dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ -E 'pr=1000/noprompt' \\ '(&(objectClass=group)(CN=*))' search particular group (cn=DL-mydomaindis-group)$ ldapsearch \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'OU=DL,OU=Groups,OU=GLOBAL,OU=Sites,dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ -E 'pr=1000/noprompt' \\ CN='DL-mydomaindis-group' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:15 "},"cheatsheet/vim/vim.html":{"url":"cheatsheet/vim/vim.html","title":"vim","keywords":"","body":" Table of Contents generated with DocToc check where vim executable package tricky check where vim executable package :echo v:progpath or :echo $VIM tricky List startup script files:scriptnames Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:15 "},"cheatsheet/vim/tricky.html":{"url":"cheatsheet/vim/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc combine multiple lines with or without space combine multiple lines with or without space with space: J without space: gJ Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:15 "},"cheatsheet/vim/plugins.html":{"url":"cheatsheet/vim/plugins.html","title":"plugins","keywords":"","body":" Table of Contents generated with DocToc Tabularize Tabularize align to left :Tabularize / align to center :Tabularize //r1c1l0 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:15 "},"cheatsheet/windows/windows.html":{"url":"cheatsheet/windows/windows.html","title":"windows","keywords":"","body":" Table of Contents generated with DocToc process get the list of programs (wmic) ps auxf shortcut cmd admin lansettings Desktop Icon Settings Notification Area Icons Personalization Screen Saver System System Icon CLSID usage details regedit Set %USERPROFILE% as ${HOME} for cygwin PuTTy disable screensaver Remove Graphics card context menu Set Environment Variables setx problem whoami check SID Fingerprint Pro Enable Gadgets issue about \"profile.d\\Active\"' is not recognized as an internal or external command shell win + r details reference: windows commandline TenForums process get the list of programs (wmic) [12:26:33.40 C:\\Windows\\SysWOW64] $ wmic product get name,version Name Version ALM-Platform Loader 11.5x 11.52.444.0 Microsoft Lync Web App Plug-in 15.8.8308.577 Google App Engine 1.8.6.0 Microsoft Office Professional Plus 2010 14.0.6029.1000 Microsoft Office OneNote MUI (English) 2010 14.0.6029.1000 ... ps auxf tasklist > tasklist Image Name PID Session Name Session# Mem Usage ========================= ======== ================ =========== ============ System Idle Process 0 Services 0 4 K System 4 Services 0 8,236 K smss.exe 520 Services 0 1,164 K csrss.exe 864 Services 0 4,340 K wininit.exe 960 Services 0 4,744 K csrss.exe 968 Console 1 11,396 K services.exe 108 Services 0 7,776 K lsass.exe 96 Services 0 22,176 K shortcut cmd admin create shortcut by New -> Shortcut insert commands setup shortcut name setup Run as administrator for the shortcut move shortcut to Start Menu lansettings Internet Settings > inetcpl.cpl Internet Settings with Connections Tab > rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,4 or > inetcpl.cpl ,4 or > control inetcpl.cpl,,4 proxy setup > REG ADD \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyServer /d \"hhttp=proxy-url:port;https=proxy-url:port;ftp=proxy-url:port;socks=proxy-url:port;\" /t REG_SZ /f Desktop Icon Settings > rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,0 Notification Area Icons > explorer shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} Personalization > explorer shell:::{ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} Screen Saver > rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,1 System > control /name Microsoft.System or > control sysdm.cpl System Icon > explorer shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} \\SystemIcons,,0 CLSID reference CLSID Key (GUID) Shortcuts List for Windows 10 http://www.klapac.funsite.cz/mediawiki/index.php?title=List_of_Windows_10_CLSID_Key_(GUID)_Shortcuts usage > explorer.exe shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} or > explorer.exe /e,::{CLSID key number} details clsid regedit Set %USERPROFILE% as ${HOME} for cygwin [15:55:36.30 C:\\] $ reg add HKCU\\Environment /v HOME /t REG_EXPAND_SZ /d ^%USERPROFILE^% PuTTy Backup PuTTy sessions C:> regedit /e \"%userprofile%\\desktop\\putty-registry.reg\" HKEY_CURRENT_USER\\Software\\Simontatham Launchy PuTTy session as shortcut C:> [PuTTy.exe] -load [SessionName] Backup PuTTy session C:> regedit /e \"%userprofile%\\desktop\\putty-sessions.reg\" HKEY_CURRENT_USER\\Software\\SimonTatham\\PuTTY\\Sessions disable screensaver reference Configure screensaver command line REM Disable the screensaver REG ADD \"HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Control Panel\\Desktop\" /v ScreenSaverIsSecure /t REG_SZ /d 0 /f REG ADD \"HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Control Panel\\Desktop\" /v ScreenSaveActive /t REG_SZ /d 0 /f or by using autohotkey CoordMode, Mouse, Screen Loop { ; Move mouse MouseMove, 1, 1, 0, R ; Replace mouse to its original location MouseMove, -1, -1, 0, R ; Wait before moving the mouse again Sleep, 600000 } return or #Persistent SetTimer, WatchCursor, 100 return Loop { WatchCursor: MouseGetPos,X1 ,Y1 Sleep 10000 MouseGetPos,X2,Y2 if X1=X2 And Y1=Y2 { MouseMove,100,100 Sleep, 10000 MouseMove,200,200 Sleep, 10000 } } Remove Graphics card context menu Unregister igfxpph.dll [11:39:50.61 C:\\] $ regsvr32 /u igfxpph.dll Remove register Setting from regedit [11:47:10.20 C:\\] $ REG DELETE \"HKEY_CLASSES_ROOT\\Directory\\Background\\shellex\\ContextMenuHandlers\\igfxcui\" /f Setting from setx [11:47:10.20 C:\\] $ REG DELETE \"HKEY_CLASSES_ROOT\\Directory\\Background\\shellex\\ContextMenuHandlers\\igfxcui\" /f Set Environment Variables Set User Varialbe [13:48:11.20 C:\\] $ setx VIM_HOME C:\\Marslo\\MyProgramFiles\\Vim\\vim74\\gvim.exe Set System Variable [13:48:11.20 C:\\] $ setx /M VIM_HOME C:\\Marslo\\MyProgramFiles\\Vim\\vim74\\gvim.exe details windows default environment variable setx problem [14:31:18.67 C:\\] $ setx /M PATH %PATH%;%M2_HOME%\\bin ERROR: Invalid syntax. Default option is not allowed more than '2' time(s). Type \"SETX /?\" for usage. Fix:[14:31:18.67 C:\\] $ REG ADD \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v Path /t REG_SZ /d \"%path%;%M2_HOME%\\bin\" /f whoami check SID [15:59:24.12 C:\\Windows\\SysWOW64] $ whoami /user USER INFORMATION ---------------- User Name SID ================ =============================================== mj\\marslo_jiao S-1-5-21-354581543-3608027983-2995495404-970613 Fingerprint Pro URL: www.lenovo.com Help link: support.lenovo.com Installation folder: C:\\Program Files\\Lenovo\\Fingerprint Manager Pro\\ Uninstaller: \"C:\\Program Files\\InstallShield Installation Information\\{314FAD12-F785-4471-BCE8-AB506642B9A1}\\setup.exe\" -runfromtemp -l0x0409 -removeonly Estimated size: 70.21 MB Enable Gadgets Windows Registry Editor Version 5.00 [HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Windows\\Sidebar] \"TurnOffSidebar\"=- [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Windows\\Sidebar] \"TurnOffSidebar\"=- issue about \"profile.d\\Active\"' is not recognized as an internal or external command regedit [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Command Processor] \"Autorun\"=\"@CHCP 65001>nul\" cmd $ REG ADD \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Command Processor\" /v AutoRun /t REG_SZ /d \"@CHCP 65001>nul\" /f shell win + r appfolder > shell:appfolder startup folder > shell:startup > shell:Common Startup details shell:folder Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:16 "},"cheatsheet/windows/clsid.html":{"url":"cheatsheet/windows/clsid.html","title":"clsid","keywords":"","body":" Table of Contents generated with DocToc Usage List reference Usage > explorer.exe shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} or > explorer.exe /e,::{CLSID key number} List Opens CLSID key (GUID) Add Network Location {D4480A50-BA28-11d1-8E75-00C04FA31A86} Administrative Tools {D20EA4E1-3957-11d2-A40B-0C5020524153} Applications {4234d49b-0245-4df3-b780-3893943456e1} AutoPlay {9C60DE1E-E5FC-40f4-A487-460851A8D915} BitLocker Drive Encryption {D9EF8727-CAC2-4e60-809E-86F80A666C91} Bluetooth Devices {28803F59-3A75-4058-995F-4EE5503B023C} Color Management {B2C761C6-29BC-4f19-9251-E6195265BAF1} Command Folder {437ff9c0-a07f-4fa0-af80-84b6c6440a16} Common Places FS Folder {d34a6ca6-62c2-4c34-8a7c-14709c1ad938} Control Panel {5399E694-6CE5-4D6C-8FCE-1D8870FDCBA0} Control Panel (All Tasks) {ED7BA470-8E54-465E-825C-99712043E01C} Control Panel (always Category view) {26EE0668-A00A-44D7-9371-BEB064C98683} Control Panel (always Icons view) {21EC2020-3AEA-1069-A2DD-08002B30309D} Credential Manager {1206F5F1-0569-412C-8FEC-3204630DFB70} Date and Time {E2E7934B-DCE5-43C4-9576-7FE4F75E7480} Default Programs {17cd9488-1228-4b2f-88ce-4298e93e0966} delegate folder that appears in Computer {b155bdf8-02f0-451e-9a26-ae317cfd7779} Desktop (folder) {B4BFCC3A-DB2C-424C-B029-7FE99A87C641} Device Manager {74246bfc-4c96-11d0-abef-0020af6b0b7a} Devices and Printers {A8A91A66-3A7D-4424-8D24-04E180695C7A} Display {C555438B-3C23-4769-A71F-B6D3D9B6053A} Documents (folder) {A8CDFF1C-4878-43be-B5FD-F8091C1C60D0} Downloads (folder) {374DE290-123F-4565-9164-39C4925E467B} Ease of Access Center {D555645E-D4F8-4c29-A827-D93C859C4F2A} E-mail (default e-mail program) {2559a1f5-21d7-11d4-bdaf-00c04f60b9f0} Family Safety {96AE8D84-A250-4520-95A5-A47A7E3C548B} Favorites {323CA680-C24D-4099-B94D-446DD2D7249E} File Explorer Options {6DFD7C5C-2451-11d3-A299-00C04F8EF6AF} File History {F6B6E965-E9B2-444B-9286-10C9152EDBC5} Font Settings {93412589-74D4-4E4E-AD0E-E0CB621440FD} Fonts (folder) {BD84B380-8CA2-1069-AB1D-08000948F534} Frequent folders {3936E9E4-D92C-4EEE-A85A-BC16D5EA0819} Games Explorer {ED228FDF-9EA8-4870-83b1-96b02CFE0D52} Get Programs {15eae92e-f17a-4431-9f28-805e482dafd4} Help and Support {2559a1f1-21d7-11d4-bdaf-00c04f60b9f0} HomeGroup (settings) {67CA7650-96E6-4FDD-BB43-A8E774F73A57} HomeGroup (users) {B4FB3F98-C1EA-428d-A78A-D1F5659CBA93} Hyper-V Remote File Browsing {0907616E-F5E6-48D8-9D61-A91C3D28106D} Indexing Options {87D66A43-7B11-4A28-9811-C86EE395ACF7} Infared (if installed) {A0275511-0E86-4ECA-97C2-ECD8F1221D08} Installed Updates {d450a8a1-9568-45c7-9c0e-b4f9fb4537bd} Internet Options (Internet Explorer) {A3DD4F92-658A-410F-84FD-6FBBBEF2FFFE} Keyboard Properties {725BE8F7-668E-4C7B-8F90-46BDB0936430} Language settings {BF782CC9-5A52-4A17-806C-2A894FFEEAC5} Libraries {031E4825-7B94-4dc3-B131-E946B44C8DD5} Location Information (Phone and Modem Control Panel) {40419485-C444-4567-851A-2DD7BFA1684D} Location Settings {E9950154-C418-419e-A90A-20C5287AE24B} Media Servers {289AF617-1CC3-42A6-926C-E6A863F0E3BA} Mouse Properties {6C8EEC18-8D75-41B2-A177-8831D59D2D50} Music (folder) {1CF1260C-4DD0-4ebb-811F-33C572699FDE} My Documents {450D8FBA-AD25-11D0-98A8-0800361B1103} Network {F02C1A0D-BE21-4350-88B0-7367FC96EF3C} Network and Sharing Center {8E908FC9-BECC-40f6-915B-F4CA0E70D03D} Network Connections (in PC settings) {38A98528-6CBF-4CA9-8DC0-B1E1D10F7B1B} Network Connections {7007ACC7-3202-11D1-AAD2-00805FC1270E}OR{992CFFA0-F557-101A-88EC-00DD010CCC48} Network (WorkGroup) {208D2C60-3AEA-1069-A2D7-08002B30309D} Notification Area Icons {05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} NVIDIA Control Panel (if installed) {0bbca823-e77d-419e-9a44-5adec2c8eeb0} Offline Files Folder {AFDB1F70-2A4C-11d2-9039-00C04F8EEB3E} OneDrive {018D5C66-4533-4307-9B53-224DE2ED1FE6} Pen and Touch {F82DF8F7-8B9F-442E-A48C-818EA735FF9B} Personalization {ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} Pictures (folder) {3ADD1653-EB32-4cb0-BBD7-DFA0ABB5ACCA} Portable Devices {35786D3C-B075-49b9-88DD-029876E11C01} Power Options {025A5937-A6BE-4686-A844-36FE4BEC8B6D} Previous Versions Results Folder {f8c2ab3b-17bc-41da-9758-339d7dbf2d88} printhood delegate folder {ed50fc29-b964-48a9-afb3-15ebb9b97f36} Printers {2227A280-3AEA-1069-A2DE-08002B30309D}OR{863aa9fd-42df-457b-8e4d-0de1b8015c60} Programs and Features {7b81be6a-ce2b-4676-a29e-eb907a5126c5} Public (folder) {4336a54d-038b-4685-ab02-99bb52d3fb8b} Quick access {679f85cb-0220-4080-b29b-5540cc05aab6} Recent places {22877a6d-37a1-461a-91b0-dbda5aaebc99} Recovery {9FE63AFD-59CF-4419-9775-ABCC3849F861} Recycle Bin {645FF040-5081-101B-9F08-00AA002F954E} Region and Language {62D8ED13-C9D0-4CE8-A914-47DD628FB1B0} RemoteApp and Desktop Connections {241D7C96-F8BF-4F85-B01F-E2B043341A4B} Remote Printers {863aa9fd-42df-457b-8e4d-0de1b8015c60} Removable Storage Devices {a6482830-08eb-41e2-84c1-73920c2badb9} Results Folder {2965e715-eb66-4719-b53f-1672673bbefa} Run {2559a1f3-21d7-11d4-bdaf-00c04f60b9f0} Search {9343812e-1c37-4a49-a12e-4b2d810d956b} Search Everywhere (modern) {2559a1f8-21d7-11d4-bdaf-00c04f60b9f0} Search Files (modern) {2559a1f0-21d7-11d4-bdaf-00c04f60b9f0} Security and Maintenance {BB64F8A7-BEE7-4E1A-AB8D-7D8273F7FDB6} Set Program Access and Computer Defaults {2559a1f7-21d7-11d4-bdaf-00c04f60b9f0} Show Desktop {3080F90D-D7AD-11D9-BD98-0000947B0257} Sound {F2DDFC82-8F12-4CDD-B7DC-D4FE1425AA4D} Speech Recognition {58E3C745-D971-4081-9034-86E34B30836A} Storage Spaces {F942C606-0914-47AB-BE56-1321B8035096} Sync Center {9C73F5E5-7AE7-4E32-A8E8-8D23B85255BF} Sync Setup Folder {2E9E59C0-B437-4981-A647-9C34B9B90891} System {BB06C0E4-D293-4f75-8A90-CB05B6477EEE} System Icons {05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} \\SystemIcons Tablet PC Settings {80F3F1D5-FECA-45F3-BC32-752C152E456E} Taskbar and Navigation properties {0DF44EAA-FF21-4412-828E-260A8728E7F1} Text to Speech {D17D1D6D-CC3F-4815-8FE3-607E7D5D10B3} This PC {20D04FE0-3AEA-1069-A2D8-08002B30309D} Troubleshooting {C58C4893-3BE0-4B45-ABB5-A63E4B8C8651} User Accounts {60632754-c523-4b62-b45c-4172da012619} User Accounts (netplwiz) {7A9D77BD-5403-11d2-8785-2E0420524153} User Pinned {1f3427c8-5c10-4210-aa03-2ee45287d668} %UserProfile% {59031a47-3f72-44a7-89c5-5595fe6b30ee} Videos (folder) {A0953C92-50DC-43bf-BE83-3742FED03C9C} Web browser (default) {871C5380-42A0-1069-A2EA-08002B30309D} Windows Defender {D8559EB9-20C0-410E-BEDA-7ED416AECC2A} Windows Mobility Center {5ea4f148-308c-46d7-98a9-49041b1dd468} Windows Features {67718415-c450-4f3c-bf8a-b487642dc39b} Windows Firewall {4026492F-2F69-46B8-B9BF-5654FC07E423} Windows To Go {8E0C279D-0BD1-43C3-9EBD-31C3DC5B8A77} Windows Update {36eef7db-88ad-4e81-ad49-0e313f0c35f8} Work Folders {ECDB0924-4208-451E-8EE0-373C0956DE16} reference C:\\Users\\marslo>Netsh netsh>interface In future versions of Windows, Microsoft might remove the Netsh functionality for TCP/IP. Microsoft recommends that you transition to Windows PowerShell if you currently use netsh to configure and manage TCP/IP. Type Get-Command -Module NetTCPIP at the Windows PowerShell prompt to view a list of commands to manage TCP/IP. Visit https://go.microsoft.com/fwlink/?LinkId=217627 for additional information about PowerShell commands for TCP/IP. netsh interface>show helper Helper GUID DLL Filename Command -------------------------------------- ------------ ------- {02BC1F81-D927-4EC5-8CBC-8DD65E3E38E8} AUTHFWCFG.DLL advfirewall {FB10CBCA-5430-46CE-B732-079B4E23BE24} AUTHFWCFG.DLL consec {35342B49-83B4-4FCC-A90D-278533D5BEA2} AUTHFWCFG.DLL firewall {4BD827F7-1E83-462D-B893-F33A80C5DE1D} AUTHFWCFG.DLL mainmode {4D0FEFCB-8C3E-4CDE-B39B-325933727297} AUTHFWCFG.DLL monitor {A31CB05A-1213-4F4E-B420-0EE908B896CB} PEERDISTSH.DLL branchcache {555EA58E-72B1-4F0A-9055-779D0F5400B2} PEERDISTSH.DLL smb {00770721-44EA-11D5-93BA-00B0D022DD1F} HNETMON.DLL bridge {6DC31EC5-3583-4901-9E28-37C28113656A} DHCPCMONITOR.DLL dhcpclient {8A6D23B3-0AF2-4101-BC6E-8114B325FE17} NETIOHLP.DLL dnsclient {8B3A0D7F-1F30-4402-B753-C4B2C7607C97} FWCFG.DLL firewall {44F3288B-DBFF-4B31-A86E-633F50D706B3} NSHHTTP.DLL http {0705ECA1-7AAC-11D2-89DC-006008B0E5B9} IFMON.DLL interface {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL 6to4 {97C192DB-A774-43E6-BE78-1FABD795EEAB} NETIOHLP.DLL httpstunnel {725588AC-7A11-4220-A121-C92C915E8B73} NETIOHLP.DLL ipv4 {500F32FD-7064-476B-8FD6-2171EA46428F} NETIOHLP.DLL ipv6 {90E1CBE1-01D9-4174-BB4D-EB97F3F6150D} NETIOHLP.DLL 6to4 {90E1CBE1-01D9-4174-BB4D-EB97F3F6150D} NETIOHLP.DLL isatap {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL isatap {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL portproxy {78197B47-2BEF-49CA-ACEB-D8816371BAA8} NETIOHLP.DLL tcp {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL teredo {F7E0BC27-BA6E-4145-A123-012F1922F3F1} NSHIPSEC.DLL ipsec {F7E0BC29-BA6E-4145-A123-012F1922F3F1} NSHIPSEC.DLL dynamic {F7E0BC28-BA6E-4145-A123-012F1922F3F1} NSHIPSEC.DLL static {3BB6DA1D-AC0C-4972-AC05-B22F49DEA9B6} NSHWFP.DLL ipsecdosprotection {1D8240C7-48B9-47CC-9E40-4F7A0A390E71} DOT3CFG.DLL lan {B341E8BA-13AA-4E08-8CF1-A6F2D8B0C229} NETIOHLP.DLL namespace {931852E2-597D-40B9-B927-55FFC81A6104} NETIOHLP.DLL netio {0705ECA2-7AAC-11D2-89DC-006008B0E5B9} RASMONTR.DLL ras {42E3CC21-098C-11D3-8C4D-00104BCA495B} RASMONTR.DLL aaaa {90FE6CFC-B6A2-463B-AA12-25E615EC3C66} RASMONTR.DLL diagnostics {13D12A78-D0FB-11D2-9B76-00104BCA495B} RASMONTR.DLL ip {36B3EF76-94C1-460F-BD6F-DF0178D90EAC} RASMONTR.DLL ipv6 {592852F7-5F6F-470B-9097-C5D33B612975} RPCNSH.DLL rpc {C07E293F-9531-4426-8E5C-D7EBBA50F693} RPCNSH.DLL filter {D3E9D893-852F-4E22-B05D-99293065773D} NETTRACE.DLL trace {3BB6DA1D-AC0C-4972-AC05-B22F49DEA9B6} NSHWFP.DLL wfp {0BFDC146-56A3-4311-A7D5-7D9953F8326E} WHHELPER.DLL winhttp {B2C0EEF4-CCE5-4F55-934E-ABF60F3DCF56} WSHELPER.DLL winsock Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:17 "},"cheatsheet/windows/env.html":{"url":"cheatsheet/windows/env.html","title":"env","keywords":"","body":" Table of Contents generated with DocToc default [Windows Environment Variables] List (https://ss64.com/nt/syntax-variables.html) default [Windows Environment Variables] List (https://ss64.com/nt/syntax-variables.html) Variable Default value assuming the system drive is C: ALLUSERSPROFILE C:\\ProgramData APPDATA C:\\Users\\{username}\\AppData\\Roaming ClientName Terminal servers only - the ComputerName of a remote host. CMDEXTVERSION The current Command Processor Extensions version number. (NT = \"1\", Win2000+ = \"2\".) CMDCMDLINE The original command line that invoked the Command Processor. CommonProgramFiles C:\\Program Files\\Common Files COMMONPROGRAMFILES(x86) C:\\Program Files (x86)\\Common Files COMPUTERNAME {computername} COMSPEC C:\\Windows\\System32\\cmd.exe or if running a 32 bit WOW - C:\\Windows\\SysWOW64\\cmd.exe ERRORLEVEL The current ERRORLEVEL value, automatically set when a program exits. HOMEDRIVE C: HOMEPATH C:\\Users\\{username} LOCALAPPDATA C:\\Users\\{username}\\AppData\\Local LOGONSERVER \\\\{domain_logon_server} NUMBER_OF_PROCESSORS The Number of processors running on the machine. OS Operating system on the user's workstation. System C:\\Windows\\System32\\;C:\\Windows\\;C:\\Windows\\System32\\Wbem;{plus program paths} ProgramData C:\\ProgramData ProgramFiles C:\\Program Files or C:\\Program Files (x86) ProgramFiles(x86) 1 C:\\Program Files (x86) (but only available when running under a 64 bit OS) RANDOM A random integer number, anything from 0 to 32,767 (inclusive). %SessionName% Terminal servers only - for a terminal server session, SessionName is a combination of the connection name, followed by #SessionNumber. For a console session, SessionName returns \"Console\". SYSTEMDRIVE C: SYSTEMROOT By default, Windows is installed to C:\\Windows but there's no guarantee of that, Windows can be installed to a different folder, or a different drive letter. TEMP and TMP C:\\Users\\{Username}\\AppData\\Local\\Temp; Under XP this was C:\\{username}\\Local Settings\\Temp TIME The current time using same format as TIME. USERPROFILE %SystemDrive%\\Users{username}. This is equivalent to the $HOME environment variable in Unix/Linux WINDIR %windir% is a regular User variable and can be changed, which makes it less robust than %SystemRoot%; Set by default as windir=%SystemRoot% Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:17 "},"cheatsheet/windows/shell:folder.html":{"url":"cheatsheet/windows/shell:folder.html","title":"shell:folder","keywords":"","body":" Table of Contents generated with DocToc Usage List Usage win + r run> shell:startup List credit belongs to How to Open Hidden System Folders with Windows’ Shell Command Shell Commands to Access the Special Folders in Windows 10/8/7/Vista/XP Shell: folder shortcuts COMMANDS LOCATION shell:AccountPictures %AppData%\\Microsoft\\Windows\\AccountPictures shell:AddNewProgramsFolder Control Panel\\All Control Panel Items\\Get Programs shell:Administrative Tools %AppData%\\Microsoft\\Windows\\Start Menu\\Programs\\Administrative Tools shell:AppData %AppData% shell:Application Shortcuts %LocalAppData%\\Microsoft\\Windows\\Application Shortcuts shell:AppsFolder Applications shell:AppUpdatesFolder Installed Updates shell:Cache %LocalAppData%\\Microsoft\\Windows\\INetCache shell:Camera Roll %UserProfile%\\Pictures\\Camera Roll shell:CD Burning %LocalAppData%\\Microsoft\\Windows\\Burn\\Burn shell:ChangeRemoveProgramsFolder Control Panel\\All Control Panel Items\\Programs and Features shell:Common Administrative Tools %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Administrative Tools shell:Common AppData %ProgramData% shell:Common Desktop %Public%\\Desktop shell:Common Documents %Public%\\Documents shell:CommonDownloads %Public%\\Downloads shell:CommonMusic %Public%\\Music shell:CommonPictures %Public%\\Pictures shell:Common Programs %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs shell:CommonRingtones %ProgramData%\\Microsoft\\Windows\\Ringtones shell:Common Start Menu %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup shell:Common Startup %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup shell:Common Templates %ProgramData%\\Microsoft\\Windows\\Templates shell:CommonVideo %Public%\\Videos shell:ConflictFolder Control Panel\\All Control Panel Items\\Sync Center\\Conflicts shell:ConnectionsFolder Control Panel\\All Control Panel Items\\Network Connections shell:Contacts %UserProfile%\\Contacts shell:ControlPanelFolder Control Panel\\All Control Panel Items shell:Cookies %LocalAppData%\\Microsoft\\Windows\\INetCookies shell:Cookies\\Low %LocalAppData%\\Microsoft\\Windows\\INetCookies\\Low shell:CredentialManager %AppData%\\Microsoft\\Credentials shell:CryptoKeys %AppData%\\Microsoft\\Crypto shell:desktop Desktop shell:device Metadata Store %ProgramData%\\Microsoft\\Windows\\DeviceMetadataStore shell:documentsLibrary Libraries\\Documents shell:downloads %UserProfile%\\Downloads shell:dpapiKeys %AppData%\\Microsoft\\Protect shell:Favorites %UserProfile%\\Favorites shell:Fonts %WinDir%\\Fonts shell:Games Games shell:GameTasks %LocalAppData%\\Microsoft\\Windows\\GameExplorer shell:History %LocalAppData%\\Microsoft\\Windows\\History shell:HomeGroupCurrentUserFolder Homegroup\\{username} shell:HomeGroupFolder Homegroup shell:ImplicitAppShortcuts %AppData%\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\ImplicitAppShortcuts shell:InternetFolder Internet Explorer shell:Libraries Libraries shell:Links %UserProfile%\\Links shell:Local AppData %LocalAppData% shell:LocalAppDataLow %UserProfile%\\AppData\\LocalLow shell:MusicLibrary Libraries\\Music shell:MyComputerFolder This PC shell:My Music %UserProfile%\\Music shell:My Pictures %UserProfile%\\Pictures shell:My Video %UserProfile%\\Videos shell:NetHood %AppData%\\Microsoft\\Windows\\Network Shortcuts shell:NetworkPlacesFolder Network shell:OneDrive OneDrive shell:OneDriveCameraRoll %UserProfile%\\OneDrive\\Pictures\\Camera Roll shell:OneDriveDocuments %UserProfile%\\OneDrive\\Documents shell:OneDriveMusic %UserProfile%\\OneDrive\\Music shell:OneDrivePictures %UserProfile%\\OneDrive\\Pictures shell:Personal %UserProfile%\\Documents shell:PicturesLibrary Libraries\\Pictures shell:PrintersFolder All Control Panel Items\\Printers shell:PrintHood %AppData%\\Microsoft\\Windows\\Printer Shortcuts shell:Profile %UserProfile% shell:ProgramFiles %ProgramFiles% shell:ProgramFilesCommon %ProgramFiles%\\Common Files shell:ProgramFilesCommonX64 %ProgramFiles%\\Common Files (64 bit Windows only) shell:ProgramFilesCommonX86 %ProgramFiles(x86)%\\Common Files (64 bit Windows only) shell:ProgramFilesX64 %ProgramFiles% (64 bit Windows only) shell:ProgramFilesX86 %ProgramFiles(x86)% (64 bit Windows only) shell:Programs %AppData%\\Microsoft\\Windows\\Start Menu\\Programs shell:Public %Public% shell:PublicAccountPictures %Public%\\AccountPictures shell:PublicGameTasks %ProgramData%\\Microsoft\\Windows\\GameExplorer shell:PublicLibraries %Public%\\Libraries shell:Quick Launch %AppData%\\Microsoft\\Internet Explorer\\Quick Launch shell:Recent %AppData%\\Microsoft\\Windows\\Recent shell:RecordedTVLibrary Libraries\\Recorded TV shell:RecycleBinFolder Recycle Bin shell:ResourceDir %WinDir%\\Resources shell:Ringtones %ProgramData%\\Microsoft\\Windows\\Ringtones shell:Roamed Tile Images %LocalAppData%\\Microsoft\\Windows\\RoamedTileImages shell:Roaming Tiles %AppData%\\Microsoft\\Windows\\RoamingTiles shell:SavedGames %UserProfile%\\Saved Games shell:Screenshots %UserProfile%\\Pictures\\Screenshots shell:Searches %UserProfile%\\Searches shell:SearchHistoryFolder %LocalAppData%\\Microsoft\\Windows\\ConnectedSearch\\History shell:SearchHomeFolder search ms: shell:SearchTemplatesFolder %LocalAppData%\\Microsoft\\Windows\\ConnectedSearch\\Templates shell:SendTo %AppData%\\Microsoft\\Windows\\SendTo shell:Start Menu %AppData%\\Microsoft\\Windows\\Start Menu shell:StartMenuAllPrograms StartMenuAllPrograms shell:Startup %AppData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup shell:SyncCenterFolder Control Panel\\All Control Panel Items\\Sync Center shell:SyncResultsFolder Control Panel\\All Control Panel Items\\Sync Center\\Sync Results shell:SyncSetupFolder Control Panel\\All Control Panel Items\\Sync Center\\Sync Setup shell:System %WinDir%\\System32 shell:SystemCertificates %AppData%\\Microsoft\\SystemCertificates shell:SystemX86 %WinDir%\\SysWOW64 shell:Templates %AppData%\\Microsoft\\Windows\\Templates shell:ThisPCDesktopFolder Desktop shell:UsersFilesFolder %UserProfile% shell:User Pinned %AppData%\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned shell:UserProfiles %HomeDrive%\\Users shell:UserProgramFiles %LocalAppData%\\Programs shell:UserProgramFilesCommon %LocalAppData%\\Programs\\Common shell:UsersLibrariesFolder Libraries shell:VideosLibrary Libraries\\Videos shell:Windows %WinDir% Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:17 "},"cheatsheet/character/character.html":{"url":"cheatsheet/character/character.html","title":"character","keywords":"","body":" Table of Contents generated with DocToc get line after the pattern get certain Line between 2 matched patterns working with empty line xargs multiple move subset of arguments sort all shell script by line number diff every git commit against its parent Running multiple commands with xargs find cat config file in all .git folder find && tar tar all and extra in remote exec and sed find and rename trim trim tailing chars regex get URL insert new line write a file without indent space cat and reference: 10 Awk Tips, Tricks and Pitfalls FIND -EXEC VS. FIND | XARGS get line after the pattern $ cat a.txt 1a 2b 3c * (2 lines after `^3c$`) 4d 5e 6f 7g awk $ cat a.txt | awk '$0==\"3c\"{getline; print; getline; print}' 4d 5e $ cat a.txt | awk '/3c/{getline; print; getline; print}' 4d 5e or $ cat a.txt | awk '/^3c$/ {s=NR;next} s && NR or $ cat a.txt | awk '{if(a-->0){print;next}} /3c/{a=2}' 4d 5e or get second column of next line of pattern $ awk '/my.company.com$/{getline; print}' ~/.marslo/.netrc login marslo $ awk '/my.company.com$/{getline; print $2}' ~/.marslo/.netrc marslo sed $ cat a.txt | sed -n '/3c/{n;p;n;p}' 4d 5e $ cat a.txt | sed -n '/3c/{N;p;n;p}' 3c 4d 5e get certain Line between 2 matched patterns reference: How to print lines between two patterns, inclusive or exclusive (in sed, AWK or Perl)? Print lines between PAT1 and PAT2 How to select lines between two marker patterns which may occur multiple times with awk/sed Print lines between (and excluding) two patterns $ cat a.txt 1a 2b 3c * (begining) 4d 5e 6f 7g 8h * (end) 9i 10j 11k awk include pattern$ cat a.txt | awk '/3c/,/8h/' 3c 4d 5e 6f 7g 8h sed don't include pattern $ cat a.txt | sed '1,/3c/d;/8h/,$d' 4d 5e 6f 7g $ cat a.txt | sed '/3c/,/8h/!d;//d' 4d 5e 6f 7g include the pattern$ cat a.txt | sed -n '/3c/,/8h/p' 3c 4d 5e 6f 7g 8h working with empty line $ cat a.txt 1a 2b 3c * (begining) 4d 5e 6f * (ending) 7g 8h 9i 10j 11k $ cat a.txt | sed -n '/3c/,/^$/p' 3c 4d 5e 6f xargs references: xargs Running multiple commands with xargs multiple move $ mkdir ~/backups $ find /path -type f -name '*~' -print0 | xargs -0 -I % cp -a % ~/backups # multiple cp $ find /path -type f -name '*~' -print0 | xargs -0 sh -c 'if [ $# -gt 0 ]; then cp -a \"$@\" ~/backup; fi' sh subset of arguments $ echo {0..9} | xargs -n 2 0 1 2 3 4 5 6 7 8 9 sort all shell script by line number Pipe xargs into find $ find . -name \"*.sh\" | xargs wc -l | sort -hr diff every git commit against its parent $ git log --format=\"%H %P\" | xargs -L 1 git diff Running multiple commands with xargs precondition: $ cat a.txt a b c 123 ###this is a comment $ myCommandWithDifferentQuotes=$(cat echo \"command 1: $@\"; echo 'will you do the fandango?'; echo \"command 2: $@\"; echo -> EOF -> ) $ or$ cat a.txt | xargs -I @@ bash -c \"$myCommandWithDifferentQuotes\" -- @@ or$ while read stuff; do -> echo \"command 1: $stuff\"; -> echo 'will you do the fandango?'; -> echo \"command 2: $stuff\"; -> echo -> done compress sub-folders $ find . -maxdepth 1 ! -path . -type d -print0 \\ | xargs -0 -I @@ bash -c '{ \\ tar caf \"@@.tar.lzop\" \"@@\" \\ && echo Completed compressing directory \"@@\" ; \\ }' execute commands from file create files -t, --verbose Print the command line on the standard error output before executing it. -p, --interactive Prompt the user about whether to run each command line and read a line from the terminal. Only run the command line if the response starts with `y' or `Y'. Implies -t. -I replace-str Replace occurrences of replace-str in the initial-arguments with names read from standard in- put. Also, unquoted blanks do not terminate input items; instead the separator is the new- line character. Implies -x and -L 1. precondition $ cat a.txt a b c $ echo 'a b c' a b c $ echo 'a b c' | xargs -n1 a b c $ echo 'a b c' | xargs -n1 -t touch touch a touch b touch c $ echo 'a b c' | xargs -n1 -p touch touch a ?...y ping multiple ips $ cat a.txt 8.8.8.8 1.1.1.1 $ xargs -L1 -a a.txt /sbin/ping -c 1 PING 8.8.8.8 (8.8.8.8): 56 data bytes 64 bytes from 8.8.8.8: icmp_seq=0 ttl=44 time=82.868 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 packets received, 0.0% packet loss round-trip min/avg/max/stddev = 82.868/82.868/82.868/0.000 ms PING 1.1.1.1 (1.1.1.1): 56 data bytes 64 bytes from 1.1.1.1: icmp_seq=0 ttl=63 time=1.016 ms --- 1.1.1.1 ping statistics --- 1 packets transmitted, 1 packets received, 0.0% packet loss round-trip min/avg/max/stddev = 1.016/1.016/1.016/0.000 ms find cat config file in all .git folder xargs && cat $ find . -type d -name '.git' -print0 | xargs -0 -I {} cat {}/config find && -exec $ find . -type d -name '.git' -exec cat {}/config \\; find && tar backup all config.xml in JENKINS_HOME $ find ${JENKINS_HOME}/jobs -maxdepth 2 -name config\\.xml -type f -print | tar czf ~/config.xml.tar.gz --files-from - back build history $ find ${JENKINS_HOME}/jobs -name builds -prune -o -type f -print | tar czf ~/m.tar.gz --files-from - tar all and extra in remote # ssh -C $ tar cf - . | ssh -C hostname \"cd ~/.marslo/test/; tar xvf -\" Warning: Permanently added '10.69.78.40' (ECDSA) to the list of known hosts. ./ ./temp/ ./a/ ./a/a.txt ./c/ ./b/ or # tar z-flag $ tar cfz - . | ssh hostname \"cd ~/.marslo/test/; tar xvzf -\" copy multiple files to remote server$ tar cvzf - -T list_of_filenames | ssh hostname tar xzf - exec and sed change bunches ip address$ find ${JENKINS_HOME}/jobs \\ -type f \\ -name \"config.xml\" \\ -maxdepth 2 \\ -exec sed -i 's/1.2.3./4.5.6./g' {} \\; -print find and rename $ find -iname \"*.sh\" -exec rename \"s/.sh$/.shell/\" {} \\; -print trim trim tailing chars str='1234567890' awk + rev $ echo $str | rev | cut -c4- | rev 1234567 ${var:: -x}) $ echo ${str:: -3} 1234567 regex get URL $ echo http://www.baidu.com | awk '{for(i=1;i insert new line insert right after the second match string originalexpectedDCR DCR DCRDCR DCR check DCR $ echo -e \"DCR\\nDCR\\nDCR\" |awk 'BEGIN {t=0}; { print }; /DCR/ { t++; if ( t==2) { print \"check\" } }' write a file without indent space $ sed -e 's:^\\s*::' > ~/file-without-indent-space.txt or$ sed -e 's:^\\s*::' > find.aql example$ sed -e 's:^\\s*::' cat and Here Documents: This type of redirection instructs the shell to read input from the current source until a line containing only delimiter (with no trailing blanks) is seen. All of the lines read up to that point are then used as the standard input for a command. The format of here-documents is: No parameter expansion, command substitution, arithmetic expansion, or pathname expansion is performed on word. If any characters in word are quoted, the delimiter is the result of quote removal on word, and the lines in the here-document are not expanded. If word is unquoted, all lines of the here-document are subjected to parameter expansion, command substitution, and arithmetic expansion. In the latter case, the character sequence \\ is ignored, and \\ must be used to quote the characters \\, $, and `. cat with specific character $ man tab ... -T, --show-tabs display TAB characters as ^I other references: Multi-line string with extra space (preserved indentation) Bash - Removing white space from indented multiline strings How to avoid heredoc expanding variables? [duplicate] $ cat -A sample.sh LANG=C tr a-z A-Z $ cat -A sample.sh LANG=C tr a-z A-Z Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:16 "},"cheatsheet/character/markdown.html":{"url":"cheatsheet/character/markdown.html","title":"markdown","keywords":"","body":" Table of Contents generated with DocToc useful unicode Combining Diacritical Marks useful unicode reference HTML Symbols HTML Entities UTF-8 Greek and Coptic symbols unicode (HTML entity nubmer) entity Name desc   &#160; &nbsp; space &#60; &lt; less than > &#62; &gt; greater than « &#xab; &laquo; left-pointing double angle quotation mark » &#xbb; &raquo; right-pointing Double angle quotation mark › &#x203a; &rsaquo; right-pointing single guillemet ‹ &#x2039; &lsaquo; left-pointing single guillemet & &#38; &amp; ampersand | &#124; &#124; vertical bar ← &#8592; &larr; leftwards arrow → &#8594; &rarr; rightwards arrow ↑ &#8593; &uarr; upwards arrow ↓ &#8595; &darr; downwards arrow Combining Diacritical Marks mark unicode character construct result ̀ &#768; a +  ̀ » à a&#768; à ́ &#769; a +  ́ » á a&#769; á ̂ &#770; a +  ̂ » â a&#770; â ̃ &#771; a +  ̃ » ã a&#771; ã ̀ &#768; O +  ̀ » Ò O&#768; Ò ́ &#769; O +  ́ » Ó O&#769; Ó ̂ &#770; O +  ̂ » Ô O&#770; Ô ̃ &#771; O +  ̃ » Õ O&#771; Õ Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:16 "},"cheatsheet/character/json.html":{"url":"cheatsheet/character/json.html","title":"json","keywords":"","body":" Table of Contents generated with DocToc jq format join space in the key reference: jq manual (development version) Parsing JSON with jq Use jq to filter objects list with regex jq: Cannot iterate over number / string and number cannot be added jq format $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r 'to_entries[] | \"\\(.key)\\t\\(.value)\"' some thing json like or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r '[.some, .json] | @csv' \"thing\",\"like\" or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r '[.some, .json] | @tsv' thing like join $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r '[.some, .json] | join(\":\")' thing:like or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r '[.some, .json] | \"\\(.[0]) \\(.[1])\"' thing like or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r '[.some, .json] | \"\\(.[0]): \\(.[1])\"' thing: like or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r '[.some, .json] | reduce .[1:][] as $i (\"\\(.[0])\"; . + \",\\($i)\")' thing,like or$ echo '{ \"k1\": \"v1\", \"k2\": \"v2\", \"k3\": \"v3\", \"k4\": \"v4\" }' \\ | jq -r '[.k1, .k2, .k3] | reduce .[1:][] as $i (\"\\(.[0])\"; . + \",\\($i)\")' v1,v2,v3 or $ echo '{ \"users\": [ { \"first\": \"Stevie\", \"last\": \"Wonder\" }, { \"first\": \"Michael\", \"last\": \"Jackson\" } ] }' \\ | jq -r '.users[] | .first + \" \" + .last' Stevie Wonder Michael Jackson or$ echo '{ \"users\": [ { \"first\": \"Stevie\", \"last\": \"Wonder\" }, { \"first\": \"Michael\", \"last\": \"Jackson\" } ] }' \\ | jq -r '.users[] | .first + \" \" + (.last|tostring)' or$ echo '{ \"users\": [ { \"first\": \"Stevie\", \"last\": \"Wonder\", \"number\": 1 }, { \"first\": \"Michael\", \"last\": \"Jackson\", \"number\": 2 } ] }' \\ | jq -r '.users[] | .first + \" \" + (.number|tostring)' Stevie 1 Michael 2 space in the key $ echo '{ \"k1 name\": \"v1\", \"k2 name\": \"v2\", \"k3\": \"v3\", \"k4\": \"v4\" }' | jq -r '.\"k1 name\"' v1 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:16 "},"cheatsheet/havefun.html":{"url":"cheatsheet/havefun.html","title":"havefun","keywords":"","body":" Table of Contents generated with DocToc I'm very busy Press Any Key to Continue Simulate type mechine [Pretty Cool!!] Get how many days left this years Get week number DOS tree Set Volume by command cat and tac ASCII chart Char chart Hate someone Star war I'm very busy $ cat /dev/urandom | hexdump -C | grep \"ca fe\" Press Any Key to Continue $ read -sn 1 -p \"Press any key to continue...\" && echo \"\\n\" Press any key to continue...\\n Simulate type mechine [Pretty Cool!!] $ sudo apt-get intall pv $ echo \"Very very very very very long words\" | pv -qL $[10+(-2 + RANDOM%5)] # or $ sudo apt-get install randtype $ echo \"Very very very very very long words\" | randtype -m 4 Get how many days left this years $ echo \"There are $(($(date +%j -d\"Dec 31, $(date +%Y)\")-$(date +%j))) left in year $(date +%Y).\" There are 323 left in year 2014. Get week number $ date +\"%V\" 08 DOS tree $ find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g' . |____a_b |____b_a Set Volume by command $ pacmd set-sink-volume 0 0x10000 Welcome to PulseAudio! Use \"help\" for usage information. cat and tac $ cat a_b 1 2 3 $ tac a_b 3 2 1 ASCII chart $ figlet Marslo __ __ _ | \\/ | __ _ _ __ ___| | ___ | |\\/| |/ _` | '__/ __| |/ _ \\ | | | | (_| | | \\__ \\ | (_) | |_| |_|\\__,_|_| |___/_|\\___/ Char chart $ toilet marslo \"\"# mmmmm mmm m mm mmm # mmm # # # \" # #\" \" # \" # #\" \"# # # # m\"\"\"# # \"\"\"m # # # # # # \"mm\"# # \"mmm\" \"mm \"#m#\" Hate someone ┌─ (marslo@MarsloJiao ~) -> └─ $ :(){ :|: & };: Star war ┌─ (marslo@MarsloJiao ~) -> └─ $ telnet towel.blinkenlights.nl Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:16 "},"cheatsheet/media.html":{"url":"cheatsheet/media.html","title":"media","keywords":"","body":" Table of Contents generated with DocToc Highly Recommanded Video Get Audio from video Convert flv to mp4 Combine video and audio Image identity an image convert svg to png convert HEIC/HEIF to PNG Highly Recommanded cmd.to Video Get Audio from video $ ffmpeg -i source.mpg -f s16le -acodec pcm_s16le audio.raw Convert flv to mp4 $ ffmpeg -i name.flv -qscale 0 name.mp4 convert to 5 mins (300 sec) $ ffmpeg -i name.mp4 -ss 0 -t 300 name-5m.mp4 sequence convert (every 5 mins ~> 300 secs) first 5 mins (0 ~> 300) $ ffmpeg -i name.mp4 -ss 0 -t 300 name-5m-1.mp4 second 5 mins (300*1 ~> 300) $ ffmpeg -i name.mp4 -ss 300 -t 300 name-5m-2.mp4 third 5 mins (300*2 ~> 300) $ ffmpeg -i name.mp4 -ss 600 -t 300 name-5m-3.mp4 Combine video and audio $ ffmpeg -i -i -c copy -map 0:0 -map 1:0 -shortest Image identity an image $ identify arms009.jpg | grep -o \"[[:digit:]]*x[[:digit:]]*\" | tail -1 1024x768 convert svg to png $ qlmanage -t -s 1000 -o . k-1.svg convert HEIC/HEIF to PNG $ brew install imagemagick --with-libheif # for single convert $ magick convert [-monitor] .HEIC .png # for batch convert $ magick mogrify [-monitor] -format png *.HEIC. Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:16 "},"cheatsheet/osx.html":{"url":"cheatsheet/osx.html","title":"osx","keywords":"","body":" Table of Contents generated with DocToc system information Get OSX Info Reboot if system freezed Setup HostName and LocalHostname Setup Bash as default SHELL Disable Guest User Go to Hidden path in Finder ReIndex Spotilght copy STDOUT into clipboard Copy path from finder System Integrity Protection change Mac default settings development environment Setup JAVA_HOME xCode Homebrew system settings accessory QnA x86_64 liblzma.dylib in nokogiri Reference system information Get OSX Info $ sw_vers ProductName: Mac OS X ProductVersion: 10.15.6 BuildVersion: 19G73 $ /usr/sbin/system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Name: MacBook Pro Model Identifier: MacBookPro15,1 Processor Name: 6-Core Intel Core i7 Processor Speed: 2.2 GHz Number of Processors: 1 Total Number of Cores: 6 L2 Cache (per Core): 256 KB L3 Cache: 9 MB Hyper-Threading Technology: Enabled Memory: 16 GB Boot ROM Version: 1037.147.1.0.0 (iBridge: 17.16.16065.0.0,0) Serial Number (system): C02XFGWEJG5H Hardware UUID: 4EA008BF-9B36-5F1D-9151-AD4F64808AAB Activation Lock Status: Enabled get CPU information $ sysctl -n machdep.cpu.brand_string Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz # or $ sysctl machdep.cpu machdep.cpu.max_basic: 22 machdep.cpu.max_ext: 2147483656 machdep.cpu.vendor: GenuineIntel machdep.cpu.brand_string: Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz machdep.cpu.family: 6 ... get more details $ sysctl -a Reboot if system freezed $ sudo systemsetup -setrestartfreeze on Setup HostName and LocalHostname $ sudo scutil --set HostName [HOSTNAME] $ sudo scutil --set LocalHostName [HOSTNAME] $ sudo scutil --set ComputerName [HOSTNAME] # Optional $ dscacheutil -flushcache # Flush the DNS Cache $ sudo shutdown -r now Setup Bash as default SHELL $ chsh -s /bin/bash # OR $ chsh -s `which bash` Disable Guest User $ dscl . delete /Users/Guest $ sudo defaults write /Library/Preferences/com.apple.AppleFileServer guestAccess -bool NO $ sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server AllowGuestAccess -bool NO Go to Hidden path in Finder Command+Shift+G ReIndex Spotilght $ sudo mdutil -i on / $ sudo mdutil -E / $ sudo mdutil -E /Volumes/marslo/ copy STDOUT into clipboard refer to: osx/tricky Copy path from finder refer to: osx/tricky System Integrity Protection refer to: osx/tricky change Mac default settings refer to: osx/defaults development environment Setup JAVA_HOME $ /usr/libexec/java_home -v 1.8.0.162 -exec javac -versioin xCode refer to osx xCode installation Install from App Store Offline Package xCode 9.0.1 Command_Line_Tools_macOS_10.13_for_Xcode_9.0.1 All Packages more details xCode Setup $ sudo xcodebuild -license [accept] xCode CommandLine Tools Verify installed or not $ xcode-select -p xCode CommandLine tools Installation $ xcode-select --install xcode-select: note: install requested for command line developer tools upgrade CommandLine tools $ softwareupdate --all --install --force or $ sudo rm -rf /Library/Developer/CommandLineTools $ sudo xcode-select --install xcode Components Installation $ for pkg in /Applications/Xcode.app/Contents/Resources/Packages/*.pkg; do > sudo installer -pkg \"$pkg\" -target /; > done example: $ ls -altrh /Applications/Xcode.app/Contents/Resources/Packages/ total 180512 -rw-r--r-- 1 root wheel 87K Mar 10 2017 MobileDeviceDevelopment.pkg -rw-r--r-- 1 root wheel 5.4M Sep 30 05:28 XcodeSystemResources.pkg -rw-r--r-- 1 root wheel 11K Sep 30 05:28 XcodeExtensionSupport.pkg -rw-r--r-- 1 root wheel 83M Sep 30 05:28 MobileDevice.pkg drwxr-xr-x 6 root wheel 204B Oct 11 05:23 ./ drwxr-xr-x 87 root wheel 2.9K Oct 11 05:55 ../ $ for pkg in /Applications/Xcode.app/Contents/Resources/Packages/*.pkg; do -> sudo installer -pkg \"$pkg\" -target /; -> done installer: Package name is MobileDevice installer: Upgrading at base path / installer: The upgrade was successful. installer: Package name is MobileDeviceDevelopment installer: Installing at base path / installer: The install was successful. installer: Package name is XcodeExtensionSupport installer: Installing at base path / installer: The install was successful. installer: Package name is XcodeSystemResources installer: Installing at base path / installer: The install was successful. Enable Developer Mode $ DevToolsSecurity -enable show SDK path $ xcrun --show-sdk-path /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk Homebrew refer to: osx/apps.md system settings refer to: osx/apps accessory refer to: osx/apps QnA x86_64 liblzma.dylib in nokogiri Solution 1: $ brew unlink xz $ gem install nokogiri # or gem install cupertino $ brew link xz Solutioin 2 (using system libraies): $ brew install libxml2 $ gem install nokogiri -- --use-system-libraries --with-xml2-include=$(brew --prefix libxml2)/include/libxml2 or $ bundle config build.nokogiri --use-system-libraries --with-xml2-include=$(brew --prefix libxml2)/include/libxml2 $ bundle install or $ brew link --force libxml2 $ gem install nokogiri -v '1.7.0.1' -- --use-system-libraries --with-xml2-include=/usr/include/libxml2 --with-xml2-lib=/usr/lib Reference osx chflags man page Show Hidden Files in Mac OS X Mac Keyboard Shortcuts How to reinstall macOS How to Find the Wi-Fi Password of your Current Network How to Find Wi-Fi Network Passwords from Command Line on Mac 5 Stupid Terminal Tricks to Keep You Entertained Install Nokogiri OSX实用命令 Locking files and folders to prevent changes Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:16 "},"devops/adminTools.html":{"url":"devops/adminTools.html","title":"devops","keywords":"","body":" Table of Contents generated with DocToc Network Tools Reference Network Tools vnstat $ vnstat -l 1 -i en7 Monitoring en7... (press CTRL-C to stop) rx: 4.10 kbit/s 21.00 KiB tx: 0 bit/s 6.00 KiB^C en7 / traffic statistics rx | tx --------------------------------------+------------------ bytes 21.00 KiB | 6.00 KiB --------------------------------------+------------------ max 53.25 kbit/s | 12.29 kbit/s average 17.20 kbit/s | 4.92 kbit/s min 0 bit/s | 0 bit/s --------------------------------------+------------------ packets 60 | 52 --------------------------------------+------------------ max 15 p/s | 16 p/s average 6 p/s | 5 p/s min 2 p/s | 0 p/s --------------------------------------+------------------ time 10 seconds ipcalc $ ipcalc 10.25.130.2/23 Address: 10.25.130.2 00001010.00011001.1000001 0.00000010 Netmask: 255.255.254.0 = 23 11111111.11111111.1111111 0.00000000 Wildcard: 0.0.1.255 00000000.00000000.0000000 1.11111111 => Network: 10.25.130.0/23 00001010.00011001.1000001 0.00000000 HostMin: 10.25.130.1 00001010.00011001.1000001 0.00000001 HostMax: 10.25.131.254 00001010.00011001.1000001 1.11111110 Broadcast: 10.25.131.255 00001010.00011001.1000001 1.11111111 Hosts/Net: 510 Class A, Private Internet $ ipcalc 10.25.131.1/23 Address: 10.25.131.1 00001010.00011001.1000001 1.00000001 Netmask: 255.255.254.0 = 23 11111111.11111111.1111111 0.00000000 Wildcard: 0.0.1.255 00000000.00000000.0000000 1.11111111 => Network: 10.25.130.0/23 00001010.00011001.1000001 0.00000000 HostMin: 10.25.130.1 00001010.00011001.1000001 0.00000001 HostMax: 10.25.131.254 00001010.00011001.1000001 1.11111110 Broadcast: 10.25.131.255 00001010.00011001.1000001 1.11111111 Hosts/Net: 510 Class A, Private Internet iostat $ iostat disk0 cpu load average KB/t tps MB/s us sy id 1m 5m 15m 19.85 37 0.72 3 1 96 1.78 1.90 1.69 tcpdump $ sudo tcpdump -A -i en7 tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on en7, link-type EN10MB (Ethernet), capture size 262144 bytes 00:33:02.787671 IP 10.25.130.117.53629 > a23-43-240-92.deploy.static.akamaitechnologies.com.https: Flags [.], ack 697481089, win 2048, length 0 E..(....@... ..u.+.\\.}..r...)...P...:... 00:33:02.790119 IP 10.25.130.117.51541 > sh-vdc01.mycompany.com.domain: 53089+ PTR? 92.240.43.23.in-addr.arpa. (43) E..GP....._. ..u &t..U.5.3...a...........92.240.43.23.in-addr.arpa..... 00:33:02.812866 ARP, Request who-has gw-voice-idf.cdu-cn.mycompany.com tell gw-vg224-idf.cdu-cn.mycompany.com, length 46 .... .... 13 packets captured 25 packets received by filter 0 packets dropped by kernel dstat strace sar Reference 20 Command Line Tools to Monitor Linux Performance 20 Linux System Monitoring Tools Every SysAdmin Should Know Top 25 Best Linux Performance Monitoring and Debugging Tools http://www.thegeekstuff.com/2010/12/50-unix-linux-sysadmin-tutorials 16 commands to check hardware information on Linux Best UNIX shell-based tools Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:00 "},"devops/git/git.html":{"url":"devops/git/git.html","title":"git","keywords":"","body":"Git Command Study and practice Table of Contents generated with DocToc Appoint Git Alias git branch create empty branch get branch name from reversion git log show files and status without comments show submodule changes get change from .git/objects get change history for deleted files git rebase automatic edit by git rebase -i auto rebaes fix typo in commits git mv case sensitive git submodule init submodule update submodule revert changes in submodule working with submodule remove submodule clean clean untracked directory and item in .gitignore undo delete after push change latest comments in local tag get distance between tags checkout checkout specific commit checkout single branch tricky and scripts commits remove warning: CRLF will be replaced by LF in xxx file for .gitattributes create multiple commits git commit .gitattributes fetch merge all fetchall .marslorc reference: git-tips/tips 521xueweihan/git-tips CS Visualized: Useful Git Commands Appoint Git Alias br = branch co = checkout coa = commit --amend --no-edit pl = !git --no-pager log --color --graph --pretty=tformat:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(blue)%Creset' --abbrev-commit --date=relative --max-count=3 pls = log --color --graph --pretty=tformat:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(blue)%Creset' --abbrev-commit --date=relative fpl = log --color --graph --pretty=tformat:'%Cred%H%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(blue)%Creset' --abbrev-commit --date=relative fl = log -p --graph --color --graph rlog = \"!bash -c 'while read branch; do \\n\\ git fetch --all --force; \\n\\ git pl remotes/origin/$branch; \\n\\ done git branch create empty branch create an empty branch $ mkdir && cd $_ $ git init $ git remote add origin $ git fetch --all --progress --force $ git checkout -b push to remote $ git add --all . $ git commit -m 'inital an empty branch' $ git push --force -u origin HEAD: git alias ~/.gitconfig.alias: [alias] init-repo = \"!f() { \\ declare help=\\\"\\\"\\\"\\ USAGE: git init-repo [DEFAULT_BRANCH] [LOCAL_DIR] \\n\\ OPT: \\n\\ REMOTE_URL: mandatory \\n\\ DEFAULT_BRANCH: optinal. default is 'master' \\n\\ LOCAL_DIR: optional. default is current directory: '\\\"$(pwd)\\\"' \\n\\ \\\"\\\"\\\"; \\ declare remoteURL=\\\"$1\\\"; \\ declare defaultBr='master'; \\ declare localDir='.'; \\ [ 2 -eq $# ] && defaultBr=\\\"$2\\\"; \\ [ 3 -eq $# ] && localDir=\\\"$3\\\"; \\ if [ 0 -eq $# ]; then \\ echo \\\"${help}\\\"; \\ else \\ [ -d ${localDir} ] || mkdir -p ${localDir}; \\ cd ${localDir} ; \\ git init && \\ git remote add origin ${remoteURL} && \\ git fetch --all --force --quiet && \\ git checkout -b ${defaultBr}; \\ fi \\ }; f\" get branch name from reversion branch -a --contians $ git branch -a --contains a3879d3 * master remotes/origin/master or $ git branch -r --contains a3879d3 origin/master name-rev $ git name-rev a3879d3 a3879d3 master~12 git log show files and status without comments $ git log --color --stat --abbrev-commit --date=relative --graph --submodule --format=\"%H\" more # or $ git log --color --stat --abbrev-commit --date=relative --graph --submodule --format=\"%h %ad- %s [%an]\" # or $ git log --color --stat --abbrev-commit --date=relative --graph --submodule --format='%C(red)%h%Creset %C(yellow)(%ad)%Creset %s %C(blue)%Creset' e.g.: $ git log -3 --color --stat --abbrev-commit --date=relative --graph --submodule --format=\"%H\" * 50ede51fcc3cf0311fd85b3e9c4a36d4beb89e69 | | devops/git/gerrit.md | 6 ++++-- | devops/git/git.md | 5 +++++ | 2 files changed, 9 insertions(+), 2 deletions(-) * 41d58dabcd0aaee33edd1de7793ffd82c7cffa89 | | SUMMARY.md | 2 +- | 1 file changed, 1 insertion(+), 1 deletion(-) * 4460a32d8fddbe7c5c434947aea153273ce215d4 | | devops/git/{gitStudy.md => git.md} | 117 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++- | 1 file changed, 116 insertions(+), 1 deletion(-) show submodule changes $ git submodule status $ git log -- get change from .git/objects $ find .git/objects -type f -printf \"%P\\n\" | sed s,/,, get change history for deleted files full-history $ git log --all --full-history -- or $ git log --all --full-history --online -- or $ git log --oneline --follow -- or $ git log --diff-filter=D --summary | find \"delete\" | grep --follow $ git log --follow git rebase about GIT_SEQUENCE_EDITOR git rebase in depth automatic edit by git rebase -i inspired from .gitconfig & Is there a way to squash a number of commits non-interactively? $ COUNT=$1 $ GIT_EDITOR=\"sed -i -e '2,$COUNT s/^pick /s /;/# This is the 2nd commit message:/d'\" git rebase -i HEAD~$COUNT git alias [alias] sq = ! \"f() { TARGET=$1 && GIT_EDITOR=\\\"sed -i -e '2,$TARGET s/^pick /s /;/# This is the 2nd commit message:/,$ {d}'\\\" git rebase -i HEAD~$TARGET; }; f\" example or $ GIT_SEQUENCE_EDITOR=\"sed -i 's/^pick ce5efdb /edit ce5efdb /;/^pick ce6efdb /d'\" git rebase -i ${SHA} or edit $ GIT_SEQUENCE_EDITOR=\"sed -i -re 's/^pick 134567/e 1234567/'\" git rebase -i 1234567^ or sequence.editor $ git -c sequence.editor='sed -i s/pick/reword/' rebase -i ${SHA} auto rebaes .gitconfig [alias] arebase = ! ~/.marslo/bin/arebase.sh ~/.marslo/bin/arebase.sh #!/bin/bash ACTION=$1 COMMIT=$(git rev-parse --short $2) [[ \"$COMMIT\" ]] || exit 1 CORRECT= for A in p pick r reword e edit s squash f fixup d drop t split; do [[ $ACTION == $A ]] && CORRECT=1 done [[ \"$CORRECT\" ]] || exit 1 git merge-base --is-ancestor $COMMIT HEAD || exit 1 if [[ $ACTION == \"drop\" || $ACTION == \"d\" ]]; then GIT_SEQUENCE_EDITOR=\"sed -i -e '/^pick $COMMIT/d'\" git rebase -i $COMMIT^^ elif [[ $ACTION == \"split\" || $ACTION == \"t\" ]]; then GIT_SEQUENCE_EDITOR=\"sed -i -e 's/^pick $COMMIT/edit $COMMIT/'\" git rebase -i $COMMIT^^ || exit 1 git reset --soft HEAD^ echo \"Hints:\" echo \" Select files to be commited using 'git reset', 'git add' or 'git add -p'\" echo \" Commit using 'git commit -c $COMMIT'\" echo \" Finish with 'git rebase --continue'\" else GIT_SEQUENCE_EDITOR=\"sed -i -e 's/^pick $COMMIT/$1 $COMMIT/'\" git rebase -i $COMMIT^^ fi fix typo in commits $ EDITOR=\"sed -i -e 's/borken/broken/g'\" GIT_SEQUENCE_EDITOR=\"sed -i -e 's/pick/reword/g'\" git rebase -i --root or: $ VISUAL=\"sed -i -e '/^[[:blank:]]*Change-Id/ d'\" GIT_SEQUENCE_EDITOR=\"sed -i -e 's/pick/reword/g'\" git rebase -i --root or: $ GIT_EDITOR=\"sed -i -e 's/kyewrod/keyword/g'\" GIT_SEQUENCE_EDITOR=\"sed -i -e 's/pick/reword/g'\" git rebase -i --root git mv case sensitive error with regular git mv $ git config --global core.ignorecase true $ git mv Tig tig fatal: renaming 'confs/home/Tig' failed: Invalid argument renmae $ git mv Tig temp $ git aa $ git mv temp tig $ git aa $ git st On branch master Your branch is up to date with 'origin/master'. Changes to be committed: (use \"git restore --staged ...\" to unstage) renamed: Tig/.tig/marslo.tigrc -> tig/.tig/marslo.tigrc renamed: Tig/.tigrc -> tig/.tigrc renamed: Tig/.tigrc_latest -> tig/.tigrc_latest renamed: Tig/tigrc_2.4.1_1_example -> tig/tigrc_2.4.1_1_example renamed: Tig/tigrc_Marslo -> tig/tigrc_Marslo git submodule reference: gitmodules - Defining submodule properties Gerrit Code Review - Superproject subscription to submodules updateshttps://gerrit-review.googlesource.com/Documentation/user-submodules.html init submodule $ git submodule add -b $ git submodule init $ git submodule update --init update submodule $ git config -f .gitmodules submodule..branch $ git submodule update --remote revert changes in submodule $ git submodule deinit -f . $ git submodule update --init or or $ git submodule foreach --recursive git clean -dffx $ git submodule foreach --recursive git reset --hard working with submodule pull from remote update submodule only$ git submodule update --remote --recursive --force --rebase update both super and submodule$ git pull [--rebase] --recurse-submodules push to remote push submodule only$ cd $ git push --recurse-submodule=on-demand push for both super and submodule $ cd $ git add --all $ git commit -am \"\" $ git push --recurse-submodule=on-demand $ cd $(git rev-parse --show-superproject-working-tree) # or: https://stackoverflow.com/a/7359782/2940319 $ cd $(git rev-parse --show-superproject-working-tree --show-toplevel | head -1) $ git add --all $ git commit -am \"\" $ git push origin $(git rev-parse --abbrev-ref HEAD) remove submodule $ git rm --cached $ rm -rf $ rm -rf .gitmodules $ rm -rf .git/modules/ $ vim .git/config clean clean untracked directory and item in .gitignore $ git clean -dfx using -f twice if you really want to remove such a directory $ git st On branch meta/config Your branch is based on 'origin/meta/config', but the upstream is gone. (use \"git branch --unset-upstream\" to fixup) Untracked files: (use \"git add ...\" to include in what will be committed) my-sbumodule/ nothing added to commit but untracked files present (use \"git add\" to track) $ git clean -dfx Skipping repository my-submodule/ $ git clean -dffx Removing my-submodule/ undo delete after push delete only the latest commit $ git push origin +^: # e.g.: $ git pl --pretty=format:\"%h\" --no-patch * cb46bdc * 936543c * a83ac6b # delete cb46bdc $ git push origin +cb46bdc^:master delete multiple commits revert local $ git reset --hard HEAD~ # or $ git reset --hard HEAD^^^ # or $ git reset --hard # or $ git rebase -i HEAD~ push to remote $ git push [--force] origin + # e.g.: $ git push [--force] origin +master revert single file to remotes $ git checkout origin/ -- Git Reset vs Revert vs Checkout reference Command Scope Common use cases git reset Commit-level Discard commits in a private branch or throw away uncommited changes git reset File-level Unstage a file git checkout Commit-level Switch between branches or inspect old snapshots git checkout File-level Discard changes in the working directory git revert Commit-level Undo commits in a public branch git revert File-level (N/A) change latest comments in local $ git commit --amend change comments in remote $ git pl * a79d384 - (HEAD -> master, origin/master, origin/HEAD) update (11 seconds ago) * 7cef7c7 - update (7 hours ago) * e1d7a64 - update (7 hours ago) # change comments on a79d384 $ git commit --amend $ git push --force-with-lease origin master # result $ git fetch --all --force $ git pl remotes/origin/master Fetching origin * ba49259 - (HEAD -> master, origin/master, origin/HEAD) update a79d384 for change comments (24 seconds ago) * 7cef7c7 - update (7 hours ago) * e1d7a64 - update (7 hours ago) change remote root comments $ git rebase -i --root $ git push origin + change remote comments $ git rebase -i HEAD~ And then change pick to reword example $ git pls * 1e7d979 - (HEAD -> master, origin/master, origin/HEAD) f (24 seconds ago) * 9b89ed7 - c (40 seconds ago) * beb575f - d (51 seconds ago) * 25d010d - e (57 seconds ago) * c502e34 - b (64 seconds ago) * 8890288 - init commit (4 minutes ago) $ git rebase -i HEAD~5 reword c502e34 b pick 25d010d e pick beb575f d reword 9b89ed7 c pick 1e7d979 f $ git push --force origin master # or $ git push origin +master tag get distance between tags $ git describe HEAD --tags or $ git describe HEAD --all --long checkout checkout specific commit # credit belongs to https://stackoverflow.com/a/3489576/2940319 # make a new blank repository in the current directory git init # add a remote git remote add origin url://to/source/repository # fetch a commit (or branch or tag) of interest # Note: the full history up to this commit will be retrieved unless # you limit it with '--depth=...' or '--shallow-since=...' git fetch origin # reset this repository's master branch to the commit of interest git reset --hard FETCH_HEAD checkout single branch $ git clone --single-branch --branch url://to/source/repository [target dir] tricky and scripts commits the first commit$ git rev-list --max-parents=0 HEAD remove warning: CRLF will be replaced by LF in xxx file for .gitattributes $ git add --all -u --renormalize . or ignore the warning$ git config --global core.safecrlf false create multiple commits for c in {0..10}; do echo \"$c\" >>squash.txt git add squash.txt git commit -m\"Add '$c' to squash.txt\" done git commit emoji .gitattributes Refreshing the repository after committing .gitattributes reference: Please Add .gitattributes To Your Git Repository Git tip: Add a .gitattributes file to deal with line endings gitattributes - Defining attributes per path Force LF eol in git repo and working copy $ rm -rf .git/index # or $ git rm --cached -r . # or $ git ls-files -z | xargs -0 rm $ git reset --hard or $ echo \"* text=auto\" >.gitattributes $ git add --renormalize . $ git status # Show files that will be normalized $ git commit -m \"Introduce end-of-line normalization\" format reference Be a Git ninja: the .gitattributes file $ cat .gitattributes * text=auto *.sh eol=lf path/to/file eol=lf fetch merge all $ cat ~/.gitconfig ... [alias] ua = \"!bash -c 'while read branch; do \\n\\ echo -e \\\"\\\\033[1;33m~~> ${branch}\\\\033[0m\\\" \\n\\ git fetch --all --force; \\n\\ if [ 'meta/config' == \\\"${branch}\\\" ]; then \\n\\ git fetch origin --force refs/${branch}:refs/remotes/origin/${branch} \\n\\ fi \\n\\ git rebase -v refs/remotes/origin/${branch}; \\n\\ git merge --all --progress refs/remotes/origin/${branch}; \\n\\ git remote prune origin; \\n\\ if git --no-pager config --file $(git rev-parse --show-toplevel)/.gitmodules --get-regexp url; then \\n\\ git submodule sync --recursive; \\n\\ git submodule update --init --recursive \\n\\ fi \\n\\ done fetchall .marslorc .marslorc Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:02 "},"devops/git/eol.html":{"url":"devops/git/eol.html","title":"eol","keywords":"","body":" Table of Contents generated with DocToc theory list eol in repo core.autocrlf please notice practice force using lf in both remote and local ignore warning: LF will be replaced by CRLF Reference theory list eol in repo > git ls-files --eol core.autocrlf parameters core.autocrlf false input true git commit lf > lf cr > cr crlf > crlf lf > lf cr > cr crlf > lf lf > lf cr > cr crlf > lf git checkout lf > lf cr > cr crlf > crlf lf > lf cr > cr crlf > crlf lf > lf cr > cr crlf > crlf normally, it will looks like core.autocrlf=true: core.autocrlf=input: core.autocrlf=false: repo repo repo ^ V ^ V ^ V / \\ / \\ / \\ crlf->lf lf->crlf crlf->lf \\ / \\ / \\ / \\ / \\ set in GUI checkout Windows-style, commit Unix-style line endings: $ git config --global core.autocrlf true Text files checked-out from the repository that have only LF characters are normalized to CRLF in your working tree; files that contain CRLF in the repository will not be touched Text files that have only LF characters in the repository, are normalized from CRLF to LF when committed back to the repository. Files that contain CRLF in the repository will be committed untouched. Checkout as-is, commit Unix-Style line endings: $ git config --global core.autocrlf input Text files checked-out from the repository will keep original EOL characters in your working tree. Text files in your working tree with CRLFcharacters are normalized to LF when committed back to the repository. Checkout as-is, commit as-is: $ git config --global core.autocrlf false core.eol dictates EOL characters in the text files of your working tree. core.eol = native by default, which means Windows EOLs are CRLF and *nix EOLs are LF in working trees. Repository gitattributes settings determines EOL character normalization for commits to the repository (default is normalization to LF characters). please notice eol This attribute sets a specific line-ending style to be used in the working directory. It enables end-of-line conversion without any content checks, effectively setting the text attribute. Note that setting this attribute on paths which are in the index with CRLF line endings may make the paths to be considered dirty. Adding the path to the index again will normalize the line endings in the index. practice force using lf in both remote and local $ git config core.eol lf $ git config core.autocrlf input or $ git config --global core.eol lf $ git config --global core.autocrlf input ignore warning: LF will be replaced by CRLF $ git config --global core.safecrlf false Reference Force LF eol in git repo and working copy Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:02 "},"devops/git/example.html":{"url":"devops/git/example.html","title":"example","keywords":"","body":" Table of Contents generated with DocToc rebase Without Confilite file With Confilite file rebase Without Confilite file Precondiction $ git pl 37a0595 - (HEAD, master) 2: 2.txt (5 seconds ago) 1d9bcce - Initial commit (65 minutes ago) $ git rlog 4e3106e - (origin/master, origin/HEAD) 1: 1.txt (2 minutes ago) 1d9bcce - Initial commit (65 minutes ago) $ git br master $ git push To git@github.com:Marslo/GitStudy.git ! [rejected] master -> master (non-fast-forward) error: failed to push some refs to 'git@github.com:Marslo/GitStudy.git' hint: Updates were rejected because the tip of your current branch is behind hint: its remote counterpart. Merge the remote changes (e.g. 'git pull') hint: before pushing again. hint: See the 'Note about fast-forwards' in 'git push --help' for details. Merge with rebase Use command: git pulll --rebase $ git pull --rebase First, rewinding head to replay your work on top of it... Applying: 2: 2.txt Check the status after pull rebase Check the status The status of meraged file hasn't been changed $ git st # On branch master # Your branch is ahead of 'origin/master' by 1 commit. # (use \"git push\" to publish your local commits) # nothing to commit, working directory clean The branch hasn't been changed $ git br master Log added the remote new version $ git pl 7bc54e0 - (HEAD, master) 2: 2.txt (12 seconds ago) 4e3106e - (origin/master, origin/HEAD) 1: 1.txt (4 minutes ago) 1d9bcce - Initial commit (68 minutes ago) $ git rlog 4e3106e - (origin/master, origin/HEAD) 1: 1.txt (4 minutes ago) 1d9bcce - Initial commit (68 minutes ago) With Confilite file Precondiction $ git pl 94a5935 - (HEAD, master) 2: 1 (25 seconds ago) 1d9bcce - Initial commit (25 minutes ago) $ git rlog b9709fe - (origin/master, origin/HEAD) 1: 1 (71 seconds ago) $ git br master $ git push To git@github.com:Marslo/GitStudy.git ! [rejected] master -> master (non-fast-forward) error: failed to push some refs to 'git@github.com:Marslo/GitStudy.git' hint: Updates were rejected because the tip of your current branch is behind hint: its remote counterpart. Merge the remote changes (e.g. 'git pull') hint: before pushing again. hint: See the 'Note about fast-forwards' in 'git push --help' for details. Merge by rebase Using command: git pull --rebase $ git pull --rebase First, rewinding head to replay your work on top of it... Applying: 2: 1 Using index info to reconstruct a base tree... M README.md Falling back to patching base and 3-way merge... Auto-merging README.md CONFLICT (content): Merge conflict in README.md Failed to merge in the changes. Patch failed at 0001 2: 1 The copy of the patch that failed is found in: /home/marslo/Tools/Git/2_GitStudy/.git/rebase-apply/patch When you have resolved this problem, run \"git rebase --continue\". If you prefer to skip this patch, run \"git rebase --skip\" instead. To check out the original branch and stop rebasing, run \"git rebase --abort\". Check the status after pull rebase branch is changed (master -> no branch) $ git br (no branch, rebasing master) master Status from unchanged and staged -> Umerged $ git st # HEAD detached at b9709fe # You are currently rebasing branch 'master' on 'b9709fe'. # (fix conflicts and then run \"git rebase --continue\") # (use \"git rebase --skip\" to skip this patch) # (use \"git rebase --abort\" to check out the original branch) # # Unmerged paths: # (use \"git reset HEAD ...\" to unstage) # (use \"git add ...\" to mark resolution) # # both modified: README.md # no changes added to commit (use \"git add\" and/or \"git commit -a\") Log changed: New committed version has been removed Remote new version has been *added $ git rlog b9709fe - (HEAD, origin/master, origin/HEAD) 1: 1 (2 minutes ago) 1d9bcce - Initial commit (26 minutes ago) $ git pl b9709fe - (HEAD, origin/master, origin/HEAD) 1: 1 (2 minutes ago) 1d9bcce - Initial commit (26 minutes ago) The conflicted file has been meraged $ git add . $ git st # HEAD detached at b9709fe # You are currently rebasing branch 'master' on 'b9709fe'. # (all conflicts fixed: run \"git rebase --continue\") # # Changes to be committed: # (use \"git reset HEAD ...\" to unstage) # # modified: README.md # $ git br (no branch, rebasing master) master $ git diff --staged diff --git a/README.md b/README.md index b1acca3..12afed2 100644 --- a/README.md +++ b/README.md @@ -1 +1,5 @@ +>>>>>> 2: 1 open all conflicted files $ git diff --name-only --diff-filter=U | uniq | xargs $EDITOR Return to master branch $ git rebase --continue Applying: 2: 1 Check the status The merged file (Unmerged) -> staged $ git st # On branch master # Your branch is ahead of 'origin/master' by 1 commit. # (use \"git push\" to publish your local commits) # nothing to commit, working directory clean Log added the remote new version $ git pl d6962d6 - (HEAD, master) 2: 1 (4 seconds ago) b9709fe - (origin/master, origin/HEAD) 1: 1 (3 minutes ago) 1d9bcce - Initial commit (27 minutes ago) $ git rlog b9709fe - (origin/master, origin/HEAD) 1: 1 (3 minutes ago) 1d9bcce - Initial commit (27 minutes ago) Branch changed no branch, rebasing master -> master $ git br master Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:02 "},"devops/git/gerrit.html":{"url":"devops/git/gerrit.html","title":"gerrit","keywords":"","body":" Table of Contents generated with DocToc .gitconfig refs/meta/config useful refs restriction for branches (feature1, feature2 and master) for only allow code review merge, forbidden code push rules.pl reference .gitconfig $ git config --global gitreview.username $ git config --global gitreview.remote origin refs/meta/config get project.config clone the repo $ git clone # or update the local repo to HEAD $ git pull [--rebase] checkout meta/config $ git fetch origin refs/meta/config:refs/remotes/origin/meta/config $ git checkout meta/config or $ git fetch ssh://localhost:29418/project refs/meta/config $ git checkout FETCH_HEAD publish to remote $ git add --all . $ git commit -m \"\" submit directly $ git push origin meta/config:meta/config or $ git push origin HEAD:refs/meta/config submit review $ git push origin HEAD:refs/for/refs/meta/config or $ git push origin meta/config:refs/for/refs/meta/config update meta/config if remotes update $ git fetch origin --force refs/meta/config:refs/remotes/origin/meta/config $ git pull origin refs/meta/config # or $ git merge meta/config reset to remotes $ git fetch origin --force refs/meta/config:refs/remotes/origin/meta/config $ git reset --hard remotes/origin/meta/config useful refs sandbox: refs/heads/sandbox/${username}/* its-jira: for project specific [commentlink \"its-jira\"] match = ^[ \\\\t]*PROJECT-([0-9]{1,5}): link = https://:/browse/PROJECT-$1 for common setup [plugin \"its-jira\"] association = OPTIONAL branch = ^refs/heads/.* branch = ^refs/heads/stable-.* commentOnChangeAbandoned = false commentOnChangeCreated = true commentOnChangeMerged = true commentOnChangeRestored = false commentOnCommentAdded = false commentOnFirstLinkedPatchSetCreated = true commentOnPatchSetCreated = false commentOnRefUpdatedGitWeb = true enabled = enforced [commentlink \"its-jira\"] match = ^[ \\\\t]*([A-Za-z]*-[0-9]{1,5}): link = https://:/browse/$1 [commentlink \"changeid\"] match = (I[0-9a-f]{8,40}) link = \"#/q/$1\" verified label [label \"Verified\"] function = MaxWithBlock defaultValue = 0 copyAllScoresIfNoCodeChange = true value = -1 Fails value = 0 No score value = +1 Verified change-id [receive] requireChangeId = true createNewChangeForAllNotInTarget = false maxObjectSizeLimit = 6m maxBatchChanges = 1 [commentlink \"changeid\"] match = (I[0-9a-f]{8,40}) link = \"#/q/$1\" freeze master branch project.config [access \"refs/for/refs/heads/master\"] push = block group user/Marslo Jiao (marslo) push = block group Registered Users submit = block group Registered Users submit = block group group user/Marslo Jiao (marslo) addPatchSet = block group user/Marslo Jiao (marslo) addPatchSet = block group Registered Users pushMerge = block group user/Marslo Jiao (marslo) pushMerge = block group Registered Users groups ... global:Project-Owners Project Owners global:Registered-Users Registered Users ... user:marslo user/Marslo Jiao(marslo) ... freeze multiple branches (stable & release) for the specific account project.config [access \"^refs/for/refs/heads/(stable|release)$\"] push = block group Registered Users submit = block group Registered Users addPatchSet = block group Registered Users pushMerge = block group Registered Users [access \"^refs/heads/(stable|release)$\"] read = group user/Marslo Jiao (marslo) push = +force group user/Marslo Jiao (marslo) pushMerge = group user/Marslo Jiao (marslo) groups ... global:Project-Owners Project Owners global:Registered-Users Registered Users ... user:marslo user/Marslo Jiao(marslo) ... restriction for branches (feature1, feature2 and master) for only allow code review merge, forbidden code push project.config [access \"refs/*\"] read = group Project Owners read = group user/Marslo Jiao (marslo) [access \"refs/for/*\"] addPatchSet = group Project Owners addPatchSet = group user/Marslo Jiao (marslo) push = group Project Owners push = group user/Marslo Jiao (marslo) pushMerge = group Project Owners pushMerge = group user/Marslo Jiao (marslo) [access \"^refs/heads/(feature1|feature2|master)$\"] push = block group Registered Users pushMerge = block group Registered Users submit = group Change Owner groups ... global:Project-Owners Project Owners global:Registered-Users Registered Users ... user:marslo user/Marslo Jiao(marslo) ... example of project.config project.config [project] description = Gerrit Code Review [access \"refs/*\"] owner = group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/heads/*\"] label-Code-Review = -2..+2 group google/gerritcodereview-maintainers@googlegroups.com label-Code-Review = -2..+2 group polygerrit-maintainers label-Verified = -1..+1 group Change Owner label-Verified = -1..+1 group gerrit-verifiers label-Code-Style = -1..+1 group gerrit-verifiers label-Verified-Notedb = -1..+1 group gerrit-verifiers label-Library-Compliance = -1..+1 group gerrit-lib label-Library-Compliance = -1..+0 group google/gerritcodereview-maintainers@googlegroups.com submit = group Change Owner submit = group google/gerritcodereview-maintainers@googlegroups.com create = group google/gerritcodereview-maintainers@googlegroups.com abandon = group gerrit-verifiers editTopicName = +force group google/gerritcodereview-maintainers@googlegroups.com removeReviewer = group google/gerritcodereview-maintainers@googlegroups.com publishDrafts = group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/tags/*\"] create = group gerrit-release-creators create = group google/gerritcodereview-maintainers@googlegroups.com createTag = group gerrit-release-creators createTag = group google/gerritcodereview-maintainers@googlegroups.com createSignedTag = group gerrit-release-creators createSignedTag = group google/gerritcodereview-maintainers@googlegroups.com [access] inheritFrom = Public-Projects [receive] rejectImplicitMerges = true [reviewer] enableByEmail = true [label \"Verified\"] function = MaxNoBlock copyAllScoresIfNoCodeChange = true value = -1 Fails value = 0 No score value = +1 Verified defaultValue = 0 [label \"Code-Style\"] function = MaxWithBlock copyAllScoresIfNoCodeChange = true value = -1 Wrong Style or Formatting value = 0 No score value = +1 Style Verified defaultValue = 0 [label \"Library-Compliance\"] function = MaxWithBlock copyAllScoresIfNoCodeChange = true copyAllScoresOnTrivialRebase = true value = -1 Do not submit value = 0 No score value = +1 Approved defaultValue = 0 [access \"refs/for/refs/meta/dashboards/*\"] push = group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/meta/dashboards/*\"] label-Code-Review = -2..+2 group google/gerritcodereview-maintainers@googlegroups.com label-Code-Review = -1..+1 group Registered Users label-Verified = -1..+1 group gerrit-verifiers label-Verified = -1..+1 group google/gerritcodereview-maintainers@googlegroups.com submit = group google/gerritcodereview-maintainers@googlegroups.com forgeAuthor = group google/gerritcodereview-maintainers@googlegroups.com label-Code-Style = -1..+1 group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/for/refs/meta/config\"] push = group gerrit-verifiers [notify \"polygerrit-reviews\"] email = polygerrit-reviews@google.com type = all_comments type = submitted_changes header = cc filter = file:polygerrit-ui [access \"refs/heads/infra/config\"] push = group gerrit-tricium-admins rules.pl submit by a non author submit_rule(S) :- gerrit:default_submit(X), X =.. [submit | Ls], add_non_author_approval(Ls, R), S =.. [submit | R]. add_non_author_approval(S1, S2) :- gerrit:commit_author(A), gerrit:commit_label(label('Code-Review', 2), R), R \\= A, !, S2 = [label('Non-Author-Code-Review', ok(R)) | S1]. add_non_author_approval(S1, [label('Non-Author-Code-Review', need(_)) | S1]). ticket check check also: Prolog Gerrit - validate label if commit message contains a specific string optional validation submit_rule(S) :- gerrit:default_submit(X), X =.. [submit | Ls], require_ticket_check_for_ticket(Ls, Nls), S =.. [submit | Nls]. require_ticket_check_for_ticket(S1, S2) :- gerrit:commit_message_matches('^issue-[\\\\d]+\\\\s?:\\\\s?[\\\\w\\\\W]+'), !, S2 = [label('Ticket-Checked', need(_)) | S1]. require_ticket_check_for_ticket(S1, S2) :- !, S2 = S1. optional validation with auto vote submit_rule(S) :- gerrit:default_submit(X), X =.. [submit | Ls], require_ticket_check_for_ticket(Ls, Nls), S =.. [submit | Nls]. require_ticket_check_for_ticket(S1, S2) :- gerrit:commit_message_matches('\\\\[issue-[\\\\d]{2}\\\\]\\\\s?:\\\\s?[\\\\w\\\\W]+'), !, S2 = [label('Ticket-Checked', ok(user(824))) | S1]. require_ticket_check_for_ticket(S1, S2) :- !, S2 = S1. mandatory validation submit_rule(S) :- gerrit:default_submit(X), % get the current submit structure X=.. [submit | Ls], require_ticket_check_for_ticket(Ls, Nls), S=.. [submit | Nls]. require_ticket_check_for_ticket(S1, S2) :- gerrit:commit_message_matches('\\\\[issue-[\\\\d]{2}\\\\][\\\\s\\\\S]+'), !, S2 = [label('Ticket-Checked', ok(user(790))) | S1]. % Add the label and automatically approval by user-id: 790 require_ticket_check_for_ticket(S1, [label('Ticket-Checked', need(_)) | S1]). reference project owner guide Gerrit Code Review - Uploading Changes gerrit/gerrit/refs/meta/config gerrit 权限控制 its-jira plugin md Rule base configuration Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:01 "},"devops/git/q&a.html":{"url":"devops/git/q&a.html","title":"q&a","keywords":"","body":" Table of Contents generated with DocToc For Ubuntu no refs in common and none specified; doing nothing. For CentOS /bin/sh: cc openssl/ssl.h expat.h asciidoc docbook2x-texi xmlto gnu/stubs-64.h For Ubuntu no refs in common and none specified; doing nothing. Error $ git push No refs in common and none specified; doing nothing. Perhaps you should specify a branch such as 'master'. Everything up-to-date Solution: git push -u origin master $ git push -u origin master Counting objects: 40, done. Delta compression using up to 4 threads. Compressing objects: 100% (40/40), done. Writing objects: 100% (40/40), 133.46 KiB | 0 bytes/s, done. Total 40 (delta 6), reused 0 (delta 0) To git@github.com:Marslo/LaunchySkins.git \\* [new branch] master -> master \\* Branch master set up to track remote branch master from origin. For CentOS /bin/sh: cc Error: $ make prefix=/usr/local/myprograms/git GIT_VERSION = 2.1.0 * new build flags CC credential-store.o /bin/sh: cc: command not found make: *** [credential-store.o] Error 127 Solution: $ yum install gcc gcc-g++ g++ make openssl/ssl.h Error: $ make prefix=/usr/local/myprograms/git CC credential-store.o In file included from cache.h:4, from credential-store.c:1: git-compat-util.h:213:25: warning: openssl/ssl.h: No such file or directory git-compat-util.h:214:25: warning: openssl/err.h: No such file or directory git-compat-util.h:326:25: warning: openssl/evp.h: No such file or directory git-compat-util.h:327:26: warning: openssl/hmac.h: No such file or directory git-compat-util.h:329:28: warning: openssl/x509v3.h: No such file or directory In file included from credential-store.c:1: cache.h:12:21: warning: openssl/sha.h: No such file or directory cache.h:20:18: warning: zlib.h: No such file or directory In file included from credential-store.c:1: cache.h:22: error: expected specifier-qualifier-list before ‘z_stream’ make: *** [credential-store.o] Error 1 Solution: $ yum install openssl openssl-devel zlib-devel libcurl libcurl-devel expat.h Error: $ make prefix=/usr/local/myprograms/git http-push.c:17:19: warning: expat.h: No such file or directory http-push.c:832: warning: type defaults to ‘int’ in declaration of ‘XML_Char’ http-push.c:832: error: expected ‘;’, ‘,’ or ‘)’ before ‘*’ token Solution $ sudo yum install expat-devel asciidoc Error: /bin/sh: line 1: asciidoc: command not found make[1]: *** [git-add.html] Error 127 make[1]: Leaving directory `/root/Software/git-master/Documentation' make: *** [doc] Error 2 Solution: $ sudo yum install docbook-style-xsl $ sudo rpm -ivh http://pkgs.repoforge.org/asciidoc/asciidoc-8.6.9-1.el6.rfx.noarch.rpm # Or $ wget http://downloads.sourceforge.net/project/asciidoc/asciidoc/8.6.9/asciidoc-8.6.9.tar.gz $ tar xf asciidoc-8.6.9.tar.gz $ autoconf $ ./configure $ make $ sudo make install docbook2x-texi Error: DB2TEXI user-manual.texi /bin/sh: 2: docbook2x-texi: not found make[1]: *** [user-manual.texi] Error 127 make[1]: Leaving directory `/home/marslo/Tools/Software/Programming/Git/git-master/Documentation' make: *** [info] Error 2 Solution: $ sudo yum -y --enablerepo=*epel* install docbook2X $ sudo ln -s /usr/bin/db2x_docbook2texi /usr/bin/docbook2x-texi xmlto Error: /bin/sh: line 1: xmlto: command not found make[1]: *** [git-add.1] Error 127 make[1]: Leaving directory `/root/Software/git-master/Documentation' make: *** [doc] Error 2 Solution: $ sudo yum install xmlto gnu/stubs-64.h Error: In file included from /usr/include/features.h:399:0, from /usr/include/unistd.h:25, from git-compat-util.h:158, from cache.h:4, from credential-store.c:1: /usr/include/gnu/stubs.h:10:27: fatal error: gnu/stubs-64.h: No such file or directory # include ^ compilation terminated. make: *** [credential-store.o] Error 1 Solution: $ sudo yum install glibc-devel Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:01 "},"devops/git/tricky.html":{"url":"devops/git/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc get current branch get previous branch get current branch $ git br sandbox/marslo * master sed $ git branch | sed -ne 's:^\\*\\s*\\(.*\\)$:\\1:p' master symbolic-ref $ git symbolic-ref --short HEAD master $ git symbolic-ref HEAD refs/heads/master describe $ git describe --contains --all HEAD master get previous branch get previous branch name $ git rev-parse --symbolic-full-name @{-1} refs/heads/sandbox/marslo/291 or $ git describe --all $(git rev-parse @{-1}) heads/sandbox/marslo/291 checkout to previous branch $ git checkout - or$ git checkout @{-1} quick diff with previous branch $ git diff ..@{-1} Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:01 "},"devops/android.html":{"url":"devops/android.html","title":"android","keywords":"","body":" Table of Contents generated with DocToc sdkmanager list download sdk while building debug install android package management list remote sdk list local sdk update sdk manual download sdkmanager list list available package $ sdkmanager --no_https --proxy=socks --proxy_port=1880 --proxy_host=localhost --list Installed packages:=====================] 100% Computing updates... Path | Version | Description | Location ------- | ------- | ------- | ------- tools | 26.1.1 | Android SDK Tools 26.1.1 | tools/ Available Packages: Path | Version | Description ------- | ------- | ------- add-ons;addon-google_apis-google-15 | 3 | Google APIs add-ons;addon-google_apis-google-16 | 4 | Google APIs add-ons;addon-google_apis-google-17 | 4 | Google APIs add-ons;addon-google_apis-google-18 | 4 | Google APIs add-ons;addon-google_apis-google-19 | 20 | Google APIs add-ons;addon-google_apis-google-21 | 1 | Google APIs add-ons;addon-google_apis-google-22 | 1 | Google APIs add-ons;addon-google_apis-google-23 | 1 | Google APIs add-ons;addon-google_apis-google-24 | 1 | Google APIs add-ons;addon-google_gdk-google-19 | 11 | Glass Development Kit Preview build-tools;19.1.0 | 19.1.0 | Android SDK Build-Tools 19.1 build-tools;20.0.0 | 20.0.0 | Android SDK Build-Tools 20 build-tools;21.1.2 | 21.1.2 | Android SDK Build-Tools 21.1.2 ... list $ find /opt/android-sdk/ -name package.xml -exec sh -c 'eval $(xmllint --xpath \"//*[local-name()='\\'localPackage\\'']/@path\" $0) && echo $path' {} \\; platforms;android-26 platforms;android-17 platforms;android-22 platforms;android-23 platforms;android-24 platforms;android-18 platforms;android-21 platforms;android-19 platforms;android-25 platforms;android-16 docs build-tools;24.0.1 build-tools;22.0.1 build-tools;25.0.2 build-tools;25.0.3 build-tools;23.0.1 ... $ sdkmanager --list --verbose Info: Parsing legacy package: /opt/android-sdk/android-ndk Info: Parsing /opt/android-sdk/build-tools/19.1.0/package.xml Info: Parsing /opt/android-sdk/build-tools/20.0.0/package.xml Info: Parsing /opt/android-sdk/build-tools/21.1.2/package.xml Info: Parsing /opt/android-sdk/build-tools/22.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.1/package.xml ... list target $ android list target Available Android targets: ---------- id: 1 or \"android-15\" Name: Android 4.0.3 Type: Platform API level: 15 Revision: 5 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800 Tag/ABIs : no ABIs. ---------- id: 2 or \"android-16\" Name: Android 4.1.2 Type: Platform API level: 16 Revision: 5 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800, WXGA800-7in Tag/ABIs : no ABIs. ---------- ... download sdk while building GRADLE_OPTS='-Dorg.gradle.daemon=false -Dandroid.builder.sdkDownload=true -Dorg.gradle.jvmargs=-Xmx2048M -Dhttp.proxyHost=sample.localnet -Dhttp.proxyPort=80 -Dhttps.proxyHost=sample.localnet -Dhttps.proxyPort=80' HTTPS_PROXY=http://sample.localnet:80 HTTP_PROXY=http://sample.localnet:80 _JAVA_OPTIONS='-Dhttp.proxyHost=sample.localnet -Dhttp.proxyPort=80 -Dhttps.proxyHost=sample.localnet -Dhttps.proxyPort=80' http_proxy=http://sample.localnet:80 https_proxy=http://sample.localnet:80 debug $ strace -e trace=network -y -s 256 -f -o strace.log tools/bin/sdkmanager --update install $ sdkmanager \"platform-tools\" \"platforms;android-26\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 --verbose Info: Parsing legacy package: /opt/android-sdk/android-ndk Info: Parsing /opt/android-sdk/build-tools/19.1.0/package.xml Info: Parsing /opt/android-sdk/build-tools/20.0.0/package.xml Info: Parsing /opt/android-sdk/build-tools/21.1.2/package.xml Info: Parsing /opt/android-sdk/build-tools/22.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.2/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.3/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.0/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.2/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.3/pac kage.xml ... plugin installation $ sdkmanager \"extras;m2repository;com;android;support;constraint;constraint-layout;1.0.2\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 /opt/android-sdk/extras/m2repository/com/android/support/constraint/constraint-layout/1.0.2/constraint-layout-1.0.2.aar $ sdkmanager \"extras;android;m2repository;com;android;support;multidex;1.0.2\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 /opt/android-sdk/extras/android/m2repository/com/android/support/multidex/1.0.1/multidex-1.0.1.aar \"extras;android;m2repository;com;android;support;multidex;1.0.2\" $ sdkmanager \"add-ons;addon-google_apis-google-21\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 Done /opt/android-sdk/add-ons/addon-google_apis-google-21 android package management list remote sdk $ android list sdk --no-https --proxy-host 192.168.1.100 --proxy-port 8000 Refresh Sources: Fetching http://dl.google.com/android/repository/addons_list-2.xml Validate XML Parse XML Fetched Add-ons List successfully Refresh Sources Fetching URL: http://dl.google.com/android/repository/repository-11.xml Validate XML: http://dl.google.com/android/repository/repository-11.xml Parse XML: http://dl.google.com/android/repository/repository-11.xml Fetching URL: http://dl.google.com/android/repository/addon.xml Validate XML: http://dl.google.com/android/repository/addon.xml ... list local sdk $ android list Available Android targets: ---------- id: 1 or \"android-16\" Name: Android 4.1.2 Type: Platform API level: 16 Revision: 5 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800, WXGA800-7in Tag/ABIs : no ABIs. ---------- id: 2 or \"android-17\" Name: Android 4.2.2 Type: Platform API level: 17 Revision: 3 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800, WXGA800-7in Tag/ABIs : no ABIs. ---------- ... update sdk $ android update sdk --no-ui --no-https --proxy-host 192.168.1.100 --proxy-port 8000 Refresh Sources: Fetching http://dl.google.com/android/repository/addons_list-2.xml Validate XML Parse XML Fetched Add-ons List successfully Refresh Sources Fetching URL: http://dl.google.com/android/repository/repository-11.xml Validate XML: http://dl.google.com/android/repository/repository-11.xml Parse XML: http://dl.google.com/android/repository/repository-11.xml Fetching URL: http://dl.google.com/android/repository/addon.xml Validate XML: http://dl.google.com/android/repository/addon.xml Parse XML: http://dl.google.com/android/repository/addon.xml Fetching URL: http://dl.google.com/android/repository/glass/addon.xml Validate XML: http://dl.google.com/android/repository/glass/addon.xml Parse XML: http://dl.google.com/android/repository/glass/addon.xml Fetching URL: http://dl.google.com/android/repository/extras/intel/addon.xml Validate XML: http://dl.google.com/android/repository/extras/intel/addon.xml ... manual download https://dl.google.com/android/repository/ https://dl.google.com/android/repository/tools_r25.2.5-linux.zip Tools: Android SDK Platform-tools https://dl.google.com/android/repository/platform-tools_r25.0.3-linux.zip https://dl.google.com/android/repository/platform-tools_r25.0.3-linux.zip Android SDK Build-tools: - https://dl.google.com/android/repository/build-tools_r25.0.2-linux.zip - https://dl.google.com/android/repository/build-tools_r25.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r25-linux.zip - https://dl.google.com/android/repository/build-tools_r24.0.3-linux.zip - https://dl.google.com/android/repository/build-tools_r24.0.2-linux.zip - https://dl.google.com/android/repository/build-tools_r24.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r24-linux.zip - https://dl.google.com/android/repository/build-tools_r23.0.3-linux.zip - https://dl.google.com/android/repository/build-tools_r23.0.2-linux.zip - https://dl.google.com/android/repository/build-tools_r23.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r22.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r21.1.2-linux.zip - https://dl.google.com/android/repository/build-tools_r20-linux.zip - https://dl.google.com/android/repository/build-tools_r19.1-linux.zip Android 7.1.1 (API 25) - SDK Platform: https://dl.google.com/android/repository/platform-25_r03.zip platforms/android-25 Android 7.0 (API 24) - SDK Platform: https://dl.google.com/android/repository/platform-24_r02.zip platforms/android-24 - Document: https://dl.google.com/android/repository/docs-24_r01.zip docs/ - Google APIs https://dl.google.com/android/repository/google_apis-24_r1.zip add-ons/addon-google_apis-google-24 Android 6.0 (API 23) - SDK Platform https://dl.google.com/android/repository/platform-23_r03.zip platforms/android-23 - Document: https://dl.google.com/android/repository/docs-23_r01.zip docs/ - Google APIs https://dl.google.com/android/repository/google_apis-23_r01.zip add-ons/addon-google_apis-google-23 Android 5.1.1 (API 22) - SDK Platform https://dl.google.com/android/repository/android-22_r02.zip platforms/android-23 - Google APIs https://dl.google.com/android/repository/google_apis-22_r01.zip add-ons/addon-google_apis-google-22 Extra: - Android Support Repository https://dl.google.com/android/repository/android_m2repository_r44.zip extras/android/m2repository - Android Auto Desktop Head Unit emulator https://dl.google.com/android/repository/desktop-head-unit-linux_r01.1.zip extras/google/auto - Google Play Services https://dl.google.com/android/repository/google_play_services_v9_rc41.zip extras/google/google_play_services - Google Repository https://dl.google.com/android/repository/google_m2repository_gms_v9_rc41_wear_2_0_rc6.zip extras/google/m2repository - Google Play APK Expansion library https://dl.google.com/android/repository/market_apk_expansion-r03.zip extras/google/market_apk_expansion - Google Play Licensing Library https://dl.google.com/android/repository/market_licensing-r02.zip extras/google/market_licensing - Google Play Billing Library https://dl.google.com/android/repository/play_billing_r05.zip extras/google/play_billing - Android Auto API Simulators https://dl.google.com/android/repository/simulator_r01.zip extras/google/simulators - Google USD Driver https://dl.google.com/android/repository/usb_driver_r11-windows.zip extras/google/usb_driver - Google Web Driver https://dl.google.com/android/repository/webdriver_r02.zip extras/google/webdriver - Intel x86 Emulator Accelerator (HAXM Installer) http://mirrors.neusoft.edu.cn/android/repository/extras/intel/ Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:00 "},"devops/commonTools.html":{"url":"devops/commonTools.html","title":"commonTools","keywords":"","body":" Table of Contents generated with DocToc APT APT Configuration Necessory Pckages and Dependencies Package Auto-Upgrade Dislable Disable Server Auto Upgrade Revert Hold Settings Show all Hold Complete Remove an App System Timezone Setup MOTD Upgrade Disable Set Service Auto-Startup Application JDK and JAVA_HOME Groovy MySQL Built from Source Code Install from APT Repo Install old version Reconfiguration MySQL-Connector (JDBC) APT APT Configuration $ cat /etc/apt/apt.conf Acquire::http::Proxy \"http://161.91.27.236:8080\"; Acquire::https::Proxy \"http://161.91.27.236:8080\"; Acquire::ftp::Proxy \"http://161.91.27.236:8080\"; $ cat /etc/apt/apt.conf.d/99ignoresave Dir::Ignore-Files-Silently:: \"(.save|.distupgrade)$\"; Dir::Ignore-Files-Silently:: \"\\.gz$\"; Dir::Ignore-Files-Silently:: \"\\.save$\"; Dir::Ignore-Files-Silently:: \"\\.distUpgrade$\"; Dir::Ignore-Files-Silently:: \"\\.list_$\"; Necessory Pckages and Dependencies $ sudo apt --list upgradable $ sudo apt upgrade $ sudo apt install sysv-rc-conf tree dos2unix iptables-persistent mailutils policycoreutils build-essential landscape-common gcc g++ make cmake Package Auto-Upgrade Dislable $ sudo sed -i 's/Prompt=.*/Prompt=never/' /etc/update-manager/release-upgrades $ sudo sed -i 's/\"1\"/\"0\"/' /etc/apt/apt.conf.d/10periodic $ sudo sed -i 's/\"1\"/\"0\"/' /etc/apt/apt.conf.d/20auto-upgrades Disable Server Auto Upgrade # dpkg --list | grep jenkins ii jenkins 2.19.4 all Jenkins monitors executions of repeated jobs, such as building a software # echo \"jenkins hold\" | dpkg --set-selections OR # apt-mark hold jenkins # dpkg --list | grep jenkins hi jenkins 2.19.4 all Jenkins monitors executions of repeated jobs, such as building a software Revert Hold Settings # echo \"jenkins install\" | dpkg --set-selections OR # apt-mark unhold jenkins Show all Hold # apt-mark showhold Complete Remove an App # systemctl stop mysql # apt-get --purge autoremove mysql* # apt-get autoclean # apt --purge autoremove mysql* # apt autoclean # apt list --installed | grep mysql # rm -rf /var/lib/mysql/debian-*.flag # rm -rf /var/lib/mysql # rm -rf /etc/mysql System Timezone Setup # sudo dpkg-reconfigure tzdata MOTD Upgrade Disable # sudo mv /etc/update-motd.d/90-updates-available /etc/update-motd.d/org.90-updates-available.org Set Service Auto-Startup # sysv-rc-config jenkins on # sysv-rc-conf --list | grep jenkins jenkins 0:off 1:off 2:on 3:on 4:on 5:on 6:off # update-rc.d jenkins enable update-rc.d: warning: start runlevel arguments (none) do not match jenkins Default-Start values (2 3 4 5) update-rc.d: warning: stop runlevel arguments (none) do not match jenkins Default-Stop values (0 1 6) Enabling system startup links for /etc/init.d/jenkins ... Removing any system startup links for /etc/init.d/jenkins ... /etc/rc0.d/K20jenkins /etc/rc1.d/K20jenkins /etc/rc2.d/S20jenkins /etc/rc3.d/S20jenkins /etc/rc4.d/S20jenkins /etc/rc5.d/S20jenkins /etc/rc6.d/K20jenkins Adding system startup for /etc/init.d/jenkins ... /etc/rc0.d/K20jenkins -> ../init.d/jenkins /etc/rc1.d/K20jenkins -> ../init.d/jenkins /etc/rc6.d/K20jenkins -> ../init.d/jenkins /etc/rc2.d/S20jenkins -> ../init.d/jenkins /etc/rc3.d/S20jenkins -> ../init.d/jenkins /etc/rc4.d/S20jenkins -> ../init.d/jenkins /etc/rc5.d/S20jenkins -> ../init.d/jenkins Application JDK and JAVA_HOME Download JDK 1.8.0_121 # mkdir -p /opt/java && cd /opt/java # wget --no-check-certificate -c --header \"Cookie: oraclelicense=accept-securebackup-cookie\" http://download.oracle.com/otn-pub/java/jdk/8u121-b13/e9e7ea248e2c4826b92b3f075a80e441/jdk-8u121-linux-x64.tar.gz OR # curl -L -C - -b \"oraclelicense=accept-securebackup-cookie\" -O http://download.oracle.com/otn-pub/java/jdk/8u121-b13/e9e7ea248e2c4826b92b3f075a80e441/jdk-8u121-linux-x64.tar.gz # tar xf jdk-8u121-linux-x64.tar.gz Setup JAVA environment $ sudo bash -c 'cat >> /etc/bash.bashrc' Setup default JDK # update-alternatives --install /usr/bin/java java /opt/java/jdk1.8.0_121/bin/java 999 # update-alternatives --auto java # update-alternatives --install /usr/bin/javac javac /opt/java/jdk1.8.0_121/bin/javac 999 # update-alternatives --auto javac Groovy Download Groovy Binary Pakcage # mkdir -p /opt/groovy && cd /opt/groovy # wget --no-check-certificate -c https://akamai.bintray.com/1c/1c4dff3b6edf9a8ced3bca658ee1857cee90cfed1ee3474a2790045033c317a9?__gda__=exp=1490346679~hmac=6d64a1c3596da50e470fb6a46b182ba2cacab553c66843c8ea292e1e70e4e243&response-content-disposition=attachment%3Bfilename%3D%22apache-groovy-binary-2.4.10.zip%22&response-content-type=application%2Foctet-stream&requestInfo=U2FsdGVkX19cWhR3RJcR6SCy74HUcDg470ifD-nH2EiE5uxtdI5EbUiW_jGoHgZZTVR3qgks9tiU5441axygT9z3ykqpL45d_-9oyTlOp8Gild5Z7iGRzCiwf0kba9uza8iWDxnIxgnUIg5tDe6N8ZQ3R0yFCY4c4w7czwBGyK0 # unzip apache-groovy-binary-2.4.10.zip Setup Groovy Environment $ sudo bash -c 'cat >> /etc/bash.bashrc' Set Default Groovy # update-alternatives --install /usr/bin/groovy groovy /opt/groovy/groovy-2.4.10/bin/groovy 999999999 # update-alternatives --auto groovy MySQL Built from Source Code Build $ sudo groupadd mysql $ sudo useradd -g mysql mysql $ wget http://cdn.mysql.com/archives/mysql-5.5/mysql-5.5.41.tar.gz $ apt install ncurses-dev $ cd myaql-5.5.41 $ cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\ -DDEFAULT_CHARSET=utf8 \\ -DDEFAULT_COLLATION=utf8_general_ci \\ -DENABLED_LOCAL_INFILE=ON \\ -DWITH_INNOBASE_STORAGE_ENGINE=1 \\ -DWITH_FEDERATED_STORAGE_ENGINE=1 \\ -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\ -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \\ -DWITH_DEBUG=0 \\ -DMYSQL_TCP_PORT=3306 $ make $ sudo make install $ sudo systemctl enable mysqld or $ sysv-rc-conf mysqld on Configure $ sudo chown -R mysql:mysql /usr/local/mysql $ /usr/local/mysql/scripts/mysql_install_db --user=mysql $ sudo cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld $ sudo chown -R root /usr/local/mysql/ $ sudo chown -R mysql /usr/local/mysql/data $ /usr/local/mysql/bin/mysqld_safe --user=mysql & $ /usr/local/mysql/bin/mysqladmin -u root password '' OR $ /usr/local/mysql/bin/mysql_secure_installtion Install from APT Repo $ sudo apt install mysql-server Install old version $ sudo add-apt-repository 'deb http://archive.ubuntu.com/ubuntu trusty universe' $ sudo apt update $ sudo apt install mysql-server-5.6 mysql-client-5.6 -y $ sudo mysql_secure_installation Reconfiguration $ sudo service mysql start $ sudo mysql_secure_installation MySQL-Connector (JDBC) Download mysql-connector-java-*.tar.gz at MySQL Official Website -> Platform Independent $ wget http://cdn.mysql.com//Downloads/Connector-J/mysql-connector-java-5.1.40.tar.gz Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:00 "},"devops/compilation.html":{"url":"devops/compilation.html","title":"compilation","keywords":"","body":" Table of Contents generated with DocToc ssl.h curl.h expat.h tclsh asciidoc docbook2x-texi hunspell ao ncurses ssl.h Problem: git-compat-util.h:213:25: fatal error: openssl/ssl.h: No such file or directory #include \\ Solution: Ubuntu/Debian: $ sudo apt-get install libssl-dev RHEL/CentOS $ sudo yum install openssl-devel curl.h Problem: http.h:6:23: fatal error: curl/curl.h: No such file or directory #include \\ Solution: For OpenSuse: $ sudo apt-get install libcurl4-openssl For Ubuntu/Debian: $ sudo apt-get install libcurl4-openssl-dev For RHEL/CentOS: $ sudo yum install libcurl libcurl-devel Reason: libcurl-dev should be installed, but Package libcurl-dev is a virtual package provided by: libcurl4-openssl-dev 7.35.0-1ubuntu2 libcurl4-nss-dev 7.35.0-1ubuntu2 libcurl4-gnutls-dev 7.35.0-1ubuntu2 You should explicitly select one to install. expat.h Problem: http-push.c:17:19: fatal error: expat.h: No such file or directory #include \\ Solution: For Ubuntu/Debain: ┌─ (marslo@MarsloJiao ~/Marslo/Tools/git) -> └─ $ apt-cache search expat | grep dev libexpat1-dev - XML parsing C library - development kit lib64expat1-dev - XML parsing C library - development kit (64bit) libexpat-ocaml-dev - OCaml expat bindings lua-expat-dev - libexpat development files for the Lua language tdom-dev - fast XML/DOM/XPath/XSLT extension for Tcl written in C (development files) ┌─ (marslo@MarsloJiao ~/Marslo/Tools/git) -> └─ $ sudo apt-get install libexpat1-dev - For RHEL/CentOS: ```bash ┌─ (marslo@MarsloJiao ~/Marslo/Tools/git) -> └─ $ sudo yum install expat-devel ``` tclsh Problem: tclsh failed; using unoptimized loading MSGFMT po/de.msg make[1]: *** [po/de.msg] Error 127 make: *** [all] Error 2 Solution: For Ubuntu/Debain: ┌─ (marslo@MJ ~/Tools/Software/Programming/Git/git-master) -> └─ $ sudo apt-get install gettext asciidoc Problem ASCIIDOC git-add.html /bin/sh: 2: asciidoc: not found make[1]: *** [git-add.html] Error 127 make[1]: Leaving directory `/home/marslo/Tools/Software/Programming/Git/git-master/Documentation' make: *** [doc] Error 2 Solution For Ubuntu/Debain: ┌─ (marslo@MJ ~/Tools/Software/Programming/Git/git-master) -> └─ $ apt-cache search asciidoc ┌─ (marslo@MJ ~/Tools/Software/Programming/Git/git-master) -> └─ $ sudo apt-get install asciidoc For RHEL/CentOS: ┌─ (marslo@MJ ~/Tools/Software/Programming/Git/git-master) -> └─ $ yum install docbook-style-xsl ┌─ (marslo@MJ ~/Tools/Software/Programming/Git/git-master) -> └─ $ rpm -ivh http://pkgs.repoforge.org/asciidoc/asciidoc-8.6.9-1.el6.rfx.noarch.rpm docbook2x-texi Problem db2texi user-manual.texi /bin/sh: 2: docbook2x-texi: not found make[1]: *** [user-manual.texi] error 127 make[1]: leaving directory `/home/marslo/tools/software/programming/git/git-master/documentation' make: *** [info] error 2 Solution For Ubuntu/Debain: ┌─ (marslo@MJ ~/Tools/Software/Programming/Git/git-master) -> └─ $ sudo apt-get install docbook2x For RHEL/CentOS (Inspired from Git for human beings google group): ```bash ┌─ (marslo@MJ ~/Tools/Software/Programming/Git/git-master) -> └─ $ sudo yum -y --enablerepo=*epel* install docbook2X ┌─ (marslo@MJ ~/Tools/Software/Programming/Git/git-master) -> └─ $ sudo ln -s /usr/bin/db2x_docbook2texi /usr/bin/docbook2x-texi ``` hunspell Problem ┌─ (marslo@MarsloJiao ~/Tools/Git/goldendict) -> └─ $ qmake-qt4 Project MESSAGE: Install Prefix is: /usr/local Project ERROR: Package hunspell not found Solution For Ubuntu/Debain: ┌─ (marslo@MarsloJiao ~/Tools/Git/goldendict) -> └─ $ sudo apt-get install hunspell ┌─ (marslo@MarsloJiao ~/Tools/Git/goldendict) -> └─ $ sudo apt-get install libhunspell-dev ao Problem ┌─ (marslo@MarsloJiao ~/Tools/Git/goldendict) -> └─ $ qmake-qt4 Project MESSAGE: Install Prefix is: /usr/local Project ERROR: Package ao not found Solution For Ubuntu/Debain: ┌─ (marslo@MarsloJiao ~/Tools/Git/goldendict) -> └─ $ apt-cache search ao | grep dev libao-dev - Cross Platform Audio Output Library Development ... ┌─ (marslo@MarsloJiao ~/Tools/Git/goldendict) -> └─ $ sudo apt-get install libao-dev ncurses Problem no terminal library found checking for tgetent()... configure: error: NOT FOUND! You need to install a terminal library; for example ncurses. Or specify the name of the library with --with-tlib. Solution For Ubuntu/Debain: For RHEL/CentOS: ┌─ (marslo@MarsloJiao ~/Marslo/Tools/vim) -> └─ $ yum install ncurses-devel Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:00 "},"devops/mobile.html":{"url":"devops/mobile.html","title":"mobile","keywords":"","body":" Table of Contents generated with DocToc ios get info idevice list apps install app idevicediagnostics andriod environment get info show list install & uninstall ios get info get info from *.plist $ /usr/libexec/PlistBuddy -c \"Print :CFBundleIdentifier\" package/Info.plist com.mycompany.myapp.demo $ /usr/libexec/PlistBuddy -c print package/Info.plist | grep CFBundleVersion CFBundleVersion = 185 get ipa file information $ gem install shenzhen $ ipa info myapp-0.3.0/myapp.ipa security: SecPolicySetValue: One or more parameters passed to a function were not valid. +-----------------------------+---------------------------------------------------------+ | AppIDName | mymobileapp | | ApplicationIdentifierPrefix | 9BXY7H1234 | | CreationDate | 2017-04-13T04:58:51+00:00 | | Platform | iOS | | Entitlements | keychain-access-groups: [\"9BXY7H1234.*\"] | | | get-task-allow: false | | | application-identifier: 9BXY7H1234.com.mycompany.my.app | | | com.apple.developer.healthkit: true | | | com.apple.developer.team-identifier: 9BXY7H1234 | | | aps-environment: production | | ExpirationDate | 2018-04-13T04:58:51+00:00 | | Name | myappPilotAppDistribution | | ProvisionsAllDevices | true | | TeamIdentifier | 9BXY7H1234 | | TeamName | mycompany (China) Investment Co., Ltd | | TimeToLive | 365 | | UUID | 4b73738f-d730-49e4-a8eb-0031275cdee4 | | Version | 1 | | Codesigned | False | +-----------------------------+---------------------------------------------------------+ check version mobileprovision $ unzip -l myapp-0.3.0/myapp.ipa | grep mobileprovision 7589 06-30-2017 17:29 Payload/myapp.app/embedded.mobileprovision get version $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D | egrep \\(.*) details $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D | grep version security: SecPolicySetValue: One or more parameters passed to a function were not valid. $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D | egrep \\1 $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D security: SecPolicySetValue: One or more parameters passed to a function were not valid. AppIDName myapp ApplicationIdentifierPrefix 9BXY7H1234 ... get uuid uuid=$(/usr/libexec/PlistBuddy -c 'Print :UUID' /dev/stdin idevice list real devices $ idevice_id -l 02be8bb96f479db9ff691f7e57c2344d170b363c 521d2bba6b5da32ad61aa7ea516fc45e31300a0f list simulator & devices $ instruments -s devices Known Devices: devops-slave08 [BEFBB759-F3EF-5053-94B4-EC21E6F032F7] devops-iphone (11.2.6) [521d2bba6b5da32ad61aa7ea516fc45e31300a0f] devops-ipad (11.2.6) [02be8bb96f479db9ff691f7e57c2344d170b363c] Apple TV 1080p (10.2) [F546057D-6F75-40C6-ADB2-958ED8ACAF45] (Simulator) iPad (5th generation) (10.3.1) [7D221270-6E99-4C25-B3F0-FD3ABF4ADE38] (Simulator) iPad Air (10.3.1) [C4AC315A-FD89-4D6B-B7B9-3CDA2088A36E] (Simulator) iPad Air 2 (10.3.1) [01F1D17D-5666-4B40-A8DC-F38FB7E3A266] (Simulator) ... list apps $ ideviceinstaller -u ${DEVICEID} --list-apps CFBundleIdentifier, CFBundleVersion, CFBundleDisplayName com.mycompany.my.app, \"1384\", \"myapp\" List the 3rd part apps $ ideviceinstaller -u ${DEVICEID} --list-apps -o list_user CFBundleIdentifier, CFBundleVersion, CFBundleDisplayName com.mycompany.my.app, \"1384\", \"myapp\" list default apps $ ideviceinstaller -u ${DEVICEID} --list-apps -o list_system CFBundleIdentifier, CFBundleVersion, CFBundleDisplayName com.apple.AXUIViewService, \"1\", \"AXUIViewService\" com.apple.AccountAuthenticationDialog, \"1.0\", \"AccountAuthenticationDialog\" com.apple.AdSheetPhone, \"1.0\", \"iAd\" com.apple.AppStore, \"1\", \"App Store\" com.apple.AskPermissionUI, \"1.0\", \"AskPermissionUI\" com.apple.CTCarrierSpaceAuth, \"1\", \"CTCarrierSpaceAuth\" ... install app $ /usr/local/bin/ideviceinstaller -u ${DEVICEID} --install $(find ${WORKSPACE}/package -name \"*.ipa\") WARNING: could not locate iTunesMetadata.plist in archive! WARNING: could not locate Payload/myapp.app/SC_Info/myapp.sinf in archive! Copying '/Users/devops/workspace/platform_mobile_deploy/package/myapp_ios_app-1.1.1389.ipa' to device... DONE. Installing 'com.mycompany.my.app' Install: CreatingStagingDirectory (5%) Install: ExtractingPackage (15%) Install: InspectingPackage (20%) Install: TakingInstallLock (20%) Install: PreflightingApplication (30%) Install: InstallingEmbeddedProfile (30%) Install: VerifyingApplication (40%) Install: CreatingContainer (50%) Install: InstallingApplication (60%) Install: PostflightingApplication (70%) Install: SandboxingApplication (80%) Install: GeneratingApplicationMap (90%) Install: Complete idevicediagnostics restart device $ idevicediagnostics restart -u ${DEVICEID} Restarting device. get provision $ idevicediagnostics diagnostics All -u ${DEVICEID} GasGauge CycleCount 3 DesignCapacity 1810 FullChargeCapacity 1900 Status Success idevicepair $ idevicepair pair -u 521d2bba6b5da32ad61aa7ea516fc45e31300a0f SUCCESS: Paired with device 521d2bba6b5da32ad61aa7ea516fc45e31300a0f $ idevicepair pair -u 02be8bb96f479db9ff691f7e57c2344d170b363c SUCCESS: Paired with device 02be8bb96f479db9ff691f7e57c2344d170b363c ideviceprovision $ ideviceprovision list -u ${DEVICEID} Device has 4 provisioning profiles installed: 4b73738f-d730-49e4-a8eb-0031275cdee4 - myappPilotAppDistribution b84ef185-a387-4a1d-8a41-3230708c6b31 - iOS Team Provisioning Profile: com.mycompany.cdtest.WebDriverAgentRunner 59ecee46-f43f-4a87-a89e-f9b03f14cf01 - XC iOS: com.mycompany.myapp.demo 83d90272-79fe-4f8f-8ea5-8f18f60b5683 - myappDemoDev andriod environment $ ln -sf /opt/android/platform-tools/adb /usr/local/bin/adb $ ln -sf /opt/android/build-tools/27.0.3/aapt /usr/local/bin/aapt $ ln -sf /opt/android/build-tools/27.0.3/aapt2 /usr/local/bin/aapt2 get info get bundle id from *.ipa $ aapt dump badging ${apkFile} | grep package | sed -r -e \"s:^.*name='([^']*).*$:\\\\1:\" $ aapt dump badging package/myapp-1.3.85.apk | grep package | sed -r -e \"s:^.*name='([^']*).*$:\\\\1:\" com.mycompany.myapp.demo $ aapt dump badging package/myapp-1.3.85.apk | grep package package: name='com.mycompany.myapp.demo' versionCode='1030085' versionName='1.3.85' platformBuildVersionName='8.0.0' $ aapt dump badging package/myapp-1.3.85.apk package: name='com.mycompany.myapp.demo' versionCode='1030085' versionName='1.3.85' platformBuildVersionName='8.0.0' sdkVersion:'19' targetSdkVersion:'26' uses-permission: name='android.permission.INTERNET' uses-permission: name='android.permission.ACCESS_NETWORK_STATE' uses-permission: name='android.permission.ACCESS_WIFI_STATE' uses-permission: name='android.permission.READ_PHONE_STATE' uses-permission: name='android.permission.WRITE_EXTERNAL_STORAGE' uses-permission: name='android.permission.READ_EXTERNAL_STORAGE' ... get imei $ adb shell service call iphonesubinfo 1 | awk -F \"'\" '{print $2}' | sed '1 d' | tr -d '.' | awk '{print}' ORS= 864226033999836 $ echo \"[device.imei]: [$(adb shell service call iphonesubinfo 1 | awk -F \"'\" '{print $2}' | sed '1 d'| tr -d '\\n' | tr -d '.' | tr -d ' ')]\" [device.imei]: [864226033999836] $ echo \"[device.imei]: [$(adb shell service call iphonesubinfo 1 | awk -F \"'\" '{print $2}' | sed '1 d'| tr -d '\\n' | tr -d '.' | tr -d ' ')]\"; adb shell getprop | grep \"model\\|version.sdk\\|manufacturer\\|ro.serialno\\|product.name\\|brand\\|version.release\\|build.id\\|security_patch\" | sed 's/ro\\.//g' [device.imei]: [864226033999836] [persist.sys.modelnumber]: [NX569H] [build.id]: [MMB29M] [build.version.release]: [6.0.1] [build.version.sdk]: [23] [build.version.security_patch]: [2017-02-01] [product.brand]: [nubia] [product.manufacturer]: [nubia] [product.model]: [NX569H] [product.name]: [NX569H] [serialno]: [fac7ea46] get andriod version $ adb shell getprop ro.build.version.release 6.0.1 show list list installed apps $ adb -s fac7ea46 shell 'pm list packages' | grep 'com.mycompany.myapp.demo' package:com.mycompany.myapp.demo list all apps $ adb -s ${DEVICEID} shell 'pm list packages -f' | sed -e 's/.*=//' | sed 's/\\r//g' | sort android cn.nubia.accounts cn.nubia.aftersale cn.nubia.applockmanager cn.nubia.apps cn.nubia.appsettingsinfoproviders cn.nubia.autoagingtest cn.nubia.bbs cn.nubia.bootanimationinfo ... list connected device $ adb devices List of devices attached fac7ea46 device $ adb devices -l List of devices attached fac7ea46 device usb:343089152X product:NX569H model:NX569H device:NX569H transport_id:2 install & uninstall install $ adb -s ${DEVICEID} install -r \"$(find . -name '*.apk')\" $ adb -s fac7ea46 install ${WORKSPACE}/package/myapp-1.3.84.apk [ 0%] /data/local/tmp/myapp-1.3.84.apk [ 1%] /data/local/tmp/myapp-1.3.84.apk [ 2%] /data/local/tmp/myapp-1.3.84.apk [ 3%] /data/local/tmp/myapp-1.3.84.apk [ 3%] /data/local/tmp/myapp-1.3.84.apk [ 4%] /data/local/tmp/myapp-1.3.84.apk [ 5%] /data/local/tmp/myapp-1.3.84.apk [ 6%] /data/local/tmp/myapp-1.3.84.apk [ 7%] /data/local/tmp/myapp-1.3.84.apk [ 7%] /data/local/tmp/myapp-1.3.84.apk ... uninstall $ adb -s ${DEVICEID} uninstall ${BUNDLEID} e.g.: $ adb -s fac7ea46 uninstall com.mycompany.myapp.demo Success $ if adb -s fac7ea46 shell 'pm list packages' | grep 'com.mycompany.myapp.demo'; then > adb -s fac7ea46 uninstall com.mycompany.myapp.demo > fi Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:01 "},"devops/network.html":{"url":"devops/network.html","title":"network","keywords":"","body":" Table of Contents generated with DocToc interface DNS Port Redirection Proxy Setup network speed wifi Reference interface Change Interface Name Permanent Solution $ sudo touch /etc/udev/rules.d/10-network.rules $ sudo bash -c \"cat > /etc/udev/rules.d/10-network.rules\" \", KERNEL==\"\", NAME=\"\" EOF E.g.: $ nmcli connection NAME UUID TYPE DEVICE WLAN-PUB 2cde1f25-8c28-4318-9781-b9fcdabd985d wifi wlp2s0 Wired connection 1 f72d569d-065b-3bc8-98ae-e07f8bf46945 ethernet enp0s31f6 cni0 dcfc10c6-5421-4405-9d56-b3bb595780f5 bridge cni0 docker0 29822e8f-772f-4e67-8052-55b9e6c9e298 bridge docker0 $ sudo bash -c \"cat > /etc/udev/rules.d/10-network.rules\" Temporary Solution $ sudo ifconfig down $ sudo ip link set name $ sudo ifconfig E.g.: $ nmcli dev DEVICE TYPE STATE CONNECTION wlp2s0 wifi connected WLAN-PUB cni0 bridge connected cni0 enp0s31f6 ethernet connected Wired connection 1 docker0 bridge connected docker0 flannel.1 vxlan disconnected -- veth1890b284 ethernet unmanaged -- veth5145289b ethernet unmanaged -- vetha9ee773c ethernet unmanaged -- vethf5a48bb2 ethernet unmanaged -- lo loopback unmanaged -- $ nmcli connection NAME UUID TYPE DEVICE WLAN-PUB 2cde1f25-8c28-4318-9781-b9fcdabd985d wifi wlp2s0 Wired connection 1 f72d569d-065b-3bc8-98ae-e07f8bf46945 ethernet enp0s31f6 cni0 dcfc10c6-5421-4405-9d56-b3bb595780f5 bridge cni0 docker0 29822e8f-772f-4e67-8052-55b9e6c9e298 bridge docker0 $ sudo ifconfig enp0s31f6 down; sudo ip link set enp0s31f6 name eth0; sudo ifconfig eth0 up $ nmcli dev DEVICE TYPE STATE CONNECTION wlp2s0 wifi connected WLAN-PUB cni0 bridge connected cni0 docker0 bridge connected docker0 eth0 ethernet connected Wired connection 1 flannel.1 vxlan disconnected -- veth1890b284 ethernet unmanaged -- veth5145289b ethernet unmanaged -- vetha9ee773c ethernet unmanaged -- vethf5a48bb2 ethernet unmanaged -- lo loopback unmanaged -- $ nmcli connection NAME UUID TYPE DEVICE WLAN-PUB 2cde1f25-8c28-4318-9781-b9fcdabd985d wifi wlp2s0 Wired connection 1 f72d569d-065b-3bc8-98ae-e07f8bf46945 ethernet eth0 cni0 e557e9bc-754e-4dc9-b9db-4519a7b15c33 bridge cni0 docker0 47c195b8-4867-40d3-acec-c28223e2b013 bridge docker0 Show ethtool $ sudo ethtool eth0 Settings for eth0: Supported ports: [ TP ] Supported link modes: 10baseT/Half 10baseT/Full 100baseT/Half 100baseT/Full 1000baseT/Full Supported pause frame use: No Supports auto-negotiation: Yes Supported FEC modes: Not reported Advertised link modes: 10baseT/Half 10baseT/Full 100baseT/Half 100baseT/Full 1000baseT/Full Advertised pause frame use: No Advertised auto-negotiation: Yes Advertised FEC modes: Not reported Speed: 100Mb/s Duplex: Full Port: Twisted Pair PHYAD: 1 Transceiver: internal Auto-negotiation: on MDI-X: on (auto) Supports Wake-on: pumbg Wake-on: g Current message level: 0x00000007 (7) drv probe link Link detected: yes List Hardware $ sudo lshw -class network *-network description: Wireless interface product: Wireless 8260 vendor: Intel Corporation physical id: 0 bus info: pci@0000:02:00.0 logical name: wlan0 version: 3a serial: 34:f3:9a:52:75:65 width: 64 bits clock: 33MHz capabilities: pm msi pciexpress bus_master cap_list ethernet physical wireless configuration: broadcast=yes driver=iwlwifi driverversion=4.15.0-23-generic firmware=34.0.1 ip=192.168.10.235 latency=0 link=yes multicast=yes wireless=IEEE 802.11 resources: irq:129 memory:e4100000-e4101fff *-network description: Ethernet interface product: Ethernet Connection (2) I219-LM vendor: Intel Corporation physical id: 1f.6 bus info: pci@0000:00:1f.6 logical name: eth0 version: 31 serial: 30:e1:71:95:19:bc size: 100Mbit/s capacity: 1Gbit/s width: 32 bits clock: 33MHz capabilities: pm msi bus_master cap_list ethernet physical tp 10bt 10bt-fd 100bt 100bt-fd 1000bt-fd autonegotiation configuration: autonegotiation=on broadcast=yes driver=e1000e driverversion=3.2.6-k duplex=full firmware=0.8-4 ip=130.147.182.57 latency=0 link=yes multicast=yes port=twisted pair speed=100Mbit/s resources: irq:127 memory:e4300000-e431ffff *-network:0 description: Ethernet interface physical id: 2 logical name: veth680e7b1b serial: 86:86:ae:b1:3f:c3 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s *-network:1 description: Ethernet interface physical id: 3 logical name: vethdd057c06 serial: ae:b1:42:e3:30:d0 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s *-network:2 description: Ethernet interface physical id: 4 logical name: vethfe693595 serial: 16:ec:cd:4e:c3:d8 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s *-network:3 description: Ethernet interface physical id: 5 logical name: flannel.1 serial: 2a:2b:77:a7:35:8f capabilities: ethernet physical configuration: broadcast=yes driver=vxlan driverversion=0.1 ip=10.244.0.0 link=yes multicast=yes *-network:4 description: Ethernet interface physical id: 6 logical name: cni0 serial: 0a:58:0a:f4:00:01 capabilities: ethernet physical configuration: broadcast=yes driver=bridge driverversion=2.3 firmware=N/A ip=10.244.0.1 link=yes multicast=yes *-network:5 description: Ethernet interface physical id: 7 logical name: docker0 serial: 02:42:99:41:e5:02 capabilities: ethernet physical configuration: broadcast=yes driver=bridge driverversion=2.3 firmware=N/A ip=172.17.0.1 link=no multicast=yes *-network:6 description: Ethernet interface physical id: 8 logical name: vethc1b38134 serial: 76:6a:6c:0f:e8:a1 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s Show Route $ nslookup my.gitlab.company.com Server: 130.147.236.5 Address: 130.147.236.5#53 Non-authoritative answer: Name: pww.gitlab.cdi.mycompany.com Address: 130.147.219.15 $ $ ip route get 130.147.219.15 130.147.219.15 dev eno1 src 130.147.182.240 uid 1000 cache ------ $ nslookup github.com Server: 130.147.236.5 Address: 130.147.236.5#53 Non-authoritative answer: Name: github.com Address: 192.30.253.112 Name: github.com Address: 192.30.253.113 $ ip route get 192.30.253.113 192.30.253.113 via 192.168.10.1 dev wlan0 src 192.168.11.166 uid 1000 cache OR $ ip route show default via 192.168.10.1 dev wlan0 proto dhcp metric 600 10.244.0.0/24 dev cni0 proto kernel scope link src 10.244.0.1 130.140.0.0/16 dev eth0 scope link 130.145.0.0/16 dev eth0 scope link 130.146.0.0/16 dev eth0 scope link 130.147.0.0/16 dev eth0 scope link 130.147.182.0/23 dev eth0 proto kernel scope link src 130.147.182.57 metric 100 137.55.0.0/16 dev eth0 scope link 161.83.0.0/16 dev eth0 scope link 161.84.0.0/16 dev eth0 scope link 161.85.0.0/16 dev eth0 scope link 161.88.0.0/16 dev eth0 scope link 161.91.0.0/16 dev eth0 scope link 161.92.0.0/16 dev eth0 scope link 169.254.0.0/16 dev eth0 scope link metric 1000 172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown 185.166.0.0/16 dev eth0 scope link 192.168.10.0/23 dev wlan0 proto kernel scope link src 192.168.10.235 metric 600 OR $ route -n Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface 0.0.0.0 192.168.10.1 0.0.0.0 UG 600 0 0 wlan0 10.244.0.0 0.0.0.0 255.255.255.0 U 0 0 0 cni0 130.140.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.145.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.146.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.147.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.147.182.0 0.0.0.0 255.255.254.0 U 100 0 0 eth0 137.55.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.83.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.84.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.85.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.88.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.91.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.92.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 169.254.0.0 0.0.0.0 255.255.0.0 U 1000 0 0 eth0 172.17.0.0 0.0.0.0 255.255.0.0 U 0 0 0 docker0 185.166.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 192.168.10.0 0.0.0.0 255.255.254.0 U 600 0 0 wlan0 DNS Permanently Add new DNS $ sudo apt install resolvconf $ sudo cp /etc/resolvconf/resolv.conf.d/head{,.org} $ sudo bash -c \"cat > /etc/resolvconf/resolv.conf.d/head\" Port Redirection $ sudo iptables -L -n Chain INPUT (policy ACCEPT) target prot opt source destination Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination $ sudo iptables -I INPUT 1 -p tcp --dport 8080 -j ACCEPT $ sudo iptables -I INPUT 1 -p tcp --dport 80 -j ACCEPT $ sudo iptables -A PREROUTING -t nat -i ens32 -p tcp --dport 80 -j REDIRECT --to-port 8080 $ sudo iptables -t nat -I OUTPUT -p tcp -d 127.0.0.1 --dport 80 -j REDIRECT --to-ports 8080 $ sudo iptables -t nat -I OUTPUT -p tcp -o lo --dport 80 -j REDIRECT --to-ports 8080 $ sudo iptables -L -n Chain INPUT (policy ACCEPT) target prot opt source destination ACCEPT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:80 ACCEPT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:8080 Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination $ sudo netfilter-persistent save run-parts: executing /usr/share/netfilter-persistent/plugins.d/15-ip4tables save run-parts: executing /usr/share/netfilter-persistent/plugins.d/25-ip6tables save $ sudo iptables-save > /etc/iptables/rules.v4 Proxy Setup Name: x.x.x.x Port: 80 Settings $ grep proxy /etc/profile export http_proxy=x.x.x.x:80 export https_proxy=x.x.x.x:80 export no_proxy=localhost,127.0.0.1,*.google.com network speed $ ifstat -n -i en7 en7 KB/s in KB/s out 7.35 1.15 4.91 1.02 6.05 0.80 8.36 1.78 wifi iwconfig installation $ sudo apt install wireless-tools get wireless card $ WIRELESSCARD=\"$(iwconfig 2>/dev/null | /bin/grep ESSID | awk -F' ' '{print $1}')\" $ iwconfig 2>/dev/null | \\grep ESSID wlx24050f15c19b IEEE 802.11 ESSID:\"MERCURY_07FA\" wireless network details $ sudo iwlist scan docker0 Interface doesn't support scanning. eno1 Interface doesn't support scanning. lo Interface doesn't support scanning. cni0 Interface doesn't support scanning. flannel.1 Interface doesnt support scanning. wlx24050f15c19b Scan completed : Cell 01 - Address: 50:3A:A0:CB:07:FA Channel:1 Frequency:2.412 GHz (Channel 1) Quality=55/70 Signal level=-55 dBm Encryption key:on ESSID:\"MERCURY_07FA\" Bit Rates:1 Mb/s; 2 Mb/s; 5.5 Mb/s; 11 Mb/s; 9 Mb/s 18 Mb/s; 36 Mb/s; 54 Mb/s Bit Rates:6 Mb/s; 12 Mb/s; 24 Mb/s; 48 Mb/s Mode:Master ... # or $ nmcli --show-secrets connection show 'MERCURY_07FA' connection.id: MERCURY_07FA connection.uuid: 8e362f4a-d3a3-4147-b31e-4519954b55ef connection.stable-id: -- connection.type: 802-11-wireless connection.interface-name: -- connection.autoconnect: yes connection.autoconnect-priority: 0 connection.autoconnect-retries: -1 (default) connection.auth-retries: -1 connection.timestamp: 1530689982 connection.read-only: no ... nmcli show available wifi $ sudo nmcli device wifi rescan $ nmcli dev wifi list IN-USE SSID MODE CHAN RATE SIGNAL BARS SECURITY CDI_TP-LINK Infra 11 405 Mbit/s 100 ▂▄▆█ WPA1 WPA2 TP-LINK_CDI Infra 1 270 Mbit/s 82 ▂▄▆█ WPA1 WPA2 WLAN-PUB Infra 4 54 Mbit/s 82 ▂▄▆█ WPA1 WPA2 HiWiFi_Pins Infra 7 270 Mbit/s 82 ▂▄▆█ WPA1 WPA2 -- Infra 1 54 Mbit/s 59 ▂▄▆_ -- * MERCURY_07FA Infra 1 270 Mbit/s 55 ▂▄__ WPA1 WPA2 Automation-Local Infra 9 195 Mbit/s 55 ▂▄__ WPA2 ChinaUnicom Infra 1 54 Mbit/s 42 ▂▄__ -- 61-PUB Infra 1 270 Mbit/s 29 ▂___ WPA2 HC_Guest Infra 6 405 Mbit/s 29 ▂___ WPA1 WPA2 HuaCloud_AP Infra 6 405 Mbit/s 29 ▂___ WPA1 WPA2 56qq-guest Infra 6 195 Mbit/s 25 ▂___ WPA2 56qq-sec Infra 1 195 Mbit/s 22 ▂___ WPA2 802.1X 56qq-guest Infra 1 195 Mbit/s 22 ▂___ WPA2 HCB Infra 1 195 Mbit/s 19 ▂___ WPA2 802.1X show saved wifi list $ nmcli c ( = $ nmcli connection) NAME UUID TYPE DEVICE WLAN-PUB 545d5d95-723f-4e1b-b764-8e9bd2fe6a9f wifi wlp2s0 Wired connection 1 a2a10a61-4519-3380-9301-c6e2a592eaa7 ethernet enp0s31f6 CDI_TP-LINK_5G cb00cf00-58ca-4668-9b4c-e1fb3b18c932 wifi -- nmtui Reference ARCH NetWork Configuration How do I add a DNS server via resolv.conf? How to Configure and Manage Network Connections Using ‘nmcli’ Tool Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:00 "},"devops/nginx&cert.html":{"url":"devops/nginx&cert.html","title":"nginx&cert","keywords":"","body":" Table of Contents generated with DocToc nginx ssl cert generate cert for server cert working with Nginx certificate working with client If you enter '.', the field will be left blank. artifactory https general SSL certs If you enter '.', the field will be left blank. If you enter '.', the field will be left blank. nginx installation $ sudo apt udpate $ sudo apt install nginx configuration $ sudo ufw app list Available applications: CUPS Nginx Full Nginx HTTP Nginx HTTPS OpenSSH Postfix Postfix SMTPS Postfix Submission OR $ sudo ufw allow 'Nginx HTTP' ssl cert generate cert for server CA (root cert) $ openssl genrsa -aes256 -out www.artifactory.mycompany.com-ca.key 2048 $ openssl req -new -x509 -days 365 -key www.artifactory.mycompany.com-ca.key -sha256 -out www.artifactory.mycompany.com-ca.crt -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com\" Click to check details $ openssl genrsa -aes256 -out www.artifactory.mycompany.com-ca.key 2048 Generating RSA private key, 2048 bit long modulus ....................................................................+++ ...................................................+++ unable to write 'random state' e is 65537 (0x10001) Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory Verifying - Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory $ openssl req -new -x509 -days 365 -key www.artifactory.mycompany.com-ca.key -sha256 -out www.artifactory.mycompany.com-ca.crt -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory cert for server $ openssl genrsa -out www.artifactory.mycompany.com-server.key 2048 $ openssl req -sha256 -new -key www.artifactory.mycompany.com-server.key -out www.artifactory.mycompany.com-server.csr -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" Click to check details $ openssl genrsa -out www.artifactory.mycompany.com-server.key 2048 Generating RSA private key, 2048 bit long modulus ......................................................................+++ ............................................................................................................................................................................................................................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req -sha256 -new -key www.artifactory.mycompany.com-server.key -out www.artifactory.mycompany.com-server.csr -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" sign the server cert with CA $ echo subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req -days 365 -sha256 -in www.artifactory.mycompany.com-server.csr -CA www.artifactory.mycompany.com-ca.crt -CAkey www.artifactory.mycompany.com-ca.key -CAcreateserial -out www.artifactory.mycompany.com-server.crt -extfile extfile.cnf Click to check details $ echo subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req -days 365 -sha256 -in www.artifactory.mycompany.com-server.csr -CA www.artifactory.mycompany.com-ca.crt -CAkey www.artifactory.mycompany.com-ca.key -CAcreateserial -out www.artifactory.mycompany.com-server.crt -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Getting CA Private Key Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory unable to write 'random state' $ ls extfile.cnf www.artifactory.mycompany.com-ca.key www.artifactory.mycompany.com-server.csr www.srl www.artifactory.mycompany.com-ca.crt www.artifactory.mycompany.com-server.crt www.artifactory.mycompany.com-server.key generate client cert and signed by CA $ openssl genrsa -out www.artifactory.mycompany.com-client.key $ openssl req -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" -new -key www.artifactory.mycompany.com-client.key -out www.artifactory.mycompany.com-client.csr $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ openssl x509 -req -days 365 -sha256 -in www.artifactory.mycompany.com-client.csr -CA www.artifactory.mycompany.com-ca.crt -CAkey www.artifactory.mycompany.com-ca.key -CAcreateserial -out www.artifactory.mycompany.com-client.cert -extfile extfile.cnf Click to check details $ openssl genrsa -out www.artifactory.mycompany.com-client.key 2048 Generating RSA private key, 2048 bit long modulus ................................................+++ .......................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" -new -key www.artifactory.mycompany.com-client.key -out www.artifactory.mycompany.com-client.csr $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ cat extfile.cnf subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 extendedKeyUsage = serverAuth extendedKeyUsage = clientAuth $ openssl x509 -req -days 365 -sha256 -in www.artifactory.mycompany.com-client.csr -CA www.artifactory.mycompany.com-ca.crt -CAkey www.artifactory.mycompany.com-ca.key -CAcreateserial -out www.artifactory.mycompany.com-client.cert -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Getting CA Private Key Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactor unable to write 'random state' update the file perm $ sudo chmod -v 0444 www.artifactory.mycompany.com-ca.crt www.artifactory.mycompany.com-server.crt client.cert $ sudo chmod -v 0400 www.artifactory.mycompany.com-ca.key client.key www.artifactory.mycompany.com-server.key check certs crt $ openssl x509 -noout -text -in www.artifactory.mycompany.com-server.crt openssl x509 ca.crt $ openssl x509 -noout -text -in www.artifactory.mycompany.com-ca.crt Certificate: Data: Version: 3 (0x2) Serial Number: 15145698426239402702 (0xd23054792b3142ce) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Validity Not Before: Jan 2 11:35:31 2018 GMT Not After : Jan 2 11:35:31 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:d0:3f:b6:c5:e5:52:8d:c7:26:3f:e7:0a:7a:5f: c1:71:2a:9e:34:07:7e:10:4a:3d:c4:4f:f7:df:58: 93:0d:fa:00:e8:21:75:6d:d1:45:7d:bd:27:f2:c5: 08:13:8f:4f:be:91:9f:28:19:7e:c3:a7:42:1b:fc: b4:96:21:8a:33:59:79:27:a3:cf:13:3e:cd:92:0d: 7e:b9:9f:0d:01:bf:27:5f:e4:7a:7d:db:69:a3:78: 96:a8:c3:a9:2d:31:28:97:ba:6c:20:17:ab:eb:85: ce:2c:25:e8:3e:a0:8b:c0:0b:b2:a9:e1:ac:9f:e1: 57:35:bb:64:6a:99:2e:8f:27:f1:04:40:a7:16:32: 31:4e:ad:18:5e:9e:0b:dd:42:17:af:8a:58:c6:1a: e9:00:52:97:7b:7a:24:cc:b1:81:8d:b9:20:60:e4: 96:d5:77:82:07:4e:df:9c:3a:26:95:d5:ed:aa:a1: 24:94:64:0e:93:9a:9e:9b:d4:78:6b:46:50:69:05: 19:6a:ff:7b:1d:1b:0f:ce:6b:30:33:c7:99:9d:6a: 30:0c:fc:f8:74:00:df:65:6f:fa:1b:24:0a:73:77: 4d:94:45:27:9b:93:a6:81:37:57:57:6f:e9:ae:e4: 5e:a8:b8:be:31:0f:73:4b:9e:1b:ed:78:5c:48:ec: 0b:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: IP Address:130.147.219.19 X509v3 Subject Key Identifier: 23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Authority Key Identifier: keyid:23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Basic Constraints: CA:TRUE Signature Algorithm: sha256WithRSAEncryption 69:a3:fe:35:63:a5:e8:4e:e6:3e:4f:9d:f6:82:3d:73:f2:a7: 22:c1:46:e5:09:5e:61:81:b7:70:3c:62:ba:43:7d:bd:ac:67: d0:41:ea:a7:b8:41:47:04:bc:41:9a:46:35:31:3f:62:10:7a: 58:73:45:3a:59:3b:41:6b:2b:1e:62:42:b7:7e:c1:6b:92:25: 2a:df:3f:69:b5:26:8e:c7:5d:c6:24:a0:65:21:b7:63:74:60: 7f:3b:0e:9a:80:a4:4f:a2:79:20:19:92:64:60:b7:53:5c:09: 6e:46:6e:7a:d7:ee:ef:f4:2e:27:7a:1a:0e:da:5b:8b:7a:bf: 40:56:9f:16:63:6b:89:ab:48:65:07:45:e0:a0:21:7c:0f:6d: 9c:2a:ab:ca:d0:02:06:8a:39:7a:ea:65:b9:04:13:0f:6b:cd: ea:e5:9f:59:c5:d2:06:b2:e4:c3:cb:ab:59:69:aa:11:e6:08: 49:12:cc:d4:29:21:2b:59:c1:dc:bb:e6:a9:7d:96:68:a4:7b: 61:76:8a:21:a9:69:a5:83:d5:8b:f6:08:4e:c0:34:64:6b:65: 96:ac:ed:cd:c1:0b:54:7d:a9:57:07:77:0c:6a:43:9e:4f:c0: 6c:12:88:e8:cf:34:08:67:af:1c:2f:bb:49:54:1b:17:95:89: b3:2d:c9:5f openssl x509 server.crt $ openssl x509 -noout -text -in www.artifactory.mycompany.com-server.crt Certificate: Data: Version: 3 (0x2) Serial Number: 12625600037876864867 (0xaf37245755cf1763) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Validity Not Before: Jan 2 11:39:47 2018 GMT Not After : Jan 2 11:39:47 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: DNS:www.artifactory.mycompany.com, IP Address:130.147.219.19 X509v3 Extended Key Usage: TLS Web Server Authentication Signature Algorithm: sha256WithRSAEncryption 3d:e8:81:f2:ab:89:47:e2:2c:8c:5a:54:31:c2:2a:11:37:e6: ab:89:ff:d1:c2:8c:8e:3a:7d:d2:1d:28:3e:9e:5f:9e:89:08: 78:2e:16:32:52:e7:35:ab:66:09:a4:83:85:42:55:d6:7c:4f: 37:cf:8d:37:bd:57:d0:00:f2:9c:67:68:a2:ed:49:c6:eb:0f: b7:49:ba:ae:12:35:82:a6:a5:b6:5e:f7:68:08:f7:3f:a1:73: d2:94:3e:7a:d9:5c:e1:e2:ab:12:46:66:9d:59:3a:e1:2d:aa: a6:53:97:40:ac:a3:ca:80:6d:5b:75:dc:c4:ee:10:48:55:2c: 10:00:43:07:e6:c4:16:09:fb:04:5d:78:8e:85:21:21:75:01: a5:af:c0:c0:d1:fd:33:6e:5b:24:8b:f8:e6:1c:df:b7:f1:e5: 38:02:d4:a8:e1:09:93:2e:8d:19:ea:e2:11:3f:c1:fe:75:bb: ef:03:6e:c3:50:77:a5:54:7d:7e:e0:cd:85:20:08:41:38:b2: 86:65:aa:58:51:1b:7b:ed:6a:07:0f:cc:ab:49:d8:34:ec:5d: fd:0d:75:48:81:3c:a5:bc:ce:c0:95:8c:8e:d3:8c:0f:0d:a3: a7:73:70:bc:59:89:7c:42:25:0b:cb:2f:b0:86:4a:46:56:f2: e9:d9:63:f1 csr $ openssl req -noout -text -in www.artifactory.mycompany.com-server.csr openss req $ openssl req -noout -text -in www.artifactory.mycompany.com-server.csr Certificate Request: Data: Version: 0 (0x0) Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) Attributes: a0:00 Signature Algorithm: sha256WithRSAEncryption 74:99:e5:36:44:b4:48:a9:50:83:eb:61:02:37:6c:8a:46:45: 0e:58:04:40:66:55:56:fc:fd:cf:15:a0:31:be:de:3a:16:4f: 9a:46:1d:17:33:7f:38:dd:36:a9:76:e5:92:b2:48:29:60:e7: af:c0:f6:76:0d:9a:a6:40:43:a8:98:75:90:c3:c1:2a:7d:51: 1d:df:1b:50:8b:69:ce:7c:74:cf:03:9d:69:6b:41:7f:ed:bc: f1:6c:c0:93:22:36:5e:f7:8c:d0:f7:f5:0f:dc:51:93:1e:23: cc:12:cd:f3:0e:6c:1b:4e:b2:df:01:86:5b:d0:79:c8:6e:c8: 57:72:a8:dd:81:8a:af:c3:52:e2:ff:e8:f1:3d:6f:cb:e4:a9: 1c:51:58:b9:31:00:c0:88:5e:ca:63:59:f8:d7:82:d4:22:30: 0c:d8:bd:e6:01:11:d2:4a:68:64:d1:8e:d5:a1:19:0c:5a:99: 25:cd:c2:e5:ed:f3:48:e3:c0:7a:00:a3:a8:09:8e:d3:50:2a: 84:29:63:66:50:3e:42:af:43:ea:fa:5b:28:f9:f1:84:89:88: 2e:7f:8d:bf:44:29:83:fa:89:b3:b8:3c:13:98:20:76:6c:d3: 67:ce:03:9e:15:ea:3e:9d:4b:cb:c2:78:ab:57:1d:b7:e8:9e: 81:1b:b5:1f cert working with Nginx $ grep ssl_certificate /etc/nginx/sites-enabled/artifactoryv2.conf ssl_certificate /etc/nginx/certs/www.artifactory.mycompany.com/www.artifactory.mycompany.com-server.crt; ssl_certificate_key /etc/nginx/certs/www.artifactory.mycompany.com/www.artifactory.mycompany.com-server.key; certificate working with client MacOS $ sudo security add-trusted-cert -d -r trustRoot -k \"/Library/Keychains/System.keychain\" \"/Users/marslo/Downloads/www.artifactory.mycompany.com-ca.crt\" get cert info in MacOS $ security find-certificate -a -c -Z $ security find-certificate -a -c artifactor -Z | grep SHA-1 SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E $ security list-keychain \"/Users/marslo/Library/Keychains/login.keychain-db\" \"/Library/Keychains/System.keychain\" Click to check details $ security find-certificate -a -c artifactor -Z SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E keychain: \"/Library/Keychains/System.keychain\" version: 256 class: 0x80001000 attributes: \"alis\"=\"marslo.jiao@mycompany.com\" \"cenc\"=0x00000003 \"ctyp\"=0x00000001 \"hpky\"=0x2332BC619E518E9422305BAE688A7E8E53D2457C \"##2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"issu\"=0x3081A3310B300906035504061302434E3110300E06035504080C075369636875616E3110300E06035504070C074368656E6764753110300E060355040A0C075068696C697073310C300A060355040B0C034344493128302606035504030C1F7077772E61727469666163746F72792E6364692E7068696C6970732E636F6D3126302406092A864886F70D01090116176D6172736C6F2E6A69616F407068696C6970732E636F6D \"0\\201\\2431\\0130\\011\\006\\003U\\004\\006\\023\\002CN1\\0200\\016\\006\\003U\\004\\010\\014\\007Sichuan1\\0200\\016\\006\\003U\\004\\007\\014\\007Chengdu1\\0200\\016\\006\\003U\\004\\012\\014\\007mycompany1\\0140\\012\\006\\003U\\004\\013\\014\\003CDI1(0&\\006\\003U\\004\\003\\014\\037www.artifactory.mycompany.com1&0$\\006\\011*\\206H\\206\\367\\015\\001\\011\\001\\026\\027marslo.jiao@mycompany.com\" \"labl\"=\"www.artifactory.mycompany.com\" \"skid\"=0x2332BC619E518E9422305BAE688A7E8E53D2457C \"##2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"snbr\"=0x00D23054792B3142CE \"\\000\\3220Ty+1B\\316\" \"subj\"=0x3081A3310B300906035504061302434E3110300E06035504080C075369636875616E3110300E06035504070C074368656E6764753110300E060355040A0C075068696C697073310C300A060355040B0C034344493128302606035504030C1F7077772E61727469666163746F72792E6364692E7068696C6970732E636F6D3126302406092A864886F70D01090116176D6172736C6F2E6A69616F407068696C6970732E636F6D \"0\\201\\2431\\0130\\011\\006\\003U\\004\\006\\023\\002CN1\\0200\\016\\006\\003U\\004\\010\\014\\007Sichuan1\\0200\\016\\006\\003U\\004\\007\\014\\007Chengdu1\\0200\\016\\006\\003U\\004\\012\\014\\007mycompany1\\0140\\012\\006\\003U\\004\\013\\014\\003CDI1(0&\\006\\003U\\004\\003\\014\\037www.artifactory.mycompany.com1&0$\\006\\011*\\206H\\206\\367\\015\\001\\011\\001\\026\\027marslo.jiao@mycompany.com\" $ security find-certificate -a -c artifactor -Z -p -m SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E email addresses: marslo.jiao@mycompany.com -----BEGIN CERTIFICATE----- MIIELDCCAxSgAwIBAgIJANIwVHkrMULOMA0GCSqGSIb3DQEBCwUAMIGjMQswCQYD VQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdkdTEQMA4G A1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cuYXJ0aWZh Y3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJzbG8uamlh b0BwaGlsaXBzLmNvbTAeFw0xODAxMDIxMTM1MzFaFw0xOTAxMDIxMTM1MzFaMIGj MQswCQYDVQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdk dTEQMA4GA1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cu YXJ0aWZhY3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJz bG8uamlhb0BwaGlsaXBzLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC ggEBANA/tsXlUo3HJj/nCnpfwXEqnjQHfhBKPcRP999Ykw36AOghdW3RRX29J/LF CBOPT76RnygZfsOnQhv8tJYhijNZeSejzxM+zZINfrmfDQG/J1/ken3baaN4lqjD qS0xKJe6bCAXq+uFziwl6D6gi8ALsqnhrJ/hVzW7ZGqZLo8n8QRApxYyMU6tGF6e C91CF6+KWMYa6QBSl3t6JMyxgY25IGDkltV3ggdO35w6JpXV7aqhJJRkDpOanpvU eGtGUGkFGWr/ex0bD85rMDPHmZ1qMAz8+HQA32Vv+hskCnN3TZRFJ5uTpoE3V1dv 6a7kXqi4vjEPc0ueG+14XEjsC6UCAwEAAaNhMF8wDwYDVR0RBAgwBocEgpPbEzAd BgNVHQ4EFgQUIzK8YZ5RjpQiMFuuaIp+jlPSRXwwHwYDVR0jBBgwFoAUIzK8YZ5R jpQiMFuuaIp+jlPSRXwwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEA aaP+NWOl6E7mPk+d9oI9c/KnIsFG5QleYYG3cDxiukN9vaxn0EHqp7hBRwS8QZpG NTE/YhB6WHNFOlk7QWsrHmJCt37Ba5IlKt8/abUmjsddxiSgZSG3Y3RgfzsOmoCk T6J5IBmSZGC3U1wJbkZuetfu7/QuJ3oaDtpbi3q/QFafFmNriatIZQdF4KAhfA9t nCqrytACBoo5eupluQQTD2vN6uWfWcXSBrLkw8urWWmqEeYISRLM1CkhK1nB3Lvm qX2WaKR7YXaKIalppYPVi/YITsA0ZGtllqztzcELVH2pVwd3DGpDnk/AbBKI6M80 CGevHC+7SVQbF5WJsy3JXw== -----END CERTIFICATE----- remove the cert in MacOS $ sudo security delete-certificate -Z 915D019F0993F369C09D75C6B8DA201B8DE2636E Others Click to check details Others 1: $ cd /etc/nginx/ $ sudo openssl genrsa -des3 -out server.key 1024 $ sudo openssl req -new -key server.key -out server.csr $ sudo cp server.key{,.org} $ sudo cp server.csr{,.org} $ sudo openssl rsa -in server.key.org -out server.key $ sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt Click to check details $ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled $ sudo openssl genrsa -des3 -out server.key 1024 Generating RSA private key, 1024 bit long modulus .................................................................++++++ ......++++++ e is 65537 (0x10001) Enter pass phrase for server.key: artifactory Verifying - Enter pass phrase for server.key: artifactory $ sudo openssl req -new -key server.key -out server.csr Enter pass phrase for server.key: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Organizational Unit Name (eg, section) []:mycompany Common Name (e.g. server FQDN or YOUR name) []:docker-2.artifactory Email Address []:marslo.jiao@mycompany.com Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:artifactory An optional company name []:mycompany $ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled -rw-r--r-- 1 root root 951 Dec 26 18:32 server.key -rw-r--r-- 1 root root 785 Dec 26 18:36 server.csr -rw-r--r-- 1 root root 951 Dec 26 18:38 server.key.org -rw-r--r-- 1 root root 785 Dec 26 18:38 server.csr.org $ sudo openssl rsa -in server.key.org -out server.key Enter pass phrase for server.key.org: writing RSA key $ sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=mycompany/CN=docker-2.artifactory/emailAddress=marslo.jiao@mycompany.com Getting Private key Others 2: /etc/nginx$ sudo openssl req -newkey rsa:2048 -nodes -sha256 -keyout certs/www.artifactory.mycompany.com.key -x509 -days 365 -out certs/www.artifactory.mycompany.com.crt Generating a 2048 bit RSA private key ........+++ ..............................................................+++ writing new private key to 'certs/www.artifactory.mycompany.com.key' You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Organizational Unit Name (eg, section) []:mycompany Common Name (e.g. server FQDN or YOUR name) []:www.artifactory.mycompany.com Email Address []:marslo.jiao@mycompany.com artifactory https general SSL certs try 1 $ sudo openssl genrsa -des3 -out artifactorykey 2048 $ sudo openssl req -new -key artifactorykey -out artifactorycsr $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey $ sudo openssl x509 -req -days 365 -in artifactorycsr -signkey artifactorykey -out artifactorycrt SSL with IP $ sudo openssl genrsa -des3 -out artifactorykey 2048 Generating RSA private key, 2048 bit long modulus .........................+++ ........................................................................+++ e is 65537 (0x10001) Enter pass phrase for artifactorykey: artifactory Verifying - Enter pass phrase for artifactorykey: artifactory $ sudo openssl req -new -key artifactorykey -out artifactorycsr Enter pass phrase for artifactorykey: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Ltd Organizational Unit Name (eg, section) []:. Common Name (e.g. server FQDN or YOUR name) []:192.168.1.102 Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey Enter pass phrase for artifactorykey.org: artifactory writing RSA key $ sudo openssl x509 -req -days 365 -in artifactorycsr -signkey artifactorykey -out artifactorycrt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany Ltd/CN=192.168.1.102 Getting Private key $ openssl x509 -text -noout -in ssl_ip/artifactorycrt Certificate: Data: Version: 1 (0x0) Serial Number: 9804858425156156035 (0x8811daca106dba83) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, CN=192.168.1.102 Validity Not Before: Dec 26 16:23:15 2017 GMT Not After : Dec 26 16:23:15 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, CN=192.168.1.102 Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:ad:32:26:35:8a:8f:09:82:ff:59:61:14:14:1b: 9c:da:02:74:09:48:2a:d5:05:1d:ad:8a:d0:e0:70: 1f:9b:44:b4:df:4d:c5:4c:5a:1b:8a:52:7b:2a:69: a2:77:d3:cf:c7:fb:a6:ef:34:d1:bb:23:8d:d0:78: e6:48:3f:8c:12:3c:69:d5:62:2d:74:24:b8:49:a8: 59:c7:36:5f:64:97:5a:d1:8f:9a:5b:2f:aa:a8:65: 6c:75:28:60:55:b9:2a:5b:41:71:a4:fa:eb:10:7e: 84:4b:fb:c3:57:9c:55:8e:e8:2a:4a:c1:45:74:54: 58:d5:09:0d:59:d4:14:94:db:5b:67:91:9c:23:24: c4:07:10:d1:f1:28:fa:97:38:01:da:81:c4:f3:63: d7:84:24:dc:3c:ff:04:64:b2:3e:41:f0:d8:08:66: 06:cc:7c:05:3c:90:97:0b:02:b6:b5:2f:03:28:b7: 4c:38:aa:84:23:3e:9e:d4:b0:3a:58:4c:f3:74:df: 36:63:f2:18:ac:d1:0d:ef:05:6b:f3:dc:b6:d3:c7: f0:91:7b:b8:69:4f:ae:19:da:34:b7:38:1e:e2:9a: 10:2e:a9:a0:54:f6:61:b9:da:e6:98:c8:9b:76:83: d6:59:77:d9:18:c6:57:8c:cf:af:a4:89:5a:87:99: c4:15 Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption 5a:06:ad:9b:d0:07:d7:9b:92:2a:77:71:ff:80:6e:c1:39:bd: 81:e8:0f:21:39:bd:80:3e:96:a9:6b:7a:73:f1:80:70:4e:b1: d4:b7:1e:54:be:62:dc:35:c0:b9:d8:8c:d1:24:75:8a:42:ec: a9:dd:9b:9a:f2:4b:ad:6e:38:d7:a2:fa:7a:70:be:7b:8c:37: 63:71:10:fe:73:18:de:e5:9c:c5:6e:1a:4e:cb:7b:51:26:56: 68:56:fb:4f:71:d7:7b:94:b6:55:b9:f8:9b:31:a8:26:a5:e5: 32:36:33:65:7b:1d:9f:27:7d:f1:b0:d2:06:7c:75:d7:39:bb: 7a:44:92:e1:b8:fc:2b:fd:3c:43:93:d6:47:19:f6:ad:d3:cc: 82:dd:15:bd:d3:a0:e2:2d:92:fd:65:44:60:44:21:b9:1f:31: fd:91:c2:78:86:d9:aa:77:fd:54:ae:2f:4c:ae:5d:5e:c7:a3: 43:0d:6b:32:23:d9:61:b6:a7:c4:47:eb:bc:c2:79:6c:06:f0: a6:af:e8:45:c6:02:d5:1c:09:26:8a:a7:b0:ff:74:50:85:82: 1d:88:b2:2c:eb:20:3e:bf:3b:4e:9b:ab:b7:4f:e8:14:a8:1a: 33:50:e9:a8:24:3e:5e:2a:68:ea:fa:f3:12:30:94:8e:0f:0d: da:6c:17:60 ssl with domain $ sudo openssl genrsa -des3 -out artifactorykey 2048 Generating RSA private key, 2048 bit long modulus ........................+++ .......................................+++ e is 65537 (0x10001) Enter pass phrase for artifactorykey: artifactory Verifying - Enter pass phrase for artifactorykey: artifactory $ sudo openssl req -new -key artifactorykey -out artifactorycsr Enter pass phrase for artifactorykey: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Ltd Organizational Unit Name (eg, section) []:mycompany CDI Common Name (e.g. server FQDN or YOUR name) []:docker-1.artifactory Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey Enter pass phrase for artifactorykey.org: artifactory writing RSA key $ sudo openssl x509 -req -days 365 -in artifactorycsr -signkey artifactorykey -out artifactorycrt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany Ltd/OU=mycompany CDI/CN=docker-1.artifactory Getting Private key $ openssl x509 -text -noout -in ssl/artifactorycrt Certificate: Data: Version: 1 (0x0) Serial Number: 15006671364169185053 (0xd0426818d254b71d) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, OU=mycompany CDI, CN=docker-1.artifactory Validity Not Before: Dec 26 16:02:10 2017 GMT Not After : Dec 26 16:02:10 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, OU=mycompany CDI, CN=docker-1.artifactory Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:dc:30:6b:83:56:92:fb:f3:fb:bc:da:3e:a9:5c: 67:c3:19:42:9a:8f:8f:30:e6:27:fa:a9:9d:c9:3e: 9c:31:3d:aa:d8:9f:ae:9b:64:b0:75:2a:01:51:ad: 04:c4:00:5d:f4:f8:b4:af:bb:20:f3:77:45:65:28: d8:38:28:b2:03:46:d0:67:d1:91:8e:7b:65:66:a0: 7e:a5:e2:fe:80:00:5e:54:95:50:52:9c:44:2a:aa: dc:a2:80:be:16:07:79:b4:13:1d:f5:8a:ca:c3:ab: 1c:76:de:f3:b8:23:9b:54:17:28:be:ac:e5:68:5c: f3:83:49:61:55:d2:e1:ea:0c:e7:72:75:6e:90:5a: 90:a8:85:01:c6:cc:69:94:5b:c4:f9:14:6d:70:0a: 8e:45:e0:b9:28:aa:99:3a:22:12:db:0b:d7:d9:6e: aa:35:36:5e:e6:00:eb:99:ab:46:6d:7b:e5:12:b1: f9:0c:5c:d3:c0:47:7b:b3:e4:03:15:fa:8d:42:f8: a1:c1:ce:dc:42:d2:81:88:18:0d:26:28:7e:90:cf: e8:05:84:75:94:e9:ac:20:47:95:c7:50:1c:d8:42: c3:d7:8b:90:f9:a9:48:cc:a5:8d:88:3b:54:a9:ef: 20:ce:ee:4c:6d:04:65:eb:6c:f7:22:9d:c8:13:33: b1:6d Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption c3:c7:c8:0d:19:d1:0b:05:ac:11:e3:e4:af:25:0e:95:f5:f5: 31:ed:90:4e:7f:1a:2b:a2:2f:4d:a3:d9:57:40:a2:f6:af:55: 90:53:bf:72:39:81:5d:53:41:85:e0:1d:26:9f:9e:33:05:46: 9c:fc:51:99:19:5c:7d:ef:aa:cc:50:61:0b:f4:11:69:bd:9e: 2a:34:48:e9:9d:7c:d0:e0:80:a5:42:67:ac:8e:0c:d6:84:19: 8e:cb:05:97:9f:21:c5:e0:78:8f:97:f6:53:fa:f2:ec:49:3f: fb:11:68:ed:ea:c0:8c:c5:be:08:61:e4:bd:4e:05:5f:89:99: f6:47:6f:b3:1e:5f:49:62:ff:37:dc:f0:c4:4b:bb:a4:15:06: b1:80:4d:24:ef:bb:25:d6:a5:60:13:34:57:73:ba:b4:b0:8b: 42:0f:18:ef:0e:17:60:83:4d:61:bd:ef:55:b9:52:6a:47:ab: c3:ee:b3:11:27:86:aa:87:18:d5:60:b8:b4:34:c2:fa:75:48: 0e:f1:f4:30:b3:fa:b3:ad:a9:8a:6e:e6:62:71:02:5a:72:bd: 5c:45:a0:23:ea:1d:84:16:24:3d:88:a0:12:20:61:7a:f8:bd: dc:0f:fb:26:c0:f3:2f:1f:66:7e:64:35:b6:45:05:c4:00:43: 2d:18:da:a1 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:01 "},"devops/python.html":{"url":"devops/python.html","title":"python","keywords":"","body":" Table of Contents generated with DocToc install pip install pip from source code $ curl https://bootstrap.pypa.io/get-pip.py | python [--no-setuptools] [--no-wheel] # or $ curl https://bootstrap.pypa.io/get-pip.py | python3.2 # or $ curl https://bootstrap.pypa.io/get-pip.py | python - 'pip==8.0.0' example$ python get-pip.py --no-index --find-links=/local/copies $ python get-pip.py --user $ python get-pip.py --proxy=\"http://[user:passwd@]proxy.server:port\" $ python get-pip.py pip==9.0.2 wheel==0.30.0 setuptools==28.8.0 upgrade pip linux$ [sudo [-H]] pip install --upgrade pip windows> python -m pip install --upgrade pip from easy_install $ cd \\Scripts $ easy_install pip or $ curl -fsSL https://files.pythonhosted.org/packages/ba/2c/743df41bd6b3298706dfe91b0c7ecdc47f2dc1a3104abeb6e9aa4a45fa5d/ez_setup-0.9.tar.gz | tar xzf - -C . $ python ez_setup-0.9/ez_setup.py pip Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:00 "},"devops/ssh.html":{"url":"devops/ssh.html","title":"ssh","keywords":"","body":" Table of Contents generated with DocToc SSH Tricky Generate SSH Key Add into agent Performance Get Public Key from Private Key Disable Login Password Force Use Password Get FingerPrinter from Private Key SSH with OpenSSL SSH With Proxy Using Command Directly Using Configure file Debug Git by SSH Reference SSH Tricky Generate SSH Key $ keyname='marslo@china' # rsa4096 $ ssh-keygen -t rsa -b 4096 -f \"~/.ssh/${keyname}\" -C \"${keyname}\" -P \"\" -q # ed25519 $ ssh-keygen -t ed25519 -o -a 100 -C \"${keyname}\" -f \"~/.ssh/${keyname}\" -P '' -q Add into agent $ ssh-add ~/.ssh/${keyname} # e.g.: $ ssh-add ~/.ssh/id_ed25519 Identity added: /Users/marslo/.ssh/id_ed25519 (marslo@devops) $ ssh-agent -s SSH_AUTH_SOCK=/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T//ssh-MgCrKA3ZS06N/agent.25376; export SSH_AUTH_SOCK; SSH_AGENT_PID=25377; export SSH_AGENT_PID; echo Agent pid 25377; Performance $ openssl speed rsa1024 rsa2048 dsa1024 dsa2048 Doing 1024 bit private rsa's for 10s: 91211 1024 bit private RSA's in 9.97s Doing 1024 bit public rsa's for 10s: 1161461 1024 bit public RSA's in 9.93s Doing 2048 bit private rsa's for 10s: 12305 2048 bit private RSA's in 9.94s Doing 2048 bit public rsa's for 10s: 403455 2048 bit public RSA's in 9.98s Doing 1024 bit sign dsa's for 10s: 84873 1024 bit DSA signs in 10.00s Doing 1024 bit verify dsa's for 10s: 109544 1024 bit DSA verify in 9.99s Doing 2048 bit sign dsa's for 10s: 30010 2048 bit DSA signs in 9.99s Doing 2048 bit verify dsa's for 10s: 33202 2048 bit DSA verify in 9.98s OpenSSL 1.0.2t 10 Sep 2019 built on: reproducible build, date unspecified options:bn(64,64) rc4(ptr,int) des(idx,cisc,16,int) aes(partial) idea(int) blowfish(idx) compiler: clang -I. -I.. -I../include -fPIC -fno-common -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch x86_64 -O3 -DL_ENDIAN -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM sign verify sign/s verify/s rsa 1024 bits 0.000109s 0.000009s 9148.5 116964.9 rsa 2048 bits 0.000808s 0.000025s 1237.9 40426.4 sign verify sign/s verify/s dsa 1024 bits 0.000118s 0.000091s 8487.3 10965.4 dsa 2048 bits 0.000333s 0.000301s 3004.0 3326.9 Get Public Key from Private Key $ ssh-keygen -y -f ~/.ssh/id_rsa > ~/.ssh/id_rsa.pub Disable Login Password $ cat /etc/ssh/sshd_config ChallengeResponseAuthentication no PasswordAuthentication no UsePAM no scripts: TIMESTAMPE=$(date +\"%Y%m%d%H%M%S\") SSHDFILE=\"/etc/ssh/sshd_config\" sudo cp \"${SSHDFILE}{,.org.${TIMESTAMPE}}\" sudo bash -c '/bin/sed -i -e \"s:^\\(UsePAM.*$\\):# \\1:\" ${SSHDFILE}' sudo bash -c '/bin/sed -i -e \"s:^\\(PermitRootLogin.*$\\):# \\1:\" ${SSHDFILE}' sudo bash -c '/bin/sed -i -e \"s:^\\(ChallengeResponseAuthentication.*$\\):# \\1:\" ${SSHDFILE}' sudo bash -c '/bin/sed -i -e \"s:^\\(PasswordAuthentication.*$\\):# \\1:\" ${SSHDFILE}' if ! grep 'Add my marslo' ${SSHDFILE} > /dev/null 2>&1; then sudo bash -c \"cat >> ${SSHDFILE}\" Force Use Password $ ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no user@target.server Get FingerPrinter from Private Key SHA256: $ ssh-keygen -l -f ~/.ssh/id_rsa # or $ ssh-keygen -l -f ~/.ssh/id_rsa.pub MD5: $ ssh-keygen -E md5 -l -f ~/.ssh/id_rsa # OR $ ssh-keygen -E md5 -l -f ~/.ssh/id_rsa.pub SSH with OpenSSL $ openssl pkey -in ~/.ssh/ec2/primary.pem -pubout -outform DER | openssl md5 -c SSH With Proxy Using Command Directly Linux: $ ssh -o 'ProxyCommand nc -x proxy.url.com proxy-port %h %p' -vT user@target.server # or $ ssh -o 'ProxyCommand corkscrew proxy.url.com proxy-port %h %p' -vT user@target.server Windows: Git for Windows $ ssh -o 'ProxyCommand connect -H http://proxy.url.com:proxy-port %h %p' user@target.server Cygwin $ apt-cyg install corkscrew $ ssh -o 'ProxyCommand corkscrew proxy.url.com proxy-port %h %p' user@target.server # OR $ apt-cyg install nc $ ssh -o 'ProxyCommand nc -X connect -x proxy.url.com:proxy-port %h %p' -vT git@github.com Using Configure file $ cat ~/.ssh/config HOST * GSSAPIAuthentication no StrictHostKeyChecking no # UserKnownHostsFile /dev/null IdentityFile ~/.ssh/id_ed25519 IdentityFile ~/.ssh/id_rsa # keep the older key if necessary Host github.com Hostname github.com User marslo.jiao@gmail.com IdentityFile /C/Marslo/my@key ProxyCommand connect -H http://127.0.0.1:8000 %h %p IdentitiesOnly yes OR $ cat ~/.ssh/config HOST * GSSAPIAuthentication no StrictHostKeyChecking no # UserKnownHostsFile /dev/null IdentityFile ~/.ssh/id_ed25519 IdentityFile ~/.ssh/id_rsa # keep the older key if necessary Host github.com Hostname github.com User marslo.jiao@gmail.com IdentityFile /C/Marslo/my@key ProxyCommand nc -X connect -x proxy.url.com:proxy-port %h %p IdentitiesOnly yes ServerAliveInterval 10 # Optional Debug Git by SSH GIT_SSH_COMMAND $ GIT_SSH_COMMAND=\"ssh -vvT\" git clone git@github.com:Marslo/myblog.git Cloning into 'myblog'... OpenSSH_7.9p1, LibreSSL 2.7.3 debug1: Reading configuration data /Users/marslo/.ssh/config debug1: /Users/marslo/.ssh/config line 1: Applying options for * debug1: /Users/marslo/.ssh/config line 13: Applying options for github.com debug1: Reading configuration data /etc/ssh/ssh_config debug1: /etc/ssh/ssh_config line 48: Applying options for * debug1: Connecting to github.com port 22. ^C GIT_TRACE $ GIT_TRACE=1 git st 00:30:44.772137 git.c:703 trace: exec: git-st 00:30:44.772540 run-command.c:663 trace: run_command: git-st 00:30:44.772894 git.c:384 trace: alias expansion: st => status 00:30:44.772903 git.c:764 trace: exec: git status 00:30:44.772907 run-command.c:663 trace: run_command: git status 00:30:44.777379 git.c:440 trace: built-in: git status On branch master Your branch is up to date with 'origin/master'. 00:30:44.782714 run-command.c:663 trace: run_command: GIT_INDEX_FILE=.git/index git submodule summary --cached --for-status --summary-limit -1 HEAD 00:30:44.787490 git.c:703 trace: exec: git-submodule summary --cached --for-status --summary-limit -1 HEAD 00:30:44.788038 run-command.c:663 trace: run_command: git-submodule summary --cached --for-status --summary-limit -1 HEAD 00:30:44.838222 git.c:440 trace: built-in: git rev-parse --git-dir 00:30:44.845054 git.c:440 trace: built-in: git rev-parse --git-path objects 00:30:44.852811 git.c:440 trace: built-in: git rev-parse -q --git-dir 00:30:44.870362 git.c:440 trace: built-in: git rev-parse --show-prefix 00:30:44.878755 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:44.893984 git.c:440 trace: built-in: git rev-parse -q --verify --default HEAD HEAD 00:30:44.899709 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:44.905200 git.c:440 trace: built-in: git rev-parse --sq --prefix -- 00:30:44.911762 git.c:440 trace: built-in: git diff-index --cached --ignore-submodules=dirty --raw 52c94664ffc09cde2308c6bf9824ca0355ff5ff7 -- 00:30:44.917374 run-command.c:663 trace: run_command: GIT_INDEX_FILE=.git/index git submodule summary --files --for-status --summary-limit -1 00:30:44.922165 git.c:703 trace: exec: git-submodule summary --files --for-status --summary-limit -1 00:30:44.922568 run-command.c:663 trace: run_command: git-submodule summary --files --for-status --summary-limit -1 00:30:44.965375 git.c:440 trace: built-in: git rev-parse --git-dir 00:30:44.972784 git.c:440 trace: built-in: git rev-parse --git-path objects 00:30:44.979117 git.c:440 trace: built-in: git rev-parse -q --git-dir 00:30:44.991077 git.c:440 trace: built-in: git rev-parse --show-prefix 00:30:44.997718 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:45.012365 git.c:440 trace: built-in: git rev-parse -q --verify --default HEAD 00:30:45.018759 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:45.024687 git.c:440 trace: built-in: git rev-parse --sq --prefix -- 00:30:45.031664 git.c:440 trace: built-in: git diff-files --ignore-submodules=dirty --raw -- nothing to commit, working tree clean Reference 透过代理连接SSH SSH ProxyCommand example: Going through one host to reach another server OpenSSH/Cookbook/Proxies and Jump Hosts Tunneling SSH over PageKite Transparent Multi-hop SSH SSH via HTTP proxy in OSX ssh key Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:01 "},"jenkins/jenkins.html":{"url":"jenkins/jenkins.html","title":"jenkins","keywords":"","body":" Table of Contents generated with DocToc run Jenkins in docker in kubernetes crumb get crumb visit API via crumb restart Jenkins instance run Jenkins refernce: Jenkins Features Controlled with System Properties -Dhudson.security.ArtifactsPermission=true remoting configuration IMPORTANT JENKINS COMMAND in docker $ docker run \\ --name jenkins \\ --rm \\ --detach \\ --network jenkins \\ --env DOCKER_HOST=tcp://docker:2376 \\ --env DOCKER_CERT_PATH=/certs/client \\ --env DOCKER_TLS_VERIFY=1 \\ --publish 8080:8080 \\ --publish 50000:50000 \\ --volume jenkins-data:/var/jenkins_home \\ --volume jenkins-docker-certs:/certs/client:ro \\ jenkins/jenkins:latest docker run with JAVA_OPTS$ docker run \\ --name jenkins \\ --detach \\ --rm \\ --network jenkins \\ --env DOCKER_HOST=tcp://docker:2376 \\ --env DOCKER_CERT_PATH=/certs/client \\ --env DOCKER_TLS_VERIFY=1 \\ --publish 80:8080 \\ --publish 50000:50000 \\ --env JAVA_OPTS=\" \\ -DsessionTimeout=1440 \\ -DsessionEviction=43200 \\ -Djava.awt.headless=true \\ -Djenkins.ui.refresh=true \\ -Divy.message.logger.level=4 \\ -Dhudson.Main.development=true \\ -Duser.timezone='Asia/Chongqing' \\ -Djenkins.install.runSetupWizard=true \\ -Dhudson.security.ArtifactsPermission=true \\ -Dpermissive-script-security.enabled=true \\ -Djenkins.slaves.NioChannelSelector.disabled=true \\ -Dhudson.security.LDAPSecurityRealm.groupSearch=true \\ -Djenkins.slaves.JnlpSlaveAgentProtocol3.enabled=false \\ -Djenkins.security.ClassFilterImpl.SUPPRESS_WHITELIST=true \\ -Dhudson.model.ParametersAction.keepUndefinedParameters=true \\ -Dcom.cloudbees.workflow.rest.external.ChangeSetExt.resolveCommitAuthors=true \\ -Dhudson.plugins.active_directory.ActiveDirectorySecurityRealm.forceLdaps=false \\ -Dhudson.model.DirectoryBrowserSupport.CSP=\\\"sandbox allow-same-origin allow-scripts; default-src 'self'; script-src * 'unsafe-eval'; img-src *; style-src * 'unsafe-inline'; font-src *;\\\" \\ \" \\ --env JNLP_PROTOCOL_OPTS=\"-Dorg.jenkinsci.remoting.engine.JnlpProtocol3.disabled=false\" \\ --volume /opt/JENKINS_HOME:/var/jenkins_home \\ jenkins/jenkins:latest in kubernetes reference: official yaml official sa yaml $ cat for nginx ingress--- apiVersion: extensions/v1beta1 kind: Ingress metadata: name: jenkins namespace: devops annotations: kubernetes.io/ingress.class: \"nginx\" nginx.ingress.kubernetes.io/secure-backends: \"true\" nginx.ingress.kubernetes.io/backend-protocol: \"HTTP\" kubernetes.io/ingress.allow-http: \"false\" spec: tls: - hosts: - jenkins.mysite.com secretName: mysite-certs rules: - host: jenkins.mysite.com http: paths: - path: backend: serviceName: jenkins servicePort: 8080 crumb more info: Improved CSRF protection CSRF Protection Remote Access API Jenkins REST API example using crumb CSRF Protection Explained get crumb jq for multiple values and another answer $ curl -s 'http://jenkins.marslo.com/crumbIssuer/api/json' \\ | jq -r '[.crumbRequestField, .crumb] | \"\\(.[0]):\\(.[1])\"' Jenkins-Crumb:8b87b6ed98ef923****** or $ curl -s 'http://jenkins.marslo.com/crumbIssuer/api/json' \\ | jq -r '[.crumbRequestField, .crumb] | join(\":\")' or $ curl -sSLg \"http://${JENKINS_URL}/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,\\\":\\\",//crumb)\" Jenkins-Crumb:8b87b6ed98ef923****** visit API via crumb CRUMB=$(curl -sSLg http://jenkins.marslo.com/crumbIssuer/api/json | jq -r .crumb) $ curl -H \"Jenkins-Crumb:${CRUMB}\" \\ http://jenkins.marslo.com/job/marslo/job/sandbox/buildWithParameters \\ -d 'cities=Lanzhou' or $ curl -H \"Jenkins-Crumb:${CRUMB}\" \\ http://jenkins.marslo.com/job/marslo/job/sandbox/buildWithParameters \\ --data 'cities=Leshan,Chengdu' \\ --data 'provinces=Sichuan' build a job using the REST API and cURL $ curl -X POST http://developer:developer@localhost:8080/job/test/build # build with parameters $ curl -X POST \\ http://developer:developer@localhost:8080/job/test/build \\ --data-urlencode json='{\"parameter\": [{\"name\":\"paramA\", \"value\":\"123\"}]}' restart Jenkins instance CRUMB=$(curl -sSLg http://jenkins.marslo.com/crumbIssuer/api/json | jq -r .crumb) $ curl -X POST \\ -H \"Jenkins-Crumb:${CRUMB}\" \\ http://jenkins.marslo.com/safeRestart Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:13 "},"jenkins/config/config.html":{"url":"jenkins/config/config.html","title":"config","keywords":"","body":" Table of Contents generated with DocToc Mailing format Mailing format Show the logs after building Format: ${BUILD_LOG, maxLines, escapeHtml} maxLines: 250 For example: ${BUILD_LOG, maxLines=8000, escapeHtml=true} Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:13 "},"jenkins/config/windows.html":{"url":"jenkins/config/windows.html","title":"windows","keywords":"","body":" Table of Contents generated with DocToc windows agent windows agent configuration start service remove service windows agent reference windows agent: How to create an agent in Linux from console How to Install Several Windows Agents as a Service? Launch Java Web Start slave agent via Windows Scheduler Step by step guide to set up master and agent machines on Windows windows services: sc.exe query windows agent configuration jenkins node start service open the node connection page -> Launch -> File -> Install as a server setup jenkins-slave.exe install and start service by cmd -> sc.exe C:\\WINDOWS\\system32>sc.exe create \"jenkins\" start= auto binPath= \"E:\\devops\\jenkins-slave.exe\" DisplayName= \"jenkins\" [SC] CreateService SUCCESS C:\\WINDOWS\\system32>sc description jenkins \"the windows agent for jenkins >\" [SC] ChangeServiceConfig2 SUCCESS C:\\WINDOWS\\system32>sc start jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 2 START_PENDING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 PID : 27784 FLAGS : service configuration C:\\WINDOWS\\system32>sc config jenkins start= disabled [SC] ChangeServiceConfig SUCCESS C:\\WINDOWS\\system32>sc query jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 4 RUNNING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 list all services C:\\WINDOWS\\system32>sc queryex type=service state=all | find /i \"SERVICE_NAME:\" SERVICE_NAME: AJRouter SERVICE_NAME: ALG SERVICE_NAME: AppIDSvc SERVICE_NAME: Appinfo SERVICE_NAME: AppMgmt SERVICE_NAME: AppReadiness SERVICE_NAME: AppVClient SERVICE_NAME: AppXSvc SERVICE_NAME: AudioEndpointBuilder SERVICE_NAME: Audiosrv SERVICE_NAME: AxInstSV ... setup service remove service C:\\WINDOWS\\system32>sc stop jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 3 STOP_PENDING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 C:\\WINDOWS\\system32>sc delete jenkins [SC] DeleteService SUCCESS C:\\WINDOWS\\system32>taskkill /F /IM mmc.exe SUCCESS: The process \"mmc.exe\" with PID 19572 has been terminated. or remove HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\jenkins Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:13 "},"jenkins/jenkinsfile/jenkinsfile.html":{"url":"jenkins/jenkinsfile/jenkinsfile.html","title":"jenkinsfile","keywords":"","body":" Table of Contents generated with DocToc jenkins API update node name raw build manager.build.result.isBetterThan customized build display name description reference: Pipeline Examples Jenkins Pipeline Syantx Pipeline Steps Reference jenkins API update node name get label @NonCPS def getLabel(){ for (node in jenkins.model.Jenkins.instance.nodes) { if (node.getNodeName().toString().equals(\"${env.NODE_NAME}\".toString())) { currentLabel = node.getLabelString() return currentLabel } } } set label @NonCPS def updateLabel(nodeName, newLabel) { def node = jenkins.model.Jenkins.instance.getNode(nodeName) if (node) { node.setLabelString(newLabel) node.save() } } Jenkinsfile Example String curLabel = null String newLabel = null String testNodeName = null String curProject = env.JOB_NAME String curBuildNumber = env.BUILD_NUMBER node(\"master\") { try{ stage(\"reserve node\") { node(\"${params.tmNode}\") { testNodeName = env.NODE_NAME curLabel = getLabel() newLabel = \"${curLabel}~running_${curProject}#${curBuildNumber}\" echo \"~~> lock ${testNodeName}. update lable: ${curLabel} ~> ${newLabel}\" updateLabel(testNodeName, newLabel) } // node } // reserve stage } finally { if (newLabel) { stage(\"release node\") { nodeLabels = \"${newLabel}\".split('~') orgLabel = nodeLabels[0] echo \"~~> release ${testNodeName}. update lable ${newLabel} ~> ${orgLabel}\" updateLabel(testNodeName, orgLabel) } // release stage } // if } // finally raw build Map buildResult = [:] node(\"master\") { buildResult = build job: '/marslo/artifactory-lib', propagate: true, wait: true buildResult.each { println it } println \"\"\" ~~> \"result\" : ${buildResult.result} ~~> \"getBuildVariables()\" : ${buildResult.getBuildVariables()} ~~> \"getBuildVariables().mytest\" : ${buildResult.getBuildVariables().mytest} ~~> \"getRawBuild().getEnvVars()\" : ${buildResult.getRawBuild().getEnvVars()} ~~> \"getRawBuild().getEnvironment()\" : ${buildResult.getRawBuild.getEnvironment()} ~~> \"rawBuild.environment.RUN_CHANGES_DISPLAY_URL\" : ${buildResult.rawBuild.environment.RUN_CHANGES_DISPLAY_URL} ~~> \"getBuildCauses()\" : ${buildResult.getBuildCauses()} ~~> \"getChangeSets()\" : ${buildResult.getChangeSets()} ~~> \"buildVariables[\"mytest\"]\" : ${buildResult.buildVariables[\"mytest\"]} ~~> \"buildResult.rawBuild\": ${buildResult.rawBuild} ~~> \"buildResult.rawBuild.log\": ${buildResult.rawBuild.log} \"\"\" } // node manager.build.result.isBetterThan if(manager.build.result.isBetterThan(hudson.model.Result.UNSTABLE)) { def cmd = 'ssh -p 29418 $host gerrit review --verified +1 --code --review +2 --submit $GERRIT_CHANGE_NUMBER,$GERRIT_PATCHSET_NUMBER' cmd = manager.build.environment.expand(cmd) manager.listener.logger.println(\"Merge review: '$cmd'\") def p = \"$cmd\".execute() manager.listener.logger.println(p.in.text) manager.addShortText(\"M\") } customized build display name currentBuild.displayName = '#' + Integer.toString(currentBuild.number) + ' mytest' description currentBuild.description = 'this is whitebox' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:14 "},"jenkins/jenkinsfile/utility.html":{"url":"jenkins/jenkinsfile/utility.html","title":"utility","keywords":"","body":" Table of Contents generated with DocToc Pipeline Utility Steps findFiles Pipeline Utility Steps findFiles jenkinsfilesh \"touch a.txt\" def files = findFiles (glob: \"**/*.txt\") println \"\"\" name: ${files[0].name} path: ${files[0].path} directory: ${files[0].directory} length: ${files[0].length} lastModified: ${files[0].lastModified} \"\"\" result [Pipeline] sh (hide) + touch a.txt [Pipeline] findFiles [Pipeline] echo name: a.txt path: a.txt directory: false length: 0 lastModified: 1605525397000 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:15 "},"jenkins/jenkinsfile/parallel.html":{"url":"jenkins/jenkinsfile/parallel.html","title":"parallel","keywords":"","body":" Table of Contents generated with DocToc parallel static dynamic parallel static timestamps { ansiColor('xterm') { parallel([ 'k1 \\u00BB v1': { stage( 'build k1' ) { node(\"master\") { println \"KEY= k1, VALUE=v1\" sleep 3 } // node } }, 'k2 \\u00BB v2': { stage( 'build k2' ) { node(\"master\") { println \"KEY= k2, VALUE=v2\" sleep 3 } // node } }, 'k3 \\u00BB v3': { stage( 'build k3' ) { node(\"master\") { println \"KEY= k3, VALUE=v3\" sleep 3 } // node } } ]) println 'done' }} // ansiColor | timestamps dynamic timestamps { ansiColor('xterm') { Map worker = [:] Map data = [ \"k1\": \"v1\", \"k2\": \"v2\", \"k3\": \"v3\", ] data.each { k ,v -> worker[\"${k} \\u00BB ${v}\"] = { stage(\"build ${k}\") { node(\"master\") { println \"\"\" --------------- \"KEY=${k} VALUE=${v}\" --------------- \"\"\" sleep 3 } // node : master } // stage } // work } parallel worker println \"done !\" }} // ansiColor | timestamps Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:15 "},"jenkins/jenkinsfile/build.html":{"url":"jenkins/jenkinsfile/build.html","title":"build","keywords":"","body":" Table of Contents generated with DocToc build & current build check previous build status Stop the current build get current build info trigger downstream builds build & current build check previous build status useful info: method hudson.model.Run getPreviousBuild method hudson.model.Run getResult method org.jenkinsci.plugins.workflow.support.steps.build.RunWrapper getRawBuild if(!hudson.model.Result.SUCCESS.equals(currentBuild.rawBuild.getPreviousBuild()?.getResult())) { echo \"last build failed\" } Stop the current build stop current // stop and show status to UNSTABLE if ( 'UNSTABLE' == currentBuild.result ) { currentBuild.getRawBuild().getExecutor().interrupt(Result.UNSTABLE) } stop all Thread.getAllStackTraces().keySet().each() { t -> if (t.getName()==\"YOUR THREAD NAME\" ) { t.interrupt(); } // or t.stop(); } // and Jenkins.instance.getItemByFullName(\"JobName\") .getBuildByNumber(JobNumber) .finish( hudson.model.Result.ABORTED, new java.io.IOException(\"Aborting build\") ); get current build info reference: How to get Jenkins build job details? get BUILD_NUMBER Jenkins.instance.getItemByFullName(env.JOB_NAME).getLastBuild().getNumber().toInteger() get build id of lastSuccessfulBuild get via api sh \"\"\" curl -sSLg 'https:///job//api/json' -o 'output.json' \"\"\" def data = readJSON file: 'output.json' println data.lastSuccessfulBuild.number get via Jenkins.instance.getItemByFullName(env.JOB_NAME) println Jenkins.instance.getItemByFullName(env.JOB_NAME).lastSuccessfulBuild.number get last build idprintln Jenkins.instance.getItemByFullName(env.JOB_NAME).getLastBuild().getNumber().toInteger() trigger downstream builds timestamps { ansiColor('xterm') { node('master') { stage('trigger downstream') { buildRes = build job: '/marslo/downstream', propagate: false, parameters: [ string( name: 'stringParams', value: 'string' ) , string( name: 'choiceParams', value: 'validChoice' ) , booleanParam( name: 'booleanParams', value: false ) , ] String log = \"\"\" result : ${buildRes.result} url : ${buildRes.absoluteUrl} build number : ${buildRes.number.toString()} \"\"\" println log } // stage : trigger downstream } // node : master }} // ansiColor | timestamps trigger downstream with active choice parameters /marslo/sandbox timestamps { ansiColor('xterm') { podTemplate(cloud: 'DevOps Kubernetes') { node(POD_LABEL) { List newParams = [ [$class: 'StringParameterValue' , name: 'lastName' , value: 'Jiao' ] , [$class: 'StringParameterValue' , name: 'firstName' , value: 'Marslo' ] , [$class: 'StringParameterValue' , name: 'provinces' , value: 'Gansu' ] , [$class: 'StringParameterValue' , name: 'cities' , value: 'Lanzhou,Dingxi' ] , [$class: 'BooleanParameterValue', name: 'notify', value: false] ] def res = build ( job: '/marslo/sandbox' , propagate : false , wait : true , parameters: newParams ) println \"\"\" result : ${res.result} url : ${res.absoluteUrl} build number : ${res.number.toString()} \"\"\" }} // node | podTemplate }} // ansiColor | timestamp Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:15 "},"jenkins/jenkinsfile/envvar.html":{"url":"jenkins/jenkinsfile/envvar.html","title":"envvar","keywords":"","body":" Table of Contents generated with DocToc environment variables get current customized environment get downstream build environment get previous build environment environment variables get current customized environment println currentBuild.getBuildVariables()?.MY_ENV get downstream build environment def res = build job: 'downstream-job', propagate: false println res.getBuildVariables()?.MY_ENV get previous build environment println currentBuild.getPreviousBuild().getBuildVariables()?.MY_ENV Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:14 "},"jenkins/jenkinsfile/properties.html":{"url":"jenkins/jenkinsfile/properties.html","title":"properties","keywords":"","body":" Table of Contents generated with DocToc parameters active choice parameters mixed parameters parameters properties([ parameters([ string(defaultValue: '', name: 'stringParams', description: '', trim: false), string(defaultValue: 'default', name: 'stringDefaultParams', description: '', trim: false), choice(choices: ['a', 'b', 'c', 'd'], name: 'choiceParams', description: ''), booleanParam(defaultValue: false, name: 'booleanParams', description: '') ]) ]) active choice parameters properties([ parameters([ [ $class: 'ChoiceParameter', name: 'provinces', choiceType: 'PT_SINGLE_SELECT', description: '', script: [ $class: 'GroovyScript', fallbackScript: [classpath: [], sandbox: false, script: '#!groovy return [\"accept in ScriptApproval first\"]'], script: [classpath: [], sandbox: false, script: '''return[ \\'Gansu\\', \\'Sichuan\\', \\'Disabled:disabled\\' ]''' ] ] ], // ChoiceParameter [ $class: 'CascadeChoiceParameter', name: 'cities', referencedParameters: 'provinces', choiceType: 'PT_CHECKBOX', description: '', script: [ $class: 'GroovyScript', fallbackScript: [classpath: [], sandbox: false, script: '#!groovy return [\"accept in ScriptApproval first\"]'], script: [classpath: [], sandbox: false, script: '''if (provinces.equals(\"Gansu\")) { return [\"Lanzhou\", \"Dingxi\"] } else if (provinces.equals(\"Sichuan\")) { return [\"Leshan\", \"Guangyuan:disabled\", \"Chengdu:selected\"] } else if (provinces.equals(\"Disabled\")) { return [\"notshow:selected\"] } else { return [\"Unknown provinces\"] }''' ] ]], // CascadeChoiceParameter [ $class: 'StringParameterDefinition' , name: 'lastName' , defaultValue: 'Joe' , description: '' ], // StringParameterDefinition [ $class: 'BooleanParameterDefinition', name: 'notify', defaultValue: false, description: '' ] // BooleanParameterDefinition ]) ]) or import groovy.transform.Field import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript @Field def props = [] @Field def newParams = [] @Field def fb = new SecureGroovyScript(\"\"\"return ['Script Error!']\"\"\", false) @Field def ps = new SecureGroovyScript(\"\"\"return[ 'Gansu', 'Sichuan', 'Disabled:disabled' ]\"\"\", false ) @Field def cs = new SecureGroovyScript(\"\"\"#!groovy Map citySets = [ Gansu : ['Lanzhou', 'Dingxi'] , Sichuan : ['Leshan', 'Guangyuan', 'Chengdu:selected'] , Disabled : ['notshow:selected'] ] return citySets[provinces] \"\"\", false) newParams += [$class: 'ChoiceParameter', name: 'provinces', choiceType: 'PT_SINGLE_SELECT', script: [ $class: 'GroovyScript', script: ps, fallbackScript: fb ], description: '' ] newParams += [$class: 'CascadeChoiceParameter', name: 'cities', referencedParameters: 'provinces', choiceType: 'PT_CHECKBOX', script: [ $class: 'GroovyScript', script: cs, fallbackScript: fb ], description: '' ] props += [$class: 'ParametersDefinitionProperty', parameterDefinitions: newParams] properties( properties: props ) mixed parameters import groovy.transform.Field import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript @Field def props = [] @Field def newParams = [] @Field def fb = new SecureGroovyScript(\"\"\"return ['Script Error!']\"\"\", false) @Field def ps = new SecureGroovyScript(\"\"\"return[ 'Gansu', 'Sichuan', 'Disabled:disabled' ]\"\"\", false ) @Field def cs = new SecureGroovyScript(\"\"\"#!groovy Map citySets = [ Gansu : ['Lanzhou', 'Dingxi'] , Sichuan : ['Leshan', 'Guangyuan', 'Chengdu:selected'] , Disabled : ['notshow:selected'] ] return citySets[provinces] \"\"\", false) newParams += [$class: 'StringParameterDefinition' , name: 'lastName' , defaultValue: 'Joe' , description: ''] newParams += [$class: 'StringParameterDefinition' , name: 'firstName' , defaultValue: 'Dan' , description: ''] newParams += [$class: 'ChoiceParameter', name: 'provinces', choiceType: 'PT_SINGLE_SELECT', script: [ $class: 'GroovyScript', script: ps, fallbackScript: fb ], description: '' ] newParams += [$class: 'CascadeChoiceParameter', name: 'cities', referencedParameters: 'provinces', choiceType: 'PT_CHECKBOX', script: [ $class: 'GroovyScript', script: cs, fallbackScript: fb ], description: '' ] newParams += [$class: 'BooleanParameterDefinition', name: 'notify', defaultValue: false, description: ''] props += [$class: 'ParametersDefinitionProperty', parameterDefinitions: newParams] properties( properties: props ) podTemplate(cloud: 'DevOps Kubernetes') { node(POD_LABEL) { stage('run') { println \"\"\" lastName: ${params.lastName} firstName: ${params.firstName} provinces: ${params.provinces} cities: ${params.cities} notify: ${params.notify} \"\"\" } } } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:15 "},"jenkins/jenkinsfile/trigger.html":{"url":"jenkins/jenkinsfile/trigger.html","title":"trigger","keywords":"","body":" Table of Contents generated with DocToc trigger poll SCM parameterizedCron triggered by trigger poll SCM properties([ // every 6 hours pipelineTriggers([ pollSCM( ignorePostCommitHooks: true, scmpoll_spec: 'H H/6 * * *' ) ]) ]) properties([ pipelineTriggers([ [ $class: \"SCMTrigger\", scmpoll_spec: 'H/5 * * * *' ], ]) ]) declarative:triggers { pollSCM ignorePostCommitHooks: true, scmpoll_spec: 'H H * * *' } parameterizedCron properties([ parameters([ choice(choices: ['', 'a', 'b', 'c'], description: '', name: 'var1') choice(choices: ['', 'a', 'b', 'c'], description: '', name: 'var2') ]), pipelineTriggers([ parameterizedCron( ''' H/3 * * * * % var1=a; var2=b H/6 * * * * % var1=b; var2=a ''' ) ]) ]) triggered by gitlab gitlab currentBuild.rawBuild.getCause(com.dabsquared.gitlabjenkins.cause.GitLabWebHookCause).getData() // or commit = currentBuild.rawBuild.getCause(com.dabsquared.gitlabjenkins.cause.GitLabWebHookCause).getData().getLastCommit() get build cause def build = currentBuild.rawBuild println build.getCauses().collect { it.getClass().getCanonicalName().tokenize('.').last() } println \"\"\" cause: ${build.getCauses().toString()} cause.getClass(): ${build.getCauses().getClass()} : ${build.getCauses().getClass().getCanonicalName()} build.getCause(hudson.model.Cause.UserIdCause.class): ${build.getCause(hudson.model.Cause.UserIdCause.class)} \"\"\" get user id if triggered by manually def build = currentBuild.rawBuild if ( build.getCause(hudson.model.Cause.UserIdCause.class) ) { println \"\"\" username: ${build.getCause(hudson.model.Cause.UserIdCause.class).getUserName()} id: ${build.getCause(hudson.model.Cause.UserIdCause.class).getUserId()} mail: ${build.getCause(hudson.model.Cause.UserIdCause.class).getUserId()}@domain.com \"\"\" } or import hudson.model.Cause.UserIdCause if ( build.getCause(UserIdCause.class) ) { println \"\"\" username: ${build.getCause(UserIdCause.class).getUserName()} id: ${build.getCause(UserIdCause.class).getUserId()} mail: ${build.getCause(UserIdCause.class).getUserId()}@domain.com \"\"\" } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:14 "},"jenkins/jenkinsfile/node.html":{"url":"jenkins/jenkinsfile/node.html","title":"node","keywords":"","body":" Table of Contents generated with DocToc yaml with resources with POD_LABEL default yaml container reference: kubernetes Kubernetes plugin yaml #!/usr/bin/env groovy import groovy.transform.Field @Field final String CLUSTER = 'DevOps Kubernetes' @Field final String NAMESPACE = 'devops' String label = env.BUILD_TAG ansiColor('xterm') { timestamps { podTemplate( label: label , cloud: CLUSTER , namespace: NAMESPACE , showRawYaml: true, yaml: \"\"\" apiVersion: v1 kind: Pod metadata: labels: jenkins: jnlp-inbound-agent spec: hostNetwork: true containers: - name: jnlp image: jenkins/inbound-agent:latest workingDir: /home/jenkins tty: true \"\"\" ) { node (label) { container(name:'jnlp', shell:'/bin/bash') { stage('prepare') { sh \"\"\" whoami pwd realpath ${WORKSPACE} \"\"\" } // stage }}} // container | node | podTemplate }} // timestamp | ansiColor // vim: ft=Jenkinsfile ts=2 sts=2 sw=2 et with resources #!/usr/bin/env groovy import groovy.transform.Field @Field final String CLUSTER = 'Jenkins Kubernetes' @Field final String NAMESPACE = 'jenkins' String label = env.BUILD_TAG ansiColor('xterm') { timestamps { podTemplate( label: label , cloud: CLUSTER , namespace: NAMESPACE , showRawYaml: true, yaml: \"\"\" apiVersion: v1 kind: Pod metadata: labels: jenkins: jnlp-inbound-agent spec: hostNetwork: true containers: - name: jnlp image: jenkins/inbound-agent:latest workingDir: /home/jenkins tty: true resources: limits: memory: 1Gi cpu: 1 requests: memory: 500Mi cpu: 0.5 \"\"\" ) { node (label) { container(name:'jnlp', shell:'/bin/bash') { stage('prepare') { sh \"\"\" whoami pwd \"\"\" } // stage }}} // container | node | podTemplate }} // timestamp | ansiColor // vim: ft=Jenkinsfile ts=2 sts=2 sw=2 et with POD_LABEL #!/usr/bin/env groovy import groovy.transform.Field @Field final String CLUSTER = 'Jenkins Kubernetes' @Field final String NAMESPACE = 'jenkins' ansiColor('xterm') { timestamps { podTemplate( cloud: CLUSTER , namespace: NAMESPACE , showRawYaml: true, yaml: \"\"\" apiVersion: v1 kind: Pod metadata: labels: jenkins: jnlp-inbound-agent spec: hostNetwork: true containers: - name: jnlp image: jenkins/inbound-agent:latest workingDir: /home/jenkins tty: true resources: limits: memory: 1Gi cpu: 1 requests: memory: 500Mi cpu: 0.5 \"\"\" ) { node (POD_LABEL) { container(name:'jnlp', shell:'/bin/bash') { stage('prepare') { sh \"\"\" whoami pwd ls -Altrh /home/ ls -Altrh /home/jenkins/ touch a.txt realpath ${WORKSPACE} realpath a.txt \"\"\" } // stage }}} // container | node | podTemplate }} // timestamp | ansiColor // vim: ft=Jenkinsfile ts=2 sts=2 sw=2 et default yaml podTemplate(cloud: 'DevOps Kubernetes') { node(POD_LABEL) { stage('Run shell') { sh 'echo hello world' } } } windows (kubernetes) /* * Runs a build on a Windows pod. * Tested in EKS: https://docs.aws.amazon.com/eks/latest/userguide/windows-support.html */ podTemplate(yaml: ''' apiVersion: v1 kind: Pod spec: containers: - name: jnlp image: jenkins/inbound-agent:windowsservercore-1809 - name: shell image: mcr.microsoft.com/powershell:preview-windowsservercore-1809 command: - powershell args: - Start-Sleep - 999999 nodeSelector: kubernetes.io/os: windows ''') { node(POD_LABEL) { container('shell') { powershell 'Get-ChildItem Env: | Sort Name' } } } maven (kubernetes) // Build a Maven project using the standard image and Scripted syntax. // Rather than inline YAML, you could use: yaml: readTrusted('jenkins-pod.yaml') // Or, to avoid YAML: containers: [containerTemplate(name: 'maven', image: 'maven:3.6.3-jdk-8', command: 'sleep', args: 'infinity')] podTemplate(yaml: ''' apiVersion: v1 kind: Pod spec: containers: - name: maven image: maven:3.6.3-jdk-8 command: - sleep args: - infinity ''') { node(POD_LABEL) { // or, for example: git 'https://github.com/jglick/simple-maven-project-with-tests' writeFile file: 'pom.xml', text: ''' 4.0.0 sample sample 1.0-SNAPSHOT org.apache.maven.plugins maven-surefire-plugin 2.18.1 junit junit 4.12 test UTF-8 1.8 1.8 ''' writeFile file: 'src/test/java/sample/SomeTest.java', text: ''' package sample; public class SomeTest { @org.junit.Test public void checks() {} } ''' container('maven') { sh 'mvn -B -ntp -Dmaven.test.failure.ignore verify' } junit '**/target/surefire-reports/TEST-*.xml' archiveArtifacts '**/target/*.jar' } } container podTemplate(cloud: 'DevOps Kubernetes', containers: [ containerTemplate( name: 'jnlp', image: 'jenkins/inbound-agent:latest', ttyEnabled: true, privileged: false, alwaysPullImage: false, workingDir: '/home/jenkins' ) ]) { node(POD_LABEL) { stage ('run') { echo 'yes!' sh \"\"\" id whoami echo ${WORKSPACE} realpath ${WORKSPACE} \"\"\" } }} Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:14 "},"jenkins/plugins/plugins.html":{"url":"jenkins/plugins/plugins.html","title":"plugins","keywords":"","body":" Table of Contents generated with DocToc plugins recommended plugins plugins recommended plugins Artifactory Git plugin Gerrit Code Review plugin Gerrit Trigger Kubernetes Docker Commons Plugin Pipeline Pipeline Aggregator Blue Ocean Copy Artifact JUnit Plugin Build Trigger Badge Plugin Groovy Postbuild Active Directory plugin Active Choices Plug-in AnsiColor Build Timestamp Plugin Delivery Pipeline Plugin Docker Pipeline Email Extension Environment Injector Plugin Green Balls Job Configuration History Plugin Lockable Resources plugin JobFanIn Log Parser Plugin Matrix Authorization Strategy Plugin Monitoring Rebuilder ThinBackup Sectioned View Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:13 "},"jenkins/plugins/kubernetes.html":{"url":"jenkins/plugins/kubernetes.html","title":"kubernetes","keywords":"","body":" Table of Contents generated with DocToc namespace generate credentials for pfx full steps configure in jenkins using kubeconfig for remote cluster credential Q&A namespace namespace $ cat quota $ cat generate credentials for pfx ca.crt $ grep certificate-authority-data ~/.kube/config | awk -F': ' '{print $NF}' | base64 -d > ca.crt # OR $ sudo cat /etc/kubernetes/pki/ca.crt client.crt & client.key $ grep client-certificate-data ~/.kube/config | awk -F': ' '{print $NF}' | base64 -d > client.crt $ grep client-key-data ~/.kube/config | awk -F': ' '{print $NF}' | base64 -d > client.key cert.pfx $ openssl pkcs12 -export -out cert.pfx -inkey client.key -in client.crt -certfile ca.crt Enter Export Password: Verifying - Enter Export Password: $ ls ca.crt cert.pfx client.crt client.key # or # using password 'marslo' $ openssl pkcs12 -export -out cert.pfx -inkey client.key -in client.crt -certfile ca.crt -password pass:marslo full steps $ cat ~/.kube/config \\ | grep certificate-authority-data \\ | awk '{print $2}' \\ | base64 -d > ca.crt $ cat ~/.kube/config \\ | grep client-certificate-data \\ | awk '{print $2}' \\ | base64 -d > client.crt $ cat ~/.kube/config \\ | grep client-key-data \\ | awk '{print $2}' \\ | base64 -d > client.key $ openssl pkcs12 -export \\ -out cert.pfx \\ -in client.crt \\ -inkey client.key \\ -certfile ca.crt \\ -password pass:devops configure in jenkins Go to Manage Jenkins -> Configure System or Manage Jenkins -> Manage Nodes and Clouds -> Configure Clouds Add a new Cloud -> Kuberentes Name: Kubernetes URL: get from $ kubectl cluster-info using https://kubernetes.default.svc.cluster.local Kubernetes server certificate key: content of ca.crt. ($ cat ca.crt) Credentials: Add -> Jenkins Kind: Certificate Setup in Jenkins using kubeconfig for remote cluster credential reference: jenkinsci/kubernetes-cli-plugin Kubernetes Plugin: Authenticate with a ServiceAccount to a remote cluster Creating a kubeconfig file for a self-hosted Kubernetes cluster How to find your Jenkins admin password on Kubernetes get Kubernetes URL $ k config view --minify | sed -n -re 's/^.*server: (https.*)$/\\1/p' or$ k config view --minify --raw --output 'jsonpath={..cluster.server}' generate CA $ k -n jenkins get secret \\ $(k -n jenkins get sa jenkins-admin -o jsonpath={.secrets[0].name}) \\ -o jsonpath={.data.'ca\\.crt'} \\ | base64 --decode or$ cat ~/.kube/config \\ | grep certificate-authority-data \\ | awk '{print $2}' \\ | base64 -d > ca.crt Generate token in kubernetes $ namespace='devops' $ serviceAccount='jenkins-admin' $ alias k='kubectl' setup sa$ k -n jenkins create sa jenkins-admin $ k -n jenkins create rolebinding jenkins-admin-binding \\ --clusterrole=cluster-admin \\ --serviceaccount=devops:jenkins-admin get token $ k -n jenkins \\ get sa jenkins-admin \\ -o go-template \\ --template='{{range .secrets}}{{.name}}{{\"\\n\"}}{{end}}' jenkins-admin-token-kshsh $ k -n jenkins \\ get secrets jenkins-admin-token-kshsh \\ -o go-template \\ --template '{{index .data \"token\"}}' \\ | base64 -d eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.*** more info $ k get secret -n jenkins NAME TYPE DATA AGE default-token-8k7vj kubernetes.io/service-account-token 3 27m jenkins-admin-token-9r8pt kubernetes.io/service-account-token 3 21m $ k -n jenkins get rolebinding NAME AGE jenkins-admin-binding 15m $ k -n jenkins describe rolebinding jenkins-admin-binding Name: jenkins-admin-binding Labels: Annotations: Role: Kind: ClusterRole Name: cluster-admin Subjects: Kind Name Namespace ---- ---- --------- ServiceAccount jenkins-admin jenkins $ k describe clusterrolebindings jenkins-admin-cluster-binding Name: jenkins-admin-cluster-binding Labels: Annotations: Role: Kind: ClusterRole Name: cluster-admin Subjects: Kind Name Namespace ---- ---- --------- ServiceAccount jenkins-admin jenkins or$ k -n jenkins \\ get secret \\ $(k -n jenkins get sa jenkins-admin -o jsonpath={.secrets[0].name}) \\ -o jsonpath={.data.token} \\ | base64 --decode or $ k -n jenkins \\ get sa jenkins-admin \\ --template='{{range .secrets}}{{ .name }} {{end}}' \\ | xargs -n 1 k -n jenkins get secret \\ --template='{{ if .data.token }}{{ .data.token }}{{end}}' \\ | head -n 1 \\ | base64 -d - setup in Jenkins credential setup cloud setup Q&A Kubernetes agents are failing with SocketTimeoutException: connect timed out Message: pods is forbidden: User \"system:serviceaccount:jenkins:jenkins-admin\" cannot list resource \"pods\" in API group solution: lachie83/jenkins-service-account see also chukaofili/k8s-dashboard-admin-user.yaml $ k -n create rolebinding -binding \\ --clusterrole=cluster-admin \\ --serviceaccount=: $ k create clusterrolebinding jenkins-admin-cluster-binding \\ --clusterrole cluster-admin \\ --serviceaccount=:jenkins-admin thinking $ k -n jenkins auth can-i list pods --as jenkins-admin no $ k -n jenkins auth can-i list pods --as jenkins-admin-binding no $ k -n jenkins auth can-i list pods --as jenkins-admin-cluster-binding no Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:13 "},"jenkins/plugins/lockable-resource.html":{"url":"jenkins/plugins/lockable-resource.html","title":"lockable-resource","keywords":"","body":" Table of Contents generated with DocToc Lockable Resource Manager get info get all labels Get resource by label if label validated Get free number of label Get all resource add or remove remove by label (or name) create new item reserve & unlock by cli by api examples reference Lockable Resource Manager get info get all labels import org.jenkins.plugins.lockableresources.LockableResourcesManager; stage('all label') { println '~~> all labels:' println new LockableResourcesManager().getAllLabels() } Get resource by label import org.jenkins.plugins.lockableresources.LockableResourcesManager; stage('get label') { String l = 'my-label' println \"~~> resources for ${l}:\" println new LockableResourcesManager().getResourcesWithLabel(l, null) } if label validated import org.jenkins.plugins.lockableresources.LockableResourcesManager; stage('does label validated') { String l = 'my-label' println '~~> is ${l} valid:' println new LockableResourcesManager().isValidLabel(l) } Get free number of label import org.jenkins.plugins.lockableresources.LockableResourcesManager; stage('number of free') { String l = 'my-label' println new LockableResourcesManager().getFreeResourceAmount(l) } Get all resource stage('get all resoruces') { def all_lockable_resources = GlobalConfiguration.all().get(org.jenkins.plugins.lockableresources.LockableResourcesManager.class).resources println \"~~> free resource for ${l}\" println all_lockable_resources // remove all_lockable_resources.removeAll { it.name.contains('somestr')} } add or remove remove by label (or name) stage('remove') { def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() def resources = manager.getResources().findAll { // println it.locked ? \"${it} locked\" : \"${it.labels}\" ( !it.locked ) && ( it.name.equals('marslo') || it.labels.contains('marslo') || it.name.startsWith('marslo') ) } currentBuild.description = \"${resources.size()} locks\" resources.each { println \"Removing ${it.name} ~~> ${it.labels}\" manager.getResources().remove(it) } manager.save() } create new item stage('create') { def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() def myr = manager.createResourceWithLabel('marslo', 'marslo-label') } reserve & unlock by cli $ resource='marslo' $ curl -XGET -uadmin:passwd https://my.jenkins.com/lockable-resources/reserve?resource=${resource} $ curl -XGET -uadmin:passwd https://my.jenkins.com/lockable-resources/unreserve?resource=${resource} by api stage('reserve & unlock') { def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() println manager.fromName('marslo')?.isReserved() println '~~> lock marslo:' manager.reserve([ manager.fromName('marslo') ], 'Marslo Jiao') println manager.fromName('marslo')?.isReserved() println '~~> unlock marslo:' manager.reset([ manager.fromName('marslo') ]) println manager.fromName('marslo')?.isReserved() } examples print \"START\\n\" def all_lockable_resources = org.jenkins.plugins.lockableresources.LockableResourcesManager.get().resources all_lockable_resources.each { r-> if (r.isLocked() || r.isReserved()) { println \"Lock \" + r + \" is locked or reserved by \" + r.getBuild() + \" B CARSE \" + r.getLockCause() b = r.getBuild() if (b) { if (b.isBuilding()) { println \"build:\" + b + \" is building\" } if (b.getResult().equals(null)) { println \"build:\" + b + \" result is not in yet\" } if ( ! b.isBuilding() && ! b.getResult().equals(null)) { println \"build:\" + b + \" is not building and result is \" + b.getResult() + \" yet the lock \" + r + \" is locked.\" println \"ACTION RELEASE LOCK \" + r println \"getLockCause:\" + r.getLockCause() println \"getDescription:\" + r.getDescription() println \"getReservedBy:\" + r.getReservedBy() println \"isReserved:\" + r.isReserved() println \"isLocked:\" + r.isLocked() println \"isQueued:\" + r.isQueued() //release the lock r.reset() println \"getLockCause:\" + r.getLockCause() println \"getDescription:\" + r.getDescription() println \"getReservedBy:\" + r.getReservedBy() println \"isReserved:\" + r.isReserved() println \"isLocked:\" + r.isLocked() println \"isQueued:\" + r.isQueued() } } } } reference javadoc configure-lockable-resources.groovy collect-resources-data-for-graphite.groovy LockableResourcesHelper.groovy lockable_resources_from_json.groovy list_lockable_resources.groovy JenkinsJobDslCleanupLockableResources.groovy JenkinsScriptedPipelineCleanupLockableResources.groovy jenkins-remove-lockable-resources.groovy Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:13 "},"jenkins/plugins/postbuild.html":{"url":"jenkins/plugins/postbuild.html","title":"postbuild","keywords":"","body":" Table of Contents generated with DocToc Groovy Postbuild Plugin setup badge Groovy Postbuild Plugin badge-plugin setup badge setup badge from another plugins manager.addBadge(\"/plugin/artifactory/images/artifactory-promote.png\", \"promoted\") how to find it Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:13 "},"jenkins/plugins/artifactory.html":{"url":"jenkins/plugins/artifactory.html","title":"artifactory","keywords":"","body":" Table of Contents generated with DocToc allow interactive promotion promotion allow interactive promotion /** * add interactive promotion options * * @param sourceRepo the copy-from repo name * @param targetRepo the copy-to repo name * @param server Artifactory.server 'server-id' * @param buildInfo the buildInfo of {@code server} **/ def addInteractivePromotion( String sourceRepo, String targetRepo, def server, def buildInfo ) { def promotionSpec = [ //Mandatory parameters 'buildName' : buildInfo.name, 'buildNumber' : buildInfo.number, 'targetRepo' : targetRepo, //Optional parameters 'sourceRepo' : sourceRepo, 'comment' : 'promotion with interactive mode', 'status' : 'Released', 'includeDependencies': true, 'failFast' : true, 'copy' : true ] Artifactory.addInteractivePromotion server: server, promotionConfig: promotionSpec, displayName: 'promote me' } example def publish( String promoteRepo ) { server = Artifactory.server SERVER_ID uploadSpec = readFile 'jenkins-examples/pipeline-examples/resources/props-upload.json' buildInfo = server.upload spec: uploadSpec server.publishBuildInfo buildInfo if( promoteRepo ) addInteractivePromotion( \"${promoteRepo}-local\", promoteRepo, server, buildInfo ) } or for downloaddef download( String promoteRepo ) { server = Artifactory.server SERVER_ID downloadSpec = readFile 'jenkins-examples/pipeline-examples/resources/props-download.json' server.download spec: downloadSpec, buildInfo: buildInfo server.publishBuildInfo buildInfo if( promoteRepo ) addInteractivePromotion( \"${promoteRepo}-local\", promoteRepo, server, buildInfo ) } promotion Delete jenkins builds during Promote / promotion step /*** BEGIN META { \"name\" : \"Bulk Delete Builds except the given build number\", \"comment\" : \"For a given job and a given build numnber, delete all builds of a given release version (M.m.interim) only and except the user provided one. Sometimes a Jenkins job use Build Name setter plugin and same job generates 2.75.0.1 and 2.76.0.43\", \"parameters\" : [ 'jobName', 'releaseVersion', 'buildNumber' ], \"core\": \"1.409\", \"authors\" : [ { name : \"Arun Sangal - Maddys Version\" } ] } END META **/ import groovy.json.* import jenkins.model.*; import hudson.model.Fingerprint.RangeSet; import hudson.model.Job; import hudson.model.Fingerprint; //these should be passed in as arguments to the script if(!artifactoryURL) throw new Exception(\"artifactoryURL not provided\") if(!artifactoryUser) throw new Exception(\"artifactoryUser not provided\") if(!artifactoryPassword) throw new Exception(\"artifactoryPassword not provided\") def authString = \"${artifactoryUser}:${artifactoryPassword}\".getBytes().encodeBase64().toString() def artifactorySettings = [artifactoryURL: artifactoryURL, authString: authString] if(!jobName) throw new Exception(\"jobName not provided\") if(!buildNumber) throw new Exception(\"buildNumber not provided\") def lastBuildNumber = buildNumber.toInteger() - 1; def nextBuildNumber = buildNumber.toInteger() + 1; def jij = jenkins.model.Jenkins.instance.getItem(jobName); def promotedBuildRange = new Fingerprint.RangeSet() promotedBuildRange.add(buildNumber.toInteger()) def promoteBuildsList = jij.getBuilds(promotedBuildRange) assert promoteBuildsList.size() == 1 def promotedBuild = promoteBuildsList[0] // The release / version of a Jenkins job - i.e. in case you use \"Build name\" setter plugin in Jenkins for getting builds like 2.75.0.1, 2.75.0.2, .. , 2.75.0.15 etc. // and over the time, change the release/version value (2.75.0) to a newer value i.e. 2.75.1 or 2.76.0 and start builds of this new release/version from #1 onwards. def releaseVersion = promotedBuild.getDisplayName().split(\"\\\\.\")[0..2].join(\".\") println \"\" println(\"- Jenkins Job_Name: ${jobName} -- Version: ${releaseVersion} -- Keep Build Number: ${buildNumber}\"); println \"\" /** delete the indicated build and its artifacts from artifactory */ def deleteBuildFromArtifactory(String jobName, int deleteBuildNumber, Map artifactorySettings){ println \" ## Deleting >>>>>>>>>: - ${jobName}:${deleteBuildNumber} from artifactory\" def artifactSearchUri = \"api/build/${jobName}?buildNumbers=${deleteBuildNumber}&artifacts=1\" def conn = \"${artifactorySettings['artifactoryURL']}/${artifactSearchUri}\".toURL().openConnection() conn.setRequestProperty(\"Authorization\", \"Basic \" + artifactorySettings['authString']); conn.setRequestMethod(\"DELETE\") if( conn.responseCode != 200 ) { println \"Failed to delete the build artifacts from artifactory for ${jobName}/${deleteBuildNumber}: ${conn.responseCode} - ${conn.responseMessage}\" } } /** delete all builds in the indicated range that match the releaseVersion */ def deleteBuildsInRange(String buildRange, String releaseVersion, Job theJob, Map artifactorySettings){ def range = RangeSet.fromString(buildRange, true); theJob.getBuilds(range).each { if ( it.getDisplayName().find(/${releaseVersion}.*/)) { println \" ## Deleting >>>>>>>>>: \" + it.getDisplayName(); deleteBuildFromArtifactory(theJob.name, it.number, artifactorySettings) it.delete(); } } } //delete all the matching builds before the promoted build number deleteBuildsInRange(\"1-${lastBuildNumber}\", releaseVersion, jij, artifactorySettings) //delete all the matching builds after the promoted build number deleteBuildsInRange(\"${nextBuildNumber}-${jij.nextBuildNumber}\", releaseVersion, jij, artifactorySettings) println \"\" println(\"- Builds have been successfully deleted for the above mentioned release: ${releaseVersion}\") println \"\" Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:13 "},"jenkins/script/script.html":{"url":"jenkins/script/script.html","title":"script","keywords":"","body":" Table of Contents generated with DocToc Script Console usage examples jobs list all Abstract Project list all jobs and folders get name and classes find all disabled projects/jobs get particular job status get build status get all failure builds in last 24 hours list job which running for more than 24 hours shelve jobs List plugins via api simple list List plugin and dependencies scriptApproval backup & restore all scriptApproval items automatic approval all pending disable the scriptApproval abort abort a job abort running builds if new one is running cancel queue builds(https://xanderx.com/post/cancel-all-queued-jenkins-jobs/) stop all queue and running jobs Script Console usage remote access $ curl -d \"script=\" https://jenkins/script # or to get output as a plain text result (no HTML) $ curl -d \"script=\" https://jenkins/scriptText curl submitting groovy file$ curl --data-urlencode \"script=$( via api token$ curl --user 'username:api-token' --data-urlencode \\ \"script=$( via pythonwith open('somescript.groovy', 'r') as fd: data = fd.read() r = requests.post('https://jenkins/scriptText', auth=('username', 'api-token'), data={'script': data}) examples CloudBees jenkins-scripts repository Jenkins CI jenkins-scripts repository Sam Gleske’s jenkins-script-console-scripts repository Sam Gleske’s jenkins-bootstrap-shared repository Some scripts at JBoss.org jobs list all Abstract Project Abstract Project: freestyle, maven, etc... Jenkins.instance.getAllItems(AbstractProject.class).each { println it.fullName; } list all jobs and folders Jenkins.instance.getAllItems(AbstractItem.class).each { println(it.fullName) }; == result: marslo/marslo marslo/fs get name and classes Jenkins.instance.getAllItems(Job.class).each { println it.name + \" - \" + it.class } == result marslo - class org.jenkinsci.plugins.workflow.job.WorkflowJob fs - class hudson.model.FreeStyleProject find all disabled projects/jobs jenkins.model.Jenkins.instance.getAllItems(jenkins.model.ParameterizedJobMixIn.ParameterizedJob.class).findAll{ it -> it.disabled }.each { println it.fullName; } get particular job status def job = Jenkins.instance.getItemByFullName('//') println \"\"\" Last success : ${job.getLastSuccessfulBuild()} All builds : ${job.getBuilds().collect{ it.getNumber()}} Last build : ${job.getLastBuild()} Is building : ${job.isBuilding()} \"\"\" get build status String jobPattern = '/' Map> results = [:] int sum = 0 Jenkins.instance.getAllItems( Job.class ).each { project -> if ( project.fullName.contains(jobPattern) ) { results.\"$project.fullName\" = [ SUCCESS:0, UNSTABLE:0, FAILURE:0, ABORTED:0 ] def build = project.getLastBuild() while ( build ) { //println \"$project.name;$build.id;$build.result\" results.\"${project.fullName}\".\"${build.result}\" = results.\"${project.fullName}\".\"${build.result}\" + 1 build=build.getPreviousBuild() } } } results.each{ name, map -> sum = map.values().sum() println \"${name}: ${sum} : \" map.each{ r, c -> println \" ${r}: ${c}: \\tpercentage: \" + (sum ? \"${c * 100 / sum}%\" : '0%') } } \"DONE\" get all failure builds in last 24 hours import hudson.model.Job import hudson.model.Result import hudson.model.Run import java.util.Calendar import jenkins.model.Jenkins //24 hours in a day, 3600 seconds in 1 hour, 1000 milliseconds in 1 second long time_in_millis = 24*3600*1000 Calendar rightNow = Calendar.getInstance() Jenkins.instance.getAllItems(Job.class).findAll { Job job -> !job.isBuilding() }.collect { Job job -> //find all matching items and return a list but if null then return an empty list job.builds.findAll { Run run -> job.lastBuild.result == Result.FAILURE && ((rightNow.getTimeInMillis() - run.getStartTimeInMillis()) println \"${job}\" } list job which running for more than 24 hours /* We had to write this script several times. Time to have it stored, it is a very simple approach but will serve as starting point for more refined approaches. */ Jenkins.instance.getAllItems(Job).each(){ job -> job.isBuildable() if (job.isBuilding()){ def myBuild= job.getLastBuild() def runningSince= groovy.time.TimeCategory.minus( new Date(), myBuild.getTime() ) if (runningSince.hours >= 24){ println job.name +\"---- ${runningSince.hours} hours:${runningSince.minutes} minutes\" } } } return null shelve jobs //You have to install the Shelve Project Plugin on your Jenkins Master //The maximum value for daysBack is 365, going beyond 365 will break the script. import org.jvnet.hudson.plugins.shelveproject.ShelveProjectTask def daysBack=365; Jenkins.instance.getAllItems(AbstractProject.class).each{ it-> def lastBuild=it.getLastBuild() if(lastBuild != null){ def back = Calendar.getInstance() back.set(Calendar.DAY_OF_YEAR,back.get(Calendar.DAY_OF_YEAR)-daysBack) if (lastBuild.getTime().compareTo(back.getTime()) List plugins via api simple list Jenkins.instance.pluginManager.plugins.each{ plugin -> println (\"${plugin.getDisplayName()} (${plugin.getShortName()}): ${plugin.getVersion()}\") } List plugin and dependencies println \"Jenkins Instance : \" + Jenkins.getInstance().getComputer('').getHostName() + \" - \" + Jenkins.getInstance().getRootUrl() println \"Installed Plugins: \" println \"==================\" Jenkins.instance.pluginManager.plugins.sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase()}.each { plugin -> println \"${plugin.getShortName()}:${plugin.getVersion()} | ${plugin.getDisplayName()} \" } println \"\" println \"Plugins Dependency tree (...: dependencies; +++: dependants) :\" println \"=======================\" Jenkins.instance.pluginManager.plugins.sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase()}.each { plugin -> println \"${plugin.getShortName()}:${plugin.getVersion()} | ${plugin.getDisplayName()} \" println \"+++ ${plugin.getDependants()}\" println \"... ${plugin.getDependencies()}\" println '' } scriptApproval backup & restore all scriptApproval items backup import java.lang.reflect.* import jenkins.model.Jenkins import jenkins.model.* import org.jenkinsci.plugins.scriptsecurity.scripts.* import org.jenkinsci.plugins.scriptsecurity.sandbox.whitelists.* import static groovy.json.JsonOutput.* scriptApproval = ScriptApproval.get() alreadyApproved = new HashSet<>(Arrays.asList(scriptApproval.getApprovedSignatures())) println prettyPrint( toJson(alreadyApproved) ) restore def scriptApproval = org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval.get() String[] signs = [ \"method org.jenkinsci.plugins.workflow.steps.FlowInterruptedException getCauses\", \"method org.jenkinsci.plugins.workflow.support.steps.input.Rejection getUser\" ] for( String sign : signs ) { scriptApproval.approveSignature(sign) } scriptApproval.save() example import java.lang.reflect.*; import jenkins.model.Jenkins; import jenkins.model.*; import org.jenkinsci.plugins.scriptsecurity.scripts.*; import org.jenkinsci.plugins.scriptsecurity.sandbox.whitelists.*; import static groovy.json.JsonOutput.* scriptApproval = ScriptApproval.get() alreadyApproved = new HashSet<>(Arrays.asList(scriptApproval.getApprovedSignatures())) void approveSignature(String signature) { if (!alreadyApproved.contains(signature)) { scriptApproval.approveSignature(signature) } } List scriptList = ['method hudson.model.Job getLastSuccessfulBuild', 'method hudson.model.Node getNodeName'] scriptList.each { approveSignature(it) } scriptApproval.save() automatic approval all pending list pending scriptApproval import org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval ScriptApproval scriptApproval = ScriptApproval.get() scriptApproval.pendingScripts.each { scriptApproval.approveScript(it.hash) } Job DSL support for ScriptApproval import jenkins.model.Jenkins def scriptApproval = Jenkins.instance.getExtensionList('org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval')[0] def hashesToApprove = scriptApproval.pendingScripts.findAll{ it.script.startsWith(approvalPrefix) }.collect{ it.getHash() } hashesToApprove.each { scriptApproval.approveScript(it) } disable the scriptApproval file: $JENKINS_HOME/init.groovy.d/disable-script-security.groovy import javaposse.jobdsl.plugin.GlobalJobDslSecurityConfiguration import jenkins.model.GlobalConfiguration // disable Job DSL script approval GlobalConfiguration.all().get(GlobalJobDslSecurityConfiguration.class).useScriptSecurity=false GlobalConfiguration.all().get(GlobalJobDslSecurityConfiguration.class).save() abort abort a job Jenkins.instance.getItemByFullName(\"JobName\") .getBuildByNumber(JobNumber) .finish( hudson.model.Result.ABORTED, new java.io.IOException(\"Aborting build\") ); abort running builds if new one is running reference: Controlling the Flow with Stage, Lock, and Milestone I have a stuck Pipeline and I can not stop it Aborting a build Cancel queued builds and aborting executing builds using Groovy for Jenkins import hudson.model.Result import jenkins.model.CauseOfInterruption //iterate through current project runs build.getProject()._getRuns().iterator().each{ run -> def exec = run.getExecutor() //if the run is not a current build and it has executor (running) then stop it if( run!=build && exec!=null ){ //prepare the cause of interruption def cause = { \"interrupted by build #${build.getId()}\" as String } as CauseOfInterruption exec.interrupt(Result.ABORTED, cause) } } or import hudson.model.Result import hudson.model.Run import jenkins.model.CauseOfInterruption.UserInterruption def abortPreviousBuilds() { Run previousBuild = currentBuild.rawBuild.getPreviousBuildInProgress() while (previousBuild != null) { if (previousBuild.isInProgress()) { def executor = previousBuild.getExecutor() if (executor != null) { echo \">> Aborting older build #${previousBuild.number}\" executor.interrupt(Result.ABORTED, new UserInterruption( \"Aborted by newer build #${currentBuild.number}\" )) } } previousBuild = previousBuild.getPreviousBuildInProgress() } } or: cancel builds same job /* Author: Isaac S Cohen This script works with workflow to cancel other running builds for the same job Use case: many build may go to QA, but only the build that is accepted is needed, the other builds in the workflow should be aborted */ def jobname = env.JOB_NAME def buildnum = env.BUILD_NUMBER.toInteger() def job = Jenkins.instance.getItemByFullName(jobname) for (build in job.builds) { if (!build.isBuilding()) { continue; } if (buildnum == build.getNumber().toInteger()) { continue; println \"equals\" } build.doStop(); } or: Properly Stop Only Running Pipelines cancel queue builds(https://xanderx.com/post/cancel-all-queued-jenkins-jobs/) Jenkins.instance.queue.clear() stop all queue and running jobs import java.util.ArrayList import hudson.model.*; import jenkins.model.Jenkins // Remove everything which is currently queued def q = Jenkins.instance.queue for (queued in Jenkins.instance.queue.items) { q.cancel(queued.task) } // stop all the currently running jobs for (job in Jenkins.instance.items) { stopJobs(job) } def stopJobs(job) { if (job in com.cloudbees.hudson.plugins.folder.Folder) { for (child in job.items) { stopJobs(child) } } else if (job in org.jenkinsci.plugins.workflow.multibranch.WorkflowMultiBranchProject) { for (child in job.items) { stopJobs(child) } } else if (job in org.jenkinsci.plugins.workflow.job.WorkflowJob) { if (job.isBuilding()) { for (build in job.builds) { build.doKill() } } } } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:14 "},"jenkins/script/api.html":{"url":"jenkins/script/api.html","title":"api","keywords":"","body":" Table of Contents generated with DocToc execute Groovy script with an API call stop build via api get builds information list plugins using api (curl) using cli reference: Example for Jenkins API execute Groovy script with an API call $ curl -d \"script=$(cat /tmp/script.groovy)\" -v --user username:ApiToken http://JENKINS_URL/scriptText # or $ curl -d \"script=println 'this script works'\" -v --user username:ApiToken http://JENKINS_URL/scriptText stop build via api api comments BUILD_URL/stop abort a build BUILD_URL/term forcibly terminate a build BUILD_URL/kill hard kill a pipeline get builds information via job api$ curl -sSLg http://jenkins:8080/job/my-job/api/json?tree=builds[id,number,duration,timestamp,builtOn] list plugins using api (curl) $ curl -u: \\ -s https:///pluginManager/api/json?depth=1 \\ | jq -r '.plugins[] | \"\\(.shortName):\\(.version)\"' \\ | sort using cli $ cat plugin.groovy def plugins = jenkins.model.Jenkins.instance.getPluginManager().getPlugins() plugins.each {println \"${it.getShortName()}: ${it.getVersion()}\"} by jar$ curl -fsSL -O https://JENKINS_URL/jnlpJars/jenkins-cli.jar $ java -jar jenkins-cli.jar \\ [-auth :] \\ -s https://JENKINS_URL groovy = or$ java -jar jenkins-cli.jar \\ [-auth :] \\ -s https://JENKINS_URL \\ list-plugins by ssh $ ssh [-i ] [-l ] -p JENKINS_URL groovy = or $ ssh [-i ] [-l ] -p JENKINS_URL list-plugins or $ ssh [-i ] [-l ] -p JENKINS_URL groovy Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:14 "},"jenkins/script/cli.html":{"url":"jenkins/script/cli.html","title":"cli","keywords":"","body":" Table of Contents generated with DocToc setup cli get port ssh jenkins-cli.jar Execute groovy script via cli ERROR: This command is requesting the -remoting mode which is no longer supported Solution setup cli export JENKINS_URL= get port $ curl -Lv https://${JENKINS_URL}/login 2>&1 | grep -i 'x-ssh-endpoint' ssh Jenkins config ~/.ssh/config $ cat ~/.ssh/config Host my.jenkins.com User marslo IdentityFile ~/.ssh/marslo Port 32123 using cli $ ssh -q ${JENKINS_URL} help add-job-to-view Adds jobs to view. apply-configuration Apply YAML configuration to instance build Builds a job, and optionally waits until its completion. cancel-quiet-down Cancel the effect of the \"quiet-down\" command. channel-process Launch a new JVM on a slave and connect it with the master with remoting ... OR $ ssh -l -i -p ${JENKINS_URL} # example $ ssh -l marslo -i ~/.ssh/marslo -p 32123 ${JENKINS_URL} help jenkins-cli.jar get client (jenkins-cli.jar) $ curl -fsSL -O [-u:] https://${JENKINS_URL}/jnlpJars/jenkins-cli.jar # or $ curl -fsSL -O --netrc-file ~/.marslo/.netrc' https://${JENKINS_URL}/jnlpJars/jenkins-cli.jar $ cat ~/.marslo/.netrc machine login myaccount password mypassword use cli $ java -jar jenkins-cli.jar -auth : -s https://${JENKINS_URL} # example $ java -jar jenkins-cli.jar -auth marslo: -s https://${JENKINS_URL} help add-job-to-view Adds jobs to view. apply-configuration Apply YAML configuration to instance build Builds a job, and optionally waits until its completion. cancel-quiet-down Cancel the effect of the \"quiet-down\" command. ... handle -auth using directly in command line $ java -jar jenkins-cli.jar -auth marslo: -s https://${JENKINS_URL} using file $ echo 'marslo: ~/.marslo/.jenkins-cli' $ java -jar jenkins-cli.jar -auth @/Users/marslo/.marslo/.jenkins-cli -s https://${JENKINS_URL} using environment $ export JENKINS_USER_ID=marslo $ export JENKINS_API_TOKEN= $ java -jar jenkins-cli.jar -s https://${JENKINS_URL} Execute groovy script via cli ERROR: This command is requesting the -remoting mode which is no longer supported $ ssh -q groovy Solution $ ssh -q groovy = i.e.:$ ssh -q my.jenkins.com groovy Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:14 "},"jenkins/script/tricky.html":{"url":"jenkins/script/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc DSL How do I access Pipeline DSLs from inside a Groovy class? jobs Create a Permanent Agent from Groovy Console agents Monitor and Restart Offline Agents others run shell scripts in a cluster-operation get all running thread DSL How do I access Pipeline DSLs from inside a Groovy class? class C implements Serializable { def stuff(steps) { steps.node { steps.sh 'echo hello' } } } def c = new C() c.stuff(steps) orclass C implements Serializable { def stuff(script) { script.node { script.echo \"running in ${script.env.JENKINS_URL}\" } } } def c = new C() c.stuff(this) jobs Create a Permanent Agent from Groovy Console import hudson.model.* import jenkins.model.* import hudson.slaves.* import hudson.slaves.EnvironmentVariablesNodeProperty.Entry /** * INSERT \"Launch Method\" SNIPPET HERE */ // Define a \"Permanent Agent\" Slave agent = new DumbSlave( \"agent-node\", \"/home/jenkins\", launcher) agent.nodeDescription = \"Agent node description\" agent.numExecutors = 1 agent.labelString = \"agent-node-label\" agent.mode = Node.Mode.NORMAL agent.retentionStrategy = new RetentionStrategy.Always() List env = new ArrayList(); env.add(new Entry(\"key1\",\"value1\")) env.add(new Entry(\"key2\",\"value2\")) EnvironmentVariablesNodeProperty envPro = new EnvironmentVariablesNodeProperty(env); agent.getNodeProperties().add(envPro) // Create a \"Permanent Agent\" Jenkins.instance.addNode(agent) return \"Node has been created successfully.\" or:CloudBees SSH Build Agents plugin 2.0 and newer import com.cloudbees.jenkins.plugins.sshslaves.verification.* import com.cloudbees.jenkins.plugins.sshslaves.SSHConnectionDetails // Pick one of the strategies from the comments below this line ServerKeyVerificationStrategy serverKeyVerificationStrategy = new TrustInitialConnectionVerificationStrategy(false) // = new TrustInitialConnectionVerificationStrategy(false /* \"Require manual verification of initial connection\" */) // \"Manually trusted key verification Strategy\" // = new ManuallyConnectionVerificationStrategy(\"\") // \"Manually provided key verification Strategy\" // = new KnownHostsConnectionVerificationStrategy() // \"~/.ssh/known_hosts file Verification Strategy\" // = new BlindTrustConnectionVerificationStrategy() // \"Non-verifying Verification Strategy\" // Define a \"Launch method\": \"Launch agents via SSH\" ComputerLauncher launcher = new com.cloudbees.jenkins.plugins.sshslaves.SSHLauncher( \"host\", // Host new SSHConnectionDetails( \"credentialsId\", // Credentials ID 22, // port (String)null, // JavaPath (String)null, // JVM Options (String)null, // Prefix Start Agent Command (String)null, // Suffix Start Agent Command (boolean)false, // Log environment on initial connect (ServerKeyVerificationStrategy) serverKeyVerificationStrategy // Host Key Verification Strategy ) ) agents Monitor and Restart Offline Agents import hudson.node_monitors.* import hudson.slaves.* import java.util.concurrent.* jenkins = Jenkins.instance import javax.mail.internet.*; import javax.mail.* import javax.activation.* def sendMail (agent, cause) { message = agent + \" agent is down. Check http://JENKINS_HOSTNAME:JENKINS_PORT/computer/\" + agent + \"\\nBecause \" + cause subject = agent + \" agent is offline\" toAddress = \"JENKINS_ADMIN@YOUR_DOMAIN\" fromAddress = \"JENKINS@YOUR_DOMAIN\" host = \"SMTP_SERVER\" port = \"SMTP_PORT\" Properties mprops = new Properties(); mprops.setProperty(\"mail.transport.protocol\",\"smtp\"); mprops.setProperty(\"mail.host\",host); mprops.setProperty(\"mail.smtp.port\",port); Session lSession = Session.getDefaultInstance(mprops,null); MimeMessage msg = new MimeMessage(lSession); //tokenize out the recipients in case they came in as a list StringTokenizer tok = new StringTokenizer(toAddress,\";\"); ArrayList emailTos = new ArrayList(); while(tok.hasMoreElements()) { emailTos.add(new InternetAddress(tok.nextElement().toString())); } InternetAddress[] to = new InternetAddress[emailTos.size()]; to = (InternetAddress[]) emailTos.toArray(to); msg.setRecipients(MimeMessage.RecipientType.TO,to); InternetAddress fromAddr = new InternetAddress(fromAddress); msg.setFrom(fromAddr); msg.setFrom(new InternetAddress(fromAddress)); msg.setSubject(subject); msg.setText(message) Transport transporter = lSession.getTransport(\"smtp\"); transporter.connect(); transporter.send(msg); } def getEnviron(computer) { def env def thread = Thread.start(\"Getting env from ${computer.name}\", { env = computer.environment }) thread.join(2000) if (thread.isAlive()) thread.interrupt() env } def agentAccessible(computer) { getEnviron(computer)?.get('PATH') != null } def numberOfflineNodes = 0 def numberNodes = 0 for (agent in jenkins.getNodes()) { def computer = agent.computer numberNodes ++ println \"\" println \"Checking computer ${computer.name}:\" def isOK = (agentAccessible(computer) && !computer.offline) if (isOK) { println \"\\t\\tOK, got PATH back from slave ${computer.name}.\" println('\\tcomputer.isOffline: ' + slave.getComputer().isOffline()); println('\\tcomputer.isTemporarilyOffline: ' + slave.getComputer().isTemporarilyOffline()); println('\\tcomputer.getOfflineCause: ' + slave.getComputer().getOfflineCause()); println('\\tcomputer.offline: ' + computer.offline); } else { numberOfflineNodes ++ println \" ERROR: can't get PATH from agent ${computer.name}.\" println('\\tcomputer.isOffline: ' + agent.getComputer().isOffline()); println('\\tcomputer.isTemporarilyOffline: ' + agent.getComputer().isTemporarilyOffline()); println('\\tcomputer.getOfflineCause: ' + agent.getComputer().getOfflineCause()); println('\\tcomputer.offline: ' + computer.offline); sendMail(computer.name, agent.getComputer().getOfflineCause().toString()) if (agent.getComputer().isTemporarilyOffline()) { if (!agent.getComputer().getOfflineCause().toString().contains(\"Disconnected by\")) { computer.setTemporarilyOffline(false, agent.getComputer().getOfflineCause()) } } else { computer.connect(true) } } } println (\"Number of Offline Nodes: \" + numberOfflineNodes) println (\"Number of Nodes: \" + numberNodes) others run shell scripts in a cluster-operation def exec(cmd) { println cmd def process = new ProcessBuilder([ \"sh\", \"-c\", cmd]) .directory(new File(\"/tmp\")) .redirectErrorStream(true) .start() process.outputStream.close() process.inputStream.eachLine {println it} process.waitFor(); return process.exitValue() } [ \"echo hello world\", \"ls -al\" ].each { exec(it) } get all running thread Thread.getAllStackTraces().keySet().each() { println it.getName() } kill running thread or using t.stop() instead of t.interrupt() Thread.getAllStackTraces().keySet().each() { t -> if (t.getName()==\"YOUR THREAD NAME\" ) { t.interrupt(); } } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:14 "},"virtualization/virtualization.html":{"url":"virtualization/virtualization.html","title":"virtualization","keywords":"","body":"Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-10 20:28:18 "},"virtualization/kubernetes/kubernetes.html":{"url":"virtualization/kubernetes/kubernetes.html","title":"kubernetes","keywords":"","body":" Table of Contents generated with DocToc kubectl alias secrets token tear down kubectl alias __start_kubectl $ echo 'source > ~/.bashrc $ cat >> ~/.bashrc _complete_alias # download bash_completion.sh for kubectl $ curl -fsSL https://raw.githubusercontent.com/cykerway/complete-alias/master/bash_completion.sh > ~/.bash_completion.sh $ chmod +x !$ $ cat >> ~/.bashrc secrets create secrets by command $ kubectl create secret tls my-certs \\ --key .devops/certs/server.key \\ --cert .devops/certs/server.crt \\ -n ingress-nginx by yaml $ echo \"apiVersion: v1 kind: Secret type: kubernetes.io/tls metadata: name: mytest-cert namespace: ingress-nginx data: tls.crt: $(cat $HOME/.devops/certs/server.csr | base64 | tr -d '\\n') tls.key: $(cat $HOME/.devops/certs/server.key | base64 | tr -d '\\n')\" | k apply -f - duplicate secrets to the other ns reference: others Pro-Tip – Copying Kubernetes Secrets Between Namespaces $ k -n ingress-nginx get secrets my-certs -o yaml --export | k apply -n devops -f - token check token $ sudo kubeadm token list TOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPS bop765.brol9nsrw820gmbi authentication,signing system:bootstrappers:kubeadm:default-node-token khhfwa.jvkvrpiknx4o6ffy 19h 2018-07-13T11:37:43+08:00 authentication,signing system:bootstrappers:kubeadm:default-node-token generate token $ sudo kubeadm token create --print-join-command kubeadm join 192.168.1.100:6443 --token lhb1ln.oj0fqwgd1yl7l9xp --discovery-token-ca-cert-hash sha256:cba8df87dcb70c83c19af72c02e4886fcc7b0cf05319084751e6ece688443bde $ sudo kubeadm token create --print-join-command --ttl=0 kubeadm join 192.168.1.100:6443 --token bop765.brol9nsrw820gmbi --discovery-token-ca-cert-hash sha256:c8650c56faf72b8bf71c576f0d13f44c93bea2d21d4329c64bb97cba439af5c3 tear down ubuntu $ kubectl drain --delete-local-data --force --ignore-daemonsets $ kubectl delete node $ sudo kubeadm reset [preflight] Running pre-flight checks. [reset] Stopping the kubelet service. [reset] Unmounting mounted directories in \"/var/lib/kubelet\" [reset] Removing kubernetes-managed containers. [reset] Deleting contents of stateful directories: [/var/lib/kubelet /etc/cni/net.d /var/lib/dockershim /var/run/kubernetes /var/lib/etcd] [reset] Deleting contents of config directories: [/etc/kubernetes/manifests /etc/kubernetes/pki] [reset] Deleting files: [/etc/kubernetes/admin.conf /etc/kubernetes/kubelet.conf /etc/kubernetes/bootstrap-kubelet.conf /etc/kubernetes/controller-manager.conf /etc/kubernetes/scheduler.conf] $ systemctl stop kubelet $ docker system prune -a -f $ systemctl stop docker $ sudo rm -rf /etc/kubernetes/ $ sudo rm -rf /var/lib/cni/ $ sudo rm -rf /var/lib/kubelet/* $ sudo rm -rf /etc/cni/ $ sudo ifconfig cni0 down $ sudo ifconfig flannel.1 down $ rm -rf ~/.kube/ $ sudo apt purge kubeadm kubectl kubelet kubernetes-cni kube* $ sudo apt autoremove CentOS/RHEL $ kubectl drain --delete-local-data --force --ignore-daemonsets $ kubectl delete node $ sudo kubeadm reset $ docker system prune -a -f $ sudo yum versionlock delete docker-ce $ sudo yum versionlock delete docker-ce-cli $ sudo yum versionlock delete kubeadm $ sudo yum versionlock delete kubelet $ sudo yum versionlock delete kubectl $ sudo yum versionlock delete kubernetes-cni $ sudo yum remove -y docker-ce docker-ce-cli containerd.io kubectl kubeadm kubelet kubernetes-cni $ rm -rf /home/devops/.kube $ sudo rm -rf /var/log/pods/ $ sudo rm -rf /var/log/containers/ $ sudo rm -rf /etc/kubernetes/ $ sudo rm -rf /var/lib/yum/repos/x86_64/7/kubernetes $ sudo rm -rf /usr/libexec/kubernetes $ sudo rm -rf /var/cache/yum/x86_64/7/kubernetes $ sudo rm -rf /etc/systemd/system/multi-user.target.wants/kubelet.service $ sudo rm -rf /usr/lib/systemd/system/kubelet.service.d $ sudo rm -rf /var/lib/kubelet $ sudo rm -rf /usr/libexec/kubernetes $ sudo yum clean all $ sudo rm -rf /var/cache/yum $ sudo yum makecache Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:04 "},"virtualization/kubernetes/kubeadm/kubeadm.html":{"url":"virtualization/kubernetes/kubeadm/kubeadm.html","title":"kubeadm","keywords":"","body":" Table of Contents generated with DocToc Repo Sources Package Search Installation reference Repo Sources $ cat /etc/apt/sources.list deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful main restricted deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful-updates main restricted deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful universe deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful-updates universe deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful multiverse deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful-updates multiverse deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful-backports main restricted universe multiverse deb http://www.artifactory.mycompany.com/artifactory/debian-remote-canonical artful partner deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu-security artful-security main restricted deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu-security artful-security universe deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu-security artful-security multiverse $ cat sources.list.d/kubernetes.list deb http://www.artifactory.mycompany.com/artifactory/debian-remote-google kubernetes-xenial main $ cat sources.list.d/docker.list deb [arch=amd64] http://www.artifactory.mycompany.com/artifactory/debian-remote-docker artful edge # deb [arch=amd64] https://download.docker.com/linux/ubuntu artful edge Package Search $ apt-cache search kub python-magnumclient - client library for Magnum API - Python 2.x python-magnumclient-doc - client library for Magnum API - doc flannel - Etcd backed network fabric for containers golang-github-kubernetes-gengo-dev - Library for generating code based on Go files kubrick - game based on Rubik's Cube kubuntu-debug-installer - Debug package installer for Kubuntu kubuntu-debug-installer-dbg - Debug package installer for Kubuntu - debug symbols kubuntu-desktop - Kubuntu Plasma Desktop/Netbook system kubuntu-docs - kubuntu system documentation kubuntu-driver-manager - Driver Manager for Kubuntu kubuntu-driver-manager-dbg - Driver Manager for Kubuntu -- debug symbols kubuntu-full - Full Kubuntu Plasma Desktop/Netbook system kubuntu-notification-helper - Kubuntu system notification helper kubuntu-notification-helper-dbg - Kubuntu Notification Helper debugging symbols kubuntu-patched-l10n - Fake package containing absolutely nothing kubuntu-settings-desktop - Settings and artwork for the Kubuntu (Desktop) kubuntu-wallpapers-artful - Kubuntu 17.10 Wallpapers kubuntu-web-shortcuts - web shortcuts for Kubuntu, Ubuntu, Launchpad ldm-kubuntu-theme - Kubuntu theme for the LTSP Display Manager libkubuntu-dbg - library for Kubuntu platform integration - debugging files libkubuntu-dev - library for Kubuntu platform integration - development files libkubuntu1 - library for Kubuntu platform integration magnum-api - OpenStack containers as a service magnum-common - OpenStack containers as a service - API server magnum-conductor - OpenStack containers as a service - conductor mecab-jumandic - Juman dictionary compiled for Mecab (deprecated) mecab-jumandic-utf8 - Juman dictionary encoded in UTF-8 compiled for Mecab plymouth-theme-kubuntu-logo - graphical boot animation and logger - kubuntu-logo theme plymouth-theme-kubuntu-text - graphical boot animation and logger - kubuntu-text theme python-k8sclient - Kubernetes API Python client code - Python 2.7 python-k8sclient-doc - Kubernetes API Python client code - doc python-magnum - OpenStack containers as a service - Python library python3-k8sclient - Kubernetes API Python client code - Python 3.x python3-magnumclient - client library for Magnum API - Python 3.x ruby-kubeclient - client for Kubernetes REST api salt-formula-kubernetes - Salt formula for Kubernetes texlive-games - TeX Live: Games typesetting ubiquity-slideshow-kubuntu - Ubiquity slideshow for Kubuntu uck - Tool to customize official Ubuntu Live CDs unity-scope-home - Home scope that aggregates results from multiple scopes kubuntu-restricted-addons - Commonly used restricted packages for Kubuntu kubuntu-restricted-extras - Commonly used media codecs and fonts for Kubuntu kubeadm - Kubernetes Cluster Bootstrapping Tool kubectl - Kubernetes Command Line Tool kubelet - Kubernetes Node Agent kubernetes-cni - Kubernetes CNI Installation $ sudo apt install kubeadm Reading package lists... Done Building dependency tree Reading state information... Done The following additional packages will be installed: ebtables ethtool kubectl kubelet kubernetes-cni socat The following NEW packages will be installed: ebtables ethtool kubeadm kubectl kubelet kubernetes-cni socat 0 upgraded, 7 newly installed, 0 to remove and 0 not upgraded. Need to get 57.1 MB of archives. After this operation, 411 MB of additional disk space will be used. Do you want to continue? [Y/n] Get:1 http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful/main amd64 ebtables amd64 2.0.10.4-3.5ubuntu2 [80.0 kB] Get:2 http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful/main amd64 ethtool amd64 1:4.8-1 [109 kB] Get:3 http://www.artifactory.mycompany.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubernetes-cni amd64 0.6.0-00 [5,910 kB] Get:4 http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful/universe amd64 socat amd64 1.7.3.2-1 [342 kB] Get:5 http://www.artifactory.mycompany.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubelet amd64 1.10.0-00 [21.1 MB] Get:6 http://www.artifactory.mycompany.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubectl amd64 1.10.0-00 [8,905 kB] Get:7 http://www.artifactory.mycompany.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubeadm amd64 1.10.0-00 [20.7 MB] Fetched 57.1 MB in 1min 22s (697 kB/s) Selecting previously unselected package ebtables. (Reading database ... 195476 files and directories currently installed.) Preparing to unpack .../0-ebtables_2.0.10.4-3.5ubuntu2_amd64.deb ... Unpacking ebtables (2.0.10.4-3.5ubuntu2) ... Selecting previously unselected package ethtool. Preparing to unpack .../1-ethtool_1%3a4.8-1_amd64.deb ... Unpacking ethtool (1:4.8-1) ... Selecting previously unselected package kubernetes-cni. Preparing to unpack .../2-kubernetes-cni_0.6.0-00_amd64.deb ... Unpacking kubernetes-cni (0.6.0-00) ... Selecting previously unselected package socat. Preparing to unpack .../3-socat_1.7.3.2-1_amd64.deb ... Unpacking socat (1.7.3.2-1) ... Selecting previously unselected package kubelet. Preparing to unpack .../4-kubelet_1.10.0-00_amd64.deb ... Unpacking kubelet (1.10.0-00) ... Selecting previously unselected package kubectl. Preparing to unpack .../5-kubectl_1.10.0-00_amd64.deb ... Unpacking kubectl (1.10.0-00) ... Selecting previously unselected package kubeadm. Preparing to unpack .../6-kubeadm_1.10.0-00_amd64.deb ... Unpacking kubeadm (1.10.0-00) ... Setting up kubernetes-cni (0.6.0-00) ... Processing triggers for ureadahead (0.100.0-20) ... Setting up socat (1.7.3.2-1) ... Processing triggers for doc-base (0.10.7) ... Processing 1 added doc-base file... Processing triggers for systemd (234-2ubuntu12.3) ... Setting up ebtables (2.0.10.4-3.5ubuntu2) ... Created symlink /etc/systemd/system/multi-user.target.wants/ebtables.service → /lib/systemd/system/ebtables.service. update-rc.d: warning: start and stop actions are no longer supported; falling back to defaults Setting up kubectl (1.10.0-00) ... Processing triggers for man-db (2.7.6.1-2) ... Setting up ethtool (1:4.8-1) ... Setting up kubelet (1.10.0-00) ... Created symlink /etc/systemd/system/multi-user.target.wants/kubelet.service → /lib/systemd/system/kubelet.service. Setting up kubeadm (1.10.0-00) ... Processing triggers for systemd (234-2ubuntu12.3) ... Processing triggers for ureadahead (0.100.0-20) ... devops@devops-kubernetes-master:/etc/apt$ reference Kubernetes Recovery from Master Failure with Kubeadm 1 - Kubernetes Objects 2 - Kubernetes Pods 3 - Kubernetes Services and Ingress 4 - Kubernetes Storage Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:05 "},"virtualization/kubernetes/kubeadm/init.html":{"url":"virtualization/kubernetes/kubeadm/init.html","title":"init","keywords":"","body":" Table of Contents generated with DocToc certificate extend etcd certificate reference: Generate self-signed certificates Certification authority root certificate expiry and renewal Certificates CUSTOM CERTIFICATE AUTHORITY CONFIGURING ETCD RBAC Certificate Authority with CFSSL Deploy a secure etcd cluster K8S Cluster tls Certificate Management [!TIP] # hostname master01Name='master01' master02Name='master02' master03Name='master03' # ipaddress master01IP='192.168.100.200' master01IP='192.168.100.201' master01IP='192.168.100.202' virtualIP='192.168.100.250' leadIP=\"${master01IP}\" leadName=\"${master01Name}\" k8sVer='v1.15.3' cfsslDownloadUrl='https://pkg.cfssl.org/R1.2' etcdVer='v3.3.15' etcdDownloadUrl='https://github.com/etcd-io/etcd/releases/download' etcdSSLPath='/etc/etcd/ssl' etcdInitialCluster=\"${master01Name}=https://${master01IP}:2380,${master02Name}=https://${master02IP}:2380,${master03Name}=https://${master03IP}:2380\" keepaliveVer='2.0.18' haproxyVer='2.0.6' helmVer='v2.14.3' interface=$(netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}') ipAddr=$(ip a s \"${interface}\" | sed -rn 's|\\W*inet[^6]\\W*([0-9\\.]{7,15}).*$|\\1|p') peerName=$(hostname) extend etcd prepare$ sudo mkdir -p ${etcdSSLPath} $ cd ${etcdSSLPath} [!TIP] setup certificate in major master File Description ca.csr The signing request that the Root will sign ca.pem The unsigned intermediate so it’s useless, you can discard this one ca-key.pem The private key for your CA, do not lose this or share it configuration ca-config.json master01 $ sudo bash -c 'cat > ${etcdSSLPath}/ca-config.json' CA master01 $ sudo bash -c 'cat > ${etcdSSLPath}/ca-csr.json' client master01 $ sudo bash -c 'cat > ${etcdSSLPath}/client.json' generate cert for CA and Client $ cd ${etcdSSLPath} # ca $ sudo /usr/local/bin/cfssl gencert \\ -initca ca-csr.json \\ | sudo /usr/local/bin/cfssljson -bare ca - # client $ sudo /usr/local/bin/cfssl gencert \\ -ca=ca.pem \\ -ca-key=ca-key.pem \\ -config=ca-config.json \\ -profile=client client.json \\ | sudo /usr/local/bin/cfssljson -bare client resultmaster01 $ ls ca-config.json ca.csr ca-csr.json ca-key.pem ca.pem ... master01 $ ls ca-config.json ca.csr ca-csr.json ca-key.pem ca.pem client.csr client.json client-key.pem client.pem check expired time$ openssl x509 -in ca.pem -text -noout | grep -w Not Not Before: Sep 10 10:44:00 2019 GMT Not After : Sep 8 10:44:00 2024 GMT verify$ ls /etc/etcd/ssl/*.pem \\ | grep -Ev 'key.pem$' \\ | xargs -L 1 -t -i bash -c 'openssl verify -CAfile ca.pem {}' bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/ca.pem /etc/etcd/ssl/ca.pem: OK bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/client.pem /etc/etcd/ssl/client.pem: OK bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/peer.pem /etc/etcd/ssl/peer.pem: OK bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/server.pem /etc/etcd/ssl/server.pem: OK copy certs [!TIP] copy ected certificates to another masters $ for i in {2..3}; do ssh master0${i} 'sudo mkdir -p ${etcdSSLPath}' rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ ${etcdSSLPath}/*.pem \\ master0${i}:${etcdSSLPath}/ rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ ${etcdSSLPath}/ca-config.json \\ master0${i}:${etcdSSLPath}/ done Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:05 "},"virtualization/kubernetes/kubectl.html":{"url":"virtualization/kubernetes/kubectl.html","title":"kubectl","keywords":"","body":" Table of Contents generated with DocToc what is kubectl get get all get cluster status get po list list image from a single deploy list Container images by Pod list all Container images in all namespaces list Container images filtering by Pod namespace list Container images using a go-template instead of jsonpath list all quota what is kubectl get output options: -o custom-columns=:[,:]... get all $ k get all -A get cluster status $ k get cs NAME STATUS MESSAGE ERROR controller-manager Healthy ok scheduler Healthy ok etcd-1 Healthy {\"health\":\"true\"} etcd-2 Healthy {\"health\":\"true\"} etcd-0 Healthy {\"health\":\"true\"} get po name$ k -n devops get po -o custom-columns='NAME:metadata.name' or$ k -n devops get deploy jenkins -o custom-columns=\"NAME:metadata.name, IMAGES:..image\" NAME IMAGES jenkins jenkins/jenkins:2.187 list list image from a single deploy $ k -n devops get deployment jenkins -o=jsonpath='{.spec.template.spec.containers[:1].image}' jenkins/jenkins:2.187 or$ k -n devops get deploy jenkins -o jsonpath=\"{..image}\" jenkins/jenkins:2.187 list Container images by Pod $ k get pods --all-namespaces -o=jsonpath=\"{..image}\" -l app=nginx or$ k4 -n devops get po \\ -> -o custom-columns='NAME:metadata.name,IMAGES:spec.containers[*].image' list all Container images in all namespaces $ k get pods --all-namespaces -o jsonpath=\"{.items[*].spec.containers[*].image}\" or$ k get pods --all-namespaces -o jsonpath=\"{..image}\" |\\ > tr -s '[[:space:]]' '\\n' |\\ > sort |\\ > uniq -c list Container images filtering by Pod namespace $ k get pods --namespace kube-system -o jsonpath=\"{..image}\" list Container images using a go-template instead of jsonpath $ k get pods --all-namespaces -o go-template --template=\"{{range .items}}{{range .spec.containers}}{{.image}} {{end}}{{end}}\" or$ k get deployment -o=jsonpath=\"{range .items[*]}{'\\n'}{.metadata.name}{':\\t'}{range .spec.template.spec.containers[*]}{.image}{', '}{end}{end}\" list all quota $ for _i in $(k get ns --no-headers | awk -F' ' '{print $1}'); do echo ------------- ${_i} ------------ k -n ${_i} describe quota done Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:04 "},"virtualization/kubernetes/pod.html":{"url":"virtualization/kubernetes/pod.html","title":"pod","keywords":"","body":" Table of Contents generated with DocToc execute in pod list, filter and sort --field-selector --sort-by List Pods name management restart po others execute in pod $ k -n devops exec -it devops-jenkins-659f4c6d44-d2w76 -- /bin/bash jenkins@devops-jenkins-659f4c6d44-d2w76:/$ echo $HOME /var/jenkins_home jenkins@devops-jenkins-659f4c6d44-d2w76:/$ hostname devops-jenkins-659f4c6d44-d2w76 list, filter and sort --field-selector filter via Node Name$ k -n get po -o wide --field-selector spec.nodeName=master-node01 NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES devops-jenkins-659f4c6d44-d2w76 1/1 Running 0 2d22h **.***.*.** master-node01 --sort-by sort by restart count $ k -n get pods --sort-by=.status.containerStatuses[0].restartCount sort via start time $ k -n get po --sort-by=.status.startTime get the oldest pod -1: means the last in the list $ k -n get pods --sort-by=.metadata.creationTimestamp -o jsonpath='{.items[-1:].metadata.name}' sort via created time$ k -n get pods --sort-by=.metadata.creationTimestamp List Pods name Inspired from here -o name $ k -n kube-system get pods -o name | head pod/coredns-c7ddbcccb-5cj5z pod/coredns-c7ddbcccb-lxsw6 pod/coredns-c7ddbcccb-prjfk pod/etcd-node03 pod/etcd-node04 pod/etcd-node01 pod/kube-apiserver-node03 pod/kube-apiserver-node04 pod/kube-apiserver-node01 pod/kube-controller-manager-node03 --template $ k -n kube-system get pods \\ -o go-template \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' \\ | head coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 kube-controller-manager-node03 or $ k -n kube-system get pods \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' \\ | head coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 kube-controller-manager-node03 -o custom-columns=\":metadata.name\" $ k -n kube-system get pods -o custom-columns=\":metadata.name\" | head coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 jsonpath={.items..metadata.name} $ k -n kube-system get pods --output=jsonpath={.items..metadata.name} coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk ... or$ k -n kube-system get po -o jsonpath=\"{range .items[*]}{@.metadata.name}{'\\n'}{end}\" | head -10 coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 kube-controller-manager-node03 management restart po $ k -n get po -o yaml | k replace --force -f - result$ k -n get po -w NAME READY STATUS RESTARTS AGE mypo-659f4c6d44-72hb5 1/1 Running 0 47h mypo-659f4c6d44-72hb5 1/1 Terminating 0 47h mypo-659f4c6d44-d2w76 0/1 Pending 0 0s mypo-659f4c6d44-d2w76 0/1 Pending 0 0s mypo-659f4c6d44-d2w76 0/1 ContainerCreating 0 0s mypo-659f4c6d44-d2w76 1/1 Running 0 2s mypo-659f4c6d44-72hb5 0/1 Terminating 0 47h mypo-659f4c6d44-72hb5 0/1 Terminating 0 47h mypo-659f4c6d44-72hb5 0/1 Terminating 0 47h mypo-659f4c6d44-72hb5 0/1 Pending 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 1s mypo-659f4c6d44-72hb5 0/1 Terminating 0 1s or$ k -n scale deployment --replicas=0 -n service others get the first deploy name in namespace$ k -n get deploy -o=jsonpath={.items[0].metadata.name} Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:06 "},"virtualization/kubernetes/deploy.html":{"url":"virtualization/kubernetes/deploy.html","title":"deploy","keywords":"","body":" Table of Contents generated with DocToc get set update image get check origial$ k -n devops get deploy devops-jenkins -o wide NAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTOR devops-jenkins 1/1 1 1 408d devops-jenkins jenkins/jenkins:2.199 app=devops-jenkins set update image $ k -n devops set image deployments/devops-jenkins devops-jenkins=jenkins/jenkins:2.200 deployment.extensions/devops-jenkins image updated result $ k -n devops get pods -w NAME READY STATUS RESTARTS AGE devops-jenkins-54d6db68ff-bz5b6 1/1 Running 0 6d17h devops-jenkins-6bdd4fc6dd-l9spp 0/1 Pending 0 0s devops-jenkins-6bdd4fc6dd-l9spp 0/1 Pending 0 0s devops-jenkins-6bdd4fc6dd-l9spp 0/1 ContainerCreating 0 0s devops-jenkins-6bdd4fc6dd-l9spp 1/1 Running 0 8s devops-jenkins-54d6db68ff-bz5b6 1/1 Terminating 0 6d17h devops-jenkins-54d6db68ff-bz5b6 0/1 Terminating 0 6d17h devops-jenkins-54d6db68ff-bz5b6 0/1 Terminating 0 6d17h devops-jenkins-54d6db68ff-bz5b6 0/1 Terminating 0 6d17h $ k -n devops get deploy -w NAME READY UP-TO-DATE AVAILABLE AGE devops-jenkins 1/1 1 1 22d devops-jenkins 1/1 1 1 22d devops-jenkins 1/1 1 1 22d devops-jenkins 1/1 0 1 22d devops-jenkins 1/1 1 1 22d devops-jenkins 2/1 1 2 22d devops-jenkins 1/1 1 1 22d $ k -n devops get deploy devops-jenkins -o yaml --export | grep image\\: Flag --export has been deprecated, This flag is deprecated and will be removed in future. image: jenkins/jenkins:2.200 $ k -n devops get po -o custom-columns='NAME:metadata.name,IMAGES:spec.containers[*].image' NAME IMAGES devops-jenkins-6bdd4fc6dd-l9spp jenkins/jenkins:2.2000 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:05 "},"virtualization/kubernetes/certificates.html":{"url":"virtualization/kubernetes/certificates.html","title":"certificates","keywords":"","body":" Table of Contents generated with DocToc renew master check info backup renew cert renew kubeconfig Restart the master components restart kubelet service verify renew working node backup restart kubelet certificates generation pfx reference [!TIP] this for renew extend CA mode stacked CA mode can found from Certificate Management with kubeadm renew master reference: Renewing Kubernetes 1.14.x cluster certificates Renew cluster certificates Certificate Management with kubeadm kubeadm alpha check info kubernetes version $ kubectl version --short Client Version: v1.15.3 Server Version: v1.15.3 crt for kubernetes $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print \\ | egrep -v 'ca.crt$' \\ | xargs -L 1 -t -i bash -c 'openssl x509 -noout -text -in {} | grep After' bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-kubelet-client.crt | grep After Not After : Sep 16 07:51:58 2020 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver.crt | grep After Not After : Sep 16 07:51:59 2020 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/front-proxy-client.crt | grep After Not After : Sep 16 07:52:00 2020 GMT or $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print \\ | egrep -v 'ca.crt$' \\ | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' or $ ls -1 /etc/kubernetes/pki/*.crt \\ | grep -Ev 'ca.crt$' \\ | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' pem for extend etcd $ for i in ca client server peer; do echo /etc/etcd/ssl/$i.pem openssl x509 -enddate -noout -in /etc/etcd/ssl/$i.pem done /etc/etcd/ssl/ca.pem notAfter=Sep 8 10:44:00 2024 GMT /etc/etcd/ssl/client.pem notAfter=Sep 8 10:49:00 2024 GMT /etc/etcd/ssl/server.pem notAfter=Sep 8 11:03:00 2024 GMT /etc/etcd/ssl/peer.pem notAfter=Sep 8 11:03:00 2024 GMT or $ find /etc/etcd/ssl/ -type f -name '*.pem' \\ | egrep -v '*-key.pem$' \\ | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/ca.pem notAfter=Sep 8 10:44:00 2024 GMT bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/client.pem notAfter=Sep 8 10:49:00 2024 GMT bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/server.pem notAfter=Sep 8 11:03:00 2024 GMT bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/peer.pem notAfter=Sep 8 11:03:00 2024 GMT or $ ls -1 /etc/etcd/ssl/*.pem \\ | grep -Ev '\\-key.pem$' \\ | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' backup $ mkdir ~/k8s-cert-expired $ sudo cp -r /etc/kubernetes/pki ~/k8s-cert-expired/ $ sudo cp -r /etc/kubernetes/*.conf ~/k8s-cert-expired/ $ sudo cp -rp /var/lib/kubelet/pki /var/lib/kubelet/pki.orig $ sudo cp -r /var/lib/kubelet/config.yaml{,.orig} clean expired certificates /etc/kubernetes/pki $ for i in apiserver apiserver-kubelet-client front-proxy-client; do sudo mv /etc/kubernetes/pki/${i}.key{,.orig} sudo cp /etc/kubernetes/pki/${i}.crt{,.orig} done or $ for i in apiserver apiserver-kubelet-client front-proxy-client; do -> sudo rm -rf /etc/kubernetes/pki/${i}.{key,crt}; -> done kubeconfig $ for i in admin kubelet controller-manager scheduler; do sudo mv /etc/kubernetes/${i}.conf{,.orig}; done restore /etc/kuberentes/pki/*.key $ for i in apiserver apiserver-kubelet-client front-proxy-client; do for j in crt key; do sudo mv /etc/kubernetes/pki/${i}.${j}{.orig,} done done or $ for i in apiserver apiserver-kubelet-client front-proxy-client; do -> sudo cp ~/k8s-cert-expired/${i}.{key,crt} /etc/kubernetes/pki/ -> done /etc/kubernetes/*.conf $ for i in admin kubelet controller-manager scheduler; do sudo mv /etc/kubernetes/${i}.conf{.orig,} done renew cert major master major master is the master node bind with load balance ip. the key master node picked by keepalived. check it by using: ip a s \"${interface}\" | sed -rn 's|\\W*inet[^6]\\W*([0-9\\.]{7,15}).*$|\\1|p' kubeadm-conf.yaml [!NOTE] renew cert in major master certificate files path apiserver.crt apiserver.key apiserver-kubelet-client.crt apiserver-kubelet-client.key front-proxy-client.crt front-proxy-client.key /etc/kubernetes/pki $ for i in apiserver apiserver-kubelet-client front-proxy-client; do sudo kubeadm alpha certs renew ${i} done certificate for serving the Kubernetes API renewed certificate for the API server to connect to kubelet renewed certificate for the front proxy client renewed or $ for i in apiserver apiserver-kubelet-client front-proxy-client; do sudo kubeadm --config kubeadm-conf.yaml alpha certs renew ${i} done certificate for serving the Kubernetes API renewed certificate for the API server to connect to kubelet renewed certificate for the front proxy client renewed or $ for i in apiserver apiserver-kubelet-client front-proxy-client; do sudo kubeadm alpha certs renew ${i} --config=kubeadm-conf.yaml done certificate for serving the Kubernetes API renewed certificate for the API server to connect to kubelet renewed certificate for the front proxy client renewed redundant masters [!NOTE] sync renewed certificates to another masters $ leadIP= $ for pkg in '*.key' '*.crt' '*.pub'; do sudo rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ root@${leadIP}:\"/etc/kubernetes/pki/${pkg}\" \\ /etc/kubernetes/pki/ done verify $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print \\ | egrep -v 'ca.crt$' \\ | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' bash -c openssl x509 -enddate -noout -in /etc/kubernetes/pki/apiserver.crt notAfter=Sep 18 12:10:31 2021 GMT bash -c openssl x509 -enddate -noout -in /etc/kubernetes/pki/apiserver-kubelet-client.crt notAfter=Sep 18 12:10:31 2021 GMT bash -c openssl x509 -enddate -noout -in /etc/kubernetes/pki/front-proxy-client.crt notAfter=Sep 18 12:10:31 2021 GMT or $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print \\ | xargs -L 1 -t -i bash -c 'openssl x509 -in {} -noout -text |grep \"Not \"' bash -c openssl x509 -in /etc/kubernetes/pki/ca.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 14 07:51:58 2029 GMT bash -c openssl x509 -in /etc/kubernetes/pki/front-proxy-ca.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:52:00 2019 GMT Not After : Sep 14 07:52:00 2029 GMT bash -c openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 18 12:10:31 2021 GMT bash -c openssl x509 -in /etc/kubernetes/pki/apiserver-kubelet-client.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 18 12:10:31 2021 GMT bash -c openssl x509 -in /etc/kubernetes/pki/front-proxy-client.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:52:00 2019 GMT Not After : Sep 18 12:10:31 2021 GMT renew kubeconfig config files path admin.conf kubelet.conf controller-manager.conf scheduler.conf /etc/kubernetes/ $ sudo kubeadm --config kubeadm-conf.yaml init phase kubeconfig all [kubeconfig] Using kubeconfig folder \"/etc/kubernetes\" [kubeconfig] Writing \"admin.conf\" kubeconfig file [kubeconfig] Writing \"kubelet.conf\" kubeconfig file [kubeconfig] Writing \"controller-manager.conf\" kubeconfig file [kubeconfig] Writing \"scheduler.conf\" kubeconfig file setup ~/.kube/config | configuration file | path | | :- : | : - : | | config | ~/.kube | $ sudo cp /etc/kubernetes/admin.conf ~/.kube/config $ sudo chown $(id -u):$(id -g) $HOME/.kube/config $ sudo chmod 644 $HOME/.kube/config Restart the master components $ sudo kill -s SIGHUP $(pidof kube-apiserver) $ sudo kill -s SIGHUP $(pidof kube-controller-manager) $ sudo kill -s SIGHUP $(pidof kube-scheduler) or $ for i in kube-apiserver kube-controller-manager kube-scheduler; do sudo kill -s SIGHUP $(pidof ${i}) done restart kubelet service $ sudo rm -rf /var/lib/kubelet/pki/* $ sudo systemctl restart kubelet verify$ sudo systemctl status kubelet ● kubelet.service - kubelet: The Kubernetes Node Agent Loaded: loaded (/usr/lib/systemd/system/kubelet.service; enabled; vendor preset: disabled) Drop-In: /usr/lib/systemd/system/kubelet.service.d └─10-kubeadm.conf Active: active (running) since Mon 2020-09-21 04:25:33 PDT; 55s ago Docs: https://kubernetes.io/docs/ Main PID: 11891 (kubelet) Tasks: 19 Memory: 126.5M CGroup: /system.slice/kubelet.service └─11891 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/... ... verify kubernetes api (load.balance.ip.address:6443)$ echo -n \\ | openssl s_client -connect x.x.x.x:6443 2>&1 \\ | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' \\ | openssl x509 -text -noout \\ | grep Not Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 21 09:09:00 2021 GMT renew working node backup $ mkdir k8s-cert-expired $ sudo cp -rp /var/lib/kubelet/pki k8s-cert-expired/ $ sudo cp -r /var/lib/kubelet/pki{,.orig} restart kubelet sudo rm -rf /var/lib/kubelet/pki/* sudo systemctl restart kubelet sudo systemctl status kubelet.service certificates generation pfx $ cat ~/.kube/config | grep certificate-authority-data | awk '{print $2}' | base64 -d > ca.crt $ cat ~/.kube/config | grep client-certificate-data | awk '{print $2}' | base64 -d > client.crt $ cat ~/.kube/config | grep client-key-data | awk '{print $2}' | base64 -d > client.key $ openssl pkcs12 -export -out cert.pfx -inkey client.key -in client.crt -certfile ca.crt Enter Export Password: marslo Verifying - Enter Export Password: marslo $ ls ca.crt cert.pfx client.crt client.key reference Access Kubernetes API with Client Certificates Public-key cryptography and X.509 Bootstrapping Kubernetes Clusters with kubeadm PKI certificates and requirements Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:05 "},"virtualization/kubernetes/monitor.html":{"url":"virtualization/kubernetes/monitor.html","title":"monitor","keywords":"","body":" Table of Contents generated with DocToc Grafana reset password Environment Setup configure Reference Code Pool Grafana reset password $ curl -X PUT -H \"Content-Type: application/json\" -d '{ \"oldPassword\": \"admin\", \"newPassword\": \"newpass\", \"confirmNew\": \"newpass\" }' http://admin:admin@:3000/api/user/password Environment # for pvc kubems-01 ~ $ mkdir -p /opt/grafana/plugins kubems-01 ~ $ sudo chwon -R 472:472 $_ # https://grafana.com/docs/grafana/latest/installation/docker/#migration-from-a-previous-version-of-the-docker-container-to-5-1-or-later # 104:104 for version User ID changes Version User User ID grafana 104 >= 5.1 grafana 472 Setup ns $ cat sa $ cat pv & pvc $ cat deploy $ cat svc $ cat ing $ cat configure grafana-kubernetes-app $ cat ~/.kube/config | grep certificate-authority-data | awk '{print $2}' | base64 -d $ cat ~/.kube/config | grep client-certificate-data | awk '{print $2}' | base64 -d $ cat ~/.kube/config | grep client-key-data | awk '{print $2}' | base64 -d dashboard (315) Reference Scaling out Grafana with Kubernetes and AWS How To Setup Grafana On Kubernetes Monitoring Kubernetes Clusters with Grafana Code Pool kubeless/manifests/monitoring kube-prometheus/manifests kubernetes-handbook/manifests/prometheus Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:05 "},"virtualization/kubernetes/namespace.html":{"url":"virtualization/kubernetes/namespace.html","title":"namespace","keywords":"","body":" Table of Contents generated with DocToc remove stuck namespace check which item occupied the resource remove challenge.certmanager Reference remove stuck namespace check which item occupied the resource $ myns='marslo-test' $ for _i in $(kubectl api-resources --verbs=list --namespaced -o name); do echo ----- ${_i} ------ kubectl get -n ${myns} ${_i} done # result: ----- configmaps ------ No resources found. ----- endpoints ------ No resources found. ----- events ------ No resources found. ----- limitranges ------ No resources found. ----- persistentvolumeclaims ------ No resources found. ----- pods ------ No resources found. ----- podtemplates ------ No resources found. ----- replicationcontrollers ------ No resources found. ----- resourcequotas ------ No resources found. ----- secrets ------ No resources found. ----- serviceaccounts ------ No resources found. ----- services ------ No resources found. ----- controllerrevisions.apps ------ No resources found. ----- daemonsets.apps ------ No resources found. ----- deployments.apps ------ No resources found. ----- replicasets.apps ------ No resources found. ----- statefulsets.apps ------ No resources found. ----- horizontalpodautoscalers.autoscaling ------ No resources found. ----- cronjobs.batch ------ No resources found. ----- jobs.batch ------ No resources found. ----- certificaterequests.certmanager.k8s.io ------ No resources found. ----- certificates.certmanager.k8s.io ------ No resources found. ----- challenges.certmanager.k8s.io ------ NAME STATE DOMAIN AGE marslo-dashboard-2318568841-0 pending marslo-dashboard.mycompany.com 72m ----- issuers.certmanager.k8s.io ------ No resources found. ----- orders.certmanager.k8s.io ------ No resources found. ----- leases.coordination.k8s.io ------ No resources found. ----- events.events.k8s.io ------ No resources found. ----- daemonsets.extensions ------ No resources found. ----- deployments.extensions ------ No resources found. ----- ingresses.extensions ------ No resources found. ----- networkpolicies.extensions ------ No resources found. ----- replicasets.extensions ------ No resources found. ----- pods.metrics.k8s.io ------ No resources found. ----- ingresses.networking.k8s.io ------ No resources found. ----- networkpolicies.networking.k8s.io ------ No resources found. ----- poddisruptionbudgets.policy ------ No resources found. ----- rolebindings.rbac.authorization.k8s.io ------ No resources found. ----- roles.rbac.authorization.k8s.io ------ No resources found. remove challenge.certmanager $ k -n marslo-test delete challenges.certmanager.k8s.io marslo-dashboard-2318568841-0 --force --grace-period=0 warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely. challenge.certmanager.k8s.io \"marslo-dashboard-2318568841-0\" force deleted #### stuck #### $ k get ns NAME STATUS AGE cert-manager Active 103d ... marslo-test Terminating 103d ... $ k delete namespace cert-manager $ k -n marslo-test describe challenges.certmanager.k8s.io Name: marslo-dashboard-2318568841-0 Namespace: marslo-test Labels: acme.cert-manager.io/order-name=marslo-dashboard-2318568841 Annotations: API Version: certmanager.k8s.io/v1alpha1 Kind: Challenge Metadata: Creation Timestamp: 2020-01-02T13:24:46Z Deletion Grace Period Seconds: 0 Deletion Timestamp: 2020-01-02T13:26:37Z Finalizers: finalizer.acme.cert-manager.io # Please edit the object below. Lines beginning with a '#' will be ignored, Generation: 5 Owner References: API Version: certmanager.k8s.io/v1alpha1 Block Owner Deletion: true Controller: true Kind: Order Name: marslo-dashboard-2318568841 UID: 06c2cc11-fd96-473d-b672-9e7495dee3bf Resource Version: 28236617 Self Link: /apis/certmanager.k8s.io/v1alpha1/namespaces/marslo-test/challenges/marslo-dashboard-2318568841-0 UID: cc6f18e3-1035-4f9f-aa25-9fdcf2340d36 Spec: Authz URL: https://acme-v02.api.letsencrypt.org/acme/authz-v3/2065855459 Config: http01: Ingress Class: nginx Dns Name: marslo-dashboard.mycompany.com Issuer Ref: Kind: ClusterIssuer Name: marslo-cert Key: cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY.TjEqvfuHdQXjDvwPm1FMc5pU4scT3qTDs5j4qc8XAqM Token: cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY Type: http-01 URL: https://acme-v02.api.letsencrypt.org/acme/chall-v3/2065855459/raQniA Wildcard: false Status: Presented: true Processing: true Reason: Waiting for http-01 challenge propagation: failed to perform self check GET request 'http://marslo-dashboard.mycompany.com/.well-known/acme-challenge/cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY': Get http://marslo-dashboard.mycompany.com/.well-known/acme-challenge/cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY: dial tcp: lookup marslo-dashboard.mycompany.com on 10.96.0.10:53: no such host State: pending Events: ## inspired from https://github.com/jetstack/cert-manager/issues/1582#issuecomment-515354712 $ k -n marslo-test edit challenges.certmanager.k8s.io marslo-dashboard-2318568841-0 challenge.certmanager.k8s.io/marslo-dashboard-2318568841-0 edited ## manual remove the finalizer Reference deleting namespace stuck at \"Terminating\" state Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:04 "},"virtualization/kubernetes/network.html":{"url":"virtualization/kubernetes/network.html","title":"network","keywords":"","body":" Table of Contents generated with DocToc devops-kubernetes-master devops-kubernetes-02 /etc/network/interface iface eno3 inet dhcp auto eno3 iface eno3 inet static address 192.168.11.121 netmask 255.255.254.0 gateway 192.168.10.1 dns-nameservers 61.139.2.69 218.6.200.139 network info Route Details devops-kubernetes-03 devops-kubernetes-master devops-kubernetes-02 /etc/network/interface $ cat /etc/network/interfaces auto lo iface lo inet loopback auto eno1 iface eno1 inet static address 130.147.180.86 netmask 255.255.255.192 gateway 130.147.180.65 dns-nameservers 130.147.236.5 161.92.35.78 dns-search cn-132.lan.mycompany.com Click to check details $ cat /etc/network/interfaces # interfaces(5) file used by ifup(8) and ifdown(8) auto lo iface lo inet loopback auto eno1 iface eno1 inet static address 130.147.180.86 netmask 255.255.255.192 gateway 130.147.180.65 dns-nameservers 130.147.236.5 161.92.35.78 dns-search cn-132.lan.mycompany.com broadcast 130.147.219.127 network 130.147.219.0 auto eno3 # iface eno3 inet dhcp # auto eno3 # iface eno3 inet static # address 192.168.11.121 # netmask 255.255.254.0 # gateway 192.168.10.1 # dns-nameservers 61.139.2.69 218.6.200.139 network info $ nmcli [-p] d[evice] show Click to check details $ nmcli -p d show eno1 =============================================================================== Device details (eno1) =============================================================================== GENERAL.DEVICE: eno1 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8C ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 130.147.180.86/26 IP4.GATEWAY: -- IP4.ROUTE[1]: dst = 161.92.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[2]: dst = 130.145.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[3]: dst = 180.166.223.190/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[4]: dst = 185.46.212.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[5]: dst = 130.140.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[6]: dst = 130.147.236.5/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[7]: dst = 130.147.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[8]: dst = 161.91.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[9]: dst = 161.84.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[10]: dst = 169.254.0.0/16, nh = 0.0.0.0, mt = 1000 IP4.ROUTE[11]: dst = 185.166.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[12]: dst = 130.146.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[13]: dst = 137.55.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[14]: dst = 161.83.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[15]: dst = 42.99.164.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[16]: dst = 161.85.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[17]: dst = 161.92.35.78/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[18]: dst = 140.207.91.234/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[19]: dst = 161.88.0.0/16, nh = 0.0.0.0, mt = 0 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318c/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- $ nmcli -p device show eno3 =============================================================================== Device details (eno3) =============================================================================== GENERAL.DEVICE: eno3 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8E ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 192.168.11.121/23 IP4.GATEWAY: 192.168.10.1 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318e/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- $ nmcli -p device show =============================================================================== Device details (eno2) =============================================================================== GENERAL.DEVICE: eno2 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8D ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 20 (unavailable) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: off ------------------------------------------------------------------------------- =============================================================================== Device details (eno4) =============================================================================== GENERAL.DEVICE: eno4 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8F ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 20 (unavailable) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: off ------------------------------------------------------------------------------- =============================================================================== Device details (eno1) =============================================================================== GENERAL.DEVICE: eno1 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8C ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 130.147.180.86/26 IP4.GATEWAY: -- IP4.ROUTE[1]: dst = 161.92.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[2]: dst = 130.145.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[3]: dst = 180.166.223.190/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[4]: dst = 185.46.212.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[5]: dst = 130.140.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[6]: dst = 130.147.236.5/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[7]: dst = 130.147.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[8]: dst = 161.91.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[9]: dst = 161.84.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[10]: dst = 169.254.0.0/16, nh = 0.0.0.0, mt = 1000 IP4.ROUTE[11]: dst = 185.166.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[12]: dst = 130.146.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[13]: dst = 137.55.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[14]: dst = 161.83.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[15]: dst = 42.99.164.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[16]: dst = 161.85.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[17]: dst = 161.92.35.78/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[18]: dst = 140.207.91.234/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[19]: dst = 161.88.0.0/16, nh = 0.0.0.0, mt = 0 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318c/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- =============================================================================== Device details (eno3) =============================================================================== GENERAL.DEVICE: eno3 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8E ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 192.168.11.121/23 IP4.GATEWAY: 192.168.10.1 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318e/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- =============================================================================== Device details (lo) =============================================================================== GENERAL.DEVICE: lo ------------------------------------------------------------------------------- GENERAL.TYPE: loopback ------------------------------------------------------------------------------- GENERAL.HWADDR: 00:00:00:00:00:00 ------------------------------------------------------------------------------- GENERAL.MTU: 65536 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 127.0.0.1/8 IP4.GATEWAY: -- ------------------------------------------------------------------------------- IP6.ADDRESS[1]: ::1/128 IP6.GATEWAY: -- ------------------------------------------------------------------------------- Route Details $ route -n Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface 0.0.0.0 192.168.10.1 0.0.0.0 UG 100 0 0 eno3 42.99.164.34 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 130.140.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.145.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.146.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.147.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.147.180.64 0.0.0.0 255.255.255.192 U 0 0 0 eno1 130.147.236.5 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 137.55.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 140.207.91.234 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 161.83.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.84.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.85.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.88.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.91.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.92.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.92.35.78 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 169.254.0.0 0.0.0.0 255.255.0.0 U 1000 0 0 eno1 180.166.223.190 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 185.46.212.34 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 185.166.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 192.168.10.0 0.0.0.0 255.255.254.0 U 100 0 0 eno3 devops-kubernetes-03 $ ifconfig en1 en1: flags=8863 mtu 1500 ether 6c:96:cf:f2:01:0a inet6 fe80::81d:93a6:a4d4:32c2%en1 prefixlen 64 secured scopeid 0x6 inet 192.168.10.124 netmask 0xfffffe00 broadcast 192.168.11.255 nd6 options=201 media: autoselect status: active $ ifconfig en0 en0: flags=8863 mtu 1500 options=10b ether 78:7b:8a:bc:c2:3c inet6 fe80::1843:dfe3:4c35:c38%en0 prefixlen 64 secured scopeid 0x5 inet 130.147.182.248 netmask 0xfffffe00 broadcast 130.147.183.255 nd6 options=201 media: autoselect (100baseTX ) status: active $ ifconfig lo0: flags=8049 mtu 16384 options=1203 inet 127.0.0.1 netmask 0xff000000 inet6 ::1 prefixlen 128 inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 nd6 options=201 gif0: flags=8010 mtu 1280 stf0: flags=0<> mtu 1280 XHC20: flags=0<> mtu 0 en0: flags=8863 mtu 1500 options=10b ether 78:7b:8a:bc:c2:3c inet6 fe80::1843:dfe3:4c35:c38%en0 prefixlen 64 secured scopeid 0x5 inet 130.147.182.248 netmask 0xfffffe00 broadcast 130.147.183.255 nd6 options=201 media: autoselect (100baseTX ) status: active en1: flags=8863 mtu 1500 ether 6c:96:cf:f2:01:0a inet6 fe80::81d:93a6:a4d4:32c2%en1 prefixlen 64 secured scopeid 0x6 inet 192.168.10.124 netmask 0xfffffe00 broadcast 192.168.11.255 nd6 options=201 media: autoselect status: active en2: flags=8963 mtu 1500 options=60 ether 2a:00:02:31:1e:a0 media: autoselect status: inactive en3: flags=8963 mtu 1500 options=60 ether 2a:00:02:31:1e:a1 media: autoselect status: inactive bridge0: flags=8863 mtu 1500 options=63 ether 2a:00:02:31:1e:a0 Configuration: id 0:0:0:0:0:0 priority 0 hellotime 0 fwddelay 0 maxage 0 holdcnt 0 proto stp maxaddr 100 timeout 1200 root id 0:0:0:0:0:0 priority 0 ifcost 0 port 0 ipfilter disabled flags 0x2 member: en2 flags=3 ifmaxaddr 0 port 7 priority 0 path cost 0 member: en3 flags=3 ifmaxaddr 0 port 8 priority 0 path cost 0 nd6 options=201 media: status: inactive p2p0: flags=8843 mtu 2304 ether 0e:96:cf:f2:01:0a media: autoselect status: inactive awdl0: flags=8943 mtu 1484 ether 6e:66:62:10:bb:fa inet6 fe80::6c66:62ff:fe10:bbfa%awdl0 prefixlen 64 scopeid 0xb nd6 options=201 media: autoselect status: active utun0: flags=8051 mtu 2000 inet6 fe80::2c33:8275:3276:346f%utun0 prefixlen 64 scopeid 0xc nd6 options=201 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:04 "},"virtualization/kubernetes/events.html":{"url":"virtualization/kubernetes/events.html","title":"events","keywords":"","body":" Table of Contents generated with DocToc get info list all warning events get info list all warning events $ kubectl get events --field-selector type=Warning --all-namespaces --sort-by='{.lastTimestamp}' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:06 "},"virtualization/kubernetes/node.html":{"url":"virtualization/kubernetes/node.html","title":"node","keywords":"","body":" Table of Contents generated with DocToc list node with label update label of node list node with label $ k get no -l = update label of node $ k label no = [--overwrite] Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:04 "},"virtualization/docker/docker.html":{"url":"virtualization/docker/docker.html","title":"docker","keywords":"","body":" Table of Contents generated with DocToc docker completion OSX docker build docker run run into dind run to override ENTRYPOINT docker exec login docker container as root docker ps list without wrap filter format docker rmi docker rm docker completion OSX bashComp=\"$(brew --prefix)/etc/bash_completion.d\" bashComp2=\"$(brew --prefix)/etc/profile.d/bash_completion.sh\" dApp=\"/Applications/Docker.app\" dmver='0.16.2' gitcontent='https://raw.githubusercontent.com' dm=\"${gitcontent}/docker/machine/v${dmver}/contrib/completion/bash/docker-machine.bash\" curlOpt='-x 127.0.0.1:1087 -fsSL' brew install bash-completion@2 sudo curl ${curlOpt} ${dm} --output ${bashComp}/docker-machine.bash for _i in docker.bash-completion docker-compose.bash-completion; do ln -s ${dApp}/Contents/Resources/etc/${_i} ${bashComp}/${_i} done cat > ~/.bash_profile /dev/null; then # bash-completion [ -f \"${bashComp}\" ] && export BASH_COMPLETION_COMPAT_DIR=\"${bashComp}\" && source \"${bashComp}\"; # bash-completion@2 [ -f \"${bashComp2}\" ] && source \"${bashComp2}\"; fi EOF result $ complete -p d complete -F _complete_alias d $ complete -p dls complete -F _complete_alias dls # others: $ complete -p k complete -F _complete_alias k $ complete -p git complete -o bashdefault -o default -o nospace -F __git_wrap__git_main git docker build Best practices for writing Dockerfiles Create a base image Dockerfile reference $ docker build \\ --no-cache \\ --build-arg REPO= \\ --build-arg TAG=1.4-bionic \\ -t /devops/jnlp.bionic \\ -f devops-jnlp . docker run run into dind $ docker run \\ --name \"marslo\" \\ --privileged \\ --rm \\ -it \\ -v /var/run/docker.sock:/var/run/docker.sock docker:dind $ ubuntu@01acbffd94ec:~$ docker --version Docker version 18.06.1-ce, build e68fc7a run to override ENTRYPOINT $ docker run \\ --name marslo \\ -it \\ --entrypoint /bin/bash \\ docker:dind docker exec login docker container as root $ docker run -d : $ docker exec --privileged -u root -it -- /bin/bash docker ps list without wrap $ docker ps -a --no-trunc or $ curl --unix-socket /var/run/docker.sock 'http://localhost/containers/json' i.e.:$ docker ps -a --no-trunc --filter name=marslo* list full container id $ docker ps -aq --no-trunc or $ docker inspect --format=\"{{.Id}}\" d40df87b2f87 d40df87b2f87261152d2541b870c6b801c031f8df969e4bd3e9b3c607e6c1698 filter filter with image$ docker ps -a --no-trunc --filter ancestor='busybox:latest' filter with exit code$ docker ps -a --filter 'exited=0' filter with status$ docker ps --filter status=running filter with tag$ docker images --filter \"reference=*/*/*/*:1.4-bionic-dind\" format id and command $ docker ps --no-trunc --format \"{{.ID}}: {{.Command}}\" id, image and commands $ docker ps --no-trunc --format \"{{.ID}}: {{.Command}}: {{.Image}}\" log path HOW TO REDIRECT DOCKER LOGS TO A SINGLE FILE $ docker inspect --format='{{.LogPath}}' containername with table $ docker ps --format \"table {{.Image}}\\t{{.Names}}\\t{{.Ports}}\\t{{.Status}}\" docker rmi remove via docker image $ docker rmi -f $(docker images \"*/*/*/myimage\" --format \"{{.ID}}\") or $ docker images \"*/*/*/myimage\" --format \"{{.ID}}\" | xargs docker rmi -f remove tag images $ docker images -q -f \"dangling=true\" | xargs docker rmi -f --no-trunc or $ docker image prune --filter=\"dangling=true\" docker rm remove all stopped container $ docker ps --filter \"status=exited\" --format '{{.ID}}' | xargs docker rm -f or$ docker rm $(docker ps -aq --filter \"status=exited\") Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:04 "},"virtualization/docker/tricky.html":{"url":"virtualization/docker/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc command-line auto completion Linux osx others complete_alias get tags from docker hub simple script for get tags get current container ID get volume from container ID mount volume in DinD command-line auto completion reference: Enable Docker command-line auto completion in bash on Centos/Ubuntu completion/bash/docker Perform tab-completion for aliases in Bash Linux $ dpkg -L docker-ce-cli |grep completion /usr/share/bash-completion /usr/share/bash-completion/completions /usr/share/bash-completion/completions/docker /usr/share/fish/vendor_completions.d /usr/share/fish/vendor_completions.d/docker.fish /usr/share/zsh/vendor-completions /usr/share/zsh/vendor-completions/_docker rpm$ rpm -ql docker-ce | grep completion /usr/share/bash-completion/completions/docker /usr/share/fish/vendor_completions.d/docker.fish /usr/share/zsh/vendor-completions/_docker setup in bashrc source /usr/share/bash-completion/completions/docker alias d='docker' alias dp='docker ps' while read -r _i; do complete -F _docker \"${_i}\" done more info$ source /usr/share/bash-completion/completions/docker $ type _docker | head _docker is a function _docker () { local previous_extglob_setting=$(shopt -p extglob); shopt -s extglob; osx $ la '/Applications/Docker.app/Contents/Resources/etc' total 332K -rwxr-xr-x 1 marslo admin 124K Nov 9 21:50 docker.zsh-completion -rwxr-xr-x 1 marslo admin 51K Nov 9 21:50 docker.fish-completion -rwxr-xr-x 1 marslo admin 114K Nov 9 21:50 docker.bash-completion -rw-r--r-- 1 marslo admin 18K Nov 9 21:50 docker-compose.zsh-completion -rw-r--r-- 1 marslo admin 1.7K Nov 9 21:50 docker-compose.fish-completion -rwxr-xr-x 1 marslo admin 13K Nov 9 21:50 docker-compose.bash-completion $ ln -sf '/Applications/Docker.app/Contents/Resources/etc/docker.bash-completion' $(brew --prefix)/etc/bash_completion.d/docker $ ln -sf '/Applications/Docker.app/Contents/Resources/etc/docker-compose.bash-completion' $(brew --prefix)/etc/bash_completion.d/docker-compose setup in bashrc dockerComp=\"$(brew --prefix)/etc/bash_completion.d/docker\" dockerComposeComp=\"$(brew --prefix)/etc/bash_completion.d/docker-compose\" [ -f \"${dockerComp}\" ] && source \"${dockerComp}\" [ -f \"${dockerComposeComp}\" ] && source \"${dockerComposeComp}\" alias d='docker' alias dp='docker ps' alias dls='docker ps -l -q' alias dps='docker ps -l -a' alias di='docker images' alias dip=\"docker inspect --format '{{ .NetworkSettings.IPAddress }}'\" while read -r _i; do complete -F _docker \"${_i}\" done others _completion_loader_completion_loader() { . \"/etc/bash_completion.d/$1.sh\" >/dev/null 2>&1 && return 124 } complete -D -F _completion_loader complete_alias # for Linux $ sudo curl -sSLg https://raw.githubusercontent.com/cykerway/complete-alias/master/complete_alias \\ -o /etc/bash_completion.d/complete_alias # for osx $ sudo curl -sSLg https://raw.githubusercontent.com/cykerway/complete-alias/master/complete_alias \\ -o $(brew --prefix)/etc/bash_completion.d/complete_alias setup in bash source /etc/bash_completion.d/complete_alias # source $(brew --prefix)/etc/bash_completion.d/complete_alias while read -r _i; do complete -F _complete_alias \"${_i}\" done get tags from docker hub $ curl -sS 'https://hub.docker.com/v2/repositories/jenkins/jenkins/tags' \\ | jq --raw-output .results[].name jdk8-openj9-windowsservercore-1809 jdk11-hotspot-windowsservercore-1809 jdk11-openj9-windowsservercore-1809 windowsservercore-1809 jdk8-hotspot-windowsservercore-1809 2.249.3-lts-centos7 lts-centos7 centos7 2.249.3-lts-centos lts-centos get more$ curl -sS 'https://hub.docker.com/v2/repositories/jenkins/jenkins/tags?page_size=100&ordering=last_updated' \\ | jq --raw-output .results[].name | sort or$ curl -sS https://hub.docker.com/v2/repositories/jenkins/jenkins/tags?page=2 \\ | jq '.\"results\"[][\"name\"]' \\ | sort simple script for get tags #!/bin/sh # # Simple script that will display docker repository tags. # # Usage: # $ docker-show-repo-tags.sh ubuntu centos for _r in $* ; do curl -s -S \"https://registry.hub.docker.com/v2/repositories/library/$_r/tags/\" | \\ sed -e 's/,/,\\n/g' -e 's/\\[/\\[\\n/g' | \\ grep '\"name\"' | \\ awk -F\\\" '{print $4;}' | \\ sort -fu | \\ sed -e \"s/^/${_r}:/\" done get current container ID $ basename $(cat /proc/self/cpuset) ab8c1732f1a3fdb46b9f9a477f0fbcc1d23c6787d7532648242a76d6eb1e8b84 or$ hostname ab8c1732f1a3 get volume from container ID $ docker inspect -f '{{ .Mounts }}' or $ docker inspect | grep volume or get all $ docker ps -a --no-trunc --format \"{{.ID}}\\t{{.Names}}\\t{{.Mounts}}\" or$ docker inspect | jq --raw-output .[].Mounts or $ docker ps -q | xargs docker container inspect -f '{{ .Name }} {{ .HostConfig.Binds }}' mount volume in DinD reference: Mounting Volumes in Sibling Containers with Gitlab CI Mount volumes from container (--volumes-from) Kubernetes emptyDir is not the same as Docker's volumes-from $ cid=$(basename $(cat /proc/self/cpuset)) $ VOLUME_OPTION=\"--volumes-from ${cid}:rw\" $ docker run ${VOLUME_OPTION} Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:04 "},"osx/osx.html":{"url":"osx/osx.html","title":"osx","keywords":"","body":" Table of Contents generated with DocToc xcode downlaod xcode by wget Appendix accpet license from cmd commandline tools and compoents enable dev mode system info system setup hostname disable guest user System Integrity Protection app java xcode downlaod xcode by wget get cookies.txt install google chrome extension from official website login developer.apple.com select cookies.txt and download get xcode download url and right click and select Copy Link Address: download xcode (inspired from here and here) $ wget --cookies=on \\ --load-cookies=cookies.txt \\ --keep-session-cookies \\ --save-cookies=cookies.txt \\ https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip exmaple $ wget --cookies=on \\ > --load-cookies=cookies.txt \\ > --keep-session-cookies \\ > --save-cookies=cookies.txt \\ > https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip --2019-10-15 07:55:18-- https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip Resolving download.developer.apple.com (download.developer.apple.com)... 17.253.17.207, 17.253.17.211 Connecting to download.developer.apple.com (download.developer.apple.com)|17.253.17.207|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 7805079698 (7.3G) [application/octet-stream] Saving to: ‘Xcode_11.2_beta_2.xip’ 100%[===========================================================================================================>] 7,805,079,698 112MB/s in 70s 2019-10-15 07:53:07 (106 MB/s) - ‘Xcode_11.2_beta_2.xip’ saved [7805079698/7805079698] $ ls -altrh Xcode_11.2_beta_2.xip -rw-rw-r-- 1 devops devops 7.3G Oct 9 13:27 Xcode_11.2_beta_2.xip Appendix xcode xcode url 12.3 beta https://download.developer.apple.com/Developer_Tools/Xcode_12.3_beta/Xcode_12.3_beta.xip 12.2 https://download.developer.apple.com/Developer_Tools/Xcode_12.2/Xcode_12.2.xip 12.2beta2 https://download.developer.apple.com/Developer_Tools/Xcode_12.2_beta_2/Xcode_12.2_beta_2.xip 12.0.1 https://download.developer.apple.com/Developer_Tools/Xcode_12.0.1/Xcode_12.0.1.xip 12 beta 5 https://download.developer.apple.com/Developer_Tools/Xcode_12_beta_5/Xcode_12_beta_5.xip 11.6 https://download.developer.apple.com/Developer_Tools/Xcode_11.6/Xcode_11.6.xip 11.5 beta 2 https://download.developer.apple.com/Developer_Tools/Xcode_11.5_beta_2/Xcode_11.5_beta_2.xip 11.5 beta https://download.developer.apple.com/Developer_Tools/Xcode_11.5_beta/Xcode_11.5_beta.xip 11.4.1 https://download.developer.apple.com/Developer_Tools/Xcode_11.4.1/Xcode_11.4.1.xip 11.4 https://download.developer.apple.com/Developer_Tools/Xcode_11.4/Xcode_11.4.xip 11.4 beta 3 https://download.developer.apple.com/Developer_Tools/Xcode_11.4_beta_3/Xcode_11.4_beta_3.xip 11.4 beta 2 https://download.developer.apple.com/Developer_Tools/Xcode_11.4_beta_2/Xcode_11.4_beta_2.xip 11.4 beta https://download.developer.apple.com/Developer_Tools/Xcode_11.4_beta/Xcode_11.4_beta.xip 11.3.1 https://download.developer.apple.com/Developer_Tools/Xcode_11.3.1/Xcode_11.3.1.xip 11.2 beta 2 https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip 11.1 https://download.developer.apple.com/Developer_Tools/Xcode_11.1/Xcode_11.1.xip 11.2 beta https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta/Xcode_11.2_beta.xip 11 https://download.developer.apple.com/Developer_Tools/Xcode_11/Xcode_11.xip 10.3 https://download.developer.apple.com/Developer_Tools/Xcode_10.3/Xcode_10.3.xip 10.2.1 https://download.developer.apple.com/Developer_Tools/Xcode_10.2.1/Xcode_10.2.1.xip 10.2 https://download.developer.apple.com/Developer_Tools/Xcode_10.2/Xcode_10.2.xip 10.1 https://download.developer.apple.com/Developer_Tools/Xcode_10.1/Xcode_10.1.xip command line tool command line tool url 12.3 beta https://download.developer.apple.com/Developer_Tools/Xcode_12.3_beta/Xcode_12.3_beta.xip 12.2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_12.2/Command_Line_Tools_for_Xcode_12.2.dmg 12.0 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_12/Command_Line_Tools_for_Xcode_12.dmg 11.4.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4.1/Command_Line_Tools_for_Xcode_11.4.1.dmg 11.4 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4/Command_Line_Tools_for_Xcode_11.4.dmg 11.4 beta 3 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4_beta_3/Command_Line_Tools_for_Xcode_11.4_beta_3.dmg 11.4 beta 2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4_beta_2/Command_Line_Tools_for_Xcode_11.4_beta_2.dmg 11.3.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.3.1/Command_Line_Tools_for_Xcode_11.3.1.dmg 11.2 beta 2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.2_beta_2/Command_Line_Tools_for_Xcode_11.2_beta_2.dmg 11.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.2_beta/Command_Line_Tools_for_Xcode_11.2_beta.dmg 11 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11/Command_Line_Tools_for_Xcode_11.dmg 10.3 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.3/Command_Line_Tools_macOS_10.14_for_Xcode_10.3.dmg 10.2.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.2.1.dmg/Command_Line_Tools_macOS_10.14_for_Xcode_10.2.1.dmg 10.2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.2/Command_Line_Tools_macOS_10.14_for_Xcode_10.2.dmg 10.1 for macOS 10.14 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.1/Command_Line_Tools_macOS_10.14_for_Xcode_10.1.dmg 10.1 for macOS 10.13 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.13_for_Xcode_10.1/Command_Line_Tools_macOS_10.13_for_Xcode_10.1.dmg additional tools additional tool url 11.4 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_11.4/Additional_Tools_for_Xcode_11.4.dmg 11.4 beta 2 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_11.4_beta_2/Additional_Tools_for_Xcode_11.4_beta_2.dmg 11 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_11/Additional_Tools_for_Xcode_11.dmg 10.1 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_10.1/Additional_Tools_for_Xcode_10.1.dmg additional info accpet license from cmd $ sudo xcodebuild -license accept commandline tools and compoents installation $ xcode-select -p $ for pkg in /Applications/Xcode.app/Contents/Resources/Packages/*.pkg; do sudo installer -pkg \"$pkg\" -target /; done upgrade $ softwareupdate --all --install --force or $ sudo rm -rf /Library/Developer/CommandLineTools $ sudo xcode-select --install more details $ defaults read /Library/Preferences/com.apple.SoftwareUpdate { AutomaticallyInstallMacOSUpdates = 1; LastAttemptBuildVersion = \"10.15.7 (19H2)\"; LastAttemptSystemVersion = \"10.15.7 (19H2)\"; LastBackgroundSuccessfulDate = \"2020-10-10 06:15:40 +0000\"; LastCatalogChangeDate = \"2020-10-10 14:13:29 +0000\"; LastFullSuccessfulDate = \"2020-10-10 14:14:38 +0000\"; LastRecommendedMajorOSBundleIdentifier = \"\"; LastRecommendedUpdatesAvailable = 0; LastResultCode = 2; LastSessionSuccessful = 1; LastSuccessfulDate = \"2020-10-10 14:14:38 +0000\"; LastUpdatesAvailable = 0; PrimaryLanguages = ( \"en-CN\", en ); RecommendedUpdates = ( ); SkipLocalCDN = 0; } enable dev mode $ DevToolsSecurity -enable system info production version $ sw_vers ProductName: Mac OS X ProductVersion: 10.15 BuildVersion: 19A602 or$ /usr/libexec/PlistBuddy -c \"Print:ProductName\" \\ -> -c \"Print:ProductVersion\" \\ -> -c \"Print:ProductBuildVersion\" /System/Library/CoreServices/SystemVersion.plist macOS 11.0.1 20B29 hardware $ /usr/sbin/system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Name: MacBook Pro Model Identifier: MacBookPro15,1 Processor Name: 6-Core Intel Core i7 Processor Speed: 2.2 GHz Number of Processors: 1 Total Number of Cores: 6 L2 Cache (per Core): 256 KB L3 Cache: 9 MB Hyper-Threading Technology: Enabled Memory: 16 GB Boot ROM Version: 1037.0.78.0.0 (iBridge: 17.16.10572.0.0,0) Serial Number (system): C02XFGWEJG5H Hardware UUID: 4EA008BF-9B36-5F1D-9151-AD4F64808AAB Activation Lock Status: Enabled $ system_profiler SPCameraDataType Camera: FaceTime HD Camera (Built-in): Model ID: UVC Camera VendorID_1452 ProductID_34068 Unique ID: 0x8020000005ac8514 cpu $ sysctl -n machdep.cpu.brand_string Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz or$ sysctl machdep.cpu machdep.cpu.max_basic: 22 machdep.cpu.max_ext: 2147483656 machdep.cpu.vendor: GenuineIntel machdep.cpu.brand_string: Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz machdep.cpu.family: 6 machdep.cpu.model: 158 ... system setup hostname $ sudo scutil --set HostName [HOSTNAME] $ sudo scutil --set LocalHostName [HOSTNAME] # Optional $ sudo scutil --set ComputerName [HOSTNAME] # Flush the DNS Cache $ dscacheutil -flushcache $ sudo shutdown -r now disable guest user $ dscl . delete /Users/Guest $ sudo defaults write /Library/Preferences/com.apple.AppleFileServer guestAccess -bool NO $ sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server AllowGuestAccess -bool NO System Integrity Protection $ csrutil disable Successfully disabled System Integrity Protection. Please restart the machine for the changes to take effect. $ csrutil clear Successfully cleared System Integrity Proteciton. Please restart the machine for the changes to take effect. $ sudo chflags restricted /usr/local turn off the Rootless System Integrity Protection $ csrutil status System Integrity Protection status: enabled. $ sudo csrutil disable csrutil: failed to modify system integrity configuration. This tool needs to be executed from the Recovery OS reboot and command + r go to Utilities -> Terminal disable -bash-3.2# csrutil status System Integrity Protection status: enabled -bash-3.2# csrutil disable Successfully disabled System Integrity Protection. Please restart the machine for the changes to take effect. Remove file lock (uchg) flag $ chflags -R nouchg * # or $ chflags -R nouchg example $ find /usr -flags +sunlnk -print /usr/libexec/cups find: /usr/sbin/authserver: Permission denied /usr/local /usr/share/man /usr/share/snmp $ /bin/ls -lO /usr total 0 drwxr-xr-x 976 root wheel restricted 31232 Oct 28 19:17 bin/ drwxr-xr-x 292 root wheel restricted 9344 Oct 28 10:04 lib/ drwxr-xr-x 234 root wheel restricted 7488 Oct 28 19:17 libexec/ drwxr-xr-x 16 root wheel sunlnk 512 Oct 28 19:26 local/ drwxr-xr-x 246 root wheel restricted 7872 Oct 28 09:55 sbin/ drwxr-xr-x 46 root wheel restricted 1472 Oct 28 09:55 share/ drwxr-xr-x 5 root wheel restricted 160 Oct 3 13:48 standalone/ $ csrutil status System Integrity Protection status: enabled. $ sudo csrutil disable csrutil: failed to modify system integrity configuration. This tool needs to be executed from the Recovery OS $ cat /System/Library/Sandbox/rootless.conf $ /bin/ls -lO /Applications | grep firefox 22:drwxr-xr-x 3 marslo staff - 96 Dec 7 03:14 Firefox.app $ sudo chflags restricted Firefox.app $ /bin/ls -lO /Applications | grep firefox drwxr-xr-x 3 marslo staff restricted 96 Dec 7 03:14 Firefox.app app java setup java home$ /usr/libexec/java_home -v 1.8.0.162 -exec javac -versioin Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:06 "},"osx/defaults.html":{"url":"osx/defaults.html","title":"defaults","keywords":"","body":" Table of Contents generated with DocToc change Mac default settings Enable Key Repeat Disable the .DS_Store file Enable the Hidden file Reset iTerm Profile Dock performance setup Safari Font Size Disable Spotlight Disable Notification Center Disable the download apps security Disable the dashboard change Mac default settings Enable Key Repeat $ defaults write -g ApplePressAndHoldEnabled -bool false Restore to Default$ defaults delete -g ApplePressAndHoldEnabled Disable the .DS_Store file $ defaults write com.apple.desktopservices DSDontWriteNetworkStores true Enable the .DS_Store$ defaults write com.apple.desktopservices DSDontWriteNetworkStores false Enable the Hidden file $ defaults write com.apple.finder AppleShowAllFiles TRUE; killall Finder # OR $ defaults write com.apple.finder AppleShowAllFiles YES Reset iTerm Profile $ cd ~/Library/Preferences/com.googlecode.iterm2.plist $ defaults delete com.googlecode.iterm2 Dock performance setup Minize Windows Using \"suck\" mode $ defaults write com.apple.dock mineffect suck; Killall Dock Restore to Default:System Preferences -> Dock -> Minized Windows Using Highlight icon $ defaults write com.apple.dock mouse-over-hilite-stack -bool TRUE;killall Dock Restore to Default:$ defaults delete com.apple.dock mouse-over-hilite-stack;killall Dock Remove none-opened apps $ defaults write com.apple.dock static-only -boolean true; killall Dock Restore to Default:$ defaults delete com.apple.dock static-only; killall Dock Hidden icon $ defaults write com.apple.dock showhidden -bool true; Killall Dock Restore to Default$ defaults delete com.apple.Dock showhidden; Killall Dock Safari Font Size $ defaults write com.apple.Safari com.apple.Safari.ContentPageGroupIdentifier.WebKit2MinimumFontSize -int 14 Disable Spotlight $ sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist Reenable Spotlight$ sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist Disable Notification Center $ launchctl unload -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist $ killall NotificationCenter Reenable Notifaction Center$ launchctl load -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist Disable the download apps security $ defaults write com.apple.LaunchServices LSQuarantine -bool NO Reenable the download apps security$ defaults write com.apple.LaunchServices LSQuarantine -bool YES Disable the dashboard $ defaults write com.apple.dashboard mcx-disabled -boolean YES && killall Dock re-enable the dashboard$ defaults write com.apple.dashboard mcx-disabled -boolean NO && killall Dock Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:06 "},"osx/apps.html":{"url":"osx/apps.html","title":"apps","keywords":"","body":" Table of Contents generated with DocToc Homebrew Homebrew Installation Homebrew Caskroom Installation Package Installation check formula config files brew debug tricky system settings accessory iTerm2 BackgroundMusic Mac CLI Others Homebrew Homebrew Installation $ /usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\" Homebrew Caskroom Installation $ brew tap caskroom/versions $ brew cask outdated $ brew tap buo/cask-upgrade $ brew update $ brew cu --all home brew cask upgrade $ brew cu -a -y -f ==> Options Include auto-update (-a): true Include latest (-f): true ==> Updating Homebrew Already up-to-date. ==> Finding outdated apps Cask Current Latest A/U Result 1/10 alfred 3.5.1_883 3.5.1_883 Y [ OK ] 2/10 android-sdk 3859397,26.0.2 3859397,26.0.2 [ OK ] 3/10 dash 4.1.1 4.1.1 Y [ OK ] 4/10 etcher 1.2.1 1.2.1 [ OK ] 5/10 firefox 57.0.2 57.0.2 Y [ OK ] 6/10 imageoptim 1.7.3 1.7.3 Y [ OK ] 7/10 iterm2-beta 3.1.5.beta.1 3.1.5.beta.2 Y [ FORCED ] 8/10 java8 1.8.0_152-b16,aa0333dd3019491ca4f6ddbe78cdb6d0 1.8.0_152-b16,aa0333dd3019491ca4f6ddbe78cdb6d0 [ OK ] 9/10 little-snitch 4.0.4 4.0.4 Y [ OK ] 10/10 mounty latest latest [ OK ] ==> Found outdated apps Cask Current Latest A/U Result 1/1 iterm2-beta 3.1.5.beta.1 3.1.5.beta.2 Y [ FORCED ] ==> Upgrading iterm2-beta to 3.1.5.beta.2 ==> Satisfying dependencies ==> Downloading https://iterm2.com/downloads/beta/iTerm2-3_1_5_beta_2.zip ######################################################################## 100.0% ==> Verifying checksum for Cask iterm2-beta ==> Installing Cask iterm2-beta Warning: It seems there is already an App at '/Applications/iTerm.app'; overwriting. ==> Removing App '/Applications/iTerm.app'. ==> Moving App 'iTerm.app' to '/Applications/iTerm.app'. 🍺 iterm2-beta was successfully installed! or$ brew upgrade --cask --greedy Package Installation reference: Homebrew Formulae - macvim MacVim more on mytools/osx/belloMyOSX systemlist=\"imagemagick coreutils bash proctools pstree vnstat ncdu ipcalc htop ack lsof\" regularlist=\"wget tmux corkscrew tig ifstat binutils diffutils gawk gnutls gzip less file-formula stow telnet iproute2mac ctags jshon colordiff tree vifm p7zip git mas htop watch jfrog-cli-go youtube-dl etcd mas figlet screenfetch glances bash-completion@2 dos2unix nmap rename renameutils pipenv inetutils hadolint\" regularheadlist=\"shellcheck bats jq gradle-completion git-flow\" gnulist=\"gnu-sed gnu-tar gnu-which grep ed findutils gnu-indent\" # utils $ brew install imagemagick coreutils moreutils bash proctools pstree vnstat ncdu ipcalc htop ack lsof $ brew install wget tmux corkscrew telnet figlet $ brew install gnu-sed --with-default-names $ brew install stow iproute2mac pandoc $ brew install macvim $ brew install wdiff --with-gettext $ brew install less --with-pcre deprecated (macvim) $ brew install macvim --with-override-system-vim --HEAD # OR $ brew tap macvim-dev/macvim $ brew install --HEAD macvim-dev/macvim/macvim $ brew linkapps macvim # OR $ brew linkapps # OR $ HOME_APPS = File.expand_path(\"/Applications\") # OR (Using none-link Info.plist and PkgInfo in *.app/Contents/) $ mkdir -p /Applications/gVim.app/Contents $ ln -sf /usr/local/Cellar/macvim/HEAD-a5e0355/gVim.app/Contents/* /Applications/gVim.app/Contents/ $ mv /Applications/gVim.app/Contents/Info.plist{,.link} $ mv /Applications/gVim.app/Contents/PkgInfo{,.link} $ cp /Applications/gVim.app/Contents/Info.plist{.link,} $ cp /Applications/gVim.app/Contents/PkgInfo{.link,} brew upgrade ignore specific formulas Ignore formula on brew upgrade $ brew pin macvim $ brew list --pinned macvim $ brew upgrade Updating Homebrew... Error: Not upgrading 1 pinned package: macvim HEAD-caf7642_1 ==> Upgrading 6 outdated packages: ghostscript 9.53.2 -> 9.53.3 groovy 3.0.5 -> 3.0.6 node 14.12.0 -> 14.13.1 unbound 1.11.0 -> 1.12.0 nmap 7.80_1 -> 7.90 imagemagick 7.0.10-31 -> 7.0.10-34 ... unpin$ brew unpin macvim $ brew list --pinned Spotlight Error $ xattr -dr com.apple.quarantine MacVim.app $ osascript -e 'tell application \"Finder\" to make alias file to POSIX file \"/usr/local/opt/macvim/MacVim.app\" at POSIX file \"/Applications\"' Warning $ brew linkapps macvim Warning: `brew linkapps` has been deprecated and will eventually be removed! Unfortunately `brew linkapps` cannot behave nicely with e.g. Spotlight using either aliases or symlinks and Homebrew formulae do not build \"proper\" `.app` bundles that can be relocated. Instead, please consider using `brew cask` and migrate formulae using `.app`s to casks. Linking: /usr/local/opt/macvim/MacVim.app Linked 1 app to /Applications macvim build install from sourcode $ brew install --HEAD macvim-dev/macvim/macvim ==> Installing macvim from macvim-dev/macvim ==> Installing dependencies for macvim-dev/macvim/macvim: python3, lua ==> Installing macvim-dev/macvim/macvim dependency: python3 ==> Downloading https://homebrew.bintray.com/bottles/python3-3.6.3.high_sierra.bottle.tar.gz ==> Pouring python3-3.6.3.high_sierra.bottle.tar.gz You can try again using `brew postinstall python3` ==> Caveats Pip, setuptools, and wheel have been installed. To update them pip3 install --upgrade pip setuptools wheel You can install Python packages with pip3 install They will install into the site-package directory /usr/local/lib/python3.6/site-packages See: https://docs.brew.sh/Homebrew-and-Python.html ==> Summary 🍺 /usr/local/Cellar/python3/3.6.3: 3,009 files, 48MB ==> Installing macvim-dev/macvim/macvim dependency: lua ==> Downloading https://homebrew.bintray.com/bottles/lua-5.3.4_2.high_sierra.bottle.tar.gz ==> Pouring lua-5.3.4_2.high_sierra.bottle.tar.gz ==> Caveats Please be aware due to the way Luarocks is designed any binaries installed via Luarocks-5.3 AND 5.1 will overwrite each other in /usr/local/bin. This is, for now, unavoidable. If this is troublesome for you, you can build rocks with the `--tree=` command to a special, non-conflicting location and then add that to your `$PATH`. ==> Summary 🍺 /usr/local/Cellar/lua/5.3.4_2: 147 files, 752.9KB ==> Installing macvim-dev/macvim/macvim --HEAD ==> Cloning https://github.com/macvim-dev/macvim.git Updating /Users/marslo/Library/Caches/Homebrew/macvim--git ==> Checking out branch master ==> ./configure --prefix=/usr/local/Cellar/macvim/HEAD-4bf1de8 --with-features=huge --enable-multibyte --enable-terminal --enable-netbeans --with-tlib=ncurses --enable-cscope --enable-termtruecolor --enable-perlinterp=dynamic --enable-pythoninterp=dynamic --enable-python3interp=dynamic --enable-rubyinterp=dynamic --enable-luainterp=dynamic --with-lua-prefix=/usr/local ==> make ==> PATH=/usr/local/Cellar/gettext/0.19.8.1/bin:$PATH MSGFMT=/usr/local/Cellar/gettext/0.19.8.1/bin/msgfmt INSTALL_DATA=install FILEMOD=644 LOCALEDIR=../../src/MacVim/build/Release/MacVim.app/Contents/Resources/vim/runtime/lang make -C src/po install 🍺 /usr/local/Cellar/macvim/HEAD-4bf1de8: 2,183 files, 39.7MB, built in 1 minute 13 seconds check formula config files $ brew -v edit macvim Editing /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/macvim.rb vim /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/macvim.rb ... system \"./configure\", \"--with-features=huge\", \"--enable-multibyte\", \"--enable-perlinterp\", \"--enable-rubyinterp\", \"--enable-tclinterp\", \"--enable-terminal\", \"--with-tlib=ncurses\", \"--with-compiledby=Homebrew\", \"--with-local-dir=#{HOMEBREW_PREFIX}\", \"--enable-cscope\", \"--enable-luainterp\", \"--with-lua-prefix=#{Formula[\"lua\"].opt_prefix}\", \"--enable-luainterp\", \"--enable-python3interp\", \"--disable-sparkle\" ... # or $ brew -v edit macvim-dev/macvim/macvim manual install formula How to prevent homebrew from upgrading a package? $ brew -v edit macvim $ brew -v fetch --deps macvim $ brew -v install --build-from-source macvim $ brew pin macvim brew debug info$ brew info --analytics doctor$ brew doctor info$ brew config HOMEBREW_VERSION: 2.6.0-211-g2c77a54 ORIGIN: https://github.com/Homebrew/brew HEAD: 2c77a540b522c2eee74af0745851167412adb83b Last commit: 68 minutes ago Core tap ORIGIN: https://github.com/Homebrew/homebrew-core Core tap HEAD: 4fb418f9d1b35c372d82d0b49b0f1df9143be236 Core tap last commit: 20 minutes ago Core tap branch: master HOMEBREW_PREFIX: /usr/local HOMEBREW_CASK_OPTS: [] HOMEBREW_EDITOR: vim HOMEBREW_INSTALL_BADGE: ☕️ 🐸 HOMEBREW_MAKE_JOBS: 12 Homebrew Ruby: 2.6.3 => /System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/bin/ruby CPU: dodeca-core 64-bit kabylake Clang: 12.0 build 1200 Git: 2.29.2 => /usr/local/bin/git Curl: 7.64.1 => /usr/bin/curl Java: 1.8.271.09, 1.8.0_211 macOS: 11.0.1-x86_64 CLT: 12.2.0.0.1.1604076827 Xcode: 12.2 tricky get info $ brew --repository /usr/local/Homebrew $ brew --prefix python@3 /usr/local/opt/python@3.9 $ brew --cache /Users/marslo/Library/Caches/Homebre cleanup # Remove all cache files older than specified days $ brew cleanup --prune=1 # remove all caches $ brew cleanup -s system settings GNU Coreutils $ brew install coreutils GNU Command Line Tools$ cat /etc/bashrc export PATH=\"$(brew --prefix coreutils)/libexec/gnubin:/usr/local/bin:$PATH\" bash $ brew install bash $ which -a bash /usr/local/bin/bash /bin/bash $ /usr/local/bin/bash --version GNU bash, version 4.4.12(1)-release (x86_64-apple-darwin17.0.0) Copyright (C) 2016 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later This is free software; you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. $ /bin/bash --version GNU bash, version 3.2.57(1)-release (x86_64-apple-darwin17) Copyright (C) 2007 Free Software Foundation, Inc. development tools $ brew install binutils diffutils gawk ctags jshon colordiff tree p7zip gnutls gzip watch $ brew install jq --devel --HEAD $ brew install cmake --with-completion --HEAD $ brew install ed --with-default-names $ brew install findutils --with-default-names $ brew install gnu-tar --with-default-names $ brew install gnu-which --with-default-names $ brew install grep --with-default-names $ brew install gnu-indent --with-default-names $ brew install file-formula applications(brew, cask and mas) $ brew tap homebrew/dupes # Optional $ brew tap macvim-dev/macvim $ brew install vim --override-system-vi $ brew install macvim --with-override-system-vim --HEAD # OR $ brew install --HEAD macvim-dev/macvim/macvim $ brew install jfrog-cli-go # JFrog CLI OR $ CURL -FL HTTPS://XRAY.JFROG.IO | SH $ brew install mas # app tools like appstore $ brew install youtube-dl $ brew cask install firefox $ brew cask install google-chrome # OR $ brew cask install google-chrome-dev $ brew cask install moom # instead of mas install 419330170 $ brew cask install dash $ brew cask install little-snitch $ brew cask install vlc $ mas install 1256503523 # System Indicators $ mas install 836500024 # WeChat $ mas install 1233593954 # MailMaster $ mas install 467939042 # Growl $ mas install 497799835 # Xcode $ mas install 736473980 # Paint $ mas install 520993579 # pwSafe $ mas install 944848654 # NeteaseMusic $ mas install 419330170 # Moom $ mas list 1256503523 System Indicators (1.0.6) 836500024 WeChat (2.3.5) 1233593954 MailMaster (2.2.2) 467939042 Growl (2.1.3) 497799835 Xcode (9.2) 736473980 Paint 2 (5.6.5) 520993579 pwSafe (4.11) 944848654 NeteaseMusic (1.5.7) 419330170 Moom (3.2.10) Alternative list $ find /Applications/*.app/Contents/_MASReceipt/receipt -maxdepth 4 -print | sed 's#.app/Contents/_MASReceipt/receipt#.app#g; s#/Applications/##' Alfred.app Growl.app MailMaster.app Moom.app NeteaseMusic.app Paint S.app System Indicators.app WeChat.app Xcode.app pwSafe.app accessory iTerm2 Install Shell Integration$ curl -L https://iterm2.com/shell_integration/install_shell_integration_and_utilities.sh | bash more settings BackgroundMusic $ (set -eo pipefail; URL='https://github.com/kyleneideck/BackgroundMusic/archive/master.tar.gz'; \\ cd $(mktemp -d); echo Downloading $URL to $(pwd); curl -qfL# $URL | gzcat - | tar x && \\ /bin/bash BackgroundMusic-master/build_and_install.sh -w && rm -rf BackgroundMusic-master) logs $ (set -eo pipefail; URL='https://github.com/kyleneideck/BackgroundMusic/archive/master.tar.gz'; \\ -> cd $(mktemp -d); echo Downloading $URL to $(pwd); curl -qfL# $URL | gzcat - | tar x && \\ -> /bin/bash BackgroundMusic-master/build_and_install.sh -w && rm -rf BackgroundMusic-master) Downloading https://github.com/kyleneideck/BackgroundMusic/archive/master.tar.gz to /var/folders/dm/dblpttpn3c5cdvg_g2rthhvh0000gn/T/tmp.mixzjjg1 ######################################################################## 100.0% About to install Background Music. Please pause all audio, if you can. This script will install: - /Applications/Background Music.app - /Library/Audio/Plug-Ins/HAL/Background Music Device.driver - /Library/Application Support/Background Music/BGMXPCHelper.xpc - /Library/LaunchDaemons/com.bearisdriving.BGM.XPCHelper.plist Continue (y/N)? y Password: [1/3] Installing the virtual audio device Background Music Device.driver to /Library/Audio/Plug-Ins/HAL [2/3] Installing BGMXPCHelper.xpc to /Library/Application Support/Background Music [3/3] Installing Background Music.app to /Applications Restarting coreaudiod to load the virtual audio device. Launching Background Music. Done. Mac CLI $ sh -c \"$(curl -fsSL https://raw.githubusercontent.com/marslo/mac-cli/master/mac-cli/tools/install)\" example $ mac bluetooth:status Bluetooth: ON $ mac speedtest Testing internet connection speed... 4.2 Mbps ↓ Others markdown-toc $ npm i -g --save markdown-toc --verbose doctoc $ npm install -g doctoc usage$ doctoc --gitlab my_osx.md $ doctoc --github --maxlevel 3 */*.md gitbook $ npm install gitbook-cli -g usage$ gitbook init $ gitbook serve $ gitbook build gitbook-summary $ npm install -g gitbook-summary usage:$ book sm -d -t 'life is hard, make it easier' reveal.js $ git clone git@github.com:hakimel/reveal.js.git $ cd reveal.js $ npm i -g usage$ npm start -- --port=8081 (http://localhost:8081) gnomon $ npm i -g gnomon usage$ ping 127.0.0.1 | gnomon 0.0066s PING 127.0.0.1 (127.0.0.1): 56 data bytes 0.8694s 18:13:43.219648 64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.048 ms 0.9999s 18:13:44.221333 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.116 ms 1.0004s 18:13:45.221475 64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.088 ms 1.0047s 18:13:46.222231 64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.059 ms 1.0001s 18:13:47.226847 64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.101 ms 1.0049s 18:13:48.227248 64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.100 ms 1.0049s 18:13:49.232354 64 bytes from 127.0.0.1: icmp_seq=6 ttl=64 time=0.093 ms 0.5038s 18:13:50.237433 64 bytes from 127.0.0.1: icmp_seq=7 ttl=64 time=0.091 ms iStats $ sudo gem install iStats -n /usr/local/bin usage $ istats all --- CPU Stats --- CPU temp: 57.19°C ▁▂▃▅▆▇ --- Fan Stats --- Total fans in system: 2 Fan 0 speed: 2146 RPM ▁▂▃▅▆▇ Fan 1 speed: 1985 RPM ▁▂▃▅▆▇ --- Battery Stats --- Battery health: unknown Cycle count: 34 ▁▂▃▅▆▇ 3.4% Max cycles: 1000 Current charge: 6073 mAh ▁▂▃▅▆▇ 100% Maximum charge: 6236 mAh ▁▂▃▅▆▇ 85.0% Design capacity: 7336 mAh Battery temp: 35.8°C For more stats run `istats extra` and follow the instructions. Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:06 "},"osx/util.html":{"url":"osx/util.html","title":"util","keywords":"","body":" Table of Contents generated with DocToc brew force the link and overwrite everything rerurn postinstall check brew configure file whatprovide alternatives tricky rpm & dpkg & brew brew command network show network information change order of networks list hardware IP DNS proxy setup wifi firewall brew force the link and overwrite everything $ brew link --overwrite example $ brew link --overwrite --dry-run python@3.8 Would remove: /usr/local/bin/python3 -> /usr/local/Cellar/python@3.9/3.9.0/bin/python3.9 If you need to have this software first in your PATH instead consider running: echo 'export PATH=\"/usr/local/opt/python@3.8/bin:$PATH\"' >> /Users/marslo/.bash_profile rerurn postinstall $ brew postinstall i.e.: $ sudo chown marslo:admin -R /usr/local/lib/python3.8/site-packages $ brew postinstall python@3.8 ==> Postinstalling python@3.8 ==> /usr/local/Cellar/python@3.8/3.8.6_1/bin/python3 -s setup.py --no-user-cfg install --force --verbose --install-scripts=/usr/local/Cellar/python@3.8 ==> /usr/local/Cellar/python@3.8/3.8.6_1/bin/python3 -s setup.py --no-user-cfg install --force --verbose --install-scripts=/usr/local/Cellar/python@3.8 ==> /usr/local/Cellar/python@3.8/3.8.6_1/bin/python3 -s setup.py --no-user-cfg install --force --verbose --install-scripts=/usr/local/Cellar/python@3.8 update homebrew-cask $ git -C \"/usr/local/Homebrew/Library/Taps/homebrew/homebrew-cask\" fetch --unshallow check brew configure file $ brew -v edit i.e.: $ brew -v edit openjdk manual install formula $ brew -v edit macvim $ brew -v fetch --deps macvim $ brew -v install --build-from-source macvim $ brew pin macvim whatprovide alternatives $ pkgutil --file-info /usr/bin/qlmanage volume: / path: /usr/bin/qlmanage pkgid: com.apple.pkg.Core pkg-version: 10.15.0.1.1.1569789135 install-time: 1570542610 uid: 0 gid: 0 mode: 755 for brew formula$ while read formula; do brew list --formula \"${formula}\" | grep -w magick; done tricky reference: Tips and Tricks interactive homebrew shell $ brew irb ==> Interactive Homebrew Shell Example commands available with: brew irb --examples WARNING: This version of ruby is included in macOS for compatibility with legacy software. In future versions of macOS the ruby runtime will not be available by default, and may require you to install an additional package. irb(main):001:0> list dependencies $ brew deps macvim Warning: Treating macvim as a formula. For the cask, use homebrew/cask/macvim cscope gdbm gettext libyaml lua openssl@1.1 python@3.9 readline ruby sqlite xz list who depends on $ brew uses --installed cscope macvim list all formula dpendencies $ brew list | while read cask; do echo -e -n \"\\e[1;34m$cask ->\\e[0m\"; brew deps $cask | awk '{printf(\" %s \", $0)}'; echo \"\"; done e.g.: $ brew list | while read cask; do echo -e -n \"\\e[1;34m$cask ->\\e[0m\"; brew deps $cask | awk '{printf(\" %s \", $0)}'; echo \"\"; done Warning: Calling `brew list` to only list formulae is deprecated! Use `brew list --formula` instead. ack -> adns -> aom -> autoconf -> autoconf-archive -> autoconf automake -> autoconf bash -> bash-completion -> bash-completion@2 -> bash bats -> bdw-gc -> berkeley-db -> openssl@1.1 binutils -> cabal-install -> ghc cairo -> fontconfig freetype gdbm gettext glib libffi libpng lzo openssl@1.1 pcre pixman python@3.8 readline sqlite xz ... rpm & dpkg & brew rpm dpkg brew rpm -qa dpkg -l brew list rpm -ql sofrwareanme dpkg -L softwarename dpkg --listfiles softwarename dpkg-qurery -L softwarename brew list softwarename brew ls --verbose software rpm -qf /path/to/file yum whatprovides /path/to/file dpkg -S /path/to/file rpm -qip pkgfile.rpm rpm -qlp pkgfile.rpm dpkg -l pkgfile.deb dpkg -c pkgfile.deb rpm -q softwarename rpm -qi softwarename dpkg -l softwarename dpkg -s softwarename dpkg -p softwarename brew info softwarename rpm -e softwarename dpkg -r softwarename dpkg -P softwareanme brew uninstall softwarename brew command command description brew --cache Print path to Homebrew’s download cache (usually ~/Library/Caches/Homebrew) brew --cellar Print path to Homebrew’s Cellar (usually /usr/local/Cellar) brew --config Print system configuration info brew --env Print Homebrew’s environment brew --prefix Print path to Homebrew’s prefix (usually /usr/local) brew --prefix [formula] Print where formula is installed brew audit Audit all formulae for common code and style issues brew cleanup [formula] Remove older versions from the Cellar for all (or specific) formulae1 brew create [url] Generate formula for downloadable file at url and open it in $HOMEBREW_EDITOR or $EDITOR2 brew create [tarball-url] --cache Generate formula (including MD5), then download the tarball brew create --fink [formula] Open Fink’s search page in your browser, so you can see how they do formula brew create --macports [formula] Open MacPorts’ search page in your browser, so you can see how they do formula brew deps [formula] List dependencies for formula brew doctor Check your Homebrew installation for common issues brew edit Open all of Homebrew for editing in TextMate brew edit [formula] Open [formula] in $HOMEBREW_EDITOR or $EDITOR brew fetch --force -v --HEAD [formula] Download source package for formula; for tarballs, also prints MD5, SHA1, and SHA256 checksums brew home Open Homebrew’s homepage in your browser brew home [formula] Opens formula ’s homepage in your browser brew info Print summary of installed packages brew info [formula] Print info for formula (regardless of whether formula is installed) brew info --github [formula] Open Github’s History page for formula in your browser brew install [formula] Install formula brew install --HEAD [formula] Install the HEAD version of formula (if its formula defines HEAD) brew install --force --HEAD [formula] Install a newer HEAD version of formula (if its formula defines HEAD) brew link [formula] Symlink all installed files for formula into the Homebrew prefix3 brew list [formula] List all installed files for formula (or all installed formulae with no arguments ) brew options [formula] Display install options specific to formula brew outdated List formulae that have an updated version available (brew install formula will install the newer version) brew prune Remove dead symlinks from Homebrew’s prefix4 brew remove [formula] Uninstall formula brew search List all available formula brew search [formula] Search for formula in all available formulae brew search /[formula]/ Search for /formula/ (as regex) in all available formulae brew test [formula] If formula defines a test, run it brew unlink [formula] Unsymlink formula from Homebrew’s prefix brew update Update formulae and Homebrew itself brew upgrade Install newer versions of outdated packages brew upgrade [formula] Install newer version of formula brew versions [formula] List previous versions of formulae, along with a command to checkout each version network show network information $ networksetup -listnetworkserviceorder An asterisk (*) denotes that a network service is disabled. (1) USB 10/100/1000 LAN (Hardware Port: USB 10/100/1000 LAN, Device: en7) (2) Wi-Fi (Hardware Port: Wi-Fi, Device: en0) ... or$ networksetup -listallnetworkservices An asterisk (*) denotes that a network service is disabled. USB 10/100/1000 LAN Wi-Fi Bluetooth PAN Thunderbolt Bridge change order of networks $ networksetup -ordernetworkservices \"Wi-Fi\" \"Ethernet\" \"USB Ethernet\" list hardware $ networksetup -listallhardwareports list detail of hardware$ networksetup -getinfo 'USB 10/100/1000 LAN' DHCP Configuration IP address: 192.168.1.10 Subnet mask: 255.255.255.0 Router: 192.168.1.1 Client ID: IPv6: Automatic IPv6 IP address: none IPv6 Router: none Ethernet Address: **:**:**:**:**:** IP find local device ip address$ arp -a DNS Get Info $ scutil --dns DNS configuration resolver #1 ... resolver #7 DNS configuration (for scoped queries) resolver #1 search domain[0] : ... nameserver[0] : ... nameserver[1] : ... nameserver[2] : ... if_index : ... flags : ... reach : ... setup DNS $ networksetup -getdnsservers Wi-Fi There aren't any DNS Servers set on Wi-Fi. $ networksetup -setdnsservers Wi-Fi 192.168.236.5 192.168.35.78 192.168.2.69 192.168.200.139 $ networksetup -getdnsservers Wi-Fi 192.168.236.5 192.168.35.78 192.168.2.69 192.168.200.139 $ cat /etc/resolv.conf nameserver 192.168.236.5 nameserver 192.168.35.78 nameserver 192.168.2.69 nameserver 192.168.200.139 proxy setup $ networksetup -getwebproxy Wi-Fi Enabled: No Server: Port: 0 Authenticated Proxy Enabled: 0 $ networksetup -getwebproxy Ethernet Enabled: No Server: Port: 0 Authenticated Proxy Enabled: 0 $ networksetup -getproxybypassdomains Ethernet *.local 169.254/16 $ scutil --proxy { HTTPEnable : 0 HTTPSEnable : 0 ProxyAutoConfigEnable : 1 ProxyAutoConfigURLString : http://my.pac.com/global-pac.pac SOCKSEnable : 0 } wifi get wifi name connection currently$ networksetup -getairportnetwork en0 Current Wi-Fi Network: WLAN-PUB connect to another $ networksetup -setairportnetwork en0 WLAN-PUB $ networksetup -getairportnetwork en0 Current Wi-Fi Network: WLAN-PUB $ networksetup -setairportnetwork en0 Automation-4G $ networksetup -getairportnetwork en0 Current Wi-Fi Network: Automation-4G turn on/off wifi $ networksetup -setairportpower en0 on $ networksetup -getairportpower en0 Wi-Fi Power (en0): On $ networksetup -setairportpower en0 off $ networksetup -getairportpower en0 Wi-Fi Power (en0): Off scan available wifi network $ networksetup -setairportpower en0 on $ sudo /System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -s SSID BSSID RSSI CHANNEL HT CC SECURITY (auth/unicast/group) Customer **:**:**:**:**:** -75 11 N CN WEP CorpWLAN **:**:**:**:**:** -72 1 Y CN WPA2(802.1x,Unrecognized(0)/AES/AES) Guest **:**:**:**:**:** -71 1 Y CN NONE disable ipv6 $ networksetup -listallnetworkservices An asterisk (*) denotes that a network service is disabled. USB 10/100/1000 LAN Wi-Fi Bluetooth PAN Thunderbolt Bridge $ networksetup -setv6off 'USB 10/100/1000 LAN' $ networksetup -setv6off Wi-fi undo$ networksetup -setv6automatic 'USB 10/100/1000 LAN' $ networksetup -setv6automatic Wi-Fi show network connection history$ defaults read /Library/Preferences/SystemConfiguration/com.apple.airport.preferences \\ | grep LastConnected -A 7 get wifi password list all Wifi$ defaults read /Library/Preferences/SystemConfiguration/com.apple.airport.preferences | \\grep SSIDString ... SSIDString = \"Apple Network Guest\"; ... get password$ sudo security find-generic-password -ga \"Apple Network Guest\" | grep password\\: password: \"guest@3742\" firewall show status$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate Firewall is disabled. (State = 0) enable firewall$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:07 "},"osx/system.html":{"url":"osx/system.html","title":"system","keywords":"","body":" Table of Contents generated with DocToc system tools hostinfo get human-readable vm_stat show system info show memory show Mach virtual memory statistics check process without interactive mode show system Serial Number hardware memory swap usage show kernel version flushed disk cache clean OSX native dot file system tools hostinfo $ hostinfo Mach kernel version: Darwin Kernel Version 19.6.0: Mon Aug 31 22:12:52 PDT 2020; root:xnu-6153.141.2~1/RELEASE_X86_64 Kernel configured for up to 12 processors. 6 processors are physically available. 12 processors are logically available. Processor type: x86_64h (Intel x86-64h Haswell) Processors active: 0 1 2 3 4 5 6 7 8 9 10 11 Primary memory available: 16.00 gigabytes Default processor set: 463 tasks, 2557 threads, 12 processors Load average: 2.72, Mach factor: 9.26 get human-readable vm_stat $ paste 1' | grep -o \".*:\") 1' | tr -d '.' | awk '{print $NF}'); do perl -e \"print $i/1024\" | awk '{printf \"%0.2f\", $0}'; echo; done) | column -s: -t Pages free 328.70 Pages active 910.00 Pages inactive 973.38 Pages speculative 39.51 Pages throttled 0.00 Pages wired down 852.52 Pages purgeable 389.65 \"Translation faults\" 174323.38 Pages copy-on-write 7828.62 Pages zero filled 127404.04 Pages reactivated 3420.56 Pages purged 6392.20 File-backed pages 656.69 Anonymous pages 1266.20 Pages stored in compressor 2536.76 Pages occupied by compressor 991.23 Decompressions 1555.85 Compressions 8494.54 Pageins 7799.75 Pageouts 11.98 Swapins 43.15 Swapouts 48.46 show system info $ glances show memory $ top -o MEM iStat $ istats --- CPU Stats --- CPU temp: 53.19°C ▁▂▃▅▆▇ --- Fan Stats --- Total fans in system: 2 Fan 0 speed: 2157 RPM ▁▂▃▅▆▇ Fan 1 speed: 1995 RPM ▁▂▃▅▆▇ --- Battery Stats --- Battery health: unknown Cycle count: 34 ▁▂▃▅▆▇ 3.4% Max cycles: 1000 Current charge: 6093 mAh ▁▂▃▅▆▇ 100% Maximum charge: 6237 mAh ▁▂▃▅▆▇ 85.0% Design capacity: 7336 mAh Battery temp: 36.5°C For more stats run `istats extra` and follow the instructions. show Mach virtual memory statistics $ vm_stat check process without interactive mode $ top -l 1 -n 0 example $ top -l 1 -n 0 Processes: 472 total, 3 running, 469 sleeping, 2589 threads 2020/11/02 16:10:28 Load Avg: 2.67, 2.88, 3.12 CPU usage: 33.4% user, 20.46% sys, 46.49% idle SharedLibs: 268M resident, 69M data, 44M linkedit. MemRegions: 112888 total, 3016M resident, 90M private, 2802M shared. PhysMem: 16G used (3742M wired), 420M unused. VM: 3201G vsize, 1993M framework vsize, 44188(0) swapins, 49627(0) swapouts. Networks: packets: 1575080/1561M in, 1302980/954M out. Disks: 1368885/28G read, 648911/13G written. or$ top -l 1 -s 0 show system Serial Number $ /usr/sbin/system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Name: MacBook Pro Model Identifier: MacBookPro15,1 Processor Name: 6-Core Intel Core i7 Processor Speed: 2.2 GHz Number of Processors: 1 Total Number of Cores: 6 L2 Cache (per Core): 256 KB L3 Cache: 9 MB Hyper-Threading Technology: Enabled Memory: 16 GB Boot ROM Version: 10**.***.*.*.* (iBridge: 17.**.*****.*.*,*) Serial Number (system): ************ Hardware UUID: ********-****-****-****-************ Activation Lock Status: Enabled hardware cpu manufacture$ sysctl -n machdep.cpu.brand_string Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz or$ sysctl machdep.cpu machdep.cpu.max_basic: 22 machdep.cpu.max_ext: 2147483656 machdep.cpu.vendor: GenuineIntel machdep.cpu.brand_string: Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz machdep.cpu.family: 6 ... memory $ system_profiler SPHardwareDataType | grep \"Memory:\\|Cores:\\|Processors:\" Number of Processors: 1 Total Number of Cores: 6 Memory: 16 GB or $ sysctl hw.memsize hw.memsize: 17179869184 $ sysctl hw.ncpu hw.ncpu: 12 memory slot $ system_profiler SPMemoryDataType Memory: Memory Slots: ECC: Disabled Upgradeable Memory: No BANK 0/ChannelA-DIMM0: Size: 8 GB Type: DDR4 Speed: 2400 MHz Status: OK Manufacturer: Micron Part Number: **********-***** Serial Number: - BANK 2/ChannelB-DIMM0: Size: 8 GB Type: DDR4 Speed: 2400 MHz Status: OK Manufacturer: Micron Part Number: **********-***** Serial Number: swap usage $ sysctl vm.swapusage vm.swapusage: total = 1024.00M used = 34.00M free = 990.00M (encrypted) show kernel version $ sysctl kern.version kern.version: Darwin Kernel Version 20.1.0: Sat Oct 31 00:07:11 PDT 2020; root:xnu-7195.50.7~2/RELEASE_X86_64 $ sysctl kern.ostype kern.ostype: Darwin $ sysctl kern.osrelease kern.osrelease: 20.1.0 $ sysctl kern.osrevision kern.osrevision: 199506 or$ uname -a Darwin iMarslo 20.1.0 Darwin Kernel Version 20.1.0: Sat Oct 31 00:07:11 PDT 2020; root:xnu-7195.50.7~2/RELEASE_X86_64 x86_64 i386 MacBookPro15,1 Darwin flushed disk cache $ sudo purge clean OSX native dot file $ dot_clean -mvp i.e.:$ sudo dot_clean -mvp / OR $ find $HOME -name '.DS_Store' -type f -delete Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:06 "},"osx/tricky.html":{"url":"osx/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc copy path copy STDOUT into clipboard Copy path from finder create an app for script add snippets for input others launch apps create image disk disable startup music 3D lock screen take screenshot after 3 sec setup welcome text in login screen show message on desktop copy path copy STDOUT into clipboard [!NOTE] pbcopy for macOS xclip for Linux $ | pbcopy example$ cat file | pbcopy $ pwd | pbcopy Copy path from finder right-click(control + left-click) -> option Automator -> Quick Action Automator -> Apple Script on run {input, parameters} try tell application \"Finder\" to set the clipboard to POSIX path of (target of window 1 as alias) on error beep end try return input end run create an app for script case: run groovyConsole from Spolite or Alfred reference: Install groovy console on Mac and make it runnable from dock get standalone commands for the script $ ps aux | grep groovyConsole | grep -v grep marslo 50495 0.0 3.4 11683536 577828 ?? S 5:50PM 0:15.85 /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/bin/java -Xdock:name=GroovyConsole -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns -Dgroovy.jaxb=jaxb -classpath /usr/local/opt/groovy/libexec/lib/groovy-3.0.6.jar -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole -Dprogram.name=groovyConsole -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf -Dgroovy.home=/usr/local/opt/groovy/libexec -Dtools.jar=/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter --main groovy.console.ui.Console --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf --classpath .:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. ==> which would be: /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/bin/java \\ -Xdock:name=GroovyConsole \\ -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns \\ -Dgroovy.jaxb=jaxb \\ -classpath /usr/local/opt/groovy/libexec/lib/groovy-3.0.6.jar \\ -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole \\ -Dprogram.name=groovyConsole \\ -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\ -Dgroovy.home=/usr/local/opt/groovy/libexec \\ -Dtools.jar=/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter \\ --main groovy.console.ui.Console \\ --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\ --classpath .:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. using Automator.app to create an app Open Automator.app » New » Application Select Run Shell Script » save to .app with empty shell script edit Contents/Info.plist $ vim groovyConsole.app/Contents/Info.plist ... CFBundleExecutable gConsole « the script name, can be any name you want CFBundleIconFile groovy CFBundleIdentifier com.apple.groovyConsole ... originalCFBundleExecutable Application Stub CFBundleIconFile AutomatorApplet CFBundleIdentifier com.apple.automator.groovyConsole create script to open the groovyConsole $ touch groovyConsole.app/Contents/MacOS/groovyConsole $ cat > groovyConsole.app/Contents/MacOS/groovyConsole #!/bin/bash -> /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/bin/java \\\\ -> -Xdock:name=GroovyConsole \\\\ -> -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns \\\\ -> -Dgroovy.jaxb=jaxb \\\\ -> -classpath /usr/local/opt/groovy/libexec/lib/groovy-3.0.6.jar \\\\ -> -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole \\\\ -> -Dprogram.name=groovyConsole \\\\ -> -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\\\ -> -Dgroovy.home=/usr/local/opt/groovy/libexec \\\\ -> -Dtools.jar=/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter \\\\ -> --main groovy.console.ui.Console \\\\ -> --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\\\ -> --classpath .:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. -> EOF $ chmod +x groovyConsole.app/Contents/MacOS/groovyConsole try validate via execute groovyConsole.app/Contents/MacOS/groovyConsole directly. to see whether if the groovyConsole will be opened. set the icon for new app optional $ cp /usr/local/opt/groovy/libexec/lib/groovy.icns groovyConsole.app/Contents/Resources or$ ln -sf /usr/local/opt/groovy/libexec/lib/groovy.icns groovyConsole.app/Contents/Resources/groovy.icns move groovyConsole.app to /Application $ mv groovyConsole.app/ /Applications/ add snippets for input enable Technical Symbols Input Method ⇢ Show emoji and symbols Open Customized List ⇢ Technical Symbols And snippets go to System Preferences ⇢ Keyboard ⇢ Test Add snippets as below finally others launch apps $ launchctl list create image create dmg image$ hdiutil create -volname \"Volume Name\" -srcfolder /path/to/folder -ov diskimage.dmg create encrypted image$ hdiutil create -encryption -stdinpass -volname \"Volume Name\" -srcfolder /path/to/folder -ov encrypted.dmg creaste dvd (for .iso, .img, .dmg)$ hdiutil burn /path/to/image_file disk check volumn info $ diskutil info i.e.: $ diskutil info /Volumes/iMarsloOSX/ Device Identifier: disk1s5 Device Node: /dev/disk1s5 Whole: No Part of Whole: disk1 Volume Name: iMarsloOSX Mounted: Yes Mount Point: / list disks and volumns $ diskutil list list the apfs info $ diskutil apfs list APFS Container (1 found) | +-- Container disk1 ********-****-****-****-************ ==================================================== APFS Container Reference: disk1 Size (Capacity Ceiling): 250685575168 B (250.7 GB) Capacity In Use By Volumes: 176258826240 B (176.3 GB) (70.3% used) Capacity Not Allocated: 74426748928 B (74.4 GB) (29.7% free) | +- | +-> ... check detail diskage usage $ sudo fs_usage 21:03:47 ioctl 0.000003 iTerm2 21:03:47 ioctl 0.000003 iTerm2 21:03:47 close 0.000031 privoxy 21:03:47 select 0.000004 privoxy ... disable startup music $ sudo nvram SystemAudioVolume=\" \" 3D lock screen $ /System/Library/CoreServices/Menu\\ Extras/User.menu/Contents/Resources/CGSession -suspend take screenshot after 3 sec $ screencapture -T 3 -t jpg -P delayedpic.jpg setup welcome text in login screen $ sudo defaults write /Library/Preferences/com.apple.loginwindow LoginwindowText 'Awesome Marslo!!' show message on desktop $ sudo jamf displayMessage -message \"Hello World!\" Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:06 "},"linux/basic.html":{"url":"linux/basic.html","title":"linux","keywords":"","body":" Table of Contents generated with DocToc character metacharacter Brace Expansion Scp Multipule Folder/File to Target Server Process Substitution nstalling tools via running random scripts from unknown sites strace Basic Commands du sed CentOS Yum File \"/usr/libexec/urlgrabber-ext-down\", line 28 reference The Bash Shell Startup Files character metacharacter Character Where Meaning csh, sh Execute command # csh, sh, ASCII files Start a comment csh, sh Argument separator ``` csh, sh Command substitution \" csh, sh Weak Quotes ' csh, sh Strong Quotes \\ csh, sh Single Character Quote variable sh, csh Variable variable csh, sh Same as variable \\ csh, sh Pipe character ^ sh Pipe Character & csh, sh Run program in background ? csh, sh Match one character * csh, sh Match any number of characters ; csh, sh Command separator ;; sh End of Case statement ~ csh Home Directory ~user csh User's Home Directory ! csh History of Commands - Programs Start of optional argument $# csh, sh Number of arguments to script $* csh, sh Arguments to script $@ sh Original arguments to script $- sh Flags passed to shell $? sh Status of previous command $$ sh Process identification number $! sh PID of last background job && sh Short-circuit AND ` ` sh Short-circuit OR . csh, sh Typ. filename extension . sh Source a file and execute as command : sh Nothing command : sh Separates Values in environment variables : csh Variable modifier Character Where Meaning [ ] csh, sh Match range of characters [ ] sh Test %job csh Identifies job Number (cmd;cmd) csh. sh Runs cmd;cmd as a sub-shell { } csh In-line expansions {cmd;cmd } sh Like (cmd;cmd ) without a subshell >ofile csh, sh Standard output >>ofile csh, sh Append to standard output csh, sh Standard Input csh, sh Read until word, substitute variables csh, sh Read until word, no substitution sh Read until word, ignoring TABS >>!file csh Append to file, ignore error if not there >!file csh Output to new file, ignore error if not there >&file csh Send standard & error output to file sh Switch Standard Input to file sh Close Standard Input >&digit sh Switch Standard Output to file >&- sh Close Standard Output digit1 sh Connect digit2 to digit1 digit sh Close file digit digit2>&digit1 sh Connect digit2 to digit1 digit>&- sh Close file digit Brace Expansion Scp Multipule Folder/File to Target Server $ scp -r `echo dir{1..10}` user@target.server:/target/server/path/ Process Substitution Process substitution is a form of redirection where the input or output of a process (some sequence of commands) appear as a temporary file. $ while read branch; do git fetch --all --force; done example: run script without download $ bash or $ python or $ python example: merge lines of file inspired by here and here $ cat a t1 t2 t3 t4 $ cat b 11 22 33 44 $ paste /dev/fd/63 is not a regular file $ more nstalling tools via running random scripts from unknown sites $ ( wget -O - pi.dk/3 || lynx -source pi.dk/3 || curl pi.dk/3/ || \\ fetch -o - http://pi.dk/3 ) > install.sh strace reference What's the difference between Basic Commands du top biggest directories under [path]$ du -a [path] | sort -n -r | head -n 5 display the largest files according to human-readable format$ du -hs * | sort -rh | head -5 display the largest folders/files including the sub-directories$ du -Sh | sort -rh | head -5 biggest file sizes $ find -type f -exec du -Sh {} + | sort -rh | head -n 5 or $ find [PATH] -type f -printf \"%s %p\\n\" | sort -rn | head -n 5 sed reference 50 sed Command Examples CentOS Yum File \"/usr/libexec/urlgrabber-ext-down\", line 28 Error File \"/usr/libexec/urlgrabber-ext-down\", line 28 except OSError, e: ^ Solution $ sudo update-alternatives --remove python /usr/bin/python3 $ realpath /usr/bin/python /usr/bin/python2.7 OR $ sudo update-alternatives --config python There are 3 programs which provide 'python'. Selection Command ----------------------------------------------- *+ 1 /usr/bin/python3 2 /usr/bin/python2.7 3 /usr/bin/python2 Enter to keep the current selection[+], or type selection number: 3 Reason $ ls -l /usr/bin/python* lrwxrwxrwx 1 root root 24 Jul 10 02:29 /usr/bin/python -> /etc/alternatives/python lrwxrwxrwx 1 root root 9 Dec 6 2018 /usr/bin/python2 -> python2.7 -rwxr-xr-x 1 root root 7216 Oct 30 2018 /usr/bin/python2.7 lrwxrwxrwx 1 root root 9 Mar 7 2019 /usr/bin/python3 -> python3.4 -rwxr-xr-x 2 root root 11392 Feb 5 2019 /usr/bin/python3.4 -rwxr-xr-x 2 root root 11392 Feb 5 2019 /usr/bin/python3.4m $ ls -altrh /etc/alternatives/python lrwxrwxrwx 1 root root 16 Jul 10 02:29 /etc/alternatives/python -> /usr/bin/python3 reference Yum install error file \"/usr/bin/yum\", line 30 failed at yum update and how to fix it Upgraded Python, and now I can't run “yum upgrade” How to Find Out Top Directories and Files (Disk Space) in Linux Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:10 "},"linux/util/util.html":{"url":"linux/util/util.html","title":"util","keywords":"","body":" Table of Contents generated with DocToc Utils shell paramters pass self parameters to another script getopts with long option Network Get Interface by command get ipv4 address system command use parameter in xargs find out commands belongs to and come from Get all google website readline & bind get info Utils shell paramters pass self parameters to another script objective: $ ./b.sh a b c d -> $ ./a.sh a b c d b.sh #!/bin/bash echo \"\"\" b.sh: \\$1: \"$1\" \\$#: \"$#\" \\$@: \"$@\" \\${@: -1}: ${@: -1} \\${@: -2}: ${@: -2} \\${@: -3}: ${@: -2} \\${@: -\\$(( \\$#-1 ))}: ${@: -$(( $#-1 ))} \\$(echo '\\${@: -\\$(( \\$#-1 ))}' | cut -d' ' -f1-) : $(echo \"${@: -$(( $#-1 ))}\" | cut -d' ' -f1-) \"\"\" echo -e \"\\n'~~> ./a.sh \\\"\\${@: -1}\\\"': ~~~> ./a.sh ${@: -1}:\" ./a.sh \"${@: -1}\" echo -e \"\\n'~~> ./a.sh \\$(echo '\\${@: -1}' | cut -d' ' -f1-)': ~~~> ./a.sh $(echo \"${@: -1}\" | cut -d' ' -f1-):\" ./a.sh $(echo \"${@: -1}\" | cut -d' ' -f1-) echo -e \"\\n'~~> ./a.sh \\\"\\${@: -4}\\\"': ~~~> ./a.sh ${@: -4}:\" ./a.sh \"${@: -4}\" echo -e \"\\n'~~> ./a.sh \\$(echo '\\${@: -\\$(( \\$#-1 ))}' | cut -d' ' -f1-)': ~~~> ./a.sh $(echo \"${@: -$(( $#-1 ))}\" | cut -d' ' -f1-)\" ./a.sh $(echo \"${@: -$(( $#-1 ))}\" | cut -d' ' -f1-) a.sh echo \"\"\" a.sh: \\$1: \"$1\" \\$#: \"$#\" \\$@: \"$@\" \\${@: -$(( $#-2 ))}: ${@: -$(( $#-2 ))} \"\"\" result $ ./b.sh a b c d e b.sh: $1: a $#: 5 $@: a b c d e ${@: -1}: e ${@: -2}: d e ${@: -3}: d e ${@: -$(( $#-1 ))}: b c d e $(echo '${@: -$(( $#-1 ))}' | cut -d' ' -f1-) : b c d e '~~> ./a.sh \"${@: -1}\"': ~~~> ./a.sh e: a.sh: $1: e $#: 1 $@: e ${@: --1}: e '~~> ./a.sh $(echo '${@: -1}' | cut -d' ' -f1-)': ~~~> ./a.sh e: a.sh: $1: e $#: 1 $@: e ${@: --1}: e '~~> ./a.sh \"${@: -4}\"': ~~~> ./a.sh b c d e: a.sh: $1: b $#: 4 $@: b c d e ${@: -2}: d e '~~> ./a.sh $(echo '${@: -$(( $#-1 ))}' | cut -d' ' -f1-)': ~~~> ./a.sh b c d e a.sh: $1: b $#: 4 $@: b c d e ${@: -2}: d e getopts with long option #!/bin/bash # shellcheck disable=SC1079,SC1078 usage=\"\"\"USAGE \\t$0\\t[-h|--help] [-c|--clean] [-t|--tag ] [-i|--image ] \\t\\t\\t[-v|--ver ] [-n|--name ] \\t\\t\\t[-p|--prop ] \"\"\" while test -n \"$1\"; do case \"$1\" in -c | --clean ) clean=true ; shift ;; -t | --tag ) tag=$2 ; shift 2 ;; -i | --image ) image=$2 ; shift 2 ;; -v | --ver ) ver=$2 ; shift 2 ;; -n | --name ) name=$2 ; shift 2 ;; -p | --prop ) prop=$2 ; shift 2 ;; -h | --help | * ) echo -e \"${usage}\"; exit 0 ;; esac done echo \"\"\" clean : ${clean} tag : ${tag} image : ${image} ver : ${ver} name : ${name} prop : ${prop} \"\"\" result $ ./longopts.sh -h USAGE ./longopts.sh [-h|--help] [-c|--clean] [-t|--tag ] [-i|--image ] [-v|--ver ] [-n|--name ] [-p|--prop ] $ ./longopts.sh -c clean : true tag : image : ver : name : prop : $ ./longopts.sh -c -t 'ttt' -i 'iii' --ver '1.1.1' --name 'name' clean : true tag : ttt image : iii ver : 1.1.1 name : name prop : Network Get Interface by command interface=$(netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}') # or get the route to github interface=$(ip route get $(nslookup github.com | grep Server | awk -F' ' '{print $NF}') | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') get ipv4 address ipAddr=$(ip a s \"${interface}\" | sed -rn 's|.*inet ([0-9\\.]{7,15})/[0-9]{2} brd.*$|\\1|p') system command use parameter in xargs $ find . -type f | xargs -n 1 -I FILE bash -c 'echo $(file --mime-type -b FILE)' text/plain text/plain text/plain inode/x-empty text/plain text/plain text/plain text/plain text/plain text/plain find out commands belongs to and come from belongs to $ type which which is aliased to `alias | which -a --tty-only --read-alias --show-dot --show-tilde' $ type bello bello is a function bello () { source \"${iRCHOME}/.imac\" } come from $ shopt -s extdebug $ declare -F _docker _docker 5463 /usr/local/etc/bash_completion.d/docker $ declare -F __git_ps1 __git_ps1 340 /usr/local/etc/bash_completion.d/git-prompt.sh $ declare -F bello bello 79 /Users/marslo/.marslo/.marslorc linux$ bash --debugger $ declare -F _docker _docker 5011 /usr/share/bash-completion/completions/docker Get all google website $ whois www.google.com Whois Server Version 2.0 Domain names in the .com and .net domains can now be registered with many different competing registrars. Go to http://www.internic.net for detailed information. Server Name: WWW.GOOGLE.COM.VN Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.TW Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.TR Registrar: TUCOWS DOMAINS INC. Whois Server: whois.tucows.com Referral URL: http://domainhelp.opensrs.net Server Name: WWW.GOOGLE.COM.SA Registrar: OMNIS NETWORK, LLC Whois Server: whois.omnis.com Referral URL: http://domains.omnis.com Server Name: WWW.GOOGLE.COM.PK Registrar: INTERNET.BS CORP. Whois Server: whois.internet.bs Referral URL: http://www.internet.bs Server Name: WWW.GOOGLE.COM.PE Registrar: HOSTOPIA.COM INC. D/B/A APLUS.NET Whois Server: whois.names4ever.com Referral URL: http://www.aplus.net Server Name: WWW.GOOGLE.COM.MX Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.HK Registrar: GKG.NET, INC. Whois Server: whois.gkg.net Referral URL: http://www.gkg.net Server Name: WWW.GOOGLE.COM.DO Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.CO Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.BR Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.AU Registrar: MELBOURNE IT, LTD. D/B/A INTERNET NAMES WORLDWIDE Whois Server: whois.melbourneit.com Referral URL: http://www.melbourneit.com Server Name: WWW.GOOGLE.COM.AR Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com >>> Last update of whois database: Mon, 24 Feb 2014 17:24:05 UTC readline & bind get info get current keymap $ bind -v | awk '/keymap/ {print $NF}' vi-insert tricky for switch keymap set keymap emacs \"\\ee\": vi-editing-mode set keymap vi-insert \"\\e\": vi-movement-mode set keymap vi-command \"\\ee\": emacs-editing-mode Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:11 "},"linux/util/date.html":{"url":"linux/util/date.html","title":"time & date","keywords":"","body":" Table of Contents generated with DocToc date epoch timestamps format IOS 8601 rfc-3339 utc timezone Common formats convert timestamps to epoch epoch to timestamps calculate time different transfer date format date epoch https://en.wikipedia.org/wiki/Unix_time: It is the number of seconds that have elapsed since the Unix epoch, minus leap seconds; the Unix epoch is 00:00:00 UTC on 1 January 1970 What is epoch time? $ date -u -d '1970-01-01 00:00:00' '+Normal: %F %T %:z%nUnix: %s' Normal: 1970-01-01 00:00:00 +00:00 Unix: 0 $ date -d '1970-01-01 00:00:00' '+Normal: %F %T %:z%nUnix: %s' Normal: 1970-01-01 00:00:00 +08:00 Unix: -28800 $ date -u -d '1970-01-01 00:00:00 UTC +1 day' '+Normal: %F %T %:z%nUnix: %s' Normal: 1970-01-02 00:00:00 +00:00 Unix: 86400 $ date '+%s%3N' 1602231334983 $ date '+%s' 1602231334 timestamps format yyyy-MM-dd'T'HH:mm:ss.SSSZ yyyy-MM-dd'T'HH:mm:ss Date Format Option Meaning Example Output date +%c locale’s date time Sat May 9 11:49:47 2020 date +%x locale’s date 05/09/20 date +%X locale’s time 11:49:47 date +%A locale’s full weekday name Saturday date +%B locale’s full month name May date +%m-%d-%Y MM-DD-YYYY date format 05-09-2020 date +%D MM/DD/YY date format 05/09/20 date +%F YYYY-MM-DD date format 2020-05-09 date +%T HH:MM:SS time format 11:44:15 date +%u Day of Week 6 date +%U Week of Year with Sunday as first day of week 18 date +%V ISO Week of Year with Monday as first day of week 19 date +%j Day of Year 130 date +%Z Timezone PDT date +%m Month of year (MM) 05 date +%d Day of Month (DD) 09 date +%Y Year (YY) 2020 date +%H Hour (HH) 11 date +%H Hour (HH) in 24-hour clock format 11 date +%I Hour in 12-hour clock format 11 date +%p locale’s equivalent of AM or PM AM date +%P same as %p but in lower case am classical date format $ secs=259200 $ date -u -d @${secs} +\"%F\" 1970-01-04 $ date -u -d @${secs} +\"%T\" 00:00:00 $ date -u -d @${secs} +\"%F %T\" 1970-01-04 00:00:00 $ date -u -d @${secs} -Is 1970-01-04T00:00:00+00:00 date format with timezone $ date -u +\"%Y-%m-%dT%H:%M:%SZ\" 2020-10-09T08:14:47Z $ date +%FT%T.%3N%:z 2020-10-09T17:27:18.491+08:00 $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" 2020-10-09T08:14:47.167Z $ date +%Y-%m-%d-T%H:%M:%S.%3N%z 2020-10-09-T17:27:18.491+0800 details $ date -u -d \"2019-01-19T05:00:00 - 2 hours\" +%Y-%m-%d_%H:%M:%S%Z --debug date: parsed datetime part: (Y-M-D) 2019-01-19 05:00:00 UTC-02 date: parsed relative part: +1 hour(s) date: input timezone: parsed date/time string (-02) date: using specified time as starting value: '05:00:00' date: starting date/time: '(Y-M-D) 2019-01-19 05:00:00 TZ=-02' date: '(Y-M-D) 2019-01-19 05:00:00 TZ=-02' = 1547881200 epoch-seconds date: after time adjustment (+1 hours, +0 minutes, +0 seconds, +0 ns), date: new time = 1547884800 epoch-seconds date: timezone: Universal Time date: final: 1547884800.000000000 (epoch-seconds) date: final: (Y-M-D) 2019-01-19 08:00:00 (UTC) date: final: (Y-M-D) 2019-01-19 08:00:00 (UTC+00) 2019-01-19_08:00:00UTC IOS 8601 dates example YYYY 2015 YYYY-MM 2015-12 YYYY-MM-DD 2015-12-11 YYYY-MM-DD'T'hh:mmTZD 2015-12-11T20:28+01:00 or 2015-12-11T19:28Z YYYY-MM-DD'T'hh:mm:ssTZD 2015-12-11T20:28:30+01:00 or 2015-12-11T19:28:30Z YYYY-MM-DD'T'hh:mm:ss.sTZD 2015-12-11T20:28:30.45+01:00 or 2015-12-11T19:28:30.45Z where: YYYY = four-digit year MM = two-digit month (01=January, etc.) DD = two-digit day of month (01 through 31) hh = two digits of hour (00 through 23) (am/pm NOT allowed) mm = two digits of minute (00 through 59) ss = two digits of second (00 through 59) s = one or more digits representing a decimal fraction of a second (i.e. milliseconds) TZD = time zone designator (Z or +hh:mm or -hh:mm) $ date -I 2020-10-09 $ date -Is && date -Isecond 2020-10-09T16:31:47+08:00 2020-10-09T16:31:47+08:00 $ date -Ih 2020-10-09T16+08:00 $ date -Im 2020-10-09T16:31+08:00 rfc-3339 $ date --rfc-3339=date 2020-10-09 $ date --rfc-3339=ns 2020-10-09 17:32:14.158684000+08:00 $ date --rfc-3339=seconds 2020-10-09 17:32:14+08:00 utc $ date Fri Oct 9 17:09:34 CST 2020 $ date -u Fri Oct 9 09:09:34 UTC 2020 timezone $ date '+%Z' CST $ date '+%z' +0800 $ date '+%:z' +08:00 $ date '+%::z' +08:00:00 $ date '+%:::z' +08 $ date '+%Z' CST Common formats Shell command: date Most common Bash date commands for timestamping Format/result Command Output YYYY-MM-DD date -I 2020-10-09 YYYY-MM-DD_hh:mm:ss date +%F_%T 2020-10-09_16:48:45 YYYYMMDD_hhmmss date +%Y%m%d_%H%M%S 20201009_164845 YYYYMMDD_hhmmss (UTC version) date --utc +%Y%m%d_%H%M%SZ 20201009_084845Z YYYYMMDD_hhmmss (with local TZ) date +%Y%m%d_%H%M%S%Z 20201009_164845CST YYYYMMSShhmmss date +%Y%m%d%H%M%S 20201009164845 YYYYMMSShhmmssnnnnnnnnn date +%Y%m%d%H%M%S%N 20201009164845495302000 YYMMDD_hhmmss date +%y%m%d_%H%M%S 201009_164845 Seconds since UNIX epoch: date +%s 1602233325 Nanoseconds only: date +%N 505337000 Nanoseconds since UNIX epoch: date +%s%N 1602233325508581000 Nanoseconds since UNIX epoch: date +%s%3N 1602233325508 ISO8601 UTC timestamp date --utc +%FT%TZ 2020-10-09T08:48:45Z ISO8601 UTC timestamp date --utc +%FT%T%Z 2020-10-09T08:48:45UTC ISO8601 UTC timestamp + ms date --utc +%FT%T.%3NZ 2020-10-09T08:48:45.517Z ISO8601 UTC timestamp + ms date --utc +%FT%T.%3N%Z 2020-10-09T08:48:45.520UTC ISO8601 Local TZ timestamp date +%FT%T%Z 2020-10-09T16:48:45CST YYYY-MM-DD (Short day) date +%F\\(%a\\) 2020-10-09(Fri) YYYY-MM-DD (Long day) date +%F\\(%A\\) 2020-10-09(Friday) convert $ date +\"%Y-%m-%dT%H:%M:%SZ\" 2020-10-09T17:16:37Z $ date -u +\"%Y-%m-%dT%H:%M:%SZ\" 2020-10-09T09:16:37Z $ date -d $(date -u +\"%Y-%m-%dT%H:%M:%SZ\") Fri Oct 9 17:16:37 CST 2020 Human-readable time Seconds 1 hour 3600 seconds 1 day 86400 seconds 1 week 604800 seconds 1 month (30.44 days) 2629743 seconds 1 year (365.24 days) 31556926 seconds timestamps to epoch $ echo $EPOCHSECONDS 1602235097 $ date -d $(date -u +\"%Y-%m-%dT%H:%M:%SZ\") +%s 1602235097 $ date --date=$(date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\") +%s%3N 1602235097801 epoch to timestamps $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" 2020-10-09T09:18:17.795Z $ date -d @1602235097 +%c Fri Oct 9 17:18:17 2020 $ date -d @1602235097 Fri Oct 9 17:18:17 CST 2020 $ date -d @1602235097 -u Fri Oct 9 09:18:17 UTC 2020 convert epoch with milliseconds Convert unix timestamp to hh:mm:ss:SSS (where SSS is milliseconds) d=$(date +%s%3N) s=${d%???} ms=${d#\"$s\"} date -d \"@$s\" +\"%F %T.$ms %z\" result 2020-10-09 18:28:34.534 +0800 d: 1602239314534 s: 1602239314 ms: 534 calculate time different $ date -d 'now + 3 weeks' Fri Oct 30 20:32:04 CST 2020 $ date -d 'now + 3 weeks' +%s 1604061130 $ date -d 'Jan 1 + 11 weeks' Wed Mar 18 00:00:00 CST 2020 $ date -d 'Jan 1 2021 + 11 weeks' Fri Mar 19 00:00:00 CST 2021 time described by STRING $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" -d '90 day ago' 2020-07-11T08:14:03.145Z $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" -d '3 months ago' 2020-07-09T08:14:47.164Z $ date -u -d \"2019-01-19T05:00:00Z - 2 hours\" +%Y-%m-%d_%H:%M:%S 2019-01-19_03:00:00 $ date -d \"$(date -Iseconds -d \"2018-12-10 00:00:00\") - 5 hours - 20 minutes - 5 seconds\" Sun Dec 9 18:39:55 CST 2018 $ date -d \"2018-12-10 00:00:00 5 hours ago 20 minutes ago 5 seconds ago\" Sun Dec 9 18:39:55 CST 2018 two times different $ seconds=$(date +%s) $ printf \"%d days %(%H hours %M minutes %S seconds)T\\n\" $((seconds/86400)) $seconds 18544 days 18 hours 35 minutes 48 seconds Simple one-liner $ secs=259200 $ printf '%dh:%dm:%ds\\n' $(($secs/3600)) $(($secs%3600/60)) $(($secs%60)) 72h:0m:0s with leading zero $ printf '%02dh:%02dm:%02ds\\n' $(($secs/3600)) $(($secs%3600/60)) $(($secs%60)) 72h:00m:00s with days $ printf '%dd:%dh:%dm:%ds\\n' $(($secs/86400)) $(($secs%86400/3600)) $(($secs%3600/60)) $(($secs%60)) 3d:0h:0m:0s with nanoseconds $ printf '%02dh:%02dm:%02fs\\n' $(echo -e \"$secs/3600\\n$secs%3600/60\\n$secs%60\"| bc | xargs echo) 72h:00m:0.000000s datediff (ddiff) $ datediff -f \"%d days, %H hours, %M mins, %S secs\" \"$(date +'%Y-%m-%d %H:%M:%S')\" \"$(date +'%Y-%m-%d %H:%M:%S' -d '3 days ago')\" -3 days, 0 hours, 0 mins, 0 secs or with specific format $ ddiff -i '%Y%m%d%H%M%S' 20190817040001 20200312000101 17956860s $ ddiff -f \"%d days, %H hours, %M mins, %S secs\" -i '%Y%m%d%H%M%S' 20190817040001 20200312000101 207 days, 20 hours, 1 mins, 0 secs calculate with epoch $ awk -v t=$(( $(date -d $(date +\"%Y-%m-%dT%H:%M:%SZ\") +%s) - $(date -d $(date +\"%Y-%m-%dT%H:%M:%SZ\" -d '3 days ago') +%s) )) 'BEGIN{ printf \"%d:%02d:%06.3f\\n\", t/3600, (t/60)%60, t%60}' 72:00:00.000 transfer date format $ date +'%Y%m%d%H%M%S' 20201009184852 $ d1=$(date +'%Y%m%d%H%M%S') $ date --date \"$(echo $d1 | sed -nr 's/(....)(..)(..)(..)(..)(..)/\\1-\\2-\\3 \\4:\\5:\\6/p')\" Fri Oct 9 18:48:52 CST 2020 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:11 "},"linux/util/files&chars.html":{"url":"linux/util/files&chars.html","title":"files & chars","keywords":"","body":" Table of Contents generated with DocToc .join() alike in shell find out the file is ending by crlf or lf Show all line numbers in a file Insert into the first line backup and restore filer & folder permission Encrypt bash file Get the count of a word in a file Print 50th char Get the common part Revert a word Format a file to a table Show last n lines in a file Print a file into one line Get the file inode All About {Curly Braces} In Bash find and replace Shell Parameter Expansion .join() alike in shell paste $ seq 1 100 | paste -sd ':' - 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53:54:55:56:57:58:59:60:61:62:63:64:65:66:67:68:69:70:71:72:73:74:75:76:77:78:79:80:81:82:83:84:85:86:87:88:89:90:91:92:93:94:95:96:97:98:99:100 # others $ seq 1 100 | paste -sd \"\\0\" 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100 sed $ seq 1 100 | sed ':a; N; $!ba; s/\\n/:/g' 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53:54:55:56:57:58:59:60:61:62:63:64:65:66:67:68:69:70:71:72:73:74:75:76:77:78:79:80:81:82:83:84:85:86:87:88:89:90:91:92:93:94:95:96:97:98:99:100 awk (ORS) $ seq 1 100 | awk 'ORS=\",\"' 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100, ls -m $ ls -m Applications, Desktop, Documents, Downloads, Library, Movies, Music, Pictures, Public, find out the file is ending by crlf or lf cat -e $ cat -e # e.g. $ cat -e windows.txt test^M$ windows^M$ format $ cat -e linux.txt test$ windows$ format file $ file windows.txt windows.txt: ASCII text, with CRLF line terminators $ file windows.txt windows.txt: ASCII text Show all line numbers in a file cat $ sudo cat /etc/passwd | wc -l 36 awk $ awk 'END {print NR}' /etc/passwd 36 Insert into the first line $ cat demo.file abc efg $ echo \"first line\" | cat - demo.file first line abc efg backup and restore filer & folder permission backup $ find . -printf '%m\\t%u\\t%g\\t%p\\0' > file.perm restore while read -rd $'\\0' perms user group file; do if [ -e \"$file\" ]; then chown \"$user:$group\" \"$file\" chmod \"$perms\" \"$file\" else echo \"warning: $file not found\" fi done check perm find & printf $ find $PWD -printf '%m\\t%u\\t%g\\t%p\\n' | head 755 marslo staff /Users/marslo 755 marslo staff /Users/marslo/.eclipse 755 marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo 644 marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo/defaults.properties 644 marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo/infos.txt $ find $PWD -printf '%M %u %g %p\\n' | head drwxr-xr-x marslo staff /Users/marslo drwxr-xr-x marslo staff /Users/marslo/.eclipse drwxr-xr-x marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo -rw-r--r-- marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo/defaults.properties stat $ stat -c '%A %a %n' * drwx------ 700 Applications drwx------ 700 Desktop drwx------ 700 Documents drwx------ 700 Downloads drwx------ 700 Library drwx------ 700 Movies drwx------ 700 Music drwx------ 700 Pictures drwxr-xr-x 755 Public drwxr-xr-x 755 mywork drwxr-xr-x 755 test namei $ namei -l $PWD /Users/marslo / = drwxr-xr-x l=22 u=root/0 g=admin/80 s=704 m=07-16-2020@13:40:21 Users = drwxr-xr-x l=6 u=root/0 g=admin/80 s=192 m=09-30-2019@04:22:36 marslo = drwxr-xr-x l=72 u=marslo/501 g=staff/20 s=2304 m=07-16-2020@17:37:27 Encrypt bash file $ echo \"ls\" > script.bash; gpg -c script.bash; cat script.bash.gpg | gpg -d --no-mdc-warning | bash Get the count of a word in a file $ cat /etc/passwd | grep marslo -o | wc -l 3 # or $ find . -name file.txt | xargs -e grep \"token\" -o | wc -l Print 50th char $ awk 'BEGIN{while (a++ Get the common part $ cat a.txt 1 2 3 $ cat b.txt 3 4 5 9 $ comm -12 a.txt b.txt > common $ cat common 3 Revert a word $ echo linux | rev xunil Format a file to a table $ cat a_b 1:1 2:2 3:3 $ column -tns: a_b 1 1 2 2 3 3 Show last n lines in a file $ tail /etc/passwd -n 3 saned:x:115:123::/home/saned:/bin/false marslo:x:1000:1000:Marslo,,,:/home/marslo:/bin/bash mysql:x:1001:1001::/home/mysql:/bin/sh $ tail /etc/passwd -n 2 marslo:x:1000:1000:Marslo,,,:/home/marslo:/bin/bash mysql:x:1001:1001::/home/mysql:/bin/sh Print a file into one line $ cat a 1 2 3 4 5 $ echo $(cat a) 1 2 3 4 5 $ cat a | xargs 1 2 3 4 5 Get the file inode $ l -i a_b 10224132 -rw-r--r-- 1 marslo marslo 10 Feb 21 00:43 a_b All About {Curly Braces} In Bash $ echo 00{1..9} 0{10..99} 100 001 002 003 004 005 006 007 008 009 010 011 012 013 014 015 016 017 018 019 020 021 022 023 024 025 026 027 028 029 030 031 032 033 034 035 036 037 038 039 040 041 042 043 044 045 046 047 048 049 050 051 052 053 054 055 056 057 058 059 060 061 062 063 064 065 066 067 068 069 070 071 072 073 074 075 076 077 078 079 080 081 082 083 084 085 086 087 088 089 090 091 092 093 094 095 096 097 098 099 100 $ dec2bin=({0..1}{0..1}{0..1}{0..1}{0..1}{0..1}{0..1}{0..1}) $ echo ${dec2bin[1]} 00000001 $ echo ${dec2bin[0]} 00000000 $ echo ${dec2bin[255]} 11111111 $ month=(\"Jan\" \"Feb\" \"Mar\" \"Apr\" \"May\" \"Jun\" \"Jul\" \"Aug\" \"Sep\" \"Oct\" \"Nov\" \"Dec\") $ echo ${month[5]} Jun $ echo {10..0..2} 10 8 6 4 2 0 $ echo {1..100..3} 1 4 7 10 13 16 19 22 25 28 31 34 37 40 43 46 49 52 55 58 61 64 67 70 73 76 79 82 85 88 91 94 97 100 Fast copy or moving or someting (Detials -> Brace Expansion) Example 1:$ ls | grep foo $ touch foo{1,2,3} $ ls | grep foo foo1 foo2 foo3 Example 2 $ ls | grep foo $ touch foo-{a..d} $ ls | grep foo foo-a foo-b foo-c foo-d Example 3 $ ls foo-* foo-a foo-b foo-c foo-d $ mv foo-{a,} $ ls foo-* foo- foo-b foo-c foo-d Example 4 $ mkdir -p test/{a,b,c,d} $ tree test/ test/ ├── a ├── b ├── c └── d 4 directories, 0 files Multiple Directories Creation $ mkdir sa{1..50} $ mkdir -p sa{1..50}/sax{1..50} $ mkdir {a-z}12345 $ mkdir {1,2,3} $ mkdir test{01..10} $ mkdir -p `date '+%y%m%d'`/{1,2,3} $ mkdir -p $USER/{1,2,3} Copy a File to Multipule Folder $ echo dir1 dir2 dir3 | xargs -n 1 cp file1 # OR $ echo dir{1..10} | xargs -n 1 cp file1 find and replace $ find . -type f -name '*.md' -exec sed -i 's///g' {} + Shell Parameter Expansion $ x='aabbcc' $ echo ${x#a*b} bcc $ echo ${x#a} abbcc $ echo ${x##a} abbcc $ echo ${x%b*c} aab $ echo ${x%%b*c} aa $ echo ${x%c} aabbc $ echo ${x%%c} aabbc Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:11 "},"linux/util/colors.html":{"url":"linux/util/colors.html","title":"colors & prompt","keywords":"","body":" Table of Contents generated with DocToc scripts bash prompt reference: Bash tips: Colors and formatting (ANSI/VT100 Control sequences) Bash Colors color grid What color codes can I use in my PS1 prompt? Colours and Cursor Movement With tput scripts bash 256 colors function 256color() { for i in {0..255}; do echo -e \"\\e[38;05;${i}m█${i}\"; done | column -c 180 -s ' '; echo -e \"\\e[m\" } #!/bin/bash # This program is free software. It comes without any warranty, to # the extent permitted by applicable law. You can redistribute it # and/or modify it under the terms of the Do What The Fuck You Want # To Public License, Version 2, as published by Sam Hocevar. See # http://sam.zoy.org/wtfpl/COPYING for more details. for fgbg in 38 48 ; do # Foreground / Background for color in {0..255} ; do # Colors # Display the color printf \"\\e[${fgbg};5;%sm %3s \\e[0m\" $color $color # Display 6 colors per lines if [ $((($color + 1) % 6)) == 4 ] ; then echo # New line fi done echo # New line done exit 0 colors and formatting #!/bin/bash # This program is free software. It comes without any warranty, to # the extent permitted by applicable law. You can redistribute it # and/or modify it under the terms of the Do What The Fuck You Want # To Public License, Version 2, as published by Sam Hocevar. See # http://sam.zoy.org/wtfpl/COPYING for more details. #Background for clbg in {40..47} {100..107} 49 ; do #Foreground for clfg in {30..37} {90..97} 39 ; do #Formatting for attr in 0 1 2 4 5 7 ; do #Print the result echo -en \"\\e[${attr};${clbg};${clfg}m ^[${attr};${clbg};${clfg}m \\e[0m\" done echo #Newline done done exit 0 for attr in 0 1 2 3 4 5 6 7; do echo \"------------------------------------------------\" printf \"ESC[%s;Foreground;Background - \\n\" $attr for fore in 30 31 32 33 34 35 36 37; do for back in 40 41 42 43 44 45 46 47; do printf '\\033[%s;%s;%sm %02s;%02s\\033[0m' $attr $fore $back $fore $back done printf '\\n' done printf '\\033[0m' done solarized color #!/bin/bash # solarized ansicolors (exporting for grins) export base03='\\033[0;30;40m' export base02='\\033[1;30;40m' export base01='\\033[0;32;40m' export base00='\\033[0;33;40m' export base0='\\033[0;34;40m' export base1='\\033[0;36;40m' export base2='\\033[0;37;40m' export base3='\\033[1;37;40m' export yellow='\\033[1;33;40m' export orange='\\033[0;31;40m' export red='\\033[1;31;40m' export magenta='\\033[1;35;40m' export violet='\\033[0;35;40m' export blue='\\033[1;34;40m' export cyan='\\033[1;36;40m' export green='\\033[1;32;40m' export reset='\\033[0m' colors () { echo -e \"base03 ${base03}Test$reset\" echo -e \"base02 ${base02}Test$reset\" echo -e \"base01 ${base01}Test$reset\" echo -e \"base00 ${base00}Test$reset\" echo -e \"base0 ${base0}Test$reset\" echo -e \"base1 ${base1}Test$reset\" echo -e \"base2 ${base2}Test$reset\" echo -e \"base3 ${base3}Test$reset\" echo -e \"yellow ${yellow}Test$reset\" echo -e \"orange ${orange}Test$reset\" echo -e \"red ${red}Test$reset\" echo -e \"magenta ${magenta}Test$reset\" echo -e \"violet ${violet}Test$reset\" echo -e \"blue ${blue}Test$reset\" echo -e \"cyan ${cyan}Test$reset\" echo -e \"green ${green}Test$reset\" } colors prompt reference: Bash/Prompt customization Colors using tput PS1=\"\\[$(tput setaf 0)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 1)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 2)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 3)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 4)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 5)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 6)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 7)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 8)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 9)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 10)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 11)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 12)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 13)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 14)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 15)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 16)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 17)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 18)\\]my prompt\\[$(tput sgr0)\\]> \" or $ DEFAULT=\"\\[$(tput setaf 3)\\]\" # or '\\[\\033[1;38;5;3m\\]' or '\\[\\e[1;33m\\]' $ ifDEFAULT='\\[\\e[1\\;33m\\]' # or '\\[\\033[1\\;38\\;5\\;3m\\]' $ ifRED='\\[\\e[1\\;31m\\]' # or '\\[\\033[1\\;38\\;5\\;1m\\]' $ PS1=\"${DEFAULT}my prompt${RESET} \\$( if [ \\$? != 0 ]; then echo -e ${ifRED}\\\\$; else echo -e ${ifDEFAULT}\\\\$; fi) ${RESET}\" right prompt rightprompt() { printf \"%*s\" $COLUMNS \"right prompt\" } PS1='\\[$(tput sc; rightprompt; tput rc)\\]left prompt > ' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:11 "},"linux/util/tricky.html":{"url":"linux/util/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc save & restore screen tput echo Terminfo escape sequences others clear screen show TERM show terminal width reference Terminal codes (ANSI/VT100) introduction save & restore screen tput clear$ tput smcup restore$ tput rmcup echo save$ echo -e '\\033[?47h' restore$ echo -e '\\033[?47l' Terminfo escape sequences $ infocmp ... colors#256, cols#80, it#8, lines#24, pairs#32767, bel=^G, blink=\\E[5m, bold=\\E[1m, cbt=\\E[Z, civis=\\E[?25l, clear=\\E[H\\E[2J, cnorm=\\E[?12l\\E[?25h, cr=^M, ... others clear screen $ tput home show TERM $ tput color show terminal width $ tput cols Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:11 "},"linux/disk.html":{"url":"linux/disk.html","title":"disk","keywords":"","body":" Table of Contents generated with DocToc nfs mount a nfs check nfs mount disconnect the mount setup nfs mount by default server boot LVM check status nfs # example nfs server: 1.2.3.4 sub-folder: /a/b mount to local: /mnt/mynfs mount a nfs $ sudo mkdir -p /mnt/mynfs $ sudo mount -t nfs 1.2.3.4:/a/b /mnt/mynfs test if sub-folder exists in remote nfs server $ showmount -e 1.2.3.4 | grep '/a/b' environment setup # centos $ yum install nfs-utils nfs-utils-lib $ yum install portmap (not required with NFSv4) # ubuntu $ apt-get install nfs-utils nfs-utils-lib check nfs mount $ df -h -F nfs [ | column -t ] $ mount | column -t | grep -E 'type.*nfs $ findmnt /mnt/mynfs disconnect the mount $ sudo umount /mnt/mynfs setup nfs mount by default server boot $ sudo bash -c \"cat > /etc/fstab\" LVM check status lsblk pvs lvs vgs pvscan lvscan pvdisplay vgdisplay lvdisplay fdisk -l sfdisk -l -uM lshw -class disk hwinfo --block --short Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:12 "},"linux/network.html":{"url":"linux/network.html","title":"network","keywords":"","body":" Table of Contents generated with DocToc get into get IP address by hostname get current IP address get Mac address check remote server dns scan route get into get IP address by hostname ping & sed $ ping -q -c 1 -t 1 github.com | sed -n -re 's:^PING.*\\(([0-9\\.]{7,15})\\).*$:\\1:p' dig $ dig +short github.com # or $ dig github.com | awk '/^;; ANSWER SECTION:$/ { getline ; print $5 }' nslookup $ nslookup github.com | awk '/Name:/{getline; print $2;}' get current IP address $ githubIP=$(dig +short github.com | head -1) $ interface=$(ip route get ${githubIP} | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') $ ipaddr=$(ip a s ${interface} | sed -rn 's|\\W*inet[^6]([0-9\\.]{7,15}).*$|\\1|p') get Mac address $ githubIP=$(dig +short github.com | head -1) $ interface=$(ip route get ${githubIP} | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') $ macaddr=$(ip link show ${interface} | sed -rn 's|.*ether ([0-9a-fA-F:]{17}).*$|\\1|p' | sed 's|:||g' | tr [a-z] [A-Z]) dig $ dig +noall +answer check remote server dns $ for _i in {1..10}; do echo -e \"\\n\\n ~~~> myserver_${i}\" ssh -q marslo@myserver_${_i} \"cat /etc/resolv.conf | sed -nre 's:^nameserver\\s([0-9.]+):\\1:p' | xargs -L1 /usr/bin/ping -c 1\" done scan scan 80 or 22 in particular setment $ nmap -sT -p 80 -oG - 10 - 1.2.3.* [| grep open] $ nmap -sT -p 22 -oG - 10 - 1.2.3.* [| grep open] route Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:10 "},"linux/system.html":{"url":"linux/system.html","title":"system","keywords":"","body":" Table of Contents generated with DocToc system info check hardware process sogou Pinyin input method specified terminal size logout about whatis user management system info get hardware info more $ sudo dmidecode -s System Information $ sudo dmidecode | grep -A3 '^System Information' System Information Manufacturer: HPE Product Name: ProLiant DL380 Gen10 Version: Not Specified # or $ inxi -M Machine: Type: Server Mobo: HPE model: ProLiant DL380 Gen10 serial: UEFI: HPE v: U30 date: 06/15/2018 # or $ sudo inxi --dmidecode -Mxxx Machine: Type: Rack Mount Chassis Mobo: HPE model: ProLiant DL380 Gen10 serial: PFARA%%LMAZ6XB BIOS: HPE v: U30 rev: 1.40 date: 06/15/2018 rom size: 16384 kB Manufacturer $ sudo dmidecode -s system-manufacturer HPE # or $ sudo dmidecode -s baseboard-manufacturer HPE # or $ cat /sys/devices/virtual/dmi/id/sys_vendor HPE uuid $ sudo dmidecode | grep -i uuid | awk '{print $2}' | tr '[:upper:]' '[:lower:]' Product Name $ sudo dmidecode -s system-product-name ProLiant DL380 Gen10 # or $ sudo dmidecode -s baseboard-product-name ProLiant DL380 Gen10 # or $ cat /sys/devices/virtual/dmi/id/product_name ProLiant DL380 Gen10 cpu cores $ cat /proc/cpuinfo | egrep \"core id|physical id\" | tr -d \"\\n\" | sed s/physical/\\\\nphysical/g | grep -v ^$ | sort | uniq | wc -l 36 network speed $ ifstat -n -i en7 en7 KB/s in KB/s out 7.35 1.15 4.91 1.02 6.05 0.80 8.36 1.78 show PATH $ echo src::${PATH} | awk 'BEGIN{pwd=ENVIRON[\"PWD\"];RS=\":\";FS=\"\\n\"}!$1{$1=pwd}$1!~/^\\//{$1=pwd\"/\"$1}{print $1}' /home/marslo/src /home/marslo /home/marslo/.vim/tools/bin /usr/local/mysql/bin /usr/local/bcompare/bin /usr/lib/lightdm/lightdm /usr/local/sbin /usr/local/bin /usr/sbin /usr/bin /sbin /bin /usr/games /usr/local/games OR $ echo \"${PATH//:/$'\\n'}\" clear duplicated PATH $ export PATH=`echo -n $PATH | awk -v RS=\":\" '{ if (!x[$0]++) {printf s $0; s=\":\"} }'` set DNS for ubuntu $ cat /etc/resolv.conf # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8) # DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN nameserver 8.8.8.8 nameserver 8.8.4.4 nameserver 127.0.1.1 $ cat /etc/resolvconf/resolv.conf.d/head # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8) # DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN nameserver 8.8.8.8 nameserver 8.8.4.4 $ sudo resolvconf -u # or $ cat /etc/dhcp/dhclient.conf | grep \"prepend domain-name-servers\" prepend domain-name-servers 8.8.8.8, 8.8.4.4; # or $ cat /etc/network/interfaces | grep dns dns-nameservers 8.8.8.8 8.8.4.4 disable firewall $ sudo systemctl stop firewalld $ sudo systemctl disable firewalld $ sudo systemctl mask firewalld check result$ sudo systemctl is-enabled firewalld $ sudo systemctl is-active firewalld $ sudo firewall-cmd --state change net.bridge $ sudo modprobe br_netfilter $ sudo sysctl net.bridge.bridge-nf-call-iptables=1 $ sudo sysctl net.bridge.bridge-nf-call-ip6tables=1 # OR $ sudo bash -c \"cat > /etc/sysctl.d/k8s.conf\" check status$ sudo sysctl --system off swap $ sudo swapoff -a $ sudo bash -c \"/usr/bin/sed -e 's:^\\\\(.*swap.*\\\\)$:# \\\\1:' -i /etc/fstab\" disable selinux $ setenforce 0 $ sudo bash -c \"/usr/bin/sed 's/^SELINUX=enforcing$/SELINUX=permissive/' -i /etc/selinux/config\" Get the public IP Address $ curl ifconfig.me check hardware check CPU support 64 bit or not $ sudo dmidecode --type=processor | grep -i -A 1 charac Characteristics: 64-bit capable get the computer version $ sudo dmidecode | grep -i prod Product Name: Vostro 5560 Product Name: 04YDT0 print memory only $ ps -o comm,%mem,args -u marslo | more COMMAND %MEM COMMAND gnome-keyring-d 0.0 /usr/bin/gnome-keyring-daemon --daemonize --login init 0.0 init --user ssh-agent 0.0 ssh-agent dbus-daemon 0.0 dbus-daemon --fork --session --address=unix:abstract=/tmp/dbus-i5FUVjzADG upstart-event-b 0.0 upstart-event-bridge window-stack-br 0.0 /usr/lib/i386-linux-gnu/hud/window-stack-bridge upstart-dbus-br 0.0 upstart-dbus-bridge --daemon --session --user --bus-name session upstart-dbus-br 0.0 upstart-dbus-bridge --daemon --system --user --bus-name system upstart-file-br 0.0 upstart-file-bridge --daemon --user ibus-daemon 0.1 /usr/bin/ibus-daemon --daemonize --xim .... cat /etc/cpuinfo $ lscpu Architecture: i686 CPU op-mode(s): 32-bit, 64-bit Byte Order: Little Endian CPU(s): 4 On-line CPU(s) list: 0-3 .... process find the zombie process $ ps aux | awk '{ print $8 \" \" $2 \" \" $11}' | grep -w Z sort process by PID $ ps -axww check the group PID $ ps -xj sogou Pinyin input method $ sudo add-apt-repository ppa:fcitx-team/nightly $ sudo apt-get update $ sudo apt-get install fcitx-sogoupinyin $ # sudo apt-get remove ibus specified terminal size $ gnome-terminal --geometry=123x42+0+0 logout $ pkill -KILL -u ${useranme} about whatis $ whatis whois whois (1) - client for the whois directory service $ whatis which which (1) - locate a command $ whatis whereis whereis (1) - locate the binary, source, and manual page files for a command user management create new user in Ubuntu create user devops $ useradd -c \"comments here\" \\ -d \"/home/devops\" \\ -u 1000 \\ -g 1000 \\ -m \\ -s /bin/bash \\ devops full steps $ uid='1000' $ gid='1000' $ user='devops' $ mkdir -p /home/${user} $ chown -R ${uid}:${gid} /home/${user} $ groupadd -g ${gid} ${user} $ useradd -c \"create user ${user}\" \\ -d \"/home/${user}\" \\ -u ${uid} \\ -g ${gid} \\ -m \\ -s /bin/bash \\ ${user} add user into group $ usermod -a -G adm,root,sudo,docker devops list all groups$ getent group Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:11 "},"linux/ubuntu/ubuntu.html":{"url":"linux/ubuntu/ubuntu.html","title":"ubuntu","keywords":"","body":" Table of Contents generated with DocToc Get Package name by command Search package name for apt-get Install Ubuntu Theme Open Font Viewer and install font Show launcher icon Show the softer renderer Specified Context Menu Disable Ubuntu Desktop notification Recode activity as a GIF file (Inspired from here and here) Goldendict Installation Get Package name by command $ apt-cache search mkpasswd whois - intelligent WHOIS client libstring-mkpasswd-perl - Perl module implementing a random password generator Search package name for apt-get $ sudo apt-cache search chrome browser chromium-browser - Chromium browser chromium-chromedriver - WebDriver driver for the Chromium Browser cloudprint - Server for Google Cloud Print collabtive - Web-based project management software epiphany-browser - Intuitive GNOME web browser jsxgraph - Interactive Geometry with JavaScript kpartsplugin - Netscape-compatible plugin to embed KDE file-viewers into browser libjs-excanvas - HTML5 Canvas for Internet Explorer libjs-jquery-jplayer - HTML5 Audio & Video for jQuery with a Flash fallback libjs-jquery-jush - jQuery Syntax Highlighter google-chrome-beta - The web browser from Google google-chrome-stable - The web browser from Google google-chrome-unstable - The web browser from Google Install Ubuntu Theme $ sudo add-apt-repository ppa:noobslab/themes $ sudo apt-get update $ sudo apt-get install nokto-theme Open Font Viewer and install font $ sudo gnome-font-viewer ~/Tools/Monaco/Monaco_Linux.TTF Show launcher icon $ gsettings get com.canonical.Unity.Launcher favorites ['application://nautilus.desktop', 'application://gnome-terminal.desktop', 'application://firefox.desktop', 'unity://running-apps', 'application://gvim.desktop', 'unity://desktop-icon', 'unity://expo-icon', 'unity://devices'] Show the softer renderer $ /usr/lib/nux/unity_support_test -p OpenGL vendor string: VMware, Inc. OpenGL renderer string: Gallium 0.4 on SVGA3D; build: RELEASE; OpenGL version string: 2.1 Mesa 10.1.0 Not software rendered: yes Not blacklisted: yes GLX fbconfig: yes GLX texture from pixmap: yes GL npot or rect textures: yes GL vertex program: yes GL fragment program: yes GL vertex buffer object: yes GL framebuffer object: yes GL version is 1.4+: yes Unity 3D supported: yes Specified Context Menu $ sudo apt-get install nautilus-actions $ nautilus -q $ utilus-actions-config-tool Disable Ubuntu Desktop notification $ sudo chmod -x /usr/lib/notify-osd/notify-osd Recode activity as a GIF file (Inspired from here and here) $ sudo add-apt-repository ppa:fossfreedom/byzanz $ sudo apt-get update && sudo apt-get install byzanz Goldendict Installation $ git clone git@github.com:goldendict/goldendict.git $ sudo apt-get install liblzma-dev qt4-qmake hunspell-dev hunspell build-essential libvorbis-dev zlib1g-dev libhunspell-dev x11proto-record-dev libqt4-dev libqtwebkit-dev libxtst-dev liblzo2-dev libbz2-dev libao-dev libavutil-dev libavformat-dev libtiff5-dev $ cd goldendict/ $ qmake-qt4 $ qmake \"CONFIG+=no_epwing_support\" $ make && sudo make install Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:12 "},"linux/ubuntu/apps.html":{"url":"linux/ubuntu/apps.html","title":"apps","keywords":"","body":" Table of Contents generated with DocToc Hardwares Hardwares Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:12 "},"linux/ubuntu/installation.html":{"url":"linux/ubuntu/installation.html","title":"installation","keywords":"","body":" Table of Contents generated with DocToc preconfig install dependencies setup account setup MOTD get subnet ip address get public IP address applications shadowsocks shadowsocks-libev terminal configurations vncserver artifactory add insecure-regiestry docker login & logout docker pull docker push X Windows get screen solution desktop sharing Reference preconfig install dependencies $ sudo apt install -y apt-file autoconf automake bash-completion* binutils binutils-doc bison build-essential cmake cpp cpp-5 cpp-doc curl debian-keyring dlocate dos2unix dpkg-dev dstat fakeroot flex g++ g++-5 g++-5-multilib g++-multilib gcc gcc-5 gcc-5-doc gcc-5-locales gcc-5-multilib gcc-doc gcc-multilib gdb git htop ifstat iftop iptables-persistent jq landscape-common libasan2 libasan2-dbg libatomic1 libatomic1-dbg libbz2-dev libc-dev-bin libc6-dev libcc1-0 libcilkrts5 libcilkrts5-dbg libexpat-dev libexpat1-dev libfakeroot libgcc1-dbg libgomp1-dbg libisl15 libitm1 libitm1-dbg liblsan0 liblsan0-dbg liblxc1 libmpc3 libmpx0 libmpx0-dbg libncurses-dev libncurses5-dev libncursesw5-dev libpython-all-dev libpython2.7 libquadmath0 libquadmath0-dbg libsensors4 libssl-dev libstdc++-5-dev libstdc++-5-doc libstdc++6-5-dbg libtool libtsan0 libtsan0-dbg libubsan0 libubsan0-dbg linux-libc-dev lxc-common lxcfs m4 mailutils make manpages-dev ncurses-doc net-tools netfilter-persistent policycoreutils python-docutils python-pip python-setuptools-doc ruby sysstat texinfo traceroute tree update-motd update-notifier-common zlib1g-dev setup account $ sudo usermod -a -G sudo,adm,root,docker devops setup MOTD $ sudo chmod -x /etc/update-motd.d/00-header \\ /etc/update-motd.d/10-help-text \\ /etc/update-motd.d/50-motd-news $ cat /etc/landscape/client.conf [sysinfo] exclude_sysinfo_plugins = Temperature, LandscapeLink EOF get subnet ip address $ ip addr show eno1 | grep inet | awk '{ print $2; }' | sed 's/\\/.*$//' 192.168.1.105 fe80::e5ca:1027:b572:9998 get public IP address $ curl -4 icanhazip.com 182.150.46.248 applications shadowsocks server $ sudo apt install m2crypto git python-pip $ pip install --upgrade pip $ pip install git+https://github.com/shadowsocks/shadowsocks.git@master $ sudo ln -sf /home/marslo/.local/bin/ssserver /usr/local/bin/ssserver start $ sudo bash -c 'cat > /etc/rc.local' client ubuntu $ sudo add-apt-repository ppa:hzwhuang/ss-qt5 Shadowsocks-Qt5 is a cross-platform Shadowsocks GUI client. Shadowsocks is a lightweight tool that helps you bypass firewall(s). This PPA mainly includes packages for Shadowsocks-Qt5, which means it also includes libQtShadowsocks packages. More info: https://launchpad.net/~hzwhuang/+archive/ubuntu/ss-qt5 Press [ENTER] to continue or Ctrl-c to cancel adding it. gpg: keybox '/tmp/tmpaegs6_x4/pubring.gpg' created gpg: /tmp/tmpaegs6_x4/trustdb.gpg: trustdb created gpg: key 6DA746A05F00FA99: public key \"Launchpad PPA for Symeon Huang\" imported gpg: Total number processed: 1 gpg: imported: 1 OK $ sudo apt update $ sudo apt install shadowsocks-qt5 Others $ sudo apt install python-pip $ sudo pip install genpac shadowsocks-libev service started by docker image teddysun/shadowsocks-libev $ mkdir -p /etc/shadowsocks-libev $ sudo bash -c \"cat > /etc/shadowsocks-libev/config.json\" started by /etc/init.d/shadowsocks-libev $ wget --no-check-certificate -O shadowsocks-all.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh $ chmod +x shadowsocks-all.sh $ ./shadowsocks-all.sh 2>&1 | tee shadowsocks-all.log ... Which Shadowsocks server you'd select: 1) Shadowsocks-Python 2) ShadowsocksR 3) Shadowsocks-Go 4) Shadowsocks-libev Please enter a number (Default Shadowsocks-Python): 4 You choose = Shadowsocks-libev ... [Info] Starting install package autoconf Do you want install simple-obfs for Shadowsocks-libev? [y/n] (default: n): y You choose = y Please select obfs for simple-obfs: 1) http 2) tls Which obfs you'd select(Default: http): 1 obfs = http ... service $ sudo /etc/init.d/shadowsocks-libev start $ sudo /etc/init.d/shadowsocks-libev stop $ sudo /etc/init.d/shadowsocks-libev restart $ sudo /etc/init.d/shadowsocks-libev status config $ /etc/shadowsocks-libev/config.json { \"server\":\"0.0.0.0\", \"server_port\": 1111, \"password\":\"mypassword\", \"timeout\":300, \"user\":\"nobody\", // optinal \"method\":\"aes-256-cfb\", \"fast_open\":false, \"nameserver\":\"1.0.0.1\", // be careful for dns resolve in private network \"mode\":\"tcp_and_udp\", \"plugin\":\"obfs-server\", \"plugin_opts\":\"obfs=http\" } check status $ sudo lsof -i:1111 $ sudo netstatus -tunpla | grep 1111 client plugin plugin opts simple-obfs obfs=http;obfs-host=www.google.com terminal configurations Backup $ dconf dump /org/gnome/terminal/ > ubuntu1710_terminal_backup.bak Restore $ dconf load /org/gnome/terminal/ Reset $ dconf reset -f /org/gnome/terminal List $ gsettings list-recursively | grep -i org.gnome.Terminal Click to check details $ gsettings list-recursively | grep -i org.gnome.Terminal org.gnome.Terminal.ProfilesList list ['b1dcc9dd-5262-4d8d-a863-c897e6d979b9'] org.gnome.Terminal.ProfilesList default 'b1dcc9dd-5262-4d8d-a863-c897e6d979b9' org.gnome.shell favorite-apps ['firefox.desktop', 'org.gnome.Nautilus.desktop', 'org.gnome.Terminal.desktop'] org.gnome.Terminal.Legacy.Settings new-terminal-mode 'window' org.gnome.Terminal.Legacy.Settings menu-accelerator-enabled true org.gnome.Terminal.Legacy.Settings tab-position 'top' org.gnome.Terminal.Legacy.Settings confirm-close true org.gnome.Terminal.Legacy.Settings shell-integration-enabled true org.gnome.Terminal.Legacy.Settings theme-variant 'dark' org.gnome.Terminal.Legacy.Settings default-show-menubar true org.gnome.Terminal.Legacy.Settings mnemonics-enabled false org.gnome.Terminal.Legacy.Settings schema-version uint32 3 org.gnome.Terminal.Legacy.Settings encodings ['UTF-8'] org.gnome.Terminal.Legacy.Settings shortcuts-enabled true org.gnome.Terminal.Legacy.Settings tab-policy 'automatic' org.gnome.Terminal.Legacy.Keybindings toggle-menubar 'disabled' org.gnome.Terminal.Legacy.Keybindings reset-and-clear 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-14 'disabled' org.gnome.Terminal.Legacy.Keybindings zoom-normal '0' org.gnome.Terminal.Legacy.Keybindings read-only 'disabled' org.gnome.Terminal.Legacy.Keybindings new-profile 'disabled' org.gnome.Terminal.Legacy.Keybindings zoom-out 'minus' org.gnome.Terminal.Legacy.Keybindings move-tab-left 'Page_Up' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-20 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-21 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-22 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-23 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-24 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-25 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-26 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-27 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-28 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-29 'disabled' org.gnome.Terminal.Legacy.Keybindings zoom-in 'plus' org.gnome.Terminal.Legacy.Keybindings detach-tab 'disabled' org.gnome.Terminal.Legacy.Keybindings move-tab-right 'Page_Down' org.gnome.Terminal.Legacy.Keybindings close-tab 'w' org.gnome.Terminal.Legacy.Keybindings paste 'v' org.gnome.Terminal.Legacy.Keybindings reset 'disabled' org.gnome.Terminal.Legacy.Keybindings new-tab 't' org.gnome.Terminal.Legacy.Keybindings find-previous 'H' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-30 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-31 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-32 'disabled' org.gnome.Terminal.Legacy.Keybindings select-all 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-34 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-35 'disabled' org.gnome.Terminal.Legacy.Keybindings preferences 'disabled' org.gnome.Terminal.Legacy.Keybindings prev-tab 'Page_Up' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-33 'disabled' org.gnome.Terminal.Legacy.Keybindings find-next 'G' org.gnome.Terminal.Legacy.Keybindings find 'F' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-1 '1' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-2 '2' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-3 '3' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-4 '4' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-5 '5' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-6 '6' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-7 '7' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-8 '8' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-9 '9' org.gnome.Terminal.Legacy.Keybindings help 'F1' org.gnome.Terminal.Legacy.Keybindings copy 'c' org.gnome.Terminal.Legacy.Keybindings close-window 'q' org.gnome.Terminal.Legacy.Keybindings new-window 'n' org.gnome.Terminal.Legacy.Keybindings save-contents 'disabled' org.gnome.Terminal.Legacy.Keybindings find-clear 'J' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-10 '0' org.gnome.Terminal.Legacy.Keybindings full-screen 'F11' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-12 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-13 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-11 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-15 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-16 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-17 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-18 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-19 'disabled' org.gnome.Terminal.Legacy.Keybindings profile-preferences 'disabled' org.gnome.Terminal.Legacy.Keybindings next-tab 'Page_Down' vncserver install $ sudo apt install vnc4server $ sudo apt install gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal artifactory add insecure-regiestry $ cat ~/.docker/daemon.json { \"debug\" : true, \"experimental\" : true, \"insecure-registries\" : [\"www.artifactory.mycompany.com\", \"www.artifactory.mycompany.com:2500\", \"www.artifactory.mycompany.com:2501\", \"docker-1.artifactory\", \"docker-1.artifactory:443\"] } $ sudo systemctl daemon-reload $ sudo systemctl restart docker docker login & logout $ docker --debug -l debug login --username admin https://docker-1.artifactory Password: Login Succeeded $ docker --debug -l debug logout docker-1.artifactory Removing login credentials for docker-1.artifactory docker pull $ docker pull docker-1.artifactory/nginx:latest latest: Pulling from nginx e7bb522d92ff: Pull complete 0f4d7753723e: Pulling fs layer 91470a14d63f: Download complete 0f4d7753723e: Pull complete 91470a14d63f: Pull complete Digest: sha256:3eff18554e47c4177a09cea5d460526cbb4d3aff9fd1917d7b1372da1539694a Status: Downloaded newer image for docker-1.artifactory/nginx:latest docker push $ docker pull hello-world $ docker tag hello-world docker-1.artifactory/bello-marslo:2.0 $ docker login --username admin docker-1.artifactory $ docker push docker-1.artifactory/bello-marslo:2.0 X Windows get screen solution $ xrandr --verbose Screen 0: minimum 320 x 200, current 1920 x 1080, maximum 8192 x 8192 XWAYLAND0 connected 1920x1080+0+0 (0x22) normal (normal left inverted right x axis y axis) 480mm x 270mm Identifier: 0x21 Timestamp: 3807 Subpixel: unknown Gamma: 1.0:1.0:1.0 Brightness: 0.0 Clones: CRTC: 0 CRTCs: 0 Transform: 1.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 1.000000 filter: 1920x1080 (0x22) 173.000MHz -HSync +VSync *current +preferred h: width 1920 start 2048 end 2248 total 2576 skew 0 clock 67.16KHz v: height 1080 start 1083 end 1088 total 1120 clock 59.96Hz desktop sharing enable desktop sharing ##!/bin/bash export DISPLAY=:0 read -e -p \"VNC Password: \" -i \"ubuntu\" password dconf write /org/gnome/desktop/remote-access/enabled true dconf write /org/gnome/desktop/remote-access/prompt-enabled false dconf write /org/gnome/desktop/remote-access/authentication-methods \"['vnc']\" dconf write /org/gnome/desktop/remote-access/require-encryption false08/03/2018 dconf write /org/gnome/desktop/remote-access/vnc-password \\\"\\'$(echo -n $password | base64)\\'\\\" dconf dump /org/gnome/desktop/remote-access/ ## sudo service lightdm restart OR $ vino-preference $ dconf-editor start x server $ export DISPLAY=:0 $ /usr/lib/vino/vino-server --display=:0 & Reset vnc password $ echo -n 'awesome' | base64 $ gconftool-2 -s -t string /desktop/gnome/remote_access/vnc_password $(echo -n \"\" | base64) $ gconftool-2 --type string --set /desktop/gnome/remote_acess/vnc_password '123456' Wayland known error cat Check using Wayland or Xorg $ echo $XDG_SESSION_TYPE Ubuntu: Wayland (Wayland) Ubuntu on Xorg: Xorg (X11) Reference 使用ssl模块配置同时支持http和https并存 How To Create an SSL Certificate on Nginx for Ubuntu 14.04 How To Create a Self-Signed SSL Certificate for Nginx in Ubuntu 16.04 Enabling Https with Nginx Enable SSL for HTTPS Configuration on nginx Nginx+Https配置 Test an insecure registry Protect the Docker daemon socket Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:12 "},"linux/ubuntu/repo.html":{"url":"linux/ubuntu/repo.html","title":"repo","keywords":"","body":" Table of Contents generated with DocToc Reference Reference Google Linux Software Repositories Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:12 "},"linux/ubuntu/ssl.html":{"url":"linux/ubuntu/ssl.html","title":"ssl","keywords":"","body":" Table of Contents generated with DocToc SSL Cert Create Cert for server CA (root cert) Cert for Server Sign the server cert with CA Cert for Client Update the file perm Check certs Certificate working with Nginx Certificate working with Client Add certifactory in MacOS Find the added cert in MacOS Remove the cert in MacOS Other methods If you enter '.', the field will be left blank. Artifactory HTTPS If you enter '.', the field will be left blank. If you enter '.', the field will be left blank. SSL Cert Create Cert for server CA (root cert) $ openssl genrsa -aes256 -out www.artifactory.mycompany.com-ca.key 2048 $ openssl req -new -x509 -days 365 -key www.artifactory.mycompany.com-ca.key -sha256 -out www.artifactory.mycompany.com-ca.crt -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com\" Click to check details $ openssl genrsa -aes256 -out www.artifactory.mycompany.com-ca.key 2048 Generating RSA private key, 2048 bit long modulus ....................................................................+++ ...................................................+++ unable to write 'random state' e is 65537 (0x10001) Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory Verifying - Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory $ openssl req -new -x509 -days 365 -key www.artifactory.mycompany.com-ca.key -sha256 -out www.artifactory.mycompany.com-ca.crt -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory Cert for Server $ openssl genrsa -out www.artifactory.mycompany.com-server.key 2048 $ openssl req -sha256 -new -key www.artifactory.mycompany.com-server.key -out www.artifactory.mycompany.com-server.csr -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" Click to check details $ openssl genrsa -out www.artifactory.mycompany.com-server.key 2048 Generating RSA private key, 2048 bit long modulus ......................................................................+++ ............................................................................................................................................................................................................................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req -sha256 -new -key www.artifactory.mycompany.com-server.key -out www.artifactory.mycompany.com-server.csr -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" Sign the server cert with CA $ echo subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req -days 365 -sha256 -in www.artifactory.mycompany.com-server.csr -CA www.artifactory.mycompany.com-ca.crt -CAkey www.artifactory.mycompany.com-ca.key -CAcreateserial -out www.artifactory.mycompany.com-server.crt -extfile extfile.cnf Click to check details $ echo subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req -days 365 -sha256 -in www.artifactory.mycompany.com-server.csr -CA www.artifactory.mycompany.com-ca.crt -CAkey www.artifactory.mycompany.com-ca.key -CAcreateserial -out www.artifactory.mycompany.com-server.crt -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Getting CA Private Key Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory unable to write 'random state' $ ls extfile.cnf www.artifactory.mycompany.com-ca.key www.artifactory.mycompany.com-server.csr www.srl www.artifactory.mycompany.com-ca.crt www.artifactory.mycompany.com-server.crt www.artifactory.mycompany.com-server.key Cert for Client $ openssl genrsa -out www.artifactory.mycompany.com-client.key $ openssl req -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" -new -key www.artifactory.mycompany.com-client.key -out www.artifactory.mycompany.com-client.csr $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ openssl x509 -req -days 365 -sha256 -in www.artifactory.mycompany.com-client.csr -CA www.artifactory.mycompany.com-ca.crt -CAkey www.artifactory.mycompany.com-ca.key -CAcreateserial -out www.artifactory.mycompany.com-client.cert -extfile extfile.cnf Click to check details $ openssl genrsa -out www.artifactory.mycompany.com-client.key 2048 Generating RSA private key, 2048 bit long modulus ................................................+++ .......................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" -new -key www.artifactory.mycompany.com-client.key -out www.artifactory.mycompany.com-client.csr $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ cat extfile.cnf subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 extendedKeyUsage = serverAuth extendedKeyUsage = clientAuth $ openssl x509 -req -days 365 -sha256 -in www.artifactory.mycompany.com-client.csr -CA www.artifactory.mycompany.com-ca.crt -CAkey www.artifactory.mycompany.com-ca.key -CAcreateserial -out www.artifactory.mycompany.com-client.cert -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Getting CA Private Key Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactor unable to write 'random state' Update the file perm $ sudo chmod -v 0444 www.artifactory.mycompany.com-ca.crt www.artifactory.mycompany.com-server.crt client.cert $ sudo chmod -v 0400 www.artifactory.mycompany.com-ca.key client.key www.artifactory.mycompany.com-server.key Check certs crt $ openssl x509 -noout -text -in www.artifactory.mycompany.com-server.crt openssl x509 ca.crt $ openssl x509 -noout -text -in www.artifactory.mycompany.com-ca.crt Certificate: Data: Version: 3 (0x2) Serial Number: 15145698426239402702 (0xd23054792b3142ce) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Validity Not Before: Jan 2 11:35:31 2018 GMT Not After : Jan 2 11:35:31 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:d0:3f:b6:c5:e5:52:8d:c7:26:3f:e7:0a:7a:5f: c1:71:2a:9e:34:07:7e:10:4a:3d:c4:4f:f7:df:58: 93:0d:fa:00:e8:21:75:6d:d1:45:7d:bd:27:f2:c5: 08:13:8f:4f:be:91:9f:28:19:7e:c3:a7:42:1b:fc: b4:96:21:8a:33:59:79:27:a3:cf:13:3e:cd:92:0d: 7e:b9:9f:0d:01:bf:27:5f:e4:7a:7d:db:69:a3:78: 96:a8:c3:a9:2d:31:28:97:ba:6c:20:17:ab:eb:85: ce:2c:25:e8:3e:a0:8b:c0:0b:b2:a9:e1:ac:9f:e1: 57:35:bb:64:6a:99:2e:8f:27:f1:04:40:a7:16:32: 31:4e:ad:18:5e:9e:0b:dd:42:17:af:8a:58:c6:1a: e9:00:52:97:7b:7a:24:cc:b1:81:8d:b9:20:60:e4: 96:d5:77:82:07:4e:df:9c:3a:26:95:d5:ed:aa:a1: 24:94:64:0e:93:9a:9e:9b:d4:78:6b:46:50:69:05: 19:6a:ff:7b:1d:1b:0f:ce:6b:30:33:c7:99:9d:6a: 30:0c:fc:f8:74:00:df:65:6f:fa:1b:24:0a:73:77: 4d:94:45:27:9b:93:a6:81:37:57:57:6f:e9:ae:e4: 5e:a8:b8:be:31:0f:73:4b:9e:1b:ed:78:5c:48:ec: 0b:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: IP Address:130.147.219.19 X509v3 Subject Key Identifier: 23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Authority Key Identifier: keyid:23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Basic Constraints: CA:TRUE Signature Algorithm: sha256WithRSAEncryption 69:a3:fe:35:63:a5:e8:4e:e6:3e:4f:9d:f6:82:3d:73:f2:a7: 22:c1:46:e5:09:5e:61:81:b7:70:3c:62:ba:43:7d:bd:ac:67: d0:41:ea:a7:b8:41:47:04:bc:41:9a:46:35:31:3f:62:10:7a: 58:73:45:3a:59:3b:41:6b:2b:1e:62:42:b7:7e:c1:6b:92:25: 2a:df:3f:69:b5:26:8e:c7:5d:c6:24:a0:65:21:b7:63:74:60: 7f:3b:0e:9a:80:a4:4f:a2:79:20:19:92:64:60:b7:53:5c:09: 6e:46:6e:7a:d7:ee:ef:f4:2e:27:7a:1a:0e:da:5b:8b:7a:bf: 40:56:9f:16:63:6b:89:ab:48:65:07:45:e0:a0:21:7c:0f:6d: 9c:2a:ab:ca:d0:02:06:8a:39:7a:ea:65:b9:04:13:0f:6b:cd: ea:e5:9f:59:c5:d2:06:b2:e4:c3:cb:ab:59:69:aa:11:e6:08: 49:12:cc:d4:29:21:2b:59:c1:dc:bb:e6:a9:7d:96:68:a4:7b: 61:76:8a:21:a9:69:a5:83:d5:8b:f6:08:4e:c0:34:64:6b:65: 96:ac:ed:cd:c1:0b:54:7d:a9:57:07:77:0c:6a:43:9e:4f:c0: 6c:12:88:e8:cf:34:08:67:af:1c:2f:bb:49:54:1b:17:95:89: b3:2d:c9:5f openssl x509 server.crt $ openssl x509 -noout -text -in www.artifactory.mycompany.com-server.crt Certificate: Data: Version: 3 (0x2) Serial Number: 12625600037876864867 (0xaf37245755cf1763) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Validity Not Before: Jan 2 11:39:47 2018 GMT Not After : Jan 2 11:39:47 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: DNS:www.artifactory.mycompany.com, IP Address:130.147.219.19 X509v3 Extended Key Usage: TLS Web Server Authentication Signature Algorithm: sha256WithRSAEncryption 3d:e8:81:f2:ab:89:47:e2:2c:8c:5a:54:31:c2:2a:11:37:e6: ab:89:ff:d1:c2:8c:8e:3a:7d:d2:1d:28:3e:9e:5f:9e:89:08: 78:2e:16:32:52:e7:35:ab:66:09:a4:83:85:42:55:d6:7c:4f: 37:cf:8d:37:bd:57:d0:00:f2:9c:67:68:a2:ed:49:c6:eb:0f: b7:49:ba:ae:12:35:82:a6:a5:b6:5e:f7:68:08:f7:3f:a1:73: d2:94:3e:7a:d9:5c:e1:e2:ab:12:46:66:9d:59:3a:e1:2d:aa: a6:53:97:40:ac:a3:ca:80:6d:5b:75:dc:c4:ee:10:48:55:2c: 10:00:43:07:e6:c4:16:09:fb:04:5d:78:8e:85:21:21:75:01: a5:af:c0:c0:d1:fd:33:6e:5b:24:8b:f8:e6:1c:df:b7:f1:e5: 38:02:d4:a8:e1:09:93:2e:8d:19:ea:e2:11:3f:c1:fe:75:bb: ef:03:6e:c3:50:77:a5:54:7d:7e:e0:cd:85:20:08:41:38:b2: 86:65:aa:58:51:1b:7b:ed:6a:07:0f:cc:ab:49:d8:34:ec:5d: fd:0d:75:48:81:3c:a5:bc:ce:c0:95:8c:8e:d3:8c:0f:0d:a3: a7:73:70:bc:59:89:7c:42:25:0b:cb:2f:b0:86:4a:46:56:f2: e9:d9:63:f1 csr $ openssl req -noout -text -in www.artifactory.mycompany.com-server.csr openss req $ openssl req -noout -text -in www.artifactory.mycompany.com-server.csr Certificate Request: Data: Version: 0 (0x0) Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) Attributes: a0:00 Signature Algorithm: sha256WithRSAEncryption 74:99:e5:36:44:b4:48:a9:50:83:eb:61:02:37:6c:8a:46:45: 0e:58:04:40:66:55:56:fc:fd:cf:15:a0:31:be:de:3a:16:4f: 9a:46:1d:17:33:7f:38:dd:36:a9:76:e5:92:b2:48:29:60:e7: af:c0:f6:76:0d:9a:a6:40:43:a8:98:75:90:c3:c1:2a:7d:51: 1d:df:1b:50:8b:69:ce:7c:74:cf:03:9d:69:6b:41:7f:ed:bc: f1:6c:c0:93:22:36:5e:f7:8c:d0:f7:f5:0f:dc:51:93:1e:23: cc:12:cd:f3:0e:6c:1b:4e:b2:df:01:86:5b:d0:79:c8:6e:c8: 57:72:a8:dd:81:8a:af:c3:52:e2:ff:e8:f1:3d:6f:cb:e4:a9: 1c:51:58:b9:31:00:c0:88:5e:ca:63:59:f8:d7:82:d4:22:30: 0c:d8:bd:e6:01:11:d2:4a:68:64:d1:8e:d5:a1:19:0c:5a:99: 25:cd:c2:e5:ed:f3:48:e3:c0:7a:00:a3:a8:09:8e:d3:50:2a: 84:29:63:66:50:3e:42:af:43:ea:fa:5b:28:f9:f1:84:89:88: 2e:7f:8d:bf:44:29:83:fa:89:b3:b8:3c:13:98:20:76:6c:d3: 67:ce:03:9e:15:ea:3e:9d:4b:cb:c2:78:ab:57:1d:b7:e8:9e: 81:1b:b5:1f Certificate working with Nginx $ grep ssl_certificate /etc/nginx/sites-enabled/artifactoryv2.conf ssl_certificate /etc/nginx/certs/www.artifactory.mycompany.com/www.artifactory.mycompany.com-server.crt; ssl_certificate_key /etc/nginx/certs/www.artifactory.mycompany.com/www.artifactory.mycompany.com-server.key; Certificate working with Client Add certifactory in MacOS $ sudo security add-trusted-cert -d -r trustRoot -k \"/Library/Keychains/System.keychain\" \"/Users/marslo/Downloads/www.artifactory.mycompany.com-ca.crt\" Find the added cert in MacOS $ security find-certificate -a -c -Z $ security find-certificate -a -c artifactor -Z | grep SHA-1 SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E $ security list-keychain \"/Users/marslo/Library/Keychains/login.keychain-db\" \"/Library/Keychains/System.keychain\" Click to check details $ security find-certificate -a -c artifactor -Z SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E keychain: \"/Library/Keychains/System.keychain\" version: 256 class: 0x80001000 attributes: \"alis\"=\"marslo.jiao@mycompany.com\" \"cenc\"=0x00000003 \"ctyp\"=0x00000001 \"hpky\"=0x2332BC619E518E9422305BAE688A7E8E53D2457C \"#2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"issu\"=0x3081A3310B300906035504061302434E3110300E06035504080C075369636875616E3110300E06035504070C074368656E6764753110300E060355040A0C075068696C697073310C300A060355040B0C034344493128302606035504030C1F7077772E61727469666163746F72792E6364692E7068696C6970732E636F6D3126302406092A864886F70D01090116176D6172736C6F2E6A69616F407068696C6970732E636F6D \"0\\201\\2431\\0130\\011\\006\\003U\\004\\006\\023\\002CN1\\0200\\016\\006\\003U\\004\\010\\014\\007Sichuan1\\0200\\016\\006\\003U\\004\\007\\014\\007Chengdu1\\0200\\016\\006\\003U\\004\\012\\014\\007mycompany1\\0140\\012\\006\\003U\\004\\013\\014\\003CDI1(0&\\006\\003U\\004\\003\\014\\037www.artifactory.mycompany.com1&0$\\006\\011*\\206H\\206\\367\\015\\001\\011\\001\\026\\027marslo.jiao@mycompany.com\" \"labl\"=\"www.artifactory.mycompany.com\" \"skid\"=0x2332BC619E518E9422305BAE688A7E8E53D2457C \"#2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"snbr\"=0x00D23054792B3142CE \"\\000\\3220Ty+1B\\316\" \"subj\"=0x3081A3310B300906035504061302434E3110300E06035504080C075369636875616E3110300E06035504070C074368656E6764753110300E060355040A0C075068696C697073310C300A060355040B0C034344493128302606035504030C1F7077772E61727469666163746F72792E6364692E7068696C6970732E636F6D3126302406092A864886F70D01090116176D6172736C6F2E6A69616F407068696C6970732E636F6D \"0\\201\\2431\\0130\\011\\006\\003U\\004\\006\\023\\002CN1\\0200\\016\\006\\003U\\004\\010\\014\\007Sichuan1\\0200\\016\\006\\003U\\004\\007\\014\\007Chengdu1\\0200\\016\\006\\003U\\004\\012\\014\\007mycompany1\\0140\\012\\006\\003U\\004\\013\\014\\003CDI1(0&\\006\\003U\\004\\003\\014\\037www.artifactory.mycompany.com1&0$\\006\\011*\\206H\\206\\367\\015\\001\\011\\001\\026\\027marslo.jiao@mycompany.com\" $ security find-certificate -a -c artifactor -Z -p -m SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E email addresses: marslo.jiao@mycompany.com -----BEGIN CERTIFICATE----- MIIELDCCAxSgAwIBAgIJANIwVHkrMULOMA0GCSqGSIb3DQEBCwUAMIGjMQswCQYD VQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdkdTEQMA4G A1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cuYXJ0aWZh Y3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJzbG8uamlh b0BwaGlsaXBzLmNvbTAeFw0xODAxMDIxMTM1MzFaFw0xOTAxMDIxMTM1MzFaMIGj MQswCQYDVQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdk dTEQMA4GA1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cu YXJ0aWZhY3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJz bG8uamlhb0BwaGlsaXBzLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC ggEBANA/tsXlUo3HJj/nCnpfwXEqnjQHfhBKPcRP999Ykw36AOghdW3RRX29J/LF CBOPT76RnygZfsOnQhv8tJYhijNZeSejzxM+zZINfrmfDQG/J1/ken3baaN4lqjD qS0xKJe6bCAXq+uFziwl6D6gi8ALsqnhrJ/hVzW7ZGqZLo8n8QRApxYyMU6tGF6e C91CF6+KWMYa6QBSl3t6JMyxgY25IGDkltV3ggdO35w6JpXV7aqhJJRkDpOanpvU eGtGUGkFGWr/ex0bD85rMDPHmZ1qMAz8+HQA32Vv+hskCnN3TZRFJ5uTpoE3V1dv 6a7kXqi4vjEPc0ueG+14XEjsC6UCAwEAAaNhMF8wDwYDVR0RBAgwBocEgpPbEzAd BgNVHQ4EFgQUIzK8YZ5RjpQiMFuuaIp+jlPSRXwwHwYDVR0jBBgwFoAUIzK8YZ5R jpQiMFuuaIp+jlPSRXwwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEA aaP+NWOl6E7mPk+d9oI9c/KnIsFG5QleYYG3cDxiukN9vaxn0EHqp7hBRwS8QZpG NTE/YhB6WHNFOlk7QWsrHmJCt37Ba5IlKt8/abUmjsddxiSgZSG3Y3RgfzsOmoCk T6J5IBmSZGC3U1wJbkZuetfu7/QuJ3oaDtpbi3q/QFafFmNriatIZQdF4KAhfA9t nCqrytACBoo5eupluQQTD2vN6uWfWcXSBrLkw8urWWmqEeYISRLM1CkhK1nB3Lvm qX2WaKR7YXaKIalppYPVi/YITsA0ZGtllqztzcELVH2pVwd3DGpDnk/AbBKI6M80 CGevHC+7SVQbF5WJsy3JXw== -----END CERTIFICATE----- Remove the cert in MacOS $ sudo security delete-certificate -Z 915D019F0993F369C09D75C6B8DA201B8DE2636E Other methods Click to check details Others 1: $ cd /etc/nginx/ $ sudo openssl genrsa -des3 -out server.key 1024 $ sudo openssl req -new -key server.key -out server.csr $ sudo cp server.key{,.org} $ sudo cp server.csr{,.org} $ sudo openssl rsa -in server.key.org -out server.key $ sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt Click to check details $ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled $ sudo openssl genrsa -des3 -out server.key 1024 Generating RSA private key, 1024 bit long modulus .................................................................++++++ ......++++++ e is 65537 (0x10001) Enter pass phrase for server.key: artifactory Verifying - Enter pass phrase for server.key: artifactory $ sudo openssl req -new -key server.key -out server.csr Enter pass phrase for server.key: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Organizational Unit Name (eg, section) []:mycompany Common Name (e.g. server FQDN or YOUR name) []:docker-2.artifactory Email Address []:marslo.jiao@mycompany.com Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:artifactory An optional company name []:mycompany $ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled -rw-r--r-- 1 root root 951 Dec 26 18:32 server.key -rw-r--r-- 1 root root 785 Dec 26 18:36 server.csr -rw-r--r-- 1 root root 951 Dec 26 18:38 server.key.org -rw-r--r-- 1 root root 785 Dec 26 18:38 server.csr.org $ sudo openssl rsa -in server.key.org -out server.key Enter pass phrase for server.key.org: writing RSA key $ sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=mycompany/CN=docker-2.artifactory/emailAddress=marslo.jiao@mycompany.com Getting Private key Others 2: /etc/nginx$ sudo openssl req -newkey rsa:2048 -nodes -sha256 -keyout certs/www.artifactory.mycompany.com.key -x509 -days 365 -out certs/www.artifactory.mycompany.com.crt Generating a 2048 bit RSA private key ........+++ ..............................................................+++ writing new private key to 'certs/www.artifactory.mycompany.com.key' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Organizational Unit Name (eg, section) []:mycompany Common Name (e.g. server FQDN or YOUR name) []:www.artifactory.mycompany.com Email Address []:marslo.jiao@mycompany.com Other 3: genreate key and cert by one command $ openssl req -new -newkey rsa:2048 -nodes -out www_artifactory__mycompany_com.csr -keyout www_artifactory__mycompany_com.key -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com\" Artifactory HTTPS $ sudo openssl genrsa -des3 -out artifactorykey 2048 $ sudo openssl req -new -key artifactorykey -out artifactorycsr $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey $ sudo openssl x509 -req -days 365 -in artifactorycsr -signkey artifactorykey -out artifactorycrt SSL with IP $ sudo openssl genrsa -des3 -out artifactorykey 2048 Generating RSA private key, 2048 bit long modulus .........................+++ ........................................................................+++ e is 65537 (0x10001) Enter pass phrase for artifactorykey: artifactory Verifying - Enter pass phrase for artifactorykey: artifactory $ sudo openssl req -new -key artifactorykey -out artifactorycsr Enter pass phrase for artifactorykey: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Ltd Organizational Unit Name (eg, section) []:. Common Name (e.g. server FQDN or YOUR name) []:192.168.1.102 Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey Enter pass phrase for artifactorykey.org: artifactory writing RSA key $ sudo openssl x509 -req -days 365 -in artifactorycsr -signkey artifactorykey -out artifactorycrt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany Ltd/CN=192.168.1.102 Getting Private key $ openssl x509 -text -noout -in ssl_ip/artifactorycrt Certificate: Data: Version: 1 (0x0) Serial Number: 9804858425156156035 (0x8811daca106dba83) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, CN=192.168.1.102 Validity Not Before: Dec 26 16:23:15 2017 GMT Not After : Dec 26 16:23:15 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, CN=192.168.1.102 Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:ad:32:26:35:8a:8f:09:82:ff:59:61:14:14:1b: 9c:da:02:74:09:48:2a:d5:05:1d:ad:8a:d0:e0:70: 1f:9b:44:b4:df:4d:c5:4c:5a:1b:8a:52:7b:2a:69: a2:77:d3:cf:c7:fb:a6:ef:34:d1:bb:23:8d:d0:78: e6:48:3f:8c:12:3c:69:d5:62:2d:74:24:b8:49:a8: 59:c7:36:5f:64:97:5a:d1:8f:9a:5b:2f:aa:a8:65: 6c:75:28:60:55:b9:2a:5b:41:71:a4:fa:eb:10:7e: 84:4b:fb:c3:57:9c:55:8e:e8:2a:4a:c1:45:74:54: 58:d5:09:0d:59:d4:14:94:db:5b:67:91:9c:23:24: c4:07:10:d1:f1:28:fa:97:38:01:da:81:c4:f3:63: d7:84:24:dc:3c:ff:04:64:b2:3e:41:f0:d8:08:66: 06:cc:7c:05:3c:90:97:0b:02:b6:b5:2f:03:28:b7: 4c:38:aa:84:23:3e:9e:d4:b0:3a:58:4c:f3:74:df: 36:63:f2:18:ac:d1:0d:ef:05:6b:f3:dc:b6:d3:c7: f0:91:7b:b8:69:4f:ae:19:da:34:b7:38:1e:e2:9a: 10:2e:a9:a0:54:f6:61:b9:da:e6:98:c8:9b:76:83: d6:59:77:d9:18:c6:57:8c:cf:af:a4:89:5a:87:99: c4:15 Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption 5a:06:ad:9b:d0:07:d7:9b:92:2a:77:71:ff:80:6e:c1:39:bd: 81:e8:0f:21:39:bd:80:3e:96:a9:6b:7a:73:f1:80:70:4e:b1: d4:b7:1e:54:be:62:dc:35:c0:b9:d8:8c:d1:24:75:8a:42:ec: a9:dd:9b:9a:f2:4b:ad:6e:38:d7:a2:fa:7a:70:be:7b:8c:37: 63:71:10:fe:73:18:de:e5:9c:c5:6e:1a:4e:cb:7b:51:26:56: 68:56:fb:4f:71:d7:7b:94:b6:55:b9:f8:9b:31:a8:26:a5:e5: 32:36:33:65:7b:1d:9f:27:7d:f1:b0:d2:06:7c:75:d7:39:bb: 7a:44:92:e1:b8:fc:2b:fd:3c:43:93:d6:47:19:f6:ad:d3:cc: 82:dd:15:bd:d3:a0:e2:2d:92:fd:65:44:60:44:21:b9:1f:31: fd:91:c2:78:86:d9:aa:77:fd:54:ae:2f:4c:ae:5d:5e:c7:a3: 43:0d:6b:32:23:d9:61:b6:a7:c4:47:eb:bc:c2:79:6c:06:f0: a6:af:e8:45:c6:02:d5:1c:09:26:8a:a7:b0:ff:74:50:85:82: 1d:88:b2:2c:eb:20:3e:bf:3b:4e:9b:ab:b7:4f:e8:14:a8:1a: 33:50:e9:a8:24:3e:5e:2a:68:ea:fa:f3:12:30:94:8e:0f:0d: da:6c:17:60 SSL With Domain $ sudo openssl genrsa -des3 -out artifactorykey 2048 Generating RSA private key, 2048 bit long modulus ........................+++ .......................................+++ e is 65537 (0x10001) Enter pass phrase for artifactorykey: artifactory Verifying - Enter pass phrase for artifactorykey: artifactory $ sudo openssl req -new -key artifactorykey -out artifactorycsr Enter pass phrase for artifactorykey: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Ltd Organizational Unit Name (eg, section) []:mycompany CDI Common Name (e.g. server FQDN or YOUR name) []:docker-1.artifactory Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey Enter pass phrase for artifactorykey.org: artifactory writing RSA key $ sudo openssl x509 -req -days 365 -in artifactorycsr -signkey artifactorykey -out artifactorycrt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany Ltd/OU=mycompany CDI/CN=docker-1.artifactory Getting Private key $ openssl x509 -text -noout -in ssl/artifactorycrt Certificate: Data: Version: 1 (0x0) Serial Number: 15006671364169185053 (0xd0426818d254b71d) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, OU=mycompany CDI, CN=docker-1.artifactory Validity Not Before: Dec 26 16:02:10 2017 GMT Not After : Dec 26 16:02:10 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, OU=mycompany CDI, CN=docker-1.artifactory Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:dc:30:6b:83:56:92:fb:f3:fb:bc:da:3e:a9:5c: 67:c3:19:42:9a:8f:8f:30:e6:27:fa:a9:9d:c9:3e: 9c:31:3d:aa:d8:9f:ae:9b:64:b0:75:2a:01:51:ad: 04:c4:00:5d:f4:f8:b4:af:bb:20:f3:77:45:65:28: d8:38:28:b2:03:46:d0:67:d1:91:8e:7b:65:66:a0: 7e:a5:e2:fe:80:00:5e:54:95:50:52:9c:44:2a:aa: dc:a2:80:be:16:07:79:b4:13:1d:f5:8a:ca:c3:ab: 1c:76:de:f3:b8:23:9b:54:17:28:be:ac:e5:68:5c: f3:83:49:61:55:d2:e1:ea:0c:e7:72:75:6e:90:5a: 90:a8:85:01:c6:cc:69:94:5b:c4:f9:14:6d:70:0a: 8e:45:e0:b9:28:aa:99:3a:22:12:db:0b:d7:d9:6e: aa:35:36:5e:e6:00:eb:99:ab:46:6d:7b:e5:12:b1: f9:0c:5c:d3:c0:47:7b:b3:e4:03:15:fa:8d:42:f8: a1:c1:ce:dc:42:d2:81:88:18:0d:26:28:7e:90:cf: e8:05:84:75:94:e9:ac:20:47:95:c7:50:1c:d8:42: c3:d7:8b:90:f9:a9:48:cc:a5:8d:88:3b:54:a9:ef: 20:ce:ee:4c:6d:04:65:eb:6c:f7:22:9d:c8:13:33: b1:6d Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption c3:c7:c8:0d:19:d1:0b:05:ac:11:e3:e4:af:25:0e:95:f5:f5: 31:ed:90:4e:7f:1a:2b:a2:2f:4d:a3:d9:57:40:a2:f6:af:55: 90:53:bf:72:39:81:5d:53:41:85:e0:1d:26:9f:9e:33:05:46: 9c:fc:51:99:19:5c:7d:ef:aa:cc:50:61:0b:f4:11:69:bd:9e: 2a:34:48:e9:9d:7c:d0:e0:80:a5:42:67:ac:8e:0c:d6:84:19: 8e:cb:05:97:9f:21:c5:e0:78:8f:97:f6:53:fa:f2:ec:49:3f: fb:11:68:ed:ea:c0:8c:c5:be:08:61:e4:bd:4e:05:5f:89:99: f6:47:6f:b3:1e:5f:49:62:ff:37:dc:f0:c4:4b:bb:a4:15:06: b1:80:4d:24:ef:bb:25:d6:a5:60:13:34:57:73:ba:b4:b0:8b: 42:0f:18:ef:0e:17:60:83:4d:61:bd:ef:55:b9:52:6a:47:ab: c3:ee:b3:11:27:86:aa:87:18:d5:60:b8:b4:34:c2:fa:75:48: 0e:f1:f4:30:b3:fa:b3:ad:a9:8a:6e:e6:62:71:02:5a:72:bd: 5c:45:a0:23:ea:1d:84:16:24:3d:88:a0:12:20:61:7a:f8:bd: dc:0f:fb:26:c0:f3:2f:1f:66:7e:64:35:b6:45:05:c4:00:43: 2d:18:da:a1 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:12 "},"linux/ubuntu/systemctl.html":{"url":"linux/ubuntu/systemctl.html","title":"systemctl","keywords":"","body":" Table of Contents generated with DocToc ubuntu 17.10 bootup settings Reference ubuntu 17.10 bootup settings create Script $ cat /usr/local/bin/do_route.sh ##!/bin/bash ## Destination Gateway Genmask Flags Metric Ref Use Iface ## 0.0.0.0 192.168.10.1 0.0.0.0 UG 0 0 0 eno2 /sbin/route -n | grep \"0\\.0\\.0\\.0.*192\\.168\\.10\\.1.*eno2\" > /dev/null 2>&1 if [ $? != 0 ]; then sudo route add default gw 192.168.10.1 fi ## Destination Gateway Genmask Flags Metric Ref Use Iface ## 0.0.0.0 130.147.180.65 0.0.0.0 UG 0 0 0 eno1 /sbin/route -n | grep \"0\\.0\\.0\\.0.*130\\.147\\.180\\.65.*eno1\" > /dev/null 2>&1 if [ $? == 0 ]; then sudo route delete -net 0.0.0.0 gw 130.147.180.65 netmask 0.0.0.0 fi host=\"161.92.35.78 130.147.236.5 180.166.223.190 140.207.91.234 42.99.164.34 185.46.212.34\" for _h in ${host}; do sudo route add -host ${_h} gw 130.147.180.65 done route=\"130.147.0.0 130.140.0.0 130.146.0.0 137.55.0.0 161.83.0.0 161.84.0.0 161.85.0.0 161.88.0.0 161.91.0.0 161.92.0.0 185.166.0.0\" for _r in ${route}; do sudo route add -net ${_r} netmask 255.255.0.0 eno1 done touch /home/devops/hi-marslo create service $ ls -altrh /lib/systemd/system/do_route.service -rwxr-xr-x 1 root root 140 Jan 15 22:08 /lib/systemd/system/do_route.service $ cat /lib/systemd/system/do_route.service [Unit] Description=Add static route for two interface [Service] ExecStart=/usr/local/bin/do_route.sh [Install] WantedBy=multi-user.target Alias=myroute.service enable the service $ sudo systemctl enable do_route.service Created symlink /etc/systemd/system/multi-user.target.wants/do_route.service → /lib/systemd/system/do_route.service. Created symlink /etc/systemd/system/myroute.service → /lib/systemd/system/do_route.service. $ sudo systemctl start do_route.service disable the service $ sudo systemctl disable do_route.service Removed /etc/systemd/system/myroute.service. Removed /etc/systemd/system/multi-user.target.wants/do_route.service. re-enable the service $ sudo systemctl enable add_route.service Created symlink /etc/systemd/system/marslo_route.service → /lib/systemd/system/add_route.service. Created symlink /etc/systemd/system/multi-user.target.wants/add_route.service → /lib/systemd/system/add_route.service. route FLags U: Up: 表示此路由当前为启动状态 H: Host: 表示此网关为一主机 G: Gateway: 表示此网关为一路有 R: Reinstate Route: 使用动态路由重新初始化的路由 D: Dynamically: 此路由是动态性的写入 M: Modifed: 此路由是有路由守护程序或导向器动态修改 !: 关闭状态 Reference How to automatically execute shell script at startup boot on systemd Linux Using systemd to control the Docker daemon systemd_service.5.manual Linux route命令详解：查看和操作IP路由表 ubuntu配置静态路由及重启生效 Systemd的Unit文件; systemctl增加服务详细介绍 SystemdForUpstartUsers Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:12 "},"linux/ubuntu/x.html":{"url":"linux/ubuntu/x.html","title":"x","keywords":"","body":" Table of Contents generated with DocToc enable screensharing backup and restore config setup screen sharing start application remotelly GDM login session Process and SubProcesses Wayland Reference enable screensharing backup and restore config $ dconf dump /org/gnome/desktop/remote-access/ > ubuntu1804_remoteaccess $ cat ubuntu1804_remoteaccess [/] require-encryption=false vnc-password='bWFyc2xv' authentication-methods=['vnc'] prompt-enabled=false $ dconf load /org/gnome/desktop/remote-access/ setup screen sharing $ read -e -p \"VNC Password: \" -i \"ubuntu\" VNCPASSWORD $ dconf write /org/gnome/desktop/remote-access/enabled true $ dconf write /org/gnome/desktop/remote-access/authentication-methods \"['vnc']\" $ dconf write /org/gnome/desktop/remote-access/prompt-enabled false $ dconf write /org/gnome/desktop/remote-access/require-encryption false $ dconf write /org/gnome/desktop/remote-access/vnc-password \\\"\\'$(echo -n $VNCPASSWORD | base64)\\'\\\" $ sudo service lightdm restart reset VNC password $ echo -n \"marslo\" | base64 bWFyc2xv read all conf $ for i in $(gsettings list-keys org.gnome.Vino); do echo -e \"$i:\\t --> \"$(dconf read /org/gnome/desktop/remote-access/$i); done notify-on-connect: --> alternative-port: --> disable-background: --> use-alternative-port: --> icon-visibility: --> use-upnp: --> view-only: --> prompt-enabled: --> false disable-xdamage: --> authentication-methods: --> ['vnc'] network-interface: --> require-encryption: --> false mailto: --> lock-screen-on-disconnect: --> vnc-password: --> 'bWFyc2xv' start application remotelly $ export DISPLAY=:0 $ gnome-terminal GDM $ cat /lib/systemd/system/gdm.service [Unit] Description=GNOME Display Manager ## replaces the getty Conflicts=getty@tty1.service After=getty@tty1.service ## replaces plymouth-quit since it quits plymouth on its own Conflicts=plymouth-quit.service After=plymouth-quit.service ## Needs all the dependencies of the services it's replacing ## pulled from getty@.service and plymouth-quit.service ## (except for plymouth-quit-wait.service since it waits until ## plymouth is quit, which we do) After=rc-local.service plymouth-start.service systemd-user-sessions.service ## GDM takes responsibility for stopping plymouth, so if it fails ## for any reason, make sure plymouth still stops OnFailure=plymouth-quit.service [Service] ExecStartPre=/usr/share/gdm/generate-config ExecStart=/usr/sbin/gdm3 KillMode=mixed Restart=always RestartSec=1s IgnoreSIGPIPE=no BusName=org.gnome.DisplayManager StandardOutput=syslog StandardError=inherit EnvironmentFile=-/etc/default/locale ExecReload=/usr/share/gdm/generate-config ExecReload=/bin/kill -SIGHUP $MAINPID gnome-shell AutoLogin Login with desired session $ cat /var/lib/AccountsService/users/devops [User] FormatsLocale=en_US.UTF-8 XSession=gnome-xorg SystemAccount=false [InputSource0] xkb=us Auto Login with GDM $ grep -i auto /etc/gdm3/custom.conf [daemon] ## Enabling automatic login AutomaticLoginEnable = true AutomaticLogin = devops Auto Login with Delay $ grep -i time /etc/gdm3/custom.conf [daemon] ## Enabling timed login ## TimedLoginEnable = true ## TimedLogin = user1 ## TimedLoginDelay = 10 login session Default Session $ cat /etc/X11/default-display-manager /usr/sbin/gdm3 Process and SubProcesses pstree $ pstree 1391 gdm3─┬─gdm-session-wor─┬─gdm-x-session─┬─Xorg───{Xorg} │ │ ├─gnome-session-b─┬─deja-dup-monito───4*[{deja-dup-monito}] │ │ │ ├─gnome-software───3*[{gnome-software}] │ │ │ ├─gsd-a11y-settin───3*[{gsd-a11y-settin}] │ │ │ ├─gsd-clipboard───2*[{gsd-clipboard}] │ │ │ ├─gsd-color───3*[{gsd-color}] │ │ │ ├─gsd-datetime───3*[{gsd-datetime}] │ │ │ ├─gsd-disk-utilit───2*[{gsd-disk-utilit}] │ │ │ ├─gsd-housekeepin───3*[{gsd-housekeepin}] │ │ │ ├─gsd-keyboard───3*[{gsd-keyboard}] │ │ │ ├─gsd-media-keys───3*[{gsd-media-keys}] │ │ │ ├─gsd-mouse───3*[{gsd-mouse}] │ │ │ ├─gsd-power───3*[{gsd-power}] │ │ │ ├─gsd-print-notif───2*[{gsd-print-notif}] │ │ │ ├─gsd-rfkill───2*[{gsd-rfkill}] │ │ │ ├─gsd-screensaver───2*[{gsd-screensaver}] │ │ │ ├─gsd-sharing───3*[{gsd-sharing}] │ │ │ ├─gsd-smartcard───4*[{gsd-smartcard}] │ │ │ ├─gsd-sound───3*[{gsd-sound}] │ │ │ ├─gsd-wacom───2*[{gsd-wacom}] │ │ │ ├─gsd-xsettings───3*[{gsd-xsettings}] │ │ │ ├─nautilus-deskto───3*[{nautilus-deskto}] │ │ │ ├─ssh-agent │ │ │ ├─update-notifier───3*[{update-notifier}] │ │ │ └─3*[{gnome-session-b}] │ │ └─2*[{gdm-x-session}] │ └─2*[{gdm-session-wor}] └─2*[{gdm3}] ps short $ ps auxwwf /usr/sbin/gdm3 \\_ gdm-session-worker [pam/gdm-autologin] \\_ /usr/lib/gdm3/gdm-x-session --run-script env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu \\_ /usr/lib/xorg/Xorg vt1 -displayfd 3 -auth /run/user/1000/gdm/Xauthority -background none -noreset -keeptty -verbose 3 \\_ /usr/lib/gnome-session/gnome-session-binary --session=ubuntu \\_ /usr/bin/ssh-agent /usr/bin/im-launch env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu \\_ /usr/lib/gnome-settings-daemon/gsd-power \\_ /usr/lib/gnome-settings-daemon/gsd-print-notifications \\_ /usr/lib/gnome-settings-daemon/gsd-rfkill \\_ /usr/lib/gnome-settings-daemon/gsd-screensaver-proxy \\_ /usr/lib/gnome-settings-daemon/gsd-sharing \\_ /usr/lib/gnome-settings-daemon/gsd-smartcard \\_ /usr/lib/gnome-settings-daemon/gsd-sound \\_ /usr/lib/gnome-settings-daemon/gsd-xsettings \\_ /usr/lib/gnome-settings-daemon/gsd-wacom \\_ /usr/lib/gnome-settings-daemon/gsd-clipboard \\_ /usr/lib/gnome-settings-daemon/gsd-a11y-settings \\_ /usr/lib/gnome-settings-daemon/gsd-datetime \\_ /usr/lib/gnome-settings-daemon/gsd-color \\_ /usr/lib/gnome-settings-daemon/gsd-keyboard \\_ /usr/lib/gnome-settings-daemon/gsd-housekeeping \\_ /usr/lib/gnome-settings-daemon/gsd-mouse \\_ /usr/lib/gnome-settings-daemon/gsd-media-keys \\_ /usr/lib/gnome-disk-utility/gsd-disk-utility-notify \\_ /usr/bin/gnome-software --gapplication-service \\_ nautilus-desktop \\_ update-notifier \\_ /usr/lib/deja-dup/deja-dup-monitor full $ ps auxwwf root 1391 0.0 0.1 308176 8340 ? Ssl 16:58 0:00 /usr/sbin/gdm3 root 1456 0.0 0.1 271860 8720 ? Sl 16:58 0:00 \\_ gdm-session-worker [pam/gdm-autologin] devops 1497 0.0 0.0 212124 6000 tty1 Ssl+ 16:58 0:00 \\_ /usr/lib/gdm3/gdm-x-session --run-script env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu devops 1499 0.4 1.0 370392 81984 tty1 Sl+ 16:58 0:02 \\_ /usr/lib/xorg/Xorg vt1 -displayfd 3 -auth /run/user/1000/gdm/Xauthority -background none -noreset -keeptty -verbose 3 devops 1518 0.0 0.1 716920 15716 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-session/gnome-session-binary --session=ubuntu devops 1599 0.0 0.0 11304 320 ? Ss 16:58 0:00 \\_ /usr/bin/ssh-agent /usr/bin/im-launch env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu devops 2471 0.0 0.2 527336 23468 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-power devops 2472 0.0 0.1 349316 10144 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-print-notifications devops 2475 0.0 0.0 423340 5728 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-rfkill devops 2481 0.0 0.0 275728 5048 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-screensaver-proxy devops 2485 0.0 0.1 471340 11980 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-sharing devops 2493 0.0 0.1 466472 10096 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-smartcard devops 2495 0.0 0.1 343116 9808 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-sound devops 2499 0.0 0.2 504824 23460 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-xsettings devops 2511 0.0 0.2 440656 22568 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-wacom devops 2530 0.0 0.2 355824 21572 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-clipboard devops 2531 0.0 0.1 296660 8348 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-a11y-settings devops 2532 0.0 0.1 476600 15176 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-datetime devops 2536 0.0 0.3 678216 24396 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-color devops 2537 0.0 0.2 508124 22096 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-keyboard devops 2539 0.0 0.1 374712 8804 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-housekeeping devops 2542 0.0 0.1 296672 8284 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-mouse devops 2545 0.0 0.3 1155368 24656 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-media-keys devops 2589 0.0 0.0 271928 6216 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-disk-utility/gsd-disk-utility-notify devops 2590 0.4 1.8 1318392 152212 tty1 SLl+ 16:58 0:02 \\_ /usr/bin/gnome-software --gapplication-service devops 2599 0.2 0.9 1197708 75864 tty1 Sl+ 16:58 0:01 \\_ nautilus-desktop devops 3686 0.0 0.3 605436 28680 tty1 Sl+ 16:59 0:00 \\_ update-notifier devops 4017 0.0 0.4 118225468 32448 tty1 Sl+ 17:00 0:00 \\_ /usr/lib/deja-dup/deja-dup-monitor Wayland Reference GDM Reference Manual GNOME How to configure Vino for remote desktop access using command line Vino Vino. The Remote Desktop Project VND/Servers Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:12 "},"programming/python/python.html":{"url":"programming/python/python.html","title":"programming","keywords":"","body":" Table of Contents generated with DocToc Pythonic zip/unzip in dict & counter enumerate import local module args & kwargs itertools one-line python code slice Chain Compare Boolean Reverse Join in list Sum & Max & Min & Time sum = 15 maxNum = 5 minNum = 1 prod = 120 Default Dict if...else... Ternary Operator dict & zip Hidden Features (Got from here) Numbers: String Args: Conditional Assignment List & Dics Generator & Iteration Statement Funcs Class & Module Others PEP8 -- Style Guide for Python Code Indentation Maximum Line Length Should a Line break before or after a binary operator? Imports module Level dunder names Whitespace in Expressions and Statements Other Recommendations documentation strings Programming Recommendations PEP8 Error/Warning Code Pythonic Inspired from what are same example of beautiful 'Pythonic' code? and 如何让你的Python代码更加pythonic? -- zip/unzip def unzip(tuples): if tuples: return [tuple(t[i] for t in tuples) for i, _ in enumerate(tuples[0])] else: return [] result:>>> unzip( ((1, 2), (3, 4), (5, 6)) ) [(1, 3, 5), (2, 4, 6)] -- in long_string = \"This is a very long string\" if \"long\" in long_string: print(\"Match found\") dict & counter >>> from collections import Counter >>> fruits = ['orange', 'banana', 'apple', 'orange', 'banana'] >>> Counter(fruits) Counter({'orange': 2, 'banana': 2, 'apple': 1}) -- enumerate x = ['a', 'b', 'c'] for index, item in enumerate(x): print(index, item) -- P: array = [1, 2, 3, 4, 5] for i, e in enumerate(array,0): print i, e #0 1 #1 2 #2 3 #3 4 #4 5 NP: for i in xrange(len(array)): print i, array[i] #0 1 #1 2 #2 3 #3 4 #4 5 -- import local module # A.py def filter_items(items): for i in items: if i -- args & kwargs def add(one, two): return one + two my_list = [1, 2] x = add(*my_list) # x = 3 my_dict = {\"one\": 1, \"two\": 2} y = add(**my_dict) #y = 3 -- itertools >>> from itertools import zip_longest >>> x = [1, 2, 3, 4] >>> y = ['a', 'b', 'c'] >>> for i, j in zip_longest(x, y): ... print(i, j) ... 1 a 2 b 3 c 4 None -- one-line python code >>> my_dict = {key: value for key, value in zip_longest(x,y)} >>> my_dict {1: 'a', 2: 'b', 3: 'c', 4: None} -- slice word = #some word is_palindrome = word.find(word[-1::-1]) -- Chain Compare P: a = 3 b = 1 1 NP: a = 3 b = 1 b >= 1 and b -- Boolean P: name = 'Tim' langs = ['AS3', 'Lua', 'C'] info = {'name': 'Tim', 'sex': 'Male', 'age':23 } if name and langs and info: print('All True!') #All True! NP: if name != '' and len(langs) > 0 and info != {}: print('All True!') #All True! -- Reverse P:def reverse_str( s ): return s[::-1] NP:def reverse_str( s ): t = '' for x in xrange(len(s)-1,-1,-1): t += s[x] return t -- Join in list P: strList = [\"Python\", \"is\", \"good\"] res = ' '.join(strList) #Python is good NP: res = '' for s in strList: res += s + ' ' #Python is good #最后还有个多余空格 -- Sum & Max & Min & Time P: numList = [1,2,3,4,5] sum = sum(numList) #sum = 15 maxNum = max(numList) #maxNum = 5 minNum = min(numList) #minNum = 1 from operator import mul prod = reduce(mul, numList, 1) #prod = 120 默认值传1以防空列表报错 NP: sum = 0 maxNum = -float('inf') minNum = float('inf') prod = 1 for num in numList: if num > maxNum: maxNum = num if num -- List Comprehensions P: l = [x*x for x in range(10) if x % 3 == 0] # l = [0, 9, 36, 81] NP: l = [] for x in range(10): if x % 3 == 0: l.append(x*x) # l = [0, 9, 36, 81] -- Default Dict P: dic = {'name':'Tim', 'age':23} dic['workage'] = dic.get('workage',0) + 1 # dic = {'age': 23, 'workage': 1, 'name': 'Tim'} NP: if 'workage' in dic: dic['workage'] += 1 else: dic['workage'] = 1 # dic = {'age': 23, 'workage': 1, 'name': 'Tim'} -- if...else... P: for x in xrange(1,5): if x == 5: print 'find 5' break else: print 'can not find 5!' # can not find 5! NP: find = False for x in xrange(1,5): if x == 5: find = True print 'find 5' break if not find: print 'can not find 5!' # can not find 5! -- Ternary Operator P: a = 3 b = 2 if a > 2 else 1 # b = 2 NP: if a > 2: b = 2 else: b = 1 # b = 2 -- dict & zip P: keys = ['Name', 'Sex', 'Age'] values = ['Tim', 'Male', 23] dic = dict(zip(keys, values)) # {'Age': 23, 'Name': 'Tim', 'Sex': 'Male'} NP: dic = {} for i,e in enumerate(keys): dic[e] = values[i] # {'Age': 23, 'Name': 'Tim', 'Sex': 'Male'} Hidden Features (Got from here) Numbers: round >>> str(round(1234.5678, -2)) '1200.0' >>> str(round(1234.5678, 2)) '1234.57' Integer base >>> int('10', 0) 10 >>> int('0x10', 0) 16 >>> int('010', 0) # does not work on Python 3.x 8 >>> int('0o10', 0) # Python >=2.6 and Python 3.x 8 >>> int('0b10', 0) # Python >=2.6 and Python 3.x 2 In-place value swapping >>> a = 10 >>> b = 5 >>> a, b (10, 5) >>> a, b = b, a >>> a, b (5, 10) Sum from operator import add print reduce(add, [1,2,3,4,5,6]) String Multi-line Strings >>> sql = \"select * from some_table \\ where id > 10\" >>> print sql select * from some_table where id > 10 or >>> sql = \"\"\"select * from some_table where id > 10\"\"\" >>> print sql select * from some_table where id > 10 or >>> sql = (\"select * from some_table \" # 10 \" \"order by name\") >>> print sql select * from some_table where id > 10 order by name In >>> 'str' in 'string' True >>> 'no' in 'yes' False >>> Join ''.join(list_of_strings) set >>> a = set([1,2,3,4]) >>> b = set([3,4,5,6]) >>> a | b # Union {1, 2, 3, 4, 5, 6} >>> a & b # Intersection {3, 4} >>> a >> a - b # Difference {1, 2} >>> a ^ b # Symmetric Difference {1, 2, 5, 6} Slice operators a = [1,2,3,4,5] >>> a[::2] # iterate over the whole list in 2-increments [1,3,5] or >>> a[::-1] [5,4,3,2,1] or >>> a = range(10) >>> a [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> a[:5] = [42] >>> a [42, 5, 6, 7, 8, 9] >>> a[:1] = range(5) >>> a [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> del a[::2] >>> a [1, 3, 5, 7, 9] >>> a[::2] = a[::-2] >>> a [9, 3, 5, 7, 1] Reversed for i in reversed([1, 2, 3]): print(i) Backslashes >>> print repr(r\"aaa\\\"bbb\") 'aaa\\\\\"bbb' or >>> print repr(r\"C:\\\") SyntaxError: EOL while scanning string literal >>> print repr(r\"C:\\\"\") 'C:\\\\\"' Args: Use _ instead of last printed item >>> range(10) [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> _ [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> *args & **kwargs >>> g = lambda *args, **kwargs: args[0], kwargs['thing'] >>> g(1, 2, 3, thing='stuff') (1, 'stuff') or def foo(a, b, c): print a, b, c bar = (3, 14, 15) foo(*bar) function argument unpacking def draw_point(x, y): # do some magic point_foo = (3, 4) point_bar = {'y': 3, 'x': 2} draw_point(*point_foo) draw_point(**point_bar) Conditional Assignment Ternary operator >>> 'ham' if True else 'spam' 'ham' >>> 'ham' if False else 'spam' 'spam' or >>> True and 'ham' or 'spam' 'ham' >>> False and 'ham' or 'spam' 'spam' or >>> [] if True else 'spam' [] >>> True and [] or 'spam' 'spam' or In [18]: a = True In [19]: a and 3 or 4 Out[19]: 3 In [20]: a = False In [21]: a and 3 or 4 Out[21]: 4 or >>> (1 and [foo()] or [bar()])[0] foo 0 or >>> foo() if True or bar() foo 0 Conditional x = 3 if (y == 1) else 2 or x = 3 if (y == 1) else 2 if (y == -1) else 1 or (func1 if y == 1 else func2)(arg1, arg2) or x = (class1 if y == 1 else class2)(arg1, arg2) or [(x, y) for x in range(4) if x % 2 == 1 for y in range(4)] [(1, 0), (1, 1), (1, 2), (1, 3), (3, 0), (3, 1), (3, 2), (3, 3)] or x = 3 if (y == 1) else 2 is equvalent to x = y == 1 and 3 or 2 x = 0 if True else 1 is equvalent to x = True and 0 or 1 or foo = [x for x in xrange(10) if x % 2 == 0] equal to foo = [] for x in xrange(10): if x % 2 == 0: foo.append(x) Dict Comprehensions (wiki, manual) >>> {i: i**2 for i in range(5)} {0: 0, 1: 1, 2: 4, 3: 9, 4: 16} Set comprehensions wiki manual >>> {i**2 for i in range(5)} set([0, 1, 4, 16, 9]) List & Dics zip a = [(1,2), (3,4), (5,6)] zip(*a) # [(1, 3, 5), (2, 4, 6)] or >>> dict([ ('foo','bar'),('a',1),('b',2) ]) {'a': 1, 'b': 2, 'foo': 'bar'} >>> names = ['Bob', 'Marie', 'Alice'] >>> ages = [23, 27, 36] >>> dict(zip(names, ages)) {'Alice': 36, 'Bob': 23, 'Marie': 27} or >>> t1 = (0,1,2,3) >>> t2 = (7,6,5,4) >>> [t1,t2] == zip(*zip(t1,t2)) True or In [15]: t1 = (1, 2, 3) In [16]: t2 = (4, 5, 6) In [17]: dict (zip(t1,t2)) Out[17]: {1: 4, 2: 5, 3: 6} or >>> l=[(1,2),(3,4)] >>> [a+b for a,b in l ] [3,7] List & Sum >>> l = [[1, 2, 3], [4, 5], [6], [7, 8, 9]] >>> sum(l, []) [1, 2, 3, 4, 5, 6, 7, 8, 9] Nested list [(i,j) for i in range(3) for j in range(i) ] or ((i,j) for i in range(4) for j in range(i) ) enumerate >>> a = ['a', 'b', 'c', 'd', 'e'] >>> for index, item in enumerate(a): print index, item ... 0 a 1 b 2 c 3 d 4 e or >>> l = [\"spam\", \"ham\", \"eggs\"] >>> list(enumerate(l)) >>> [(0, \"spam\"), (1, \"ham\"), (2, \"eggs\")] >>> list(enumerate(l, 1)) >>> [(1, \"spam\"), (2, \"ham\"), (3, \"eggs\")] Generate List >>> from functools import partial >>> bound_func = partial(range, 0, 10) >>> bound_func() [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> bound_func(2) [0, 2, 4, 6, 8] dict's constructor >>> dict(foo=1, bar=2) {'foo': 1, 'bar': 2} or >>> a = {} >>> b = a.setdefault('foo', 'bar') >>> a {'foo': 'bar'} >>> b 'bar dict's get t = {1: 'a'} >>> test[2] Traceback (most recent call last): File \"\", line 1, in test[2] KeyError: 2 >>> test.get(2) >>> test.get(1) 'a' >>> test.get(2) == None True >>> test.get(2, 'some') == 'some' True Copy List >>> x = [1,2,3] >>> y = x[:] >>> y.pop() 3 >>> y [1, 2] >>> x [1, 2, 3] Replace list >>> x = [1,2,3] >>> y = x >>> y[:] = [4,5,6] >>> x [4, 5, 6] generators objects x = [n for n in foo if bar(n)] or >>> n = ((a,b) for a in range(0,2) for b in range(4,6)) >>> for i in n: ... print i (0, 4) (0, 5) (1, 4) (1, 5) Generator & Iteration iteration (itertools) & constructor (yield) >>> def g(n): ... for i in range(n): ... yield i **2 >>> t = g(5) >>> t.next() 0 >>> t.next() 1 >>> t.next() 4 >>> t.next() 9 >>> t.next() 16 >>> t.next() Traceback (most recent call last): File \"\", line 1, in StopIteration or def fab(max): a,b = 0,1 while a >> for i in fab(20): ... print i,\",\", ... 0 , 1 , 1 , 2 , 3 , 5 , 8 , 13 , or >>> i = (1,2,3,4,5,6,7,8,9,10) # or any iterable object >>> iterators = [iter(i)] * 2 >>> iterators[0].next() 1 >>> iterators[1].next() 2 >>> iterators[0].next() 3 or def grouper(n, iterable, fillvalue=None): \"grouper(3, 'ABCDEFG', 'x') --> ABC DEF Gxx\" args = [iter(iterable)] * n return izip_longest(fillvalue=fillvalue, *args) or >>> from itertools import * >>> l = [[1, 2], [3, 4]] >>> list(chain(*l)) [1, 2, 3, 4] or def create_printers(n): for i in xrange(n): def printer(i=i): # Doesn't work without the i=i print i yield printer Statement for...else... for i in foo: if i == 0: break else: print(\"i was never 0\") or found = False for i in foo: if i == 0: found = True break if not found: print(\"i was never 0\") Context managers and the \"with\" Statement from __future__ import with_statement with open('foo.txt', 'w') as f: f.write('hello!') try...except...elese...finally try: put_4000000000_volts_through_it(parrot) except Voom: print \"'E's pining!\" else: print \"This parrot is no more!\" finally: end_sketch() Funcs dir >>> dir(\"foo\") ['__add__', '__class__', '__contains__', (snipped a bunch), 'title', 'translate', 'upper', 'zfill'] help >>> help(\"foo\".upper) Help on built-in function upper: upper(...) S.upper() -> string Return a copy of the string S converted to uppercase. Convenient Web-browser controller >>> import webbrowser >>> webbrowser.open_new_tab('http://www.stackoverflow.com') Built-in http server python -m SimpleHTTPServer 8000 An interpreter within the interpreter $ python Python 2.5.1 (r251:54863, Jan 17 2008, 19:35:17) [GCC 4.0.1 (Apple Inc. build 5465)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> shared_var = \"Set in main console\" >>> import code >>> ic = code.InteractiveConsole({ 'shared_var': shared_var }) >>> try: ... ic.interact(\"My custom console banner!\") ... except SystemExit, e: ... print \"Got SystemExit!\" ... My custom console banner! >>> shared_var 'Set in main console' >>> shared_var = \"Set in sub-console\" >>> import sys >>> sys.exit() Got SystemExit! >>> shared_var 'Set in main console' pretty print >>> import pprint >>> stuff = sys.path[:] >>> stuff.insert(0, stuff) >>> pprint.pprint(stuff) [, '', '/usr/local/lib/python1.5', '/usr/local/lib/python1.5/test', '/usr/local/lib/python1.5/sunos5', '/usr/local/lib/python1.5/sharedmodules', '/usr/local/lib/python1.5/tkinter'] or from __future__ import print_function mylist = ['foo', 'bar', 'some other value', 1,2,3,4] print(*mylist) Class & Module bash python -c\"import os; print(os.getcwd());\" assertion >>> try: ... assert [] ... except AssertionError: ... print \"This list should not be empty\" This list should not be empty import try: import json except ImportError: import simplejson as json create new types >>> NewType = type(\"NewType\", (object,), {\"x\": \"hello\"}) >>> n = NewType() >>> n.x \"hello\" or >>> class NewType(object): >>> x = \"hello\" >>> n = NewType() >>> n.x \"hello\" Manipulating sys.modules >>> import sys >>> import ham Traceback (most recent call last): File \"\", line 1, in ImportError: No module named ham # Make the 'ham' module available -- as a non-module object even! >>> sys.modules['ham'] = 'ham, eggs, saussages and spam.' >>> import ham >>> ham 'ham, eggs, saussages and spam.' # Now remove it again. >>> sys.modules['ham'] = None >>> import ham Traceback (most recent call last): or >>> import os # Stop future imports of 'os'. >>> sys.modules['os'] = None >>> import os Traceback (most recent call last): File \"\", line 1, in ImportError: No module named os # Our old imported module is still available. >>> os Others not hidden but still nice import os.path as op root_dir = op.abspath(op.join(op.dirname(__file__), \"..\")) be careful with mutable default arguments >>> def foo(x=[]): ... x.append(1) ... print x ... >>> foo() [1] >>> foo() [1, 1] >>> foo() [1, 1, 1] or >>> def foo(x=None): ... if x is None: ... x = [] ... x.append(1) ... print x >>> foo() [1] >>> foo() [1] PEP8 -- Style Guide for Python Code Indentation yes: # Aligned with opening delimiter. foo = long_function_name(var_one, var_two, var_three, var_four) # More indentation included to distinguish this from the rest. def long_function_name( var_one, var_two, var_three, var_four): print(var_one) # Hanging indents should add a level. foo = long_function_name( var_one, var_two, var_three, var_four) no: # Arguments on first line forbidden when not using vertical alignment. foo = long_function_name(var_one, var_two, var_three, var_four) # Further indentation required as indentation is not distinguishable. def long_function_name( var_one, var_two, var_three, var_four): print(var_one) Optional: # Hanging indents *may* be indented to other than 4 spaces. foo = long_function_name( var_one, var_two, var_three, var_four) if statemant # No extra indentation. if (this_is_one_thing and that_is_another_thing): do_something() # Add a comment, which will provide some distinction in editors # supporting syntax highlighting. if (this_is_one_thing and that_is_another_thing): # Since both conditions are true, we can frobnicate. do_something() # Add some extra indentation on the conditional continuation line. if (this_is_one_thing and that_is_another_thing): do_something()o List my_list = [ 1, 2, 3, 4, 5, 6, ] result = some_function_that_takes_arguments( 'a', 'b', 'c', 'd', 'e', 'f', ) or my_list = [ 1, 2, 3, 4, 5, 6, ] result = some_function_that_takes_arguments( 'a', 'b', 'c', 'd', 'e', 'f', ) Maximum Line Length yes: ```python with open('/path/to/some/file/you/want/to/read') as file_1, \\ open('/path/to/some/file/being/written', 'w') as file_2: file_2.write(file_1.read()) ### Should a Line break before or after a binary operator? - no: operators sit far away from their operands ```python income = (gross_wages + taxable_interest + (dividends - qualified_dividends) - ira_deduction - student_loan_interest) yes: easy to match operators with operands income = (gross_wages + taxable_interest + (dividends - qualified_dividends) - ira_deduction - student_loan_interest) Imports no: import sys, os yes: import os import sys bad: import from * Absolute imports are recommended import mypkg.sibling from mypkg import silbing from mypkg.sibling import example Explicit relative imports are acceptable from . import sibling from .sibling import example Import a class from a class-containing module from myclass import MyClass from foo.bar.yourclass import YourClass Local name classes import myclass import foo.bar.yourclass # use \"myclass.MyClass\" or \"foo.bar.yourclass.YourClass\" module Level dunder names Module level \"dunder\" names with two leading and two trailing underscores, such as __all__, __author__, __version__, etc yes: \"\"\"This is the example module. This module does stuff. \"\"\" from __future__ import barry_as_FLUFL __all__ = ['a', 'b', 'c'] __version__ = '0.1' __author__ = 'Cardinal Biggles' import os import sys Whitespace in Expressions and Statements no: spam( ham[ 1 ], { eggs: 2 } ) yes: spam(ham[1], {eggs: 2}) no: if x == 4 : print x , y ; x , y = y , x yes: if x == 4; print x, y; x, y = y, x no: ham[lower + offset:upper + offset] ham[1: 9], ham[1 :9], ham[1:9 :3] ham[lower : : upper] ham[ : upper ] yes: ham[1:9], ham[1:9:3], ham[:9:3], ham[1::3], ham[1:9:] ham[lower:upper], ham[lowser:pper:], ham[lower::step] ham[lower+offset : upper+offset] ham[: upper_fn(x) : setp_fn(x)], ham[:: setp_fn(x)] ham[lower + offset : upper + offset] no: spam (1) yes: spam(1) no: dct ['key'] = lst [index] yes: dct['key'] = lst[index] no: x = 1 y = 2 long_variable = 3 yes: x = 1 y = 2 long_variable = 3 Other Recommendations no: i=i+1 submitted +=1 x = x * 2 - 1 hypot2 = x * x + y * y c = (a + b) * (a - b) yes: i = i + 1 submitted += 1 x = x*2 - 1 hypot2 = x*x + y*y c = (a+b) * (a-b) no: def complex(real, imag = 0.0): return magic(r = real, i = imag) yes: def complex(real, imag=0.0): return magic(r=real, i=imag) no: def munge(input:AnyStr): ... def munge()->PosInt: ... yes: def munge(input: AnyStr): ... def munge() -> AnyStr: ... no: def munge(input: AnyStr=None): ... def munge(input: AnyStr, limit = 1000): ... yes: def munge(sep: AnyStr = None): ... def munge(input: AnyStr, sep: AnyStr = None, limit=1000): ... rather no: if foo == 'blah': do_blah_thing() do_one(); do_two(); do_three() yes: if foo == 'blah': do_blah_thing() do_one() do_two() do_three() Definitely No: if foo == 'blah': do_blah_thing() else: do_non_blah_thing() try: something() finally: cleanup() do_one(); do_two(); do_three(long, argument, list, like, this) if foo == 'blah': one(); two(); three() yes: if foo == 'blah': do_blah_thing() for x in lst: total += x while t documentation strings yes: \"\"\"Return a foobang Optional plotz says to frobnicate the bizbaz first. \"\"\" Programming Recommendations no: if not foo is None: yes: if foo is not None: no: f = lambda x: 2*x yes: def f(x): return 2*x no: try: # Too broad! return handle_value(collection[key]) expect KeyError: # Will also catch KeyError raised by handle_value() return key_not_found(key) yes: try: value = collection[key] except KeyError: return key_not_found(key) else: return handle_value(value) no: with conn: do_stuff_in_transaction(conn) yes: with conn.begin_transaction(): do_stuff_in_transaction(conn) no: def foo(x): fi x >= 0: return math.sqrt(x) def bar(x): if x yes: def foo(x): if x >= 0: return math.sqrt(x) else: return None def bar(x): if x no: if foo[:3] == 'bar': yes: if foo.startwith('bar'): no: if type(obj) is type(1): yes: if isinstance(obj, int): no: if len(seq): if not len(seq): yes: if not seq: if seq: no: if greeting == True: yes: if greeting: worse: if greeting is True: PEP8 Error/Warning Code E1 Indentation E101 indentation contains mixed spaces and tabs E111 indentation is not a multiple of four E112 expected an indented block E113 unexpected indentation E114 indentation is not a multiple of four (comment) E115 expected an indented block (comment) E116 unexpected indentation (comment) E121 (*^) continuation line under-indented for hanging indent E122 (^) continuation line missing indentation or outdented E123 (*) closing bracket does not match indentation of opening bracket’s line E124 (^) closing bracket does not match visual indentation E125 (^) continuation line with same indent as next logical line E126 (*^) continuation line over-indented for hanging indent E127 (^) continuation line over-indented for visual indent E128 (^) continuation line under-indented for visual indent E129 (^) visually indented line with same indent as next logical line E131 (^) continuation line unaligned for hanging indent E133 (*) closing bracket is missing indentation E2 Whitespace E201 whitespace after ‘(‘ E202 whitespace before ‘)’ E203 whitespace before ‘:’ E211 whitespace before ‘(‘ E221 multiple spaces before operator E222 multiple spaces after operator E223 tab before operator E224 tab after operator E225 missing whitespace around operator E226 (*) missing whitespace around arithmetic operator E227 missing whitespace around bitwise or shift operator E228 missing whitespace around modulo operator E231 missing whitespace after ‘,’, ‘;’, or ‘:’ E241 (*) multiple spaces after ‘,’ E242 (*) tab after ‘,’ E251 unexpected spaces around keyword / parameter equals E261 at least two spaces before inline comment E262 inline comment should start with ‘# ‘ E265 block comment should start with ‘# ‘ E266 too many leading ‘#’ for block comment E271 multiple spaces after keyword E272 multiple spaces before keyword E273 tab after keyword E274 tab before keyword E3 Blank line E301 expected 1 blank line, found 0 E302 expected 2 blank lines, found 0 E303 too many blank lines (3) E304 blank lines found after function decorator E4 Import E401 multiple imports on one line E402 module level import not at top of file E5 Line length E501 (^) line too long (82 > 79 characters) E502 the backslash is redundant between brackets E7 Statement E701 multiple statements on one line (colon) E702 multiple statements on one line (semicolon) E703 statement ends with a semicolon E704 (*) multiple statements on one line (def) E711 (^) comparison to None should be ‘if cond is None:’ E712 (^) comparison to True should be ‘if cond is True:’ or ‘if cond:’ E713 test for membership should be ‘not in’ E714 test for object identity should be ‘is not’ E721 (^) do not compare types, use ‘isinstance()’ E731 do not assign a lambda expression, use a def E9 Runtime E901 SyntaxError or IndentationError E902 IOError W1 Indentation warning W191 indentation contains tabs W2 Whitespace warning W291 trailing whitespace W292 no newline at end of file W293 blank line contains whitespace W3 Blank line warning W391 blank line at end of file W5 Line break warning W503 line break occurred before a binary operator W6 Deprecation warning W601 .has_key() is deprecated, use ‘in’ W602 deprecated form of raising exception W603 ‘<>’ is deprecated, use ‘!=’ W604 backticks are deprecated, use ‘repr()’ Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:09 "},"programming/groovy/groovy.html":{"url":"programming/groovy/groovy.html","title":"groovy","keywords":"","body":" Table of Contents generated with DocToc Map find a string in a nested Map by using recursive function find a string exists in a list of Map elvis operator if/elseif{if}/else Map find a string in a nested Map by using recursive function def hasValue( Map m, String value ) { m.containsValue(value) || m.values().find { v -> v instanceof Map && hasValue(v, value) } } another version inspired by stackoverflow: How to search value by key from Map as well as Nested Map def hasValue( Map m, String value ) { if ( m.containsValue(value) ) return m.containsValue(value) m.findResult { k, v -> v instanceof Map ? hasValue(v, value) : null } } find a string exists in a list of Map def isTargetExists( Map m, String subKey, String value ) { def map = m.findAll { it.value instanceof Map }.collect { it.key } return m.subMap(map).any { k, v -> v.get(subKey, []).contains(value) } } Map> matrix = [ dev : [ user: ['dev1', 'dev2', 'dev3'] , passwd: '123456', customer: ['yahoo', 'bing'] ] , staging : [ user: ['stg1', 'stg2', 'stg3'] , passwd: 'abcdefg' , customer: ['google', 'huawei'] ] , prod : [ user: ['prod1', 'prod2', 'prod3'] , passwd: 'a1b2c3d4' ] ] assert isTargetExists( matrix, 'user', 'dev4' ) == false assert isTargetExists( matrix, 'release', 'huawei' ) == true elvis operator if/elseif{if}/else // by using if/elseif{if}/else Map option = [:] if ( [ 'apple', 'orange' ].contains(fruits) ) { option = [ \"${fruits}\" : '5' ] } else if ( [ 'watermelon' ].contains(fruits) ) { if (mode) { option = [ \"${fruits}\" : mode] } } else { println( 'basket CANNOT be empty while fruits is watermelon' ) } // by using elvis operator Map option = ( [ 'apple', 'orange' ].contains(fruits) ) ? [ \"${fruits}\" : '5' ] : ( [ 'watermelon' ].contains(fruits) ) ? ( mode ) ? [ \"${fruits}\" : mode ] : println( 'basket CANNOT be empty while fruits is watermelon' ) : null Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:10 "},"programming/groovy/groovydoc.html":{"url":"programming/groovy/groovydoc.html","title":"groovydoc","keywords":"","body":" Table of Contents generated with DocToc Generate Groovy API doc from command line Generate Groovy API doc from command line credit belongs to HOW-TO Documenting Groovy with Groovydoc $ groovydoc -classpath /usr/local/Cellar/groovy/3.0.1/libexec/lib/ \\ -d output \\ -windowtitle \"Groovy Logging Example\" \\ -header \"Groovy 1.8 Logging (Inspired by Actual Events)\" \\ -footer \"Inspired by Actual Events: Logging in Groovy 1.8\" \\ -doctitle \"Logging in Groovy 1.8 Demonstrated\" \\ *.groovy *.java Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:10 "},"programming/groovy/map.html":{"url":"programming/groovy/map.html","title":"map","keywords":"","body":" Table of Contents generated with DocToc map withDefault map withDefault requirement: [a:1,b:2,c:2] ⇣⇣ [1:['a'], 2:['b','c']] def newMap = [:].withDefault { [] } [a:1,b:2,c:2].each { key, val -> newMap[val] alternative [a:1, b:2, c:2].inject([:].withDefault{[]}) { map, k, v -> map[v] alternatives [a:1,b:2,c:2].groupBy{ it.value }.collectEntries{ k, v -> [(k): v.collect{ it.key }] } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:10 "},"programming/groovy/tricky.html":{"url":"programming/groovy/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc get the first item if exists or null if empty split and trim in string elegant way to merge Map> structure by using groovy fuzzy search and merge Map>> groupBy List> to Map get object id (python -c 'id('abc')) getField() enum check whether if enum contains a given string list all values in Enum Convert String type to Enum get the first item if exists or null if empty assert [:]?.find{true} == null assert []?.find{true} == null assert ['a']?.find{true} == 'a' ['a': '1'].find{ true }.each { println it.key + ' ~> ' + it.value } println (['a': '1'].find{ true }.getClass()) // result // a ~> 1 // class java.util.LinkedHashMap$Entry split and trim in string spread operator: *. groovy:000> 'a , b, ccc ,d'.split(',')*.trim() ===> [a, b, ccc, d] regular expression \\s*\\s* groovy:000> 'a , b, ccc ,d'.trim().split(\"\\\\s*,\\\\s*\") ===> [a, b, ccc, d] elegant way to merge Map> structure by using groovy original Map structure wanted result Map> case_pool = [ dev : [ funcA : ['devA'] , funcB : ['devB'] , funcC : ['devC'] ], 'dev/funcA' : [ funcA : ['performanceA'] ], 'dev/funcA/feature' : [ funcA : ['performanceA', 'feature'] ], staging : [ funcB : ['stgB'] , funcC : ['stgC'] ] ] String branch = 'dev/funcA/feature-1.0' result: [ funcA: [ \"devA\", \"performanceA\", \"feature\" ], funcB: [ \"devB\" ], funcC: [ \"devC\" ] ] original map structure wanted result Map> case_pool = [   dev : [     funcA : ['devA'] ,     funcB : ['devB'] ,     funcC : ['devC']   ],   'dev/funcA' : [     funcA : ['performanceA']   ],   'dev/funcA/feature' : [     funcA : ['performanceA', 'feature']   ],   staging : [     funcB : ['stgB'] ,     funcC : ['stgC']   ] ] String branch = 'dev/funcA/feature-1.0' // will final get result of: // \" 'dev' + 'dev/funcA' + 'dev/funcA/feature' \": [   funcA: [ \"devA\", \"performanceA\", \"feature\" ],   funcB: [ \"devB\" ],   funcC: [ \"devC\" ] ] original map structure: Map> case_pool = [ dev : [ funcA : ['devA'] , funcB : ['devB'] , funcC : ['devC'] ], 'dev/funcA' : [ funcA : ['performanceA'] ], 'dev/funcA/feature' : [ funcA : ['performanceA', 'feature'] ], staging : [ funcB : ['stgB'] , funcC : ['stgC'] ] ] method 1st: by using loop String branch = 'dev/funcA/feature-1.0' def result = [:].withDefault { [] as Set } case_pool.keySet().each { if ( branch.contains(it) ) { case_pool.get(it).each { k, v -> result[k].addAll(v) } } } println 'result: ' + result method 2nd: by using closure String branch = 'dev/funcA/feature-1.0' def result = [:].withDefault { [] as Set } case_pool.findAll{ k, v -> branch.contains(k) }.collectMany{ k, v -> v.collect{ c, l -> result[c].addAll(l) }} println 'result: ' + result method 3rd: by using closure elegantly def result = case_pool.inject([:].withDefault { [] as Set }) { result, key, value -> if (branch.contains(key)) { value.each { k, v -> result[k] += v } }; result } println 'result: ' + result fuzzy search and merge Map>> /** * \"fuzzy\" search and merge the {@code Map>} according to keywords. * To replace the hardcode 'keyword' search {@code case_pool.get(stg).get(keyword).values()}. example: * * keyword = 'dev/funcA/feature1' * fuzzyFindAll( case_pool, keyword ) * => Result: [funcA:[devA, performanceA, feature], funcB:[devB], funcC:[devC]] * * * @param map the map structure for {@code Map>} * @param keyword use branch as keyword normally **/ def fuzzyFindAll( Map map, String keyword ) { Map result = [:] map.findAll{ k, v -> keyword.toLowerCase().contains(k.toLowerCase()) }.collect { k, v -> v.each { key, value -> result[key] = [ result.getOrDefault(key,[]) + value ].flatten().unique() } } return result } groupBy List> to Map requirements: [ [\"GX 470\",\"Model\"], [\"Lexus\",\"Make\"], [\"Jeep\",\"Make\"], [\"Red\",\"Color\"], [\"blue\",\"Color\"] ] ⇣⇣ [\"Model\":[\"GX 470\"],\"Make\":[\"Lexus\",\"Jeep\"],\"Color\":[\"Red\", \"blue\"]] solution def list = [ [\"GX-470\",\"Model\"], [\"Lexus\",\"Make\"], [\"Jeep\",\"Make\"], [\"Red\",\"Color\"], [\"blue\",\"Color\"] ] list.groupBy{ it[1] }.collectEntries{ k, v -> [(k): v.collect{it.get(0)}] } alternatives list.inject([:].withDefault{[]}) { map, elem -> map[elem[1]] get object id (python -c 'id('abc')) java.lang.System.identityHashCode( obj ) example String s = 'abc' String x = s println java.lang.System.identityHashCode(s) println java.lang.System.identityHashCode(x) x = s + 'aa' println java.lang.System.identityHashCode(x) ==> 51571311 51571311 733591550 example for identityHashCode() and hashCode() String a = new String(\"hhh\") String b = new String(\"hhh\") println(System.identityHashCode(a)) println(System.identityHashCode(b)) println(a.hashCode()) println(b.hashCode()) getField() groovy:000 > 'aaa'.getClass().getFields() ===> [public static final java.util.Comparator java.lang.String.CASE_INSENSITIVE_ORDER] enum precondition: enum Choices {a1, a2, b1, b2} check whether if enum contains a given string assert Arrays.asList(Choices.values()).toString().contains(\"a9\") == false assert Arrays.asList(Choices.values()).toString().contains(\"a1\") == true orassert Arrays.stream(Choices.values()).anyMatch((t) -> t.name().equals(\"a1\")) == true orassert Choices.values()*.name().contains('a1') == true assert Choices.values()*.name().contains('a9') == false or public enum Choices { a1, a2, b1, b2; public static boolean contains(String s) { try { Choices.valueOf(s); return true; } catch (Exception e) { return false; } } } Choices.contains('a1') or public enum Choices { a1, a2, b1, b2; public static boolean contains(String str) { return Arrays.asList(Choices.values()).toString().contains(str) } } assert Choices.contains('a1') == true list all values in Enum groovy:000> enum Choices {a1, a2, b1, b2} ===> true groovy:000> println Choices.values() [a1, a2, b1, b2] ===> null orList enumValues = Arrays.asList( Choices.values() ) Convert String type to Enum groovy:000> enum Choices {a1, a2, b1, b2} ===> true groovy:000> Choices.valueOf(\"a1\").getClass() ===> class Choices Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:10 "},"programming/python/config.html":{"url":"programming/python/config.html","title":"config","keywords":"","body":" Table of Contents generated with DocToc environment in MacOS setup default python pip.conf list python path python libs multiple versions version change modules re-installation PYTHONPATH /usr/local/opt/python reference: homebrew and python Installing from local packages pip list environment in MacOS setup default python $ defaults write com.apple.versioner.python Version 3.8 pip.conf user: ~/.pip/pip.conf global: /Library/Application Support/pip/pip.conf list config: $ pip config list global.index-url='https://repo.my.com/artifactory/api/pypi/tools/simple' PIP_CONF_FILE $ export PIP_CONFIG_FILE=/path/to/pip.conf upgrade all outdated modules$ pip install --upgrade --user $(pip list --outdated | sed 1,2d | awk '{print $1}' | xargs) with exclude$ pip3.9 install --upgrade --user $(pip3.9 list --outdated | sed 1,2d | awk '{print $1}' | grep -vw 'docker\\|rich') list python path $ python -vv -c \"import sys; print sys.path\" $ python -vvE -c \"import sys; print sys.path\" $ python -vvEsS -c \"import sys; print sys.path\" python libs global $ ls -ld /usr/local/lib/python*/ drwxr-xr-x 3 marslo admin 96 May 17 2019 /usr/local/lib/python2.7/ drwxr-xr-x 3 marslo admin 96 May 17 2019 /usr/local/lib/python3.7/ drwxr-xr-x 3 marslo admin 96 Jan 13 2020 /usr/local/lib/python3.8/ drwxr-xr-x 3 marslo admin 96 Oct 10 17:06 /usr/local/lib/python3.9/ $ ls -ld /Library/Python/2.7/site-packages/ drwxr-xr-x 9 root wheel 288 Aug 6 18:16 /Library/Python/2.7/site-packages/ or $ ls $(brew --prefix)/lib/python* /usr/local/lib/python2.7: site-packages /usr/local/lib/python3.7: site-packages /usr/local/lib/python3.8: site-packages /usr/local/lib/python3.9: site-packages local $ ls -ld ~/Library/Python/*/ drwx------ 4 marslo staff 128 Aug 6 17:23 /Users/marslo/Library/Python/2.7/ drwx------ 5 marslo staff 160 Oct 12 21:17 /Users/marslo/Library/Python/3.7/ drwx------ 5 marslo staff 160 Oct 27 19:24 /Users/marslo/Library/Python/3.8/ drwx------ 5 marslo staff 160 Oct 27 19:24 /Users/marslo/Library/Python/3.9/ how to check $ /usr/bin/python -c 'import site; print(site.USER_BASE)' /Users/marslo/Library/Python/2.7 $ /usr/local/bin/python3.9 -c 'import site; print(site.USER_BASE)' /Users/marslo/Library/Python/3.9 multiple versions get current working version $ CFLAGS=-I$(brew --prefix)/include LDFLAGS=-L$(brew --prefix)/lib pip --version pip 20.2.4 from /Users/marslo/Library/Python/3.8/lib/python/site-packages/pip (python 3.8) or$ $(brew --prefix)/opt/python/libexec/bin/python -V Python 3.8.6 upgrade particular modules $ sudo -H python3.9 -m pip install --upgrade pip Collecting pip Using cached pip-20.2.4-py2.py3-none-any.whl (1.5 MB) Installing collected packages: pip Attempting uninstall: pip Found existing installation: pip 20.2.3 Uninstalling pip-20.2.3: Successfully uninstalled pip-20.2.3 Successfully installed pip-20.2.4 upgrade to previous version$ pip install --upgrade --no-cache-dir --pre pip install all older version modules $ /usr/local/bin/python3.8 -m pip freeze > pip3.8-requirements.txt $ sudo -H /usr/local/bin/python3.9 -m pip install --pre -r pip3.8-requirements.txt reference: $ CFLAGS=-I$(brew --prefix)/include LDFLAGS=-L$(brew --prefix)/lib pip freeze beautifulsoup4==4.9.1 certifi==2020.6.20 cffi==1.14.1 chardet==3.0.4 click==7.1.2 click-config-file==0.6.0 colorama==0.4.3 ... or $ pip list --outdate --format=freeze docker==4.2.2 rich==3.0.5 $ pip list -o --format columns Package Version Latest Type ------- ------- ------ ----- docker 4.2.2 4.3.1 wheel rich 3.0.5 9.1.0 whee $ pip list --outdate --format=json [{\"name\": \"docker\", \"version\": \"4.2.2\", \"latest_version\": \"4.3.1\", \"latest_filetype\": \"wheel\"}, {\"name\": \"rich\", \"version\": \"3.0.5\", \"latest_version\": \"9.1.0\", \"latest_filetype\": \"wheel\"}] version change change default python from 3.8 to 3.9 modules re-installation $ /usr/local/bin/python3.8 -m pip freeze > pip3.8-requirements.txt $ sudo -H /usr/local/bin/python3.9 -m pip install --pre -r pip3.8-requirements.txt PYTHONPATH $ export PYTHONPATH=\"/usr/local/lib/python3.8/site-packages:$PYTHONPATH\" ⇣⇣ $ export PYTHONPATH=\"/usr/local/lib/python3.9/site-packages:$PYTHONPATH\" /usr/local/opt/python $ unlink /usr/local/opt/python $ ln -sf /usr/local/Cellar/python@3.9/3.9.0 /usr/local/opt/python $ unlink /usr/local/bin/python $ ln -sf /usr/local/Cellar/python@3.9/3.9.0/bin/python3.9 /usr/local/bin/python3 $ ln -sf /usr/local/Cellar/python@3.9/3.9.0/bin/python3.9 /usr/local/bin/python $ export PYTHONUSERBASE=\"$(/usr/local/opt/python/libexec/bin/python -c 'import site; print(site.USER_BASE)')\" $ export PYTHON3='/usr/local/opt/python/libexec/bin' $ export PATH=\"$PYTHONUSERBASE/bin:${PYTHON3}:$PATH\" Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:09 "},"programming/python/list.html":{"url":"programming/python/list.html","title":"list","keywords":"","body":" Table of Contents generated with DocToc list copy reverse list cast format (str -> int) zip two lists list mathematical list copy inspired by How to clone or copy a list? in stackoverflow clone_list = sample_list.copy() orclone_list = sample_list[:] orclone_list = list(sample_list) orimport copy clone_list = copy.copy(sample_list) or import copy clone_list = copy.deepcopy(sample_list) example: >>> id(x) 4505979072 >>> k = x >>> id(k) 4505979072 >>> k = x.copy() >>> id(k) 4445208000 >>> k = x[:] >>> id(k) 4505977632 >>> import copy >>> k = copy.copy(x) >>> id(k) 4505754352 >>> k = copy.deepcopy(x) >>> id(k) 4505978352 >>> k = x[:] >>> id(k) 4506260896 >>> k = copy.deepcopy(x) >>> id(k) 4506261136 reverse list sample_list[::-1] example:>>> ['1', '2', '3', '4', '5'][::-1] ['5', '4', '3', '2', '1'] cast format (str -> int) list( map(int, sample_list) ) example:>>> print( list( map(int, ['2', '8', '4', '127', 'HKD'][:3][::-1] ) ) ) [4, 8, 2] zip two lists >> from itertools import zip_longest >>> x = ['1', '2', '3', '4'] >>> y = ['one', 'two', 'three', 'four'] >>> for i, j in zip_longest( x, y ): print(i, j) 1 one 2 two 3 three 4 four or zip to a map>>> x = ['1', '2', '3', '4'] >>> y = ['one', 'two', 'three', 'four'] >>> print( {key: value for key, value in zip_longest(x, y)} ) {'1': 'one', '2': 'two', '3': 'three', '4': 'four'} list mathematical sum >>> n = ['1', '2', '3', '4'] >>> print( sum( list( map(int, n) ) ) ) 10 multiplication python Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:09 "},"programming/python/pip.html":{"url":"programming/python/pip.html","title":"pip","keywords":"","body":" Table of Contents generated with DocToc installation cache dir and clean caches for global user (or non user) re-install package in site.USER_BASE setup default python version installation cache dir and clean caches clean cache ([pip cache](https://pip.pypa.io/en/stable/reference/pip_cache/))$ pip cache purge $ pip cache remove matplotlib set no cache ([pip config](https://pip.pypa.io/en/stable/reference/pip_config/)) $ pip install --no-cache-dir # or $ pip config set global.cache-dir false for global user (or non user) export PYTHONPATH=\"/usr/local/lib/python3.9/site-packages:$PYTHONPATH\" # load the user's $HOME/.pip/pip.conf $ sudo python -m pip install or # CANNOT load the user's $HOME/.pip/pip.conf $ sudo -H pip install re-install package in site.USER_BASE $ python -c 'import site; print(site.USER_BASE)' /Users/marslo/Library/Python/3.9 $ export PYTHONUSERBASE=\"$(python -c 'import site; print(site.USER_BASE)')\" $ pip install --upgrade --force-reinstall --user reference: Can I force pip to reinstall the current version? setup default python version # temporary $ export VERSIONER_PYTHON_VERSION=3.9 $ defaults write com.apple.versioner.python Version 3.9 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:09 "},"programming/python/qa.html":{"url":"programming/python/qa.html","title":"q&a","keywords":"","body":" Table of Contents generated with DocToc Q&A pkg_resources.VersionConflict ImportError: No module named pkg_resources No module named pip Q&A pkg_resources.VersionConflict issue $ sudo -H pip install --upgrade pip ... $ pip --version Traceback (most recent call last): File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 584, in _build_master ws.require(__requires__) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 901, in require needed = self.resolve(parse_requirements(requirements)) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 792, in resolve raise VersionConflict(dist, req).with_context(dependent_req) pkg_resources.VersionConflict: (pip 20.1.1 (/Users/marslo/Library/Python/3.7/lib/python/site-packages), Requirement.parse('pip==20.0.2')) During handling of the above exception, another exception occurred: Traceback (most recent call last): File \"/usr/local/opt/python/bin/pip3\", line 6, in from pkg_resources import load_entry_point File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 3254, in @_call_aside File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 3238, in _call_aside f(*args, **kwargs) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 3267, in _initialize_master_working_set working_set = WorkingSet._build_master() File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 586, in _build_master return cls._build_from_requirements(__requires__) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 599, in _build_from_requirements dists = ws.resolve(reqs, Environment()) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 787, in resolve raise DistributionNotFound(req, requirers) pkg_resources.DistributionNotFound: The 'pip==20.0.2' distribution was not found and is required by the application $ which -a pip /usr/local/opt/python/libexec/bin/pip /usr/local/bin/pip $ la /usr/local/opt/python/libexec/bin/pip lrwxr-xr-x 1 marslo staff 14 Jul 6 18:23 /usr/local/opt/python/libexec/bin/pip -> ../../bin/pip3 $ /usr/local/opt/python/bin/pip3 --version Traceback (most recent call last): File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 584, in _build_master ws.require(__requires__) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 901, in require needed = self.resolve(parse_requirements(requirements)) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 792, in resolve raise VersionConflict(dist, req).with_context(dependent_req) pkg_resources.VersionConflict: (pip 20.1.1 (/Users/marslo/Library/Python/3.7/lib/python/site-packages), Requirement.parse('pip==20.0.2')) .... solution $ which -a pip /usr/local/opt/python/libexec/bin/pip /usr/local/bin/pip $ la /usr/local/opt/python/libexec/bin/pip lrwxr-xr-x 1 marslo staff 14 Jul 6 18:23 /usr/local/opt/python/libexec/bin/pip -> ../../bin/pip3 $ which -a pip3 /usr/local/bin/pip3 /usr/bin/pip3 ln -sf $ mv /usr/local/opt/python/bin/pip3{,.bak} $ ln -sf /usr/local/bin/pip3 /usr/local/opt/python/bin/pip3 re-install $ brew reinstall python $ sudo rm -rf /usr/local/lib/python3.7/site-packages/pip/ $ brew postinstall python $ pip --version pip 20.0.2 from /usr/local/lib/python3.7/site-packages/pip (python 3.7) $ sudo -H python3 -m pip install --force-reinstall pip $ pip --version pip 20.1.1 from /usr/local/lib/python3.7/site-packages/pip (python 3.7) ImportError: No module named pkg_resources precondition: $ which -a python /usr/local/opt/python/libexec/bin/python /usr/bin/python $ realpath /usr/bin/python /System/Library/Frameworks/Python.framework/Versions/2.7/bin/python2.7 issue $ /usr/bin/xattr Traceback (most recent call last): File \"/usr/bin/xattr\", line 8, in from pkg_resources import load_entry_point ImportError: No module named pkg_resources solution restore ~/Library/Python/2.7 $ mkdir -p ~/Library/Python/2.7/lib/python $ cp -r /usr/local/lib/python2.7/site-packages ~/Library/Python/2.7/lib/python/ $ sudo chown -R $(whoami):staff ~/Library/Python/2.7 # or $ sudo chown -R $USER:$(id -g) /Users/$USER/Library/Python result: $ /usr/bin/python -m pip list DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Package Version ---------------------------- --------- backports.ssl-match-hostname 3.7.0.1 certifi 2019.6.16 chardet 3.0.4 Click 7.0 click-config-file 0.5.0 colorama 0.4.1 configobj 5.0.6 docker 4.0.2 idna 2.8 ipaddress 1.0.22 Markdown 3.1.1 mdv 1.7.4 pip 19.1.1 Pygments 2.4.2 requests 2.22.0 setuptools 41.0.1 six 1.12.0 tabulate 0.8.3 urllib3 1.25.3 websocket-client 0.56.0 wheel 0.33.4 $ /usr/bin/xattr Traceback (most recent call last): File \"/usr/bin/xattr\", line 8, in from pkg_resources import load_entry_point File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 3241, in @_call_aside File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 3225, in _call_aside f(*args, **kwargs) File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 3254, in _initialize_master_working_set working_set = WorkingSet._build_master() File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 583, in _build_master ws.require(__requires__) File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 900, in require needed = self.resolve(parse_requirements(requirements)) File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 786, in resolve raise DistributionNotFound(req, requirers) pkg_resources.DistributionNotFound: The 'xattr==0.6.4' distribution was not found and is required by the application install setuptools==39.1.0 and xattr==0.6.4 $ sudo -H python -m pip install --upgrade pip setuptools wheel $ sudo -H /usr/bin/python -m pip uninstall -y setuptools $ /usr/bin/python -m pip install --user setuptools==39.1.0 DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Collecting setuptools==39.1.0 Installing collected packages: setuptools Found existing installation: setuptools 41.0.1 Uninstalling setuptools-41.0.1: Successfully uninstalled setuptools-41.0.1 Successfully installed setuptools-39.1.0 $ curl -fsSL https://raw.githubusercontent.com/marslo/ibook/master/programming/python/xattr-0.6.4.tar.gz -o xattr-0.6.4.tar.gz $ /usr/bin/python -m pip install --user xattr-0.6.4.tar.gz DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Processing ./xattr-0.6.4.tar.gz Building wheels for collected packages: xattr Building wheel for xattr (setup.py) ... done Stored in directory: /Users/marslo/Library/Caches/pip/wheels/63/db/04/be8c6e423b8158e30b1d63992368c899811286844edf41ce32 Successfully built xattr Installing collected packages: xattr WARNING: The script xattr is installed in '/Users/marslo/Library/Python/2.7/bin' which is not on PATH. Consider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location. Successfully installed xattr-0.6.4 result: $ /usr/bin/xattr -h usage: xattr [-lz] file [file ...] xattr -p [-lz] attr_name file [file ...] xattr -w [-z] attr_name attr_value file [file ...] xattr -d attr_name file [file ...] The first form lists the names of all xattrs on the given file(s). The second form (-p) prints the value of the xattr attr_name. The third form (-w) sets the value of the xattr attr_name to attr_value. The fourth form (-d) deletes the xattr attr_name. options: -h: print this help -l: print long format (attr_name: attr_value) -z: compress or decompress (if compressed) attribute value in zip format $ /usr/bin/python -m pip list DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Package Version ---------------------------- --------- backports.ssl-match-hostname 3.7.0.1 certifi 2019.6.16 chardet 3.0.4 Click 7.0 click-config-file 0.5.0 colorama 0.4.1 configobj 5.0.6 docker 4.0.2 idna 2.8 ipaddress 1.0.22 Markdown 3.1.1 mdv 1.7.4 pip 19.1.1 Pygments 2.4.2 requests 2.22.0 setuptools 39.1.0 six 1.12.0 tabulate 0.8.3 urllib3 1.25.3 websocket-client 0.56.0 wheel 0.33.4 xattr 0.6.4 reinstall xattr==0.6.4 for global [if necessary] $ sudo -H /usr/bin/python -m pip install xattr-0.6.4.tar.gz DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Processing /Users/marslo/Desktop/xattr-0.6.4.tar.gz Building wheels for collected packages: xattr Building wheel for xattr (setup.py) ... error ERROR: Complete output from command /System/Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python -u -c 'import setuptools, tokenize;__file__='\"'\"'/private/tmp/pip-req-build-dVgPOl/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' bdist_wheel -d /private/tmp/pip-wheel-ZV80PW --python-tag cp27: ERROR: usage: -c [global_opts] cmd1 [cmd1_opts] [cmd2 [cmd2_opts] ...] or: -c --help [cmd1 cmd2 ...] or: -c --help-commands or: -c cmd --help error: invalid command 'bdist_wheel' ---------------------------------------- ERROR: Failed building wheel for xattr Running setup.py clean for xattr Failed to build xattr Installing collected packages: xattr Found existing installation: xattr 0.6.4 Uninstalling xattr-0.6.4: Successfully uninstalled xattr-0.6.4 Running setup.py install for xattr ... done Successfully installed xattr-0.6.4 No module named pip issue $ sudo -H /usr/bin/python -m pip install --upgrade pip setuptools wheel /System/Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python: No module named pip solution $ sudo -H /usr/bin/python -m ensurepip --default-pip Looking in links: /tmp/tmpkmqQV6 Requirement already satisfied: setuptools in /Library/Python/2.7/site-packages (39.1.0) Collecting pip Installing collected packages: pip Successfully installed pip-18.1 verify $ sudo /usr/bin/python -m pip install --upgrade pip setuptools wheel DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality. WARNING: The directory '/Users/marslo/Library/Caches/pip' or its parent directory is not owned or is not writable by the current user. The cache has been disabled. Check the permissions and owner of that directory. If executing pip with sudo, you may want sudo's -H flag. Looking in indexes: https://ssdfw-repo-dev.marvell.com/artifactory/api/pypi/tools/simple Requirement already up-to-date: pip in /Users/marslo/Library/Python/2.7/lib/python/site-packages (20.2.4) Requirement already up-to-date: setuptools in /Users/marslo/Library/Python/2.7/lib/python/site-packages (44.1.1) Requirement already up-to-date: wheel in /Users/marslo/Library/Python/2.7/lib/python/site-packages (0.35.1) $ ls -Altrh /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python alternatives get-pip.py $ curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py $ /usr/bin/python get-pip.py Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:09 "},"programming/others.html":{"url":"programming/others.html","title":"others","keywords":"","body":" Table of Contents generated with DocToc Import data to SQL and print process Get the cnf file location for MySQL Get the git change from .git/objects unicode Simple arrows Arrows with modifications Arrows with bent tips Keyboard symbols and circle arrows Harpoons Paired arrows and harpoons Double arrows Miscellaneous arrows and keyboard symbols White arrows and keyboard symbols Miscellaneous arrows Import data to SQL and print process $ (pv -n ~/database.sql | mysql -u root -pPASSWORD -D database_name) 2>&1 | zenity --width 550 --progress --auto-close --auto-kill --title \"Im Get the cnf file location for MySQL $ mysql - ? | grep \".cnf\" -C 1 Default options are read from the following files in the given order: /etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/etc/my.cnf ~/.my.cnf The following groups are read: mysql client Get the git change from .git/objects $ find .git/objects -type f -printf \"%P\\n\" | sed s,/,, | while read object; do echo \"=== $obj $(git cat-file -t $object) ===\" git cat-file -p $object done unicode reference arrow Arrows amp-what Simple arrows CODE Symbols explanation 2190 ← LEFTWARDS ARROW 20EA ◌⃪ combining leftwards arrow overlay 2191 ↑ UPWARDS ARROW 2192 → RIGHTWARDS ARROW 2193 ↓ DOWNWARDS ARROW 2194 ↔ LEFT RIGHT ARROW 2195 ↕ UP DOWN ARROW 2196 ↖ NORTH WEST ARROW 2197 ↗ NORTH EAST ARROW 2198 ↘ SOUTH EAST ARROW 2199 ↙ SOUTH WEST ARROW Arrows with modifications CODE Symbols explanation 219A ↚ LEFTWARDS ARROW WITH STROKE 219B ↛ RIGHTWARDS ARROW WITH STROKE 219C ↜ LEFTWARDS WAVE ARROW 2B3F ⬿ wave arrow pointing directly left 219D ↝ RIGHTWARDS WAVE ARROW 219E ↞ LEFTWARDS TWO HEADED ARROW 219F ↟ UPWARDS TWO HEADED ARROW 21A0 ↠ RIGHTWARDS TWO HEADED ARROW 21A1 ↡ DOWNWARDS TWO HEADED ARROW 21A2 ↢ LEFTWARDS ARROW WITH TAIL 21A3 ↣ RIGHTWARDS ARROW WITH TAIL 21A4 ↤ LEFTWARDS ARROW FROM BAR 21A5 ↥ UPWARDS ARROW FROM BAR 21A6 ↦ RIGHTWARDS ARROW FROM BAR 21A7 ↧ DOWNWARDS ARROW FROM BAR 21A8 ↨ UP DOWN ARROW WITH BASE 21A9 ↩ LEFTWARDS ARROW WITH HOOK 21AA ↪ RIGHTWARDS ARROW WITH HOOK 21AB ↫ LEFTWARDS ARROW WITH LOOP 21AC ↬ RIGHTWARDS ARROW WITH LOOP 21AD ↭ LEFT RIGHT WAVE ARROW 21AE ↮ LEFT RIGHT ARROW WITH STROKE 21AF ↯ DOWNWARDS ZIGZAG ARROW Arrows with bent tips Other arrows with bent tips to complete this set can be found in the Miscellaneous Symbols and Arrows block. CODE Symbols explanation 21B0 ↰ UPWARDS ARROW WITH TIP LEFTWARDS 21B1 ↱ UPWARDS ARROW WITH TIP RIGHTWARDS 21B2 ↲ DOWNWARDS ARROW WITH TIP LEFTWARDS 21B3 ↳ DOWNWARDS ARROW WITH TIP RIGHTWARDS Keyboard symbols and circle arrows CODE Symbols explanation 21B4 ↴ RIGHTWARDS ARROW WITH CORNER DOWNWARDS 21B5 ↵ DOWNWARDS ARROW WITH CORNER LEFTWARDS 23CE ⏎ return symbol 21B6 ↶ ANTICLOCKWISE TOP SEMICIRCLE ARROW 21B7 ↷ CLOCKWISE TOP SEMICIRCLE ARROW 21B8 ↸ NORTH WEST ARROW TO LONG BAR 21B9 ↹ LEFTWARDS ARROW TO BAR OVER RIGHTWARDS ARROW TO BAR 21BA ↺ ANTICLOCKWISE OPEN CIRCLE ARROW 21BB ↻ CLOCKWISE OPEN CIRCLE ARROW Harpoons CODE Symbols explanation 21BC ↼ LEFTWARDS HARPOON WITH BARB UPWARDS 21BD ↽ LEFTWARDS HARPOON WITH BARB DOWNWARDS 21BE ↾ UPWARDS HARPOON WITH BARB RIGHTWARDS 21BF ↿ UPWARDS HARPOON WITH BARB LEFTWARDS 21C0 ⇀ RIGHTWARDS HARPOON WITH BARB UPWARDS 21C1 ⇁ RIGHTWARDS HARPOON WITH BARB DOWNWARDS 21C2 ⇂ DOWNWARDS HARPOON WITH BARB RIGHTWARDS 21C3 ⇃ DOWNWARDS HARPOON WITH BARB LEFTWARDS Paired arrows and harpoons CODE Symbols explanation 21C4 ⇄ RIGHTWARDS ARROW OVER LEFTWARDS ARROW 21C5 ⇅ UPWARDS ARROW LEFTWARDS OF DOWNWARDS ARROW 21C6 ⇆ LEFTWARDS ARROW OVER RIGHTWARDS ARROW 21C7 ⇇ LEFTWARDS PAIRED ARROWS 21C8 ⇈ UPWARDS PAIRED ARROWS 21C9 ⇉ RIGHTWARDS PAIRED ARROWS 21CA ⇊ DOWNWARDS PAIRED ARROWS 21CB ⇋ LEFTWARDS HARPOON OVER RIGHTWARDS HARPOON 21CC ⇌ RIGHTWARDS HARPOON OVER LEFTWARDS HARPOON Double arrows CODE Symbols explanation 21CD ⇍ LEFTWARDS DOUBLE ARROW WITH STROKE 21CE ⇎ LEFT RIGHT DOUBLE ARROW WITH STROKE 21CF ⇏ RIGHTWARDS DOUBLE ARROW WITH STROKE 21D0 ⇐ LEFTWARDS DOUBLE ARROW 21D1 ⇑ UPWARDS DOUBLE ARROW 21D2 ⇒ RIGHTWARDS DOUBLE ARROW 21D3 ⇓ DOWNWARDS DOUBLE ARROW 21D4 ⇔ LEFT RIGHT DOUBLE ARROW 21D5 ⇕ UP DOWN DOUBLE ARROW 21D6 ⇖ NORTH WEST DOUBLE ARROW 21D7 ⇗ NORTH EAST DOUBLE ARROW 21D8 ⇘ SOUTH EAST DOUBLE ARROW 21D9 ⇙ SOUTH WEST DOUBLE ARROW Miscellaneous arrows and keyboard symbols CODE Symbols explanation 21DA ⇚ LEFTWARDS TRIPLE ARROW 21DB ⇛ RIGHTWARDS TRIPLE ARROW 21DC ⇜ LEFTWARDS SQUIGGLE ARROW 2B33 ⬳ long leftwards squiggle arrow 21DD ⇝ RIGHTWARDS SQUIGGLE ARROW 21DE ⇞ UPWARDS ARROW WITH DOUBLE STROKE 21DF ⇟ DOWNWARDS ARROW WITH DOUBLE STROKE 21E0 ⇠ LEFTWARDS DASHED ARROW 21E1 ⇡ UPWARDS DASHED ARROW 21E2 ⇢ RIGHTWARDS DASHED ARROW 21E3 ⇣ DOWNWARDS DASHED ARROW 21E4 ⇤ LEFTWARDS ARROW TO BAR 21E5 ⇥ RIGHTWARDS ARROW TO BAR White arrows and keyboard symbols CODE Symbols explanation 21E6 ⇦ LEFTWARDS WHITE ARROW 2B00 ⬀ north east white arrow 21E7 ⇧ UPWARDS WHITE ARROW 21E8 ⇨ RIGHTWARDS WHITE ARROW 21E9 ⇩ DOWNWARDS WHITE ARROW 21EA ⇪ UPWARDS WHITE ARROW FROM BAR 21EB ⇫ UPWARDS WHITE ARROW ON PEDESTAL 21EC ⇬ UPWARDS WHITE ARROW ON PEDESTAL WITH HORIZONTAL BAR 21ED ⇭ UPWARDS WHITE ARROW ON PEDESTAL WITH VERTICAL BAR 21EE ⇮ UPWARDS WHITE DOUBLE ARROW 21EF ⇯ UPWARDS WHITE DOUBLE ARROW ON PEDESTAL 21F0 ⇰ RIGHTWARDS WHITE ARROW FROM WALL 21F1 ⇱ NORTH WEST ARROW TO CORNER 21F2 ⇲ SOUTH EAST ARROW TO CORNER 21F3 ⇳ UP DOWN WHITE ARROW 2B04 ⬄ left right white arrow Miscellaneous arrows CODE Symbols explanation 21F4 ⇴ RIGHT ARROW WITH SMALL CIRCLE 2B30 ⬰ left arrow with small circle 21F5 ⇵ DOWNWARDS ARROW LEFTWARDS OF UPWARDS ARROW 21F6 ⇶ THREE RIGHTWARDS ARROWS 2B31 ⬱ three leftwards arrows 21F7 ⇷ LEFTWARDS ARROW WITH VERTICAL STROKE 21F8 ⇸ RIGHTWARDS ARROW WITH VERTICAL STROKE 21F9 ⇹ LEFT RIGHT ARROW WITH VERTICAL STROKE 21FA ⇺ LEFTWARDS ARROW WITH DOUBLE VERTICAL STROKE 21FB ⇻ RIGHTWARDS ARROW WITH DOUBLE VERTICAL STROKE 21FC ⇼ LEFT RIGHT ARROW WITH DOUBLE VERTICAL STROKE 21FD ⇽ LEFTWARDS OPEN-HEADED ARROW 21FE ⇾ RIGHTWARDS OPEN-HEADED ARROW 21FF ⇿ LEFT RIGHT OPEN-HEADED ARROW Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:10 "},"programming/archive/archive.html":{"url":"programming/archive/archive.html","title":"archive","keywords":"","body":"Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-10 20:28:18 "},"programming/archive/angular/config.html":{"url":"programming/archive/angular/config.html","title":"angular","keywords":"","body":" Table of Contents generated with DocToc Download NodeJs Install yo Install compass by gem Install Angular Startup server Download NodeJs For 64bit ┌─ (marslo@MarsloJiao ~) -> └─ $ wget http://nodejs.org/dist/v0.10.29/node-v0.10.29-linux-x64.tar.gz For 32bit ┌─ (marslo@MarsloJiao ~) -> └─ $ wget http://nodejs.org/dist/v0.10.29/node-v0.10.29-linux-x86.tar.gz Install yo ┌─ (marslo@MarsloJiao ~) -> └─ $ sudo npm install -g yo Install compass by gem ┌─ (marslo@MarsloJiao ~) -> └─ $ sudo gem install compass The solution for kernel_require.rb:55:inrequire': libyaml-0.so.2: cannot open shared object file: No such file or directory - /../../psych.so (LoadError)` Install Angular ┌─ (marslo@MarsloJiao ~/client) -> └─ $ npm install generator-angular ┌─ (marslo@MarsloJiao ~/client) -> └─ $ yo angular ┌─ (marslo@MarsloJiao ~/client) -> └─ $ bower install Startup server ┌─ (marslo@MarsloJiao ~/client) -> └─ $ grunt serve Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:08 "},"programming/archive/maven/":{"url":"programming/archive/maven/","title":"maven","keywords":"","body":" Table of Contents generated with DocToc Compile and Execute java file by manual Compile and Execute by maven Scaffold in Maven Compile and Execute java file by manual Compile [16:59:13.56 C:\\hello-world\\src\\main\\java] $ javac com\\juvenxu\\mvnbook\\helloworld\\HelloWorld.java Execute [16:59:20.89 C:\\hello-world\\src\\main\\java] $ java com.juvenxu.mvnbook.helloworld.HelloWorld Hello Maven Compile and Execute by maven Compile [16:55:49.04 C:\\hello-world] $ mvn clean compile [INFO] Scanning for projects... [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 1.916 s [INFO] Finished at: 2014-11-28T17:02:36+08:00 [INFO] Final Memory: 12M/150M [INFO] ------------------------------------------------------------------------ Test [17:02:39.17 C:\\hello-world] $ mvn clean test [INFO] Scanning for projects... [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\test\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world --- [INFO] Surefire report directory: C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.juvenxu.mvnbook.helloworld.HelloWorldTest Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.06 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 4.639 s [INFO] Finished at: 2014-11-28T17:03:42+08:00 [INFO] Final Memory: 13M/159M [INFO] ------------------------------------------------------------------------ Package [18:36:28.23 C:\\hello-world] $ mvn clean package [INFO] Scanning for projects... [WARNING] [WARNING] Some problems were encountered while building the effective model for com.juvenxu.mvnbook:hello-world:jar:1.0-SNAPSHOT [WARNING] 'build.plugins.plugin.version' for org.apache.maven.plugins:maven-compiler-plugin is missing. @ line 21, column 15 [WARNING] [WARNING] It is highly recommended to fix these problems because they threaten the stability of your build. [WARNING] [WARNING] For this reason, future Maven versions might no longer support building such malformed projects. [WARNING] [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\test\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world --- [INFO] Surefire report directory: C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.juvenxu.mvnbook.helloworld.HelloWorldTest Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.06 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] [INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ hello-world --- [INFO] Building jar: C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 5.571 s [INFO] Finished at: 2014-11-28T18:36:41+08:00 [INFO] Final Memory: 15M/201M [INFO] ------------------------------------------------------------------------ Install [19:02:40.49 c:\\hello-world] $ mvn clean install [INFO] Scanning for projects... [WARNING] [WARNING] Some problems were encountered while building the effective model for com.juvenxu.mvnbook:hello-world:jar:1.0-SNAPSHOT [WARNING] 'build.plugins.plugin.version' for org.apache.maven.plugins:maven-compiler-plugin is missing. @ line 21, column 15 [WARNING] [WARNING] It is highly recommended to fix these problems because they threaten the stability of your build. [WARNING] [WARNING] For this reason, future Maven versions might no longer support building such malformed projects. [WARNING] [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\test\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world --- [INFO] Surefire report directory: c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.juvenxu.mvnbook.helloworld.HelloWorldTest Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.05 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] [INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ hello-world --- [INFO] Building jar: c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar [INFO] [INFO] --- maven-shade-plugin:1.2.1:shade (default) @ hello-world --- [INFO] Replacing original artifact with shaded artifact. [INFO] Replacing c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar with c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT-shaded.jar [INFO] [INFO] --- maven-install-plugin:2.4:install (default-install) @ hello-world --- [INFO] Installing c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar to C:\\Users\\marslo_jiao\\.m2\\repository\\com\\juvenxu\\mvnbook\\hello-world\\1.0-SNAPSHOT\\hello-world-1.0-SNAPSHOT.jar [INFO] Installing c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\pom.xml to C:\\Users\\marslo_jiao\\.m2\\repository\\com\\juvenxu\\mvnbook\\hello-world\\1.0-SNAPSHOT\\hello-world-1.0-SNAPSHOT.pom [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 5.429 s [INFO] Finished at: 2014-11-28T19:03:44+08:00 [INFO] Final Memory: 16M/201M [INFO] ------------------------------------------------------------------------ Verification [19:09:52.90 c:\\hello-world\\target] $ java -jar hello-world-1.0-SNAPSHOT.jar Hello Maven [19:09:57.52 c:\\hello-world\\target] $ jar xf hello-world-1.0-SNAPSHOT.jar [19:10:46.36 c:\\hello-world\\target] $ cat META-INF\\MANIFEST.MF Manifest-Version: 1.0 Archiver-Version: Plexus Archiver Built-By: Marslo_Jiao Created-By: Apache Maven 3.2.3 Build-Jdk: 1.8.0_25 Main-Class: com.juvenxu.mvnbook.helloworld.HelloWorld Scaffold in Maven Maven 3.x [13:05:17.08 C:\\archetype] $ mvn archetype:generate ... Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): 502: Choose org.apache.maven.archetypes:maven-archetype-quickstart version: 1: 1.0-alpha-1 2: 1.0-alpha-2 3: 1.0-alpha-3 4: 1.0-alpha-4 5: 1.0 6: 1.1 Choose a number: 6: Define value for property 'package': com.juvenxu.mvnbook: : com.juvenxu.mvnbook.helloworld Confirm properties configuration: groupId: com.juvenxu.mvnbook artifactId: hello-world version: 1.0-SNAPSHOT package: com.juvenxu.mvnbook.helloworld Y: : Y ... Maven 2.x $ mvn org.apache.maven.plugins:maven-archetype-plugin:2.0-alpha-5:generate Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:08 "},"programming/archive/mysql/installation/installDB.html":{"url":"programming/archive/mysql/installation/installDB.html","title":"mysql","keywords":"","body":" Table of Contents generated with DocToc The log of scripts/mysql_install_db --user=mysql The log of scripts/mysql_install_db --user=mysql Installing MySQL system tables...OK Filling help tables...OK To start mysqld at boot time you have to copy support-files/mysql.server to the right place for your system PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER ! To do so, start the server, then issue the following commands: ./bin/mysqladmin -u root password 'new-password' ./bin/mysqladmin -u root -h MJ password 'new-password' Alternatively you can run: ./bin/mysql_secure_installation which will also give you the option of removing the test databases and anonymous user created by default. This is strongly recommended for production servers. See the manual for more instructions. You can start the MySQL daemon with: cd . ; ./bin/mysqld_safe & You can test the MySQL daemon with mysql-test-run.pl cd mysql-test ; perl mysql-test-run.pl Please report any problems with the ./bin/mysqlbug script! The latest information about MySQL is available on the web at http://www.mysql.com Support MySQL by buying support/licenses at http://shop.mysql.com New default config file was created as ./my.cnf and will be used by default by the server when you start it. You may edit this file to change server settings Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:08 "},"programming/archive/mysql/installation/installFromSourceCode.html":{"url":"programming/archive/mysql/installation/installFromSourceCode.html","title":"installFromSourceCode","keywords":"","body":" Table of Contents generated with DocToc Install MySQL from Source code Usefull Links Compile and Install Configuration and Initial Set Environment Check the mysql port Check variables Make mysql as boot start Install MySQL from Source code Usefull Links Community Server 5.7 MySQL Community Server 5.6 MySQL Community Server MySQL source code mysql-5.7.3-m13.tar.gz mysql-5.6.16.tar.gz Documents MySQL Document MySQL Online manual 2.8.2. Installing MySQL Using a Standard Source Distribution 2.8.4. MySQL Source-Configuration Options Compile and Install Preconfiguration Setup Create user and group $ sudo groupadd mysql $ sudo useradd -r -g mysql mysql Extract tar.gz $ tar xf mysql-5.7.3-m13.tar.gz $ cd mysql-5.7.3-m13 Compile and Install $ cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\ > -DDEFAULT_CHARSET=gbk \\ > -DDEFAULT_COLLATION=gbk_chinese_ci \\ > -DENABLED_LOCAL_INFILE=ON \\ > -DWITH_INNOBASE_STORAGE_ENGINE=1 \\ > -DWITH_FEDERATED_STORAGE_ENGINE=1 \\ > -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\ > -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \\ > -DWITH_DEBUG=0 \\ > -DMYSQL_TCP_PORT=3306 $ make $ sudo make install cmake logs Configuration and Initial Permission Manager $ sudo chown -R mysql:mysql /usr/local/mysql Initial MySQL $ scripts/mysql_install_db --user=mysql $ cp support-files/mysql.server /etc/init.d/mysqld Log of mysql_install_db --user=mysql Change Permission again $ sudo chown -R root . $ sudo chown -R mysql data Start mysqld_safe $ sudo bin/mysqld_safe --user=mysql & Setup root password $ sudo ./bin/mysqladmin -u root password '' # Or $ sudo ./bin/mysql_secure_installation Log of mysql_secure_installatioin Set Environment $ sudo bash -c 'cat >> /etc/bash.bashrc' export PATH=/usr/local/mysql/bin:$PATH > EOF Check the mysql port $ sudo netstat -tunlp | grep 3306 tcp6 0 0 :::3306 :::* LISTEN 21712/mysqld Check variables $ mysqladmin variables -p Enter password: Make mysql as boot start $ sudo chkconfig --add mysqld $ sudo chkconfig --level 345 mysqld on Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:08 "},"programming/archive/mysql/installation/secureInstation.html":{"url":"programming/archive/mysql/installation/secureInstation.html","title":"secureInstation","keywords":"","body":" Table of Contents generated with DocToc Log for ./bin/mysql_secure_installation Log for ./bin/mysql_secure_installation $ sudo ./bin/mysql_secure_installation NOTE: RUNNING ALL THE STEPS FOLLOWING THIS IS RECOMMENDED FOR ALL MySQL SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY! In order to log into MySQL to secure it, we'll need the current password for the root user. If you've just installed MySQL, and you haven't set the root password yet, the password will be blank, so you should just press enter here. Enter password: OK, successfully used password, moving on... validate_password plugin is installed on the server. The subsequent steps will run with the existing configuration of the plugin. Setting the root password ensures that nobody can log into the MySQL root user without the proper authorisation. You already have a root password set. Strength of the password: 25 Change the root password? (Press y|Y for Yes, any other key for No) : n ... skipping. By default, a MySQL installation has an anonymous user, allowing anyone to log into MySQL without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment. Remove anonymous users? (Press y|Y for Yes, any other key for No) : y Success.. Moving on.. Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network. Disallow root login remotely? (Press y|Y for Yes, any other key for No) : n ... skipping. By default, MySQL comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment. Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y - Dropping test database... ... Success! - Removing privileges on test database... ... Success! Reloading the privilege tables will ensure that all changes made so far will take effect immediately. Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y ... Success! All done! If you've completed all of the above steps, your MySQL installation should now be secure. Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:08 "},"programming/archive/ruby/rubyInstallationBySourceCode.html":{"url":"programming/archive/ruby/rubyInstallationBySourceCode.html","title":"ruby","keywords":"","body":" Table of Contents generated with DocToc Yaml Ruby Thanks Yaml Download Yaml Lib Installation Download by wget ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby) -> └─ $ wget http://pyyaml.org/download/libyaml/yaml-0.1.6.tar.gz ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby) -> └─ $ tar xf yaml-0.1.6.tar.gz && cd yaml-0.1.6 Compile and installation ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/yaml-0.1.6) -> └─ $ ./configure --prefix=/usr/local ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby) -> └─ $ make && sudo make install Ruby Download official webiste Current Stable Ruby 2.1.2 Previous Stable Ruby 2.0.0-p481 Old Stable Ruby 1.9.3-p547 Ruby Installation Download by wget ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby) -> └─ $ wget http://cache.ruby-lang.org/pub/ruby/2.1/ruby-2.1.2.tar.gz ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby) -> └─ $ tar xf ruby-2.1.2.tar.gz && cd ruby-2.1.2 Compile and install ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2) -> └─ $ ./configure --prefix=/usr/local/ruby --enable-shared --with-opt-dir=/usr/local/lib ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2) -> └─ $ make && sudo make install Libs installation OpenSSL ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2) -> └─ $ cd ext/openssl ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ ruby extconf.rb ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ make && sudo make install Thanks collectiveidea.com Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:08 "},"programming/archive/ruby/rubyInstallationQ&A.html":{"url":"programming/archive/ruby/rubyInstallationQ&A.html","title":"rubyInstallationQ&A","keywords":"","body":" Table of Contents generated with DocToc openssl.h thread_native.h sqlite3.h libyaml-0.so.2 & psych.so openssl.h Error Description ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ ruby extconf.rb ... checking for openssl/ssl.h... no ... Solution Install openssl lib ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ sudo apt-get intall libssl-dev ┌─ (marslo@MarsloJiao ~) -> └─ $ dpkg -l | grep openssl ii libcurl3:amd64 7.35.0-1ubuntu2 amd64 easy-to-use client-side URL transfer library (OpenSSL flavour) ii libcurl4-openssl-dev:amd64 7.35.0-1ubuntu2 amd64 development files and documentation for libcurl (OpenSSL flavour) ii libgnutls-openssl27:amd64 2.12.23-12ubuntu2.1 amd64 GNU TLS library - OpenSSL wrapper ii openssl 1.0.1f-1ubuntu2.4 amd64 Secure Sockets Layer toolkit - cryptographic utility ii python-openssl 0.13-2ubuntu6 amd64 Python 2 wrapper around the OpenSSL library thread_native.h Error Description ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ make make: *** No rule to make target `/thread_native.h`, needed by `ossl.o`. Stop. Solution Add top_srcdir=../.. into Makefile (the 63th line as below) ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ grep top_srcdir Makefile -n 63: top_srcdir=../.. 279: ossl.o: $(top_srcdir)/thread_native.h $(top_srcdir)/thread_$(THREAD_MODEL).h sqlite3.h Error Description ┌─ (marslo@MarsloJiao ~) -> └─ $ gem install vmail ... Fetching: sqlite3-1.3.9.gem Building native extensions. This could take a while... ERROR: Error installing vmail: ERROR: Failed to build gem native extension. /usr/local/ruby/bin/ruby extconf.rb checking for sqlite3.h... no sqlite3.h is missing. Try 'port install sqlite3 +universal', 'yum install sqlite-devel' or 'apt-get install libsqlite3-dev' and check your shared library search path (the location where you sqlite3 shared library is located). *** extconf.rb failed *** ... Solution Install libsqlite3-dev in Ubuntu as the error logged ┌─ (marslo@MarsloJiao ~) -> └─ $ sudo apt-get install libsqlite3-dev libyaml-0.so.2 & psych.so Error Description ┌─ (marslo@MarsloJiao ~) -> └─ $ gem install compass /usr/local/ruby/lib/ruby/2.1.0/yaml.rb:4:in `': It seems your ruby installation is missing psych (for YAML output). To eliminate this warning, please install libyaml and reinstall your ruby. /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require': libyaml-0.so.2: cannot open shared object file: No such file or directory - /usr/local/ruby/lib/ruby/2.1.0/x86_64-linux/psych.so (LoadError) from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/psych.rb:1:in `' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/yaml.rb:5:in `' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/rubygems.rb:616:in `load_yaml' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/config_file.rb:328:in `load_file' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/config_file.rb:197:in `initialize' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/gem_runner.rb:74:in `new' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/gem_runner.rb:74:in `do_configuration' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/gem_runner.rb:39:in `run' from /usr/local/ruby/bin/gem:21:in `' Solution ┌─ (marslo@MarsloJiao ~) -> └─ # sudo apt-get install libyaml-dev Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:08 "},"tools/node/gitbook.html":{"url":"tools/node/gitbook.html","title":"tools","keywords":"gitbook","body":" Table of Contents generated with DocToc gitbook-cli installation initial book.json gitbook format hints tab emoji Q&A if (cb) cb.apply(this, arguments) unexpected token: . reference gitbook-cli installation install $ brew install node $ npm i -g gitbook-cli [--save-dev] verify $ gitbook --version CLI version: 2.3.2 GitBook version: 3.2.3 check packages $ npm root -g /usr/local/lib/node_modules initial book.json gitbook install $ gitbook install info: installing 29 plugins using npm@3.9.2 info: info: installing plugin \"search-plus\" info: install plugin \"search-plus\" (^0.0.11) from NPM with version 0.0.11 /Users/marslo/mywork/tools/git/marslo/mbook └─┬ gitbook-plugin-search-plus@0.0.11 └── html-entities@1.2.0 .... gitbook install in fresh environment\" $ gitbook install --log=debug --debug Installing GitBook 3.2.3 SOLINK_MODULE(target) Release/.node CXX(target) Release/obj.target/fse/fsevents.o SOLINK_MODULE(target) Release/fse.node SOLINK_MODULE(target) Release/.node CXX(target) Release/obj.target/fse/fsevents.o SOLINK_MODULE(target) Release/fse.node gitbook@3.2.3 ../../var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/tmp-10600Rn1q3aFhRWiI/node_modules/gitbook ├── escape-html@1.0.3 ├── escape-string-regexp@1.0.5 ├── destroy@1.0.4 ├── ignore@3.1.2 ├── bash-color@0.0.4 ├── gitbook-plugin-livereload@0.0.1 ├── cp@0.2.0 ... alternatively $ gitbook serve Live reload server started on port: 35729 Press CTRL+C to quit ... info: 7 plugins are installed info: 31 explicitly listed Error: Couldn't locate plugins \"search-plus, simple-page-toc, github, github-buttons, prism, prism-themes, advanced-emoji, anchors, include-codeblock, ace, emphasize, katex, splitter, mermaid-gb3, tbfed-pagefooter, sectionx, local-video, anchor-navigation-ex, favicon, todo, alerts, include-csv, puml, sharing-plus, image-captions, donate, toggle-chapters, navigator, downloadpdf\", Run 'gitbook install' to install plugins from registry. gitbook format hints Simran-B/gitbook-plugin-callouts styles code info tip danger warning success success {% hint style='success' %} success {% endhint %} tip {% hint style='tip' %} info {% endhint %} danger {% hint style='danger' %} danger {% endhint %} warning {% hint style='warning' %} warning {% endhint %} quote Important info: this note needs to be highlighted {% hint 'info' %} **Important info**: this *note* needs to be highlighted {% endhint %} tab [!TIP] this function only for native gitbook.io example: here reference: -Templating code {% tabs %} {% tab title=\"bash\" %} {% code title=\"filename: bash.sh\" %} # bash {% endcode %} {% endtab %} {% tab title=\"python\" %} python {% endtab %} {% endtabs %} emoji reference: gist Emoji broken & new emojis Emojis list from https://api.github.com/emojis emoji-cheat-sheet.com emoji code :joy: :u7981: :u7121: :white_check_mark: :four_leaf_clover: Q&A if (cb) cb.apply(this, arguments) reference: How I fixed a \"cb.apply is not a function\" error while using Gitbook issue $ gitbook serve Live reload server started on port: 35729 Press CTRL+C to quit ... /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287 if (cb) cb.apply(this, arguments) ^ TypeError: cb.apply is not a function at /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287:18 solution: raw polyfills.js 62 fs.stat = statFix(fs.stat) 63 fs.fstat = statFix(fs.fstat) 64 fs.lstat = statFix(fs.lstat) fix polyfills.js 62 // fs.stat = statFix(fs.stat) 63 // fs.fstat = statFix(fs.fstat) 64 // fs.lstat = statFix(fs.lstat) unexpected token: . issue $ git serve ... unexpected token: . solution raw code '''bash $ k -n kube-system get pods \\ -o go-template \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' \\ | head ''' fixed code {% raw %} '''bash $ k -n kube-system get pods \\ -o go-template \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' \\ | head ''' {% endraw %} reference gitbook 简明教程 gitbook 入门教程 book.json emoji gitbook howto gitbook 安装配置 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:03 "},"tools/node/node.html":{"url":"tools/node/node.html","title":"node & npm","keywords":"","body":" Table of Contents generated with DocToc npm configuration registry npm usage upgrade npm packages view details QnA empty of npm ls -g npm configuration registry $ npm config -g set registry https://registry.npm.taobao.org $ npm config -g get registry https://registry.npm.taobao.org/ npm usage upgrade $ npm install -g npm-check-updates $ ncu -u or $ npm outdated -g --depth=0 Package Current Wanted Latest Location react-sticky 5.0.8 5.0.8 6.0.3 global $ npm update -g react-sticky npm packages view details $ npm view example $ npm view gitbook-cli gitbook-cli@2.3.2 | Apache-2.0 | deps: 11 | versions: 21 CLI to generate books and documentation using gitbook https://www.gitbook.com bin: gitbook dist .tarball: https://registry.npm.taobao.org/gitbook-cli/download/gitbook-cli-2.3.2.tgz .shasum: 5e893582e1f743f6fa920c3c3eb36b62ea4a31a0 dependencies: bash-color: 0.0.4 fs-extra: 3.0.1 npm: 5.1.0 optimist: 0.6.1 semver: 5.3.0 user-home: 2.0.0 commander: 2.11.0 lodash: 4.17.4 npmi: 1.0.1 q: 1.5.0 tmp: 0.0.31 maintainers: - aymeric-gb - gitbook-bot - jpreynat - samypesse dist-tags: latest: 2.3.2 published over a year ago by aarono QnA empty of npm ls -g $ npm ls -g /usr/local/Cellar/node/15.0.1/lib └── (empty) solution $ brew rm node Uninstalling /usr/local/Cellar/node/15.0.1... (3,331 files, 61MB) $ brew install node Updating Homebrew... ==> Auto-updated Homebrew! Updated 2 taps (homebrew/core and homebrew/cask). ==> Updated Formulae Updated 3 formulae. ==> Updated Casks ithoughtsx ==> Downloading https://homebrew.bintray.com/bottles/node-15.0.1.catalina.bottle.tar.gz ==> Downloading from https://d29vzk4ow07wi7.cloudfront.net/9cdf039763f006eef0cc0aaebb13bc8173f017d961ac41c30f26d45a23ecffe0?response-content-dispositio ######################################################################## 100.0% ==> Pouring node-15.0.1.catalina.bottle.tar.gz ==> Caveats Bash completion has been installed to: /usr/local/etc/bash_completion.d ==> Summary ☕️ 🐸 /usr/local/Cellar/node/15.0.1: 3,331 files, 61MB verify $ npm ls -g /usr/local/lib ├── -@0.0.1 ├── commitizen@4.2.1 ├── ... └── verify-junit-xml@0.0.3 how to reproduce $ npm --version 7.0.3 $ npm root -g /usr/local/lib/node_module $ npm i -g npm@latest removed 51 packages, and changed 197 packages in 4s 2 packages are looking for funding run `npm fund` for details $ npm -v 6.14.8 $ npm root -g /usr/local/Cellar/node/15.0.1/lib/node_modules $ npm i -g npm@7.0.3 /usr/local/Cellar/node/15.0.1/bin/npm -> /usr/local/Cellar/node/15.0.1/lib/node_modules/npm/bin/npm-cli.js /usr/local/Cellar/node/15.0.1/bin/npx -> /usr/local/Cellar/node/15.0.1/lib/node_modules/npm/bin/npx-cli.js + npm@7.0.3 updated 248 packages in 6.481s $ npm -v 6.14.8 $ npm root -g /usr/local/Cellar/node/15.0.1/lib/node_modules deep investigation $ npm config -g ls -l | grep prefix ; prefix = \"/usr/local/Cellar/node/15.0.1\" ; overridden by builtin save-prefix = \"^\" tag-version-prefix = \"v\" prefix = \"/usr/local\" $ npm i -g npm@7.0.5 changed 1 package in 6s 10 packages are looking for funding run `npm fund` for details $ npm config -g ls -l | grep prefix prefix = \"/usr/local/Cellar/node/15.0.1\" save-prefix = \"^\" tag-version-prefix = \"v\" $ npm -v 7.0.5 $ npm ls -g /usr/local/Cellar/node/15.0.1/lib └── (empty) $ npm config -g set prefix '/usr/local' $ npm ls -g /usr/local/lib ├── -@0.0.1 ├── commitizen@4.2.1 ├── diff-so-fancy@1.3.0 ├── ... Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:03 "},"tools/node/hexo.html":{"url":"tools/node/hexo.html","title":"hexo","keywords":"","body":" Table of Contents generated with DocToc prepare init add theme clone code install plugin generate new pages diable the default highlight settings prepare $ npm i -g hexo-cli init $ mkdir myblog && cd myblog $ hexo init $ hexo init INFO Cloning hexo-starter https://github.com/hexojs/hexo-starter.git INFO Install dependencies added 183 packages from 421 contributors and audited 189 packages in 22.277s 12 packages are looking for funding run `npm fund` for details found 0 vulnerabilities INFO Start blogging with Hexo! add theme credit belongs to snark clone code In a Git repoIn a folderUpdate theme$ git submodule add https://github.com/imarslo/hexo-theme-snark.git themes/snark$ git clone https://github.com/imarslo/hexo-theme-snark.git themes/snark $ sed '/highlight:/{n;s/^.*$/\\ \\ enable: false/}' -i _config.xml $ sed '/highlight:/{n;n;s/^.*$/\\ \\ line_number: false/}' -i _config.xml$ git submodule sync --recursive $ git submodule update --init --recursive install plugin $ npm install hexo-renderer-pug --save $ npm install hexo-renderer-sass --save $ npm install hexo-generator-feed --save $ npm install hexo-generator-search --save $ npm install hexo-generator-sitemap --save generate new pages $ hexo new page archives $ hexo new page categories $ hexo new page tags $ hexo new page about diable the default highlight settings default settings in _config.xml cmd with sedorresult$ sed '/highlight:/{n;s/^.*$/\\ \\ enable: false/;n;s/^.*$/\\ \\ line_number: false/;}' -i _config.xml$ sed '/highlight:/{n;s/^.*$/\\ \\ enable: false/}' -i _config.xml $ sed '/highlight:/{n;n;s/^.*$/\\ \\ line_number: false/}' -i _config.xml$ grep highlight: _config.yml -A 6 highlight: enable: false line_number: false auto_detect: false tab_replace: '' wrap: true hljs: false Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:03 "},"tools/node/github.page.html":{"url":"tools/node/github.page.html","title":"github.page","keywords":"","body":" Table of Contents generated with DocToc theme jekyll gh-pages theme reference: github.com » github.page theme jekyll-themes.com jekyllthemes.io jekyllthemes.org jamstackthemes.dev Solar DevJoural jekyll jellky usage install $ gem install github-pages Fetching em-websocket-0.5.1.gem Fetching colorator-1.1.0.gem Fetching eventmachine-1.2.7.gem ... start local service $ jekyll serve Configuration file: /Users/marslo/mywork/tools/git/marslo/marslo.github.io/_config.yml Source: /Users/marslo/mywork/tools/git/marslo/marslo.github.io Destination: /Users/marslo/mywork/tools/git/marslo/marslo.github.io/_site Incremental build: disabled. Enable with --incremental Generating... done in 0.593 seconds. Auto-regeneration: enabled for '/Users/marslo/mywork/tools/git/marslo/marslo.github.io' Server address: http://127.0.0.1:4000/ Server running... press ctrl-c to stop. gh-pages reference How to build and deploy a React app to Github pages in less than 5 minutes Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:03 "},"tools/iterm2.html":{"url":"tools/iterm2.html","title":"iterm2","keywords":"","body":" Table of Contents generated with DocToc tab setup a colorful tab add favor color to a file (~/.marslo/.colors) hidden settings tab setup a colorful tab pick colors using tabset --list > $ while read i; do > c=$(echo $i | awk -F':' '{print $1}'); > echo === $c === ; > tabset --add m-$c $c; > done add favor color to a file (~/.marslo/.colors) $ echo \"\" >> ~/.marslo/.colors get color hex (for it2setcolor) download original csscolor.js if necessory: $ curl -fsSL -O https://raw.githubusercontent.com/jonathaneunice/iterm2-tab-set/master/csscolors.js $ while read -r i; do > rgb=$(grep -E \"\\s$i:\" csscolors.js | sed -re \"s:.*\\[(.*)\\],?$:\\1:\";) > hexc=$(for c in $(echo ${rgb} | sed -re 's:,::g'); do printf '%x' $c; done) > echo -e \"\"\"$i :\\t$rgb :\\t$hexc\"\"\" > echo \"$hexc\" >> ~/.marslo/.it2color > done result: $ ./rgb2hex.sh yellowgreen : 154, 205, 50 : 9acd32 wheat : 245, 222, 179 : f5deb3 tomato : 255, 99, 71 : ff6347 steelblue : 70, 130, 180 : 4682b4 tan : 210, 180, 140 : d2b48c sandybrown : 244, 164, 96 : f4a460 plum : 221, 160, 221 : dda0dd palegoldenrod : 238, 232, 170 : eee8aa palegreen : 152, 251, 152 : 98fb98 navajowhite : 255, 222, 173 : ffdead olive : 128, 128, 0 : 80800 moccasin : 255, 228, 181 : ffe4b5 chartreuse : 127, 255, 0 : 7fff0 palegreen : 152, 251, 152 : 98fb98 mediumorchid : 186, 85, 211 : ba55d3 royalblue : 65, 105, 225 : 4169e1 olivedrab : 107, 142, 35 : 6b8e23 khaki : 240, 230, 140 : f0e68c show color in iterm2 $ cat ~/.profile # iTerm2 tab titles function itit { if [ \"$1\" ]; then unset PROMPT_COMMAND echo -ne \"\\\\033]0;${1}\\\\007\" if [ 2 -eq $# ]; then case $2 in [cC] ) it2setcolor tab $(shuf -n 1 ~/.marslo/.it2colors) || echo ;; [bB] ) printf \"\\e]1337;SetBadgeFormat=%s\\a\" $(echo -n \"${1} \\(user.gitBranch)\" | base64) ;; [bB][cC] | [cC][bB] ) printf \"\\e]1337;SetBadgeFormat=%s\\a\" $(echo -n \"${1}\" | base64) it2setcolor tab $(shuf -n 1 ~/.marslo/.it2colors) || echo ;; esac fi else export PROMPT_COMMAND='echo -ne \"\\033]0;${PWD/#$HOME/\\~}\\007\";' printf \"\\e]1337;SetBadgeFormat=%s\\a\" $(echo -n \"\" | base64) it2setcolor tab default fi } EOF usage:$ itit 'title-string-here' [c][b] result: c\"> hidden settings To change the number of entries in the autocomplete menu: $ defaults write com.googlecode.iterm2 AutocompleteMaxOptions -int 10 To change the number of coprocess commands remembered: $ defaults write com.googlecode.iterm2 \"Coprocess MRU\" -int 10 To preserve whitespace in selections copied to the pasteboard: $ defaults write com.googlecode.iterm2 TrimWhitespaceOnCopy -bool false When you open a file from the finder in iTerm2 (e.g., by double-clicking a shell script), it will either open in a window or a tab. By default, it opens in a tab. You can change this with: $ defaults write com.googlecode.iterm2 OpenFileInNewWindows -bool true quite iTerm2 when the last session is closed $ defaults write com.googlecode.iterm2 MinRunningTime -float 10.0 increase the delay before it attempts to reconfigure itself after a change of monitors $ defaults write com.googlecode.iterm2 UpdateScreenParamsDelay -float 1.0 To change the number of paste history entries saved: defaults write com.googlecode.iterm2 MaxPasteHistoryEntries -int 20 Pastes (both regular and slow) are done by splitting the text to paste into chunks. There is a delay between the transmission of each chunk. To change the speed that \"paste\" pastes at: $ defaults write com.googlecode.iterm2 QuickPasteBytesPerCall -int 1024 $ defaults write com.googlecode.iterm2 QuickPasteDelayBetweenCalls -float 0.01 To change the speed that \"paste slowly\" pastes at: $ defaults write com.googlecode.iterm2 SlowPasteBytesPerCall -int 16 $ defaults write com.googlecode.iterm2 SlowPasteDelayBetweenCalls -float 0.125 To disable using the pinch gesture to change font size: $ defaults write com.googlecode.iterm2 PinchToChangeFontSizeDisabled -bool true To keep LC_CTYPE from being set when locale environment variables are set: $ defaults write com.googlecode.iterm2 DoNotSetCtype -bool true To allow Growl notifications to be posted for the current tab: $ defaults write com.googlecode.iterm2 GrowlOnForegroundTabs -bool true To tune smart cursor color settings: $ defaults write com.googlecode.iterm2.plist SmartCursorColorBgThreshold -float 0.5 $ defaults write com.googlecode.iterm2.plist SmartCursorColorFgThreshold -float 0.75 To allow a three-finger tap to act like a three-finger click: $ defaults write com.googlecode.iterm2.plist ThreeFingerTapEmulatesThreeFingerClick \\ -bool true To change the set of characters that are considered part of a URL (besides alphanumerics): $ defaults write com.googlecode.iterm2.plist URLCharacterSet -string \\ \".?\\\\/:;%=&_-,+~#@!*'()|[]\" To use some experimental optimizations that will improve performance (safety not guaranteed): $ defaults write com.googlecode.iterm2.plist ExperimentalOptimizationsEnabled \\ -bool true To tweak tab sizes: $ defaults write com.googlecode.iterm2 UseUnevenTabs -bool false $ defaults write com.googlecode.iterm2 MinTabWidth -int 75 $ defaults write com.googlecode.iterm2 MinCompactTabWidth -int 60 $ defaults write com.googlecode.iterm2 OptimumTabWidth -int 175 To change your search engine: $ defaults write com.googlecode.iterm2 SearchCommand \\ -string \"http://google.com/search?q=%@\" To adjust the speed of the animation of the hotkey window's appearance and disappearance: $ defaults write com.googlecode.iterm2 HotkeyTermAnimationDuration \\ -float 0.25 To adjust the amount of dimming of split panes. Set the value to a floating-point number between 0 (no dimming) and 1 (complete dimming). The default is 0.15: $ defaults write com.googlecode.iterm2 SplitPaneDimmingAmount \\ -float 0.25 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:02 "},"tools/atlassian.html":{"url":"tools/atlassian.html","title":"Jira & Confluence","keywords":"","body":" Table of Contents generated with DocToc jira check fields check attachment confluence get info publish to confluence reference: Confluence REST API examples Jira REST API examples JIRA Server platform REST API reference jira $ jiraName='my.jira.com' $ jiraID='STORY-1' check fields $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID} \\ | jq --raw-output check attachment check attachment ID $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID}?fields=attachment \\ | jq --raw-output .fields.attachment[].id get attachments download url $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID}?fields=attachment \\ | jq --raw-output .fields.attachment[].content download all attachments in Jira -I replace-str Replace occurrences of replace-str in the initial-arguments with names read from standard in- put. Also, unquoted blanks do not terminate input items; instead the separator is the new- line character. Implies -x and -L 1. $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID}?fields=attachment \\ | jq --raw-output .fields.attachment[].content \\ | xargs -I '{}' curl -sgOJL '{}' confluence $ confluenceName='my.confluence.com' $ pageID='143765713' get page id: get info $ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq --raw-output get space$ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .space.key get title$ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .title get page history $ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .version.number get next versioncurrentVer=$(curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .version.number) newVer=$((currentVer+1)) publish to confluence sample script $ url=\"https://${confluenceName}/rest/api/content/${pageID}\" $ page=$(curl -s ${url}) $ space=$(echo \"${page}\" | jq .space.key) $ title=$(echo \"${page}\" | jq .title) $ currentVer=$(echo \"${page}\" | jq .version.number) $ newVer=$((currentVer+1)) $ cat > a.json Hi confluence\", \"representation\": \"storage\" } }, \"version\": {\"number\":${newVer}} } EOF $ curl -s \\ -i \\ -X PUT \\ -H 'Content-Type: application/json' \\ --data \"$(cat a.json)\" \\ https://${confluenceName}/rest/api/content/${pageID} result Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:02 "},"tools/skype.html":{"url":"tools/skype.html","title":"skype","keywords":"","body":" Table of Contents generated with DocToc Install skype in Ubuntu 64bit Install skype in Ubuntu 64bit Inspired from AskUbuntu Add i386 architecture $ sudo dpkg --add-architecture i386 $ sudo apt-get update Add Repo and install by apt-get $ sudo add-apt-repository \"deb http://archive.canonical.com/ $(lsb_release -sc) partner\" $ sudo apt-get update && sudo apt-get install skype OR Add by dpkg $ wget http://www.skype.com/go/getskype-linux-ubuntu-64/skype-ubuntu-quantal_4.1.0.20-1_amd64.deb $ sudo dpkg -i skype-ubuntu*.deb Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:03 "},"tools/teamviewer.html":{"url":"tools/teamviewer.html","title":"teamviewer","keywords":"","body":" Table of Contents generated with DocToc teamviewer installation. Inspired from Official Help teamviewer installation. Inspired from Official Help Add i386 architecture ┌─ (marslo@MarsloJiao ~) -> └─ $ sudo dpkg --add-architecture i386 ┌─ (marslo@MarsloJiao ~) -> └─ $ sudo apt-get update Download teamview deb ┌─ (marslo@MarsloJiao ~) -> └─ $ wget http://downloadeu2.teamviewer.com/download/teamviewer_linux.deb Install the dependency by apt-get ┌─ (marslo@MarsloJiao ~) -> └─ $ sudo apt-get install -f Install teamviewer by dpkg ┌─ (marslo@MarsloJiao ~) -> └─ $ sudo dpkg -i teamviewer_linux.deb Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:03 "},"tools/app.html":{"url":"tools/app.html","title":"app","keywords":"","body":" Table of Contents generated with DocToc recommend apps screenshot keystore gif development system recommend apps screenshot jietu snagit snipaste ⇠ for windows keystore Visualize cn us keyCastr captin Carnac ⇠ for windows gif GIF Brewery 3 by Gfycat cn us LICEcap development macvim RegExRX cn us iTerm2 dash doctoc gnomon system psSafe iStat Menus Moon Alfed Chrome Canary Chromium Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2020-12-14 20:25:02 "}}