{"./":{"url":"./","title":"Introduction","keywords":"","body":" Table of Contents generated with DocToc life is hard, make it easier Introduction The other docs build mocp from Source Code goagent configuration windows build vim/gvim from source code colorful windows command line life is hard, make it easier Introduction [!NOTE] This is a book powered by imarslo. The other docs build mocp from Source Code Precondiction Error and Solucton Error: BerkeleyDB (libdb) not found decoder.c:22:18: fatal error: ltdl.h FATAL_ERROR: No valid sound driver! goagent configuration Offical Website Latest Version Install Configuration Run GoAgent Older Version How to install 如何安装 Q&A windows build vim/gvim from source code Compile vim/gvim by source code Precondiction Compile and Install Make compiled vim as default text editor Q&A colorful windows command line Colorful Prompt Needed Tools and files Steps Specified Font Specified Cursor Size Set aliases in cmd Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:24 "},"artifactory/artifactory.html":{"url":"artifactory/artifactory.html","title":"artifactory","keywords":"","body":" Table of Contents generated with DocToc reference integration with pipeline aql Artifactory SSL Certification configuration reference: How to enable verbose log on JVM Garbage Collection JAVA_OPTIONS: -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xloggc:/path/to/file/gc.log reference integration with pipeline Scripted Pipeline Syntax Jenkins Pipeline Examples aql Jenkins Artifactory Plugin AQL download latest artifact matching pattern $pair = \"$($art_user):$($art_pass)\" Write-Verbose \"Attempting to convert Artifactory credentials to a base64 string for automation\" $encodedCreds = [System.Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes($pair)) $basicAuthValue = \"Basic $encodedCreds\" $headers = @{ Authorization = $basicAuthValue } Write-Host \"Attempting to perform a AQL search.\" $aql_search = $art_base_url + \"/api/search/aql\" Write-Host \"Building aql query with the following parameters, groupID: $group_id, artifactID: $artifact_id, version: $version, classifier: $classifier and repos: $art_generic_repokey.\" $aql_query = 'items.find({\"repo\":\"' + $art_generic_repokey + '\",\"$or\":[{\"$and\":[{\"path\":{\"$match\":\"' + $group_id + '/' + $artifact_id + '/' + $version + '\"},\"name\":{\"$match\":\"' + $artifact_id + '*' + $classifier + '*.' + $extension + '\"}}]}]}).sort({\"$desc\":[\"modified\"]}).limit(1)' Write-Host \"Built the following aql query: '$aql_query' .\" $aql_content = Invoke-RestMethod -Uri $aql_search -Headers $headers -Method Post -Body $aql_query -ContentType 'text/plain' Write-Host \"Attempting to submit the aql query to the following artifactory server: $art_base_url.\" $aql_results = ($aql_content).results Write-Host \"Attempting to parse query results and build the artifact download uri.\" $aql_repo,$aql_path,$aql_name = ($aql_results).repo,($aql_results).path,($aql_results).name $artifactDownloadUri = $art_base_url + '/' + $aql_repo + '/' + $aql_path + '/' + $aql_name Write-Host \"Found the following uri: $artifactDownloadUri !!\" if ($artifactMimeType -eq 'application/zip' -or $extension -eq 'zip') { Write-Verbose \"Attempting to save the artifact to $download_dir/$art_dist_name.zip\" Invoke-RestMethod -Uri $artifactDownloadUri -Headers $headers -OutFile \"$download_dir/$art_dist_name.zip\" } Artifactory SSL Certification ARTIFACTORY: How to Resolve an “unable to find valid certification path to requested target” Error Using TLS Certificates as a Client Working with Certificates and SSL ibook : ssl/keystore get remote cert $ openssl s_client -showcerts -connect : #i.e. $ echo -n | openssl s_client -connect : -debug | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > .crt # or $ keytool -printcert \\ -rfc \\ -sslserver : > .crt # or # https://www.howtouselinux.com/post/openssl-command-to-generate-view-check-certificate $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 if issue (i:) is the same as subject (s:). Therefore, this is the root certificat. i.e. : $ openssl s_client -connect cdn.redhat.com:443 -showcerts import to truststore $ sudo keytool -importcert \\ -keystore /usr/local/java/jdk1.8.0_60/jre/lib/security/cacerts \\ -storepass changeit \\ -file .crt \\ -alias \"-crt\" configuration allow partial folder in particular repo Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:25 "},"artifactory/api.html":{"url":"artifactory/api.html","title":"api","keywords":"","body":" Table of Contents generated with DocToc variable repo check repo exists get all repos get all local repos get repo size Build Info List all timestamps in ${buildName} List specific build-info filter \"buildInfo.env.JOB_NAME\" in all builds cleanup delete all in my-repo 4 weeks ago trash can builds rotation via api/build/retention promote property search deploy deploy single artifacts deploy bundle artifact variable $ rtUrl='https://my.artifactory.com/artifactory' $ repoName='my-repo' $ buildName='my - repo' $ buildNumber=12345 $ curlOpt=\"-s -g --netrc-file ~/.marslo/.netrc\" repo check repo exists $ /usr/bin/curl ${curlOpt} \\ -X GET \"${rtUrl}/api/repositories\" | jq .[].key | grep \"${repo}\" get all repos api/repositories $ curl -sSg \\ -X GET \\ https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | .type + \" ~> \" + .key' LOCAL ~> local-repo REMOTE ~> remote-repo VIRTUAL ~> virtual-repo ... get all local repos $ curl -sSg \\ -X GET \\ https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | select(.type == \"LOCAL\") | .key' get all virtual repos $ curl -sSg \\ -X GET \\ https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | select(.type == \"VIRTUAL\") | .key' get all virtual repos, and repo name starts with ''$ curl -sSg \\ -X GET https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | select((.type == \"VIRTUAL\") and select(.key | startswith(\"\"))) | .key' get defaultDeployRepo for all virutal repos who named starts with ''$ for i in $(curl -sSg \\ -XGET https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | select((.type == \"VIRTUAL\") and select(.key | startswith(\"\"))) | .key' ); do echo \"${i} : \" curl -sSg \\ --netrc-file /home/marslo/.marslo/.netrc \\ -XGET https://my.artifactory.com/artifactory/api/repositories/${i} | jq .defaultDeploymentRepo echo ' ' done get all remote repos $ curl -sSg \\ -X GET \\ https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | select(.type == \"REMOTE\") | .key' get repo size api/storageinfo get storage summary including: binariesSummary fileStoreSummary repositoriesSummaryList bash Build Info List all timestamps in ${buildName} $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X GET ${rtUrl}/api/build/${buildsNumbers} \\ | jq .buildsNumbers[].started List specific build-info $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X GET ${rtUrl}/api/build/${buildNazme}/${buildNumber} get start timestampe$ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X GET ${rtUrl}/api/build/${buildNazme}/${buildNumber} \\ | jq .buildInfo.started \"2020-09-30T02:38:32.264-0700\" filter \"buildInfo.env.JOB_NAME\" in all builds $ BUILD_NAME='my - job' $ RT_URL='https://my.artifactory.com/artifactory' $ for i in $(curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}\" | jq -r '.[][]?.uri' ); do echo \"~~~> ${i}\" curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}${i}\" | jq --raw-output '.buildInfo.properties.\"buildInfo.env.JOB_NAME\"' echo '' done or #!/usr/bin/env bash BUILD_NAME='my - build' CURL_OPT=\"-sg --netrc-file $HOME/.marslo/.netrc\" RT_URL='https://my.artifactory.com/artifactory' for bid in $(curl ${CURL_OPT} -X GET \"${RT_URL}/api/build/${BUILD_NAME}\" | jq -r '.[][]?.uri'); do curl ${CURL_OPT} -X GET \"${RT_URL}/api/build/${BUILD_NAME}${bid}\" \\ | jq -r '.buildInfo.properties | select(.\"buildInfo.env.JOB_NAME\" | contains(\"marslo\"))' \\ | jq -r '[.\"buildInfo.env.JOB_NAME\" , .\"buildInfo.env.BUILD_URL\"]' done filter \"buildInfo.env.JOB_NAME\" by keyword $ BUILD_ID='/297' $ curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}${BUILD_ID}\" \\ | jq -r '.buildInfo.properties | select(.\"buildInfo.env.JOB_NAME\" | contains(\"marslo\"))' \\ | jq -r '.\"buildInfo.env.JOB_NAME\"' marslo/rc filter both \"buildInfo.env.BUILD_URL\" and \"buildInfo.env.JOB_NAME\" if JOB_NAME contains keyword $ curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}${BUILD_ID}\" \\ | jq -r '.buildInfo.properties | select(.\"buildInfo.env.JOB_NAME\" | contains(\"marslo\"))' \\ | jq -r '[.\"buildInfo.env.JOB_NAME\" , .\"buildInfo.env.BUILD_URL\"]' [ \"marslo/rc\", \"https://my.jenkins.com/job/marslo/job/rc/297/\" ] cleanup delete all in my-repo 4 weeks ago find.aql $ cat find.aql items.find({ \"repo\": \"my-repo\", \"type\" : \"folder\" , \"depth\" : \"1\", \"created\" : { \"$before\" : \"4w\" } }) delete artifacts and buildinfo rtURL='https://my.artifactory.com/artifactory' cibuild='my-jenkins-build' repo='my-repo' curlOpt= '-s -g --netrc-file ~/.marslo/.netrc' for _i in $(curl ${curlOpt} -X POST ${curlOpt} ${rtURL}/api/search/aql -T find.aql | jq --raw-output .results[].name); do curl ${curlOpt} -X DELETE \"${rtURL}/${repo}/${_i}\" curl ${curlOpt} -X DELETE \"${rtURL}/api/build/${cibuild}?buildNumbers=${_i}&artifacts=1\" curl ${curlOpt} -X DELETE \"${rtUrl}/api/trash/clean/${repo}/${_i}\" curl ${curlOpt} -X DELETE \"${rtUrl}/api/trash/clean/artifactory-build-info\" done trash can empty trash can $ curl -s \\ -g \\ --netrc-file ~/.marslo/.netrc' \\ -X POST \\ \"${rtUrl}/api/trash/empty\" list items in trash can $ curl -s \\ -g \\ --netrc-file ~/.marslo/.netrc' \\ -X GET \\ \"${rtURL}/api/storage/auto-trashcan\" | jq .children[].uri builds rotation via api/build/retention $ date -d 'now - 2 months' +%s%3N 1597232120161 $ date -d @$(echo '1597232120161' | rev | cut -c4- | rev) Wed Aug 12 19:35:20 CST 2020 $ cat rotation.json { \"deleteBuildArtifacts\" : true , \"count\" : 3 , \"minimumBuildDate\" : 1597232120161 , \"buildNumbersNotToBeDiscarded\" : [] } $ curl -s \\ -g \\ -X POST \\ -d @rotation.json \\ -H \"Content-Type: application/json\" \\ --netrc-file ~/.marslo/.netrc' \\ \"https://my.artifactory.com/artifactory/api/build/retention/build%20-%20name?async=false\" promote reference: How do I promote a build using the REST-API? build promotion $ cat promot.json { \"status\": \"released\", \"ciUser\": \"ci-user\", \"dryRun\" : false, \"targetRepo\" : \"my-repo-release\", \"copy\": true, \"artifacts\" : true, \"dependencies\" : true, \"scopes\" : [ \"compile\", \"runtime\" ], \"properties\": { \"release-name\": [\"marslo-test\"] } } $ curl -s \\ -g \\ -i \\ -k \\ -H \"Content-type:application/json\" \\ -d @promot.json \\ -X POST \\ '${rtURL}/api/build/promote/${buildName}/' property add property $ path='libs-release-local/pkg' $ properties=$('os=win,linux|qa=done' | sed 's:|:%7C:') $ curl -s \\ -g \\ -I \\ --netrc-file ~/.marslo/.netrc \\ -X PUT \\ '${rtURL}/storage/${repoName}-local/${path}?properties=${properties}&recursive=1' get result $ curl -sgI \\ --netrc-file ~/.marslo/.netrc \\ -X PUT \\ '${rtURL}/storage/${repoName}-local/${path}?properties=${properties}&recursive=1' \\ | sed -rn 's:^HTTP/2\\s?([0-9]+)\\s?:\\1:gp' 204 # or 400 # or 404 search via pattern search $ pattern='*/pkg/*/*.jar' $ curl -s \\ -g \\ -k \\ --netrc-file ~/.marslo/.netrc \\ -X GET \\ \"${rtURL}/search/pattern?pattern=${repoName}-local:${pattern}\" via aql search $ curl -s \\ -k \\ -X POST \\ -H 'Content-Type:text/plain' \\ 'https://artifactory.domain.com/artifactory/api/search/aql' \\ -d 'builds.find({ \"name\": \"my - build - dev\", \"created\": {\"$before\": \"3days\"} }).sort({\"$desc\": [\"created\"]}).limit(1) ' deploy deploy single artifacts $ curl -gsSL \\ --netrc-file ~/.marslo/.netrc \\ -XPUT \\ \"https://artifactory.domain.com/artifactory//\" \\ -T .txt deploy bundle artifact $ curl -g \\ -s \\ -SL \\ -H \"X-Explode-Archive-Atomic: true\" \\ -X PUT \\ \"https://artifactory.domain.com/artifactory///\" \\ -T .[zip\\|tar.gz\\|tgz] Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:25 "},"artifactory/cli.html":{"url":"artifactory/cli.html","title":"cli","keywords":"","body":" Table of Contents generated with DocToc CLI setup CLI for jFrog Artifactory configuration ping Discarding Old Builds from Artifactory search with aql CLI setup reference: JFrog CLI INSTALL JFROG CLI jfrog/jfrog-cli npm $ npm i -g jfrog-cli-go homebrew $ brew install jfrog-cli-go docker $ docker run docker.bintray.io/jfrog/jfrog-cli-go:latest jfrog CLI for jFrog Artifactory reference: CLI for JFrog Artifactory commands abbreviation config c ping p upload u download dl copy cp move mv delete del search s set-props sp delete-props delp curl cl build-collect-env bce build-publish bp build-promote bpr build-clean bc build-scan bs build-discard bdi repo-template rpt repo-create rc repo-update ru repo-delete rdel configuration setup in local $ jfrog rt c myrt --url=https://my.artifactory.com/artifactory --apikey=*********** JFrog Distribution URL (Optional): For commands which don't use external tools or the JFrog Distribution service, JFrog CLI supports replacing the configured username and password/API key with automatically created access token that's refreshed hourly. Enable this setting? (y/n) [y]? n Is the Artifactory reverse proxy configured to accept a client certificate? (y/n) [n]? n or$ jfrog rt c myrt --url=https://my.artifactory.com/artifactory --user=myaccount --password=mypassword JFrog Distribution URL (Optional): For commands which don't use external tools or the JFrog Distribution service, JFrog CLI supports replacing the configured username and password/API key with automatically created access token that's refreshed hourly. Enable this setting? (y/n) [y]? n Is the Artifactory reverse proxy configured to accept a client certificate? (y/n) [n]? n [Info] Encrypting password... setup in docker $ docker run -it \\ --rm \\ -v $(PWD):/root docker.bintray.io/jfrog/jfrog-cli-go \\ jfrog rt c prod --url=https://my.artifactory.com/artifactory --user=myaccount --password=mypassword show configuration $ jfrog rt c show Server ID: myrt Url: https://my.artifactory.com/artifactory/ API key: *************** Default: true ping check configuration or remote server$ jfrog rt p --server-id=myrt OK Discarding Old Builds from Artifactory clean build info and artifacts 30 days before $ jfrog rt use myrt $ jfrog rt bdi --max-days=30 --delete-artifacts=true \"my-job-build\" using cli via docker $ docker run \\ -it \\ --rm \\ -v $(PWD):/root docker.bintray.io/jfrog/jfrog-cli-go \\ jfrog rt bdi --max-days=45 --delete-artifacts 'ci - buildinfo - name' search with aql Jfrog artifactory delete folder of containing artifacts after remove them $ cat spec.json { \"files\": [{ \"aql\": { \"items.find\": { \"repo\": \"my-repo\", \"type\":\"folder\", \"depth\" : \"1\", \"created\": { \"$before\": \"15d\" } } } }] } $ jfrog rt s --spec spec.json delete with aql search$ jfrog rt del --spec spec.json Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:25 "},"artifactory/aql.html":{"url":"artifactory/aql.html","title":"aql","keywords":"","body":" Table of Contents generated with DocToc AQL Relative Time Operators find items (folder) some times ago by aql AQL Relative Time Operators aqlCleanup.groovy Advanced Cleanup Using Artifactory Query Language (AQL) AQL supports specifying time intervals for queries using relative time. In other words, the time interval for the query will always be relative to the time that the query is run, so you don't have to change or formulate the time period, in some other way, each time the query is run. For example, you may want to run a query over the last day, or for the time period up to two weeks ago. Relative time is specified using the following two operators: operators paraphrase $before The query is run over complete period up to specified time. $last The query is run over period from the specified time until the query is run Time periods are specified with a number and one of the following suffixes: time period suffixes milliseconds \"mills\", \"ms\" seconds \"seconds\", \"s\" minutes \"minutes\" days \"days\", \"d\" weeks \"weeks\", \"w\" months \"months\", \"mo\" years \"years\", \"y\" find items (folder) some times ago by aql e.g. find root folder && 4 weeks ago (by using -T, --upload-file) imarslo : write a file without indent space $ cat find.aql items.find ({ \"repo\": \"my-repo\", \"type\" : \"folder\" , \"depth\" : \"1\", \"created\" : { \"$before\" : \"4w\" } }) $ curl [-s] \\ -X POST \\ -uadmin:password https://my.artifactory.com/artifactory/api/search/aql \\ -T find.aql -T, --upload-file This transfers the specified local file to the remote URL. If there is no file part in the specified URL, curl will append the local file name. NOTE that you must use a trailing / on the last directory to really prove to Curl that there is no file name or curl will think that your last directory name is the remote file name to use. That will most likely cause the upload operation to fail. If this is used on an HTTP(S) server, the PUT command will be used. Use the file name \"-\" (a single dash) to use stdin instead of a given file. Alternately, the file name \".\" (a single period) may be specified instead of \"-\" to use stdin in non-blocking mode to allow reading server output while stdin is being uploaded. You can specify one -T, --upload-file for each URL on the command line. Each -T, --upload- file + URL pair specifies what to upload and to where. curl also supports \"globbing\" of the -T, --upload-file argument, meaning that you can upload multiple files to a single URL by using the same URL globbing style supported in the URL, like this: curl --upload-file \"{file1,file2}\" http://www.example.com or even curl -T \"img[1-1000].png\" ftp://ftp.example.com/upload/ search by using -d, --data $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X POST https://my.artifactory.com/artifactory/api/search/aql \\ -H \"Content-Type: text/plain\" \\ -d \"\"\"items.find ({ \\\"repo\\\": \\\"my-repo\\\", \\\"type\\\" : \\\"folder\\\" , \\\"depth\\\" : \\\"1\\\", \\\"created\\\" : { \\\"\\$before\\\" : \\\"4mo\\\" } }) \"\"\" $ cat ~/.marslo/.netrc machine my.artifactory.com login admin password password d, --data (HTTP) Sends the specified data in a POST request to the HTTP server, in the same way that a browser does when a user has filled in an HTML form and presses the submit button. This will cause curl to pass the data to the server using the content-type application/x-www-form- urlencoded. Compare to -F, --form. --data-raw is almost the same but does not have a special interpretation of the @ character. To post data purely binary, you should instead use the --data-binary option. To URL-encode the value of a form field you may use --data-urlencode. If any of these options is used more than once on the same command line, the data pieces specified will be merged together with a separating &-symbol. Thus, using '-d name=daniel -d skill=lousy' would generate a post chunk that looks like 'name=daniel&skill=lousy'. If you start the data with the letter @, the rest should be a file name to read the data from, or - if you want curl to read the data from stdin. Multiple files can also be speci- fied. Posting data from a file named from a file like that, carriage returns and newlines will be stripped out. If you don't want the @ character to have a special interpretation use --data-raw instead. See also --data-binary and --data-urlencode and --data-raw. This option overrides -F, --form and -I, --head and -T, --upload-file. or $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X POST https://my.artifactory.com/artifactory/api/search/aql \\ -H \"Content-Type: text/plain\" \\ -d \"\"\"items.find ({ \\ \\\"repo\\\": \\\"my-repo\\\", \\ \\\"type\\\" : \\\"folder\\\" , \\ \\\"depth\\\" : \\\"1\\\", \\ \\\"created\\\" : { \\\"\\$before\\\" : \\\"4mo\\\" } \\ }) \"\"\" \\ | jq --raw-output .results[].name? or (with sort and limit) Artifactory query language (AQL). How to write a not match query with $nmatch $ curl -X POST \\ -k \\ -H 'Content-Type:text/plain' \\ -i \\ 'https://my.artifactory.com/artifactory/api/search/aql' \\ -d 'items.find ({ \"repo\": \"proj-1-local\", \"type\" : \"folder\" , \"depth\" : \"1\", \"created\" : { \"$before\" : \"3days\" } }).sort({\"$desc\":[\"created\"]}).limit(1) ' or -d @ JFrog Artifactory REST API in 5min $ cat builds.json builds.find({ \"name\" : \"ci - build - name\", \"created\" : { \"$before\" : \"10d\" } }) $ curl -s \\ -g \\ -d @builds.json \\ -H \"Content-Type: text/plain\" \\ -X POST \"https://${rtURL}/api/search/aql\" Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:24 "},"cheatsheet/good.html":{"url":"cheatsheet/good.html","title":"cheatsheet","keywords":"","body":" Table of Contents generated with DocToc time & date show date with timezone show cal synchronize date and time with a server over ssh (Inspired from commandlinefu.com) download and extract check file without extract extract jar compress zip package with dot-file remove dot-file without skipping '..' '.' issue get cookie from firefox echo 256 colors directory diff commands PWD's secrets list the command beginning with searching for commands without knowing their exact names batch commands rename batch move batch copy bash bash alias ldapsearch search specific user search DN field of particular user (user2) filter all SAMAccountName, uid and uidNumber under base DN (OU=Person,DC=mydomain,DC=com) filter particular group installation alternatives others show some command periodically clear use less as tail -f authentication Special Characters in Usernames and Passwords time & date show date with timezone # with quotes $ TZ=':Asia/Shanghai' date # or without quotes $ TZ=America/Los_Angeles date show cal $ cal -y | tr '\\n' '|' | sed \"s/^/ /;s/$/ /;s/ $(date +%e) / $(date +%e | sed 's/./#/g') /$(date +%m | sed s/^0//)\" | tr '|' '\\n' 2014 January February March Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 1 1 5 6 7 8 9 10 11 2 3 4 5 6 7 8 2 3 4 5 6 7 8 12 13 14 15 16 17 18 9 10 11 12 13 14 15 9 10 11 12 13 14 15 19 20 21 22 23 24 25 16 17 18 19 20 21 22 16 17 ## 19 20 21 22 26 27 28 29 30 31 23 24 25 26 27 28 23 24 25 26 27 28 29 30 31 April May June Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 5 1 2 3 1 2 3 4 5 6 7 6 7 8 9 10 11 12 4 5 6 7 8 9 10 8 9 10 11 12 13 14 13 14 15 16 17 18 19 11 12 13 14 15 16 17 15 16 17 18 19 20 21 20 21 22 23 24 25 26 18 19 20 21 22 23 24 22 23 24 25 26 27 28 27 28 29 30 25 26 27 28 29 30 31 29 30 July August September Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 5 1 2 1 2 3 4 5 6 6 7 8 9 10 11 12 3 4 5 6 7 8 9 7 8 9 10 11 12 13 13 14 15 16 17 18 19 10 11 12 13 14 15 16 14 15 16 17 18 19 20 20 21 22 23 24 25 26 17 18 19 20 21 22 23 21 22 23 24 25 26 27 27 28 29 30 31 24 25 26 27 28 29 30 28 29 30 31 October November December Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 1 1 2 3 4 5 6 5 6 7 8 9 10 11 2 3 4 5 6 7 8 7 8 9 10 11 12 13 12 13 14 15 16 17 18 9 10 11 12 13 14 15 14 15 16 17 18 19 20 19 20 21 22 23 24 25 16 17 18 19 20 21 22 21 22 23 24 25 26 27 26 27 28 29 30 31 23 24 25 26 27 28 29 28 29 30 31 30 synchronize date and time with a server over ssh (Inspired from commandlinefu.com) $ date --set=\"$(ssh [username]@[sshserver] date)\" download and extract *.gz $ wget -O - http://example.com/a.gz | tar xz *.zip $ curl -fsSL https://services.gradle.org/distributions/gradle-4.7-all.zip | bsdtar xzf - -C with zip password$ curl -fsSL \\ -u: \\ https://path/to/file.zip \\ | bsdtar -xzf- --passphrase - -C *.tar.gz $ curl -fsSL https://path/to/file.tar.gz | tar xzf - -C example$ curl -fsSL \\ -j \\ -k \\ -L \\ -H \"Cookie: oraclelicense=accept-securebackup-cookie\" \\ http://download.oracle.com/otn-pub/java/jdk/8u181-b13/96a7b8442fe848ef90c96a2fad6ed6d1/jdk-8u181-linux-x64.tar.gz \\ | tar xzf - -C '/opt/java' check file without extract $ tar -Oxvf myfile.tgz path/to/my.sh | less extract jar $ unzip .jar -d Delete files from JAR without unzip$ zip -d .jar compress zip package with dot-file .[^.]* $ zip name.zip * .[^.]*' shopt -s dotglob $ shopt -s dotglob $ zip name.zip * . $ zip -r name.zip . remove dot-file without skipping '..' '.' issue shopt -s dotglob $ shopt -s dotglob $ rm [-rf] * using shopt -u dotglob to turn dotglob off .[^.]* $ rm [-rf] .[^.]* .[!.]* $ rm [-rf] .[!.]* .??* $ rm [-rf] .??* get cookie from firefox $ grep -oP '\"url\":\"\\K[^\"]+' $(ls -t ~/.mozilla/firefox/*/sessionstore.js | sed q) echo 256 colors $ for i in {0..255}; do echo -e \"\\e[38;05;${i}m${i}\"; done | column -c 80 -s ' '; echo -e \"\\e[m\" # or $ yes \"$(seq 1 255)\" | while read i; do printf \"\\x1b[48;5;${i}m\\n\"; sleep .01; done directory diff diff --suppress-common-lines -y commands PWD's secrets $ l | grep bc lrwxrwxrwx 1 marslo marslo 37 Mar 4 00:25 bc -> /home/marslo/Tools/Git/BrowserConfig// $ cd bc/ $ pwd -L /home/marslo/bc $ pwd -P /home/marslo/Tools/Git/BrowserConfig list the command beginning with $ compgen -c \"system-config-\" system-config-authentication system-config-authentication system-config-date system-config-firewall system-config-firewall-tui system-config-kdump system-config-keyboard system-config-keyboard system-config-network system-config-network system-config-network-cmd system-config-network-cmd system-config-network-tui system-config-printer system-config-printer-applet system-config-services system-config-services system-config-users searching for commands without knowing their exact names $ apropos editor | head Git::SVN::Editor (3pm) - commit driver for \"git svn set-tree\" and dcommit INIFILE (1) - OpenLink Virtuoso Opensource ini File Editor atobm (1) - bitmap editor and converter utilities for the X Window System bitmap (1) - bitmap editor and converter utilities for the X Window System bmtoa (1) - bitmap editor and converter utilities for the X Window System ed (1) - line-oriented text editor editor (1) - Nano's ANOther editor, an enhanced free Pico clone editres (1) - a dynamic resource editor for X Toolkit applications ex (1) - Vi IMproved, a programmers text editor gedit (1) - text editor for the GNOME Desktop batch commands rename $ l total 4.0K -rw-r--r-- 1 marslo marslo 10 Feb 21 00:43 a.b $ rename -v 's/\\./_/g' * a.b renamed as a_b $ l total 4.0K -rw-r--r-- 1 marslo marslo 10 Feb 21 00:43 a_b batch move -I replace-str $ mkdir backup-folder && ls | grep -Ze \".*rar\" | xargs -d '\\n' -I {} mv {} backup-folder batch copy reference: Hack 22. Xargs Command Examples $ ls -1 a/b/* 11 12 | xargs cp -t copy-target-folder/ bash bash alias $ echo ${BASH_ALIASES[ls]} ls --color=always bash - get bash login log $ bash -l -v run with only one startup file $ bash -i --rcfile=\"$HOME/.marslo/.imarslo\" ldapsearch reference: ldapsearch Examples The ldapsearch Tool Querying AD with ldapsearch-LLL # just a particular way to display the results -H ldap://wspace.mydomain.com # the URL where the LDAP server listens -x # use simple authentication, not SASL -D 'user1' # the account to use to authenticate to LDAP -w 'user1password' # the password that goes with the account on the previous line -E pr=1000/noprompt # ask the server for all pages, don't stop after one -b 'ou=mydomain,dc=wspace,dc=mydomain,dc=com' # the base of the search. We don't want results from e.g. 'ou=blah,dc=wspace,dc=mydomain,dc=com' '(&(objectClass=person)(uidNumber=*))' # Ask for any entry that has attributes objectClass=person and uidNumber has a value SAMAccountName uid uidNumber # Show only these attributes search specific user Info : ldap url : ldaps://ldap.mydomain.com:636 base search base : dc=mydomain,dc=com login user : user1 / user1password search : user2 $ ldapsearch \\ -LLL \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ CN='user2' or insert password via interactive mode ( -W )$ ldapsearch \\ -LLL \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'dc=mydomain,dc=com' \\ -W \\ -D 'user1' \\ CN='user2' search DN field of particular user (user2) $ ldapsearch \\ [-LLL \\] -H 'ldaps://ldap.mydomain.com:636' \\ -b 'dc=mydomain,dc=com' \\ -x \\ -D 'user1' \\ -w 'user1password' \\ CN='user2' \\ DN filter all SAMAccountName, uid and uidNumber under base DN (OU=Person,DC=mydomain,DC=com) $ ldapsearch \\ -LLL \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'ou=Workers,dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ -E 'pr=1000/noprompt' \\ '(&(objectClass=user)(sAMAccountName=*))' \\ SAMAccountName uid uidNumber DN filter particular group $ ldapsearch \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'OU=DL,OU=Groups,OU=GLOBAL,OU=Sites,dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ -E 'pr=1000/noprompt' \\ '(&(objectClass=group)(CN=*))' search particular group (cn=DL-mydomaindis-group)$ ldapsearch \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'OU=DL,OU=Groups,OU=GLOBAL,OU=Sites,dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ -E 'pr=1000/noprompt' \\ CN='DL-mydomaindis-group' installation alternatives install $ sudo update-alternatives --install /usr/bin/java java /opt/java/jdk1.8.0_121/bin/java 999 $ sudo update-alternatives --auto java $ sudo update-alternatives --install /usr/bin/javac javac /opt/java/jdk1.8.0_121/bin/javac 999 $ sudo update-alternatives --auto javac modify $ ls -altrh $(which -a nc) lrwxrwxrwx 1 root root 22 Jun 1 04:02 /usr/bin/nc -> /etc/alternatives/nmap $ sudo alternatives --config nmap There are 2 programs which provide 'nmap'. Selection Command ----------------------------------------------- *+ 1 /usr/bin/netcat 2 /usr/bin/ncat Enter to keep the current selection[+], or type selection number: 1 others show some command periodically $ watch --interval 1 ls -alt watch with pipe$ watch -n 1 'ls -Altrh | grep ' clear $ printf \"\\ec\" use less as tail -f $ less +F authentication Special Characters in Usernames and Passwords references: percent-encoding CHARACTERS PERCENT-ENCODED ] %5B [ %5D ? %3F / %2F %3C ~ %7E # %23 ``` %6D ! %21 @ %40 $ %24 % %25 ^ %5E & %26 * %2A ( %28 ) %29 + %2B = %3D } %7D ` %7C : %3A \" %22 ; %3B ' %27 , %2C > %3E { %7B space %20 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:36 "},"cheatsheet/bash.html":{"url":"cheatsheet/bash.html","title":"bash","keywords":"","body":" Table of Contents generated with DocToc shell expansions word splitting Filename Expansion quoting brace expansion segmented continuous scp multipule folder/file to target server all about {curly braces} in bash fast copy or moving or something (detials -> brace expansion) multiple directories creation copy a file to multipule folder the eval builtin the set builtin show current status option name the shopt builtin options examples event designators word designators special parameters shell expansions references: Bash Reference Manual Bash Reference Manual ZH Brace Expansion Tilde Expansion Shell Parameter Expansion Command Substitution Arithmetic Expansion Process Substitution Word Splitting Filename Expansion Pattern Matching Quote Removal And: The Set Builtin The Shopt Builtin And Bash Guide for Beginners Chapter 3. The Bash environment NAME EXAMPLE Brace Expansion echo a{d,c,b}e Tilde Expansion ~ Shell Parameter Expansion string=01234567890abc; echo ${string:7:2} Command Substitution $(command) or command Arithmetic Expansion $(( expression )) Process Substitution or >(list) Word Splitting $IFS Filename Expansion *, ? , [..],... word splitting due to 7 fields are spitted via : in /etc/passwd IFS=':' read f1 f2 f3 f4 f5 f6 f7 Filename Expansion Bash scans each word for the characters '*', '?', and '[', unless the -f (set -f) option has been set CONDITION RESULT match found && nullglob disabled the word is regarded as a pattern no match found && nullglob disabled the word is left unchanged no match found && nullglob set the word is removed no match found && failglob set show error msg and cmd won't be exectued nocaseglob enabled patten match case insensitive set -o noglob or set -f * will not be expanded shopt -s dotglob * will including all .*. see zip package with dot-file quoting Difference between single and double quotes in Bash ANSI-C quoting with $'' - GNU Bash Manual Locale translation with $\"\" - GNU Bash Manual A three-point formula for quotes sample: a=apple # a simple variable arr=(apple) # an indexed array with a single element # Expression Result Comments 1 \"$a\" apple variables are expanded inside \"\" 2 '$a' $a variables are not expanded inside '' 3 \"'$a'\" 'apple' '' has no special meaning inside \"\" 4 '\"$a\"' \"$a\" \"\" is treated literally inside '' 5 '\\'' invalid can not escape a ' within ''; use \"'\" or $'\\'' (ANSI-C quoting) 6 \"red$arocks\" red $arocks does not expand $a; use ${a}rocks to preserve $a 7 \"redapple$\" redapple$ $ followed by no variable name evaluates to $ 8 '\\\"' \\\" \\ has no special meaning inside '' 9 \"\\'\" \\' \\' is interpreted inside \"\" but has no significance for ' 10 \"\\\"\" \" \\\" is interpreted inside \"\" 11 \"*\" * glob does not work inside \"\" or '' 12 \"\\t\\n\" \\t\\n \\t and \\n have no special meaning inside \"\" or ''; use ANSI-C quoting 13 \"echo hi\" hi `` and $() are evaluated inside \"\" (backquotes are retained in actual output) 14 'echo hi' echo` hi `` and $() are not evaluated inside '' (backquotes are retained in actual output) 15 '${arr[0]}' ${arr[0]} array access not possible inside '' 16 \"${arr[0]}\" apple array access works inside \"\" 17 $'$a\\'' $a' single quotes can be escaped inside ANSI-C quoting 18 \"$'\\t'\" $'\\t' ANSI-C quoting is not interpreted inside \"\" 19 '!cmd' !cmd history expansion character '!' is ignored inside '' 20 \"!cmd\" cmd args expands to the most recent command matching \"cmd\" 21 $'!cmd' !cmd history expansion character '!' is ignored inside ANSI-C quotes brace expansion segmented continuous # exclude 7 from 1-10 $ echo test-{{1..6},{8..10}} test-1 test-2 test-3 test-4 test-5 test-6 test-8 test-9 test-10 scp multipule folder/file to target server $ scp -r $(echo dir{1..10}) user@target.server:/target/server/path/ all about {curly braces} in bash $ echo 00{1..9} 0{10..99} 100 001 002 003 004 005 006 007 008 009 010 011 012 013 014 015 016 017 018 019 020 021 022 023 024 025 026 027 028 029 030 031 032 033 034 035 036 037 038 039 040 041 042 043 044 045 046 047 048 049 050 051 052 053 054 055 056 057 058 059 060 061 062 063 064 065 066 067 068 069 070 071 072 073 074 075 076 077 078 079 080 081 082 083 084 085 086 087 088 089 090 091 092 093 094 095 096 097 098 099 100 $ dec2bin=({0..1}{0..1}{0..1}{0..1}{0..1}{0..1}{0..1}{0..1}) $ echo ${dec2bin[1]} 00000001 $ echo ${dec2bin[0]} 00000000 $ echo ${dec2bin[255]} 11111111 $ month=(\"Jan\" \"Feb\" \"Mar\" \"Apr\" \"May\" \"Jun\" \"Jul\" \"Aug\" \"Sep\" \"Oct\" \"Nov\" \"Dec\") $ echo ${month[5]} Jun $ echo {10..0..2} 10 8 6 4 2 0 $ echo {1..100..3} 1 4 7 10 13 16 19 22 25 28 31 34 37 40 43 46 49 52 55 58 61 64 67 70 73 76 79 82 85 88 91 94 97 100 fast copy or moving or something (detials -> brace expansion) Example 1:$ ls | grep foo $ touch foo{1,2,3} $ ls | grep foo foo1 foo2 foo3 Example 2 $ ls | grep foo $ touch foo-{a..d} $ ls | grep foo foo-a foo-b foo-c foo-d Example 3 $ ls foo-* foo-a foo-b foo-c foo-d $ mv foo-{a,} $ ls foo-* foo- foo-b foo-c foo-d Example 4 $ mkdir -p test/{a,b,c,d} $ tree test/ test/ ├── a ├── b ├── c └── d 4 directories, 0 files multiple directories creation $ mkdir sa{1..50} $ mkdir -p sa{1..50}/sax{1..50} $ mkdir {a-z}12345 $ mkdir {1,2,3} $ mkdir test{01..10} $ mkdir -p `date '+%y%m%d'`/{1,2,3} $ mkdir -p $USER/{1,2,3} copy a file to multipule folder $ echo dir1 dir2 dir3 | xargs -n 1 cp file1 # OR $ echo dir{1..10} | xargs -n 1 cp file1 the eval builtin eval — construct command by concatenating arguments reference: Bash eval command functions / eval (source, CPAN) What is the “eval” command in bash? example without eval:$ foo='ls | less' $ $foo ls: cannot access '|': No such file or directory ls: cannot access 'less': No such file or directory with eval:$ foo='ls | less' $ eval $foo Applications Library System Users ... example $ x=10 $ y=x $ foo='$'$x $ echo $foo $x # with eval $ eval foo='$'$x # with eval $ echo $foo 10 # or $ foo=\\$$x $ eval echo $foo # with eval 10 $ echo $foo $x the set builtin reference: Writing Robust Bash Shell Scripts 用内置的set和shopt命令来设置bash的选项 set set [--abefhkmnptuvxBCEHPT] [-o option-name] [argument …] set [+abefhkmnptuvxBCEHPT] [+o option-name] [argument …] example$ set | grep -e SHELLOPTS -e BASHOPTS BASHOPTS=cdspell:checkwinsize:cmdhist:complete_fullquote:expand_aliases:extglob:extquote:force_fignore:globasciiranges:histappend:interactive_comments:login_shell:progcomp:promptvars:sourcepath SHELLOPTS=braceexpand:emacs:hashall:histexpand:history:interactive-comments:monitor OPTION EXPLANATION -a -o allexport -b cause the status of terminated background jobs to be reported immediately -e -o errexitExit immediately if a pipeline returns a non-zero status -f Disable filename expansion (globbing) -h -o hashall -k -o keyword -m -o monitor -n -o noexec -o option-name see option name -p -o privileged the $BASH_ENV and $ENV files are not processed -t -o onecmd -u -o unsettreat unset variables and parameters other than the special parameters '@' or '*' as an error -v verbose. print shell input lines as they are read -x -o xtrace[debug] print commands and their arguments as they are executed -B -o braceexpand shell will perform brace expansion -c -o noclobberprevent output redirection using '>', '>&', and '<>' from overwriting existing files. -E -o errtrace -H -o histexpand -P do not resolve symbolic links -T -o functraceany trap on DEBUG and RETURN are inherited by shell functions -- if no arguments follow this option, then the positional parameters are unset - signal the end of options, cause all remaining arguments to be assigned to the positional parameters show current status set -o $ set -o allexport off braceexpand on emacs on errexit off errtrace off functrace off hashall on histexpand on history on ignoreeof off interactive-comments on keyword off monitor on noclobber off noexec off noglob off nolog off notify off nounset off onecmd off physical off pipefail off posix off privileged off verbose off vi off xtrace off set +o $ set +o set +o allexport set -o braceexpand set -o emacs set +o errexit set +o errtrace set +o functrace set -o hashall set -o histexpand set -o history set +o ignoreeof set -o interactive-comments set +o keyword set -o monitor set +o noclobber set +o noexec set +o noglob set +o nolog set +o notify set +o nounset set +o onecmd set +o physical set +o pipefail set +o posix set +o privileged set +o verbose set +o vi set +o xtrace option name option expression allexport Same as -a. braceexpand Same as -B. emacs Use an emacs-style line editing interface. This also affects the editing interface used for read -e. errexit Same as -e. errtrace Same as -E. functrace Same as -T. hashall Same as -h. histexpand Same as -H. history Enable command history, as described in Bash History Facilities. This option is on by default in interactive shells. ignoreeof An interactive shell will not exit upon reading EOF. keyword Same as -k. monitor Same as -m. noclobber Same as -C. noexec Same as -n. noglob Same as -f. nolog Currently ignored. notify Same as -b. nounset Same as -u. onecmd Same as -t. physical Same as -P. pipefail If set, the return value of a pipeline is the value of the last (rightmost) command to exit with a non-zero status, or zero if all commands in the pipeline exit successfully. This option is disabled by default. posix Change the behavior of Bash where the default operation differs from the POSIX standard to match the standard (see Bash POSIX Mode). This is intended to make Bash behave as a strict superset of that standard. privileged Same as -p. verbose Same as -v. vi Use a vi-style line editing interface. This also affects the editing interface used for read -e. xtrace Same as -x. the shopt builtin shopt shopt [-pqsu] [-o] [optname …] option expression -s enable -u disable -q suppresses normal output -o set -o options options assoc_expand_once autocd cdable_vars cdspell checkhash checkjobs checkwinsize cmdhist compat31 compat32 compat40 compat41 compat42 compat43 compat44 complete_fullquote direxpand dirspell dotglob execfail expand_aliases extdebug extglob extquote failglob force_fignore globasciiranges globstar gnu_errfmt histappend histreedit histverify hostcomplete huponexit inherit_errexit interactive_comments lastpipe lithist localvar_inherit localvar_unset login_shell mailwarn no_empty_cmd_completion nocaseglob nocasematch nullglob progcomp progcomp_alias promptvars restricted_shell shift_verbose sourcepath xpg_echo examples show all status $ shopt -p shopt -u autocd shopt -u assoc_expand_once shopt -u cdable_vars shopt -s cdspell shopt -u checkhash shopt -u checkjobs shopt -s checkwinsize shopt -s cmdhist shopt -u compat31 shopt -u compat32 shopt -u compat40 shopt -u compat41 shopt -u compat42 shopt -u compat43 shopt -u compat44 shopt -s complete_fullquote shopt -u direxpand shopt -u dirspell shopt -u dotglob shopt -u execfail shopt -s expand_aliases shopt -u extdebug shopt -s extglob shopt -s extquote shopt -u failglob shopt -s force_fignore shopt -s globasciiranges shopt -u globstar shopt -u gnu_errfmt shopt -s histappend shopt -u histreedit shopt -u histverify shopt -u hostcomplete shopt -u huponexit shopt -u inherit_errexit shopt -s interactive_comments shopt -u lastpipe shopt -u lithist shopt -u localvar_inherit shopt -u localvar_unset shopt -s login_shell shopt -u mailwarn shopt -u no_empty_cmd_completion shopt -u nocaseglob shopt -u nocasematch shopt -u nullglob shopt -s progcomp shopt -u progcomp_alias shopt -s promptvars shopt -u restricted_shell shopt -u shift_verbose shopt -s sourcepath shopt -u xpg_echo show single option # shopt -s sourcepath $ shopt -q sourcepath; echo $? 0 # shopt -u xpg_echo $ shopt -q xpg_echo; echo $? 1 set VS. shopt $ set | grep -e SHELLOPTS -e BASHOPTS BASHOPTS=cdspell:checkwinsize:cmdhist:complete_fullquote:expand_aliases:extglob:extquote:force_fignore:globasciiranges:histappend:interactive_comments:login_shell:progcomp:promptvars:sourcepath SHELLOPTS=braceexpand:emacs:hashall:histexpand:history:interactive-comments:monitor $ set -o | column -t | grep -v off braceexpand on emacs on hashall on histexpand on history on interactive-comments on monitor on $ shopt | column -t | grep -v off cdspell on checkwinsize on cmdhist on complete_fullquote on expand_aliases on extglob on extquote on force_fignore on globasciiranges on histappend on interactive_comments on login_shell on progcomp on promptvars on sourcepath on event designators option expression ! start a history substitution !n refer to command line n !-n refer to the command n lines back !! refer to the previous command !string refer to the most recent command preceding the current position in the history list starting with string !?string[?] refer to the most recent command preceding the current position in the history list containing string. ^string1^string2^ !!:s^string1^string2^ quick substitution. repeat the last command, replacing string1 with string2 !# the entire command line typed so far word designators option expression !! designates the preceding command !!:$ or !$ designates the last argument of the preceding command !fi:2 designates the second argument of the most recent command starting with the letters fi $_ VS. !$ reference: Understand the meaning of $_ -$_ bash variables if the invoking application doesn't pass a environment variable, the invoked bash shell will initialise $ to the argv[0] it receives itself which could be bash i.e. $ env | grep '^_=' _=/usr/local/opt/coreutils/libexec/gnubin/env # or $ env bash -c 'echo \"$_\"' /usr/local/opt/coreutils/libexec/gnubin/env !$ Word Designators equal to !!:$ special parameters character definition $* expands to the positional parameters, starting from one. when the expansion occurs within double quotes, it expands to a single word with the value of each parameter separated by the first character of the ifs special variable. $@ expands to the positional parameters, starting from one. when the expansion occurs within double quotes, each parameter expands to a separate word. $# expands to the number of positional parameters in decimal. $? expands to the exit status of the most recently executed foreground pipeline. $- a hyphen expands to the current option flags as specified upon invocation, by the set built-in command, or those set by the shell itself (such as the -i). $$ expands to the process id of the shell. $! expands to the process id of the most recently executed background (asynchronous) command. $0 expands to the name of the shell or shell script. $_ the underscore variable is set at shell startup and contains the absolute file name of the shell or script being executed as passed in the argument list. subsequently, it expands to the last argument to the previous command, after expansion. it is also set to the full pathname of each command executed and placed in the environment exported to that command. when checking mail, this parameter holds the name of the mail file. $* vs. $@: The implementation of \"$*\" has always been a problem and realistically should have been replaced with the behavior of \"$@\". In almost every case where coders use \"$*\", they mean \"$@\". \"$*\" Can cause bugs and even security holes in your software. Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:39 "},"cheatsheet/windows/windows.html":{"url":"cheatsheet/windows/windows.html","title":"windows","keywords":"","body":" Table of Contents generated with DocToc process get the list of programs (wmic) ps auxf stop service & process via powershell CLSID usage details regedit Set %USERPROFILE% as ${HOME} for cygwin PuTTy disable screensaver Remove Graphics card context menu Set Environment Variables setx problem whoami check SID Fingerprint Pro Enable Gadgets issue about \"profile.d\\Active\"' is not recognized as an internal or external command stop windows beep shell win + r debug in powershell show all environment variables setup environment via config file by powershell tricky reference: windows commandline TenForums process get the list of programs (wmic) [12:26:33.40 C:\\Windows\\SysWOW64] $ wmic product get name,version Name Version ALM-Platform Loader 11.5x 11.52.444.0 Microsoft Lync Web App Plug-in 15.8.8308.577 Google App Engine 1.8.6.0 Microsoft Office Professional Plus 2010 14.0.6029.1000 Microsoft Office OneNote MUI (English) 2010 14.0.6029.1000 ... ps auxf tasklist > tasklist Image Name PID Session Name Session# Mem Usage ========================= ======== ================ =========== ============ System Idle Process 0 Services 0 4 K System 4 Services 0 8,236 K smss.exe 520 Services 0 1,164 K csrss.exe 864 Services 0 4,340 K wininit.exe 960 Services 0 4,744 K csrss.exe 968 Console 1 11,396 K services.exe 108 Services 0 7,776 K lsass.exe 96 Services 0 22,176 K stop service & process via powershell reference: Restart docker Windows 10 command line get service: PS > Get-Service | Where-Object {$_.name -ilike \"*docker*\" -and $_.Status -ieq \"Running\"} Status Name DisplayName ------ ---- ----------- Running docker Docker Engine # or PS > Get-Service | Where-Object {$_.name -ilike \"*docker*\" -and $_.Status -ieq \"Running\"} Status Name DisplayName ------ ---- ----------- Running docker Docker Engine stop service: PS > foreach($svc in (Get-Service | Where-Object {$_.name -ilike \"*docker*\" -and $_.Status -ieq \"Running\"})) { $svc | Stop-Service -ErrorAction Continue -Confirm:$false -Force } # or PS > Stop-Service docker -ErrorAction Continue -Confirm:$false -Force get process PS > Get-Process | Where-Object {$_.Name -ilike \"*docker*\"} Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName ------- ------ ----- ----- ------ -- -- ----------- 644 43 175288 56388 475.31 5080 0 dockerd stop process PS > Get-Process | Where-Object {$_.Name -ilike \"*docker*\"} | Stop-Process -ErrorAction Continue -Confirm:$false -Force restart docker service & process PS > Stop-Service docker -ErrorAction Continue -Confirm:$false -Force PS > Get-Process | Where-Object {$_.Name -ilike \"*docker*\"} | Stop-Process -ErrorAction Continue -Confirm:$false -Force PS > Start-Service docker PS > Get-Process | Where-Object {$_.Name -ilike \"*docker*\"} Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName ------- ------ ----- ----- ------ -- -- ----------- 371 26 142736 46460 1.06 5828 0 dockerd restart via batch reference: Restart docker Windows 10 command line > net stop docker > net stop com.docker.service > taskkill /IM \"dockerd.exe\" /F > taskkill /IM \"Docker for Windows.exe\" /F > net start docker > net start com.docker.service > \"c:\\program files\\docker\\docker\\Docker for Windows.exe\" CLSID reference CLSID Key (GUID) Shortcuts List for Windows 10 http://www.klapac.funsite.cz/mediawiki/index.php?title=List_of_Windows_10_CLSID_Key_(GUID)_Shortcuts usage > explorer.exe shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} or > explorer.exe /e,::{CLSID key number} details clsid regedit Set %USERPROFILE% as ${HOME} for cygwin [15:55:36.30 C:\\] $ reg add HKCU\\Environment /v HOME /t REG_EXPAND_SZ /d ^%USERPROFILE^% PuTTy Backup PuTTy sessions > regedit /e \"%userprofile%\\desktop\\putty-registry.reg\" HKEY_CURRENT_USER\\Software\\Simontatham Launchy PuTTy session as shortcut > [PuTTy.exe] -load [SessionName] Backup PuTTy session > regedit /e \"%userprofile%\\desktop\\putty-sessions.reg\" HKEY_CURRENT_USER\\Software\\SimonTatham\\PuTTY\\Sessions disable screensaver reference Configure screensaver command line REM Disable the screensaver REG ADD \"HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Control Panel\\Desktop\" /v ScreenSaverIsSecure /t REG_SZ /d 0 /f REG ADD \"HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Control Panel\\Desktop\" /v ScreenSaveActive /t REG_SZ /d 0 /f or by using autohotkey CoordMode, Mouse, Screen Loop { ; Move mouse MouseMove, 1, 1, 0, R ; Replace mouse to its original location MouseMove, -1, -1, 0, R ; Wait before moving the mouse again Sleep, 600000 } return or #Persistent SetTimer, WatchCursor, 100 return Loop { WatchCursor: MouseGetPos,X1 ,Y1 Sleep 10000 MouseGetPos,X2,Y2 if X1=X2 And Y1=Y2 { MouseMove,100,100 Sleep, 10000 MouseMove,200,200 Sleep, 10000 } } Remove Graphics card context menu Unregister igfxpph.dll [11:39:50.61 C:\\] $ regsvr32 /u igfxpph.dll Remove register Setting from regedit [11:47:10.20 C:\\] $ REG DELETE \"HKEY_CLASSES_ROOT\\Directory\\Background\\shellex\\ContextMenuHandlers\\igfxcui\" /f Setting from setx [11:47:10.20 C:\\] $ REG DELETE \"HKEY_CLASSES_ROOT\\Directory\\Background\\shellex\\ContextMenuHandlers\\igfxcui\" /f Set Environment Variables Set User Varialbe [13:48:11.20 C:\\] $ setx VIM_HOME C:\\Marslo\\MyProgramFiles\\Vim\\vim74\\gvim.exe Set System Variable [13:48:11.20 C:\\] $ setx /M VIM_HOME C:\\Marslo\\MyProgramFiles\\Vim\\vim74\\gvim.exe details windows default environment variable setx problem [14:31:18.67 C:\\] $ setx /M PATH %PATH%;%M2_HOME%\\bin ERROR: Invalid syntax. Default option is not allowed more than '2' time(s). Type \"SETX /?\" for usage. Fix:[14:31:18.67 C:\\] $ REG ADD \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v Path /t REG_SZ /d \"%path%;%M2_HOME%\\bin\" /f whoami check SID [15:59:24.12 C:\\Windows\\SysWOW64] $ whoami /user USER INFORMATION ---------------- User Name SID ================ =============================================== mj\\marslo_jiao S-1-5-21-354581543-3608027983-2995495404-970613 Fingerprint Pro URL: www.lenovo.com Help link: support.lenovo.com Installation folder: C:\\Program Files\\Lenovo\\Fingerprint Manager Pro\\ Uninstaller: \"C:\\Program Files\\InstallShield Installation Information\\{314FAD12-F785-4471-BCE8-AB506642B9A1}\\setup.exe\" -runfromtemp -l0x0409 -removeonly Estimated size: 70.21 MB Enable Gadgets Windows Registry Editor Version 5.00 [HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Windows\\Sidebar] \"TurnOffSidebar\"=- [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Windows\\Sidebar] \"TurnOffSidebar\"=- issue about \"profile.d\\Active\"' is not recognized as an internal or external command regedit [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Command Processor] \"Autorun\"=\"@CHCP 65001>nul\" cmd $ REG ADD \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Command Processor\" /v AutoRun /t REG_SZ /d \"@CHCP 65001>nul\" /f stop windows beep references: How to disable PC Speaker beep sound in Windows 10https://winaero.com/how-to-disable-pc-speaker-beep-sound-in-windows-10/ How to disable System Beep in Windows 10 > net stop beep > sc config beep start= disabled shell win + r references: shell:folder appfolder > shell:appfolder startup folder > shell:startup > shell:Common Startup debug in powershell references: Set-PSDebug Troubleshoot by Using Set-PSDebug > Set-PSDebug -Trace 2 show all environment variables Write-Host \"System Environment: \" Get-ChildItem -Path Env: setup environment via config file by powershell references: Set-Content PS C:\\> cat .\\test.txt TEST_A=aa TEST_B=bb PS C:\\> cat .\\test.txt | ForEach-Object { >> $name, $value = $_ -split '=', 2 >> Set-Content env:\\\"$name\" $value >> } example PS C:\\> Get-Content -Path .\\test.txt | Foreach-Object { >> $name, $value = $_ -split '=', 2 >> echo \"`n>>> $name ~> $value\" >> Set-Content env:\\\"$name\" $value >> Get-ChildItem Env:\\\"$name\" >> } >>> TEST_A ~> aa Name Value ---- ----- TEST_A aa >>> TEST_B ~> bb TEST_B bb tricky Internet Explorer Enhanced Security Configuration is enabled Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:38 "},"cheatsheet/windows/shortcut.html":{"url":"cheatsheet/windows/shortcut.html","title":"shortcut","keywords":"","body":" Table of Contents generated with DocToc shortcuts cmd admin cmd admin without UAC check via Task Scheduler lansettings Desktop Icon Settings Notification Area Icons Personalization Screen Saver System System Icon user environment variables icons reference reference : Windows Start | Run commands List of Commands to Open Control Panel Items in Windows 10 shortcuts cmd admin references: Create Elevated Command Prompt Shortcut in Windows 10 Open Elevated Command Prompt in Windows 10 create shortcut by New -> Shortcut insert commands setup shortcut name setup Run as administrator for the shortcut move shortcut to Start Menu : Ctrl + r -> shell:Programs cmd admin without UAC check via Task Scheduler references: Create Administrator Mode Shortcuts Without UAC Prompts in Windows 10 How to Create Administrator Shortcut Without UAC Password Prompt configuration in Task Scheduler win -> insert Task Scheduler -> Enter Task Scheduler (Local) -> Create Task... General Tab : -> Name: RunAdminCMD (or any you want) -> [x] Run with highest privileges Conditions Tab : -> [ ] Start the task only if the computer is on AC power Actions Tab : -> New -> Browse Program/script: -> select the path (i.e.: C:\\Windows\\System32\\cmd.exe) -> OK or Triggers Tab : -> New -> Begin the task: : At Startup (or At log on) -> OK Settings Tab : -> [ ] Stop the task if runing longer than: 3 days -> OK Save and Run shortcut setup right click -> New -> Shortcut Type the location of the item: : schtasks /run /tn \"\" -> Next schtasks /run /tn \"\" i.e.:schtasks /run /tn \"RunAdminCMD\" Type a name of this shortbut: : any name you want (i.e.: Command Prompt) -> Finish right click the new shortcut -> Properties -> Shortcut Tab : Change Icon Look for icons in this file : %SystemRoot%\\System32\\imageres.dll put the shortcut to anywhere you want lansettings Internet Settings > inetcpl.cpl Internet Settings with Connections Tab > rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,4 or > inetcpl.cpl ,4 or > control inetcpl.cpl,,4 proxy setup > REG ADD \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyServer /d \"hhttp=proxy-url:port;https=proxy-url:port;ftp=proxy-url:port;socks=proxy-url:port;\" /t REG_SZ /f Desktop Icon Settings > rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,0 Notification Area Icons > explorer shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} Personalization > explorer shell:::{ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} Screen Saver > rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,1 System > control /name Microsoft.System or > control sysdm.cpl System Icon > explorer shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} \\SystemIcons,,0 user environment variables rundll32.exe sysdm.cpl,EditEnvironmentVariables icons %SystemRoot%\\System32\\shell32.dll %SystemRoot%\\system32\\imageres.dll %systemroot%\\system32\\DeviceCenter.dll %systemroot%\\explorer.exe %systemroot%\\system32\\ddores.dll %systemroot%\\system32\\mmcndmgr.dll %systemroot%\\system32\\mmres.dll %systemroot%\\system32\\netcenter.dll %systemroot%\\system32\\networkexplorer.dll %systemroot%\\system32\\pnidui.dll %systemroot%\\system32\\setupapi.dll %systemroot%\\system32\\compstui.dll %systemroot%\\system32\\dsuiext.dll %systemroot%\\system32\\mstscax.dll %systemroot%\\system32\\comres.dll %systemroot%\\system32\\mstsc.exe %systemroot%\\system32\\actioncentercpl.dll %systemroot%\\system32\\aclui.dll %systemroot%\\system32\\autoplay.dll %systemroot%\\system32\\comctl32.dll %systemroot%\\system32\\xwizards.dll %systemroot%\\system32\\ncpa.cpl %systemroot%\\system32\\url.dll %systemroot%\\system32\\pifmgr.dll %systemroot%\\system32\\accessibilitycpl.dl %systemroot%\\system32\\moricons.dll %systemroot%system32\\netshell.dll %systemroot%\\system32\\sensorscpl.dll %systemroot%\\system32\\wmploc.dll %systemroot%\\system32\\wpdshext.dll systemroot%\\system32\\ieframe.dll %systemroot%\\system32\\wiashext.dll reference Control Panel Item Commands Add a Device wizard %windir%\\System32\\DevicePairingWizard.exe Add Hardware wizard %windir%\\System32\\hdwwiz.exe Add a Printer wizard rundll32.exe shell32.dll,SHHelpShortcuts_RunDLL AddPrinter Additional Clocks rundll32.exe shell32.dll,Control_RunDLL timedate.cpl,,1 Administrative Tools control /name Microsoft.AdministrativeTools OR control admintools AutoPlay control /name Microsoft.AutoPlay Backup and Restore (Windows 7) control /name Microsoft.BackupAndRestoreCenter BitLocker Drive Encryption control /name Microsoft.BitLockerDriveEncryption Color and Appearance explorer shell:::{ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} -Microsoft.Personalization\\pageColorization Color Management control /name Microsoft.ColorManagement Credential Manager control /name Microsoft.CredentialManager Date and Time (Date and Time) control /name Microsoft.DateAndTime OR control timedate.cpl OR control date/time OR rundll32.exe shell32.dll,Control_RunDLL timedate.cpl,,0 Date and Time (Additional Clocks) rundll32.exe shell32.dll,Control_RunDLL timedate.cpl,,1 Default Programs control /name Microsoft.DefaultPrograms Desktop Background explorer shell:::{ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} -Microsoft.Personalization\\pageWallpaper Desktop Icon Settings rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,0 Device Manager control /name Microsoft.DeviceManager OR control hdwwiz.cpl OR devmgmt.msc Devices and Printers control /name Microsoft.DevicesAndPrinters OR control printers Ease of Access Center control /name Microsoft.EaseOfAccessCenter OR control access.cpl File Explorer Options (General tab) control /name Microsoft.FolderOptions OR control folders OR rundll32.exe shell32.dll,Options_RunDLL 0 File Explorer Options (View tab) rundll32.exe shell32.dll,Options_RunDLL 7 File Explorer Options (Search tab) rundll32.exe shell32.dll,Options_RunDLL 2 File History control /name Microsoft.FileHistory Fonts control /name Microsoft.Fonts OR control fonts Game Controllers control /name Microsoft.GameControllers OR control joy.cpl Get Programs control /name Microsoft.GetPrograms OR rundll32.exe shell32.dll,Control_RunDLL appwiz.cpl,,1 HomeGroup control /name Microsoft.HomeGroup Indexing Options control /name Microsoft.IndexingOptions OR rundll32.exe shell32.dll,Control_RunDLL srchadmin.dll Infrared control /name Microsoft.Infrared OR control irprops.cpl OR control /name Microsoft.InfraredOptions Internet Properties (General tab) control /name Microsoft.InternetOptions OR control inetcpl.cpl OR rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,0 Internet Properties (Security tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,1 Internet Properties (Privacy tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,2 Internet Properties (Content tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,3 Internet Properties (Connections tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,4 Internet Properties (Programs tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,5 Internet Properties (Advanced tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,6 iSCSI Initiator control /name Microsoft.iSCSIInitiator Keyboard control /name Microsoft.Keyboard OR control keyboard Language control /name Microsoft.Language Mouse Properties (Buttons tab 0) control /name Microsoft.Mouse OR control main.cpl OR control mouse OR rundll32.exe shell32.dll,Control_RunDLL main.cpl,,0 Mouse Properties (Pointers tab 1) control main.cpl,,1 OR rundll32.exe shell32.dll,Control_RunDLL main.cpl,,1 Mouse Properties (Pointer Options tab 2) control main.cpl,,2 OR rundll32.exe shell32.dll,Control_RunDLL main.cpl,,2 Mouse Properties (Wheel tab 3) control main.cpl,,3 OR rundll32.exe shell32.dll,Control_RunDLL main.cpl,,3 Mouse Properties (Hardware tab 4) control main.cpl,,4 OR rundll32.exe shell32.dll,Control_RunDLL main.cpl,,4 Network and Sharing Center control /name Microsoft.NetworkAndSharingCenter Network Connections control ncpa.cpl OR control netconnections Network Setup Wizard control netsetup.cpl Notification Area Icons explorer shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} ODBC Data Source Administrator control odbccp32.cpl Offline Files control /name Microsoft.OfflineFiles Performance Options (Visual Effects) %windir%\\system32\\SystemPropertiesPerformance.exe Performance Options (Data Execution Prevention) %windir%\\system32\\SystemPropertiesDataExecutionPrevention.exe Personalization explorer shell:::{ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} Phone and Modem control /name Microsoft.PhoneAndModem OR control telephon.cpl Power Options control /name Microsoft.PowerOptions OR control powercfg.cpl Power Options - Advanced settings control powercfg.cpl,,1 Power Options - Create a Power Plan control /name Microsoft.PowerOptions /page pageCreateNewPlan Power Options - Edit Plan Settings control /name Microsoft.PowerOptions /page pagePlanSettings Power Options - System Settings control /name Microsoft.PowerOptions /page pageGlobalSettings Presentation Settings %windir%\\system32\\PresentationSettings.exe Programs and Features control /name Microsoft.ProgramsAndFeatures OR control appwiz.cpl Recovery control /name Microsoft.Recovery Region (Formats tab) control /name Microsoft.RegionAndLanguage OR control /name Microsoft.RegionalAndLanguageOptions /page /p:\"Formats\" OR control intl.cpl OR control international Region (Location tab) control /name Microsoft.RegionalAndLanguageOptions /page /p:\"Location\" Region (Administrative tab) control /name Microsoft.RegionalAndLanguageOptions /page /p:\"Administrative\" RemoteApp and Desktop Connections control /name Microsoft.RemoteAppAndDesktopConnections Scanners and Cameras control /name Microsoft.ScannersAndCameras OR control sticpl.cpl Screen Saver Settings rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,1 Security and Maintenance control /name Microsoft.ActionCenter OR control wscui.cpl Set Associations control /name Microsoft.DefaultPrograms /page pageFileAssoc Set Default Programs control /name Microsoft.DefaultPrograms /page pageDefaultProgram Set Program Access and Computer Defaults rundll32.exe shell32.dll,Control_RunDLL appwiz.cpl,,3 Sound (Playback tab) control /name Microsoft.Sound OR control mmsys.cpl OR %windir%\\System32\\rundll32.exe shell32.dll,Control_RunDLL mmsys.cpl,,0 Sound (Recording tab) %windir%\\System32\\rundll32.exe shell32.dll,Control_RunDLL mmsys.cpl,,1 Sound (Sounds tab) %windir%\\System32\\rundll32.exe shell32.dll,Control_RunDLL mmsys.cpl,,2 Sound (Communications tab) %windir%\\System32\\rundll32.exe shell32.dll,Control_RunDLL mmsys.cpl,,3 Speech Recognition control /name Microsoft.SpeechRecognition Storage Spaces control /name Microsoft.StorageSpaces Sync Center control /name Microsoft.SyncCenter System control /name Microsoft.System OR control sysdm.cpl System Icons explorer shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} \\SystemIcons,,0 System Properties (Computer Name) %windir%\\System32\\SystemPropertiesComputerName.exe System Properties (Hardware) %windir%\\System32\\SystemPropertiesHardware.exe System Properties (Advanced) %windir%\\System32\\SystemPropertiesAdvanced.exe System Properties (System Protection) %windir%\\System32\\SystemPropertiesProtection.exe System Properties (Remote) %windir%\\System32\\SystemPropertiesRemote.exe Tablet PC Settings control /name Microsoft.TabletPCSettings Text to Speech control /name Microsoft.TextToSpeech Troubleshooting explorer shell:::{26EE0668-A00A-44D7-9371-BEB064C98683}\\0\\::{C58C4893-3BE0-4B45-ABB5-A63E4B8C8651} User Accounts control /name Microsoft.UserAccounts OR control userpasswords User Accounts (netplwiz) netplwiz OR control userpasswords2 Windows Defender Firewall control /name Microsoft.WindowsFirewall OR control firewall.cpl Windows Defender Firewall Allowed apps explorer shell:::{4026492F-2F69-46B8-B9BF-5654FC07E423} -Microsoft.WindowsFirewall\\pageConfigureApps Windows Defender Firewall with Advanced Security %WinDir%\\System32\\WF.msc Windows Features %windir%\\System32\\OptionalFeatures.exe OR rundll32.exe shell32.dll,Control_RunDLL appwiz.cpl,,2 Windows Mobility Center control /name Microsoft.MobilityCenter Work Folders %windir%\\System32\\WorkFolders.exe Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:38 "},"cheatsheet/windows/clsid.html":{"url":"cheatsheet/windows/clsid.html","title":"clsid","keywords":"","body":" Table of Contents generated with DocToc Usage List reference Usage > explorer.exe shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} or > explorer.exe /e,::{CLSID key number} List Opens CLSID key (GUID) Add Network Location {D4480A50-BA28-11d1-8E75-00C04FA31A86} Administrative Tools {D20EA4E1-3957-11d2-A40B-0C5020524153} Applications {4234d49b-0245-4df3-b780-3893943456e1} AutoPlay {9C60DE1E-E5FC-40f4-A487-460851A8D915} BitLocker Drive Encryption {D9EF8727-CAC2-4e60-809E-86F80A666C91} Bluetooth Devices {28803F59-3A75-4058-995F-4EE5503B023C} Color Management {B2C761C6-29BC-4f19-9251-E6195265BAF1} Command Folder {437ff9c0-a07f-4fa0-af80-84b6c6440a16} Common Places FS Folder {d34a6ca6-62c2-4c34-8a7c-14709c1ad938} Control Panel {5399E694-6CE5-4D6C-8FCE-1D8870FDCBA0} Control Panel (All Tasks) {ED7BA470-8E54-465E-825C-99712043E01C} Control Panel (always Category view) {26EE0668-A00A-44D7-9371-BEB064C98683} Control Panel (always Icons view) {21EC2020-3AEA-1069-A2DD-08002B30309D} Credential Manager {1206F5F1-0569-412C-8FEC-3204630DFB70} Date and Time {E2E7934B-DCE5-43C4-9576-7FE4F75E7480} Default Programs {17cd9488-1228-4b2f-88ce-4298e93e0966} delegate folder that appears in Computer {b155bdf8-02f0-451e-9a26-ae317cfd7779} Desktop (folder) {B4BFCC3A-DB2C-424C-B029-7FE99A87C641} Device Manager {74246bfc-4c96-11d0-abef-0020af6b0b7a} Devices and Printers {A8A91A66-3A7D-4424-8D24-04E180695C7A} Display {C555438B-3C23-4769-A71F-B6D3D9B6053A} Documents (folder) {A8CDFF1C-4878-43be-B5FD-F8091C1C60D0} Downloads (folder) {374DE290-123F-4565-9164-39C4925E467B} Ease of Access Center {D555645E-D4F8-4c29-A827-D93C859C4F2A} E-mail (default e-mail program) {2559a1f5-21d7-11d4-bdaf-00c04f60b9f0} Family Safety {96AE8D84-A250-4520-95A5-A47A7E3C548B} Favorites {323CA680-C24D-4099-B94D-446DD2D7249E} File Explorer Options {6DFD7C5C-2451-11d3-A299-00C04F8EF6AF} File History {F6B6E965-E9B2-444B-9286-10C9152EDBC5} Font Settings {93412589-74D4-4E4E-AD0E-E0CB621440FD} Fonts (folder) {BD84B380-8CA2-1069-AB1D-08000948F534} Frequent folders {3936E9E4-D92C-4EEE-A85A-BC16D5EA0819} Games Explorer {ED228FDF-9EA8-4870-83b1-96b02CFE0D52} Get Programs {15eae92e-f17a-4431-9f28-805e482dafd4} Help and Support {2559a1f1-21d7-11d4-bdaf-00c04f60b9f0} HomeGroup (settings) {67CA7650-96E6-4FDD-BB43-A8E774F73A57} HomeGroup (users) {B4FB3F98-C1EA-428d-A78A-D1F5659CBA93} Hyper-V Remote File Browsing {0907616E-F5E6-48D8-9D61-A91C3D28106D} Indexing Options {87D66A43-7B11-4A28-9811-C86EE395ACF7} Infared (if installed) {A0275511-0E86-4ECA-97C2-ECD8F1221D08} Installed Updates {d450a8a1-9568-45c7-9c0e-b4f9fb4537bd} Internet Options (Internet Explorer) {A3DD4F92-658A-410F-84FD-6FBBBEF2FFFE} Keyboard Properties {725BE8F7-668E-4C7B-8F90-46BDB0936430} Language settings {BF782CC9-5A52-4A17-806C-2A894FFEEAC5} Libraries {031E4825-7B94-4dc3-B131-E946B44C8DD5} Location Information (Phone and Modem Control Panel) {40419485-C444-4567-851A-2DD7BFA1684D} Location Settings {E9950154-C418-419e-A90A-20C5287AE24B} Media Servers {289AF617-1CC3-42A6-926C-E6A863F0E3BA} Mouse Properties {6C8EEC18-8D75-41B2-A177-8831D59D2D50} Music (folder) {1CF1260C-4DD0-4ebb-811F-33C572699FDE} My Documents {450D8FBA-AD25-11D0-98A8-0800361B1103} Network {F02C1A0D-BE21-4350-88B0-7367FC96EF3C} Network and Sharing Center {8E908FC9-BECC-40f6-915B-F4CA0E70D03D} Network Connections (in PC settings) {38A98528-6CBF-4CA9-8DC0-B1E1D10F7B1B} Network Connections {7007ACC7-3202-11D1-AAD2-00805FC1270E}OR{992CFFA0-F557-101A-88EC-00DD010CCC48} Network (WorkGroup) {208D2C60-3AEA-1069-A2D7-08002B30309D} Notification Area Icons {05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} NVIDIA Control Panel (if installed) {0bbca823-e77d-419e-9a44-5adec2c8eeb0} Offline Files Folder {AFDB1F70-2A4C-11d2-9039-00C04F8EEB3E} OneDrive {018D5C66-4533-4307-9B53-224DE2ED1FE6} Pen and Touch {F82DF8F7-8B9F-442E-A48C-818EA735FF9B} Personalization {ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} Pictures (folder) {3ADD1653-EB32-4cb0-BBD7-DFA0ABB5ACCA} Portable Devices {35786D3C-B075-49b9-88DD-029876E11C01} Power Options {025A5937-A6BE-4686-A844-36FE4BEC8B6D} Previous Versions Results Folder {f8c2ab3b-17bc-41da-9758-339d7dbf2d88} printhood delegate folder {ed50fc29-b964-48a9-afb3-15ebb9b97f36} Printers {2227A280-3AEA-1069-A2DE-08002B30309D}OR{863aa9fd-42df-457b-8e4d-0de1b8015c60} Programs and Features {7b81be6a-ce2b-4676-a29e-eb907a5126c5} Public (folder) {4336a54d-038b-4685-ab02-99bb52d3fb8b} Quick access {679f85cb-0220-4080-b29b-5540cc05aab6} Recent places {22877a6d-37a1-461a-91b0-dbda5aaebc99} Recovery {9FE63AFD-59CF-4419-9775-ABCC3849F861} Recycle Bin {645FF040-5081-101B-9F08-00AA002F954E} Region and Language {62D8ED13-C9D0-4CE8-A914-47DD628FB1B0} RemoteApp and Desktop Connections {241D7C96-F8BF-4F85-B01F-E2B043341A4B} Remote Printers {863aa9fd-42df-457b-8e4d-0de1b8015c60} Removable Storage Devices {a6482830-08eb-41e2-84c1-73920c2badb9} Results Folder {2965e715-eb66-4719-b53f-1672673bbefa} Run {2559a1f3-21d7-11d4-bdaf-00c04f60b9f0} Search {9343812e-1c37-4a49-a12e-4b2d810d956b} Search Everywhere (modern) {2559a1f8-21d7-11d4-bdaf-00c04f60b9f0} Search Files (modern) {2559a1f0-21d7-11d4-bdaf-00c04f60b9f0} Security and Maintenance {BB64F8A7-BEE7-4E1A-AB8D-7D8273F7FDB6} Set Program Access and Computer Defaults {2559a1f7-21d7-11d4-bdaf-00c04f60b9f0} Show Desktop {3080F90D-D7AD-11D9-BD98-0000947B0257} Sound {F2DDFC82-8F12-4CDD-B7DC-D4FE1425AA4D} Speech Recognition {58E3C745-D971-4081-9034-86E34B30836A} Storage Spaces {F942C606-0914-47AB-BE56-1321B8035096} Sync Center {9C73F5E5-7AE7-4E32-A8E8-8D23B85255BF} Sync Setup Folder {2E9E59C0-B437-4981-A647-9C34B9B90891} System {BB06C0E4-D293-4f75-8A90-CB05B6477EEE} System Icons {05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} \\SystemIcons Tablet PC Settings {80F3F1D5-FECA-45F3-BC32-752C152E456E} Taskbar and Navigation properties {0DF44EAA-FF21-4412-828E-260A8728E7F1} Text to Speech {D17D1D6D-CC3F-4815-8FE3-607E7D5D10B3} This PC {20D04FE0-3AEA-1069-A2D8-08002B30309D} Troubleshooting {C58C4893-3BE0-4B45-ABB5-A63E4B8C8651} User Accounts {60632754-c523-4b62-b45c-4172da012619} User Accounts (netplwiz) {7A9D77BD-5403-11d2-8785-2E0420524153} User Pinned {1f3427c8-5c10-4210-aa03-2ee45287d668} %UserProfile% {59031a47-3f72-44a7-89c5-5595fe6b30ee} Videos (folder) {A0953C92-50DC-43bf-BE83-3742FED03C9C} Web browser (default) {871C5380-42A0-1069-A2EA-08002B30309D} Windows Defender {D8559EB9-20C0-410E-BEDA-7ED416AECC2A} Windows Mobility Center {5ea4f148-308c-46d7-98a9-49041b1dd468} Windows Features {67718415-c450-4f3c-bf8a-b487642dc39b} Windows Firewall {4026492F-2F69-46B8-B9BF-5654FC07E423} Windows To Go {8E0C279D-0BD1-43C3-9EBD-31C3DC5B8A77} Windows Update {36eef7db-88ad-4e81-ad49-0e313f0c35f8} Work Folders {ECDB0924-4208-451E-8EE0-373C0956DE16} reference C:\\Users\\marslo>Netsh netsh>interface In future versions of Windows, Microsoft might remove the Netsh functionality for TCP/IP. Microsoft recommends that you transition to Windows PowerShell if you currently use netsh to configure and manage TCP/IP. Type Get-Command -Module NetTCPIP at the Windows PowerShell prompt to view a list of commands to manage TCP/IP. Visit https://go.microsoft.com/fwlink/?LinkId=217627 for additional information about PowerShell commands for TCP/IP. netsh interface>show helper Helper GUID DLL Filename Command -------------------------------------- ------------ ------- {02BC1F81-D927-4EC5-8CBC-8DD65E3E38E8} AUTHFWCFG.DLL advfirewall {FB10CBCA-5430-46CE-B732-079B4E23BE24} AUTHFWCFG.DLL consec {35342B49-83B4-4FCC-A90D-278533D5BEA2} AUTHFWCFG.DLL firewall {4BD827F7-1E83-462D-B893-F33A80C5DE1D} AUTHFWCFG.DLL mainmode {4D0FEFCB-8C3E-4CDE-B39B-325933727297} AUTHFWCFG.DLL monitor {A31CB05A-1213-4F4E-B420-0EE908B896CB} PEERDISTSH.DLL branchcache {555EA58E-72B1-4F0A-9055-779D0F5400B2} PEERDISTSH.DLL smb {00770721-44EA-11D5-93BA-00B0D022DD1F} HNETMON.DLL bridge {6DC31EC5-3583-4901-9E28-37C28113656A} DHCPCMONITOR.DLL dhcpclient {8A6D23B3-0AF2-4101-BC6E-8114B325FE17} NETIOHLP.DLL dnsclient {8B3A0D7F-1F30-4402-B753-C4B2C7607C97} FWCFG.DLL firewall {44F3288B-DBFF-4B31-A86E-633F50D706B3} NSHHTTP.DLL http {0705ECA1-7AAC-11D2-89DC-006008B0E5B9} IFMON.DLL interface {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL 6to4 {97C192DB-A774-43E6-BE78-1FABD795EEAB} NETIOHLP.DLL httpstunnel {725588AC-7A11-4220-A121-C92C915E8B73} NETIOHLP.DLL ipv4 {500F32FD-7064-476B-8FD6-2171EA46428F} NETIOHLP.DLL ipv6 {90E1CBE1-01D9-4174-BB4D-EB97F3F6150D} NETIOHLP.DLL 6to4 {90E1CBE1-01D9-4174-BB4D-EB97F3F6150D} NETIOHLP.DLL isatap {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL isatap {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL portproxy {78197B47-2BEF-49CA-ACEB-D8816371BAA8} NETIOHLP.DLL tcp {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL teredo {F7E0BC27-BA6E-4145-A123-012F1922F3F1} NSHIPSEC.DLL ipsec {F7E0BC29-BA6E-4145-A123-012F1922F3F1} NSHIPSEC.DLL dynamic {F7E0BC28-BA6E-4145-A123-012F1922F3F1} NSHIPSEC.DLL static {3BB6DA1D-AC0C-4972-AC05-B22F49DEA9B6} NSHWFP.DLL ipsecdosprotection {1D8240C7-48B9-47CC-9E40-4F7A0A390E71} DOT3CFG.DLL lan {B341E8BA-13AA-4E08-8CF1-A6F2D8B0C229} NETIOHLP.DLL namespace {931852E2-597D-40B9-B927-55FFC81A6104} NETIOHLP.DLL netio {0705ECA2-7AAC-11D2-89DC-006008B0E5B9} RASMONTR.DLL ras {42E3CC21-098C-11D3-8C4D-00104BCA495B} RASMONTR.DLL aaaa {90FE6CFC-B6A2-463B-AA12-25E615EC3C66} RASMONTR.DLL diagnostics {13D12A78-D0FB-11D2-9B76-00104BCA495B} RASMONTR.DLL ip {36B3EF76-94C1-460F-BD6F-DF0178D90EAC} RASMONTR.DLL ipv6 {592852F7-5F6F-470B-9097-C5D33B612975} RPCNSH.DLL rpc {C07E293F-9531-4426-8E5C-D7EBBA50F693} RPCNSH.DLL filter {D3E9D893-852F-4E22-B05D-99293065773D} NETTRACE.DLL trace {3BB6DA1D-AC0C-4972-AC05-B22F49DEA9B6} NSHWFP.DLL wfp {0BFDC146-56A3-4311-A7D5-7D9953F8326E} WHHELPER.DLL winhttp {B2C0EEF4-CCE5-4F55-934E-ABF60F3DCF56} WSHELPER.DLL winsock Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:39 "},"cheatsheet/windows/env.html":{"url":"cheatsheet/windows/env.html","title":"env","keywords":"","body":" Table of Contents generated with DocToc default Windows Environment Variables List default Windows Environment Variables List Variable Default value assuming the system drive is C: ALLUSERSPROFILE C:\\ProgramData APPDATA C:\\Users\\{username}\\AppData\\Roaming ClientName Terminal servers only - the ComputerName of a remote host. CMDEXTVERSION The current Command Processor Extensions version number. (NT = \"1\", Win2000+ = \"2\".) CMDCMDLINE The original command line that invoked the Command Processor. CommonProgramFiles C:\\Program Files\\Common Files COMMONPROGRAMFILES(x86) C:\\Program Files (x86)\\Common Files COMPUTERNAME {computername} COMSPEC C:\\Windows\\System32\\cmd.exe or if running a 32 bit WOW - C:\\Windows\\SysWOW64\\cmd.exe ERRORLEVEL The current ERRORLEVEL value, automatically set when a program exits. HOMEDRIVE C: HOMEPATH C:\\Users\\{username} LOCALAPPDATA C:\\Users\\{username}\\AppData\\Local LOGONSERVER \\\\{domain_logon_server} NUMBER_OF_PROCESSORS The Number of processors running on the machine. OS Operating system on the user's workstation. System C:\\Windows\\System32\\;C:\\Windows\\;C:\\Windows\\System32\\Wbem;{plus program paths} ProgramData C:\\ProgramData ProgramFiles C:\\Program Files or C:\\Program Files (x86) ProgramFiles(x86) 1 C:\\Program Files (x86) (but only available when running under a 64 bit OS) RANDOM A random integer number, anything from 0 to 32,767 (inclusive). %SessionName% Terminal servers only - for a terminal server session, SessionName is a combination of the connection name, followed by #SessionNumber. For a console session, SessionName returns \"Console\". SYSTEMDRIVE C: SYSTEMROOT By default, Windows is installed to C:\\Windows but there's no guarantee of that, Windows can be installed to a different folder, or a different drive letter. TEMP and TMP C:\\Users\\{Username}\\AppData\\Local\\Temp; Under XP this was C:\\{username}\\Local Settings\\Temp TIME The current time using same format as TIME. USERPROFILE %SystemDrive%\\Users{username}. This is equivalent to the $HOME environment variable in Unix/Linux WINDIR %windir% is a regular User variable and can be changed, which makes it less robust than %SystemRoot%; Set by default as windir=%SystemRoot% Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:39 "},"cheatsheet/windows/shell-folder.html":{"url":"cheatsheet/windows/shell-folder.html","title":"shell:folder","keywords":"","body":" Table of Contents generated with DocToc Usage List Usage win + r run> shell:startup List credit belongs to How to Open Hidden System Folders with Windows’ Shell Command Shell Commands to Access the Special Folders in Windows 10/8/7/Vista/XP Shell: folder shortcuts COMMANDS LOCATION shell:AccountPictures %AppData%\\Microsoft\\Windows\\AccountPictures shell:AddNewProgramsFolder Control Panel\\All Control Panel Items\\Get Programs shell:Administrative Tools %AppData%\\Microsoft\\Windows\\Start Menu\\Programs\\Administrative Tools shell:AppData %AppData% shell:Application Shortcuts %LocalAppData%\\Microsoft\\Windows\\Application Shortcuts shell:AppsFolder Applications shell:AppUpdatesFolder Installed Updates shell:Cache %LocalAppData%\\Microsoft\\Windows\\INetCache shell:Camera Roll %UserProfile%\\Pictures\\Camera Roll shell:CD Burning %LocalAppData%\\Microsoft\\Windows\\Burn\\Burn shell:ChangeRemoveProgramsFolder Control Panel\\All Control Panel Items\\Programs and Features shell:Common Administrative Tools %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Administrative Tools shell:Common AppData %ProgramData% shell:Common Desktop %Public%\\Desktop shell:Common Documents %Public%\\Documents shell:CommonDownloads %Public%\\Downloads shell:CommonMusic %Public%\\Music shell:CommonPictures %Public%\\Pictures shell:Common Programs %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs shell:CommonRingtones %ProgramData%\\Microsoft\\Windows\\Ringtones shell:Common Start Menu %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs shell:Common Startup %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup shell:Common Templates %ProgramData%\\Microsoft\\Windows\\Templates shell:CommonVideo %Public%\\Videos shell:ConflictFolder Control Panel\\All Control Panel Items\\Sync Center\\Conflicts shell:ConnectionsFolder Control Panel\\All Control Panel Items\\Network Connections shell:Contacts %UserProfile%\\Contacts shell:ControlPanelFolder Control Panel\\All Control Panel Items shell:Cookies %LocalAppData%\\Microsoft\\Windows\\INetCookies shell:Cookies\\Low %LocalAppData%\\Microsoft\\Windows\\INetCookies\\Low shell:CredentialManager %AppData%\\Microsoft\\Credentials shell:CryptoKeys %AppData%\\Microsoft\\Crypto shell:desktop Desktop shell:device Metadata Store %ProgramData%\\Microsoft\\Windows\\DeviceMetadataStore shell:documentsLibrary Libraries\\Documents shell:downloads %UserProfile%\\Downloads shell:dpapiKeys %AppData%\\Microsoft\\Protect shell:Favorites %UserProfile%\\Favorites shell:Fonts %WinDir%\\Fonts shell:Games Games shell:GameTasks %LocalAppData%\\Microsoft\\Windows\\GameExplorer shell:History %LocalAppData%\\Microsoft\\Windows\\History shell:HomeGroupCurrentUserFolder Homegroup\\{username} shell:HomeGroupFolder Homegroup shell:ImplicitAppShortcuts %AppData%\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\ImplicitAppShortcuts shell:InternetFolder Internet Explorer shell:Libraries Libraries shell:Links %UserProfile%\\Links shell:Local AppData %LocalAppData% shell:LocalAppDataLow %UserProfile%\\AppData\\LocalLow shell:MusicLibrary Libraries\\Music shell:MyComputerFolder This PC shell:My Music %UserProfile%\\Music shell:My Pictures %UserProfile%\\Pictures shell:My Video %UserProfile%\\Videos shell:NetHood %AppData%\\Microsoft\\Windows\\Network Shortcuts shell:NetworkPlacesFolder Network shell:OneDrive OneDrive shell:OneDriveCameraRoll %UserProfile%\\OneDrive\\Pictures\\Camera Roll shell:OneDriveDocuments %UserProfile%\\OneDrive\\Documents shell:OneDriveMusic %UserProfile%\\OneDrive\\Music shell:OneDrivePictures %UserProfile%\\OneDrive\\Pictures shell:Personal %UserProfile%\\Documents shell:PicturesLibrary Libraries\\Pictures shell:PrintersFolder All Control Panel Items\\Printers shell:PrintHood %AppData%\\Microsoft\\Windows\\Printer Shortcuts shell:Profile %UserProfile% shell:ProgramFiles %ProgramFiles% shell:ProgramFilesCommon %ProgramFiles%\\Common Files shell:ProgramFilesCommonX64 %ProgramFiles%\\Common Files (64 bit Windows only) shell:ProgramFilesCommonX86 %ProgramFiles(x86)%\\Common Files (64 bit Windows only) shell:ProgramFilesX64 %ProgramFiles% (64 bit Windows only) shell:ProgramFilesX86 %ProgramFiles(x86)% (64 bit Windows only) shell:Programs %AppData%\\Microsoft\\Windows\\Start Menu\\Programs shell:Public %Public% shell:PublicAccountPictures %Public%\\AccountPictures shell:PublicGameTasks %ProgramData%\\Microsoft\\Windows\\GameExplorer shell:PublicLibraries %Public%\\Libraries shell:Quick Launch %AppData%\\Microsoft\\Internet Explorer\\Quick Launch shell:Recent %AppData%\\Microsoft\\Windows\\Recent shell:RecordedTVLibrary Libraries\\Recorded TV shell:RecycleBinFolder Recycle Bin shell:ResourceDir %WinDir%\\Resources shell:Ringtones %ProgramData%\\Microsoft\\Windows\\Ringtones shell:Roamed Tile Images %LocalAppData%\\Microsoft\\Windows\\RoamedTileImages shell:Roaming Tiles %AppData%\\Microsoft\\Windows\\RoamingTiles shell:SavedGames %UserProfile%\\Saved Games shell:Screenshots %UserProfile%\\Pictures\\Screenshots shell:Searches %UserProfile%\\Searches shell:SearchHistoryFolder %LocalAppData%\\Microsoft\\Windows\\ConnectedSearch\\History shell:SearchHomeFolder search ms: shell:SearchTemplatesFolder %LocalAppData%\\Microsoft\\Windows\\ConnectedSearch\\Templates shell:SendTo %AppData%\\Microsoft\\Windows\\SendTo shell:Start Menu %AppData%\\Microsoft\\Windows\\Start Menu shell:StartMenuAllPrograms StartMenuAllPrograms shell:Startup %AppData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup shell:SyncCenterFolder Control Panel\\All Control Panel Items\\Sync Center shell:SyncResultsFolder Control Panel\\All Control Panel Items\\Sync Center\\Sync Results shell:SyncSetupFolder Control Panel\\All Control Panel Items\\Sync Center\\Sync Setup shell:System %WinDir%\\System32 shell:SystemCertificates %AppData%\\Microsoft\\SystemCertificates shell:SystemX86 %WinDir%\\SysWOW64 shell:Templates %AppData%\\Microsoft\\Windows\\Templates shell:ThisPCDesktopFolder Desktop shell:UsersFilesFolder %UserProfile% shell:User Pinned %AppData%\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned shell:UserProfiles %HomeDrive%\\Users shell:UserProgramFiles %LocalAppData%\\Programs shell:UserProgramFilesCommon %LocalAppData%\\Programs\\Common shell:UsersLibrariesFolder Libraries shell:VideosLibrary Libraries\\Videos shell:Windows %WinDir% Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:38 "},"cheatsheet/character/character.html":{"url":"cheatsheet/character/character.html","title":"character","keywords":"","body":" Table of Contents generated with DocToc encryption base64 single line VS. multiple lines execute commands from file get line after the pattern get certain Line between 2 matched patterns awk sed working with empty line xargs multiple move subset of arguments sort all shell script by line number diff every git commit against its parent Running multiple commands with xargs convert row to column find cat config file in all .git folder find && tar tar all and extra in remote exec and sed find and rename find and exclude trim trim tailing chars remove leading & trailing whitespace search and replace replace with position fold check the params valid regex get URL insert new line write a file without indent space cat and reference: 10 Awk Tips, Tricks and Pitfalls FIND -EXEC VS. FIND | XARGS encryption base64 $ echo \"marslo\" | base64 -w0 bWFyc2xvCg== decryption$ echo \"bWFyc2xvCg==\" | base64 --decode marslo single line VS. multiple lines [!TIP] $ echo 'a b c' a b c xargs -n $ echo 'a b c' | xargs -n1 a b c $ echo {a..c}.{1..2} | xargs -n1 | xargs -I{} echo -{}- -a.1- -a.2- -b.1- -b.2- -c.1- -c.2- fmt $ echo 'a b c' | fmt -1 a b c $ echo {a..c}.{1..2} | fmt -1 | xargs -I{} echo -{}- -a.1- -a.2- -b.1- -b.2- -c.1- -c.2- awk $ echo 'a b c' | awk '{OFS=RS;$1=$1}1' a b c tr $ echo 'a b c' | tr -s ' ' '\\n' a b c printf $ printf '%s\\n' a b c a b c execute commands from file create files [!TIP] precondition $ cat a.txt a b c $ echo 'a b c' | xargs -n1 -t touch touch a touch b touch c $ echo 'a b c' | xargs -n1 -p touch touch a?...y touch b?...y touch c?...y -t, --verbose Print the command line on the standard error output before executing it. -p, --interactive Prompt the user about whether to run each command line and read a line from the terminal. Only run the command line if the response starts with `y' or `Y'. Implies -t. -I replace-str Replace occurrences of replace-str in the initial-arguments with names read from standard in- put. Also, unquoted blanks do not terminate input items; instead the separator is the new- line character. Implies -x and -L 1. get line after the pattern $ cat a.txt 1a 2b 3c * (2 lines after `^3c$`) 4d 5e 6f 7g awk $ cat a.txt | awk '$0==\"3c\"{getline; print; getline; print}' 4d 5e $ cat a.txt | awk '/3c/{getline; print; getline; print}' 4d 5e or $ cat a.txt | awk '/^3c$/ {s=NR;next} s && NR or $ cat a.txt | awk '{if(a-->0){print;next}} /3c/{a=2}' 4d 5e or get second column of next line of pattern $ awk '/my.company.com$/{getline; print}' ~/.marslo/.netrc login marslo $ awk '/my.company.com$/{getline; print $2}' ~/.marslo/.netrc marslo sed $ cat a.txt | sed -n '/3c/{n;p;n;p}' 4d 5e $ cat a.txt | sed -n '/3c/{N;p;n;p}' 3c 4d 5e get certain Line between 2 matched patterns reference: How to print lines between two patterns, inclusive or exclusive (in sed, AWK or Perl)? Print lines between PAT1 and PAT2 How to select lines between two marker patterns which may occur multiple times with awk/sed Print lines between (and excluding) two patterns $ cat a.txt 1a 2b 3c * (begining) 4d 5e 6f 7g 8h * (end) 9i 10j 11k awk include pattern$ cat a.txt | awk '/3c/,/8h/' 3c 4d 5e 6f 7g 8h sed don't include pattern $ cat a.txt | sed '1,/3c/d;/8h/,$d' 4d 5e 6f 7g $ cat a.txt | sed '/3c/,/8h/!d;//d' 4d 5e 6f 7g include the pattern $ cat a.txt | sed -n '/3c/,/8h/p' 3c 4d 5e 6f 7g 8h working with empty line $ cat a.txt 1a 2b 3c * (begining) 4d 5e 6f * (ending) 7g 8h 9i 10j 11k $ cat a.txt | sed -n '/3c/,/^$/p' 3c 4d 5e 6f xargs references: xargs Running multiple commands with xargs multiple move $ mkdir ~/backups $ find /path -type f -name '*~' -print0 | xargs -0 -I % cp -a % ~/backups # multiple cp $ find /path -type f -name '*~' -print0 | xargs -0 sh -c 'if [ $# -gt 0 ]; then cp -a \"$@\" ~/backup; fi' sh subset of arguments $ echo {0..9} | xargs -n 2 0 1 2 3 4 5 6 7 8 9 sort all shell script by line number Pipe xargs into find $ find . -name \"*.sh\" | xargs wc -l | sort -hr diff every git commit against its parent $ git log --format=\"%H %P\" | xargs -L 1 git diff Running multiple commands with xargs [!TIP] precondition: $ cat a.txt a b c 123 ###this is a comment $ myCommandWithDifferentQuotes=$(cat echo \"command 1: $@\"; echo 'will you do the fandango?'; echo \"command 2: $@\"; echo -> EOF -> ) $ or $ cat a.txt | xargs -I @@ bash -c \"$myCommandWithDifferentQuotes\" -- @@ or $ while read stuff; do echo \"command 1: $stuff\"; echo 'will you do the fandango?'; echo \"command 2: $stuff\"; echo done compress sub-folders $ find . -maxdepth 1 ! -path . -type d -print0 | xargs -0 -I @@ bash -c '{ \\ tar caf \"@@.tar.lzop\" \"@@\" \\ && echo Completed compressing directory \"@@\" ; \\ }' convert row to column awk '{ for (i=1; i result $ cat sample.txt job salary c++ 13 java 14 php 12 $ awk '{ for (i=1; i ping multiple ips $ cat a.txt 8.8.8.8 1.1.1.1 $ xargs -L1 -a a.txt /sbin/ping -c 1 PING 8.8.8.8 (8.8.8.8): 56 data bytes 64 bytes from 8.8.8.8: icmp_seq=0 ttl=44 time=82.868 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 packets received, 0.0% packet loss round-trip min/avg/max/stddev = 82.868/82.868/82.868/0.000 ms PING 1.1.1.1 (1.1.1.1): 56 data bytes 64 bytes from 1.1.1.1: icmp_seq=0 ttl=63 time=1.016 ms --- 1.1.1.1 ping statistics --- 1 packets transmitted, 1 packets received, 0.0% packet loss round-trip min/avg/max/stddev = 1.016/1.016/1.016/0.000 ms find reference: Everything CLI: FIND -EXEC VS. FIND | XARGS cat config file in all .git folder xargs && cat $ find . -type d -name '.git' -print0 | xargs -0 -I {} cat {}/config find && -exec $ find . -type d -name '.git' -exec cat {}/config \\; find && tar backup all config.xml in JENKINS_HOME $ find ${JENKINS_HOME}/jobs -maxdepth 2 -name config\\.xml -type f -print | tar czf ~/config.xml.tar.gz --files-from - back build history $ find ${JENKINS_HOME}/jobs -name builds -prune -o -type f -print | tar czf ~/m.tar.gz --files-from - tar all and extra in remote # ssh -C $ tar cf - . | ssh -C hostname \"cd ~/.marslo/test/; tar xvf -\" Warning: Permanently added '10.69.78.40' (ECDSA) to the list of known hosts. ./ ./temp/ ./a/ ./a/a.txt ./c/ ./b/ or # tar z-flag $ tar cfz - . | ssh hostname \"cd ~/.marslo/test/; tar xvzf -\" copy multiple files to remote server$ tar cvzf - -T list_of_filenames | ssh hostname tar xzf - exec and sed change bunches ip address$ find ${JENKINS_HOME}/jobs \\ -type f \\ -name \"config.xml\" \\ -maxdepth 2 \\ -exec sed -i 's/1.2.3./4.5.6./g' {} \\; -print find and rename $ find -iname \"*.sh\" -exec rename \"s/.sh$/.shell/\" {} \\; -print find and exclude $ find . -regextype posix-egrep -regex \".*\\.(js|vue|s?css|php|html|json)$\" -and -not -regex \".*/(node_modules|vendor)/.*\" or$ find . -regex-type posix-extended -regex \".*def/incoming.*|.*456/incoming.*\" -prune -o -print trim trim tailing chars str='1234567890' awk + rev $ echo $str | rev | cut -c4- | rev 1234567 ${var:: -x}) $ echo ${str:: -3} 1234567 remove leading & trailing whitespace $ str=\" aaaa bbbb \" $ echo \"$str\" | sed 's:^ *::; s: *$::' # i.e.: $ echo .$(echo \"$str\" | sed 's:^ *::; s: *$::'). .aaaa bbbb. remove all spaces $ echo .${str// }. .aaaabbbb. remove leading space(s) $ echo .${str##+([[:space:]])}. .aaaa bbbb . remove leading space(s) $ echo .${str%%+([[:space:]])}. . aaaa bbbb. search and replace reference: shellcheck SC2001 str='aa bb cc' ${variable//search/replace} $ shopt -s extglob $ echo ${str//+( )/|} aa|bb|cc or $ echo \"${str//+([[:blank:]])/|}\" aa|bb|cc sed # DO NOT USE \"${str}\" $ echo ${str} | sed 's: :|:g' aa|bb|cc or $ echo \"$str\" | sed 's:[ ][ ]*:|:g' aa|bb|cc # or $ echo \"$str\" | sed 's:\\s\\s*:|:g' aa|bb|cc echo \"${string:0:$(( position - 1 ))}${replacement}${string:position}\" # or $ sed 's:\\s\\s*:|:g' tr $ echo \"$str\" | tr -s ' ' '|' aa|bb|cc replace with position $ string=aaaaa $ replacement=b $ position=3 $ echo \"${string:0:$(( position - 1 ))}${replacement}${string:position}\" aabaa or $ echo \"${string:0:position-1}${replacement}${string:position}\" aabaa fold check the params valid available params should be contained by 'iwfabcem' # case insensitive param=$( tr '[:upper:]' '[:lower:]' regex get URL $ echo http://www.baidu.com | awk '{for(i=1;i insert new line insert right after the second match string originalexpectedDCR DCR DCRDCR DCR check DCR $ echo -e \"DCR\\nDCR\\nDCR\" |awk 'BEGIN {t=0}; { print }; /DCR/ { t++; if ( t==2) { print \"check\" } }' write a file without indent space $ sed -e 's:^\\s*::' > ~/file-without-indent-space.txt or$ sed -e 's:^\\s*::' > find.aql example$ sed -e 's:^\\s*::' cat and Here Documents: This type of redirection instructs the shell to read input from the current source until a line containing only delimiter (with no trailing blanks) is seen. All of the lines read up to that point are then used as the standard input for a command. The format of here-documents is: No parameter expansion, command substitution, arithmetic expansion, or pathname expansion is performed on word. If any characters in word are quoted, the delimiter is the result of quote removal on word, and the lines in the here-document are not expanded. If word is unquoted, all lines of the here-document are subjected to parameter expansion, command substitution, and arithmetic expansion. In the latter case, the character sequence \\ is ignored, and \\ must be used to quote the characters \\, $, and `. cat with specific character $ man tab ... -T, --show-tabs display TAB characters as ^I other references: Multi-line string with extra space (preserved indentation) Bash - Removing white space from indented multiline strings How to avoid heredoc expanding variables? [duplicate] $ cat -A sample.sh LANG=C tr a-z A-Z $ cat -A sample.sh LANG=C tr a-z A-Z Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:37 "},"cheatsheet/character/awk.html":{"url":"cheatsheet/character/awk.html","title":"awk","keywords":"","body":" Table of Contents generated with DocToc split print chars and length summary all user used memory (ps aux) calculate word count in a file remove non-duplicated lines show matched values references: awk printf split $ echo \"12:34:56\" | awk '{ len = split( $0, a, \":\" ) ; for( i=1; i print chars and length $ awk '{ for(i=1; i or using while$ while IFS= read -r line; do echo \"${line}: ${#line}\" done summary all user used memory (ps aux) $ awk '{sum += $1} END {print sum}' or$ ps -u marslo -o pcpu,pmem,pid,command | awk '{sum += $2} END {print sum}' calculate word count in a file $ or$ cat sample.txt | xargs -n1 echo | sort | uniq -c | awk '{print $2,$1}' | sort -gk2 or$ awk '{for(w=1;w remove non-duplicated lines pre-condition $ cat sample.txt | xargs a a b c d e e e f $ awk '{ print $1 }' sample.txt | sort | uniq -cd | sort -g or $ awk '{ arr[$1]++ } END { for (key in arr) { if ( arr[key] > 1 ){ print arr[key], key } } }' \\ sample.txt show only duplicated lines $ awk 'seen[$1]++' sample.txt show only non-duplicated lines$ awk '!seen[$1]++' sample.txt show matched values Comparison Operators Regular Expressions How to check the checksum through commandline? find distrib name from /etc/lsb-release $ awk -F= '$1 == \"DISTRIB_ID\" {print $2;}' /etc/lsb-release Ubuntu # or $ awk -F= '$1==\"ID\" {print $2;}' /etc/os-release ubuntu find multiple matches $ awk -F= '$1 ~ /DISTRIB_ID|DISTRIB_RELEASE/ {print $2;}' /etc/lsb-release Ubuntu 18.04 return true or false according to matches result $ standard='2cf1b1652a5b268ec80717ef33fef111' $ md5sum ~/.bashrc | awk '$1 != \"${standard}\" {exit 1}' # or $ md5sum ~/.bashrc | awk '$1 == \"${standard}\" {print \"true\"}' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:37 "},"cheatsheet/character/sed.html":{"url":"cheatsheet/character/sed.html","title":"sed","keywords":"","body":" Table of Contents generated with DocToc execute multiple sed commands range print delete substitute get matched pattern execute multiple sed commands -e command Append the editing commands specified by the command argument to the list of commands. example : show only root and nobody in /etc/passwd -e : $ sed -n -e '/^root/p' -e '/^nobody/p' /etc/passwd nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false root:*:0:0:System Administrator:/var/root:/bin/sh '{}' : $ sed -n '{ /^root/p /^nobody/p }' /etc/passwd nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false root:*:0:0:System Administrator:/var/root:/bin/sh range specific line 2nd line : N range n~m lines : n,m n to end lines : n,$ m lines starting with n : n, +m start n skip m via ~ : pattern matches comments 1~2 1,3,5,7,... start frmo 1, print every 2 lines 2~2 2,4,6,8,... start from 2, print every 2 lines 1~3 1,4,7,10,... start from 1, print every 3 lines 2~3 2,5,8,11,... start from 2, print every 3 lines pattern matches range between pattern_1 to pattern_2 : /pattern_1/,/pattern_2/ print print all lines print every line twice$ sed 'p' employee.txt 101,John Doe,CEO 101,John Doe,CEO 102,Jason Smith,IT Manager 102,Jason Smith,IT Manager 103,Raj Reddy,Sysadmin 103,Raj Reddy,Sysadmin 104,Anand Ram,Developer 104,Anand Ram,Developer 105,Jane Miller,Sales Manager 105,Jane Miller,Sales Manager print all lines : $ sed -n 'p' employee.txt range print print the 2nd line : $ sed -n '2 p' employee.txt n,m range print 1~4 lines : $ sed -n '1,4 p' employee.txt print all lines since the 2nd line: $ sed -n '2,$ p' employee.txt ~ to skip lines print only odd numbered lines : sed -n '1~2 p' employee.txt + ( n, +m ) : sed -n 'n,+m p' employee.txt print matched pattern find pattern to the end :$ sed -n '/Raj/,$ p' employee.txt 103,Raj Reddy,Sysadmin 104,Anand Ram,Developer 105,Jane Miller,Sales Manager find pattern and line after the matches line : $ sed -n '/Raj/, +1 p' employee.txt 103,Raj Reddy,Sysadmin 104,Anand Ram,Developer find pattern to 4th line : $ sed -n '/Raj/,4 p' employee.txt 103,Raj Reddy,Sysadmin 104,Anand Ram,Developer find pattern until find another pattern ( Jason to Anand ) : $ sed -n '/Jason/,/Anand/p' employee.txt 102,Jason Smith,IT Manager 103,Raj Reddy,Sysadmin 104,Anand Ram,Developer delete delete all $ sed 'd' employee.txt range delete delete the 2nd line : $ sed '2 d' /path/to/file delete between 1 and 4 lines : $ sed '1,4 d' /path/to/file conditional delete delete all empty lines: $ sed '/^$/ d' /path/to/file delete all comment lines : $ sed '/^#/ d' /path/to/file substitute substitute-flags flag comments i ignore case flag g global flag 1,2,... number flag p print flag w write flag e execute flag multiple replaces $ sed '{ s/Developer/IT Manager/ s/Manager/Director/ }' employee.txt 101,John Doe,CEO 102,Jason Smith,IT Director 103,Raj Reddy,Sysadmin 104,Anand Ram,IT Director 105,Jane Miller,Sales Director get matched pattern & When & is used in the replacement-string, it replaces it with whatever text matched the original-string or the regular-expression. $ sed 's/^[0-9][0-9][0-9]//g' employee.txt ,John Doe,CEO ,Jason Smith,IT Manager ,Raj Reddy,Sysadmin ,Anand Ram,Developer ,Jane Miller,Sales Manager substitution grouping $ sed 's/^\\([0-9][0-9][0-9]\\).*//g' employee.txt or via -r $ sed -r 's/^([0-9][0-9][0-9]).*//g' employee.txt # or $ sed -nr 's/^([0-9][0-9][0-9])(.*)/\\2/gp' employee.txt ,John Doe,CEO ,Jason Smith,IT Manager ,Raj Reddy,Sysadmin ,Anand Ram,Developer ,Jane Miller,Sales Manager Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:37 "},"cheatsheet/character/markdown.html":{"url":"cheatsheet/character/markdown.html","title":"markdown","keywords":"","body":" Table of Contents generated with DocToc useful unicode Combining Diacritical Marks useful unicode reference HTML Symbols HTML Entities UTF-8 Greek and Coptic symbols unicode (HTML entity nubmer) entity Name desc   &#160; &nbsp; space &#60; &lt; less than > &#62; &gt; greater than « &#xab; &laquo; left-pointing double angle quotation mark » &#xbb; &raquo; right-pointing Double angle quotation mark › &#x203a; &rsaquo; right-pointing single guillemet ‹ &#x2039; &lsaquo; left-pointing single guillemet & &#38; &amp; ampersand | &#124; &#124; vertical bar ← &#8592; &larr; leftwards arrow → &#8594; &rarr; rightwards arrow ↑ &#8593; &uarr; upwards arrow ↓ &#8595; &darr; downwards arrow Combining Diacritical Marks mark unicode character construct result ̀ &#768; a +  ̀ » à a&#768; à ́ &#769; a +  ́ » á a&#769; á ̂ &#770; a +  ̂ » â a&#770; â ̃ &#771; a +  ̃ » ã a&#771; ã ̀ &#768; O +  ̀ » Ò O&#768; Ò ́ &#769; O +  ́ » Ó O&#769; Ó ̂ &#770; O +  ̂ » Ô O&#770; Ô ̃ &#771; O +  ̃ » Õ O&#771; Õ Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:36 "},"cheatsheet/character/json.html":{"url":"cheatsheet/character/json.html","title":"json","keywords":"","body":" Table of Contents generated with DocToc basic syntax for jq Dealing with json objects Slicing and Filtering join space in the key builtin operators debug select contains inside toUpperCase : ascii_upcase to_entries from_entries with_entries json online player: Online JSON Formatter & Validator jq online player: https://jqplay.org reference: jq manual (development version) Parsing JSON with jq olih/jq-cheetsheet.md Use jq to filter objects list with regex jq: Cannot iterate over number / string and number cannot be added Guide to Linux jq Command for JSON Processing Reshaping JSON with jq basic syntax for jq Syntax Description , Filters separated by a comma will produce multiple independent outputs ? Will ignores error if the type is unexpected [] Array construction {} Object construction + Concatenate or Add - Difference of sets or Substract length Size of selected element ⎮ Pipes are used to chain commands in a similar fashion than bash Dealing with json objects Description Command Display all keys jq 'keys' Adds + 1 to all items jq 'map_values(.+1)' Delete a key jq 'del(.foo)' Convert an object to array to_entries ⎮ map([.key, .value]) Slicing and Filtering Description Command All jq .[] First jq '.[0]' Range jq '.[2:4]' First 3 jq '.[:3]' Last 2 jq '.[-2:]' Before Last jq '.[-2]' Select array of int by value jq 'map(select(. >= 2))' Select array of objects by value jq '.[] ⎮ select(.id == \"second\")' Select by type jq '.[] ⎮ numbers' with type been arrays, objects, iterables, booleans, numbers, normals, finites, strings, nulls, values, scalars join to output multiple values on a single line join multiple values $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' | jq -r '[.some, .json] | join(\":\")' thing:like or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' | jq -r '[.some, .json] | \"\\(.[0]) \\(.[1])\"' thing like or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' | jq -r '[.some, .json] | \"\\(.[0]): \\(.[1])\"' thing: like or with reduce $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' | jq -r '[.some, .json] | reduce .[1:][] as $i (\"\\(.[0])\"; . + \",\\($i)\")' thing,like or$ echo '{ \"k1\": \"v1\", \"k2\": \"v2\", \"k3\": \"v3\", \"k4\": \"v4\" }' | jq -r '[.k1, .k2, .k3] | reduce .[1:][] as $i (\"\\(.[0])\"; . + \",\\($i)\")' v1,v2,v3 or with .first and .last $ echo '{ \"users\": [ { \"first\": \"Stevie\", \"last\": \"Wonder\" }, { \"first\": \"Michael\", \"last\": \"Jackson\" } ] }' | jq -r '.users[] | .first + \" \" + .last' Stevie Wonder Michael Jackson or$ echo '{ \"users\": [ { \"first\": \"Stevie\", \"last\": \"Wonder\" }, { \"first\": \"Michael\", \"last\": \"Jackson\" } ] }' | jq -r '.users[] | .first + \" \" + (.last|tostring)' or$ echo '{ \"users\": [ { \"first\": \"Stevie\", \"last\": \"Wonder\", \"number\": 1 }, { \"first\": \"Michael\", \"last\": \"Jackson\", \"number\": 2 } ] }' | jq -r '.users[] | .first + \" \" + (.number|tostring)' Stevie 1 Michael 2 space in the key $ echo '{ \"k1 name\": \"v1\", \"k2 name\": \"v2\", \"k3\": \"v3\", \"k4\": \"v4\" }' | jq -r '.\"k1 name\"' v1 builtin operators reference: jq manual - Builtin operators and functions debug without debug$ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"SECOND\", \"val\": 3}]''' | jq '.[] | select( .val == (2, 3) )' with debug:$ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"SECOND\", \"val\": 3}]''' | jq '.[] | select( .val == (2, 3) | debug )' [\"DEBUG:\",false] [\"DEBUG:\",false] [\"DEBUG:\",true] { \"id\": \"second\", \"val\": 2 } [\"DEBUG:\",false] [\"DEBUG:\",false] [\"DEBUG:\",true] { \"id\": \"SECOND\", \"val\": 3 } select refrence imarslo : example on jenkins api analysis imarslo : example on gerrit api analysis jq tips : remove emtpy line $ echo \"[1,5,3,0,7]\" | jq 'map(select(. >= 2))' [ 5, 3, 7 ] or $ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}]''' | jq '.[] | select(.id == \"second\")' { \"id\": \"second\", \"val\": 2 } contains reference: imarslo : example on artifactory api analysis imarslo : example on list Error pods in kuberetnes $ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"second-one\", \"val\": 3}]''' | jq '.[] | select( .id | contains(\"second\") )' { \"id\": \"second\", \"val\": 2 } { \"id\": \"second-one\", \"val\": 3 } by using test$ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"second.one\", \"val\": 3}]''' | jq '.[] | select( .id | test(\"sec*\") )' { \"id\": \"second\", \"val\": 2 } { \"id\": \"second.one\", \"val\": 3 } inside $ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"second-one\", \"val\": 3}]''' | jq '.[] | select( [.val] | inside([2,3]) )' { \"id\": \"second\", \"val\": 2 } { \"id\": \"second-one\", \"val\": 3 } or$ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"SECOND\", \"val\": 3}]''' | jq '.[] | select( .val == (2, 3) )' { \"id\": \"second\", \"val\": 2 } { \"id\": \"SECOND\", \"val\": 3 } toUpperCase : ascii_upcase $ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"SECOND\", \"val\": 3}]''' | jq '.[] | select(.id | ascii_upcase == \"SECOND\")' { \"id\": \"second\", \"val\": 2 } { \"id\": \"SECOND\", \"val\": 3 } to_entries $ echo '{\"a\": 1, \"b\": 2}' | jq -r to_entries [ { \"key\": \"a\", \"value\": 1 }, { \"key\": \"b\", \"value\": 2 } ] example to get key and value $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r 'to_entries[] | \"\\(.key)\\t\\(.value)\"' some thing json like or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r '[.some, .json] | @csv' \"thing\",\"like\" or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r '[.some, .json] | @tsv' thing like from_entries $ echo '[{\"key\":\"a\", \"value\":1}, {\"key\":\"b\", \"value\":2}]' | jq -r from_entries { \"a\": 1, \"b\": 2 } with_entries $ echo '{\"a\": 1, \"b\": 2}' | jq 'with_entries(.key |= \"KEY_\" + .)' { \"KEY_a\": 1, \"KEY_b\": 2 } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:37 "},"cheatsheet/character/regex.html":{"url":"cheatsheet/character/regex.html","title":"regex","keywords":"","body":" Table of Contents generated with DocToc matches if exits match any exclude keywords references: cheat-sheet for password crackers matches if exits samples: ✔️ keyword.baz.com ✔️ string-keyword.baz.com ✔️ keyword-staging.bar.com ✔️ keyword-staging.foo.com ^.*keyword(?:-staging)?\\.[^\\]+\\.com match any exclude keywords samples: ❌ foo-jenkins.domain.com ❌ foo-jenkins.domain.com/Monitor/ ❌ marslo.github.com ❌ 127.0.0.1 ^((?!.*\\-jenkins\\.[^\\.]+\\.com|.*Monitor/$|.*detail.*pipeline|.*api|marslo.github.*|shields.io|127.0.0.1|0.0.0.0|localhost).)*$ Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:37 "},"cheatsheet/havefun.html":{"url":"cheatsheet/havefun.html","title":"havefun","keywords":"","body":" Table of Contents generated with DocToc I'm very busy Press Any Key to Continue Simulate type mechine [Pretty Cool!!] Get how many days left this years Get week number DOS tree Set Volume by command cat and tac ASCII chart Char chart Hate someone Star war I'm very busy $ cat /dev/urandom | hexdump -C | grep \"ca fe\" Press Any Key to Continue $ read -sn 1 -p \"Press any key to continue...\" && echo \"\\n\" Press any key to continue...\\n Simulate type mechine [Pretty Cool!!] $ sudo apt-get intall pv $ echo \"Very very very very very long words\" | pv -qL $[10+(-2 + RANDOM%5)] # or $ sudo apt-get install randtype $ echo \"Very very very very very long words\" | randtype -m 4 Get how many days left this years $ echo \"There are $(($(date +%j -d\"Dec 31, $(date +%Y)\")-$(date +%j))) left in year $(date +%Y).\" There are 323 left in year 2014. Get week number $ date +\"%V\" 08 DOS tree $ find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g' . |____a_b |____b_a Set Volume by command $ pacmd set-sink-volume 0 0x10000 Welcome to PulseAudio! Use \"help\" for usage information. cat and tac $ cat a_b 1 2 3 $ tac a_b 3 2 1 ASCII chart $ figlet Marslo __ __ _ | \\/ | __ _ _ __ ___| | ___ | |\\/| |/ _` | '__/ __| |/ _ \\ | | | | (_| | | \\__ \\ | (_) | |_| |_|\\__,_|_| |___/_|\\___/ Char chart $ toilet marslo \"\"# mmmmm mmm m mm mmm # mmm # # # \" # #\" \" # \" # #\" \"# # # # m\"\"\"# # \"\"\"m # # # # # # \"mm\"# # \"mmm\" \"mm \"#m#\" Hate someone ┌─ (marslo@MarsloJiao ~) -> └─ $ :(){ :|: & };: Star war ┌─ (marslo@MarsloJiao ~) -> └─ $ telnet towel.blinkenlights.nl Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:38 "},"cheatsheet/media.html":{"url":"cheatsheet/media.html","title":"media","keywords":"","body":" Table of Contents generated with DocToc Highly Recommanded Video Get Audio from video Convert flv to mp4 convert png to mp4 scale the media(https://www.everythingcli.org/convert-pdf-to-mp4/) Combine video and audio Image convert webp to png identity an image convert svg to png convert HEIC/HEIF to PNG Highly Recommanded cmd.to Video Get Audio from video $ ffmpeg -i source.mpg -f s16le -acodec pcm_s16le audio.raw Convert flv to mp4 $ ffmpeg -i name.flv -qscale 0 name.mp4 convert png to mp4 options: pic-%02d.png: Read all images from the current folder with the prefix pic-, a following number of 2 digits (%02d) and an ending of .png -r 1/5 : Displays each image for 5 seconds r 30 : Output framerate of 30 fps. -c:v libx264 : Output video codec: h264 pix_fmt yuv420p : YUV pixel format $ ffmpeg -r 1/5 -i pic-%02d.png -c:v libx264 -r 30 -pix_fmt yuv420p out.mp4 scale the media(https://www.everythingcli.org/convert-pdf-to-mp4/) $ ffmpeg -i out.mp4 -vf scale=-1:720 out_720p.mp4 convert to 5 mins (300 sec) $ ffmpeg -i name.mp4 -ss 0 -t 300 name-5m.mp4 sequence convert (every 5 mins ~> 300 secs) first 5 mins (0 ~> 300)$ ffmpeg -i name.mp4 -ss 0 -t 300 name-5m-1.mp4 second 5 mins (300*1 ~> 300)$ ffmpeg -i name.mp4 -ss 300 -t 300 name-5m-2.mp4 third 5 mins (300*2 ~> 300)$ ffmpeg -i name.mp4 -ss 600 -t 300 name-5m-3.mp4 convert pdf to png -density 400 : Set the horizontal resolution of the image $ convert -density 400 input.pdf pic.png Combine video and audio $ ffmpeg -i -i -c copy -map 0:0 -map 1:0 -shortest Image convert webp to png $ ffmpeg -i file.webp out.png for multiple images$ for x in ls *.webp; do ffmpeg -i \"$x\" \"${x%.webp}.jpg\" done identity an image $ identify arms009.jpg | grep -o \"[[:digit:]]*x[[:digit:]]*\" | tail -1 1024x768 convert svg to png $ qlmanage -t -s 1000 -o . k-1.svg convert HEIC/HEIF to PNG $ brew install imagemagick --with-libheif # for single convert $ magick convert [-monitor] .HEIC .png # for batch convert $ magick mogrify [-monitor] -format png *.HEIC. Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:38 "},"cheatsheet/osx.html":{"url":"cheatsheet/osx.html","title":"osx","keywords":"","body":" Table of Contents generated with DocToc system information Get OSX Info Reboot if system freezed Setup HostName and LocalHostname Setup Bash as default SHELL Disable Guest User Go to Hidden path in Finder ReIndex Spotilght copy STDOUT into clipboard Copy path from finder System Integrity Protection change Mac default settings development environment Setup JAVA_HOME xCode Homebrew system settings accessory QnA x86_64 liblzma.dylib in nokogiri Reference system information Get OSX Info $ sw_vers ProductName: Mac OS X ProductVersion: 10.15.6 BuildVersion: 19G73 $ /usr/sbin/system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Name: MacBook Pro Model Identifier: MacBookPro15,1 Processor Name: 6-Core Intel Core i7 Processor Speed: 2.2 GHz Number of Processors: 1 Total Number of Cores: 6 L2 Cache (per Core): 256 KB L3 Cache: 9 MB Hyper-Threading Technology: Enabled Memory: 16 GB Boot ROM Version: 1037.147.1.0.0 (iBridge: 17.16.16065.0.0,0) Serial Number (system): C02XFGWEJG5H Hardware UUID: 4EA008BF-9B36-5F1D-9151-AD4F64808AAB Activation Lock Status: Enabled get CPU information $ sysctl -n machdep.cpu.brand_string Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz # or $ sysctl machdep.cpu machdep.cpu.max_basic: 22 machdep.cpu.max_ext: 2147483656 machdep.cpu.vendor: GenuineIntel machdep.cpu.brand_string: Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz machdep.cpu.family: 6 ... get more details $ sysctl -a Reboot if system freezed $ sudo systemsetup -setrestartfreeze on Setup HostName and LocalHostname $ sudo scutil --set HostName [HOSTNAME] $ sudo scutil --set LocalHostName [HOSTNAME] $ sudo scutil --set ComputerName [HOSTNAME] # Optional $ dscacheutil -flushcache # Flush the DNS Cache $ sudo shutdown -r now Setup Bash as default SHELL $ chsh -s /bin/bash # OR $ chsh -s `which bash` Disable Guest User $ dscl . delete /Users/Guest $ sudo defaults write /Library/Preferences/com.apple.AppleFileServer guestAccess -bool NO $ sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server AllowGuestAccess -bool NO Go to Hidden path in Finder Command+Shift+G ReIndex Spotilght $ sudo mdutil -i on / $ sudo mdutil -E / $ sudo mdutil -E /Volumes/marslo/ copy STDOUT into clipboard refer to: osx/tricky Copy path from finder refer to: osx/tricky System Integrity Protection refer to: osx/tricky change Mac default settings refer to: osx/defaults development environment Setup JAVA_HOME $ /usr/libexec/java_home -v 1.8.0.162 -exec javac -versioin xCode refer to osx xCode installation Install from App Store Offline Package xCode 9.0.1 Command_Line_Tools_macOS_10.13_for_Xcode_9.0.1 All Packages more details xCode Setup $ sudo xcodebuild -license [accept] xCode CommandLine Tools Verify installed or not $ xcode-select -p xCode CommandLine tools Installation $ xcode-select --install xcode-select: note: install requested for command line developer tools upgrade CommandLine tools $ softwareupdate --all --install --force or $ sudo rm -rf /Library/Developer/CommandLineTools $ sudo xcode-select --install xcode Components Installation $ for pkg in /Applications/Xcode.app/Contents/Resources/Packages/*.pkg; do > sudo installer -pkg \"$pkg\" -target /; > done example: $ ls -altrh /Applications/Xcode.app/Contents/Resources/Packages/ total 180512 -rw-r--r-- 1 root wheel 87K Mar 10 2017 MobileDeviceDevelopment.pkg -rw-r--r-- 1 root wheel 5.4M Sep 30 05:28 XcodeSystemResources.pkg -rw-r--r-- 1 root wheel 11K Sep 30 05:28 XcodeExtensionSupport.pkg -rw-r--r-- 1 root wheel 83M Sep 30 05:28 MobileDevice.pkg drwxr-xr-x 6 root wheel 204B Oct 11 05:23 ./ drwxr-xr-x 87 root wheel 2.9K Oct 11 05:55 ../ $ for pkg in /Applications/Xcode.app/Contents/Resources/Packages/*.pkg; do -> sudo installer -pkg \"$pkg\" -target /; -> done installer: Package name is MobileDevice installer: Upgrading at base path / installer: The upgrade was successful. installer: Package name is MobileDeviceDevelopment installer: Installing at base path / installer: The install was successful. installer: Package name is XcodeExtensionSupport installer: Installing at base path / installer: The install was successful. installer: Package name is XcodeSystemResources installer: Installing at base path / installer: The install was successful. Enable Developer Mode $ DevToolsSecurity -enable show SDK path $ xcrun --show-sdk-path /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk Homebrew refer to: osx/apps.md system settings refer to: osx/apps accessory refer to: osx/apps QnA x86_64 liblzma.dylib in nokogiri Solution 1: $ brew unlink xz $ gem install nokogiri # or gem install cupertino $ brew link xz Solutioin 2 (using system libraies): $ brew install libxml2 $ gem install nokogiri -- --use-system-libraries --with-xml2-include=$(brew --prefix libxml2)/include/libxml2 or $ bundle config build.nokogiri --use-system-libraries --with-xml2-include=$(brew --prefix libxml2)/include/libxml2 $ bundle install or $ brew link --force libxml2 $ gem install nokogiri -v '1.7.0.1' -- --use-system-libraries --with-xml2-include=/usr/include/libxml2 --with-xml2-lib=/usr/lib Reference osx chflags man page Show Hidden Files in Mac OS X Mac Keyboard Shortcuts How to reinstall macOS How to Find the Wi-Fi Password of your Current Network How to Find Wi-Fi Network Passwords from Command Line on Mac 5 Stupid Terminal Tricks to Keep You Entertained Install Nokogiri OSX实用命令 Locking files and folders to prevent changes Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:36 "},"cheatsheet/ssl/ssl.html":{"url":"cheatsheet/ssl/ssl.html","title":"ssl","keywords":"","body":" Table of Contents generated with DocToc SSL Cert create cert for server ca (root cert) cert for server (csr) generate cert for client (cert) and singed by CA Update the file perm verify certificate in Nginx get remote server certs keytool openssl cheatsheet generate private key and csr generate a self-signed certificate check ssl certificate check who has issued the ssl certificate check whom the ssl certificate is issued to check for what dates the ssl certificate is valid show multiple informations show fingerprint extract all information from the ssl certificate (decoded) show the ssl certificate check ssl certificate expiration date verifying the keys match manage certificate in OS (client) OSX add search remove others Windows Linux ubuntu Artifactory HTTPS reference: * cheatsheet: Check SSL Certificate with OpenSSL * cheatsheet: Check SSL Certificate Chain with OpenSSL Examples Understanding X509 Certificate with Openssl Command Protect the Docker daemon socket generating SSL Certificates sethvargo/create-certs.sh How can I add a private key to my keychain? Kubernetes Authentication and Authorization with X509 client certificates SSL Cert create cert for server ca (root cert) commandmore details$ openssl genrsa -aes256 -out ca.key 2048 $ openssl req -new \\ -x509 \\ -sha256 \\ -days 365 \\ -key ca.key \\ -out ca.crt \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com\"$ openssl genrsa -aes256 -out ca.key 2048 Generating RSA private key, 2048 bit long modulus ....................................................................+++ ...................................................+++ unable to write 'random state' e is 65537 (0x10001) Enter pass phrase for ca.key:artifactory Verifying - Enter pass phrase for ca.key:artifactory $ openssl req -new \\ -x509 \\ -sha256 \\ -days 365 \\ -key ca.key \\ -out ca.crt \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" Enter pass phrase for ca.key:artifactory cert for server (csr) commandmore details$ openssl genrsa -out server.key 2048 $ openssl req -new\\ -sha256 \\ -key server.key \\ -out server.csr \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\"$ openssl genrsa -out server.key 2048 Generating RSA private key, 2048 bit long modulus ......................................................................+++ ............................................................................................................................................................................................................................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req -new \\ -sha256 \\ -key server.key \\ -out server.csr \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" sign the server cert with CA commandmore details$ echo subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -CAcreateserial \\ -CA ca.crt \\ -CAkey ca.key \\ -in server.csr \\ -out server.crt \\ -extfile extfile.cnf$ echo subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -CAcreateserial \\ -CA ca.crt \\ -CAkey ca.key \\ -in server.csr \\ -out server.crt \\ -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Getting CA Private Key Enter pass phrase for ca.key:artifactory unable to write 'random state' $ ls extfile.cnf ca.key server.csr www.srl ca.crt server.crt server.key generate cert for client (cert) and singed by CA commandmore details$ openssl genrsa -out client.key $ openssl req -new \\ -key client.key \\ -out client.csr \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -CAcreateserial \\ -CA ca.crt \\ -CAkey ca.key \\ -in client.csr \\ -out client.cert \\ -extfile extfile.cnf$ openssl genrsa -out client.key 2048 Generating RSA private key, 2048 bit long modulus ................................................+++ .......................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req -new \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" \\ -key client.key \\ -out client.csr $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ cat extfile.cnf subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 gxtendedKeyUsage = serverAuth extendedKeyUsage = clientAuth $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -CAcreateserial \\ -CA ca.crt \\ -CAkey ca.key \\ -in client.csr \\ -out client.cert \\ -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Getting CA Private Key Enter pass phrase for ca.key:artifactor unable to write 'random state' Update the file perm $ sudo chmod -v 0444 ca.crt \\ server.crt \\ client.cert $ sudo chmod -v 0400 ca.key \\ client.key \\ server.key verify crt commandopenssl x509 ca.crtopenssl x509 server.crt$ openssl x509 -noout \\ -text \\ -in server.crt$ openssl x509 -noout \\ -text \\ -in ca.crt Certificate: Data: Version: 3 (0x2) Serial Number: 15145698426239402702 (0xd23054792b3142ce) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Validity Not Before: Jan 2 11:35:31 2018 GMT Not After : Jan 2 11:35:31 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:d0:3f:b6:c5:e5:52:8d:c7:26:3f:e7:0a:7a:5f: c1:71:2a:9e:34:07:7e:10:4a:3d:c4:4f:f7:df:58: 93:0d:fa:00:e8:21:75:6d:d1:45:7d:bd:27:f2:c5: 08:13:8f:4f:be:91:9f:28:19:7e:c3:a7:42:1b:fc: b4:96:21:8a:33:59:79:27:a3:cf:13:3e:cd:92:0d: 7e:b9:9f:0d:01:bf:27:5f:e4:7a:7d:db:69:a3:78: 96:a8:c3:a9:2d:31:28:97:ba:6c:20:17:ab:eb:85: ce:2c:25:e8:3e:a0:8b:c0:0b:b2:a9:e1:ac:9f:e1: 57:35:bb:64:6a:99:2e:8f:27:f1:04:40:a7:16:32: 31:4e:ad:18:5e:9e:0b:dd:42:17:af:8a:58:c6:1a: e9:00:52:97:7b:7a:24:cc:b1:81:8d:b9:20:60:e4: 96:d5:77:82:07:4e:df:9c:3a:26:95:d5:ed:aa:a1: 24:94:64:0e:93:9a:9e:9b:d4:78:6b:46:50:69:05: 19:6a:ff:7b:1d:1b:0f:ce:6b:30:33:c7:99:9d:6a: 30:0c:fc:f8:74:00:df:65:6f:fa:1b:24:0a:73:77: 4d:94:45:27:9b:93:a6:81:37:57:57:6f:e9:ae:e4: 5e:a8:b8:be:31:0f:73:4b:9e:1b:ed:78:5c:48:ec: 0b:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: IP Address:130.147.219.19 X509v3 Subject Key Identifier: 23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Authority Key Identifier: keyid:23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Basic Constraints: CA:TRUE Signature Algorithm: sha256WithRSAEncryption 69:a3:fe:35:63:a5:e8:4e:e6:3e:4f:9d:f6:82:3d:73:f2:a7: 22:c1:46:e5:09:5e:61:81:b7:70:3c:62:ba:43:7d:bd:ac:67: d0:41:ea:a7:b8:41:47:04:bc:41:9a:46:35:31:3f:62:10:7a: 58:73:45:3a:59:3b:41:6b:2b:1e:62:42:b7:7e:c1:6b:92:25: 2a:df:3f:69:b5:26:8e:c7:5d:c6:24:a0:65:21:b7:63:74:60: 7f:3b:0e:9a:80:a4:4f:a2:79:20:19:92:64:60:b7:53:5c:09: 6e:46:6e:7a:d7:ee:ef:f4:2e:27:7a:1a:0e:da:5b:8b:7a:bf: 40:56:9f:16:63:6b:89:ab:48:65:07:45:e0:a0:21:7c:0f:6d: 9c:2a:ab:ca:d0:02:06:8a:39:7a:ea:65:b9:04:13:0f:6b:cd: ea:e5:9f:59:c5:d2:06:b2:e4:c3:cb:ab:59:69:aa:11:e6:08: 49:12:cc:d4:29:21:2b:59:c1:dc:bb:e6:a9:7d:96:68:a4:7b: 61:76:8a:21:a9:69:a5:83:d5:8b:f6:08:4e:c0:34:64:6b:65: 96:ac:ed:cd:c1:0b:54:7d:a9:57:07:77:0c:6a:43:9e:4f:c0: 6c:12:88:e8:cf:34:08:67:af:1c:2f:bb:49:54:1b:17:95:89: b3:2d:c9:5f $ openssl x509 -noout \\ -text \\ -in server.crt Certificate: Data: Version: 3 (0x2) Serial Number: 12625600037876864867 (0xaf37245755cf1763) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Validity Not Before: Jan 2 11:39:47 2018 GMT Not After : Jan 2 11:39:47 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: DNS:www.artifactory.mycompany.com, IP Address:130.147.219.19 X509v3 Extended Key Usage: TLS Web Server Authentication Signature Algorithm: sha256WithRSAEncryption 3d:e8:81:f2:ab:89:47:e2:2c:8c:5a:54:31:c2:2a:11:37:e6: ab:89:ff:d1:c2:8c:8e:3a:7d:d2:1d:28:3e:9e:5f:9e:89:08: 78:2e:16:32:52:e7:35:ab:66:09:a4:83:85:42:55:d6:7c:4f: 37:cf:8d:37:bd:57:d0:00:f2:9c:67:68:a2:ed:49:c6:eb:0f: b7:49:ba:ae:12:35:82:a6:a5:b6:5e:f7:68:08:f7:3f:a1:73: d2:94:3e:7a:d9:5c:e1:e2:ab:12:46:66:9d:59:3a:e1:2d:aa: a6:53:97:40:ac:a3:ca:80:6d:5b:75:dc:c4:ee:10:48:55:2c: 10:00:43:07:e6:c4:16:09:fb:04:5d:78:8e:85:21:21:75:01: a5:af:c0:c0:d1:fd:33:6e:5b:24:8b:f8:e6:1c:df:b7:f1:e5: 38:02:d4:a8:e1:09:93:2e:8d:19:ea:e2:11:3f:c1:fe:75:bb: ef:03:6e:c3:50:77:a5:54:7d:7e:e0:cd:85:20:08:41:38:b2: 86:65:aa:58:51:1b:7b:ed:6a:07:0f:cc:ab:49:d8:34:ec:5d: fd:0d:75:48:81:3c:a5:bc:ce:c0:95:8c:8e:d3:8c:0f:0d:a3: a7:73:70:bc:59:89:7c:42:25:0b:cb:2f:b0:86:4a:46:56:f2: e9:d9:63:f1 csr commandopenss req$ openssl req -noout \\ -text \\ -in server.csr$ openssl req -noout \\ -text \\ -in server.csr Certificate Request: Data: Version: 0 (0x0) Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) Attributes: a0:00 Signature Algorithm: sha256WithRSAEncryption 74:99:e5:36:44:b4:48:a9:50:83:eb:61:02:37:6c:8a:46:45: 0e:58:04:40:66:55:56:fc:fd:cf:15:a0:31:be:de:3a:16:4f: 9a:46:1d:17:33:7f:38:dd:36:a9:76:e5:92:b2:48:29:60:e7: af:c0:f6:76:0d:9a:a6:40:43:a8:98:75:90:c3:c1:2a:7d:51: 1d:df:1b:50:8b:69:ce:7c:74:cf:03:9d:69:6b:41:7f:ed:bc: f1:6c:c0:93:22:36:5e:f7:8c:d0:f7:f5:0f:dc:51:93:1e:23: cc:12:cd:f3:0e:6c:1b:4e:b2:df:01:86:5b:d0:79:c8:6e:c8: 57:72:a8:dd:81:8a:af:c3:52:e2:ff:e8:f1:3d:6f:cb:e4:a9: 1c:51:58:b9:31:00:c0:88:5e:ca:63:59:f8:d7:82:d4:22:30: 0c:d8:bd:e6:01:11:d2:4a:68:64:d1:8e:d5:a1:19:0c:5a:99: 25:cd:c2:e5:ed:f3:48:e3:c0:7a:00:a3:a8:09:8e:d3:50:2a: 84:29:63:66:50:3e:42:af:43:ea:fa:5b:28:f9:f1:84:89:88: 2e:7f:8d:bf:44:29:83:fa:89:b3:b8:3c:13:98:20:76:6c:d3: 67:ce:03:9e:15:ea:3e:9d:4b:cb:c2:78:ab:57:1d:b7:e8:9e: 81:1b:b5:1f certificate in Nginx $ grep ssl_certificate /etc/nginx/sites-enabled/artifactoryv2.conf ssl_certificate /etc/nginx/certs/www.artifactory.mycompany.com/server.crt; ssl_certificate_key /etc/nginx/certs/www.artifactory.mycompany.com/server.key; get remote server certs [!TIP] references: *imarslo : get cert from domain * Checking A Remote Certificate Chain With OpenSSL Using openssl to get the certificate from a server SSL Certificate Verification keytool $ keytool -printcert \\ -rfc \\ -sslserver : \\ > cacert.crt check # convert to pem $ openssl x509 -inform PEM -in cacert.crt -out outcert.pem -text # or $ openssl x509 \\ -in cacert.crt \\ -noout \\ -text openssl $ echo | openssl s_client -showcerts \\ -servername \\ -connect : 2>/dev/null | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' \\ > cacert.crt check$ keytool -printcert \\ -v \\ -file cacert.crt cheatsheet generate private key and csr $ openssl genrsa -out privateKey.key 2048 $ openssl req -new -key privateKey.key -out CSR.csr # or $ openssl req -out CSR.csr \\ -new -newkey rsa:2048 \\ -nodes \\ -keyout privateKey.key \\ -subj \"/C=US/ST=Florida/L=Saint Petersburg/O=Your Company, Inc./OU=IT/CN=yourdomain.com\" need to input the following info to generate CSR : Country Name: 2-digit country code where our organization is legally located. State/Province: Write the full name of the state where the organization is legally located. City: Write the full name of the city where our organization is legally located. Organization Name: Write the legal name of our organization. Organization Unit: Name of the department Common Name: Fully Qualified Domain Name generate a self-signed certificate $ openssl req -x509 \\ -sha256 \\ -nodes \\ -days 365 \\ -newkey rsa:2048 \\ -keyout privateKey.key \\ -out certificate.crt check ssl certificate check private key info$ openssl rsa -text \\ -in privateKey.key \\ -noout check csr info$ openssl req -text \\ -in CSR.csr \\ -noout view ssl certificate info$ openssl x509 -text \\ -in certificate.crt \\ -noout check who has issued the ssl certificate $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -issuer check whom the ssl certificate is issued to $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -subject check for what dates the ssl certificate is valid $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -dates notBefore=Sep 8 00:00:00 2021 GMT notAfter=Aug 18 23:59:59 2022 GMT show multiple informations $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -dates -subject -issuer show fingerprint $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -fingerprint extract all information from the ssl certificate (decoded) $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -text show the ssl certificate $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -----BEGIN CERTIFICATE----- ... -----END CERTIFICATE----- check ssl certificate expiration date $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -dates # or $ openssl x509 -enddate -noout -in /path/to/name.pem verifying the keys match $ openssl pkey -pubout -in privateKey.key | openssl sha256 # or $ openssl req -pubkey -in CSR.csr -noout | openssl sha256 # or $ openssl x509 -pubkey -in certificate.crt -noout | openssl sha256 manage certificate in OS (client) OSX add $ sudo security add-trusted-cert -d \\ -r trustRoot \\ -k \"/Library/Keychains/System.keychain\" \\ \"/Users/marslo/Downloads/ca.crt\" search commandmore details$ security find-certificate -a -c -Z $ security find-certificate -a -c artifactor -Z | grep SHA-1 SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E $ security list-keychain \"/Users/marslo/Library/Keychains/login.keychain-db\" \"/Library/Keychains/System.keychain\"$ security find-certificate -a -c artifactor -Z SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E keychain: \"/Library/Keychains/System.keychain\" version: 256 class: 0x80001000 attributes: \"alis\"=\"marslo.jiao@mycompany.com\" \"cenc\"=0x00000003 \"ctyp\"=0x00000001 \"hpky\"=0x2332BC619E*** \"#2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"issu\"=0x3081A3310B*** \"0\\201\\..Sichuan1\\0200\\016\\..Chengdu1\\0200\\016\\..mycompany1\\0140\\012\\..CDI1(0&\\006\\..www.artifactory.mycompany.com1&0$\\006\\011*\\206H\\206\\..marslo.jiao@mycompany.com\" \"labl\"=\"www.artifactory.mycompany.com\" \"skid\"=0x2332BC619E*** \"#2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"snbr\"=0x00D2305479*** \"\\000\\3220Ty+1B\\316\" \"subj\"=0x3081A3310B*** \"0\\201\\..Sichuan1\\0200\\016\\..Chengdu1\\0200\\016\\..mycompany1\\0140\\012\\..CDI1(0&\\006\\..www.artifactory.mycompany.com1&0$\\006\\011*\\206H\\206\\..marslo.jiao@mycompany.com\" $ security find-certificate -a -c artifactor -Z -p -m SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E email addresses: marslo.jiao@mycompany.com -----BEGIN CERTIFICATE----- MIIELDCCAxSgAwIBAgIJANIwVHkrMULOMA0GCSqGSIb3DQEBCwUAMIGjMQswCQYD VQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdkdTEQMA4G A1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cuYXJ0aWZh Y3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJzbG8uamlh b0BwaGlsaXBzLmNvbTAeFw0xODAxMDIxMTM1MzFaFw0xOTAxMDIxMTM1MzFaMIGj MQswCQYDVQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdk dTEQMA4GA1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cu YXJ0aWZhY3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJz bG8uamlhb0BwaGlsaXBzLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC ggEBANA/tsXlUo3HJj/nCnpfwXEqnjQHfhBKPcRP999Ykw36AOghdW3RRX29J/LF CBOPT76RnygZfsOnQhv8tJYhijNZeSejzxM+zZINfrmfDQG/J1/ken3baaN4lqjD qS0xKJe6bCAXq+uFziwl6D6gi8ALsqnhrJ/hVzW7ZGqZLo8n8QRApxYyMU6tGF6e C91CF6+KWMYa6QBSl3t6JMyxgY25IGDkltV3ggdO35w6JpXV7aqhJJRkDpOanpvU eGtGUGkFGWr/ex0bD85rMDPHmZ1qMAz8+HQA32Vv+hskCnN3TZRFJ5uTpoE3V1dv 6a7kXqi4vjEPc0ueG+14XEjsC6UCAwEAAaNhMF8wDwYDVR0RBAgwBocEgpPbEzAd BgNVHQ4EFgQUIzK8YZ5RjpQiMFuuaIp+jlPSRXwwHwYDVR0jBBgwFoAUIzK8YZ5R jpQiMFuuaIp+jlPSRXwwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEA aaP+NWOl6E7mPk+d9oI9c/KnIsFG5QleYYG3cDxiukN9vaxn0EHqp7hBRwS8QZpG NTE/YhB6WHNFOlk7QWsrHmJCt37Ba5IlKt8/abUmjsddxiSgZSG3Y3RgfzsOmoCk T6J5IBmSZGC3U1wJbkZuetfu7/QuJ3oaDtpbi3q/QFafFmNriatIZQdF4KAhfA9t nCqrytACBoo5eupluQQTD2vN6uWfWcXSBrLkw8urWWmqEeYISRLM1CkhK1nB3Lvm qX2WaKR7YXaKIalppYPVi/YITsA0ZGtllqztzcELVH2pVwd3DGpDnk/AbBKI6M80 CGevHC+7SVQbF5WJsy3JXw== -----END CERTIFICATE----- remove $ sudo security delete-certificate -Z 915D019F0993F369C09D75C6B8DA201B8DE2636E others 1st: commandmore details$ cd /etc/nginx/ $ sudo openssl genrsa -des3 -out server.key 1024 $ sudo openssl req -new -key server.key -out server.csr $ sudo cp server.key{,.org} $ sudo cp server.csr{,.org} $ sudo openssl rsa -in server.key.org \\ -out server.key $ sudo openssl x509 -req \\ -days 365 \\ -signkey server.key \\ -in server.csr \\ -out server.crt$ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled $ sudo openssl genrsa -des3 -out server.key 1024 Generating RSA private key, 1024 bit long modulus .................................................................++++++ ......++++++ e is 65537 (0x10001) Enter pass phrase for server.key: artifactory Verifying - Enter pass phrase for server.key: artifactory $ sudo openssl req -new \\ -key server.key \\ -out server.csr Enter pass phrase for server.key: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Organizational Unit Name (eg, section) []:mycompany Common Name (e.g. server FQDN or YOUR name) []:docker-2.artifactory Email Address []:marslo.jiao@mycompany.com Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:artifactory An optional company name []:mycompany $ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled -rw-r--r-- 1 root root 951 Dec 26 18:32 server.key -rw-r--r-- 1 root root 785 Dec 26 18:36 server.csr -rw-r--r-- 1 root root 951 Dec 26 18:38 server.key.org -rw-r--r-- 1 root root 785 Dec 26 18:38 server.csr.org $ sudo openssl rsa \\ -in server.key.org \\ -out server.key Enter pass phrase for server.key.org: writing RSA key $ sudo openssl x509 -req \\ -days 365 \\ -signkey server.key \\ -in server.csr \\ -out server.crt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=mycompany/CN=docker-2.artifactory/emailAddress=marslo.jiao@mycompany.com Getting Private key 2nd: /etc/nginx$ sudo openssl req \\ -x509 \\ -nodes \\ -sha256 \\ -days 365 \\ -newkey rsa:2048 \\ -keyout certs/www.artifactory.mycompany.com.key \\ -out certs/www.artifactory.mycompany.com.crt Generating a 2048 bit RSA private key ........+++ ..............................................................+++ writing new private key to 'certs/www.artifactory.mycompany.com.key' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Organizational Unit Name (eg, section) []:mycompany Common Name (e.g. server FQDN or YOUR name) []:www.artifactory.mycompany.com Email Address []:marslo.jiao@mycompany.com 3rd: genreate key and cert by one command $ openssl req -new \\ -newkey rsa:2048 \\ -nodes \\ -out www_artifactory__mycompany_com.csr \\ -keyout www_artifactory__mycompany_com.key \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com\" Windows Linux ubuntu add $ sudo cp ca.crt /usr/local/share/ca-certificates/ $ ls -Altrh !$ ls -altrh /usr/local/share/ca-certificates/ total 12K -rw-r--r-- 1 root root 1.5K Jan 3 16:03 ca.crt $ sudo update-ca-certificates Updating certificates in /etc/ssl/certs... 1 added, 0 removed; done. Running hooks in /etc/ca-certificates/update.d... done. $ sudo systemctl restart docker.service remove$ sudo rm -rf /usr/local/share/ca-certificates/ca.crt $ sudo update-ca-certificates --fresh $ sudo systemctl restart docker.service Artifactory HTTPS commandSSL With DomainSSL with IP$ sudo openssl genrsa -des3 -out artifactorykey 2048 $ sudo openssl req -new -key artifactorykey -out artifactorycsr $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey $ sudo openssl x509 -req -days 365 -in artifactorycsr -signkey artifactorykey -out artifactorycrt$ sudo openssl genrsa -des3 -out artifactorykey 2048 Generating RSA private key, 2048 bit long modulus .........................+++ ........................................................................+++ e is 65537 (0x10001) Enter pass phrase for artifactorykey: artifactory Verifying - Enter pass phrase for artifactorykey: artifactory $ sudo openssl req -new -key artifactorykey -out artifactorycsr Enter pass phrase for artifactorykey: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Ltd Organizational Unit Name (eg, section) []:. Common Name (e.g. server FQDN or YOUR name) []:192.168.1.102 Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey Enter pass phrase for artifactorykey.org: artifactory writing RSA key $ sudo openssl x509 -req \\ -days 365 \\ -in artifactorycsr \\ -signkey artifactorykey \\ -out artifactorycrt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany Ltd/CN=192.168.1.102 Getting Private key $ openssl x509 -text \\ -noout \\ -in ssl_ip/artifactorycrt Certificate: Data: Version: 1 (0x0) Serial Number: 9804858425156156035 (0x8811daca106dba83) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, CN=192.168.1.102 Validity Not Before: Dec 26 16:23:15 2017 GMT Not After : Dec 26 16:23:15 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, CN=192.168.1.102 Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:ad:32:26:35:8a:8f:09:82:ff:59:61:14:14:1b: 9c:da:02:74:09:48:2a:d5:05:1d:ad:8a:d0:e0:70: 1f:9b:44:b4:df:4d:c5:4c:5a:1b:8a:52:7b:2a:69: a2:77:d3:cf:c7:fb:a6:ef:34:d1:bb:23:8d:d0:78: e6:48:3f:8c:12:3c:69:d5:62:2d:74:24:b8:49:a8: 59:c7:36:5f:64:97:5a:d1:8f:9a:5b:2f:aa:a8:65: 6c:75:28:60:55:b9:2a:5b:41:71:a4:fa:eb:10:7e: 84:4b:fb:c3:57:9c:55:8e:e8:2a:4a:c1:45:74:54: 58:d5:09:0d:59:d4:14:94:db:5b:67:91:9c:23:24: c4:07:10:d1:f1:28:fa:97:38:01:da:81:c4:f3:63: d7:84:24:dc:3c:ff:04:64:b2:3e:41:f0:d8:08:66: 06:cc:7c:05:3c:90:97:0b:02:b6:b5:2f:03:28:b7: 4c:38:aa:84:23:3e:9e:d4:b0:3a:58:4c:f3:74:df: 36:63:f2:18:ac:d1:0d:ef:05:6b:f3:dc:b6:d3:c7: f0:91:7b:b8:69:4f:ae:19:da:34:b7:38:1e:e2:9a: 10:2e:a9:a0:54:f6:61:b9:da:e6:98:c8:9b:76:83: d6:59:77:d9:18:c6:57:8c:cf:af:a4:89:5a:87:99: c4:15 Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption 5a:06:ad:9b:d0:07:d7:9b:92:2a:77:71:ff:80:6e:c1:39:bd: 81:e8:0f:21:39:bd:80:3e:96:a9:6b:7a:73:f1:80:70:4e:b1: d4:b7:1e:54:be:62:dc:35:c0:b9:d8:8c:d1:24:75:8a:42:ec: a9:dd:9b:9a:f2:4b:ad:6e:38:d7:a2:fa:7a:70:be:7b:8c:37: 63:71:10:fe:73:18:de:e5:9c:c5:6e:1a:4e:cb:7b:51:26:56: 68:56:fb:4f:71:d7:7b:94:b6:55:b9:f8:9b:31:a8:26:a5:e5: 32:36:33:65:7b:1d:9f:27:7d:f1:b0:d2:06:7c:75:d7:39:bb: 7a:44:92:e1:b8:fc:2b:fd:3c:43:93:d6:47:19:f6:ad:d3:cc: 82:dd:15:bd:d3:a0:e2:2d:92:fd:65:44:60:44:21:b9:1f:31: fd:91:c2:78:86:d9:aa:77:fd:54:ae:2f:4c:ae:5d:5e:c7:a3: 43:0d:6b:32:23:d9:61:b6:a7:c4:47:eb:bc:c2:79:6c:06:f0: a6:af:e8:45:c6:02:d5:1c:09:26:8a:a7:b0:ff:74:50:85:82: 1d:88:b2:2c:eb:20:3e:bf:3b:4e:9b:ab:b7:4f:e8:14:a8:1a: 33:50:e9:a8:24:3e:5e:2a:68:ea:fa:f3:12:30:94:8e:0f:0d: da:6c:17:60$ sudo openssl genrsa -des3 -out artifactorykey 2048 Generating RSA private key, 2048 bit long modulus ........................+++ .......................................+++ e is 65537 (0x10001) Enter pass phrase for artifactorykey: artifactory Verifying - Enter pass phrase for artifactorykey: artifactory $ sudo openssl req \\ -new \\ -key artifactorykey \\ -out artifactorycsr Enter pass phrase for artifactorykey: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Ltd Organizational Unit Name (eg, section) []:mycompany CDI Common Name (e.g. server FQDN or YOUR name) []:docker-1.artifactory Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactorykey{,.org} $ sudo openssl rsa \\ -in artifactorykey.org \\ -out artifactorykey Enter pass phrase for artifactorykey.org: artifactory writing RSA key $ sudo openssl x509 -req \\ -days 365 \\ -in artifactorycsr \\ -signkey artifactorykey \\ -out artifactorycrt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany Ltd/OU=mycompany CDI/CN=docker-1.artifactory Getting Private key $ openssl x509 -text -noout -in ssl/artifactorycrt Certificate: Data: Version: 1 (0x0) Serial Number: 15006671364169185053 (0xd0426818d254b71d) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, OU=mycompany CDI, CN=docker-1.artifactory Validity Not Before: Dec 26 16:02:10 2017 GMT Not After : Dec 26 16:02:10 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, OU=mycompany CDI, CN=docker-1.artifactory Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:dc:30:6b:83:56:92:fb:f3:fb:bc:da:3e:a9:5c: 67:c3:19:42:9a:8f:8f:30:e6:27:fa:a9:9d:c9:3e: 9c:31:3d:aa:d8:9f:ae:9b:64:b0:75:2a:01:51:ad: 04:c4:00:5d:f4:f8:b4:af:bb:20:f3:77:45:65:28: d8:38:28:b2:03:46:d0:67:d1:91:8e:7b:65:66:a0: 7e:a5:e2:fe:80:00:5e:54:95:50:52:9c:44:2a:aa: dc:a2:80:be:16:07:79:b4:13:1d:f5:8a:ca:c3:ab: 1c:76:de:f3:b8:23:9b:54:17:28:be:ac:e5:68:5c: f3:83:49:61:55:d2:e1:ea:0c:e7:72:75:6e:90:5a: 90:a8:85:01:c6:cc:69:94:5b:c4:f9:14:6d:70:0a: 8e:45:e0:b9:28:aa:99:3a:22:12:db:0b:d7:d9:6e: aa:35:36:5e:e6:00:eb:99:ab:46:6d:7b:e5:12:b1: f9:0c:5c:d3:c0:47:7b:b3:e4:03:15:fa:8d:42:f8: a1:c1:ce:dc:42:d2:81:88:18:0d:26:28:7e:90:cf: e8:05:84:75:94:e9:ac:20:47:95:c7:50:1c:d8:42: c3:d7:8b:90:f9:a9:48:cc:a5:8d:88:3b:54:a9:ef: 20:ce:ee:4c:6d:04:65:eb:6c:f7:22:9d:c8:13:33: b1:6d Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption c3:c7:c8:0d:19:d1:0b:05:ac:11:e3:e4:af:25:0e:95:f5:f5: 31:ed:90:4e:7f:1a:2b:a2:2f:4d:a3:d9:57:40:a2:f6:af:55: 90:53:bf:72:39:81:5d:53:41:85:e0:1d:26:9f:9e:33:05:46: 9c:fc:51:99:19:5c:7d:ef:aa:cc:50:61:0b:f4:11:69:bd:9e: 2a:34:48:e9:9d:7c:d0:e0:80:a5:42:67:ac:8e:0c:d6:84:19: 8e:cb:05:97:9f:21:c5:e0:78:8f:97:f6:53:fa:f2:ec:49:3f: fb:11:68:ed:ea:c0:8c:c5:be:08:61:e4:bd:4e:05:5f:89:99: f6:47:6f:b3:1e:5f:49:62:ff:37:dc:f0:c4:4b:bb:a4:15:06: b1:80:4d:24:ef:bb:25:d6:a5:60:13:34:57:73:ba:b4:b0:8b: 42:0f:18:ef:0e:17:60:83:4d:61:bd:ef:55:b9:52:6a:47:ab: c3:ee:b3:11:27:86:aa:87:18:d5:60:b8:b4:34:c2:fa:75:48: 0e:f1:f4:30:b3:fa:b3:ad:a9:8a:6e:e6:62:71:02:5a:72:bd: 5c:45:a0:23:ea:1d:84:16:24:3d:88:a0:12:20:61:7a:f8:bd: dc:0f:fb:26:c0:f3:2f:1f:66:7e:64:35:b6:45:05:c4:00:43: 2d:18:da:a1 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:36 "},"cheatsheet/ssl/keystore.html":{"url":"cheatsheet/ssl/keystore.html","title":"keystore","keywords":"","body":" Table of Contents generated with DocToc Keytool Options get cert from domain add crt into Java keystore generate a certificate create java keystore from cert file append to existing java keystore import an entire keystore into another keystore export items to cert file references: keytool - Key and Certificate Management Tool To Use keytool to Create a Server Certificate gencert importcert changealias Examples 5 Creating, Exporting, and Importing SSL Certificates To Generate a Certificate by Using keytool Error Importing SSL certificate : Not an X.509 Certificate generate key and certificate using keytool How to Creat JKS KeyStore file from existing private key and certificate How to Generate a Keystore and CSR Using the Keytool Command The Most Common Java Keytool Keystore Commands Error unable to find valid certification path Java Keytool - Create Keystore ARTIFACTORY: How to Resolve an “unable to find valid certification path to requested target” Error Working with Certificates and SSL Keytool Options KEYTOOL OPTIONS DESCRIPTION -delete Deletes an entry from the Keystore -exportcert Exports a certificate from a Keystore -genkeypair Generates a key pair -genseckey Generates a secret key pair -gencert Generates a certificate from a certificate request -importcert Import a certificate or a certificate chain to keystore -importpass Imports a password -importkeystore Imports one or all entries from another keystore to a keystore -keypasswd Changes the key password of an entry in keystore -list Lists entries in a keystore -printcert Prints the content of a certificate -printcertreq Prints the content of a certificate request -printcrl Prints the content of a CRL file -storepasswd Changes the store password of a keystore get cert from domain $ keytool -printcert \\ -rfc \\ -sslserver google.com:443 > google.com.new.crt check crt file$ openssl x509 \\ -in google.com.new.crt \\ -noout \\ -text | grep \"Not \" Not Before: Aug 30 01:36:08 2021 GMT Not After : Nov 22 01:36:07 2021 GMT or$ keytool -printcert \\ -v \\ -file google.com.new.crt | head Certificate[1]: Owner: CN=*.google.com Issuer: CN=GTS CA 1C3, O=Google Trust Services LLC, C=US Serial number: 1a46a5eeaea1c2610a00000000fcefe4 Valid from: Sun Aug 29 18:36:08 PDT 2021 until: Sun Nov 21 17:36:07 PST 2021 Certificate fingerprints: MD5: 58:83:A1:72:6A:FC:96:FD:18:BF:93:57:AD:64:BE:55 SHA1: 5D:F7:6F:AC:E9:D8:13:9F:68:E3:32:9C:42:CD:11:44:67:0A:E7:E6 SHA256: 03:FF:12:79:0E:57:B2:90:65:37:F2:5D:EA:62:A5:36:62:C6:1E:C0:2E:58:12:10:33:66:2D:49:2B:0C:3B:D5 Signature algorithm name: SHA256withRSA add crt into Java keystore [!TIP] imarslo : get remote server certs generate a certificate $ keytool -genkey \\ -alias google.com \\ -keyalg RSA \\ -keystore keystore.jks \\ -keysize 2048 create java keystore from cert file $ keytool -importcert \\ -alias google.com \\ -keystore google.com.jks \\ -storepass changeit \\ -file google.com.new.crt Trust this certificate? [no]: yes Certificate was added to keystore using -noprompt -trustcacerts will skip manual input yes for Trust this certificate verify $ keytool -list \\ [-v] \\ -keystore google.com.jks \\ -storepass changeit Keystore type: jks Keystore provider: SUN Your keystore contains 1 entry google.com, Sep 27, 2021, trustedCertEntry, Certificate fingerprint (SHA1): 5D:F7:6F:AC:E9:D8:13:9F:68:E3:32:9C:42:CD:11:44:67:0A:E7:E6 append to existing java keystore $ keytool -import \\ -noprompt \\ -trustcacerts \\ -alias google.com \\ -keystore google.com.new.jks \\ -file google.com.new.crt import an entire keystore into another keystore $ keytool -importkeystore -srckeystore key.jks -destkeystore NONE -srcstoretype JKS -deststoretype PKCS11 -srcstorepass -deststorepass import only single alias from keystore to another keystore$ keytool -importkeystore -srckeystore key.jks -destkeystore NONE -srcstoretype JKS -deststoretype PKCS11 -srcstorepass -deststorepass -srcalias myprivatekey -destalias myoldprivatekey -srckeypass -destkeypass -noprompt export items to cert file history: This command was named -export in previous releases. This old name is still supported in this release and will be supported in future releases, but for clarify the new name, -exportcert, is preferred going forward. $ keytool -export \\ -keystore google.com.jks \\ -alias google.com \\ -file google.com.crt Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:36 "},"cheatsheet/ssl/verification.html":{"url":"cheatsheet/ssl/verification.html","title":"verification","keywords":"","body":" Table of Contents generated with DocToc verify local cert s_client with cert debug curl openssl get crt information get csr information java ssl InstallCert.java verify remote cert openssl & s_client curl keytool nmap check in kubernetes certifactes as well verify local cert s_client $ openssl s_client -state -msg -connect my.server.com:443 with cert debug $ openssl s_client -state \\ -debug \\ -connect my.server.com:443 \\ -cert my.server.com-server.crt \\ -key my.server.com-server.key \\ curl $ curl -vvv \\ [--cacert server.crt \\] https://my.server.com:443/artifactory or$ curl -vvv \\ -i \\ -L \\ [--cacert server.crt \\] \\ https://my.server.com:443/artifactory openssl get crt information ca.crt $ openssl verify ca.crt or$ openssl x509 -noout -text -in ca.crt server.crt $ openssl x509 -inform PEM \\ -in server.crt \\ -text \\ -out certdata.pem get csr information $ openssl req -noout -text -in server.csr java ssl to add cert into Java for Java services (i.e.: Jenkins) reference: 4ndrej/SSLPoke.java bric3/SSLPoke.java klasen/sslpoke Test of java SSL / keystore / cert setup // SSLPoke.java import javax.net.ssl.SSLParameters; import javax.net.ssl.SSLSocket; import javax.net.ssl.SSLSocketFactory; import java.io.*; /** Establish a SSL connection to a host and port, writes a byte and * prints the response. See * http://confluence.atlassian.com/display/JIRA/Connecting+to+SSL+services */ public class SSLPoke { public static void main(String[] args) { if (args.length != 2) { System.out.println(\"Usage: \"+SSLPoke.class.getName()+\" \"); System.exit(1); } try { SSLSocketFactory sslsocketfactory = (SSLSocketFactory) SSLSocketFactory.getDefault(); SSLSocket sslsocket = (SSLSocket) sslsocketfactory.createSocket(args[0], Integer.parseInt(args[1])); SSLParameters sslparams = new SSLParameters(); sslparams.setEndpointIdentificationAlgorithm(\"HTTPS\"); sslsocket.setSSLParameters(sslparams); InputStream in = sslsocket.getInputStream(); OutputStream out = sslsocket.getOutputStream(); // Write a test byte to get a reaction :) out.write(1); while (in.available() > 0) { System.out.print(in.read()); } System.out.println(\"Successfully connected\"); } catch (Exception exception) { exception.printStackTrace(); System.exit(1); } } } extract cert from server:$ openssl s_client -connect server:443 negative test cert/keytool:$ java SSLPoke server 443 you should get something likejavax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target import cert into default keytool:$ keytool -import -alias alias.server.com -keystore $JAVA_HOME/jre/lib/security/cacerts positive test cert / keytool: java SSLPoke server 443 // you should get this: // Successfully connected import certificate into your local TrustStore -Djavax.net.ssl.trustStore will override the default truststore (cacerts). copy the default one and then add cert and set it via -Djavax.net.ssl.trustStore so default CA won't be lost. $ keytool -import \\ -trustcacerts \\ -storepass changeit \\ -file \"./class 1 root ca.cer\" \\ -alias C1_ROOT_CA \\ -keystore ./LocalTrustStore # use it in JAVA: $ java -Djavax.net.ssl.trustStore=./LocalTrustStore -jar SSLPoke.jar $HOST $PORT InstallCert.java reference: unable to find valid certification path to requested target compile first $ javac InstallCert.java Access server, and retrieve certificate (accept default certificate 1)$ java InstallCert [host]:[port] Extract certificate from created jssecacerts keystore$ keytool -exportcert -alias [host]-1 -keystore jssecacerts -storepass changeit -file [host].cer Import certificate into system keystore$ keytool -importcert -alias [host] -keystore [path to system keystore] -storepass changeit -file [host].cer verify remote cert reference: Checking A Remote Certificate Chain With OpenSSL How to extract SSL data from any website openssl & s_client $ openssl s_client -showcerts -connect www.domain.com:443 or $ echo | openssl s_client -showcerts \\ -servername www.domain.com \\ -connect www.domain.com:443 2>/dev/null | openssl x509 -inform pem -noout -text or $ openssl s_client -showcerts \\ -starttls imap \\ -connect www.domain.com:443 CONNECTED(00000005) or using local client cert for debug purpose $ openssl s_client -showcerts \\ -cert cert.cer \\ -key cert.key \\ -connect www.domain.com:443 or $ openssl s_client -connect www.domain.com:443 | openssl x509 -text -noout | grep -A 1 -i key or use specify acceptable ciphers for ssl handshake $ openssl s_client -showcerts \\ -cipher DHE-RSA-AES256-SHA \\ -connect www.domain.com:443 or get enddate only $ echo | openssl s_client \\ -connect www.domain.com:443 2>/dev/null | openssl x509 -noout -enddate notAfter=Nov 28 23:59:59 2020 GMT curl $ curl -vvI https://www.domain.com print ssl only$ curl --insecure \\ -vvI https://www.domain.com 2>&1 | awk 'BEGIN { cert=0 } /^\\* SSL connection/ { cert=1 } /^\\*/ { if (cert) print }' keytool $ keytool -printcert -sslserver www.domain.com:443 nmap $ nmap -p 443 --script ssl-cert www.domain.com [-v] Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:36 "},"cheatsheet/proxy.html":{"url":"cheatsheet/proxy.html","title":"proxy","keywords":"","body":" Table of Contents generated with DocToc proxy for bash proxy for curl proxy for yum proxy for apt proxy for docker proxy for pip proxy for ssh proxy for git proxy for npm proxy for ssl references: How to Use Netcat Commands: Examples and Cheat Sheets SSH Tunneling and Proxying bryanpkc/corkscrew nc / netcat gotoh/ssh-connect larryhou/connect-proxy proxy for bash # global settings $ cat /etc/bashrc export http_proxy=http://proxy.example.com:80/ export https_proxy=http://proxy.example.com:80/ # individual account settings $ cat ~/.bashrc export http_proxy=http://proxy.example.com:80/ export https_proxy=http://proxy.example.com:80/ proxy for curl $ curl -x http://proxy.example.com:80 to get head only$ curl -kvI -x http://proxy.example.com:80 proxy for yum $ cat /etc/yum.conf [main] proxy=http://proxy.example.com:80 proxy for apt [!TIP] imarlso : APT Configuration $ cat /etc/apt/apt.conf Acquire::http::Proxy \"http://proxy.example.com:80\"; Acquire::https::Proxy \"http://proxy.example.com:80\"; Acquire::ftp::Proxy \"http://proxy.example.com:80\"; proxy for docker [!TIP] details can be found in imarslo : docker proxy for docker build $ cat ~/.docker/config.json { \"proxies\": { \"default\": { \"httpProxy\": \"http://proxy.example.com:80\", \"httpsProxy\": \"http://proxy.example.com:80\" } } } or via cmd directly$ docker build \\ --build-arg http_proxy=http://proxy.example.com:80 \\ --build-arg https_proxy=http://proxy.example.com:443 \\ for docker pull # for rootless mode $ mkdir -p ~/.config/systemd/user/docker.service.d/ # or regular mode $ sudo mkdir -p /etc/systemd/system/docker.service.d $ sudo bash -c \"cat > /etc/systemd/system/docker.service.d\" proxy for pip [!TIP] MS Windows: %APPDATA%\\pip\\pip.ini MacOS: $HOME/Library/Application Support/pip/pip.conf Unix: $HOME/.config/pip/pip.conf setup via command line $ pip config set global.proxy http://proxy.example.com:80 using directly $ pip install --proxy http://proxy.example.com:80 git-review proxy for ssh nc $ ssh -vT \\ -o \"ProxyCommand=nc -X connect -x proxy.example.com:80 %h %p\" \\ -p 22 \\ ssh://remote.git.com # or $ ssh -vT \\ -o \"ProxyCommand=netcat -X connect -x proxy.example.com:80 %h %p\" \\ -p 22 \\ ssh://remote.git.com $ cat ~/.ssh/config Host github.com User my.account@mail.com ServerAliveInterval 60 Hostname ssh.github.com Port 443 ProxyCommand nc -X connect -x proxy.example.com:80 %h %p for socks5ProxyCommand nc -X 5 -x proxy.example.com:80 %h %p corkscrew $ brew install corkscrew $ ssh -vT \\ -o \"ProxyCommand=corkscrew proxy.example.com 80 %h %p\" \\ -p 22 \\ ssh://remote.git.com $ cat ~/.ssh/config Host github.com User my.account@mail.com ServerAliveInterval 60 Hostname ssh.github.com Port 443 ProxyCommand corkscrew proxy.example.com 80 %h %p ncat $ brew install nmap $ ssh -vT \\ -o \"ProxyCommand=ncat --proxy proxy.example.com:80 --proxy-type http %h %p\" \\ -p 22 \\ ssh://remote.git.com $ cat ~/.ssh/config Host github.com User my.account@mail.com ServerAliveInterval 60 Hostname ssh.github.com Port 443 ProxyCommand ncat --proxy proxy.example.com:80 --proxy-type http %h %p for socks5ProxyCommand ncat --proxy proxy.example.com:80 --proxy-type socks5 %h %p connect $ brew install connect $ ssh -vT \\ -o \"ProxyCommand=connect -H proxy.example.com:80 %h %p\" \\ -p 22 \\ ssh://remote.git.com $ cat ~/.ssh/config Host github.com User my.account@mail.com ServerAliveInterval 60 Hostname ssh.github.com Port 443 ProxyCommand connect -H proxy.example.com:80 %h %p for socks5ProxyCommand connect -S proxy.example.com:80 %h %p proxy for git $ git config --global https.proxy 'http://127.0.0.1:80' # using privoxy convert socks to http $ git config --global http.proxy 'http://127.0.0.1:80' or $ cat ~/.gitconfig [http] proxy = http://proxy.example.com:80 [https] proxy = http://proxy.example.com:80 [http \"https://chromium.googlesource.com\"] proxy = http://proxy.example.com:80 [http \"https://github.com\"] proxy = http://proxy.example.com:80 for socks5 $ git config --global socks.proxy \"proxy.example.com:80\" # or $ git config --global socks.proxy \"socks5://proxy.example.com:80\" additional usage $ cat ~/.gitconfig ... [url \"git@ssh.github.com\"] insteadOf = git@github.com [url \"git@ssh.github.com:\"] insteadOf = https://github.com/ [http] sslVerify = false postBuffer = 524288000 # sslVersion = tlsv1.1 # sslVersion = tlsv1.2 # sslVersion = tlsv1.3 ... proxy for npm references: npm config Is there a way to make npm install (the command) to work behind proxy? How to fix SSL certificate error when running Npm on Windows? $ npm config set proxy http://proxy.example.com:80/ $ npm config set https-proxy http://proxy.example.com:80/ $ npm config set noproxy '127.0.0.1,my.noproxy.com' # optional $ npm config set strict-ssl false or$ cat ~/.npmrc strict-ssl=false proxy=http://proxy.example.com:80/ https-proxy=http://proxy.example.com:80/ proxy for ssl [!TIP] HTTPS proxy Since version 7.52.0, curl can do HTTPS to the proxy separately from the connection to the server. This TLS connection is handled separately from the server connection so instead of --insecure and --cacert to control the certificate verification, you use --proxy-insecure and --proxy-cacert. With these options, you make sure that the TLS connection and the trust of the proxy can be kept totally separate from the TLS connection to the server. Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:39 "},"cheatsheet/curl.html":{"url":"cheatsheet/curl.html","title":"curl","keywords":"","body":" Table of Contents generated with DocToc get get JSON get XML get http_code or response_code get size_download get time post post JSON data using Curl post a file using Curl post form data using Curl post XML put send PUT request delete send a DELETE request authorization Basic Auth Credentials Bearer Token Authorization Header Curl with a proxy content type set the content type for a Curl request others ssl send http header with curl request set a timeout send a head request send a OPTIONS request send a CORS request send Cookies set the User-Agent string convert convert to python requests convert to javascript/ajax calls convert to php code convert to http request 12 Essential Curl Commands for Linux, Windows and macOS references Top 20 Curl Flags write-out references: online rest & soap api testing tool : curl get get JSON $ curl https://reqbin.com/echo/get/json \\ -H \"Accept: application/json\" get XML $ curl https://reqbin.com/echo/get/xml \\ -H \"Accept: application/xml\" get http_code or response_code $ curl -s -o /dev/null -w \"%{http_code}\" https://github.com 200 or$ curl -s -o /dev/null -w \"response: '%{response_code}'\" https://github.com response: '200' get size_download $ curl -R -s -S -w \"\\nhttp: %{http_code}. size: %{size_download}\\n\" -o /dev/null https://github.com get time $ curl -s \\ -w 'results: \\n Lookup time:\\t%{time_namelookup} Connect time:\\t%{time_connect} PreXfer time:\\t%{time_pretransfer} StartXfer time:\\t%{time_starttransfer} AppCon time:\\t%{time_appconnect} Redirect time:\\t%{time_redirect}\\n Total time:\\t%{time_total}\\n' \\ -o /deve/null \\ https://github.com results: Lookup time: 0.001288 Connect time: 0.001617 PreXfer time: 0.080264 StartXfer time: 0.119895 AppCon time: 0.080165 Redirect time: 0.000000 Total time: 0.120600 post post JSON data using Curl $ curl -X POST https://reqbin.com/echo/post/json \\ -H 'Content-Type: application/json' \\ -d '{\"login\":\"my_login\",\"password\":\"my_password\"}' post a file using Curl $ curl -d @data.json https://reqbin.com/echo/post/json post form data using Curl $ curl -X POST https://reqbin.com/echo/post/form \\ -H \"Content-Type: application/x-www-form-urlencoded\" \\ -d \"param1=value1&param2=value2\" post XML $ curl -X POST https://reqbin.com/echo/post/xml \\ -H \"Content-Type: application/xml\" \\ -H \"Accept: application/xml\" \\ -d \"my_loginmy_password\" put send PUT request $ curl -X PUT https://reqbin.com/echo/put/json \\ -d \"PUT request data\" delete syntax: $ curl -X DELETE [URL] [options] send a DELETE request $ curl -X DELETE http://reqbin.com/sample/delete/json?id=1 \\ -H \"Accept: application/json\" authorization Basic Auth Credentials $ curl https://reqbin.com/echo \\ -u \"login:password\" Bearer Token Authorization Header $ curl https://reqbin.com/echo/get/json \\ -H \"Accept: application/json\" \\ -H \"Authorization: Bearer {token}\" Curl with a proxy $ curl https://reqbin.com/echo \\ -x myproxy.com:8080 \\ -U login:password content type set the content type for a Curl request $ curl -X POST https://reqbin.com/echo/post/json \\ -H 'Content-Type: application/json' \\ -H 'Accept: application/json' \\ -d '{\"Id\": 78912, \"Quantity\": 1, \"Price\": 19.00}' others ssl ignore invalid and self-signed SSL certificate errors in Curl $ curl -k https://expired.badssl.com make HTTPS requests with Curl $ curl -k https://expired.badssl.com with SSL connections $ curl -k https://expired.badssl.com send http header with curl request $ curl https://reqbin.com/echo/get/json \\ -H \"X-Custom-Header: value\" \\ -H \"Content-Type: application/json\" set a timeout $ curl --connection-timeout 5 https://reqbin.com/echo send a head request $ curl -I https://reqbin.com/echo send a OPTIONS request $ curl https://api.reqbin.com/api/v1/requests \\ -X OPTIONS \\ -H \"Access-Control-Request-Method: POST\" \\ -H \"Access-Control-Request-Headers: content-type\" \\ -H \"Origin: https://reqbin.com\" send a CORS request $ curl -H \"Origin: https://example.reqbin.com\" \\ https://reqbin.com/echo send Cookies $ curl --cookie \"Name=Value\" https://reqbin.com/echo set the User-Agent string $ curl https://reqbin.com/echo \\ -A \"ReqBin Curl Client/1.0\" convert convert to python requests $ curl -X POST https://reqbin.com/echo/post/json \\ -H \"Content-Type: application/json\" \\ -d \"{\\\"login\\\":\\\"my_login\\\",\\\"password\\\":\\\"my_password\\\"}\" convert to javascript/ajax calls $ curl -X POST https://reqbin.com/echo/post/json \\ -H \"Content-Type: application/json\" \\ -d \"{\\\"login\\\":\\\"my_login\\\",\\\"password\\\":\\\"my_password\\\"}\" convert to php code $ curl -X POST https://reqbin.com/echo/post/json \\ -H \"Content-Type: application/json\" \\ -d \"{\\\"login\\\":\\\"my_login\\\",\\\"password\\\":\\\"my_password\\\"}\" convert to http request $ curl https://reqbin.com/echo/get/json \\ -H \"Content-Type: application/json\" \\ -H \"Accept: application/json\" 12 Essential Curl Commands for Linux, Windows and macOS get resource content by url$ curl https://reqbin.com/echo save url content to a file$ curl -o logo.png https://reqbin.com/static/img/logo.png download multiple files at once$ curl -O https://reqbin.com/static/img/code/curl.png \\ -O https://reqbin.com/static/img/code/java.png \\ -O https://reqbin.com/static/img/code/python.png check page http headers bash force curl to use http/2 protocol$ curl --http2 https://reqbin.com do follow redirects$ curl -L http://www.reqbin.com/echo use proxy server$ curl -x proxy.domain.com:8080 -U user:password https://reqbin.com provide additional http headers with request$ curl -H \"Accept: application/json\" https://reqbin.com/echo/get/json send data to the server$ curl -d '{\"id\": 123456}' \\ -H \"Content-Type: application/json\" \\ https://reqbin.com/echo/post/json change the user-agent string$ curl --user-agent \"MyAppName 1.0\" https://reqbin.com/echo send cookies to website$ curl -b \"name1=value1; name2=value2\" https://reqbin.com references Top 20 Curl Flags Flags Description Syntax -O Download the file and save it under the original name curl -O [URL] -o Download the file and save it with a different name curl -o [file name] [URL] -X Specify the HTTP method to be used when sending the request curl -X [method] [URL] -I or -head Print the title without the body of the document curl -I [URL] -d Specify the data to send to the server curl -d \"key1=value1&key2=value2\" [URL] -k or -insecure Ignore SSL Certificate Errors curl -k [URL] -u or --user Specify the authentication data by passing a pair of login-password curl -u [user:password] [URL] -F Submit form data as POST request curl -F @field_name=@path/to/myFile --cookie Send HTTP cookies curl --cookie \"Name=Value\" [URL] -x or --proxy Use a proxy server to upload files curl -x \"[protocol://][host][:port]\" [URL] [options] --limit-rate Limit the download speed curl --limit-rate [speed] -O [URL] -L or --location Follow Curl redirect using HTTP Location header curl -L [URL] -v Makes Curl verbose curl -v [URL] -m or --max-time Set a limit in seconds for the entire operation curl -m [SECONDS] [URL] --connect-timeout Set a limit in seconds for a connection request curl --connect-timeout [SECONDS] [URL] -T Transfers the specified local file to a remote URL curl -T [file name] [URL] -H or --header Add additional HTTP request header curl -H \"X-Header: value\" [URL] -D Save the HTTP headers that the site sends back curl -D [URL] -A or --user-agent Set User-Agent string curl -A \"value\" [URL] -C Resume an interrupted or intentionally stopped download curl -C [OFFSET] -O [URL] write-out Option Description Lookup time (time_namelookup) The time, in seconds, it took from the start until the name resolving was completed Connect time (time_connect) The time, in seconds, it took from the start until the TCP connect to the remote host was completed PreXfer time (time_pretransfer) The time, in seconds, it took from the start until the file transfer was just about to begin. This includes all ‘pre-transfer’ commands and negotiations that are specific to the particular protocol(s) involved StartXfer time (time_starttransfer) The time, in seconds, it took from the start until the first byte was just about to be transferred. This includes ‘time_pretransfer’ and also the time the server needed to calculate the result AppCon time (time_appconnect) The time, in seconds, it took from the start until the SSL/SSH/etc connect/handshake to the remote host was completed (Added in 7.19.0) Redirect time (time_redirect) The time, in seconds, it took for all redirection steps include name lookup, connect, pretransfer and transfer before the final transaction was started. ‘time_redirect’ shows the complete execution time for multiple redirections. (Added in 7.12.3) Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:37 "},"vim/vim.html":{"url":"vim/vim.html","title":"vim","keywords":"","body":" Table of Contents generated with DocToc check where vim executable package tricky Capitalize words and regions easily Switching case of characters reference: vim:tip Best Vim Tips Search for visually selected text check where vim executable package :echo v:progpath or :echo $VIM tricky List startup script files :scriptnames check customized completion :set completefunc? completefunc=youcompleteme#CompleteFunc show terminal type :TERM_PROGRAM iTerm.app show printable non-ASCII characters reference: VIM学习笔记 非可见字符(Listchars) \" for listchars :digraphs filetype in vim language if index(['vim', 'c', 'cpp'], &filetype) != -1 echom \"hello!\" endif or let fts = ['c', 'cpp'] if index(fts, &filetype) == -1 \" do stuff endif Capitalize words and regions easily shortcut comments gcw capitalize word (from cursor position to end of word) gcW capitalize WORD (from cursor position to end of WORD) gciw capitalize inner word (from start to end) gciW capitalize inner WORD (from start to end) gcis capitalize inner sentence gc$ capitalize until end of line (from cursor postition) gcgc capitalize whole line (from start to end) gcc capitalize whole line {Visual}gc capitalize highlighted text Switching case of characters lowercase allgu uppercase allgU reverse allg~ Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:13 "},"vim/tricky.html":{"url":"vim/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc combine multiple lines with or without space search (in)sensitive sort lines list all filetype run vim commands in terminal vim open file and go to specific function or linenumber Using vim as a man-page viewer under Unix newline \\r vim regex vim pattern run command in multiple buffers combine multiple lines with or without space with space: J without space: gJ search (in)sensitive reference: 7. Ignoring case in a pattern cmd ignorecase smartcase matches foo off - foo foo on - foo Foo FOO foo on on foo Foo FOO Foo on on Foo Foo on - foo Foo FOO \\cfoo - - foo Foo FOO foo\\C - - foo :set ignorecase :set smartcase /example \" Case insensitive /Example \" Case sensitive /example\\C \" Case sensitive /Example\\c \" Case insensitive search with \\V pattern result /a.k.a backward a.k.a /a\\.k\\.a backward a.k.a /Va.k.a backward a.k.a sort lines How to sort using visual blocks sort :{range}sort sort and unique :{range}sort u list all filetype :echo getcompletion('', 'filetype') or:echo getcompletion('c', 'filetype') or and use: for f in GetFiletypes() | echo f | endfor function! GetFiletypes() \" Get a list of all the runtime directories by taking the value of that \" option and splitting it using a comma as the separator. let rtps = split(&runtimepath, \",\") \" This will be the list of filetypes that the function returns let filetypes = [] \" Loop through each individual item in the list of runtime paths for rtp in rtps let syntax_dir = rtp . \"/syntax\" \" Check to see if there is a syntax directory in this runtimepath. if (isdirectory(syntax_dir)) \" Loop through each vimscript file in the syntax directory for syntax_file in split(glob(syntax_dir . \"/*.vim\"), \"\\n\") \" Add this file to the filetypes list with its everything \" except its name removed. call add(filetypes, fnamemodify(syntax_file, \":t:r\")) endfor endif endfor \" This removes any duplicates and returns the resulting list. \" NOTE: This might not be the best way to do this, suggestions are welcome. return uniq(sort(filetypes)) endfunction run vim commands in terminal $ man vim ... OPTIONS +{command} -c {command} {command} will be executed after the first file has been read. {command} is interpreted as an Ex command. If the {command} contains spaces it must be enclosed in double quotes (this depends on the shell that is used). Example: Vim \"+set si\" main.c Note: You can use up to 10 \"+\" or \"-c\" commands. --cmd {command} Like using \"-c\", but the command is executed just before processing any vimrc file. You can use up to 10 of these commands, independently from \"-c\" commands. $ vim -es -c \"set ff? | q\" fileformat=unix vim open file and go to specific function or linenumber $ vim +commandHere filename # or $ vim +linenumber filename without fold$ vim +linenumber filename -c 'normal zR' Using vim as a man-page viewer under Unix export PAGER=\"/bin/sh -c \\\"unset PAGER;col -b -x | \\ vim -R -c 'set ft=man nomod nolist' -c 'map q :q' \\ -c 'map ' -c 'map b ' \\ -c 'nmap K :Man =expand(\\\\\\\"\\\\\\\")' -\\\"\" additional highlight \" DrChip's additional man.vim stuff syn match manSectionHeading \"^\\s\\+[0-9]\\+\\.[0-9.]*\\s\\+[A-Z].*$\" contains=manSectionNumber syn match manSectionNumber \"^\\s\\+[0-9]\\+\\.[0-9]*\" contained syn region manDQString start='[^a-zA-Z\"]\"[^\", )]'lc=1 end='\"' contains=manSQString syn region manSQString start=\"[ \\t]'[^', )]\"lc=1 end=\"'\" syn region manSQString start=\"^'[^', )]\"lc=1 end=\"'\" syn region manBQString start=\"[^a-zA-Z`]`[^`, )]\"lc=1 end=\"[`']\" syn region manBQSQString start=\"``[^),']\" end=\"''\" syn match manBulletZone transparent \"^\\s\\+o\\s\" contains=manBullet syn case match syn keyword manBullet contained o syn match manBullet contained \"\\[+*]\" syn match manSubSectionStart \"^\\*\" skipwhite nextgroup=manSubSection syn match manSubSection \".*$\" contained hi link manSectionNumber Number hi link manDQString String hi link manSQString String hi link manBQString String hi link manBQSQString String hi link manBullet Special hi manSubSectionStart term=NONE cterm=NONE gui=NONE ctermfg=black ctermbg=black guifg=navyblue guibg=navyblue hi manSubSection term=underline cterm=underline gui=underline ctermfg=green guifg=green newline \\r reference: Why is \\r a newline for Vim? Vim documentation: pattern : \\n matches an end of line (newline) \\r matches a carriage return (more precisely it’s treated as the input CR)) vim regex vim pattern reference: magic overview of multi items pattern magic nomagic matches of the preceding atom /star * \\* 0 or more   (as many as possible) /\\+ \\+ \\+ 1 or more   (as many as possible) /\\= \\= \\= 0 or 1   (as many as possible) /\\? \\? \\? 0 or 1   (as many as possible) /\\{ \\{n,m} \\{n,m} n to m   (as many as possible) \\{n} \\{n} n   exactly \\{n,} \\{n,} at least n   (as many as possible) \\{,m} \\{,m} 0 to m   (as many as possible) \\{} \\{} 0 or more   (as many as possible. same as *) /\\{- \\{-n,m} \\{-n,m} n to m   (as few as possible) \\{-n} \\{-n} n    exactly \\{-n,} \\{-n,} at least n   (as few as possible) \\{-,m} \\{-,m} 0 to m   (as few as possible) \\{-} \\{-} 0 or more   (as few as possible) overview of ordinary atoms pattern magic nomagic matches /^ ^ ^ start-of-line (at start of pattern) /zero-width /\\^ \\^ \\^ literal '^' /\\_^ \\_^ \\_^ start-of-line (used anywhere) /zero-width /$ $ $ end-of-line (at end of pattern) /zero-width /\\$ \\$ \\$ literal '$' /\\_$ \\_$ \\_$ end-of-line (used anywhere) /zero-width /. . \\. any single character (not an end-of-line) /\\_. \\_. \\_. any single character or end-of-line /\\ \\ \\ beginning of a word /zero-width /\\> \\> \\> end of a word /zero-width /\\zs \\zs \\zs anything, sets start of match /\\ze \\ze \\ze anything, sets end of match /\\%^ \\%^ \\%^ beginning of file /zero-width E71 /\\%$ \\%$ \\%$ end of file /zero-width /\\%V \\%V \\%V inside Visual area /zero-width /\\%# \\%# \\%# cursor position /zero-width /\\%'m \\%'m \\%'m mark m position /zero-width /\\%l \\%23l \\%23l in line 23 /zero-width /\\%c \\%23c \\%23c in column 23 /zero-width /\\%v \\%23v \\%23v in virtual column 23 /zero-width matches the N pattern every 3rd \\(.\\{-}\\zsfoo\\)\\{3} the 3rd ^\\(.\\{-}\\zsPATTERN\\)\\{3} \\v: the following chars in the pattern are \"very magic\": ^\\(.\\{-}\\zsPATTERN\\)\\{N} == > \\v^(.{-}\\zsPATTERN){N} ^\\(.\\{-}\\zs=\\)\\{N} == > \\v^(.{-}\\zs\\=){N} NOTICE: after using \\v the = should using \\= instead run command in multiple buffers related commands: :argdo : all files in argument list :bufdo : all buffers :tabdo : all tabs :windo : all windows reference: Search and replace in multiple buffers :bufdo replace # regular :%s///ge # for all buffers :bufdo %s///ge | update force the bufdo to continue without saving files via :bufdo! Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:13 "},"vim/windows.html":{"url":"vim/windows.html","title":"windows","keywords":"","body":" Table of Contents generated with DocToc move between windows resize horizontal resize vertical resize quickfix reference: windows.txt move between windows commands shortcut :wincmd l ctrl + w ⇢ l :wincmd h ctrl + w ⇢ h :wincmd j ctrl + w ⇢ j :wincmd k ctrl + w ⇢ k resize reference: Resize splits more quickly maximium window: ctrl + w ⇢ _ horizontal resize :res is the shortcut of :resize commands or shortcut comments :res n setup the width to lines :resize -n reduce lines of the width :resize +n extend lines of the width ctrl + w ⇢ + extend 1 line :wincmd + extend 1 line ctrl + w ⇢ - reduce 1 line :wincmd - reduce 1 line ctrl + w ⇢ = resize to default: 50% :wincmd = resize to default: 50% ctrl + w ⇢ _ maximum the window :wincmd _ maximum the window vertical resize commands or shortcut comments :vertical res n setup the width to columns :vertical resize -n reduce columns of the width :vertical resize +n extend columns of the width ctrl + w ⇢ > extend 1 column :wincmd > extend 1 column ctrl + w ⇢ reduce 1 column :wincmd reduce 1 column ctrl + w ⇢ = resize to default: 50% :wincmd = resize to default: 50% ctrl + w ⇢ | maximum the window :wincmd ⎮ maximum the window quickfix Automatically fitting a quickfix window height\" .vimrc au FileType qf call AdjustWindowHeight(3, 10) function! AdjustWindowHeight(minheight, maxheight) exe max([min([line(\"$\"), a:maxheight]), a:minheight]) . \"wincmd _\" endfunction Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:14 "},"vim/plugins.html":{"url":"vim/plugins.html","title":"plugins","keywords":"","body":" Table of Contents generated with DocToc Tabularize including the align without align on first matche align with the N pattern align on specific symbol cheetsheet Tabularize Tabular cheatsheet specifier comments l left-align (with N spaces padding) r right-align (with N spaces padding) c center-align (with N spaces padding) :Tabularize /,/r1c1l0 means: splitting fields on commas (:) print everything before the first comma right aligned, then 1 space then the comma center aligned, then 1 space, then everything after the comma left aligned. including the align to left :Tabularize / or:Tabularize //l1 align to center :Tabularize //r1c1l0 align without help /zs :Tabularize /\\zs/ align on first matche align the first : :Tabularize /^[^:]*\\zs: or :Tabularize /:.* via vim cmd only for default left-alignemnt. Not support customized right/middle alignment. i.e.: /r1c1l0 command! -nargs=1 -range First exec . ',' . . 'Tabularize /^[^' . escape(, '\\^$.[?*~') . ']*\\zs' . escape(, '\\^$.[?*~') align with the N pattern i.e.: the second match (=) refer to matches the N pattern :Tabularize /^\\(.\\{-}\\zs=\\)\\{N}/ | `^` means start of the line or with \\v (very magic) reference: :help \\v vim pattern: overview of ordinary atoms :Tabularize /\\v^(.{-}\\zs\\=){N}/ for every N matches : Tabularize /\\(.\\{-}\\zs=\\)\\{N}/ | no `^` means every `{N}` matches or :Tabularize /\\v(.{-}\\zs\\=){N}/ align on specific symbol pre condition: align the first : and last matches , as below:[ isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , ] first : reference: via /^[^;]*\\zs: /^[^;]*\\zs:/r1c1l0 /^[^;]*/r1c1l0 /^[^:]*\\zs: isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , /^[^:]*\\zs/r1c1l0 isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , /^[^:]*\\zs:/r1c1l0 isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , /^[^:]*/r1c1l0 isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , /^[^:]*:/r1c1l0: isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , last , tips: actually the pattern not matches with the final ,, but matches with ) , sample code: isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , /)[^,]*\\zs, isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , or even better align :1,3Tabularize /, or :'Tabularize /, isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , :Tabularize /)[^,]*\\zs, isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , cheetsheet align with first space : /^\\s*\\S\\+\\zs/l0c1l0 align the second = to left : /^\\(.\\{-}\\zs=\\)\\{2}/l1l0 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:14 "},"devops/adminTools.html":{"url":"devops/adminTools.html","title":"devops","keywords":"","body":" Table of Contents generated with DocToc Network Tools Reference Network Tools vnstat $ vnstat -l 1 -i en7 Monitoring en7... (press CTRL-C to stop) rx: 4.10 kbit/s 21.00 KiB tx: 0 bit/s 6.00 KiB^C en7 / traffic statistics rx | tx --------------------------------------+------------------ bytes 21.00 KiB | 6.00 KiB --------------------------------------+------------------ max 53.25 kbit/s | 12.29 kbit/s average 17.20 kbit/s | 4.92 kbit/s min 0 bit/s | 0 bit/s --------------------------------------+------------------ packets 60 | 52 --------------------------------------+------------------ max 15 p/s | 16 p/s average 6 p/s | 5 p/s min 2 p/s | 0 p/s --------------------------------------+------------------ time 10 seconds ipcalc $ ipcalc 10.25.130.2/23 Address: 10.25.130.2 00001010.00011001.1000001 0.00000010 Netmask: 255.255.254.0 = 23 11111111.11111111.1111111 0.00000000 Wildcard: 0.0.1.255 00000000.00000000.0000000 1.11111111 => Network: 10.25.130.0/23 00001010.00011001.1000001 0.00000000 HostMin: 10.25.130.1 00001010.00011001.1000001 0.00000001 HostMax: 10.25.131.254 00001010.00011001.1000001 1.11111110 Broadcast: 10.25.131.255 00001010.00011001.1000001 1.11111111 Hosts/Net: 510 Class A, Private Internet $ ipcalc 10.25.131.1/23 Address: 10.25.131.1 00001010.00011001.1000001 1.00000001 Netmask: 255.255.254.0 = 23 11111111.11111111.1111111 0.00000000 Wildcard: 0.0.1.255 00000000.00000000.0000000 1.11111111 => Network: 10.25.130.0/23 00001010.00011001.1000001 0.00000000 HostMin: 10.25.130.1 00001010.00011001.1000001 0.00000001 HostMax: 10.25.131.254 00001010.00011001.1000001 1.11111110 Broadcast: 10.25.131.255 00001010.00011001.1000001 1.11111111 Hosts/Net: 510 Class A, Private Internet iostat $ iostat disk0 cpu load average KB/t tps MB/s us sy id 1m 5m 15m 19.85 37 0.72 3 1 96 1.78 1.90 1.69 tcpdump $ sudo tcpdump -A -i en7 tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on en7, link-type EN10MB (Ethernet), capture size 262144 bytes 00:33:02.787671 IP 10.25.130.117.53629 > a23-43-240-92.deploy.static.akamaitechnologies.com.https: Flags [.], ack 697481089, win 2048, length 0 E..(....@... ..u.+.\\.}..r...)...P...:... 00:33:02.790119 IP 10.25.130.117.51541 > sh-vdc01.mycompany.com.domain: 53089+ PTR? 92.240.43.23.in-addr.arpa. (43) E..GP....._. ..u &t..U.5.3...a...........92.240.43.23.in-addr.arpa..... 00:33:02.812866 ARP, Request who-has gw-voice-idf.cdu-cn.mycompany.com tell gw-vg224-idf.cdu-cn.mycompany.com, length 46 .... .... 13 packets captured 25 packets received by filter 0 packets dropped by kernel dstat strace sar Reference 20 Command Line Tools to Monitor Linux Performance 20 Linux System Monitoring Tools Every SysAdmin Should Know Top 25 Best Linux Performance Monitoring and Debugging Tools http://www.thegeekstuff.com/2010/12/50-unix-linux-sysadmin-tutorials 16 commands to check hardware information on Linux Best UNIX shell-based tools Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:15 "},"devops/git/git.html":{"url":"devops/git/git.html","title":"git","keywords":"","body":"Git Command Study and practice Table of Contents generated with DocToc appoint git alias specifying ranges commit get commit id get previous commit id branch get current branch create empty branch get branch name from reversion get upstream branch get local/remote branches sort local branch via committerdate change head log show files and status without comments show submodule changes get change from .git/objects get change history for deleted files by contents by message rebase automatic edit by git rebase -i auto rebaes fix typo in commits undo delete after push change latest comments in local change remote comments change root comments mv case sensitive clean clean untracked directory and item in .gitignore diff get difference between two branches tag get distance between tags get revision in particular branch show all tags for particular revision get tag and distance (depth) checkout checkout specific commit checkout particular commit and submodules checkout single branch for-each-ref format date format reference: git reference git cheatsheet git commands schacon/plumbing.md git-tips/tips 521xueweihan/git-tips CS Visualized: Useful Git Commands 10.8 Git Internals - Environment Variables GitHub Flow Like a Pro with these 13 Git Aliases gitglossary(7) Manual Page appoint git alias br = branch co = checkout coa = commit --amend --no-edit pl = !git --no-pager log --color --graph --pretty=tformat:'%C(red)%h%C(reset) -%C(yellow)%d%C(reset) %s %C(green)(%cr) %C(blue)%C(reset)' --abbrev-commit --date=relative --max-count=3 pls = log --color --graph --pretty=tformat:'%C(red)%h%C(reset) -%C(yellow)%d%C(reset) %s %C(green)(%cr)%C(reset) %C(blue)%C(reset)' --abbrev-commit --date=relative fpl = log --color --graph --pretty=tformat:'%C(red)%H%C(reset) -%C(yellow)%d%C(reset) %s %C(green)(%cr)%C(reset) %C(blue)%C(reset)' --abbrev-commit --date=relative fl = log -p --graph --color --graph rlog = \"!bash -c 'while read branch; do \\n\\ git fetch --all --force; \\n\\ git pl remotes/origin/$branch; \\n\\ done specifying ranges references: gitrevisions First master absolute commit referencing... using tilde (~) and caret (^) combined commit exclusions ^ (caret) notation : To exclude commits reachable from a commit, a prefix ^ notation is used. E.g. ^r1 r2 means commits reachable from r2 but exclude the ones reachable from r1 (i.e. r1 and its ancestors) dotted range notations .. (two-dot) range notation r1..r2 : commits that are reachable from r2 excluding those that are reachable from r1 by ^r1 r2 ... (three-dot) symmetric difference notation r1...r2 : called symmetric difference of r1 and r2 It is the set of commits that are reachable from either one of r1 (left side) or r2 (right side) but not from both commit get commit id the can be: commit id branch name HEAD, HEAD~n, HEAD^^ $ git rev-parse ^{commit} get previous commit id $ git rev-list --no-walk ^ branch get current branch $ git branch --show-current or $ git rev-parse --abbrev-ref HEAD or $ git symbolic-ref --short HEAD or$ git symbolic-ref HEAD | sed -e \"s/^refs\\/heads\\///\" or$ git symbolic-ref --quiet --short HEAD || git rev-parse --short or$ git name-rev --name-only HEAD for detached branch $ git st HEAD detached at d4beb6ac ... $ git branch --no-color \\ --remote \\ --verbose \\ --no-abbrev \\ --contains | sed -rne 's:^[^/]*/([^\\ ]+).*$:\\1:p' marslo/sandbox # or $ git branch --no-color \\ --remote \\ --verbose \\ --no-abbrev \\ --contains | sed -rne 's:^[ \\s]*origin/([^\\ ]+).*$:\\1:p' or $ git name-rev --name-only HEAD | sed -rne 's:^[ \\s]*([^\\]+/){2}([^~]+).*$:\\2:p' # or $ git name-rev --name-only HEAD | sed -rne 's:^[ \\s]*remotes/origin/([^~]+).*$:\\1:p' create empty branch create an empty branch $ mkdir && cd $_ $ git init $ git remote add origin $ git fetch --all --progress --force $ git checkout -b push to remote $ git add --all . $ git commit -m 'inital an empty branch' $ git push --force -u origin HEAD: git alias .gitalias : [alias] init-repo = \"!f() { \\ declare help=\\\"\\\"\\\"\\ USAGE: git init-repo [DEFAULT_BRANCH] [LOCAL_DIR] \\n\\ OPT: \\n\\ REMOTE_URL: mandatory \\n\\ DEFAULT_BRANCH: optinal. default is 'master' \\n\\ LOCAL_DIR: optional. default is current directory: '\\\"$(pwd)\\\"' \\n\\ \\\"\\\"\\\"; \\ declare remoteURL=\\\"$1\\\"; \\ declare defaultBr='master'; \\ declare localDir='.'; \\ [ 2 -le $# ] && defaultBr=\\\"$2\\\"; \\ [ 3 -eq $# ] && localDir=\\\"$3\\\"; \\ if [ 0 -eq $# ] || [ 3 -lt $# ]; then \\ echo \\\"${help}\\\"; \\ else \\ [ -d ${localDir} ] || mkdir -p ${localDir}; \\ cd ${localDir} ; \\ git init && \\ git remote add origin ${remoteURL} && \\ git fetch --all --force --quiet && \\ git checkout -b ${defaultBr}; \\ fi \\ }; f \\ \" get branch name from reversion branch -a --contians $ git branch -a --contains a3879d3 * master remotes/origin/master or $ git branch -r --contains a3879d3 origin/master name-rev $ git name-rev a3879d3 a3879d3 master~12 get upstream branch get current $ git rev-parse --abbrev-ref --symbolic-full-name @{u} origin/marslo or$ git for-each-ref --format='%(upstream)' $(git symbolic-ref -q HEAD) refs/remotes/origin/marslo or for meta/config$ git symbolic-ref -q HEAD refs/heads/meta/config $ git for-each-ref --format='%(upstream)' $(git symbolic-ref -q HEAD) refs/remotes/origin/meta/config $ git for-each-ref --format='%(upstream:short)' $(git symbolic-ref -q HEAD) origin/meta/config or$ git status -bsuno ## master...origin/master get specific $ git rev-parse --abbrev-ref gh-pages@{upstream} origin/gh-pages or$ git for-each-ref --format='%(upstream:short)' $(git rev-parse --symbolic-full-name meta/config) origin/meta/config get local/remote branches local$ git for-each-ref --format='%(refname:short)' refs/heads/ remote$ git for-each-ref --format='%(refname:short)' refs/remotes/origin/ sort local branch via committerdate references: How can I get a list of Git branches, ordered by most recent commit? sort git branch by default$ git config --global branch.sort -committerdate $ git for-each-ref --sort=-committerdate refs/heads/ # Or using git branch (since version 2.7.0) $ git branch --sort=-committerdate # DESC $ git branch --sort=committerdate # ASC advanced usage $ git for-each-ref \\ --sort=-committerdate \\ refs/heads/ \\ --format='%(HEAD) %(color:yellow)%(refname:short)%(color:reset) - %(color:red)%(objectname:short)%(color:reset) - %(contents:subject) - %(authorname) (%(color:green)%(committerdate:relative)%(color:reset))' for remote $ git for-each-ref --sort=-committerdate refs/remotes more on git tips git-list-branches-by-date() { local current_branch=$(git rev-parse --symbolic-full-name --abbrev-ref HEAD) local normal_text=$(echo -ne '\\E[0m') local yellow_text=$(echo -ne '\\E[0;33m') local yellow_bg=$(echo -ne '\\E[7;33m') git for-each-ref --sort=-committerdate \\ --format=$' %(refname:short) \\ \\t%(committerdate:short)\\t%(authorname)\\t%(objectname:short)' \\ refs/heads \\ | column -t -s $'\\t' -n \\ | sed -E \"s:^ (${current_branch}) :* ${yellow_bg}\\1${normal_text} :\" \\ | sed -E \"s:^ ([^ ]+): ${yellow_text}\\1${normal_text}:\" } git alias() [alias] sb = \"! git branch --sort=-committerdate --format='%(HEAD) %(color:red)%(objectname:short)%(color:reset) - %(color:yellow)%(refname:short)%(color:reset) - %(subject) %(color:bold green)(%(committerdate:relative))%(color:reset) %(color:blue)%(color:reset)' --color=always\" recent = \"! f() { \\ declare help=\\\"USAGE: git recent [remotes|tags] [count]\\\"; \\ declare refs; \\ declare count; \\ if [ 2 -lt $# ]; then \\ echo \\\"${help}\\\"; \\ exit 1; \\ else \\ if [ 'remotes' = \\\"$1\\\" ]; then \\ refs='refs/remotes/origin'; \\ elif [ 'tags' = \\\"$1\\\" ]; then \\ refs='refs/tags'; \\ elif [ 1 -eq $# ]; then \\ count=$1; \\ fi; \\ if [ 2 -eq $# ]; then \\ count=$2; \\ fi; \\ fi; \\ git for-each-ref \\ --sort=-committerdate \\ ${refs:='refs/heads'} \\ --format='%(HEAD) %(color:yellow)%(refname:short)%(color:reset) - %(color:red)%(objectname:short)%(color:reset) - %(contents:subject) - %(authorname) %(color:green)(%(committerdate:relative))%(color:reset)' \\ --color=always \\ --count=${count:=5}; \\ }; f \\ \" change head reference: warning: ignoring broken ref refs/remotes/origin/HEAD check refs $ git status warning: ignoring broken ref refs/remotes/origin/HEAD $ git symbolic-ref refs/remotes/origin/HEAD refs/remotes/origin/new_master fix warning$ git symbolic-ref refs/remotes/origin/HEAD refs/remotes/origin/new_master or$ git remote set-head origin --delete $ git remote set-head origin --auto or$ git fetch --all --force $ git remote set-head origin refs/remotes/origin/new_master log show files and status without comments $ git log --color --stat --abbrev-commit --date=relative --graph --submodule --format=\"%H\" more # or $ git log --color --stat --abbrev-commit --date=relative --graph --submodule --format=\"%h %ad- %s [%an]\" # or $ git log --color --stat --abbrev-commit --date=relative --graph --submodule --format='%C(red)%h%Creset %C(yellow)(%ad)%Creset %s %C(blue)%Creset' e.g.: $ git log -3 --color --stat --abbrev-commit --date=relative --graph --submodule --format=\"%H\" * 50ede51fcc3cf0311fd85b3e9c4a36d4beb89e69 | | devops/git/gerrit.md | 6 ++++-- | devops/git/git.md | 5 +++++ | 2 files changed, 9 insertions(+), 2 deletions(-) * 41d58dabcd0aaee33edd1de7793ffd82c7cffa89 | | SUMMARY.md | 2 +- | 1 file changed, 1 insertion(+), 1 deletion(-) * 4460a32d8fddbe7c5c434947aea153273ce215d4 | | devops/git/{gitStudy.md => git.md} | 117 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++- | 1 file changed, 116 insertions(+), 1 deletion(-) show submodule changes $ git submodule status $ git log -- get change from .git/objects $ find .git/objects -type f -printf \"%P\\n\" | sed s,/,, get change history for deleted files full-history $ git log --all --full-history -- or $ git log --all --full-history --online -- or $ git log --oneline --follow -- or $ git log --diff-filter=D --summary | find \"delete\" | grep --follow $ git log --follow by contents $ git log -S'add' --oneline -3 6f7877c2 update git for fetch more refs after cloned via --single-branch, and add tricky for vim 30ce195e add jenkins plugin jira-steps 913a7f29 update jenkins recommended plugins by message $ git log --grep='jira' --oneline 30ce195e add jenkins plugin jira-steps d17dd3aa add jira api rebase about GIT_SEQUENCE_EDITOR git rebase in depth automatic edit by git rebase -i inspired from .gitconfig & Is there a way to squash a number of commits non-interactively? $ COUNT=$1 $ GIT_EDITOR=\"sed -i -e '2,$COUNT s/^pick /s /;/# This is the 2nd commit message:/d'\" git rebase -i HEAD~$COUNT git alias [alias] sq = ! \"f() { TARGET=$1 && GIT_EDITOR=\\\"sed -i -e '2,$TARGET s/^pick /s /;/# This is the 2nd commit message:/,$ {d}'\\\" git rebase -i HEAD~$TARGET; }; f\" example or $ GIT_SEQUENCE_EDITOR=\"sed -i 's/^pick ce5efdb /edit ce5efdb /;/^pick ce6efdb /d'\" git rebase -i ${SHA} or edit $ GIT_SEQUENCE_EDITOR=\"sed -i -re 's/^pick 134567/e 1234567/'\" git rebase -i 1234567^ or sequence.editor $ git -c sequence.editor='sed -i s/pick/reword/' rebase -i ${SHA} auto rebaes .gitconfig [alias] arebase = ! ~/.marslo/bin/arebase.sh ~/.marslo/bin/arebase.sh #!/bin/bash ACTION=$1 COMMIT=$(git rev-parse --short $2) [[ \"$COMMIT\" ]] || exit 1 CORRECT= for A in p pick r reword e edit s squash f fixup d drop t split; do [[ $ACTION == $A ]] && CORRECT=1 done [[ \"$CORRECT\" ]] || exit 1 git merge-base --is-ancestor $COMMIT HEAD || exit 1 if [[ $ACTION == \"drop\" || $ACTION == \"d\" ]]; then GIT_SEQUENCE_EDITOR=\"sed -i -e '/^pick $COMMIT/d'\" git rebase -i $COMMIT^^ elif [[ $ACTION == \"split\" || $ACTION == \"t\" ]]; then GIT_SEQUENCE_EDITOR=\"sed -i -e 's/^pick $COMMIT/edit $COMMIT/'\" git rebase -i $COMMIT^^ || exit 1 git reset --soft HEAD^ echo \"Hints:\" echo \" Select files to be commited using 'git reset', 'git add' or 'git add -p'\" echo \" Commit using 'git commit -c $COMMIT'\" echo \" Finish with 'git rebase --continue'\" else GIT_SEQUENCE_EDITOR=\"sed -i -e 's/^pick $COMMIT/$1 $COMMIT/'\" git rebase -i $COMMIT^^ fi fix typo in commits $ EDITOR=\"sed -i -e 's/borken/broken/g'\" GIT_SEQUENCE_EDITOR=\"sed -i -e 's/pick/reword/g'\" git rebase -i --root or: $ VISUAL=\"sed -i -e '/^[[:blank:]]*Change-Id/ d'\" GIT_SEQUENCE_EDITOR=\"sed -i -e 's/pick/reword/g'\" git rebase -i --root or: $ GIT_EDITOR=\"sed -i -e 's/kyewrod/keyword/g'\" GIT_SEQUENCE_EDITOR=\"sed -i -e 's/pick/reword/g'\" git rebase -i --root undo delete after push delete only the latest commit $ git push origin +^: # e.g.: $ git pl --pretty=format:\"%h\" --no-patch * cb46bdc * 936543c * a83ac6b # delete cb46bdc $ git push origin +cb46bdc^:master delete multiple commits revert local $ git reset --hard HEAD~ # or $ git reset --hard HEAD^^^ # or $ git reset --hard # or $ git rebase -i HEAD~ push to remote $ git push [--force] origin + # e.g.: $ git push [--force] origin +master revert single file to remotes $ git checkout origin/ -- revert changes in submodule $ git submodule update -f --init or$ git submodule foreach --recursive git reset --hard or$ git submodule update -f --recursive or$ git submodule foreach --recursive git reset --hard $ git submodule update --recursive --init Git Reset vs Revert vs Checkout reference Command Scope Common use cases git reset Commit-level Discard commits in a private branch or throw away uncommited changes git reset File-level Unstage a file git checkout Commit-level Switch between branches or inspect old snapshots git checkout File-level Discard changes in the working directory git revert Commit-level Undo commits in a public branch git revert File-level (N/A) change latest comments in local $ git commit --amend change comments in remote $ git pl * a79d384 - (HEAD -> master, origin/master, origin/HEAD) update (11 seconds ago) * 7cef7c7 - update (7 hours ago) * e1d7a64 - update (7 hours ago) # change comments on a79d384 $ git commit --amend $ git push --force-with-lease origin master # result $ git fetch --all --force $ git pl remotes/origin/master Fetching origin * ba49259 - (HEAD -> master, origin/master, origin/HEAD) update a79d384 for change comments (24 seconds ago) * 7cef7c7 - update (7 hours ago) * e1d7a64 - update (7 hours ago) change remote comments $ git rebase -i HEAD~ And then change pick to reword example $ git pls * 1e7d979 - (HEAD -> master, origin/master, origin/HEAD) f (24 seconds ago) * 9b89ed7 - c (40 seconds ago) * beb575f - d (51 seconds ago) * 25d010d - e (57 seconds ago) * c502e34 - b (64 seconds ago) * 8890288 - init commit (4 minutes ago) $ git rebase -i HEAD~5 reword c502e34 b pick 25d010d e pick beb575f d reword 9b89ed7 c pick 1e7d979 f $ git push --force origin master # or $ git push origin +master change root comments $ git rebase -i --root $ git push origin + mv case sensitive error with regular git mv $ git config --global core.ignorecase true $ git mv Tig tig fatal: renaming 'confs/home/Tig' failed: Invalid argument renmae $ git mv Tig temp $ git aa $ git mv temp tig $ git aa $ git st On branch master Your branch is up to date with 'origin/master'. Changes to be committed: (use \"git restore --staged ...\" to unstage) renamed: Tig/.tig/marslo.tigrc -> tig/.tig/marslo.tigrc renamed: Tig/.tigrc -> tig/.tigrc renamed: Tig/.tigrc_latest -> tig/.tigrc_latest renamed: Tig/tigrc_2.4.1_1_example -> tig/tigrc_2.4.1_1_example renamed: Tig/tigrc_Marslo -> tig/tigrc_Marslo clean clean untracked directory and item in .gitignore $ git clean -dfx using -f twice if you really want to remove such a directory $ git st On branch meta/config Your branch is based on 'origin/meta/config', but the upstream is gone. (use \"git branch --unset-upstream\" to fixup) Untracked files: (use \"git add ...\" to include in what will be committed) my-sbumodule/ nothing added to commit but untracked files present (use \"git add\" to track) $ git clean -dfx Skipping repository my-submodule/ $ git clean -dffx Removing my-submodule/ diff get difference between two branches $ git log --left-right --graph --cherry-pick --oneline origin/..origin/ or$ git rev-list --reverse \\ --pretty=\"TO_TEST %h () %s\" \\ --cherry-pick \\ --right-only origin/...origin/ \\ | grep \"^TO_TEST \" tag reference : GIT LIKE A PRO: SORT GIT TAGS BY DATE get distance between tags $ git describe HEAD --tags or $ git describe HEAD --all --long get revision in particular branch $ git tag -l --sort='creatordate' --merged get latest tag references: Get the most recent tag in git GIT LIKE A PRO: SORT GIT TAGS BY DATE $ git tag -l --sort='creatordate' --merged | tail -1 or # the command can be executed in .git folder (! -is-inside-work-tree) $ git describe --tags --abbrev=0 --always or $ git for-each-ref --sort=taggerdate \\ --format '%(tag)' \\ refs/tags | tail -1 to get verbose output$ git for-each-ref --sort=taggerdate \\ --format '%(tag) %(taggerdate:raw) %(taggername) %(subject)' \\ refs/tags or$ git for-each-ref --sort=taggerdate \\ --format '%(tag)_,,,_%(taggerdate:raw)_,,,_%(taggername)_,,,_%(subject)' \\ refs/tags | awk 'BEGIN { FS = \"_,,,_\" } ; { printf \"%-20s %-18s %-25s %s\\n\", $2, $1, $4, $3 }' or$ git log --tags \\ --simplify-by-decoration \\ --pretty=\"format:%ai %d\" | sort or formatted date$ git for-each-ref --sort=taggerdate \\ --format '%(tag)_,,,_%(taggerdate:raw)_,,,_%(taggername)_,,,_%(subject)' \\ refs/tags | awk 'BEGIN { FS = \"_,,,_\" } ; { t=strftime(\"%Y-%m-%d %H:%M\",$2); printf \"%-20s %-18s %-25s %s\\n\", t, $1, $4, $3 }' or git aliastags = !\"git for-each-ref \\ --sort=taggerdate \\ --format '%(tag)_,,,_%(taggerdate:raw)_,,,_%(taggername)_,,,_%(subject)' refs/tags \\ | awk 'BEGIN { FS = \\\"_,,,_\\\" } ; { t=strftime(\\\"%Y-%m-%d %H:%M\\\",$2); printf \\\"%-20s %-18s %-25s %s\\\\n\\\", t, $1, $4, $3 }'\" get revision from latest tag in particular branch $ git rev-list -1 --no-patch $(git tag -l --sort='creatordate' --merged | tail -1) show all tags for particular revision $ git tag --points-at get tags for HEAD:$ git tag --points-at HEAD or$ git name-rev --tags --name-only $(git rev-parse ) example$ git name-rev --tags --name-only $(git rev-parse HEAD) get tag and distance (depth) reference: Why does git-describe prefix the commit ID with the letter 'g'? man of git-describe: The hash suffix is \"-g\" + an unambigous abbreviation for the tip commit of parent. The length of the abbreviation scales as the repository grows, using the approximate number of objects in the repository and a bit of math around the birthday paradox, and defaults to a minimum of 7. $ git describe --long --tags v1.0.0-epsilon-2-g46b7ebb | | + -g | + distance (commits on top) + tag name # or $ git describe --dirty --tags --long v1.0.0-epsilon-2-g46b7ebb | | | | \\___ ___/ | + commit hash of the current commit most + commits on top recent tag or --all $ git describe --all --long to filter the tags $ git describe --dirty --tags --long --match *nightly* nightly#82-2001310818-1765-gc18894b193 sort git tags by ascending and descending semver [!TIP] prepend \"-\" to reverse sort order. ascending : --sort= descending : --sort=- references: How to sort git tags by version string order of form rc-X.Y.Z.W? How can I list all tags in my Git repository by the date they were created? GIT LIKE A PRO: SORT GIT TAGS BY DATE via v:refname or version:refname by created data $ git for-each-ref --sort=creatordate --format='%(refname) %(creatordate)' refs/tags # or $ git tag --format='%(creatordate:short)%09%(refname:strip=2)' --sort=creatordate # or $ git for-each-ref --sort=taggerdate --format='%(tag) %(taggerdate) %(taggername) %(subject)' refs/tags # much better $ git for-each-ref --sort=taggerdate \\ --format '%(tag)_,,,_%(taggerdate:raw)_,,,_%(taggername)_,,,_%(subject)' refs/tags | awk 'BEGIN { FS = \"_,,,_\" } ; { t=strftime(\"%Y-%m-%d %H:%M\",$2); printf \"%-20s %-18s %-25s %s\\n\", t, $1, $4, $3 }' checkout checkout specific commit # make a new blank repository in the current directory git init # add a remote git remote add origin url://to/source/repository # fetch a commit (or branch or tag) of interest # Note: the full history up to this commit will be retrieved unless # you limit it with '--depth=...' or '--shallow-since=...' git fetch origin # reset this repository's master branch to the commit of interest git reset --hard FETCH_HEAD checkout particular commit and submodules [!TIP] references: How to checkout old git commit including all submodules recursively? nicktoumpelis/repo-rinse.sh $ git checkout --recurse-submodules or # [optional] create new branch $ git branch $ git checkout $ git checkout $ git submodule init # optional $ git submodule update --recursive or $ git clean -xfd $ git submodule foreach --recursive git clean -xfd $ git reset --hard $ git submodule foreach --recursive git reset --hard $ git submodule update --init --recursive checkout single branch $ git clone --single-branch --branch url://to/source/repository [target dir] add more branches $ git config remote.origin.fetch \"+refs/heads/*:refs/remotes/origin/*\" $ git fetch origin or $ cat ~/.marslo/.gitalias [alias] # [a]dd [f]etch [r]efs afr = !bash -c 'git config --add remote.origin.fetch \"+refs/heads/$1:refs/remotes/origin/$1\"' $ git afr 'sandbox/marslo/*' for-each-ref format (subject) : \"the subject line\" %(subject:sanitize) : \"the-subject-line\" [!TIP] field names git/t/t6300-for-each-ref.sh field names: head : refname: -> refs/heads/master refname:short -> master refname:lstrip=1 -> heads/master refname:lstrip=2 -> master refname:lstrip=-1 -> master refname:lstrip=-2 -> heads/master refname:rstrip=1 -> refs/heads refname:rstrip=2 -> refs refname:rstrip=-1 -> refs refname:rstrip=-2 -> refs/heads refname:strip=1 -> heads/master refname:strip=2 -> master refname:strip=-1 -> master refname:strip=-2 -> heads/master upstream -> refs/remotes/origin/master upstream:short -> origin/master upstream:lstrip=2 -> origin/master upstream:lstrip=-2 -> origin/master upstream:rstrip=2 -> refs/remotes upstream:rstrip=-2 -> refs/remotes upstream:strip=2 -> origin/master upstream:strip=-2 -> origin/master push -> refs/remotes/myfork/master push:short -> myfork/master push:lstrip=1 -> remotes/myfork/master push:lstrip=-1 -> master push:rstrip=1 -> refs/remotes/myfork push:rstrip=-1 -> refs push:strip=1 -> remotes/myfork/master push:strip=-1 -> master objecttype -> commit objectsize -> $((131 + hexlen)) objectsize:disk -> $disklen deltabase -> $ZERO_OID parent -> '' parent:short -> '' parent:short=1 -> '' parent:short=10 -> '' numparent -> 0 object -> '' type -> '' '*objectname' -> '' '*objecttype' -> '' author -> 'A U Thor 1151968724 +0200' authorname -> 'A U Thor' authoremail -> '' authoremail:trim -> 'author@example.com' authoremail:localpart -> 'author' tag -> '' tagger -> '' taggername -> '' taggeremail -> '' taggeremail:trim -> '' taggeremail:localpart -> '' taggerdate -> '' subject -> 'Initial' subject:sanitize -> 'Initial' contents:subject -> 'Initial' body -> '' contents:body -> '' contents:signature -> '' contents -> 'Initial' HEAD -> '*' objectname -> $(git rev-parse refs/heads/master) objectname:short -> $(git rev-parse --short refs/heads/master) objectname:short=1 -> $(git rev-parse --short=1 refs/heads/master) objectname:short=10 -> $(git rev-parse --short=10 refs/heads/master) tree -> $(git rev-parse refs/heads/master^{tree}) tree:short -> $(git rev-parse --short refs/heads/master^{tree}) tree:short=1 -> $(git rev-parse --short=1 refs/heads/master^{tree}) tree:short=10 -> $(git rev-parse --short=10 refs/heads/master^{tree}) authordate -> 'Tue Jul 4 01:18:44 2006 +0200' committer -> 'C O Mitter 1151968723 +0200' committername -> 'C O Mitter' committeremail -> '' committeremail:trim -> 'committer@example.com' committeremail:localpart -> 'committer' committerdate -> 'Tue Jul 4 01:18:43 2006 +0200' objectname:short=1 -> $(git rev-parse --short=1 refs/heads/master) objectname:short=10 -> $(git rev-parse --short=10 refs/heads/master) creator -> 'C O Mitter 1151968723 +0200' creatordate -> 'Tue Jul 4 01:18:43 2006 +0200' tags: refname -> refs/tags/testtag refname:short -> testtag upstream -> '' push -> '' objecttype -> tag objectsize -> $((114 + hexlen)) objectsize:disk -> $disklen '*objectsize:disk' -> $disklen deltabase -> $ZERO_OID '*deltabase' -> $ZERO_OID tree -> '' tree:short -> '' tree:short=1 -> '' tree:short=10 -> '' parent -> '' parent:short -> '' parent:short=1 -> '' parent:short=10 -> '' numparent -> '' type -> 'commit' '*objecttype' -> 'commit' author -> '' authorname -> '' authoremail -> '' authoremail:trim -> '' authoremail:localpart -> '' authordate -> '' committer -> '' committername -> '' committeremail -> '' committeremail:trim -> '' committeremail:localpart -> '' committerdate -> '' tag -> 'testtag' body -> '' contents:body -> '' contents:signature -> '' contents -> `'Tagging at 1151968727`` object -> $(git rev-parse refs/tags/testtag^0) objectname -> $(git rev-parse refs/tags/testtag) objectname:short -> $(git rev-parse --short refs/tags/testtag) '*objectname' -> $(git rev-parse refs/tags/testtag^{}) tagger -> 'C O Mitter 1151968725 +0200' taggername -> 'C O Mitter' taggeremail -> '' taggeremail:trim -> 'committer@example.com' taggeremail:localpart -> 'committer' taggerdate -> 'Tue Jul 4 01:18:45 2006 +0200' creator -> 'C O Mitter 1151968725 +0200' creatordate -> 'Tue Jul 4 01:18:45 2006 +0200' subject -> 'Tagging at 1151968727' subject:sanitize -> 'Tagging-at-1151968727' contents:subject -> 'Tagging at 1151968727' date format [!TIP] references: Specification for syntax of git dates strftime strftime format: relative local default iso ( or iso8601 ) rfc ( or rfc2822 ) short raw format:%Y-%m-%d %I:%M %p strftime : %a : Abbreviated weekday name %A : Full weekday name %b : Abbreviated month name %B : Full month name %c : Date and time representation appropriate for locale %d : Day of month as decimal number (01 – 31) %H : Hour in 24-hour format (00 – 23) %I : Hour in 12-hour format (01 – 12) %j : Day of year as decimal number (001 – 366) %m : Month as decimal number (01 – 12) %M : Minute as decimal number (00 – 59) %p : Current locale's A.M./P.M. indicator for 12-hour clock %S : Second as decimal number (00 – 59) %U : Week of year as decimal number, with Sunday as first day of week (00 – 53) %w : Weekday as decimal number (0 – 6; Sunday is 0) %W : Week of year as decimal number, with Monday as first day of week (00 – 53) %x : Date representation for current locale %X : Time representation for current locale %y : Year without century, as decimal number (00 – 99) %Y : Year with century, as decimal number %% : Percent sign %z, %Z : Either the time-zone name or time zone abbreviation, depending on registry settings how to use $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate)' Mon Aug 30 21:50:57 2021 +0800 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:relative)' 9 months ago $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:raw)' 1630331457 +0800 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:iso)' 2021-08-30 21:50:57 +0800 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:rfc)' Mon, 30 Aug 2021 21:50:57 +0800 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:local)' Mon Aug 30 21:50:57 2021 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:format:%Y-%m-%d %I:%M %p)' 2021-08-30 09:50 PM $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:format:%Y-%m-%d %H:%M:%S)' 2021-08-30 21:50:57 color [!TIP] usage: %(color:) %(color:reset) example $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(color:yellow)%(committerdate:iso)%(color:reset)' \\ --color =always 2021-08-30 21:50:57 +0800 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(color:blue)%(committerdate:iso)%(color:reset)' \\ --color=always 2021-08-30 21:50:57 +0800 condition [!TIP] %(if)...%(then)...%(else)...%(end) %(align:,left) ... %(end) example $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(if)%(committerdate)%(then)%(committerdate:format:%Y-%m-%d %I:%M %p)%(else)%(taggerdate:format:%Y-%m-%d %I:%M %p)%(end)' 2021-08-30 09:50 PM $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(align:left,50)[%(objecttype) : %(refname:short)]%(end) (%(committerdate:format:%Y-%m-%d %H:%M)) ' \\ --color \\ --count=10 [commit : sandbox/marslo/tag-1] (2021-08-30 21:50) alias [alias] # [p]retty [t]ag pt = \"!git for-each-ref --sort=-taggerdate refs/tags --format='%(color:red)%(objectname:short)%(color:reset) - %(align:left,38)%(color:bold yellow)[%(objecttype) : %(refname:short)]%(color:reset)%(end) %(subject) %(color:green)(%(if)%(taggerdate)%(then)%(taggerdate:format:%Y-%m-%d %H:%M)%(else)%(committerdate:format:%Y-%m-%d %H:%M)%(end))%(color:reset) %(color:blue)%(if)%(taggername)%(then)%(else)%(end)%(color:reset)' --color --count=10\" pts = \"!git for-each-ref --sort=-taggerdate refs/tags --format='%(color:red)%(objectname:short)%(color:reset) - %(color:bold yellow)[%(objecttype) : %(refname:short)]%(color:reset) - %(subject) %(color:green)(%(if)%(taggerdate)%(then)%(taggerdate:format:%Y-%m-%d %H:%M)%(else)%(committerdate:format:%Y-%m-%d %H:%M)%(end))%(color:reset) %(color:blue)%(if)%(taggername)%(then)%(else)%(end)%(color:reset)' --color\" Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:17 "},"devops/git/submodule.html":{"url":"devops/git/submodule.html","title":"submodule","keywords":"","body":" Table of Contents generated with DocToc git submodule init submodule update submodule revert changes in submodule working with submodule remove submodule git submodule reference: gitmodules - Defining submodule properties Gerrit Code Review - Superproject subscription to submodules updateshttps://gerrit-review.googlesource.com/Documentation/user-submodules.html init submodule $ git submodule add -b $ git submodule init $ git submodule update --init update submodule $ git config -f .gitmodules submodule..branch $ git submodule update --remote revert changes in submodule $ git submodule deinit -f . $ git submodule update --init or or $ git submodule foreach --recursive git clean -dffx $ git submodule foreach --recursive git reset --hard working with submodule list submodules HEAD:.gitmodules$ git show HEAD:.gitmodules | git config --file - --list pull from remote update submodule only$ git submodule update --remote --recursive --force --rebase update both super and submodule$ git pull [--rebase] --recurse-submodules push to remote push submodule only$ cd $ git push --recurse-submodule=on-demand push for both super and submodule $ cd $ git add --all $ git commit -am \"\" $ git push --recurse-submodule=on-demand $ cd $(git rev-parse --show-superproject-working-tree) # or: https://stackoverflow.com/a/7359782/2940319 $ cd $(git rev-parse --show-superproject-working-tree --show-toplevel | head -1) $ git add --all $ git commit -am \"\" $ git push origin $(git rev-parse --abbrev-ref HEAD) remove submodule $ git rm --cached $ rm -rf $ rm -rf .gitmodules $ rm -rf .git/modules/ $ vim .git/config Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:16 "},"devops/git/eol.html":{"url":"devops/git/eol.html","title":"eol","keywords":"","body":" Table of Contents generated with DocToc theory list eol in repo core.autocrlf please notice practice force using lf in both remote and local ignore warning: LF will be replaced by CRLF Reference references: git-config - Get and set repository or global options git config Git config theory list eol in repo > git ls-files --eol core.autocrlf parameters core.autocrlf false input true git commit lf > lf cr > cr crlf > crlf lf > lf cr > cr crlf > lf lf > lf cr > cr crlf > lf git checkout lf > lf cr > cr crlf > crlf lf > lf cr > cr crlf > crlf lf > lf cr > cr crlf > crlf normally, it will looks like core.autocrlf=true: core.autocrlf=input: core.autocrlf=false: repo repo repo ^ V ^ V ^ V / \\ / \\ / \\ crlf->lf lf->crlf crlf->lf \\ / \\ / \\ / \\ / \\ set in GUI checkout Windows-style, commit Unix-style line endings: $ git config --global core.autocrlf true Text files checked-out from the repository that have only LF characters are normalized to CRLF in your working tree; files that contain CRLF in the repository will not be touched Text files that have only LF characters in the repository, are normalized from CRLF to LF when committed back to the repository. Files that contain CRLF in the repository will be committed untouched. Checkout as-is, commit Unix-Style line endings: $ git config --global core.autocrlf input Text files checked-out from the repository will keep original EOL characters in your working tree. Text files in your working tree with CRLFcharacters are normalized to LF when committed back to the repository. Checkout as-is, commit as-is: $ git config --global core.autocrlf false core.eol dictates EOL characters in the text files of your working tree. core.eol = native by default, which means Windows EOLs are CRLF and *nix EOLs are LF in working trees. Repository gitattributes settings determines EOL character normalization for commits to the repository (default is normalization to LF characters). please notice eol This attribute sets a specific line-ending style to be used in the working directory. It enables end-of-line conversion without any content checks, effectively setting the text attribute. Note that setting this attribute on paths which are in the index with CRLF line endings may make the paths to be considered dirty. Adding the path to the index again will normalize the line endings in the index. practice force using lf in both remote and local $ git config core.eol lf $ git config core.autocrlf input or $ git config --global core.eol lf $ git config --global core.autocrlf input ignore warning: LF will be replaced by CRLF $ git config --global core.safecrlf false Reference Force LF eol in git repo and working copy Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:17 "},"devops/git/example.html":{"url":"devops/git/example.html","title":"example","keywords":"","body":" Table of Contents generated with DocToc rebase Without Confilite file With Confilite file rebase Without Confilite file Precondiction $ git pl 37a0595 - (HEAD, master) 2: 2.txt (5 seconds ago) 1d9bcce - Initial commit (65 minutes ago) $ git rlog 4e3106e - (origin/master, origin/HEAD) 1: 1.txt (2 minutes ago) 1d9bcce - Initial commit (65 minutes ago) $ git br master $ git push To git@github.com:Marslo/GitStudy.git ! [rejected] master -> master (non-fast-forward) error: failed to push some refs to 'git@github.com:Marslo/GitStudy.git' hint: Updates were rejected because the tip of your current branch is behind hint: its remote counterpart. Merge the remote changes (e.g. 'git pull') hint: before pushing again. hint: See the 'Note about fast-forwards' in 'git push --help' for details. Merge with rebase Use command: git pulll --rebase $ git pull --rebase First, rewinding head to replay your work on top of it... Applying: 2: 2.txt Check the status after pull rebase Check the status The status of meraged file hasn't been changed $ git st # On branch master # Your branch is ahead of 'origin/master' by 1 commit. # (use \"git push\" to publish your local commits) # nothing to commit, working directory clean The branch hasn't been changed $ git br master Log added the remote new version $ git pl 7bc54e0 - (HEAD, master) 2: 2.txt (12 seconds ago) 4e3106e - (origin/master, origin/HEAD) 1: 1.txt (4 minutes ago) 1d9bcce - Initial commit (68 minutes ago) $ git rlog 4e3106e - (origin/master, origin/HEAD) 1: 1.txt (4 minutes ago) 1d9bcce - Initial commit (68 minutes ago) With Confilite file Precondiction $ git pl 94a5935 - (HEAD, master) 2: 1 (25 seconds ago) 1d9bcce - Initial commit (25 minutes ago) $ git rlog b9709fe - (origin/master, origin/HEAD) 1: 1 (71 seconds ago) $ git br master $ git push To git@github.com:Marslo/GitStudy.git ! [rejected] master -> master (non-fast-forward) error: failed to push some refs to 'git@github.com:Marslo/GitStudy.git' hint: Updates were rejected because the tip of your current branch is behind hint: its remote counterpart. Merge the remote changes (e.g. 'git pull') hint: before pushing again. hint: See the 'Note about fast-forwards' in 'git push --help' for details. Merge by rebase Using command: git pull --rebase $ git pull --rebase First, rewinding head to replay your work on top of it... Applying: 2: 1 Using index info to reconstruct a base tree... M README.md Falling back to patching base and 3-way merge... Auto-merging README.md CONFLICT (content): Merge conflict in README.md Failed to merge in the changes. Patch failed at 0001 2: 1 The copy of the patch that failed is found in: /home/marslo/Tools/Git/2_GitStudy/.git/rebase-apply/patch When you have resolved this problem, run \"git rebase --continue\". If you prefer to skip this patch, run \"git rebase --skip\" instead. To check out the original branch and stop rebasing, run \"git rebase --abort\". Check the status after pull rebase branch is changed (master -> no branch) $ git br (no branch, rebasing master) master Status from unchanged and staged -> Umerged $ git st # HEAD detached at b9709fe # You are currently rebasing branch 'master' on 'b9709fe'. # (fix conflicts and then run \"git rebase --continue\") # (use \"git rebase --skip\" to skip this patch) # (use \"git rebase --abort\" to check out the original branch) # # Unmerged paths: # (use \"git reset HEAD ...\" to unstage) # (use \"git add ...\" to mark resolution) # # both modified: README.md # no changes added to commit (use \"git add\" and/or \"git commit -a\") Log changed: New committed version has been removed Remote new version has been *added $ git rlog b9709fe - (HEAD, origin/master, origin/HEAD) 1: 1 (2 minutes ago) 1d9bcce - Initial commit (26 minutes ago) $ git pl b9709fe - (HEAD, origin/master, origin/HEAD) 1: 1 (2 minutes ago) 1d9bcce - Initial commit (26 minutes ago) The conflicted file has been meraged $ git add . $ git st # HEAD detached at b9709fe # You are currently rebasing branch 'master' on 'b9709fe'. # (all conflicts fixed: run \"git rebase --continue\") # # Changes to be committed: # (use \"git reset HEAD ...\" to unstage) # # modified: README.md # $ git br (no branch, rebasing master) master $ git diff --staged diff --git a/README.md b/README.md index b1acca3..12afed2 100644 --- a/README.md +++ b/README.md @@ -1 +1,5 @@ +>>>>>> 2: 1 open all conflicted files $ git diff --name-only --diff-filter=U | uniq | xargs $EDITOR Return to master branch $ git rebase --continue Applying: 2: 1 Check the status The merged file (Unmerged) -> staged $ git st # On branch master # Your branch is ahead of 'origin/master' by 1 commit. # (use \"git push\" to publish your local commits) # nothing to commit, working directory clean Log added the remote new version $ git pl d6962d6 - (HEAD, master) 2: 1 (4 seconds ago) b9709fe - (origin/master, origin/HEAD) 1: 1 (3 minutes ago) 1d9bcce - Initial commit (27 minutes ago) $ git rlog b9709fe - (origin/master, origin/HEAD) 1: 1 (3 minutes ago) 1d9bcce - Initial commit (27 minutes ago) Branch changed no branch, rebasing master -> master $ git br master Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:16 "},"devops/git/gerrit.html":{"url":"devops/git/gerrit.html","title":"gerrit","keywords":"","body":" Table of Contents generated with DocToc .gitconfig default groups refs/meta/config get project.config publish to remote update meta/config if remotes update reset to remotes useful refs restriction for branches (feature1, feature2 and master) for only allow code review merge, forbidden code push rules.pl api basic usage change who approval the CR+2 get all vote CR-2 who approval the V+1 reference .gitconfig $ git config --global gitreview.username $ git config --global gitreview.remote origin default groups Gerrit Code Review - Access Controls Administrators Anonymous Users Change Owner Non-Interactive Users Project Owners Registered Users refs/meta/config get project.config clone the repo $ git clone # or update the local repo to HEAD $ git pull [--rebase] checkout meta/config $ git fetch origin refs/meta/config:refs/remotes/origin/meta/config $ git checkout meta/config or $ git fetch ssh://localhost:29418/project refs/meta/config $ git checkout FETCH_HEAD publish to remote $ git add --all . $ git commit -m \"\" submit directly $ git push origin meta/config:meta/config or $ git push origin HEAD:refs/meta/config submit review $ git push origin HEAD:refs/for/refs/meta/config or $ git push origin meta/config:refs/for/refs/meta/config update meta/config if remotes update $ git fetch origin --force refs/meta/config:refs/remotes/origin/meta/config $ git pull origin refs/meta/config # or $ git merge meta/config reset to remotes $ git fetch origin --force refs/meta/config:refs/remotes/origin/meta/config $ git reset --hard remotes/origin/meta/config useful refs sandbox: refs/heads/sandbox/${username}/* its-jira: for project specific [commentlink \"its-jira\"] match = ^[ \\\\t]*PROJECT-([0-9]{1,5}): link = https://:/browse/PROJECT-$1 for common setup [plugin \"its-jira\"] association = OPTIONAL branch = ^refs/heads/.* branch = ^refs/heads/stable-.* commentOnChangeAbandoned = false commentOnChangeCreated = true commentOnChangeMerged = true commentOnChangeRestored = false commentOnCommentAdded = false commentOnFirstLinkedPatchSetCreated = true commentOnPatchSetCreated = false commentOnRefUpdatedGitWeb = true enabled = enforced [commentlink \"its-jira\"] match = ^[ \\\\t]*([A-Za-z]*-[0-9]{1,5}): link = https://:/browse/$1 [commentlink \"changeid\"] match = (I[0-9a-f]{8,40}) link = \"#/q/$1\" verified label [label \"Verified\"] function = MaxWithBlock defaultValue = 0 copyAllScoresIfNoCodeChange = true value = -1 Fails value = 0 No score value = +1 Verified change-id [receive] requireChangeId = true createNewChangeForAllNotInTarget = false maxObjectSizeLimit = 6m maxBatchChanges = 1 [commentlink \"changeid\"] match = (I[0-9a-f]{8,40}) link = \"#/q/$1\" freeze master branch [!TIP] One quirk is that the shortest possible pattern expansion must be a valid ref name thus ^refs/heads/.*/name will fail because refs/heads//name is not a valid reference but ^refs/heads/.+/name will work. About the refs/for namespace [!TIP] references: what is the use refs/for/refs/* in gerrit? refs/for/* syntax is just a short name for refs/for/refs/*: project.config [access \"refs/for/refs/heads/master\"] push = block group user/Marslo Jiao (marslo) push = block group Registered Users submit = block group Registered Users submit = block group group user/Marslo Jiao (marslo) addPatchSet = block group user/Marslo Jiao (marslo) addPatchSet = block group Registered Users pushMerge = block group user/Marslo Jiao (marslo) pushMerge = block group Registered Users groups ... global:Project-Owners Project Owners global:Registered-Users Registered Users ... user:marslo user/Marslo Jiao(marslo) ... freeze multiple branches (stable & release) for the specific account project.config [access \"^refs/for/refs/heads/(stable|release)$\"] push = block group Registered Users submit = block group Registered Users addPatchSet = block group Registered Users pushMerge = block group Registered Users [access \"^refs/heads/(stable|release)$\"] read = group user/Marslo Jiao (marslo) push = +force group user/Marslo Jiao (marslo) pushMerge = group user/Marslo Jiao (marslo) or using exclusiveGroupPermissions[access \"^refs/heads/backup/(master|dev|staging|stable)/.+$\"] exclusiveGroupPermissions = create delete push pushMerge create = group Project Owners create = block group Registered Users delete = block group Registered Users push = block group Registered Users pushMerge = block group Registered Users [access \"^refs/for/refs/heads/backup/(master|dev|staging|stable)/.+$\"] exclusiveGroupPermissions = addPatchSet create push pushMerge submit addPatchSet = block group Registered Users create = block group Registered Users push = block group Registered Users pushMerge = block group Registered Users submit = block group Registered Users groups ... global:Project-Owners Project Owners global:Registered-Users Registered Users ... user:marslo user/Marslo Jiao(marslo) ... restriction for branches (feature1, feature2 and master) for only allow code review merge, forbidden code push project.config [access \"refs/*\"] read = group Project Owners read = group user/Marslo Jiao (marslo) [access \"refs/for/*\"] addPatchSet = group Project Owners addPatchSet = group user/Marslo Jiao (marslo) push = group Project Owners push = group user/Marslo Jiao (marslo) pushMerge = group Project Owners pushMerge = group user/Marslo Jiao (marslo) [access \"^refs/heads/(feature1|feature2|master)$\"] push = block group Registered Users pushMerge = block group Registered Users submit = group Change Owner groups ... global:Project-Owners Project Owners global:Registered-Users Registered Users ... user:marslo user/Marslo Jiao(marslo) ... example of project.config project.config[project] description = Gerrit Code Review [access \"refs/*\"] owner = group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/heads/*\"] label-Code-Review = -2..+2 group google/gerritcodereview-maintainers@googlegroups.com label-Code-Review = -2..+2 group polygerrit-maintainers label-Verified = -1..+1 group Change Owner label-Verified = -1..+1 group gerrit-verifiers label-Code-Style = -1..+1 group gerrit-verifiers label-Verified-Notedb = -1..+1 group gerrit-verifiers label-Library-Compliance = -1..+1 group gerrit-lib label-Library-Compliance = -1..+0 group google/gerritcodereview-maintainers@googlegroups.com submit = group Change Owner submit = group google/gerritcodereview-maintainers@googlegroups.com create = group google/gerritcodereview-maintainers@googlegroups.com abandon = group gerrit-verifiers editTopicName = +force group google/gerritcodereview-maintainers@googlegroups.com removeReviewer = group google/gerritcodereview-maintainers@googlegroups.com publishDrafts = group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/tags/*\"] create = group gerrit-release-creators create = group google/gerritcodereview-maintainers@googlegroups.com createTag = group gerrit-release-creators createTag = group google/gerritcodereview-maintainers@googlegroups.com createSignedTag = group gerrit-release-creators createSignedTag = group google/gerritcodereview-maintainers@googlegroups.com [access] inheritFrom = Public-Projects [receive] rejectImplicitMerges = true [reviewer] enableByEmail = true [label \"Verified\"] function = MaxNoBlock copyAllScoresIfNoCodeChange = true value = -1 Fails value = 0 No score value = +1 Verified defaultValue = 0 [label \"Code-Style\"] function = MaxWithBlock copyAllScoresIfNoCodeChange = true value = -1 Wrong Style or Formatting value = 0 No score value = +1 Style Verified defaultValue = 0 [label \"Library-Compliance\"] function = MaxWithBlock copyAllScoresIfNoCodeChange = true copyAllScoresOnTrivialRebase = true value = -1 Do not submit value = 0 No score value = +1 Approved defaultValue = 0 [access \"refs/for/refs/meta/dashboards/*\"] push = group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/meta/dashboards/*\"] label-Code-Review = -2..+2 group google/gerritcodereview-maintainers@googlegroups.com label-Code-Review = -1..+1 group Registered Users label-Verified = -1..+1 group gerrit-verifiers label-Verified = -1..+1 group google/gerritcodereview-maintainers@googlegroups.com submit = group google/gerritcodereview-maintainers@googlegroups.com forgeAuthor = group google/gerritcodereview-maintainers@googlegroups.com label-Code-Style = -1..+1 group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/for/refs/meta/config\"] push = group gerrit-verifiers [notify \"polygerrit-reviews\"] email = polygerrit-reviews@google.com type = all_comments type = submitted_changes header = cc filter = file:polygerrit-ui [access \"refs/heads/infra/config\"] push = group gerrit-tricium-admins rules.pl submit by a non author submit_rule(S) :- gerrit:default_submit(X), X =.. [submit | Ls], add_non_author_approval(Ls, R), S =.. [submit | R]. add_non_author_approval(S1, S2) :- gerrit:commit_author(A), gerrit:commit_label(label('Code-Review', 2), R), R \\= A, !, S2 = [label('Non-Author-Code-Review', ok(R)) | S1]. add_non_author_approval(S1, [label('Non-Author-Code-Review', need(_)) | S1]). ticket check check also: Prolog Gerrit - validate label if commit message contains a specific string optional validation submit_rule(S) :- gerrit:default_submit(X), X =.. [submit | Ls], require_ticket_check_for_ticket(Ls, Nls), S =.. [submit | Nls]. require_ticket_check_for_ticket(S1, S2) :- gerrit:commit_message_matches('^issue-[\\\\d]+\\\\s?:\\\\s?[\\\\w\\\\W]+'), !, S2 = [label('Ticket-Checked', need(_)) | S1]. require_ticket_check_for_ticket(S1, S2) :- !, S2 = S1. optional validation with auto vote submit_rule(S) :- gerrit:default_submit(X), X =.. [submit | Ls], require_ticket_check_for_ticket(Ls, Nls), S =.. [submit | Nls]. require_ticket_check_for_ticket(S1, S2) :- gerrit:commit_message_matches('\\\\[issue-[\\\\d]{2}\\\\]\\\\s?:\\\\s?[\\\\w\\\\W]+'), !, S2 = [label('Ticket-Checked', ok(user(824))) | S1]. require_ticket_check_for_ticket(S1, S2) :- !, S2 = S1. mandatory validation submit_rule(S) :- gerrit:default_submit(X), % get the current submit structure X=.. [submit | Ls], require_ticket_check_for_ticket(Ls, Nls), S=.. [submit | Nls]. require_ticket_check_for_ticket(S1, S2) :- gerrit:commit_message_matches('\\\\[issue-[\\\\d]{2}\\\\][\\\\s\\\\S]+'), !, S2 = [label('Ticket-Checked', ok(user(790))) | S1]. % Add the label and automatically approval by user-id: 790 require_ticket_check_for_ticket(S1, [label('Ticket-Checked', need(_)) | S1]). api reference: Gerrit Code Review - REST API Developers' Notes Gerrit Code Review - REST API basic usage regular options a might means [a]pi ⇡ $ curl -X PUT http://domain.name/a/path/to/api/ $ curl -X POST http://domain.name/a/path/to/api/ $ curl -X DELETE http://domain.name/a/path/to/api/ sending data json with file $ curl -X PUT \\ -d@testdata.json \\ --header \"Content-Type: application/json\" \\ http://domain.name/a/path/to/api/ json with string $ curl -X POST \\ -H \"Content-Type: application/json\" https://domain.name/a/changes//move \\ -d '{ \"destination_branch\" : \"target/branch/name\" }' )]}' { \"id\": \"marslo-project~target%2Fbranch%2Fname~Id90057ab632eb93be2fa9128a9d624664008cb4a\", \"project\": \"marslo-project\", \"branch\": \"target/branch/name\", \"hashtags\": [], \"change_id\": \"Id90057ab632eb93be2fa9128a9d624664008cb4a\", \"subject\": \"marslo: testing api move\", \"status\": \"NEW\", \"created\": \"2022-01-21 05:21:25.000000000\", \"updated\": \"2022-05-17 06:56:37.000000000\", \"submit_type\": \"FAST_FORWARD_ONLY\", \"mergeable\": false, \"insertions\": 8, \"deletions\": 8, \"unresolved_comment_count\": 0, \"has_review_started\": true, \"_number\": 94490, \"owner\": { \"_account_id\": 790 }, \"requirements\": [] } # or $ curl -X POST \\ -H \"Content-Type: application/json\" https://domain.name/a/changes//move \\ -d '{ \"destination_branch\" : \"target/branch/name\" }' | tail -n +2 | jq -r .branch txt $ curl -X PUT \\ --data-binary @testdata.txt \\ --header \"Content-Type: text/plain\" \\ http://domain.name/a/path/to/api/ verifying header content $ curl -v -n -X DELETE http://domain.name/a/path/to/api/ change get change via change-id $ curl -X GET 'https://domina.name/a/changes/' get change via commit-id $ changeid=$(git show --no-patch --format=\"%s%n%n%b\" | sed -nre 's!Change-Id: (.*$)!\\1!p') $ curl -X GET \"https://domina.name/a/changes/${changeid}\" or $ project=$(echo 'path/to/project' | sed 's:/:%2F:g') $ branch='dev' $ changeid=$(git show --no-patch --format=\"%s%n%n%b\" | sed -nre 's!Change-Id: (.*$)!\\1!p') $ curl -X GET \"https://domina.name/a/changes/${project}~${branch}~${changeid}\" who approval the CR+2 $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r '.labels.\"Code-Review\".approved.name' get all vote CR-2 example output for .labels..all[]{ \"value\": -2, \"date\": \"2021-05-31 07:57:14.000000000\", \"permitted_voting_range\": { \"min\": -2, \"max\": 2 }, \"_account_id\": 790, \"name\": \"Marslo Jiao\", \"email\": \"marslo.jiao@gmail.com\", \"username\": \"marslo\" } { \"value\": 0, \"permitted_voting_range\": { \"min\": -2, \"max\": 2 }, \"_account_id\": 124, \"name\": \"John Doe\", \"email\": \"john@gmail.com\", \"username\": \"john\" } reference: Select objects based on value of variable in object using jq jq select or statement How to select items in JQ based on value in array $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r '.labels.\"Code-Review\".all[] | select ( .value == -2 ) | .username' : |⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂| : : ⇣ : : select \".value\"== -2 : : : ⇣ ⇣ pipe pipe # or $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r '( .labels.\"Code-Review\".all[] | select ( .value == -2 ) ).username' : : ⇣ ⇣ expression expression # or $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r '[ .labels.\"Code-Review\".all[] | select ( .value == -2 ) ][].username' : : ⇣ ⇣ expression expression # or $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r '.labels.\"Code-Review\".all[] | select ( .value == -2 )' | jq -r .username : ⇣ pipe who approval the V+1 $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r .labels.Verified.approved.username reference project owner guide Gerrit Code Review - Access Controls Gerrit Code Review - Uploading Changes The refs/for namespace gerrit/gerrit/refs/meta/config gerrit 权限控制 its-jira plugin md Rule base configuration Gerrit push not working. Remote rejected, prohibited by gerrit Gerrit Code Review - Project Configuration File Format Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:16 "},"devops/git/q&a.html":{"url":"devops/git/q&a.html","title":"q&a","keywords":"","body":" Table of Contents generated with DocToc For Ubuntu no refs in common and none specified; doing nothing. For CentOS /bin/sh: cc openssl/ssl.h expat.h asciidoc docbook2x-texi xmlto gnu/stubs-64.h others diff-highlight: command not found error: RPC failed For Ubuntu no refs in common and none specified; doing nothing. Error $ git push No refs in common and none specified; doing nothing. Perhaps you should specify a branch such as 'master'. Everything up-to-date Solution: git push -u origin master $ git push -u origin master Counting objects: 40, done. Delta compression using up to 4 threads. Compressing objects: 100% (40/40), done. Writing objects: 100% (40/40), 133.46 KiB | 0 bytes/s, done. Total 40 (delta 6), reused 0 (delta 0) To git@github.com:Marslo/LaunchySkins.git \\* [new branch] master -> master \\* Branch master set up to track remote branch master from origin. For CentOS /bin/sh: cc Error: $ make prefix=/usr/local/myprograms/git GIT_VERSION = 2.1.0 * new build flags CC credential-store.o /bin/sh: cc: command not found make: *** [credential-store.o] Error 127 Solution: $ yum install gcc gcc-g++ g++ make openssl/ssl.h Error: $ make prefix=/usr/local/myprograms/git CC credential-store.o In file included from cache.h:4, from credential-store.c:1: git-compat-util.h:213:25: warning: openssl/ssl.h: No such file or directory git-compat-util.h:214:25: warning: openssl/err.h: No such file or directory git-compat-util.h:326:25: warning: openssl/evp.h: No such file or directory git-compat-util.h:327:26: warning: openssl/hmac.h: No such file or directory git-compat-util.h:329:28: warning: openssl/x509v3.h: No such file or directory In file included from credential-store.c:1: cache.h:12:21: warning: openssl/sha.h: No such file or directory cache.h:20:18: warning: zlib.h: No such file or directory In file included from credential-store.c:1: cache.h:22: error: expected specifier-qualifier-list before ‘z_stream’ make: *** [credential-store.o] Error 1 Solution: $ yum install openssl openssl-devel zlib-devel libcurl libcurl-devel expat.h Error: $ make prefix=/usr/local/myprograms/git http-push.c:17:19: warning: expat.h: No such file or directory http-push.c:832: warning: type defaults to ‘int’ in declaration of ‘XML_Char’ http-push.c:832: error: expected ‘;’, ‘,’ or ‘)’ before ‘*’ token Solution $ sudo yum install expat-devel asciidoc Error: /bin/sh: line 1: asciidoc: command not found make[1]: *** [git-add.html] Error 127 make[1]: Leaving directory `/root/Software/git-master/Documentation' make: *** [doc] Error 2 Solution: $ sudo yum install docbook-style-xsl $ sudo rpm -ivh http://pkgs.repoforge.org/asciidoc/asciidoc-8.6.9-1.el6.rfx.noarch.rpm # Or $ wget http://downloads.sourceforge.net/project/asciidoc/asciidoc/8.6.9/asciidoc-8.6.9.tar.gz $ tar xf asciidoc-8.6.9.tar.gz $ autoconf $ ./configure $ make $ sudo make install docbook2x-texi Error: DB2TEXI user-manual.texi /bin/sh: 2: docbook2x-texi: not found make[1]: *** [user-manual.texi] Error 127 make[1]: Leaving directory `/home/marslo/Tools/Software/Programming/Git/git-master/Documentation' make: *** [info] Error 2 Solution: $ sudo yum -y --enablerepo=*epel* install docbook2X $ sudo ln -s /usr/bin/db2x_docbook2texi /usr/bin/docbook2x-texi xmlto Error: /bin/sh: line 1: xmlto: command not found make[1]: *** [git-add.1] Error 127 make[1]: Leaving directory `/root/Software/git-master/Documentation' make: *** [doc] Error 2 Solution: $ sudo yum install xmlto gnu/stubs-64.h Error: In file included from /usr/include/features.h:399:0, from /usr/include/unistd.h:25, from git-compat-util.h:158, from cache.h:4, from credential-store.c:1: /usr/include/gnu/stubs.h:10:27: fatal error: gnu/stubs-64.h: No such file or directory # include ^ compilation terminated. make: *** [credential-store.o] Error 1 Solution: $ sudo yum install glibc-devel others diff-highlight: command not found ubuntu$ dpkg -L git | grep diff-highlight centos/rhel$ rpm -ql git | grep diff-highlight arch$ pacman -Ql git | grep diff-highlight $ sudo ln -sf /path/to/diff-highlight /usr/bin/diff-highlight error: RPC failed [!TIP] error: RPC failed; curl 92 LibreSSL SSL_read: error:02FFF03C:system library:func(4095):Operation timed out references: Git push getting failed. error: RPC failed; curl 56 LibreSSL SSL_read: SSL_ERROR_SYSCALL, errno 60 $ git config [--global] http.postBuffer 524288000 $ git config [--global] http.sslVerify false Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:16 "},"devops/git/tricky.html":{"url":"devops/git/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc tricky get current branch get previous branch quick push to current branch remove warning: CRLF will be replaced by LF in xxx file for .gitattributes create multiple commits revision git commit git path .gitattributes git summaries scripts fetch merge all gfall iGitOpt effort others alias check help in previw.app debug Git Debug Options Linux windows tricky references: git-tips/tips git 的奇技淫巧 k88hudson/git-flight-rules git飞行规则(flight rules) firstaidgit.io unixorn/git-extra-commands tj/git-extras shell tricks: one git alias to rule them all get current branch $ git branch sandbox/marslo * master branch $ git branch --show-current # or $ git branch --show # or $ git branch | sed -ne 's:^\\*\\s*\\(.*\\)$:\\1:p' master symbolic-ref $ git symbolic-ref --short HEAD master $ git symbolic-ref HEAD refs/heads/master name-rev $ git name-rev --name-only HEAD remotes/origin/master describe $ git describe --contains --all HEAD master get previous branch get previous branch name $ git rev-parse --symbolic-full-name @{-1} refs/heads/sandbox/marslo/291 or $ git describe --all $(git rev-parse @{-1}) heads/sandbox/marslo/291 checkout to previous branch $ git checkout - or$ git checkout @{-1} quick diff with previous branch $ git diff ..@{-1} # or $ git diff @..@{-1} # or $ git diff HEAD..@{-1} quick push to current branch @@ alone is a shortcut for HEAD. references: gitrevisions(7) Manual Page $ git push origin @ # or $ git push origin HEAD remove warning: CRLF will be replaced by LF in xxx file for .gitattributes $ git add --all -u --renormalize . or ignore the warning$ git config --global core.safecrlf false create multiple commits $ for c in {0..10}; do echo \"$c\" >> squash.txt git add squash.txt git commit -m \"add '${c}' to squash.txt\" done revision the first revision $ git rev-list --max-parents=0 HEAD git commit emoji git path get absolute root path $ git rev-parse --show-toplevel get relative root path $ git rev-parse --show-cdup get absolute root path inside submodules $ git rev-parse --show-superproject-working-tree get .git path $ git rev-parse --git-dir inside the work tree or not $ git rev-parse --is-inside-work-tree .gitattributes Refreshing the repository after committing .gitattributes reference: Please Add .gitattributes To Your Git Repository Git tip: Add a .gitattributes file to deal with line endings gitattributes - Defining attributes per path Force LF eol in git repo and working copy $ rm -rf .git/index # or $ git rm --cached -r . # or $ git ls-files -z | xargs -0 rm $ git reset --hard or $ echo \"* text=auto\" >.gitattributes $ git add --renormalize . $ git status # Show files that will be normalized $ git commit -m \"Introduce end-of-line normalization\" format reference Be a Git ninja: the .gitattributes file $ cat .gitattributes * text=auto *.sh eol=lf path/to/file eol=lf git summaries get repo active days $ git log --pretty='format: %ai' $1 | cut -d ' ' -f 2 | sort -r | uniq | awk '{ sum += 1 } END {print sum}' get commit count since particular commit$ git log --oneline | wc -l | tr -d ' ' 635 since the initial commit$ git log --oneline | wc -l | tr -d ' ' 780 get all files count in the repo $ git ls-files | wc -l | tr -d ' ' get contributors $ git shortlog -n -s -e 110 marslo 31 marslo collection $ git shortlog -n -s -e | awk ' { sum += $1 if ($NF in emails) { emails[$NF] += $1 } else { email = $NF emails[email] = $1 # set commits/email to empty $1=$NF=\"\" sub(/^[[:space:]]+/, \"\", $0) sub(/[[:space:]]+$/, \"\", $0) name = $0 if (name in names) { # when the same name is associated with existed email, # merge the previous email into the later one. emails[email] += emails[names[name]] emails[names[name]] = 0 } names[name] = email } } END { for (name in names) { email = names[name] printf \"%6d\\t%s\\n\", emails[email], name } }' 141 marslo format the author $ git shortlog -n -s -e | awk ' { args[NR] = $0; sum += $0 } END { for (i = 1; i 78.0% 31 marslo 22.0% show diff file only $ git log --numstat --pretty=\"%H\" --author=marslo HEAD~3..HEAD 9fdb297ba0d2d51975e91d2b7e40fb5e96be4f5f 8 1 docs/artifactory/artifactory.md 095ec79c89d98831c0a485f55011bf81c6f712ad 49 11 docs/linux/disk.md 5 1 docs/osx/util.md f15a40c8dea2927db54570268aca4203cd50a416 1 0 docs/SUMMARY.md - - docs/screenshot/tools/ms/outlook-keychain-1.png 81 0 docs/tools/ms.md repo age $ git log --reverse --pretty=oneline --format=\"%ar\" | head -n 1 | LC_ALL=C sed 's/ago//' 4 months scripts fetch merge all $ cat ~/.gitconfig ... [alias] ua = \"!bash -c 'while read branch; do \\n\\ echo -e \\\"\\\\033[1;33m~~> ${branch}\\\\033[0m\\\" \\n\\ git fetch --all --force; \\n\\ if [ 'meta/config' == \\\"${branch}\\\" ]; then \\n\\ git fetch origin --force refs/${branch}:refs/remotes/origin/${branch} \\n\\ fi \\n\\ git rebase -v refs/remotes/origin/${branch}; \\n\\ git merge --all --progress refs/remotes/origin/${branch}; \\n\\ git remote prune origin; \\n\\ if git --no-pager config --file $(git rev-parse --show-toplevel)/.gitmodules --get-regexp url; then \\n\\ git submodule sync --recursive; \\n\\ git submodule update --init --recursive \\n\\ fi \\n\\ done gfall iGitOpt ig.sh effort references: tj/git-extras How can I calculate the number of lines changed between two commits in Git? --stat $ git diff --stat HEAD^ HEAD docs/programming/groovy/groovy.md | 1 + docs/vim/tricky.md | 81 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-------------------- 2 files changed, 61 insertions(+), 21 deletions(-) for particular account$ git --no-pager diff --author='marslo' --stat HEAD^ HEAD docs/programming/groovy/groovy.md | 1 + docs/vim/tricky.md | 81 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-------------------- 2 files changed, 61 insertions(+), 21 deletions(-) --numstat $ git --no-pager log --numstat --author=\"marslo\" HEAD^..HEAD commit c361ddf2687319f978bb4ec0069b4b996607615f (HEAD -> marslo, origin/marslo) Author: marslo Date: Wed Jul 28 22:21:03 2021 +0800 add bufdo for vim 1 0 docs/programming/groovy/groovy.md 60 21 docs/vim/tricky.md for total count of changes $ git log --numstat --pretty=\"%H\" --author=\"marslo\" HEAD^..HEAD | awk 'NF==3 {plus+=$1; minus+=$2} END {printf(\"+%d, -%d\\n\", plus, minus)}' +61, -21 or for pretty format $ git log HEAD^..HEAD --numstat --pretty=\"%H\" | awk 'NF==3 {added+=$1; deleted+=$2} NF==1 {commit++} END {printf(\"total lines added: +%d\\ntotal lines deleted: -%d\\ntotal commits: %d\\n\", added, deleted, commit)}' total lines added: +61 total lines deleted: -21 total commits: 1 or $ git log --numstat --format=\"\" HEAD^..HEAD | awk '{files += 1}{ins += $1}{del += $2} END{print \"total: \"files\" files, \"ins\" insertions(+) \"del\" deletions(-)\"}' total: 2 files, 61 insertions(+) 21 deletions(-) git alias [alias] summary = \"!git log --numstat --format=\\\"\\\" \\\"$@\\\" | awk '{files += 1}{ins += $1}{del += $2} END{print \\\"total: \\\"files\\\" files, \\\"ins\\\" insertions(+) \\\"del\\\" deletions(-)\\\"}' #\" --shortstat $ git diff --shortstat HEAD^..HEAD 2 files changed, 61 insertions(+), 21 deletions(-) or check for multiple commits$ git diff $(git log -5 --pretty=format:\"%h\" | tail -1) --shortstat 7 files changed, 253 insertions(+), 24 deletions(-) others alias references: putermancer/.gitconfig List Git aliases Shell Tricks: One Git Alias to Rule Them All automatic documentation of gitconfig aliases using sed or awk git config alias escaping show git alias $ git --list-cmds=alias # or $ git config --get-regexp '^alias\\.' [alias] # https://stackoverflow.com/q/53841043/2940319 ### show [g]it alia[s] as = \"! bash -c '''grep --no-group-separator -A1 -e \\\"^\\\\s*###\\\" \\\"$HOME\\\"/.marslo/.gitalias | \\n\\ awk \\\"END{if((NR%2))print p}!(NR%2){print\\\\$0p}{p=\\\\$0}\\\" | \\n\\ sed -re \\\"s/( =)(.*)(###)/*/g\\\" | \\n\\ sed -re \\\"s:[][]::g\\\" | \\n\\ awk -F* \\\"{printf \\\\\\\"\\\\033[1;33m%-20s\\\\033[0m » \\\\033[0;34m%s\\\\033[0m\\\\n\\\\\\\", \\\\$1, \\\\$2}\\\" | \\n\\ sort \\n\\ '''\" or [alias] alias = \"!sh -c '[ $# = 2 ] && git config --global alias.\\\"$1\\\" \\\"$2\\\" && exit 0 || [ $# = 1 ] && [ $1 = \\\"--list\\\" ] && git config --list | grep \\\"alias\\\\.\\\" | sed \\\"s/^alias\\\\.\\\\([^=]*\\\\)=\\\\(.*\\\\).*/\\\\1@@@@=>@@@@\\\\2/\\\" | sort | column -ts \\\"@@@@\\\" && exit 0 || echo \\\"usage: git alias \\\\n git alias --list\\\" >&2 && exit 1' -\" or [alias] aliases = !git config --get-regexp ^alias\\\\. | sed -e s/^alias.// -e s/\\\\ /\\\\ $(printf \\\"\\\\043\\\")--\\\\>\\\\ / | column -t -s $(printf \\\"\\\\043\\\") or $ git config --global --get-regexp alias | awk -v nr=2 '{sub(/^alias\\./,\"\")}; \\ { printf \"\\033[31m%_10s\\033[1;37m\", $1}; \\ {sep=FS}; \\ {for (x=nr; x finda[alias] finda = \"!grepalias() { git config --global --get-regexp alias | grep -i \\\"$1\\\" | awk -v nr=2 '{sub(/^alias\\\\./,\\\"\\\")};{printf \\\"\\\\033[31m%_10s\\\\033[1;37m\\\", $1};{sep=FS};{for (x=nr; x or show-cmd [alias] show-cmd = \"!f() { \\ sep=\"㊣\" ;\\ name=${1:-alias};\\ echo -n -e '\\\\033[48;2;255;255;01m' ;\\ echo -n -e '\\\\033[38;2;255;0;01m' ;\\ echo \"$name\"; \\ echo -n -e '\\\\033[m' ;\\ git config --get-regexp ^$name\\\\..*$2+ | \\ cut -c 1-40 | \\ sed -e s/^$name.// \\ -e s/\\\\ /\\\\ $(printf $sep)--\\\\>\\\\ / | \\ column -t -s $(printf $sep) | \\ sort -k 1 ;\\ }; f\" ls references: putermancer/.gitconfig taxilian/.gitconfig [alias] ls = \"!git status -suno\" ls-modified = \"!git status --porcelain -uno | awk 'match($1, /M/) {print $2}'\" ls-added = \"!git status --porcelain -uno | awk 'match($1, /A/) {print $2}'\" ls-deleted = \"!git status --porcelain -uno | awk 'match($1, /D/) {print $2}'\" ls-renamed = \"!git status --porcelain -uno | awk 'match($1, /R/) {print $2}'\" ls-copied = \"!git status --porcelain -uno | awk 'match($1, /C/) {print $2}'\" ls-updated = \"!git status --porcelain -uno | awk 'match($1, /U/) {print $2}'\" ls-staged = \"!git status --porcelain -uno | grep -P '^[MA]' | awk '{ print $2 }'\" ls-untracked = \"!git status --porcelain -uall | awk '$1 == \\\"??\\\" {print $2}'\" git alias escaping [alias] # https://stackoverflow.com/a/39616600/2940319 # Quote / unquote a sh command, converting it to / from a git alias string quote-string = \"!read -r l; printf \\\\\\\"!; printf %s \\\"$l\\\" | sed 's/\\\\([\\\\\\\"]\\\\)/\\\\\\\\\\\\1/g'; printf \\\" #\\\\\\\"\\\\n\\\" #\" quote-string-undo = \"!read -r l; printf %s \\\"$l\\\" | sed 's/\\\\\\\\\\\\([\\\\\\\"]\\\\)/\\\\1/g'; printf \\\"\\\\n\\\" #\" check help in previw.app $ MANWIDTH=80 MANPAGER='col -bx' git help rev-parse | groff -P-pa4 -Tps -mandoc -c | open -f -a Preview.app debug Git Debug Options Option Description GIT_TRACE=true Enable general trace messages GIT_CURL_VERBOSE=true Print HTTP headers (similar to curl -v) GIT_SSH_COMMAND=\"ssh -vvv\" Print SSH debug messages (similar to ssh -vvv) GIT_TRACE_PACK_ACCESS=true Enable trace messages for all accesses to any packs GIT_TRACE_PACKET=true Enable trace messages for all packets coming in or out of a given program GIT_TRACE_PACKFILE=true Enable tracing of packfiles sent or received by a given program GIT_TRACE_PERFORMANCE=true Enable performance related trace messages GIT_TRACE_SETUP=true Enable trace messages printing the .git, working tree and current working directory after Git has completed its setup phase GIT_TRACE_SHALLOW=true Enable trace messages that can help debugging fetching/cloning of shallow repositories Linux $ GIT_TRACE=true \\ GIT_CURL_VERBOSE=true \\ GIT_SSH_COMMAND=\"ssh -vvv\" \\ GIT_TRACE_PACK_ACCESS=true \\ GIT_TRACE_PACKET=true \\ GIT_TRACE_PACKFILE=true \\ GIT_TRACE_PERFORMANCE=true \\ GIT_TRACE_SETUP=true \\ GIT_TRACE_SHALLOW=true \\ or$ GIT_SSH_COMMAND='ssh -vvT' windows C:\\> set GIT_TRACE=true C:\\> set GIT_CURL_VERBOSE=true C:\\> set GIT_SSH_COMMAND=ssh -vvv C:\\> Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:16 "},"devops/android.html":{"url":"devops/android.html","title":"android","keywords":"","body":" Table of Contents generated with DocToc sdkmanager list download sdk while building debug install android package management list remote sdk list local sdk update sdk manual download sdkmanager list list available package $ sdkmanager --no_https --proxy=socks --proxy_port=1880 --proxy_host=localhost --list Installed packages:=====================] 100% Computing updates... Path | Version | Description | Location ------- | ------- | ------- | ------- tools | 26.1.1 | Android SDK Tools 26.1.1 | tools/ Available Packages: Path | Version | Description ------- | ------- | ------- add-ons;addon-google_apis-google-15 | 3 | Google APIs add-ons;addon-google_apis-google-16 | 4 | Google APIs add-ons;addon-google_apis-google-17 | 4 | Google APIs add-ons;addon-google_apis-google-18 | 4 | Google APIs add-ons;addon-google_apis-google-19 | 20 | Google APIs add-ons;addon-google_apis-google-21 | 1 | Google APIs add-ons;addon-google_apis-google-22 | 1 | Google APIs add-ons;addon-google_apis-google-23 | 1 | Google APIs add-ons;addon-google_apis-google-24 | 1 | Google APIs add-ons;addon-google_gdk-google-19 | 11 | Glass Development Kit Preview build-tools;19.1.0 | 19.1.0 | Android SDK Build-Tools 19.1 build-tools;20.0.0 | 20.0.0 | Android SDK Build-Tools 20 build-tools;21.1.2 | 21.1.2 | Android SDK Build-Tools 21.1.2 ... list $ find /opt/android-sdk/ -name package.xml -exec sh -c 'eval $(xmllint --xpath \"//*[local-name()='\\'localPackage\\'']/@path\" $0) && echo $path' {} \\; platforms;android-26 platforms;android-17 platforms;android-22 platforms;android-23 platforms;android-24 platforms;android-18 platforms;android-21 platforms;android-19 platforms;android-25 platforms;android-16 docs build-tools;24.0.1 build-tools;22.0.1 build-tools;25.0.2 build-tools;25.0.3 build-tools;23.0.1 ... $ sdkmanager --list --verbose Info: Parsing legacy package: /opt/android-sdk/android-ndk Info: Parsing /opt/android-sdk/build-tools/19.1.0/package.xml Info: Parsing /opt/android-sdk/build-tools/20.0.0/package.xml Info: Parsing /opt/android-sdk/build-tools/21.1.2/package.xml Info: Parsing /opt/android-sdk/build-tools/22.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.1/package.xml ... list target $ android list target Available Android targets: ---------- id: 1 or \"android-15\" Name: Android 4.0.3 Type: Platform API level: 15 Revision: 5 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800 Tag/ABIs : no ABIs. ---------- id: 2 or \"android-16\" Name: Android 4.1.2 Type: Platform API level: 16 Revision: 5 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800, WXGA800-7in Tag/ABIs : no ABIs. ---------- ... download sdk while building GRADLE_OPTS='-Dorg.gradle.daemon=false -Dandroid.builder.sdkDownload=true -Dorg.gradle.jvmargs=-Xmx2048M -Dhttp.proxyHost=sample.localnet -Dhttp.proxyPort=80 -Dhttps.proxyHost=sample.localnet -Dhttps.proxyPort=80' HTTPS_PROXY=http://sample.localnet:80 HTTP_PROXY=http://sample.localnet:80 _JAVA_OPTIONS='-Dhttp.proxyHost=sample.localnet -Dhttp.proxyPort=80 -Dhttps.proxyHost=sample.localnet -Dhttps.proxyPort=80' http_proxy=http://sample.localnet:80 https_proxy=http://sample.localnet:80 debug $ strace -e trace=network -y -s 256 -f -o strace.log tools/bin/sdkmanager --update install $ sdkmanager \"platform-tools\" \"platforms;android-26\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 --verbose Info: Parsing legacy package: /opt/android-sdk/android-ndk Info: Parsing /opt/android-sdk/build-tools/19.1.0/package.xml Info: Parsing /opt/android-sdk/build-tools/20.0.0/package.xml Info: Parsing /opt/android-sdk/build-tools/21.1.2/package.xml Info: Parsing /opt/android-sdk/build-tools/22.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.2/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.3/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.0/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.2/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.3/pac kage.xml ... plugin installation $ sdkmanager \"extras;m2repository;com;android;support;constraint;constraint-layout;1.0.2\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 /opt/android-sdk/extras/m2repository/com/android/support/constraint/constraint-layout/1.0.2/constraint-layout-1.0.2.aar $ sdkmanager \"extras;android;m2repository;com;android;support;multidex;1.0.2\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 /opt/android-sdk/extras/android/m2repository/com/android/support/multidex/1.0.1/multidex-1.0.1.aar \"extras;android;m2repository;com;android;support;multidex;1.0.2\" $ sdkmanager \"add-ons;addon-google_apis-google-21\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 Done /opt/android-sdk/add-ons/addon-google_apis-google-21 android package management list remote sdk $ android list sdk --no-https --proxy-host 192.168.1.100 --proxy-port 8000 Refresh Sources: Fetching http://dl.google.com/android/repository/addons_list-2.xml Validate XML Parse XML Fetched Add-ons List successfully Refresh Sources Fetching URL: http://dl.google.com/android/repository/repository-11.xml Validate XML: http://dl.google.com/android/repository/repository-11.xml Parse XML: http://dl.google.com/android/repository/repository-11.xml Fetching URL: http://dl.google.com/android/repository/addon.xml Validate XML: http://dl.google.com/android/repository/addon.xml ... list local sdk $ android list Available Android targets: ---------- id: 1 or \"android-16\" Name: Android 4.1.2 Type: Platform API level: 16 Revision: 5 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800, WXGA800-7in Tag/ABIs : no ABIs. ---------- id: 2 or \"android-17\" Name: Android 4.2.2 Type: Platform API level: 17 Revision: 3 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800, WXGA800-7in Tag/ABIs : no ABIs. ---------- ... update sdk $ android update sdk --no-ui --no-https --proxy-host 192.168.1.100 --proxy-port 8000 Refresh Sources: Fetching http://dl.google.com/android/repository/addons_list-2.xml Validate XML Parse XML Fetched Add-ons List successfully Refresh Sources Fetching URL: http://dl.google.com/android/repository/repository-11.xml Validate XML: http://dl.google.com/android/repository/repository-11.xml Parse XML: http://dl.google.com/android/repository/repository-11.xml Fetching URL: http://dl.google.com/android/repository/addon.xml Validate XML: http://dl.google.com/android/repository/addon.xml Parse XML: http://dl.google.com/android/repository/addon.xml Fetching URL: http://dl.google.com/android/repository/glass/addon.xml Validate XML: http://dl.google.com/android/repository/glass/addon.xml Parse XML: http://dl.google.com/android/repository/glass/addon.xml Fetching URL: http://dl.google.com/android/repository/extras/intel/addon.xml Validate XML: http://dl.google.com/android/repository/extras/intel/addon.xml ... manual download https://dl.google.com/android/repository/ https://dl.google.com/android/repository/tools_r25.2.5-linux.zip Tools: Android SDK Platform-tools https://dl.google.com/android/repository/platform-tools_r25.0.3-linux.zip https://dl.google.com/android/repository/platform-tools_r25.0.3-linux.zip Android SDK Build-tools: - https://dl.google.com/android/repository/build-tools_r25.0.2-linux.zip - https://dl.google.com/android/repository/build-tools_r25.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r25-linux.zip - https://dl.google.com/android/repository/build-tools_r24.0.3-linux.zip - https://dl.google.com/android/repository/build-tools_r24.0.2-linux.zip - https://dl.google.com/android/repository/build-tools_r24.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r24-linux.zip - https://dl.google.com/android/repository/build-tools_r23.0.3-linux.zip - https://dl.google.com/android/repository/build-tools_r23.0.2-linux.zip - https://dl.google.com/android/repository/build-tools_r23.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r22.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r21.1.2-linux.zip - https://dl.google.com/android/repository/build-tools_r20-linux.zip - https://dl.google.com/android/repository/build-tools_r19.1-linux.zip Android 7.1.1 (API 25) - SDK Platform: https://dl.google.com/android/repository/platform-25_r03.zip platforms/android-25 Android 7.0 (API 24) - SDK Platform: https://dl.google.com/android/repository/platform-24_r02.zip platforms/android-24 - Document: https://dl.google.com/android/repository/docs-24_r01.zip docs/ - Google APIs https://dl.google.com/android/repository/google_apis-24_r1.zip add-ons/addon-google_apis-google-24 Android 6.0 (API 23) - SDK Platform https://dl.google.com/android/repository/platform-23_r03.zip platforms/android-23 - Document: https://dl.google.com/android/repository/docs-23_r01.zip docs/ - Google APIs https://dl.google.com/android/repository/google_apis-23_r01.zip add-ons/addon-google_apis-google-23 Android 5.1.1 (API 22) - SDK Platform https://dl.google.com/android/repository/android-22_r02.zip platforms/android-23 - Google APIs https://dl.google.com/android/repository/google_apis-22_r01.zip add-ons/addon-google_apis-google-22 Extra: - Android Support Repository https://dl.google.com/android/repository/android_m2repository_r44.zip extras/android/m2repository - Android Auto Desktop Head Unit emulator https://dl.google.com/android/repository/desktop-head-unit-linux_r01.1.zip extras/google/auto - Google Play Services https://dl.google.com/android/repository/google_play_services_v9_rc41.zip extras/google/google_play_services - Google Repository https://dl.google.com/android/repository/google_m2repository_gms_v9_rc41_wear_2_0_rc6.zip extras/google/m2repository - Google Play APK Expansion library https://dl.google.com/android/repository/market_apk_expansion-r03.zip extras/google/market_apk_expansion - Google Play Licensing Library https://dl.google.com/android/repository/market_licensing-r02.zip extras/google/market_licensing - Google Play Billing Library https://dl.google.com/android/repository/play_billing_r05.zip extras/google/play_billing - Android Auto API Simulators https://dl.google.com/android/repository/simulator_r01.zip extras/google/simulators - Google USD Driver https://dl.google.com/android/repository/usb_driver_r11-windows.zip extras/google/usb_driver - Google Web Driver https://dl.google.com/android/repository/webdriver_r02.zip extras/google/webdriver - Intel x86 Emulator Accelerator (HAXM Installer) http://mirrors.neusoft.edu.cn/android/repository/extras/intel/ Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:15 "},"devops/commonTools.html":{"url":"devops/commonTools.html","title":"commonTools","keywords":"","body":" Table of Contents generated with DocToc apt apt configuration necessory pckages and dependencies package auto-upgrade dislable disable server auto upgrade revert hold settings Show all Hold complete remove an app system timezone setup motd upgrade disable set service auto-startup application jdk and JAVA_HOME groovy mysql built from source code install from apt repo mysql-connector (jdbc) apt apt configuration $ cat /etc/apt/apt.conf Acquire::http::Proxy \"http://161.91.27.236:8080\"; Acquire::https::Proxy \"http://161.91.27.236:8080\"; Acquire::ftp::Proxy \"http://161.91.27.236:8080\"; $ cat /etc/apt/apt.conf.d/99ignoresave Dir::Ignore-Files-Silently:: \"(.save|.distupgrade)$\"; Dir::Ignore-Files-Silently:: \"\\.gz$\"; Dir::Ignore-Files-Silently:: \"\\.save$\"; Dir::Ignore-Files-Silently:: \"\\.distUpgrade$\"; Dir::Ignore-Files-Silently:: \"\\.list_$\"; necessory pckages and dependencies $ sudo apt --list upgradable $ sudo apt upgrade $ sudo apt install sysv-rc-conf tree dos2unix iptables-persistent mailutils policycoreutils build-essential landscape-common gcc g++ make cmake package auto-upgrade dislable $ sudo sed -i 's/Prompt=.*/Prompt=never/' /etc/update-manager/release-upgrades $ sudo sed -i 's/\"1\"/\"0\"/' /etc/apt/apt.conf.d/10periodic $ sudo sed -i 's/\"1\"/\"0\"/' /etc/apt/apt.conf.d/20auto-upgrades disable server auto upgrade # dpkg --list | grep jenkins ii jenkins 2.19.4 all Jenkins monitors executions of repeated jobs, such as building a software # echo \"jenkins hold\" | dpkg --set-selections OR # apt-mark hold jenkins # dpkg --list | grep jenkins hi jenkins 2.19.4 all Jenkins monitors executions of repeated jobs, such as building a software revert hold settings $ sudo echo \"jenkins install\" | dpkg --set-selections # OR $ sudo apt-mark unhold jenkins Show all Hold $ sudo apt-mark showhold complete remove an app $ sudo systemctl stop mysql $ sudo apt-get --purge autoremove mysql* $ sudo apt-get autoclean $ sudo apt --purge autoremove mysql* $ sudo apt autoclean $ sudo apt list --installed | grep mysql $ sudo rm -rf /var/lib/mysql/debian-*.flag $ sudo rm -rf /var/lib/mysql $ sudo rm -rf /etc/mysql system timezone setup $ sudo dpkg-reconfigure tzdata motd upgrade disable $ sudo mv /etc/update-motd.d/90-updates-available /etc/update-motd.d/org.90-updates-available.org set service auto-startup $ sudo sysv-rc-config jenkins on $ sudo sysv-rc-conf --list | grep jenkins jenkins 0:off 1:off 2:on 3:on 4:on 5:on 6:off $ sudo update-rc.d jenkins enable update-rc.d: warning: start runlevel arguments (none) do not match jenkins Default-Start values (2 3 4 5) update-rc.d: warning: stop runlevel arguments (none) do not match jenkins Default-Stop values (0 1 6) Enabling system startup links for /etc/init.d/jenkins ... Removing any system startup links for /etc/init.d/jenkins ... /etc/rc0.d/K20jenkins /etc/rc1.d/K20jenkins /etc/rc2.d/S20jenkins /etc/rc3.d/S20jenkins /etc/rc4.d/S20jenkins /etc/rc5.d/S20jenkins /etc/rc6.d/K20jenkins Adding system startup for /etc/init.d/jenkins ... /etc/rc0.d/K20jenkins -> ../init.d/jenkins /etc/rc1.d/K20jenkins -> ../init.d/jenkins /etc/rc6.d/K20jenkins -> ../init.d/jenkins /etc/rc2.d/S20jenkins -> ../init.d/jenkins /etc/rc3.d/S20jenkins -> ../init.d/jenkins /etc/rc4.d/S20jenkins -> ../init.d/jenkins /etc/rc5.d/S20jenkins -> ../init.d/jenkins application jdk and JAVA_HOME download jdk 1.8.0_121 $ mkdir -p /opt/java && cd /opt/java $ wget --no-check-certificate \\ -c \\ --header \"Cookie: oraclelicense=accept-securebackup-cookie\" \\ http://download.oracle.com/otn-pub/java/jdk/8u121-b13/e9e7ea248e2c4826b92b3f075a80e441/jdk-8u121-linux-x64.tar.gz # or $ curl -L -C - -b \"oraclelicense=accept-securebackup-cookie\" \\ -O http://download.oracle.com/otn-pub/java/jdk/8u121-b13/e9e7ea248e2c4826b92b3f075a80e441/jdk-8u121-linux-x64.tar.gz $ tar xf jdk-8u121-linux-x64.tar.gz setup java environment $ sudo bash -c 'cat >> /etc/bash.bashrc' setup default jdk $ sudo update-alternatives --install /usr/bin/java java /opt/java/jdk1.8.0_121/bin/java 999 $ sudo update-alternatives --auto java $ sudo update-alternatives --install /usr/bin/javac javac /opt/java/jdk1.8.0_121/bin/javac 999 $ sudo update-alternatives --auto javac groovy download groovy binary pakcage $ mkdir -p /opt/groovy && cd /opt/groovy $ wget --no-check-certificate -c https://akamai.bintray.com/1c/1c4dff3b6edf9a8ced3bca658ee1857cee90cfed1ee3474a2790045033c317a9?__gda__=exp=1490346679~hmac=6d64a1c3596da50e470fb6a46b182ba2cacab553c66843c8ea292e1e70e4e243&response-content-disposition=attachment%3Bfilename%3D%22apache-groovy-binary-2.4.10.zip%22&response-content-type=application%2Foctet-stream&requestInfo=U2FsdGVkX19cWhR3RJcR6SCy74HUcDg470ifD-nH2EiE5uxtdI5EbUiW_jGoHgZZTVR3qgks9tiU5441axygT9z3ykqpL45d_-9oyTlOp8Gild5Z7iGRzCiwf0kba9uza8iWDxnIxgnUIg5tDe6N8ZQ3R0yFCY4c4w7czwBGyK0 $ unzip apache-groovy-binary-2.4.10.zip setup groovy environment $ sudo bash -c 'cat >> /etc/bash.bashrc' Set Default Groovy $ sudo update-alternatives --install /usr/bin/groovy groovy /opt/groovy/groovy-2.4.10/bin/groovy 999999999 $ sudo update-alternatives --auto groovy mysql built from source code build $ sudo groupadd mysql $ sudo useradd -g mysql mysql $ wget http://cdn.mysql.com/archives/mysql-5.5/mysql-5.5.41.tar.gz $ apt install ncurses-dev $ cd myaql-5.5.41 $ cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\ -DDEFAULT_CHARSET=utf8 \\ -DDEFAULT_COLLATION=utf8_general_ci \\ -DENABLED_LOCAL_INFILE=ON \\ -DWITH_INNOBASE_STORAGE_ENGINE=1 \\ -DWITH_FEDERATED_STORAGE_ENGINE=1 \\ -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\ -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \\ -DWITH_DEBUG=0 \\ -DMYSQL_TCP_PORT=3306 $ make $ sudo make install $ sudo systemctl enable mysqld # or $ sysv-rc-conf mysqld on configure $ sudo chown -R mysql:mysql /usr/local/mysql $ /usr/local/mysql/scripts/mysql_install_db --user=mysql $ sudo cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld $ sudo chown -R root /usr/local/mysql/ $ sudo chown -R mysql /usr/local/mysql/data $ /usr/local/mysql/bin/mysqld_safe --user=mysql & $ /usr/local/mysql/bin/mysqladmin -u root password '' # or $ /usr/local/mysql/bin/mysql_secure_installtion install from apt repo $ sudo apt install mysql-server install old version $ sudo add-apt-repository 'deb http://archive.ubuntu.com/ubuntu trusty universe' $ sudo apt update $ sudo apt install mysql-server-5.6 mysql-client-5.6 -y $ sudo mysql_secure_installation reconfiguration $ sudo service mysql start $ sudo mysql_secure_installation mysql-connector (jdbc) download mysql-connector-java-*.tar.gz in mysql official website -> Platform Independent$ wget http://cdn.mysql.com//Downloads/Connector-J/mysql-connector-java-5.1.40.tar.gz Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:14 "},"devops/compilation.html":{"url":"devops/compilation.html","title":"compilation","keywords":"","body":" Table of Contents generated with DocToc ssl.h curl.h expat.h tclsh asciidoc docbook2x-texi hunspell ao ncurses ssl.h issues: git-compat-util.h:213:25: fatal error: openssl/ssl.h: No such file or directory #include \\ Solution: Ubuntu/Debian: $ sudo apt-get install libssl-dev RHEL/CentOS $ sudo yum install openssl-devel curl.h issues: http.h:6:23: fatal error: curl/curl.h: No such file or directory #include \\ Solution: For OpenSuse: $ sudo apt-get install libcurl4-openssl For Ubuntu/Debian: $ sudo apt-get install libcurl4-openssl-dev For RHEL/CentOS: $ sudo yum install libcurl libcurl-devel Reason: libcurl-dev should be installed, but Package libcurl-dev is a virtual package provided by: libcurl4-openssl-dev 7.35.0-1ubuntu2 libcurl4-nss-dev 7.35.0-1ubuntu2 libcurl4-gnutls-dev 7.35.0-1ubuntu2 You should explicitly select one to install. expat.h issues: http-push.c:17:19: fatal error: expat.h: No such file or directory #include \\ Solution: For Ubuntu/Debain: $ apt-cache search expat | grep dev libexpat1-dev - XML parsing C library - development kit lib64expat1-dev - XML parsing C library - development kit (64bit) libexpat-ocaml-dev - OCaml expat bindings lua-expat-dev - libexpat development files for the Lua language tdom-dev - fast XML/DOM/XPath/XSLT extension for Tcl written in C (development files) $ sudo apt-get install libexpat1-dev For RHEL/CentOS:$ sudo yum install expat-devel tclsh issues: tclsh failed; using unoptimized loading MSGFMT po/de.msg make[1]: *** [po/de.msg] Error 127 make: *** [all] Error 2 Solution: For Ubuntu/Debain:$ sudo apt-get install gettext asciidoc issues ASCIIDOC git-add.html /bin/sh: 2: asciidoc: not found make[1]: *** [git-add.html] Error 127 make[1]: Leaving directory `/home/marslo/Tools/Software/Programming/Git/git-master/Documentation' make: *** [doc] Error 2 solution For Ubuntu/Debain: $ apt-cache search asciidoc $ sudo apt-get install asciidoc For RHEL/CentOS: $ yum install docbook-style-xsl $ rpm -ivh http://pkgs.repoforge.org/asciidoc/asciidoc-8.6.9-1.el6.rfx.noarch.rpm docbook2x-texi issues db2texi user-manual.texi /bin/sh: 2: docbook2x-texi: not found make[1]: *** [user-manual.texi] error 127 make[1]: leaving directory `/home/marslo/tools/software/programming/git/git-master/documentation' make: *** [info] error 2 solution For Ubuntu/Debain:$ sudo apt-get install docbook2x For RHEL/CentOS (Inspired from Git for human beings google group):$ sudo yum -y --enablerepo=*epel* install docbook2X $ sudo ln -s /usr/bin/db2x_docbook2texi /usr/bin/docbook2x-texi hunspell issues $ qmake-qt4 Project MESSAGE: Install Prefix is: /usr/local Project ERROR: Package hunspell not found solution For Ubuntu/Debain:$ sudo apt-get install hunspell $ sudo apt-get install libhunspell-dev ao issues $ qmake-qt4 Project MESSAGE: Install Prefix is: /usr/local Project ERROR: Package ao not found solution For Ubuntu/Debain: $ apt-cache search ao | grep dev libao-dev - Cross Platform Audio Output Library Development ... $ sudo apt-get install libao-dev ncurses issues no terminal library found checking for tgetent()... configure: error: NOT FOUND! You need to install a terminal library; for example ncurses. Or specify the name of the library with --with-tlib. solution For RHEL/CentOS:$ yum install ncurses-devel Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:14 "},"devops/mobile.html":{"url":"devops/mobile.html","title":"mobile","keywords":"","body":" Table of Contents generated with DocToc ios get info idevice list apps install app idevicediagnostics andriod environment get info show list install & uninstall ios get info get info from *.plist $ /usr/libexec/PlistBuddy -c \"Print :CFBundleIdentifier\" package/Info.plist com.mycompany.myapp.demo $ /usr/libexec/PlistBuddy -c print package/Info.plist | grep CFBundleVersion CFBundleVersion = 185 get ipa file information $ gem install shenzhen $ ipa info myapp-0.3.0/myapp.ipa security: SecPolicySetValue: One or more parameters passed to a function were not valid. +-----------------------------+---------------------------------------------------------+ | AppIDName | mymobileapp | | ApplicationIdentifierPrefix | 9BXY7H1234 | | CreationDate | 2017-04-13T04:58:51+00:00 | | Platform | iOS | | Entitlements | keychain-access-groups: [\"9BXY7H1234.*\"] | | | get-task-allow: false | | | application-identifier: 9BXY7H1234.com.mycompany.my.app | | | com.apple.developer.healthkit: true | | | com.apple.developer.team-identifier: 9BXY7H1234 | | | aps-environment: production | | ExpirationDate | 2018-04-13T04:58:51+00:00 | | Name | myappPilotAppDistribution | | ProvisionsAllDevices | true | | TeamIdentifier | 9BXY7H1234 | | TeamName | mycompany (China) Investment Co., Ltd | | TimeToLive | 365 | | UUID | 4b73738f-d730-49e4-a8eb-0031275cdee4 | | Version | 1 | | Codesigned | False | +-----------------------------+---------------------------------------------------------+ check version mobileprovision $ unzip -l myapp-0.3.0/myapp.ipa | grep mobileprovision 7589 06-30-2017 17:29 Payload/myapp.app/embedded.mobileprovision get version $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D | egrep \\(.*) details $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D | grep version security: SecPolicySetValue: One or more parameters passed to a function were not valid. $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D | egrep \\1 $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D security: SecPolicySetValue: One or more parameters passed to a function were not valid. AppIDName myapp ApplicationIdentifierPrefix 9BXY7H1234 ... get uuid uuid=$(/usr/libexec/PlistBuddy -c 'Print :UUID' /dev/stdin idevice list real devices $ idevice_id -l 02be8bb96f479db9ff691f7e57c2344d170b363c 521d2bba6b5da32ad61aa7ea516fc45e31300a0f list simulator & devices $ instruments -s devices Known Devices: devops-slave08 [BEFBB759-F3EF-5053-94B4-EC21E6F032F7] devops-iphone (11.2.6) [521d2bba6b5da32ad61aa7ea516fc45e31300a0f] devops-ipad (11.2.6) [02be8bb96f479db9ff691f7e57c2344d170b363c] Apple TV 1080p (10.2) [F546057D-6F75-40C6-ADB2-958ED8ACAF45] (Simulator) iPad (5th generation) (10.3.1) [7D221270-6E99-4C25-B3F0-FD3ABF4ADE38] (Simulator) iPad Air (10.3.1) [C4AC315A-FD89-4D6B-B7B9-3CDA2088A36E] (Simulator) iPad Air 2 (10.3.1) [01F1D17D-5666-4B40-A8DC-F38FB7E3A266] (Simulator) ... list apps $ ideviceinstaller -u ${DEVICEID} --list-apps CFBundleIdentifier, CFBundleVersion, CFBundleDisplayName com.mycompany.my.app, \"1384\", \"myapp\" List the 3rd part apps $ ideviceinstaller -u ${DEVICEID} --list-apps -o list_user CFBundleIdentifier, CFBundleVersion, CFBundleDisplayName com.mycompany.my.app, \"1384\", \"myapp\" list default apps $ ideviceinstaller -u ${DEVICEID} --list-apps -o list_system CFBundleIdentifier, CFBundleVersion, CFBundleDisplayName com.apple.AXUIViewService, \"1\", \"AXUIViewService\" com.apple.AccountAuthenticationDialog, \"1.0\", \"AccountAuthenticationDialog\" com.apple.AdSheetPhone, \"1.0\", \"iAd\" com.apple.AppStore, \"1\", \"App Store\" com.apple.AskPermissionUI, \"1.0\", \"AskPermissionUI\" com.apple.CTCarrierSpaceAuth, \"1\", \"CTCarrierSpaceAuth\" ... install app $ /usr/local/bin/ideviceinstaller -u ${DEVICEID} --install $(find ${WORKSPACE}/package -name \"*.ipa\") WARNING: could not locate iTunesMetadata.plist in archive! WARNING: could not locate Payload/myapp.app/SC_Info/myapp.sinf in archive! Copying '/Users/devops/workspace/platform_mobile_deploy/package/myapp_ios_app-1.1.1389.ipa' to device... DONE. Installing 'com.mycompany.my.app' Install: CreatingStagingDirectory (5%) Install: ExtractingPackage (15%) Install: InspectingPackage (20%) Install: TakingInstallLock (20%) Install: PreflightingApplication (30%) Install: InstallingEmbeddedProfile (30%) Install: VerifyingApplication (40%) Install: CreatingContainer (50%) Install: InstallingApplication (60%) Install: PostflightingApplication (70%) Install: SandboxingApplication (80%) Install: GeneratingApplicationMap (90%) Install: Complete idevicediagnostics restart device $ idevicediagnostics restart -u ${DEVICEID} Restarting device. get provision $ idevicediagnostics diagnostics All -u ${DEVICEID} GasGauge CycleCount 3 DesignCapacity 1810 FullChargeCapacity 1900 Status Success idevicepair $ idevicepair pair -u 521d2bba6b5da32ad61aa7ea516fc45e31300a0f SUCCESS: Paired with device 521d2bba6b5da32ad61aa7ea516fc45e31300a0f $ idevicepair pair -u 02be8bb96f479db9ff691f7e57c2344d170b363c SUCCESS: Paired with device 02be8bb96f479db9ff691f7e57c2344d170b363c ideviceprovision $ ideviceprovision list -u ${DEVICEID} Device has 4 provisioning profiles installed: 4b73738f-d730-49e4-a8eb-0031275cdee4 - myappPilotAppDistribution b84ef185-a387-4a1d-8a41-3230708c6b31 - iOS Team Provisioning Profile: com.mycompany.cdtest.WebDriverAgentRunner 59ecee46-f43f-4a87-a89e-f9b03f14cf01 - XC iOS: com.mycompany.myapp.demo 83d90272-79fe-4f8f-8ea5-8f18f60b5683 - myappDemoDev andriod environment $ ln -sf /opt/android/platform-tools/adb /usr/local/bin/adb $ ln -sf /opt/android/build-tools/27.0.3/aapt /usr/local/bin/aapt $ ln -sf /opt/android/build-tools/27.0.3/aapt2 /usr/local/bin/aapt2 get info get bundle id from *.ipa $ aapt dump badging ${apkFile} | grep package | sed -r -e \"s:^.*name='([^']*).*$:\\\\1:\" $ aapt dump badging package/myapp-1.3.85.apk | grep package | sed -r -e \"s:^.*name='([^']*).*$:\\\\1:\" com.mycompany.myapp.demo $ aapt dump badging package/myapp-1.3.85.apk | grep package package: name='com.mycompany.myapp.demo' versionCode='1030085' versionName='1.3.85' platformBuildVersionName='8.0.0' $ aapt dump badging package/myapp-1.3.85.apk package: name='com.mycompany.myapp.demo' versionCode='1030085' versionName='1.3.85' platformBuildVersionName='8.0.0' sdkVersion:'19' targetSdkVersion:'26' uses-permission: name='android.permission.INTERNET' uses-permission: name='android.permission.ACCESS_NETWORK_STATE' uses-permission: name='android.permission.ACCESS_WIFI_STATE' uses-permission: name='android.permission.READ_PHONE_STATE' uses-permission: name='android.permission.WRITE_EXTERNAL_STORAGE' uses-permission: name='android.permission.READ_EXTERNAL_STORAGE' ... get imei $ adb shell service call iphonesubinfo 1 | awk -F \"'\" '{print $2}' | sed '1 d' | tr -d '.' | awk '{print}' ORS= 864226033999836 $ echo \"[device.imei]: [$(adb shell service call iphonesubinfo 1 | awk -F \"'\" '{print $2}' | sed '1 d'| tr -d '\\n' | tr -d '.' | tr -d ' ')]\" [device.imei]: [864226033999836] $ echo \"[device.imei]: [$(adb shell service call iphonesubinfo 1 | awk -F \"'\" '{print $2}' | sed '1 d'| tr -d '\\n' | tr -d '.' | tr -d ' ')]\"; adb shell getprop | grep \"model\\|version.sdk\\|manufacturer\\|ro.serialno\\|product.name\\|brand\\|version.release\\|build.id\\|security_patch\" | sed 's/ro\\.//g' [device.imei]: [864226033999836] [persist.sys.modelnumber]: [NX569H] [build.id]: [MMB29M] [build.version.release]: [6.0.1] [build.version.sdk]: [23] [build.version.security_patch]: [2017-02-01] [product.brand]: [nubia] [product.manufacturer]: [nubia] [product.model]: [NX569H] [product.name]: [NX569H] [serialno]: [fac7ea46] get andriod version $ adb shell getprop ro.build.version.release 6.0.1 show list list installed apps $ adb -s fac7ea46 shell 'pm list packages' | grep 'com.mycompany.myapp.demo' package:com.mycompany.myapp.demo list all apps $ adb -s ${DEVICEID} shell 'pm list packages -f' | sed -e 's/.*=//' | sed 's/\\r//g' | sort android cn.nubia.accounts cn.nubia.aftersale cn.nubia.applockmanager cn.nubia.apps cn.nubia.appsettingsinfoproviders cn.nubia.autoagingtest cn.nubia.bbs cn.nubia.bootanimationinfo ... list connected device $ adb devices List of devices attached fac7ea46 device $ adb devices -l List of devices attached fac7ea46 device usb:343089152X product:NX569H model:NX569H device:NX569H transport_id:2 install & uninstall install $ adb -s ${DEVICEID} install -r \"$(find . -name '*.apk')\" $ adb -s fac7ea46 install ${WORKSPACE}/package/myapp-1.3.84.apk [ 0%] /data/local/tmp/myapp-1.3.84.apk [ 1%] /data/local/tmp/myapp-1.3.84.apk [ 2%] /data/local/tmp/myapp-1.3.84.apk [ 3%] /data/local/tmp/myapp-1.3.84.apk [ 3%] /data/local/tmp/myapp-1.3.84.apk [ 4%] /data/local/tmp/myapp-1.3.84.apk [ 5%] /data/local/tmp/myapp-1.3.84.apk [ 6%] /data/local/tmp/myapp-1.3.84.apk [ 7%] /data/local/tmp/myapp-1.3.84.apk [ 7%] /data/local/tmp/myapp-1.3.84.apk ... uninstall $ adb -s ${DEVICEID} uninstall ${BUNDLEID} e.g.: $ adb -s fac7ea46 uninstall com.mycompany.myapp.demo Success $ if adb -s fac7ea46 shell 'pm list packages' | grep 'com.mycompany.myapp.demo'; then > adb -s fac7ea46 uninstall com.mycompany.myapp.demo > fi Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:16 "},"devops/network.html":{"url":"devops/network.html","title":"network","keywords":"","body":" Table of Contents generated with DocToc interface change interface name show route DNS add new DNS permanently Port Redirection proxy setup network speed wifi iwconfig nmcli nmtui reference: ARCH NetWork Configuration How do I add a DNS server via resolv.conf? How to Configure and Manage Network Connections Using ‘nmcli’ Tool 9 张动图让明白网络性能的四大指标：带宽、时延、抖动、丢包 interface change interface name Permanent Solution $ sudo touch /etc/udev/rules.d/10-network.rules $ sudo bash -c \"cat > /etc/udev/rules.d/10-network.rules\" \", KERNEL==\"\", NAME=\"\" EOF e.g.: $ nmcli connection NAME UUID TYPE DEVICE WLAN-PUB 2cde1f25-8c28-4318-9781-b9fcdabd985d wifi wlp2s0 Wired connection 1 f72d569d-065b-3bc8-98ae-e07f8bf46945 ethernet enp0s31f6 cni0 dcfc10c6-5421-4405-9d56-b3bb595780f5 bridge cni0 docker0 29822e8f-772f-4e67-8052-55b9e6c9e298 bridge docker0 $ sudo bash -c \"cat > /etc/udev/rules.d/10-network.rules\" temporary Solution $ sudo ifconfig down $ sudo ip link set name $ sudo ifconfig e.g.: $ nmcli dev DEVICE TYPE STATE CONNECTION wlp2s0 wifi connected WLAN-PUB cni0 bridge connected cni0 enp0s31f6 ethernet connected Wired connection 1 docker0 bridge connected docker0 flannel.1 vxlan disconnected -- veth1890b284 ethernet unmanaged -- veth5145289b ethernet unmanaged -- vetha9ee773c ethernet unmanaged -- vethf5a48bb2 ethernet unmanaged -- lo loopback unmanaged -- $ nmcli connection NAME UUID TYPE DEVICE WLAN-PUB 2cde1f25-8c28-4318-9781-b9fcdabd985d wifi wlp2s0 Wired connection 1 f72d569d-065b-3bc8-98ae-e07f8bf46945 ethernet enp0s31f6 cni0 dcfc10c6-5421-4405-9d56-b3bb595780f5 bridge cni0 docker0 29822e8f-772f-4e67-8052-55b9e6c9e298 bridge docker0 $ sudo ifconfig enp0s31f6 down; sudo ip link set enp0s31f6 name eth0; sudo ifconfig eth0 up $ nmcli dev DEVICE TYPE STATE CONNECTION wlp2s0 wifi connected WLAN-PUB cni0 bridge connected cni0 docker0 bridge connected docker0 eth0 ethernet connected Wired connection 1 flannel.1 vxlan disconnected -- veth1890b284 ethernet unmanaged -- veth5145289b ethernet unmanaged -- vetha9ee773c ethernet unmanaged -- vethf5a48bb2 ethernet unmanaged -- lo loopback unmanaged -- $ nmcli connection NAME UUID TYPE DEVICE WLAN-PUB 2cde1f25-8c28-4318-9781-b9fcdabd985d wifi wlp2s0 Wired connection 1 f72d569d-065b-3bc8-98ae-e07f8bf46945 ethernet eth0 cni0 e557e9bc-754e-4dc9-b9db-4519a7b15c33 bridge cni0 docker0 47c195b8-4867-40d3-acec-c28223e2b013 bridge docker0 show ethtool $ sudo ethtool eth0 Settings for eth0: Supported ports: [ TP ] Supported link modes: 10baseT/Half 10baseT/Full 100baseT/Half 100baseT/Full 1000baseT/Full Supported pause frame use: No Supports auto-negotiation: Yes Supported FEC modes: Not reported Advertised link modes: 10baseT/Half 10baseT/Full 100baseT/Half 100baseT/Full 1000baseT/Full Advertised pause frame use: No Advertised auto-negotiation: Yes Advertised FEC modes: Not reported Speed: 100Mb/s Duplex: Full Port: Twisted Pair PHYAD: 1 Transceiver: internal Auto-negotiation: on MDI-X: on (auto) Supports Wake-on: pumbg Wake-on: g Current message level: 0x00000007 (7) drv probe link Link detected: yes list hardware $ sudo lshw -class network *-network description: Wireless interface product: Wireless 8260 vendor: Intel Corporation physical id: 0 bus info: pci@0000:02:00.0 logical name: wlan0 version: 3a serial: 34:f3:9a:52:75:65 width: 64 bits clock: 33MHz capabilities: pm msi pciexpress bus_master cap_list ethernet physical wireless configuration: broadcast=yes driver=iwlwifi driverversion=4.15.0-23-generic firmware=34.0.1 ip=192.168.10.235 latency=0 link=yes multicast=yes wireless=IEEE 802.11 resources: irq:129 memory:e4100000-e4101fff *-network description: Ethernet interface product: Ethernet Connection (2) I219-LM vendor: Intel Corporation physical id: 1f.6 bus info: pci@0000:00:1f.6 logical name: eth0 version: 31 serial: 30:e1:71:95:19:bc size: 100Mbit/s capacity: 1Gbit/s width: 32 bits clock: 33MHz capabilities: pm msi bus_master cap_list ethernet physical tp 10bt 10bt-fd 100bt 100bt-fd 1000bt-fd autonegotiation configuration: autonegotiation=on broadcast=yes driver=e1000e driverversion=3.2.6-k duplex=full firmware=0.8-4 ip=130.147.182.57 latency=0 link=yes multicast=yes port=twisted pair speed=100Mbit/s resources: irq:127 memory:e4300000-e431ffff *-network:0 description: Ethernet interface physical id: 2 logical name: veth680e7b1b serial: 86:86:ae:b1:3f:c3 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s *-network:1 description: Ethernet interface physical id: 3 logical name: vethdd057c06 serial: ae:b1:42:e3:30:d0 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s *-network:2 description: Ethernet interface physical id: 4 logical name: vethfe693595 serial: 16:ec:cd:4e:c3:d8 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s *-network:3 description: Ethernet interface physical id: 5 logical name: flannel.1 serial: 2a:2b:77:a7:35:8f capabilities: ethernet physical configuration: broadcast=yes driver=vxlan driverversion=0.1 ip=10.244.0.0 link=yes multicast=yes *-network:4 description: Ethernet interface physical id: 6 logical name: cni0 serial: 0a:58:0a:f4:00:01 capabilities: ethernet physical configuration: broadcast=yes driver=bridge driverversion=2.3 firmware=N/A ip=10.244.0.1 link=yes multicast=yes *-network:5 description: Ethernet interface physical id: 7 logical name: docker0 serial: 02:42:99:41:e5:02 capabilities: ethernet physical configuration: broadcast=yes driver=bridge driverversion=2.3 firmware=N/A ip=172.17.0.1 link=no multicast=yes *-network:6 description: Ethernet interface physical id: 8 logical name: vethc1b38134 serial: 76:6a:6c:0f:e8:a1 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s route $ nslookup my.gitlab.company.com Server: 130.147.236.5 Address: 130.147.236.5#53 Non-authoritative answer: Name: pww.gitlab.cdi.mycompany.com Address: 130.147.219.15 $ $ ip route get 130.147.219.15 130.147.219.15 dev eno1 src 130.147.182.240 uid 1000 cache $ nslookup github.com Server: 130.147.236.5 Address: 130.147.236.5#53 Non-authoritative answer: Name: github.com Address: 192.30.253.112 Name: github.com Address: 192.30.253.113 $ ip route get 192.30.253.113 192.30.253.113 via 192.168.10.1 dev wlan0 src 192.168.11.166 uid 1000 cache or $ ip route show default via 192.168.10.1 dev wlan0 proto dhcp metric 600 10.244.0.0/24 dev cni0 proto kernel scope link src 10.244.0.1 130.140.0.0/16 dev eth0 scope link 130.145.0.0/16 dev eth0 scope link 130.146.0.0/16 dev eth0 scope link 130.147.0.0/16 dev eth0 scope link 130.147.182.0/23 dev eth0 proto kernel scope link src 130.147.182.57 metric 100 137.55.0.0/16 dev eth0 scope link 161.83.0.0/16 dev eth0 scope link 161.84.0.0/16 dev eth0 scope link 161.85.0.0/16 dev eth0 scope link 161.88.0.0/16 dev eth0 scope link 161.91.0.0/16 dev eth0 scope link 161.92.0.0/16 dev eth0 scope link 169.254.0.0/16 dev eth0 scope link metric 1000 172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown 185.166.0.0/16 dev eth0 scope link 192.168.10.0/23 dev wlan0 proto kernel scope link src 192.168.10.235 metric 600 or $ route -n Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface 0.0.0.0 192.168.10.1 0.0.0.0 UG 600 0 0 wlan0 10.244.0.0 0.0.0.0 255.255.255.0 U 0 0 0 cni0 130.140.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.145.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.146.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.147.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.147.182.0 0.0.0.0 255.255.254.0 U 100 0 0 eth0 137.55.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.83.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.84.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.85.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.88.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.91.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.92.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 169.254.0.0 0.0.0.0 255.255.0.0 U 1000 0 0 eth0 172.17.0.0 0.0.0.0 255.255.0.0 U 0 0 0 docker0 185.166.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 192.168.10.0 0.0.0.0 255.255.254.0 U 600 0 0 wlan0 DNS add new DNS permanently $ sudo apt install resolvconf $ sudo cp /etc/resolvconf/resolv.conf.d/head{,.org} $ sudo bash -c \"cat > /etc/resolvconf/resolv.conf.d/head\" Port Redirection $ sudo iptables -L -n Chain INPUT (policy ACCEPT) target prot opt source destination Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination $ sudo iptables -I INPUT 1 -p tcp --dport 8080 -j ACCEPT $ sudo iptables -I INPUT 1 -p tcp --dport 80 -j ACCEPT $ sudo iptables -A PREROUTING -t nat -i ens32 -p tcp --dport 80 -j REDIRECT --to-port 8080 $ sudo iptables -t nat -I OUTPUT -p tcp -d 127.0.0.1 --dport 80 -j REDIRECT --to-ports 8080 $ sudo iptables -t nat -I OUTPUT -p tcp -o lo --dport 80 -j REDIRECT --to-ports 8080 $ sudo iptables -L -n Chain INPUT (policy ACCEPT) target prot opt source destination ACCEPT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:80 ACCEPT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:8080 Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination $ sudo netfilter-persistent save run-parts: executing /usr/share/netfilter-persistent/plugins.d/15-ip4tables save run-parts: executing /usr/share/netfilter-persistent/plugins.d/25-ip6tables save $ sudo iptables-save > /etc/iptables/rules.v4 proxy setup Name: x.x.x.x Port: 80 Settings $ grep proxy /etc/profile export http_proxy=x.x.x.x:80 export https_proxy=x.x.x.x:80 export no_proxy=localhost,127.0.0.1,*.google.com network speed $ ifstat -n -i en7 en7 KB/s in KB/s out 7.35 1.15 4.91 1.02 6.05 0.80 8.36 1.78 wifi iwconfig installation $ sudo apt install wireless-tools get wireless card $ WIRELESSCARD=\"$(iwconfig 2>/dev/null | /bin/grep ESSID | awk -F' ' '{print $1}')\" $ iwconfig 2>/dev/null | \\grep ESSID wlx24050f15c19b IEEE 802.11 ESSID:\"MERCURY_07FA\" wireless network details $ sudo iwlist scan docker0 Interface doesn't support scanning. eno1 Interface doesn't support scanning. lo Interface doesn't support scanning. cni0 Interface doesn't support scanning. flannel.1 Interface doesnt support scanning. wlx24050f15c19b Scan completed : Cell 01 - Address: 50:3A:A0:CB:07:FA Channel:1 Frequency:2.412 GHz (Channel 1) Quality=55/70 Signal level=-55 dBm Encryption key:on ESSID:\"MERCURY_07FA\" Bit Rates:1 Mb/s; 2 Mb/s; 5.5 Mb/s; 11 Mb/s; 9 Mb/s 18 Mb/s; 36 Mb/s; 54 Mb/s Bit Rates:6 Mb/s; 12 Mb/s; 24 Mb/s; 48 Mb/s Mode:Master ... or $ nmcli --show-secrets connection show 'MERCURY_07FA' connection.id: MERCURY_07FA connection.uuid: 8e362f4a-d3a3-4147-b31e-4519954b55ef connection.stable-id: -- connection.type: 802-11-wireless connection.interface-name: -- connection.autoconnect: yes connection.autoconnect-priority: 0 connection.autoconnect-retries: -1 (default) connection.auth-retries: -1 connection.timestamp: 1530689982 connection.read-only: no ... nmcli show available wifi$ sudo nmcli device wifi rescan $ nmcli dev wifi list IN-USE SSID MODE CHAN RATE SIGNAL BARS SECURITY CDI_TP-LINK Infra 11 405 Mbit/s 100 ▂▄▆█ WPA1 WPA2 TP-LINK_CDI Infra 1 270 Mbit/s 82 ▂▄▆█ WPA1 WPA2 WLAN-PUB Infra 4 54 Mbit/s 82 ▂▄▆█ WPA1 WPA2 HiWiFi_Pins Infra 7 270 Mbit/s 82 ▂▄▆█ WPA1 WPA2 -- Infra 1 54 Mbit/s 59 ▂▄▆_ -- * MERCURY_07FA Infra 1 270 Mbit/s 55 ▂▄__ WPA1 WPA2 Automation-Local Infra 9 195 Mbit/s 55 ▂▄__ WPA2 ChinaUnicom Infra 1 54 Mbit/s 42 ▂▄__ -- 61-PUB Infra 1 270 Mbit/s 29 ▂___ WPA2 HC_Guest Infra 6 405 Mbit/s 29 ▂___ WPA1 WPA2 HuaCloud_AP Infra 6 405 Mbit/s 29 ▂___ WPA1 WPA2 56qq-guest Infra 6 195 Mbit/s 25 ▂___ WPA2 56qq-sec Infra 1 195 Mbit/s 22 ▂___ WPA2 802.1X 56qq-guest Infra 1 195 Mbit/s 22 ▂___ WPA2 HCB Infra 1 195 Mbit/s 19 ▂___ WPA2 802.1X show saved wifi list$ nmcli c ( = $ nmcli connection) NAME UUID TYPE DEVICE WLAN-PUB 545d5d95-723f-4e1b-b764-8e9bd2fe6a9f wifi wlp2s0 Wired connection 1 a2a10a61-4519-3380-9301-c6e2a592eaa7 ethernet enp0s31f6 CDI_TP-LINK_5G cb00cf00-58ca-4668-9b4c-e1fb3b18c932 wifi -- nmtui Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:14 "},"devops/nginx&cert.html":{"url":"devops/nginx&cert.html","title":"nginx&cert","keywords":"","body":" Table of Contents generated with DocToc nginx installation configuration ssl cert generate cert for server check certs cert in Nginx cert in os MacOS artifactory https general SSL certs nginx installation $ sudo apt udpate $ sudo apt install nginx configuration $ sudo ufw app list Available applications: CUPS Nginx Full Nginx HTTP Nginx HTTPS OpenSSH Postfix Postfix SMTPS Postfix Submission or$ sudo ufw allow 'Nginx HTTP' ssl cert generate cert for server CA (root cert) $ openssl genrsa -aes256 \\ -out www.artifactory.mycompany.com-ca.key \\ 2048 $ openssl req -new \\ -x509 \\ -days 365 \\ -sha256 \\ -key www.artifactory.mycompany.com-ca.key \\ -out www.artifactory.mycompany.com-ca.crt \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com\" $ openssl genrsa -aes256 -out www.artifactory.mycompany.com-ca.key 2048 Generating RSA private key, 2048 bit long modulus ....................................................................+++ ...................................................+++ unable to write 'random state' e is 65537 (0x10001) Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory Verifying - Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory $ openssl req -new \\ -x509 \\ -sha256 \\ -days 365 \\ -key www.artifactory.mycompany.com-ca.key \\ -out www.artifactory.mycompany.com-ca.crt \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory cert for server $ openssl genrsa -out www.artifactory.mycompany.com-server.key 2048 $ openssl req -sha256 -new -key www.artifactory.mycompany.com-server.key -out www.artifactory.mycompany.com-server.csr -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" $ openssl genrsa -out www.artifactory.mycompany.com-server.key 2048 Generating RSA private key, 2048 bit long modulus ......................................................................+++ ............................................................................................................................................................................................................................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req -sha256 \\ -new \\ -key www.artifactory.mycompany.com-server.key \\ -out www.artifactory.mycompany.com-server.csr \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" sign the server cert with CA $ echo subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req -days 365 -sha256 -in www.artifactory.mycompany.com-server.csr -CA www.artifactory.mycompany.com-ca.crt -CAkey www.artifactory.mycompany.com-ca.key -CAcreateserial -out www.artifactory.mycompany.com-server.crt -extfile extfile.cnf $ echo subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -in www.artifactory.mycompany.com-server.csr \\ -CA www.artifactory.mycompany.com-ca.crt \\ -CAkey www.artifactory.mycompany.com-ca.key \\ -CAcreateserial \\ -out www.artifactory.mycompany.com-server.crt \\ -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Getting CA Private Key Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactory unable to write 'random state' $ ls extfile.cnf www.artifactory.mycompany.com-ca.key www.artifactory.mycompany.com-server.csr www.srl www.artifactory.mycompany.com-ca.crt www.artifactory.mycompany.com-server.crt www.artifactory.mycompany.com-server.key generate client cert and signed by CA $ openssl genrsa -out www.artifactory.mycompany.com-client.key $ openssl req -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" -new -key www.artifactory.mycompany.com-client.key -out www.artifactory.mycompany.com-client.csr $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -in www.artifactory.mycompany.com-client.csr \\ -CA www.artifactory.mycompany.com-ca.crt \\ -CAkey www.artifactory.mycompany.com-ca.key \\ -CAcreateserial \\ -out www.artifactory.mycompany.com-client.cert \\ -extfile extfile.cnf $ openssl genrsa -out www.artifactory.mycompany.com-client.key 2048 Generating RSA private key, 2048 bit long modulus ................................................+++ .......................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com\" -new \\ -key www.artifactory.mycompany.com-client.key \\ -out www.artifactory.mycompany.com-client.csr $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ cat extfile.cnf subjectAltName = DNS:www.artifactory.mycompany.com,IP:130.147.219.19 extendedKeyUsage = serverAuth extendedKeyUsage = clientAuth $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -in www.artifactory.mycompany.com-client.csr \\ -CA www.artifactory.mycompany.com-ca.crt \\ -CAkey www.artifactory.mycompany.com-ca.key \\ -CAcreateserial \\ -out www.artifactory.mycompany.com-client.cert \\ -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Getting CA Private Key Enter pass phrase for www.artifactory.mycompany.com-ca.key:artifactor unable to write 'random state' update the file perm $ sudo chmod -v 0444 www.artifactory.mycompany.com-ca.crt www.artifactory.mycompany.com-server.crt client.cert $ sudo chmod -v 0400 www.artifactory.mycompany.com-ca.key client.key www.artifactory.mycompany.com-server.key check certs crt $ openssl x509 -noout \\ -text \\ -in www.artifactory.mycompany.com-server.crt $ openssl x509 -noout -text -in www.artifactory.mycompany.com-ca.crt Certificate: Data: Version: 3 (0x2) Serial Number: 15145698426239402702 (0xd23054792b3142ce) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Validity Not Before: Jan 2 11:35:31 2018 GMT Not After : Jan 2 11:35:31 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:d0:3f:b6:c5:e5:52:8d:c7:26:3f:e7:0a:7a:5f: c1:71:2a:9e:34:07:7e:10:4a:3d:c4:4f:f7:df:58: 93:0d:fa:00:e8:21:75:6d:d1:45:7d:bd:27:f2:c5: 08:13:8f:4f:be:91:9f:28:19:7e:c3:a7:42:1b:fc: b4:96:21:8a:33:59:79:27:a3:cf:13:3e:cd:92:0d: 7e:b9:9f:0d:01:bf:27:5f:e4:7a:7d:db:69:a3:78: 96:a8:c3:a9:2d:31:28:97:ba:6c:20:17:ab:eb:85: ce:2c:25:e8:3e:a0:8b:c0:0b:b2:a9:e1:ac:9f:e1: 57:35:bb:64:6a:99:2e:8f:27:f1:04:40:a7:16:32: 31:4e:ad:18:5e:9e:0b:dd:42:17:af:8a:58:c6:1a: e9:00:52:97:7b:7a:24:cc:b1:81:8d:b9:20:60:e4: 96:d5:77:82:07:4e:df:9c:3a:26:95:d5:ed:aa:a1: 24:94:64:0e:93:9a:9e:9b:d4:78:6b:46:50:69:05: 19:6a:ff:7b:1d:1b:0f:ce:6b:30:33:c7:99:9d:6a: 30:0c:fc:f8:74:00:df:65:6f:fa:1b:24:0a:73:77: 4d:94:45:27:9b:93:a6:81:37:57:57:6f:e9:ae:e4: 5e:a8:b8:be:31:0f:73:4b:9e:1b:ed:78:5c:48:ec: 0b:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: IP Address:130.147.219.19 X509v3 Subject Key Identifier: 23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Authority Key Identifier: keyid:23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Basic Constraints: CA:TRUE Signature Algorithm: sha256WithRSAEncryption 69:a3:fe:35:63:a5:e8:4e:e6:3e:4f:9d:f6:82:3d:73:f2:a7: 22:c1:46:e5:09:5e:61:81:b7:70:3c:62:ba:43:7d:bd:ac:67: d0:41:ea:a7:b8:41:47:04:bc:41:9a:46:35:31:3f:62:10:7a: 58:73:45:3a:59:3b:41:6b:2b:1e:62:42:b7:7e:c1:6b:92:25: 2a:df:3f:69:b5:26:8e:c7:5d:c6:24:a0:65:21:b7:63:74:60: 7f:3b:0e:9a:80:a4:4f:a2:79:20:19:92:64:60:b7:53:5c:09: 6e:46:6e:7a:d7:ee:ef:f4:2e:27:7a:1a:0e:da:5b:8b:7a:bf: 40:56:9f:16:63:6b:89:ab:48:65:07:45:e0:a0:21:7c:0f:6d: 9c:2a:ab:ca:d0:02:06:8a:39:7a:ea:65:b9:04:13:0f:6b:cd: ea:e5:9f:59:c5:d2:06:b2:e4:c3:cb:ab:59:69:aa:11:e6:08: 49:12:cc:d4:29:21:2b:59:c1:dc:bb:e6:a9:7d:96:68:a4:7b: 61:76:8a:21:a9:69:a5:83:d5:8b:f6:08:4e:c0:34:64:6b:65: 96:ac:ed:cd:c1:0b:54:7d:a9:57:07:77:0c:6a:43:9e:4f:c0: 6c:12:88:e8:cf:34:08:67:af:1c:2f:bb:49:54:1b:17:95:89: b3:2d:c9:5f $ openssl x509 -noout -text -in www.artifactory.mycompany.com-server.crt Certificate: Data: Version: 3 (0x2) Serial Number: 12625600037876864867 (0xaf37245755cf1763) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Validity Not Before: Jan 2 11:39:47 2018 GMT Not After : Jan 2 11:39:47 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: DNS:www.artifactory.mycompany.com, IP Address:130.147.219.19 X509v3 Extended Key Usage: TLS Web Server Authentication Signature Algorithm: sha256WithRSAEncryption 3d:e8:81:f2:ab:89:47:e2:2c:8c:5a:54:31:c2:2a:11:37:e6: ab:89:ff:d1:c2:8c:8e:3a:7d:d2:1d:28:3e:9e:5f:9e:89:08: 78:2e:16:32:52:e7:35:ab:66:09:a4:83:85:42:55:d6:7c:4f: 37:cf:8d:37:bd:57:d0:00:f2:9c:67:68:a2:ed:49:c6:eb:0f: b7:49:ba:ae:12:35:82:a6:a5:b6:5e:f7:68:08:f7:3f:a1:73: d2:94:3e:7a:d9:5c:e1:e2:ab:12:46:66:9d:59:3a:e1:2d:aa: a6:53:97:40:ac:a3:ca:80:6d:5b:75:dc:c4:ee:10:48:55:2c: 10:00:43:07:e6:c4:16:09:fb:04:5d:78:8e:85:21:21:75:01: a5:af:c0:c0:d1:fd:33:6e:5b:24:8b:f8:e6:1c:df:b7:f1:e5: 38:02:d4:a8:e1:09:93:2e:8d:19:ea:e2:11:3f:c1:fe:75:bb: ef:03:6e:c3:50:77:a5:54:7d:7e:e0:cd:85:20:08:41:38:b2: 86:65:aa:58:51:1b:7b:ed:6a:07:0f:cc:ab:49:d8:34:ec:5d: fd:0d:75:48:81:3c:a5:bc:ce:c0:95:8c:8e:d3:8c:0f:0d:a3: a7:73:70:bc:59:89:7c:42:25:0b:cb:2f:b0:86:4a:46:56:f2: e9:d9:63:f1 csr $ openssl req -noout -text -in www.artifactory.mycompany.com-server.csr $ openssl req -noout -text -in www.artifactory.mycompany.com-server.csr Certificate Request: Data: Version: 0 (0x0) Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=www.artifactory.mycompany.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) Attributes: a0:00 Signature Algorithm: sha256WithRSAEncryption 74:99:e5:36:44:b4:48:a9:50:83:eb:61:02:37:6c:8a:46:45: 0e:58:04:40:66:55:56:fc:fd:cf:15:a0:31:be:de:3a:16:4f: 9a:46:1d:17:33:7f:38:dd:36:a9:76:e5:92:b2:48:29:60:e7: af:c0:f6:76:0d:9a:a6:40:43:a8:98:75:90:c3:c1:2a:7d:51: 1d:df:1b:50:8b:69:ce:7c:74:cf:03:9d:69:6b:41:7f:ed:bc: f1:6c:c0:93:22:36:5e:f7:8c:d0:f7:f5:0f:dc:51:93:1e:23: cc:12:cd:f3:0e:6c:1b:4e:b2:df:01:86:5b:d0:79:c8:6e:c8: 57:72:a8:dd:81:8a:af:c3:52:e2:ff:e8:f1:3d:6f:cb:e4:a9: 1c:51:58:b9:31:00:c0:88:5e:ca:63:59:f8:d7:82:d4:22:30: 0c:d8:bd:e6:01:11:d2:4a:68:64:d1:8e:d5:a1:19:0c:5a:99: 25:cd:c2:e5:ed:f3:48:e3:c0:7a:00:a3:a8:09:8e:d3:50:2a: 84:29:63:66:50:3e:42:af:43:ea:fa:5b:28:f9:f1:84:89:88: 2e:7f:8d:bf:44:29:83:fa:89:b3:b8:3c:13:98:20:76:6c:d3: 67:ce:03:9e:15:ea:3e:9d:4b:cb:c2:78:ab:57:1d:b7:e8:9e: 81:1b:b5:1f cert in Nginx $ grep ssl_certificate /etc/nginx/sites-enabled/artifactoryv2.conf ssl_certificate /etc/nginx/certs/www.artifactory.mycompany.com/www.artifactory.mycompany.com-server.crt; ssl_certificate_key /etc/nginx/certs/www.artifactory.mycompany.com/www.artifactory.mycompany.com-server.key; cert in os MacOS add $ sudo security add-trusted-cert -d \\ -r trustRoot \\ -k \"/Library/Keychains/System.keychain\" \\ \"/Users/marslo/Downloads/www.artifactory.mycompany.com-ca.crt\" search $ security find-certificate -a -c -Z $ security find-certificate -a -c artifactor -Z | grep SHA-1 SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E $ security list-keychain \"/Users/marslo/Library/Keychains/login.keychain-db\" \"/Library/Keychains/System.keychain\" $ security find-certificate -a -c artifactor -Z SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E keychain: \"/Library/Keychains/System.keychain\" version: 256 class: 0x80001000 attributes: \"alis\"=\"marslo.jiao@mycompany.com\" \"cenc\"=0x00000003 \"ctyp\"=0x00000001 \"hpky\"=0x2332.. \"##2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"issu\"=0x3081.. \"0\\201\\2431..CN1\\0200..Sichuan1\\0200..Chengdu1\\0200..mycompany1\\0140..CDI1(0&\\006..www.artifactory.mycompany.com1&0$\\006..*\\206H\\..marslo.jiao@mycompany.com\" \"labl\"=\"www.artifactory.mycompany.com\" \"skid\"=0x2332.. \"##2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"snbr\"=0x00D23054792B3142CE \"\\000\\3220Ty+1B\\316\" \"subj\"=0x3081.. \"0\\201\\2431..CN1\\0200..Sichuan1\\0200..Chengdu1\\0200..mycompany1\\0140..CDI1(0&\\006..www.artifactory.mycompany.com1&0$\\006..*\\206H\\..marslo.jiao@mycompany.com\" $ security find-certificate -a -c artifactor -Z -p -m SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E email addresses: marslo.jiao@mycompany.com -----BEGIN CERTIFICATE----- MIIELDCCAxSgAwIBAgIJANIwVHkrMULOMA0GCSqGSIb3DQEBCwUAMIGjMQswCQYD VQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdkdTEQMA4G A1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cuYXJ0aWZh Y3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJzbG8uamlh b0BwaGlsaXBzLmNvbTAeFw0xODAxMDIxMTM1MzFaFw0xOTAxMDIxMTM1MzFaMIGj MQswCQYDVQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdk dTEQMA4GA1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cu YXJ0aWZhY3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJz bG8uamlhb0BwaGlsaXBzLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC ggEBANA/tsXlUo3HJj/nCnpfwXEqnjQHfhBKPcRP999Ykw36AOghdW3RRX29J/LF CBOPT76RnygZfsOnQhv8tJYhijNZeSejzxM+zZINfrmfDQG/J1/ken3baaN4lqjD qS0xKJe6bCAXq+uFziwl6D6gi8ALsqnhrJ/hVzW7ZGqZLo8n8QRApxYyMU6tGF6e C91CF6+KWMYa6QBSl3t6JMyxgY25IGDkltV3ggdO35w6JpXV7aqhJJRkDpOanpvU eGtGUGkFGWr/ex0bD85rMDPHmZ1qMAz8+HQA32Vv+hskCnN3TZRFJ5uTpoE3V1dv 6a7kXqi4vjEPc0ueG+14XEjsC6UCAwEAAaNhMF8wDwYDVR0RBAgwBocEgpPbEzAd BgNVHQ4EFgQUIzK8YZ5RjpQiMFuuaIp+jlPSRXwwHwYDVR0jBBgwFoAUIzK8YZ5R jpQiMFuuaIp+jlPSRXwwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEA aaP+NWOl6E7mPk+d9oI9c/KnIsFG5QleYYG3cDxiukN9vaxn0EHqp7hBRwS8QZpG NTE/YhB6WHNFOlk7QWsrHmJCt37Ba5IlKt8/abUmjsddxiSgZSG3Y3RgfzsOmoCk T6J5IBmSZGC3U1wJbkZuetfu7/QuJ3oaDtpbi3q/QFafFmNriatIZQdF4KAhfA9t nCqrytACBoo5eupluQQTD2vN6uWfWcXSBrLkw8urWWmqEeYISRLM1CkhK1nB3Lvm qX2WaKR7YXaKIalppYPVi/YITsA0ZGtllqztzcELVH2pVwd3DGpDnk/AbBKI6M80 CGevHC+7SVQbF5WJsy3JXw== -----END CERTIFICATE----- remove $ sudo security delete-certificate -Z 915D019F0993F369C09D75C6B8DA201B8DE2636E Others 1st$ cd /etc/nginx/ $ sudo openssl genrsa -des3 -out server.key 1024 $ sudo openssl req -new -key server.key -out server.csr $ sudo cp server.key{,.org} $ sudo cp server.csr{,.org} $ sudo openssl rsa -in server.key.org -out server.key $ sudo openssl x509 -req \\ -days 365 \\ -in server.csr \\ -signkey server.key \\ -out server.crt $ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled $ sudo openssl genrsa -des3 -out server.key 1024 Generating RSA private key, 1024 bit long modulus .................................................................++++++ ......++++++ e is 65537 (0x10001) Enter pass phrase for server.key: artifactory Verifying - Enter pass phrase for server.key: artifactory $ sudo openssl req -new \\ -key server.key \\ -out server.csr Enter pass phrase for server.key: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Organizational Unit Name (eg, section) []:mycompany Common Name (e.g. server FQDN or YOUR name) []:docker-2.artifactory Email Address []:marslo.jiao@mycompany.com Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:artifactory An optional company name []:mycompany $ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled -rw-r--r-- 1 root root 951 Dec 26 18:32 server.key -rw-r--r-- 1 root root 785 Dec 26 18:36 server.csr -rw-r--r-- 1 root root 951 Dec 26 18:38 server.key.org -rw-r--r-- 1 root root 785 Dec 26 18:38 server.csr.org $ sudo openssl rsa -in server.key.org -out server.key Enter pass phrase for server.key.org: writing RSA key $ sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=mycompany/CN=docker-2.artifactory/emailAddress=marslo.jiao@mycompany.com Getting Private key 2nd: /etc/nginx$ sudo openssl req \\ -newkey rsa:2048 \\ -nodes \\ -sha256 \\ -keyout certs/www.artifactory.mycompany.com.key \\ -x509 \\ -days 365 \\ -out certs/www.artifactory.mycompany.com.crt Generating a 2048 bit RSA private key ........+++ ..............................................................+++ writing new private key to 'certs/www.artifactory.mycompany.com.key' ***** You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Organizational Unit Name (eg, section) []:mycompany Common Name (e.g. server FQDN or YOUR name) []:www.artifactory.mycompany.com Email Address []:marslo.jiao@mycompany.com artifactory https general SSL certs $ sudo openssl genrsa -des3 -out artifactorykey 2048 $ sudo openssl req -new -key artifactorykey -out artifactorycsr $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey $ sudo openssl x509 -req -days 365 -in artifactorycsr -signkey artifactorykey -out artifactorycrt $ sudo openssl genrsa -des3 -out artifactorykey 2048 Generating RSA private key, 2048 bit long modulus .........................+++ ........................................................................+++ e is 65537 (0x10001) Enter pass phrase for artifactorykey: artifactory Verifying - Enter pass phrase for artifactorykey: artifactory $ sudo openssl req -new \\ -key artifactorykey \\ -out artifactorycsr Enter pass phrase for artifactorykey: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Ltd Organizational Unit Name (eg, section) []:. Common Name (e.g. server FQDN or YOUR name) []:192.168.1.102 Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactorykey{,.org} $ sudo openssl rsa \\ -in artifactorykey.org \\ -out artifactorykey Enter pass phrase for artifactorykey.org: artifactory writing RSA key $ sudo openssl x509 -req \\ -days 365 \\ -in artifactorycsr \\ -signkey artifactorykey \\ -out artifactorycrt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany Ltd/CN=192.168.1.102 Getting Private key $ openssl x509 -text -noout -in ssl_ip/artifactorycrt Certificate: Data: Version: 1 (0x0) Serial Number: 9804858425156156035 (0x8811daca106dba83) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, CN=192.168.1.102 Validity Not Before: Dec 26 16:23:15 2017 GMT Not After : Dec 26 16:23:15 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, CN=192.168.1.102 Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:ad:32:26:35:8a:8f:09:82:ff:59:61:14:14:1b: 9c:da:02:74:09:48:2a:d5:05:1d:ad:8a:d0:e0:70: 1f:9b:44:b4:df:4d:c5:4c:5a:1b:8a:52:7b:2a:69: a2:77:d3:cf:c7:fb:a6:ef:34:d1:bb:23:8d:d0:78: e6:48:3f:8c:12:3c:69:d5:62:2d:74:24:b8:49:a8: 59:c7:36:5f:64:97:5a:d1:8f:9a:5b:2f:aa:a8:65: 6c:75:28:60:55:b9:2a:5b:41:71:a4:fa:eb:10:7e: 84:4b:fb:c3:57:9c:55:8e:e8:2a:4a:c1:45:74:54: 58:d5:09:0d:59:d4:14:94:db:5b:67:91:9c:23:24: c4:07:10:d1:f1:28:fa:97:38:01:da:81:c4:f3:63: d7:84:24:dc:3c:ff:04:64:b2:3e:41:f0:d8:08:66: 06:cc:7c:05:3c:90:97:0b:02:b6:b5:2f:03:28:b7: 4c:38:aa:84:23:3e:9e:d4:b0:3a:58:4c:f3:74:df: 36:63:f2:18:ac:d1:0d:ef:05:6b:f3:dc:b6:d3:c7: f0:91:7b:b8:69:4f:ae:19:da:34:b7:38:1e:e2:9a: 10:2e:a9:a0:54:f6:61:b9:da:e6:98:c8:9b:76:83: d6:59:77:d9:18:c6:57:8c:cf:af:a4:89:5a:87:99: c4:15 Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption 5a:06:ad:9b:d0:07:d7:9b:92:2a:77:71:ff:80:6e:c1:39:bd: 81:e8:0f:21:39:bd:80:3e:96:a9:6b:7a:73:f1:80:70:4e:b1: d4:b7:1e:54:be:62:dc:35:c0:b9:d8:8c:d1:24:75:8a:42:ec: a9:dd:9b:9a:f2:4b:ad:6e:38:d7:a2:fa:7a:70:be:7b:8c:37: 63:71:10:fe:73:18:de:e5:9c:c5:6e:1a:4e:cb:7b:51:26:56: 68:56:fb:4f:71:d7:7b:94:b6:55:b9:f8:9b:31:a8:26:a5:e5: 32:36:33:65:7b:1d:9f:27:7d:f1:b0:d2:06:7c:75:d7:39:bb: 7a:44:92:e1:b8:fc:2b:fd:3c:43:93:d6:47:19:f6:ad:d3:cc: 82:dd:15:bd:d3:a0:e2:2d:92:fd:65:44:60:44:21:b9:1f:31: fd:91:c2:78:86:d9:aa:77:fd:54:ae:2f:4c:ae:5d:5e:c7:a3: 43:0d:6b:32:23:d9:61:b6:a7:c4:47:eb:bc:c2:79:6c:06:f0: a6:af:e8:45:c6:02:d5:1c:09:26:8a:a7:b0:ff:74:50:85:82: 1d:88:b2:2c:eb:20:3e:bf:3b:4e:9b:ab:b7:4f:e8:14:a8:1a: 33:50:e9:a8:24:3e:5e:2a:68:ea:fa:f3:12:30:94:8e:0f:0d: da:6c:17:60 $ sudo openssl genrsa -des3 -out artifactorykey 2048 Generating RSA private key, 2048 bit long modulus ........................+++ .......................................+++ e is 65537 (0x10001) Enter pass phrase for artifactorykey: artifactory Verifying - Enter pass phrase for artifactorykey: artifactory $ sudo openssl req -new -key artifactorykey -out artifactorycsr Enter pass phrase for artifactorykey: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Ltd Organizational Unit Name (eg, section) []:mycompany CDI Common Name (e.g. server FQDN or YOUR name) []:docker-1.artifactory Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey Enter pass phrase for artifactorykey.org: artifactory writing RSA key $ sudo openssl x509 -req \\ -days 365 \\ -in artifactorycsr \\ -signkey artifactorykey \\ -out artifactorycrt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany Ltd/OU=mycompany CDI/CN=docker-1.artifactory Getting Private key $ openssl x509 -text \\ -noout \\ -in ssl/artifactorycrt Certificate: Data: Version: 1 (0x0) Serial Number: 15006671364169185053 (0xd0426818d254b71d) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, OU=mycompany CDI, CN=docker-1.artifactory Validity Not Before: Dec 26 16:02:10 2017 GMT Not After : Dec 26 16:02:10 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, OU=mycompany CDI, CN=docker-1.artifactory Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:dc:30:6b:83:56:92:fb:f3:fb:bc:da:3e:a9:5c: 67:c3:19:42:9a:8f:8f:30:e6:27:fa:a9:9d:c9:3e: 9c:31:3d:aa:d8:9f:ae:9b:64:b0:75:2a:01:51:ad: 04:c4:00:5d:f4:f8:b4:af:bb:20:f3:77:45:65:28: d8:38:28:b2:03:46:d0:67:d1:91:8e:7b:65:66:a0: 7e:a5:e2:fe:80:00:5e:54:95:50:52:9c:44:2a:aa: dc:a2:80:be:16:07:79:b4:13:1d:f5:8a:ca:c3:ab: 1c:76:de:f3:b8:23:9b:54:17:28:be:ac:e5:68:5c: f3:83:49:61:55:d2:e1:ea:0c:e7:72:75:6e:90:5a: 90:a8:85:01:c6:cc:69:94:5b:c4:f9:14:6d:70:0a: 8e:45:e0:b9:28:aa:99:3a:22:12:db:0b:d7:d9:6e: aa:35:36:5e:e6:00:eb:99:ab:46:6d:7b:e5:12:b1: f9:0c:5c:d3:c0:47:7b:b3:e4:03:15:fa:8d:42:f8: a1:c1:ce:dc:42:d2:81:88:18:0d:26:28:7e:90:cf: e8:05:84:75:94:e9:ac:20:47:95:c7:50:1c:d8:42: c3:d7:8b:90:f9:a9:48:cc:a5:8d:88:3b:54:a9:ef: 20:ce:ee:4c:6d:04:65:eb:6c:f7:22:9d:c8:13:33: b1:6d Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption c3:c7:c8:0d:19:d1:0b:05:ac:11:e3:e4:af:25:0e:95:f5:f5: 31:ed:90:4e:7f:1a:2b:a2:2f:4d:a3:d9:57:40:a2:f6:af:55: 90:53:bf:72:39:81:5d:53:41:85:e0:1d:26:9f:9e:33:05:46: 9c:fc:51:99:19:5c:7d:ef:aa:cc:50:61:0b:f4:11:69:bd:9e: 2a:34:48:e9:9d:7c:d0:e0:80:a5:42:67:ac:8e:0c:d6:84:19: 8e:cb:05:97:9f:21:c5:e0:78:8f:97:f6:53:fa:f2:ec:49:3f: fb:11:68:ed:ea:c0:8c:c5:be:08:61:e4:bd:4e:05:5f:89:99: f6:47:6f:b3:1e:5f:49:62:ff:37:dc:f0:c4:4b:bb:a4:15:06: b1:80:4d:24:ef:bb:25:d6:a5:60:13:34:57:73:ba:b4:b0:8b: 42:0f:18:ef:0e:17:60:83:4d:61:bd:ef:55:b9:52:6a:47:ab: c3:ee:b3:11:27:86:aa:87:18:d5:60:b8:b4:34:c2:fa:75:48: 0e:f1:f4:30:b3:fa:b3:ad:a9:8a:6e:e6:62:71:02:5a:72:bd: 5c:45:a0:23:ea:1d:84:16:24:3d:88:a0:12:20:61:7a:f8:bd: dc:0f:fb:26:c0:f3:2f:1f:66:7e:64:35:b6:45:05:c4:00:43: 2d:18:da:a1 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:15 "},"devops/ssh.html":{"url":"devops/ssh.html","title":"ssh","keywords":"","body":" Table of Contents generated with DocToc SSH Tricky Generate SSH Key Add into agent Performance Get Public Key from Private Key Disable Login Password Force Use Password Get FingerPrinter from Private Key SSH with OpenSSL SSH With Proxy Using Command Directly Using Configure file Debug Git by SSH reference: SSH port forwarding - Example, command, server config 透过代理连接SSH SSH ProxyCommand example: Going through one host to reach another server OpenSSH/Cookbook/Proxies and Jump Hosts Tunneling SSH over PageKite Transparent Multi-hop SSH SSH via HTTP proxy in OSX ssh key SSH Tricky Generate SSH Key $ keyname='marslo@china' # rsa4096 $ ssh-keygen -t rsa -b 4096 -f \"~/.ssh/${keyname}\" -C \"${keyname}\" -P \"\" -q # ed25519 $ ssh-keygen -t ed25519 -o -a 100 -C \"${keyname}\" -f \"~/.ssh/${keyname}\" -P '' -q Add into agent $ ssh-add ~/.ssh/${keyname} # e.g.: $ ssh-add ~/.ssh/id_ed25519 Identity added: /Users/marslo/.ssh/id_ed25519 (marslo@devops) $ ssh-agent -s SSH_AUTH_SOCK=/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T//ssh-MgCrKA3ZS06N/agent.25376; export SSH_AUTH_SOCK; SSH_AGENT_PID=25377; export SSH_AGENT_PID; echo Agent pid 25377; Performance $ openssl speed rsa1024 rsa2048 dsa1024 dsa2048 Doing 1024 bit private rsa's for 10s: 91211 1024 bit private RSA's in 9.97s Doing 1024 bit public rsa's for 10s: 1161461 1024 bit public RSA's in 9.93s Doing 2048 bit private rsa's for 10s: 12305 2048 bit private RSA's in 9.94s Doing 2048 bit public rsa's for 10s: 403455 2048 bit public RSA's in 9.98s Doing 1024 bit sign dsa's for 10s: 84873 1024 bit DSA signs in 10.00s Doing 1024 bit verify dsa's for 10s: 109544 1024 bit DSA verify in 9.99s Doing 2048 bit sign dsa's for 10s: 30010 2048 bit DSA signs in 9.99s Doing 2048 bit verify dsa's for 10s: 33202 2048 bit DSA verify in 9.98s OpenSSL 1.0.2t 10 Sep 2019 built on: reproducible build, date unspecified options:bn(64,64) rc4(ptr,int) des(idx,cisc,16,int) aes(partial) idea(int) blowfish(idx) compiler: clang -I. -I.. -I../include -fPIC -fno-common -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch x86_64 -O3 -DL_ENDIAN -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM sign verify sign/s verify/s rsa 1024 bits 0.000109s 0.000009s 9148.5 116964.9 rsa 2048 bits 0.000808s 0.000025s 1237.9 40426.4 sign verify sign/s verify/s dsa 1024 bits 0.000118s 0.000091s 8487.3 10965.4 dsa 2048 bits 0.000333s 0.000301s 3004.0 3326.9 Get Public Key from Private Key $ ssh-keygen -y -f ~/.ssh/id_rsa > ~/.ssh/id_rsa.pub Disable Login Password $ cat /etc/ssh/sshd_config ChallengeResponseAuthentication no PasswordAuthentication no UsePAM no scripts: TIMESTAMPE=$(date +\"%Y%m%d%H%M%S\") SSHDFILE=\"/etc/ssh/sshd_config\" sudo cp \"${SSHDFILE}{,.org.${TIMESTAMPE}}\" sudo bash -c '/bin/sed -i -e \"s:^\\(UsePAM.*$\\):# \\1:\" ${SSHDFILE}' sudo bash -c '/bin/sed -i -e \"s:^\\(PermitRootLogin.*$\\):# \\1:\" ${SSHDFILE}' sudo bash -c '/bin/sed -i -e \"s:^\\(ChallengeResponseAuthentication.*$\\):# \\1:\" ${SSHDFILE}' sudo bash -c '/bin/sed -i -e \"s:^\\(PasswordAuthentication.*$\\):# \\1:\" ${SSHDFILE}' if ! grep 'Add my marslo' ${SSHDFILE} > /dev/null 2>&1; then sudo bash -c \"cat >> ${SSHDFILE}\" Force Use Password $ ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no user@target.server Get FingerPrinter from Private Key SHA256: $ ssh-keygen -l -f ~/.ssh/id_rsa # or $ ssh-keygen -l -f ~/.ssh/id_rsa.pub MD5: $ ssh-keygen -E md5 -l -f ~/.ssh/id_rsa # or $ ssh-keygen -E md5 -l -f ~/.ssh/id_rsa.pub SSH with OpenSSL $ openssl pkey -in ~/.ssh/ec2/primary.pem -pubout -outform DER | openssl md5 -c SSH With Proxy Using Command Directly Linux: $ ssh -o 'ProxyCommand nc -x proxy.url.com proxy-port %h %p' -vT user@target.server # or $ ssh -o 'ProxyCommand corkscrew proxy.url.com proxy-port %h %p' -vT user@target.server Windows: Git for Windows $ ssh -o 'ProxyCommand connect -H http://proxy.url.com:proxy-port %h %p' user@target.server Cygwin $ apt-cyg install corkscrew $ ssh -o 'ProxyCommand corkscrew proxy.url.com proxy-port %h %p' user@target.server # OR $ apt-cyg install nc $ ssh -o 'ProxyCommand nc -X connect -x proxy.url.com:proxy-port %h %p' -vT git@github.com Using Configure file $ cat ~/.ssh/config HOST * GSSAPIAuthentication no StrictHostKeyChecking no # UserKnownHostsFile /dev/null IdentityFile ~/.ssh/id_ed25519 IdentityFile ~/.ssh/id_rsa # keep the older key if necessary Host github.com Hostname github.com User marslo.jiao@gmail.com IdentityFile /C/Marslo/my@key ProxyCommand connect -H http://127.0.0.1:8000 %h %p IdentitiesOnly yes OR $ cat ~/.ssh/config HOST * GSSAPIAuthentication no StrictHostKeyChecking no # UserKnownHostsFile /dev/null IdentityFile ~/.ssh/id_ed25519 IdentityFile ~/.ssh/id_rsa # keep the older key if necessary Host github.com Hostname github.com User marslo.jiao@gmail.com IdentityFile /C/Marslo/my@key ProxyCommand nc -X connect -x proxy.url.com:proxy-port %h %p IdentitiesOnly yes ServerAliveInterval 10 # Optional Debug Git by SSH GIT_SSH_COMMAND $ GIT_SSH_COMMAND=\"ssh -vvT\" git clone git@github.com:Marslo/myblog.git Cloning into 'myblog'... OpenSSH_7.9p1, LibreSSL 2.7.3 debug1: Reading configuration data /Users/marslo/.ssh/config debug1: /Users/marslo/.ssh/config line 1: Applying options for * debug1: /Users/marslo/.ssh/config line 13: Applying options for github.com debug1: Reading configuration data /etc/ssh/ssh_config debug1: /etc/ssh/ssh_config line 48: Applying options for * debug1: Connecting to github.com port 22. ^C GIT_TRACE $ GIT_TRACE=1 git st 00:30:44.772137 git.c:703 trace: exec: git-st 00:30:44.772540 run-command.c:663 trace: run_command: git-st 00:30:44.772894 git.c:384 trace: alias expansion: st => status 00:30:44.772903 git.c:764 trace: exec: git status 00:30:44.772907 run-command.c:663 trace: run_command: git status 00:30:44.777379 git.c:440 trace: built-in: git status On branch master Your branch is up to date with 'origin/master'. 00:30:44.782714 run-command.c:663 trace: run_command: GIT_INDEX_FILE=.git/index git submodule summary --cached --for-status --summary-limit -1 HEAD 00:30:44.787490 git.c:703 trace: exec: git-submodule summary --cached --for-status --summary-limit -1 HEAD 00:30:44.788038 run-command.c:663 trace: run_command: git-submodule summary --cached --for-status --summary-limit -1 HEAD 00:30:44.838222 git.c:440 trace: built-in: git rev-parse --git-dir 00:30:44.845054 git.c:440 trace: built-in: git rev-parse --git-path objects 00:30:44.852811 git.c:440 trace: built-in: git rev-parse -q --git-dir 00:30:44.870362 git.c:440 trace: built-in: git rev-parse --show-prefix 00:30:44.878755 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:44.893984 git.c:440 trace: built-in: git rev-parse -q --verify --default HEAD HEAD 00:30:44.899709 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:44.905200 git.c:440 trace: built-in: git rev-parse --sq --prefix -- 00:30:44.911762 git.c:440 trace: built-in: git diff-index --cached --ignore-submodules=dirty --raw 52c94664ffc09cde2308c6bf9824ca0355ff5ff7 -- 00:30:44.917374 run-command.c:663 trace: run_command: GIT_INDEX_FILE=.git/index git submodule summary --files --for-status --summary-limit -1 00:30:44.922165 git.c:703 trace: exec: git-submodule summary --files --for-status --summary-limit -1 00:30:44.922568 run-command.c:663 trace: run_command: git-submodule summary --files --for-status --summary-limit -1 00:30:44.965375 git.c:440 trace: built-in: git rev-parse --git-dir 00:30:44.972784 git.c:440 trace: built-in: git rev-parse --git-path objects 00:30:44.979117 git.c:440 trace: built-in: git rev-parse -q --git-dir 00:30:44.991077 git.c:440 trace: built-in: git rev-parse --show-prefix 00:30:44.997718 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:45.012365 git.c:440 trace: built-in: git rev-parse -q --verify --default HEAD 00:30:45.018759 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:45.024687 git.c:440 trace: built-in: git rev-parse --sq --prefix -- 00:30:45.031664 git.c:440 trace: built-in: git diff-files --ignore-submodules=dirty --raw -- nothing to commit, working tree clean Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:15 "},"devops/klocwork/klocwork.html":{"url":"devops/klocwork/klocwork.html","title":"klocwork","keywords":"","body":" Table of Contents generated with DocToc environment analysis initial a klocwork analysis full build analysis incremental build analysis load result from both windows and linux using kwwrap plus kwinject to generate a build specification when editing the makefile is not an option authentication get ltoken api list builds info from project report creating a report CI Jenkinsfile reference: Klocwork Build integration for C Cplus plus projects EN Command Reference Troubleshooting an incomplete kwinject build specification Providing a build specification template for your developers Compiler options for kwbuildproject Klocwork Jenkins CI plugin Synchronizing status changes and comments across projects Continuous integration and Klocwork analysis examples Klocwork - Knowledgebase Running the C and C++ integration build analysis Running your first integration build analysis Running your next integration build analysis Creating a C/C++ build specification C/C++ integration build analysis - Cheat sheet example about integrate with Jenkins 最佳实践：Klocwork增量/VerifyCI检查 Running a distributed Klocwork C/C++ analysis Security Best Practices + Klocwork environment reference: Install and Configure Klocwork cmd client User manual | Installation and Upgrade Klocwork Desktop for C/C++ project setup overview video: Build integration for C/C++ projects video: Klocwork Demo Useful resources analysis issue severity 1 - Critical 2 - Error 3 - Warning 4 - Review 5 - Severity 5 6 - Severity 6 7 - Severity 7 8 - Severity 8 9 - Severity 9 10 - Severity 10 initial a klocwork analysis sample code capture build settings $ kwinject --output \"\" i.e.:$ kwinject --output \"~/npp/npp.out\" devenv \"~/npp/PowerEditor/visual.net/notepadPlus.sln\" /Rebuild run an analysis using the build spec $ kwbuildproject --url \"/\" \\ --tables-directory \"\" \\ \"\" i.e.:$ kwbuildproject --url \"http://my.kw.com/NotepadPlusPlus\" --tables-directory \"~/npp/npp_tables\" \"~/npp/npp.out\" load the database $ kwadmin --url \"\" \\ load \"\" \\ \"\" i.e.: $ kwadmin --url \"http://my.kw.com\" load \"NotepadPlusPlus\" \"~/npp/npp_tables\" debug for authentication issue $ kwadmin --debug --url list-projects logout via$ kwauth --log-out full build analysis sample code re-create the build spec $ kwinject --output \"~/kw.out\" i.e.$ kwinject --output \"~/npp/npp.out\" devenv \"~/npp/PowerEditor/visual.net/notepadPlus.sln\" /Rebuild force a full analysis $ kwbuildproject --url \"/\" \\ --tables-directory \"\" \\ --force \"\" i.e.:$ kwbuildproject --url \"http://my.kw.com/NotepadPlusPlus\" --tables-directory \"~/npp/npp_tables\" --force \"~/npp/npp.out\" load the result $ kwadmin --url \"\" \\ load \"\" \\ \"\" i.e.:$ kwadmin --url http://my.kw.com/ load NotepadPlusPlus \"~/npp/npp_tables\" incremental build analysis sample code update the build settings $ kwinject --update \"\" i.e.:$ kwinject --update \"~/npp/npp.out\" devenv \"~/npp/PowerEditor/visual.net/notepadPlus.sln\" /Build execute the incremental analysis $ kwbuildproject --url \"/\" \\ --tables-directory \"\" \\ --incremental \"\" i.e.:$ kwbuildproject --url \"http://my.kw.com/NotepadPlusPlus\" --tables-directory \"~/npp/npp_tables\" --incremental \"~/npp/npp_tables\" load the result $ kwadmin --url \"\" \\ load \"\" \\ \"\" i.e.:$ kwadmin --url \"http://my.kw.com\" load NotepadPlusPlus \"~/npp/npp_tables\" load result from both windows and linux sample code kwbuildproject create an integration project on kw server via command line $ kwadmin --url \"\" \\ create-project \"\" i.e.:$ kwadmin --url http://my.kw.com create-project NotepadPlusPlus capture build settings on linux machine $ kwinject --output \"\" i.e.:$ kwinject --output \"~/npp/npp.out\" make run an analysis using the build spec on linux $ kwbuildproject --url \"/\" \\ [--project \"\"] --tables-directory \"\" \\ \"\" i.e.:$ kwbuildproject --url \"http://my.kw.com/NotepadPlusPlus\" \\ --tables-directory \"~/npp/npp_tables\" \\ \"~/npp/npp.out\" load multiple specification$ kwbuildproject --tables-directory \\ [--url http://:/] \\ [] \\ [...] load the database on windows $ kwadmin --url \"\" \\ load \"\" \\ \"\" i.e.:$ kwadmin --url \"http://my.kw.com/NotepadPlusPlus\" \\ load NotepadPlusPlus \\ \"~/npp/npp_tables\" using kwwrap plus kwinject to generate a build specification reference: Using a build trace to troubleshoot build specification problems Can I concatenate the results of more than one kwinject.out file? Running a distributed analysis Note: For distributed builds, you must run the following procedure on all build machines and merge the resultant build trace files. inserting the kwwrap command line before your compiler and linker names CC = gcc convert to CC = kwwrap -o gcc // or CC = kwwrap -o $(command -v gcc) or via creating wrapper scripts execute the original build command Convert the build trace into a build specification with kwinject$ kwinject --trace-in \\ --output i.e.:$ kwinject --trace-in C:/temp/kwwrap.trace \\ --output C:/Klocwork/temp/kwinject.out when editing the makefile is not an option i.e.: is /temp/kwwrap.trace using environment variables create environment variables $ LDSHARED=\"kwwrap -o /temp/kwwrap.trace $(command -v gcc)\" $ CC=\"kwwrap -o /temp/kwwrap.trace $(command -v gcc)\" $ C++=\"kwwrap -o /temp/kwwrap.trace $(command -v g++)\" $ CMAKE=\"kwwrap -o /temp/kwwrap.trace $(command -v cmake)\" $ AR=\"kwwrap -o /temp/kwwrap.trace $(command -v ar) rc\" $ export CC C++ CMAKE AR LDSHARED build with original command $ cmake use kwwrap with CMake and generate the trace $ kwinject --trace-in /temp/kwwrap.trace --output kwinject.out using wrapper scripts creating wrapper scripts $ echo \"kwwrap -r -o $(command -v gcc)\" > $HOME/.hook/gcc $ echo \"kwwrap -r -o $(command -v g++)\" > $HOME/.hook/g++ $ echo \"kwwrap -r -o $(command -v cmake)\" > $HOME/.hook/cmake $ chmod +x $HOME/.hook/* setup environment variables $ export KWWRAP_HOOKS_DIR=\"$HOME/.hook\" $ export PATH=${KWWRAP_HOOKS_DIR}:${PATH} build with original command $ cmake # the original command use kwwrap with CMake and generate the trace $ kwinject --trace-in /temp/kwwrap.trace --output kwinject.out authentication get ltoken $ export KLOCWORK_LTOKEN=/home/marslo/.klocwork/ltoken $ kwauth --url https://my.kw.com:443 Login: marslo Password: **** $ cat /home/marslo/.klocwork/ltoen my.kw.com;443;marslo;abcdefg1234567************************************************** api api url: http(s)://my.kw.com:443/review/api reference: Klocwork Web API cookbook Klocwork Insight Web API cookbook Access control API examples Issue and metric API examples Klocwork Static Code Analysis Web API Reference To access Web API send a POST request to http://my.kw.com/review/api with the following parameters: user Klocwork user name ltoken kwauth login token action action name builds Retrieve the list of builds for a project. Example: curl --data \"action=builds&user=myself&project=my_project\" http://my.kw.com/review/api project* : project name list builds info from project ltoek is got from ${KLOCWORK_LTOKEN} file reference: Klocwork Insight Web API cookbook Issue states Issue statuses api additional header : -H \"Content-Type: application/x-www-form-urlencoded;charset=UTF-8\" via api $ curl --data \"action=builds&user=&ltoken=&project=\" http://my.kw.com/review/api i.e.:$ curl --data \"action=builds&user=marslo&ltoken=abcd1234****&project=marslo-kw\" \\ https://my.kw.com:443/review/api {\"id\":3,\"name\":\"build_3\",\"date\":1619437882164,\"keepit\":false} {\"id\":2,\"name\":\"build_2\",\"date\":1619436216567,\"keepit\":false} {\"id\":1,\"name\":\"build_1\",\"date\":1619434698145,\"keepit\":false} via kwadmin $ kwadmin --url https://my.kw.com:443 list-builds marslo-kw build_1 build_2 build_3 list project config files$ kwadmin --url https://my.kw.com:443 list-config-files marslo-kw analysis_profile.pconf (Problems Configuration) metrics_default.mconf (Metrics Thresholds) query only new issues reference Using the search API search Retrieve the list of detected issues. Example: curl --data \"action=search&user=myself&project=my_project&query=file:MyFile.c\" http://my.kw.com/review/api project* : project name query : search query, such as narrowing by file (for example, 'file:MyFile.c') view : view name limit : search result limit summary : include summary record to output stream Searching in Klocwork Static Code Analysis: Note: You can only search by one build at a time. Other acceptable syntax: build:'123' - searches for build which contains substring '123' build:+123 - searches for build with name 123 build:+'123string' - searches for build with name equal to '123string' $ ltoken='abcd1234*****' $ username='marslo' $ project='marslo-kw' $ query='build:build_3 state:New' $ url='https://my.kw.com:443' $ curl --data \"action=search&user=${username}&ltoken=${ltoken}&project=${project}&query=${query}\" \\ ${url}/review/api | jq --raw-output . report creating a report CI reference: Klocwork Jenkins CI plugin Continuous integration and Klocwork analysis Ebook: klocwork ci/cd best practice.pdf Video: Add Static Code Analysis to Your CI/CD Pipelines Jenkinsfile pipeline { agent any environment { KLOCWORK_URL = \"http://localhost:8080\" KLOCWORK_PROJECT = \"zlib-pipeline\" KLOCWORK_LICENSE_HOST = \"flexlm-server\" KLOCWORK_LICENSE_PORT = \"27000\" KLOCWORK_LTOKEN = \"\" } stages { stage('Get src from git') { steps { git 'https://github.com/madler/zlib.git' } } // stage : clone code stage('Klocwork Build') { steps { klocworkBuildSpecGeneration([ additionalOpts: '', buildCommand: 'c:\\\\dev\\\\zlib-git.bat', ignoreErrors: true, output: 'kwinject.out', tool: 'kwinject' ]) } } // stage : klocwork build stage('Klocwork Analysis') { steps { klocworkIntegrationStep1([ additionalOpts: '', buildSpec: 'kwinject.out', disableKwdeploy: true, duplicateFrom: '', enabledCreateProject: true, ignoreCompileErrors: true, importConfig: '', incrementalAnalysis: false, tablesDir: 'kwtables' ]) } } // stage : klocwork analysis stage('Klocwork Db-load') { steps { klocworkIntegrationStep2 reportConfig: [ displayChart: true, query: 'status:Analyze' ], serverConfig: [ additionalOpts: '', buildName: '', tablesDir: 'kwtables' ] } } // stage : klocwork db-load stage('Build Failure Conditions') { steps { klocworkFailureCondition([ enableCiFailureCondition: true, failureConditionCiConfigs: [[ withDiffList: true, diffFileList: 'my_list.txt', enableHTMLReporting: true, name: 'one', reportFile: '', threshold: '1',]] ]) } } // stage : build failure conditions } // stages } // pipeline full static code analysisstage(\"full static code analysis\") { steps{ echo \"performance integration analysis\" klocworkIntegrationStep1([ buildSpec: \"${KLOCWORK_BUILDSPEC}\", tableDir: \"${KLONWORK_TABLES}\", incrementalAnalysis : true, ignoreCompileErrors: false, importConfig : \"\", additionalOpts: \"--replace-path ${WORKSPACE}=workspace\", disableKwdeploy: true ]) } } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:15 "},"devops/klocwork/kwadmin.html":{"url":"devops/klocwork/kwadmin.html","title":"kwadmin","keywords":"","body":" Table of Contents generated with DocToc list projects and properties project create project delete project duplicate project rename project project properties get project properties set project properties project configuration files list configuration files list configuration types import configuration files delete configuration files build list builds delete build rename build keep builds by default Project properties displayed by kwadmin reference: kwadmin Reference for integration project and build properties Build properties displayed by kwadmin Admin Tools Improving database performance Backing up Klocwork data Build properties displayed by kwadmin list projects and properties $ kwadmin list-projects project create project $ kwadmin create-project [--encoding utf-8] delete project $ kwadmin delete-project duplicate project $ kwadmin duplicate-project rename project $ kwadmin rename-project project properties get project properties $ kwadmin get-project-properties set project properties $ kwadmin set-project-property change Issue grouping$ kwadmin set-project-property grouping_on_default false project configuration files Configuration files that you can import into integration projects list configuration files $ kwadmin list-config-files example$ kwadmin list-config-files sample_project analysis_profile.pconf (Problems Configuration) metrics_default.mconf (Metrics Thresholds) kw_override.h (Override File) list configuration types $ kwadmin list-config-types Build Specification Template (.tpl) User Defined Attributes (.atr) Source Ownership (.sow) User Metrics (.ume) Size of Types (.szt) User Defined Relationships (.rel) Taxonomy Configuration (.tconf) Metrics Thresholds (.mconf) Override File (.h) Problems Configuration (.pconf) Java Function Behavior Knowledge Base (.jkb) Function Behavior Knowledge Base (.kb) import configuration files $ kwadmin import-config delete configuration files $ kwadmin delete-config build list builds $ kwadmin list-builds delete build $ kwadmin delete-build rename build $ kwadmin rename-build keep builds by default $ kwadmin set-project-property auto_delete_threshold Project properties displayed by kwadmin Property Description auto_delete_threshold specifies the number of builds to save when the auto delete feature is enabled bug_tracker_schema Used to replace {0} with id, and convert id to a hyperlink copy_tables specifies whether Klocwork tables will be copied to projects_root by kwadmin load description project description grouping_on_default changes the way the system displays server issues. By default, desktop issues are shown with grouping off while server issues are shown with grouping on. If you want server issues for a project to persistently show issues with grouping off, change the setting to false. language programming language of the source files in the project locale overrides the locale for the project set during project creation. Should only be set before running an integration build analysis with kwbuildproject, so that the language of issue messages and traceback will be consistent in all builds source_encoding language encoding of project source files. See kwadmin create-project. Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:15 "},"jenkins/jenkins.html":{"url":"jenkins/jenkins.html","title":"jenkins","keywords":"","body":" Table of Contents generated with DocToc crumb issuer get crumb visit API via crumb restart Jenkins instance run Jenkins in docker in kubernetes crumb issuer more info: CSRF Protection Explained Improved CSRF protection CSRF Protection Remote Access API Jenkins REST API example using crumb get crumb jq for multiple values and another answer via groovy script import hudson.security.csrf.DefaultCrumbIssuer DefaultCrumbIssuer issuer = jenkins.model.Jenkins.instance.crumbIssuer jenkinsCrumb = \"${issuer.crumbRequestField}:${issuer.crumb}\" resultprintln jenkinsCrumb Jenkins-Crumb:7248f4a5*********** via curl $ domain='jenkins.marslo.com' $ COOKIEJAR=\"$(mktemp)\" $ curl -s \\ --cookie-jar \"${COOKIEJAR} \\ https://${domain}/crumbIssuer/api/json | jq -r '[.crumbRequestField, .crumb] | \"\\(.[0]):\\(.[1])\"' Jenkins-Crumb:8b87b6ed98ef923****** imarslo : or json cheatsheet $ domain='jenkins.marslo.com' $ COOKIEJAR=\"$(mktemp)\" $ curl -sSLg \\ --cookie-jar \"${COOKIEJAR} \\ https://${domain}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb' or $ COOKIEJAR=\"$(mktemp)\" $ curl -s \\ --cookie-jar \"${COOKIEJAR} \\ http://jenkins.marslo.com/crumbIssuer/api/json | jq -r '[.crumbRequestField, .crumb] | join(\":\")' or via xml $ COOKIEJAR=\"$(mktemp)\" $ curl -sSLg \\ --cookie-jar \"${COOKIEJAR} \\ \"http://${JENKINS_URL}/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,\\\":\\\",//crumb)\" Jenkins-Crumb:8b87b6ed98ef923****** via web page via wget after jenkins 2.176.2 # via xml api $ COOKIEJAR=\"$(mktemp)\" $ wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ --save-cookies \"${COOKIEJAR}\" \\ --keep-session-cookies \\ -q \\ --output-document \\ - \\ \"https://localhost:8080/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,%22:%22,//crumb)\")\" # via json api $ COOKIEJAR=\"$(mktemp)\" $ wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ --save-cookies \"${COOKIEJAR}\" \\ --keep-session-cookies \\ -q \\ --output-document \\ - \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' before jenkins 2.176.2# via xml $ wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ -q \\ --output-document \\ - \\ 'http://localhost:8080/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,\":\",//crumb)' # via json $ wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ -q \\ --output-document \\ - \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' visit API via crumb @Current after 2.176.2 COOKIEJAR=\"$(mktemp)\" CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"${COOKIEJAR}\" \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' ) @Dprecated before jenkins 2.176.2 url='http://jenkins.marslo.com' CRUMB=\"$(curl -sSLg ${url}/crumbIssuer/api/json | jq -r .crumb \\ )\" CRUMB=\"Jenkins-Crumb:${CRUMB}\" # or CRUMB=\"$(curl -s ${url}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb' \\ )\" $ COOKIEJAR=\"$(mktemp)\" $ CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"${COOKIEJAR}\" \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' ) $ curl -H \"${CRUMB}\" \\ -d 'cities=Lanzhou' \\ http://jenkins.marslo.com/job/marslo/job/sandbox/buildWithParameters or$ domain='jenkins.marslo.com' $ url=\"https://${domain}\" $ COOKIEJAR=\"$(mktemp)\" $ curl -H \"$(curl -s \\ --cookie-jar \"${COOKIEJAR}\" \\ ${url}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb' \\ )\" \\ -d 'cities=Lanzhou' \\ ${url}/job/marslo/job/sandbox/buildWithParameters or $ curl -H \"Jenkins-Crumb:${CRUMB}\" \\ --data 'cities=Leshan,Chengdu' \\ --data 'provinces=Sichuan' \\ http://jenkins.marslo.com/job/marslo/job/sandbox/buildWithParameters or$ domain='jenkins.marslo.com' $ url=\"https://${domain}\" $ curl -H \"$(curl -s ${url}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb')\" \\ --data 'cities=Leshan,Chengdu' \\ --data 'provinces=Sichuan' \\ ${url}/job/marslo/job/sandbox/buildWithParameters build a job using the REST API and cURL $ curl -X POST http://developer:developer@localhost:8080/job/test/build # build with parameters $ curl -X POST \\ http://developer:developer@localhost:8080/job/test/build \\ --data-urlencode json='{\"parameter\": [{\"name\":\"paramA\", \"value\":\"123\"}]}' restart Jenkins instance @Current after 2.176.2 COOKIEJAR=\"$(mktemp)\" CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"${COOKIEJAR}\" \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' ) @Dprecated before jenkins 2.176.2 CRUMB=\"$(curl -sSLg http://jenkins.marslo.com/crumbIssuer/api/json | jq -r .crumb \\ )\" CRUMB=\"Jenkins-Crumb:${CRUMB}\" # or CRUMB=\"$(curl -s ${url}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb' \\ )\" $ curl -X POST \\ -H \"${CRUMB}\" \\ http://jenkins.marslo.com/safeRestart or$ domain='jenkins.marslo.com' $ url=\"https://${domain}\" $ COOKIEJAR=\"$(mktemp)\" $ curl -X POST \\ -H \"$(curl -s \\ --cookie-jar \"${COOKIEJAR}\" \\ ${url}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb' \\ )\" \\ ${url}/safeRestart run Jenkins refernce: Jenkins Features Controlled with System Properties -Dhudson.security.ArtifactsPermission=true remoting configuration IMPORTANT JENKINS COMMAND in docker $ docker run \\ --name jenkins \\ --rm \\ --detach \\ --network jenkins \\ --env DOCKER_HOST=tcp://docker:2376 \\ --env DOCKER_CERT_PATH=/certs/client \\ --env DOCKER_TLS_VERIFY=1 \\ --publish 8080:8080 \\ --publish 50000:50000 \\ --volume jenkins-data:/var/jenkins_home \\ --volume jenkins-docker-certs:/certs/client:ro \\ jenkins/jenkins:latest docker run with JAVA_OPTS more on Properties in Jenkins Core for JAVA_OPTS encoding How locale setting can break unicode/UTF-8 in Java/Tomcat $ docker run \\ --name jenkins \\ --detach \\ --rm \\ --network jenkins \\ --env DOCKER_HOST=tcp://docker:2376 \\ --env DOCKER_CERT_PATH=/certs/client \\ --env DOCKER_TLS_VERIFY=1 \\ --publish 8080:8080 \\ --publish 50000:50000 \\ --env JENKINS_ADMIN_ID=admin \\ --env JENKINS_ADMIN_PW=admin \\ --env JAVA_OPTS=\" \\ -XX:+UseG1GC \\ -Xms8G \\ -Xmx16G \\ -Dfile.encoding=UTF-8 \\ -Dsun.jnu.encoding=utf-8 \\ -DsessionTimeout=1440 \\ -DsessionEviction=43200 \\ -Djava.awt.headless=true \\ -Djenkins.ui.refresh=true \\ -Divy.message.logger.level=4 \\ -Dhudson.Main.development=true \\ -Duser.timezone='Asia/Chongqing' \\ -Dgroovy.grape.report.downloads=true \\ -Djenkins.install.runSetupWizard=true \\ -Dpermissive-script-security.enabled=true \\ -Dhudson.footerURL=https://jenkins.marslo.com \\ -Djenkins.slaves.NioChannelSelector.disabled=true \\ -Djenkins.slaves.JnlpSlaveAgentProtocol3.enabled=false \\ -Dhudson.model.ParametersAction.keepUndefinedParameters=true \\ -Djenkins.security.ClassFilterImpl.SUPPRESS_WHITELIST=true \\ -Dhudson.security.ArtifactsPermission=true \\ -Dhudson.security.LDAPSecurityRealm.groupSearch=true \\ -Dhudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID=true \\ -Dcom.cloudbees.workflow.rest.external.ChangeSetExt.resolveCommitAuthors=true \\ -Dhudson.plugins.active_directory.ActiveDirectorySecurityRealm.forceLdaps=false \\ -Dhudson.model.DirectoryBrowserSupport.CSP=\\\"sandbox allow-same-origin allow-scripts; default-src 'self'; script-src * 'unsafe-eval'; img-src *; style-src * 'unsafe-inline'; font-src *;\\\" \\ \" \\ --env JNLP_PROTOCOL_OPTS=\"-Dorg.jenkinsci.remoting.engine.JnlpProtocol3.disabled=false\" \\ --volume /opt/JENKINS_HOME:/var/jenkins_home \\ --volume /var/run/docker.sock:/var/run/docker.sock \\ jenkins/jenkins:latest in kubernetes reference: official yaml official sa yaml $ cat for nginx ingress--- apiVersion: extensions/v1beta1 kind: Ingress metadata: name: jenkins namespace: devops annotations: kubernetes.io/ingress.class: \"nginx\" nginx.ingress.kubernetes.io/secure-backends: \"true\" nginx.ingress.kubernetes.io/backend-protocol: \"HTTP\" kubernetes.io/ingress.allow-http: \"false\" spec: tls: - hosts: - jenkins.mysite.com secretName: mysite-certs rules: - host: jenkins.mysite.com http: paths: - path: backend: serviceName: jenkins servicePort: 8080 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:31 "},"jenkins/config/config.html":{"url":"jenkins/config/config.html","title":"config","keywords":"","body":" Table of Contents generated with DocToc Mailing format Properties in Jenkins Core for JAVA_OPTS System Properties Configuring HTTP Upgrading Jenkins Mailing format Show the logs after building Format:${BUILD_LOG, maxLines, escapeHtml} maxLines: 250 For example:${BUILD_LOG, maxLines=8000, escapeHtml=true} Properties in Jenkins Core for JAVA_OPTS disable the true Disabling CSRF Protection reference: CSRF Protection -Dhudson.security.csrf.GlobalCrumbIssuerConfiguration.DISABLE_CSRF_PROTECTION=true CSRF protection tokens did not expire SECURITY-626 : Scripts that obtain a crumb using the /crumbIssuer/api URL will now fail to perform actions protected from CSRF unless the scripts retain the web session ID in subsequent requests. -Dhudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID=true enable crumb proxy compatibility -Djenkins.model.Jenkins.crumbIssuerProxyCompatibility=true change workspace name # default -Djenkins.model.Jenkins.workspaceDirName='workspace' workspace path # default -Djenkins.model.Jenkins.workspacesDir=\"${JENKINS_HOME}/workspace/${ITEM_FULL_NAME}\" a cache for UserDetails should be valid # default 2 mins -Djenkins.security.UserDetailsCache.EXPIRE_AFTER_WRITE_SEC=120 copyArtifacts v1.29 : JENKINS-14999 : Support for QueueItemAuthenticator -Dhudson.security.ArtifactsPermission=true Unauthorized view fragment access # to disable the feature -Djenkins.security.stapler.StaplerDispatchValidator.disabled=false System Properties java.lang.System java.util.Properties jenkins.util.SystemProperties Controlling features of Hudson using system properties set property System.setProperty('org.apache.commons.jelly.tags.fmt.timeZone', 'Asia/Shanghai') System.setProperty('user.timezone', 'Asia/Shanghai') setup user.timezone in Jenkins println( System.getProperty('user.timezone') ); System.setProperty('user.timezone', 'Asia/Shanghai'); println( System.getProperty('user.timezone') ) enable crumb proxy compatibility System.setProperty('jenkins.model.Jenkins.crumbIssuerProxyCompatibility', 'true') System.getProperty('jenkins.model.Jenkins.crumbIssuerProxyCompatibility') setup CSRF protection tokens did not expire for SECURITY-626 System.setProperty('hudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID', 'true') System.getProperty('hudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID') get property get all properties System.getProperties() or System.getProperties().each { k, v -> println \" >>> ${k} ~> ${v} \" } get system environment : System.getenv()System.getenv().each { k, v -> println \" >>> ${k} ~> ${v} \" } i.e.:System.getenv().JAVA_OPTS Configuring HTTP remote configuration information: ${PROTOCOL_FULLY_QUALIFIED_NAME}.disabled: where PROTOCOL_FULLY_QUALIFIED_NAME equals PROTOCOL_HANDLER_CLASSNAME without the Handler suffix. description hudson.remoting.FlightRecorderInputStream.BUFFER_SIZE : Size (in bytes) of the flight recorder ring buffer used for debugging remoting issues hudson.remoting.Launcher.pingIntervalSec : Seconds between ping checks to monitor health of agent nodes; 0 to disable ping | hudson.remoting.Launcher.pingTimeoutSec : If ping of agent node takes longer than this, consider it dead; 0 to disable ping | hudson.remoting.RemoteClassLoader.force : Class name String. Forces loading of the specified class name on incoming requests. Works around issues like JENKINS-19445 | hudson.remoting.Engine.socketTimeout : Socket read timeout in milliseconds. If timeout happens and the failOnSocketTimeoutInReader property is true, the channel will be interrupted. | hudson.remoting.SynchronousCommandTransport.failOnSocketTimeoutInReader : Boolean flag. Enables the original aggressive behavior, when the channel reader gets interrupted by any SocketTimeoutException | hudson.remoting.ExportTable.unexportLogSize : Defines number of entries to be stored in the unexport history, which is being analyzed during the invalid object ID analysis. | ${PROTOCOL_FULLY_QUALIFIED_NAME}.disabled : Boolean flag, which allows disabling particular protocols in remoting. Property example: org.jenkinsci.remoting.engine.JnlpProtocol3.disabled | org.jenkinsci.remoting.nio.NioChannelHub.disabled : Boolean flag to disable NIO-based socket connection handling, and switch back to classic IO. Used to isolate the problem. | org.jenkinsci.remoting.engine.JnlpAgentEndpointResolver.protocolNamesToTry : If specified, only the protocols from the list will be tried during the connection. The option provides protocol names, but the order of the check is defined internally and cannot be changed. | System property Default value Since Jenkins version(s) Related issues hudson.remoting.FlightRecorderInputStream.BUFFER_SIZE 1048576 2.41 1.563 JENKINS-22734 hudson.remoting.Launcher.pingIntervalSec 0 since 2.60, 600 before 2.0 1.367 JENKINS-35190 hudson.remoting.Launcher.pingTimeoutSec 240 2.0 1.367 N/A hudson.remoting.RemoteClassLoader.force null 2.58 2.4 JENKINS-19445 (workaround) hudson.remoting.Engine.socketTimeout 30 minutes 2.58 2.4 JENKINS-34808 hudson.remoting.SynchronousCommandTransport.failOnSocketTimeoutInReader false 2.60 TODO JENKINS-22722 hudson.remoting.ExportTable.unexportLogSize 1024 2.40 ? JENKINS-20707 ${PROTOCOL_FULLY_QUALIFIED_NAME}.disabled false 2.59 2.4 JENKINS-34819 org.jenkinsci.remoting.nio.NioChannelHub.disabled false 2.62.3 TODO JENKINS-39290 org.jenkinsci.remoting.engine.JnlpAgentEndpointResolver.protocolNamesToTry false TODO TODO JENKINS-41730 Upgrading Jenkins Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:31 "},"jenkins/config/windows.html":{"url":"jenkins/config/windows.html","title":"windows","keywords":"","body":" Table of Contents generated with DocToc windows agent windows agent configuration start service remove service windows agent reference windows agent: How to create an agent in Linux from console How to Install Several Windows Agents as a Service? Launch Java Web Start slave agent via Windows Scheduler Step by step guide to set up master and agent machines on Windows windows services: sc.exe query windows agent configuration jenkins node start service open the node connection page -> Launch -> File -> Install as a server setup jenkins-slave.exe install and start service by cmd -> sc.exe C:\\WINDOWS\\system32>sc.exe create \"jenkins\" start= auto binPath= \"E:\\devops\\jenkins-slave.exe\" DisplayName= \"jenkins\" [SC] CreateService SUCCESS C:\\WINDOWS\\system32>sc description jenkins \"the windows agent for jenkins >\" [SC] ChangeServiceConfig2 SUCCESS C:\\WINDOWS\\system32>sc start jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 2 START_PENDING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 PID : 27784 FLAGS : service configuration C:\\WINDOWS\\system32>sc config jenkins start= disabled [SC] ChangeServiceConfig SUCCESS C:\\WINDOWS\\system32>sc query jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 4 RUNNING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 list all services C:\\WINDOWS\\system32>sc queryex type=service state=all | find /i \"SERVICE_NAME:\" SERVICE_NAME: AJRouter SERVICE_NAME: ALG SERVICE_NAME: AppIDSvc SERVICE_NAME: Appinfo SERVICE_NAME: AppMgmt SERVICE_NAME: AppReadiness SERVICE_NAME: AppVClient SERVICE_NAME: AppXSvc SERVICE_NAME: AudioEndpointBuilder SERVICE_NAME: Audiosrv SERVICE_NAME: AxInstSV ... setup service remove service C:\\WINDOWS\\system32>sc stop jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 3 STOP_PENDING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 C:\\WINDOWS\\system32>sc delete jenkins [SC] DeleteService SUCCESS C:\\WINDOWS\\system32>taskkill /F /IM mmc.exe SUCCESS: The process \"mmc.exe\" with PID 19572 has been terminated. or remove HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\jenkins Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:31 "},"jenkins/jenkinsfile/jenkinsfile.html":{"url":"jenkins/jenkinsfile/jenkinsfile.html","title":"jenkinsfile","keywords":"","body":" Table of Contents generated with DocToc jenkins API update node name raw build manager.build.result.isBetterThan customized build display name description exception using hudson.AbortException show catch message reference: Pipeline Examples Jenkins Pipeline Syantx Pipeline Steps Reference Pipeline Utility Steps Jenkins Pipeline Cookbook jenkins API update node name get label @NonCPS def getLabel(){ for (node in jenkins.model.Jenkins.instance.nodes) { if (node.getNodeName().toString().equals(\"${env.NODE_NAME}\".toString())) { currentLabel = node.getLabelString() return currentLabel } } } set label @NonCPS def updateLabel(nodeName, newLabel) { def node = jenkins.model.Jenkins.instance.getNode(nodeName) if (node) { node.setLabelString(newLabel) node.save() } } Jenkinsfile Example String curLabel = null String newLabel = null String testNodeName = null String curProject = env.JOB_NAME String curBuildNumber = env.BUILD_NUMBER node(\"master\") { try{ stage(\"reserve node\") { node(\"${params.tmNode}\") { testNodeName = env.NODE_NAME curLabel = getLabel() newLabel = \"${curLabel}~running_${curProject}#${curBuildNumber}\" echo \"~~> lock ${testNodeName}. update lable: ${curLabel} ~> ${newLabel}\" updateLabel(testNodeName, newLabel) } // node } // reserve stage } finally { if (newLabel) { stage(\"release node\") { nodeLabels = \"${newLabel}\".split('~') orgLabel = nodeLabels[0] echo \"~~> release ${testNodeName}. update lable ${newLabel} ~> ${orgLabel}\" updateLabel(testNodeName, orgLabel) } // release stage } // if } // finally raw build reference: org.jenkinsci.plugins.workflow.support.steps.build.RunWrapper hudson.model.Build hudson.model.Run Map buildResult = [:] node(\"master\") { buildResult = build job: '/marslo/artifactory-lib', propagate: true, wait: true buildResult.each { println it } println \"\"\" \"result\" : ${buildResult.result} \"getBuildVariables()\" : ${buildResult.getBuildVariables()} \"getBuildVariables().mytest\" : ${buildResult.getBuildVariables().mytest} \"getRawBuild().getEnvVars()\" : ${buildResult.getRawBuild().getEnvVars()} \"getRawBuild().getEnvironment()\" : ${buildResult.getRawBuild.getEnvironment()} \"getBuildCauses()\" : ${buildResult.getBuildCauses()} \"getChangeSets()\" : ${buildResult.getChangeSets()} \"buildVariables[\"mytest\"]\" : ${buildResult.buildVariables[\"mytest\"]} \"buildResult.rawBuild\" : ${buildResult.rawBuild} \"buildResult.rawBuild.log\" : ${buildResult.rawBuild.log} \"rawBuild.environment.RUN_CHANGES_DISPLAY_URL\" : ${buildResult.rawBuild.environment.RUN_CHANGES_DISPLAY_URL} \"\"\" } // node get changeSets reference: hudson.plugins.git.GitChangeSet hudson.scm.ChangeLogSet Interface ChangeLogSet.AffectedFile Class ChangeLogSet.Entry hudson.model.AbstractBuild How to access Changelogs in a Pipeline Job? lsjostro/changesets.groovy def res = [:] timestamps { ansiColor('xterm') { node('master'){ cleanWs() buildResult = build '/marslo/down' if( currentBuild.rawBuild.changeSets.isEmpty() ) { println \"no new code committed\" } else { buildResult.rawBuild.changeSets.each { cs -> cs.items.each { item -> println \"\"\" ----------------------------- revision : ${item.commitId} author : ${item.author} message : ${item.msg} affected files : \\t\\t${item.affectedFiles.collect{ f -> f.editType.name + ' - ' + f.path }.join('\\n\\t\\t\\t\\t')} \"\"\" } } } } }} via api $ curl -sSg \\ https://my.jenkins.com/job//job///api/json | jq -r .changeSets[] # or $ curl -sSg \\ https://my.jenkins.com/job//job///api/json?depth=100&&tree=changeSets[*[*]] manager.build.result.isBetterThan if( manager.build.result.isBetterThan(hudson.model.Result.UNSTABLE) ) { def cmd = 'ssh -p 29418 $host gerrit review --verified +1 --code --review +2 --submit $GERRIT_CHANGE_NUMBER,$GERRIT_PATCHSET_NUMBER' cmd = manager.build.environment.expand(cmd) manager.listener.logger.println(\"Merge review: '$cmd'\") def p = \"$cmd\".execute() manager.listener.logger.println(p.in.text) manager.addShortText(\"M\") } customized build display name currentBuild.displayName = '#' + Integer.toString(currentBuild.number) + ' mytest' description currentBuild.description = 'this is whitebox' exception using hudson.AbortException import hudson.AbortException throw new AbortException( \"throw aborted exception\" ) show catch message try { throw new AbortException( \"throw aborted exception\" ) } catch(e) { def sw = new StringWriter() e.printStackTrace( new PrintWriter(sw) ) println sw.toString() // throw e // if not throw error, the catch process will only print the error message } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:34 "},"jenkins/jenkinsfile/utility.html":{"url":"jenkins/jenkinsfile/utility.html","title":"utility","keywords":"","body":" Table of Contents generated with DocToc Pipeline Utility Steps findFiles send mail with catch error tips Evaluate a Groovy source file into the Pipeline script load a constant extend the pipeline DSL with groovy others handle api withCredentials push with ssh private credentials Pipeline Utility Steps findFiles jenkinsfilesh \"touch a.txt\" def files = findFiles (glob: \"**/*.txt\") println \"\"\" name : ${files[0].name} path : ${files[0].path} directory : ${files[0].directory} length : ${files[0].length} lastModified : ${files[0].lastModified} \"\"\" result [Pipeline] sh (hide) + touch a.txt [Pipeline] findFiles [Pipeline] echo name : a.txt path : a.txt directory : false length : 0 lastModified : 1605525397000 send mail with catch error try { sh 'might fail' mail subject: 'all well', to: 'admin@somewhere', body: 'All well.' } catch (e) { def w = new StringWriter() e.printStackTrace(new PrintWriter(w)) mail subject: \"failed with ${e.message}\", to: 'admin@somewhere', body: \"Failed: ${w}\" throw e } tips java.io.NotSerializableException: groovy.lang.IntRange refenrece: Groovy Range Examples Groovy For Loop Examples caused via (1..5).each { println it } solution IntRange.flatten()(1..5).flatten().each { println it } IntRange.toList()(1..5).toList().each { println it } Evaluate a Groovy source file into the Pipeline script references: Load From File load a constant see also imarslo : groovy metaClass groovy file ( constant.groovy ) @Field final Map> FOO = [ 'k1' : [ 'k11' : 'v11' ], 'k2' : [ 'k21' : 'v21', 'k22' : 'v22' ] ] Jenkinsfile Object matrix = load( '/path/to/constant.groovy' ) if ( matrix.metaClass.hasProperty(matrix, 'FOO') ) { println \"\"\" matrix.FOO : ${matrix.FOO} matrix.FOO.k1 : ${matrix.FOO.k1} matrix.type : ${matrix.metaClass.hasProperty(matrix, 'FOO').type} \"\"\" } result matrix.FOO : [k1:[k11:v11], k2:[k21:v21, k22:v22]] matrix.FOO.k1 : [k11:v11] matrix.type : interface java.util.Map extend the pipeline groovy script ( builtInStage.groovy ) String str = \"this is string A\" def stageA( String path ) { stage('scenario A') { println path } } def stageB() { stage('scenario B') { println str } } def stageC() { stage('scenario C') { String strC = \"this is string C\" sh \"echo ${strC}\" println strC } } def runAllStages( String basePath ) { stageA( basePath ) stageB() stageC() } return this Jenkinsfile node('master') { stage( 'download code' ) { echo 'prepare' sh \"cat ${WORKSPACE}/builtInStage.groovy\" } test = load \"builtInStage.groovy\" test.runAllStages( \"${WORKSPACE}/mypath\" ) stage( 'publish' ) { echo 'done!' } } stage view DSL with groovy original DSL: cleanWs( deleteDirs: true, disableDeferredWipeout: true, notFailBuild: true, patterns: [ [ pattern: 'b.txt', type: 'INCLUDE' ] , [ pattern: 'a.txt', type: 'INCLUDE' ] ] ) Spread Operator Groovy Goodness: the Spread Operato List p = [ 'a.txt', 'b.txt' ] cleanWs( deleteDirs: true, disableDeferredWipeout: true, notFailBuild: true, patterns: [ *p.collect { [pattern: \"${it}\", type: 'INCLUDE'] } ] ) List.collect List p = [ 'a.txt', 'b.txt' ] cleanWs( deleteDirs: true, disableDeferredWipeout: true, notFailBuild: true, patterns: p.collect { [pattern: \"${it}\", type: 'INCLUDE'] } ) with API import hudson.plugins.ws_cleanup.Pattern import hudson.plugins.ws_cleanup.Pattern.PatternType List p = [ 'a.txt', 'b.txt' ] cleanWs( deleteDirs: true, disableDeferredWipeout: true, notFailBuild: true, patterns: p.collect { new Pattern(it, PatternType.INCLUDE) } ) with pure API Javadoc: hudson.plugins.ws_cleanup.WsCleanup hudson.plugins.ws_cleanup.Pattern hudson.plugins.ws_cleanup.Pattern.PatternType FilePath Launcher TaskListener get FilePath : Using FilePath to access workspace on slave in Jenkins pipeline import hudson.plugins.ws_cleanup.WsCleanup import hudson.plugins.ws_cleanup.Pattern import hudson.plugins.ws_cleanup.Pattern.PatternType List p = [ 'a.txt', 'b.txt' ] WsCleanup wsc = new WsCleanup() wsc.setDeleteDirs(true) wsc.setDisableDeferredWipeout(true) wsc.setNotFailBuild(true) wsc.setPatterns( p.each { new Pattern( it, PatternType.INCLUDE ) } ) // unresolved wsc.perform( currentBuild.rawBuild, , , ) others handle api Demo: Processing Github JSON from Groovy import groovy.json.JsonSlurper String username = System.getenv('GITHUB_USERNAME') String password = System.getenv('GITHUB_PASSWORD') String GITHUB_API = 'https://api.github.com/repos' String repo = 'groovy' String PR_ID = '2' // Pull request ID String url = \"${GITHUB_API}/${username}/${repo}/pulls/${PR_ID}\" println \"Querying ${url}\" def text = url.toURL().getText(requestProperties: ['Authorization': \"token ${password}\"]) def json = new JsonSlurper().parseText(text) def bodyText = json.body // Check if Pull Request body has certain text if ( bodyText.find('Safari') ) { println 'Found Safari user' } withCredentials push with ssh private credentials references: Git Credentials Binding for sh, bat, powershell Git credentials binding for sh, bat, and powershell Is it possible to Git merge / push using Jenkins pipeline Pipeline - Equivalent to Git Publisher [!NOTE] If for any particular reason, the push must be done using a different method the URL needs to be configured accordingly: git config url.git@github.com/.insteadOf https://github.com/ : if the checkout was done through HTTPS but push must be done using SSH git config url.https://github.com/.insteadOf git@github.com/ : if the checkout was done through SSH but push must be done using HTTPS withCredentials([ sshUserPrivateKey( credentialsId : 'GITSSHPRIVATEKEY', keyFileVariable : 'SSHKEY', usernameVariable : 'USERNAME' ) ]) { sh \"\"\" GIT_SSH_COMMAND = \"ssh -i $SSH_KEY -o User=${USERNAME} -o StrictHostKeyChecking=no\" git push origin : \"\"\" } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:35 "},"jenkins/jenkinsfile/parallel.html":{"url":"jenkins/jenkinsfile/parallel.html","title":"parallel","keywords":"","body":" Table of Contents generated with DocToc parallel static dynamic reference: Jobs In Parallel Parallel From List Parallel Multiple Nodes Trigger Job On All Nodes parallel static timestamps { ansiColor('xterm') { parallel([ 'k1 \\u00BB v1': { stage( 'build k1' ) { node(\"master\") { println \"KEY= k1, VALUE=v1\" sleep 3 } // node } }, 'k2 \\u00BB v2': { stage( 'build k2' ) { node(\"master\") { println \"KEY= k2, VALUE=v2\" sleep 3 } // node } }, 'k3 \\u00BB v3': { stage( 'build k3' ) { node(\"master\") { println \"KEY= k3, VALUE=v3\" sleep 3 } // node } } ]) println 'done' }} // ansiColor | timestamps dynamic timestamps { ansiColor('xterm') { Map worker = [:] Map data = [ \"k1\": \"v1\", \"k2\": \"v2\", \"k3\": \"v3\", ] data.each { k ,v -> worker[\"${k} \\u00BB ${v}\"] = { stage(\"build ${k}\") { node(\"master\") { println \"\"\" --------------- \"KEY=${k} VALUE=${v}\" --------------- \"\"\" sleep 3 } // node : master } // stage } // work } parallel worker println \"done !\" }} // ansiColor | timestamps Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:35 "},"jenkins/jenkinsfile/build.html":{"url":"jenkins/jenkinsfile/build.html","title":"build","keywords":"","body":" Table of Contents generated with DocToc build & current build get all current build parameters check previous build status Stop the current build get current build info trigger downstream builds get changelogs stage and build warnError catchError error unstable get stage of a build Build Result isWorthThan build & current build get all current build parameters import hudson.model.* timestamps { ansiColor('xterm') { node('master') { def parameters = currentBuild.rawBuild?.actions.find{ it instanceof ParametersAction }?.parameters parameters.each { println \"parameter ${it.name}:\" println it.dump() println \"-\" * 80 } } }} check previous build status useful info: method hudson.model.Run getPreviousBuild method hudson.model.Run getResult method org.jenkinsci.plugins.workflow.support.steps.build.RunWrapper getRawBuild if(!hudson.model.Result.SUCCESS.equals(currentBuild.rawBuild.getPreviousBuild()?.getResult())) { echo \"last build failed\" } Stop the current build stop current // stop and show status to UNSTABLE if ( 'UNSTABLE' == currentBuild.result ) { currentBuild.getRawBuild().getExecutor().interrupt(Result.UNSTABLE) } or import hudson.model.Result import hudson.model.Run import jenkins.model.CauseOfInterruption println \">> Aborting older build #${previousBuild.number}\" def cause = { \"interrupted by build #${currentBuild.getId()}\" as String } as CauseOfInterruption executor.interrupt(Result.ABORTED, cause) abort previous running build import hudson.model.Result import hudson.model.Run import jenkins.model.CauseOfInterruption def abortPreviousBuilds() { Run previousBuild = currentBuild.getPreviousBuildInProgress() while (previousBuild != null) { if (previousBuild.isInProgress()) { def executor = previousBuild.getExecutor() if (executor != null) { println \">> Aborting older build #${previousBuild.number}\" def cause = { \"interrupted by build #${currentBuild.getId()}\" as String } as CauseOfInterruption executor.interrupt(Result.ABORTED, cause) } } previousBuild = previousBuild.getPreviousBuildInProgress() } } or Stopping Jenkins job in case newer one is started import hudson.model.Result import jenkins.model.CauseOfInterruption //iterate through current project runs build.getProject()._getRuns().each{id,run-> def exec = run.getExecutor() //if the run is not a current build and it has executor (running) then stop it if( run!=build && exec!=null ){ //prepare the cause of interruption def cause = new CauseOfInterruption(){ public String getShortDescription(){ return \"interrupted by build #${build.getId()}\" } } exec.interrupt(Result.ABORTED, cause) } } //just for test do something long... Thread.sleep(10000) stop all Thread.getAllStackTraces().keySet().each() { t -> if (t.getName()==\"YOUR THREAD NAME\" ) { t.interrupt(); } // or t.stop(); } // and Jenkins.instance.getItemByFullName(\"JobName\") .getBuildByNumber(JobNumber) .finish( hudson.model.Result.ABORTED, new java.io.IOException(\"Aborting build\") ); get current build info reference: How to get Jenkins build job details? get BUILD_NUMBER Jenkins.instance.getItemByFullName(env.JOB_NAME).getLastBuild().getNumber().toInteger() get build id of lastSuccessfulBuild get via api sh \"\"\" curl -sSLg 'https:///job//api/json' -o 'output.json' \"\"\" def data = readJSON file: 'output.json' println data.lastSuccessfulBuild.number get via Jenkins.instance.getItemByFullName(env.JOB_NAME) println Jenkins.instance.getItemByFullName(env.JOB_NAME).lastSuccessfulBuild.number get last build idprintln Jenkins.instance.getItemByFullName(env.JOB_NAME).getLastBuild().getNumber().toInteger() trigger downstream builds timestamps { ansiColor('xterm') { node('master') { stage('trigger downstream') { buildRes = build job: '/marslo/downstream', propagate: false, parameters: [ string( name: 'stringParams', value: 'string' ) , string( name: 'choiceParams', value: 'validChoice' ) , booleanParam( name: 'booleanParams', value: false ) , ] String log = \"\"\" result : ${buildRes.result} url : ${buildRes.absoluteUrl} build number : ${buildRes.number.toString()} \"\"\" println log } // stage : trigger downstream } // node : master }} // ansiColor | timestamps trigger downstream with active choice parameters /marslo/sandbox timestamps { ansiColor('xterm') { podTemplate(cloud: 'DevOps Kubernetes') { node(POD_LABEL) { List newParams = [ [$class: 'StringParameterValue' , name: 'lastName' , value: 'Jiao' ] , [$class: 'StringParameterValue' , name: 'firstName' , value: 'Marslo' ] , [$class: 'StringParameterValue' , name: 'provinces' , value: 'Gansu' ] , [$class: 'StringParameterValue' , name: 'cities' , value: 'Lanzhou,Dingxi' ] , [$class: 'BooleanParameterValue', name: 'notify', value: false] ] def res = build ( job: '/marslo/sandbox' , propagate : false , wait : true , parameters: newParams ) println \"\"\" result : ${res.result} url : ${res.absoluteUrl} build number : ${res.number.toString()} \"\"\" }} // node | podTemplate }} // ansiColor | timestamp get changelogs def changeLogSets = currentBuild.changeSets for (int i = 0; i Pipeline Supporting APIs Plugin older than 2.2def changeLogSets = currentBuild.rawBuild.changeSets for (int i = 0; i stage and build reference: Jenkins Pipeline Stage Result Visualization Improvements org.jenkinsci.plugins.workflow.steps.Step /plugin/workflow-basic-steps/org/jenkinsci/plugins/workflow/steps/ pipeline-stage-step-plugin/blob/master/src/main/java/org/jenkinsci/plugins/workflow/support/steps/StageStep.java org.jenkinsci.plugins.workflow.steps.CatchErrorStep org.jenkinsci.plugins.workflow.steps.WarnErrorStep warnError: Catch error and set build and stage result to unstable catchError: Catch error and set build result to failure Set a stage status in Jenkins Pipelines How to time out Jenkins Pipeline stage and keep the pipeline running? warnError node('master') { warnError('Script failed!') { sh('false') } } catchError stage('false') { catchError( buildResult : 'SUCCESS', message : 'stage failed, but build succeed', stageResult : 'FAILURE' ){ sh label: env.STAGE_NAME, script: 'exit 2' } } or just be simply: catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') { sh('false') } set unstable catchError(message: 'script failed', buildResult: 'UNSTABLE', stageResult: 'UNSTABLE') { sh('false') } catchError unstable error Signals an error. Useful if you want to conditionally abort some part of your program. You can also just throw new Exception(), but this step will avoid printing a stack trace error( 'failed the build' ) unstable Prints a message to the log and sets the overall build result and the stage result to UNSTABLE. The message will also be associated with the stage result and may be shown in visualizations. unstable( 'unstable the build' ) get stage of a build get stage namestage('build') { println \"${env.STAGE_NAME}\" } get all stages of a build WorkflowRun run = Jenkins.instance.getItemByFullName(\"####YOUR_JOB_NAME####\")._getRuns()[0] FlowExecution exec = run.getExecution() PipelineNodeGraphVisitor visitor = new PipelineNodeGraphVisitor(run) def flowNodes = visitor.getPipelineNodes() for (Iterator iterator = flowNodes.iterator(); iterator.hasNext();) { def node = iterator.next() if (node.getType() == FlowNodeWrapper.NodeType.STAGE) { String stageName = node.getDisplayName() def stageResult = node.getStatus().getResult() println \"Result of stage ${stageName} is ${stageResult}\" } } or import org.jenkinsci.plugins.workflow.graph.FlowGraphWalker import org.jenkinsci.plugins.workflow.graph.FlowNode try { // just for demo, a success step and a failure step node { sh 'true' sh 'false' } } finally { FlowGraphWalker walker = new FlowGraphWalker(currentBuild.rawBuild.getExecution()) for (FlowNode flowNode: walker) { // do whatever you want with flowNode echo flowNode.dump() } } Build Result reference How to manipulate the build result of a Jenkins pipeline job How to set current build result in Pipeline hudson.module.Result API isWorthThan import hudson.model.Result ansiColor('xterm') { List r = [ 'SUCCESS', 'UNSTABLE', 'FAILURE', 'NOT_BUILT', 'ABORTED' ] r.each { b -> println \" ~~> ${b}\" Result base = Result.fromString(b) ( r - b ).each { o -> Result x = Result.fromString(o) res = base.isWorseThan(x) color.echo( \"${res ? 'green' : 'red'}\", \"${base} isWorthThan ${x} : ${res}\" ) } } } // ansiColor Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:35 "},"jenkins/jenkinsfile/envvar.html":{"url":"jenkins/jenkinsfile/envvar.html","title":"envvar","keywords":"","body":" Table of Contents generated with DocToc environment variables get current customized environment get downstream build environment get previous build environment global environment System.getenv() sh 'env' or sh 'printenv' env.getEnvironment() or currentBuild.getRawBuild().getEnvironment() get builds environment setup environment using Groovy script Creating Local Environment Variables references: Jenkins Pipeline Environment Variables - The Definitive Guide Using environment variables in Jenkins pipelines - with examples Jenkins Pipeline - set and use environment variables environment variables get current customized environment println currentBuild.getBuildVariables()?.MY_ENV get downstream build environment def res = build job: 'downstream-job', propagate: false println res.getBuildVariables()?.MY_ENV get previous build environment println currentBuild.getPreviousBuild().getBuildVariables()?.MY_ENV global environment System.getenv() To get the Jenkins Global environment variables System.getenv().collect { k, v -> \"$k=$v\" }.join('\\n>>> ') resultPATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin >>> PWD=/ >>> LANGUAGE=en_US:en >>> LC_ALL=en_US.UTF-8 >>> SHLVL=0 >>> JAVA_HOME=/opt/java/openjdk >>> JENKINS_VERSION=2.284 >>> JAVA_VERSION=jdk8u282-b08 >>> JENKINS_UC=https://updates.jenkins.io >>> JAVA_OPTS=-Xms48G -Xmx144G -Duser.timezone='America/Los_Angeles' -XX:+UseG1GC -Dhudson.model.DirectoryBrowserSupport.CSP=\"sandbox allow-same-origin allow-scripts; default-src 'self'; script-src * 'unsafe-eval'; img-src *; style-src * 'unsafe-inline'; font-src *;\" -Djenkins.slaves.NioChannelSelector.disabled=true -Djenkins.slaves.JnlpSlaveAgentProtocol3.enabled=false -Djava.awt.headless=true -Djenkins.security.ClassFilterImpl.SUPPRESS_WHITELIST=true -Dhudson.model.ParametersAction.keepUndefinedParameters=true -Dcom.cloudbees.workflow.rest.external.ChangeSetExt.resolveCommitAuthors=true -Djenkins.install.runSetupWizard=true -Dpermissive-script-security.enabled=true -DsessionTimeout=1440 -DsessionEviction=43200 -Dgroovy.grape.report.downloads=true -Divy.message.logger.level=4 -Dhudson.plugins.active_directory.ActiveDirectorySecurityRealm.forceLdaps=false ... sh 'env' or sh 'printenv' running script in agent, so the result is the agent system environment variables + job itself variables (i.e: params and ${env.JENKINS_xxx}) sh 'env' // or sh 'printenv | sort' resultAGENT_WORKDIR=/home/devops/agent BUILD_DISPLAY_NAME=#1332 BUILD_ID=1332 BUILD_NUMBER=1332 BUILD_TAG=jenkins-marslo-sandbox-1332 BUILD_TIMESTAMP=2021-05-07 00:02:22 PDT JENKINS_HOME=/var/jenkins_home JOB_BASE_NAME=sandbox MY_TEST=works // particular environment setup in agent itself (linux) PATH=/it/my/test:/test/again:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin SHLVL=1 TERM=xterm ... env.getEnvironment() or currentBuild.getRawBuild().getEnvironment() pure Jenkins job's environment variables (and parameters) println currentBuild.getRawBuild().getEnvironment() // or println prettyPrint( toJson(env.getEnvironment()) ) result {BUILD_DISPLAY_NAME=#1332, BUILD_ID=1332, BUILD_NUMBER=1332, BUILD_TAG=jenkins-marslo-sandbox-1332, BUILD_TIMESTAMP=2021-05-07 00:02:22 PDT, CLASSPATH=, HUDSON_HOME=/var/jenkins_home, JENKINS_HOME=/var/jenkins_home, ...} // or { \"BUILD_DISPLAY_NAME\": \"#1335\", \"BUILD_ID\": \"1335\", \"BUILD_NUMBER\": \"1335\", \"BUILD_TAG\": \"jenkins-marslo-sandbox-1335\", \"BUILD_TIMESTAMP\": \"2021-05-07 00:26:40 PDT\", \"CLASSPATH\": \"\", \"HUDSON_HOME\": \"/var/jenkins_home\", \"JOB_NAME\": \"marslo/sandbox\", ... } get builds environment references: Access to build environment variables from a groovy script in a Jenkins build step (Windows) import hudson.model.* def build = Thread.currentThread().executable def myVar = build.getBuildVariables().get('myVar') or import hudson.slaves.EnvironmentVariablesNodeProperty import hudson.EnvVars import hudson.model.BuildableItem import hudson.model.Job import jenkins.model.*; jenkins = Jenkins.instance; EnvironmentVariablesNodeProperty prop = jenkins.getGlobalNodeProperties().get(EnvironmentVariablesNodeProperty.class) EnvVars env = prop.getEnvVars() println env['MY_VAR'] setup environment using Groovy script import hudson.EnvVars; import hudson.slaves.EnvironmentVariablesNodeProperty; import hudson.slaves.NodeProperty; import hudson.slaves.NodePropertyDescriptor; import hudson.util.DescribableList; import jenkins.model.Jenkins; public createGlobalEnvironmentVariables(String key, String value){ Jenkins instance = Jenkins.getInstance(); DescribableList, NodePropertyDescriptor> globalNodeProperties = instance.getGlobalNodeProperties(); List envVarsNodePropertyList = globalNodeProperties.getAll(EnvironmentVariablesNodeProperty.class); EnvironmentVariablesNodeProperty newEnvVarsNodeProperty = null; EnvVars envVars = null; if ( envVarsNodePropertyList == null || envVarsNodePropertyList.size() == 0 ) { newEnvVarsNodeProperty = new hudson.slaves.EnvironmentVariablesNodeProperty(); globalNodeProperties.add(newEnvVarsNodeProperty); envVars = newEnvVarsNodeProperty.getEnvVars(); } else { envVars = envVarsNodePropertyList.get(0).getEnvVars(); } envVars.put(key, value) instance.save() } createGlobalEnvironmentVariables('Var1','Dummy') Creating Local Environment Variables declarative pipelinepipeline { agent any environment { DISABLE_AUTH = 'true' //can be used in whole pipeline } stages { stage(“Build”) { steps { echo env.DISABLE_AUTH } } } } scripted pipelinenode{ stage('Build') { withEnv([\"DISABLE_AUTH=true\"]) { echo env.DISABLE_AUTH } } } update Jenkins envvars in Jenkisnfile import jenkins.* import jenkins.model.* import hudson.* import hudson.model.* import hudson.slaves.* def updateEnvVar() { script { instance = Jenkins.getInstance() globalNodeProperties = instance.getGlobalNodeProperties() envVarsNodePropertyList = globalNodeProperties.getAll(hudson.slaves.EnvironmentVariablesNodeProperty.class) newEnvVarsNodeProperty = null envVars = null if ( envVarsNodePropertyList == null || envVarsNodePropertyList.size() == 0 ) { newEnvVarsNodeProperty = new hudson.slaves.EnvironmentVariablesNodeProperty(); globalNodeProperties.add(newEnvVarsNodeProperty); envVars = newEnvVarsNodeProperty.getEnvVars(); envVars.put(NEW_VAR, \"toto\"); } else { for (property in envVarsNodePropertyList) { envVars = property.getEnvVars(); envVars.put(\"EXISTING_VAR\",\"tata\"); } } instance.save() } } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:34 "},"jenkins/jenkinsfile/properties.html":{"url":"jenkins/jenkinsfile/properties.html","title":"properties","keywords":"","body":" Table of Contents generated with DocToc parameters active choice parameters mixed parameters Jenkins 2.0 pipeline: Scripting active parameters for SCM reference: Class ParametersAction Class ParameterValue parameters Parameterized System Groovy script How to retrieve Jenkins build parameters using the Groovy API? parameters properties([ parameters([ string( defaultValue: '', name: 'stringParams', description: '', trim: false ), string( defaultValue: 'default', name: 'stringDefaultParams', description: '', trim: false ), validatingString( defaultValue: '', name: 'validatingString', regex: '.+', description: 'format: .+', failedValidationMessage: 'cannot be empty' ), choice( choices: ['a', 'b', 'c', 'd'], name: 'choiceParams', description: '' ), booleanParam( defaultValue: false, name: 'booleanParams', description: '' ) ]) ]) active choice parameters properties([ parameters([ [ $class: 'ChoiceParameter', name: 'provinces', choiceType: 'PT_SINGLE_SELECT', description: '', script: [ $class: 'GroovyScript', fallbackScript: [classpath: [], sandbox: false, script: '#!groovy return [\"accept in ScriptApproval first\"]'], script: [classpath: [], sandbox: false, script: '''return[ \\'Gansu\\', \\'Sichuan\\', \\'Disabled:disabled\\' ]''' ] ] ], // ChoiceParameter [ $class: 'CascadeChoiceParameter', name: 'cities', referencedParameters: 'provinces', choiceType: 'PT_CHECKBOX', description: '', script: [ $class: 'GroovyScript', fallbackScript: [classpath: [], sandbox: false, script: '#!groovy return [\"accept in ScriptApproval first\"]'], script: [classpath: [], sandbox: false, script: '''if (provinces.equals(\"Gansu\")) { return [\"Lanzhou\", \"Dingxi\"] } else if (provinces.equals(\"Sichuan\")) { return [\"Leshan\", \"Guangyuan:disabled\", \"Chengdu:selected\"] } else if (provinces.equals(\"Disabled\")) { return [\"notshow:selected\"] } else { return [\"Unknown provinces\"] }''' ] ]], // CascadeChoiceParameter [ $class: 'StringParameterDefinition' , name: 'lastName' , defaultValue: 'Joe' , description: '' ], // StringParameterDefinition [ $class: 'BooleanParameterDefinition', name: 'notify', defaultValue: false, description: '' ] // BooleanParameterDefinition ]) ]) or import groovy.transform.Field import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript @Field def props = [] @Field def newParams = [] @Field def fb = new SecureGroovyScript(\"\"\"return ['Script Error!']\"\"\", false) @Field def ps = new SecureGroovyScript(\"\"\"return[ 'Gansu', 'Sichuan', 'Disabled:disabled' ]\"\"\", false ) @Field def cs = new SecureGroovyScript(\"\"\"#!groovy Map citySets = [ Gansu : ['Lanzhou', 'Dingxi'] , Sichuan : ['Leshan', 'Guangyuan', 'Chengdu:selected'] , Disabled : ['notshow:selected'] ] return citySets[provinces] \"\"\", false) newParams += [$class: 'ChoiceParameter', name: 'provinces', choiceType: 'PT_SINGLE_SELECT', script: [ $class: 'GroovyScript', script: ps, fallbackScript: fb ], description: '' ] newParams += [$class: 'CascadeChoiceParameter', name: 'cities', referencedParameters: 'provinces', choiceType: 'PT_CHECKBOX', script: [ $class: 'GroovyScript', script: cs, fallbackScript: fb ], description: '' ] props += [$class: 'ParametersDefinitionProperty', parameterDefinitions: newParams] properties( properties: props ) mixed parameters import groovy.transform.Field import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript @Field def props = [] @Field def newParams = [] @Field def fb = new SecureGroovyScript(\"\"\"return ['Script Error!']\"\"\", false) @Field def ps = new SecureGroovyScript(\"\"\"return[ 'Gansu', 'Sichuan', 'Disabled:disabled' ]\"\"\", false ) @Field def cs = new SecureGroovyScript(\"\"\"#!groovy Map citySets = [ Gansu : ['Lanzhou', 'Dingxi'] , Sichuan : ['Leshan', 'Guangyuan', 'Chengdu:selected'] , Disabled : ['notshow:selected'] ] return citySets[provinces] \"\"\", false) newParams += [$class: 'StringParameterDefinition' , name: 'lastName' , defaultValue: 'Joe' , description: ''] newParams += [$class: 'StringParameterDefinition' , name: 'firstName' , defaultValue: 'Dan' , description: ''] newParams += [ $class : 'ValidatingStringParameterDefinition', defaultValue : '' , description : 'timestamps format: YYMMDDHHMMSS' , failedValidationMessage : 'Cannot be empty or failed by Regex validation !' , name : 'timeStamps' , regex : '\\\\d{2,4}(0[1-9]|1[0-2])(0[1-9]|[1-2][0-9]|3[0-1])(2[0-3]|[01][0-9])[0-5][0-9]\\\\d{0,2}' ] newParams += [ $class : 'ChoiceParameter' , name : 'provinces' , choiceType : 'PT_SINGLE_SELECT' , script : [ $class : 'GroovyScript' , script : ps , fallbackScript : fb ] , description : '' ] newParams += [ $class : 'CascadeChoiceParameter' , name : 'cities' , referencedParameters : 'provinces' , choiceType : 'PT_CHECKBOX' , script : [ $class : 'GroovyScript' , script : cs , fallbackScript : fb ] , description : '' ] newParams += [$class: 'BooleanParameterDefinition' , name: 'notify' , defaultValue: false , description: ''] props += [$class: 'ParametersDefinitionProperty' , parameterDefinitions: newParams] properties( properties: props ) podTemplate(cloud: 'DevOps Kubernetes') { node(POD_LABEL) { stage('run') { println \"\"\" lastName : ${params.lastName} firstName : ${params.firstName} provinces : ${params.provinces} cities : ${params.cities} notify : ${params.notify} timeStamps : ${params.timeStamps} \"\"\" } // stage } // node } // podTemplate Jenkins 2.0 pipeline: Scripting active parameters for SCM import groovy.transform.Field import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript @Field def props = [] @Field def newParams = [] node('mster') { setNewProps() } // node void setNewProps() { //Parameters are unknown at first load try { regenerateJob = (params.RegenerateJob == null) ? true : params.RegenerateJob } catch (MissingPropertyException e) { regenerateJob = true } if (regenerateJob) { def fb = new SecureGroovyScript(\"\"\"return ['Script Error!']\"\"\", false) def ps = new SecureGroovyScript(\"\"\"return[ 'Gansu', 'Sichuan', 'Disabled:disabled' ]\"\"\", false ) def cs = new SecureGroovyScript(\"\"\"#!groovy Map citySets = [ Gansu : ['Lanzhou', 'Dingxi'] , Sichuan : ['Leshan', 'Guangyuan', 'Chengdu:selected'] , Disabled : ['notshow:selected'] ] return citySets[provinces] \"\"\", false) println \"Jenkins job ${env.JOB_NAME} gets updated.\" currentBuild.displayName = \"#\" + Integer.toString(currentBuild.number) + \": Initialize job\" newParams += [$class: 'StringParameterDefinition' , name: 'lastName' , defaultValue: 'Joe' , description: ''] newParams += [$class: 'StringParameterDefinition' , name: 'firstName' , defaultValue: 'Dan' , description: ''] newParams += [ $class : 'ValidatingStringParameterDefinition', name : 'timeStamps' , description : 'timestamps format: YYMMDDHHMMSS' , failedValidationMessage : 'Cannot be empty or failed by Regex validation !' , defaultValue : '' , regex : '\\\\d{2,4}(0[1-9]|1[0-2])(0[1-9]|[1-2][0-9]|3[0-1])(2[0-3]|[01][0-9])[0-5][0-9]\\\\d{0,2}' ] newParams += [ $class : 'ChoiceParameter' , name : 'provinces' , choiceType : 'PT_SINGLE_SELECT' , script : [ $class : 'GroovyScript' , script : ps , fallbackScript : fb ] , description : '' ] newParams += [ $class : 'CascadeChoiceParameter' , name : 'cities' , referencedParameters : 'provinces' , choiceType : 'PT_CHECKBOX' , script : [ $class : 'GroovyScript' , script : cs , fallbackScript : fb ] , description : '' ] newParams += [$class: 'BooleanParameterDefinition' , name: 'notify' , defaultValue: false , description: ''] props += [ $class : 'BuildDiscarderProperty', strategy : [$class: 'LogRotator', daysToKeepStr: '30', artifactDaysToKeepStr: '1', artifactNumToKeepStr: ''] ] props += [$class: 'ParametersDefinitionProperty', parameterDefinitions: newParams] properties( properties: props ) } } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:35 "},"jenkins/jenkinsfile/trigger.html":{"url":"jenkins/jenkinsfile/trigger.html","title":"trigger","keywords":"","body":" Table of Contents generated with DocToc trigger poll SCM parameterizedCron triggered by trigger poll SCM properties([ // every 6 hours pipelineTriggers([ pollSCM( ignorePostCommitHooks: true, scmpoll_spec: 'H H/6 * * *' ) ]) ]) properties([ pipelineTriggers([ [ $class: \"SCMTrigger\", scmpoll_spec: 'H/5 * * * *' ], ]) ]) declarative:triggers { pollSCM ignorePostCommitHooks: true, scmpoll_spec: 'H H * * *' } parameterizedCron properties([ parameters([ choice(choices: ['', 'a', 'b', 'c'], description: '', name: 'var1') choice(choices: ['', 'a', 'b', 'c'], description: '', name: 'var2') ]), pipelineTriggers([ parameterizedCron( ''' H/3 * * * * % var1=a; var2=b H/6 * * * * % var1=b; var2=a ''' ) ]) ]) triggered by gitlab gitlab currentBuild.rawBuild.getCause(com.dabsquared.gitlabjenkins.cause.GitLabWebHookCause).getData() // or commit = currentBuild.rawBuild.getCause(com.dabsquared.gitlabjenkins.cause.GitLabWebHookCause).getData().getLastCommit() get build cause def build = currentBuild.rawBuild println build.getCauses().collect { it.getClass().getCanonicalName().tokenize('.').last() } println \"\"\" cause: ${build.getCauses().toString()} cause.getClass(): ${build.getCauses().getClass()} : ${build.getCauses().getClass().getCanonicalName()} build.getCause(hudson.model.Cause.UserIdCause.class): ${build.getCause(hudson.model.Cause.UserIdCause.class)} \"\"\" get user id if triggered by manually def build = currentBuild.rawBuild if ( build.getCause(hudson.model.Cause.UserIdCause.class) ) { println \"\"\" username: ${build.getCause(hudson.model.Cause.UserIdCause.class).getUserName()} id: ${build.getCause(hudson.model.Cause.UserIdCause.class).getUserId()} mail: ${build.getCause(hudson.model.Cause.UserIdCause.class).getUserId()}@domain.com \"\"\" } or import hudson.model.Cause.UserIdCause if ( build.getCause(UserIdCause.class) ) { println \"\"\" username: ${build.getCause(UserIdCause.class).getUserName()} id: ${build.getCause(UserIdCause.class).getUserId()} mail: ${build.getCause(UserIdCause.class).getUserId()}@domain.com \"\"\" } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:35 "},"jenkins/jenkinsfile/node.html":{"url":"jenkins/jenkinsfile/node.html","title":"node","keywords":"","body":" Table of Contents generated with DocToc yaml with resources with POD_LABEL default yaml container reference: kubernetes Kubernetes plugin yaml #!/usr/bin/env groovy import groovy.transform.Field @Field final String CLUSTER = 'DevOps Kubernetes' @Field final String NAMESPACE = 'devops' String label = env.BUILD_TAG ansiColor('xterm') { timestamps { podTemplate( label: label , cloud: CLUSTER , namespace: NAMESPACE , showRawYaml: true, yaml: \"\"\" apiVersion: v1 kind: Pod metadata: labels: jenkins: jnlp-inbound-agent spec: hostNetwork: true nodeSelector: : \"\" containers: - name: jnlp image: jenkins/inbound-agent:latest workingDir: /home/jenkins tty: true \"\"\" ) { node (label) { container(name:'jnlp', shell:'/bin/bash') { stage('prepare') { sh \"\"\" whoami pwd realpath ${WORKSPACE} \"\"\" } // stage }}} // container | node | podTemplate }} // timestamp | ansiColor // vim: ft=Jenkinsfile ts=2 sts=2 sw=2 et with resources #!/usr/bin/env groovy import groovy.transform.Field @Field final String CLUSTER = 'Jenkins Kubernetes' @Field final String NAMESPACE = 'jenkins' String label = env.BUILD_TAG ansiColor('xterm') { timestamps { podTemplate( label: label , cloud: CLUSTER , namespace: NAMESPACE , showRawYaml: true, yaml: \"\"\" apiVersion: v1 kind: Pod metadata: labels: jenkins: jnlp-inbound-agent spec: hostNetwork: true nodeSelector: : \"\" containers: - name: jnlp image: jenkins/inbound-agent:latest workingDir: /home/jenkins tty: true resources: limits: memory: 1Gi cpu: 1 requests: memory: 500Mi cpu: 0.5 \"\"\" ) { node (label) { container(name:'jnlp', shell:'/bin/bash') { stage('prepare') { sh \"\"\" whoami pwd \"\"\" } // stage }}} // container | node | podTemplate }} // timestamp | ansiColor // vim: ft=Jenkinsfile ts=2 sts=2 sw=2 et with POD_LABEL #!/usr/bin/env groovy import groovy.transform.Field @Field final String CLUSTER = 'Jenkins Kubernetes' @Field final String NAMESPACE = 'jenkins' ansiColor('xterm') { timestamps { podTemplate( cloud: CLUSTER , namespace: NAMESPACE , showRawYaml: true, yaml: \"\"\" apiVersion: v1 kind: Pod metadata: labels: jenkins: jnlp-inbound-agent spec: hostNetwork: true nodeSelector: : \"\" containers: - name: jnlp image: jenkins/inbound-agent:latest workingDir: /home/jenkins tty: true resources: limits: memory: 1Gi cpu: 1 requests: memory: 500Mi cpu: 0.5 \"\"\" ) { node (POD_LABEL) { container(name:'jnlp', shell:'/bin/bash') { stage('prepare') { sh \"\"\" whoami pwd ls -Altrh /home/ ls -Altrh /home/jenkins/ touch a.txt realpath ${WORKSPACE} realpath a.txt \"\"\" } // stage }}} // container | node | podTemplate }} // timestamp | ansiColor // vim: ft=Jenkinsfile ts=2 sts=2 sw=2 et default yaml podTemplate(cloud: 'DevOps Kubernetes') { node(POD_LABEL) { stage('Run shell') { sh 'echo hello world' } } } windows (kubernetes) /* * Runs a build on a Windows pod. * Tested in EKS: https://docs.aws.amazon.com/eks/latest/userguide/windows-support.html */ podTemplate(yaml: ''' apiVersion: v1 kind: Pod spec: containers: - name: jnlp image: jenkins/inbound-agent:windowsservercore-1809 - name: shell image: mcr.microsoft.com/powershell:preview-windowsservercore-1809 command: - powershell args: - Start-Sleep - 999999 nodeSelector: kubernetes.io/os: windows ''') { node(POD_LABEL) { container('shell') { powershell 'Get-ChildItem Env: | Sort Name' } } } maven (kubernetes) // Build a Maven project using the standard image and Scripted syntax. // Rather than inline YAML, you could use: yaml: readTrusted('jenkins-pod.yaml') // Or, to avoid YAML: containers: [containerTemplate(name: 'maven', image: 'maven:3.6.3-jdk-8', command: 'sleep', args: 'infinity')] podTemplate(yaml: ''' apiVersion: v1 kind: Pod spec: containers: - name: maven image: maven:3.6.3-jdk-8 command: - sleep args: - infinity ''') { node(POD_LABEL) { // or, for example: git 'https://github.com/jglick/simple-maven-project-with-tests' writeFile file: 'pom.xml', text: ''' 4.0.0 sample sample 1.0-SNAPSHOT org.apache.maven.plugins maven-surefire-plugin 2.18.1 junit junit 4.12 test UTF-8 1.8 1.8 ''' writeFile file: 'src/test/java/sample/SomeTest.java', text: ''' package sample; public class SomeTest { @org.junit.Test public void checks() {} } ''' container('maven') { sh 'mvn -B -ntp -Dmaven.test.failure.ignore verify' } junit '**/target/surefire-reports/TEST-*.xml' archiveArtifacts '**/target/*.jar' } } container podTemplate(cloud: 'DevOps Kubernetes', containers: [ containerTemplate( name: 'jnlp', image: 'jenkins/inbound-agent:latest', ttyEnabled: true, privileged: false, alwaysPullImage: false, workingDir: '/home/jenkins' ) ]) { node(POD_LABEL) { stage ('run') { echo 'yes!' sh \"\"\" id whoami echo ${WORKSPACE} realpath ${WORKSPACE} \"\"\" } }} Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:35 "},"jenkins/script/script.html":{"url":"jenkins/script/script.html","title":"script","keywords":"","body":" Table of Contents generated with DocToc Script Console usage basic usage execute shell script in console jobs get build status get all builds status during certain start-end time list job which running for more than 24 hours shelve jobs List plugins via api simple list List plugin and dependencies scriptApproval backup & restore all scriptApproval items automatic approval all pending disable the scriptApproval abort abort a build abort running builds if new one is running shared libes vars src Asynchronous resource disposer reference: Script Console Jenkins Features Controlled with System Properties samrocketman/jenkins-script-console-scripts jenkinsci/jenkins-scripts cloudbees/jenkins-scripts mubbashir/Jenkins+Script+Console.md Sam Gleske’s jenkins-script-console-scripts repository Sam Gleske’s jenkins-bootstrap-shared repository Some scripts at JBoss.org mikejoh/jenkins-and-groovy-snippets.md Script Console usage remote access $ curl -d \"script=\" https://jenkins/script # or to get output as a plain text result (no HTML) $ curl -d \"script=\" https://jenkins/scriptText curl submitting groovy file$ curl --data-urlencode \"script=$( via api token$ curl --user 'username:api-token' --data-urlencode \\ \"script=$( via pythonwith open('somescript.groovy', 'r') as fd: data = fd.read() r = requests.post('https://jenkins/scriptText', auth=('username', 'api-token'), data={'script': data}) basic usage setup timestampe (temporary)System.setProperty('org.apache.commons.jelly.tags.fmt.timeZone', 'America/Los_Angeles') execute shell script in console reference: i.e. println (\"uname -a\".execute().text) // or println (\"printenv\".execute().in.text) resultLinux devops-jenkins-685cf57df9-znfs8 4.19.12-1.el7.elrepo.x86_64 #1 SMP Fri Dec 21 11:06:36 EST 2018 x86_64 GNU/Linux modify log level references: How to change the default or package log levels Configure Loggers for Jenkins Disable HttpClient logging Viewing logs System.setProperty(\"org.apache.commons.logging.Log\", \"org.apache.commons.logging.impl.SimpleLog\"); System.setProperty(\"org.apache.commons.logging.simplelog.showdatetime\", \"true\"); System.setProperty(\"org.apache.commons.logging.simplelog.log.httpclient.wire.header\", \"error\"); System.setProperty(\"org.apache.commons.logging.simplelog.log.org.apache.http\", \"error\"); System.setProperty(\"log4j.logger.org.apache.http\", \"error\"); System.setProperty(\"log4j.logger.org.apache.http.wire\", \"error\"); System.setProperty(\"org.apache.commons.logging.simplelog.log.org.apache.commons.httpclient\", \"error\"); check log levelprintln System.getProperty(\"org.apache.commons.logging.Log\"); println System.getProperty(\"org.apache.commons.logging.simplelog.showdatetime\"); println System.getProperty(\"org.apache.commons.logging.simplelog.log.httpclient.wire.header\"); println System.getProperty(\"org.apache.commons.logging.simplelog.log.org.apache.http\"); println System.getProperty(\"log4j.logger.org.apache.http\"); println System.getProperty(\"log4j.logger.org.apache.http.wire\"); println System.getProperty(\"org.apache.commons.logging.simplelog.log.org.apache.commons.httpclient\"); jobs get more: jobs & builds get build status get all builds result percentage get builds result percentage within 24 hours get builds result and percentage within certain start-end time get all builds status during certain start-end time list all builds within 24 hours get last 24 hours failure builds get last 24 hours failure builds via Map structure get builds result during certain start-end time get builds result and percentage within certain start-end time list job which running for more than 24 hours list job which running for more than 24 hours shelve jobs //You have to install the Shelve Project Plugin on your Jenkins Master //The maximum value for daysBack is 365, going beyond 365 will break the script. import org.jvnet.hudson.plugins.shelveproject.ShelveProjectTask def daysBack=365; Jenkins.instance.getAllItems(AbstractProject.class).each { it -> def lastBuild = it.getLastBuild() if( lastBuild != null ) { def back = Calendar.getInstance() back.set( Calendar.DAY_OF_YEAR,back.get(Calendar.DAY_OF_YEAR) - daysBack ) if ( lastBuild.getTime().compareTo(back.getTime()) List plugins via api simple list Jenkins.instance .pluginManager .plugins .each { plugin -> println ( \"${plugin.getDisplayName()} (${plugin.getShortName()}): ${plugin.getVersion()}\" ) } List plugin and dependencies def plugins = Jenkins.instance .pluginManager .plugins .sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase() } println \"Jenkins Instance : ${Jenkins.instance.getComputer('').hostName} + ${Jenkins.instance.rootUrl}\\n\" + \"Installed Plugins:\\n\" + \"==================\" plugins.each { plugin -> println \" ${plugin.getShortName()} : ${plugin.getVersion()} | ${plugin.getDisplayName()}\" } println \"\\nPlugins Dependency tree (...: dependencies; +++: dependants) :\\n\" + \"=======================\" plugins.each { plugin -> println \"\"\" ${plugin.getShortName()} : ${plugin.getVersion()} | ${plugin.getDisplayName()} +++ ${plugin.getDependants()} ... ${plugin.getDependencies()} \"\"\" } or def jenkins = Jenkins.instance println \"\"\" Jenkins Instance : ${jenkins.getComputer('').hostName} + ${jenkins.rootUrl} Installed Plugins: ================== \"\"\" jenkins.pluginManager .plugins .sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase() }.each { plugin -> println \"${plugin.getShortName()}: ${plugin.getVersion()} | ${plugin.getDisplayName()}\" } println \"\"\" Plugins Dependency tree (...: dependencies; +++: dependants) : ======================= \"\"\" jenkins.pluginManager .plugins .sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase() }.each { plugin -> println \"\"\" ${plugin.getShortName()} : ${plugin.getVersion()} | ${plugin.getDisplayName()} +++ ${plugin.getDependants()} ... ${plugin.getDependencies()} \"\"\" } scriptApproval backup & restore all scriptApproval items backup import java.lang.reflect.* import jenkins.model.Jenkins import jenkins.model.* import org.jenkinsci.plugins.scriptsecurity.scripts.* import org.jenkinsci.plugins.scriptsecurity.sandbox.whitelists.* import static groovy.json.JsonOutput.* scriptApproval = ScriptApproval.get() alreadyApproved = new HashSet<>(Arrays.asList(scriptApproval.getApprovedSignatures())) println prettyPrint( toJson(alreadyApproved) ) restore def scriptApproval = org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval.get() String[] signs = [ \"method org.jenkinsci.plugins.workflow.steps.FlowInterruptedException getCauses\", \"method org.jenkinsci.plugins.workflow.support.steps.input.Rejection getUser\" ] for( String sign : signs ) { scriptApproval.approveSignature(sign) } scriptApproval.save() example import java.lang.reflect.*; import jenkins.model.Jenkins; import jenkins.model.*; import org.jenkinsci.plugins.scriptsecurity.scripts.*; import org.jenkinsci.plugins.scriptsecurity.sandbox.whitelists.*; import static groovy.json.JsonOutput.* scriptApproval = ScriptApproval.get() alreadyApproved = new HashSet<>(Arrays.asList(scriptApproval.getApprovedSignatures())) void approveSignature(String signature) { if (!alreadyApproved.contains(signature)) { scriptApproval.approveSignature(signature) } } List scriptList = [ 'method hudson.model.Job getLastSuccessfulBuild', 'method hudson.model.Node getNodeName' ] scriptList.each { approveSignature(it) } scriptApproval.save() automatic approval all pending list pending scriptApproval import org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval ScriptApproval scriptApproval = ScriptApproval.get() scriptApproval.pendingScripts.each { scriptApproval.approveScript(it.hash) } Job DSL support for ScriptApproval import jenkins.model.Jenkins def scriptApproval = Jenkins.instance.getExtensionList('org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval')[0] def hashesToApprove = scriptApproval.pendingScripts.findAll{ it.script.startsWith(approvalPrefix) }.collect{ it.getHash() } hashesToApprove.each { scriptApproval.approveScript(it) } disable the scriptApproval file: $JENKINS_HOME/init.groovy.d/disable-script-security.groovy import javaposse.jobdsl.plugin.GlobalJobDslSecurityConfiguration import jenkins.model.GlobalConfiguration // disable Job DSL script approval GlobalConfiguration.all().get(GlobalJobDslSecurityConfiguration.class).useScriptSecurity=false GlobalConfiguration.all().get(GlobalJobDslSecurityConfiguration.class).save() abort abort a build Jenkins.instance.getItemByFullName(\"JobName\") .getBuildByNumber(JobNumber) .finish ( hudson.model.Result.ABORTED, new java.io.IOException(\"Aborting build\") ) abort running builds if new one is running reference: Controlling the Flow with Stage, Lock, and Milestone I have a stuck Pipeline and I can not stop it Aborting a build Cancel queued builds and aborting executing builds using Groovy for Jenkins import hudson.model.Result import jenkins.model.CauseOfInterruption //iterate through current project runs build.getProject()._getRuns().iterator().each { run -> def exec = run.getExecutor() //if the run is not a current build and it has executor (running) then stop it if( run != build && exec != null ) { //prepare the cause of interruption def cause = { \"interrupted by build #${build.getId()}\" as String } as CauseOfInterruption exec.interrupt(Result.ABORTED, cause) } } or import hudson.model.Result import hudson.model.Run import jenkins.model.CauseOfInterruption.UserInterruption def abortPreviousBuilds() { Run previousBuild = currentBuild.rawBuild.getPreviousBuildInProgress() while ( previousBuild != null ) { if ( previousBuild.isInProgress() ) { def executor = previousBuild.getExecutor() if ( executor != null ) { echo \">> Aborting older build #${previousBuild.number}\" executor.interrupt( Result.ABORTED, new UserInterruption( \"Aborted by newer build #${currentBuild.number}\" )) } } previousBuild = previousBuild.getPreviousBuildInProgress() } } or: cancel builds same job /* Author: Isaac S Cohen This script works with workflow to cancel other running builds for the same job Use case: many build may go to QA, but only the build that is accepted is needed, the other builds in the workflow should be aborted */ def jobname = env.JOB_NAME def buildnum = env.BUILD_NUMBER.toInteger() def job = Jenkins.instance.getItemByFullName( jobname ) for ( build in job.builds ) { if ( !build.isBuilding() ) { continue; } if ( buildnum == build.getNumber().toInteger() ) { continue; println \"equals\" } build.doStop() } or: Properly Stop Only Running Pipelines shared libes reference: Jenkins Shared Libraries Workshop Extending with Shared Libraries vars capture def capture( String str, String pattern, int groupIndex, int index ) { ( str =~ pattern ).findAll()?.getAt(groupIndex)?.getAt(index) ?: null } example : find out the current Container ID if the process running in a container // cpuset: '/kubepods/burstable/pod59899be8-d4db-11eb-9a49-ac1f6b59c992/b60bf42d334be0eff64f325bad5b0ca4750119fbf8a7e80afa4e559040208ab3'' String cpuset = sh ( returnStdout : true , script : \"set +x; cat /proc/self/cpuset\" ).trim() String dockerPattern = '^/docker/(\\\\w{64})$' String k8sPattern = '^/kubepods/([^/]+/){2}(\\\\w{64})$' return capture( cpuset, k8sPattern ) ?: capture( cpuset, dockerPattern ) src using Jenkins plugins in groovy scripts using jenkins-core in groovy script via Grab GrabResolver Dependency management with Grape kellyrob99/setupNewServer.groovy @GrabResolver(name='jenkins', root='http://repo.jenkins-ci.org/public/') @Grab(group='org.jenkins-ci.main', module='jenkins-core', version='2.9') import jenkins.model.Jenkins Asynchronous resource disposer import org.jenkinsci.plugins.resourcedisposer.AsyncResourceDisposer AsyncResourceDisposer disposer = AsyncResourceDisposer.get() println \"\"\" getDisplayName : ${disposer.getDisplayName()} isActivated : ${disposer.isActivated()} \"\"\" disposer.getBacklog().each { println \"\"\" getId : ${it.getId()} getRegistered : ${it.getRegistered()} node : ${it.getDisposable().node} path : ${it.getDisposable().path} getLastState : ${it.getLastState().getDisplayName()} \"\"\" } // disposer.getBacklog().each { disposer.dispose( it.getDisposable() ) } result getDisplayName : Asynchronous resource disposer isActivated : true getId : 889006714 getRegistered : Mon Apr 18 19:19:30 PDT 2022 node : worknode_021 path : /home/devops/workspace/marslo/testing_ws-cleanup_1650334769689 getLastState : Unable to delete '/home/devops/workspace/marslo/testing_ws-cleanup_1650334769689'. Tried 3 times (of a maximum of 3) waiting 0.1 sec between attempts. (Discarded 33 additional exceptions) getId : 167234646 getRegistered : Sun Apr 17 13:07:47 PDT 2022 node : worknode_013 path : /home/devops/workspace/marslo/testing_ws-cleanup_1650226067115 getLastState : Unable to delete '/home/devops/workspace/marslo/testing_ws-cleanup_1650226067115'. Tried 3 times (of a maximum of 3) waiting 0.1 sec between attempts. (Discarded 32 additional exceptions) ... Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:34 "},"jenkins/script/build.html":{"url":"jenkins/script/build.html","title":"jobs & builds","keywords":"","body":" Table of Contents generated with DocToc jobs get name and classes list all jobs and folders list all Abstract Project disable all particular projects jobs undo disable jobs in particular projects get single job properties get particular job status Find Jenkins projects that build periodically list job which running for more than 24 hours build build number get changesets get SCM info get culprits stop builds get build time list all builds within 24 hours get last 24 hours failure builds get last 24 hours failure builds via Map structure build parameters get build parameters get wanted parameter values in builds get only String type parameters build results get all builds result percentage get builds result percentage within 24 hours get builds result during certain start-end time list all running builds get builds result and percentage within certain start-end time build stage show build stages details get parent stage ID get stage build status via parent stage name javadoc org.jenkinsci.plugins.workflow.job.WorkflowJob org.jenkinsci.plugins.workflow.job.WorkflowRun hudson.model.AbstractProject How to get details of Successful Jenkins build in last x days build.getAction(ParametersAction.class) Variables defined in groovy script always resolve to null build.buildVariableResolver.resolve groovy.lang.MissingPropertyException: No such property: jenkins for class: groovy.lang.Binding Class BuildVariableResolver batmat/get-jenkins-build-time.groovy source code: WorkflowRun.java AbstractBuild.java GitSCM.java GitChangeSetList.java jobs get name and classes Jenkins.instance.getAllItems(Job.class).each { println it.name + \" -> \" + it.fullName + ' ~> ' + it.class } resultmarslo - class org.jenkinsci.plugins.workflow.job.WorkflowJob fs - class hudson.model.FreeStyleProject list all jobs and folders Jenkins.instance.getAllItems(AbstractItem.class).each { println(it.fullName) } result:marslo/marslo marslo/fs list all Abstract Project Abstract Project: freestyle, maven, etc... Jenkins.instance.getAllItems( AbstractProject.class ).each { println it.fullName } disable all particular projects jobs List projects = [ 'project-1', 'project-2', 'project-n' ] Jenkins.instance.getAllItems(Job.class).findAll { projects.any { p -> it.fullName.contains(p) } }.each { println \"~~> ${it.fullName}\" it.disabled = true it.save() } undo disable jobs in particular projects List projects = [ 'project-1', 'project-2', 'project-n' ] Jenkins.instance.getAllItems(Job.class).findAll { it.disabled && projects.any{ p -> it.fullName.contains(p) } }.each { println \"~~> ${it.fullName}\" it.disabled = false it.save() } find all disabled projects/jobs Jenkins.instance .getAllItems( Job.class ) .findAll { it.disabled } .collect { it.fullName } or jenkins.model .Jenkins .instance .getAllItems(jenkins.model.ParameterizedJobMixIn.ParameterizedJob.class) .findAll{ it.disabled } .each { println it.fullName; } or jenkins.model .Jenkins .instance .getAllItems(jenkins.model.ParameterizedJobMixIn.ParameterizedJob.class) .findAll{ it.disabled } .collect { it.fullName } get single job properties Java Code Examples for jenkins.model.Jenkins#getItemByFullName() def job = Jenkins.instance.getItemByFullName('/') println \"\"\" job.getClass() : ${job.getClass()} job.isBuildable() : ${job.isBuildable()} job.getFirstBuild() : ${job.getFirstBuild()} job.getACL() : ${job.getACL()} \"=======================\" job.getBuilds() : ${job.getBuilds()} \"\"\" get particular job status def job = Jenkins.instance.getItemByFullName('/') println \"\"\" Last success : ${job.getLastSuccessfulBuild()} All builds : ${job.getBuilds().collect{ it.getNumber() }} Last build : ${job.getLastBuild()} Is building : ${job.isBuilding()} \"\"\" Find Jenkins projects that build periodically example 1: import hudson.model.* import hudson.triggers.* TriggerDescriptor TIMER_TRIGGER_DESCRIPTOR = Hudson.instance.getDescriptorOrDie(TimerTrigger.class) for(item in Jenkins.instance.getAllItems(Job)) { def timertrigger = item.getTriggers().get(TIMER_TRIGGER_DESCRIPTOR) if (timertrigger) { if (item.class.canonicalName == \"hudson.model.FreeStyleProject\") { item.removeTrigger(TIMER_TRIGGER_DESCRIPTOR) println(item.name + \" Build periodically disabled\"); } else { println(item.name + \" Build periodically remains enabled; not as Freestyle project\"); } } } example 2: Jenkins.instance.getAllItems(Job).each{ def jobBuilds=it.getBuilds() // Check the last build only jobBuilds[0].each { build -> def runningSince = groovy.time.TimeCategory.minus( new Date(), build.getTime() ) def currentStatus = build.buildStatusSummary.message def cause = build.getCauses()[0] //we keep the cause //triggered by a user def user = cause instanceof Cause.UserIdCause? cause.getUserId():null; if( !user ) { println \"[AUTOMATION] ${build}\" } else { println \"[${user}] ${build}\" } } } return list job which running for more than 24 hours only for lastBuild. /* We had to write this script several times. Time to have it stored, it is a very simple approach but will serve as starting point for more refined approaches. */ Jenkins.instance.getAllItems(Job).each(){ job -> job.isBuildable() if (job.isBuilding()){ def myBuild= job.getLastBuild() def runningSince = groovy.time.TimeCategory.minus( new Date(), myBuild.getTime() ) if (runningSince.hours >= 24){ println job.name +\"---- ${runningSince.hours} hours:${runningSince.minutes} minutes\" } } } return null build build number get WorkflowRun by build number final String JOB_NAME = 'marslo/sandbox' final int BUILD_NUMBER = 6458 def build = Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( BUILD_NUMBER ) get builds of a job WorkflowJob job = Jenkins.instance.getItemByFullName( '/marslo/sandbox/test' ) RunList runList = job.getBuilds() println \"\"\" all builds : ${job.getBuildsAsMap().collect{ k, v -> k }} build exists : ${job.getBuilds().collect { it.id }.contains( 25.toString() )} completedOnly() : ${runList.completedOnly().collect{ it.id }} failureOnly() : ${runList.failureOnly().collect{ it.id }} getLastBuild() : ${runList.getLastBuild()} getFirstBuild() : ${runList.getFirstBuild()} getLastCompletedBuild() : ${job.getLastCompletedBuild()} getLastFailedBuild() : ${job.getLastFailedBuild()} getLastStableBuild() : ${job.getLastStableBuild()} getLastSuccessfulBuild() : ${job.getLastSuccessfulBuild()} getLastUnstableBuild() : ${job.getLastUnstableBuild()} getLastUnsuccessfulBuild() : ${job.getLastUnsuccessfulBuild()} isInQueue() : ${job.isInQueue()} \"\"\" get changesets code clone via checkout([ $class: 'GitSCM', branches: [[ name: 'refs/heads/sandbox' ]], browser: [ $class: 'GitWeb', repoUrl: 'https://my.gerrit.com/path/to/repo' ], userRemoteConfigs: [[ credentialsId: 'SSHCredential', url: 'git://my.gerrit.com/path/to/repo.git' ]] ]) references: hudson.plugins.git.GitChangeSet hudson.plugins.git.GitChangeSetList jenkins.plugins.git.AbstractGitSCMSource hudson.model.AbstractBuild get changeset in Jenkisnfile Jenkins.instance .getItemByFullName('/marslo/up') .getBuildByNumber(195) .changeSets .each { it.items.each { i -> println \"\"\" \\n-----------------------------\\n paths : ${i.paths} parent commit : ${i.parentCommit} commitId : ${i.commitId} : ${i.revision} author : ${i.author} authorName : ${i.authorName} authorEmail : ${i.authorEmail} committerTime : ${i.committerTime} message : ${i.msg} repoUrl : ${it.browser?.repoUrl ?: ''} affected files : \\t\\t${i.affectedFiles.collect{ f -> f.editType.name + ' : ' + f.path }.join('\\n\\t\\t\\t\\t')} \"\"\" } } get changeSets to List>: def getChangeSets( String name, int nubmer ) { Jenkins.instance .getItemByFullName( name ) .getBuildByNumber( number ) .changeSets } def changeSetsEntry( def changeSets ) { List> changeSetsEntry = [] changeSets.collect { it.items.collect { i -> changeSetsEntry += [ 'parentCommit' : i.parentCommit , 'commitId' : i.commitId , 'revision' : i.revision , 'author' : i.author.toString() , 'authorName' : i.authorName , 'authorEmail' : i.authorEmail , 'committerTime' : i.committerTime , 'msgAnnotated' : i.msg , 'affectedFiles' : i.affectedFiles.collect{ f -> ['editType' : f.editType.name, 'path' : f.path ] } ] }} return changeSetsEntry } // testing List> totalChangeSets = [] totalChangeSets += changeSetsEntry( getChangeSets('/path/to/pipeline', 123) ) totalChangeSets += changeSetsEntry( getChangeSets('/path/to/pipeline', 456) ) totalChangeSets.each { println \"\"\" it.getClass() it.author it.commitId \"\"\" } get repo url hudson.scm.SCM def job = Jenkins.instance .getItemByFullName('/path/to/pipeline') .getBuildByNumber(n) job.changeSets .each { it.items.each { i -> println \"\"\" \\n-----------------------------\\n repoUrl : ${ it.browser.repoUrl } repoUrl : ${ job.SCMs.collect { s -> s.browser?.repoUrl }.findAll().join() } url : ${ job.SCMs.collect { s -> s.browser?.url }.findAll().join() } ormalizeUrl : ${ job.SCMs.collect { s -> s.browser?.normalizeUrl } } absoluteUrl : ${ job.SCMs.collect { s -> s.browser?.getChangeSetLink(i) }.findAll().join() } commitId : ${i.commitId} : ${i.revision} \"\"\" } } result ----------------------------- repoUrl : https://my.gerrit.com/admin/repos/sandbox repoUrl : https://my.gerrit.com/admin/repos/sandbox url : https://my.gerrit.com/admin/repos/sandbox ormalizeUrl : [null, false] absoluteUrl : https://my.gerrit.com/admin/repos/sandbox?a=commit&h=095e4470964ee8ca6ab50ceea7acf88094dc08d4 commitId : 095e4470964ee8ca6ab50ceea7acf88094dc08d4 : 095e4470964ee8ca6ab50ceea7acf88094dc08d4 get SCM info references: hudson.plugins.git.GitSCM hudson.plugins.git.UserRemoteConfig Poll SCM and Timer triggers include \"Changes\" for a Pipeline for any/all Shared Libraries Jenkins.instance .getItemByFullName('/path/to/pipeline') .getBuildByNumber(n) .SCMs .each { println \"\"\" ....................... repoUrl : ${it.userRemoteConfigs.url.join(',')} remotes : ${it.userRemoteConfigs.name.join(',')} branches : ${it.branches.join(',')} ....................... \"\"\" } get culprits println build.getCulprits() setup next build number Jenkins.instance.getItemByFullName(\"/path/to/job\").updateNextBuildNumber(n) stop builds abort single build final String JOB_NAME = 'job_name' final int BUILD_NUMBER = job_number Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( BUILD_NUMBER ) .finish( hudson.model.Result.ABORTED, new java.io.IOException( \"Aborting build\" ) ) cancel builds in same job /* Author: Isaac S Cohen This script works with workflow to cancel other running builds for the same job Use case: many build may go to QA, but only the build that is accepted is needed, the other builds in the workflow should be aborted */ final String JOB_NAME = env.JOB_NAME final int BUILD_NUMBER = env.BUILD_NUMBER.toInteger() def job = Jenkins.instance.getItemByFullName( JOB_NAME ) for ( build in job.builds ) { if ( !build.isBuilding() ) { continue } if ( BUILD_NUMBER == build.getNumber().toInteger() ) { continue; println \"equals\" } build.doStop() } stop all queue and running jobs reference: cancel queue buildsJenkins.instance.queue.clear() import java.util.ArrayList import hudson.model.* import jenkins.model.Jenkins // Remove everything which is currently queued def q = Jenkins.instance.queue for ( queued in Jenkins.instance.queue.items ) { q.cancel( queued.task ) } // stop all the currently running jobs for ( job in Jenkins.instance.items ) { stopJobs(job) } def stopJobs( job ) { if ( job in com.cloudbees.hudson.plugins.folder.Folder ) { for ( child in job.items ) { stopJobs( child ) } } else if ( job in org.jenkinsci.plugins.workflow.multibranch.WorkflowMultiBranchProject ) { for ( child in job.items ) { stopJobs( child ) } } else if ( job in org.jenkinsci.plugins.workflow.job.WorkflowJob && job.isBuilding() ) { for ( build in job.builds ) { build.doKill() } } } get queue jobs parameters refernece: cg-soft/explore.groovy def q = Jenkins.instance.queue q.items.each { println(\"${it.task.name}:\") println(\"Parameters: ${it.params}\") } list all queue tasks and blocked reason Jenkins.instance.queue.items.each { println \"\"\" getId : ${it.getId()} isBuildable : ${it.isBuildable()} getFullDisplayName : ${it.task.getFullDisplayName()} getDisplayName : ${it.task.getDisplayName()} isConcurrentBuild : ${it.task.isConcurrentBuild()} getAffinityKey : ${it.task.getAffinityKey()} getUrl : ${it.task.getUrl()} getWhyBlocked : ${it.task.getWhyBlocked()} getCauseOfBlockage() : ${it.task.getCauseOfBlockage()} \"\"\" // println it.task.metaClass.methods*.name.sort().unique() } result: getId : 80210 isBuildable : false getFullDisplayName : marslo » sandbox » test getDisplayName : test isConcurrentBuild : false getAffinityKey : marslo » sandbox » test getUrl : job/marslo/job/sandbox/job/test/ getWhyBlocked : Build #27 is already in progress (ETA: 3 min 28 sec) getCauseOfBlockage() : Build #27 is already in progress (ETA: 3 min 28 sec) get build time reference Getting current timestamp in inline pipeline script using pipeline plugin of hudson get Job && build by number for the Job and all related to time reference: convert milliseconds to date-time format Date.format(String format) ```groovy final long NOW = System.currentTimeMillis() final int BENCH_MARK = 12460601000 println \"\"\" NOW : ${NOW} NOW - BENCH_MARK : ${NOW - BENCH_MARK} Date(NOW).format() : ${new Date(NOW).format(\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\")} Date(NOW-BENCH_MARK).format() : ${new Date(NOW - BENCH_MARK).format(\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\")} \"\"\" result: NOW : 1619790803151 NOW - BENCH_MARK : 1619704403151 Date(NOW).format() : 2021-04-30T06:53:23.151Z Date(NOW-BENCH_MARK).format() : 2021-04-29T06:53:23.151Z ``` import java.time.LocalDateTime import java.time.LocalDate import java.util.Calendar final String JOB_PATTERN = '/' final LocalDateTime DATE_TIME = LocalDateTime.now() final LocalDate DATE_TAG = java.time.LocalDate.now() final long CURRENT_TIME = System.currentTimeMillis() final long RIGHT_NOW = Calendar.getInstance().getTimeInMillis() println \"\"\" ~~> current time : DATE_TIME : ${DATE_TIME} DATE_TAG : ${DATE_TAG} CURRENT_TIME : ${CURRENT_TIME} RIGHT_NOW : ${RIGHT_NOW} \"\"\" Jenkins.instance.getAllItems( Job.class ).each { job -> if ( job.fullName.contains( JOB_PATTERN ) ) { def build = job.getLastBuild() println \"\"\" ~~> ${job.getFullName()} : ${build.getId()} : build.getTimestampString() : ${build.getTimestampString()} build.getTimestampString2() : ${build.getTimestampString2()} build.getTime() : ${build.getTime()} build.startTimeInMillis : ${build.startTimeInMillis} build.startTimeInMillis.getClass() : ${build.startTimeInMillis.getClass()} duration : ${groovy.time.TimeCategory.minus( new Date(), build.getTime() )} \"\"\" } } \"DONE\" result: or : final String JOB_PATTERN = '/' // keywords Jenkins.instance.getAllItems( Job.class ).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> def build = job.getLastBuild() println \"\"\" build.getTime() : ${build.getTime()} build.getTimeInMillis() : ${build.getTimeInMillis()} build.getTimestamp() : ${build.getTimestamp()} build.getStartTimeInMillis() : ${build.getStartTimeInMillis()} build.getTimestampString() : ${build.getTimestampString()} build.getTimestampString2() : ${build.getTimestampString2()} \"\"\" } result build.getTime() : Thu Apr 29 04:08:08 PDT 2021 build.getTimeInMillis() : 1619694488799 build.getTimestamp() : java.util.GregorianCalendar[time=1619694488799,areFieldsSet=true,areAllFieldsSet=true,lenient=true,zone=sun.util.calendar.ZoneInfo[id=\"America/Los_Angeles\",offset=-28800000,dstSavings=3600000,useDaylight=true,transitions=185,lastRule=java.util.SimpleTimeZone[id=America/Los_Angeles,offset=-28800000,dstSavings=3600000,useDaylight=true,startYear=0,startMode=3,startMonth=2,startDay=8,startDayOfWeek=1,startTime=7200000,startTimeMode=0,endMode=3,endMonth=10,endDay=1,endDayOfWeek=1,endTime=7200000,endTimeMode=0]],firstDayOfWeek=1,minimalDaysInFirstWeek=1,ERA=1,YEAR=2021,MONTH=3,WEEK_OF_YEAR=18,WEEK_OF_MONTH=5,DAY_OF_MONTH=29,DAY_OF_YEAR=119,DAY_OF_WEEK=5,DAY_OF_WEEK_IN_MONTH=5,AM_PM=0,HOUR=4,HOUR_OF_DAY=4,MINUTE=8,SECOND=8,MILLISECOND=799,ZONE_OFFSET=-28800000,DST_OFFSET=3600000] build.getStartTimeInMillis() : 1619694488807 build.getTimestampString() : 2 min 1 sec build.getTimestampString2() : 2021-04-29T11:08:08Z list all builds within 24 hours reference: List Jenkins job build detials for last one year along with the user who triggered the build String JOB_PATTERN = '[/]' // keywords final long CURRENT_TIME = System.currentTimeMillis() final int BENCH_MARK = 1*24*60*60*1000 // days * hours * minutes * seconds * microseconds (1000) Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> def history = job.getBuilds().byTimestamp( CURRENT_TIME - BENCH_MARK, CURRENT_TIME ) if ( history ) { println \"\"\" ~~> ${job.fullName} : ${history.size()} : history : ${history.join('\\n\\t\\t\\t ')} \"\"\" } } get last 24 hours failure builds import hudson.model.Job import hudson.model.Result import hudson.model.Run import java.util.Calendar import jenkins.model.Jenkins final Calendar RIGHT_NOW = Calendar.getInstance() final long BENCH_MARK = 1*24*60*60*1000 final String JOB_PATTERN = '' Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.collect { Job job -> job.builds.findAll { Run run -> run.result == Result.FAILURE && ( RIGHT_NOW.getTimeInMillis() - run.getStartTimeInMillis() ) get last 24 hours failure builds via Map structure import hudson.model.Job import hudson.model.Result import hudson.model.Run import java.util.Calendar import jenkins.model.Jenkins import static groovy.json.JsonOutput.* final Calendar RIGHT_NOW = Calendar.getInstance() final long BENCH_MARK = 1*24*60*60*1000 final String JOB_PATTERN = '' Map results = [:] Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> results.(job.fullName) = job.builds.findAll { Run run -> !run.isBuilding() && run.result == Result.FAILURE && ( RIGHT_NOW.getTimeInMillis() - run.getStartTimeInMillis() ) [ (run.id) : run.getAbsoluteUrl() ] } } println prettyPrint( toJson(results.findAll{ !it.value.isEmpty() }) ) or import hudson.model.Job import hudson.model.Result import hudson.model.Run import jenkins.model.Jenkins import static groovy.json.JsonOutput.* final long CURRENT_TIME = java.util.Calendar.getInstance().getTimeInMillis() final long BENCH_MARK = 1*24*60*60*1000 final String JOB_PATTERN = '' Map results = [:] Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> results.(job.fullName) = job.getBuilds().byTimestamp( CURRENT_TIME - BENCH_MARK, CURRENT_TIME ).findAll { Run run -> !run.isBuilding() && run.result == Result.FAILURE }.collectEntries { Run run -> [ run.id, run.getAbsoluteUrl() ] } } println prettyPrint( toJson(results.findAll{ !it.value.isEmpty() }) ) or import hudson.model.Job import hudson.model.Result import hudson.model.Run import jenkins.model.Jenkins import static groovy.json.JsonOutput.* final long CURRENT_TIME = java.util.Calendar.getInstance().getTimeInMillis() final long BENCH_MARK = 1*24*60*60*1000 final String JOB_PATTERN = '' Map results = [:] Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains(JOB_PATTERN) }.each { Job job -> def history = job.getBuilds().byTimestamp( CURRENT_TIME - BENCH_MARK, CURRENT_TIME ) if( history ) { results.(job.fullName) = history.findAll { Run run -> !run.isBuilding() && run.result == Result.FAILURE }.collectEntries { Run run -> [ (run.id) : run.getAbsoluteUrl() ] } } } println prettyPrint( toJson(results.findAll{ !it.value.isEmpty() }) ) build parameters get build parameters reference: build?.actions.find{ it instanceof ParametersAction } Jenkins & Groovy – accessing build parameters Parameterized System Groovy script def job = Jenkins.getInstance().getItemByFullName( 'others-tests/sandbox' ) job.getBuilds().each { Run build -> String parameters = build?.actions.find{ it instanceof ParametersAction }?.parameters?.collectEntries { [ it.name, it.value ] }.collect { k, v -> \"\\t\\t${k}\\t: ${v}\" }.join('\\n') println \"#${build.getId()}: ${parameters}\" } result#7: id : marslo gender : female #6: id : marslo gender : female #5: id : marslo gender : female #4: id : marslo gender : female #3: name : marslo gender : female #2: name : marslo gender : female #1: get wanted parameter values in builds final String PARAM = 'id' Map params = [:] def job = Jenkins.getInstance().getItemByFullName( 'others-tests/sandbox' ) job.getBuilds().each { Run build -> params.\"${build.getId()}\" = build?.actions .find{ it instanceof ParametersAction }?.parameters?.collectEntries { [ it.name , it.value ] } } println params.collect { k , v -> \"build #${k} ~~> ${v ? \"${PARAM} : ${v.getOrDefault(PARAM, \"No '${PARAM}' found\")}\" : 'No Params Found'}\" }.join('\\n') resultbuild #7 ~~> id : marslo build #6 ~~> id : marslo build #5 ~~> id : marslo build #4 ~~> id : marslo build #3 ~~> id : No 'id' found build #2 ~~> id : No 'id' found build #1 ~~> No Params Found get only String type parameters Map params = build?.getAction( ParametersAction.class ) .parameters?.findAll{ it instanceof StringParameterValue }?.dump() or Map params = build?.getAction( ParametersAction.class ) .parameters?.findAll{ it instanceof StringParameterValue }?.collectEntries { [ it.name, it.value ] } or Map params = build?.actions .find{ it instanceof ParametersAction }?.parameters?.findAll{ it instanceof StringParameterValue }?.dump() build results get all builds result percentage final String JOB_PATTERN = '/' Map> results = [:] int sum = 0 Jenkins.instance.getAllItems( Job.class ).each { project -> if ( project.fullName.contains(JOB_PATTERN) ) { results.\"${project.fullName}\" = [ SUCCESS:0, UNSTABLE:0, FAILURE:0, ABORTED:0, INPROGRESS:0, NOT_BUILT:0 ] def build = project.getLastBuild() while ( build ) { // if job is building, then results.\"${project.fullName}\".\"${build.result}\" will be null if ( build.isBuilding() ) { results.\"${project.fullName}\".INPROGRESS = results.\"${project.fullName}\".INPROGRESS + 1 } else { // println \"$project.name;$build.id;$build.result\" results.\"${project.fullName}\".\"${build.result}\" = results.\"${project.fullName}\".\"${build.result}\" + 1 } build = build.getPreviousBuild() } } } results.each{ name, status -> sum = status.values().sum() println \"${name}: ${sum} : \" status.each{ r, c -> println \"\\t${r}: ${c}: \\t\\tpercentage: \" + (sum ? \"${c * 100 / sum}%\" : '0%') } } \"DONE\" result get builds result percentage within 24 hours final String JOB_PATTERN = '' final long CURRENT_TIME = System.currentTimeMillis() final int BENCH_MARK = 1*24*60*60*1000 Map> results = [:] int sum = 0 Jenkins.instance.getAllItems( Job.class ).each { project -> if ( project.fullName.contains(JOB_PATTERN) && project.getBuilds().byTimestamp(CURRENT_TIME - BENCH_MARK, CURRENT_TIME).size() > 0 ) { results.\"${project.fullName}\" = [ SUCCESS:0, UNSTABLE:0, FAILURE:0, ABORTED:0, INPROGRESS:0, NOT_BUILT:0 ] def build = project.getLastBuild() while ( build && (CURRENT_TIME - build.startTimeInMillis) sum = status.values().sum() println \"\\n~~> ${name}: ${sum} : \" status.each{ r, c -> println \"\\t${r}: ${c}: \\t\\tpercentage: \" + (sum ? \"${c * 100 / sum}%\" : '0%') } } \"DONE\" result get builds result during certain start-end time find only String type parameters: Map params = build?.getAction( ParametersAction.class )?.parameters?.findAll{ it instanceof StringParameterValue }?.dump() import java.text.SimpleDateFormat import java.util.Date import static groovy.json.JsonOutput.* final String JOB_PATTERN = '[/]' // keywords final Map PARAM = [ 'param_name' : 'param_value' ] Map> results = [:] SimpleDateFormat simpleDateFormat = new SimpleDateFormat( \"yyyy-MM-dd HH:mm:ss\" ) final String START_DATE = '2021-04-26 00:00:00' final String END_DATE = '2021-04-27 00:00:00' long start = simpleDateFormat.parse( START_DATE ).getTime() long end = simpleDateFormat.parse( END_DATE ).getTime() Jenkins.instance.getAllItems( Job.class ).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> results.\"${job.fullName}\" = [:] job.getBuilds().byTimestamp( start, end ).each { Run build -> Map params = build?.getAction( ParametersAction.class )?.parameters?.findAll{ it instanceof StringParameterValue }?.collectEntries { [ it.name, it.value ] } results.\"${job.fullName}\".\"${build.getId()}\" = [ 'time' : build.getTime().toString() , 'params' : params?.collect { k, v -> \"${k} : ${v}\"}, 'paramsExist': params?.entrySet()?.containsAll( PARAM.entrySet() ) ] if ( build.isBuilding() ) { results.\"${job.fullName}\".\"${build.getId()}\" if ( v.paramsExist ) { count += 1 println \"\"\" #${k} : ${v.status} : ${v.time} ${v.params} \"\"\" } } println \"total number: ${count}\" \"DONE\" result: list all running builds import static groovy.json.JsonOutput.* final String JOB_PATTERN = '[/]' // project/job keywords Map> results = [:] Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> results.(job.fullName) = job.builds.findAll { Run run -> run.isBuilding() // or `run.result.equals(null)` }.collectEntries { Run run -> [ (run.id) : run.getAbsoluteUrl() ] } } results.findAll{ !it.value.isEmpty() } .each { name, builds -> println \"\"\" ~~> ${name} : ${builds.size()} ${builds.collect{ \"#${it.key} : ${it.value}\" }.join('\\n' + ' '*16)} \"\"\" } \"DONE\" get builds result and percentage within certain start-end time import java.util.Date import java.text.DecimalFormat import java.text.SimpleDateFormat import static groovy.json.JsonOutput.* DecimalFormat df = new DecimalFormat(\"0.00\") // keep two decimal places SimpleDateFormat simpleDateFormat = new SimpleDateFormat( \"yyyy-MM-dd HH:mm:ss\" ) final String JOB_PATTERN = '[/]' // project/job keywords final Map PARAM = [ 'param_name' : 'param_value' ] // setup PARAM as non-empty to list all wanted results // final Map PARAM = [ : ] // setup PARAM as empty to list all results without params validation final long START final long END Map> results = [:] Map> status = [:] // start-end time format for x days/hours/minutes ago final long NOW_TIME = System.currentTimeMillis() final int BENCH_MARK = 1*24*60*60*1000 // | | | | + milliseconds // | | | + seconds // | | + minutes // | + housrs // + days // start-end time format for time-x to time-y // final String START_TIME = '2021-04-26 00:00:00' // final String END_TIME = '2021-04-29 00:00:00' if ( NOW_TIME && BENCH_MARK ) { START = NOW_TIME - BENCH_MARK END = NOW_TIME } else if ( START_TIME && END_TIME ) { START = simpleDateFormat.parse( START_TIME ).getTime() END = simpleDateFormat.parse( END_TIME ).getTime() } else { return } Jenkins.instance.getAllItems( Job.class ).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> results.\"${job.fullName}\" = [:] job.getBuilds().byTimestamp( START, END ).each { Run build -> Map params = PARAM ? build?.getAction( ParametersAction.class )?.parameters?.findAll{ it instanceof StringParameterValue }?.collectEntries { [ it.name, it.value ] } : [:] results.\"${job.fullName}\".\"${build.getId()}\" = [ 'time' : build.getTime().toString() , 'params' : params , 'paramsExist': params?.entrySet()?.containsAll( PARAM.entrySet() ) ] if ( build.isBuilding() ) { results.\"${job.fullName}\".\"${build.getId()}\" \"${k} ~> ${v}\"}.join(' ')}\" : 'for all builds' ) + ' :' results.each { name, values -> status.\"${name}\" = [ SUCCESS:0, UNSTABLE:0, FAILURE:0, ABORTED:0, INPROGRESS:0, NOT_BUILT:0 ] Map wanted = values.findAll { k, v -> v.get('paramsExist') == true } wanted.each { k, v -> status.\"${name}\".\"${v.status}\" += 1 } println \"\\n~~> ${name} : ${wanted.size()} : \" status.\"${name}\".each { r, c -> if (c) { println '\\t\\t' + r + ' :\\ttotal : ' + c + '\\tpercentage : ' + (wanted.size() ? \"${df.format(c * 100 / wanted.size())}%\" : '0%') + '\\n' + '\\t\\t\\t\\tbuilds :\\t' + wanted.findAll { k, v -> v.get('status') == r }?.keySet()?.collect{ \"#${it}\" }.join(', ') } // print only exists status } \"DONE\" result build stage references: Access Stage results in Workflow/ Pipeline plugin pipeline中任务分段日志获取 GuillaumeSmaha/build-stages-status.groovy Access Stage name during the build in Jenkins pipeline jenkinsci/plugins/workflow/cps/FlowDurabilityTest.java show build stages details import org.jenkinsci.plugins.workflow.job.* import org.jenkinsci.plugins.workflow.flow.* import io.jenkins.blueocean.rest.impl.pipeline.* import org.jenkinsci.plugins.workflow.cps.* mport org.jenkinsci.plugins.workflow.graph.FlowNode; final String JOB_NAME = '/marslo/sandbox' final int BUILD_NUMBER = 17 WorkflowRun run = Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( BUILD_NUMBER ) PipelineNodeGraphVisitor visitor = new PipelineNodeGraphVisitor(run) List flowNodes = visitor.getPipelineNodes() flowNodes.each { println \"\"\" ${it.getDisplayName()} : getRun() : ${it.getRun()} getResult : ${it.status.getResult()} getState : ${it.status.getState()} getType : ${it.getType()} getId : ${it.getId()} isActive : ${it.node.active} searchUrl : ${it.node.getSearchUrl()} getUrl : ${Jenkins.instance.getRootUrl() + it.node.getUrl()} iconColor : ${it.node.getIconColor()} \"\"\" // println \"\"\" // getError : ${it.node.getError()} // getAction : ${it.node.getActions()} // getDisplayFunctionName : ${it.node.getDisplayFunctionName()} // getTypeDisplayName : ${it.node.getTypeDisplayName()} // getTypeFunctionName : ${it.node.getTypeFunctionName()} // it.node.metaClass.methods.name : ${it.node.metaClass.methods*.name.sort().unique()} // it.getClass() : ${it.getClass()} // \"\"\" println \" parents : \" + it.getParents().collect { p -> [ 'name' : p.displayName, 'status' : p.status.getResult(), 'id' : p.id, 'active' : p.node.active ] }.flatten() println '--------------' } result get parent stage ID import org.jenkinsci.plugins.workflow.job.* import org.jenkinsci.plugins.workflow.flow.* import org.jenkinsci.plugins.workflow.cps.* import org.jenkinsci.plugins.workflow.graph.FlowNode; import io.jenkins.blueocean.rest.impl.pipeline.* import io.jenkins.blueocean.rest.model.* import io.jenkins.blueocean.rest.model.BlueRun.* def withFlowNodes( String name, int buildNumber, Closure body ) { WorkflowRun run = Jenkins.instance .getItemByFullName( name ) .getBuildByNumber( buildNumber ) PipelineNodeGraphVisitor visitor = new PipelineNodeGraphVisitor( run ) List flowNodes = visitor.getPipelineNodes() body( flowNodes ) } def isStageFinished( String keyword, String job, int buildNumber, String type = 'parallel' ) { withFlowNodes ( job, buildNumber ) { flowNodes -> List parentIds = flowNodes.findAll { it.displayName.startsWith(keyword) && it.getType() == FlowNodeWrapper.NodeType.valueOf( type.toUpperCase() ) }.collectMany { it.parents.collect{ p -> p.id } }.unique() flowNodes.findAll { parentIds.contains( it.id ) }.every { it.status.getState() == BlueRun.BlueRunState.FINISHED } } // withFlowNodes } get stage build status via parent stage name import org.jenkinsci.plugins.workflow.job.* import org.jenkinsci.plugins.workflow.flow.* import org.jenkinsci.plugins.workflow.cps.* import org.jenkinsci.plugins.workflow.graph.FlowNode; import io.jenkins.blueocean.rest.impl.pipeline.* import io.jenkins.blueocean.rest.model.* import io.jenkins.blueocean.rest.model.BlueRun.* @NonCPS def on( String job, int buildNumber ) { [ isBuilding : { -> isBuilding( job, buildNumber ) } stageStatus : { String keyword, String type = 'parallel', String parentStage = 'Parallel' -> stageStatus ( keyword, job, buildNumber, type, parentStage ) } ] } Boolean isBuilding( String job, int buildNumber ) { Jenkins.instance .getItemByFullName( job ) .getBuildByNumber( buildNumber ) .isInProgress() } def withFlowNodes( String name, int buildNumber, Closure body ) { WorkflowRun run = Jenkins.instance .getItemByFullName( name ) .getBuildByNumber( buildNumber ) PipelineNodeGraphVisitor visitor = new PipelineNodeGraphVisitor( run ) List flowNodes = visitor.getPipelineNodes() body( flowNodes ) } def stageStatus( String keyword , String job , int buildNumber , String type = 'parallel' , String parentStage = 'Parallel' ) { if ( ! isBuilding(job, buildNumber) ) { println( \"pipeline ${job} #${buildNumber} haven't started yet\" ) return false } withFlowNodes ( job, buildNumber ) { flowNodes -> List parentIds = flowNodes.findAll { it.displayName.startsWith(keyword) && it.getType() == FlowNodeWrapper.NodeType.valueOf( type.toUpperCase() ) }.collectMany { it.parents.findAll { p -> p.displayName == parentStage } .collect { p -> p.id } }.unique() return parentIds ? flowNodes.findAll { parentIds.contains( it.id ) }.collect { it.status.getState() } : false } // withFlowNodes } // call on( BUILD_NAME, BUILD_NUMBER ).stageStatus( stageName ) Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:34 "},"jenkins/script/agent.html":{"url":"jenkins/script/agent.html","title":"agent","keywords":"","body":" Table of Contents generated with DocToc get information get all Computer and Node get projects tied to agent get ip address of node get agent environment variable get a list of all Jenkins nodes assigned with label check how many cloud agent running Managing Nodes Monitor and Restart Offline Agents Create a Permanent Agent from Groovy Console update agent label jenkins-scripts/scriptler/disableSlaveNodeStartsWith.groovy disable agent disconnect agent offline agent delete agent get information API: hudson.model.Computer hudson.model.Node hudson.model.Slave hudson.slaves.DumbSlave references: Display Information About Nodes jenkins-scripts/scriptler/showAgentJavaVersion.groovy jenkins-scripts/scriptler/checkNodesLauncherVersion.groovy Skip Jenkins Pipeline Steps If Node Is Offline sample scripts: jenkins-scripts/scriptler/findOfflineSlaves.groovy jenkins-scripts/scriptler/showAgentJavaVersion.groovy jenkins-scripts/scriptler/checkNodesLauncherVersion.groovy get all get all agents including Jenkins master: jenkins.model.Jenkins.instance.computers jenkins.model.Jenkins.instance.get().computers jenkins.model.Jenkins.instance.computers.each { agent -> println \"${agent.displayName} : ${agent.class} : ${agent.class.superclass}\" println \" >> is master : ${jenkins.model.Jenkins.MasterComputer.isInstance(agent)}\" println \" >> is cloud : ${hudson.slaves.AbstractCloudComputer.isInstance(agent)} \" } or jenkins.model.Jenkins.instance.get().computers.each { agent -> println \"${agent.displayName} : ${agent.class} : ${agent.class.superclass}\" println \" >> is master : ${jenkins.model.Jenkins.MasterComputer.isInstance(agent)}\" println \" >> is cloud : ${hudson.slaves.AbstractCloudComputer.isInstance(agent)} \" } Computer and Node hudson.model.Computer -> hudson.model.Node via computer.setNode() hudson.model.Node -> hudson.model.Computer via node.toComputer() example for Computer Object get description Jenkins.instance.getNode('').toComputer().description get all info String agentName = 'marslo-test' Jenkins.instance.computers.findAll { computer -> agentName == computer.name }.each { computer -> String moreinfo = computer.online ? \"properties : ${computer.getSystemProperties().collect { k, v -> \"$k=$v\" }.join('\\n\\t\\t\\t>>> ')}\" : \" logs : ${computer.getLog()}\" println \"\"\" ~~> ${computer.displayName} : class : ${computer.getClass()} class : ${computer.class.superclass?.simpleName} online? : ${computer.online} description : ${computer.description} connectTime : ${computer.connectTime} offlineCauseReason : ${computer.offlineCauseReason} executor : ${computer.numExecutors} ${moreinfo} \"\"\" } result ~~> marslo-test : class : class hudson.slaves.SlaveComputer class : Computer online? : false description : marslo test agent offline connectTime : 1620478291102 offlineCauseReason : This agent is offline because Jenkins failed to launch the agent process on it. executor : 1 logs : SSHLauncher{host='1.2.3.4', port=22, credentialsId='DevOpsSSHCredential', jvmOptions='', javaPath='', prefixStartSlaveCmd='', suffixStartSlaveCmd='', launchTimeoutSeconds=30, maxNumRetries=5, retryWaitTime=30, sshHostKeyVerificationStrategy=hudson.plugins.sshslaves.verifiers.NonVerifyingKeyVerificationStrategy, tcpNoDelay=true, trackCredentials=true} [05/08/21 05:51:31] [SSH] Opening SSH connection to 1.2.3.4:22. connect timed out SSH Connection failed with IOException: \"connect timed out\", retrying in 30 seconds. There are 5 more retries left. connect timed out ... example for Node Object import hudson.slaves.* DumbSlave agent = jenkins.model.Jenkins.instance.getNode( 'marslo-test' ) println \"\"\" display name : ${agent.getDisplayName()} node name : ${agent.getNodeName()} description : ${agent.getNodeDescription()} executor : ${agent.getNumExecutors()} label string : ${agent.getLabelString()} node mode : ${agent.getMode()} hold off launch : ${agent.isHoldOffLaunchUntilSave()} \"\"\" result display name : marslo-test node name : marslo-test description : marslo test agent offline executor : 1 label string : node mode : NORMAL hold off launch : true setup hold off launch via: agent.holdOffLaunchUntilSave = true node -> computer String agent = 'marslo-test' Jenkins.instance.getNode(agent).toComputer().isOnline() or hudson.model.Hudson.instance.getNode(agent).toComputer().isOnline() or get log println jenkins.model.Jenkins.instance.getNode( 'marslo-test' ).toComputer().getLog() // result SSHLauncher{host='1.2.3.4', port=22, credentialsId='DevOpsSSHCredential', jvmOptions='', javaPath='', prefixStartSlaveCmd='', suffixStartSlaveCmd='', launchTimeoutSeconds=30, maxNumRetries=5, retryWaitTime=30, sshHostKeyVerificationStrategy=hudson.plugins.sshslaves.verifiers.NonVerifyingKeyVerificationStrategy, tcpNoDelay=true, trackCredentials=true} [05/24/21 03:59:16] [SSH] Opening SSH connection to 1.2.3.4:22. connect timed out SSH Connection failed with IOException: \"connect timed out\", retrying in 30 seconds. There are 5 more retries left. get projects tied to agent reference: jenkins.model.Computer.allExecutors hudson.model.Executor.currentWorkUnit hudson.model.queue.WorkUnit.work import hudson.model.* import jenkins.model.* import hudson.slaves.* String name = 'myagent' Computer computer = jenkins.model.Jenkins.instance.getNode(name)?.computer ?: null println computer.allExecutors.collect { it.currentWorkUnit?.work?.runId ?: '' }.join(', ') ?: '' result or println computer.getAllExecutors().collect { it.getCurrentWorkUnit()?.work?.runId ?: '' } or via hudson.model.queue.WorkUnit.context println computer.allExecutors.collect { it.currentWorkUnit?.context?.task?.runId ?: '' } get label itself might helps: Label Linked Jobs jenkins.model.Jenkins.instance.getNode(name)?.computer?.allExecutors.each { println it.currentWorkUnit.work.getClass() println '.................' println it.currentWorkUnit.work.label println it.currentWorkUnit.work.runId println '.................' println it.currentWorkUnit?.context?.task?.label println it.currentWorkUnit?.context?.task?.runId println '.................' println it.currentWorkUnit.work.getOwnerTask().getClass() println it.currentWorkUnit.work.getOwnerTask().getFullDisplayName() println '.................' } // result class org.jenkinsci.plugins.workflow.support.steps.ExecutorStepExecution$PlaceholderTask ................. MY_AGENT_001 marslo/sandbox#6460 ................. MY_AGENT_001 marslo/sandbox#6460 ................. class org.jenkinsci.plugins.workflow.job.WorkflowJob marslo » sandbox ................. Result: [Thread[Executor #0 for MY_AGENT_001 : executing PlaceholderExecutable:ExecutorStepExecution.PlaceholderTask{runId=marslo/sandbox#6460,label=CI-WP-CD-RPI005,context=CpsStepContext[3:node]:Owner[marslo/sandbox/6460:marslo/sandbox #6460],cookie=null,auth=null},5,]] get number of executor of agents jenkins.model.Jenkins.instance.getNode(name)?.computer?.allExecutors?.size get ip address of node import hudson.model.Computer.ListPossibleNames println jenkins.model .Jenkins.instance .getNode( '' ).computer .getChannel().call(new ListPossibleNames()) or println jenkins.model .Jenkins.instance .getNode( '' ).computer .getHostName() or println InetAddress.localHost.hostAddress get agent environment variable for (slave in jenkins.model.Jenkins.instance.slaves) { println(slave.name + \": \") def props = slave.nodeProperties.getAll(hudson.slaves.EnvironmentVariablesNodeProperty.class) for (prop in props) { for (envvar in prop.envVars) { println envvar.key + \" -> \" + envvar.value } } } get a list of all Jenkins nodes assigned with label def nodes = jenkins.model.Jenkins.get().computers .findAll{ it.node.labelString.contains(label) } .collect{ it.node.selfLabel.name } or@NonCPS def hostNames(label) { def nodes = [] jenkins.model.Jenkins.get.computers.each { c -> if (c.node.labelString.contains(label)) { nodes.add(c.node.selfLabel.name) } } return nodes } orJenkins.instance.getLabel('my-label').getNodes().collect{ it.getNodeName() } check how many cloud agent running println jenkins.model.Jenkins.instance.getNodes().findAll { [ 'AbstractCloudSlave', 'AbstractCloudComputer' ].contains(it.class.superclass?.simpleName) }.size() Managing Nodes Monitor and Restart Offline Agents import hudson.node_monitors.* import hudson.slaves.* import java.util.concurrent.* jenkins = Jenkins.instance import javax.mail.internet.*; import javax.mail.* import javax.activation.* def sendMail (agent, cause) { message = agent + \" agent is down. Check http://JENKINS_HOSTNAME:JENKINS_PORT/computer/\" + agent + \"\\nBecause \" + cause subject = agent + \" agent is offline\" toAddress = \"JENKINS_ADMIN@YOUR_DOMAIN\" fromAddress = \"JENKINS@YOUR_DOMAIN\" host = \"SMTP_SERVER\" port = \"SMTP_PORT\" Properties mprops = new Properties(); mprops.setProperty(\"mail.transport.protocol\",\"smtp\"); mprops.setProperty(\"mail.host\",host); mprops.setProperty(\"mail.smtp.port\",port); Session lSession = Session.getDefaultInstance(mprops,null); MimeMessage msg = new MimeMessage(lSession); //tokenize out the recipients in case they came in as a list StringTokenizer tok = new StringTokenizer(toAddress,\";\"); ArrayList emailTos = new ArrayList(); while(tok.hasMoreElements()) { emailTos.add(new InternetAddress(tok.nextElement().toString())); } InternetAddress[] to = new InternetAddress[emailTos.size()]; to = (InternetAddress[]) emailTos.toArray(to); msg.setRecipients(MimeMessage.RecipientType.TO,to); InternetAddress fromAddr = new InternetAddress(fromAddress); msg.setFrom(fromAddr); msg.setFrom(new InternetAddress(fromAddress)); msg.setSubject(subject); msg.setText(message) Transport transporter = lSession.getTransport(\"smtp\"); transporter.connect(); transporter.send(msg); } def getEnviron(computer) { def env def thread = Thread.start(\"Getting env from ${computer.name}\", { env = computer.environment }) thread.join(2000) if (thread.isAlive()) thread.interrupt() env } def agentAccessible(computer) { getEnviron(computer)?.get('PATH') != null } def numberOfflineNodes = 0 def numberNodes = 0 for (agent in jenkins.getNodes()) { def computer = agent.computer numberNodes ++ println \"\" println \"Checking computer ${computer.name}:\" def isOK = (agentAccessible(computer) && !computer.offline) if (isOK) { println \"\\t\\tOK, got PATH back from agent ${computer.name}.\" println('\\tcomputer.isOffline: ' + computer.isOffline()); println('\\tcomputer.isTemporarilyOffline: ' + computer.isTemporarilyOffline()); println('\\tcomputer.getOfflineCause: ' + computer.getOfflineCause()); println('\\tcomputer.offline: ' + computer.offline); } else { numberOfflineNodes ++ println \" ERROR: can't get PATH from agent ${computer.name}.\" println('\\tcomputer.isOffline: ' + computer.isOffline()); println('\\tcomputer.isTemporarilyOffline: ' + computer.isTemporarilyOffline()); println('\\tcomputer.getOfflineCause: ' + computer.getOfflineCause()); println('\\tcomputer.offline: ' + computer.offline); sendMail(computer.name, computer.getOfflineCause().toString()) if (computer.isTemporarilyOffline()) { if (!computer.getOfflineCause().toString().contains(\"Disconnected by\")) { computer.setTemporarilyOffline(false, agent.getComputer().getOfflineCause()) } } else { computer.connect(true) } } } println (\"Number of Offline Nodes: \" + numberOfflineNodes) println (\"Number of Nodes: \" + numberNodes) Create a Permanent Agent from Groovy Console api: hudson.plugins.sshslaves.SSHLauncher hudson.plugins.sshslaves.verifiers.SshHostKeyVerificationStrategy hudson.slaves.DumbSlave hudson.slaves.ComputerLauncher references: jenkins-scripts/createAgentsScript.groovy GroovyJenkins/src/main/groovy/AddNodeToJenkins.groovy useful libs: import jenkins.model.* import hudson.slaves.* import hudson.slaves.NodePropertyDescriptor import hudson.plugins.sshslaves.* import hudson.plugins.sshslaves.verifiers.* import hudson.model.* import hudson.model.Node import hudson.model.Queue import hudson.model.queue.CauseOfBlockage import hudson.slaves.EnvironmentVariablesNodeProperty.Entry import java.util.ArrayList import com.synopsys.arc.jenkinsci.plugins.jobrestrictions.nodes.JobRestrictionProperty import com.synopsys.arc.jenkinsci.plugins.jobrestrictions.Messages import com.synopsys.arc.jenkinsci.plugins.jobrestrictions.restrictions.JobRestriction import com.synopsys.arc.jenkinsci.plugins.jobrestrictions.restrictions.JobRestrictionBlockageCause import hudson.Extension import hudson.slaves.NodeProperty import org.kohsuke.stapler.DataBoundConstructor SSH host verification strategy: // Known hosts file Verification Strategy new KnownHostsFileKeyVerificationStrategy() // Manually provided key Verification Strategy new ManuallyProvidedKeyVerificationStrategy(\"\") // Manually trusted key Verification Strategy new ManuallyTrustedKeyVerificationStrategy(false /*requires initial manual trust*/) // Non verifying Verification Strategy new NonVerifyingKeyVerificationStrategy() import hudson.model.* import jenkins.model.* import hudson.slaves.* import hudson.slaves.EnvironmentVariablesNodeProperty.Entry import hudson.plugins.sshslaves.verifiers.* // Pick one of the strategies from the comments below this line // SshHostKeyVerificationStrategy hostKeyVerificationStrategy = new KnownHostsFileKeyVerificationStrategy() //= new KnownHostsFileKeyVerificationStrategy() // Known hosts file Verification Strategy //= new ManuallyProvidedKeyVerificationStrategy(\"\") // Manually provided key Verification Strategy //= new ManuallyTrustedKeyVerificationStrategy(false /*requires initial manual trust*/) // Manually trusted key Verification Strategy //= new NonVerifyingKeyVerificationStrategy() // Non verifying Verification Strategy // Define a \"Launch method\": \"Launch agents via SSH\" ComputerLauncher launcher = new hudson.plugins.sshslaves.SSHLauncher( \"1.2.3.4\", // Host 22, // Port \"MyCredentials\", // Credentials (String)null, // JVM Options (String)null, // JavaPath (String)null, // Prefix Start Agent Command (String)null, // Suffix Start Agent Command (Integer)null, // Connection Timeout in Seconds (Integer)null, // Maximum Number of Retries (Integer)null, // The number of seconds to wait between retries new NonVerifyingKeyVerificationStrategy() // Host Key Verification Strategy ) // Define a \"Permanent Agent\" Slave agent = new DumbSlave( \"marslo-test\", \"/home/devops\", launcher) agent.nodeDescription = \"marslo test agent\" agent.numExecutors = 1 agent.labelString = \"\" agent.mode = Node.Mode.NORMAL agent.retentionStrategy = new RetentionStrategy.Always() List env = new ArrayList(); env.add(new Entry(\"key1\",\"value1\")) env.add(new Entry(\"key2\",\"value2\")) EnvironmentVariablesNodeProperty envPro = new EnvironmentVariablesNodeProperty(env); agent.getNodeProperties().add(envPro) // Create a \"Permanent Agent\" Jenkins.instance.addNode(agent) return \"Node has been created successfully.\" or import hudson.model.* import jenkins.model.* import hudson.slaves.* import hudson.plugins.sshslaves.verifiers.* import hudson.slaves.EnvironmentVariablesNodeProperty.Entry String name = 'marslo-test' String description = 'marslo test agent' String rootDir = '/home/marslo' String nodeLabel = '' String ip = '1.2.3.4' String credential = 'MyCredential' Map envVars = [ 'key1' : 'value1', 'key2' : 'value2' ] SshHostKeyVerificationStrategy hostKeyVerificationStrategy = new NonVerifyingKeyVerificationStrategy() List env = new ArrayList(); envVars.each { k, v -> env.add(new Entry(k, v)) } EnvironmentVariablesNodeProperty envPro = new EnvironmentVariablesNodeProperty(env); Slave agent = new DumbSlave( name, description, rootDir, \"1\", Node.Mode.NORMAL, nodeLabel, new hudson.plugins.sshslaves.SSHLauncher( ip, // Host 22, // Port credential, // Credentials (String)null, // JVM Options (String)null, // JavaPath (String)null, // Prefix Start Agent Command (String)null, // Suffix Start Agent Command (Integer)null, // Connection Timeout in Seconds (Integer)null, // Maximum Number of Retries (Integer)null, // The number of seconds to wait between retries hostKeyVerificationStrategy // Host Key Verification Strategy ) , new RetentionStrategy.Always(), new LinkedList() ) agent.getNodeProperties().add(envPro) Jenkins.instance.addNode(agent) update agent label references: Groovy script for modifying Jenkins nodes labels get label def getLabel( String label ){ for ( node in jenkins.model.Jenkins.instance.nodes ) { if ( node.getNodeName().toString().equals(label) ) { return node.getLabelString() } } } or def getLabel( String label ){ jenkins.model.Jenkins.instance.nodes.find { it.getNodeName().toString().equals(label) }.getLabelString() } update label def updateLabel( String agent, String label ) { def node = jenkins.model.Jenkins.instance.getNode( agent ) if ( node ) { node.setLabelString(label) node.save() } } jenkins-scripts/scriptler/disableSlaveNodeStartsWith.groovy disable agent references: cloudbees/jenkins-scripts/disableAgents.groovy disconnect agent reconnect: agent.computer.connect( true ) jenkins.model.Jenkins.instance.getNode( name ).computer.connect( true ) reference: awslabs/ec2-spot-jenkins-plugin | or import hudson.slaves.* String name = 'marslo-test' String cause = \"disconnet the agent automatically via ${env.BUILD_URL}\" DumbSlave agent = jenkins.model.Jenkins.instance.getNode( name ) if ( agent && ! ['AbstractCloudComputer', 'AbstractCloudSlave'].contains(agent.computer?.class.superclass?.simpleName) && ! (agent.computer instanceof jenkins.model.Jenkins.MasterComputer) ) { Boolean online = agent.computer.isOnline() Boolean busy = agent.computer.countBusy() != 0 if( online && !busy ) { agent.computer.disconnect( new OfflineCause.ChannelTermination(new UnsupportedOperationException(cause)) ) } } offline agent offline agent is normally for workspace cleanup reference: codecentric/jenkins-scripts Display Information About Nodes bring node online computer.setTemporarilyOffline( false, null ) import hudson.slaves.* String name = 'marslo-test' String cause = \"temporary offline for the agent workspace cleanup\" DumbSlave agent = jenkins.model.Jenkins.instance.getNode( name ) if ( agent && ! ['AbstractCloudComputer', 'AbstractCloudSlave'].contains(agent.computer?.class.superclass?.simpleName) && ! (agent.computer instanceof jenkins.model.Jenkins.MasterComputer) ) { Boolean online = agent.computer.isOnline() Boolean busy = agent.computer.countBusy() != 0 if( online && !busy ) { agent.computer.setTemporarilyOffline( true, new hudson.slaves.OfflineCause.ByCLI(\"disk cleanup on slave\") ) } } delete agent references: cloudbees/jenkins-scripts/deleteAgents.groovy def isAgentExists( String name ) { jenkins.model.Jenkins.instance.getNodes().any { name == it.computer?.name } } def removeAgent( String name ) { Boolean deleted = false DumbSlave agent = jenkins.model.Jenkins.instance.getNode( name ) if ( agent && ! AbstractCloudComputer.isInstance( agent.computer ) && ! AbstractCloudSlave.isInstance( agent.computer ) && ! ( agent.computer instanceof jenkins.model.Jenkins.MasterComputer ) ) { Boolean online = agent.computer.isOnline() Boolean busy = agent.computer.countBusy() != 0 if ( !busy ) { println \"\"\" \"${online ? ' offline and' : ''} remove agent ${name} :\" display name : ${agent.getDisplayName()} description : ${agent.getNodeDescription()} executor : ${agent.getNumExecutors()} node mode : ${agent.getMode()} online? : ${online} busy? : ${busy} offline cause? : ${agent.computer.getOfflineCause()} \"\"\" if ( online ) { agent.computer.setTemporarilyOffline( true, new hudson.slaves.OfflineCause.ByCLI('offline due to agent will be removed automatically') ) Thread.sleep( 5*1000 ) } agent.computer.doDoDelete() deleted = ! isAgentExists( name ) println( \"INFO: agent ${name} ${deleted ? 'has been successfully removed' : 'failed been removed'} from ${env.JENKINS_URL}computer\") } else { println(\"WARN: the agent ${name} cannot be removed due to project is tie to it\" ) } } else { println('WARN: cloud agent or Jenkins master cannot be removed!' ) } return deleted } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:33 "},"jenkins/script/authorization.html":{"url":"jenkins/script/authorization.html","title":"security & authorization","keywords":"","body":" Table of Contents generated with DocToc security get securityRealm authorization strategy list all Jenkins supported authorization permissions get current authorization strategy class get raw authorization and permissions info ProjectMatrixAuthorizationStrategy RoleBasedAuthorizationStrategy crumb issuer get crumb issuer set crumb issuer clean up all pending Async Resource Disposers items security get securityRealm import hudson.security.* import jenkins.security.* import jenkins.model.Jenkins def jenkins = jenkins.model.Jenkins.getInstance() println jenkins.securityRealm println jenkins.authorizationStrategy // result // hudson.security.LDAPSecurityRealm@7d090e41 // hudson.security.ProjectMatrixAuthorizationStrategy@6d51bb9d authorization strategy reference: hudson.security.Permission hudson.security.ProjectMatrixAuthorizationStrategy matrix-auth-plugin/src/main/java/hudson/security/ProjectMatrixAuthorizationStrategy.java How to add permission in GlobalMatrixAuthorizationStrategy through the groovy - for hudson.sercurity.item.Move list all Jenkins supported authorization permissions hudson.security.Permission.getAll().each { p -> println \"${p.name} :\\n\" + \"\\t${p.id} : ${p.description}\" } better one import hudson.security.GlobalMatrixAuthorizationStrategy import hudson.security.Permission import hudson.security.ProjectMatrixAuthorizationStrategy import jenkins.model.Jenkins String shortName( Permission p ) { Map replacement = [ 'Hudson' : 'Overall' , 'Computer' : 'Agent' , 'Item' : 'Job' , 'CredentialsProvider' : 'Credentials' ] p.id .tokenize('.')[-2..-1] .collect { replacement.get(it) ?: it } .join(' ') } Map permissionIds = Permission.all.findAll { permission -> List nonConfigurablePerms = ['RunScripts', 'UploadPlugins', 'ConfigureUpdateCenter'] permission.enabled && ! permission.id.startsWith('hudson.security.Permission') && ! nonConfigurablePerms.any { permission.id.endsWith(it) } }.collect { permission -> [ (shortName(permission)): permission ] }.sum() get current authorization strategy class import hudson.model.* import hudson.security.* Hudson instance = Jenkins.getInstance() def strategy = instance.getAuthorizationStrategy() println strategy.getClass() resultclass hudson.security.ProjectMatrixAuthorizationStrategy get raw authorization and permissions info Jenkins.instance.authorizationStrategy.grantedPermissions.collect{ p, u -> println \"\\n${p} :\\n\\t${u}\" } orJenkins.instance.authorizationStrategy.grantedPermissions.collect{ p, u -> [ (p.id), u ] } ProjectMatrixAuthorizationStrategy grant permission to user import hudson.security.GlobalMatrixAuthorizationStrategy import hudson.security.Permission import hudson.security.ProjectMatrixAuthorizationStrategy import jenkins.model.Jenkins ProjectMatrixAuthorizationStrategy authorizationStrategy = new ProjectMatrixAuthorizationStrategy() String id = 'hudson.model.Hudson.Administer' String user = 'marslo' authorizationStrategy.add( Permission.fromId(id), user ) // save strategy Jenkins.instance.authorizationStrategy = authorizationStrategy Jenkins.instance.save() add new configurations according to Map structure create new instance new import hudson.security.* ProjectMatrixAuthorizationStrategy authorizationStrategy = new ProjectMatrixAuthorizationStrategy() via getAuthorizationStrategy import hudson.model.* import hudson.security.* def strategy = Jenkins.getInstance().getAuthorizationStrategy() def authorizationStrategy = strategy.class.newInstance() new instance from name String instanceName = 'hudson.security.ProjectMatrixAuthorizationStrategy' def strategy = Class.forName(instanceName).newInstance() println strategy.class resultclass hudson.security.ProjectMatrixAuthorizationStrategy get groups list import hudson.model.* import hudson.security.* ProjectMatrixAuthorizationStrategy authorizationStrategy = new ProjectMatrixAuthorizationStrategy() println authorizationStrategy.getGroups() RoleBasedAuthorizationStrategy add 'admin' user to all permissions import hudson.* import hudson.security.* import jenkins.model.* import java.util.* import com.michelin.cio.hudson.plugins.rolestrategy.* import com.synopsys.arc.jenkins.plugins.rolestrategy.* import java.lang.reflect.* import java.util.logging.* import groovy.json.* import jenkins.* import com.michelin.cio.hudson.plugins.rolestrategy.* String admin = 'admin' // Turn security on RoleBasedAuthorizationStrategy authorizationStrategy = new RoleBasedAuthorizationStrategy() // ProjectMatrixAuthorizationStrategy authorizationStrategy = new ProjectMatrixAuthorizationStrategy() Jenkins.instance.setAuthorizationStrategy(authorizationStrategy) Constructor[] constrs = Role.class.getConstructors() for (Constructor c : constrs) { c.setAccessible(true) } Method assignRoleMethod = RoleBasedAuthorizationStrategy.class.getDeclaredMethod( \"assignRole\", String.class, Role.class, String.class ) assignRoleMethod.setAccessible( true ) Set adminPermissions = new HashSet() hudson.security.Permission.getAll(){ adminPermissions.add(Permission.fromId(it) } Role adminRole = new Role( admin, adminPermissions ) authorizationStrategy.addRole( RoleBasedAuthorizationStrategy.GLOBAL, adminRole ) crumb issuer reference: hudson.security.csrf.CrumbIssuer ivan-pinatti/jenkins-set-default-crumb-issuer.groovy get crumb issuer import hudson.security.csrf.DefaultCrumbIssuer DefaultCrumbIssuer issuer = jenkins.model.Jenkins.instance.crumbIssuer String jenkinsCrumb = \"${issuer.crumbRequestField}:${issuer.crumb}\" println jenkinsCrumb // Jenkins-Crumb:b8a9cd5*********** set crumb issuer import jenkins.model.Jenkins Jenkins jenkins = jenkins.model.Jenkins.instance jenkins.setCrumbIssuer(new DefaultCrumbIssuer(true)) jenkins.save() clean up all pending Async Resource Disposers items import org.jenkinsci.plugins.resourcedisposer.AsyncResourceDisposer import org.jenkinsci.plugins.strictcrumbissuer.StrictCrumbIssuer AsyncResourceDisposer disposer = AsyncResourceDisposer.get() StrictCrumbIssuer issuer = jenkins.model.Jenkins.instance.crumbIssuer String jenkinsCrumb = \"${issuer.crumbRequestField}:${issuer.crumb}\" String url = Jenkins.instance.rootUrl + disposer.url disposer.getBacklog().each { item -> println \"\\n${item.id} : \\t${url}/stopTracking/?id=${item.id} : \\t${item.class.simpleName} : \\n\" + \"\\t${item.getLastState().getDisplayName()} : \\n\" + \"\\t${item.getDisposable().node} : ${item.getDisposable().path}\\n\" + \"\\t${item.toString()}\" println \"removeing ${item.id} : \" [ 'bash', '-c', 'curl -v -s ' + '-u : ' + '-X POST ' + \"-H \\\"Content-Type: application/json\\\" \" + \"-H \\\"Accept: application/json\\\" \" + \"-H \\\"${jenkinsCrumb}\\\" \" + \"${url}/stopTracking/?id=${item.id} \" ].execute().with{ def stdout = new StringBuffer() def stderr = new StringBuffer() it.waitForProcessOutput( stdout, stderr ) println \"EXIT CODE: ${it.exitValue()}\" println \"ERROR: ${stderr}\" println \"OUTPUT: ${stdout}\" } } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:34 "},"jenkins/script/api.html":{"url":"jenkins/script/api.html","title":"api","keywords":"","body":" Table of Contents generated with DocToc execute Groovy script with an API call stop build via api get builds information list plugins using api (curl) using cli builds get particular build parameters get all parameters via Json format reference: Example for Jenkins API CSRF Protection Explained Remote access API How to build a job using the REST API and cURL? 7 useful Jenkins Rest services get crumb and sessoin : with sessoin (cookie)$ COOKIEJAR=\"$(mktemp)\" $ CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"${COOKIEJAR}\" \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' ) example for run safeRestart api :$ COOKIEJAR=\"$(mktemp)\" $ CRUMB=$(curl --cookie-jar \"${COOKIEJAR}\" \\ \"https://jenkins.marslo.com/crumbIssuer/api/json\" | jq -r '.crumbRequestField + \":\" + .crumb' ) $ curl -v \\ -X POST \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ -H \"Content-Type: application/json\" \\ -H \"Accept: application/json\" https://jenkins.marslo.com/safeRestart execute Groovy script with an API call $ curl -v \\ --user username:ApiToken \\ -d \"script=$(cat /tmp/script.groovy)\" \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ http://JENKINS_URL/scriptText # or $ curl -v \\ --user username:ApiToken \\ -d \"script=println 'this script works'\" \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ http://JENKINS_URL/scriptText stop build via api api comments BUILD_URL/stop abort a build BUILD_URL/term forcibly terminate a build BUILD_URL/kill hard kill a pipeline get builds information reference: USING JENKINS / HUDSON REMOTE API TO CHECK JOBS STATUS justlaputa/jenkins-api.md via job api $ curl -sSLg \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ http://jenkins:8080/job/my-job/api/json?tree=builds[id,number,duration,timestamp,builtOn] get particular fields for all builds api format: api/json?tree=allBuilds[Bartifact,description,building,displayName,duration,estimatedDuration,fullDisplayName,id,number,queueId,result,timestamp,url] $ curl -s \\ --globoff \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ 'https:///job//api/json?tree=allBuilds[artifact,description,building,displayName,duration,estimatedDuration,fullDisplayName,id,number,queueId,result,timestamp,url]' | jq --raw-output . list plugins using api (curl) $ curl -s \\ -u: \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ https:///pluginManager/api/json?depth=1 | jq -r '.plugins[] | \"\\(.shortName):\\(.version)\"' | sort or$ curl -s \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ 'https:///pluginManager/api/json?pretty=1&tree=plugins\\[shortName,longName,version\\]' { \"_class\": \"hudson.LocalPluginManager\", \"plugins\": [ { \"longName\": \"SSH Credentials Plugin\", \"shortName\": \"ssh-credentials\", \"version\": \"1.18.1\" }, { \"longName\": \"Configuration as Code Plugin\", \"shortName\": \"configuration-as-code\", \"version\": \"1.47\" }, ... } using cli $ cat plugin.groovy def plugins = jenkins.model.Jenkins.instance.getPluginManager().getPlugins() plugins.each {println \"${it.getShortName()}: ${it.getVersion()}\"} by jar$ curl -fsSL -O https://JENKINS_URL/jnlpJars/jenkins-cli.jar $ java -jar jenkins-cli.jar \\ [-auth :] \\ -s https://JENKINS_URL groovy = or$ java -jar jenkins-cli.jar \\ [-auth :] \\ -s https://JENKINS_URL \\ list-plugins by ssh $ ssh [-i ] [-l ] -p JENKINS_URL groovy = or $ ssh [-i ] [-l ] -p JENKINS_URL list-plugins or $ ssh [-i ] [-l ] -p JENKINS_URL groovy builds get particular build parameters $ curl -s https:///job///api/xml?xpath=/workflowRun/action/parameter[name=\"\"]/value remove xml tag$ curl -s 'https:///job///api/xml?xpath=/workflowRun/action/parameter\\[name=\"tester\"\\]/value' | sed -re 's:]+>([^ i.e.: $ curl -s --globoff 'https:///job///api/xml?xpath=/*/action/parameter[name=%22id%22]' idmarslo $ curl -s --globoff 'https:///job///api/xml?xpath=/*/action/parameter[name=%22id%22]/value' marslo $ curl -s --globoff 'https:///job///api/xml?xpath=/*/action/parameter[name=%22id%22]/value' | sed -re 's:]+>([^ get all parameters via Json format api: https:///job///api/json?tree=actions[parameters[*]] $ curl -s --globoff 'https:///job///api/json?tree=actions[parameters[*]]' | jq --raw-output '.actions[].parameters[]?' { \"_class\": \"hudson.model.StringParameterValue\", \"name\": \"id\", \"value\": \"marslo\" } { \"_class\": \"hudson.model.StringParameterValue\", \"name\": \"gender\", \"value\": \"female\" } additional format$ curl -s --globoff 'https:///job///api/json?tree=actions[parameters[*]]' | jq --raw-output '.actions[].parameters[]? | .name + \"\\t\" + .value' id marslo gender female jq tips remove empty line from output i.e.: original jq --raw-output .actions[].parameters remove empty line: jq --raw-output '[.actions[].parameters | select(length > 0) ]' $ curl -s --globoff 'https:///job///api/json?tree=actions[parameters[*]]' | jq --raw-output '[.actions[].parameters | select(length > 0)]' [ [ { \"_class\": \"hudson.model.StringParameterValue\", \"name\": \"id\", \"value\": \"marslo\" }, { \"_class\": \"hudson.model.StringParameterValue\", \"name\": \"gender\", \"value\": \"female\" } ] ] Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:33 "},"jenkins/script/cli.html":{"url":"jenkins/script/cli.html","title":"cli","keywords":"","body":" Table of Contents generated with DocToc setup cli get port ssh jenkins-cli.jar Execute groovy script via cli ERROR: This command is requesting the -remoting mode which is no longer supported Solution setup cli export JENKINS_URL= get port $ curl -Lv https://${JENKINS_URL}/login 2>&1 | grep -i 'x-ssh-endpoint' ssh Jenkins config ~/.ssh/config $ cat ~/.ssh/config Host my.jenkins.com User marslo IdentityFile ~/.ssh/marslo Port 32123 using cli $ ssh -q ${JENKINS_URL} help add-job-to-view Adds jobs to view. apply-configuration Apply YAML configuration to instance build Builds a job, and optionally waits until its completion. cancel-quiet-down Cancel the effect of the \"quiet-down\" command. channel-process Launch a new JVM on a slave and connect it with the master with remoting ... OR $ ssh -l -i -p ${JENKINS_URL} # example $ ssh -l marslo -i ~/.ssh/marslo -p 32123 ${JENKINS_URL} help jenkins-cli.jar get client (jenkins-cli.jar) $ curl -fsSL -O [-u:] https://${JENKINS_URL}/jnlpJars/jenkins-cli.jar # or $ curl -fsSL -O --netrc-file ~/.marslo/.netrc' https://${JENKINS_URL}/jnlpJars/jenkins-cli.jar $ cat ~/.marslo/.netrc machine login myaccount password mypassword use cli $ java -jar jenkins-cli.jar -auth : -s https://${JENKINS_URL} # example $ java -jar jenkins-cli.jar -auth marslo: -s https://${JENKINS_URL} help add-job-to-view Adds jobs to view. apply-configuration Apply YAML configuration to instance build Builds a job, and optionally waits until its completion. cancel-quiet-down Cancel the effect of the \"quiet-down\" command. ... handle -auth using directly in command line $ java -jar jenkins-cli.jar -auth marslo: -s https://${JENKINS_URL} using file $ echo 'marslo: ~/.marslo/.jenkins-cli' $ java -jar jenkins-cli.jar -auth @/Users/marslo/.marslo/.jenkins-cli -s https://${JENKINS_URL} using environment $ export JENKINS_USER_ID=marslo $ export JENKINS_API_TOKEN= $ java -jar jenkins-cli.jar -s https://${JENKINS_URL} Execute groovy script via cli ERROR: This command is requesting the -remoting mode which is no longer supported $ ssh -q groovy Solution $ ssh -q groovy = i.e.:$ ssh -q my.jenkins.com groovy Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:34 "},"jenkins/script/tricky.html":{"url":"jenkins/script/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc DSL How do I access Pipeline DSLs from inside a Groovy class? jobs Create a Permanent Agent from Groovy Console agents Monitor and Restart Offline Agents others run shell scripts in a cluster-operation get all running thread Automate configuring via Jenkins Script Console references: Jenkins Features Controlled with System Properties DSL How do I access Pipeline DSLs from inside a Groovy class? class C implements Serializable { def stuff(steps) { steps.node { steps.sh 'echo hello' } } } def c = new C() c.stuff(steps) orclass C implements Serializable { def stuff(script) { script.node { script.echo \"running in ${script.env.JENKINS_URL}\" } } } def c = new C() c.stuff(this) jobs Create a Permanent Agent from Groovy Console import hudson.model.* import jenkins.model.* import hudson.slaves.* import hudson.slaves.EnvironmentVariablesNodeProperty.Entry /** * INSERT \"Launch Method\" SNIPPET HERE */ // Define a \"Permanent Agent\" Slave agent = new DumbSlave( \"agent-node\", \"/home/jenkins\", launcher) agent.nodeDescription = \"Agent node description\" agent.numExecutors = 1 agent.labelString = \"agent-node-label\" agent.mode = Node.Mode.NORMAL agent.retentionStrategy = new RetentionStrategy.Always() List env = new ArrayList(); env.add(new Entry(\"key1\",\"value1\")) env.add(new Entry(\"key2\",\"value2\")) EnvironmentVariablesNodeProperty envPro = new EnvironmentVariablesNodeProperty(env); agent.getNodeProperties().add(envPro) // Create a \"Permanent Agent\" Jenkins.instance.addNode(agent) return \"Node has been created successfully.\" or:CloudBees SSH Build Agents plugin 2.0 and newer import com.cloudbees.jenkins.plugins.sshslaves.verification.* import com.cloudbees.jenkins.plugins.sshslaves.SSHConnectionDetails // Pick one of the strategies from the comments below this line ServerKeyVerificationStrategy serverKeyVerificationStrategy = new TrustInitialConnectionVerificationStrategy(false) // = new TrustInitialConnectionVerificationStrategy(false /* \"Require manual verification of initial connection\" */) // \"Manually trusted key verification Strategy\" // = new ManuallyConnectionVerificationStrategy(\"\") // \"Manually provided key verification Strategy\" // = new KnownHostsConnectionVerificationStrategy() // \"~/.ssh/known_hosts file Verification Strategy\" // = new BlindTrustConnectionVerificationStrategy() // \"Non-verifying Verification Strategy\" // Define a \"Launch method\": \"Launch agents via SSH\" ComputerLauncher launcher = new com.cloudbees.jenkins.plugins.sshslaves.SSHLauncher( \"host\", // Host new SSHConnectionDetails( \"credentialsId\", // Credentials ID 22, // port (String)null, // JavaPath (String)null, // JVM Options (String)null, // Prefix Start Agent Command (String)null, // Suffix Start Agent Command (boolean)false, // Log environment on initial connect (ServerKeyVerificationStrategy) serverKeyVerificationStrategy // Host Key Verification Strategy ) ) agents Monitor and Restart Offline Agents import hudson.node_monitors.* import hudson.slaves.* import java.util.concurrent.* jenkins = Jenkins.instance import javax.mail.internet.*; import javax.mail.* import javax.activation.* def sendMail (agent, cause) { message = agent + \" agent is down. Check http://JENKINS_HOSTNAME:JENKINS_PORT/computer/\" + agent + \"\\nBecause \" + cause subject = agent + \" agent is offline\" toAddress = \"JENKINS_ADMIN@YOUR_DOMAIN\" fromAddress = \"JENKINS@YOUR_DOMAIN\" host = \"SMTP_SERVER\" port = \"SMTP_PORT\" Properties mprops = new Properties(); mprops.setProperty(\"mail.transport.protocol\",\"smtp\"); mprops.setProperty(\"mail.host\",host); mprops.setProperty(\"mail.smtp.port\",port); Session lSession = Session.getDefaultInstance(mprops,null); MimeMessage msg = new MimeMessage(lSession); //tokenize out the recipients in case they came in as a list StringTokenizer tok = new StringTokenizer(toAddress,\";\"); ArrayList emailTos = new ArrayList(); while(tok.hasMoreElements()) { emailTos.add(new InternetAddress(tok.nextElement().toString())); } InternetAddress[] to = new InternetAddress[emailTos.size()]; to = (InternetAddress[]) emailTos.toArray(to); msg.setRecipients(MimeMessage.RecipientType.TO,to); InternetAddress fromAddr = new InternetAddress(fromAddress); msg.setFrom(fromAddr); msg.setFrom(new InternetAddress(fromAddress)); msg.setSubject(subject); msg.setText(message) Transport transporter = lSession.getTransport(\"smtp\"); transporter.connect(); transporter.send(msg); } def getEnviron(computer) { def env def thread = Thread.start(\"Getting env from ${computer.name}\", { env = computer.environment }) thread.join(2000) if (thread.isAlive()) thread.interrupt() env } def agentAccessible(computer) { getEnviron(computer)?.get('PATH') != null } def numberOfflineNodes = 0 def numberNodes = 0 for (agent in jenkins.getNodes()) { def computer = agent.computer numberNodes ++ println \"\" println \"Checking computer ${computer.name}:\" def isOK = (agentAccessible(computer) && !computer.offline) if (isOK) { println \"\\t\\tOK, got PATH back from slave ${computer.name}.\" println('\\tcomputer.isOffline: ' + slave.getComputer().isOffline()); println('\\tcomputer.isTemporarilyOffline: ' + slave.getComputer().isTemporarilyOffline()); println('\\tcomputer.getOfflineCause: ' + slave.getComputer().getOfflineCause()); println('\\tcomputer.offline: ' + computer.offline); } else { numberOfflineNodes ++ println \" ERROR: can't get PATH from agent ${computer.name}.\" println('\\tcomputer.isOffline: ' + agent.getComputer().isOffline()); println('\\tcomputer.isTemporarilyOffline: ' + agent.getComputer().isTemporarilyOffline()); println('\\tcomputer.getOfflineCause: ' + agent.getComputer().getOfflineCause()); println('\\tcomputer.offline: ' + computer.offline); sendMail(computer.name, agent.getComputer().getOfflineCause().toString()) if (agent.getComputer().isTemporarilyOffline()) { if (!agent.getComputer().getOfflineCause().toString().contains(\"Disconnected by\")) { computer.setTemporarilyOffline(false, agent.getComputer().getOfflineCause()) } } else { computer.connect(true) } } } println (\"Number of Offline Nodes: \" + numberOfflineNodes) println (\"Number of Nodes: \" + numberNodes) others run shell scripts in a cluster-operation def exec(cmd) { println cmd def process = new ProcessBuilder([ \"sh\", \"-c\", cmd]) .directory(new File(\"/tmp\")) .redirectErrorStream(true) .start() process.outputStream.close() process.inputStream.eachLine {println it} process.waitFor(); return process.exitValue() } [ \"echo hello world\", \"ls -al\" ].each { exec(it) } get all running thread Thread.getAllStackTraces().keySet().each() { println it.getName() } kill running thread or using t.stop() instead of t.interrupt() Thread.getAllStackTraces().keySet().each() { t -> if (t.getName()==\"YOUR THREAD NAME\" ) { t.interrupt(); } } Automate configuring via Jenkins Script Console import net.sf.json.JSONArray import net.sf.json.JSONObject import org.thoughtslive.jenkins.plugins.jira.JiraStepsConfig import org.thoughtslive.jenkins.plugins.jira.Site //global user-defined configuration JSONArray sitesConf = [ [ name: 'another', url: 'http://example.com', timeout: 10000, readTimeout: 10000, loginType: 'BASIC', userName: 'foo', password: 'some pass' ], [ name: 'moar jira', url: 'http://example.com', timeout: 10000, readTimeout: 10000, loginType: 'OAUTH', consumerKey: 'my consumer key', privateKey: 'my private key', secret: 'super secret', token: 'my token' ] ] as JSONArray //get global Jenkins configuration JiraStepsConfig.ConfigDescriptorImpl config = Jenkins.instance.getExtensionList(JiraStepsConfig.ConfigDescriptorImpl.class)[0] ArrayList sites = new ArrayList() //configure new sites from the above JSONArray sitesConf.each { s -> String loginType = s.optString('loginType', '').toUpperCase() if(loginType in ['BASIC', 'OAUTH']) { Site site = new Site(s.optString('name',''), new URL(s.optString('url', '')), s.optString('loginType', ''), s.optInt('timeout', 10000)) if(loginType == 'BASIC') { site.setUserName(s.optString('userName', '')) site.setPassword(s.optString('password', '')) site.setReadTimeout(s.optInt('readTimeout', 10000)) } else { //loginType is OAUTH site.setConsumerKey(s.optString('consumerKey', '')) site.setPrivateKey(s.optString('privateKey', '')) site.setSecret(s.optString('secret', '')) site.setToken(s.optString('token', '')) site.setReadTimeout(s.optInt('readTimeout', 10000)) } sites.add(site) } } //set our defined sites config.setSites(sites.toArray(new Site[0])) //persist configuration to disk as XML config.save() or via Configuration as Code pluginunclassified: jiraStepsConfig: sites: - name: 'another' url: 'http://example.com' timeout: 10000 readTimeout: 10000 loginType: 'BASIC' userName: 'foo' password: 'some pass' - name: 'moar jira' url: 'http://example.com' timeout: 10000 readTimeout: 10000 loginType: 'OAUTH' consumerKey: 'my consumer key' privateKey: 'my private key' secret: 'super secret' token: 'my token' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:33 "},"jenkins/plugins/plugins.html":{"url":"jenkins/plugins/plugins.html","title":"plugins","keywords":"","body":" Table of Contents generated with DocToc plugins recommended plugins optinal reference: plugin index Pipeline Syntax Pipeline Best Practices plugins recommended plugins Artifactory Git plugin Gerrit Code Review plugin Gerrit Trigger Kubernetes Docker Commons Plugin Pipeline Pipeline Utility Steps Step reference Pipeline Steps Reference Blue Ocean Copy Artifact JUnit Plugin Build Trigger Badge Plugin Groovy Postbuild Active Choices Plug-in AnsiColor Build Timestamp Plugin Docker Pipeline Email Extension Environment Injector Plugin Green Balls Job Configuration History Plugin Lockable Resources plugin Matrix Authorization Strategy Plugin Monitoring Rebuilder ThinBackup Sectioned View Parameterized Scheduler Metrics Validating String Parameter Strict Crumb Issuer Plugin due to SECURITY-626 optinal JobFanIn Pipeline Aggregator Active Directory plugin Delivery Pipeline Plugin Log Parser Plugin Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:32 "},"jenkins/plugins/kubernetes.html":{"url":"jenkins/plugins/kubernetes.html","title":"kubernetes","keywords":"","body":" Table of Contents generated with DocToc namespace generate credentials for pfx full steps configure in jenkins using kubeconfig for remote cluster credential using ClusterRoleBinding Q&A references: Jenkins Kubernetes Plugin: Running Agents In Other Clusters Jenkins Kubernetes Plugin: Using the plugin in your pipelines Create Kubernetes Service Accounts and Kubeconfigs Setup Jenkins Pipeline and Blue Ocean in Kubernetes namespace namespace $ cat quota $ cat generate credentials for pfx ca.crt $ grep certificate-authority-data ~/.kube/config | awk -F': ' '{print $NF}' | base64 -d > ca.crt # OR $ sudo cat /etc/kubernetes/pki/ca.crt client.crt & client.key $ grep client-certificate-data ~/.kube/config | awk -F': ' '{print $NF}' | base64 -d > client.crt $ grep client-key-data ~/.kube/config | awk -F': ' '{print $NF}' | base64 -d > client.key cert.pfx $ openssl pkcs12 -export -out cert.pfx -inkey client.key -in client.crt -certfile ca.crt Enter Export Password: Verifying - Enter Export Password: $ ls ca.crt cert.pfx client.crt client.key # or # using password 'marslo' $ openssl pkcs12 -export -out cert.pfx -inkey client.key -in client.crt -certfile ca.crt -password pass:marslo full steps $ cat ~/.kube/config \\ | grep certificate-authority-data \\ | awk '{print $2}' \\ | base64 -d > ca.crt $ cat ~/.kube/config \\ | grep client-certificate-data \\ | awk '{print $2}' \\ | base64 -d > client.crt $ cat ~/.kube/config \\ | grep client-key-data \\ | awk '{print $2}' \\ | base64 -d > client.key $ openssl pkcs12 -export \\ -out cert.pfx \\ -in client.crt \\ -inkey client.key \\ -certfile ca.crt \\ -password pass:devops configure in jenkins Go to Manage Jenkins -> Configure System or Manage Jenkins -> Manage Nodes and Clouds -> Configure Clouds Add a new Cloud -> Kuberentes Name: Kubernetes URL: get from $ kubectl cluster-info using https://kubernetes.default.svc.cluster.local Kubernetes server certificate key: content of ca.crt. ($ cat ca.crt) Credentials: Add -> Jenkins Kind: Certificate Setup in Jenkins using kubeconfig for remote cluster credential reference: jenkinsci/kubernetes-cli-plugin Kubernetes Plugin: Authenticate with a ServiceAccount to a remote cluster Creating a kubeconfig file for a self-hosted Kubernetes cluster How to find your Jenkins admin password on Kubernetes get Kubernetes URL $ k config view --minify | sed -n -re 's/^.*server: (https.*)$/\\1/p' or$ k config view --minify --raw --output 'jsonpath={..cluster.server}' generate CA the content can be also found in kubernetes-master:/etc/kubernetes/pki/ca.crt $ k -n jenkins get secret \\ $(k -n jenkins get sa jenkins-admin -o jsonpath={.secrets[0].name}) \\ -o jsonpath={.data.'ca\\.crt'} \\ | base64 --decode or$ cat ~/.kube/config \\ | grep certificate-authority-data \\ | awk '{print $2}' \\ | base64 -d > ca.crt Generate token in kubernetes $ namespace='devops' $ serviceAccount='jenkins-admin' $ alias k='kubectl' setup sa$ k -n jenkins create sa jenkins-admin $ k -n jenkins create rolebinding jenkins-admin-binding \\ --clusterrole=cluster-admin \\ --serviceaccount=devops:jenkins-admin get token $ k -n jenkins \\ get sa jenkins-admin \\ -o go-template \\ --template='{{range .secrets}}{{.name}}{{\"\\n\"}}{{end}}' jenkins-admin-token-kshsh $ k -n jenkins \\ get secrets jenkins-admin-token-kshsh \\ -o go-template \\ --template '{{index .data \"token\"}}' \\ | base64 -d eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.*** more info $ k get secret -n jenkins NAME TYPE DATA AGE default-token-8k7vj kubernetes.io/service-account-token 3 27m jenkins-admin-token-9r8pt kubernetes.io/service-account-token 3 21m $ k -n jenkins get rolebinding NAME AGE jenkins-admin-binding 15m $ k -n jenkins describe rolebinding jenkins-admin-binding Name: jenkins-admin-binding Labels: Annotations: Role: Kind: ClusterRole Name: cluster-admin Subjects: Kind Name Namespace ---- ---- --------- ServiceAccount jenkins-admin jenkins $ k describe clusterrolebindings jenkins-admin-cluster-binding Name: jenkins-admin-cluster-binding Labels: Annotations: Role: Kind: ClusterRole Name: cluster-admin Subjects: Kind Name Namespace ---- ---- --------- ServiceAccount jenkins-admin jenkins or$ k -n jenkins \\ get secret \\ $(k -n jenkins get sa jenkins-admin -o jsonpath={.secrets[0].name}) \\ -o jsonpath={.data.token} \\ | base64 --decode or $ k -n jenkins \\ get sa jenkins-admin \\ --template='{{range .secrets}}{{ .name }} {{end}}' \\ | xargs -n 1 k -n jenkins get secret \\ --template='{{ if .data.token }}{{ .data.token }}{{end}}' \\ | head -n 1 \\ | base64 -d - setup in Jenkins credential setup cloud setup using ClusterRoleBinding references: Configure Service Accounts for Pods RoleBinding and ClusterRoleBinding Role and ClusterRole Jenkins minimal installation on Kubernetes [!TIP] simplely it can be executed via commands: $ kubectl -n kube-system create sa $ kubectl create clusterrolebinding --clusterrole cluster-admin --serviceaccount=: [!NOTE]: can be the same as --- apiVersion: v1 kind: ServiceAccount metadata: labels: k8s-app: jenkins name: jenkins-admin namespace: jenkins --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: jenkins-admin labels: k8s-app: jenkins roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: jenkins-admin namespace: jenkins using RoleBinding --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: Role metadata: name: jenkins-admin namespace: jenkins rules: - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/exec\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/log\"] verbs: [\"get\",\"list\",\"watch\"] --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: RoleBinding metadata: name: jenkins-admin namespace: jenkins roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: jenkins-admin subjects: - kind: ServiceAccount name: jenkins-admin or grant more permissions via RoleBinding apiVersion: v1 kind: ServiceAccount metadata: name: jenkins namespace: devops --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1beta1 metadata: name: jenkins rules: - apiGroups: [\"extensions\", \"apps\"] resources: [\"deployments\"] verbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"] - apiGroups: [\"\"] resources: [\"services\"] verbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"] - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/exec\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/log\"] verbs: [\"get\",\"list\",\"watch\"] - apiGroups: [\"\"] resources: [\"secrets\"] verbs: [\"get\"] --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: jenkins namespace: devops roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: jenkins subjects: - kind: ServiceAccount name: jenkins namespace: devops or get all permission via RoleBinding # spinnaker-role-and-rolebinding-target.yml --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: spinnaker-role namespace: target # Should be namespace you are granting access to rules: - apiGroups: [\"*\"] resources: [\"*\"] verbs: [\"*\"] --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: spinnaker-rolebinding namespace: target # Should be namespace you are granting access to roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: spinnaker-role # Should match name of Role subjects: - namespace: source # Should match namespace where SA lives kind: ServiceAccount name: spinnaker-service-account # Should match service account name, above Q&A Kubernetes agents are failing with SocketTimeoutException: connect timed out Message: pods is forbidden: User \"system:serviceaccount:jenkins:jenkins-admin\" cannot list resource \"pods\" in API group solution: lachie83/jenkins-service-account see also chukaofili/k8s-dashboard-admin-user.yaml $ k -n create rolebinding -binding \\ --clusterrole=cluster-admin \\ --serviceaccount=: $ k create clusterrolebinding jenkins-admin-cluster-binding \\ --clusterrole cluster-admin \\ --serviceaccount=:jenkins-admin thinking $ k -n jenkins auth can-i list pods --as jenkins-admin no $ k -n jenkins auth can-i list pods --as jenkins-admin-binding no $ k -n jenkins auth can-i list pods --as jenkins-admin-cluster-binding no Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:32 "},"jenkins/plugins/lockable-resource.html":{"url":"jenkins/plugins/lockable-resource.html","title":"lockable-resource","keywords":"","body":" Table of Contents generated with DocToc get info get all Get resource by label if label validated Get free number of label Get all resource management remove by label (or name) create new item pickup qualified available resources randomly change label by certain condition reserve & unlock by cli by api examples functions isLabelExists isResourceExists get label by name set Label with Closure get resource status removeLabelByName reference: org.jenkins.plugins.lockableresources.LockableResource javadoc index-all configure-lockable-resources.groovy collect-resources-data-for-graphite.groovy LockableResourcesHelper.groovy lockable_resources_from_json.groovy list_lockable_resources.groovy JenkinsJobDslCleanupLockableResources.groovy JenkinsScriptedPipelineCleanupLockableResources.groovy jenkins-remove-lockable-resources.groovy get info get all all items information import org.jenkins.plugins.lockableresources.LockableResourcesManager LockableResourcesManager manager = new org.jenkins.plugins.lockableresources.LockableResourcesManager() // or LockableResourcesManager manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() manager.getResources().each{ r -> println \"\"\" ${r.name}: ${r.getClass()} locked? : ${r.locked} : ${r.isLocked()} reserved? : ${r.reserved} : ${r.isReserved()} label : ${r.labels} : ${r.getLabels()} description : ${r.description} : ${r.getDescription()} queue : ${r.queueItemProject ?: ''} reserved by : ${r.reservedBy ?: ''} build : ${r.build ?: ''} queuingStarted : ${r.queuingStarted ?: ''} queuedContexts : ${r.queuedContexts ?: ''} \"\"\" } labels import org.jenkins.plugins.lockableresources.LockableResourcesManager stage('all label') { println '~~> all labels:' println new LockableResourcesManager().getAllLabels() } resources import org.jenkins.plugins.lockableresources.LockableResourcesManager println new LockableResourcesManager().getResources() orprintln org.jenkins.plugins.lockableresources.LockableResourcesManager.get().getResources() Get resource by label import org.jenkins.plugins.lockableresources.LockableResourcesManager stage('get label') { String l = 'my-label' println \"~~> resources for ${l}:\" println new LockableResourcesManager().getResourcesWithLabel( l, null ) } orimport org.jenkins.plugins.lockableresources.LockableResourcesManager println new LockableResourcesManager().getResourcesWithLabel( l, [:] ) if label validated import org.jenkins.plugins.lockableresources.LockableResourcesManager stage('does label validated') { String l = 'my-label' println '~~> is ${l} valid:' println new LockableResourcesManager().isValidLabel(l) } Get free number of label import org.jenkins.plugins.lockableresources.LockableResourcesManager stage('number of free') { String l = 'my-label' println new LockableResourcesManager().getFreeResourceAmount(l) } Get all resource stage('get all resoruces') { def all_lockable_resources = GlobalConfiguration.all().get(org.jenkins.plugins.lockableresources.LockableResourcesManager.class).resources println \"~~> free resource for ${l}\" println all_lockable_resources // remove all_lockable_resources.removeAll { it.name.contains('somestr')} } management remove by label (or name) stage('remove') { def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() def resources = manager.getResources().findAll { // println it.locked ? \"${it} locked\" : \"${it.labels}\" ( !it.locked ) && ( it.name.equals('marslo') || it.labels.contains('marslo') || it.name.startsWith('marslo') ) } currentBuild.description = \"${resources.size()} locks\" resources.each { println \"Removing ${it.name} ~~> ${it.labels}\" manager.getResources().remove(it) } manager.save() } remove allString lockName = 'lock name' def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() manager.getResources().removeAll { r -> lockNames.contains(r.name) && !r.locked && !r.reserved } manager.save() create new item stage('create') { def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() def myr = manager.createResourceWithLabel('marslo', 'marslo-label') } or import org.jenkins.plugins.lockableresources.* stage('create') { LockableResourcesManager manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() String name = 'marslo' String label = 'marslo-label' manager.createResource( name ) manager.fromName(name).setLabels( label ) manager.fromName(name).setEphemeral( false ) manager.save() } pickup qualified available resources randomly reference: imarslo : a list contains a sublist or not setup test labels import org.jenkins.plugins.lockableresources.* LockableResourcesManager manager = org.jenkins .plugins .lockableresources .LockableResourcesManager .get() manager.createResourceWithLabel('marslo-test-1', 'windows,64bit,firefox') manager.createResourceWithLabel('marslo-test-2', 'CentOS,32bit,chrome') manager.createResourceWithLabel('marslo-test-3', 'RHEL,64bit,firefox') clean up environment import org.jenkins.plugins.lockableresources.* LockableResourcesManager manager = org.jenkins .plugins .lockableresources .LockableResourcesManager .get() (1..3).each { manager.resources.remove( manager.fromName(\"marslo-test-${it}\") ) } import org.jenkins.plugins.lockableresources.* LockableResourcesManager manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() List criteria = [ '64bit', 'firefox' ] List all = manager.resources.findAll { r -> !r.locked && !r.reserved && criteria.every{ c -> r.labels.split(',').collect{ it.toLowerCase() }.contains(c.toLowerCase()) } } Collections.shuffle(all) println (all?.first() ?: '') change label by certain condition Objective : add the keyword marslo_ as prefix of labels whose label isn't belongs to keyword list. prevent repeat to add : List keyword = [ 'project1', 'project2', 'keyword', 'marslo_' ] or r.setLabels( 'marslo_' + r.labels.split('marslo_').last() ) import org.jenkins.plugins.lockableresources.* LockableResourcesManager manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() List keyword = [ 'project1', 'project2', 'keyword' ] manager.getResources().findAll { r -> r.labels && ! keyword.any{ r.labels.toLowerCase().startsWith(it) } }.collect { r -> r.setLabels( 'marslo_' + r.labels.split('marslo_').last() ) } show resultprintln manager.resources.findAll { r -> r.labels && ! keyword.any{ r.labels.toLowerCase().startsWith(it) } } collect { [ (r.name), r.labels ] } reserve & unlock by cli $ resource='marslo' $ curl -XGET -uadmin:passwd https://my.jenkins.com/lockable-resources/reserve?resource=${resource} $ curl -XGET -uadmin:passwd https://my.jenkins.com/lockable-resources/unreserve?resource=${resource} by api stage('reserve & unlock') { def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() println manager.fromName('marslo')?.isReserved() println '~~> lock marslo:' manager.reserve([ manager.fromName('marslo') ], 'Marslo Jiao') println manager.fromName('marslo')?.isReserved() println '~~> unlock marslo:' manager.reset([ manager.fromName('marslo') ]) println manager.fromName('marslo')?.isReserved() } examples print \"START\\n\" def all_lockable_resources = org.jenkins.plugins.lockableresources.LockableResourcesManager.get().resources all_lockable_resources.each { r-> if ( r.isLocked() || r.isReserved() ) { println \"Lock \" + r + \" is locked or reserved by \" + r.getBuild() + \" BECARSE \" + r.getLockCause() b = r.getBuild() if ( b ) { if ( b.isBuilding() ) println ( \"build:\" + b + \" is building\" ) if ( b.getResult().equals(null) ) println ( \"build:\" + b + \" result is not in yet\" ) if ( ! b.isBuilding() && ! b.getResult().equals(null) ) { println \"build:\" + b + \" is not building and result is \" + b.getResult() + \" yet the lock \" + r + \" is locked.\" println \"ACTION RELEASE LOCK \" + r println \"getLockCause:\" + r.getLockCause() println \"getDescription:\" + r.getDescription() println \"getReservedBy:\" + r.getReservedBy() println \"isReserved:\" + r.isReserved() println \"isLocked:\" + r.isLocked() println \"isQueued:\" + r.isQueued() //release the lock r.reset() println \"getLockCause:\" + r.getLockCause() println \"getDescription:\" + r.getDescription() println \"getReservedBy:\" + r.getReservedBy() println \"isReserved:\" + r.isReserved() println \"isLocked:\" + r.isLocked() println \"isQueued:\" + r.isQueued() } } } } functions isLabelExists def isLabelExists( String label ) { org.jenkins.plugins .lockableresources .LockableResourcesManager .get() .getResources() .findAll{ it.labels == label } != [] } orwithManager{ manager -> manager .resources .findAll{ it.labels == label } != [] } isResourceExists def isResourceExists( String name ) { org.jenkins.plugins .lockableresources .LockableResourcesManager .get() .fromName(name) != null } ordef isResourceExists( String name ) { withManager{ manager -> manager.fromName(name) != null } } or using findAll for multiple finddef isResourceExists( String name ) { org.jenkins.plugins .lockableresources .LockableResourcesManager .get() .getResources() .findAll{ it.name == name } != [] } orwithManager{ manager -> manager.getResources() .findAll{ it.name == name } != [] } get label by name using fromName(String) def getLabelByName( String name ) { org.jenkins.plugins .lockableresources .LockableResourcesManager .get() .getResources() .fromName( name ) .getLabes() } ordef getLabelByName( String name ) { withManager{ manager -> manager.fromName( name )?.labels ?: '' } } using findAll multiple def getLabelByName( String name ) { org.jenkins.plugins .lockableresources .LockableResourcesManager .get() .getResources() .findAll{ it.name == name } .collect{ it.labels } .join(' ') } orwithManager{ manager -> manager.getResources() .findAll{ it.name == name } .collect{ it.labels } .join(' ') } set Label def setLabel( String name, String label, String trigger = '', Boolean force = false, String description = '' ) { LockableResourcesManager manager = LockableResourcesManager.get() description = ( description ? \"${description} | \" : '' ) + \"created automatically by @${trigger ?: 'jenkins'} via Jenkins job ${env.BUILD_URL}\" if ( isResourceExists(name) && !force ) { println( \"ERROR: resource ${name} has already tied to label: ${manager.fromName(name)?.labels}. Exit...\" ) } else { // manager.createResourceWithLabel( name, label ) // will ignore label re-add if resource exists if ( ! isResourceExists(name) ) manager.createResource( name ) manager.fromName(name).setLabels( label ) manager.fromName(name).setDescription( description ) manager.fromName(name).setEphemeral( false ) manager.save() if ( ! isResourceExists(name) ) println( \"ERROR: resource ${name} failed to be added in resource pool. Exit...\" ) } } with Closure import org.jenkins.plugins.lockableresources.LockableResourcesManager def withManager( Closure body ) { LockableResourcesManager manager = org.jenkins.plugins .lockableresources .LockableResourcesManager .get() body( manager ) } get resource status def getResourceLabelStatus( String name ) { Map status = [:] withManager { manager -> if ( isResourceExists(name) ) { LockableResource r = manager.fromName(name) status.'locked' = r.isLocked() status.'reserved' = r.isReserved() status.'lockedBy' = r.getBuild() ?: '' status.'reservedBy' = r.getReservedBy() ?: '' status.'lockedCause' = r.getLockCause() ?: '' } } return status } removeLabelByName /** * remove the label from resource pool if the label isn't reserved or locked * * @param name the agent name * @param force whether force remove the label or not * * @see org.jenkins.plugins.lockableresources.LockableResourcesManager * @see org.jenkins.plugins.lockableresources.LockableResource * @see {@link #withManager(Closure)} **/ def removeLabelByName( String name, Boolean force = false ) { withManager { manager -> if ( isResourceExists(name) ) { if ( force ) manager.fromName(name).reset() Map resource = getResourceLabelStatus( name ) if ( ! resource.getOrDefault('locked', true) && ! resource.getOrDefault('reserved', true) ) { if ( manager.resources.remove( manager.fromName(name) ) && !isResourceExists(name) ) { println ( \"INFO: resource ${name} has been successfully removed.\" ) } else { println ( \"WARN: resource ${name} failed to be removed. still tied to label: ${getLabelByName(name)}\" ) } } else { println ( \"WARN: resource ${name} ( label: ${getLabelByName(name)} ) cannot be removed due to \" + ( resource.locked ? \"locked by ${resource.lockedBy}\" : '' ) + ( resource.reserved ? \"reserved by ${resource.reservedBy}\" : '' ) } } else { println( \"WARN: resource ${name} doesn't exist in resrouce pool. Skip...\" ) println( \"Available resources are: ${manager.resources}\" ) } } // withManager } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:32 "},"jenkins/plugins/postbuild.html":{"url":"jenkins/plugins/postbuild.html","title":"postbuild","keywords":"","body":" Table of Contents generated with DocToc Groovy Postbuild Plugin setup badge Groovy Postbuild Plugin badge-plugin setup badge setup badge from another plugins manager.addBadge(\"/plugin/artifactory/images/artifactory-promote.png\", \"promoted\") how to find it badge images to generate the images String png = 'aborted accept attribute blue clipboard computer-x computer copy dark-grey disabled document empty error fingerprint folder-delete folder freestyleproject gear2 graph grey health-00to19 health-20to39 health-40to59 health-60to79 health-80plus help installer light-grey lock monitor network nobuilt notepad orange-square package plugin red redo refresh search secure setting star-gold star system-log-out terminal user warning yellow' png.split().each { manager.createSummary(\"${it}.png\").appendText(\"${it}.png\") } dark theme jenkins material theme Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:32 "},"jenkins/plugins/artifactory.html":{"url":"jenkins/plugins/artifactory.html","title":"artifactory","keywords":"","body":" Table of Contents generated with DocToc allow interactive promotion promotion allow interactive promotion /** * add interactive promotion options * * @param sourceRepo the copy-from repo name * @param targetRepo the copy-to repo name * @param server Artifactory.server 'server-id' * @param buildInfo the buildInfo of {@code server} **/ def addInteractivePromotion( String sourceRepo, String targetRepo, def server, def buildInfo ) { def promotionSpec = [ //Mandatory parameters 'buildName' : buildInfo.name, 'buildNumber' : buildInfo.number, 'targetRepo' : targetRepo, //Optional parameters 'sourceRepo' : sourceRepo, 'comment' : 'promotion with interactive mode', 'status' : 'Released', 'includeDependencies': true, 'failFast' : true, 'copy' : true ] Artifactory.addInteractivePromotion server: server, promotionConfig: promotionSpec, displayName: 'promote me' } example def publish( String promoteRepo ) { server = Artifactory.server SERVER_ID uploadSpec = readFile 'jenkins-examples/pipeline-examples/resources/props-upload.json' buildInfo = server.upload spec: uploadSpec server.publishBuildInfo buildInfo if( promoteRepo ) addInteractivePromotion( \"${promoteRepo}-local\", promoteRepo, server, buildInfo ) } or for downloaddef download( String promoteRepo ) { server = Artifactory.server SERVER_ID downloadSpec = readFile 'jenkins-examples/pipeline-examples/resources/props-download.json' server.download spec: downloadSpec, buildInfo: buildInfo server.publishBuildInfo buildInfo if( promoteRepo ) addInteractivePromotion( \"${promoteRepo}-local\", promoteRepo, server, buildInfo ) } promotion Delete jenkins builds during Promote / promotion step /*** BEGIN META { \"name\" : \"Bulk Delete Builds except the given build number\", \"comment\" : \"For a given job and a given build numnber, delete all builds of a given release version (M.m.interim) only and except the user provided one. Sometimes a Jenkins job use Build Name setter plugin and same job generates 2.75.0.1 and 2.76.0.43\", \"parameters\" : [ 'jobName', 'releaseVersion', 'buildNumber' ], \"core\": \"1.409\", \"authors\" : [ { name : \"Arun Sangal - Maddys Version\" } ] } END META **/ import groovy.json.* import jenkins.model.*; import hudson.model.Fingerprint.RangeSet; import hudson.model.Job; import hudson.model.Fingerprint; //these should be passed in as arguments to the script if(!artifactoryURL) throw new Exception(\"artifactoryURL not provided\") if(!artifactoryUser) throw new Exception(\"artifactoryUser not provided\") if(!artifactoryPassword) throw new Exception(\"artifactoryPassword not provided\") def authString = \"${artifactoryUser}:${artifactoryPassword}\".getBytes().encodeBase64().toString() def artifactorySettings = [artifactoryURL: artifactoryURL, authString: authString] if(!jobName) throw new Exception(\"jobName not provided\") if(!buildNumber) throw new Exception(\"buildNumber not provided\") def lastBuildNumber = buildNumber.toInteger() - 1; def nextBuildNumber = buildNumber.toInteger() + 1; def jij = jenkins.model.Jenkins.instance.getItem(jobName); def promotedBuildRange = new Fingerprint.RangeSet() promotedBuildRange.add(buildNumber.toInteger()) def promoteBuildsList = jij.getBuilds(promotedBuildRange) assert promoteBuildsList.size() == 1 def promotedBuild = promoteBuildsList[0] // The release / version of a Jenkins job - i.e. in case you use \"Build name\" setter plugin in Jenkins for getting builds like 2.75.0.1, 2.75.0.2, .. , 2.75.0.15 etc. // and over the time, change the release/version value (2.75.0) to a newer value i.e. 2.75.1 or 2.76.0 and start builds of this new release/version from #1 onwards. def releaseVersion = promotedBuild.getDisplayName().split(\"\\\\.\")[0..2].join(\".\") println \"\" println(\"- Jenkins Job_Name: ${jobName} -- Version: ${releaseVersion} -- Keep Build Number: ${buildNumber}\"); println \"\" /** delete the indicated build and its artifacts from artifactory */ def deleteBuildFromArtifactory(String jobName, int deleteBuildNumber, Map artifactorySettings){ println \" ## Deleting >>>>>>>>>: - ${jobName}:${deleteBuildNumber} from artifactory\" def artifactSearchUri = \"api/build/${jobName}?buildNumbers=${deleteBuildNumber}&artifacts=1\" def conn = \"${artifactorySettings['artifactoryURL']}/${artifactSearchUri}\".toURL().openConnection() conn.setRequestProperty(\"Authorization\", \"Basic \" + artifactorySettings['authString']); conn.setRequestMethod(\"DELETE\") if( conn.responseCode != 200 ) { println \"Failed to delete the build artifacts from artifactory for ${jobName}/${deleteBuildNumber}: ${conn.responseCode} - ${conn.responseMessage}\" } } /** delete all builds in the indicated range that match the releaseVersion */ def deleteBuildsInRange(String buildRange, String releaseVersion, Job theJob, Map artifactorySettings){ def range = RangeSet.fromString(buildRange, true); theJob.getBuilds(range).each { if ( it.getDisplayName().find(/${releaseVersion}.*/)) { println \" ## Deleting >>>>>>>>>: \" + it.getDisplayName(); deleteBuildFromArtifactory(theJob.name, it.number, artifactorySettings) it.delete(); } } } //delete all the matching builds before the promoted build number deleteBuildsInRange(\"1-${lastBuildNumber}\", releaseVersion, jij, artifactorySettings) //delete all the matching builds after the promoted build number deleteBuildsInRange(\"${nextBuildNumber}-${jij.nextBuildNumber}\", releaseVersion, jij, artifactorySettings) println \"\" println(\"- Builds have been successfully deleted for the above mentioned release: ${releaseVersion}\") println \"\" Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:33 "},"jenkins/plugins/jira-steps.html":{"url":"jenkins/plugins/jira-steps.html","title":"jira-steps","keywords":"","body":" Table of Contents generated with DocToc get field get issue get field import static groovy.json.JsonOutput.* def fields = jiraGetFields idOrKey: 'MYJIRA-1', site: 'jira' println prettyPrint( toJson( fields.data )) get issue def issue = jiraGetIssue idOrKey: 'MYJIRA-1', site: 'jira' println issue.data Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:33 "},"jenkins/plugins/ansicolor.html":{"url":"jenkins/plugins/ansicolor.html","title":"ansicolor","keywords":"","body":" Table of Contents generated with DocToc println 256 colors color matrix libs println 256 colors ansiColor('xterm') { node('master') { List matrix = [] List line = [] [38, 48].collect { fgbg -> (1..255).collect { color -> \"\"\"\\033[${fgbg};5;${color}m ${String.format(\"%03d\", color)} \\033[0m\"\"\" } }.flatten().eachWithIndex{ c, idx -> line += [c] if ( 4 == (idx+1)%12 ) { matrix.add( line ) line = [] } } println matrix.collect{ it.join(' ') }.join('\\n') }} or ansiColor('xterm') { node('master') { List matrix = [] List line = [] (0..7).collect{ attr -> [38, 48].collect { fgbg -> (0..255).collect { color -> \"\\033[${attr};${fgbg};5;${color}m\" + \"\"\" \\\\033[${attr};${fgbg};${String.format(\"%03d\", color)}m \"\"\" + \"\\033[0m\" } } }.flatten().eachWithIndex{ c, idx -> line += [c] if ( 4 == (idx+1)%6 ) { matrix.add( line ) line = [] } } println matrix.collect{ it.join(' ') }.join('\\n') }} color matrix libs import groovy.transform.Field /** * regular color * bold bold color * br high intensity (bright color) * it italic * on as background **/ @Field final Map COLOR_MATRIX = [ black : '\\033[0;38;5;0m' , red : '\\033[0;38;5;1m' , green : '\\033[0;38;5;2m' , yellow : '\\033[0;38;5;3m' , blue : '\\033[0;38;5;4m' , magenta : '\\033[0;38;5;5m' , cyan : '\\033[0;38;5;6m' , white : '\\033[0;38;5;7m' , gray : '\\033[0;38;5;8m' , lightGray : '\\033[0;38;5;244m' , orange : '\\033[0;38;5;208m' , brRed : '\\033[0;38;5;9m' , brGreen : '\\033[0;38;5;10m' , brYellow : '\\033[0;38;5;11m' , brBlue : '\\033[0;38;5;12m' , brMagenta : '\\033[0;38;5;13m' , brCyan : '\\033[0;38;5;14m' , brWhite : '\\033[0;38;5;15m' , onBlack : '\\033[0;48;5;0m' , onRed : '\\033[0;48;5;1m' , onGreen : '\\033[0;48;5;2m' , onYellow : '\\033[0;48;5;3m' , onBlue : '\\033[0;48;5;4m' , onMagenta : '\\033[0;48;5;5m' , onCyan : '\\033[0;48;5;6m' , onWhite : '\\033[0;48;5;7m' , onGray : '\\033[0;48;5;8m' , onLightGray : '\\033[0;48;5;244m' , onOrange : '\\033[0;48;5;208m' , boldBlack : '\\033[1;38;5;0m' , boldRed : '\\033[1;38;5;1m' , boldGreen : '\\033[1;38;5;2m' , boldYellow : '\\033[1;38;5;3m' , boldBlue : '\\033[1;38;5;4m' , boldMagenta : '\\033[1;38;5;5m' , boldCyan : '\\033[1;38;5;6m' , boldWhite : '\\033[1;38;5;7m' , boldGray : '\\033[1;38;5;8m' , itBlack : '\\033[3;38;5;0m' , itRed : '\\033[3;38;5;1m' , itGreen : '\\033[3;38;5;2m' , itYellow : '\\033[3;38;5;3m' , itBlue : '\\033[3;38;5;4m' , itMagenta : '\\033[3;38;5;5m' , itCyan : '\\033[3;38;5;6m' , itWhite : '\\033[3;38;5;7m' , itGray : '\\033[3;38;5;8m' , ESC : '\\033[0m' ] def show( String color, String str ) { if ( COLOR_MATRIX.containsKey(color) ) { println COLOR_MATRIX.get('red') + \"WARN: the color name: ${color} cannot be found in matrix\" + COLOR_MATRIX.get('ESC') } return COLOR_MATRIX.getOrDefault( color, 'black' ) + str + COLOR_MATRIX.get('ESC') } othersimport groovy.transform.Field @Field final Map COLOR_MATRIX = [ black : '\\u001B[30m' , red : '\\u001B[31m' , green : '\\u001B[32m' , yellow : '\\u001B[33m' , blue : '\\u001B[34m' , magenta : '\\u001B[35m' , cyan : '\\u001B[36m' , white : '\\u001B[37m' , brblack : '\\u001B[90m' , brred : '\\u001B[91m' , brgreen : '\\u001B[92m' , bryellow : '\\u001B[93m' , brblue : '\\u001B[94m' , brmagenta : '\\u001B[95m' , brcyan : '\\u001B[96m' , brwhite : '\\u001B[97m' , gray : '\\u001B[90m' , ESC : '\\u001B[0m' ] Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:32 "},"jenkins/plugins/simple-theme.html":{"url":"jenkins/plugins/simple-theme.html","title":"simple-theme","keywords":"","body":" Table of Contents generated with DocToc Q&A workaround for in-progress image float layer out page-header background color Q&A workaround for in-progress image float layer out svg[class*=anime] { visibility: collapse } page-header background color a.page-header__brand-link { background: #43a047 !important; color: white !important; font-size: large !important; } .page-header__brand-image { height: 3rem !important; width: 3rem !important; } Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:32 "},"jenkins/plugins/crumbIssuer.html":{"url":"jenkins/plugins/crumbIssuer.html","title":"crumbIssuer","keywords":"","body":" Table of Contents generated with DocToc enables proxy compatibility on startup Improved CSRF protection working with session after 2.176.2 since SECURITY-626 enables proxy compatibility on startup -Djenkins.model.Jenkins.crumbIssuerProxyCompatibility=true temporary settings in Script:System.setProperty('jenkins.model.Jenkins.crumbIssuerProxyCompatibility', 'true') System.getProperty('jenkins.model.Jenkins.crumbIssuerProxyCompatibility') change in Configure Global Security Improved CSRF protection Upgrading to Jenkins 2.176.2 SECURITY-626 CSRF / tokens (crumbs) are now only valid for the web session they were created in to limit the impact of attackers obtaining them. Scripts that obtain a crumb using the /crumbIssuer/api URL will now fail to perform actions protected from CSRF unless the scripts retain the web session ID in subsequent requests. CSRF Protection Explained Scripts could instead use an API token, which has not required a CSRF token (crumb) since Jenkins 2.96. working with session after 2.176.2 since SECURITY-626 references: via curl via wget via curl check cookie $ cat ${COOKIEJAR} # Netscape HTTP Cookie File # https://curl.se/docs/http-cookies.html # This file was generated by libcurl! Edit at your own risk. #HttpOnly_jenkins.marslo.com.com FALSE / TRUE 0 JSESSIONID.a054fd7a node015xsx4fybmo2k1oxpjg5f2dzw4265.node0 SERVER=\"http://localhost:8080\" # File where web session cookie is saved COOKIEJAR=\"$(mktemp)\" CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"$COOKIEJAR\" \\ \"$SERVER/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,%22:%22,//crumb)\" \\ ) curl -X POST \\ -u \"admin:admin\" \\ --cookie \"$COOKIEJAR\" \\ -H \"$CRUMB\" \\ \"$SERVER\"/job/someJob/build via wget SERVER=\"http://localhost:8080\" # File where web session cookie is saved COOKIEJAR=\"$(mktemp)\" CRUMB=\"$(wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ --save-cookies \"$COOKIEJAR\" \\ --keep-session-cookies \\ -q \\ --output-document \\ - \\ \"$SERVER/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,%22:%22,//crumb)\" )\" wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ --load-cookies \"$COOKIEJAR\" \\ --header=\"$CRUMB\" \\ --post-data=\"\" \\ -q \\ \"$SERVER\"/job/someJob/build example with crumb only will get issue 403: No valid crumb was included in the request $ curl -H ${crumb} \\ -X POST \\ https://jenkins.marslo.com/safeRestart Error 403 No valid crumb was included in the request HTTP ERROR 403 No valid crumb was included in the request URI:/safeRestart STATUS:403 MESSAGE:No valid crumb was included in the request SERVLET:Stapler Powered by Jetty:// 9.4.39.v20210325 with crumb and cookie $ COOKIEJAR=\"$(mktemp)\" $ CRUMB=\"$(curl -s \\ --cookie-jar \"${COOKIEJAR}\" \\ \"https://jenkins.marslo.com/crumbIssuer/api/json\" | jq -r '.crumbRequestField + \":\" + .crumb' )\" $ curl -v \\ -X POST \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ https://jenkins.marslo.com/safeRestart ... * Connection state changed (MAX_CONCURRENT_STREAMS == 250)! To disable this improvement you can set the system property via JAVA_OPTS -Dhudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID=true temporary settings in Script: example for SECURITY-626 System.setProperty('hudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID', 'true') System.getProperty('hudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID') via plugin Strict Crumb Issuer get crumberIssuer with script import org.jenkinsci.plugins.strictcrumbissuer.StrictCrumbIssuer StrictCrumbIssuer issuer = jenkins.model.Jenkins.instance.crumbIssuer String jenkinsCrumb = \"${issuer.crumbRequestField}:${issuer.crumb}\" println jenkinsCrumb Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:32 "},"virtualization/virtualization.html":{"url":"virtualization/virtualization.html","title":"virtualization","keywords":"","body":" Table of Contents generated with DocToc SSL Certificate Adding trusted root certificates to the server SSL Certificate Adding trusted root certificates to the server MacOS add $ sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/new-root-certificate.crt remove $ sudo security delete-certificate -c \"\" Ubuntu add $ cp ca.crt /usr/local/share/ca-certificates/ $ sudo cp foo.crt /usr/local/share/ca-certificates/foo.crt $ sudo update-ca-certificates remove $ sudo rm -rf /usr/local/share/ca-certificates/ca.crt $ sudo rm -rf /usr/local/share/ca-certificates/foo.crt $ sudo update-ca-certificates --fresh CentOS 6 add$ sudo yum install -y ca-certificates $ sudo update-ca-trust force-enable $ sudo cp foo.crt /etc/pki/ca-trust/source/anchors/ $ update-ca-trust extract CentOS 5 add$ cat foo.crt >>/etc/pki/tls/certs/ca-bundle.crt Windows add $ certutil -addstore -f \"ROOT\" new-root-certificate.crt remove $ certutil -delstore \"ROOT\" serial-number-hex Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:20 "},"virtualization/kubernetes/kubernetes.html":{"url":"virtualization/kubernetes/kubernetes.html","title":"kubernetes","keywords":"","body":" Table of Contents generated with DocToc explain kubectl alias secrets token tear down reference * Kubernetes 中文指南/云原生应用架构实战手册 KUBERNETES: AN OVERVIEW What Is Kubernetes: A Container Orchestration Platform KUBERNETES, OPEN-SOURCE CONTAINER ORCHESTRATION TECHNOLOGY Boosting your kubectl productivity 23 Advanced kubectl commands 8 Kubernetes Tips and Tricks Linux namespace简介 explain $ kubectl explain hpa KIND: HorizontalPodAutoscaler VERSION: autoscaling/v1 DESCRIPTION: configuration of a horizontal pod autoscaler. FIELDS: apiVersion ... or $ kubectl explain configmap KIND: ConfigMap VERSION: v1 DESCRIPTION: ConfigMap holds configuration data for pods to consume. FIELDS: apiVersion APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#resources ... kubectl alias __start_kubectl $ echo 'source > ~/.bashrc $ cat >> ~/.bashrc _complete_alias # download bash_completion.sh for kubectl $ curl -fsSL https://raw.githubusercontent.com/cykerway/complete-alias/master/bash_completion.sh > ~/.bash_completion.sh $ chmod +x !$ $ cat >> ~/.bashrc secrets create secrets by command $ kubectl create secret tls my-certs \\ --key .devops/certs/server.key \\ --cert .devops/certs/server.crt \\ -n ingress-nginx by yaml $ echo \"apiVersion: v1 kind: Secret type: kubernetes.io/tls metadata: name: mytest-cert namespace: ingress-nginx data: tls.crt: $(cat $HOME/.devops/certs/server.csr | base64 -w0) tls.key: $(cat $HOME/.devops/certs/server.key | base64 -w0)\" | k apply -f - duplicate secrets to the other ns reference: others Pro-Tip – Copying Kubernetes Secrets Between Namespaces $ k -n ingress-nginx get secrets my-certs -o yaml --export | k apply -n devops -f - token check token $ sudo kubeadm token list TOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPS bop765.brol9nsrw820gmbi authentication,signing system:bootstrappers:kubeadm:default-node-token khhfwa.jvkvrpiknx4o6ffy 19h 2018-07-13T11:37:43+08:00 authentication,signing system:bootstrappers:kubeadm:default-node-token generate token $ sudo kubeadm token create --print-join-command kubeadm join 192.168.1.100:6443 --token lhb1ln.oj0fqwgd1yl7l9xp --discovery-token-ca-cert-hash sha256:cba8df87dcb70c83c19af72c02e4886fcc7b0cf05319084751e6ece688443bde $ sudo kubeadm token create --print-join-command --ttl=0 kubeadm join 192.168.1.100:6443 --token bop765.brol9nsrw820gmbi --discovery-token-ca-cert-hash sha256:c8650c56faf72b8bf71c576f0d13f44c93bea2d21d4329c64bb97cba439af5c3 tear down [!TIP] How to completely uninstall kubernetes ubuntu $ kubectl drain --delete-local-data --force --ignore-daemonsets $ kubectl delete node $ sudo kubeadm reset [preflight] Running pre-flight checks. [reset] Stopping the kubelet service. [reset] Unmounting mounted directories in \"/var/lib/kubelet\" [reset] Removing kubernetes-managed containers. [reset] Deleting contents of stateful directories: [/var/lib/kubelet /etc/cni/net.d /var/lib/dockershim /var/run/kubernetes /var/lib/etcd] [reset] Deleting contents of config directories: [/etc/kubernetes/manifests /etc/kubernetes/pki] [reset] Deleting files: [/etc/kubernetes/admin.conf /etc/kubernetes/kubelet.conf /etc/kubernetes/bootstrap-kubelet.conf /etc/kubernetes/controller-manager.conf /etc/kubernetes/scheduler.conf] $ systemctl stop kubelet $ docker system prune -a -f $ systemctl stop docker $ sudo rm -rf /etc/kubernetes/ $ sudo rm -rf /var/lib/cni/ $ sudo rm -rf /var/lib/kubelet/* $ sudo rm -rf /etc/cni/ $ sudo ifconfig cni0 down $ sudo ifconfig flannel.1 down $ rm -rf ~/.kube/ $ sudo apt purge kubeadm kubectl kubelet kubernetes-cni kube* $ sudo apt autoremove CentOS/RHEL $ kubectl drain --delete-local-data --force --ignore-daemonsets $ kubectl delete node $ sudo kubeadm reset $ docker system prune -a -f $ systemctl stop kubelet $ systemctl disable kubelet $ systemctl stop docker $ systemctl disable docker $ sudo ifconfig cni0 down $ sudo ifconfig flannel.1 down $ sudo ifconfig docker0 down $ sudo yum versionlock delete docker-ce $ sudo yum versionlock delete docker-ce-cli $ sudo yum versionlock delete kubeadm $ sudo yum versionlock delete kubelet $ sudo yum versionlock delete kubectl $ sudo yum versionlock delete kubernetes-cni $ sudo yum remove -y docker-ce docker-ce-cli containerd.io kubectl kubeadm kubelet kubernetes-cni $ sudo yum autormeove $ rm -rf /home/devops/.kube/ $ sudo rm -rf /etc/cni $ sudo rm -rf /etc/kubernetes/ $ sudo rm -rf /etc/docker/ $ sudo rm -rf /etc/systemd/system/multi-user.target.wants/kubelet.service $ sudo rm -rf /etc/systemd/system/multi-user.target.wants/docker.service $ sudo rm -rf /usr/lib/systemd/system/docker.service $ sudo rm -rf /usr/lib/systemd/system/kubelet.service.d/ $ sudo rm -rf /usr/libexec/docker/ $ sudo rm -rf /usr/libexec/kubernetes/ $ sudo rm -rf /var/lib/etcd/ # optional $ sudo rm -rf /var/lib/kubelet/ $ sudo rm -rf /var/lib/dockershim/ $ sudo rm -rf /var/lib/yum/repos/x86_64/7/kubernetes/ $ sudo rm -rf /var/log/pods/ $ sudo rm -rf /var/log/containers/ $ sudo rm -rf /var/run/docker.sock $ sudo rm -rf /var/cache/yum/x86_64/7/kubernetes $ sudo yum clean all $ sudo rm -rf /var/cache/yum $ sudo yum makecache Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:20 "},"virtualization/kubernetes/kubeadm/kubeadm.html":{"url":"virtualization/kubernetes/kubeadm/kubeadm.html","title":"kubeadm","keywords":"","body":" Table of Contents generated with DocToc basic environment Ubuntu CentOS/RHEL tricky show default KubeletConfiguration show defualt kubeadm config kubeadm join reference basic environment Ubuntu basic $ sudo apt install -y apt-transport-https ca-certificates curl software-properties-common $ sudo usermod -a -G root \"$(whoami)\" $ sudo usermod -a -G adm \"$(whoami)\" $ sudo usermod -a -G sudo \"$(whoami)\" $ [ -f /etc/sysctl.conf ] && sudo mv /etc/sysctl.conf{,.bak.${TIMESTAMPE}} $ sudo bash -c \"cat >> /etc/sysctl.conf\" repo sources $ cat /etc/apt/sources.list deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful main restricted deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful-updates main restricted deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful universe deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful-updates universe deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful multiverse deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful-updates multiverse deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful-backports main restricted universe multiverse deb http://www.artifactory.mycompany.com/artifactory/debian-remote-canonical artful partner deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu-security artful-security main restricted deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu-security artful-security universe deb http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu-security artful-security multiverse $ cat sources.list.d/kubernetes.list deb http://www.artifactory.mycompany.com/artifactory/debian-remote-google kubernetes-xenial main $ cat sources.list.d/docker.list deb [arch=amd64] http://www.artifactory.mycompany.com/artifactory/debian-remote-docker artful edge # deb [arch=amd64] https://download.docker.com/linux/ubuntu artful edge package Search $ apt-cache search kub ... kubeadm - Kubernetes Cluster Bootstrapping Tool kubectl - Kubernetes Command Line Tool kubelet - Kubernetes Node Agent kubernetes-cni - Kubernetes CNI installation $ sudo apt install kubeadm=1.10.0-00 -y # or $ sudo apt install kubeadm=1.10.0-00 kubectl=1.10.0-00 kubelet=1.10.0-00 -y # or $ sudo apt install kubeadm -y Reading package lists... Done Building dependency tree Reading state information... Done The following additional packages will be installed: ebtables ethtool kubectl kubelet kubernetes-cni socat The following NEW packages will be installed: ebtables ethtool kubeadm kubectl kubelet kubernetes-cni socat 0 upgraded, 7 newly installed, 0 to remove and 0 not upgraded. Need to get 57.1 MB of archives. After this operation, 411 MB of additional disk space will be used. Get:1 http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful/main amd64 ebtables amd64 2.0.10.4-3.5ubuntu2 [80.0 kB] Get:2 http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful/main amd64 ethtool amd64 1:4.8-1 [109 kB] Get:3 http://www.artifactory.mycompany.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubernetes-cni amd64 0.6.0-00 [5,910 kB] Get:4 http://www.artifactory.mycompany.com/artifactory/debian-remote-ubuntu artful/universe amd64 socat amd64 1.7.3.2-1 [342 kB] Get:5 http://www.artifactory.mycompany.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubelet amd64 1.10.0-00 [21.1 MB] Get:6 http://www.artifactory.mycompany.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubectl amd64 1.10.0-00 [8,905 kB] Get:7 http://www.artifactory.mycompany.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubeadm amd64 1.10.0-00 [20.7 MB] Fetched 57.1 MB in 1min 22s (697 kB/s) Selecting previously unselected package ebtables. (Reading database ... 195476 files and directories currently installed.) Preparing to unpack .../0-ebtables_2.0.10.4-3.5ubuntu2_amd64.deb ... Unpacking ebtables (2.0.10.4-3.5ubuntu2) ... Selecting previously unselected package ethtool. Preparing to unpack .../1-ethtool_1%3a4.8-1_amd64.deb ... Unpacking ethtool (1:4.8-1) ... Selecting previously unselected package kubernetes-cni. Preparing to unpack .../2-kubernetes-cni_0.6.0-00_amd64.deb ... Unpacking kubernetes-cni (0.6.0-00) ... Selecting previously unselected package socat. Preparing to unpack .../3-socat_1.7.3.2-1_amd64.deb ... Unpacking socat (1.7.3.2-1) ... Selecting previously unselected package kubelet. Preparing to unpack .../4-kubelet_1.10.0-00_amd64.deb ... Unpacking kubelet (1.10.0-00) ... Selecting previously unselected package kubectl. Preparing to unpack .../5-kubectl_1.10.0-00_amd64.deb ... Unpacking kubectl (1.10.0-00) ... Selecting previously unselected package kubeadm. Preparing to unpack .../6-kubeadm_1.10.0-00_amd64.deb ... Unpacking kubeadm (1.10.0-00) ... Setting up kubernetes-cni (0.6.0-00) ... Processing triggers for ureadahead (0.100.0-20) ... Setting up socat (1.7.3.2-1) ... Processing triggers for doc-base (0.10.7) ... Processing 1 added doc-base file... Processing triggers for systemd (234-2ubuntu12.3) ... Setting up ebtables (2.0.10.4-3.5ubuntu2) ... Created symlink /etc/systemd/system/multi-user.target.wants/ebtables.service → /lib/systemd/system/ebtables.service. update-rc.d: warning: start and stop actions are no longer supported; falling back to defaults Setting up kubectl (1.10.0-00) ... Processing triggers for man-db (2.7.6.1-2) ... Setting up ethtool (1:4.8-1) ... Setting up kubelet (1.10.0-00) ... Created symlink /etc/systemd/system/multi-user.target.wants/kubelet.service → /lib/systemd/system/kubelet.service. Setting up kubeadm (1.10.0-00) ... Processing triggers for systemd (234-2ubuntu12.3) ... Processing triggers for ureadahead (0.100.0-20) ... hold the automatic upgrade $ sudo apt-mark hold kubeadm $ sudo apt-mark hold kubelet $ sudo apt-mark hold kubectl # check $ dpkg -l | grep ^h # or $ apt-mark showhold CentOS/RHEL basic environment $ sudo systemctl stop firewalld $ sudo systemctl disable firewalld $ sudo systemctl mask firewalld $ sudo systemctl is-enabled firewalld $ sudo systemctl is-active firewalld $ sudo firewall-cmd --state $ sudo bash -c \"sed -e 's:^\\\\(.*swap.*\\\\)$:# \\\\1:' -i /etc/fstab\" $ sudo swapoff -a $ sudo setenforce 0 $ sudo bash -c \"sed 's/^SELINUX=enforcing$/SELINUX=permissive/' -i /etc/selinux/config\" $ sudo bash -c \"sed -e 's:^\\\\(.*swap.*\\\\)$:# \\\\1:' -i /etc/fstab\" $ sudo modprobe br_netfilter $ sudo sysctl net.bridge.bridge-nf-call-iptables=1 $ sudo sysctl net.bridge.bridge-nf-call-ip6tables=1 $ sudo bash -c \"cat > /etc/sysctl.d/k8s.conf\" installation $ sudo bash -c 'cat > /etc/yum.repos.d/kubernetes.repo' > /etc/bashrc\" $ sudo usermod -a -G root,admheel,docker $(whoami) $ sudo systemctl enable --now docker $ sudo systemctl enable --now kubelet version lock$ sudo yum versionlock docker-ce $ sudo yum versionlock docker-ce-cli $ sudo yum versionlock kubeadm $ sudo yum versionlock kubelet $ sudo yum versionlock kubectl $ sudo yum versionlock kubernetes-cni $ sudo yum versionlock list tricky show default KubeletConfiguration $ sudo kubeadm config print init-defaults --component-configs KubeletConfiguration $ sudo kubeadm config print init-defaults --component-configs KubeProxyConfiguration # v1.12.3 $ sudo kubeadm config print-default $ sudo kubeadm config print-defaults $ sudo kubeadm config print-defaults --api-objects [apis] [apis] Available values: [ InitConfiguration ClusterConfiguration JoinConfiguration KubeProxyConfiguration KubeletConfiguration MasterConfiguration ] show defualt kubeadm config $ sudo kubeadm config view kubeadm join [!TIP] reference: kubeadm join normal commands $ sudo kubeadm token create --print-join-command # or $ sudo kubeadm token create --print-join-command --ttl=0 # list $ sudo kubeadm token list Token-based discovery with CA pinning $ openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //' for worker nodes$ kubeadm join --discovery-token abcdef.1234567890abcdef --discovery-token-ca-cert-hash sha256:1234..cdef 1.2.3.4:6443 for control-plane nodes$ kubeadm join --discovery-token abcdef.1234567890abcdef --discovery-token-ca-cert-hash sha256:1234..cdef --control-plane 1.2.3.4:6443 reference * Bootstrapping clusters with kubeadm * 使用 kubeadm 创建集群 cURLing the Kubernetes API server Troubleshooting kubeadm Kubernetes Recovery from Master Failure with Kubeadm 1 - Kubernetes Objects 2 - Kubernetes Pods 3 - Kubernetes Services and Ingress 4 - Kubernetes Storage Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:22 "},"virtualization/kubernetes/kubeadm/init.html":{"url":"virtualization/kubernetes/kubeadm/init.html","title":"init","keywords":"","body":" Table of Contents generated with DocToc HA Cluster basic environment cfssl etcd keepalive extend etcd configuration ca and client certs peer enable etcd service HAProxy kubeadm init kubeadm-conf.yaml init master sync PKI references Set up a High Availability etcd Cluster with kubeadm HA Cluster [!TIP] # hostname master01Name='master01' master02Name='master02' master03Name='master03' # ipaddress master01IP='192.168.100.200' master01IP='192.168.100.201' master01IP='192.168.100.202' virtualIP='192.168.100.250' leadIP=\"${master01IP}\" leadName=\"${master01Name}\" k8sVer='v1.15.3' cfsslDownloadUrl='https://pkg.cfssl.org/R1.2' etcdVer='v3.3.15' etcdDownloadUrl='https://github.com/etcd-io/etcd/releases/download' etcdSSLPath='/etc/etcd/ssl' etcdInitialCluster=\"${master01Name}=https://${master01IP}:2380,${master02Name}=https://${master02IP}:2380,${master03Name}=https://${master03IP}:2380\" keepaliveVer='2.0.18' haproxyVer='2.0.6' helmVer='v2.14.3' interface=$(netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}') ipAddr=$(ip a s \"${interface}\" | sed -rn 's|\\W*inet[^6]\\W*([0-9\\.]{7,15}).*$|\\1|p') peerName=$(hostname) basic environment cfssl $ sudo bash -c \"curl -o /usr/local/bin/cfssl ${cfsslDownloadUrl}/cfssl_linux-amd64\" $ sudo bash -c \"curl -o /usr/local/bin/cfssljson ${cfsslDownloadUrl}/cfssljson_linux-amd64\" $ sudo chmod +x /usr/local/bin/cfssl* etcd $ curl -sSL ${etcdDownloadUrl}/${etcdVer}/etcd-${etcdVer}-linux-amd64.tar.gz | sudo tar -xzv --strip-components=1 -C /usr/local/bin/ keepalive $ mkdir -p ~/temp $ sudo mkdir -p /etc/keepalived/ $ curl -fsSL ${keepaliveDownloadUrl}/keepalived-${keepaliveVer}.tar.gz | tar xzf - -C ~/temp $ cd ~/temp/keepalived-${keepaliveVer} $ ./configure && make $ sudo make install $ sudo cp keepalived/keepalived.service /etc/systemd/system/ $ sudo bash -c 'cat > /etc/keepalived/keepalived.conf' /etc/keepalived/check_apiserver.sh' &2 exit 1 } curl --silent --max-time 2 --insecure https://localhost:6443/ -o /dev/null || errorExit \"Error GET https://localhost:6443/\" if ip addr | grep -q ${virtualIpAddr}; then curl --silent --max-time 2 --insecure https://${virtualIpAddr}:6443/ -o /dev/null || errorExit \"Error GET https://${virtualIpAddr}:6443/\" fi EOF $ sudo systemctl enable keepalived.service $ sudo systemctl start keepalived.service extend etcd prepare$ sudo mkdir -p ${etcdSSLPath} $ cd ${etcdSSLPath} [!TIP] setup certificate in major master FILE DESCRIPTION ca.csr The signing request that the Root will sign ca.pem The unsigned intermediate so it’s useless, you can discard this one ca-key.pem The private key for your CA, do not lose this or share it configuration generate the default json file: $ cfssl print-defaults config > ca-config.json $ cfssl print-defaults csr > ca-csr.json ca-config.json master01 $ sudo bash -c 'cat > ${etcdSSLPath}/ca-config.json' CA master01 $ sudo bash -c 'cat > ${etcdSSLPath}/ca-csr.json' client master01 $ sudo bash -c 'cat > ${etcdSSLPath}/client.json' ca and client certs $ cd ${etcdSSLPath} # ca $ sudo /usr/local/bin/cfssl gencert \\ -initca ca-csr.json | sudo /usr/local/bin/cfssljson -bare ca - # client $ sudo /usr/local/bin/cfssl gencert \\ -ca=ca.pem \\ -ca-key=ca-key.pem \\ -config=ca-config.json \\ -profile=client client.json | sudo /usr/local/bin/cfssljson -bare client result master01 $ ls ca-config.json ca.csr ca-csr.json ca-key.pem ca.pem ... master01 $ ls ca-config.json ca.csr ca-csr.json ca-key.pem ca.pem client.csr client.json client-key.pem client.pem check expired time $ openssl x509 -in ca.pem -text -noout | grep -w Not Not Before: Sep 10 10:44:00 2019 GMT Not After : Sep 8 10:44:00 2024 GMT verify$ ls /etc/etcd/ssl/*.pem | grep -Ev 'key.pem$' | xargs -L 1 -t -i bash -c 'openssl verify -CAfile ca.pem {}' bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/ca.pem /etc/etcd/ssl/ca.pem: OK bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/client.pem /etc/etcd/ssl/client.pem: OK bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/peer.pem /etc/etcd/ssl/peer.pem: OK bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/server.pem /etc/etcd/ssl/server.pem: OK copy certs [!TIP] copy ected certificates to following masters # running in major master $ for i in {2..3}; do ssh master0${i} 'sudo mkdir -p ${etcdSSLPath}' for pkg in ca-config.json ca-key.pem ca.pem client-key.pem client.pem; do rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ ${etcdSSLPath}/${pkg} \\ master0${i}:${etcdSSLPath}/ done done # or running in following master one by one $ for pkg in ca-config.json ca-key.pem ca.pem client-key.pem client.pem; do sudo rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ root@${leadHost}:${etcdSSLPath}/${pkg} \\ ${etcdSSLPath}/ done peer [!TIP] running in all masters $ sudo bash -c \"/usr/local/bin/cfssl print-defaults csr > ${etcdSSLPath}/config.json\" $ sudo sed -i '0,/CN/{s/example\\.net/'\"${peerName}\"'/}' ${etcdSSLPath}/config.json $ sudo sed -i 's/www\\.example\\.net/'\"${ipAddr}\"'/' ${etcdSSLPath}/config.json $ sudo sed -i 's/example\\.net/'\"${peerName}\"'/' ${etcdSSLPath}/config.json $ cd ${etcdSSLPath}/ $ ls ca-config.json ca-csr.json ca.pem client.json client.pem ca.csr ca-key.pem client.csr client-key.pem config.json $ sudo /usr/local/bin/cfssl gencert \\ -ca=ca.pem \\ -ca-key=ca-key.pem \\ -config=ca-config.json \\ -profile=server config.json | sudo /usr/local/bin/cfssljson -bare server $ sudo /usr/local/bin/cfssl gencert \\ -ca=ca.pem \\ -ca-key=ca-key.pem \\ -config=ca-config.json \\ -profile=peer config.json | sudo /usr/local/bin/cfssljson -bare peer # in following masters $ ls ca-config.json ca.pem client.pem peer.csr peer.pem server-key.pem ca-key.pem client-key.pem config.json peer-key.pem server.csr server.pem enable etcd service [!TIP] running in all masters $ sudo bash -c 'cat >/etc/systemd/system/etcd.service' /etc/etcd/etcd.conf' HAProxy [!TIP] for HA-Proxy version 2.0.6 $ sudo bash -c 'cat > /etc/haproxy/haproxy.cfg' : maxconn 50 stats refresh 10s stats realm HAProxy\\ Statistics stats uri /healthy $ sudo systemctl enable haproxy.service $ sudo systemctl start haproxy.service $ sudo ss -lnt | grep -E \"16443|8080\" kubeadm init kubeadm-conf.yaml [!TIP] create kubeconfig in all masters $ cat > kubeadm-conf.yaml init master [!TIP] init master in major master ONLY $ sudo modprobe br_netfilter $ sudo sysctl net.bridge.bridge-nf-call-iptables=1 $ sudo sysctl net.bridge.bridge-nf-call-ip6tables=1 $ sudo swapoff -a $ sudo bash -c \"sed -e 's:^\\\\(.*swap.*\\\\)$:# \\\\1:' -i /etc/fstab\" $ setenforce 0 $ sudo bash -c \"sed 's/^SELINUX=enforcing$/SELINUX=permissive/' -i /etc/selinux/config\" $ sudo kubeadm init --config kubeadm-conf.yaml --ignore-preflight-errors=all $ mkdir -p \"$HOME/.kube\" $ sudo cp -i /etc/kubernetes/admin.conf \"$HOME/.kube/config\" $ sudo chown \"$(id -u)\":\"$(id -g)\" \"$HOME/.kube/config\" sync PKI [!TIP] sync PKI in following masters ONLY $ for pkg in '*.key' '*.crt' '*.pub'; do sudo rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ root@${leadIP}:\"/etc/kubernetes/pki/${pkg}\" \\ /etc/kubernetes/pki/ done $ sudo rm -rf /etc/kubernetes/pki/apiserver* # sudo cp -r /root/etcd* /etc/kubernetes/pki/ references belloHAKubeCluster.sh kube-up.sh Set up a High Availability etcd Cluster with kubeadm Configuring each kubelet in your cluster using kubeadm Creating a cluster with kubeadm v1.21 使用 kubeadm 创建集群 一步步打造基于Kubeadm的高可用Kubernetes集群-第一部分 一步步打造基于Kubeadm的高可用Kubernetes集群-第二部分 以Kubeadm方式安装的Kubernetes集群的探索 使用Kubeadm搭建Kubernetes HA（1.10.1） 使用Kubeadm + HAProxy + Keepalived部署高可用Kubernetes集群 Bootstrapping clusters with kubeadm Customizing components with the kubeadm API Set up a High Availability etcd Cluster with kubeadm Considerations for large clusters PKI certificates and requirements Set up a High Availability etcd Cluster with kubeadm # Update HOST0, HOST1 and HOST2 with the IPs of your hosts export HOST0=10.0.0.6 export HOST1=10.0.0.7 export HOST2=10.0.0.8 # Update NAME0, NAME1 and NAME2 with the hostnames of your hosts export NAME0=\"infra0\" export NAME1=\"infra1\" export NAME2=\"infra2\" # Create temp directories to store files that will end up on other hosts. mkdir -p /tmp/${HOST0}/ /tmp/${HOST1}/ /tmp/${HOST2}/ HOSTS=(${HOST0} ${HOST1} ${HOST2}) NAMES=(${NAME0} ${NAME1} ${NAME2}) for i in \"${!HOSTS[@]}\"; do HOST=${HOSTS[$i]} NAME=${NAMES[$i]} cat /tmp/${HOST}/kubeadmcfg.yaml --- apiVersion: \"kubeadm.k8s.io/v1beta3\" kind: InitConfiguration nodeRegistration: name: ${NAME} localAPIEndpoint: advertiseAddress: ${HOST} --- apiVersion: \"kubeadm.k8s.io/v1beta3\" kind: ClusterConfiguration etcd: local: serverCertSANs: - \"${HOST}\" peerCertSANs: - \"${HOST}\" extraArgs: initial-cluster: ${NAMES[0]}=https://${HOSTS[0]}:2380,${NAMES[1]}=https://${HOSTS[1]}:2380,${NAMES[2]}=https://${HOSTS[2]}:2380 initial-cluster-state: new name: ${NAME} listen-peer-urls: https://${HOST}:2380 listen-client-urls: https://${HOST}:2379 advertise-client-urls: https://${HOST}:2379 initial-advertise-peer-urls: https://${HOST}:2380 EOF done Generate the certificate authority [!TIP] to generate: /etc/kubernetes/pki/etcd/ca.crt /etc/kubernetes/pki/etcd/ca.key $ kubeadm init phase certs etcd-ca Create certificates for each member kubeadm init phase certs etcd-server --config=/tmp/${HOST2}/kubeadmcfg.yaml kubeadm init phase certs etcd-peer --config=/tmp/${HOST2}/kubeadmcfg.yaml kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST2}/kubeadmcfg.yaml kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST2}/kubeadmcfg.yaml cp -R /etc/kubernetes/pki /tmp/${HOST2}/ # cleanup non-reusable certificates find /etc/kubernetes/pki -not -name ca.crt -not -name ca.key -type f -delete kubeadm init phase certs etcd-server --config=/tmp/${HOST1}/kubeadmcfg.yaml kubeadm init phase certs etcd-peer --config=/tmp/${HOST1}/kubeadmcfg.yaml kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST1}/kubeadmcfg.yaml kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST1}/kubeadmcfg.yaml cp -R /etc/kubernetes/pki /tmp/${HOST1}/ find /etc/kubernetes/pki -not -name ca.crt -not -name ca.key -type f -delete kubeadm init phase certs etcd-server --config=/tmp/${HOST0}/kubeadmcfg.yaml kubeadm init phase certs etcd-peer --config=/tmp/${HOST0}/kubeadmcfg.yaml kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST0}/kubeadmcfg.yaml kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST0}/kubeadmcfg.yaml # No need to move the certs because they are for HOST0 # clean up certs that should not be copied off this host find /tmp/${HOST2} -name ca.key -type f -delete find /tmp/${HOST1} -name ca.key -type f -delete Copy certificates and kubeadm configs USER=ubuntu HOST=${HOST1} scp -r /tmp/${HOST}/* ${USER}@${HOST}: ssh ${USER}@${HOST} USER@HOST $ sudo -Es root@HOST $ chown -R root:root pki root@HOST $ mv pki /etc/kubernetes/ Create the static pod manifests root@HOST0 $ kubeadm init phase etcd local --config=/tmp/${HOST0}/kubeadmcfg.yaml root@HOST1 $ kubeadm init phase etcd local --config=$HOME/kubeadmcfg.yaml root@HOST2 $ kubeadm init phase etcd local --config=$HOME/kubeadmcfg.yaml [Optional]: Check the cluster healthdocker run --rm -it \\ --net host \\ -v /etc/kubernetes:/etc/kubernetes k8s.gcr.io/etcd:${ETCD_TAG} etcdctl \\ --cert /etc/kubernetes/pki/etcd/peer.crt \\ --key /etc/kubernetes/pki/etcd/peer.key \\ --cacert /etc/kubernetes/pki/etcd/ca.crt \\ --endpoints https://${HOST0}:2379 \\ endpoint health \\ --cluster ... https://[HOST0 IP]:2379 is healthy: successfully committed proposal: took = 16.283339ms https://[HOST1 IP]:2379 is healthy: successfully committed proposal: took = 19.44402ms https://[HOST2 IP]:2379 is healthy: successfully committed proposal: took = 35.926451ms Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:22 "},"virtualization/kubernetes/kubeadm/etcd.html":{"url":"virtualization/kubernetes/kubeadm/etcd.html","title":"etcd","keywords":"","body":" Table of Contents generated with DocToc extenal etcd certificates certificate signing request configuration enable service verify extenal etcd topology certificates located in : /etc/etcd/ssl You need: Three or more machines that meet kubeadm's minimum requirements for the control-plane nodes. Having an odd number of control plane nodes can help with leader selection in the case of machine or zone failure. including a container runtime, already set up and working Three or more machines that meet kubeadm's minimum requirements for the workers including a container runtime, already set up and working Full network connectivity between all machines in the cluster (public or private network) Superuser privileges on all machines using sudo You can use a different tool; this guide uses sudo in the examples. SSH access from one device to all nodes in the system kubeadm and kubelet already installed on all machines. And you also need: Three or more additional machines, that will become etcd cluster members. Having an odd number of members in the etcd cluster is a requirement for achieving optimal voting quorum. These machines again need to have kubeadm and kubelet installed. These machines also require a container runtime, that is already set up and working. See External etcd topology for context. stacked etcd topology certificates located in : /etc/kubernetes/pki/etcd You need: Three or more machines that meet kubeadm's minimum requirements for the control-plane nodes. Having an odd number of control plane nodes can help with leader selection in the case of machine or zone failure. including a container runtime, already set up and working Three or more machines that meet kubeadm's minimum requirements for the workers including a container runtime, already set up and working Full network connectivity between all machines in the cluster (public or private network) Superuser privileges on all machines using sudo You can use a different tool; this guide uses sudo in the examples. SSH access from one device to all nodes in the system kubeadm and kubelet already installed on all machines. See Stacked etcd topology for context. references: Clustering Guide clustering.md Setting up Etcd Cluster with TLS Authentication Enabled CONFIGURING ETCD RBAC Deploy a secure etcd cluster Set up a High Availability etcd Cluster with kubeadm Creating Highly Available Clusters with kubeadm Etcd Backup And Restore In Kubernetes: Step By Step extenal etcd certificates $ sudo mkdir -p /etc/etcd/ssl certificate signing request generate the etcd certificates in major kubernetes master. and sync to the others following kuberentes masters. $ sudo bash -c 'cat > /etc/etcd/ssl/ca-config.json' ca $ sudo bash -c 'cat > /etc/etcd/ssl/ca-csr.json' client $ sudo bash -c 'cat > /etc/etcd/ssl/client.json' result $ ls ca-config.json ca.csr ca-csr.json ca-key.pem ca.pem client.csr client.json client-key.pem client.pem sync to the others masters $ for _host in master02 master03; do ssh ${_host} 'sudo mkdir -p /etc/etcd/ssl' rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ /etc/etcd/ssl/*.pem \\ ${_host}:/etc/etcd/ssl/ rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ /etc/etcd/ssl/ca-config.json \\ ${_host}:/etc/etcd/ssl/ done configuration etcd.service $ sudo bash -c 'cat >/etc/systemd/system/etcd.service' etcd.conf $ etcdInitialCluster=\"master01=https://192.168.100.200:2380\" etcdInitialCluster+=\",master02=https://192.168.100.201:2380\" etcdInitialCluster+=\",master03=https://192.168.100.202:2380\" $ interface=$(netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}') $ ipAddr=$(ip a s \"${interface}\" | sed -rn 's|\\W*inet[^6]\\W*([0-9\\.]{7,15}).*$|\\1|p') $ sudo bash -c 'cat > /etc/etcd/etcd.conf' enable service $ sudo systemctl daemon-reload $ sudo systemctl enable --now etcd $ sudo systemctl start etcd.service verify $ sudo systemctl status etcd $ sudo /usr/local/bin/etcdctl --ca-file /etc/etcd/ssl/ca.pem \\ --cert-file /etc/etcd/ssl/client.pem \\ --key-file /etc/etcd/ssl/client-key.pem \\ --endpoints https://192.168.100.200:2379,https://192.168.100.201:2379,https://192.168.100.202:2379 \\ cluster-health tips$ alias etcdctl=\"sudo /usr/local/bin/etcdctl --ca-file /etc/etcd/ssl/ca.pem --cert-file /etc/etcd/ssl/client.pem --key-file /etc/etcd/ssl/client-key.pem --endpoints https://192.168.100.200:2379,https://192.168.100.201:2379,https://192.168.100.202:2379\" $ etcdctl cluster-health member ae76391b129**** is healthy: got healthy result from https://192.168.100.200:2379 member cda996b3ea5a*** is healthy: got healthy result from https://192.168.100.201:2379 member e295a3c1654e*** is healthy: got healthy result from https://192.168.100.202:2379 cluster is healthy Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:21 "},"virtualization/kubernetes/kubeadm/ha.html":{"url":"virtualization/kubernetes/kubeadm/ha.html","title":"ha","keywords":"","body":" Table of Contents generated with DocToc tools cfssl & cfssljson etcd keepalived haproxy helm external etcd [!TIP] extenal etcd topology certificates located in : /etc/etcd/ssl stacked etcd topology certificates located in : /etc/kubernetes/pki/etcd Proposal for a highly available control plane configuration for ‘kubeadm’ deployments Proposal for kubeadm self-hosted HA deployment kubeadm upgrades / self-hosting / HA v1.8 implementation working group tools cfssl & cfssljson $ sudo bash -c \"curl -o /usr/local/bin/cfssl https://pkg.cfssl.org/R1.2/cfssl_linux-amd64\" $ sudo bash -c \"curl -o /usr/local/bin/cfssljson https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\" $ sudo chmod +x /usr/local/bin/cfssl* etcd $ curl -fsSL https://github.com/etcd-io/etcd/releases/download/v3.3.15/etcd-v3.3.15-linux-amd64.tar.gz | sudo tar -xzv --strip-components=1 -C /usr/local/bin/ keepalived $ mkdir -p ~/temp $ sudo mkdir -p /etc/keepalived/ $ curl -fsSL ${keepaliveDownloadUrl}/keepalived-2.0.18.tar.gz | tar xzf - -C ~/temp $ pushd . $ cd ~/temp/keepalived-2.0.18 $ ./configure && make $ sudo make install $ sudo cp keepalived/keepalived.service /etc/systemd/system/ $ popd $ rm -rf ~/temp haproxy $ curl -fsSL http://www.haproxy.org/download/2.0/src/haproxy-2.0.6.tar.gz | tar xzf - -C ~ $ pushd . $ cd ~/haproxy-2.0.6 $ make TARGET=linux-glibc \\ USE_LINUX_TPROXY=1 \\ USE_ZLIB=1 \\ USE_REGPARM=1 \\ USE_PCRE=1 \\ USE_PCRE_JIT=1 \\ USE_OPENSSL=1 \\ SSL_INC=/usr/include \\ SSL_LIB=/usr/lib \\ ADDLIB=-ldl \\ USE_SYSTEMD=1 $ sudo make install $ sudo cp haproxy /usr/sbin/ $ sudo cp examples/haproxy.init /etc/init.d/haproxy && sudo chmod +x $_ $ popd $ rm -rf ~/haproxy-2.0.6 helm $ curl -fsSL \\ https://get.helm.sh/helm-v2.14.3-linux-amd64.tar.gz | sudo tar -xzv --strip-components=1 -C /usr/local/bin/ $ while read -r _i; do sudo chmod +x \"/usr/local/bin/${_i}\" done configuration $ helm init $ helm init --client-only $ kubectl -n kube-system create serviceaccount tiller $ kubectl create clusterrolebinding tiller-cluster-rule \\ --clusterrole=cluster-admin \\ --serviceaccount=kube-system:tiller $ kubectl -n kube-system patch deploy \\ tiller-deploy -p '{\"spec\":{\"template\":{\"spec\":{\"serviceAccount\":\"tiller\"}}}}' $ helm repo add jetstack https://charts.jetstack.io external etcd Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:22 "},"virtualization/kubernetes/kubectl.html":{"url":"virtualization/kubernetes/kubectl.html","title":"kubectl","keywords":"","body":" Table of Contents generated with DocToc what is kubectl get get all get cluster status get po get all images list list image from a single deploy list Container images by Pod list all Container images in all namespaces list Container images filtering by Pod namespace list Container images using a go-template instead of jsonpath list all quota get apiservers get apiresources check etcd what is kubectl kubectl reference: 23 Advanced kubectl commands get output options: -o custom-columns=:[,:]... get all $ k get all -A get cluster status $ k get cs NAME STATUS MESSAGE ERROR controller-manager Healthy ok scheduler Healthy ok etcd-1 Healthy {\"health\":\"true\"} etcd-2 Healthy {\"health\":\"true\"} etcd-0 Healthy {\"health\":\"true\"} get po name$ k -n devops get po -o custom-columns='NAME:metadata.name' or $ k -n devops get deploy jenkins -o custom-columns=\"NAME:metadata.name, IMAGES:..image\" NAME IMAGES jenkins jenkins/jenkins:2.187 get where pods are running $ kubectl get pod -o=custom-columns=NAME:.metadata.name,STATUS:.status.phase,NODE:.spec.nodeName \\ --all-namespaces sort pods by nodeName $ kubectl get pods -o wide --sort-by=\"{.spec.nodeName}\" sort by restart count $ kubectl get pods --sort-by=\"{.status.containerStatuses[:1].restartCount}\" sort by age $ kubectl get replicasets -o wide --sort-by=.metadata.creationTimestamp or$ kubectl get pods --sort-by=.status.startTime or$ kubectl get pods --field-selector=status.phase=Pending \\ --sort-by=.metadata.creationTimestamp | awk 'match($5,/^[1-5]d/) {print $0}' get all images $ kubectl get pods --all-namespaces \\ -o jsonpath=\"{..image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq -c list list image from a single deploy $ k -n devops get deployment jenkins -o=jsonpath='{.spec.template.spec.containers[:1].image}' jenkins/jenkins:2.187 or$ k -n devops get deploy jenkins -o jsonpath=\"{..image}\" jenkins/jenkins:2.187 list Container images by Pod $ k get pods --all-namespaces -o=jsonpath=\"{..image}\" -l app=nginx or $ k -n get po \\ -o custom-columns='NAME:metadata.name,IMAGES:spec.containers[*].image' or $ k -n get po -o jsonpath=\"{..containerID}\" # or $ k -n get po \\ -o go-template \\ --template=\"{{ range .status.containerStatuses }}{{ .containerID }}{{end}}\" list all Container images in all namespaces $ k get pods --all-namespaces -o jsonpath=\"{.items[*].spec.containers[*].image}\" or$ k get pods --all-namespaces -o jsonpath=\"{..image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq -c list Container images filtering by Pod namespace $ k -n kube-system get pods -o jsonpath=\"{..image}\" list Container images using a go-template instead of jsonpath $ k get po --all-namespaces \\ -o go-template \\ --template=\"{{range .items}}{{range .spec.containers}}{{.image}} {{end}}{{end}}\" or$ k get deploy \\ -o=jsonpath=\"{range .items[*]}{'\\n'}{.metadata.name}{':\\t'}{range .spec.template.spec.containers[*]}{.image}{', '}{end}{end}\" list all quota $ for _i in $(k get ns --no-headers | awk -F' ' '{print $1}'); do echo ------------- ${_i} ------------ k -n ${_i} describe quota done get apiservers $ k get --raw=/apis get apiresources check available $ k api-resources $ k api-versions check apiservices registered $ k get apiservices.apiregistration.k8s.io $ k get apiservices.apiregistration.k8s.io v1beta1.metrics.k8s.io -o yaml check etcd $ k get --raw=/healthz/etcd ok Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:20 "},"virtualization/kubernetes/pod.html":{"url":"virtualization/kubernetes/pod.html","title":"pod","keywords":"","body":" Table of Contents generated with DocToc filter via --field-selector list all Failed pods filter via Node Name filter via json list pod details for failure pods sort via --sort-by sorting pods by nodeName sort pods by restartCount sort by restart count sort via start time get the oldest pod sort via created time list List Error Status pods list and delete all Error status pods list all pods statuses only list running images list running pods List Pods name QOS management execute in pod restart po others references: Pod Lifecycle Pods Field Selectors filter via --field-selector list all Failed pods $ k -n get po \\ --field-selector status.phase=Failed filter via Node Name $ k -n get po \\ [-o wide] \\ --field-selector spec.nodeName=master-node01 NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES devops-jenkins-659f4c6d44-d2w76 1/1 Running 0 2d22h **.***.*.** master-node01 filter all pods running in particular node $ k --all-namespaces get po \\ [-o wide] \\ --field-selector spec.nodeName= filter all pods running in particular node via --template $ k -n get po \\ --template '{{range .items}}{{if eq .spec.nodeName \"\"}}{{.metadata.name}}{{\"\\n\"}}{{end}}}{{end}}' via api$ curl --cacert ca.crt \\ --cert apiserver.crt \\ --key apiserver.key \\ https://:/api/v1/namespaces//pods?fieldSelector=spec.nodeName%3Dsomenodename filter via json $ kubectl get po -o json | jq -r '.items | sort_by(.spec.nodeName)[] | [.spec.nodeName,.metadata.name] | @tsv' list pod details for failure pods $ ns='my-namespace' $ keyword='tester' $ for p in $(k -n ${ns} get po --field-selector status.phase=Failed -o=name | /bin/grep ${keyword}); do echo \"--- ${p} --- \"; k -n ${ns} describe ${p} | grep -E 'Annotations|Status|Reason|Message'; done sort via --sort-by sorting pods by nodeName $ k -n get po \\ -o wide \\ --sort-by=\"{.spec.nodeName}\" sort pods by restartCount $ k -n get po --sort-by=\"{.status.containerStatuses[:1].restartCount}\" sort by restart count $ k -n get pods --sort-by=.status.containerStatuses[0].restartCount sort via start time $ k -n get po \\ --sort-by=.status.startTime get the oldest pod -1: means the last in the list $ k -n get pods \\ --sort-by=.metadata.creationTimestamp \\ -o jsonpath='{.items[-1:].metadata.name}' sort via created time $ k -n get pods \\ --sort-by=.metadata.creationTimestamp list List Error Status pods reference: Viewing, finding resources kubectl get should have a way to filter for advanced pods status $ k -n get po \\ --field-selector status.phase=Failed list and delete all Error status pods $ k -n delete po \\ --field-selector status.phase=Failed or $ k -n get po \\ --field-selector=status.phase!=Running or $ k --all-namespaces get po \\ --field-selector=status.phase!=Running,status.phase!=Succeeded or $ k get po --all-namespaces -o json \\ | jq -r '.items[] \\ | select(.status.phase != \"Running\" \\ or ([ .status.conditions[] | select(.type == \"Ready\" and .status == \"False\") ] | length ) == 1 \\ ) \\ | .metadata.namespace + \"/\" + .metadata.name' list all pods statuses only $ k -n get po \\ -o=jsonpath='{.items[*].status.phase}' Running Running Running Running Running Running Running Running Running list running images $ k4 -n get po -o jsonpath=\"{..image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq -c 2 gcr.io/kubernetes-helm/tiller:v2.14.3 6 k8s.gcr.io/coredns:1.2.2 6 k8s.gcr.io/etcd:3.2.24 6 k8s.gcr.io/kube-apiserver:v1.12.3 6 k8s.gcr.io/kube-controller-manager:v1.12.3 30 k8s.gcr.io/kube-proxy:v1.12.3 6 k8s.gcr.io/kube-scheduler:v1.12.3 4 k8s.gcr.io/metrics-server-amd64:v0.3.6 30 k8s.gcr.io/node-problem-detector:v0.8.1 2 kubernetesui/dashboard:v2.0.0-beta1 4 kubernetesui/metrics-scraper:v1.0.1 60 quay.io/coreos/flannel:v0.10.0-amd64 list running pods $ k -n get po \\ -o=custom-columns=NAME:.metadata.name,STATUS:.status.phase,NODE:.spec.nodeName NAME STATUS NODE coredns-59dd98b545-7t25l Running k8s-node01 coredns-59dd98b545-lnklx Running k8s-node02 coredns-59dd98b545-ltj5p Running k8s-node03 ... List Pods name Inspired from here -o name $ k -n kube-system get pods -o name | head pod/coredns-c7ddbcccb-5cj5z pod/coredns-c7ddbcccb-lxsw6 pod/coredns-c7ddbcccb-prjfk pod/etcd-node03 pod/etcd-node04 pod/etcd-node01 pod/kube-apiserver-node03 pod/kube-apiserver-node04 pod/kube-apiserver-node01 pod/kube-controller-manager-node03 --template $ k -n kube-system get pods \\ -o go-template \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' | head coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 kube-controller-manager-node03 or $ k -n kube-system get pods \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' | head coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 kube-controller-manager-node03 list all images running in particular namespace $ k -n get po \\ --output=custom-columns=\"NAME:.metadata.name,IMAGE:.spec.containers[*].image\" list all images exclude 'k8s.gcr.io/coredns:1.6.2'$ k get pods -A \\ -o=custom-columns='DATA:spec.containers[?(@.image!=\"k8s.gcr.io/coredns:1.6.2\")].image' list via -o custom-columns=\":metadata.name\" $ k -n kube-system get pods -o custom-columns=\":metadata.name\" | head coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 list via jsonpath={.items..metadata.name} $ k -n kube-system get po \\ --output=jsonpath={.items..metadata.name} coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk ... or$ k -n kube-system get po \\ -o jsonpath=\"{range .items[*]}{@.metadata.name}{'\\n'}{end}\" | head -10 coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 kube-controller-manager-node03 List all Container images in all namespaces $ kubectl get pods \\ --all-namespaces \\ -o jsonpath=\"{.items[*].spec.containers[*].image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq -c or$ kubectl get pods \\ --all-namespaces \\ -o jsonpath=\"{.items[*].spec.containers[*].image}\" List Container images by Pod $ kubectl get pods \\ --all-namespaces \\ -o=jsonpath='{range .items[*]}{\"\\n\"}{.metadata.name}{\":\\t\"}{range .spec.containers[*]}{.image}{\", \"}{end}{end}' | sort QOS $ k -n kube-system get po \\ -o custom-columns=NAME:.metadata.name,NAMESPACE:.metadata.namespace,QOS-CLASS:.status.qosClass NAME NAMESPACE QOS-CLASS coredns-59dd98b545-7t25l kube-system Burstable coredns-59dd98b545-lnklx kube-system Burstable coredns-59dd98b545-ltj5p kube-system Burstable etcd-k8s-node01 kube-system BestEffort etcd-k8s-node02 kube-system BestEffort etcd-k8s-node03 kube-system BestEffort kube-apiserver-k8s-node01 kube-system Burstable kube-apiserver-k8s-node02 kube-system Burstable kube-apiserver-k8s-node03 kube-system Burstable kube-controller-manager-k8s-node01 kube-system Burstable kube-controller-manager-k8s-node02 kube-system Burstable kube-controller-manager-k8s-node03 kube-system Burstable kube-flannel-ds-amd64-627bn kube-system Guaranteed kube-flannel-ds-amd64-7hdqd kube-system Guaranteed kube-flannel-ds-amd64-b4th7 kube-system Guaranteed ... management execute in pod $ k -n devops exec -it devops-jenkins-659f4c6d44-d2w76 -- /bin/bash jenkins@devops-jenkins-659f4c6d44-d2w76:/$ echo $HOME /var/jenkins_home jenkins@devops-jenkins-659f4c6d44-d2w76:/$ hostname devops-jenkins-659f4c6d44-d2w76 restart po reference: Restarting Kubernetes Pods How to Restarting Kubernetes Pods for kubernetes version 1.15+ kubectl -n rollout restart deployment $ k -n get po -o yaml | k replace --force -f - result$ k -n get po -w NAME READY STATUS RESTARTS AGE mypo-659f4c6d44-72hb5 1/1 Running 0 47h mypo-659f4c6d44-72hb5 1/1 Terminating 0 47h mypo-659f4c6d44-d2w76 0/1 Pending 0 0s mypo-659f4c6d44-d2w76 0/1 Pending 0 0s mypo-659f4c6d44-d2w76 0/1 ContainerCreating 0 0s mypo-659f4c6d44-d2w76 1/1 Running 0 2s mypo-659f4c6d44-72hb5 0/1 Terminating 0 47h mypo-659f4c6d44-72hb5 0/1 Terminating 0 47h mypo-659f4c6d44-72hb5 0/1 Terminating 0 47h mypo-659f4c6d44-72hb5 0/1 Pending 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 1s mypo-659f4c6d44-72hb5 0/1 Terminating 0 1s or$ k -n scale deployment --replicas=0 others get the first deploy name in namespace$ k -n get deploy \\ -o=jsonpath={.items[0].metadata.name} get all deploy names$ k -n get deploy \\ -o=jsonpath='{.items[*].metadata.name}' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:22 "},"virtualization/kubernetes/deploy.html":{"url":"virtualization/kubernetes/deploy.html","title":"deploy","keywords":"","body":" Table of Contents generated with DocToc get set update image setup limits for deploy via command line get check origial$ k -n devops get deploy devops-jenkins -o wide NAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTOR devops-jenkins 1/1 1 1 408d devops-jenkins jenkins/jenkins:2.199 app=devops-jenkins set reference: Updating a Deployment Rolling Back a Deployment format $ kubectl -n \\ set image \\ deploy \\ = \\ [--record=true] \\ [kubernetes.io/change-cause=\"update cause\"] # check history $ kubectl -n \\ rollout history \\ deploy # revert $ kubectl -n \\ rollout undo \\ deploy \\ --to-revision= update image $ k -n devops set image deployments/devops-jenkins devops-jenkins=jenkins/jenkins:2.200 deployment.extensions/devops-jenkins image updated # or $ k -n devops set image deploy devops-jenkins devops-jenkins=jenkins/jenkins:2.200 result $ k -n devops get pods -w NAME READY STATUS RESTARTS AGE devops-jenkins-54d6db68ff-bz5b6 1/1 Running 0 6d17h devops-jenkins-6bdd4fc6dd-l9spp 0/1 Pending 0 0s devops-jenkins-6bdd4fc6dd-l9spp 0/1 Pending 0 0s devops-jenkins-6bdd4fc6dd-l9spp 0/1 ContainerCreating 0 0s devops-jenkins-6bdd4fc6dd-l9spp 1/1 Running 0 8s devops-jenkins-54d6db68ff-bz5b6 1/1 Terminating 0 6d17h devops-jenkins-54d6db68ff-bz5b6 0/1 Terminating 0 6d17h devops-jenkins-54d6db68ff-bz5b6 0/1 Terminating 0 6d17h devops-jenkins-54d6db68ff-bz5b6 0/1 Terminating 0 6d17h $ k -n devops get deploy -w NAME READY UP-TO-DATE AVAILABLE AGE devops-jenkins 1/1 1 1 22d devops-jenkins 1/1 1 1 22d devops-jenkins 1/1 1 1 22d devops-jenkins 1/1 0 1 22d devops-jenkins 1/1 1 1 22d devops-jenkins 2/1 1 2 22d devops-jenkins 1/1 1 1 22d $ k -n devops get deploy devops-jenkins -o yaml --export | grep image\\: Flag --export has been deprecated, This flag is deprecated and will be removed in future. image: jenkins/jenkins:2.200 $ k -n devops get po -o custom-columns='NAME:metadata.name,IMAGES:spec.containers[*].image' NAME IMAGES devops-jenkins-6bdd4fc6dd-l9spp jenkins/jenkins:2.2000 setup limits for deploy via command line $ k run \\ --image=jenkins/jenkins:2.274 \\ -i \\ --tty \\ --limits='cpu=50m,memory=128Mi' \\ --requests='cpu=50m,memory=128Mi' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:21 "},"virtualization/kubernetes/replicaset.html":{"url":"virtualization/kubernetes/replicaset.html","title":"replicasets","keywords":"","body":" Table of Contents generated with DocToc list list redundant rs remove useless replicasets list list redundant rs $ k -n get rs | awk '{if ($2 + $3 + $4 == 0) print $1}' remove useless replicasets $ k -n delete rs $(k -n get rs | awk '{if ($2 + $3 + $4 == 0) print $1}') Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:23 "},"virtualization/kubernetes/kubelet.html":{"url":"virtualization/kubernetes/kubelet.html","title":"kubelet","keywords":"","body":" Table of Contents generated with DocToc configuration files systemd kubelet kuabelet configration change kubelet root dir references: The kubelet drop-in file for systemd configuration files systemd service configure : /etc/systemd/system/kubelet.service.d/10-kubeadm.conf environment file : /etc/sysconfig/kubelet kubelet kubeconfig, kubelet configuration file : /etc/kubernetes/kubelet.conf kubeConfig file to use for the TLS Bootstrap, (it is only used if /etc/kubernetes/kubelet.conf does not exist): /etc/kubernetes/bootstrap-kubelet.conf file containing the kubelet's ComponentConfig, workflow in kubelet init : /var/lib/kubelet/config.yaml dynamic environment file that contains KUBELET_KUBEADM_ARGS : /var/lib/kubelet/kubeadm-flags.env user-specified flag overrides with KUBELET_EXTRA_ARGS : /etc/default/kubelet (for DEBs) /etc/sysconfig/kubelet (for RPMs) kuabelet configration [!TIP] references: kubelet flag --root-dir string Default: /var/lib/kubelet change kubelet root dir $ cat /etc/sysconfig/kubelet KUBELET_EXTRA_ARGS=--root-dir=/path/to/extra/folder $ grep EnvironmentFile /etc/systemd/system/kubelet.service.d/10-kubeadm.conf EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env EnvironmentFile=-/etc/sysconfig/kubelet $ systemctl daemon-reload $ systemctl enable kubelet --now $ systemctl start kubelet or add KUBELET_EXTRA_ARGS : $ cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf ... Environment=\"KUBELET_EXTRA_ARGS=$KUBELET_EXTRA_ARGS --root-dir=/path/to/extra/folder\" ... full content of /etc/systemd/system/kubelet.service.d/10-kubeadm.conf [!TIP] This file specifies the default locations for all of the files managed by kubeadm for the kubelet. The KubeConfig file to use for the TLS Bootstrap is /etc/kubernetes/bootstrap-kubelet.conf, but it is only used if /etc/kubernetes/kubelet.conf does not exist. The KubeConfig file with the unique kubelet identity is /etc/kubernetes/kubelet.conf. The file containing the kubelet's ComponentConfig is /var/lib/kubelet/config.yaml. The dynamic environment file that contains KUBELET_KUBEADM_ARGS is sourced from /var/lib/kubelet/kubeadm-flags.env. The file that can contain user-specified flag overrides with KUBELET_EXTRA_ARGS is sourced from /etc/default/kubelet (for DEBs), or /etc/sysconfig/kubelet (for RPMs). KUBELET_EXTRA_ARGS is last in the flag chain and has the highest priority in the event of conflicting settings. $ cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf # Note: This dropin only works with kubeadm and kubelet v1.11+ [Service] Environment=\"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf\" Environment=\"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml\" # This is a file that \"kubeadm init\" and \"kubeadm join\" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env # This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use # the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file. EnvironmentFile=-/etc/sysconfig/kubelet ExecStart= ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:21 "},"virtualization/kubernetes/certificates.html":{"url":"virtualization/kubernetes/certificates.html","title":"certificates","keywords":"","body":" Table of Contents generated with DocToc renew both certificates and kubeconfig check info crt pem for external etcd backup clean environment restore backup v1.12.3 renew certificates renew kubeconfig sync to redundant masters restart kubelet v1.15.3 renew certificates sync to redundant masters renew kubeconfig restart the master components restart kubelet service verify extend X509v3 Subject Alternative Name in apiserver.crt using new certificate for apiserver renew work node backup restart kubelet certificates generation pfx renew kubeconfig only basic environment renew kubeconfig generate new certificate (csr) signing the certificate via ca.crt renew via kubeadm alpha renew via kubectl config renew via base64 manually vaildate more details reference Required certificates: Certificate paths Configure certificates for user accounts files are used as follows [!TIP] extenal etcd topology certificates located in : /etc/etcd/ssl stacked etcd topology certificates located in : /etc/kubernetes/pki/etcd references: Generate Certificates Manually Manage TLS Certificates in a Cluster Renew a Kubernetes certificate with a 10-year expiration date stacked CA mode can found from Certificate Management with kubeadm Configure Access to Multiple Clusters PKI certificates and requirements Dashboard使用自定义证书 Custom certificates on Kubernetes How to Generate a Self-Signed Certificate for Kubernetes Certificates in a Kubernetes environment Creating Self Signed Certificates on Kubernetes Cluster TLS using OpenSSL regenerate the kubeadm.yaml$ sudo kubeadm config view renew both certificates and kubeconfig check info crt $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | egrep -v 'ca.crt$' | xargs -L 1 -t -i bash -c 'openssl x509 -noout -text -in {} | grep After' bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-kubelet-client.crt | grep After Not After : Sep 16 07:51:58 2020 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver.crt | grep After Not After : Sep 16 07:51:59 2020 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/front-proxy-client.crt | grep After Not After : Sep 16 07:52:00 2020 GMT or $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | egrep -v 'ca.crt$' | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' or $ ls -1 /etc/kubernetes/pki/*.crt | grep -Ev 'ca.crt$' | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' pem for external etcd $ for i in ca client server peer; do echo /etc/etcd/ssl/$i.pem openssl x509 -enddate -noout -in /etc/etcd/ssl/$i.pem done /etc/etcd/ssl/ca.pem notAfter=Sep 8 10:44:00 2024 GMT /etc/etcd/ssl/client.pem notAfter=Sep 8 10:49:00 2024 GMT /etc/etcd/ssl/server.pem notAfter=Sep 8 11:03:00 2024 GMT /etc/etcd/ssl/peer.pem notAfter=Sep 8 11:03:00 2024 GMT or $ find /etc/etcd/ssl/ -type f -name '*.pem' | egrep -v '*-key.pem$' | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/ca.pem notAfter=Sep 8 10:44:00 2024 GMT bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/client.pem notAfter=Sep 8 10:49:00 2024 GMT bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/server.pem notAfter=Sep 8 11:03:00 2024 GMT bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/peer.pem notAfter=Sep 8 11:03:00 2024 GMT or $ ls -1 /etc/etcd/ssl/*.pem | grep -Ev '\\-key.pem$' | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' backup # timestampe=$(date +\"%Y%m%d%H%M%S\") $ timestampe=$(date +\"%Y%m%d\") $ backupFolder=\"$HOME/k8s-cert-expired-${timestampe}\" $ mkdir \"${backupFolder}\" $ sudo cp -rp --parents /etc/kubernetes/pki \"${backupFolder}\" # for external etcd # sudo cp -rp --parents /etc/etcd/ssl \"${backupFolder}\" # for kubelet $ sudo cp -rp /var/lib/kubelet/config.yaml{,.backup.${timestampe}} $ sudo cp -rp --parents /var/lib/kubelet/pki \"${backupFolder}\" $ sudo cp -rp --parents /var/lib/kubelet/pki{,.backup.${timestampe}} $ sudo cp -rp --parents /var/lib/kubelet/config.yaml \"${backupFolder}\" # for kubeconfig $ sudo cp -rp --parents /etc/kubernetes/*.conf \"${backupFolder}\" $ sudo cp -rp ~/.kube/config{,.backup.${timestampe}} clean environment # for `/etc/kubernetes/pki` $ echo {apiserver,apiserver-kubelet-client,apiserver-etcd-client,front-proxy-client} | fmt -1 | xargs -I{} bash -c \"sudo cp -rp /etc/kubernetes/pki/{}.crt{,.backup.${timestampe}}; sudo mv /etc/kubernetes/pki/{}.key{,.backup.${timestampe}}\" # for kubeconfig $ echo {admin,kubelet,controller-manager,scheduler} | fmt -1 | xargs -I{} bash -c \"sudo mv /etc/kubernetes/{}.conf{,.backup.${timestampe}}\" $ echo {peer,healthcheck-client,server}.{crt,key} | fmt -1 | xargs -I{} bash -c \"sudo mv /etc/kubernets/pki/etcd/${}{,.backup.${timestampe}}\" restore backup TBD v1.12.3 [!TIP] for stacked etcd topology $ kubectl version --short Client Version: v1.12.3 Server Version: v1.12.3 references: Renewing Kubernetes cluster certificates 1.0.2 Renewing Kubernetes cluster certificates 1.1.0 Renewing Kubernetes 1.10.x cluster certificates renew certificates $ sudo kubeadm [--config kubeadm.yaml] alpha phase certs renew [commands] Available Commands: commands comments all renew all available certificates apiserver Generates the certificate for serving the kubernetes API apiserver-etcd-client Generates the client apiserver uses to access etcd apiserver-kubelet-client Generates the Client certificate for the API server to connect to kubelet front-proxy-client Generates the client for the front proxy etcd-healthcheck-client Generates the client certificate for liveness probes to healtcheck etcd etcd-peer Generates the credentials for etcd nodes to communicate with each other etcd-server Generates the certificate for serving etcd i.e. $ sudo kubeadm --config ~/kubeadm.yaml alpha phase certs renew all # or # for /etc/kubernetes/pki/*.crt $ echo {apiserver,apiserver-kubelet-client,front-proxy-client} | fmt -1 | xargs -I{} bash -c \"sudo kuabeadm --config ~/kubeadm.yaml alpha phase certs renew {}\" # for /etc/kubernetes/pki/etcd/*.crt $ echo {etcd-server,etcd-peer,etcd-healthcheck-client} | fmt -1 | xargs -I{} bash -c \"sudo kuabeadm --config ~/kubeadm.yaml alpha phase certs renew {}\" generate new certificates $ sudo kubeadm [--config kubeadm.yaml] alpha phase certs [commands] commands comments all Generates all PKI assets necessary to establish the control plane apiserver Generates the certificate for serving the kubernetes API apiserver-etcd-client Generates the client apiserver uses to access etcd apiserver-kubelet-client Generates the Client certificate for the API server to connect to kubelet ca Generates the self-signed kubernetes CA to provision identities for other kuberenets components etcd-ca Generates the self-signed CA to provision identities for etcd etcd-healthcheck-client Generates the client certificate for liveness probes to healtcheck etcd etcd-peer Generates the credentials for etcd nodes to communicate with each other etcd-server Generates the certificate for serving etcd front-proxy-ca Generates the self-signed CA to provision identities for front proxy front-proxy-client Generates the client for the front proxy sa Generates a private key for signing service account tokens along with its public key renew Renews certificates for a Kubernetes cluster re-generate /etc/kubernetes/pki/etcd/*.crt for modify X509 Subject Alternative Name: $ sudo kubeadm --config ~/kubeadm.yaml alpha phase certs etcd-server $ sudo kubeadm --config ~/kubeadm.yaml alpha phase certs etcd-peer $ sudo kubeadm --config ~/kubeadm.yaml alpha phase certs etcd-healthcheck-client # or $ echo {etcd-server,etcd-peer,etcd-healthcheck-client} | fmt -1 | xargs -I{} bash -c \"sudo kubeadm --config ~/kubeadm.yaml alpha phase certs {}\" check X509 Subject Alternative Name$ openssl x509 -noout -text -in /path/to/NAME.crt renew kubeconfig # clean all config in /etc/kubenernets/*.conf, i.e.: # echo {admin,controller-manager,kubelet,scheduler} | fmt -1 | xargs -I{} bash -c \"sudo rm -rf {}.conf\" $ sudo kubeadm [--config ~/kubeadm.yaml] alpha phase kubeconfig [commands] renew all kubeconfig $ sudo kubeadm --config ~/kubeadm.yaml alpha phase kubeconfig all [endpoint] WARNING: port specified in controlPlaneEndpoint overrides bindPort in the controlplane address [kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/admin.conf\" [kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/kubelet.conf\" [kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/controller-manager.conf\" [kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/scheduler.conf\" # or $ echo {admin,controller-manager,kubelet,scheduler} | fmt -1 | xargs -I{} bash -c \"sudo kubeadm --config ~/kubeadm.yaml alpha phase kubeconfig {}\" Available Commands: commands comments all Generates all kubeconfig files necessary to establish the control plane and the admin kubeconfig file admin Generates a kubeconfig file for the admin to use and for kubeadm itself controller_manager Generates a kubeconfig file for the controller manager to use kubelet Generates a kubeconfig file for the kubelet to use. Please note that this should be used *only* for bootstrapping purposes scheduler Generates a kubeconfig file for the scheduler to use user Outputs a kubeconfig file for an additional user update ~/.kube/config $ sudo rm -rf ~/.kube/config $ sudo cp /etc/kubernetes/admin.conf ~/.kube/config $ sudo chown devops:devops ~/.kube/config $ sudo chmod 644 ~/.kube/config sync to redundant masters $ for pkg in '*.key' '*.crt' '*.pub'; do sudo rsync -avzrlpgoDP \\ -e \"ssh -i $HOME/.ssh/id_ed25519\" \\ --rsync-path='sudo rsync' \\ devops@:\"/etc/kubernetes/pki/${pkg}\" /etc/kubernetes/pki/ done # for stacked etcd $ for _i in server healthcheck-client peer; do sudo rsync -avzrlpgoDP \\ -e \"ssh -i $HOME/.ssh/id_ed25519\" \\ --rsync-path='sudo rsync' \\ devops@\"/etc/kubernetes/pki/etcd/${_i}.{crt,key}\" /etc/kubernetes/pki/etcd/ done # for kubeconfig $ for _i in admin kubelet controller-manager scheduler; do sudo rsync -avzrlpgoDP \\ -e \"ssh -i $HOME/.ssh/id_ed25519\" \\ --rsync-path='sudo rsync' \\ devops@:\"/etc/kubernetes/${_i}.conf\" /etc/kubernetes/ done restart kubelet kill all services $ sudo kill -s SIGHUP $(pidof kube-apiserver) $ sudo kill -s SIGHUP $(pidof kube-controller-manager) $ sudo kill -s SIGHUP $(pidof kube-scheduler) restart service $ sudo rm -rf /var/lib/kubelet/pki/* $ sudo systemctl status kubelet $ sudo systemctl restart kubelet $ sudo systemctl --no-pager -l status kubelet v1.15.3 reference: Renewing Kubernetes 1.14.x cluster certificates Renew cluster certificates Certificate Management with kubeadm kubeadm alpha kubeadm alpha Kubernetes v1.15 - Administration with kubeadm [!TIP] for external etcd topology $ kubectl version --short Client Version: v1.15.3 Server Version: v1.15.3 renew certificates [!TIP] in major master NOTE: major master is the master node bind with load balance ip. the key master node picked by keepalived. check it by using: ip a s \"${interface}\" | sed -rn 's|\\W*inet[^6]\\W*([0-9\\.]{7,15}).*$|\\1|p' references: kubeadm-conf.yaml certificate files path apiserver.crt apiserver.key apiserver-kubelet-client.crt apiserver-kubelet-client.key front-proxy-client.crt front-proxy-client.key /etc/kubernetes/pki $ for i in apiserver apiserver-kubelet-client front-proxy-client; do sudo kubeadm alpha certs renew ${i} done certificate for serving the Kubernetes API renewed certificate for the API server to connect to kubelet renewed certificate for the front proxy client renewed or$ for i in apiserver apiserver-kubelet-client front-proxy-client; do sudo kubeadm --config kubeadm-conf.yaml alpha certs renew ${i} done certificate for serving the Kubernetes API renewed certificate for the API server to connect to kubelet renewed certificate for the front proxy client renewed sync to redundant masters [!NOTE] sync renewed certificates to another masters $ leadIP= $ for pkg in '*.key' '*.crt' '*.pub'; do sudo rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ root@${leadIP}:\"/etc/kubernetes/pki/${pkg}\" \\ /etc/kubernetes/pki/ done verify $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | egrep -v 'ca.crt$' | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' bash -c openssl x509 -enddate -noout -in /etc/kubernetes/pki/apiserver.crt notAfter=Sep 18 12:10:31 2021 GMT bash -c openssl x509 -enddate -noout -in /etc/kubernetes/pki/apiserver-kubelet-client.crt notAfter=Sep 18 12:10:31 2021 GMT bash -c openssl x509 -enddate -noout -in /etc/kubernetes/pki/front-proxy-client.crt notAfter=Sep 18 12:10:31 2021 GMT or$ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | xargs -L 1 -t -i bash -c 'openssl x509 -in {} -noout -text |grep \"Not \"' bash -c openssl x509 -in /etc/kubernetes/pki/ca.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 14 07:51:58 2029 GMT bash -c openssl x509 -in /etc/kubernetes/pki/front-proxy-ca.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:52:00 2019 GMT Not After : Sep 14 07:52:00 2029 GMT bash -c openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 18 12:10:31 2021 GMT bash -c openssl x509 -in /etc/kubernetes/pki/apiserver-kubelet-client.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 18 12:10:31 2021 GMT bash -c openssl x509 -in /etc/kubernetes/pki/front-proxy-client.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:52:00 2019 GMT Not After : Sep 18 12:10:31 2021 GMT renew kubeconfig config files path admin.conf kubelet.conf controller-manager.conf scheduler.conf /etc/kubernetes/ $ sudo kubeadm --config kubeadm-conf.yaml init phase kubeconfig all [kubeconfig] Using kubeconfig folder \"/etc/kubernetes\" [kubeconfig] Writing \"admin.conf\" kubeconfig file [kubeconfig] Writing \"kubelet.conf\" kubeconfig file [kubeconfig] Writing \"controller-manager.conf\" kubeconfig file [kubeconfig] Writing \"scheduler.conf\" kubeconfig file setup ~/.kube/config $ sudo cp /etc/kubernetes/admin.conf ~/.kube/config $ sudo chown $(id -u):$(id -g) $HOME/.kube/config $ sudo chmod 644 $HOME/.kube/config configuration file path config ~/.kube restart the master components $ sudo kill -s SIGHUP $(pidof kube-apiserver) $ sudo kill -s SIGHUP $(pidof kube-controller-manager) $ sudo kill -s SIGHUP $(pidof kube-scheduler) or$ echo {kube-apiserver,kube-controller-manager,kube-scheduler} | fmt -1 | xargs -I{} bash -c \"sudo kill -s SIGHUP $(pidof {}) \" restart kubelet service $ sudo rm -rf /var/lib/kubelet/pki/* $ sudo systemctl restart kubelet verify$ sudo systemctl status kubelet ● kubelet.service - kubelet: The Kubernetes Node Agent Loaded: loaded (/usr/lib/systemd/system/kubelet.service; enabled; vendor preset: disabled) Drop-In: /usr/lib/systemd/system/kubelet.service.d └─10-kubeadm.conf Active: active (running) since Mon 2020-09-21 04:25:33 PDT; 55s ago Docs: https://kubernetes.io/docs/ Main PID: 11891 (kubelet) Tasks: 19 Memory: 126.5M CGroup: /system.slice/kubelet.service └─11891 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/... ... verify via kubernetes api (load.balance.ip.address:6443) $ echo -n | openssl s_client -connect x.x.x.:6443 2>&1 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | openssl x509 -text -noout | grep Not Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 21 09:09:00 2021 GMT extend X509v3 Subject Alternative Name in apiserver.crt $ ssh master02 //生成2048位的密钥对 $ openssl genrsa -out apiserver-master02.key 2048 //生成证书签署请求文件 $ sudo openssl req -new \\ -key apiserver-master02.key \\ -subj \"/CN=kube-apiserver,\" \\ -out apiserver-master02.csr // 编辑apiserver-master02.ext文件，内容如下： $ cat apiserver-master02.ext subjectAltName = DNS:master02,DNS:kubernetes,DNS:kubernetes.default,DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, IP:10.96.0.1, IP:10.24.138.208 // 使用ca.key和ca.crt签署上述请求 $ sudo openssl x509 -req \\ -in apiserver-master02.csr \\ -CA /etc/kubernetes/pki/ca.crt \\ -CAkey /etc/kubernetes/pki/ca.key \\ -CAcreateserial \\ -out apiserver-master02.crt \\ -days 365 \\ -extfile apiserver-master02.ext Signature ok subject=/CN=10.24.138.208 Getting CA Private Key //查看新生成的证书： $ sudo openssl x509 -noout -text -in apiserver-master02.crt Certificate: Data: Version: 3 (0x2) Serial Number: 16019625340257831745 (0xde51245f10ea0b41) Signature Algorithm: sha256WithRSAEncryption Issuer: CN=kubernetes Validity Not Before: May 12 08:40:40 2017 GMT Not After : May 12 08:40:40 2018 GMT Subject: CN=kube-apiserver, Subject Public Key Info: ... ... X509v3 extensions: X509v3 Subject Alternative Name: DNS:master02, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, IP Address:10.96.0.1, IP Address:10.24.138.208 using new certificate for apiserver $ sudo cat /etc/kubernetes/manifests/kube-apiserver.yaml .. - --tls-cert-file=/etc/kubernetes/pki/apiserver-master02.crt - --tls-private-key-file=/etc/kubernetes/pki/apiserver-master02.key .. renew work node backup $ mkdir k8s-cert-expired $ sudo cp -rp /var/lib/kubelet/pki k8s-cert-expired/ $ sudo cp -r /var/lib/kubelet/pki{,.orig} restart kubelet $ sudo rm -rf /var/lib/kubelet/pki/* $ sudo systemctl restart kubelet $ sudo systemctl status kubelet.service certificates generation pfx $ grep certificate-authority-data ~/.kube/config | awk '{print $2}' | base64 -d > ca.crt $ grep client-certificate-data ~/.kube/config | awk '{print $2}' | base64 -d > client.crt $ grep client-key-data ~/.kube/config | awk '{print $2}' | base64 -d > client.key $ openssl pkcs12 -export -out cert.pfx -inkey client.key -in client.crt -certfile ca.crt Enter Export Password: marslo Verifying - Enter Export Password: marslo $ ls ca.crt cert.pfx client.crt client.key renew kubeconfig only basic environment [!TIP] $ kubectl version --short Client Version: v1.12.3 Server Version: v1.12.3 certs $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | egrep -v 'ca.crt$' | xargs -L 1 -t -i bash -c 'openssl x509 -noout -text -in {} | grep After' bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/front-proxy-client.crt | grep Not Not After : May 28 11:48:39 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/server.crt | grep Not Not After : May 28 11:48:40 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/peer.crt | grep Not Not After : May 28 11:48:41 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/healthcheck-client.crt | grep Not Not After : May 28 11:48:40 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver.crt | grep Not Not After : May 28 11:48:37 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-kubelet-client.crt | grep Not Not After : May 28 11:48:38 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-etcd-client.crt | grep Not Not After : May 28 11:48:42 2022 GMT kubectl config view $ kubectl config get-contexts CURRENT NAME CLUSTER AUTHINFO NAMESPACE * kubernetes-admin@kubernetes kubernetes kubernetes-admin $ kubectl config current-context kubernetes-admin@kubernetes $ kubectl config view -o jsonpath={.contexts}; echo [map[name:kubernetes-admin@kubernetes context:map[user:kubernetes-admin cluster:kubernetes]]] $ kubectl config view -o jsonpath={.users}; echo [map[name:kubernetes-admin user:map[client-certificate-data:REDACTED client-key-data:REDACTED]]] $ kubectl config view apiVersion: v1 clusters: - cluster: certificate-authority-data: DATA+OMITTED server: https://1.2.3.4:1234 name: kubernetes contexts: - context: cluster: kubernetes user: kubernetes-admin name: kubernetes-admin@kubernetes current-context: kubernetes-admin@kubernetes kind: Config preferences: {} users: - name: kubernetes-admin user: client-certificate-data: REDACTED client-key-data: REDACTED kubeconfig $ kubectl --kubeconfig=config get namespace error: the server doesn't have a resource type \"namespace\" $ sudo grep 'client-certificate-data' $HOME/.kube/config | awk '{print $2}' | base64 -d | openssl x509 -text -noout | grep -E 'Not|Subject:' Not Before: Dec 8 05:43:01 2020 GMT Not After : Dec 8 05:43:01 2021 GMT Subject: O=system:masters, CN=kubernetes-admin renew kubeconfig references: Configure certificates for user accounts kubernetes > about the cluster-admin cluster role binding Subjects: configuration files config subject controller-manager.conf Subject: CN=system:kube-contdoller-manager admin.conf Subject: O=system:masters, CN=kubernetes-admin scheduler.conf Subject: O=system:masters, CN=system:kube-scheduler kubelet.conf Subject: O=system:nodes, CN=system:node:kubernetes-master01 ( CN=system:node: ) configuration files certs subject front-proxy-client.crt Subject: CN=front-proxy-client server.crt Subject: CN=kubernetes-master01 ( CN=HOSTNAME ) peer.crt Subject: CN=kubernetes-master01 ( CN=HOSTNAME ) healthcheck-client.crt Subject: O=system:masters, CN=kube-etcd-healthcheck-client apiserver.crt Subject: CN=kube-apiserver apiserver-kubelet-client.crt Subject: O=system:masters, CN=kube-apiserver-kubelet-client apiserver-etcd-client.crt Subject: O=system:masters, CN=kube-apiserver-etcd-client generate new certificate (csr) $ openssl req -subj \"/O=system:masters/CN=kubernetes-admin\" \\ -new \\ -newkey rsa:2048 \\ -nodes \\ -out marslo.csr \\ -keyout marslo.key \\ -out marslo.csr or$ openssl genrsa -out marslo.key 2048 $ openssl req -new -key marslo.key -out marslo.csr -subj \"/O=system:masters/CN=kubernetes-admin\" signing the certificate via ca.crt $ sudo openssl x509 -req \\ -in marslo.csr \\ -CA /etc/kubernetes/pki/ca.crt \\ -CAkey /etc/kubernetes/pki/ca.key \\ -CAcreateserial \\ -out marslo.crt \\ -days 365 \\ -sha256 result $ ls -Altrh . /etc/kubernetes/pki/ca* -rw------- 1 root root 1.7K Dec 6 2018 ca.key -rw-r--r-- 1 root root 1.1K Dec 6 2018 ca.crt -rw-r--r-- 1 root root 17 Dec 15 01:31 ca.srl $ ls -Altrh ./ -rw-rw-r-- 1 devops devops 1.7K Dec 15 01:31 marslo.key -rw-rw-r-- 1 devops devops 936 Dec 15 01:31 marslo.csr -rw-r--r-- 1 root root 1021 Dec 15 01:31 marslo.crt $ sudo openssl x509 -in marslo.crt -text -noout | grep -E 'Subject:|Not' Not Before: Dec 15 09:31:55 2021 GMT Not After : Dec 15 09:31:55 2022 GMT Subject: O=system:masters, CN=kubernetes-admin [!TIP] $ cp ~/.kube/config config $ kubectl --kubeconfig=config get ns error: You must be logged in to the server (Unauthorized) renew via kubeadm alpha 1.15- $ sudo kubeadm [--config ~/kubeadm.yaml] alpha phase kubeconfig all renew all certs$ sudo kubeadm [--config ~/kubeadm.yaml] alpha phase certs renew all re-generate all certs$ sudo kubeadm [--config ~/kubeadm.yaml] alpha phase certs all v1.15+ $ sudo kubeadm [--config ~/kubeadm.yaml] alpha certs renew all renew all certs$ sudo kubeadm [--config ~/kubeadm.yaml] alpha certs renew all renew via kubectl config reference: kubectlp-command#config $ kubectl config set-credentials kubernetes-admin \\ --embed-certs=true \\ --certificate-authority=/etc/kubernetes/pki/ca.crt \\ --client-certificate=./marslo.crt \\ --client-key=./marslo.key \\ --kubeconfig=config $ kubectl config set-context kubernetes-admin@kubernetes \\ --cluster=kubernetes \\ --user=kubernetes-admin renew via base64 manually $ sed -re \"s/(.*client-certificate-data:)(.*)$/\\1 $(cat marslo.crt | base64 -w0)/g\" -i config $ sed -re \"s/(.*client-key-data:)(.*)$/\\1 $(cat marslo.key| base64 -w0)/g\" -i config vaildate $ kubectl --kubeconfig=config get ns | grep kube kube-public Active 3y10d kube-system Active 3y10d more details reference: Get user and group from current-context conf: # current kubeconfig context $ kubectl config view --raw -o json | jq \".users[] | select(.name==\\\"$(kubectl config view -o jsonpath='{.users[].name}')\\\")\" | jq -r '.user[\"client-certificate-data\"]' | base64 -d | openssl x509 -text | grep \"Subject:\" Subject: O=system:masters, CN=kubernetes-admin # for all confs $ find /etc/kubernetes/ -type f -name \"*.conf\" -print | grep -Ev 'kubelet.conf$' | xargs -L1 -t -i bash -c \"sudo grep 'client-certificate-data' {} \\ | awk '{print \\$2}' \\ | base64 -d \\ | openssl x509 -noout -text \\ | grep --color=always Subject\\: \\ \" bash -c sudo grep 'client-certificate-data' /etc/kubernetes/controller-manager.conf | awk '{print $2}' | base64 -d | openssl x509 -noout -text | grep --color=always Subject\\: Subject: CN=system:kube-controller-manager bash -c sudo grep 'client-certificate-data' /etc/kubernetes/admin.conf | awk '{print $2}' | base64 -d | openssl x509 -noout -text | grep --color=always Subject\\: Subject: O=system:masters, CN=kubernetes-admin bash -c sudo grep 'client-certificate-data' /etc/kubernetes/scheduler.conf | awk '{print $2}' | base64 -d | openssl x509 -noout -text | grep --color=always Subject\\: Subject: O=system:masters, CN=system:kube-scheduler $ sudo openssl x509 -in $(sudo grep 'client-certificate' /etc/kubernetes/kubelet.conf | awk '{print $2}') -text -noout | grep --color=always Subject\\: Subject: O=system:nodes, CN=system:node:kubernetes-master01 certs $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | grep -Ev 'ca.crt$' | xargs -L1 -t -i bash -c 'openssl x509 -noout -text -in {} | grep --color=always Subject\\:' bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/front-proxy-client.crt | grep --color=always Subject\\: Subject: CN=front-proxy-client bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/server.crt | grep --color=always Subject\\: Subject: CN=kubernetes-master01 bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/peer.crt | grep --color=always Subject\\: Subject: CN=kubernetes-master01 bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/healthcheck-client.crt | grep --color=always Subject\\: ubject: O=system:masters, CN=kube-apiserver-etcd-client bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver.crt | grep --color=always Subject\\: Subject: CN=kube-apiserver bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-kubelet-client.crt | grep --color=always Subject\\: Subject: O=system:masters, CN=kube-apiserver-kubelet-client bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-etcd-client.crt | grep --color=always Subject\\: Subject: O=system:masters, CN=kube-apiserver-etcd-client about system:masters $ kubectl get clusterrolebinding cluster-admin -o yaml $ kubectl get clusterrolebinding cluster-admin -o json | jq -r .subjects[0].name system:masters $ kubectl get clusterrolebindings -o json | jq -r '.items[] | select(.subjects[0].kind==\"Group\") | select(.subjects[0].name==\"system:masters\") | .metadata.name' cluster-admin reference [!TIP] reference: * Kubernetes中的证书工作机制 证书 手动档搭建 Kubernetes HA 集群 Certificates PKI certificates and requirements Generate self-signed certificates Certification authority root certificate expiry and renewal Certificates CUSTOM CERTIFICATE AUTHORITY Certificate Authority with CFSSL K8S Cluster tls Certificate Management Access Kubernetes API with Client Certificates Public-key cryptography and X.509 Bootstrapping Kubernetes Clusters with kubeadm how to renew the certificate when apiserver cert expired? Can not access my kubernetes cluster even if all my server certificates are valid The Cluster API Book K8S 集群中的认证、授权与 kubeconfig Certificate Signing Requests Authenticating Kubernetes – KUBECONFIG and Context The connection to the server x.x.x.:6443 was refused - did you specify the right host or port? Kubernetes Troubleshooting kubectl Error: The connection to the server x.x.x.x:6443 was refused – did you specify the right host or port? Required certificates: Default CN Parent CA O (in Subject) kind hosts (SAN) kube-etcd etcd-ca - server, client hostname Host_IP localhost 127.0.0.1 kube-etcd-peer etcd-ca - server, client hostname Host_IP localhost 127.0.0.1 kube-etcd-healthcheck-client etcd-ca - client - kube-apiserver-etcd-client etcd-ca system:masters client - kube-apiserver kubernetes-ca - server hostname, Host_IP, advertise_IP, [1] kube-apiserver-kubelet-client kubernetes-ca system:masters client - front-proxy-client kubernetes-front-proxy-ca - client - Certificate paths Default CN recommended key path recommended cert path command key argument cert argument etcd-ca etcd/ca.key etcd/ca.crt kube-apiserver - --etcd-cafile kube-apiserver-etcd-client apiserver-etcd-client.key apiserver-etcd-client.crt kube-apiserver --etcd-keyfile --etcd-certfile kubernetes-ca ca.key ca.crt kube-apiserver - --client-ca-file kubernetes-ca ca.key ca.crt kube-controller-manager --cluster-signing-key-file --client-ca-file --root-ca-file --cluster-signing-cert-file kube-apiserver apiserver.key apiserver.crt kube-apiserver --tls-private-key-file --tls-cert-file kube-apiserver-kubelet-client apiserver-kubelet-client.key apiserver-kubelet-client.crt kube-apiserver --kubelet-client-key --kubelet-client-certificate front-proxy-ca front-proxy-ca.key front-proxy-ca.crt kube-apiserver - --requestheader-client-ca-file front-proxy-ca front-proxy-ca.key front-proxy-ca.crt kube-controller-manager - --requestheader-client-ca-file front-proxy-client front-proxy-client.key front-proxy-client.crt kube-apiserver --proxy-client-key-file --proxy-client-cert-file etcd-ca etcd/ca.key etcd/ca.crt etcd - --trusted-ca-file --peer-trusted-ca-file kube-etcd etcd/server.key etcd/server.crt etcd --key-file --cert-file kube-etcd-peer etcd/peer.key etcd/peer.crt etcd --peer-key-file --peer-cert-file etcd-ca - etcd/ca.crt etcdctl - --cacert kube-etcd-healthcheck-client etcd/healthcheck-client.key etcd/healthcheck-client.crt etcdctl --key --cert Configure certificates for user accounts filename credential name Default CN O (in Subject) admin.conf default-admin kubernetes-admin system:masters kubelet.conf default-auth system:node: (see note) system:nodes controller-manager.conf default-controller-manager system:kube-controller-manager - scheduler.conf default-scheduler system:kube-scheduler - files are used as follows filename command comment admin.conf kubectl Configures administrator user for the cluster kubelet.conf kubelet One required for each node in the cluster. controller-manager.conf kube-controller-manager Must be added to manifest in manifests/kube-controller-manager.yaml scheduler.conf kube-scheduler Must be added to manifest in manifests/kube-scheduler.yaml Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:22 "},"virtualization/kubernetes/namespace.html":{"url":"virtualization/kubernetes/namespace.html","title":"namespace","keywords":"","body":" Table of Contents generated with DocToc remove stuck namespace check which item occupied the resource remove challenge.certmanager list list all namespaces with name only list all quota in cluster Reference remove stuck namespace check which item occupied the resource $ myns='marslo-test' $ for _i in $(kubectl api-resources --verbs=list --namespaced -o name); do echo ----- ${_i} ------ kubectl get -n ${myns} ${_i} done # result: ----- configmaps ------ No resources found. ----- endpoints ------ No resources found. ----- events ------ No resources found. ----- limitranges ------ No resources found. ----- persistentvolumeclaims ------ No resources found. ----- pods ------ No resources found. ----- podtemplates ------ No resources found. ----- replicationcontrollers ------ No resources found. ----- resourcequotas ------ No resources found. ----- secrets ------ No resources found. ----- serviceaccounts ------ No resources found. ----- services ------ No resources found. ----- controllerrevisions.apps ------ No resources found. ----- daemonsets.apps ------ No resources found. ----- deployments.apps ------ No resources found. ----- replicasets.apps ------ No resources found. ----- statefulsets.apps ------ No resources found. ----- horizontalpodautoscalers.autoscaling ------ No resources found. ----- cronjobs.batch ------ No resources found. ----- jobs.batch ------ No resources found. ----- certificaterequests.certmanager.k8s.io ------ No resources found. ----- certificates.certmanager.k8s.io ------ No resources found. ----- challenges.certmanager.k8s.io ------ NAME STATE DOMAIN AGE marslo-dashboard-2318568841-0 pending marslo-dashboard.mycompany.com 72m ----- issuers.certmanager.k8s.io ------ No resources found. ----- orders.certmanager.k8s.io ------ No resources found. ----- leases.coordination.k8s.io ------ No resources found. ----- events.events.k8s.io ------ No resources found. ----- daemonsets.extensions ------ No resources found. ----- deployments.extensions ------ No resources found. ----- ingresses.extensions ------ No resources found. ----- networkpolicies.extensions ------ No resources found. ----- replicasets.extensions ------ No resources found. ----- pods.metrics.k8s.io ------ No resources found. ----- ingresses.networking.k8s.io ------ No resources found. ----- networkpolicies.networking.k8s.io ------ No resources found. ----- poddisruptionbudgets.policy ------ No resources found. ----- rolebindings.rbac.authorization.k8s.io ------ No resources found. ----- roles.rbac.authorization.k8s.io ------ No resources found. remove challenge.certmanager $ k -n marslo-test delete challenges.certmanager.k8s.io marslo-dashboard-2318568841-0 --force --grace-period=0 warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely. challenge.certmanager.k8s.io \"marslo-dashboard-2318568841-0\" force deleted #### stuck #### $ k get ns NAME STATUS AGE cert-manager Active 103d ... marslo-test Terminating 103d ... $ k delete namespace cert-manager $ k -n marslo-test describe challenges.certmanager.k8s.io Name: marslo-dashboard-2318568841-0 Namespace: marslo-test Labels: acme.cert-manager.io/order-name=marslo-dashboard-2318568841 Annotations: API Version: certmanager.k8s.io/v1alpha1 Kind: Challenge Metadata: Creation Timestamp: 2020-01-02T13:24:46Z Deletion Grace Period Seconds: 0 Deletion Timestamp: 2020-01-02T13:26:37Z Finalizers: finalizer.acme.cert-manager.io # Please edit the object below. Lines beginning with a '#' will be ignored, Generation: 5 Owner References: API Version: certmanager.k8s.io/v1alpha1 Block Owner Deletion: true Controller: true Kind: Order Name: marslo-dashboard-2318568841 UID: 06c2cc11-fd96-473d-b672-9e7495dee3bf Resource Version: 28236617 Self Link: /apis/certmanager.k8s.io/v1alpha1/namespaces/marslo-test/challenges/marslo-dashboard-2318568841-0 UID: cc6f18e3-1035-4f9f-aa25-9fdcf2340d36 Spec: Authz URL: https://acme-v02.api.letsencrypt.org/acme/authz-v3/2065855459 Config: http01: Ingress Class: nginx Dns Name: marslo-dashboard.mycompany.com Issuer Ref: Kind: ClusterIssuer Name: marslo-cert Key: cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY.TjEqvfuHdQXjDvwPm1FMc5pU4scT3qTDs5j4qc8XAqM Token: cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY Type: http-01 URL: https://acme-v02.api.letsencrypt.org/acme/chall-v3/2065855459/raQniA Wildcard: false Status: Presented: true Processing: true Reason: Waiting for http-01 challenge propagation: failed to perform self check GET request 'http://marslo-dashboard.mycompany.com/.well-known/acme-challenge/cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY': Get http://marslo-dashboard.mycompany.com/.well-known/acme-challenge/cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY: dial tcp: lookup marslo-dashboard.mycompany.com on 10.96.0.10:53: no such host State: pending Events: ## inspired from https://github.com/jetstack/cert-manager/issues/1582#issuecomment-515354712 $ k -n marslo-test edit challenges.certmanager.k8s.io marslo-dashboard-2318568841-0 challenge.certmanager.k8s.io/marslo-dashboard-2318568841-0 edited ## manual remove the finalizer list list all namespaces with name only $ k get ns -o name or $ k get ns --no-headers -o name list all quota in cluster while read ns; do echo \"~~~~~~~~~~~~ ${ns} ~~~~~~~~~~~~~\" k4 -n ${ns} describe quota done or $ while IFS= read -rd ' ' ns; do echo \"~~~> ${ns}\" k -n ${ns} describe quota done Reference deleting namespace stuck at \"Terminating\" state Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:21 "},"virtualization/kubernetes/network.html":{"url":"virtualization/kubernetes/network.html","title":"network","keywords":"","body":" Table of Contents generated with DocToc devops-kubernetes-master devops-kubernetes-02 /etc/network/interface iface eno3 inet dhcp auto eno3 iface eno3 inet static address 192.168.11.121 netmask 255.255.254.0 gateway 192.168.10.1 dns-nameservers 61.139.2.69 218.6.200.139 network info Route Details devops-kubernetes-03 devops-kubernetes-master devops-kubernetes-02 /etc/network/interface $ cat /etc/network/interfaces auto lo iface lo inet loopback auto eno1 iface eno1 inet static address 130.147.180.86 netmask 255.255.255.192 gateway 130.147.180.65 dns-nameservers 130.147.236.5 161.92.35.78 dns-search cn-132.lan.mycompany.com » /etc/network/interfaces # interfaces(5) file used by ifup(8) and ifdown(8) $ cat /etc/network/interfaces # interfaces(5) file used by ifup(8) and ifdown(8) auto lo iface lo inet loopback auto eno1 iface eno1 inet static address 130.147.180.86 netmask 255.255.255.192 gateway 130.147.180.65 dns-nameservers 130.147.236.5 161.92.35.78 dns-search cn-132.lan.mycompany.com broadcast 130.147.219.127 network 130.147.219.0 auto eno3 # iface eno3 inet dhcp # auto eno3 # iface eno3 inet static # address 192.168.11.121 # netmask 255.255.254.0 # gateway 192.168.10.1 # dns-nameservers 61.139.2.69 218.6.200.139 network info $ nmcli [-p] d[evice] show » Click here to check details $ nmcli -p d show eno1 =============================================================================== Device details (eno1) =============================================================================== GENERAL.DEVICE: eno1 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8C ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 130.147.180.86/26 IP4.GATEWAY: -- IP4.ROUTE[1]: dst = 161.92.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[2]: dst = 130.145.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[3]: dst = 180.166.223.190/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[4]: dst = 185.46.212.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[5]: dst = 130.140.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[6]: dst = 130.147.236.5/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[7]: dst = 130.147.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[8]: dst = 161.91.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[9]: dst = 161.84.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[10]: dst = 169.254.0.0/16, nh = 0.0.0.0, mt = 1000 IP4.ROUTE[11]: dst = 185.166.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[12]: dst = 130.146.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[13]: dst = 137.55.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[14]: dst = 161.83.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[15]: dst = 42.99.164.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[16]: dst = 161.85.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[17]: dst = 161.92.35.78/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[18]: dst = 140.207.91.234/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[19]: dst = 161.88.0.0/16, nh = 0.0.0.0, mt = 0 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318c/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- $ nmcli -p device show eno3 =============================================================================== Device details (eno3) =============================================================================== GENERAL.DEVICE: eno3 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8E ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 192.168.11.121/23 IP4.GATEWAY: 192.168.10.1 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318e/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- $ nmcli -p device show =============================================================================== Device details (eno2) =============================================================================== GENERAL.DEVICE: eno2 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8D ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 20 (unavailable) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: off ------------------------------------------------------------------------------- =============================================================================== Device details (eno4) =============================================================================== GENERAL.DEVICE: eno4 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8F ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 20 (unavailable) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: off ------------------------------------------------------------------------------- =============================================================================== Device details (eno1) =============================================================================== GENERAL.DEVICE: eno1 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8C ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 130.147.180.86/26 IP4.GATEWAY: -- IP4.ROUTE[1]: dst = 161.92.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[2]: dst = 130.145.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[3]: dst = 180.166.223.190/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[4]: dst = 185.46.212.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[5]: dst = 130.140.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[6]: dst = 130.147.236.5/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[7]: dst = 130.147.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[8]: dst = 161.91.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[9]: dst = 161.84.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[10]: dst = 169.254.0.0/16, nh = 0.0.0.0, mt = 1000 IP4.ROUTE[11]: dst = 185.166.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[12]: dst = 130.146.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[13]: dst = 137.55.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[14]: dst = 161.83.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[15]: dst = 42.99.164.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[16]: dst = 161.85.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[17]: dst = 161.92.35.78/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[18]: dst = 140.207.91.234/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[19]: dst = 161.88.0.0/16, nh = 0.0.0.0, mt = 0 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318c/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- =============================================================================== Device details (eno3) =============================================================================== GENERAL.DEVICE: eno3 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8E ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 192.168.11.121/23 IP4.GATEWAY: 192.168.10.1 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318e/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- =============================================================================== Device details (lo) =============================================================================== GENERAL.DEVICE: lo ------------------------------------------------------------------------------- GENERAL.TYPE: loopback ------------------------------------------------------------------------------- GENERAL.HWADDR: 00:00:00:00:00:00 ------------------------------------------------------------------------------- GENERAL.MTU: 65536 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 127.0.0.1/8 IP4.GATEWAY: -- ------------------------------------------------------------------------------- IP6.ADDRESS[1]: ::1/128 IP6.GATEWAY: -- ------------------------------------------------------------------------------- Route Details $ route -n Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface 0.0.0.0 192.168.10.1 0.0.0.0 UG 100 0 0 eno3 42.99.164.34 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 130.140.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.145.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.146.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.147.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.147.180.64 0.0.0.0 255.255.255.192 U 0 0 0 eno1 130.147.236.5 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 137.55.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 140.207.91.234 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 161.83.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.84.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.85.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.88.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.91.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.92.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.92.35.78 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 169.254.0.0 0.0.0.0 255.255.0.0 U 1000 0 0 eno1 180.166.223.190 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 185.46.212.34 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 185.166.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 192.168.10.0 0.0.0.0 255.255.254.0 U 100 0 0 eno3 devops-kubernetes-03 $ ifconfig en1 en1: flags=8863 mtu 1500 ether 6c:96:cf:f2:01:0a inet6 fe80::81d:93a6:a4d4:32c2%en1 prefixlen 64 secured scopeid 0x6 inet 192.168.10.124 netmask 0xfffffe00 broadcast 192.168.11.255 nd6 options=201 media: autoselect status: active $ ifconfig en0 en0: flags=8863 mtu 1500 options=10b ether 78:7b:8a:bc:c2:3c inet6 fe80::1843:dfe3:4c35:c38%en0 prefixlen 64 secured scopeid 0x5 inet 130.147.182.248 netmask 0xfffffe00 broadcast 130.147.183.255 nd6 options=201 media: autoselect (100baseTX ) status: active $ ifconfig lo0: flags=8049 mtu 16384 options=1203 inet 127.0.0.1 netmask 0xff000000 inet6 ::1 prefixlen 128 inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 nd6 options=201 gif0: flags=8010 mtu 1280 stf0: flags=0<> mtu 1280 XHC20: flags=0<> mtu 0 en0: flags=8863 mtu 1500 options=10b ether 78:7b:8a:bc:c2:3c inet6 fe80::1843:dfe3:4c35:c38%en0 prefixlen 64 secured scopeid 0x5 inet 130.147.182.248 netmask 0xfffffe00 broadcast 130.147.183.255 nd6 options=201 media: autoselect (100baseTX ) status: active en1: flags=8863 mtu 1500 ether 6c:96:cf:f2:01:0a inet6 fe80::81d:93a6:a4d4:32c2%en1 prefixlen 64 secured scopeid 0x6 inet 192.168.10.124 netmask 0xfffffe00 broadcast 192.168.11.255 nd6 options=201 media: autoselect status: active en2: flags=8963 mtu 1500 options=60 ether 2a:00:02:31:1e:a0 media: autoselect status: inactive en3: flags=8963 mtu 1500 options=60 ether 2a:00:02:31:1e:a1 media: autoselect status: inactive bridge0: flags=8863 mtu 1500 options=63 ether 2a:00:02:31:1e:a0 Configuration: id 0:0:0:0:0:0 priority 0 hellotime 0 fwddelay 0 maxage 0 holdcnt 0 proto stp maxaddr 100 timeout 1200 root id 0:0:0:0:0:0 priority 0 ifcost 0 port 0 ipfilter disabled flags 0x2 member: en2 flags=3 ifmaxaddr 0 port 7 priority 0 path cost 0 member: en3 flags=3 ifmaxaddr 0 port 8 priority 0 path cost 0 nd6 options=201 media: status: inactive p2p0: flags=8843 mtu 2304 ether 0e:96:cf:f2:01:0a media: autoselect status: inactive awdl0: flags=8943 mtu 1484 ether 6e:66:62:10:bb:fa inet6 fe80::6c66:62ff:fe10:bbfa%awdl0 prefixlen 64 scopeid 0xb nd6 options=201 media: autoselect status: active utun0: flags=8051 mtu 2000 inet6 fe80::2c33:8275:3276:346f%utun0 prefixlen 64 scopeid 0xc nd6 options=201 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:20 "},"virtualization/kubernetes/events.html":{"url":"virtualization/kubernetes/events.html","title":"events","keywords":"","body":" Table of Contents generated with DocToc get info list all warning events list particular events get info list all warning events $ kubectl get events --field-selector type=Warning --all-namespaces --sort-by='{.lastTimestamp}' list particular events $ k get event --field-selector=involvedObject.name =foo -w Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:23 "},"virtualization/kubernetes/node.html":{"url":"virtualization/kubernetes/node.html","title":"node","keywords":"","body":" Table of Contents generated with DocToc list node with label update label of node show show with labels show particular labels show with particular columns show only scheduled nodes sort sort via kubelet version list node with label $ k get no -l = update label of node $ k label no = [--overwrite] show show with labels $ k get no --show-labels show particular labels -label-columns$ k get no --label-columns e.g.:$ k4 get nodes --label-columns jenkins NAME STATUS ROLES AGE VERSION JENKINS k8s-node01 Ready worker 545d v1.12.3 k8s-node02 Ready worker 597d v1.12.3 k8s-node03 Ready worker 217d v1.12.3 k8s-node04 Ready worker 52d v1.12.3 k8s-node05 Ready worker 589d v1.12.3 k8s-node06 Ready master 2y33d v1.12.3 master k8s-node07 Ready master 589d v1.12.3 k8s-node08 Ready worker 535d v1.12.3 -l$ k get no --show-labels -l node-role.kubernetes.io/master show with particular columns $ k get no -o custom-columns=NAME:.metadata.name,VER:.status.nodeInfo.kubeletVersion NAME VER k8s-node01 v1.12.3 k8s-node02 v1.12.3 k8s-node03 v1.12.3 ... show only scheduled nodes $ k get no \\ --output 'jsonpath={range $.items[*]}{.metadata.name} {.spec.taints[*].effect}{\"\\n\"}{end}' \\ | awk '!/NoSchedule/{print $1}' sort sort via kubelet version $ k get node --sort-by={.status.nodeInfo.kubeletVersion} or$ k get nodes --sort-by={.metadata.labels.\"kubernetes\\.io\\/role\"} Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:21 "},"virtualization/kubernetes/api.html":{"url":"virtualization/kubernetes/api.html","title":"api","keywords":"","body":" Table of Contents generated with DocToc acess cluster references: Accessing Clusters [!NOTE] There are several different proxies you may encounter when using Kubernetes: The kubectl proxy: runs on a user's desktop or in a pod proxies from a localhost address to the Kubernetes apiserver client to proxy uses HTTP proxy to apiserver uses HTTPS locates apiserver adds authentication headers The apiserver proxy: is a bastion built into the apiserver connects a user outside of the cluster to cluster IPs which otherwise might not be reachable runs in the apiserver processes client to proxy uses HTTPS (or http if apiserver so configured) proxy to target may use HTTP or HTTPS as chosen by proxy using available information can be used to reach a Node, Pod, or Service does load balancing when used to reach a Service The kube proxy: runs on each node proxies UDP and TCP does not understand HTTP provides load balancing is only used to reach services A Proxy/Load-balancer in front of apiserver(s): existence and implementation varies from cluster to cluster (e.g. nginx) sits between all clients and one or more apiservers acts as load balancer if there are several apiservers. Cloud Load Balancers on external services: are provided by some cloud providers (e.g. AWS ELB, Google Cloud Load Balancer) are created automatically when the Kubernetes service has type LoadBalancer use UDP/TCP only implementation varies by cloud provider. acess cluster $ APISERVER=$(kubectl config view --minify | grep server | cut -f 2- -d \":\" | tr -d \" \") $ TOKEN=$(kubectl describe secret default-token | grep -E '^token' | cut -f2 -d':' | tr -d \" \") $ curl ${APISERVER}/api --header \"Authorization: Bearer ${TOKEN}\" --insecure { \"kind\": \"APIVersions\", \"versions\": [ \"v1\" ], \"serverAddressByClientCIDRs\": [ { \"clientCIDR\": \"0.0.0.0/0\", \"serverAddress\": \":6443\" } ] } using jsonpath$ APISERVER=$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}') $ TOKEN=$(kubectl get secret default-token -o jsonpath='{.data.token}' | base64 --decode) $ curl ${APISERVER}/api --header \"Authorization: Bearer ${TOKEN}\" --insecure Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:20 "},"virtualization/kubernetes/tools.html":{"url":"virtualization/kubernetes/tools.html","title":"tools","keywords":"","body":" Table of Contents generated with DocToc etcd check healthy re-add etcd etcd references: Operating etcd clusters for Kubernetes Set up a High Availability etcd Cluster with kubeadm check healthy $ kubectl get --raw=/healthz/etcd re-add etcd $ ssh devops@kubernets.master $ docker run -it \\ -v /var/lib/etcd:/var/lib/etcd \\ -v /etc/kubernetes/pki/etcd:/etc/kubernetes/pki/etcd \\ -p 2380:2380 \\ -p 2379:2379 \\ --network=host \\ k8s.gcr.io/etcd:3.2.24 # running inside docker $ etcdctl --ca-file /etc/kubernetes/pki/etcd/ca.crt \\ --cert-file /etc/kubernetes/pki/etcd/peer.crt \\ --key-file /etc/kubernetes/pki/etcd/peer.key \\ -endpoints=https://:2379,https://:2379,https://:2379 \\ member list >> a874c87fd42044f: name= peerURLs=https://:2380 clientURLs=https://:2379 isLeader=true >> 3be12ef2ee5f92e7(unstarted): name= peerURLs=https://:2380 >> da3e2155721a00f6: name= peerURLs=https://:2380 clientURLs=https://:2379 isLeader=false # remove \"unstarted\" node $ etcdctl --ca-file /etc/kubernetes/pki/etcd/ca.crt \\ --cert-file /etc/kubernetes/pki/etcd/peer.crt \\ --key-file /etc/kubernetes/pki/etcd/peer.key \\ -endpoints=https://:2379,https://:2379,https://:2379 \\ member remove 3be12ef2ee5f92e7 # re-add again $ etcdctl --ca-file /etc/kubernetes/pki/etcd/ca.crt \\ --cert-file /etc/kubernetes/pki/etcd/peer.crt \\ --key-file /etc/kubernetes/pki/etcd/peer.key \\ -endpoints=https://:2379,https://:2379,https://:2379 \\ member add https://:2380 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:23 "},"virtualization/kubernetes/monitor.html":{"url":"virtualization/kubernetes/monitor.html","title":"monitor","keywords":"","body":" Table of Contents generated with DocToc grafana environment setup dashboard grafana settings api code pool grafana references: * Setting Up Kubernetes Dashboard * Deploy Grafana Enterprise on Kubernetes * Deploy Grafana on Kubernetes * Kubernetes Integration * Install plugin from dockerfile * grafana/grafana-docker Scaling out Grafana with Kubernetes and AWS How To Setup Grafana On Kubernetes Monitoring Kubernetes Clusters with Grafana Configure a Grafana Docker image Configure Grafana Grafana 6.2 documentation : Installing using Docker Restart Grafana Grafana Loki Concise Tutorial Grafana CLI * Prometheus data source * GRAFANA SUPPORT FOR PROMETHEUS * Create Grafana Dashboards with Prometheus Metrics environment [!TIP] reference Do not use environment variables to add new configuration settings. Instead, use environmental variables to override existing options. To override an option:GF__ If you need to specify the version of a plugin, then you can add it to the GF_INSTALL_PLUGINS environment variable. Otherwise, the latest is used. For example:-e \"GF_INSTALL_PLUGINS=grafana-clock-panel 1.0.1,grafana-simple-json-datasource 1.3.5\" # for pvc kubems-01 ~ $ mkdir -p /opt/grafana/plugins kubems-01 ~ $ sudo chown -R 472:472 $_ # https://grafana.com/docs/grafana/latest/installation/docker/#migration-from-a-previous-version-of-the-docker-container-to-5-1-or-later # 104:104 for version user id changes Version User User ID grafana 104 >= 5.1 grafana 472 path SETTING DEFAULT VALUE GF_PATHS_CONFIG /etc/grafana/grafana.ini GF_PATHS_DATA /var/lib/grafana GF_PATHS_HOME /usr/share/grafana GF_PATHS_LOGS /var/log/grafana GF_PATHS_PLUGINS /var/lib/grafana/plugins GF_PATHS_PROVISIONING /etc/grafana/provisioning environment ENVIRONMENT VARIABLE EXAMPLE GF_INSTALL_PLUGINS grafana-kubernetes-app,grafana-piechart-panel,http://my.com/plugin.zip GF_PATHS_PLUGINS /data/grafana/plugins GF_SERVER_ROOT_URL https://my.grafana.com GF_SECURITY_ADMIN_PASSWORD admin GF_DEFAULT_INSTANCE_NAME - GF_SECURITY_ADMIN_USER - GF_DATABASE_TYPE mysql GF_DATABASE_HOST - setup ns $ cat sa $ cat pv & pvc $ cat deploy $ cat svc $ cat ingress $ cat dashboard kubernetes cluster monitoring devopsprodigy-kubegraf-app install via grafana-cli $ grafana-cli plugins install devopsprodigy-kubegraf-app setup sa and cluster role $ kubectl create ns kubegraf $ kubectl apply -f https://raw.githubusercontent.com/devopsprodigy/kubegraf/master/kubernetes/serviceaccount.yaml $ kubectl apply -f https://raw.githubusercontent.com/devopsprodigy/kubegraf/master/kubernetes/clusterrole.yaml $ kubectl apply -f https://raw.githubusercontent.com/devopsprodigy/kubegraf/master/kubernetes/clusterrolebinding.yaml $ kubectl apply -f https://raw.githubusercontent.com/devopsprodigy/kubegraf/master/kubernetes/secret.yaml create private certificate copy `/etc/kubernetes/pki/grafana-kubegraf.crt` to all masters $ openssl genrsa -out ~/grafana-kubegraf.key 2048 $ openssl req -new -key ~/grafana-kubegraf.key -out ~/grafana-kubegraf.csr -subj \"/CN=grafana-kubegraf/O=monitoring\" $ openssl x509 -req -in ~/grafana-kubegraf.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -out /etc/kubernetes/pki/grafana-kubegraf.crt -CAcreateserial get token$ kubectl get secret grafana-kubegraf-secret -o jsonpath={.data.token} -n kubegraf | base64 -d grafana-kubernetes-app @deprecated install via grafana-cli$ grafana-cli plugins install kubernetes-app setup$ cat ~/.kube/config | grep certificate-authority-data | awk '{print $2}' | base64 -d $ cat ~/.kube/config | grep client-certificate-data | awk '{print $2}' | base64 -d $ cat ~/.kube/config | grep client-key-data | awk '{print $2}' | base64 -d references: Dashboards Monitor Kubernetes easily with Grafana Export and import Create Grafana Dashboards with Prometheus Metrics cluster *315 - Kubernetes cluster monitoring (via Prometheus) *8588 - Kubernetes Deployment Statefulset Daemonset metrics 6417 - Kubernetes Cluster (Prometheus) 3662 - Prometheus 2.0 Overview node *1860 - Node Exporter Full *6287 - Host Overview *10242 - Node Exporter Full with Node Name namespace *9809 - Kubernetes Namespace Resources pod *747 - Kubernetes Pod Metrics *6336 - Kubernetes Pods jenkins 9524 - a Jenkins performance and health overview for jenkinsci/prometheus-plugin 9964 - Jenkins: Performance and Health Overview grafana settings clusterlabel_values(kube_pod_info, cluster) orlabel_values(node_cpu_seconds_total, cluster) instance label_values(apiserver_request_total{job=\"apiserver\"}, instance) node label_values(kube_node_info{cluster=\"$cluster\"}, node) orlabel_values(kubernetes_io_hostname) namespace label_values(kube_pod_info{cluster=\"$cluster\"}, namespace) pod label_values(kube_pod_info{cluster=\"$cluster\", namespace=\"$namespace\"}, pod) api references: Grafana Docker and data persistence reset password $ curl -X PUT -H \"Content-Type: application/json\" -d '{ \"oldPassword\": \"admin\", \"newPassword\": \"newpass\", \"confirmNew\": \"newpass\" }' http://admin:admin@:3000/api/user/password set grafana admin password $ docker exec -t grafana \\ bash -c 'grafana-cli --homepath /usr/share/grafana admin reset-admin-password \"{{ grafana_passwd }}\"' check if grafana can be accessed $ curl -s http://localhost:3000/api/org \\ -u {{ grafana_user }}:{{ grafana_passwd }} create datasoure in grafana $ curl -L \\ --header 'Content-Type: application/json' \\ --header 'Accept: application/json' \\ -d@//docker_data/grafana_conf/grafanacfg.output http://localhost:3000/api/datasources \\ -u {{ grafana_user }}:{{ grafana_passwd }} create TelegrafHost dashboard in grafana using jsonfile $ curl -L \\ --header 'Content-Type: application/json' \\ --header 'Accept: application/json' \\ -d@/home/Configfiles/dashboards/TelegrafHostMetrics.json http://localhost:3000/api/dashboards/db \\ -u {{ grafana_user }}:{{ grafana_passwd }} create DockerMetrics dashboard in grafana using jsonfile $ curl --header 'Content-Type: application/json' \\ --header 'Accept: application/json' \\ -d@/home/Configfiles/dashboards/DockerMetricsperContainer.json http://localhost:3000/api/dashboards/db \\ -u {{ grafana_user }}:{{ grafana_passwd }} create JVM dashboard in grafana using jsonfile $ curl --header 'Content-Type: application/json' \\ --header 'Accept: application/json' \\ -d@/home/Configfiles/dashboards/jvm-metrics-jolokia-2_rev1.json http://localhost:3000/api/dashboards/db \\ -u {{ grafana_user }}:{{ grafana_passwd }} code pool kubeless/manifests/monitoring kube-prometheus/manifests kubernetes-handbook/manifests/prometheus Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:21 "},"virtualization/docker/docker.html":{"url":"virtualization/docker/docker.html","title":"docker","keywords":"","body":" Table of Contents generated with DocToc docker internals cgoups namespace docker daemon docker completion Linux OSX docker build docker run run into dind run to override ENTRYPOINT runtime options with memory, cpus, and gpus run with always restart docker exec login docker container as root docker ps list without wrap filter format docker rmi docker rm docker stats docker inspect docker proxy docker build proxy docker pull proxy reference: Docker 学习笔记 Understanding the Docker Internals Ideas for a cgroups UI docker internals cgoups namespace docker daemon references: Protect the Docker daemon socket Configure and troubleshoot the Docker daemon Set Up Docker with TLS How to Configure Docker daemon with a configuration file? docker completion references: command-line completion Linux $ curl -fsSL https://raw.githubusercontent.com/docker/cli/master/contrib/completion/bash/docker \\ -o /etc/bash_completion.d/docker load completion $ grep 'bash_completion' /etc/bashrc if [ -f /usr/share/bash-completion/bash_completion ]; then source /usr/share/bash-completion/bash_completion fi $ cat /usr/share/bash-completion/bash_completion ... 2070 # source compat completion directory definitions 2071 compat_dir=${BASH_COMPLETION_COMPAT_DIR:-/etc/bash_completion.d} 2072 if [[ -d $compat_dir && -r $compat_dir && -x $compat_dir ]]; then 2073 for i in \"$compat_dir\"/*; do 2074 [[ ${i##*/} != @($_backup_glob|Makefile*|$_blacklist_glob) \\ 2075 && -f $i && -r $i ]] && . \"$i\" 2076 done 2077 fi 2078 unset compat_dir i _blacklist_glob 2079 2080 # source user completion file 2081 user_completion=${BASH_COMPLETION_USER_FILE:-~/.bash_completion} 2082 [[ ${BASH_SOURCE[0]} != $user_completion && -r $user_completion ]] \\ 2083 && . $user_completion 2084 unset user_completion ... OSX bashComp=\"$(brew --prefix)/etc/bash_completion.d\" bashComp2=\"$(brew --prefix)/etc/profile.d/bash_completion.sh\" dApp=\"/Applications/Docker.app\" dmver='0.16.2' gitcontent='https://raw.githubusercontent.com' dm=\"${gitcontent}/docker/machine/v${dmver}/contrib/completion/bash/docker-machine.bash\" curlOpt='-x 127.0.0.1:1087 -fsSL' brew install bash-completion@2 sudo curl ${curlOpt} ${dm} --output ${bashComp}/docker-machine.bash for _i in docker.bash-completion docker-compose.bash-completion; do ln -s ${dApp}/Contents/Resources/etc/${_i} ${bashComp}/${_i} done cat > ~/.bash_profile /dev/null; then # bash-completion [ -f \"${bashComp}\" ] && export BASH_COMPLETION_COMPAT_DIR=\"${bashComp}\" && source \"${bashComp}\"; # bash-completion@2 [ -f \"${bashComp2}\" ] && source \"${bashComp2}\"; fi EOF result $ complete -p d complete -F _complete_alias d $ complete -p dls complete -F _complete_alias dls # others: $ complete -p k complete -F _complete_alias k $ complete -p git complete -o bashdefault -o default -o nospace -F __git_wrap__git_main git docker build Best practices for writing Dockerfiles Create a base image Dockerfile reference $ docker build \\ --no-cache \\ --build-arg REPO= \\ --build-arg TAG=1.4-bionic \\ -t /devops/jnlp.bionic \\ -f devops-jnlp . docker run run into dind $ docker run \\ --name \"marslo\" \\ --privileged \\ --rm \\ -it \\ -v /var/run/docker.sock:/var/run/docker.sock docker:dind $ ubuntu@01acbffd94ec:~$ docker --version Docker version 18.06.1-ce, build e68fc7a run to override ENTRYPOINT $ docker run \\ --name marslo \\ -it \\ --entrypoint /bin/bash \\ docker:dind runtime options with memory, cpus, and gpus reference: Docker容器CPU、memory资源限制 Memory Resource Controller CPU Accounting Controller CFS Bandwidth Control RedHat: 3.3. CPUACCT RedHat: 3.4. CPUSET Brief summary of control files /sys/fs/cgroup/memory/docker/ID/memory.usage_in_bytes : show current usage for memory /sys/fs/cgroup/memory/docker/ID/memory.limit_in_bytes : set/show limit of memory usage /sys/fs/cgroup/cpuacct/docker/ID/cpuacct.usage : show the total CPU time (in nanoseconds) consumed by all tasks in this cgroup /sys/fs/cgroup/cpuacct/docker/ID/cpuacct.stat : show the user and system CPU time consumed by all tasks in this cgroup /sys/fs/cgroup/cpuacct/docker/ID/cpuacct.usage_percpu: show the CPU time (in nanoseconds) consumed on each CPU by all tasks in this cgroup memory $ docker run \\ --name marslo \\ -it \\ --entrypoint /bin/bash \\ --memory=4G \\ --oom-kill-disable \\ // optional docker:dind cpu $ docker run \\ --name marslo \\ -it \\ --entrypoint /bin/bash \\ --cpus=\"4\" \\ docker:dind run with always restart docker: Conflicting options: --restart and --rm. $ docker run \\ -d \\ --name ss-libev \\ --restart=always \\ -p 8443:8443 \\ -p 8443:8443/udp \\ -v /etc/shadowsocks-libev:/etc/shadowsocks-libev \\ teddysun/shadowsocks-libev visit via$ docker exec -it ss-libev /bin/sh docker exec login docker container as root $ docker run -d : $ docker exec --privileged -u root -it /bin/bash docker ps list without wrap $ docker ps -a --no-trunc or $ curl --unix-socket /var/run/docker.sock 'http://localhost/containers/json' i.e.:$ docker ps -a --no-trunc --filter name=marslo* list full container id $ docker ps -aq --no-trunc or $ docker inspect --format=\"{{.Id}}\" d40df87b2f87 d40df87b2f87261152d2541b870c6b801c031f8df969e4bd3e9b3c607e6c1698 filter filter with image$ docker ps -a --no-trunc --filter ancestor='busybox:latest' filter with exit code$ docker ps -a --filter 'exited=0' filter with status$ docker ps --filter status=running filter with tag$ docker images --filter \"reference=*/*/*/*:1.4-bionic-dind\" format id and command $ docker ps --no-trunc --format \"{{.ID}}: {{.Command}}\" id, image and commands $ docker ps --no-trunc --format \"{{.ID}}: {{.Command}}: {{.Image}}\" log path HOW TO REDIRECT DOCKER LOGS TO A SINGLE FILE $ docker inspect --format='{{.LogPath}}' containername with table $ docker ps --format \"table {{.Image}}\\t{{.Names}}\\t{{.Ports}}\\t{{.Status}}\" docker rmi remove via docker image $ docker rmi -f $(docker images \"*/*/*/myimage\" --format \"{{.ID}}\") or $ docker images \"*/*/*/myimage\" --format \"{{.ID}}\" | xargs docker rmi -f remove tag images $ docker images -q -f \"dangling=true\" | xargs docker rmi -f --no-trunc or $ docker image prune --filter=\"dangling=true\" docker rm remove all stopped container $ docker ps --filter \"status=exited\" --format '{{.ID}}' | xargs docker rm -f or$ docker rm $(docker ps -aq --filter \"status=exited\") docker stats reference: Monitor the Resource Usage of Docker Containers See Memory and CPU Usage for All Your Docker Containers $ docker stats --format \"table {{.Name}}\\t{{.CPUPerc}}\\t{{.MemUsage}}\" docker inspect reference: See full command of running/stopped container in Docker $ docker inspect -f \"{{.Path}} {{.Args}} ({{.Id}})\" $(docker ps -a -q) or list only $ docker inspect -f \"{{.Path}} {{.Args}} ({{.Id}})\" docker proxy docker build proxy $ mkdir -p ~/.docker $ cat > ~/.docker/config.json or via --build-arg:$ docker build \\ --build-arg http_proxy=http://proxy.example.com:80 \\ --build-arg https_proxy=http://proxy.example.com:443 \\ . docker pull proxy # for rootless mode $ mkdir -p ~/.config/systemd/user/docker.service.d/ # or regular mode $ sudo mkdir -p /etc/systemd/system/docker.service.d $ sudo bash -c \"cat > /etc/systemd/system/docker.service.d\" Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:20 "},"virtualization/docker/windows.html":{"url":"virtualization/docker/windows.html","title":"windows","keywords":"","body":" Table of Contents generated with DocToc docker docker-ee exec commands tricky Hyper-V installation Windows Docker Container Hyper-V Isolation create a virtual machine with powershell by Hyper-V Q&A could not read CA certificate references docker docker-ee installation references: * Install Docker Engine - Enterprise on Windows Servers Docker-EE installtion in windows server Get started: Prep Windows for containers Install Docker Enterprise Edition for Windows Server basic settings: Docker Linux Container running on Windows Server 2019 Use a script to install docker-ee Remote Management of a Windows Docker Host > Install-Module -Name DockerMsftProvider -Repository PSGallery -Force > Install-Package -Name docker -ProviderName DockerMsftProvider > Restart-Computer -Force # or > Install-Module DockerMsftProvider -Force > Install-Package Docker -ProviderName DockerMsftProvider -Force > Restart-Computer install specific docker version > Install-Package -Name docker -ProviderName DockerMsftProvider -Force -RequiredVersion 17.06.2-ee-5 check > Get-Package -Name Docker -ProviderName DockerMsftProvider Name Version Source ProviderName ---- ------- ------ ------------ docker 19.03.5 DockerDefault DockerMsftProvider > Find-Package -Name Docker -ProviderName DockerMsftProvider Name Version Source Summary ---- ------- ------ ------- Docker 20.10.9 DockerDefault Contains docker-ee for use with Windows Server. update DockerMsftProvider > Update-Module DockerMsftProvider upgrade > Install-Package -Name Docker -ProviderName DockerMsftProvider -Update -Force > Start-Service Docker or to particular version> Install-Package -Name docker -ProviderName DockerMsftProvider -RequiredVersion 18.09 -Update -Force uninstall # clean docker images and processes > docker swarm leave --force > docker rm -f $(docker ps --all --quiet) > docker system prune --all --volumes # uninstall > Uninstall-Package -Name docker -ProviderName DockerMsftProvider > Uninstall-Module -Name DockerMsftProvider # clean up the network and filesystem > Get-HNSNetwork | Remove-HNSNetwork > Remove-Item -Path \"C:\\ProgramData\\Docker\" -Recurse -Force # get package via > Get-PackageProvider -Name *Docker* Clean up Docker data and system components > Get-HNSNetwork | Remove-HNSNetwork > Get-ContainerNetwork | Remove-ContainerNetwork > Remove-Item \"C:\\ProgramData\\Docker\" -Recurse # close Hyper-V > Remove-WindowsFeature Containers > Remove-WindowsFeature Hyper-V # reboot > Restart-Computer -Force pull and run windows image > docker pull mcr.microsoft.com/dotnet/samples:dotnetapp-nanoserver-2009 > docker run mcr.microsoft.com/dotnet/samples:dotnetapp-nanoserver-2009 # inspired from http://man.hubwiz.com/docset/Docker.docset/Contents/Resources/Documents/docs.docker.com/install/windows/docker-ee.html # On an online machine, download the zip file. Invoke-WebRequest -UseBasicParsing -OutFile docker-18.09.5.zip https://download.docker.com/components/engine/windows-server/18.09/docker-18.09.5.zip # Stop Docker service Stop-Service docker # Extract the archive. Expand-Archive docker-18.09.5.zip -DestinationPath $Env:ProgramFiles -Force # Clean up the zip file. Remove-Item -Force docker-18.09.5.zip # Install Docker. This requires rebooting. $null = Install-WindowsFeature containers # Add Docker to the path for the current session. $env:path += \";$env:ProgramFiles\\docker\" # Optionally, modify PATH to persist across sessions. $newPath = \"$env:ProgramFiles\\docker;\" + [Environment]::GetEnvironmentVariable(\"PATH\", [EnvironmentVariableTarget]::Machine) [Environment]::SetEnvironmentVariable(\"PATH\", $newPath, [EnvironmentVariableTarget]::Machine) # Register the Docker daemon as a service. dockerd --register-service # Start the Docker service. Start-Service docker check imarslo : stop service & process via powershell powershell : Get-Service > Get-Process dockerd Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName ------- ------ ----- ----- ------ -- -- ----------- 449 28 138348 45356 4.31 16192 0 dockerd > Get-NetTCPConnection -LocalPort 2376 LocalAddress LocalPort RemoteAddress RemotePort State AppliedSetting ------------ --------- ------------- ---------- ----- -------------- :: 2376 :: 0 Listen # or > Get-NetTCPConnection -LocalPort 2376 -State Listen -ErrorVariable $err -ErrorAction SilentlyContinue > Get-Service Docker Status Name DisplayName ------ ---- ----------- Running Docker Docker Engine install a specific version > Install-Package -Name docker -ProviderName DockerMsftProvider -Force -RequiredVersion 18.09 ... Name Version Source Summary ---- ------- ------ ------- Docker 18.09 Docker Contains Docker Engine - Enterprise for use with Windows Server... # update module > Update-Module DockerMsftProvider upgrade docker-ee > Install-Package -Name docker -ProviderName DockerMsftProvider -RequiredVersion 18.09 -Update -Force uninstall docker-ee # Leave any active Docker Swarm > docker swarm leave --force # Remove all running and stopped containers > docker rm -f $(docker ps --all --quiet) # Prune container data > docker system prune --all --volumes # Uninstall Docker PowerShell Package and Module > Uninstall-Package -Name docker -ProviderName DockerMsftProvider > Uninstall-Module -Name DockerMsftProvider # Clean up Windows Networking and file system > Get-HNSNetwork | Remove-HNSNetwork > Remove-Item -Path \"C:\\ProgramData\\Docker\" -Recurse -Force exec commands > docker exec a8 powershell -c \"Get-CimInstance Win32_Process | Select-Object ProcessId, CommandLine\" tricky running linux container in windows server by enable experimental features in docker daemon.conf Set LCOW_SUPPORTED Variable to 1 for enabled > [Environment]::SetEnvironmentVariable(“LCOW_SUPPORTED”, “1”, “Machine”) Enable Experimental Features in Docker daemon.conf > $configfile = @\" { “experimental”: true } \"@ > $configfile|Out-File -FilePath C:\\ProgramData\\docker\\config\\daemon.json -Encoding ascii -Force deploy LCOW for it to run > Invoke-WebRequest -Uri “https://github.com/linuxkit/lcow/releases/download/v4.14.35-v0.3.9/release.zip&#8221; -UseBasicParsing -OutFile release.zip > Expand-Archive release.zip -DestinationPath “$Env:ProgramFiles\\Linux Containers\\.” make Linux containers the Default > [Environment]::SetEnvironmentVariable(“LCOW_API_PLATFORM_IF_OMITTED”, “linux”, “Machine”) by pre build docker-ee uninstall current docker-ee > Uninstall-Package -Name docker -ProviderName DockerMSFTProvider enable Nested Virtualization by using Linux Virtual Machine running on Hyper-V. > Get-VM WinContainerHost | Set-VMProcessor -ExposeVirtualizationExtensions $true install pre build docker-ee > Install-Module DockerProvider > Install-Package Docker -ProviderName DockerProvider -RequiredVersion preview Enable LinuxKit system for running Linux containers > [Environment]::SetEnvironmentVariable(\"LCOW_SUPPORTED\", \"1\", \"Machine\") to Switch back to running Windows containers> [Environment]::SetEnvironmentVariable(\"LCOW_SUPPORTED\", \"$null\", \"Machine\") restart docker service > Restart-Service docker check > docker run -it --rm ubuntu /bin/bash FIPS 140-2 cryptographic module support > [System.Environment]::SetEnvironmentVariable(\"DOCKER_FIPS\", \"1\", \"Machine\") # regedit > Set-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\FipsAlgorithmPolicy\\\" -Name \"Enabled\" -Value \"1\" > net stop docker > net start docker # check > docker info ... Labels: com.docker.security.fips=enabled ... Hyper-V [!TIP] * Hyper-V Technology Overview * Install the Hyper-V role on Windows Server * Docker Linux Container running on Windows Server 2019 System requirements for Hyper-V on Windows Server * Create Virtual Machine with Hyper-V on Windows 10 installation [!TIP] If you're connected locally to the server, run the command without -ComputerName . via commands> Install-WindowsFeature -Name Hyper-V [-ComputerName ] -IncludeManagementTools -Restart check> Get-WindowsFeature -ComputerName manually In Server Manager, on the Manage menu, click Add Roles and Features. On the Before you begin page, verify that your destination server and network environment are prepared for the role and feature you want to install. Click Next. On the Select installation type page, select Role-based or feature-based installation and then click Next. On the Select destination server page, select a server from the server pool and then click Next. On the Select server roles page, select Hyper-V. To add the tools that you use to create and manage virtual machines, click Add Features. On the Features page, click Next. On the Create Virtual Switches page, Virtual Machine Migration page, and Default Stores page, select the appropriate options. On the Confirm installation selections page, select Restart the destination server automatically if required, and then click Install. When installation is finished, verify that Hyper-V installed correctly. Open the All Servers page in Server Manager and select a server on which you installed Hyper-V. Check the Roles and Features tile on the page for the selected server. Windows Docker Container Hyper-V Isolation > docker run -it --isolation=hyperv mcr.microsoft.com/windows/servercore:ltsc2019 # check > get-process -Name vmwp create a virtual machine with powershell by Hyper-V # Set VM Name, Switch Name, and Installation Media Path. $VMName = 'TESTVM' $Switch = 'External VM Switch' $InstallMedia = 'C:\\Users\\Administrator\\Desktop\\en_windows_10_enterprise_x64_dvd_6851151.iso' # Create New Virtual Machine New-VM -Name $VMName -MemoryStartupBytes 2147483648 -Generation 2 -NewVHDPath \"D:\\Virtual Machines\\$VMName\\$VMName.vhdx\" -NewVHDSizeBytes 53687091200 -Path \"D:\\Virtual Machines\\$VMName\" -SwitchName $Switch # Add DVD Drive to Virtual Machine Add-VMScsiController -VMName $VMName Add-VMDvdDrive -VMName $VMName -ControllerNumber 1 -ControllerLocation 0 -Path $InstallMedia # Mount Installation Media $DVDDrive = Get-VMDvdDrive -VMName $VMName # Configure Virtual Machine to Boot from DVD Set-VMFirmware -VMName $VMName -FirstBootDevice $DVDDrive Q&A could not read CA certificate solution [Environment]::SetEnvironmentVariable(\"DOCKER_CERT_PATH\", $null, \"User\") [Environment]::SetEnvironmentVariable(\"DOCKER_HOST\", $null, \"User\") [Environment]::SetEnvironmentVariable(\"DOCKER_MACHINE_NAME\", $null, \"User\") [Environment]::SetEnvironmentVariable(\"DOCKER_TLS_VERIFY\", $null, \"User\") [Environment]::SetEnvironmentVariable(\"DOCKER_TOOLBOX_INSTALL_PATH\", $null, \"User\") or SET DOCKER_CERT_PATH= $null, \"User\" SET DOCKER_HOST= $null, \"User\" SET DOCKER_MACHINE_NAME= $null, \"User\" SET DOCKER_TLS_VERIFY= $null, \"User\" SET DOCKER_TOOLBOX_INSTALL_PATH= $null, \"User\" references Support policy for Windows Server containers in on-premises scenarios Windows container requirements Install Docker in Windows Server 2019 Docker PowerShell Scripts for Local Development * docker-restart-attempt.ps1 docker-cloud-config-start.ps1 run-prep.ps1 docker-mysql-start.ps1 docker-rabbitmq-start.ps1 docker-redis-start.ps1 eureka-start.ps1 eureka-wait.ps1 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:20 "},"virtualization/docker/tricky.html":{"url":"virtualization/docker/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc docker with proxy ocker pull docker build docker build with GPG key proxy command-line auto completion Linux osx others complete_alias get tags from artifactory from docker hub docker with proxy ocker pull $ sudo mkdir -p /etc/systemd/system/docker.service.d $ cat /etc/systemd/system/docker.service.d/http-proxy.conf [Service] Environment=\"HTTPS_PROXY=http://my.proxy.com:80\" Environment=\"HTTP_PROXY=http://my.proxy.com:80\" systemctl daemon-reload;systemctl start docker $ sudo systemctl daemon-reload $ sudo systemctl restart docker # verify $ systemctl show docker --property Environment Environment=HTTPS_PROXY=http://my.proxy.com:80 HTTP_PROXY=http://my.proxy.com:80 for socks5 $ [ ! -d /etc/systemd/system/docker.service.d ] && sudo mkdir -p /etc/systemd/system/docker.service.d $ sudo bash -c \"cat > /etc/systemd/system/docker.service.d/socks5-proxy.conf\" docker build $ cat ~/.docker/config.json { \"proxies\": { \"default\": { \"httpProxy\": \"http://my.proxy.com:80\", \"httpsProxy\": \"http://my.proxy.com:80\", \"allProxy\": \"http://my.proxy.com:80\", \"noProxy\": \"*.test.example.com,.example2.com,127.0.0.0/8\" } } } details Variable Dockerfile example docker run example HTTP_PROXY ENV HTTP_PROXY=\"http://my.proxy.com:80\" --env HTTP_PROXY=\"http://my.proxy.com:80\" HTTPS_PROXY ENV HTTPS_PROXY=\"https://my.proxy.com:80\" --env HTTPS_PROXY=\"https://my.proxy.com:80\" FTP_PROXY ENV FTP_PROXY=\"ftp://my.proxy.com:80\" --env FTP_PROXY=\"ftp://my.proxy.com:80\" NO_PROXY ENV NO_PROXY=\"*.test.example.com,.example2.com\" --env NO_PROXY=\"*.test.example.com,.example2.com,127.0.0.0/8\" docker build with GPG key proxy without proxy ... gpg --batch \\ --keyserver https://keyserver.ubuntu.com:80 \\ --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831E ... # result gpg: keyserver receive failed: Connection timed out GPG with proxy ... apt-key adv --keyserver-options http-proxy=http://my.proxy.com:80 \\ --keyserver hkp://keyserver.ubuntu.com:80 \\ --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF \\ ... # result Executing: /tmp/apt-key-gpghome.uegAG54mKu/gpg.1.sh --keyserver-options http-proxy=http://my.proxy.com:80 --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF gpg: key A6A19B38D3D831EF: 2 signatures not checked due to missing keys gpg: key A6A19B38D3D831EF: public key \"Xamarin Public Jenkins (auto-signing) \" imported gpg: Total number processed: 1 gpg: imported: 1 gpg: keybox '/tmp/tmp.jad0qVCQ6v/pubring.kbx' created gpg: WARNING: nothing exported Warning: apt-key output should not be parsed (stdout is not a terminal) command-line auto completion reference: Enable Docker command-line auto completion in bash on Centos/Ubuntu completion/bash/docker Perform tab-completion for aliases in Bash Linux $ dpkg -L docker-ce-cli | grep completion /usr/share/bash-completion /usr/share/bash-completion/completions /usr/share/bash-completion/completions/docker /usr/share/fish/vendor_completions.d /usr/share/fish/vendor_completions.d/docker.fish /usr/share/zsh/vendor-completions /usr/share/zsh/vendor-completions/_docker rpm$ rpm -ql docker-ce | grep completion /usr/share/bash-completion/completions/docker /usr/share/fish/vendor_completions.d/docker.fish /usr/share/zsh/vendor-completions/_docker setup in bashrc source /usr/share/bash-completion/completions/docker alias d='docker' alias dp='docker ps' while read -r _i; do complete -F _docker \"${_i}\" done more info$ source /usr/share/bash-completion/completions/docker $ type _docker | head _docker is a function _docker () { local previous_extglob_setting=$(shopt -p extglob); shopt -s extglob; } osx $ la '/Applications/Docker.app/Contents/Resources/etc' total 332K -rwxr-xr-x 1 marslo admin 124K Nov 9 21:50 docker.zsh-completion -rwxr-xr-x 1 marslo admin 51K Nov 9 21:50 docker.fish-completion -rwxr-xr-x 1 marslo admin 114K Nov 9 21:50 docker.bash-completion -rw-r--r-- 1 marslo admin 18K Nov 9 21:50 docker-compose.zsh-completion -rw-r--r-- 1 marslo admin 1.7K Nov 9 21:50 docker-compose.fish-completion -rwxr-xr-x 1 marslo admin 13K Nov 9 21:50 docker-compose.bash-completion $ ln -sf '/Applications/Docker.app/Contents/Resources/etc/docker.bash-completion' $(brew --prefix)/etc/bash_completion.d/docker $ ln -sf '/Applications/Docker.app/Contents/Resources/etc/docker-compose.bash-completion' $(brew --prefix)/etc/bash_completion.d/docker-compose setup in bashrc dockerComp=\"$(brew --prefix)/etc/bash_completion.d/docker\" dockerComposeComp=\"$(brew --prefix)/etc/bash_completion.d/docker-compose\" [ -f \"${dockerComp}\" ] && source \"${dockerComp}\" [ -f \"${dockerComposeComp}\" ] && source \"${dockerComposeComp}\" alias d='docker' alias dp='docker ps' alias dls='docker ps -l -q' alias dps='docker ps -l -a' alias di='docker images' alias dip=\"docker inspect --format '{{ .NetworkSettings.IPAddress }}'\" while read -r _i; do complete -F _docker \"${_i}\" done others _completion_loader_completion_loader() { . \"/etc/bash_completion.d/$1.sh\" >/dev/null 2>&1 && return 124 } complete -D -F _completion_loader complete_alias # for Linux $ sudo curl -sSLg https://raw.githubusercontent.com/cykerway/complete-alias/master/complete_alias \\ -o /etc/bash_completion.d/complete_alias # for osx $ sudo curl -sSLg https://raw.githubusercontent.com/cykerway/complete-alias/master/complete_alias \\ -o $(brew --prefix)/etc/bash_completion.d/complete_alias setup in bash source /etc/bash_completion.d/complete_alias # source $(brew --prefix)/etc/bash_completion.d/complete_alias while read -r _i; do complete -F _complete_alias \"${_i}\" done get tags from artifactory list repos example: the docker registry in artifactory named docker $ curl -sS https://my.artifactory.com/v2/docker/_catalog | jq -r .repositories[] or $ curl -sS -X GET https://my.artifactory.com/artifactory/api/docker/docker/v2/_catalog | jq -r .repositories[] list tags example: get tags from repo devops/ubuntu $ curl -sS https://my.artifactory.com/artifactory/v2/docker/devops/ubuntu/tags/list [ | jq -r .tags[] ] or$ curl -sS -X GET https://my.artifactory.com/artifactory/api/docker/docker/v2/devops/ubuntu/tags/list from docker hub $ curl -sS 'https://hub.docker.com/v2/repositories/jenkins/jenkins/tags' | jq --raw-output .results[].name jdk8-openj9-windowsservercore-1809 jdk11-hotspot-windowsservercore-1809 jdk11-openj9-windowsservercore-1809 windowsservercore-1809 jdk8-hotspot-windowsservercore-1809 2.249.3-lts-centos7 lts-centos7 centos7 2.249.3-lts-centos lts-centos get more$ curl -sS 'https://hub.docker.com/v2/repositories/jenkins/jenkins/tags?page_size=100&ordering=last_updated' | jq --raw-output .results[].name | sort or$ curl -sS https://hub.docker.com/v2/repositories/jenkins/jenkins/tags?page=2 | jq '.\"results\"[][\"name\"]' | sort simple script for get tags #!/bin/sh # # Simple script that will display docker repository tags. # # Usage: # $ docker-show-repo-tags.sh ubuntu centos for _r in $* ; do curl -sS \"https://registry.hub.docker.com/v2/repositories/library/$_r/tags/\" | sed -e 's/,/,\\n/g' -e 's/\\[/\\[\\n/g' | grep '\"name\"' | awk -F\\\" '{print $4;}' | sort -fu | sed -e \"s/^/${_r}:/\" done get current container ID $ basename $(cat /proc/self/cpuset) ab8c1732f1a3fdb46b9f9a477f0fbcc1d23c6787d7532648242a76d6eb1e8b84 or$ hostname ab8c1732f1a3 get volume from container ID $ docker inspect -f '{{ .Mounts }}' or $ docker inspect | grep volume or get all $ docker ps -a --no-trunc --format \"{{.ID}}\\t{{.Names}}\\t{{.Mounts}}\" or$ docker inspect | jq --raw-output .[].Mounts or $ docker ps -q | xargs docker container inspect -f '{{ .Name }} {{ .HostConfig.Binds }}' mount volume in DinD reference: Mounting Volumes in Sibling Containers with Gitlab CI Mount volumes from container (--volumes-from) Kubernetes emptyDir is not the same as Docker's volumes-from $ cid=$(basename $(cat /proc/self/cpuset)) $ VOLUME_OPTION=\"--volumes-from ${cid}:rw\" $ docker run ${VOLUME_OPTION} Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:19 "},"osx/osx.html":{"url":"osx/osx.html","title":"osx","keywords":"","body":" Table of Contents generated with DocToc xcode downlaod xcode by wget Appendix accpet license from cmd commandline tools and compoents enable dev mode system info system setup hostname disable guest user enable root user System Integrity Protection disable/enable gatekeeper app java xcode downlaod xcode by wget get cookies.txt install google chrome extension from official website login developer.apple.com select cookies.txt and download get xcode download url and right click and select Copy Link Address: download xcode (inspired from here and here) $ wget --cookies=on \\ --load-cookies=cookies.txt \\ --keep-session-cookies \\ --save-cookies=cookies.txt \\ https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip exmaple $ wget --cookies=on \\ > --load-cookies=cookies.txt \\ > --keep-session-cookies \\ > --save-cookies=cookies.txt \\ > https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip --2019-10-15 07:55:18-- https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip Resolving download.developer.apple.com (download.developer.apple.com)... 17.253.17.207, 17.253.17.211 Connecting to download.developer.apple.com (download.developer.apple.com)|17.253.17.207|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 7805079698 (7.3G) [application/octet-stream] Saving to: ‘Xcode_11.2_beta_2.xip’ 100%[===========================================================================================================>] 7,805,079,698 112MB/s in 70s 2019-10-15 07:53:07 (106 MB/s) - ‘Xcode_11.2_beta_2.xip’ saved [7805079698/7805079698] $ ls -altrh Xcode_11.2_beta_2.xip -rw-rw-r-- 1 devops devops 7.3G Oct 9 13:27 Xcode_11.2_beta_2.xip Appendix xcode xcode url 12.3 beta https://download.developer.apple.com/Developer_Tools/Xcode_12.3_beta/Xcode_12.3_beta.xip 12.2 https://download.developer.apple.com/Developer_Tools/Xcode_12.2/Xcode_12.2.xip 12.2beta2 https://download.developer.apple.com/Developer_Tools/Xcode_12.2_beta_2/Xcode_12.2_beta_2.xip 12.0.1 https://download.developer.apple.com/Developer_Tools/Xcode_12.0.1/Xcode_12.0.1.xip 12 beta 5 https://download.developer.apple.com/Developer_Tools/Xcode_12_beta_5/Xcode_12_beta_5.xip 11.6 https://download.developer.apple.com/Developer_Tools/Xcode_11.6/Xcode_11.6.xip 11.5 beta 2 https://download.developer.apple.com/Developer_Tools/Xcode_11.5_beta_2/Xcode_11.5_beta_2.xip 11.5 beta https://download.developer.apple.com/Developer_Tools/Xcode_11.5_beta/Xcode_11.5_beta.xip 11.4.1 https://download.developer.apple.com/Developer_Tools/Xcode_11.4.1/Xcode_11.4.1.xip 11.4 https://download.developer.apple.com/Developer_Tools/Xcode_11.4/Xcode_11.4.xip 11.4 beta 3 https://download.developer.apple.com/Developer_Tools/Xcode_11.4_beta_3/Xcode_11.4_beta_3.xip 11.4 beta 2 https://download.developer.apple.com/Developer_Tools/Xcode_11.4_beta_2/Xcode_11.4_beta_2.xip 11.4 beta https://download.developer.apple.com/Developer_Tools/Xcode_11.4_beta/Xcode_11.4_beta.xip 11.3.1 https://download.developer.apple.com/Developer_Tools/Xcode_11.3.1/Xcode_11.3.1.xip 11.2 beta 2 https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip 11.1 https://download.developer.apple.com/Developer_Tools/Xcode_11.1/Xcode_11.1.xip 11.2 beta https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta/Xcode_11.2_beta.xip 11 https://download.developer.apple.com/Developer_Tools/Xcode_11/Xcode_11.xip 10.3 https://download.developer.apple.com/Developer_Tools/Xcode_10.3/Xcode_10.3.xip 10.2.1 https://download.developer.apple.com/Developer_Tools/Xcode_10.2.1/Xcode_10.2.1.xip 10.2 https://download.developer.apple.com/Developer_Tools/Xcode_10.2/Xcode_10.2.xip 10.1 https://download.developer.apple.com/Developer_Tools/Xcode_10.1/Xcode_10.1.xip command line tool command line tool url 12.3 beta https://download.developer.apple.com/Developer_Tools/Xcode_12.3_beta/Xcode_12.3_beta.xip 12.2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_12.2/Command_Line_Tools_for_Xcode_12.2.dmg 12.0 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_12/Command_Line_Tools_for_Xcode_12.dmg 11.4.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4.1/Command_Line_Tools_for_Xcode_11.4.1.dmg 11.4 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4/Command_Line_Tools_for_Xcode_11.4.dmg 11.4 beta 3 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4_beta_3/Command_Line_Tools_for_Xcode_11.4_beta_3.dmg 11.4 beta 2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4_beta_2/Command_Line_Tools_for_Xcode_11.4_beta_2.dmg 11.3.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.3.1/Command_Line_Tools_for_Xcode_11.3.1.dmg 11.2 beta 2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.2_beta_2/Command_Line_Tools_for_Xcode_11.2_beta_2.dmg 11.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.2_beta/Command_Line_Tools_for_Xcode_11.2_beta.dmg 11 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11/Command_Line_Tools_for_Xcode_11.dmg 10.3 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.3/Command_Line_Tools_macOS_10.14_for_Xcode_10.3.dmg 10.2.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.2.1.dmg/Command_Line_Tools_macOS_10.14_for_Xcode_10.2.1.dmg 10.2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.2/Command_Line_Tools_macOS_10.14_for_Xcode_10.2.dmg 10.1 for macOS 10.14 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.1/Command_Line_Tools_macOS_10.14_for_Xcode_10.1.dmg 10.1 for macOS 10.13 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.13_for_Xcode_10.1/Command_Line_Tools_macOS_10.13_for_Xcode_10.1.dmg additional tools additional tool url 11.4 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_11.4/Additional_Tools_for_Xcode_11.4.dmg 11.4 beta 2 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_11.4_beta_2/Additional_Tools_for_Xcode_11.4_beta_2.dmg 11 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_11/Additional_Tools_for_Xcode_11.dmg 10.1 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_10.1/Additional_Tools_for_Xcode_10.1.dmg additional info accpet license from cmd $ sudo xcodebuild -license accept commandline tools and compoents installation $ xcode-select -p $ for pkg in /Applications/Xcode.app/Contents/Resources/Packages/*.pkg; do sudo installer -pkg \"$pkg\" -target /; done upgrade $ softwareupdate --all --install --force or $ sudo rm -rf /Library/Developer/CommandLineTools $ sudo xcode-select --install more details $ defaults read /Library/Preferences/com.apple.SoftwareUpdate { AutomaticallyInstallMacOSUpdates = 1; LastAttemptBuildVersion = \"10.15.7 (19H2)\"; LastAttemptSystemVersion = \"10.15.7 (19H2)\"; LastBackgroundSuccessfulDate = \"2020-10-10 06:15:40 +0000\"; LastCatalogChangeDate = \"2020-10-10 14:13:29 +0000\"; LastFullSuccessfulDate = \"2020-10-10 14:14:38 +0000\"; LastRecommendedMajorOSBundleIdentifier = \"\"; LastRecommendedUpdatesAvailable = 0; LastResultCode = 2; LastSessionSuccessful = 1; LastSuccessfulDate = \"2020-10-10 14:14:38 +0000\"; LastUpdatesAvailable = 0; PrimaryLanguages = ( \"en-CN\", en ); RecommendedUpdates = ( ); SkipLocalCDN = 0; } enable dev mode $ DevToolsSecurity -enable system info production version issue in fetchScreen $ sw_vers ProductName : macOS ProductVersion : 11.1 BuildVersion : 20C69 or$ /usr/libexec/PlistBuddy -c \"Print:ProductName\" \\ -> -c \"Print:ProductVersion\" \\ -> -c \"Print:ProductBuildVersion\" /System/Library/CoreServices/SystemVersion.plist macOS 11.0.1 20B29 hardware $ /usr/sbin/system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Name: MacBook Pro Model Identifier: MacBookPro15,1 Processor Name: 6-Core Intel Core i7 Processor Speed: 2.2 GHz Number of Processors: 1 Total Number of Cores: 6 L2 Cache (per Core): 256 KB L3 Cache: 9 MB Hyper-Threading Technology: Enabled Memory: 16 GB Boot ROM Version: 1037.0.78.0.0 (iBridge: 17.16.10572.0.0,0) Serial Number (system): C02XFGWEJG5H Hardware UUID: 4EA008BF-9B36-5F1D-9151-AD4F64808AAB Activation Lock Status: Enabled $ system_profiler SPCameraDataType Camera: FaceTime HD Camera (Built-in): Model ID: UVC Camera VendorID_1452 ProductID_34068 Unique ID: 0x8020000005ac8514 grahics & display $ system_profiler SPDisplaysDataType Graphics/Displays: Intel UHD Graphics 630: Chipset Model: Intel UHD Graphics 630 Type: GPU Bus: Built-In VRAM (Dynamic, Max): 1536 MB Vendor: Intel Device ID: 0x3e** Revision ID: 0x00** Automatic Graphics Switching: Supported gMux Version: 5.0.0 Metal Family: Supported, Metal GPUFamily macOS 2 Displays: Color LCD: Display Type: Built-In Retina LCD Resolution: 3072 x 1920 Retina Framebuffer Depth: 24-Bit Color (ARGB8888) Main Display: Yes Mirror: Off Online: Yes Automatically Adjust Brightness: Yes Connection Type: Internal AMD Radeon Pro 5500M: Chipset Model: AMD Radeon Pro 5500M Type: GPU Bus: PCIe PCIe Lane Width: x8 VRAM (Total): 8 GB Vendor: AMD (0x1002) Device ID: 0x73** Revision ID: 0x00** ROM Revision: 113-******-*** VBIOS Version: 113-********-*** Option ROM Version: 113-********-*** EFI Driver Version: 01.A1.190 Automatic Graphics Switching: Supported gMux Version: 5.0.0 Metal Family: Supported, Metal GPUFamily macOS 2 cpu $ sysctl -n machdep.cpu.brand_string Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz or$ sysctl machdep.cpu machdep.cpu.max_basic: 22 machdep.cpu.max_ext: 2147483656 machdep.cpu.vendor: GenuineIntel machdep.cpu.brand_string: Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz machdep.cpu.family: 6 machdep.cpu.model: 158 machdep.cpu.extmodel: 9 ... system setup hostname $ HNAME='iMarsloPro' $ sudo scutil --set HostName \"${HNAME}\" $ sudo scutil --set LocalHostName \"${HNAME}\" # Optional $ sudo scutil --set ComputerName \"${HNAME}\" # Flush the DNS Cache $ dscacheutil -flushcache $ sudo shutdown -r now disable guest user $ sudo dscl . delete /Users/Guest $ sudo defaults write /Library/Preferences/com.apple.AppleFileServer guestAccess -bool NO $ sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server AllowGuestAccess -bool NO $ sudo defaults write /Library/Preferences/com.apple.loginwindow GuestEnabled -bool FALSE # remove Other $ sudo defaults write /Library/Preferences/com.apple.loginwindow SHOWOTHERUSERS_MANAGED -bool FALSE or $ sudo /usr/sbin/sysadminctl -deleteUse Guest check status $ sysadminctl -guestAccount status 2020-12-30 20:27:59.524 sysadminctl[45327:844298] Guest account disabled. $ sudo sysadminctl -guestAccount off 2020-12-30 20:28:39.645 sysadminctl[45479:846930] Guest account is already disabled list all accounts $ dscl . list /Users or $ dscl . -list /Users GeneratedUID or $ dscacheutil -q user location of plists: /var/db/dslocal/nodes/Default/users create Guest and enable scripts: https://github.com/sheagcraig/guestAccount/blob/master/guest_account $ dscl . -create /Users/Guest # keychain $ keychain='/Users/Guest/Library/Keychains/login.keychain' $ security create-keychain -p '' $keychain $ security login-keychain -s $keychain enable root user System Integrity Protection $ csrutil disable Successfully disabled System Integrity Protection. Please restart the machine for the changes to take effect. $ csrutil clear Successfully cleared System Integrity Proteciton. Please restart the machine for the changes to take effect. $ sudo chflags restricted /usr/local turn off the Rootless System Integrity Protection $ csrutil status System Integrity Protection status: enabled. $ sudo csrutil disable csrutil: failed to modify system integrity configuration. This tool needs to be executed from the Recovery OS reboot and command + r go to Utilities -> Terminal disable -bash-3.2# csrutil status System Integrity Protection status: enabled -bash-3.2# csrutil disable Successfully disabled System Integrity Protection. Please restart the machine for the changes to take effect. Remove file lock (uchg) flag $ chflags -R nouchg * # or $ chflags -R nouchg example $ find /usr -flags +sunlnk -print /usr/libexec/cups find: /usr/sbin/authserver: Permission denied /usr/local /usr/share/man /usr/share/snmp $ /bin/ls -lO /usr total 0 drwxr-xr-x 976 root wheel restricted 31232 Oct 28 19:17 bin/ drwxr-xr-x 292 root wheel restricted 9344 Oct 28 10:04 lib/ drwxr-xr-x 234 root wheel restricted 7488 Oct 28 19:17 libexec/ drwxr-xr-x 16 root wheel sunlnk 512 Oct 28 19:26 local/ drwxr-xr-x 246 root wheel restricted 7872 Oct 28 09:55 sbin/ drwxr-xr-x 46 root wheel restricted 1472 Oct 28 09:55 share/ drwxr-xr-x 5 root wheel restricted 160 Oct 3 13:48 standalone/ $ csrutil status System Integrity Protection status: enabled. $ sudo csrutil disable csrutil: failed to modify system integrity configuration. This tool needs to be executed from the Recovery OS $ cat /System/Library/Sandbox/rootless.conf $ /bin/ls -lO /Applications | grep firefox 22:drwxr-xr-x 3 marslo staff - 96 Dec 7 03:14 Firefox.app $ sudo chflags restricted Firefox.app $ /bin/ls -lO /Applications | grep firefox drwxr-xr-x 3 marslo staff restricted 96 Dec 7 03:14 Firefox.app disable/enable gatekeeper disable $ sudo spctl --master-disable enable $ sudo spctl --master-enable check status $ spctl --status assessments disabled app java setup java home$ /usr/libexec/java_home -v 1.8.0.162 -exec javac -versioin Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:23 "},"osx/defaults.html":{"url":"osx/defaults.html","title":"defaults","keywords":"","body":" Table of Contents generated with DocToc common usage commands usage Mac defaults programming disable the startup sounds Dock performance setup keyboard & trackpad utilities screenshot finder menu bar mission control feedback assistant time machine dock tricky for keyboards battery settings backup & restore Moon vscode reference: macOS defaults How To Change Preferences From The Command Line On MacOS? mac defaults common usage commands commands comments read prints the user’s settings to standard output read-type prints the plist type for a given key write write a value for the given key rename rename a key import import a plist to a given domain export export a domain and all the keys as a plist delete delete a given key or a domain / all keys for a given domain domains prints the name of all domains find search all domains, keys, and values for a given word usage basic usage $ defaults read DOMAIN # gets all $ defaults read DOMAIN PROPERTY_NAME # gets $ defaults write DOMAIN PROPERTY_NAME VALUE # sets $ defaults delete DOMAIN PROPERTY_NAME # resets a property $ defaults delete DOMAIN # resets preferences list all domains $ defaults domains i.e.$ defaults domains | tr ',' '\\n' | head ContextStoreAgent MobileMeAccounts com.100hps.captin com.ScooterSoftware.BeyondCompare com.app77.pwsafemac com.apple.AMPLibraryAgent com.apple.ATS com.apple.Accessibility com.apple.AdLib com.apple.AddressBook Mac defaults programming xcode add additional Counterpart Suffixes \"ViewModel\" \"View\"$ defaults write com.apple.dt.Xcode IDEAdditionalCounterpartSuffixes -array-add \"ViewModel\" \"View\" && killall Xcode \"Router\" \"Interactor\" \"Builder\"$ defaults write com.apple.dt.Xcode IDEAdditionalCounterpartSuffixes -array-add \"Router\" \"Interactor\" \"Builder\" && killall Xcode Show Build Durations$ defaults write com.apple.dt.Xcode ShowBuildOperationDuration -bool true && killall Xcode reset iTerm Profile $ cd ~/Library/Preferences/com.googlecode.iterm2.plist $ defaults delete com.googlecode.iterm2 simulator set screenshot location ~/Picture/Screenshots$ defaults write com.apple.iphonesimulator ScreenShotSaveLocation -string ~/Pictures/Screenshots ~/Picture/Simulator Screenshots$ defaults write com.apple.iphonesimulator ScreenShotSaveLocation -string ~/Pictures/Simulator Screenshots disable the startup sounds disable$ sudo nvram StartupMute=%01 enable$ sudo nvram StartupMute=%00 Dock performance setup minimize Windows Using \"suck\" mode $ defaults write com.apple.dock mineffect suck && killall Dock genie$ defaults write com.apple.dock mineffect genie && killall Dock scale$ defaults write com.apple.dock mineffect -string scale && killall Dock Highlight icon $ defaults write com.apple.dock mouse-over-hilite-stack -bool TRUE && killall Dock Restore to Default:$ defaults delete com.apple.dock mouse-over-hilite-stack && killall Dock remove none-opened apps $ defaults write com.apple.dock static-only -boolean true && killall Dock restore to default:$ defaults delete com.apple.dock static-only && killall Dock hidden icon $ defaults write com.apple.dock showhidden -bool true && killall Dock restore to default$ defaults delete com.apple.Dock showhidden && killall Dock keyboard & trackpad enable Key Repeat $ defaults write -g ApplePressAndHoldEnabled -bool false Restore to Default$ defaults delete -g ApplePressAndHoldEnabled enable tap to click $ defaults write com.apple.AppleMultitouchTrackpad Clicking -int 1 $ defaults -currentHost write NSGlobalDomain com.apple.mouse.tapBehavior -int 1 $ defaults write NSGlobalDomain com.apple.mouse.tapBehavior -int 1 enable three finger to drag $ defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerDrag -bool true $ defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerDrag -bool true fast keyboard response $ defaults write NSGlobalDomain KeyRepeat -int 0.02 reduce key repeat delay $ defaults write NSGlobalDomain InitialKeyRepeat -int 12 utilities avoid install resource validation $ sudo spctl --master-disable $ defaults write com.apple.LaunchServices LSQuarantine -bool false disable the .DS_Store file $ defaults write com.apple.desktopservices DSDontWriteNetworkStores true Enable the .DS_Store$ defaults write com.apple.desktopservices DSDontWriteNetworkStores false show battery percent $ defaults write com.apple.menuextra.battery ShowPercent -string \"YES\" forbidden spell automatic correction $ defaults write -g NSAutomaticQuoteSubstitutionEnabled -bool false $ defaults write -g NSAutomaticDashSubstitutionEnabled -bool false $ defaults write -g NSAutomaticSpellingCorrectionEnabled -bool false disable notification centers $ launchctl unload -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist $ killall NotificationCenter Are you sure you want to open this application? $ defaults write com.apple.LaunchServices LSQuarantine -bool false or$ sudo spctl — master-disable none warning for unknow resource open $ defaults write com.apple.LaunchServices LSQuarantine -bool false enable the hidden file $ defaults write com.apple.finder AppleShowAllFiles TRUE; killall Finder or$ defaults write com.apple.finder AppleShowAllFiles YES Safari Font Size $ defaults write com.apple.Safari com.apple.Safari.ContentPageGroupIdentifier.WebKit2MinimumFontSize -int 14 disable Spotlight $ sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist re-enable Spotlight$ sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist disable Notification Center $ launchctl unload -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist $ killall NotificationCenter re-enable Notifaction Center$ launchctl load -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist Disable the download apps security $ defaults write com.apple.LaunchServices LSQuarantine -bool NO re-enable the download apps security$ defaults write com.apple.LaunchServices LSQuarantine -bool YES Disable the dashboard $ defaults write com.apple.dashboard mcx-disabled -boolean YES && killall Dock re-enable the dashboard$ defaults write com.apple.dashboard mcx-disabled -boolean NO && killall Dock screenshot shadow show$ defaults write com.apple.screencapture disable-shadow -bool false disable$ defaults write com.apple.screencapture disable-shadow -bool true include date include$ defaults write com.apple.screencapture include-date -bool true not$ defaults write com.apple.screencapture include-date -bool false save location ~/Desktop$ defaults write com.apple.screencapture location -string ~/Desktop && killall SystemUIServer ~/Pictures$ defaults write com.apple.screencapture location -string ~/Pictures && killall SystemUIServer Display thumbnail display$ defaults write com.apple.screencapture show-thumbnail -bool true not show thumbnail$ defaults write com.apple.screencapture show-thumbnail -bool false screenshot format png$ defaults write com.apple.screencapture type -string png jpg$ defaults write com.apple.screencapture type -string jpg finder quitable hidden quite$ defaults write com.apple.finder QuitMenuItem -bool false && killall Finder enable quite$ defaults write com.apple.finder QuitMenuItem -bool true && killall Finder show extension show$ defaults write NSGlobalDomain AppleShowAllExtensions -bool true && killall Finder not show$ defaults write NSGlobalDomain AppleShowAllExtensions -bool false && killall Finder show hidden files show$ defaults write com.apple.Finder AppleShowAllFiles -bool true && killall Finder not show$ defaults write com.apple.Finder AppleShowAllFiles -bool false && killall Finder change file extension warning show warning$ defaults write com.apple.finder FXEnableExtensionChangeWarning -bool true && killall Finder silent$ defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false && killall Finder save to disk or iCloud by default yes$ defaults write NSGlobalDomain NSDocumentSaveNewDocumentsToCloud -bool true no$ defaults write NSGlobalDomain NSDocumentSaveNewDocumentsToCloud -bool false adjust toolbar title rollover delay 0.5$ defaults write NSGlobalDomain NSToolbarTitleViewRolloverDelay -float 0.5 && killall Finder 0$ defaults write NSGlobalDomain NSToolbarTitleViewRolloverDelay -float 0 && killall Finder 1$ defaults write NSGlobalDomain NSToolbarTitleViewRolloverDelay -float 1 && killall Finder set sidebar icon size small$ defaults write NSGlobalDomain NSTableViewDefaultSizeMode -int 1 && killall Finder medium$ defaults write NSGlobalDomain NSTableViewDefaultSizeMode -int 2 && killall Finder large$ defaults write NSGlobalDomain NSTableViewDefaultSizeMode -int 3 && killall Finder menu bar flash clock time separators stay solid$ defaults write com.apple.menuextra.clock FlashDateSeparators -bool false && killall SystemUIServer separator flashes$ defaults write com.apple.menuextra.clock FlashDateSeparators -bool true && killall SystemUIServer set menu bar digital clock format region settings: ss for seconds. HH for 24-hour clock. EEE for 3-letter day of the week. d MMM for day of the month and 3-letter month. EEE d MMM HH:mm:ss$ defaults write com.apple.menuextra.clock DateFormat -string \"EEE d MMM HH:mm:ss\" EEE h:mm:ss$ defaults write com.apple.menuextra.clock DateFormat -string \"EEE h:mm:ss\" EEE HH:mm:ss$ defaults write com.apple.menuextra.clock DateFormat -string \"EEE HH:mm:ss\" mission control rearrange automatically base on most of recent use$ defaults write com.apple.dock mru-spaces -bool true && killall Dock keep space arrangement$ defaults write com.apple.dock mru-spaces -bool false && killall Dock feedback assistant auto gather allow large$ defaults write com.apple.appleseed.FeedbackAssistant Autogather -bool true not allow$ defaults write com.apple.appleseed.FeedbackAssistant Autogather -bool false time machine disable dialog $ defaults write com.apple.TimeMachine DoNotOfferNewDisksForBackup -bool true dock change position available positions bottom left right left$ defaults write com.apple.dock orientation -string left && killall Dock right$ defaults write com.apple.dock orientation -string right && killall Dock bottom$ defaults write com.apple.dock orientation -string bottom && killall Dock change icon size 36$ defaults write com.apple.dock tilesize -int 36 && killall Dock 48$ defaults write com.apple.dock tilesize -int 48 && killall Dock read current value$ defaults read com.apple.dock tilesize 64 autohide auto hide$ defaults write com.apple.dock autohide -bool true && killall Dock always show$ defaults write com.apple.dock autohide -bool false && killall Dock autohide animation time precondition setup autohide to true 0.5$ defaults write com.apple.dock autohide-time-modifier -float 0.5 && killall dock 2$ defaults write com.apple.dock autohide-time-modifier -float 2 && killall dock 0$ defaults write com.apple.dock autohide-time-modifier -float 0 && killall dock read current value$ defaults read com.apple.dock autohide-time-modifier 1 autohide delay precondition setup autohide to true 0.5$ defaults write com.apple.dock autohide-delay -float 0.5 && killall Dock 0$ defaults write com.apple.dock autohide-delay -float 0 && killall Dock read current value$ defaults read com.apple.dock autohide-delay 0 show recently show$ defaults write com.apple.dock show-recents -bool true && killall Dock not show$ defaults write com.apple.dock show-recents -bool false && killall Dock tricky for keyboards $ defaults write NSGlobalDomain ApplePressAndHoldEnabled -boolean false # or $ defaults write -g ApplePressAndHoldEnabled -bool false battery settings get display off timer$ pmset -g | grep displaysleep displaysleep 180 set display off timer$ pmset -a displaysleep 30 backup & restore Moon backup$ defaults export com.manytricks.Moom ~/Desktop/Moom.plist restore$ defaults import com.manytricks.Moom ~/Desktop/Moom.plist vscode extension backup$ code --list-extensions >> vs_code_extensions_list.txt restore$ cat vs_code_extensions_list.txt | xargs -n 1 code --install-extension settings $HOME/Library/Application Support/Code/User/settings.json Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:23 "},"osx/apps.html":{"url":"osx/apps.html","title":"apps","keywords":"","body":" Table of Contents generated with DocToc homebrew homebrew installation homebrew caskroom installation package installation check formula config files brew debug tricky system settings accessory iTerm2 backgroundmusic mac cli others q&a Failed to connect to raw.githubusercontent.com port 443: Connection refused failure in brew search for cask formula homebrew homebrew installation $ /usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\" homebrewCN $ /bin/zsh -c \"$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)\" homebrew for additional source official brew_source='https://github.com/Homebrew' # brew 程序本身 git -C \"$(brew --repo)\" remote set-url origin ${brew_source}/brew.git git -C \"$(brew --repo homebrew/core)\" remote set-url origin ${brew_source}/homebrew-core.git git -C \"$(brew --repo homebrew/cask)\" remote set-url origin ${brew_source}/homebrew-cask.git git -C \"$(brew --repo homebrew/cask-fonts)\" remote set-url origin ${brew_source}/homebrew-cask-fonts.git git -C \"$(brew --repo homebrew/cask-drivers)\" remote set-url origin ${brew_source}/homebrew-cask-drivers.git brew update tsinghua (清华) brew_source='https://mirrors.tuna.tsinghua.edu.cn/git/homebrew' # brew 程序本身 git -C \"$(brew --repo)\" remote set-url origin ${brew_source}/brew.git git -C \"$(brew --repo homebrew/core)\" remote set-url origin ${brew_source}/homebrew-core.git git -C \"$(brew --repo homebrew/cask)\" remote set-url origin ${brew_source}/homebrew-cask.git git -C \"$(brew --repo homebrew/cask-fonts)\" remote set-url origin ${brew_source}/homebrew-cask-fonts.git git -C \"$(brew --repo homebrew/cask-drivers)\" remote set-url origin ${brew_source}/homebrew-cask-drivers.git ustc (中科大) brew_source='https://mirrors.ustc.edu.cn' # brew 程序本身 git -C \"$(brew --repo)\" remote set-url origin ${brew_source}/brew.git git -C \"$(brew --repo homebrew/core)\" remote set-url origin ${brew_source}/homebrew-core.git git -C \"$(brew --repo homebrew/cask)\" remote set-url origin ${brew_source}/homebrew-cask.git ali (阿里) brew_source='https://mirrors.aliyun.com/homebrew' # brew 程序本身 git -C \"$(brew --repo)\" remote set-url origin ${brew_source}/brew.git git -C \"$(brew --repo homebrew/core)\" remote set-url origin ${brew_source}/homebrew-core.git tencent brew_source='https://mirrors.cloud.tencent.com/homebrew' # brew 程序本身 git -C \"$(brew --repo)\" remote set-url origin ${brew_source}/brew.git git -C \"$(brew --repo homebrew/core)\" remote set-url origin ${brew_source}/homebrew-core.git git -C \"$(brew --repo homebrew/cask)\" remote set-url origin ${brew_source}/homebrew-cask.git git -C \"$(brew --repo homebrew/cask-fonts)\" remote set-url origin ${brew_source}/homebrew-cask-fonts.git git -C \"$(brew --repo homebrew/cask-drivers)\" remote set-url origin ${brew_source}/homebrew-cask-drivers.git homebrew bottles address: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles https://mirrors.ustc.edu.cn/homebrew-bottles https://mirrors.aliyun.com/homebrew/homebrew-bottles https://mirrors.cloud.tencent.com/homebrew-bottles $ export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.cloud.tencent.com/homebrew-bottles homebrew caskroom installation $ brew tap caskroom/versions $ brew cask outdated $ brew tap buo/cask-upgrade $ brew update $ brew cu --all home brew cask upgrade $ brew cu -a -y -f ==> Options Include auto-update (-a): true Include latest (-f): true ==> Updating Homebrew Already up-to-date. ==> Finding outdated apps Cask Current Latest A/U Result 1/10 alfred 3.5.1_883 3.5.1_883 Y [ OK ] 2/10 android-sdk 3859397,26.0.2 3859397,26.0.2 [ OK ] 3/10 dash 4.1.1 4.1.1 Y [ OK ] 4/10 etcher 1.2.1 1.2.1 [ OK ] 5/10 firefox 57.0.2 57.0.2 Y [ OK ] 6/10 imageoptim 1.7.3 1.7.3 Y [ OK ] 7/10 iterm2-beta 3.1.5.beta.1 3.1.5.beta.2 Y [ FORCED ] 8/10 java8 1.8.0_152-b16,aa0333dd3019491ca4f6ddbe78cdb6d0 1.8.0_152-b16,aa0333dd3019491ca4f6ddbe78cdb6d0 [ OK ] 9/10 little-snitch 4.0.4 4.0.4 Y [ OK ] 10/10 mounty latest latest [ OK ] ==> Found outdated apps Cask Current Latest A/U Result 1/1 iterm2-beta 3.1.5.beta.1 3.1.5.beta.2 Y [ FORCED ] ==> Upgrading iterm2-beta to 3.1.5.beta.2 ==> Satisfying dependencies ==> Downloading https://iterm2.com/downloads/beta/iTerm2-3_1_5_beta_2.zip ######################################################################## 100.0% ==> Verifying checksum for Cask iterm2-beta ==> Installing Cask iterm2-beta Warning: It seems there is already an App at '/Applications/iTerm.app'; overwriting. ==> Removing App '/Applications/iTerm.app'. ==> Moving App 'iTerm.app' to '/Applications/iTerm.app'. 🍺 iterm2-beta was successfully installed! or$ brew upgrade --cask --greedy package installation reference: Homebrew Formulae - macvim MacVim more on mytools/osx/belloMyOSX systemlist=\"imagemagick coreutils bash proctools pstree vnstat ncdu ipcalc htop ack lsof trash\" regularlist=\"wget tmux corkscrew tig ifstat binutils diffutils gawk gnutls gzip less file-formula stow telnet iproute2mac ctags jshon colordiff tree vifm p7zip git mas htop watch jfrog-cli-go youtube-dl etcd mas figlet screenfetch glances bash-completion@2 dos2unix nmap rename renameutils pipenv inetutils hadolint\" regularheadlist=\"shellcheck bats jq gradle-completion git-flow\" gnulist=\"gnu-sed gnu-tar gnu-which grep ed findutils gnu-indent\" # utils $ brew install imagemagick coreutils moreutils bash proctools pstree vnstat ncdu ipcalc htop ack lsof trash $ brew install wget tmux corkscrew telnet figlet $ brew install gnu-sed --with-default-names $ brew install stow iproute2mac pandoc $ brew install macvim $ brew install wdiff --with-gettext $ brew install less --with-pcre deprecated (macvim) $ brew install macvim --with-override-system-vim --HEAD # OR $ brew tap macvim-dev/macvim $ brew install --HEAD macvim-dev/macvim/macvim $ brew linkapps macvim # OR $ brew linkapps # OR $ HOME_APPS = File.expand_path(\"/Applications\") # OR (Using none-link Info.plist and PkgInfo in *.app/Contents/) $ mkdir -p /Applications/gVim.app/Contents $ ln -sf /usr/local/Cellar/macvim/HEAD-a5e0355/gVim.app/Contents/* /Applications/gVim.app/Contents/ $ mv /Applications/gVim.app/Contents/Info.plist{,.link} $ mv /Applications/gVim.app/Contents/PkgInfo{,.link} $ cp /Applications/gVim.app/Contents/Info.plist{.link,} $ cp /Applications/gVim.app/Contents/PkgInfo{.link,} brew upgrade ignore specific formulas Ignore formula on brew upgrade $ brew pin macvim $ brew list --pinned macvim $ brew upgrade Updating Homebrew... Error: Not upgrading 1 pinned package: macvim HEAD-caf7642_1 ==> Upgrading 6 outdated packages: ghostscript 9.53.2 -> 9.53.3 groovy 3.0.5 -> 3.0.6 node 14.12.0 -> 14.13.1 unbound 1.11.0 -> 1.12.0 nmap 7.80_1 -> 7.90 imagemagick 7.0.10-31 -> 7.0.10-34 ... unpin$ brew unpin macvim $ brew list --pinned Spotlight Error $ xattr -dr com.apple.quarantine MacVim.app $ osascript -e 'tell application \"Finder\" to make alias file to POSIX file \"/usr/local/opt/macvim/MacVim.app\" at POSIX file \"/Applications\"' Warning $ brew linkapps macvim Warning: `brew linkapps` has been deprecated and will eventually be removed! Unfortunately `brew linkapps` cannot behave nicely with e.g. Spotlight using either aliases or symlinks and Homebrew formulae do not build \"proper\" `.app` bundles that can be relocated. Instead, please consider using `brew cask` and migrate formulae using `.app`s to casks. Linking: /usr/local/opt/macvim/MacVim.app Linked 1 app to /Applications macvim build install from sourcode $ brew install --HEAD macvim-dev/macvim/macvim ==> Installing macvim from macvim-dev/macvim ==> Installing dependencies for macvim-dev/macvim/macvim: python3, lua ==> Installing macvim-dev/macvim/macvim dependency: python3 ==> Downloading https://homebrew.bintray.com/bottles/python3-3.6.3.high_sierra.bottle.tar.gz ==> Pouring python3-3.6.3.high_sierra.bottle.tar.gz You can try again using `brew postinstall python3` ==> Caveats Pip, setuptools, and wheel have been installed. To update them pip3 install --upgrade pip setuptools wheel You can install Python packages with pip3 install They will install into the site-package directory /usr/local/lib/python3.6/site-packages See: https://docs.brew.sh/Homebrew-and-Python.html ==> Summary 🍺 /usr/local/Cellar/python3/3.6.3: 3,009 files, 48MB ==> Installing macvim-dev/macvim/macvim dependency: lua ==> Downloading https://homebrew.bintray.com/bottles/lua-5.3.4_2.high_sierra.bottle.tar.gz ==> Pouring lua-5.3.4_2.high_sierra.bottle.tar.gz ==> Caveats Please be aware due to the way Luarocks is designed any binaries installed via Luarocks-5.3 AND 5.1 will overwrite each other in /usr/local/bin. This is, for now, unavoidable. If this is troublesome for you, you can build rocks with the `--tree=` command to a special, non-conflicting location and then add that to your `$PATH`. ==> Summary 🍺 /usr/local/Cellar/lua/5.3.4_2: 147 files, 752.9KB ==> Installing macvim-dev/macvim/macvim --HEAD ==> Cloning https://github.com/macvim-dev/macvim.git Updating /Users/marslo/Library/Caches/Homebrew/macvim--git ==> Checking out branch master ==> ./configure --prefix=/usr/local/Cellar/macvim/HEAD-4bf1de8 --with-features=huge --enable-multibyte --enable-terminal --enable-netbeans --with-tlib=ncurses --enable-cscope --enable-termtruecolor --enable-perlinterp=dynamic --enable-pythoninterp=dynamic --enable-python3interp=dynamic --enable-rubyinterp=dynamic --enable-luainterp=dynamic --with-lua-prefix=/usr/local ==> make ==> PATH=/usr/local/Cellar/gettext/0.19.8.1/bin:$PATH MSGFMT=/usr/local/Cellar/gettext/0.19.8.1/bin/msgfmt INSTALL_DATA=install FILEMOD=644 LOCALEDIR=../../src/MacVim/build/Release/MacVim.app/Contents/Resources/vim/runtime/lang make -C src/po install 🍺 /usr/local/Cellar/macvim/HEAD-4bf1de8: 2,183 files, 39.7MB, built in 1 minute 13 seconds check formula config files $ brew -v edit macvim Editing /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/macvim.rb vim /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/macvim.rb ... system \"./configure\", \"--with-features=huge\", \"--enable-multibyte\", \"--enable-perlinterp\", \"--enable-rubyinterp\", \"--enable-tclinterp\", \"--enable-terminal\", \"--with-tlib=ncurses\", \"--with-compiledby=Homebrew\", \"--with-local-dir=#{HOMEBREW_PREFIX}\", \"--enable-cscope\", \"--enable-luainterp\", \"--with-lua-prefix=#{Formula[\"lua\"].opt_prefix}\", \"--enable-luainterp\", \"--enable-python3interp\", \"--disable-sparkle\" ... # or $ brew -v edit macvim-dev/macvim/macvim manual install formula How to prevent homebrew from upgrading a package? $ brew -v edit macvim $ brew -v fetch --deps macvim $ brew -v install --build-from-source macvim $ brew pin macvim brew debug info$ brew info --analytics doctor $ brew doctor info $ brew config HOMEBREW_VERSION: 2.6.0-211-g2c77a54 ORIGIN: ${brew_source}/brew HEAD: 2c77a540b522c2eee74af0745851167412adb83b Last commit: 68 minutes ago Core tap ORIGIN: ${brew_source}/homebrew-core Core tap HEAD: 4fb418f9d1b35c372d82d0b49b0f1df9143be236 Core tap last commit: 20 minutes ago Core tap branch: master HOMEBREW_PREFIX: /usr/local HOMEBREW_CASK_OPTS: [] HOMEBREW_EDITOR: vim HOMEBREW_INSTALL_BADGE: ☕️ 🐸 HOMEBREW_MAKE_JOBS: 12 Homebrew Ruby: 2.6.3 => /System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/bin/ruby CPU: dodeca-core 64-bit kabylake Clang: 12.0 build 1200 Git: 2.29.2 => /usr/local/bin/git Curl: 7.64.1 => /usr/bin/curl Java: 1.8.271.09, 1.8.0_211 macOS: 11.0.1-x86_64 CLT: 12.2.0.0.1.1604076827 Xcode: 12.2 tricky get info $ brew --repository /usr/local/Homebrew $ brew --prefix python@3 /usr/local/opt/python@3.9 $ brew --cache /Users/marslo/Library/Caches/Homebre $ brew --repo homebrew/core /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core cleanup # Remove all cache files older than specified days $ brew cleanup --prune=1 # remove all caches $ brew cleanup -s check formula $ git -C \"$(brew --repo homebrew/core)\" show a2f05fb0b2^:Formula/rmtrash.rb class Rmtrash list the packages installed from taps $ brew tap-info --installed to get formula name$ brew tap-info macvim-dev/macvim --json | jq -r '.[]|(.formula_names[])' macvim-dev/macvim/macvim manual download and install from local # download manually due to proxy issue $ curl -O https://downloads.sourceforge.net/gptfdisk/gdisk-1.0.9.pkg $ mv gdisk-1.0.9.pkg $(brew --cache -s gdisk) check local cache path$ brew --cache -s system settings GNU Coreutils $ brew install coreutils GNU Command Line Tools$ cat /etc/bashrc export PATH=\"$(brew --prefix coreutils)/libexec/gnubin:/usr/local/bin:$PATH\" bash $ brew install bash $ which -a bash /usr/local/bin/bash /bin/bash $ /usr/local/bin/bash --version GNU bash, version 4.4.12(1)-release (x86_64-apple-darwin17.0.0) Copyright (C) 2016 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later This is free software; you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. $ /bin/bash --version GNU bash, version 3.2.57(1)-release (x86_64-apple-darwin17) Copyright (C) 2007 Free Software Foundation, Inc. development tools $ brew install binutils diffutils gawk ctags jshon colordiff tree p7zip gnutls gzip watch $ brew install jq --devel --HEAD $ brew install cmake --with-completion --HEAD $ brew install ed --with-default-names $ brew install findutils --with-default-names $ brew install gnu-tar --with-default-names $ brew install gnu-which --with-default-names $ brew install grep --with-default-names $ brew install gnu-indent --with-default-names $ brew install file-formula applications(brew, cask and mas) $ brew tap homebrew/dupes # Optional $ brew tap macvim-dev/macvim $ brew install vim --override-system-vi $ brew install macvim --with-override-system-vim --HEAD # OR $ brew install --HEAD macvim-dev/macvim/macvim $ brew install jfrog-cli-go # JFrog CLI OR $ CURL -FL HTTPS://XRAY.JFROG.IO | SH $ brew install mas # app tools like appstore $ brew install youtube-dl $ brew cask install firefox $ brew cask install google-chrome # OR $ brew cask install google-chrome-dev $ brew cask install moom # instead of mas install 419330170 $ brew cask install dash $ brew cask install little-snitch $ brew cask install vlc $ mas install 1256503523 # System Indicators $ mas install 836500024 # WeChat $ mas install 1233593954 # MailMaster $ mas install 467939042 # Growl $ mas install 497799835 # Xcode $ mas install 736473980 # Paint $ mas install 520993579 # pwSafe $ mas install 944848654 # NeteaseMusic $ mas install 419330170 # Moom $ mas list 1256503523 System Indicators (1.0.6) 836500024 WeChat (2.3.5) 1233593954 MailMaster (2.2.2) 467939042 Growl (2.1.3) 497799835 Xcode (9.2) 736473980 Paint 2 (5.6.5) 520993579 pwSafe (4.11) 944848654 NeteaseMusic (1.5.7) 419330170 Moom (3.2.10) alternative list $ find /Applications/*.app/Contents/_MASReceipt/receipt -maxdepth 4 -print | sed 's#.app/Contents/_MASReceipt/receipt#.app#g; s#/Applications/##' Alfred.app Growl.app MailMaster.app Moom.app NeteaseMusic.app Paint S.app System Indicators.app WeChat.app Xcode.app pwSafe.app accessory iTerm2 Install Shell Integration$ curl -L https://iterm2.com/shell_integration/install_shell_integration_and_utilities.sh | bash more settings backgroundmusic $ (set -eo pipefail; URL='https://github.com/kyleneideck/BackgroundMusic/archive/master.tar.gz'; \\ cd $(mktemp -d); echo Downloading $URL to $(pwd); curl -qfL# $URL | gzcat - | tar x && \\ /bin/bash BackgroundMusic-master/build_and_install.sh -w && rm -rf BackgroundMusic-master) logs $ (set -eo pipefail; URL='https://github.com/kyleneideck/BackgroundMusic/archive/master.tar.gz'; \\ -> cd $(mktemp -d); echo Downloading $URL to $(pwd); curl -qfL# $URL | gzcat - | tar x && \\ -> /bin/bash BackgroundMusic-master/build_and_install.sh -w && rm -rf BackgroundMusic-master) Downloading https://github.com/kyleneideck/BackgroundMusic/archive/master.tar.gz to /var/folders/dm/dblpttpn3c5cdvg_g2rthhvh0000gn/T/tmp.mixzjjg1 ######################################################################## 100.0% About to install Background Music. Please pause all audio, if you can. This script will install: - /Applications/Background Music.app - /Library/Audio/Plug-Ins/HAL/Background Music Device.driver - /Library/Application Support/Background Music/BGMXPCHelper.xpc - /Library/LaunchDaemons/com.bearisdriving.BGM.XPCHelper.plist Continue (y/N)? y Password: [1/3] Installing the virtual audio device Background Music Device.driver to /Library/Audio/Plug-Ins/HAL [2/3] Installing BGMXPCHelper.xpc to /Library/Application Support/Background Music [3/3] Installing Background Music.app to /Applications Restarting coreaudiod to load the virtual audio device. Launching Background Music. Done. mac cli $ sh -c \"$(curl -fsSL https://raw.githubusercontent.com/marslo/mac-cli/master/mac-cli/tools/install)\" example $ mac bluetooth:status Bluetooth: ON $ mac speedtest Testing internet connection speed... 4.2 Mbps ↓ others markdown-toc $ npm i -g --save markdown-toc --verbose doctoc $ npm install -g doctoc usage$ doctoc --gitlab my_osx.md $ doctoc --github --maxlevel 3 */*.md gitbook $ npm install gitbook-cli -g usage$ gitbook init $ gitbook serve $ gitbook build gitbook-summary $ npm install -g gitbook-summary usage:$ book sm -d -t 'life is hard, make it easier' npm-completion $ npm i -g npm-completion usage$ PATH_TO_NPM_COMPLETION=\"/usr/local/lib/node_modules/npm-completion\" $ source $PATH_TO_NPM_COMPLETION/npm-completion.sh reveal.js $ git clone git@github.com:hakimel/reveal.js.git $ cd reveal.js $ npm i -g usage$ npm start -- --port=8081 (http://localhost:8081) gnomon $ npm i -g gnomon usage$ ping 127.0.0.1 | gnomon 0.0066s PING 127.0.0.1 (127.0.0.1): 56 data bytes 0.8694s 18:13:43.219648 64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.048 ms 0.9999s 18:13:44.221333 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.116 ms 1.0004s 18:13:45.221475 64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.088 ms 1.0047s 18:13:46.222231 64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.059 ms 1.0001s 18:13:47.226847 64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.101 ms 1.0049s 18:13:48.227248 64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.100 ms 1.0049s 18:13:49.232354 64 bytes from 127.0.0.1: icmp_seq=6 ttl=64 time=0.093 ms 0.5038s 18:13:50.237433 64 bytes from 127.0.0.1: icmp_seq=7 ttl=64 time=0.091 ms iStats $ sudo gem install iStats -n /usr/local/bin usage $ istats all --- CPU Stats --- CPU temp: 57.19°C ▁▂▃▅▆▇ --- Fan Stats --- Total fans in system: 2 Fan 0 speed: 2146 RPM ▁▂▃▅▆▇ Fan 1 speed: 1985 RPM ▁▂▃▅▆▇ --- Battery Stats --- Battery health: unknown Cycle count: 34 ▁▂▃▅▆▇ 3.4% Max cycles: 1000 Current charge: 6073 mAh ▁▂▃▅▆▇ 100% Maximum charge: 6236 mAh ▁▂▃▅▆▇ 85.0% Design capacity: 7336 mAh Battery temp: 35.8°C For more stats run `istats extra` and follow the instructions. q&a Failed to connect to raw.githubusercontent.com port 443: Connection refused issueFailed to connect to raw.githubusercontent.com port 443: Connection refused solution sudo bash -c \" echo '199.232.28.133 raw.githubusercontent.com' >> /etc/hosts\" checking host IP address via https://www.ipaddress.com/ additional reference: DNS查询 iP或域名查询 flush DNS via sudo killall -HUP mDNSResponder sudo bash -c cat >> /etc/hosts failure in brew search for cask formula issue $ brew install --cask firefox-developer-edition Error: Cask 'firefox-developer-edition' is unavailable: No Cask with this name exists. $ brew search firefox ==> Casks firefox multifirefox solution $ git -C $(brew --repo homebrew/cask-versions) st On branch master Your branch is up to date with 'origin/master'. Changes not staged for commit: (use \"git add/rm ...\" to update what will be committed) (use \"git restore ...\" to discard changes in working directory) deleted: Casks/firefox-beta.rb deleted: Casks/firefox-developer-edition.rb deleted: Casks/firefox-esr.rb deleted: Casks/firefox-nightly.rb no changes added to commit (use \"git add\" and/or \"git commit -a\") $ git -C $(brew --repo homebrew/cask-versions) reset --hard HEAD is now at 67d487bd6 Update dotnet-preview from 6.0.0-preview.4.21253.7,bab80210-ac54-44fa-bf41-7474c6371cf2:eadcd657b93e347d08bc33c59bd60835 to 6.0.0-preview.5.21301.5,c326f2e1-10ee-482e-9871-5fb8de7f7777:dda8203d3b58e56efeca4a7248cdea67 (#11293) Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:24 "},"osx/util.html":{"url":"osx/util.html","title":"util","keywords":"","body":" Table of Contents generated with DocToc brew force the link and overwrite everything rerurn postinstall check brew configure file whatprovide alternatives tricky rpm & dpkg & brew brew command network show network information change order of networks list hardware IP DNS proxy setup wifi firewall reference Mac OS X Server Command-Line Administration brew force the link and overwrite everything $ brew link --overwrite example $ brew link --overwrite --dry-run python@3.8 Would remove: /usr/local/bin/python3 -> /usr/local/Cellar/python@3.9/3.9.0/bin/python3.9 If you need to have this software first in your PATH instead consider running: echo 'export PATH=\"/usr/local/opt/python@3.8/bin:$PATH\"' >> /Users/marslo/.bash_profile rerurn postinstall $ brew postinstall i.e.: $ sudo chown marslo:admin -R /usr/local/lib/python3.8/site-packages $ brew postinstall python@3.8 ==> Postinstalling python@3.8 ==> /usr/local/Cellar/python@3.8/3.8.6_1/bin/python3 -s setup.py --no-user-cfg install --force --verbose --install-scripts=/usr/local/Cellar/python@3.8 ==> /usr/local/Cellar/python@3.8/3.8.6_1/bin/python3 -s setup.py --no-user-cfg install --force --verbose --install-scripts=/usr/local/Cellar/python@3.8 ==> /usr/local/Cellar/python@3.8/3.8.6_1/bin/python3 -s setup.py --no-user-cfg install --force --verbose --install-scripts=/usr/local/Cellar/python@3.8 update homebrew-cask $ git -C \"/usr/local/Homebrew/Library/Taps/homebrew/homebrew-cask\" fetch --unshallow check brew configure file $ brew -v edit i.e.: $ brew -v edit openjdk manual install formula $ brew -v edit macvim $ brew -v fetch --deps macvim $ brew -v install --build-from-source macvim $ brew pin macvim whatprovide alternatives $ pkgutil --file-info /usr/bin/qlmanage volume: / path: /usr/bin/qlmanage pkgid: com.apple.pkg.Core pkg-version: 10.15.0.1.1.1569789135 install-time: 1570542610 uid: 0 gid: 0 mode: 755 for brew formula$ while read formula; do brew list --formula \"${formula}\" | grep -w magick; done tricky reference: Tips and Tricks interactive homebrew shell $ brew irb ==> Interactive Homebrew Shell Example commands available with: brew irb --examples WARNING: This version of ruby is included in macOS for compatibility with legacy software. In future versions of macOS the ruby runtime will not be available by default, and may require you to install an additional package. irb(main):001:0> list dependencies $ brew deps macvim Warning: Treating macvim as a formula. For the cask, use homebrew/cask/macvim cscope gdbm gettext libyaml lua openssl@1.1 python@3.9 readline ruby sqlite xz list who depends on $ brew uses --installed cscope macvim list all formula dpendencies $ brew list | while read cask; do echo -e -n \"\\e[1;34m$cask ->\\e[0m\"; brew deps $cask | awk '{printf(\" %s \", $0)}'; echo \"\"; done e.g.: $ brew list | while read cask; do echo -e -n \"\\e[1;34m$cask ->\\e[0m\"; brew deps $cask | awk '{printf(\" %s \", $0)}'; echo \"\"; done Warning: Calling `brew list` to only list formulae is deprecated! Use `brew list --formula` instead. ack -> adns -> aom -> autoconf -> autoconf-archive -> autoconf automake -> autoconf bash -> bash-completion -> bash-completion@2 -> bash bats -> bdw-gc -> berkeley-db -> openssl@1.1 binutils -> cabal-install -> ghc cairo -> fontconfig freetype gdbm gettext glib libffi libpng lzo openssl@1.1 pcre pixman python@3.8 readline sqlite xz ... rpm & dpkg & brew rpm dpkg brew rpm -qa dpkg -l brew list rpm -ql sofrwareanme dpkg -L softwarename dpkg --listfiles softwarename dpkg-qurery -L softwarename brew list softwarename brew ls --verbose software rpm -qf /path/to/file yum whatprovides /path/to/file dpkg -S /path/to/file rpm -qip pkgfile.rpm rpm -qlp pkgfile.rpm dpkg -l pkgfile.deb dpkg -c pkgfile.deb rpm -q softwarename rpm -qi softwarename dpkg -l softwarename dpkg -s softwarename dpkg -p softwarename brew info softwarename rpm -e softwarename dpkg -r softwarename dpkg -P softwareanme brew uninstall softwarename brew command command description brew --cache Print path to Homebrew’s download cache (usually ~/Library/Caches/Homebrew) brew --cellar Print path to Homebrew’s Cellar (usually /usr/local/Cellar) brew --config Print system configuration info brew --env Print Homebrew’s environment brew --prefix Print path to Homebrew’s prefix (usually /usr/local) brew --prefix [formula] Print where formula is installed brew audit Audit all formulae for common code and style issues brew cleanup [formula] Remove older versions from the Cellar for all (or specific) formulae1 brew create [url] Generate formula for downloadable file at url and open it in $HOMEBREW_EDITOR or $EDITOR2 brew create [tarball-url] --cache Generate formula (including MD5), then download the tarball brew create --fink [formula] Open Fink’s search page in your browser, so you can see how they do formula brew create --macports [formula] Open MacPorts’ search page in your browser, so you can see how they do formula brew deps [formula] List dependencies for formula brew doctor Check your Homebrew installation for common issues brew edit Open all of Homebrew for editing in TextMate brew edit [formula] Open [formula] in $HOMEBREW_EDITOR or $EDITOR brew fetch --force -v --HEAD [formula] Download source package for formula; for tarballs, also prints MD5, SHA1, and SHA256 checksums brew home Open Homebrew’s homepage in your browser brew home [formula] Opens formula ’s homepage in your browser brew info Print summary of installed packages brew info [formula] Print info for formula (regardless of whether formula is installed) brew info --github [formula] Open Github’s History page for formula in your browser brew install [formula] Install formula brew install --HEAD [formula] Install the HEAD version of formula (if its formula defines HEAD) brew install --force --HEAD [formula] Install a newer HEAD version of formula (if its formula defines HEAD) brew link [formula] Symlink all installed files for formula into the Homebrew prefix3 brew list [formula] List all installed files for formula (or all installed formulae with no arguments ) brew options [formula] Display install options specific to formula brew outdated List formulae that have an updated version available (brew install formula will install the newer version) brew prune Remove dead symlinks from Homebrew’s prefix4 brew remove [formula] Uninstall formula brew search List all available formula brew search [formula] Search for formula in all available formulae brew search /[formula]/ Search for /formula/ (as regex) in all available formulae brew test [formula] If formula defines a test, run it brew unlink [formula] Unsymlink formula from Homebrew’s prefix brew update Update formulae and Homebrew itself brew upgrade Install newer versions of outdated packages brew upgrade [formula] Install newer version of formula brew versions [formula] List previous versions of formulae, along with a command to checkout each version network show network information $ networksetup -listnetworkserviceorder An asterisk (*) denotes that a network service is disabled. (1) USB 10/100/1000 LAN (Hardware Port: USB 10/100/1000 LAN, Device: en7) (2) Wi-Fi (Hardware Port: Wi-Fi, Device: en0) ... or$ networksetup -listallnetworkservices An asterisk (*) denotes that a network service is disabled. USB 10/100/1000 LAN Wi-Fi Bluetooth PAN Thunderbolt Bridge change order of networks $ networksetup -ordernetworkservices \"Wi-Fi\" \"Ethernet\" \"USB Ethernet\" list hardware $ networksetup -listallhardwareports list detail of hardware$ networksetup -getinfo 'USB 10/100/1000 LAN' DHCP Configuration IP address: 192.168.1.10 Subnet mask: 255.255.255.0 Router: 192.168.1.1 Client ID: IPv6: Automatic IPv6 IP address: none IPv6 Router: none Ethernet Address: **:**:**:**:**:** IP find local device ip address$ arp -a DNS Get Info $ scutil --dns DNS configuration resolver #1 ... resolver #7 DNS configuration (for scoped queries) resolver #1 search domain[0] : ... nameserver[0] : ... nameserver[1] : ... nameserver[2] : ... if_index : ... flags : ... reach : ... setup DNS $ networksetup -getdnsservers Wi-Fi There aren't any DNS Servers set on Wi-Fi. $ networksetup -setdnsservers Wi-Fi 192.168.236.5 192.168.35.78 192.168.2.69 192.168.200.139 $ networksetup -getdnsservers Wi-Fi 192.168.236.5 192.168.35.78 192.168.2.69 192.168.200.139 $ cat /etc/resolv.conf nameserver 192.168.236.5 nameserver 192.168.35.78 nameserver 192.168.2.69 nameserver 192.168.200.139 proxy setup $ networksetup -getwebproxy Wi-Fi Enabled: No Server: Port: 0 Authenticated Proxy Enabled: 0 $ networksetup -getwebproxy Ethernet Enabled: No Server: Port: 0 Authenticated Proxy Enabled: 0 $ networksetup -getproxybypassdomains Ethernet *.local 169.254/16 $ scutil --proxy { HTTPEnable : 0 HTTPSEnable : 0 ProxyAutoConfigEnable : 1 ProxyAutoConfigURLString : http://my.pac.com/global-pac.pac SOCKSEnable : 0 } wifi get wifi name connection currently$ networksetup -getairportnetwork en0 Current Wi-Fi Network: WLAN-PUB connect to another $ networksetup -setairportnetwork en0 WLAN-PUB $ networksetup -getairportnetwork en0 Current Wi-Fi Network: WLAN-PUB $ networksetup -setairportnetwork en0 Automation-4G $ networksetup -getairportnetwork en0 Current Wi-Fi Network: Automation-4G turn on/off wifi $ networksetup -setairportpower en0 on $ networksetup -getairportpower en0 Wi-Fi Power (en0): On $ networksetup -setairportpower en0 off $ networksetup -getairportpower en0 Wi-Fi Power (en0): Off scan available wifi network $ networksetup -setairportpower en0 on $ sudo /System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -s SSID BSSID RSSI CHANNEL HT CC SECURITY (auth/unicast/group) Customer **:**:**:**:**:** -75 11 N CN WEP CorpWLAN **:**:**:**:**:** -72 1 Y CN WPA2(802.1x,Unrecognized(0)/AES/AES) Guest **:**:**:**:**:** -71 1 Y CN NONE disable ipv6 $ networksetup -listallnetworkservices An asterisk (*) denotes that a network service is disabled. USB 10/100/1000 LAN Wi-Fi Bluetooth PAN Thunderbolt Bridge $ networksetup -setv6off 'USB 10/100/1000 LAN' $ networksetup -setv6off Wi-fi undo$ networksetup -setv6automatic 'USB 10/100/1000 LAN' $ networksetup -setv6automatic Wi-Fi show network connection history$ defaults read /Library/Preferences/SystemConfiguration/com.apple.airport.preferences \\ | grep LastConnected -A 7 get wifi password list all Wifi $ defaults read /Library/Preferences/SystemConfiguration/com.apple.airport.preferences | \\grep SSIDString ... SSIDString = \"Apple Network Guest\"; ... get password $ sudo security find-generic-password -ga \"Apple Network Guest\" | grep password\\: password: \"guest@3742\" firewall show status$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate Firewall is disabled. (State = 0) enable firewall$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:24 "},"osx/system.html":{"url":"osx/system.html","title":"system","keywords":"","body":" Table of Contents generated with DocToc system tools hostinfo get human-readable vm_stat show system info show memory show Mach virtual memory statistics check process without interactive mode show system Serial Number hardware memory swap usage show kernel version list printer status osx installation download older version create osx installer usb boot with macOS USB installer Convert a MacOS Installer to ISO flushed disk cache clean OSX native dot file launchctl create new plist Q&A SUPreferenceManager: Failed to set object of class: __NSCFString system tools hostinfo $ hostinfo Mach kernel version: Darwin Kernel Version 19.6.0: Mon Aug 31 22:12:52 PDT 2020; root:xnu-6153.141.2~1/RELEASE_X86_64 Kernel configured for up to 12 processors. 6 processors are physically available. 12 processors are logically available. Processor type: x86_64h (Intel x86-64h Haswell) Processors active: 0 1 2 3 4 5 6 7 8 9 10 11 Primary memory available: 16.00 gigabytes Default processor set: 463 tasks, 2557 threads, 12 processors Load average: 2.72, Mach factor: 9.26 get human-readable vm_stat $ paste 1' | grep -o \".*:\") 1' | tr -d '.' | awk '{print $NF}'); do perl -e \"print $i/1024\" | awk '{printf \"%0.2f\", $0}'; echo; done) | column -s: -t Pages free 328.70 Pages active 910.00 Pages inactive 973.38 Pages speculative 39.51 Pages throttled 0.00 Pages wired down 852.52 Pages purgeable 389.65 \"Translation faults\" 174323.38 Pages copy-on-write 7828.62 Pages zero filled 127404.04 Pages reactivated 3420.56 Pages purged 6392.20 File-backed pages 656.69 Anonymous pages 1266.20 Pages stored in compressor 2536.76 Pages occupied by compressor 991.23 Decompressions 1555.85 Compressions 8494.54 Pageins 7799.75 Pageouts 11.98 Swapins 43.15 Swapouts 48.46 show system info $ glances show memory $ top -o MEM iStat $ istats --- CPU Stats --- CPU temp: 53.19°C ▁▂▃▅▆▇ --- Fan Stats --- Total fans in system: 2 Fan 0 speed: 2157 RPM ▁▂▃▅▆▇ Fan 1 speed: 1995 RPM ▁▂▃▅▆▇ --- Battery Stats --- Battery health: unknown Cycle count: 34 ▁▂▃▅▆▇ 3.4% Max cycles: 1000 Current charge: 6093 mAh ▁▂▃▅▆▇ 100% Maximum charge: 6237 mAh ▁▂▃▅▆▇ 85.0% Design capacity: 7336 mAh Battery temp: 36.5°C For more stats run `istats extra` and follow the instructions. show Mach virtual memory statistics $ vm_stat check process without interactive mode $ top -l 1 -n 0 example $ top -l 1 -n 0 Processes: 472 total, 3 running, 469 sleeping, 2589 threads 2020/11/02 16:10:28 Load Avg: 2.67, 2.88, 3.12 CPU usage: 33.4% user, 20.46% sys, 46.49% idle SharedLibs: 268M resident, 69M data, 44M linkedit. MemRegions: 112888 total, 3016M resident, 90M private, 2802M shared. PhysMem: 16G used (3742M wired), 420M unused. VM: 3201G vsize, 1993M framework vsize, 44188(0) swapins, 49627(0) swapouts. Networks: packets: 1575080/1561M in, 1302980/954M out. Disks: 1368885/28G read, 648911/13G written. or$ top -l 1 -s 0 show system Serial Number $ /usr/sbin/system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Name: MacBook Pro Model Identifier: MacBookPro15,1 Processor Name: 6-Core Intel Core i7 Processor Speed: 2.2 GHz Number of Processors: 1 Total Number of Cores: 6 L2 Cache (per Core): 256 KB L3 Cache: 9 MB Hyper-Threading Technology: Enabled Memory: 16 GB Boot ROM Version: 10**.***.*.*.* (iBridge: 17.**.*****.*.*,*) Serial Number (system): ************ Hardware UUID: ********-****-****-****-************ Activation Lock Status: Enabled hardware cpu manufacture$ sysctl -n machdep.cpu.brand_string Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz or$ sysctl machdep.cpu machdep.cpu.max_basic: 22 machdep.cpu.max_ext: 2147483656 machdep.cpu.vendor: GenuineIntel machdep.cpu.brand_string: Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz machdep.cpu.family: 6 ... memory $ system_profiler SPHardwareDataType | grep \"Memory:\\|Cores:\\|Processors:\" Number of Processors: 1 Total Number of Cores: 6 Memory: 16 GB or $ sysctl hw.memsize hw.memsize: 17179869184 $ sysctl hw.ncpu hw.ncpu: 12 memory slot $ system_profiler SPMemoryDataType Memory: Memory Slots: ECC: Disabled Upgradeable Memory: No BANK 0/ChannelA-DIMM0: Size: 8 GB Type: DDR4 Speed: 2400 MHz Status: OK Manufacturer: Micron Part Number: **********-***** Serial Number: - BANK 2/ChannelB-DIMM0: Size: 8 GB Type: DDR4 Speed: 2400 MHz Status: OK Manufacturer: Micron Part Number: **********-***** Serial Number: swap usage $ sysctl vm.swapusage vm.swapusage: total = 1024.00M used = 34.00M free = 990.00M (encrypted) show kernel version $ sysctl kern.version kern.version: Darwin Kernel Version 20.1.0: Sat Oct 31 00:07:11 PDT 2020; root:xnu-7195.50.7~2/RELEASE_X86_64 $ sysctl kern.ostype kern.ostype: Darwin $ sysctl kern.osrelease kern.osrelease: 20.1.0 $ sysctl kern.osrevision kern.osrevision: 199506 or$ uname -a Darwin iMarslo 20.1.0 Darwin Kernel Version 20.1.0: Sat Oct 31 00:07:11 PDT 2020; root:xnu-7195.50.7~2/RELEASE_X86_64 x86_64 i386 MacBookPro15,1 Darwin list printer status $ lpstat -a printer-01 accepting requests since Wed Feb 3 16:40:50 2021 osx installation download older version How to Download Full MacOS Installers from Command Line $ softwareupdate --fetch-full-installer or $ softwareupdate --fetch-full-installer --full-installer-version **.**.* # i.e.: $ softwareupdate --fetch-full-installer --full-installer-version 10.15 MacOS Mojave 10.14.6 Installer $ softwareupdate --fetch-full-installer --full-installer-version 10.14.6 MacOS Catalina 10.15.3 Installer$ softwareupdate --fetch-full-installer --full-installer-version 10.15.3 MacOS High Sierra 10.13.6 Installer$ softwareupdate --fetch-full-installer --full-installer-version 10.13.6 create osx installer usb for Catalina FINAL version$ sudo /Applications/Install\\ macOS\\ Catalina.app/Contents/Resources/createinstallmedia --volume /Volumes/UNTITLED && echo Catalina Boot Drive Created for Catalina BETA version$ sudo /Applications/Install\\ macOS\\ Catalina\\ Beta.app/Contents/Resources/createinstallmedia --volume /Volumes/UNTITLED && echo Catalina Boot Drive Created boot with macOS USB installer connect the macOS Catalina 10.15 beta install drive to to the Mac you want to install Catalina onto reboot the Mac immediately hold down the OPTION key upon boot, keep holding Option until you see the boot menu choose the macOS Catalina 10.15 beta installer volume to boot from Convert a MacOS Installer to ISO download MacOS Mojave installer, or the MacOS Catalina installer (or the installer you wish to turn into an ISO) from the Mac App Store, untill the “Install MacOS Mojave.app” or “Install MacOS Catalina.app” application is fully downloaded and within the /Applications folder, proceed open the Terminal application, create a disk image DMG file via: $ hdiutil create -o /tmp/Mojave -size 8500m -volname Mojave -layout SPUD -fs HFS+J mount the created DMG disk image via: $ hdiutil attach /tmp/Mojave.dmg -noverify -mountpoint /Volumes/Mojave use createinstallmedia to create the macOS installer application on the mounted volume: $ sudo /Applications/Install\\ macOS\\ Mojave.app/Contents/Resources/createinstallmedia --volume /Volumes/Mojave --nointeraction unmount the volume just created: $ hdiutil detach /volumes/Install\\ macOS\\ Mojave convert the DMG disk image file to an ISO disk image file (technically a CDR file but it’s the same as an iso) $ hdiutil convert /tmp/Mojave.dmg -format UDTO -o ~/Desktop/Mojave.cdr rename the CDR file extension to ISO to convert the CDR to ISO: $ mv ~/Desktop/Mojave.cdr ~/Desktop/Mojave.iso more info: Convert ISO to VDI Virtual Box Image flushed disk cache $ sudo purge clean OSX native dot file $ dot_clean -mvp i.e.:$ sudo dot_clean -mvp / OR $ find $HOME -name '.DS_Store' -type f -delete launchctl create new plist cat > ~/Library/LaunchAgents/i.marslo.updatedb.plist Label i.marslo.updatedb ProgramArguments sudo /usr/local/bin/gupdatedb RunAtLoad StandardErrorPath /Users/marslo/.marslo/log/i.marslo.updatedb.log StandardOutPath /Users/marslo/.marslo/log/i.marslo.updatedb.error.log StartInterval 300 KeepAlive EOF check$ plutil ~/Library/LaunchAgents/i.marslo.updatedb.plist /Users/marslo/Library/LaunchAgents/i.marslo.updatedb.plist: OK enable$ launchctl load ~/Library/LaunchAgents/i.marslo.updatedb.plist $ launchctl list | grep updatedb - 1 i.marslo.updatedb disable$ launchctl remove i.marslo.updatedb Q&A SUPreferenceManager: Failed to set object of class: __NSCFString issue:$ softwareupdate --fetch-full-installer Downloading and installing com.apple.InstallAssistant.macOSBigSur installer SUPreferenceManager: Failed to set object of class: __NSCFString for key: LastRecommendedMajorOSBundleIdentifier with error: Error Domain=SUPreferenceManagerErrorDomain Code=1 \"(null)\" SUPreferenceManager: Failed to set object of class: __NSCFString for key: LastRecommendedMajorOSBundleIdentifier with error: Error Domain=SUPreferenceManagerErrorDomain Code=1 \"(null)\" SUPreferenceManager: Failed to set object of class: __NSCFString for key: LastRecommendedMajorOSBundleIdentifier with error: Error Domain=SUPreferenceManagerErrorDomain Code=1 \"(null)\" Installing: 90.0%SUPreferenceManager: Failed to set object of class: __NSCFString for key: LastRecommendedMajorOSBundleIdentifier with error: Error Domain=SUPreferenceManagerErrorDomain Code=1 \"(null)\" Install failed with error: 0 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:24 "},"osx/script.html":{"url":"osx/script.html","title":"script","keywords":"","body":" reference: How to automate your keyboard in Mac OS X with AppleScript Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-16 18:28:39 "},"osx/tricky.html":{"url":"osx/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc copy path copy STDOUT into clipboard Copy path from finder create an app for script get standalone commands for the script using Automator.app to create an app edit Contents/Info.plist create script to open the groovyConsole set the icon for new app move groovyConsole.app to /Application add snippets for input enable Technical Symbols And snippets finally others shutdown mac via commands turn off the screen without sleeping launch apps extra pkg create image disk disable startup music 3D lock screen take screenshot after 3 sec setup welcome text in login screen show message on desktop modify font in plist show process details copy path copy STDOUT into clipboard [!NOTE] pbcopy for macOS xclip for Linux $ | pbcopy example$ cat file | pbcopy $ pwd | pbcopy Copy path from finder right-click(control + left-click) -> option Automator -> Quick Action Automator -> Apple Script on run {input, parameters} try tell application \"Finder\" to set the clipboard to POSIX path of (target of window 1 as alias) on error beep end try return input end run create an app for script case: run groovyConsole from Spolite or Alfred reference: Install groovy console on Mac and make it runnable from dock get standalone commands for the script $ ps aux | grep groovyConsole | grep -v grep marslo 50495 0.0 3.4 11683536 577828 ?? S 5:50PM 0:15.85 /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/bin/java -Xdock:name=GroovyConsole -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns -Dgroovy.jaxb=jaxb -classpath /usr/local/opt/groovy/libexec/lib/groovy-3.0.6.jar -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole -Dprogram.name=groovyConsole -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf -Dgroovy.home=/usr/local/opt/groovy/libexec -Dtools.jar=/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter --main groovy.console.ui.Console --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf --classpath .:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. ==> which would be: /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/bin/java \\ -Xdock:name=GroovyConsole \\ -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns \\ -Dgroovy.jaxb=jaxb \\ -classpath /usr/local/opt/groovy/libexec/lib/groovy-3.0.6.jar \\ -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole \\ -Dprogram.name=groovyConsole \\ -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\ -Dgroovy.home=/usr/local/opt/groovy/libexec \\ -Dtools.jar=/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter \\ --main groovy.console.ui.Console \\ --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\ --classpath .:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. using Automator.app to create an app Open Automator.app » New » Application Select Run Shell Script » save to .app with empty shell script edit Contents/Info.plist $ vim groovyConsole.app/Contents/Info.plist ... CFBundleExecutable gConsole « the script name, can be any name you want CFBundleIconFile groovy CFBundleIdentifier com.apple.groovyConsole ... originalCFBundleExecutable Application Stub CFBundleIconFile AutomatorApplet CFBundleIdentifier com.apple.automator.groovyConsole create script to open the groovyConsole $ touch groovyConsole.app/Contents/MacOS/groovyConsole $ cat > groovyConsole.app/Contents/MacOS/groovyConsole #!/bin/bash -> /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/bin/java \\\\ -> -Xdock:name=GroovyConsole \\\\ -> -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns \\\\ -> -Dgroovy.jaxb=jaxb \\\\ -> -classpath /usr/local/opt/groovy/libexec/lib/groovy-3.0.6.jar \\\\ -> -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole \\\\ -> -Dprogram.name=groovyConsole \\\\ -> -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\\\ -> -Dgroovy.home=/usr/local/opt/groovy/libexec \\\\ -> -Dtools.jar=/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter \\\\ -> --main groovy.console.ui.Console \\\\ -> --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\\\ -> --classpath .:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. -> EOF $ chmod +x groovyConsole.app/Contents/MacOS/groovyConsole try validate via execute groovyConsole.app/Contents/MacOS/groovyConsole directly. to see whether if the groovyConsole will be opened. set the icon for new app optional $ cp /usr/local/opt/groovy/libexec/lib/groovy.icns groovyConsole.app/Contents/Resources or$ ln -sf /usr/local/opt/groovy/libexec/lib/groovy.icns groovyConsole.app/Contents/Resources/groovy.icns move groovyConsole.app to /Application $ mv groovyConsole.app/ /Applications/ add snippets for input enable Technical Symbols Input Method ⇢ Show emoji and symbols Open Customized List ⇢ Technical Symbols And snippets go to System Preferences ⇢ Keyboard ⇢ Test Add snippets as below finally others shutdown mac via commands $ osascript -e 'tell app 'loginwindow' to «event aevtrsdn»' turn off the screen without sleeping $ pmset displaysleepnow sleep $ pmset sleepnow lock $ pmset lock launch apps $ launchctl list extra pkg $ xar -xvf foo.pkg create image create dmg image$ hdiutil create -volname \"Volume Name\" \\ -srcfolder /path/to/folder \\ -ov diskimage.dmg create encrypted image $ hdiutil create -encryption \\ -stdinpass \\ -volname \"Volume Name\" \\ -srcfolder /path/to/folder \\ -ov encrypted.dmg creaste dvd (for .iso, .img, .dmg) $ hdiutil burn /path/to/image_file create disk image from volume $ sudo hdiutil create ~/Desktop/.dmg -srcdevice /dev/ i.e.:$ sudo hdiutil create ~/Desktop/Lion.dmg -srcdevice /dev/disk2s4 create disk image from a folder $ hdiutil create .dmg -volname \"\" -srcfolder /path/to/folder' i.e.: $ hdiutil create ~/Desktop/marsloTest.dmg -volname 'marslo test' -srcfolder ~/Desktop/marsloTest/ created: /Users/marslo/Desktop/marsloTest.dmg setup read & write dmg $ hdiutil create ~/Desktop/mTest.dmg \\ -volname \"Marslo Test\" \\ -srcfolder ~/Desktop/mTest \\ -size 1g \\ -format UDRW create encrypted disk image $ hdiutil create mEncrypted.dmg \\ -encryption \\ -size 1g \\ -volname \"mEncrypted Disk Image\" \\ -fs JHFS+ \\ -srcfolder /path/to/folder \\ Enter a new password to secure \"mEncrypted.dmg\": Re-enter new password: .... created: /Users/marslo/Desktop/mEncrypted.dmg resize the disk image $ hdiutil resize -size .dmg i.e.:$ hdiutil resize -size 2g mEncrypted.dmg restore disk images $ sudo asr restore --source .dmg --target /Volumes/ disk reference: Disk Management From the Command-Line, Part 1 Disk Management From the Command-Line, Part 2 Disk Management From the Command-Line, Part 3 check volumn info $ diskutil info i.e.: $ diskutil info /Volumes/iMarsloOSX/ Device Identifier: disk1s5 Device Node: /dev/disk1s5 Whole: No Part of Whole: disk1 Volume Name: iMarsloOSX Mounted: Yes Mount Point: / list disks and volumns $ diskutil list or $ diskutil list disk1 or lsblk $ docker run cmd.cat/lsblk lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT vda 254:0 0 16G 0 disk └─vda1 254:1 0 16G 0 part /etc/hosts or lshw $ docker run cmd.cat/lshw lshw -class disk *-virtio1 description: Virtual I/O device physical id: 0 bus info: virtio@1 logical name: vda configuration: driver=virtio_blk list the apfs info $ diskutil apfs list APFS Container (1 found) | +-- Container disk1 ********-****-****-****-************ ==================================================== APFS Container Reference: disk1 Size (Capacity Ceiling): 250685575168 B (250.7 GB) Capacity In Use By Volumes: 176258826240 B (176.3 GB) (70.3% used) Capacity Not Allocated: 74426748928 B (74.4 GB) (29.7% free) | +- | +-> ... check detail diskage usage $ sudo fs_usage 21:03:47 ioctl 0.000003 iTerm2 21:03:47 ioctl 0.000003 iTerm2 21:03:47 close 0.000031 privoxy 21:03:47 select 0.000004 privoxy ... erase disk File System Abbreviation Mac OS Extended (Journaled) JHFS+ Mac OS Extended HFS+ MS-DOS fat32 FAT32 ExFAT ExFAT $ diskutil listFilesystems ... ------------------------------------------------------------------------------- PERSONALITY USER VISIBLE NAME ------------------------------------------------------------------------------- Case-sensitive APFS APFS (Case-sensitive) (or) APFSX APFS APFS (or) APFSI ExFAT ExFAT Free Space Free Space (or) FREE MS-DOS MS-DOS (FAT) MS-DOS FAT12 MS-DOS (FAT12) MS-DOS FAT16 MS-DOS (FAT16) MS-DOS FAT32 MS-DOS (FAT32) (or) FAT32 HFS+ Mac OS Extended Case-sensitive HFS+ Mac OS Extended (Case-sensitive) (or) HFSX Case-sensitive Journaled HFS+ Mac OS Extended (Case-sensitive, Journaled) (or) JHFSX Journaled HFS+ Mac OS Extended (Journaled) (or) JHFS+ UFSD_NTFS Microsoft NTFS ExFAT $ diskutil eraseDisk ExFAT iMarsloUSB /dev/disk2 Started erase on disk2 Unmounting disk Creating the partition map Waiting for partitions to activate Formatting disk2s2 as ExFAT with name iMarsloUSB Volume name : iMarsloUSB Partition offset : 411648 sectors (210763776 bytes) Volume size : 246534144 sectors (126225481728 bytes) Bytes per sector : 512 Bytes per cluster: 131072 FAT offset : 2048 sectors (1048576 bytes) # FAT sectors : 8192 Number of FATs : 1 Cluster offset : 10240 sectors (5242880 bytes) # Clusters : 962984 Volume Serial # : 5ff81490 Bitmap start : 2 Bitmap file size : 120373 Upcase start : 3 Upcase file size : 5836 Root start : 4 Mounting disk Finished erase on disk2 check $ diskutil info disk2s1 Device Identifier: disk2s1 Device Node: /dev/disk2s1 Whole: No Part of Whole: disk2 Volume Name: EFI Mounted: No Partition Type: EFI File System Personality: MS-DOS FAT32 Type (Bundle): msdos Name (User Visible): MS-DOS (FAT32) ... ... $ diskutil info disk2s2 Device Identifier: disk2s2 Device Node: /dev/disk2s2 Whole: No Part of Whole: disk2 Volume Name: iMarsloUSB Mounted: Yes Mount Point: /Volumes/iMarsloUSB Partition Type: Microsoft Basic Data File System Personality: ExFAT Type (Bundle): exfat Name (User Visible): ExFAT ... ... Verifying and Repairing Volumes $ diskutil verifyVolume /Volumes/ $ diskutil repairVolume /Volumes/ rename volume $ diskutil rename \"\" \"\" Partitioning a Disk reference: GPT: GUID Partition Table APM: Apple Partition Map MBR: Master Boot Records $ diskutil partitionDisk /dev/disk2 GPT JHFS+ New 0b multiple partitions$ diskutil partitionDisk /dev/disk2 GPT \\ JHFS+ First 10g \\ JHFS+ Second 10g \\ JHFS+ Third 10g \\ JHFS+ Fourth 10g \\ JHFS+ Fifth 0b Splitting Partitions $ diskutil splitPartition /dev/disk2s6 \\ JHFS+ Test 10GB \\ JHFS+ Test2 0b Merging Partitions $ diskutil mergePartitions \\ JHFS+ \\ NewName \\ \\ i.e.: $ diskutil mergePartitions JHFS+ NewName disk2s4 disk2s6 check usb $ system_profiler SPUSBDataType or get xml format$ system_profiler -xml SPUSBDataType or$ ioreg -p IOUSB or$ ioreg -p IOUSB -w0 -l or get device name $ ioreg -p IOUSB -w0 | sed 's/[^o]*o //; s/@.*$//' | grep -v '^Root.*' disable startup music $ sudo nvram SystemAudioVolume=\" \" 3D lock screen $ /System/Library/CoreServices/Menu\\ Extras/User.menu/Contents/Resources/CGSession -suspend take screenshot after 3 sec $ screencapture -T 3 -t jpg -P delayedpic.jpg setup welcome text in login screen $ sudo defaults write /Library/Preferences/com.apple.loginwindow LoginwindowText 'Awesome Marslo!!' show message on desktop $ sudo jamf displayMessage -message \"Hello World!\" modify font in plist original $ defaults read ~/Library/Preferences/groovy.console.ui.plist { \"/groovy/console/ui/\" = { autoClearOutput = true; compilerPhase = 4; currentFileChooserDir = \"/Users/marslo/Desktop\"; decompiledFontSize = 12; fontSize = 18; frameHeight = 600; frameWidth = 800; frameX = 198; frameY = 201; horizontalSplitterLocation = 100; inputAreaHeight = 576; inputAreaWidth = 1622; outputAreaHeight = 354; outputAreaWidth = 1676; showClosureClasses = false; showIndyBytecode = false; showScriptClass = true; showScriptFreeForm = false; showScriptInOutput = false; showTreeView = true; threadInterrupt = true; verticalSplitterLocation = 100; }; } or$ /usr/libexec/PlistBuddy -c 'print \":/groovy/console/ui/:fontSize\"' ~/Library/Preferences/groovy.console.ui.plist 18 change$ /usr/libexec/PlistBuddy -c 'Set \":/groovy/console/ui/:fontSize\" 24' ~/Library/Preferences/groovy.console.ui.plist $ /usr/libexec/PlistBuddy -c 'Print \":/groovy/console/ui/:fontSize\"' ~/Library/Preferences/groovy.console.ui.plist 24 show process details Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:23 "},"linux/basic.html":{"url":"linux/basic.html","title":"linux","keywords":"","body":" Table of Contents generated with DocToc character metacharacter Process Substitution example: run script without download example: merge lines of file nstalling tools via running random scripts from unknown sites strace Basic Commands du sed others you have new mail CentOS Yum File \"/usr/libexec/urlgrabber-ext-down\", line 28 reference The Bash Shell Startup Files Advanced Bash-Scripting Guide download pdf from here or here Perform tab-completion for aliases in Bash character metacharacter Character Where Meaning csh, sh Execute command # csh, sh, ASCII files Start a comment csh, sh Argument separator ``` csh, sh Command substitution \" csh, sh Weak Quotes ' csh, sh Strong Quotes \\ csh, sh Single Character Quote variable sh, csh Variable variable csh, sh Same as variable \\ csh, sh Pipe character ^ sh Pipe Character & csh, sh Run program in background ? csh, sh Match one character * csh, sh Match any number of characters ; csh, sh Command separator ;; sh End of Case statement ~ csh Home Directory ~user csh User's Home Directory ! csh History of Commands - Programs Start of optional argument $# csh, sh Number of arguments to script $* csh, sh Arguments to script $@ sh Original arguments to script $- sh Flags passed to shell $? sh Status of previous command $$ sh Process identification number $! sh PID of last background job && sh Short-circuit AND ` ` sh Short-circuit OR . csh, sh Typ. filename extension . sh Source a file and execute as command : sh Nothing command : sh Separates Values in environment variables : csh Variable modifier Character Where Meaning [ ] csh, sh Match range of characters [ ] sh Test %job csh Identifies job Number (cmd;cmd) csh. sh Runs cmd;cmd as a sub-shell { } csh In-line expansions {cmd;cmd } sh Like (cmd;cmd ) without a subshell >ofile csh, sh Standard output >>ofile csh, sh Append to standard output csh, sh Standard Input csh, sh Read until word, substitute variables csh, sh Read until word, no substitution sh Read until word, ignoring TABS >>!file csh Append to file, ignore error if not there >!file csh Output to new file, ignore error if not there >&file csh Send standard & error output to file sh Switch Standard Input to file sh Close Standard Input >&digit sh Switch Standard Output to file >&- sh Close Standard Output digit1 sh Connect digit2 to digit1 digit sh Close file digit digit2>&digit1 sh Connect digit2 to digit1 digit>&- sh Close file digit Process Substitution Process substitution is a form of redirection where the input or output of a process (some sequence of commands) appear as a temporary file. reference: Chapter 23. Process Substitution Command list enclosed within parentheses>(command_list) Process substitution uses /dev/fd/ files to send the results of the process(es) within parentheses to another process. [1] $ while read branch; do git fetch --all --force; done $ echo >(true) /dev/fd/63 $ echo (true) named pipe similar $ wc get diff in two folders $ diff _book > book.json 3a5 > node_modules $ diff Tue Dec 15 22:48:32 CST 2020 example: run script without download $ bash via curl $ python or $ curl -so - https://raw.githubusercontent.com/giampaolo/psutil/master/scripts/meminfo.py | python via wget $ python or $ wget -qO - https://raw.githubusercontent.com/giampaolo/psutil/master/scripts/meminfo.py | python or $ python or $ python example: merge lines of file inspired by here and here $ cat a t1 t2 t3 t4 $ cat b 11 22 33 44 $ paste additional usage $ cat a | paste -d'\\t' - - - - a b c d e f or $ cat a | paste -d, - - a,b c,d e,f /dev/fd/63 is not a regular file $ more nstalling tools via running random scripts from unknown sites $ ( wget -O - pi.dk/3 || lynx -source pi.dk/3 || curl pi.dk/3/ || \\ fetch -o - http://pi.dk/3 ) > install.sh strace reference What's the difference between Basic Commands du top biggest directories under [path]$ du -a [path] | sort -n -r | head -n 5 display the largest files according to human-readable format$ du -hs * | sort -rh | head -5 display the largest folders/files including the sub-directories$ du -Sh | sort -rh | head -5 biggest file sizes $ find -type f -exec du -Sh {} + | sort -rh | head -n 5 or $ find [PATH] -type f -printf \"%s %p\\n\" | sort -rn | head -n 5 sort result via human-readable format $ sudo du -ahx --max-depth=1 | sort -k1 -rh or $ du -sk * | sort -g | awk '{ numBytes = $1 * 1024; numUnits = split(\"B K M G T P\", unit); num = numBytes; iUnit = 0; while(num >= 1024 && iUnit + 1 = 1024 && iUnit + 1 or #! /usr/bin/env bash ducks () { du -cks -x | sort -n | while read size fname; do for unit in k M G T P E Z Y; do if [ $size -lt 1024 ]; then echo -e \"${size}${unit}\\t${fname}\" break fi size=$((size/1024)) done done } ducks > .ducks && tail .ducks or $ du -k ./* | sort -nr | awk '{ split(\"KB,MB,GB\",size,\",\"); } { x = 1;while ($1 >= 1024) {$1 = $1 / 1024;x = x + 1} $1 = sprintf(\"%-4.2f%s\", $1, size[x]); print $0; }' sed reference 50 sed Command Examples others you have new mail remove$ mail ? delete * ? q CentOS Yum File \"/usr/libexec/urlgrabber-ext-down\", line 28 Error File \"/usr/libexec/urlgrabber-ext-down\", line 28 except OSError, e: ^ Solution $ sudo update-alternatives --remove python /usr/bin/python3 $ realpath /usr/bin/python /usr/bin/python2.7 OR $ sudo update-alternatives --config python There are 3 programs which provide 'python'. Selection Command ----------------------------------------------- *+ 1 /usr/bin/python3 2 /usr/bin/python2.7 3 /usr/bin/python2 Enter to keep the current selection[+], or type selection number: 3 Reason $ ls -l /usr/bin/python* lrwxrwxrwx 1 root root 24 Jul 10 02:29 /usr/bin/python -> /etc/alternatives/python lrwxrwxrwx 1 root root 9 Dec 6 2018 /usr/bin/python2 -> python2.7 -rwxr-xr-x 1 root root 7216 Oct 30 2018 /usr/bin/python2.7 lrwxrwxrwx 1 root root 9 Mar 7 2019 /usr/bin/python3 -> python3.4 -rwxr-xr-x 2 root root 11392 Feb 5 2019 /usr/bin/python3.4 -rwxr-xr-x 2 root root 11392 Feb 5 2019 /usr/bin/python3.4m $ ls -altrh /etc/alternatives/python lrwxrwxrwx 1 root root 16 Jul 10 02:29 /etc/alternatives/python -> /usr/bin/python3 reference Yum install error file \"/usr/bin/yum\", line 30 failed at yum update and how to fix it Upgraded Python, and now I can't run “yum upgrade” How to Find Out Top Directories and Files (Disk Space) in Linux Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:29 "},"linux/util/util.html":{"url":"linux/util/util.html","title":"util","keywords":"","body":" Table of Contents generated with DocToc Utils shell paramters pass self parameters to another script getopts with long option Network Get Interface by command get ipv4 address system command use parameter in xargs find out commands belongs to and come from Get all google website check linux window size readline & bind get info locales CentOS8 installation Utils shell paramters pass self parameters to another script objective: $ ./b.sh a b c d -> $ ./a.sh a b c d b.sh #!/bin/bash echo \"\"\" b.sh: \\$1: \"$1\" \\$#: \"$#\" \\$@: \"$@\" \\${@: -1}: ${@: -1} \\${@: -2}: ${@: -2} \\${@: -3}: ${@: -2} \\${@: -\\$(( \\$#-1 ))}: ${@: -$(( $#-1 ))} \\$(echo '\\${@: -\\$(( \\$#-1 ))}' | cut -d' ' -f1-) : $(echo \"${@: -$(( $#-1 ))}\" | cut -d' ' -f1-) \"\"\" echo -e \"\\n'~~> ./a.sh \\\"\\${@: -1}\\\"': ~~~> ./a.sh ${@: -1}:\" ./a.sh \"${@: -1}\" echo -e \"\\n'~~> ./a.sh \\$(echo '\\${@: -1}' | cut -d' ' -f1-)': ~~~> ./a.sh $(echo \"${@: -1}\" | cut -d' ' -f1-):\" ./a.sh $(echo \"${@: -1}\" | cut -d' ' -f1-) echo -e \"\\n'~~> ./a.sh \\\"\\${@: -4}\\\"': ~~~> ./a.sh ${@: -4}:\" ./a.sh \"${@: -4}\" echo -e \"\\n'~~> ./a.sh \\$(echo '\\${@: -\\$(( \\$#-1 ))}' | cut -d' ' -f1-)': ~~~> ./a.sh $(echo \"${@: -$(( $#-1 ))}\" | cut -d' ' -f1-)\" ./a.sh $(echo \"${@: -$(( $#-1 ))}\" | cut -d' ' -f1-) a.sh echo \"\"\" a.sh: \\$1: \"$1\" \\$#: \"$#\" \\$@: \"$@\" \\${@: -$(( $#-2 ))}: ${@: -$(( $#-2 ))} \"\"\" result $ ./b.sh a b c d e b.sh: $1: a $#: 5 $@: a b c d e ${@: -1}: e ${@: -2}: d e ${@: -3}: d e ${@: -$(( $#-1 ))}: b c d e $(echo '${@: -$(( $#-1 ))}' | cut -d' ' -f1-) : b c d e '~~> ./a.sh \"${@: -1}\"': ~~~> ./a.sh e: a.sh: $1: e $#: 1 $@: e ${@: --1}: e '~~> ./a.sh $(echo '${@: -1}' | cut -d' ' -f1-)': ~~~> ./a.sh e: a.sh: $1: e $#: 1 $@: e ${@: --1}: e '~~> ./a.sh \"${@: -4}\"': ~~~> ./a.sh b c d e: a.sh: $1: b $#: 4 $@: b c d e ${@: -2}: d e '~~> ./a.sh $(echo '${@: -$(( $#-1 ))}' | cut -d' ' -f1-)': ~~~> ./a.sh b c d e a.sh: $1: b $#: 4 $@: b c d e ${@: -2}: d e getopts with long option #!/bin/bash # shellcheck disable=SC1079,SC1078 usage=\"\"\"USAGE \\t$0\\t[-h|--help] [-c|--clean] [-t|--tag ] [-i|--image ] \\t\\t\\t[-v|--ver ] [-n|--name ] \\t\\t\\t[-p|--prop ] \"\"\" while test -n \"$1\"; do case \"$1\" in -c | --clean ) clean=true ; shift ;; -t | --tag ) tag=$2 ; shift 2 ;; -i | --image ) image=$2 ; shift 2 ;; -v | --ver ) ver=$2 ; shift 2 ;; -n | --name ) name=$2 ; shift 2 ;; -p | --prop ) prop=$2 ; shift 2 ;; -h | --help | * ) echo -e \"${usage}\"; exit 0 ;; esac done echo \"\"\" clean : ${clean} tag : ${tag} image : ${image} ver : ${ver} name : ${name} prop : ${prop} \"\"\" result $ ./longopts.sh -h USAGE ./longopts.sh [-h|--help] [-c|--clean] [-t|--tag ] [-i|--image ] [-v|--ver ] [-n|--name ] [-p|--prop ] $ ./longopts.sh -c clean : true tag : image : ver : name : prop : $ ./longopts.sh -c -t 'ttt' -i 'iii' --ver '1.1.1' --name 'name' clean : true tag : ttt image : iii ver : 1.1.1 name : name prop : Network Get Interface by command interface=$(netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}') # or get the route to github interface=$(ip route get $(nslookup github.com | grep Server | awk -F' ' '{print $NF}') | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') get ipv4 address ipAddr=$(ip a s \"${interface}\" | sed -rn 's|.*inet ([0-9\\.]{7,15})/[0-9]{2} brd.*$|\\1|p') system command use parameter in xargs $ find . -type f | xargs -n 1 -I FILE bash -c 'echo $(file --mime-type -b FILE)' text/plain text/plain text/plain inode/x-empty text/plain text/plain text/plain text/plain text/plain text/plain find out commands belongs to and come from belongs to $ type which which is aliased to `alias | which -a --tty-only --read-alias --show-dot --show-tilde' $ type bello bello is a function bello () { source \"${iRCHOME}/.imac\" } come from $ shopt -s extdebug $ declare -F _completion_loader _completion_loader 2219 /usr/local/Cellar/bash-completion@2/2.11/share/bash-completion/bash_completion $ declare -F _docker _docker 5463 /usr/local/etc/bash_completion.d/docker $ declare -F __git_ps1 __git_ps1 340 /usr/local/etc/bash_completion.d/git-prompt.sh $ declare -F bello bello 79 /Users/marslo/.marslo/.marslorc linux$ bash --debugger $ declare -F _docker _docker 5011 /usr/share/bash-completion/completions/docker Get all google website $ whois www.google.com Whois Server Version 2.0 Domain names in the .com and .net domains can now be registered with many different competing registrars. Go to http://www.internic.net for detailed information. Server Name: WWW.GOOGLE.COM.VN Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.TW Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.TR Registrar: TUCOWS DOMAINS INC. Whois Server: whois.tucows.com Referral URL: http://domainhelp.opensrs.net Server Name: WWW.GOOGLE.COM.SA Registrar: OMNIS NETWORK, LLC Whois Server: whois.omnis.com Referral URL: http://domains.omnis.com Server Name: WWW.GOOGLE.COM.PK Registrar: INTERNET.BS CORP. Whois Server: whois.internet.bs Referral URL: http://www.internet.bs Server Name: WWW.GOOGLE.COM.PE Registrar: HOSTOPIA.COM INC. D/B/A APLUS.NET Whois Server: whois.names4ever.com Referral URL: http://www.aplus.net Server Name: WWW.GOOGLE.COM.MX Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.HK Registrar: GKG.NET, INC. Whois Server: whois.gkg.net Referral URL: http://www.gkg.net Server Name: WWW.GOOGLE.COM.DO Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.CO Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.BR Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.AU Registrar: MELBOURNE IT, LTD. D/B/A INTERNET NAMES WORLDWIDE Whois Server: whois.melbourneit.com Referral URL: http://www.melbourneit.com Server Name: WWW.GOOGLE.COM.AR Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com >>> Last update of whois database: Mon, 24 Feb 2014 17:24:05 UTC check linux window size check$ shopt | grep checkwinsize checkwinsize on enable$ shopt -s checkwinsize readline & bind get info get current keymap $ bind -v | awk '/keymap/ {print $NF}' vi-insert tricky for switch keymap set keymap emacs \"\\ee\": vi-editing-mode set keymap vi-insert \"\\e\": vi-movement-mode set keymap vi-command \"\\ee\": emacs-editing-mode locales CentOS8 installation references: How to Fix “Failed to set locale, defaulting to C.UTF-8” in CentOS 8 How do I change my locale to UTF-8 in CentOS? $ sudo dnf install -y langpacks-en glibc-all-langpacks glibc-langpack-en glibc-langpack-zh $ sudo localectl set-locale LANG=en_US.UTF-8 # option $ sudo localedef -c -f UTF-8 -i en_US en_US.UTF-8 check $ locale LANG=en_US.UTF-8 LC_CTYPE=\"en_US.UTF-8\" LC_NUMERIC=\"en_US.UTF-8\" LC_TIME=\"en_US.UTF-8\" LC_COLLATE=\"en_US.UTF-8\" LC_MONETARY=\"en_US.UTF-8\" LC_MESSAGES=\"en_US.UTF-8\" LC_PAPER=\"en_US.UTF-8\" LC_NAME=\"en_US.UTF-8\" LC_ADDRESS=\"en_US.UTF-8\" LC_TELEPHONE=\"en_US.UTF-8\" LC_MEASUREMENT=\"en_US.UTF-8\" LC_IDENTIFICATION=\"en_US.UTF-8\" LC_ALL=en_US.UTF-8 $ localectl status System Locale: LANG=en_US.UTF-8 VC Keymap: us X11 Layout: us more options $ yum list available | grep glibc-langpack Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:30 "},"linux/util/date.html":{"url":"linux/util/date.html","title":"time & date","keywords":"","body":" Table of Contents generated with DocToc date epoch timestamps format IOS 8601 rfc-3339 utc timezone Common formats convert timestamps to epoch epoch to timestamps calculate time different transfer date format date epoch https://en.wikipedia.org/wiki/Unix_time: It is the number of seconds that have elapsed since the Unix epoch, minus leap seconds; the Unix epoch is 00:00:00 UTC on 1 January 1970 What is epoch time? $ date -u -d '1970-01-01 00:00:00' '+Normal: %F %T %:z%nUnix: %s' Normal: 1970-01-01 00:00:00 +00:00 Unix: 0 $ date -d '1970-01-01 00:00:00' '+Normal: %F %T %:z%nUnix: %s' Normal: 1970-01-01 00:00:00 +08:00 Unix: -28800 $ date -u -d '1970-01-01 00:00:00 UTC +1 day' '+Normal: %F %T %:z%nUnix: %s' Normal: 1970-01-02 00:00:00 +00:00 Unix: 86400 $ date '+%s%3N' 1602231334983 $ date '+%s' 1602231334 timestamps format yyyy-MM-dd'T'HH:mm:ss.SSSZ yyyy-MM-dd'T'HH:mm:ss Date Format Option Meaning Example Output date +%c locale’s date time Sat May 9 11:49:47 2020 date +%x locale’s date 05/09/20 date +%X locale’s time 11:49:47 date +%A locale’s full weekday name Saturday date +%B locale’s full month name May date +%m-%d-%Y MM-DD-YYYY date format 05-09-2020 date +%D MM/DD/YY date format 05/09/20 date +%F YYYY-MM-DD date format 2020-05-09 date +%T HH:MM:SS time format 11:44:15 date +%u Day of Week 6 date +%U Week of Year with Sunday as first day of week 18 date +%V ISO Week of Year with Monday as first day of week 19 date +%j Day of Year 130 date +%Z Timezone PDT date +%m Month of year (MM) 05 date +%d Day of Month (DD) 09 date +%Y Year (YY) 2020 date +%H Hour (HH) 11 date +%H Hour (HH) in 24-hour clock format 11 date +%I Hour in 12-hour clock format 11 date +%p locale’s equivalent of AM or PM AM date +%P same as %p but in lower case am classical date format $ secs=259200 $ date -u -d @${secs} +\"%F\" 1970-01-04 $ date -u -d @${secs} +\"%T\" 00:00:00 $ date -u -d @${secs} +\"%F %T\" 1970-01-04 00:00:00 $ date -u -d @${secs} -Is 1970-01-04T00:00:00+00:00 date format with timezone $ date -u +\"%Y-%m-%dT%H:%M:%SZ\" 2020-10-09T08:14:47Z $ date +%FT%T.%3N%:z 2020-10-09T17:27:18.491+08:00 $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" 2020-10-09T08:14:47.167Z $ date +%Y-%m-%d-T%H:%M:%S.%3N%z 2020-10-09-T17:27:18.491+0800 details $ date -u -d \"2019-01-19T05:00:00 - 2 hours\" +%Y-%m-%d_%H:%M:%S%Z --debug date: parsed datetime part: (Y-M-D) 2019-01-19 05:00:00 UTC-02 date: parsed relative part: +1 hour(s) date: input timezone: parsed date/time string (-02) date: using specified time as starting value: '05:00:00' date: starting date/time: '(Y-M-D) 2019-01-19 05:00:00 TZ=-02' date: '(Y-M-D) 2019-01-19 05:00:00 TZ=-02' = 1547881200 epoch-seconds date: after time adjustment (+1 hours, +0 minutes, +0 seconds, +0 ns), date: new time = 1547884800 epoch-seconds date: timezone: Universal Time date: final: 1547884800.000000000 (epoch-seconds) date: final: (Y-M-D) 2019-01-19 08:00:00 (UTC) date: final: (Y-M-D) 2019-01-19 08:00:00 (UTC+00) 2019-01-19_08:00:00UTC IOS 8601 dates example YYYY 2015 YYYY-MM 2015-12 YYYY-MM-DD 2015-12-11 YYYY-MM-DD'T'hh:mmTZD 2015-12-11T20:28+01:00 or 2015-12-11T19:28Z YYYY-MM-DD'T'hh:mm:ssTZD 2015-12-11T20:28:30+01:00 or 2015-12-11T19:28:30Z YYYY-MM-DD'T'hh:mm:ss.sTZD 2015-12-11T20:28:30.45+01:00 or 2015-12-11T19:28:30.45Z where: YYYY = four-digit year MM = two-digit month (01=January, etc.) DD = two-digit day of month (01 through 31) hh = two digits of hour (00 through 23) (am/pm NOT allowed) mm = two digits of minute (00 through 59) ss = two digits of second (00 through 59) s = one or more digits representing a decimal fraction of a second (i.e. milliseconds) TZD = time zone designator (Z or +hh:mm or -hh:mm) $ date -I 2020-10-09 $ date -Is && date -Isecond 2020-10-09T16:31:47+08:00 2020-10-09T16:31:47+08:00 $ date -Ih 2020-10-09T16+08:00 $ date -Im 2020-10-09T16:31+08:00 rfc-3339 $ date --rfc-3339=date 2020-10-09 $ date --rfc-3339=ns 2020-10-09 17:32:14.158684000+08:00 $ date --rfc-3339=seconds 2020-10-09 17:32:14+08:00 utc $ date Fri Oct 9 17:09:34 CST 2020 $ date -u Fri Oct 9 09:09:34 UTC 2020 timezone $ date '+%Z' CST $ date '+%z' +0800 $ date '+%:z' +08:00 $ date '+%::z' +08:00:00 $ date '+%:::z' +08 $ date '+%Z' CST Common formats Shell command: date Most common Bash date commands for timestamping Format/result Command Output YYYY-MM-DD date -I 2020-10-09 YYYY-MM-DD_hh:mm:ss date +%F_%T 2020-10-09_16:48:45 YYYYMMDD_hhmmss date +%Y%m%d_%H%M%S 20201009_164845 YYYYMMDD_hhmmss (UTC version) date --utc +%Y%m%d_%H%M%SZ 20201009_084845Z YYYYMMDD_hhmmss (with local TZ) date +%Y%m%d_%H%M%S%Z 20201009_164845CST YYYYMMSShhmmss date +%Y%m%d%H%M%S 20201009164845 YYYYMMSShhmmssnnnnnnnnn date +%Y%m%d%H%M%S%N 20201009164845495302000 YYMMDD_hhmmss date +%y%m%d_%H%M%S 201009_164845 Seconds since UNIX epoch: date +%s 1602233325 Nanoseconds only: date +%N 505337000 Nanoseconds since UNIX epoch: date +%s%N 1602233325508581000 Nanoseconds since UNIX epoch: date +%s%3N 1602233325508 ISO8601 UTC timestamp date --utc +%FT%TZ 2020-10-09T08:48:45Z ISO8601 UTC timestamp date --utc +%FT%T%Z 2020-10-09T08:48:45UTC ISO8601 UTC timestamp + ms date --utc +%FT%T.%3NZ 2020-10-09T08:48:45.517Z ISO8601 UTC timestamp + ms date --utc +%FT%T.%3N%Z 2020-10-09T08:48:45.520UTC ISO8601 Local TZ timestamp date +%FT%T%Z 2020-10-09T16:48:45CST YYYY-MM-DD (Short day) date +%F\\(%a\\) 2020-10-09(Fri) YYYY-MM-DD (Long day) date +%F\\(%A\\) 2020-10-09(Friday) convert $ date +\"%Y-%m-%dT%H:%M:%SZ\" 2020-10-09T17:16:37Z $ date -u +\"%Y-%m-%dT%H:%M:%SZ\" 2020-10-09T09:16:37Z $ date -d $(date -u +\"%Y-%m-%dT%H:%M:%SZ\") Fri Oct 9 17:16:37 CST 2020 Human-readable time Seconds 1 hour 3600 seconds 1 day 86400 seconds 1 week 604800 seconds 1 month (30.44 days) 2629743 seconds 1 year (365.24 days) 31556926 seconds timestamps to epoch $ echo $EPOCHSECONDS 1602235097 $ date -d $(date -u +\"%Y-%m-%dT%H:%M:%SZ\") +%s 1602235097 $ date --date=$(date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\") +%s%3N 1602235097801 epoch to timestamps $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" 2020-10-09T09:18:17.795Z $ date -d @1602235097 +%c Fri Oct 9 17:18:17 2020 $ date -d @1602235097 Fri Oct 9 17:18:17 CST 2020 $ date -d @1602235097 -u Fri Oct 9 09:18:17 UTC 2020 convert epoch with milliseconds Convert unix timestamp to hh:mm:ss:SSS (where SSS is milliseconds) d=$(date +%s%3N) s=${d%???} ms=${d#\"$s\"} date -d \"@$s\" +\"%F %T.$ms %z\" result 2020-10-09 18:28:34.534 +0800 d: 1602239314534 s: 1602239314 ms: 534 calculate time different $ date -d 'now + 3 weeks' Fri Oct 30 20:32:04 CST 2020 $ date -d 'now + 3 weeks' +%s 1604061130 $ date -d 'Jan 1 + 11 weeks' Wed Mar 18 00:00:00 CST 2020 $ date -d 'Jan 1 2021 + 11 weeks' Fri Mar 19 00:00:00 CST 2021 time described by STRING $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" -d '90 day ago' 2020-07-11T08:14:03.145Z $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" -d '3 months ago' 2020-07-09T08:14:47.164Z $ date -u -d \"2019-01-19T05:00:00Z - 2 hours\" +%Y-%m-%d_%H:%M:%S 2019-01-19_03:00:00 $ date -d \"$(date -Iseconds -d \"2018-12-10 00:00:00\") - 5 hours - 20 minutes - 5 seconds\" Sun Dec 9 18:39:55 CST 2018 $ date -d \"2018-12-10 00:00:00 5 hours ago 20 minutes ago 5 seconds ago\" Sun Dec 9 18:39:55 CST 2018 two times different $ seconds=$(date +%s) $ printf \"%d days %(%H hours %M minutes %S seconds)T\\n\" $((seconds/86400)) $seconds 18544 days 18 hours 35 minutes 48 seconds Simple one-liner $ secs=259200 $ printf '%dh:%dm:%ds\\n' $(($secs/3600)) $(($secs%3600/60)) $(($secs%60)) 72h:0m:0s with leading zero $ printf '%02dh:%02dm:%02ds\\n' $(($secs/3600)) $(($secs%3600/60)) $(($secs%60)) 72h:00m:00s with days $ printf '%dd:%dh:%dm:%ds\\n' $(($secs/86400)) $(($secs%86400/3600)) $(($secs%3600/60)) $(($secs%60)) 3d:0h:0m:0s with nanoseconds $ printf '%02dh:%02dm:%02fs\\n' $(echo -e \"$secs/3600\\n$secs%3600/60\\n$secs%60\"| bc | xargs echo) 72h:00m:0.000000s datediff (ddiff) $ datediff -f \"%d days, %H hours, %M mins, %S secs\" \"$(date +'%Y-%m-%d %H:%M:%S')\" \"$(date +'%Y-%m-%d %H:%M:%S' -d '3 days ago')\" -3 days, 0 hours, 0 mins, 0 secs or with specific format $ ddiff -i '%Y%m%d%H%M%S' 20190817040001 20200312000101 17956860s $ ddiff -f \"%d days, %H hours, %M mins, %S secs\" -i '%Y%m%d%H%M%S' 20190817040001 20200312000101 207 days, 20 hours, 1 mins, 0 secs calculate with epoch $ awk -v t=$(( $(date -d $(date +\"%Y-%m-%dT%H:%M:%SZ\") +%s) - $(date -d $(date +\"%Y-%m-%dT%H:%M:%SZ\" -d '3 days ago') +%s) )) 'BEGIN{ printf \"%d:%02d:%06.3f\\n\", t/3600, (t/60)%60, t%60}' 72:00:00.000 transfer date format $ date +'%Y%m%d%H%M%S' 20201009184852 $ d1=$(date +'%Y%m%d%H%M%S') $ date --date \"$(echo $d1 | sed -nr 's/(....)(..)(..)(..)(..)(..)/\\1-\\2-\\3 \\4:\\5:\\6/p')\" Fri Oct 9 18:48:52 CST 2020 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:29 "},"linux/util/files&chars.html":{"url":"linux/util/files&chars.html","title":"files & chars","keywords":"","body":" Table of Contents generated with DocToc .join() alike in shell find out the file is ending by crlf or lf Show all line numbers in a file Insert into the first line backup and restore filer & folder permission Encrypt bash file Get the count of a word in a file Print 50th char Get the common part Revert a word Format a file to a table Show last n lines in a file Print a file into one line inode find and replace Shell Parameter Expansion find and copy .join() alike in shell paste $ seq 1 100 | paste -sd ':' - 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53:54:55:56:57:58:59:60:61:62:63:64:65:66:67:68:69:70:71:72:73:74:75:76:77:78:79:80:81:82:83:84:85:86:87:88:89:90:91:92:93:94:95:96:97:98:99:100 # others $ seq 1 100 | paste -sd \"\\0\" 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100 sed $ seq 1 100 | sed ':a; N; $!ba; s/\\n/:/g' 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53:54:55:56:57:58:59:60:61:62:63:64:65:66:67:68:69:70:71:72:73:74:75:76:77:78:79:80:81:82:83:84:85:86:87:88:89:90:91:92:93:94:95:96:97:98:99:100 awk (ORS) $ seq 1 100 | awk 'ORS=\",\"' 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100, ls -m $ ls -m Applications, Desktop, Documents, Downloads, Library, Movies, Music, Pictures, Public, find out the file is ending by crlf or lf cat -e $ cat -e # e.g. $ cat -e windows.txt test^M$ windows^M$ format $ cat -e linux.txt test$ windows$ format file $ file windows.txt windows.txt: ASCII text, with CRLF line terminators $ file windows.txt windows.txt: ASCII text Show all line numbers in a file cat $ sudo cat /etc/passwd | wc -l 36 awk $ awk 'END {print NR}' /etc/passwd 36 Insert into the first line $ cat demo.file abc efg $ echo \"first line\" | cat - demo.file first line abc efg backup and restore filer & folder permission backup $ find . -printf '%m\\t%u\\t%g\\t%p\\0' > file.perm restore while read -rd $'\\0' perms user group file; do if [ -e \"$file\" ]; then chown \"$user:$group\" \"$file\" chmod \"$perms\" \"$file\" else echo \"warning: $file not found\" fi done check perm find & printf $ find $PWD -printf '%m\\t%u\\t%g\\t%p\\n' | head 755 marslo staff /Users/marslo 755 marslo staff /Users/marslo/.eclipse 755 marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo 644 marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo/defaults.properties 644 marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo/infos.txt $ find $PWD -printf '%M %u %g %p\\n' | head drwxr-xr-x marslo staff /Users/marslo drwxr-xr-x marslo staff /Users/marslo/.eclipse drwxr-xr-x marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo -rw-r--r-- marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo/defaults.properties stat $ stat -c '%A %a %n' * drwx------ 700 Applications drwx------ 700 Desktop drwx------ 700 Documents drwx------ 700 Downloads drwx------ 700 Library drwx------ 700 Movies drwx------ 700 Music drwx------ 700 Pictures drwxr-xr-x 755 Public drwxr-xr-x 755 mywork drwxr-xr-x 755 test namei $ namei -l $PWD /Users/marslo / = drwxr-xr-x l=22 u=root/0 g=admin/80 s=704 m=07-16-2020@13:40:21 Users = drwxr-xr-x l=6 u=root/0 g=admin/80 s=192 m=09-30-2019@04:22:36 marslo = drwxr-xr-x l=72 u=marslo/501 g=staff/20 s=2304 m=07-16-2020@17:37:27 Encrypt bash file $ echo \"ls\" > script.bash; gpg -c script.bash; cat script.bash.gpg | gpg -d --no-mdc-warning | bash Get the count of a word in a file $ cat /etc/passwd | grep marslo -o | wc -l 3 # or $ find . -name file.txt | xargs -e grep \"token\" -o | wc -l Print 50th char $ awk 'BEGIN{while (a++ Get the common part $ cat a.txt 1 2 3 $ cat b.txt 3 4 5 9 $ comm -12 a.txt b.txt > common $ cat common 3 Revert a word $ echo linux | rev xunil Format a file to a table $ cat a_b 1:1 2:2 3:3 $ column -tns: a_b 1 1 2 2 3 3 Show last n lines in a file $ tail /etc/passwd -n 3 saned:x:115:123::/home/saned:/bin/false marslo:x:1000:1000:Marslo,,,:/home/marslo:/bin/bash mysql:x:1001:1001::/home/mysql:/bin/sh $ tail /etc/passwd -n 2 marslo:x:1000:1000:Marslo,,,:/home/marslo:/bin/bash mysql:x:1001:1001::/home/mysql:/bin/sh Print a file into one line $ cat a 1 2 3 4 5 $ echo $(cat a) 1 2 3 4 5 $ cat a | xargs 1 2 3 4 5 inode get inode of a file $ l -i a_b 10224132 -rw-r--r-- 1 marslo marslo 10 Feb 21 00:43 a_b get inodes in a folder stat $ stat -c '%i' ~ 686476 equivalent to $ ls -id ~ 686476 /Users/marslo example$ ls -id /local_storage/docker 2818591238 /local_storage/docker ls() $ ls /local_storage/docker -AiR1U | sed -rn '/^[./]/{h;n;};G; s|^ *([0-9][0-9]*)[^0-9][^/]*([~./].*):|\\1:\\2|p' | sort -t : -uk1.1,1n | cut -d: -f2 | sort -V | uniq -c | sort -rn | head -n10 46 /Users/marslo/test/keepalived-2.0.18/lib 29 /Users/marslo/test 28 /Users/marslo/test/keepalived-2.0.18/doc/samples 27 /Users/marslo/test/jenkins/vars 23 /Users/marslo/test/keepalived-2.0.18 22 /Users/marslo/test/keepalived-2.0.18/doc/source 17 /Users/marslo/test/jenkins/jenkinsfile 16 /Users/marslo/test/autosquash/.git/objects 14 /Users/marslo/test/keepalived-2.0.18/keepalived/vrrp 14 /Users/marslo/test/jenkins/configs/etc/yum.repos.d df $ df -i Filesystem Type Inodes IUsed IFree IUse% Mounted on /dev/disk1s5s1 apfs 2.3G 555K 2.3G 1% / /dev/disk1s4 apfs 2.3G 2 2.3G 1% /System/Volumes/VM /dev/disk1s2 apfs 2.3G 1.2K 2.3G 1% /System/Volumes/Preboot /dev/disk1s6 apfs 2.3G 16 2.3G 1% /System/Volumes/Update /Library/Input Methods/SogouInput.app nullfs 2.3G 1.8M 2.3G 1% /private/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/AppTranslocation/1E49F6C4-251F-443B-8D8A-86DA8F531F09 du$ sudo du --inodes -S ~ \\ | sort -rh \\ | sed -n '1,50{/^.\\{71\\}/s/^\\(.\\{30\\}\\).*\\(.\\{37\\}\\)$/\\1...\\2/;p}' \\ | head -10 14994 /Users/marslo/Library/Co...icrosoft User Data/OneNote/15.0/cache 13453 /Users/marslo/Library/Gr...s/Main Profile/Files/S0/1/Attachments 4667 /Users/marslo/Library/Caches/Google/Chrome Canary/Default/Cache 4086 /Users/marslo/Library/Gro...ofiles/Marvell/Files/S0/1/Attachments 3912 /Users/marslo/Library/Con...476b0cb6d7b78ea9f492c743c1bdfa/Avatar 3359 /Users/marslo/Library/Con...6d7b78ea9f492c743c1bdfa/Stickers/File 3174 /Users/marslo/Library/App...versions/3.8.6/openssl/share/man/man3 3174 /Users/marslo/Library/App...6/openssl/share/doc/openssl/html/man3 3174 /Users/marslo/Library/App...versions/3.7.9/openssl/share/man/man3 3174 /Users/marslo/Library/App...9/openssl/share/doc/openssl/html/man3 check inode status $ sudo tune2fs -l /dev/sdb1 | grep inode Filesystem features: has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize Free inodes: 234152632 First inode: 11 Journal inode: 8 First orphan inode: 44171696 Journal backup: inode blocks extend inode reference: Modifying the inode count for an ext2/ext3/ext4 file system RHEL: Extending the maximum inode count on a ext2/ext3/ext4 filesystem find and replace $ find . -type f -name '*.md' -exec sed -i 's///g' {} + Shell Parameter Expansion $ x='aabbcc' $ echo ${x#a*b} bcc $ echo ${x#a} abbcc $ echo ${x##a} abbcc $ echo ${x%b*c} aab $ echo ${x%%b*c} aa $ echo ${x%c} aabbc $ echo ${x%%c} aabbc shell parameter expansion for string replace for bash only usage: ${parameter/pattern/string} replace the first occurrence of a pattern with a given string ${parameter//pattern/string} replace all occurrences reference: the Bash Reference Manual, §3.5.3 \"Shell Parameter Expansion\" not supported in all Unix Shells: the Shell & Utilities volume, §2.6.2 \"Parameter Expansion\" $ message='The secret code is 12345' # first occurrence replacement $ echo \"${message/[0-9]/X}\" The secret code is X2345 # all occurrences replacement $ echo \"${message//[0-9]/X}\" The secret code is XXXXX find and copy source=\"/Users/marslo/test/logs\" target=\"/Users/marslo/test/logs/targetet\" while IFS= read -r -d '' logFile; do cp \"${logFile}\" \"${target}\" done Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:29 "},"linux/util/colors.html":{"url":"linux/util/colors.html","title":"colors & prompt","keywords":"","body":" Table of Contents generated with DocToc scripts bash prompt reference: Bash tips: Colors and formatting (ANSI/VT100 Control sequences) Bash Colors color grid What color codes can I use in my PS1 prompt? Colours and Cursor Movement With tput scripts bash 256 colors function 256color() { for i in {0..255}; do echo -e \"\\e[38;05;${i}m█${i}\"; done | column -c 180 -s ' '; echo -e \"\\e[m\" } #!/bin/bash # This program is free software. It comes without any warranty, to # the extent permitted by applicable law. You can redistribute it # and/or modify it under the terms of the Do What The Fuck You Want # To Public License, Version 2, as published by Sam Hocevar. See # http://sam.zoy.org/wtfpl/COPYING for more details. for fgbg in 38 48 ; do # Foreground / Background for color in {0..255} ; do # Colors # Display the color printf \"\\e[${fgbg};5;%sm %3s \\e[0m\" $color $color # Display 6 colors per lines if [ $((($color + 1) % 6)) == 4 ] ; then echo # New line fi done echo # New line done exit 0 colors and formatting #!/bin/bash # This program is free software. It comes without any warranty, to # the extent permitted by applicable law. You can redistribute it # and/or modify it under the terms of the Do What The Fuck You Want # To Public License, Version 2, as published by Sam Hocevar. See # http://sam.zoy.org/wtfpl/COPYING for more details. #Background for clbg in {40..47} {100..107} 49 ; do #Foreground for clfg in {30..37} {90..97} 39 ; do #Formatting for attr in 0 1 2 4 5 7 ; do #Print the result echo -en \"\\e[${attr};${clbg};${clfg}m ^[${attr};${clbg};${clfg}m \\e[0m\" done echo #Newline done done exit 0 for attr in 0 1 2 3 4 5 6 7; do echo \"------------------------------------------------\" printf \"ESC[%s;Foreground;Background - \\n\" $attr for fore in 30 31 32 33 34 35 36 37; do for back in 40 41 42 43 44 45 46 47; do printf '\\033[%s;%s;%sm %02s;%02s\\033[0m' $attr $fore $back $fore $back done printf '\\n' done printf '\\033[0m' done solarized color #!/bin/bash # solarized ansicolors (exporting for grins) export base03='\\033[0;30;40m' export base02='\\033[1;30;40m' export base01='\\033[0;32;40m' export base00='\\033[0;33;40m' export base0='\\033[0;34;40m' export base1='\\033[0;36;40m' export base2='\\033[0;37;40m' export base3='\\033[1;37;40m' export yellow='\\033[1;33;40m' export orange='\\033[0;31;40m' export red='\\033[1;31;40m' export magenta='\\033[1;35;40m' export violet='\\033[0;35;40m' export blue='\\033[1;34;40m' export cyan='\\033[1;36;40m' export green='\\033[1;32;40m' export reset='\\033[0m' colors () { echo -e \"base03 ${base03}Test$reset\" echo -e \"base02 ${base02}Test$reset\" echo -e \"base01 ${base01}Test$reset\" echo -e \"base00 ${base00}Test$reset\" echo -e \"base0 ${base0}Test$reset\" echo -e \"base1 ${base1}Test$reset\" echo -e \"base2 ${base2}Test$reset\" echo -e \"base3 ${base3}Test$reset\" echo -e \"yellow ${yellow}Test$reset\" echo -e \"orange ${orange}Test$reset\" echo -e \"red ${red}Test$reset\" echo -e \"magenta ${magenta}Test$reset\" echo -e \"violet ${violet}Test$reset\" echo -e \"blue ${blue}Test$reset\" echo -e \"cyan ${cyan}Test$reset\" echo -e \"green ${green}Test$reset\" } colors prompt reference: Bash/Prompt customization Colors using tput PS1=\"\\[$(tput setaf 0)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 1)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 2)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 3)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 4)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 5)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 6)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 7)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 8)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 9)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 10)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 11)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 12)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 13)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 14)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 15)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 16)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 17)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 18)\\]my prompt\\[$(tput sgr0)\\]> \" or $ DEFAULT=\"\\[$(tput setaf 3)\\]\" # or '\\[\\033[1;38;5;3m\\]' or '\\[\\e[1;33m\\]' $ ifDEFAULT='\\[\\e[1\\;33m\\]' # or '\\[\\033[1\\;38\\;5\\;3m\\]' $ ifRED='\\[\\e[1\\;31m\\]' # or '\\[\\033[1\\;38\\;5\\;1m\\]' $ PS1=\"${DEFAULT}my prompt${RESET} \\$( if [ \\$? != 0 ]; then echo -e ${ifRED}\\\\$; else echo -e ${ifDEFAULT}\\\\$; fi) ${RESET}\" right prompt rightprompt() { printf \"%*s\" $COLUMNS \"right prompt\" } PS1='\\[$(tput sc; rightprompt; tput rc)\\]left prompt > ' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:29 "},"linux/util/tricky.html":{"url":"linux/util/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc process bar with dot . with ▉ ▎ ▌ ▊ with [###----] with |\\|/ save & restore screen tput echo Terminfo escape sequences others clear screen show TERM show terminal width customized colorful output process bar reference: How to add a progress bar to a shell script? with dot . reference: colorful output : c() c() can be also found in .marslorc while true; do (( i++ == 0 )) && printf $(c sY)%-6s$(c) 'waiting ...' || printf $(c sY)%s$(c) '.' sleep 1 done with ▉ ▎ ▌ ▊ another: A progress bar for the shell # Main function designed for quickly copying to another program progressBar() { Bar=\"\" # Progress Bar / Volume level Len=25 # Length of Progress Bar / Volume level Div=4 # Divisor into Volume for # of blocks Fill=\"▒\" # Fill up to $Len Arr=( \"▉\" \"▎\" \"▌\" \"▊\" ) # UTF-8 left blocks: 7/8, 1/4, 1/2, 3/4 FullBlock=$((${1} / Div)) # Number of full blocks PartBlock=$((${1} % Div)) # Size of partial block (array index) while [[ $FullBlock -gt 0 ]]; do Bar=\"$Bar${Arr[0]}\" # Add 1 full block into Progress Bar (( FullBlock-- )) # Decrement full blocks counter done # If remainder zero no partial block, else append character from array if [[ $PartBlock -gt 0 ]]; then Bar=\"$Bar${Arr[$PartBlock]}\"; fi # Pad Progress Bar with fill character while [[ \"${#Bar}\" -lt \"$Len\" ]]; do Bar=\"$Bar$Fill\"; done echo progress : \"$1 $Bar\" exit 0 # Remove this line when copying into program } # progressBar Main () { tput civis # Turn off cursor for ((i=0; i with [###----] another solution: fearside/ProgressBar BAR='##############################' FILL='------------------------------' totalLines=100 barLen=30 count=0 while [ ${count} -lt ${totalLines} ]; do # update progress bar count=$(( ${count}+ 1 )) percent=$(( (${count} * 100 / ${totalLines} * 100)/ 100 )) i=$(( ${percent} * ${barLen} / 100 )) echo -ne \"\\r[${BAR:0:$i}${FILL:$i:barLen}] ${count}/${totalLines} (${percent}%)\" sleep .1 done with |\\|/ while :; do for s in / - \\\\ \\| do printf \"\\r$s\" sleep .1 done done save & restore screen reference Terminal codes (ANSI/VT100) introduction tput clear$ tput smcup restore$ tput rmcup echo save$ echo -e '\\033[?47h' restore$ echo -e '\\033[?47l' Terminfo escape sequences $ infocmp ... colors#256, cols#80, it#8, lines#24, pairs#32767, bel=^G, blink=\\E[5m, bold=\\E[1m, cbt=\\E[Z, civis=\\E[?25l, clear=\\E[H\\E[2J, cnorm=\\E[?12l\\E[?25h, cr=^M, ... others clear screen $ tput home show TERM $ tput color show terminal width $ tput cols customized colorful output $ export GREP_COLORS=\"sl=0;33;49:ms=1;34;49\" $ find /etc/ -type f | head | grep --color=always '^\\|[^/]*$' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:29 "},"linux/disk.html":{"url":"linux/disk.html","title":"disk","keywords":"","body":" Table of Contents generated with DocToc nfs mount a nfs check mount disconnect the mount setup nfs mount by default server boot related configure LVM example check status ios mount ios performance iostat sar nfs # example nfs server: 1.2.3.4 sub-folder: /a/b mount to local: /mnt/mynfs mount a nfs $ sudo mkdir -p /mnt/mynfs $ sudo mount -t nfs 1.2.3.4:/a/b /mnt/mynfs # or force using nfsversion 4 $ sudo mount -t nfs -o nfsvers=4 1.2.3.4:/a/b /mnt/mynfs -vvv test if sub-folder exists in remote nfs server $ showmount -e 1.2.3.4 | grep '/a/b' environment setup # centos $ yum install nfs-utils nfs-utils-lib $ yum install portmap (not required with NFSv4) # for nfs4 # ubuntu $ apt-get install nfs-utils nfs-utils-lib check mount $ cat /etc/mtab | grep /folder_name /dev/sdb1 /folder_name ext4 rw,seclabel,relatime,stripe=64 0 0 Check if folder is a mounted remote filesystem $ df -P -T /folder_name Filesystem Type 1024-blocks Used Available Capacity Mounted on /dev/sdb1 ext4 744******* 658***** 699******* 1% /folder_name df $ df /local_storage Filesystem 1K-blocks Used Available Use% Mounted on /dev/sdb1 744******* 658***** 699******* 1% /folder_name /etc/fstab $ cat /etc/fstab findmnt $ findmnt --fstab /local_storage TARGET SOURCE FSTYPE OPTIONS /local_storage /dev/sdb1 ext4 defaults check nfs mount $ df -h -F nfs [ | column -t ] $ mount | column -t | grep -E 'type.*nfs $ findmnt /mnt/mynfs check mount version nfsstat -c will show you the NFS version actually being used nfsstat -m will show statistics on mounted NFS filesystems grep nfs /proc/mounts equals nfsstat -m $ rpcinfo -p localhost program vers proto port service 100000 4 tcp 111 portmapper 100000 3 tcp 111 portmapper 100000 2 tcp 111 portmapper 100000 4 udp 111 portmapper 100000 3 udp 111 portmapper 100000 2 udp 111 portmapper 100024 1 udp 38978 status 100024 1 tcp 36415 status 100021 1 udp 51669 nlockmgr 100021 3 udp 51669 nlockmgr 100021 4 udp 51669 nlockmgr 100021 1 tcp 42699 nlockmgr 100021 3 tcp 42699 nlockmgr 100021 4 tcp 42699 nlockmgr disconnect the mount $ sudo umount /mnt/mynfs setup nfs mount by default server boot $ sudo bash -c \"cat > /etc/fstab\" related configure /etc/fstab /etc/nsswitch.conf /etc/nfsmount.conf /etc/nfs.conf /proc/mounts LVM reference: CONFIGURING AND MANAGING LOGICAL VOLUMES CHAPTER 5. MODIFYING THE SIZE OF A LOGICAL VOLUME example extends the logical volume /dev/myvg/homevol to 12 gigabytes$ sudo lvextend -L12G /dev/myvg/homevol lvextend -- extending logical volume \"/dev/myvg/homevol\" to 12 GB lvextend -- doing automatic backup of volume group \"myvg\" lvextend -- logical volume \"/dev/myvg/homevol\" successfully extended adds another gigabyte to the logical volume /dev/myvg/homevol$ sudo lvextend -L+1G /dev/myvg/homevol lvextend -- extending logical volume \"/dev/myvg/homevol\" to 13 GB lvextend -- doing automatic backup of volume group \"myvg\" lvextend -- logical volume \"/dev/myvg/homevol\" successfully extended check status lsblk pvs lvs vgs pvscan lvscan pvdisplay vgdisplay lvdisplay fdisk -l sfdisk -l -uM lshw -class disk hwinfo --block --short ios mount ios $ [[ -z $(findmnt /mnt/tmp) ]] || umount -f /mnt/tmp $ mkdir /mnt/tmp $ mount -t iso9660 -o loop /vol/builds/os/linux/RHEL-6.6-20140926.0-Server-x86_64-dvd1.iso /mnt/tmp/ performance iostat $ iostat -x -d 1 Linux 3.10.0-957.27.2.el7.x86_64 (dc5-ssdfwtst3) 01/15/2021 _x86_64_ (4 CPU) Device: rrqm/s wrqm/s r/s w/s rkB/s wkB/s avgrq-sz avgqu-sz await r_await w_await svctm %util sda 0.00 0.09 0.07 13.91 6.83 81.26 12.61 0.01 0.93 11.40 0.88 0.38 0.53 dm-0 0.00 0.00 0.07 14.00 6.83 81.26 12.53 0.01 0.95 11.60 0.90 0.38 0.53 dm-1 0.00 0.00 0.00 0.00 0.00 0.00 52.91 0.00 0.64 0.64 0.00 0.48 0.00 sar $ sar -bdp 1 Linux 3.10.0-957.27.2.el7.x86_64 (dc5-ssdfwtst3) 01/15/2021 _x86_64_ (4 CPU) 05:44:20 AM tps rtps wtps bread/s bwrtn/s 05:44:21 AM 863.00 863.00 0.00 47048.00 0.00 05:44:20 AM DEV tps rd_sec/s wr_sec/s avgrq-sz avgqu-sz await svctm %util 05:44:21 AM sda 863.00 47048.00 0.00 54.52 2.86 3.33 0.16 14.20 05:44:21 AM centos-root 863.00 47048.00 0.00 54.52 2.88 3.33 0.16 14.20 05:44:21 AM centos-swap 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:30 "},"linux/network.html":{"url":"linux/network.html","title":"network","keywords":"","body":" Table of Contents generated with DocToc get into get IP address by hostname get active interface get active IP address get active Mac address check remote server dns nmap Host Discovery scan 80 or 22 in particular setment OS detection with verbosity find printer list hostname with mac address get all server up ip address route get into get IP address by hostname ping & sed $ ping -q -c 1 -t 1 github.com | sed -n -re 's:^PING.*\\(([0-9\\.]{7,15})\\).*$:\\1:p' dig $ dig +short github.com # or $ dig github.com | awk '/^;; ANSWER SECTION:$/ { getline ; print $5 }' nslookup $ nslookup github.com | awk '/Name:/{getline; print $2;}' get active interface interface=$(netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}') # or get the route to github interface=$(ip route get $(nslookup github.com | grep Server | awk -F' ' '{print $NF}') | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') get active IP address $ githubIP=$(dig +short github.com | head -1) $ interface=$(ip route get ${githubIP} | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') $ ipaddr=$(ip a s ${interface} | sed -rn 's|\\W*inet[^6]([0-9\\.]{7,15}).*$|\\1|p') get active Mac address $ githubIP=$(dig +short github.com | head -1) $ interface=$(ip route get ${githubIP} | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') $ macaddr=$(ip link show ${interface} | sed -rn 's|.*ether ([0-9a-fA-F:]{17}).*$|\\1|p' | sed 's|:||g' | tr [a-z] [A-Z]) dig $ dig +noall +answer check remote server dns $ for _i in {1..10}; do echo -e \"\\n\\n ~~~> myserver_${i}\" ssh -q marslo@myserver_${_i} \"cat /etc/resolv.conf | sed -nre 's:^nameserver\\s([0-9.]+):\\1:p' | xargs -L1 /usr/bin/ping -c 1\" done nmap reference: SOLUTION: Scan a Large Network for a Certain Open TCP Port Nmap Network Scanning Host Discovery parameter comments -iL Input from list of hosts/networks -iR Choose random targets -sL List Scan - simply list targets to scan -sP Ping Scan - go no further than determining if host is online -P0 Treat all hosts as online -- skip host discovery -PS/PA/PU [portlist] TCP SYN/ACK or UDP discovery probes to given ports -PE/PP/PM ICMP echo, timestamp, and netmask request discovery probes -n/-R Never do DNS resolution/Always resolve [default ⎮ sometimes resolve] -sS/sT/sA/sW/sM TCP SYN/Connect()/ACK/Window/Maimon scans -sN/sF/sX TCP Null, FIN, and Xmas scans -sO IP protocol scan -sI Idlescan -O Enable OS detection scan 80 or 22 in particular setment $ nmap -sT -p 80 -oG - 10 - 1.2.3.* [| grep open] $ nmap -sT -p 22 -oG - 10 - 1.2.3.* [| grep open] OS detection with verbosity $ sudo nmap -O -v 192.168.1.0/23 Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 15:51 CST Initiating ARP Ping Scan at 15:51 Scanning 511 hosts [1 port/host] Completed ARP Ping Scan at 15:51, 2.02s elapsed (511 total hosts) Initiating Parallel DNS resolution of 118 hosts. at 15:51 Completed Parallel DNS resolution of 118 hosts. at 15:51, 0.18s elapsed Nmap scan report for 192.168.1.0 [host down] Nmap scan report for 192.168.1.2 [host down] ... Nmap scan report for 192.168.1.1 Host is up (0.0016s latency). Not shown: 998 closed ports PORT STATE SERVICE 22/tcp open ssh 23/tcp open telnet MAC Address: C0:**:**:**:**:C8 (Cisco Systems) OS details: Cisco 2950, 2960, 3550, 3560, 3750, or 4500 switch or 6500 router (IOS 12.1 - 15.0); or Adaptive Security Appliance firewall Network Distance: 1 hop TCP Sequence Prediction: Difficulty=264 (Good luck!) IP ID Sequence Generation: Randomized ... find printer $ sudo nmap -p 9100,515,631 192.168.1.0/23 [-oX printers.xml] ... Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 16:09 CST Nmap scan report for 192.168.1.191 Host is up (0.0029s latency). PORT STATE SERVICE 515/tcp closed printer 631/tcp closed ipp 9100/tcp open jetdirect MAC Address: 08:00:27:96:17:9E (Oracle VirtualBox virtual NIC) Nmap done: 1 IP address (1 host up) scanned in 0.29 second ... or$ sudo nmap [-sT] -p 9100,515,631 -oG - 192.168.1.0/23 # Nmap 7.91 scan initiated Wed Feb 3 16:44:20 2021 as: nmap -p 9100,515,631 -oG - 192.168.1.0/23 Host: 192.168.1.1 () Status: Up Host: 192.168.1.1 () Ports: 515/closed/tcp//printer///, 631/closed/tcp//ipp///, 9100/closed/tcp//jetdirect/// Host: 192.168.1.13 () Status: Up Host: 192.168.1.13 () Ports: 515/open/tcp//printer///, 631/open/tcp//ipp///, 9100/open/tcp//jetdirect/// Host: 192.168.1.1 () Status: Up Host: 192.168.1.1 () Ports: 515/closed/tcp//printer///, 631/closed/tcp//ipp///, 9100/closed/tcp//jetdirect/// Host: 192.168.1.254 () Status: Up Host: 192.168.1.254 () Ports: 515/filtered/tcp//printer///, 631/filtered/tcp//ipp///, 9100/filtered/tcp//jetdirect/// # Nmap done at Wed Feb 3 16:44:28 2021 -- 512 IP addresses (4 hosts up) scanned in 8.37 seconds list hostname with mac address $ sudo nmap -sP 172.31.201.0/24 | awk '/Nmap scan report for/{printf $5;}/MAC Address:/{print \" => \"$3;}' | sort 192.168.1.1 => C0:**:**:**:**:C8 192.168.1.108 => 08:**:**:**:**:6B 192.168.1.109 => 08:**:**:**:**:96 ... get hostname, macaddress, OS$ sudo nmap -sn 192.168.1.0/23 | awk '/Nmap scan report for/{printf $5;}/MAC Address:/{print \" => \"substr($0, index($0,$3)) }' | sort 192.168.1.1 => C0:**:**:**:**:C8 (Cisco Systems) 192.168.1.108 => 08:**:**:**:**:6B (Oracle VirtualBox virtual NIC) 192.168.1.109 => 08:**:**:**:**:96 (Oracle VirtualBox virtual NIC) ... get all server up ip address $ sudo nmap -v -sn -n 192.168.1.0/24 -oG - | awk '/Status: Up/{print $2}' get down$ sudo nmap -v -sn -n 192.168.1.0/24 -oG - | awk '/Status: Down/{print $2}' route Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:29 "},"linux/system.html":{"url":"linux/system.html","title":"system","keywords":"","body":" Table of Contents generated with DocToc system info hardware cpu memory network environment variables set system info clear duplicated PATH set dns for ubuntu disable firewall change net.bridge off swap disable selinux confined and unconfined users process find the zombie process about whatis user management sssd to use LDAP local user local group logout others system encoding setup via environment setup via locale command applications Q&A yum issue after python upgrade to 3.x system info hardware $ sudo dmidecode -s system information $ sudo dmidecode | grep -A3 '^System Information' System Information Manufacturer: HPE Product Name: ProLiant DL380 Gen10 Version: Not Specified # or $ inxi -M Machine: Type: Server Mobo: HPE model: ProLiant DL380 Gen10 serial: UEFI: HPE v: U30 date: 06/15/2018 # or $ sudo inxi --dmidecode -Mxxx Machine: Type: Rack Mount Chassis Mobo: HPE model: ProLiant DL380 Gen10 serial: PFARA%%LMAZ6XB BIOS: HPE v: U30 rev: 1.40 date: 06/15/2018 rom size: 16384 kB manufacturer $ sudo dmidecode -s system-manufacturer HPE # or $ sudo dmidecode -s baseboard-manufacturer HPE # or $ cat /sys/devices/virtual/dmi/id/sys_vendor HPE product name and version product name only $ sudo dmidecode -s system-product-name ProLiant DL380 Gen10 # or $ sudo dmidecode -s baseboard-product-name ProLiant DL380 Gen10 # or $ cat /sys/devices/virtual/dmi/id/product_name ProLiant DL380 Gen10 # or $ sudo dmidecode | grep -i prod Product Name: Vostro 5560 Product Name: 04YDT0 uuid $ sudo dmidecode | grep -i uuid | awk '{print $2}' | tr '[:upper:]' '[:lower:]' cpu cpu cores $ cat /proc/cpuinfo | egrep \"core id|physical id\" | tr -d \"\\n\" | sed s/physical/\\\\nphysical/g | grep -v ^$ | sort | uniq | wc -l 36 check CPU support 64 bit or not $ sudo dmidecode --type=processor | grep -i -A 1 charac Characteristics: 64-bit capable cat /etc/cpuinfo $ lscpu Architecture: i686 CPU op-mode(s): 32-bit, 64-bit Byte Order: Little Endian CPU(s): 4 On-line CPU(s) list: 0-3 .... memory print memory only $ ps -o comm,%mem,args -u marslo | more COMMAND %MEM COMMAND gnome-keyring-d 0.0 /usr/bin/gnome-keyring-daemon --daemonize --login init 0.0 init --user ssh-agent 0.0 ssh-agent dbus-daemon 0.0 dbus-daemon --fork --session --address=unix:abstract=/tmp/dbus-i5FUVjzADG upstart-event-b 0.0 upstart-event-bridge window-stack-br 0.0 /usr/lib/i386-linux-gnu/hud/window-stack-bridge upstart-dbus-br 0.0 upstart-dbus-bridge --daemon --session --user --bus-name session upstart-dbus-br 0.0 upstart-dbus-bridge --daemon --system --user --bus-name system upstart-file-br 0.0 upstart-file-bridge --daemon --user ibus-daemon 0.1 /usr/bin/ibus-daemon --daemonize --xim .... network network speed $ ifstat -n -i en7 en7 KB/s in KB/s out 7.35 1.15 4.91 1.02 6.05 0.80 8.36 1.78 get the public ip address $ curl ifconfig.me environment variables show PATH $ echo src::${PATH} | awk 'BEGIN{pwd=ENVIRON[\"PWD\"];RS=\":\";FS=\"\\n\"}!$1{$1=pwd}$1!~/^\\//{$1=pwd\"/\"$1}{print $1}' /home/marslo/src /home/marslo /home/marslo/.vim/tools/bin /usr/local/mysql/bin /usr/local/bcompare/bin /usr/lib/lightdm/lightdm /usr/local/sbin /usr/local/bin /usr/sbin /usr/bin /sbin /bin /usr/games /usr/local/games OR $ echo \"${PATH//:/$'\\n'}\" set system info clear duplicated PATH $ export PATH=`echo -n $PATH | awk -v RS=\":\" '{ if (!x[$0]++) {printf s $0; s=\":\"} }'` set dns for ubuntu $ cat /etc/resolv.conf # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8) # DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN nameserver 8.8.8.8 nameserver 8.8.4.4 nameserver 127.0.1.1 $ cat /etc/resolvconf/resolv.conf.d/head # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8) # DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN nameserver 8.8.8.8 nameserver 8.8.4.4 $ sudo resolvconf -u # or $ cat /etc/dhcp/dhclient.conf | grep \"prepend domain-name-servers\" prepend domain-name-servers 8.8.8.8, 8.8.4.4; # or $ cat /etc/network/interfaces | grep dns dns-nameservers 8.8.8.8 8.8.4.4 disable firewall $ sudo systemctl stop firewalld $ sudo systemctl disable firewalld $ sudo systemctl mask firewalld check result$ sudo systemctl is-enabled firewalld $ sudo systemctl is-active firewalld $ sudo firewall-cmd --state change net.bridge $ sudo modprobe br_netfilter $ sudo sysctl net.bridge.bridge-nf-call-iptables=1 $ sudo sysctl net.bridge.bridge-nf-call-ip6tables=1 # or $ sudo bash -c \"cat > /etc/sysctl.d/k8s.conf\" check status$ sudo sysctl --system off swap $ sudo swapoff -a $ sudo bash -c \"/usr/bin/sed -e 's:^\\\\(.*swap.*\\\\)$:# \\\\1:' -i /etc/fstab\" disable selinux $ setenforce 0 $ sudo bash -c \"/usr/bin/sed 's/^SELINUX=enforcing$/SELINUX=permissive/' -i /etc/selinux/config\" confined and unconfined users references: SELinux笔记 SELinux/Users and logins installation $ yum -y install setools-console setup for exiting account $ semanage login -a -s staff_u # or $ semanage login -a -s staff_u -r s0-s0:c0.c100 Modifying an existing mapping $ semanage login -m -s sysadm_u delete a mapping $ semanage login -d list mappings $ semanage user -l process find the zombie process $ ps aux | awk '{ print $8 \" \" $2 \" \" $11}' | grep -w Z sort process by PID $ ps -axww check the group PID $ ps -xj about whatis $ whatis whois whois (1) - client for the whois directory service $ whatis which which (1) - locate a command $ whatis whereis whereis (1) - locate the binary, source, and manual page files for a command user management sssd to use LDAP references: understanding sssd and its benefits additional configuration for identity and authentication providers sssd client-side view Configuring an LDAP Client to use SSSD /etc/sssd/sssd.conf sample Troubleshooting SSSD Linux user authentication with SSSD / LDAP add user name $ sss_override user-add username -n secondary-username # verification $ id secondary-username # display the override $ sss_override user-show user-name override the uid # check current uid $ id -u username # overwride $ sss_override user-add -u $ sss_cache --users # or $ sss_cache --user $ systemctl restart sssd override the gid # check current gid $ id -g username # override $ sss_override user-add -g $ sss_cache --users $ sss_cache --user $ systemctl restart sssd override the home directory # check current home directory $ getent passwd username # override $ sss_override user-add username -h /new/home/directory $ systemctl restart sssd override the shell attribute # check current $ getent passwd username # override $ sss_override user-add username -s /new/shell $ systemctl restart sssd managing the sssd cache # clear the cache and update all records $ sudo sss_cache [-E|--everything] # clear invalidates cache entries for all user records $ sudo sss_cache [-U|--users] # clear all cached entries for a particular domain $ sudo sss_cache [-E|--everything] [-d|--domain] # purge the records for that specific account and leave the rest of the cache intact $ sudo sss_cache [-u|--user] # invalidates the cache entry for the specified group $ sudo sss_cache [-g|--group] backup and restore # export $ sss_override user-export user-export.bak $ sss_override group-export group-export.bak # restore $ sss_override user-import user-import.bak $ sss_override group-import group-import.bak list all override $ sss_override user-find create sssd config After this in /etc/sssd/sssd.conf file Specify ldap_default_bind_dn and ldap_default_authtok as default bind dn and password respectively, this depends upon your ldap setup. $ authconfig --enablesssd \\ --enablesssdauth \\ --enablelocauthorize \\ --enableldap \\ --enableldapauth \\ --ldapserver=ldap://ipaserver.example.com:389 \\ --disableldaptls \\ --ldapbasedn=dc=example,dc=com \\ --enablerfc2307bis \\ --enablemkhomedir \\ --enablecachecreds \\ --update local user references: how to list users and groups on linux How to Create Groups in Linux (groupadd Command) understanding /etc/shadow file format on linux understanding the /etc/shadow file linux: instructions on using commands about user and group on linux find users /etc/passwd /etc/shadow /etc/pam.d/passwd more on users /etc/login.defs useradd create user devops $ useradd -c \"comments here\" \\ -m \\ -d \"/home/devops\" \\ -u 1000 \\ -g 1000 \\ -s /bin/bash \\ devops or $ useradd --comment \"comments here\" \\ --create-home \\ --home-dir /home/devops \\ --shell /bin/bash \\ --uid 1000 \\ --gid 1000 \\ --user-group devops devops full steps $ uid='1000' $ gid='1000' $ user='devops' $ mkdir -p /home/${user} $ chown -R ${uid}:${gid} /home/${user} $ groupadd -g ${gid} ${user} $ useradd -c \"create user ${user}\" \\ -d \"/home/${user}\" \\ -u ${uid} \\ -g ${gid} \\ -m \\ -s /bin/bash \\ ${user} deluser for ubunut deluser, delgroup - remove a user or group from the system SYNOPSIS deluser [options] [--force] [--remove-home] [--remove-all-files] [--backup] [--backup-to DIR] user deluser --group [options] group delgroup [options] [--only-if-empty] group deluser [options] user group $ deluser local group /etc/group /etc/passwd /etc/shadow references: Linux groupadd command list all groups $ getent group create group with random gid $ sudo groupadd get available gid for error: groupadd: GID 'xxxx' already exists $ gname='mytestgroup' $ sudo groupadd ${gname} $ getent group ${gname} | cut -d: -f3 # or $ sed -nr \"s/^${gname}:x:([0-9]+):.*/\\1/p\" /etc/group # or $ grep \"^${gname}\" /etc/group|cut -d: -f3 # and finally remove the group $ sudo groupdel ${gname} create group with particular gid $ sudo groupadd -g create group with existing gid -o (--non-unique) option the groupadd command allows you to create a group with non-unique GID $ sudo groupadd -o -g modify gid $ sudo groupmod -g add user into group $ usermod -a -G adm,root,sudo,docker devops remove user from group How to Add or Remove a User from a Group in Linux $ gpasswd -d logout $ pkill -KILL -u ${useranme} or$ who -uH NAME LINE TIME IDLE PID COMMENT devops pts/0 2022-06-14 05:44 00:17 41455 (192.168.1.1) marslo pts/1 2022-06-14 05:58 . 50162 (192.168.1.1) $ sudo kill 41455 $ who -uH NAME LINE TIME IDLE PID COMMENT marslo pts/1 2022-06-14 05:58 . 50162 (192.168.1.1) others view users password properties in linux $ chage -l marslo Last password change : Mar 09, 2022 Password expires : never Password inactive : never Account expires : never Minimum number of days between password change : 0 Maximum number of days between password change : 99999 Number of days of warning before password expires : 7 hash_algorithm Code Algorithm $1 MD5 hashing algorithm $2 Blowfish Algorithm $3 Eksblowfish Algorithm $4 NT hashing algorithm $5 SHA-256 Algorithm $6 SHA-512 Algorithm system encoding references: How to Change or Set System Locales in Linux /etc/default/locale – on Ubuntu/Debian /etc/locale.conf – on CentOS/RHEL Unicode characters in console logs do not print correctly in Workflow builds Locale How to set up a clean UTF-8 environment in Linux important files: /etc/default/locale /etc/locale.gen /etc/environment /usr/share/locales /var/lib/locales/supported.d/local /usr/local/share/i18n/SUPPORTED /usr/share/i18n/SUPPORTED setup via environment $ sudo bash -c 'cat >> /etc/bash.bashrc' setup via locale command $ apt-get install -y locales $ sudo locale-gen en_US.UTF-8 $ sudo update-locale LANG=en_US.UTF-8 $ source /etc/default/locale # or $ sudo dpkg-reconfigure locales # or $ sudo localectl set-locale LANG=en_US.UTF-8,LC_ALL=en_US.UTF-8 setup environment files$ sudo bash -c 'cat >> /etc/environment' applications sogou Pinyin input method $ sudo add-apt-repository ppa:fcitx-team/nightly $ sudo apt-get update $ sudo apt-get install fcitx-sogoupinyin $ # sudo apt-get remove ibus specified terminal size $ gnome-terminal --geometry=123x42+0+0 Q&A yum issue after python upgrade to 3.x references: CentOS 7升级Python到3.6.6后yum出错问题解决总结 yum upgrading error issue SyntaxError: invalid syntax File \"/usr/libexec/urlgrabber-ext-down\", line 28 except OSError, e: ^ solution $ sed -r '1s/^(.*python)$/\\12/g' -i /usr/libexec/urlgrabber-ext-down or change shebang from #! /usr/bin/python to #! /usr/bin/python2$ vim /usr/libexec/urlgrabber-ext-down ... change '#! /usr/bin/python' to '#! /usr/bin/python2' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:30 "},"linux/ubuntu/ubuntu.html":{"url":"linux/ubuntu/ubuntu.html","title":"ubuntu","keywords":"","body":" Table of Contents generated with DocToc Get Package name by command Search package name for apt-get Install Ubuntu Theme Open Font Viewer and install font Show launcher icon Show the softer renderer Specified Context Menu Disable Ubuntu Desktop notification Recode activity as a GIF file (Inspired from here and here) Goldendict Installation Get Package name by command $ apt-cache search mkpasswd whois - intelligent WHOIS client libstring-mkpasswd-perl - Perl module implementing a random password generator Search package name for apt-get $ sudo apt-cache search chrome browser chromium-browser - Chromium browser chromium-chromedriver - WebDriver driver for the Chromium Browser cloudprint - Server for Google Cloud Print collabtive - Web-based project management software epiphany-browser - Intuitive GNOME web browser jsxgraph - Interactive Geometry with JavaScript kpartsplugin - Netscape-compatible plugin to embed KDE file-viewers into browser libjs-excanvas - HTML5 Canvas for Internet Explorer libjs-jquery-jplayer - HTML5 Audio & Video for jQuery with a Flash fallback libjs-jquery-jush - jQuery Syntax Highlighter google-chrome-beta - The web browser from Google google-chrome-stable - The web browser from Google google-chrome-unstable - The web browser from Google Install Ubuntu Theme $ sudo add-apt-repository ppa:noobslab/themes $ sudo apt-get update $ sudo apt-get install nokto-theme Open Font Viewer and install font $ sudo gnome-font-viewer ~/Tools/Monaco/Monaco_Linux.TTF Show launcher icon $ gsettings get com.canonical.Unity.Launcher favorites ['application://nautilus.desktop', 'application://gnome-terminal.desktop', 'application://firefox.desktop', 'unity://running-apps', 'application://gvim.desktop', 'unity://desktop-icon', 'unity://expo-icon', 'unity://devices'] Show the softer renderer $ /usr/lib/nux/unity_support_test -p OpenGL vendor string: VMware, Inc. OpenGL renderer string: Gallium 0.4 on SVGA3D; build: RELEASE; OpenGL version string: 2.1 Mesa 10.1.0 Not software rendered: yes Not blacklisted: yes GLX fbconfig: yes GLX texture from pixmap: yes GL npot or rect textures: yes GL vertex program: yes GL fragment program: yes GL vertex buffer object: yes GL framebuffer object: yes GL version is 1.4+: yes Unity 3D supported: yes Specified Context Menu $ sudo apt-get install nautilus-actions $ nautilus -q $ utilus-actions-config-tool Disable Ubuntu Desktop notification $ sudo chmod -x /usr/lib/notify-osd/notify-osd Recode activity as a GIF file (Inspired from here and here) $ sudo add-apt-repository ppa:fossfreedom/byzanz $ sudo apt-get update && sudo apt-get install byzanz Goldendict Installation $ git clone git@github.com:goldendict/goldendict.git $ sudo apt-get install liblzma-dev qt4-qmake hunspell-dev hunspell build-essential libvorbis-dev zlib1g-dev libhunspell-dev x11proto-record-dev libqt4-dev libqtwebkit-dev libxtst-dev liblzo2-dev libbz2-dev libao-dev libavutil-dev libavformat-dev libtiff5-dev $ cd goldendict/ $ qmake-qt4 $ qmake \"CONFIG+=no_epwing_support\" $ make && sudo make install Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:30 "},"linux/ubuntu/apps.html":{"url":"linux/ubuntu/apps.html","title":"apps","keywords":"","body":" Table of Contents generated with DocToc Hardwares Hardwares Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:31 "},"linux/ubuntu/installation.html":{"url":"linux/ubuntu/installation.html","title":"installation","keywords":"","body":" Table of Contents generated with DocToc preconfig install dependencies setup account setup MOTD get subnet ip address get public IP address applications shadowsocks shadowsocks-libev terminal configurations vncserver artifactory add insecure-regiestry docker login & logout docker pull docker push X Windows get screen solution desktop sharing Reference preconfig install dependencies $ sudo apt install -y apt-file autoconf automake bash-completion* binutils binutils-doc bison build-essential cmake cpp cpp-5 cpp-doc curl debian-keyring dlocate dos2unix dpkg-dev dstat fakeroot flex g++ g++-5 g++-5-multilib g++-multilib gcc gcc-5 gcc-5-doc gcc-5-locales gcc-5-multilib gcc-doc gcc-multilib gdb git htop ifstat iftop iptables-persistent jq landscape-common libasan2 libasan2-dbg libatomic1 libatomic1-dbg libbz2-dev libc-dev-bin libc6-dev libcc1-0 libcilkrts5 libcilkrts5-dbg libexpat-dev libexpat1-dev libfakeroot libgcc1-dbg libgomp1-dbg libisl15 libitm1 libitm1-dbg liblsan0 liblsan0-dbg liblxc1 libmpc3 libmpx0 libmpx0-dbg libncurses-dev libncurses5-dev libncursesw5-dev libpython-all-dev libpython2.7 libquadmath0 libquadmath0-dbg libsensors4 libssl-dev libstdc++-5-dev libstdc++-5-doc libstdc++6-5-dbg libtool libtsan0 libtsan0-dbg libubsan0 libubsan0-dbg linux-libc-dev lxc-common lxcfs m4 mailutils make manpages-dev ncurses-doc net-tools netfilter-persistent policycoreutils python-docutils python-pip python-setuptools-doc ruby sysstat texinfo traceroute tree update-motd update-notifier-common zlib1g-dev setup account $ sudo usermod -a -G sudo,adm,root,docker devops setup MOTD $ sudo chmod -x /etc/update-motd.d/00-header \\ /etc/update-motd.d/10-help-text \\ /etc/update-motd.d/50-motd-news $ cat /etc/landscape/client.conf [sysinfo] exclude_sysinfo_plugins = Temperature, LandscapeLink EOF get subnet ip address $ ip addr show eno1 | grep inet | awk '{ print $2; }' | sed 's/\\/.*$//' 192.168.1.105 fe80::e5ca:1027:b572:9998 get public IP address $ curl -4 icanhazip.com 182.150.46.248 applications shadowsocks server $ sudo apt install m2crypto git python-pip $ pip install --upgrade pip $ pip install git+https://github.com/shadowsocks/shadowsocks.git@master $ sudo ln -sf /home/marslo/.local/bin/ssserver /usr/local/bin/ssserver start $ sudo bash -c 'cat > /etc/rc.local' client ubuntu $ sudo add-apt-repository ppa:hzwhuang/ss-qt5 Shadowsocks-Qt5 is a cross-platform Shadowsocks GUI client. Shadowsocks is a lightweight tool that helps you bypass firewall(s). This PPA mainly includes packages for Shadowsocks-Qt5, which means it also includes libQtShadowsocks packages. More info: https://launchpad.net/~hzwhuang/+archive/ubuntu/ss-qt5 Press [ENTER] to continue or Ctrl-c to cancel adding it. gpg: keybox '/tmp/tmpaegs6_x4/pubring.gpg' created gpg: /tmp/tmpaegs6_x4/trustdb.gpg: trustdb created gpg: key 6DA746A05F00FA99: public key \"Launchpad PPA for Symeon Huang\" imported gpg: Total number processed: 1 gpg: imported: 1 OK $ sudo apt update $ sudo apt install shadowsocks-qt5 Others $ sudo apt install python-pip $ sudo pip install genpac shadowsocks-libev service started by docker image teddysun/shadowsocks-libev $ mkdir -p /etc/shadowsocks-libev $ sudo bash -c \"cat > /etc/shadowsocks-libev/config.json\" started by /etc/init.d/shadowsocks-libev $ wget --no-check-certificate -O shadowsocks-all.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh $ chmod +x shadowsocks-all.sh $ ./shadowsocks-all.sh 2>&1 | tee shadowsocks-all.log ... Which Shadowsocks server you'd select: 1) Shadowsocks-Python 2) ShadowsocksR 3) Shadowsocks-Go 4) Shadowsocks-libev Please enter a number (Default Shadowsocks-Python): 4 You choose = Shadowsocks-libev ... [Info] Starting install package autoconf Do you want install simple-obfs for Shadowsocks-libev? [y/n] (default: n): y You choose = y Please select obfs for simple-obfs: 1) http 2) tls Which obfs you'd select(Default: http): 1 obfs = http ... service $ sudo /etc/init.d/shadowsocks-libev start $ sudo /etc/init.d/shadowsocks-libev stop $ sudo /etc/init.d/shadowsocks-libev restart $ sudo /etc/init.d/shadowsocks-libev status config $ /etc/shadowsocks-libev/config.json { \"server\":\"0.0.0.0\", \"server_port\": 1111, \"password\":\"mypassword\", \"timeout\":300, \"user\":\"nobody\", // optinal \"method\":\"aes-256-cfb\", \"fast_open\":false, \"nameserver\":\"1.0.0.1\", // be careful for dns resolve in private network \"mode\":\"tcp_and_udp\", \"plugin\":\"obfs-server\", \"plugin_opts\":\"obfs=http\" } check status $ sudo lsof -i:1111 $ sudo netstatus -tunpla | grep 1111 client plugin plugin opts simple-obfs obfs=http;obfs-host=www.google.com terminal configurations Backup $ dconf dump /org/gnome/terminal/ > ubuntu1710_terminal_backup.bak Restore $ dconf load /org/gnome/terminal/ Reset $ dconf reset -f /org/gnome/terminal List $ gsettings list-recursively | grep -i org.gnome.Terminal Click to check details $ gsettings list-recursively | grep -i org.gnome.Terminal org.gnome.Terminal.ProfilesList list ['b1dcc9dd-5262-4d8d-a863-c897e6d979b9'] org.gnome.Terminal.ProfilesList default 'b1dcc9dd-5262-4d8d-a863-c897e6d979b9' org.gnome.shell favorite-apps ['firefox.desktop', 'org.gnome.Nautilus.desktop', 'org.gnome.Terminal.desktop'] org.gnome.Terminal.Legacy.Settings new-terminal-mode 'window' org.gnome.Terminal.Legacy.Settings menu-accelerator-enabled true org.gnome.Terminal.Legacy.Settings tab-position 'top' org.gnome.Terminal.Legacy.Settings confirm-close true org.gnome.Terminal.Legacy.Settings shell-integration-enabled true org.gnome.Terminal.Legacy.Settings theme-variant 'dark' org.gnome.Terminal.Legacy.Settings default-show-menubar true org.gnome.Terminal.Legacy.Settings mnemonics-enabled false org.gnome.Terminal.Legacy.Settings schema-version uint32 3 org.gnome.Terminal.Legacy.Settings encodings ['UTF-8'] org.gnome.Terminal.Legacy.Settings shortcuts-enabled true org.gnome.Terminal.Legacy.Settings tab-policy 'automatic' org.gnome.Terminal.Legacy.Keybindings toggle-menubar 'disabled' org.gnome.Terminal.Legacy.Keybindings reset-and-clear 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-14 'disabled' org.gnome.Terminal.Legacy.Keybindings zoom-normal '0' org.gnome.Terminal.Legacy.Keybindings read-only 'disabled' org.gnome.Terminal.Legacy.Keybindings new-profile 'disabled' org.gnome.Terminal.Legacy.Keybindings zoom-out 'minus' org.gnome.Terminal.Legacy.Keybindings move-tab-left 'Page_Up' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-20 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-21 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-22 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-23 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-24 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-25 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-26 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-27 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-28 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-29 'disabled' org.gnome.Terminal.Legacy.Keybindings zoom-in 'plus' org.gnome.Terminal.Legacy.Keybindings detach-tab 'disabled' org.gnome.Terminal.Legacy.Keybindings move-tab-right 'Page_Down' org.gnome.Terminal.Legacy.Keybindings close-tab 'w' org.gnome.Terminal.Legacy.Keybindings paste 'v' org.gnome.Terminal.Legacy.Keybindings reset 'disabled' org.gnome.Terminal.Legacy.Keybindings new-tab 't' org.gnome.Terminal.Legacy.Keybindings find-previous 'H' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-30 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-31 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-32 'disabled' org.gnome.Terminal.Legacy.Keybindings select-all 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-34 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-35 'disabled' org.gnome.Terminal.Legacy.Keybindings preferences 'disabled' org.gnome.Terminal.Legacy.Keybindings prev-tab 'Page_Up' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-33 'disabled' org.gnome.Terminal.Legacy.Keybindings find-next 'G' org.gnome.Terminal.Legacy.Keybindings find 'F' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-1 '1' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-2 '2' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-3 '3' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-4 '4' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-5 '5' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-6 '6' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-7 '7' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-8 '8' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-9 '9' org.gnome.Terminal.Legacy.Keybindings help 'F1' org.gnome.Terminal.Legacy.Keybindings copy 'c' org.gnome.Terminal.Legacy.Keybindings close-window 'q' org.gnome.Terminal.Legacy.Keybindings new-window 'n' org.gnome.Terminal.Legacy.Keybindings save-contents 'disabled' org.gnome.Terminal.Legacy.Keybindings find-clear 'J' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-10 '0' org.gnome.Terminal.Legacy.Keybindings full-screen 'F11' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-12 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-13 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-11 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-15 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-16 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-17 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-18 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-19 'disabled' org.gnome.Terminal.Legacy.Keybindings profile-preferences 'disabled' org.gnome.Terminal.Legacy.Keybindings next-tab 'Page_Down' vncserver install $ sudo apt install vnc4server $ sudo apt install gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal artifactory add insecure-regiestry $ cat ~/.docker/daemon.json { \"debug\" : true, \"experimental\" : true, \"insecure-registries\" : [\"www.artifactory.mycompany.com\", \"www.artifactory.mycompany.com:2500\", \"www.artifactory.mycompany.com:2501\", \"docker-1.artifactory\", \"docker-1.artifactory:443\"] } $ sudo systemctl daemon-reload $ sudo systemctl restart docker docker login & logout $ docker --debug -l debug login --username admin https://docker-1.artifactory Password: Login Succeeded $ docker --debug -l debug logout docker-1.artifactory Removing login credentials for docker-1.artifactory docker pull $ docker pull docker-1.artifactory/nginx:latest latest: Pulling from nginx e7bb522d92ff: Pull complete 0f4d7753723e: Pulling fs layer 91470a14d63f: Download complete 0f4d7753723e: Pull complete 91470a14d63f: Pull complete Digest: sha256:3eff18554e47c4177a09cea5d460526cbb4d3aff9fd1917d7b1372da1539694a Status: Downloaded newer image for docker-1.artifactory/nginx:latest docker push $ docker pull hello-world $ docker tag hello-world docker-1.artifactory/bello-marslo:2.0 $ docker login --username admin docker-1.artifactory $ docker push docker-1.artifactory/bello-marslo:2.0 X Windows get screen solution $ xrandr --verbose Screen 0: minimum 320 x 200, current 1920 x 1080, maximum 8192 x 8192 XWAYLAND0 connected 1920x1080+0+0 (0x22) normal (normal left inverted right x axis y axis) 480mm x 270mm Identifier: 0x21 Timestamp: 3807 Subpixel: unknown Gamma: 1.0:1.0:1.0 Brightness: 0.0 Clones: CRTC: 0 CRTCs: 0 Transform: 1.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 1.000000 filter: 1920x1080 (0x22) 173.000MHz -HSync +VSync *current +preferred h: width 1920 start 2048 end 2248 total 2576 skew 0 clock 67.16KHz v: height 1080 start 1083 end 1088 total 1120 clock 59.96Hz desktop sharing enable desktop sharing ##!/bin/bash export DISPLAY=:0 read -e -p \"VNC Password: \" -i \"ubuntu\" password dconf write /org/gnome/desktop/remote-access/enabled true dconf write /org/gnome/desktop/remote-access/prompt-enabled false dconf write /org/gnome/desktop/remote-access/authentication-methods \"['vnc']\" dconf write /org/gnome/desktop/remote-access/require-encryption false08/03/2018 dconf write /org/gnome/desktop/remote-access/vnc-password \\\"\\'$(echo -n $password | base64)\\'\\\" dconf dump /org/gnome/desktop/remote-access/ ## sudo service lightdm restart OR $ vino-preference $ dconf-editor start x server $ export DISPLAY=:0 $ /usr/lib/vino/vino-server --display=:0 & Reset vnc password $ echo -n 'awesome' | base64 $ gconftool-2 -s -t string /desktop/gnome/remote_access/vnc_password $(echo -n \"\" | base64) $ gconftool-2 --type string --set /desktop/gnome/remote_acess/vnc_password '123456' Wayland known error cat Check using Wayland or Xorg $ echo $XDG_SESSION_TYPE Ubuntu: Wayland (Wayland) Ubuntu on Xorg: Xorg (X11) Reference 使用ssl模块配置同时支持http和https并存 How To Create an SSL Certificate on Nginx for Ubuntu 14.04 How To Create a Self-Signed SSL Certificate for Nginx in Ubuntu 16.04 Enabling Https with Nginx Enable SSL for HTTPS Configuration on nginx Nginx+Https配置 Test an insecure registry Protect the Docker daemon socket Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:31 "},"linux/ubuntu/repo.html":{"url":"linux/ubuntu/repo.html","title":"repo","keywords":"","body":" Table of Contents generated with DocToc Reference Reference Google Linux Software Repositories Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:30 "},"linux/ubuntu/systemctl.html":{"url":"linux/ubuntu/systemctl.html","title":"systemctl","keywords":"","body":" Table of Contents generated with DocToc ubuntu 17.10 bootup settings Reference ubuntu 17.10 bootup settings create Script $ cat /usr/local/bin/do_route.sh ##!/bin/bash ## Destination Gateway Genmask Flags Metric Ref Use Iface ## 0.0.0.0 192.168.10.1 0.0.0.0 UG 0 0 0 eno2 /sbin/route -n | grep \"0\\.0\\.0\\.0.*192\\.168\\.10\\.1.*eno2\" > /dev/null 2>&1 if [ $? != 0 ]; then sudo route add default gw 192.168.10.1 fi ## Destination Gateway Genmask Flags Metric Ref Use Iface ## 0.0.0.0 130.147.180.65 0.0.0.0 UG 0 0 0 eno1 /sbin/route -n | grep \"0\\.0\\.0\\.0.*130\\.147\\.180\\.65.*eno1\" > /dev/null 2>&1 if [ $? == 0 ]; then sudo route delete -net 0.0.0.0 gw 130.147.180.65 netmask 0.0.0.0 fi host=\"161.92.35.78 130.147.236.5 180.166.223.190 140.207.91.234 42.99.164.34 185.46.212.34\" for _h in ${host}; do sudo route add -host ${_h} gw 130.147.180.65 done route=\"130.147.0.0 130.140.0.0 130.146.0.0 137.55.0.0 161.83.0.0 161.84.0.0 161.85.0.0 161.88.0.0 161.91.0.0 161.92.0.0 185.166.0.0\" for _r in ${route}; do sudo route add -net ${_r} netmask 255.255.0.0 eno1 done touch /home/devops/hi-marslo create service $ ls -altrh /lib/systemd/system/do_route.service -rwxr-xr-x 1 root root 140 Jan 15 22:08 /lib/systemd/system/do_route.service $ cat /lib/systemd/system/do_route.service [Unit] Description=Add static route for two interface [Service] ExecStart=/usr/local/bin/do_route.sh [Install] WantedBy=multi-user.target Alias=myroute.service enable the service $ sudo systemctl enable do_route.service Created symlink /etc/systemd/system/multi-user.target.wants/do_route.service → /lib/systemd/system/do_route.service. Created symlink /etc/systemd/system/myroute.service → /lib/systemd/system/do_route.service. $ sudo systemctl start do_route.service disable the service $ sudo systemctl disable do_route.service Removed /etc/systemd/system/myroute.service. Removed /etc/systemd/system/multi-user.target.wants/do_route.service. re-enable the service $ sudo systemctl enable add_route.service Created symlink /etc/systemd/system/marslo_route.service → /lib/systemd/system/add_route.service. Created symlink /etc/systemd/system/multi-user.target.wants/add_route.service → /lib/systemd/system/add_route.service. route FLags U: Up: 表示此路由当前为启动状态 H: Host: 表示此网关为一主机 G: Gateway: 表示此网关为一路有 R: Reinstate Route: 使用动态路由重新初始化的路由 D: Dynamically: 此路由是动态性的写入 M: Modifed: 此路由是有路由守护程序或导向器动态修改 !: 关闭状态 Reference How to automatically execute shell script at startup boot on systemd Linux Using systemd to control the Docker daemon systemd_service.5.manual Linux route命令详解：查看和操作IP路由表 ubuntu配置静态路由及重启生效 Systemd的Unit文件; systemctl增加服务详细介绍 SystemdForUpstartUsers Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:30 "},"linux/ubuntu/x.html":{"url":"linux/ubuntu/x.html","title":"x","keywords":"","body":" Table of Contents generated with DocToc enable screensharing backup and restore config setup screen sharing start application remotelly GDM login session Process and SubProcesses Wayland Reference enable screensharing backup and restore config $ dconf dump /org/gnome/desktop/remote-access/ > ubuntu1804_remoteaccess $ cat ubuntu1804_remoteaccess [/] require-encryption=false vnc-password='bWFyc2xv' authentication-methods=['vnc'] prompt-enabled=false $ dconf load /org/gnome/desktop/remote-access/ setup screen sharing $ read -e -p \"VNC Password: \" -i \"ubuntu\" VNCPASSWORD $ dconf write /org/gnome/desktop/remote-access/enabled true $ dconf write /org/gnome/desktop/remote-access/authentication-methods \"['vnc']\" $ dconf write /org/gnome/desktop/remote-access/prompt-enabled false $ dconf write /org/gnome/desktop/remote-access/require-encryption false $ dconf write /org/gnome/desktop/remote-access/vnc-password \\\"\\'$(echo -n $VNCPASSWORD | base64)\\'\\\" $ sudo service lightdm restart reset VNC password $ echo -n \"marslo\" | base64 bWFyc2xv read all conf $ for i in $(gsettings list-keys org.gnome.Vino); do echo -e \"$i:\\t --> \"$(dconf read /org/gnome/desktop/remote-access/$i); done notify-on-connect: --> alternative-port: --> disable-background: --> use-alternative-port: --> icon-visibility: --> use-upnp: --> view-only: --> prompt-enabled: --> false disable-xdamage: --> authentication-methods: --> ['vnc'] network-interface: --> require-encryption: --> false mailto: --> lock-screen-on-disconnect: --> vnc-password: --> 'bWFyc2xv' start application remotelly $ export DISPLAY=:0 $ gnome-terminal GDM $ cat /lib/systemd/system/gdm.service [Unit] Description=GNOME Display Manager ## replaces the getty Conflicts=getty@tty1.service After=getty@tty1.service ## replaces plymouth-quit since it quits plymouth on its own Conflicts=plymouth-quit.service After=plymouth-quit.service ## Needs all the dependencies of the services it's replacing ## pulled from getty@.service and plymouth-quit.service ## (except for plymouth-quit-wait.service since it waits until ## plymouth is quit, which we do) After=rc-local.service plymouth-start.service systemd-user-sessions.service ## GDM takes responsibility for stopping plymouth, so if it fails ## for any reason, make sure plymouth still stops OnFailure=plymouth-quit.service [Service] ExecStartPre=/usr/share/gdm/generate-config ExecStart=/usr/sbin/gdm3 KillMode=mixed Restart=always RestartSec=1s IgnoreSIGPIPE=no BusName=org.gnome.DisplayManager StandardOutput=syslog StandardError=inherit EnvironmentFile=-/etc/default/locale ExecReload=/usr/share/gdm/generate-config ExecReload=/bin/kill -SIGHUP $MAINPID gnome-shell AutoLogin Login with desired session $ cat /var/lib/AccountsService/users/devops [User] FormatsLocale=en_US.UTF-8 XSession=gnome-xorg SystemAccount=false [InputSource0] xkb=us Auto Login with GDM $ grep -i auto /etc/gdm3/custom.conf [daemon] ## Enabling automatic login AutomaticLoginEnable = true AutomaticLogin = devops Auto Login with Delay $ grep -i time /etc/gdm3/custom.conf [daemon] ## Enabling timed login ## TimedLoginEnable = true ## TimedLogin = user1 ## TimedLoginDelay = 10 login session Default Session $ cat /etc/X11/default-display-manager /usr/sbin/gdm3 Process and SubProcesses pstree $ pstree 1391 gdm3─┬─gdm-session-wor─┬─gdm-x-session─┬─Xorg───{Xorg} │ │ ├─gnome-session-b─┬─deja-dup-monito───4*[{deja-dup-monito}] │ │ │ ├─gnome-software───3*[{gnome-software}] │ │ │ ├─gsd-a11y-settin───3*[{gsd-a11y-settin}] │ │ │ ├─gsd-clipboard───2*[{gsd-clipboard}] │ │ │ ├─gsd-color───3*[{gsd-color}] │ │ │ ├─gsd-datetime───3*[{gsd-datetime}] │ │ │ ├─gsd-disk-utilit───2*[{gsd-disk-utilit}] │ │ │ ├─gsd-housekeepin───3*[{gsd-housekeepin}] │ │ │ ├─gsd-keyboard───3*[{gsd-keyboard}] │ │ │ ├─gsd-media-keys───3*[{gsd-media-keys}] │ │ │ ├─gsd-mouse───3*[{gsd-mouse}] │ │ │ ├─gsd-power───3*[{gsd-power}] │ │ │ ├─gsd-print-notif───2*[{gsd-print-notif}] │ │ │ ├─gsd-rfkill───2*[{gsd-rfkill}] │ │ │ ├─gsd-screensaver───2*[{gsd-screensaver}] │ │ │ ├─gsd-sharing───3*[{gsd-sharing}] │ │ │ ├─gsd-smartcard───4*[{gsd-smartcard}] │ │ │ ├─gsd-sound───3*[{gsd-sound}] │ │ │ ├─gsd-wacom───2*[{gsd-wacom}] │ │ │ ├─gsd-xsettings───3*[{gsd-xsettings}] │ │ │ ├─nautilus-deskto───3*[{nautilus-deskto}] │ │ │ ├─ssh-agent │ │ │ ├─update-notifier───3*[{update-notifier}] │ │ │ └─3*[{gnome-session-b}] │ │ └─2*[{gdm-x-session}] │ └─2*[{gdm-session-wor}] └─2*[{gdm3}] ps short $ ps auxwwf /usr/sbin/gdm3 \\_ gdm-session-worker [pam/gdm-autologin] \\_ /usr/lib/gdm3/gdm-x-session --run-script env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu \\_ /usr/lib/xorg/Xorg vt1 -displayfd 3 -auth /run/user/1000/gdm/Xauthority -background none -noreset -keeptty -verbose 3 \\_ /usr/lib/gnome-session/gnome-session-binary --session=ubuntu \\_ /usr/bin/ssh-agent /usr/bin/im-launch env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu \\_ /usr/lib/gnome-settings-daemon/gsd-power \\_ /usr/lib/gnome-settings-daemon/gsd-print-notifications \\_ /usr/lib/gnome-settings-daemon/gsd-rfkill \\_ /usr/lib/gnome-settings-daemon/gsd-screensaver-proxy \\_ /usr/lib/gnome-settings-daemon/gsd-sharing \\_ /usr/lib/gnome-settings-daemon/gsd-smartcard \\_ /usr/lib/gnome-settings-daemon/gsd-sound \\_ /usr/lib/gnome-settings-daemon/gsd-xsettings \\_ /usr/lib/gnome-settings-daemon/gsd-wacom \\_ /usr/lib/gnome-settings-daemon/gsd-clipboard \\_ /usr/lib/gnome-settings-daemon/gsd-a11y-settings \\_ /usr/lib/gnome-settings-daemon/gsd-datetime \\_ /usr/lib/gnome-settings-daemon/gsd-color \\_ /usr/lib/gnome-settings-daemon/gsd-keyboard \\_ /usr/lib/gnome-settings-daemon/gsd-housekeeping \\_ /usr/lib/gnome-settings-daemon/gsd-mouse \\_ /usr/lib/gnome-settings-daemon/gsd-media-keys \\_ /usr/lib/gnome-disk-utility/gsd-disk-utility-notify \\_ /usr/bin/gnome-software --gapplication-service \\_ nautilus-desktop \\_ update-notifier \\_ /usr/lib/deja-dup/deja-dup-monitor full $ ps auxwwf root 1391 0.0 0.1 308176 8340 ? Ssl 16:58 0:00 /usr/sbin/gdm3 root 1456 0.0 0.1 271860 8720 ? Sl 16:58 0:00 \\_ gdm-session-worker [pam/gdm-autologin] devops 1497 0.0 0.0 212124 6000 tty1 Ssl+ 16:58 0:00 \\_ /usr/lib/gdm3/gdm-x-session --run-script env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu devops 1499 0.4 1.0 370392 81984 tty1 Sl+ 16:58 0:02 \\_ /usr/lib/xorg/Xorg vt1 -displayfd 3 -auth /run/user/1000/gdm/Xauthority -background none -noreset -keeptty -verbose 3 devops 1518 0.0 0.1 716920 15716 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-session/gnome-session-binary --session=ubuntu devops 1599 0.0 0.0 11304 320 ? Ss 16:58 0:00 \\_ /usr/bin/ssh-agent /usr/bin/im-launch env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu devops 2471 0.0 0.2 527336 23468 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-power devops 2472 0.0 0.1 349316 10144 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-print-notifications devops 2475 0.0 0.0 423340 5728 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-rfkill devops 2481 0.0 0.0 275728 5048 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-screensaver-proxy devops 2485 0.0 0.1 471340 11980 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-sharing devops 2493 0.0 0.1 466472 10096 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-smartcard devops 2495 0.0 0.1 343116 9808 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-sound devops 2499 0.0 0.2 504824 23460 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-xsettings devops 2511 0.0 0.2 440656 22568 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-wacom devops 2530 0.0 0.2 355824 21572 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-clipboard devops 2531 0.0 0.1 296660 8348 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-a11y-settings devops 2532 0.0 0.1 476600 15176 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-datetime devops 2536 0.0 0.3 678216 24396 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-color devops 2537 0.0 0.2 508124 22096 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-keyboard devops 2539 0.0 0.1 374712 8804 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-housekeeping devops 2542 0.0 0.1 296672 8284 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-mouse devops 2545 0.0 0.3 1155368 24656 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-media-keys devops 2589 0.0 0.0 271928 6216 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-disk-utility/gsd-disk-utility-notify devops 2590 0.4 1.8 1318392 152212 tty1 SLl+ 16:58 0:02 \\_ /usr/bin/gnome-software --gapplication-service devops 2599 0.2 0.9 1197708 75864 tty1 Sl+ 16:58 0:01 \\_ nautilus-desktop devops 3686 0.0 0.3 605436 28680 tty1 Sl+ 16:59 0:00 \\_ update-notifier devops 4017 0.0 0.4 118225468 32448 tty1 Sl+ 17:00 0:00 \\_ /usr/lib/deja-dup/deja-dup-monitor Wayland Reference GDM Reference Manual GNOME How to configure Vino for remote desktop access using command line Vino Vino. The Remote Desktop Project VND/Servers Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:31 "},"programming/python/python.html":{"url":"programming/python/python.html","title":"programming","keywords":"","body":" Table of Contents generated with DocToc Pythonic zip/unzip in dict & counter enumerate import local module args & kwargs itertools one-line python code slice chain compare boolean reverse join in list sum & max & min & time list comprehensions default dict if...else... ternary operator dict & zip hidden features numbers string args conditional assignment list & dics generator & iteration statement funcs class & module Others PEP8 -- Style Guide for Python Code Indentation Maximum Line Length Should a Line break before or after a binary operator? imports module Level dunder names whitespace in expressions and statements other recommendations documentation strings Programming Recommendations PEP8 Error/Warning Code Pythonic Inspired from what are same example of beautiful 'Pythonic' code? and 如何让你的Python代码更加pythonic? run python code online zip/unzip def unzip(tuples): if tuples: return [tuple(t[i] for t in tuples) for i, _ in enumerate(tuples[0])] else: return [] result:>>> unzip( ((1, 2), (3, 4), (5, 6)) ) [(1, 3, 5), (2, 4, 6)] in long_string = \"This is a very long string\" if \"long\" in long_string: print(\"Match found\") dict & counter >>> from collections import Counter >>> fruits = ['orange', 'banana', 'apple', 'orange', 'banana'] >>> Counter(fruits) Counter({'orange': 2, 'banana': 2, 'apple': 1}) enumerate x = ['a', 'b', 'c'] for index, item in enumerate(x): print(index, item) P: array = [1, 2, 3, 4, 5] for i, e in enumerate(array,0): print i, e #0 1 #1 2 #2 3 #3 4 #4 5 NP: for i in xrange(len(array)): print i, array[i] #0 1 #1 2 #2 3 #3 4 #4 5 import local module # A.py def filter_items(items): for i in items: if i args & kwargs def add(one, two): return one + two my_list = [1, 2] x = add(*my_list) # x = 3 my_dict = {\"one\": 1, \"two\": 2} y = add(**my_dict) #y = 3 itertools >>> from itertools import zip_longest >>> x = [1, 2, 3, 4] >>> y = ['a', 'b', 'c'] >>> for i, j in zip_longest(x, y): ... print(i, j) ... 1 a 2 b 3 c 4 None one-line python code >>> my_dict = {key: value for key, value in zip_longest(x,y)} >>> my_dict {1: 'a', 2: 'b', 3: 'c', 4: None} slice word = #some word is_palindrome = word.find(word[-1::-1]) chain compare P: a = 3 b = 1 1 NP: a = 3 b = 1 b >= 1 and b boolean P: name = 'Tim' langs = ['AS3', 'Lua', 'C'] info = {'name': 'Tim', 'sex': 'Male', 'age':23 } if name and langs and info: print('All True!') #All True! NP: if name != '' and len(langs) > 0 and info != {}: print('All True!') #All True! reverse P: def reverse_str( s ): return s[::-1] NP: def reverse_str( s ): t = '' for x in xrange(len(s)-1,-1,-1): t += s[x] return t join in list P: strList = [\"Python\", \"is\", \"good\"] res = ' '.join(strList) #Python is good NP: res = '' for s in strList: res += s + ' ' #Python is good #最后还有个多余空格 sum & max & min & time P: numList = [1,2,3,4,5] sum = sum(numList) #sum = 15 maxNum = max(numList) #maxNum = 5 minNum = min(numList) #minNum = 1 from operator import mul prod = reduce(mul, numList, 1) #prod = 120 默认值传1以防空列表报错 NP: sum = 0 maxNum = -float('inf') minNum = float('inf') prod = 1 for num in numList: if num > maxNum: maxNum = num if num list comprehensions P: l = [x*x for x in range(10) if x % 3 == 0] # l = [0, 9, 36, 81] NP: l = [] for x in range(10): if x % 3 == 0: l.append(x*x) # l = [0, 9, 36, 81] default dict P: dic = {'name':'Tim', 'age':23} dic['workage'] = dic.get('workage',0) + 1 # dic = {'age': 23, 'workage': 1, 'name': 'Tim'} NP: if 'workage' in dic: dic['workage'] += 1 else: dic['workage'] = 1 # dic = {'age': 23, 'workage': 1, 'name': 'Tim'} if...else... P: for x in xrange(1,5): if x == 5: print 'find 5' break else: print 'can not find 5!' # can not find 5! NP: find = False for x in xrange(1,5): if x == 5: find = True print 'find 5' break if not find: print 'can not find 5!' # can not find 5! ternary operator P: a = 3 b = 2 if a > 2 else 1 # b = 2 NP: if a > 2: b = 2 else: b = 1 # b = 2 dict & zip P: keys = ['Name', 'Sex', 'Age'] values = ['Tim', 'Male', 23] dic = dict(zip(keys, values)) # {'Age': 23, 'Name': 'Tim', 'Sex': 'Male'} NP: dic = {} for i,e in enumerate(keys): dic[e] = values[i] # {'Age': 23, 'Name': 'Tim', 'Sex': 'Male'} hidden features numbers round >>> str(round(1234.5678, -2)) '1200.0' >>> str(round(1234.5678, 2)) '1234.57' integer base >>> int('10', 0) 10 >>> int('0x10', 0) 16 >>> int('010', 0) # does not work on Python 3.x 8 >>> int('0o10', 0) # Python >=2.6 and Python 3.x 8 >>> int('0b10', 0) # Python >=2.6 and Python 3.x 2 in-place value swapping >>> a = 10 >>> b = 5 >>> a, b (10, 5) >>> a, b = b, a >>> a, b (5, 10) sum from operator import add print reduce(add, [1,2,3,4,5,6]) string multi-line strings >>> sql = \"select * from some_table \\ where id > 10\" >>> print sql select * from some_table where id > 10 or >>> sql = \"\"\"select * from some_table where id > 10\"\"\" >>> print sql select * from some_table where id > 10 or >>> sql = (\"select * from some_table \" # 10 \" \"order by name\") >>> print sql select * from some_table where id > 10 order by name in >>> 'str' in 'string' True >>> 'no' in 'yes' False >>> Join ''.join(list_of_strings) set >>> a = set([1,2,3,4]) >>> b = set([3,4,5,6]) >>> a | b # Union {1, 2, 3, 4, 5, 6} >>> a & b # Intersection {3, 4} >>> a >> a - b # Difference {1, 2} >>> a ^ b # Symmetric Difference {1, 2, 5, 6} slice operators a = [1,2,3,4,5] >>> a[::2] # iterate over the whole list in 2-increments [1,3,5] or >>> a[::-1] [5,4,3,2,1] or >>> a = range(10) >>> a [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> a[:5] = [42] >>> a [42, 5, 6, 7, 8, 9] >>> a[:1] = range(5) >>> a [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> del a[::2] >>> a [1, 3, 5, 7, 9] >>> a[::2] = a[::-2] >>> a [9, 3, 5, 7, 1] reversed for i in reversed([1, 2, 3]): print(i) backslashes >>> print repr(r\"aaa\\\"bbb\") 'aaa\\\\\"bbb' or>>> print repr(r\"C:\\\") SyntaxError: EOL while scanning string literal >>> print repr(r\"C:\\\"\") 'C:\\\\\"' args Use _ instead of last printed item >>> range(10) [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> _ [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> *args & **kwargs >>> g = lambda *args, **kwargs: args[0], kwargs['thing'] >>> g(1, 2, 3, thing='stuff') (1, 'stuff') or def foo(a, b, c): print a, b, c bar = (3, 14, 15) foo(*bar) function argument unpacking def draw_point(x, y): # do some magic point_foo = (3, 4) point_bar = {'y': 3, 'x': 2} draw_point(*point_foo) draw_point(**point_bar) conditional assignment ternary operator >>> 'ham' if True else 'spam' 'ham' >>> 'ham' if False else 'spam' 'spam' or >>> True and 'ham' or 'spam' 'ham' >>> False and 'ham' or 'spam' 'spam' or >>> [] if True else 'spam' [] >>> True and [] or 'spam' 'spam' or In [18]: a = True In [19]: a and 3 or 4 Out[19]: 3 In [20]: a = False In [21]: a and 3 or 4 Out[21]: 4 or >>> (1 and [foo()] or [bar()])[0] foo 0 or >>> foo() if True or bar() foo 0 conditional x = 3 if (y == 1) else 2 or x = 3 if (y == 1) else 2 if (y == -1) else 1 or (func1 if y == 1 else func2)(arg1, arg2) or x = (class1 if y == 1 else class2)(arg1, arg2) or [(x, y) for x in range(4) if x % 2 == 1 for y in range(4)] [(1, 0), (1, 1), (1, 2), (1, 3), (3, 0), (3, 1), (3, 2), (3, 3)] or x = 3 if (y == 1) else 2 is equvalent to x = y == 1 and 3 or 2 x = 0 if True else 1 is equvalent to x = True and 0 or 1 or foo = [x for x in xrange(10) if x % 2 == 0] equal tofoo = [] for x in xrange(10): if x % 2 == 0: foo.append(x) dict comprehensions, manual >>> {i: i**2 for i in range(5)} {0: 0, 1: 1, 2: 4, 3: 9, 4: 16} set comprehensions wiki manual >>> {i**2 for i in range(5)} set([0, 1, 4, 16, 9]) list & dics zip a = [(1,2), (3,4), (5,6)] zip(*a) # [(1, 3, 5), (2, 4, 6)] or >>> dict([ ('foo','bar'),('a',1),('b',2) ]) {'a': 1, 'b': 2, 'foo': 'bar'} >>> names = ['Bob', 'Marie', 'Alice'] >>> ages = [23, 27, 36] >>> dict(zip(names, ages)) {'Alice': 36, 'Bob': 23, 'Marie': 27} or >>> t1 = (0,1,2,3) >>> t2 = (7,6,5,4) >>> [t1,t2] == zip(*zip(t1,t2)) True or In [15]: t1 = (1, 2, 3) In [16]: t2 = (4, 5, 6) In [17]: dict (zip(t1,t2)) Out[17]: {1: 4, 2: 5, 3: 6} or >>> l=[(1,2),(3,4)] >>> [a+b for a,b in l ] [3,7] list & sum >>> l = [[1, 2, 3], [4, 5], [6], [7, 8, 9]] >>> sum(l, []) [1, 2, 3, 4, 5, 6, 7, 8, 9] nested list [(i,j) for i in range(3) for j in range(i) ] or((i,j) for i in range(4) for j in range(i) ) enumerate >>> a = ['a', 'b', 'c', 'd', 'e'] >>> for index, item in enumerate(a): print index, item ... 0 a 1 b 2 c 3 d 4 e or>>> l = [\"spam\", \"ham\", \"eggs\"] >>> list(enumerate(l)) >>> [(0, \"spam\"), (1, \"ham\"), (2, \"eggs\")] >>> list(enumerate(l, 1)) >>> [(1, \"spam\"), (2, \"ham\"), (3, \"eggs\")] generate list >>> from functools import partial >>> bound_func = partial(range, 0, 10) >>> bound_func() [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> bound_func(2) [0, 2, 4, 6, 8] dict's constructor >>> dict(foo=1, bar=2) {'foo': 1, 'bar': 2} or>>> a = {} >>> b = a.setdefault('foo', 'bar') >>> a {'foo': 'bar'} >>> b 'bar dict's get t = {1: 'a'} >>> test[2] Traceback (most recent call last): File \"\", line 1, in test[2] KeyError: 2 >>> test.get(2) >>> test.get(1) 'a' >>> test.get(2) == None True >>> test.get(2, 'some') == 'some' True copy list >>> x = [1,2,3] >>> y = x[:] >>> y.pop() 3 >>> y [1, 2] >>> x [1, 2, 3] replace list >>> x = [1,2,3] >>> y = x >>> y[:] = [4,5,6] >>> x [4, 5, 6] generators objects x = [n for n in foo if bar(n)] or >>> n = ((a,b) for a in range(0,2) for b in range(4,6)) >>> for i in n: ... print i (0, 4) (0, 5) (1, 4) (1, 5) generator & iteration iteration & constructor (yield) >>> def g(n): ... for i in range(n): ... yield i **2 >>> t = g(5) >>> t.next() 0 >>> t.next() 1 >>> t.next() 4 >>> t.next() 9 >>> t.next() 16 >>> t.next() Traceback (most recent call last): File \"\", line 1, in StopIteration or def fab(max): a,b = 0,1 while a >> for i in fab(20): ... print i,\",\", ... 0 , 1 , 1 , 2 , 3 , 5 , 8 , 13 , or >>> i = (1,2,3,4,5,6,7,8,9,10) # or any iterable object >>> iterators = [iter(i)] * 2 >>> iterators[0].next() 1 >>> iterators[1].next() 2 >>> iterators[0].next() 3 or def grouper(n, iterable, fillvalue=None): \"grouper(3, 'ABCDEFG', 'x') --> ABC DEF Gxx\" args = [iter(iterable)] * n return izip_longest(fillvalue=fillvalue, *args) or >>> from itertools import * >>> l = [[1, 2], [3, 4]] >>> list(chain(*l)) [1, 2, 3, 4] or def create_printers(n): for i in xrange(n): def printer(i=i): # Doesn't work without the i=i print i yield printer statement for...else... for i in foo: if i == 0: break else: print(\"i was never 0\") orfound = False for i in foo: if i == 0: found = True break if not found: print(\"i was never 0\") context managers and the \"with\" statement from __future__ import with_statement with open('foo.txt', 'w') as f: f.write('hello!') try...except...elese...finally try: put_4000000000_volts_through_it(parrot) except Voom: print \"'E's pining!\" else: print \"This parrot is no more!\" finally: end_sketch() funcs dir >>> dir(\"foo\") ['__add__', '__class__', '__contains__', (snipped a bunch), 'title', 'translate', 'upper', 'zfill'] help >>> help(\"foo\".upper) Help on built-in function upper: upper(...) S.upper() -> string Return a copy of the string S converted to uppercase. convenient web-browser controller >>> import webbrowser >>> webbrowser.open_new_tab('http://www.stackoverflow.com') built-in http server python -m SimpleHTTPServer 8000 an interpreter within the interpreter $ python Python 2.5.1 (r251:54863, Jan 17 2008, 19:35:17) [GCC 4.0.1 (Apple Inc. build 5465)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> shared_var = \"Set in main console\" >>> import code >>> ic = code.InteractiveConsole({ 'shared_var': shared_var }) >>> try: ... ic.interact(\"My custom console banner!\") ... except SystemExit, e: ... print \"Got SystemExit!\" ... My custom console banner! >>> shared_var 'Set in main console' >>> shared_var = \"Set in sub-console\" >>> import sys >>> sys.exit() Got SystemExit! >>> shared_var 'Set in main console' pretty print >>> import pprint >>> stuff = sys.path[:] >>> stuff.insert(0, stuff) >>> pprint.pprint(stuff) [, '', '/usr/local/lib/python1.5', '/usr/local/lib/python1.5/test', '/usr/local/lib/python1.5/sunos5', '/usr/local/lib/python1.5/sharedmodules', '/usr/local/lib/python1.5/tkinter'] or from __future__ import print_function mylist = ['foo', 'bar', 'some other value', 1,2,3,4] print(*mylist) class & module bash python -c\"import os; print(os.getcwd());\" assertion >>> try: ... assert [] ... except AssertionError: ... print \"This list should not be empty\" This list should not be empty import try: import json except ImportError: import simplejson as json create new types >>> NewType = type(\"NewType\", (object,), {\"x\": \"hello\"}) >>> n = NewType() >>> n.x \"hello\" or>>> class NewType(object): >>> x = \"hello\" >>> n = NewType() >>> n.x \"hello\" Manipulating sys.modules >>> import sys >>> import ham Traceback (most recent call last): File \"\", line 1, in ImportError: No module named ham # Make the 'ham' module available -- as a non-module object even! >>> sys.modules['ham'] = 'ham, eggs, saussages and spam.' >>> import ham >>> ham 'ham, eggs, saussages and spam.' # Now remove it again. >>> sys.modules['ham'] = None >>> import ham Traceback (most recent call last): or>>> import os # Stop future imports of 'os'. >>> sys.modules['os'] = None >>> import os Traceback (most recent call last): File \"\", line 1, in ImportError: No module named os # Our old imported module is still available. >>> os Others not hidden but still nice import os.path as op root_dir = op.abspath(op.join(op.dirname(__file__), \"..\")) be careful with mutable default arguments >>> def foo(x=[]): ... x.append(1) ... print x ... >>> foo() [1] >>> foo() [1, 1] >>> foo() [1, 1, 1] or>>> def foo(x=None): ... if x is None: ... x = [] ... x.append(1) ... print x >>> foo() [1] >>> foo() [1] PEP8 -- Style Guide for Python Code Indentation yes: # Aligned with opening delimiter. foo = long_function_name(var_one, var_two, var_three, var_four) # More indentation included to distinguish this from the rest. def long_function_name( var_one, var_two, var_three, var_four): print(var_one) # Hanging indents should add a level. foo = long_function_name( var_one, var_two, var_three, var_four) no: # Arguments on first line forbidden when not using vertical alignment. foo = long_function_name(var_one, var_two, var_three, var_four) # Further indentation required as indentation is not distinguishable. def long_function_name( var_one, var_two, var_three, var_four): print(var_one) optional # Hanging indents *may* be indented to other than 4 spaces. foo = long_function_name( var_one, var_two, var_three, var_four) if statemant # No extra indentation. if (this_is_one_thing and that_is_another_thing): do_something() # Add a comment, which will provide some distinction in editors # supporting syntax highlighting. if (this_is_one_thing and that_is_another_thing): # Since both conditions are true, we can frobnicate. do_something() # Add some extra indentation on the conditional continuation line. if (this_is_one_thing and that_is_another_thing): do_something()o list my_list = [ 1, 2, 3, 4, 5, 6, ] result = some_function_that_takes_arguments( 'a', 'b', 'c', 'd', 'e', 'f', ) ormy_list = [ 1, 2, 3, 4, 5, 6, ] result = some_function_that_takes_arguments( 'a', 'b', 'c', 'd', 'e', 'f', ) Maximum Line Length yes:with open('/path/to/some/file/you/want/to/read') as file_1, \\ open('/path/to/some/file/being/written', 'w') as file_2: file_2.write(file_1.read()) Should a Line break before or after a binary operator? no: operators sit far away from their operands income = (gross_wages + taxable_interest + (dividends - qualified_dividends) - ira_deduction - student_loan_interest) yes: easy to match operators with operands income = (gross_wages + taxable_interest + (dividends - qualified_dividends) - ira_deduction - student_loan_interest) imports no: import sys, os yes: import os import sys bad: import from * absolute imports are recommended import mypkg.sibling from mypkg import silbing from mypkg.sibling import example explicit relative imports are acceptable from . import sibling from .sibling import example import a class from a class-containing module from myclass import MyClass from foo.bar.yourclass import YourClass local name classes import myclass import foo.bar.yourclass # use \"myclass.MyClass\" or \"foo.bar.yourclass.YourClass\" module Level dunder names Module level \"dunder\" names with two leading and two trailing underscores, such as __all__, __author__, __version__, etc yes: \"\"\"This is the example module. This module does stuff. \"\"\" from __future__ import barry_as_FLUFL __all__ = ['a', 'b', 'c'] __version__ = '0.1' __author__ = 'Cardinal Biggles' import os import sys whitespace in expressions and statements no: spam( ham[ 1 ], { eggs: 2 } ) yes: spam(ham[1], {eggs: 2}) no: if x == 4 : print x , y ; x , y = y , x yes: if x == 4; print x, y; x, y = y, x no: ham[lower + offset:upper + offset] ham[1: 9], ham[1 :9], ham[1:9 :3] ham[lower : : upper] ham[ : upper ] yes: ham[1:9], ham[1:9:3], ham[:9:3], ham[1::3], ham[1:9:] ham[lower:upper], ham[lowser:pper:], ham[lower::step] ham[lower+offset : upper+offset] ham[: upper_fn(x) : setp_fn(x)], ham[:: setp_fn(x)] ham[lower + offset : upper + offset] no: spam (1) yes: spam(1) no: dct ['key'] = lst [index] yes: dct['key'] = lst[index] no: x = 1 y = 2 long_variable = 3 yes: x = 1 y = 2 long_variable = 3 other recommendations no: i=i+1 submitted +=1 x = x * 2 - 1 hypot2 = x * x + y * y c = (a + b) * (a - b) yes: i = i + 1 submitted += 1 x = x*2 - 1 hypot2 = x*x + y*y c = (a+b) * (a-b) no: def complex(real, imag = 0.0): return magic(r = real, i = imag) yes: def complex(real, imag=0.0): return magic(r=real, i=imag) no: def munge(input:AnyStr): ... def munge()->PosInt: ... yes: def munge(input: AnyStr): ... def munge() -> AnyStr: ... no: def munge(input: AnyStr=None): ... def munge(input: AnyStr, limit = 1000): ... yes: def munge(sep: AnyStr = None): ... def munge(input: AnyStr, sep: AnyStr = None, limit=1000): ... rather NO if foo == 'blah': do_blah_thing() do_one(); do_two(); do_three() yes:if foo == 'blah': do_blah_thing() do_one() do_two() do_three() DEFINITELY NO if foo == 'blah': do_blah_thing() else: do_non_blah_thing() try: something() finally: cleanup() do_one(); do_two(); do_three(long, argument, list, like, this) if foo == 'blah': one(); two(); three() yes:if foo == 'blah': do_blah_thing() for x in lst: total += x while t documentation strings yes: \"\"\"Return a foobang Optional plotz says to frobnicate the bizbaz first. \"\"\" Programming Recommendations no: if not foo is None: yes: if foo is not None: no: f = lambda x: 2*x yes: def f(x): return 2*x no: try: # Too broad! return handle_value(collection[key]) expect KeyError: # Will also catch KeyError raised by handle_value() return key_not_found(key) yes: try: value = collection[key] except KeyError: return key_not_found(key) else: return handle_value(value) no: with conn: do_stuff_in_transaction(conn) yes: with conn.begin_transaction(): do_stuff_in_transaction(conn) no: def foo(x): fi x >= 0: return math.sqrt(x) def bar(x): if x yes: def foo(x): if x >= 0: return math.sqrt(x) else: return None def bar(x): if x no: if foo[:3] == 'bar': yes: if foo.startwith('bar'): no: if type(obj) is type(1): yes: if isinstance(obj, int): no: if len(seq): if not len(seq): yes: if not seq: if seq: no: if greeting == True: yes: if greeting: worse: if greeting is True: PEP8 Error/Warning Code E1 Indentation E101 indentation contains mixed spaces and tabs E111 indentation is not a multiple of four E112 expected an indented block E113 unexpected indentation E114 indentation is not a multiple of four (comment) E115 expected an indented block (comment) E116 unexpected indentation (comment) E121 (*^) continuation line under-indented for hanging indent E122 (^) continuation line missing indentation or outdented E123 (*) closing bracket does not match indentation of opening bracket’s line E124 (^) closing bracket does not match visual indentation E125 (^) continuation line with same indent as next logical line E126 (*^) continuation line over-indented for hanging indent E127 (^) continuation line over-indented for visual indent E128 (^) continuation line under-indented for visual indent E129 (^) visually indented line with same indent as next logical line E131 (^) continuation line unaligned for hanging indent E133 (*) closing bracket is missing indentation E2 Whitespace E201 whitespace after ‘(‘ E202 whitespace before ‘)’ E203 whitespace before ‘:’ E211 whitespace before ‘(‘ E221 multiple spaces before operator E222 multiple spaces after operator E223 tab before operator E224 tab after operator E225 missing whitespace around operator E226 (*) missing whitespace around arithmetic operator E227 missing whitespace around bitwise or shift operator E228 missing whitespace around modulo operator E231 missing whitespace after ‘,’, ‘;’, or ‘:’ E241 (*) multiple spaces after ‘,’ E242 (*) tab after ‘,’ E251 unexpected spaces around keyword / parameter equals E261 at least two spaces before inline comment E262 inline comment should start with ‘# ‘ E265 block comment should start with ‘# ‘ E266 too many leading ‘#’ for block comment E271 multiple spaces after keyword E272 multiple spaces before keyword E273 tab after keyword E274 tab before keyword E3 Blank line E301 expected 1 blank line, found 0 E302 expected 2 blank lines, found 0 E303 too many blank lines (3) E304 blank lines found after function decorator E4 Import E401 multiple imports on one line E402 module level import not at top of file E5 Line length E501 (^) line too long (82 > 79 characters) E502 the backslash is redundant between brackets E7 Statement E701 multiple statements on one line (colon) E702 multiple statements on one line (semicolon) E703 statement ends with a semicolon E704 (*) multiple statements on one line (def) E711 (^) comparison to None should be ‘if cond is None:’ E712 (^) comparison to True should be ‘if cond is True:’ or ‘if cond:’ E713 test for membership should be ‘not in’ E714 test for object identity should be ‘is not’ E721 (^) do not compare types, use ‘isinstance()’ E731 do not assign a lambda expression, use a def E9 Runtime E901 SyntaxError or IndentationError E902 IOError W1 Indentation warning W191 indentation contains tabs W2 Whitespace warning W291 trailing whitespace W292 no newline at end of file W293 blank line contains whitespace W3 Blank line warning W391 blank line at end of file W5 Line break warning W503 line break occurred before a binary operator W6 Deprecation warning W601 .has_key() is deprecated, use ‘in’ W602 deprecated form of raising exception W603 ‘<>’ is deprecated, use ‘!=’ W604 backticks are deprecated, use ‘repr()’ Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:26 "},"programming/groovy/groovy.html":{"url":"programming/groovy/groovy.html","title":"groovy","keywords":"","body":" Table of Contents generated with DocToc basic Program structure Customizable Operators Special Operators string substring list filter a list filter in list via additional conditions return result instead of original list a list contains a sublist or not pickup item in list random replace item in list according reference Map 2D matrix conversion print 2D matrix Map change Map in condition filter via condition find a string in a nested Map by using recursive function find a string exists in a list of Map elvis operator if/elseif{if}/else execute shell commands in groovy Get STDERR & STDERR Show output during the process with environment Closures Closure VS. Method break from closure Curry Memoization composition Methods tricky reference: Groovy Cheatsheet online compiler http://www.cheat-sheets.org/saved-copy/rc015-groovy_online.pdf basic Program structure Customizable Operators Operator Method a + b a.plus(b) a - b a.minus(b) a * b a.multiply(b) a / b a.div(b) a % b a.mod(b) a++ or ++a a.next() assert [ a: true, b: false ] + [ a: false ] == [ a: false, b: false ] assert [ a: true, b: false ] difference +(plus) and (left shift) : is to add into left hand map + it constructs a new Map based on the LHS` Special Operators Operator Meaning Name a ? b : c if(a) b else c ternary if a ?: b a ? a : b Elvis a.?b ( a==null ) ? a : a.b null safe a(*list) a(list[0], list[1], ...) spread list*.a() [list[0].a, list[1].a, ...] spread-out a.&b reference to method b in object a as closure method closure a.@field direct field access dot-at .& : Method pointer operator def str = 'example of method reference' def fun = str.&toUpperCase assert fun() == str.toUpperCase() println fun() // result EXAMPLE OF METHOD REFERENCE class Person { String name Integer age } def list = [ new Person( name: 'Bob' , age: 42 ) , new Person( name: 'Julia' , age: 35 ) ] String describe(Person p) { \"$p.name is $p.age\" } def action = this.&describe def transform( List elements, Closure action ) { elements.inject([]){ result, e -> result string substring remove the last x chars def removeSuffix( String str ) { removeSuffix( str, 1 ) } /** * remove the last char of {@code str} * @param str the string will be removal the last char * @param c remove last {@code c} numbers chars **/ def removeSuffix( String str, int c ) { str.reverse().drop(c).reverse() } add char(s) in the end of string str.concat('substr') list filter a list [ 'baz1', 'baz2', 'baz3', 'abz1', 'zba2', 'bza3' ].findAll { it.contains 'baz' } ===> [baz1, baz2, baz3] or[['r':3],['r':5],['r':6],['r':11],['r':10]].findAll { (1..10).contains(it.r) } ===> [[r:3], [r:5], [r:6], [r:10]] filter in list via additional conditions [ [ id : 1 , age : 1 , weight : 25 ] , [ id : 2 , age : 2 , weight : 20 ] , [ id : 3 , age : 3 , weight : 25 ] ].findAll { it.age in [ 2, 3 ] || it.weight in [ 20, 25 ] }.id ===> [1,2,3] return result instead of original list [1, 2, 3, 4].findResults { ( it % 2 == 0 ) ? it / 2 : null } ===> [1, 2] ~> [2/2, 4/2] [1, 2, 3, 4].findAll { ( it % 2 == 0 ) ? it / 2 : null } ===> [2, 4] a list contains a sublist or not List parent = [ '1', '2', '3', 'a', 'b' ] List sub = [ 'a', '3' ] sub.every{ parent.contains(it) } or containsAll List parent = [ '1', '2', '3', 'a', 'b' ] List sub = [ 'a', '3' ] parent.containsAll(sub) ignore case sub.every{ parent.collect{ it.toLowerCase() }.contains( it.toLowerCase() ) } pickup item in list random Collections.shuffle List list = [ '1', '2', '3', 'a', 'b' ] Collections.shuffle( list ) println list println parent.first() // result // [2, b, 3, 1, a] // 2 Random().nextInt List list = [ '1', '2', '3', 'a', 'b' ] Random random = new Random() println list.get(random.nextInt(list.size())) println list.get(random.nextInt(list.size())) // result // 1 // b replace item in list according reference Map Map reference = [ '1' : 'apple' , '2' : 'banana' , '3' : 'pears' , '4' : 'peach' ] 'I want 1 she wants 4'.tokenize(' ') .collect { references.get(it) ?: it } .join(' ') // result: I want apple she wants peach or keeping the String format reference for replaceAll(\"\", \"$0\") 'I like 1, she likes 3.' .replaceAll(\"[^\\\\w]\", \"_\\$0\") .split('_') .collect { String c = it.trim() reference.get(c) ? it.replace(c, reference.get(c)) : it } .join() // result: I like apple, she likes pears. remove all punctuation from a String : 'I like 1,_,--__,,___ she liks 2,,...' .replaceAll(\"[^\\\\w\\\\s]|_\", '') // .replaceAll(\"\\\\s+\", ' ') // structure space if necessary ===> I like 1 she liks 2 // ===> I like 1 she liks 2 or keep only comma (and merge more if mutiple comma)'I like 1,----,,|\\\\/, she liks 2,,...' .replaceAll(\"[^\\\\w\\\\s,]|_\", '') .replaceAll(',+', ',') ===> I like 1, she liks 2, 2D matrix conversion Objective : rows and columns conversion in 2D matrix Map> original matrix: [ 'foo' : [ 'a', 'b', 'c', 'd' ] , 'bar' : [ 'b', 'c', 'x', 'y' ] , 'baz' : [ 'd', 'x', 'y', 'z' ] ] after conversion: [ 'a' : [ 'foo' ] , 'b' : [ 'bar' , 'foo' ] , 'c' : [ 'bar' , 'foo' ] , 'd' : [ 'baz' , 'foo' ] , 'x' : [ 'bar' , 'baz' ] , 'y' : [ 'bar' , 'baz' ] , 'z' : [ 'baz' ] ] Inspired from sboardwell/matrix-based-auth.groovy Map> after = [:].withDefault { [].toSet() } Map> matrix = [ 'foo' : [ 'a', 'b', 'c', 'd' ] , 'bar' : [ 'b', 'c', 'x', 'y' ] , 'baz' : [ 'd', 'x', 'y', 'z' ] ] Closure converter = { Map result, Map original -> original.each { k, v -> result[k] += v } } matrix.collect{ k, v -> v.collect{ [ (it) : k ] } } .flatten() .each converter.curry(after) after print 2D matrix (1..255).collect { color -> \" █${color}█ \" }.eachWithIndex{ c, idx -> print c if ( 4 == (idx+1)%6 ) { println '' } } Map change Map in condition [ 'a': 1, 'b': 2, 'c': 3 ].collectEntries { ( it.value > 1 ) ? [ \"${it.key}\" : 4 ] : it } ===> [a:1, b:4, c:4] or [ it.key, 4 ][ 'a': 1, 'b': 2, 'c': 3 ].collectEntries { ( it.value > 1 ) ? [ it.key, 4 ] : it } or [ (it.key) : 4 ][ 'a': 1, 'b': 2, 'c': 3 ].collectEntries { ( it.value > 1 ) ? [ (it.key) : 4 ] : it } filter via condition [ 'a': 1, 'b': 2, 'c': 3 ].findAll{ it.value > 1 }.collectEntries { [ it.key, 4 ] } ===> [b:4, c:4] find a string in a nested Map by using recursive function def hasValue( Map m, String value ) { m.containsValue(value) || m.values().find { v -> v instanceof Map && hasValue(v, value) } } another version inspired by stackoverflow: How to search value by key from Map as well as Nested Map def hasValue( Map m, String value ) { if ( m.containsValue(value) ) return m.containsValue(value) m.findResult { k, v -> v instanceof Map ? hasValue(v, value) : null } } find a string exists in a list of Map def isTargetExists( Map m, String subKey, String value ) { def map = m.findAll { it.value instanceof Map }.collect { it.key } return m.subMap(map).any { k, v -> v.get(subKey, []).contains(value) } } Map> matrix = [ dev : [ user: ['dev1', 'dev2', 'dev3'] , passwd: '123456', customer: ['yahoo', 'bing'] ] , staging : [ user: ['stg1', 'stg2', 'stg3'] , passwd: 'abcdefg' , customer: ['google', 'huawei'] ] , prod : [ user: ['prod1', 'prod2', 'prod3'] , passwd: 'a1b2c3d4' ] ] assert isTargetExists( matrix, 'user', 'dev4' ) == false assert isTargetExists( matrix, 'customer', 'huawei' ) == true elvis operator if/elseif{if}/else condition: if fruits is 'apple' or 'orange', get pre-defined number 5 ( number = 5 ) if fruits is watermelon, get particular given numbers. number cannot be null // by using if/elseif{if}/else Map option = [:] if ( [ 'apple', 'orange' ].contains(fruits) ) { option = [ \"${fruits}\" : '5' ] } else if ( [ 'watermelon' ].contains(fruits) ) { if (number) { option = [ \"${fruits}\" : number ] } } else { println( 'ERROR: number CANNOT be empty while fruits is watermelon. Exit ...' ) } // by using elvis operator Map option = ( [ 'apple', 'orange' ].contains(fruits) ) ? [ \"${fruits}\" : '5' ] : ( [ 'watermelon' ].contains(fruits) ) ? ( number ) ? [ \"${fruits}\" : number ] : println( 'ERROR: number CANNOT be empty while fruits is watermelon. Exit ...' ) : [:] example Closure option = { String fruits, String number = '' -> ( [ 'apple', 'orange' ].contains(fruits) ) ? [ (fruits) : '5' ] : ( [ 'watermelon' ].contains(fruits) ) ? ( number ) ? [ (fruits) : number ] : println( 'ERROR: number CANNOT be empty while fruits is watermelon. Exit ...' ) : [:] } assert option('apple') == ['apple' : '5'] assert option('watermelon', '100') == [ 'watermelon' : '100' ] using [ \"${fruits}\" : '5' ], the class of key is class org.codehaus.groovy.runtime.GStringImpl using [ (fruits) : '5' ] , the class of key is class java.lang.String execute shell commands in groovy reference 101 groovy script - Execute commands Jenkins Groovy script to execute shell commands java.lang.Process Get STDERR & STDERR using new StringBuffer() or new StringBuilder() i.e.: def stdout = new StringBuffer(), stderr = new StringBuffer() def proc = \"cmd\".execute() proc.waitForProcessOutput( stdout, stderr ) int exitCode = proc.exitValue() println( (exitCode == 0) ? stdout : \"exit with ${exitCode}. error: ${stderr}\" ) def stdout = new StringBuilder(), stderr = new StringBuilder() def proc = \"ls /tmp/NoFile\".execute() proc.consumeProcessOutput( stdout, stderr ) proc.waitForOrKill( 1000 ) int exitCode = proc.exitValue() println( ( exitCode == 0 ) ? stdout : \"error with exit code ${exitCode}.\\nSTDERR: ${stderr}\" ) or def stdout = new StringBuilder(), stderr = new StringBuilder() def proc = 'ls /tmp/NoFile'.execute() proc.consumeProcesstdoutput( stdout, stderr ) proc.waitForOrKill(1000) println( stdout ? \"out> \\n${stdout}\" : '' + stderr ? \"err> \\n${stderr}\" : '' ) Show output during the process using System.out and System.err def proc = \"ls /tmp/NoFile\".execute() proc.waitForProcessOutput( System.out, System.err ) proc.waitForOrKill(1000) int exitCode = proc.exitValue() if ( exitCode != 0 ) { println \"error with exit code ${exitCode}.\" } with environment def envVars = [\"GROOVY_HOME=/fake/path/groovy-3.0.7\", \"CLASSPATH=.:/fake/path/groovy-3.0.7/lib\"] def proc = './run.sh'.execute( envVars, new File(\".\") ) proc.waitForProcessOutput( System.out, System.err ) int exitCode = proc.exitValue() println( (exitCode != 0) ? \"exit with ${exitCode}\" : '' ) run.sh env echo ${GROOVY_HOME} result with system environment List envVars = System.getenv().collect { k, v -> \"${k}=${v}\" } def proc = \"./run.sh\".execute( envVars, new File(\".\") ) proc.waitForProcessOutput( System.out, System.err ) int exitCode = proc.exitValue() println( (exitCode != 0) ? \"exit with ${exitCode}\" : '' ) with partular path reference: groovy execute shell with environment and working dir def command = \"git log -1\" def proc = command.execute( null, new File('/path/to/folder') ) proc.waitFor() println \"\"\" ${proc.err.text ?: ''} ${proc.in.text ?: ''} Process exit code: ${proc.exitValue()} \"\"\" Closures references: Closures Closures in Groovy Groovy Goodness: Passing Closures to Methods Groovy Goodness: Closure Arguments Groovy Goodness: Identity Closure 实战 Groovy: 用 curry 过的闭包进行函数式编程 A closure definition follows this syntax: { [closureParameters -> ] statements } closure.call() Closure clos = { println \"Hello World\" } assert clos.call() == clos() | + implicit call + explicit call Closure VS. Method closures have benefits over regular methods and are a powerful feature of Groovy: We can pass a Closure as an argument to a method Unary closures can use the implicit it parameter We can assign a Closure to a variable and execute it later, either as a method or with call Groovy determines the return type of the closures at runtime We can declare and invoke closures inside a closure Closures always return a value method def formatToLowerCase( String name ) { name.toLowerCase() } closure def formatToLowerCaseClosure = { name -> name.toLowerCase() } break from closure tips: return means continue return true means break the loop def list = [1, 2, 3, 4, 5] list.any { element -> if (element == 2) return // continue println element if (element == 3) return true // break } Curry left curry def multiply = { x, y -> return x * y } def triple = multiply.curry(3) // triple = { y -> return 3 * y } example def nCopies = { int n, String... str -> str.join('')*n } def twice = nCopies.curry(2) println twice('|', '\\\\', '|', '/' ) assert twice('|', '\\\\', '|', '/' ) == nCopies( 2, '|', '\\\\', '|', '/' ) result|\\|/|\\|/ others left curry def multiConcat = { int n, String... args -> args.join('')*n } multiConcat( 3, '*', '-', '=' ) result*-=*-=*-= right curry def nCopies = { int n, String str -> str*n } def twice = nCopies.rcurry( '*-=*=-*' ) println twice(2) assert twice(2) == nCopies( 2, '*-=*=-*' ) result*-=*=-**-=*=-* def nCopies = { int n, String str -> str*n } def twice = nCopies.rcurry( '*-=*=-*' ) def divider = nCopies.curry( 2 ) assert nCopies( 2, '*-=*=-*' ) == twice( 2 ) // right curry assert nCopies( 2, '-.-.-.-' ) == divider( '-.-.-.-' ) // left curry index with currydef volume = { int l, int w, int h -> \"l: ${l}\\nw: ${w}\\nh: ${h}\" } def fixedWidthVolume = volume.ncurry(1, 2) println fixedWidthVolume( 3, 4 ) resultl: 3 w: 2 h: 4 Memoization Fibonacci suite : fib(15) == fib(14) + fib(13) fib(14) == fib(13) + fib(12) slow def fib fib = { long n -> n fast tips: Closures.memoize() def fib fib = { long n -> n composition double composition def plus2 = { it + 2 } def times3 = { it * 3 } def times3plus2 = plus2 > times3 // | + execute last // + execute first // result assert plus2times3(3) == (3+2)*3 assert plus2times3(3) == times3(plus2(3)) assert ( plus2 > plus2 )(3) | + execute first | + execute last + execute last + execute first example for recursive in List def map1 = [a: 10, b:2, c:3] def map2 = [b:3, c:2, d:5] def maps = [map1, map2] def process(def maps, Closure myLambda) { maps.sum { it.keySet() }.collectEntries { key -> [ key, { x -> x.subList(1, x.size()).inject(x[0], myLambda) }(maps.findResults { it[key] }) ] } } def sumResult = process(maps) { a, b -> a + b } def prodResult = process(maps) { a, b -> a * b } def minResult = process(maps) { a, b -> a Resolutionassert [2,4,5].inject(1){ a, b -> a + b } == 12 assert [2,4,5].inject(1, { a, b -> a + b }) == 12 triple composition def multiply = { x, y -> return x * y } def triple = multiply.curry(3) def quadruple = multiply.curry(4) def composition = { f, g, x -> return f(g(x)) } def twelveTimes = composition.curry(triple, quadruple) // twelveTimes = { y -> composition { y -> 3*(4*y) } } def threeDozen = twelveTimes(3) Methods various method to call closure def work( String input, Closure cl ) { cl(input) } Closure assertJava = { it == 'Java' } println work( \"Java\", assertJava ) println work(\"Java\", { it == 'Java' }) // ==> work 'Java', { it == 'Java' } println work( 'Java' ){ it == 'Java' } frequent usage def on( String name, String dString = 'is' ) { [ skip: { -> println \"no params. skip\" }, foo: { String f, Map fmap -> foo( name, dString, f, fmap ) [ bar: { Map map -> bar( '', map ) } ] } , bar: { Map map -> bar( name, map ) } ] } def reset( Map m ) { m.collect{ k, v -> \"${k} : ${v}\" }.join('\\n') } def foo( String n, String ds, String f, Map m ) { println \"${n} ${ds} ${f} !\\ndetails :\\n\\t\\t${reset(m)}\" } def bar( String n = '', Map m ) { println \"${n ? \"${n}\\n\": ''}\\t\\t${reset(m)}\" } result on('marslo') .foo( 'awesome', [ 'age' : 34 ] ) .bar( ['gender' : 'female' ] ) // result marslo is awesome ! details : age : 34 gender : female or on('marslo') .skip() // result no params. skip tricky this class Enclosing { void run() { def whatIsThisObject = { getThisObject() } assert whatIsThisObject() == this def whatIsThis = { this } assert whatIsThis() == this } } Enclosing e = new Enclosing() e.run() Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:28 "},"programming/groovy/groovydoc.html":{"url":"programming/groovy/groovydoc.html","title":"groovydoc","keywords":"","body":" Table of Contents generated with DocToc Generate Groovy API doc from command line Generate Groovy API doc from command line credit belongs to HOW-TO Documenting Groovy with Groovydoc $ groovydoc -classpath /usr/local/Cellar/groovy/3.0.1/libexec/lib/ \\ -d output \\ -windowtitle \"Groovy Logging Example\" \\ -header \"Groovy 1.8 Logging (Inspired by Actual Events)\" \\ -footer \"Inspired by Actual Events: Logging in Groovy 1.8\" \\ -doctitle \"Logging in Groovy 1.8 Demonstrated\" \\ *.groovy *.java Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:28 "},"programming/groovy/map.html":{"url":"programming/groovy/map.html","title":"map","keywords":"","body":" Table of Contents generated with DocToc merge two maps map withDefault get key or value from nested Map findResult & findResults inject collect & collectMany collectEntries grep traverse refenrece: Groovy Cookbook Groovy Cookbook: How to merge two maps in Groovy? merge two maps for > Closure merger = { Map newMap, Map currentMap -> currentMap.inject(newMap.clone()) { merged, entry -> merged[entry.key] = merged.getOrDefault( entry.key, [] ) + entry.value merged } } for >> def m1 = [ k1: [ l1: ['s1', 's2']]] def m2 = [ k1: [ l1: ['s3', 's4']], k2: [ l2: ['x1', 'x2']] ] def accumulator = [:].withDefault{ [:].withDefault{ [] } } Closure merger merger = { Map trg, Map m -> m.each{ k, v -> switch( v instanceof java.util.LinkedHashMap ){ case true : merger trg[ k ], v ; break ; case false : trg[ k ].addAll v ; break ; } } } [ m1, m2 ].each merger.curry( accumulator ) assert accumulator == [k1:[l1:['s1', 's2', 's3', 's4']], k2:[l2:['x1', 'x2']]] merge and sum preconditions: Map m1 = [ a : 10, b : 2, c : 3 ] Map m2 = [ b : 3, c : 2, d : 5 ] List> maps = [ m1, m2 ] merge values into list maps.sum { it.keySet() }.collectEntries { key -> [key, maps.findResults { it[key] } ] } // result // [a:[10], b:[2, 3], c:[3, 2], d:[5]] sum lists def process( List maps ) { maps.sum { it.keySet() }.collectEntries { key -> [ key, maps.findResults { it[key] }.sum() ] } } or more elegant way via Clousre: Closure getSum = { x -> x.sum() } getSum( [1,2,3,4] ) == 10 def process( List maps ) { Closure getSum = { x -> x.sum() } maps.sum { it.keySet() }.collectEntries { key -> [ key, getSum(maps.findResults { it[key] }) ] } } which can be extended to: def process( List maps, Closure closure ) { maps.sum { it.keySet() }.collectEntries { key -> [ key, closure(maps.findResults { it[key] }) ] } } // merge maps and get sum process(maps){ x -> x.sum() } // [a:10, b:5, c:5, d:5] // merge maps and get product process(maps){ x -> x.inject(1) { sum, n -> sum * n } // [a:10, b:6, c:6, d:5] // merge maps and get the biggest item process(maps){ x -> x.inject(x[0]) { biggest, n -> biggest > n ? biggest : n } } // [a:10, b:3, c:3, d:5] map withDefault Objective: [a:1,b:2,c:2] ⇣⇣ [1:['a'], 2:['b','c']] def newMap = [:].withDefault { [] } [a:1,b:2,c:2].each { key, val -> newMap[val] alternative [a:1, b:2, c:2].inject([:].withDefault{[]}) { map, k, v -> map[v] alternatives [a:1,b:2,c:2].groupBy{ it.value }.collectEntries{ k, v -> [(k): v.collect{ it.key }] } /* Result: [1:[a], 2:[b, c]] */ merge maps Map map1 = [x: 1, y: 2] Map map2 = [z: 3] Map merged = map1.withDefault(map2.&get) assert map1 == merged // quit interesting assert 3 == merged.get('z') get key or value from nested Map insprired from : How to find a map key by value of nested map in Groovy Objective: Map> map = [ k1 : [k11 : 'v11'] , k2 : [k11 : 'v21'] , k3 : [k11 : 'v31'] ] ⇣⇣ findKeyBelongsTo( 'k11' ) » 'k1' findValueBelongsTo( 'v31' ) » 'k3' find parent key via sub-key: try online def findKeyBelongsTo( Map map, String keyword ) { map.find { keyword in it.value.keySet() }?.key } find in nested map recursively (according to key):def findKeyBelongsTo( Map map, String keyword ) { map.findResult { k, v -> v instanceof Map ? v.containsKey(keyword) ? k : findKeyBelongsTo( v, keyword ) : null } } find parent key via sub-value: try online def findValueBelongsTo( Map map, String keyword ) { map.find { keyword in it.value.values() }?.key } find in nested map recursively (according to value):def findValueBelongsTo( Map map, String keyword ) { map.findResult { k, v -> v instanceof Map ? v.containsValue(keyword) ? k : findValueBelongsTo( v, keyword ) : null } } findResult & findResults reference: FindResults and FindResult Methods of Groovy find deep in nested map collect: return all result (with null)groovy:000> [a: 1, b: 2, c: 3, d: 4].collect{ k, v -> v>2 ? (k + '->' + v) : null } ===> [null, null, c->3, d->4] findResult: return the first eligible value (first non-null element) groovy:000> [a: 1, b: 2, c: 3, d: 4].findResult{ k, v -> v>2 ? (k + '->' + v) : null } ===> c->3 findResults: find all eligible values (all non-null elements) groovy:000> [a: 1, b: 2, c: 3, d: 4].findResults{ k, v -> v>2 ? (k + '->' + v) : null } ===> [c->3, d->4] find deep in nested map Example Map structure: Map map = [ 'a': [ 'b': [ 'c': [ 'd' : '1', 'e' : '2', 'f' : '3' ], // c 'g': '4', 'h': [ 'i': '5', 'j': '6', 'k': '7' ] // h ], // b 'l': [ 'm': '8', 'n': '9' ], // l 'o': '10' ] // a ] find value via key name recursively try online def findValues( Map map, String keyword ) { map.findResult { k, v -> v instanceof Map ? v.containsKey(keyword) ? v.getOrDefault(keyword, null) : findValues( v, keyword ) : null } } alternatives def findValues( Map map, String keyword ) { if( map.containsKey(keyword) ) return map.getOrDefault( keyword, null ) map.findResult { k, v -> v instanceof Map ? findValues(v, keyword) : null } } result println \"~~> findValues( map, 'f' ) : ${findValues( map, 'f' )} \" println \"~~> findValues( map, 'o' ) : ${findValues( map, 'o' )} \" println \"~~> findValues( map, 'aaaa' ) : ${findValues( map, 'aaaa' )} \" /** * console output * ~~> findValues( m, 'f' ) : 3 * ~~> findValues( m, 'o' ) : 10 * ~~> findValues( m, 'aaaa' ) : null **/ alternatives try online def hasValues(Map m, String key) { m.containsKey(key) || m.find { k, v -> v instanceof Map && hasValues(v, key) } } result println \"~~> hasValues( map, 'f' ) : ${hasValues( map, 'f' )} \" println \"~~> hasValues( map, 'o' ) : ${hasValues( map, 'o' )} \" println \"~~> hasValues( map, 'aaaa' ) : ${hasValues( map, 'aaaa' )} \" /** * console output * ~~> hasValues( m, 'f' ) : true * ~~> hasValues( m, 'o' ) : true * ~~> hasValues( m, 'aaaa' ) : false **/ inject Join Elements to a String def map = [q: 'groovy', maxResult: 10, start: 0, format: 'xml'] def params = map.inject([]) { result, entry -> result collect & collectMany collectEntries grep references: Groovy Goodness: the Grep Method Is there any difference between Groovy's non-argument grep() and findAll() methods? ['test', 12, 20, true].grep(String) alternatives ['test', 12, 20, true].findAll { it.class.simpleName == 'String' } // or ['test', 12, 20, true].findAll { it instanceof String } traverse references: public void traverse(Map, Closure)) Groovy Goodness: Traversing a Directory more complex traversal techniques via traverse method Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:28 "},"programming/groovy/enum.html":{"url":"programming/groovy/enum.html","title":"enum","keywords":"","body":" Table of Contents generated with DocToc check whether if enum contains a given string list all values in Enum Convert String type to Enum give Enums instance variables of their own type in Groovy precondition: enum Choices {a1, a2, b1, b2} check whether if enum contains a given string assert Arrays.asList(Choices.values()).toString().contains(\"a9\") == false assert Arrays.asList(Choices.values()).toString().contains(\"a1\") == true orassert Arrays.stream(Choices.values()).anyMatch((t) -> t.name().equals(\"a1\")) == true orassert Choices.values()*.name().contains('a1') == true assert Choices.values()*.name().contains('a9') == false or public enum Choices { a1, a2, b1, b2; public static boolean contains(String s) { try { Choices.valueOf(s); return true; } catch (Exception e) { return false; } } } Choices.contains('a1') or public enum Choices { a1, a2, b1, b2; public static boolean contains(String str) { return Arrays.asList(Choices.values()).toString().contains(str) } } assert Choices.contains('a1') == true list all values in Enum groovy:000> enum Choices {a1, a2, b1, b2} ===> true groovy:000> println Choices.values() [a1, a2, b1, b2] ===> null orList enumValues = Arrays.asList( Choices.values() ) Convert String type to Enum groovy:000> enum Choices {a1, a2, b1, b2} ===> true groovy:000> Choices.valueOf(\"a1\").getClass() ===> class Choices give Enums instance variables of their own type in Groovy enum Direction { North, South, East, West, Up, Down private Direction opposite Direction getOpposite() { opposite } static { def opposites = { d1, d2 -> d1.opposite = d2; d2.opposite = d1 } opposites(North, South) opposites(East, West) opposites(Up, Down) } } println Direction.South.getOpposite() println Direction.South.opposite Direction.values().each { println \"opposite of $it is $it.opposite\" } resultNorth North opposite of North is South opposite of South is North opposite of East is West opposite of West is East opposite of Up is Down opposite of Down is Up Result: [North, South, East, West, Up, Down] or using the direction indexes on the enum to find the opposites public enum Direction { North(1), South(0), East(3), West(2), Up(5), Down(4) private oppositeIndex Direction getOpposite() { values()[oppositeIndex] } Direction(oppositeIndex) { this.oppositeIndex = oppositeIndex } } println Direction.North.opposite or without the need of an extra field, just using the enum values' ordinal() enum Direction { North, South, East, West, Up, Down Direction getOpposite() { values()[ordinal() + ordinal() % 2 * -2 + 1] } } println Direction.North.getOpposite() Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:28 "},"programming/groovy/utility.html":{"url":"programming/groovy/utility.html","title":"utility","keywords":"","body":" Table of Contents generated with DocToc time get current time convert the Date to simpleDateFormat or timeInMillis Java LocalDateTime with different format formatting the date convert Long to SimpleDateFormat regex Pattern and Matcher matches to regex (return Boolean) get all matches unicode time [!TIP] Java SimpleDateFormat get current time import java.util.Calendar import java.time.LocalDateTime import java.time.LocalDate long curerntTime = System.currentTimeMillis() long newDateTime = new Date().getTime() long calendarTime = Calendar.getInstance().getTimeInMillis() LocalDate dateTag = java.time.LocalDate.now() LocalDateTime dateTime = LocalDateTime.now() println \"\"\" curerntTime : ${curerntTime} newDateTime : ${newDateTime} calendarTime : ${calendarTime} dateTag : ${dateTag} dateTime : ${dateTime} \"\"\" result curerntTime : 1619681910450 newDateTime : 1619681910451 calendarTime : 1619681910451 dateTag : 2021-04-29 dateTime : 2021-04-29T00: 38 :30.452 convert the Date to simpleDateFormat or timeInMillis setup simpleDateFormat to UTC timezone simpleDateFormat.setTimeZone(TimeZone.getTimeZone(\"UTC\")) reference: Java – Get time in milliseconds using Date, Calendar and ZonedDateTime tools: currentDate / Time in Millisecondsmillis current time import java.util.Calendar import java.util.Date import java.text.SimpleDateFormat import java.text.ParseException SimpleDateFormat simpleDateFormat = new SimpleDateFormat( \"yyyy-MM-dd HH:mm:ss\" ) Date date = new Date() Calendar calendar = Calendar.getInstance() def timeInMillis = date.getTime() def calendarMillis = calendar.getTimeInMillis() def simpleDate = simpleDateFormat.format( date ) println \"\"\" date : ${date} simepleDate : ${simpleDate} timeInMillis : ${timeInMillis} calendarMillis : ${calendarMillis} \"\"\" result // default timezoneo date : Thu Apr 29 00:57:03 PDT 2021 simepleDate : 2021-04-29 00:57:03 timeInMillis : 1619683023852 calendarMillis : 1619683023853 // utc timezone date : Thu Apr 29 00:57:27 PDT 2021 simepleDate : 2021-04-29 07:57:27 timeInMillis : 1619683047726 calendarMillis : 1619683047726 particular time i.e.: 2021-04-29 00:00:00 with SimpleDateFormat simpleDateFormat = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\") import java.util.Calendar import java.util.Date import java.text.SimpleDateFormat SimpleDateFormat simpleDateFormat = new SimpleDateFormat( \"yyyy-MM-dd HH:mm:ss\" ) String dateString = \"2021-04-29 00:00:00\" Date date = simpleDateFormat.parse( dateString ) Calendar calendar = Calendar.getInstance() calendar.setTime( date ) String timeInMillis = date.getTime() String calendarMillis = calendar.getTimeInMillis() def simpleDate = simpleDateFormat.format( date ) println \"\"\" date : ${date} simepleDate : ${simpleDate} timeInMillis : ${timeInMillis} calendarMillis : ${calendarMillis} \"\"\" result date : Thu Apr 29 00:00:00 PDT 2021 simepleDate : 2021-04-29 00:00:00 timeInMillis : 1619679600000 calendarMillis : 1619679600000 Java LocalDateTime with different format current LocalDataTime import java.time.LocalDateTime import java.time.format.DateTimeFormatter DateTimeFormatter format = DateTimeFormatter.ofPattern( \"yyyy-MM-dd HH:mm:ss a\" ) LocalDateTime currentDateTime = LocalDateTime.now() String currentNewFormat = currentDateTime.format( format ) println \"\"\" currentDateTime : ${currentDateTime} currentNewFormat : ${currentNewFormat} \"\"\" result currentDateTime : 2021-04-29T01:13:27.291 currentNewFormat : 2021-04-29 01:13:27 AM particular localDateTime import java.time.LocalDateTime import java.time.format.DateTimeFormatter DateTimeFormatter format = DateTimeFormatter.ofPattern( \"yyyy-MM-dd HH:mm:ss a\" ) LocalDateTime currentDateTime = LocalDateTime.now() LocalDateTime localDateTime = LocalDateTime.of( 2021, 04, 29, 00, 00, 00, 0000 ) String currentNewFormat = currentDateTime.format( format ) String localNewFormat = localDateTime.format( format ) println \"\"\" currentDateTime : ${currentDateTime} currentNewFormat : ${currentNewFormat} localDateTime : ${localDateTime} localNewFormat : ${localNewFormat} \"\"\" result currentDateTime : 2021-04-29T01:19:53.928 currentNewFormat : 2021-04-29 01:19:53 AM localDateTime : 2021-04-29T00:00 localNewFormat : 2021-04-29 00:00:00 AM get detail info from localDateTime reference: int getYear() – year int getDayOfYear() – day of year as integer value, from 1 to 365, or 366 in a leap year Month getMonth() – month. int getDayOfMonth() – day of the month as integer value, from1to31` DayOfWeek getDayOfWeek() – day of the week. int getHour() – hour of the day, from0to23` int getMinute() – minute of the hour, from 0 to 59 int getSecond() – second of the minute, from0to59` int getNano() – nanosecond, from 0 to 999,999,999 import java.time.LocalDateTime import java.time.format.DateTimeFormatter DateTimeFormatter format = DateTimeFormatter.ofPattern( \"yyyy-MM-dd HH:mm:ss a\" ) LocalDateTime localDateTime = LocalDateTime.of( 2021, 05, 01, 00, 00, 00, 0000 ) String localNewFormat = localDateTime.format( format ) println \"\"\" localDateTime : ${localDateTime} localNewFormat : ${localNewFormat} getYear : ${localDateTime.getYear()} getDayOfYear : ${localDateTime.getDayOfYear()} getDayOfWeek : ${localDateTime.getDayOfWeek()} getDayOfMonth : ${localDateTime.getDayOfMonth()} getNano : ${localDateTime.getNano()} \"\"\" result localDateTime : 2021-05-01T00:00 localNewFormat : 2021-05-01 00:00:00 AM getYear : 2021 getDayOfYear : 121 getDayOfWeek : SATURDAY getDayOfMonth : 1 getNano : 0 additional plus or minus for localDateTime plus: plusYears() – LocalDateTime with the specified years added plusMonths() – LocalDateTime with the specified months added plusDays() – LocalDateTime with the specified days added plusHours() – LocalDateTime with the specified hours added plusMinutes() – LocalDateTime with the specified minutes added plusSeconds() – LocalDateTime with the specified seconds added plusNanos() – LocalDateTime with the specified nanoseconds added minus: minusYears() – LocalDateTime with the specified years subtracted minusMonths() – LocalDateTime with the specified months subtracted minusDays() – LocalDateTime with the specified days subtracted minusHours() – LocalDateTime with the specified hours subtracted minusMinutes() – LocalDateTime with the specified minutes subtracted minusSeconds() – LocalDateTime with the specified seconds subtracted minusNanos() – LocalDateTime with the specified nanoseconds subtracted import java.time.LocalDateTime LocalDateTime currentDateTime = LocalDateTime.now() println \"\"\" currentDateTime : ${currentDateTime} plusYears(2) : ${currentDateTime.plusYears(2)} plusMinutes(15) : ${currentDateTime.plusMinutes(15)} plusHours(24) : ${currentDateTime.plusHours(24)} minusHours(24) : ${currentDateTime.minusHours(24)} plusDays(365) : ${currentDateTime.minusDays(365)} minusDays(365) : ${currentDateTime.minusDays(365)} plusMonths(12) : ${currentDateTime.plusMonths(12)} minusMonths(12) : ${currentDateTime.minusMonths(12)} result currentDateTime : 2021-04-29T01:41:40.026 plusYears(2) : 2023-04-29T01:41:40.026 plusMinutes(15) : 2021-04-29T01:56:40.026 plusHours(24) : 2021-04-30T01:41:40.026 minusHours(24) : 2021-04-28T01:41:40.026 plusDays(365) : 2020-04-29T01:41:40.026 minusDays(365) : 2020-04-29T01:41:40.026 plusMonths(12) : 2022-04-29T01:41:40.026 minusMonths(12) : 2020-04-29T01:41:40.026 isBefore(), isAfter() and isEqual() import java.time.LocalDateTime LocalDateTime currentDateTime = LocalDateTime.now() LocalDateTime localDataTime = currentDateTime.plusHours(24) println \"\"\" currentDateTime : ${currentDateTime} localDataTime : ${localDataTime} currentDataTime == localDataTime ? : ${currentDateTime.isEqual(localDataTime)} currentDataTime > localDataTime ? : ${currentDateTime.isAfter(localDataTime)} currentDataTime result currentDateTime : 2021-04-29T01:54:07.917 localDataTime : 2021-04-30T01:54:07.917 currentDataTime == localDataTime ? : false currentDataTime > localDataTime ? : false currentDataTime formatting the date reference : Class DateTimeFormatter DateTimeFormatter : BASIC_ISO_DATE : '20110103' ISO_LOCAL_DATE : '2011-12-03' ISO_OFFSET_DATE : '2011-12-03+01:00' ISO_DATE : '2011-12-03+01:00'; '2011-12-03' ISO_LOCAL_TIME : '10:15:30' ISO_OFFSET_TIME : '10:15:30+01:00' ISO_TIME : '10:15:30+01:00'; '10:15:30' ISO_LOCAL_DATE_TIME : '2011-12-03T10:15:30' ISO_OFFSET_DATE_TIME : '2011-12-03T10:15:30+01:00' ISO_ZONED_DATE_TIME : '2011-12-03T10:15:30+01:00[Europe/Paris]' ISO_DATE_TIME : '2011-12-03T10:15:30+01:00[Europe/Paris]' ISO_ORDINAL_DATE : '2012-337' ISO_WEEK_DATE : '2012-W48-6 ISO_INSTANT : '2011-12-03T10:15:30Z' RFC_1123_DATE_TIME : 'Tue, 3 Jun 2008 11:05:30 GMT' Patterns for Formatting and Parsing : Symbol Meaning Presentation Examples G era text AD; Anno Domini; A u year year 2004; 04 y year-of-era year 2004; 04 D day-of-year number 189 M/L month-of-year number/text 7; 07; Jul; July; J d day-of-month number 10 Q/q quarter-of-year number/text 3; 03; Q3; 3rd quarter Y week-based-year year 1996; 96 w week-of-week-based-year number 27 W week-of-month number 4 E day-of-week text Tue; Tuesday; T e/c localized day-of-week number/text 2; 02; Tue; Tuesday; T F week-of-month number 3 a am-pm-of-day text PM h clock-hour-of-am-pm (1-12) number 12 K hour-of-am-pm (0-11) number 0 k clock-hour-of-am-pm (1-24) number 0 H hour-of-day (0-23) number 0 m minute-of-hour number 30 s second-of-minute number 55 S fraction-of-second fraction 978 A milli-of-day number 1234 n nano-of-second number 987654321 N nano-of-day number 1234000000 V time-zone ID zone-id America/Los_Angeles; Z; -08:30 z time-zone name zone-name Pacific Standard Time; PST O localized zone-offset offset-O GMT+8; GMT+08:00; UTC-08:00; X zone-offset 'Z' for zero offset-X Z; -08; -0830; -08:30; -083015; -08:30:15; x zone-offset offset-x +0000; -08; -0830; -08:30; -083015; -08:30:15; Z zone-offset offset-Z +0000; -0800; -08:00; p pad next pad modifier 1 ' escape for text delimiter '' single quote literal ' [ optional section start ] optional section end # reserved for future use { reserved for future use } reserved for future use import java.time.LocalDateTime import java.time.format.DateTimeFormatter LocalDateTime currentDateTime = LocalDateTime.now() DateTimeFormatter basicISODate = DateTimeFormatter.BASIC_ISO_DATE DateTimeFormatter isoLocalDate = DateTimeFormatter.ISO_LOCAL_DATE DateTimeFormatter isoLocalTime = DateTimeFormatter.ISO_LOCAL_TIME DateTimeFormatter isoLocalDateTime = DateTimeFormatter.ISO_LOCAL_DATE_TIME println \"\"\" currentDateTime : ${currentDateTime} BASIC_ISO_DATE : ${basicISODate.format(currentDateTime)} ISO_LOCAL_DATE : ${isoLocalDate.format(currentDateTime)} ISO_LOCAL_TIME : ${isoLocalTime.format(currentDateTime)} ISO_LOCAL_DATE_TIME : ${isoLocalDateTime.format(currentDateTime)} \"\"\" result currentDateTime : 2021-04-29T02:45:37.501 BASIC_ISO_DATE : 20210429 ISO_LOCAL_DATE : 2021-04-29 ISO_LOCAL_TIME : 02:45:37.501 ISO_LOCAL_DATE_TIME : 2021-04-29T02:45:37.501 convert Long to SimpleDateFormat reference: Parsing and Formatting Dates in Java get Beijing Date time - Java java.util import java.util.Date import java.text.SimpleDateFormat Long x = 1086073200000 SimpleDateFormat simpleDateFormat = new SimpleDateFormat(\"HH:mm:ss dd/MM/yyyy\") simpleDateFormat.setTimeZone(TimeZone.getTimeZone(\"Asia/Shanghai\")) println \"\"\" x : ${x} x data : ${simpleDateFormat.format( new Date(x) )} 0 data : ${simpleDateFormat.format( new Date(0) )} \"\"\" result x : 1086073200000 x data : 15:00:00 01/06/2004 0 data : 08:00:00 01/01/1970 or via java.util.Calendar import java.text.SimpleDateFormat import java.util.Calendar Long x = 1086073200000 SimpleDateFormat simpleDateFormat = new SimpleDateFormat(\"HH:mm:ss dd/MM/yyyy\") simpleDateFormat.setTimeZone(TimeZone.getTimeZone(\"Asia/Shanghai\")) Calendar calendar = Calendar.getInstance() calendar.setTimeInMillis(x) println x println calendar.getTime().getClass() println simpleDateFormat.format(calendar.getTime()) result:Result 1086073200000 class java.util.Date 15:00:00 01/06/2004 regex Pattern and Matcher matches to regex (return Boolean) String cpuset = '/kubepods/burstable/pod59899be8/b60bf42d334be0eff64f325bad5b0ca4750119fbf8a7e80afa4e559040208ab3' String pattern = '^/kubepods/([^/]+/){2}(\\\\w{64})$' assert (cpuset =~ pattern).find() == true assert (cpuset =~ pattern).lookingAt() == true assert (cpuset =~ pattern).matches() == true get all matches String text = \"\"\" This text contains some numbers like 1024 or 256. Some of them are odd (like 3) or even (like 2). \"\"\" String pattern = '\\\\d+' assert (text =~ pattern).findAll() == [ '1024', '256', '3', '2' ] safely capture the matches String k8sPattern = '^/kubepods/([^/]+/){2}(\\\\w{64})$' String dockerPattern = '^/docker/(\\\\w{64})$' String cpuset = '/kubepods/burstable/pod59899be8/b60bf42d334be0eff64f325bad5b0ca4750119fbf8a7e80afa4e559040208ab3' int groupIndex = 0 int index = 1 ( cpuset =~ k8sPattern ).findAll()?.getAt(groupIndex)?.getAt(index) ?: null ( cpuset =~ dockerPattern ).findAll()?.getAt(groupIndex)?.getAt(index) ?: null unicode println \"\"\" \\\\u22c5 : | \\u22c5 | \\\\u23d0 : | \\u23d0 | \\\\u2802 : | \\u2802 | \\\\u2812 : | \\u2812 | \\\\u00a8 : | \\u00a8 | \\\\u2810 : | \\u2810 | \\\\u22ef : | \\u22ef | \\\\u1801 : | \\u1801 | \\\\u1802 : | \\u1802 | \\\\u1803 : | \\u1803 | \\\\u20db : | \\u20db | \\\\u20dc : | \\u20dc | \\\\u20e8 : | \\u20e8 | \\\\u20db : | \\u20db | \\\\u20dc : | \\u20dc | \\\\u2236 : | \\u2236 | \\\\u22ee : | \\u22ee | \\\\u22ef : | \\u22ef | \\\\u2d48 : | \\u2d48 | \\\\u2d42 : | \\u2d42 | \\\\u2d57 : | \\u2d57 | \\\\u2d67 : | \\u2d67 | \\\\u2e31 : | \\u2e31 | \\\\u302f : | \\u302f | \\\\ua4fd : | \\ua4fd | \\\\ua537 : | \\ua537 | \\\\ua539 : | \\ua539 | \\\\ua789 : | \\ua789 | \\\\ufe19 : | \\ufe19 | \\\\ufe55 : | \\ufe55 | \\\\u2219 : | \\u2219 | \\\\u22c5 : | \\u22c5 | \\\\u22ef : | \\u22ef | \\\\u25b4 : | \\u25b4 | \\\\u25b8 : | \\u25b8 | \\\\u25be : | \\u25be | \\\\u25c2 : | \\u25c2 | \\\\u25cf : | \\u25cf | \\\\u25b9 : | \\u25b9 | \\\\u25bf : | \\u25bf | \\\\u2639 : | \\u2639 | \\\\u263a : | \\u263a | \\\\u263b : | \\u263b | \"\"\" result \\u22c5 : | ⋅ | \\u23d0 : | ⏐ | \\u2802 : | ⠂ | \\u2812 : | ⠒ | \\u00a8 : | ¨ | \\u2810 : | ⠐ | \\u22ef : | ⋯ | \\u1801 : | ᠁ | \\u1802 : | ᠂ | \\u1803 : | ᠃ | \\u20db : | ⃛ | \\u20dc : | ⃜ | \\u20e8 : | ⃨ | \\u20db : | ⃛ | \\u20dc : | ⃜ | \\u2236 : | ∶ | \\u22ee : | ⋮ | \\u22ef : | ⋯ | \\u2d48 : | ⵈ | \\u2d42 : | ⵂ | \\u2d57 : | ⵗ | \\u2d67 : | ⵧ | \\u2e31 : | ⸱ | \\u302f : | 〯 | \\ua4fd : | ꓽ | \\ua537 : | ꔷ | \\ua539 : | ꔹ | \\ua789 : | ꞉ | \\ufe19 : | ︙ | \\ufe55 : | ﹕ | \\u2219 : | ∙ | \\u22c5 : | ⋅ | \\u22ef : | ⋯ | \\u25b4 : | ▴ | \\u25b8 : | ▸ | \\u25be : | ▾ | \\u25c2 : | ◂ | \\u25cf : | ● | \\u25b9 : | ▹ | \\u25bf : | ▿ | \\u2639 : | ☹ | \\u263a : | ☺ | \\u263b : | ☻ | Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:28 "},"programming/groovy/tricky.html":{"url":"programming/groovy/tricky.html","title":"tricky","keywords":"","body":" Table of Contents generated with DocToc common get the first item if exists or null if empty split and trim in string indices & indexed() elegant way to merge Map> structure by using groovy fuzzy search and merge Map>> groupBy List> to Map get object id (python -c 'id('abc')) loop if not empty getField() generate the random String run groovy from docker MetaClass get supported methods A Bit of metaClass DSL get class name dynamically call methods others groovy cli (args) with options Get variable value for its name groovy.lang.Binding load groovy file GroovyShell() GroovyClassLoader() metaClass common get the first item if exists or null if empty assert [:]?.find{true} == null assert []?.find{true} == null assert ['a']?.find{true} == 'a' ['a': '1'].find{ true }.each { println it.key + ' ~> ' + it.value } println (['a': '1'].find{ true }.getClass()) // result // a ~> 1 // class java.util.LinkedHashMap$Entry split and trim in string spread operator: *. groovy:000> 'a , b, ccc ,d'.split(',')*.trim() ===> [a, b, ccc, d] regular expression \\s*\\s* groovy:000> 'a , b, ccc ,d'.trim().split(\"\\\\s*,\\\\s*\") ===> [a, b, ccc, d] indices & indexed() def rows = ['foo', 'bar'] println rows.indices println rows.indexed() ===> result 0.. usage def userList = [ [name: 'user1', id:0, ip: '127.0.0.1'], [name: 'user2', id:1, ip: '127.0.0.2'], [name: 'user3', id:2, ip: '127.0.0.3'] ] def rows = ['foo', 'bar'] println rows.indices.collect { index -> // Using indices userList.find { it.id == index } } println rows.indexed().collect { index, item -> // Using indexed() userList.find { it.id == index } } ===> result [[name:user1, id:0, ip:127.0.0.1], [name:user2, id:1, ip:127.0.0.2]] [[name:user1, id:0, ip:127.0.0.1], [name:user2, id:1, ip:127.0.0.2]] elegant way to merge Map> structure by using groovy original Map structure wanted result Map> case_pool = [ dev : [ funcA : ['devA'] , funcB : ['devB'] , funcC : ['devC'] ], 'dev/funcA' : [ funcA : ['performanceA'] ], 'dev/funcA/feature' : [ funcA : ['performanceA', 'feature'] ], staging : [ funcB : ['stgB'] , funcC : ['stgC'] ] ] String branch = 'dev/funcA/feature-1.0' result: [ funcA: [ \"devA\", \"performanceA\", \"feature\" ], funcB: [ \"devB\" ], funcC: [ \"devC\" ] ] original map structure: Map> case_pool = [ dev : [ funcA : ['devA'] , funcB : ['devB'] , funcC : ['devC'] ], 'dev/funcA' : [ funcA : ['performanceA'] ], 'dev/funcA/feature' : [ funcA : ['performanceA', 'feature'] ], staging : [ funcB : ['stgB'] , funcC : ['stgC'] ] ] method 1st: by using loop String branch = 'dev/funcA/feature-1.0' def result = [:].withDefault { [] as Set } case_pool.keySet().each { if ( branch.contains(it) ) { case_pool.get(it).each { k, v -> result[k].addAll(v) } } } println 'result: ' + result method 2nd: by using closure String branch = 'dev/funcA/feature-1.0' def result = [:].withDefault { [] as Set } case_pool.findAll{ k, v -> branch.contains(k) } .collectMany{ k, v -> v.collect{ c, l -> result[c].addAll(l) } } println 'result: ' + result method 3rd: by using closure elegantly def result = case_pool.inject([:].withDefault { [] as Set }) { result, key, value -> if (branch.contains(key)) { value.each { k, v -> result[k] += v } }; result } println 'result: ' + result fuzzy search and merge Map>> /** * \"fuzzy\" search and merge the {@code Map>} according to keywords. * To replace the hardcode 'keyword' search {@code case_pool.get(stg).get(keyword).values()}. example: * * keyword = 'dev/funcA/feature1' * fuzzyFindAll( case_pool, keyword ) * => Result: [funcA:[devA, performanceA, feature], funcB:[devB], funcC:[devC]] * * * @param map the map structure for {@code Map>} * @param keyword use branch as keyword normally **/ def fuzzyFindAll( Map map, String keyword ) { Map result = [:] map.findAll{ k, v -> keyword.toLowerCase().contains(k.toLowerCase()) }.collect { k, v -> v.each { key, value -> result[key] = [ result.getOrDefault(key,[]) + value ].flatten().unique() } } return result } groupBy List> to Map requirements: [ [\"GX 470\",\"Model\"], [\"Lexus\",\"Make\"], [\"Jeep\",\"Make\"], [\"Red\",\"Color\"], [\"blue\",\"Color\"] ] ⇣⇣ [\"Model\":[\"GX 470\"],\"Make\":[\"Lexus\",\"Jeep\"],\"Color\":[\"Red\", \"blue\"]] solution def list = [ [\"GX-470\",\"Model\"], [\"Lexus\",\"Make\"], [\"Jeep\",\"Make\"], [\"Red\",\"Color\"], [\"blue\",\"Color\"] ] list.groupBy{ it[1] }.collectEntries{ k, v -> [(k): v.collect{it.get(0)}] } alternatives list.inject([:].withDefault{[]}) { map, elem -> map[elem[1]] get object id (python -c 'id('abc')) java.lang.System.identityHashCode( obj ) example String s = 'abc' String x = s println java.lang.System.identityHashCode(s) println java.lang.System.identityHashCode(x) x = s + 'aa' println java.lang.System.identityHashCode(x) ==> 51571311 51571311 733591550 example for identityHashCode() and hashCode() String a = new String(\"hhh\") String b = new String(\"hhh\") assert System.identityHashCode(a) != System.identityHashCode(b) assert a.hashCode() == b.hashCode() loop if not empty []?.each{ println it } ?: println( 'empty' ) [:]?.each{ k, v -> println \"${k} :: ${v}\" } ?: println( 'empty' ) detailsassert [:]?.each{ k, v -> println \"${k} :: ${v}\" } == true | | [:] false getField() groovy:000 > 'aaa'.getClass().getFields() ===> [public static final java.util.Comparator java.lang.String.CASE_INSENSITIVE_ORDER] generate the random String String alphabet = (('a'..'z') + ('A'..'Z') + ('0'..'9')).join() println new Random().with { (1..8).collect { alphabet[ nextInt( alphabet.length() ) ] }.join() } orClosure generator = { String alphabet, int n -> new Random().with { (1..n).collect { alphabet[ nextInt( alphabet.length() ) ] }.join() } } String charset = (('A'..'Z')+('0'..'9')+('a'..'z')).join() randomValue = generator( charset, 15 ) run groovy from docker $ docker run \\ --rm \\ -e hola=caracola \\ -it \\ groovy:latest groovy -e \"System.getenv().each{ println it }\" mount volume$ docker run \\ --rm \\ -v \"$PWD\":/home/marslo/scripts \\ -w /home/marslo/scripts \\ groovy:latest \\ groovy DockerBasico.groovy -a DockerBasico.groovyif ( options.a ) { println \"------------------------------------------------------------------\" System.getenv().each{ println it } println \"------------------------------------------------------------------\" } with Json $ docker run \\ --rm \\ -v \"$PWD\":/home/marslo/scripts \\ -w /home/marslo/scripts \\ groovy:latest groovy DockerBasico.groovy -d DockerBasico.groovy > how to download the image via json if( options.d ){ def json = new groovy.json.JsonSlurper().parse( new URL(\"https://dog.ceo/api/breed/hound/images/random\") ) if( json.status=='success' ){ new File('perrito.jpg').bytes = new URL(json.message).bytes } } MetaClass get supported methods String s = 'aa' println s.metaClass.methods.name result [equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait, charAt, codePointAt, codePointBefore, codePointCount, compareTo, compareToIgnoreCase, concat, contains, contentEquals, contentEquals, copyValueOf, copyValueOf, endsWith, equals, equalsIgnoreCase, format, format, getBytes, getBytes, getBytes, getBytes, getChars, hashCode, indexOf, indexOf, indexOf, indexOf, intern, isEmpty, join, join, lastIndexOf, lastIndexOf, lastIndexOf, lastIndexOf, length, matches, offsetByCodePoints, regionMatches, regionMatches, replace, replace, replaceAll, replaceFirst, split, split, startsWith, startsWith, subSequence, substring, substring, toCharArray, toLowerCase, toLowerCase, toString, toUpperCase, toUpperCase, trim, valueOf, valueOf, valueOf, valueOf, valueOf, valueOf, valueOf, valueOf, valueOf] or print by sort println .metaClass.methods*.name.sort().unique() A Bit of metaClass DSL String.metaClass { or delegate.plus(' or ').plus(s) } or delegate.findAll(\"(${l.join('|')})\") } and { String s -> delegate.plus(' and ').plus(s) } 'static' { groovy { 'Yeah man!' } } } assert 'Groovy or Java?' == (\"Groovy\" | \"Java?\") assert ['o', 'o', 'y'] == (\"Groovy\" | ['o', 'y']) assert 'Groovy and Java!' == (\"Groovy\" & \"Java!\") assert 'Yeah man!' == String.groovy() metaClass with Closure List.metaClass.eachUntilGreaterThanFive = { closure -> for ( value in delegate ) { if ( value > 5 ) break closure(value) } } [1, 2, 3, 4, 5, 6, 7].eachUntilGreaterThanFive { println it } get class name Sting s = 'string' println s.metaClass.getTheClass() // Class println s.getClass() // Class println s.class.name // String outputclass java.lang.String class java.lang.String java.lang.String dynamically call methods references: Get variable dynamically def doPrint( String platform, String string ) { this.\"do${platform.toLowerCase().capitalize()}Print\"( string ) } def doLinuxPrint( String string ) { println \"from Linux: ${string}\" } def doWindowsPrint( String string ) { println \"from Windows: ${string}\" } def doDockerPrint( String string ) { println \"from Docker: ${string}\" } doPrint( 'LINUX', 'awesome marslo!' ) doPrint( 'dOCKER', 'awesome marslo!' ) resultfrom Linux: awesome marslo! from Docker: awesome marslo! others groovy cli (args) with options reference: groovy script 101 - Dockery Groovy (basic) def cli = new CliBuilder(usage: 'groovy DockerBasico.groovy]') cli.with { h(longOpt: 'help', 'Usage Information \\n', required: false) a(longOpt: 'Hello','Al seleccionar \"a\" te saludara ', required: false) d(longOpt: 'Dogs', 'Genera imagenes de perros', required:false) } def options = cli.parse(args) if ( !options || options.h ) { cli.usage return } //tag::hello[] if ( options.a ) { println \"------------------------------------------------------------------\" println \"Hello\" System.getenv().each{ println it } println \"------------------------------------------------------------------\" } //end::hello[] //tag::dogs[] if ( options.d ){ def json = new groovy.json.JsonSlurper().parse( new URL(\"https://dog.ceo/api/breed/hound/images/random\") ) if( json.status=='success' ){ new File('perrito.jpg').bytes = new URL(json.message).bytes } } //end::dogs[] Get variable value for its name import groovy.text.SimpleTemplateEngine def binding = [ VAL1:'foo', VAL2:'bar' ] def template = 'hello ${VAL1}, please have a ${VAL2}' // single quotes println new SimpleTemplateEngine().createTemplate( template ).make( binding ).toString() groovy.lang.Binding this.binding reference: Binding variables access in Groovy script's defined classes baz = [ 'a':'b' ] foo = \"abc\" bar = \"def\" println this.binding.hasVariable('baz') this.binding.variables.each{ println \"${it.key} : ${it.value}\" } resulttrue args : [] baz : [a:b] foo : abc bar : def new Binding() String beans = 'aabbcc-beans-ddeeff' Binding b = new Binding(); b.setVariable(\"beans\", beans); b.variables.each{ println \"${it.key} : ${it.value}\" } binding.setVariable() m = [ 'a' : '1', 'b' : '2' ] binding.setVariable(\"a\", m) this.binding.variables.each{ println \"${it.key} : ${it.value}\" } resultargs : [] m : [a:1, b:2] a : [a:1, b:2] load groovy file sample.groovy: #!/usr/bin/env groovy import groovy.transform.Field @Field final Map> SAMPLE = [ k1 : [ 'k11' : 'v11' ] , k2 : [ 'k21' : 'v21', 'k22' : 'v22' ] ] references: Integrating Groovy in a Java application GroovyShell GroovyClassLoader GroovyShell() new GroovyShell().parse(new File('/path/to/file')) Object sample = new GroovyShell().parse(new File('/path/to/sample.groovy')) println \"\"\" sample.getClass() : ${sample.getClass()} sample.SAMPLE.k1 : ${sample.SAMPLE.k1} \"\"\" result sample.getClass() : class sample sample.SAMPLE.k1 : [k11:v11] Object.with{} Object sample = new GroovyShell().parse(new File('/path/to/sample.groovy')) sample.with{ println SAMPLE println SAMPLE.k1 } result[k1:[k11:v11], k2:[k21:v21, k22:v22]] [k11:v11] GroovyClassLoader() new GroovyClassLoader().parseClass(\"/path/to/sample.groovy\" as File) Class clazz = new GroovyClassLoader().parseClass(\"/path/to/sample.groovy\" as File) println \"\"\" clazz.getClass() : ${clazz.getClass()} clazz.newInstance().SAMPLE : ${clazz.newInstance().SAMPLE} \"\"\" result clazz.getClass() : class java.lang.Class clazz.newInstance().SAMPLE : [k1:[k11:v11], k2:[k21:v21, k22:v22]] this.class.classLoader.parseClass(new File(\"/path/to/sample.groovy\")) Class myClazz = this.class.classLoader.parseClass(new File(\"/Users/marslo/Desktop/sample.groovy\")) println \"\"\" myClazz.getClass() : ${myClazz.getClass()} myClazz.newInstance().SAMPLE : ${myClazz.newInstance().SAMPLE} \"\"\" result myClazz.getClass() : class java.lang.Class myClazz.newInstance().SAMPLE : [k1:[k11:v11], k2:[k21:v21, k22:v22]] new GroovyClassLoader(getClass().getClassLoader()).parseClass(new File(\"/path/to/sample.groovy\")) Class gClass = new GroovyClassLoader(getClass().getClassLoader()).parseClass(new File(\"/path/to/sample.groovy\")); println \"\"\" gClass.getClass() : ${gClass.getClass()} gClass.newInstance().SAMPLE : ${gClass.newInstance().SAMPLE} \"\"\" result gClass.getClass() : class java.lang.Class gClass.newInstance().SAMPLE : [k1:[k11:v11], k2:[k21:v21, k22:v22]] metaClass Object sample = new GroovyShell().parse(new File('/path/to/sample.groovy')) println sample.metaClass.hasProperty(sample, 'SAMPLE').type println sample.metaClass.hasProperty(sample, 'SAMPLE').name resultinterface java.util.Map SAMPLE or Class clazz = new GroovyClassLoader().parseClass(\"/path/to/sample.groovy\" as File) println clazz.metaClass.hasProperty(clazz, 'SAMPLE').dump() result more def importScript(def scriptFile) { def script = new GroovyShell().parse(new File(scriptFile)) script.metaClass.methods.each { if (it.declaringClass.getTheClass() == script.class && ! it.name.contains('$') && it.name != 'main' && it.name != 'run') { this.metaClass.\"$it.name\" = script.&\"$it.name\" } } } importScript('File1.groovy') method() Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:28 "},"programming/python/config.html":{"url":"programming/python/config.html","title":"config","keywords":"","body":" Table of Contents generated with DocToc installation command completion installation via source code environment in MacOS pip.conf pip config file list python path python libs multiple versions version change setup default python modules re-installation PYTHONPATH extension clear windows python IDLE in MacOS Big Sur IDLE quit unexpectedly Python may not be configured for Tk reference: homebrew and python Installing from local packages pip list installation command completion $ python -m pip completion --bash >> ~/.bashrc or$ python -m pip completion --bash >> ~/.profile or$ eval \"`pip completion --bash`\" installation via source code basic environment prepare $ sudo dnf install gcc openssl-devel bzip2-devel libffi-devel or$ sudo dnf groupinstall 'development tools' $ sudo dnf install bzip2-devel expat-devel gdbm-devel \\ ncurses-devel openssl-devel readline-devel wget \\ sqlite-devel tk-devel xz-devel zlib-devel libffi-devel download source code $ curl -O https://www.python.org/ftp/python/3.8.3/Python-3.8.3.tgz $ tar xzf Python-3.8.3.tgz compile and install $ cd Python-3.8.3 $ sudo ./configure --enable-optimizations $ sudo make -j 12 $ sudo make altinstall setup $ sudo update-alternatives --install /usr/bin/python3 python3 /usr/local/bin/python3.8 99 environment in MacOS pip.conf pip.conf load priority MacOS : /Library/Application Support/pip/pip.conf > ~/.config/pip/pip.conf > ~/.pip/pip.conf user: ~/.pip/pip.conf & ~/.config/pip/pip.conf global: /Library/Application Support/pip/pip.conf list config: $ pip config list [ -v ] global.index-url='https://repo.my.com/artifactory/api/pypi/tools/simple' details$ pip config list -v For variant 'global', will try loading '/Library/Application Support/pip/pip.conf' For variant 'user', will try loading '/Users/marslo/.pip/pip.conf' For variant 'user', will try loading '/Users/marslo/.config/pip/pip.conf' For variant 'site', will try loading '/usr/local/opt/python@3.10/Frameworks/Python.framework/Versions/3.10/pip.conf' global.extra-index-url='https://my.artifactory.com/artifactory/api/pypi/myPrivate' global.index-url='https://my.artifactory.com/artifactory/api/pypi/pypi/simple' PIP_CONF_FILE $ export PIP_CONFIG_FILE=/path/to/pip.conf upgrade all outdated modules $ pip install --upgrade --user $(pip list --outdated | sed 1,2d | awk '{print $1}' | xargs) with exclude$ pip3.9 install --upgrade --user $(pip3.9 list --outdated | sed 1,2d | awk '{print $1}' | grep -vw 'docker\\|rich') pip config file naming [global] timeout = 60 index-url = https://download.zope.org/ppix per-command section [global] timeout = 60 [freeze] timeout = 10 boolean options [install] ignore-installed = true no-dependencies = yes add [global] no-cache-dir = false [install] no-compile = no no-warn-script-location = false repeatable options [global] quiet = 0 verbose = 2 format: on multiple lines [global] find-links = http://download.example.com [install] find-links = http://mirror1.example.com http://mirror2.example.com trusted-host = mirror1.example.com mirror2.example.com list python path $ python -vv -c \"import sys; print sys.path\" $ python -vvE -c \"import sys; print sys.path\" $ python -vvEsS -c \"import sys; print sys.path\" python libs MacOS global $ ls -ld /usr/local/lib/python*/ drwxr-xr-x 3 marslo admin 96 May 17 2019 /usr/local/lib/python2.7/ drwxr-xr-x 3 marslo admin 96 May 17 2019 /usr/local/lib/python3.7/ drwxr-xr-x 3 marslo admin 96 Jan 13 2020 /usr/local/lib/python3.8/ drwxr-xr-x 3 marslo admin 96 Oct 10 17:06 /usr/local/lib/python3.9/ $ ls -ld /Library/Python/2.7/site-packages/ drwxr-xr-x 9 root wheel 288 Aug 6 18:16 /Library/Python/2.7/site-packages/ or $ ls $(brew --prefix)/lib/python* /usr/local/lib/python2.7: site-packages /usr/local/lib/python3.7: site-packages /usr/local/lib/python3.8: site-packages /usr/local/lib/python3.9: site-packages local $ ls -ld ~/Library/Python/*/ drwx------ 4 marslo staff 128 Aug 6 17:23 /Users/marslo/Library/Python/2.7/ drwx------ 5 marslo staff 160 Oct 12 21:17 /Users/marslo/Library/Python/3.7/ drwx------ 5 marslo staff 160 Oct 27 19:24 /Users/marslo/Library/Python/3.8/ drwx------ 5 marslo staff 160 Oct 27 19:24 /Users/marslo/Library/Python/3.9/ example: $ /usr/bin/python -c 'import site; print(site.USER_BASE)' /Users/marslo/Library/Python/2.7 $ /usr/local/bin/python3.9 -c 'import site; print(site.USER_BASE)' /Users/marslo/Library/Python/3.9 $ /usr/local/bin/python3.6 -c 'import sysconfig; print(sysconfig.get_paths()[\"purelib\"])' /usr/lib/python3.6/site-packages linux references: How do I find the location of my Python site-packages directory $ /usr/local/bin/python3.6 -m site --user-site /home/marslo/.local/lib/python3.6/site-packages $ /usr/local/bin/python3.6 -c 'import site; print(site.getsitepackages())' ['/usr/local/lib64/python3.6/site-packages', '/usr/local/lib/python3.6/site-packages', '/usr/lib64/python3.6/site-packages', '/usr/lib/python3.6/site-packages'] $ python3.6 -m site sys.path = [ '/home/marslo', '/usr/lib64/python36.zip', '/usr/lib64/python3.6', '/usr/lib64/python3.6/lib-dynload', '/usr/local/lib/python3.6/site-packages', '/usr/lib64/python3.6/site-packages', '/usr/lib/python3.6/site-packages', ] USER_BASE: '/home/marslo/.local' (exists) USER_SITE: '/home/marslo/.local/lib/python3.6/site-packages' (doesn't exist) ENABLE_USER_SITE: True check particular lib $ python -c \"import os as _; print(_.__file__)\" /usr/lib64/python3.6/os.py $ python -c \"import setuptools as _; print(_.__path__)\" ['/usr/lib/python3.6/site-packages/setuptools'] multiple versions get current working version $ CFLAGS=-I$(brew --prefix)/include LDFLAGS=-L$(brew --prefix)/lib pip --version pip 20.2.4 from /Users/marslo/Library/Python/3.8/lib/python/site-packages/pip (python 3.8) or$ $(brew --prefix)/opt/python/libexec/bin/python -V Python 3.8.6 upgrade particular modules $ sudo -H python3.9 -m pip install --upgrade pip Collecting pip Using cached pip-20.2.4-py2.py3-none-any.whl (1.5 MB) Installing collected packages: pip Attempting uninstall: pip Found existing installation: pip 20.2.3 Uninstalling pip-20.2.3: Successfully uninstalled pip-20.2.3 Successfully installed pip-20.2.4 upgrade to previous version$ pip install --upgrade --no-cache-dir --pre pip install all older version modules $ /usr/local/bin/python3.8 -m pip freeze > pip3.8-requirements.txt $ sudo -H /usr/local/bin/python3.9 -m pip install --pre -r pip3.8-requirements.txt reference: $ CFLAGS=-I$(brew --prefix)/include LDFLAGS=-L$(brew --prefix)/lib pip freeze beautifulsoup4==4.9.1 certifi==2020.6.20 cffi==1.14.1 chardet==3.0.4 click==7.1.2 click-config-file==0.6.0 colorama==0.4.3 ... or $ pip list --outdate --format=freeze docker==4.2.2 rich==3.0.5 $ pip list -o --format columns Package Version Latest Type ------- ------- ------ ----- docker 4.2.2 4.3.1 wheel rich 3.0.5 9.1.0 whee $ pip list --outdate --format=json [{\"name\": \"docker\", \"version\": \"4.2.2\", \"latest_version\": \"4.3.1\", \"latest_filetype\": \"wheel\"}, {\"name\": \"rich\", \"version\": \"3.0.5\", \"latest_version\": \"9.1.0\", \"latest_filetype\": \"wheel\"}] version change change default python from 3.9 to 3.10 setup default python via ln $ unlink /usr/local/opt/python $ ln -sf /usr/local/Cellar/python@3.10/3.10.4 /usr/local/opt/python $ unlink /usr/local/bin/python $ ln -sf /usr/local/Cellar/python@3.10/3.10.4/bin/python3.10 /usr/local/bin/python3 $ ln -sf /usr/local/Cellar/python@3.10/3.10.4/bin/python3.10 /usr/local/bin/python $ export PYTHONUSERBASE=\"$(/usr/local/opt/python/libexec/bin/python -c 'import site; print(site.USER_BASE)')\" $ export PYTHON3='/usr/local/opt/python/libexec/bin' $ export PATH=\"$PYTHONUSERBASE/bin:${PYTHON3}:$PATH\" via brew link $ brew link python3 python@3.10 --overwrite example $ python3 --version Python 3.9.13 $ brew link python3 python@3.10 --overwrite Warning: Already linked: /usr/local/Cellar/python@3.9/3.9.13_1 To relink, run: brew unlink python@3.9 && brew link python@3.9 Linking /usr/local/Cellar/python@3.10/3.10.4... 24 symlinks created. If you need to have this software first in your PATH instead consider running: echo 'export PATH=\"/usr/local/opt/python@3.10/bin:$PATH\"' >> /Users/marslo/.bash_profile $ python3 --version Python 3.10.4 via default $ defaults write com.apple.versioner.python Version 3.8 get default version$ defaults read com.apple.versioner.python Version example $ defaults read com.apple.versioner.python Version 3.9 $ defaults write com.apple.versioner.python Version 3.10 $ defaults read com.apple.versioner.python Version 3.10 modules re-installation $ /usr/local/bin/python3.9 -m pip freeze > pip3.9-requirements.txt $ sudo -H /usr/local/bin/python3.10 -m pip install --pre -r pip3.9-requirements.txt PYTHONPATH $ export PYTHONPATH=\"/usr/local/lib/python3.9/site-packages\" ⇣⇣ $ export PYTHONPATH=\"/usr/local/lib/python3.10/site-packages\" extension clear windows download$ curl -o /Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/idlelib/ClearWindow.py https://bugs.python.org/file14303/ClearWindow.py configure $ cat >> /Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/idlelib/config-extensions.def EOF python IDLE in MacOS Big Sur IDLE quit unexpectedly Process: Python [53851] Path: /usr/local/Cellar/python@3.9/3.9.1_5/IDLE 3.app/Contents/MacOS/Python Identifier: org.python.IDLE Version: 3.9.1 (3.9.1) Code Type: X86-64 (Native) Parent Process: ??? [1] Responsible: Python [53851] User ID: 501 Date/Time: 2021-01-10 15:20:06.574 +0800 OS Version: macOS 11.1 (20C69) Report Version: 12 Bridge OS Version: 5.1 (18P3030) Anonymous UUID: AB6EE819-0314-4161-9650-FFE340DF84C8 Application Specific Information: abort() called ... root cause $ python Python 3.9.1 (default, Jan 6 2021, 06:05:23) [Clang 12.0.0 (clang-1200.0.32.28)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> import tkinter as tk >>> print(tk.Tcl().eval('info patchlevel')) 8.5.9 >>> exit() using https://www.python.org/ftp/python/3.9.1/python-3.9.1-macosx10.9.pkg $ brew info tcl-tk | head -1 tcl-tk: stable 8.6.11 (bottled) [keg-only] $ python Python 3.9.1 (v3.9.1:1e5d33e9b9, Dec 7 2020, 12:10:52) [Clang 6.0 (clang-600.0.57)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license()\" for more information. >>> import tkinter as tk >>> print(tk.Tcl().eval('info patchlevel')) 8.6.8 more on tkinter >>> import tkinter >>> tkinter.TclVersion, tkinter.TkVersion (8.5, 8.5) >>> tkinter._tester() Traceback (most recent call last): File \"\", line 1, in AttributeError: module 'tkinter' has no attribute '_tester' >>> tkinter._test() macOS 11 or later required ! Abort trap: 6 Python may not be configured for Tk $ python Python 3.10.4 (main, Apr 26 2022, 19:42:59) [Clang 13.1.6 (clang-1316.0.21.2)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> import tkinter as tk Traceback (most recent call last): File \"\", line 1, in File \"/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python3.10/tkinter/__init__.py\", line 37, in import _tkinter # If this fails your Python may not be configured for Tk ModuleNotFoundError: No module named '_tkinter' solution $ brew info python@3.10 python@3.10: stable 3.10.4 (bottled) [keg-only] ... ... tkinter is no longer included with this formula, but it is available separately: brew install python-tk@3.10 ... ... $ brew install python-tk@3.10 ==> Downloading https://ghcr.io/v2/homebrew/core/python-tk/3.10/manifests/3.10.4 ######################################################################## 100.0% ==> Downloading https://ghcr.io/v2/homebrew/core/python-tk/3.10/blobs/sha256:6a937be1fd531589ef7f9b4d971cb91ee7549d99f7f1aaf97f0fc3c0911f1c5d ==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:6a937be1fd531589ef7f9b4d971cb91ee7549d99f7f1aaf97f0fc3c0911f1c5d?s ######################################################################## 100.0% ==> Pouring python-tk@3.10--3.10.4.monterey.bottle.tar.gz ==> Caveats python-tk@3.10 is keg-only, which means it was not symlinked into /usr/local, because this is an alternate version of another formula. ==> Summary ☕️ 🐸 /usr/local/Cellar/python-tk@3.10/3.10.4: 5 files, 132.6KB ==> Running `brew cleanup python-tk@3.10`... Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP. Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`). $ brew reinstall python@3.10 ... ... Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:27 "},"programming/python/basic.html":{"url":"programming/python/basic.html","title":"basic","keywords":"","body":" Table of Contents generated with DocToc environment list included modules list lib paths Positional notation to Binary to Octal to Decimal to Hexadecimal environment list included modules $ python -c 'help(\"modules\")' Please wait a moment while I gather a list of all available modules... __future__ _warnings graphlib runpy _abc _weakref grp sched _aix_support _weakrefset gzip secrets ... list lib paths $ python -c 'import sys; print (sys.path)' ['', '/usr/lib/python39.zip', '/usr/lib/python3.8', '/usr/lib/python3.8/lib-dynload', '/usr/local/lib/python3.8/dist-packages', '/usr/lib/python3/dist-packages'] Positional notation to Binary Octal to Binary>>> bin( int('0o10', 8) ) '0b1000' >>> bin( int('0o17', 8) ) '0b1111' Decimal to Binary>>> bin(2) '0b10' >>> bin(10) '0b1010' or>>> format( 3, 'b' ) '11' >>> format( 15, 'b' ) '1111' Hexadecimal to Binary>>> bin( int('a', 16) ) '0b1010' >>> bin( int('f', 16) ) '0b1111' to Octal Binary to Octal>>> oct( int(str(111), 2) ) '0o7' >>> oct( int(str(1000), 2) ) '0o10' Decimal to Octal>>> oct(8) '0o10' or>>> format( 15, 'o' ) '17' >>> format( 8, 'o' ) '10' Hexadecimal to Octal>>> oct( 0xf ) '0o17' to Decimal Binary to Decimal>>> int( str(11), 2 ) 3 >>> int( str(1010), 2 ) 10 Octal to Decimal>>> 0o10 8 >>> int( 0o10 ) 8 >>> int ( str(10), 8 ) 8 Hexadecimal to Decimal>>> int( 0xf ) 15 to Hexadecimal Binary to Hexadecimal>>> hex( int(str(1010), 2) ) '0xa' >>> hex( int(str(1111), 2) ) '0xf' Octal to Hexadecimal>>> hex(0o10) '0x8' >>> hex( int('0o17', 8 )) '0xf' Decimal to Hexadecimal>>> hex(15) '0xf' >>> hex(66) '0x42' or>>> format( 15, 'x' ) 'f' or>>> '%x' % 15 'f' Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:26 "},"programming/python/list.html":{"url":"programming/python/list.html","title":"list","keywords":"","body":" Table of Contents generated with DocToc list copy reverse list cast format (str -> int) zip two lists list mathematical list copy inspired by How to clone or copy a list? in stackoverflow clone_list = sample_list.copy() orclone_list = sample_list[:] orclone_list = list(sample_list) orimport copy clone_list = copy.copy(sample_list) or import copy clone_list = copy.deepcopy(sample_list) example: >>> id(x) 4505979072 >>> k = x >>> id(k) 4505979072 >>> k = x.copy() >>> id(k) 4445208000 >>> k = x[:] >>> id(k) 4505977632 >>> import copy >>> k = copy.copy(x) >>> id(k) 4505754352 >>> k = copy.deepcopy(x) >>> id(k) 4505978352 >>> k = x[:] >>> id(k) 4506260896 >>> k = copy.deepcopy(x) >>> id(k) 4506261136 reverse list sample_list[::-1] example:>>> ['1', '2', '3', '4', '5'][::-1] ['5', '4', '3', '2', '1'] cast format (str -> int) list( map(int, sample_list) ) example:>>> print( list( map(int, ['2', '8', '4', '127', 'HKD'][:3][::-1] ) ) ) [4, 8, 2] zip two lists >> from itertools import zip_longest >>> x = ['1', '2', '3', '4'] >>> y = ['one', 'two', 'three', 'four'] >>> for i, j in zip_longest( x, y ): print(i, j) 1 one 2 two 3 three 4 four or zip to a map>>> x = ['1', '2', '3', '4'] >>> y = ['one', 'two', 'three', 'four'] >>> print( {key: value for key, value in zip_longest(x, y)} ) {'1': 'one', '2': 'two', '3': 'three', '4': 'four'} list mathematical sum >>> n = ['1', '2', '3', '4'] >>> print( sum( list( map(int, n) ) ) ) 10 multiplication python Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:27 "},"programming/python/pip.html":{"url":"programming/python/pip.html","title":"pip","keywords":"","body":" Table of Contents generated with DocToc installation install pip cache dir and clean caches for global user (or non user) re-install package in site.USER_BASE setup default python version index-url & extra-index-url list pip package with url installation install pip from source code $ curl https://bootstrap.pypa.io/get-pip.py | python [--no-setuptools] [--no-wheel] # or $ curl https://bootstrap.pypa.io/get-pip.py | python3.2 # or $ curl https://bootstrap.pypa.io/get-pip.py | python - 'pip==8.0.0' example$ python get-pip.py --no-index --find-links=/local/copies $ python get-pip.py --user $ python get-pip.py --proxy=\"http://[user:passwd@]proxy.server:port\" $ python get-pip.py pip==9.0.2 wheel==0.30.0 setuptools==28.8.0 upgrade pip linux$ [sudo [-H]] pip install --upgrade pip windows> python -m pip install --upgrade pip from easy_install $ cd \\Scripts $ easy_install pip or $ curl -fsSL https://files.pythonhosted.org/packages/ba/2c/743df41bd6b3298706dfe91b0c7ecdc47f2dc1a3104abeb6e9aa4a45fa5d/ez_setup-0.9.tar.gz | tar xzf - -C . $ python ez_setup-0.9/ez_setup.py pip cache dir and clean caches clean cache ([pip cache](https://pip.pypa.io/en/stable/reference/pip_cache/))$ pip cache purge $ pip cache remove matplotlib set no cache ([pip config](https://pip.pypa.io/en/stable/reference/pip_config/)) $ pip install --no-cache-dir # or $ pip config set global.cache-dir false for global user (or non user) export PYTHONPATH=\"/usr/local/lib/python3.9/site-packages:$PYTHONPATH\" # load the user's $HOME/.pip/pip.conf $ sudo python -m pip install or # CANNOT load the user's $HOME/.pip/pip.conf $ sudo -H pip install re-install package in site.USER_BASE $ python -c 'import site; print(site.USER_BASE)' /Users/marslo/Library/Python/3.9 $ export PYTHONUSERBASE=\"$(python -c 'import site; print(site.USER_BASE)')\" $ pip install --upgrade --force-reinstall --user reference: Can I force pip to reinstall the current version? setup default python version # temporary $ export VERSIONER_PYTHON_VERSION=3.9 $ defaults write com.apple.versioner.python Version 3.9 index-url & extra-index-url reference: pip wheel pip error looking for private package in pypi $ pip config list global.extra-index-url='https://private.artifactory.com/artifactory/api/pypi/pypi-dev/simple' global.index-url='https://private.artifactory.com/artifactory/api/pypi/tools/simple' list pip package with url $ pip list --format=freeze | cut -d= -f1 | xargs pip show | awk '/^Name/{printf $2} /^Home-page/{print \": \"$2}' beautifulsoup4: http://www.crummy.com/software/BeautifulSoup/bs4/ certifi: https://certifiio.readthedocs.io/en/latest/ cffi: http://cffi.readthedocs.org chardet: https://github.com/chardet/chardet click: https://palletsprojects.com/p/click/ click-config-file: http://github.com/phha/click_config_file colorama: https://github.com/tartley/colorama commonmark: https://github.com/rtfd/commonmark.py compressed-rtf: https://github.com/delimitry/compressed_rtf configobj: https://github.com/DiffSK/configobj docker: https://github.com/docker/docker-py extract-msg: https://github.com/mattgwwalker/msg-extractor git-review: http://docs.openstack.org/infra/git-review/ idna: https://github.com/kjd/idna IMAPClient: https://github.com/mjs/imapclient/ Markdown: https://Python-Markdown.github.io/ mdv: http://github.com/axiros/terminal_markdown_viewer meson: https://mesonbuild.com olefile: https://www.decalage.info/python/olefileio pip: https://pip.pypa.io/ pprintpp: https://github.com/wolever/pprintpp psutil: https://github.com/giampaolo/psutil pycparser: https://github.com/eliben/pycparser Pygments: https://pygments.org/ pytz: http://pythonhosted.org/pytz PyUserInput: https://github.com/SavinaRoja/PyUserInput requests: https://requests.readthedocs.io rich: https://github.com/willmcgugan/rich setuptools: https://github.com/pypa/setuptools six: https://github.com/benjaminp/six soupsieve: https://github.com/facelessuser/soupsieve ssdfw-scripts: https://my.gerrit.com/a/storage/ssdfw/devops/scripts/devkit tabulate: https://github.com/astanin/python-tabulate typing-extensions: https://github.com/python/typing/blob/master/typing_extensions/README.rst tzlocal: https://github.com/regebro/tzlocal urllib3: https://urllib3.readthedocs.io/ websocket-client: https://github.com/websocket-client/websocket-client.git wheel: https://github.com/pypa/wheel xattr: http://github.com/xattr/xattr Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:27 "},"programming/python/qa.html":{"url":"programming/python/qa.html","title":"q&a","keywords":"","body":" Table of Contents generated with DocToc Q&A pkg_resources.VersionConflict ImportError: No module named pkg_resources No module named pip python install with tcl-tk Q&A pkg_resources.VersionConflict issue $ sudo -H pip install --upgrade pip ... $ pip --version Traceback (most recent call last): File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 584, in _build_master ws.require(__requires__) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 901, in require needed = self.resolve(parse_requirements(requirements)) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 792, in resolve raise VersionConflict(dist, req).with_context(dependent_req) pkg_resources.VersionConflict: (pip 20.1.1 (/Users/marslo/Library/Python/3.7/lib/python/site-packages), Requirement.parse('pip==20.0.2')) During handling of the above exception, another exception occurred: Traceback (most recent call last): File \"/usr/local/opt/python/bin/pip3\", line 6, in from pkg_resources import load_entry_point File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 3254, in @_call_aside File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 3238, in _call_aside f(*args, **kwargs) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 3267, in _initialize_master_working_set working_set = WorkingSet._build_master() File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 586, in _build_master return cls._build_from_requirements(__requires__) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 599, in _build_from_requirements dists = ws.resolve(reqs, Environment()) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 787, in resolve raise DistributionNotFound(req, requirers) pkg_resources.DistributionNotFound: The 'pip==20.0.2' distribution was not found and is required by the application $ which -a pip /usr/local/opt/python/libexec/bin/pip /usr/local/bin/pip $ la /usr/local/opt/python/libexec/bin/pip lrwxr-xr-x 1 marslo staff 14 Jul 6 18:23 /usr/local/opt/python/libexec/bin/pip -> ../../bin/pip3 $ /usr/local/opt/python/bin/pip3 --version Traceback (most recent call last): File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 584, in _build_master ws.require(__requires__) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 901, in require needed = self.resolve(parse_requirements(requirements)) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 792, in resolve raise VersionConflict(dist, req).with_context(dependent_req) pkg_resources.VersionConflict: (pip 20.1.1 (/Users/marslo/Library/Python/3.7/lib/python/site-packages), Requirement.parse('pip==20.0.2')) .... solution $ which -a pip /usr/local/opt/python/libexec/bin/pip /usr/local/bin/pip $ la /usr/local/opt/python/libexec/bin/pip lrwxr-xr-x 1 marslo staff 14 Jul 6 18:23 /usr/local/opt/python/libexec/bin/pip -> ../../bin/pip3 $ which -a pip3 /usr/local/bin/pip3 /usr/bin/pip3 ln -sf $ mv /usr/local/opt/python/bin/pip3{,.bak} $ ln -sf /usr/local/bin/pip3 /usr/local/opt/python/bin/pip3 re-install $ brew reinstall python $ sudo rm -rf /usr/local/lib/python3.7/site-packages/pip/ $ brew postinstall python $ pip --version pip 20.0.2 from /usr/local/lib/python3.7/site-packages/pip (python 3.7) $ sudo -H python3 -m pip install --force-reinstall pip $ pip --version pip 20.1.1 from /usr/local/lib/python3.7/site-packages/pip (python 3.7) ImportError: No module named pkg_resources precondition: $ which -a python /usr/local/opt/python/libexec/bin/python /usr/bin/python $ realpath /usr/bin/python /System/Library/Frameworks/Python.framework/Versions/2.7/bin/python2.7 issue $ /usr/bin/xattr Traceback (most recent call last): File \"/usr/bin/xattr\", line 8, in from pkg_resources import load_entry_point ImportError: No module named pkg_resources solution restore ~/Library/Python/2.7 $ mkdir -p ~/Library/Python/2.7/lib/python $ cp -r /usr/local/lib/python2.7/site-packages ~/Library/Python/2.7/lib/python/ $ sudo chown -R $(whoami):staff ~/Library/Python/2.7 # or $ sudo chown -R $USER:$(id -g) /Users/$USER/Library/Python result: $ /usr/bin/python -m pip list DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Package Version ---------------------------- --------- backports.ssl-match-hostname 3.7.0.1 certifi 2019.6.16 chardet 3.0.4 Click 7.0 click-config-file 0.5.0 colorama 0.4.1 configobj 5.0.6 docker 4.0.2 idna 2.8 ipaddress 1.0.22 Markdown 3.1.1 mdv 1.7.4 pip 19.1.1 Pygments 2.4.2 requests 2.22.0 setuptools 41.0.1 six 1.12.0 tabulate 0.8.3 urllib3 1.25.3 websocket-client 0.56.0 wheel 0.33.4 $ /usr/bin/xattr Traceback (most recent call last): File \"/usr/bin/xattr\", line 8, in from pkg_resources import load_entry_point File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 3241, in @_call_aside File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 3225, in _call_aside f(*args, **kwargs) File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 3254, in _initialize_master_working_set working_set = WorkingSet._build_master() File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 583, in _build_master ws.require(__requires__) File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 900, in require needed = self.resolve(parse_requirements(requirements)) File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 786, in resolve raise DistributionNotFound(req, requirers) pkg_resources.DistributionNotFound: The 'xattr==0.6.4' distribution was not found and is required by the application install setuptools==39.1.0 and xattr==0.6.4 $ sudo -H python -m pip install --upgrade pip setuptools wheel $ sudo -H /usr/bin/python -m pip uninstall -y setuptools $ /usr/bin/python -m pip install --user setuptools==39.1.0 DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Collecting setuptools==39.1.0 Installing collected packages: setuptools Found existing installation: setuptools 41.0.1 Uninstalling setuptools-41.0.1: Successfully uninstalled setuptools-41.0.1 Successfully installed setuptools-39.1.0 $ curl -fsSL https://raw.githubusercontent.com/marslo/ibook/master/programming/python/xattr-0.6.4.tar.gz -o xattr-0.6.4.tar.gz $ /usr/bin/python -m pip install --user xattr-0.6.4.tar.gz DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Processing ./xattr-0.6.4.tar.gz Building wheels for collected packages: xattr Building wheel for xattr (setup.py) ... done Stored in directory: /Users/marslo/Library/Caches/pip/wheels/63/db/04/be8c6e423b8158e30b1d63992368c899811286844edf41ce32 Successfully built xattr Installing collected packages: xattr WARNING: The script xattr is installed in '/Users/marslo/Library/Python/2.7/bin' which is not on PATH. Consider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location. Successfully installed xattr-0.6.4 result: $ /usr/bin/xattr -h usage: xattr [-lz] file [file ...] xattr -p [-lz] attr_name file [file ...] xattr -w [-z] attr_name attr_value file [file ...] xattr -d attr_name file [file ...] The first form lists the names of all xattrs on the given file(s). The second form (-p) prints the value of the xattr attr_name. The third form (-w) sets the value of the xattr attr_name to attr_value. The fourth form (-d) deletes the xattr attr_name. options: -h: print this help -l: print long format (attr_name: attr_value) -z: compress or decompress (if compressed) attribute value in zip format $ /usr/bin/python -m pip list DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Package Version ---------------------------- --------- backports.ssl-match-hostname 3.7.0.1 certifi 2019.6.16 chardet 3.0.4 Click 7.0 click-config-file 0.5.0 colorama 0.4.1 configobj 5.0.6 docker 4.0.2 idna 2.8 ipaddress 1.0.22 Markdown 3.1.1 mdv 1.7.4 pip 19.1.1 Pygments 2.4.2 requests 2.22.0 setuptools 39.1.0 six 1.12.0 tabulate 0.8.3 urllib3 1.25.3 websocket-client 0.56.0 wheel 0.33.4 xattr 0.6.4 reinstall xattr==0.6.4 for global [if necessary] $ sudo -H /usr/bin/python -m pip install xattr-0.6.4.tar.gz DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Processing /Users/marslo/Desktop/xattr-0.6.4.tar.gz Building wheels for collected packages: xattr Building wheel for xattr (setup.py) ... error ERROR: Complete output from command /System/Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python -u -c 'import setuptools, tokenize;__file__='\"'\"'/private/tmp/pip-req-build-dVgPOl/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' bdist_wheel -d /private/tmp/pip-wheel-ZV80PW --python-tag cp27: ERROR: usage: -c [global_opts] cmd1 [cmd1_opts] [cmd2 [cmd2_opts] ...] or: -c --help [cmd1 cmd2 ...] or: -c --help-commands or: -c cmd --help error: invalid command 'bdist_wheel' ---------------------------------------- ERROR: Failed building wheel for xattr Running setup.py clean for xattr Failed to build xattr Installing collected packages: xattr Found existing installation: xattr 0.6.4 Uninstalling xattr-0.6.4: Successfully uninstalled xattr-0.6.4 Running setup.py install for xattr ... done Successfully installed xattr-0.6.4 No module named pip issue $ sudo -H /usr/bin/python -m pip install --upgrade pip setuptools wheel /System/Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python: No module named pip solution $ sudo -H /usr/bin/python -m ensurepip --default-pip Looking in links: /tmp/tmpkmqQV6 Requirement already satisfied: setuptools in /Library/Python/2.7/site-packages (39.1.0) Collecting pip Installing collected packages: pip Successfully installed pip-18.1 verify $ sudo /usr/bin/python -m pip install --upgrade pip setuptools wheel DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality. WARNING: The directory '/Users/marslo/Library/Caches/pip' or its parent directory is not owned or is not writable by the current user. The cache has been disabled. Check the permissions and owner of that directory. If executing pip with sudo, you may want sudo's -H flag. Looking in indexes: https://my.artifactory.dev.com/artifactory/api/pypi/tools/simple Requirement already up-to-date: pip in /Users/marslo/Library/Python/2.7/lib/python/site-packages (20.2.4) Requirement already up-to-date: setuptools in /Users/marslo/Library/Python/2.7/lib/python/site-packages (44.1.1) Requirement already up-to-date: wheel in /Users/marslo/Library/Python/2.7/lib/python/site-packages (0.35.1) $ ls -Altrh /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python alternatives get-pip.py $ curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py $ /usr/bin/python get-pip.py python install with tcl-tk $ export PATH=\"/usr/local/opt/tcl-tk/bin:$PATH\" $ export LDFLAGS=\"-L/usr/local/opt/tcl-tk/lib\" $ export CPPFLAGS=\"-I/usr/local/opt/tcl-tk/include\" $ export PKG_CONFIG_PATH=\"/usr/local/opt/tcl-tk/lib/pkgconfig\" $ brew reinstall python Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:27 "},"programming/others.html":{"url":"programming/others.html","title":"others","keywords":"","body":" Table of Contents generated with DocToc Import data to SQL and print process Get the cnf file location for MySQL Get the git change from .git/objects unicode Simple arrows Arrows with modifications Arrows with bent tips Keyboard symbols and circle arrows Harpoons Paired arrows and harpoons Double arrows Miscellaneous arrows and keyboard symbols White arrows and keyboard symbols Miscellaneous arrows Import data to SQL and print process $ (pv -n ~/database.sql | mysql -u root -pPASSWORD -D database_name) 2>&1 | zenity --width 550 --progress --auto-close --auto-kill --title \"Im Get the cnf file location for MySQL $ mysql - ? | grep \".cnf\" -C 1 Default options are read from the following files in the given order: /etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/etc/my.cnf ~/.my.cnf The following groups are read: mysql client Get the git change from .git/objects $ find .git/objects -type f -printf \"%P\\n\" | sed s,/,, | while read object; do echo \"=== $obj $(git cat-file -t $object) ===\" git cat-file -p $object done unicode reference arrow Arrows amp-what Simple arrows CODE Symbols explanation 2190 ← LEFTWARDS ARROW 20EA ◌⃪ combining leftwards arrow overlay 2191 ↑ UPWARDS ARROW 2192 → RIGHTWARDS ARROW 2193 ↓ DOWNWARDS ARROW 2194 ↔ LEFT RIGHT ARROW 2195 ↕ UP DOWN ARROW 2196 ↖ NORTH WEST ARROW 2197 ↗ NORTH EAST ARROW 2198 ↘ SOUTH EAST ARROW 2199 ↙ SOUTH WEST ARROW Arrows with modifications CODE Symbols explanation 219A ↚ LEFTWARDS ARROW WITH STROKE 219B ↛ RIGHTWARDS ARROW WITH STROKE 219C ↜ LEFTWARDS WAVE ARROW 2B3F ⬿ wave arrow pointing directly left 219D ↝ RIGHTWARDS WAVE ARROW 219E ↞ LEFTWARDS TWO HEADED ARROW 219F ↟ UPWARDS TWO HEADED ARROW 21A0 ↠ RIGHTWARDS TWO HEADED ARROW 21A1 ↡ DOWNWARDS TWO HEADED ARROW 21A2 ↢ LEFTWARDS ARROW WITH TAIL 21A3 ↣ RIGHTWARDS ARROW WITH TAIL 21A4 ↤ LEFTWARDS ARROW FROM BAR 21A5 ↥ UPWARDS ARROW FROM BAR 21A6 ↦ RIGHTWARDS ARROW FROM BAR 21A7 ↧ DOWNWARDS ARROW FROM BAR 21A8 ↨ UP DOWN ARROW WITH BASE 21A9 ↩ LEFTWARDS ARROW WITH HOOK 21AA ↪ RIGHTWARDS ARROW WITH HOOK 21AB ↫ LEFTWARDS ARROW WITH LOOP 21AC ↬ RIGHTWARDS ARROW WITH LOOP 21AD ↭ LEFT RIGHT WAVE ARROW 21AE ↮ LEFT RIGHT ARROW WITH STROKE 21AF ↯ DOWNWARDS ZIGZAG ARROW Arrows with bent tips Other arrows with bent tips to complete this set can be found in the Miscellaneous Symbols and Arrows block. CODE Symbols explanation 21B0 ↰ UPWARDS ARROW WITH TIP LEFTWARDS 21B1 ↱ UPWARDS ARROW WITH TIP RIGHTWARDS 21B2 ↲ DOWNWARDS ARROW WITH TIP LEFTWARDS 21B3 ↳ DOWNWARDS ARROW WITH TIP RIGHTWARDS Keyboard symbols and circle arrows CODE Symbols explanation 21B4 ↴ RIGHTWARDS ARROW WITH CORNER DOWNWARDS 21B5 ↵ DOWNWARDS ARROW WITH CORNER LEFTWARDS 23CE ⏎ return symbol 21B6 ↶ ANTICLOCKWISE TOP SEMICIRCLE ARROW 21B7 ↷ CLOCKWISE TOP SEMICIRCLE ARROW 21B8 ↸ NORTH WEST ARROW TO LONG BAR 21B9 ↹ LEFTWARDS ARROW TO BAR OVER RIGHTWARDS ARROW TO BAR 21BA ↺ ANTICLOCKWISE OPEN CIRCLE ARROW 21BB ↻ CLOCKWISE OPEN CIRCLE ARROW Harpoons CODE Symbols explanation 21BC ↼ LEFTWARDS HARPOON WITH BARB UPWARDS 21BD ↽ LEFTWARDS HARPOON WITH BARB DOWNWARDS 21BE ↾ UPWARDS HARPOON WITH BARB RIGHTWARDS 21BF ↿ UPWARDS HARPOON WITH BARB LEFTWARDS 21C0 ⇀ RIGHTWARDS HARPOON WITH BARB UPWARDS 21C1 ⇁ RIGHTWARDS HARPOON WITH BARB DOWNWARDS 21C2 ⇂ DOWNWARDS HARPOON WITH BARB RIGHTWARDS 21C3 ⇃ DOWNWARDS HARPOON WITH BARB LEFTWARDS Paired arrows and harpoons CODE Symbols explanation 21C4 ⇄ RIGHTWARDS ARROW OVER LEFTWARDS ARROW 21C5 ⇅ UPWARDS ARROW LEFTWARDS OF DOWNWARDS ARROW 21C6 ⇆ LEFTWARDS ARROW OVER RIGHTWARDS ARROW 21C7 ⇇ LEFTWARDS PAIRED ARROWS 21C8 ⇈ UPWARDS PAIRED ARROWS 21C9 ⇉ RIGHTWARDS PAIRED ARROWS 21CA ⇊ DOWNWARDS PAIRED ARROWS 21CB ⇋ LEFTWARDS HARPOON OVER RIGHTWARDS HARPOON 21CC ⇌ RIGHTWARDS HARPOON OVER LEFTWARDS HARPOON Double arrows CODE Symbols explanation 21CD ⇍ LEFTWARDS DOUBLE ARROW WITH STROKE 21CE ⇎ LEFT RIGHT DOUBLE ARROW WITH STROKE 21CF ⇏ RIGHTWARDS DOUBLE ARROW WITH STROKE 21D0 ⇐ LEFTWARDS DOUBLE ARROW 21D1 ⇑ UPWARDS DOUBLE ARROW 21D2 ⇒ RIGHTWARDS DOUBLE ARROW 21D3 ⇓ DOWNWARDS DOUBLE ARROW 21D4 ⇔ LEFT RIGHT DOUBLE ARROW 21D5 ⇕ UP DOWN DOUBLE ARROW 21D6 ⇖ NORTH WEST DOUBLE ARROW 21D7 ⇗ NORTH EAST DOUBLE ARROW 21D8 ⇘ SOUTH EAST DOUBLE ARROW 21D9 ⇙ SOUTH WEST DOUBLE ARROW Miscellaneous arrows and keyboard symbols CODE Symbols explanation 21DA ⇚ LEFTWARDS TRIPLE ARROW 21DB ⇛ RIGHTWARDS TRIPLE ARROW 21DC ⇜ LEFTWARDS SQUIGGLE ARROW 2B33 ⬳ long leftwards squiggle arrow 21DD ⇝ RIGHTWARDS SQUIGGLE ARROW 21DE ⇞ UPWARDS ARROW WITH DOUBLE STROKE 21DF ⇟ DOWNWARDS ARROW WITH DOUBLE STROKE 21E0 ⇠ LEFTWARDS DASHED ARROW 21E1 ⇡ UPWARDS DASHED ARROW 21E2 ⇢ RIGHTWARDS DASHED ARROW 21E3 ⇣ DOWNWARDS DASHED ARROW 21E4 ⇤ LEFTWARDS ARROW TO BAR 21E5 ⇥ RIGHTWARDS ARROW TO BAR White arrows and keyboard symbols CODE Symbols explanation 21E6 ⇦ LEFTWARDS WHITE ARROW 2B00 ⬀ north east white arrow 21E7 ⇧ UPWARDS WHITE ARROW 21E8 ⇨ RIGHTWARDS WHITE ARROW 21E9 ⇩ DOWNWARDS WHITE ARROW 21EA ⇪ UPWARDS WHITE ARROW FROM BAR 21EB ⇫ UPWARDS WHITE ARROW ON PEDESTAL 21EC ⇬ UPWARDS WHITE ARROW ON PEDESTAL WITH HORIZONTAL BAR 21ED ⇭ UPWARDS WHITE ARROW ON PEDESTAL WITH VERTICAL BAR 21EE ⇮ UPWARDS WHITE DOUBLE ARROW 21EF ⇯ UPWARDS WHITE DOUBLE ARROW ON PEDESTAL 21F0 ⇰ RIGHTWARDS WHITE ARROW FROM WALL 21F1 ⇱ NORTH WEST ARROW TO CORNER 21F2 ⇲ SOUTH EAST ARROW TO CORNER 21F3 ⇳ UP DOWN WHITE ARROW 2B04 ⬄ left right white arrow Miscellaneous arrows CODE Symbols explanation 21F4 ⇴ RIGHT ARROW WITH SMALL CIRCLE 2B30 ⬰ left arrow with small circle 21F5 ⇵ DOWNWARDS ARROW LEFTWARDS OF UPWARDS ARROW 21F6 ⇶ THREE RIGHTWARDS ARROWS 2B31 ⬱ three leftwards arrows 21F7 ⇷ LEFTWARDS ARROW WITH VERTICAL STROKE 21F8 ⇸ RIGHTWARDS ARROW WITH VERTICAL STROKE 21F9 ⇹ LEFT RIGHT ARROW WITH VERTICAL STROKE 21FA ⇺ LEFTWARDS ARROW WITH DOUBLE VERTICAL STROKE 21FB ⇻ RIGHTWARDS ARROW WITH DOUBLE VERTICAL STROKE 21FC ⇼ LEFT RIGHT ARROW WITH DOUBLE VERTICAL STROKE 21FD ⇽ LEFTWARDS OPEN-HEADED ARROW 21FE ⇾ RIGHTWARDS OPEN-HEADED ARROW 21FF ⇿ LEFT RIGHT OPEN-HEADED ARROW Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:27 "},"programming/archive/archive.html":{"url":"programming/archive/archive.html","title":"archive","keywords":"","body":"Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-16 18:28:39 "},"programming/archive/angular/config.html":{"url":"programming/archive/angular/config.html","title":"angular","keywords":"","body":" Table of Contents generated with DocToc Download NodeJs Install yo Install compass by gem Install Angular Startup server Download NodeJs For 64bit ┌─ (marslo@MarsloJiao ~) -> └─ $ wget http://nodejs.org/dist/v0.10.29/node-v0.10.29-linux-x64.tar.gz For 32bit ┌─ (marslo@MarsloJiao ~) -> └─ $ wget http://nodejs.org/dist/v0.10.29/node-v0.10.29-linux-x86.tar.gz Install yo ┌─ (marslo@MarsloJiao ~) -> └─ $ sudo npm install -g yo Install compass by gem ┌─ (marslo@MarsloJiao ~) -> └─ $ sudo gem install compass The solution for kernel_require.rb:55:inrequire': libyaml-0.so.2: cannot open shared object file: No such file or directory - /../../psych.so (LoadError)` Install Angular ┌─ (marslo@MarsloJiao ~/client) -> └─ $ npm install generator-angular ┌─ (marslo@MarsloJiao ~/client) -> └─ $ yo angular ┌─ (marslo@MarsloJiao ~/client) -> └─ $ bower install Startup server ┌─ (marslo@MarsloJiao ~/client) -> └─ $ grunt serve Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:25 "},"programming/archive/maven/":{"url":"programming/archive/maven/","title":"maven","keywords":"","body":" Table of Contents generated with DocToc Compile and Execute java file by manual Compile and Execute by maven Scaffold in Maven Compile and Execute java file by manual Compile [16:59:13.56 C:\\hello-world\\src\\main\\java] $ javac com\\juvenxu\\mvnbook\\helloworld\\HelloWorld.java Execute [16:59:20.89 C:\\hello-world\\src\\main\\java] $ java com.juvenxu.mvnbook.helloworld.HelloWorld Hello Maven Compile and Execute by maven Compile [16:55:49.04 C:\\hello-world] $ mvn clean compile [INFO] Scanning for projects... [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 1.916 s [INFO] Finished at: 2014-11-28T17:02:36+08:00 [INFO] Final Memory: 12M/150M [INFO] ------------------------------------------------------------------------ Test [17:02:39.17 C:\\hello-world] $ mvn clean test [INFO] Scanning for projects... [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\test\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world --- [INFO] Surefire report directory: C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.juvenxu.mvnbook.helloworld.HelloWorldTest Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.06 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 4.639 s [INFO] Finished at: 2014-11-28T17:03:42+08:00 [INFO] Final Memory: 13M/159M [INFO] ------------------------------------------------------------------------ Package [18:36:28.23 C:\\hello-world] $ mvn clean package [INFO] Scanning for projects... [WARNING] [WARNING] Some problems were encountered while building the effective model for com.juvenxu.mvnbook:hello-world:jar:1.0-SNAPSHOT [WARNING] 'build.plugins.plugin.version' for org.apache.maven.plugins:maven-compiler-plugin is missing. @ line 21, column 15 [WARNING] [WARNING] It is highly recommended to fix these problems because they threaten the stability of your build. [WARNING] [WARNING] For this reason, future Maven versions might no longer support building such malformed projects. [WARNING] [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\test\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world --- [INFO] Surefire report directory: C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.juvenxu.mvnbook.helloworld.HelloWorldTest Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.06 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] [INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ hello-world --- [INFO] Building jar: C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 5.571 s [INFO] Finished at: 2014-11-28T18:36:41+08:00 [INFO] Final Memory: 15M/201M [INFO] ------------------------------------------------------------------------ Install [19:02:40.49 c:\\hello-world] $ mvn clean install [INFO] Scanning for projects... [WARNING] [WARNING] Some problems were encountered while building the effective model for com.juvenxu.mvnbook:hello-world:jar:1.0-SNAPSHOT [WARNING] 'build.plugins.plugin.version' for org.apache.maven.plugins:maven-compiler-plugin is missing. @ line 21, column 15 [WARNING] [WARNING] It is highly recommended to fix these problems because they threaten the stability of your build. [WARNING] [WARNING] For this reason, future Maven versions might no longer support building such malformed projects. [WARNING] [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\test\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world --- [INFO] Surefire report directory: c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.juvenxu.mvnbook.helloworld.HelloWorldTest Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.05 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] [INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ hello-world --- [INFO] Building jar: c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar [INFO] [INFO] --- maven-shade-plugin:1.2.1:shade (default) @ hello-world --- [INFO] Replacing original artifact with shaded artifact. [INFO] Replacing c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar with c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT-shaded.jar [INFO] [INFO] --- maven-install-plugin:2.4:install (default-install) @ hello-world --- [INFO] Installing c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar to C:\\Users\\marslo_jiao\\.m2\\repository\\com\\juvenxu\\mvnbook\\hello-world\\1.0-SNAPSHOT\\hello-world-1.0-SNAPSHOT.jar [INFO] Installing c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\pom.xml to C:\\Users\\marslo_jiao\\.m2\\repository\\com\\juvenxu\\mvnbook\\hello-world\\1.0-SNAPSHOT\\hello-world-1.0-SNAPSHOT.pom [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 5.429 s [INFO] Finished at: 2014-11-28T19:03:44+08:00 [INFO] Final Memory: 16M/201M [INFO] ------------------------------------------------------------------------ Verification [19:09:52.90 c:\\hello-world\\target] $ java -jar hello-world-1.0-SNAPSHOT.jar Hello Maven [19:09:57.52 c:\\hello-world\\target] $ jar xf hello-world-1.0-SNAPSHOT.jar [19:10:46.36 c:\\hello-world\\target] $ cat META-INF\\MANIFEST.MF Manifest-Version: 1.0 Archiver-Version: Plexus Archiver Built-By: Marslo_Jiao Created-By: Apache Maven 3.2.3 Build-Jdk: 1.8.0_25 Main-Class: com.juvenxu.mvnbook.helloworld.HelloWorld Scaffold in Maven Maven 3.x [13:05:17.08 C:\\archetype] $ mvn archetype:generate ... Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): 502: Choose org.apache.maven.archetypes:maven-archetype-quickstart version: 1: 1.0-alpha-1 2: 1.0-alpha-2 3: 1.0-alpha-3 4: 1.0-alpha-4 5: 1.0 6: 1.1 Choose a number: 6: Define value for property 'package': com.juvenxu.mvnbook: : com.juvenxu.mvnbook.helloworld Confirm properties configuration: groupId: com.juvenxu.mvnbook artifactId: hello-world version: 1.0-SNAPSHOT package: com.juvenxu.mvnbook.helloworld Y: : Y ... Maven 2.x $ mvn org.apache.maven.plugins:maven-archetype-plugin:2.0-alpha-5:generate Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:25 "},"programming/archive/mysql/installation/installDB.html":{"url":"programming/archive/mysql/installation/installDB.html","title":"mysql","keywords":"","body":" Table of Contents generated with DocToc The log of scripts/mysql_install_db --user=mysql The log of scripts/mysql_install_db --user=mysql Installing MySQL system tables...OK Filling help tables...OK To start mysqld at boot time you have to copy support-files/mysql.server to the right place for your system PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER ! To do so, start the server, then issue the following commands: ./bin/mysqladmin -u root password 'new-password' ./bin/mysqladmin -u root -h MJ password 'new-password' Alternatively you can run: ./bin/mysql_secure_installation which will also give you the option of removing the test databases and anonymous user created by default. This is strongly recommended for production servers. See the manual for more instructions. You can start the MySQL daemon with: cd . ; ./bin/mysqld_safe & You can test the MySQL daemon with mysql-test-run.pl cd mysql-test ; perl mysql-test-run.pl Please report any problems with the ./bin/mysqlbug script! The latest information about MySQL is available on the web at http://www.mysql.com Support MySQL by buying support/licenses at http://shop.mysql.com New default config file was created as ./my.cnf and will be used by default by the server when you start it. You may edit this file to change server settings Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:26 "},"programming/archive/mysql/installation/installFromSourceCode.html":{"url":"programming/archive/mysql/installation/installFromSourceCode.html","title":"installFromSourceCode","keywords":"","body":" Table of Contents generated with DocToc Install MySQL from Source code Usefull Links Compile and Install Configuration and Initial Set Environment Check the mysql port Check variables Make mysql as boot start Install MySQL from Source code Usefull Links Community Server 5.7 MySQL Community Server 5.6 MySQL Community Server MySQL source code mysql-5.7.3-m13.tar.gz mysql-5.6.16.tar.gz Documents MySQL Document MySQL Online manual 2.8.2. Installing MySQL Using a Standard Source Distribution 2.8.4. MySQL Source-Configuration Options Compile and Install Preconfiguration Setup Create user and group $ sudo groupadd mysql $ sudo useradd -r -g mysql mysql Extract tar.gz $ tar xf mysql-5.7.3-m13.tar.gz $ cd mysql-5.7.3-m13 Compile and Install $ cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\ > -DDEFAULT_CHARSET=gbk \\ > -DDEFAULT_COLLATION=gbk_chinese_ci \\ > -DENABLED_LOCAL_INFILE=ON \\ > -DWITH_INNOBASE_STORAGE_ENGINE=1 \\ > -DWITH_FEDERATED_STORAGE_ENGINE=1 \\ > -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\ > -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \\ > -DWITH_DEBUG=0 \\ > -DMYSQL_TCP_PORT=3306 $ make $ sudo make install cmake logs Configuration and Initial Permission Manager $ sudo chown -R mysql:mysql /usr/local/mysql Initial MySQL $ scripts/mysql_install_db --user=mysql $ cp support-files/mysql.server /etc/init.d/mysqld Log of mysql_install_db --user=mysql Change Permission again $ sudo chown -R root . $ sudo chown -R mysql data Start mysqld_safe $ sudo bin/mysqld_safe --user=mysql & Setup root password $ sudo ./bin/mysqladmin -u root password '' # Or $ sudo ./bin/mysql_secure_installation Log of mysql_secure_installatioin Set Environment $ sudo bash -c 'cat >> /etc/bash.bashrc' export PATH=/usr/local/mysql/bin:$PATH > EOF Check the mysql port $ sudo netstat -tunlp | grep 3306 tcp6 0 0 :::3306 :::* LISTEN 21712/mysqld Check variables $ mysqladmin variables -p Enter password: Make mysql as boot start $ sudo chkconfig --add mysqld $ sudo chkconfig --level 345 mysqld on Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:25 "},"programming/archive/mysql/installation/secureInstation.html":{"url":"programming/archive/mysql/installation/secureInstation.html","title":"secureInstation","keywords":"","body":" Table of Contents generated with DocToc Log for ./bin/mysql_secure_installation Log for ./bin/mysql_secure_installation $ sudo ./bin/mysql_secure_installation NOTE: RUNNING ALL THE STEPS FOLLOWING THIS IS RECOMMENDED FOR ALL MySQL SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY! In order to log into MySQL to secure it, we'll need the current password for the root user. If you've just installed MySQL, and you haven't set the root password yet, the password will be blank, so you should just press enter here. Enter password: OK, successfully used password, moving on... validate_password plugin is installed on the server. The subsequent steps will run with the existing configuration of the plugin. Setting the root password ensures that nobody can log into the MySQL root user without the proper authorisation. You already have a root password set. Strength of the password: 25 Change the root password? (Press y|Y for Yes, any other key for No) : n ... skipping. By default, a MySQL installation has an anonymous user, allowing anyone to log into MySQL without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment. Remove anonymous users? (Press y|Y for Yes, any other key for No) : y Success.. Moving on.. Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network. Disallow root login remotely? (Press y|Y for Yes, any other key for No) : n ... skipping. By default, MySQL comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment. Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y - Dropping test database... ... Success! - Removing privileges on test database... ... Success! Reloading the privilege tables will ensure that all changes made so far will take effect immediately. Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y ... Success! All done! If you've completed all of the above steps, your MySQL installation should now be secure. Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:26 "},"programming/archive/ruby/rubyInstallationBySourceCode.html":{"url":"programming/archive/ruby/rubyInstallationBySourceCode.html","title":"ruby","keywords":"","body":" Table of Contents generated with DocToc Yaml Ruby Thanks Yaml Download Yaml Lib Installation Download by wget ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby) -> └─ $ wget http://pyyaml.org/download/libyaml/yaml-0.1.6.tar.gz ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby) -> └─ $ tar xf yaml-0.1.6.tar.gz && cd yaml-0.1.6 Compile and installation ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/yaml-0.1.6) -> └─ $ ./configure --prefix=/usr/local ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby) -> └─ $ make && sudo make install Ruby Download official webiste Current Stable Ruby 2.1.2 Previous Stable Ruby 2.0.0-p481 Old Stable Ruby 1.9.3-p547 Ruby Installation Download by wget ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby) -> └─ $ wget http://cache.ruby-lang.org/pub/ruby/2.1/ruby-2.1.2.tar.gz ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby) -> └─ $ tar xf ruby-2.1.2.tar.gz && cd ruby-2.1.2 Compile and install ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2) -> └─ $ ./configure --prefix=/usr/local/ruby --enable-shared --with-opt-dir=/usr/local/lib ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2) -> └─ $ make && sudo make install Libs installation OpenSSL ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2) -> └─ $ cd ext/openssl ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ ruby extconf.rb ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ make && sudo make install Thanks collectiveidea.com Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:26 "},"programming/archive/ruby/rubyInstallationQ&A.html":{"url":"programming/archive/ruby/rubyInstallationQ&A.html","title":"rubyInstallationQ&A","keywords":"","body":" Table of Contents generated with DocToc openssl.h thread_native.h sqlite3.h libyaml-0.so.2 & psych.so openssl.h Error Description ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ ruby extconf.rb ... checking for openssl/ssl.h... no ... Solution Install openssl lib ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ sudo apt-get intall libssl-dev ┌─ (marslo@MarsloJiao ~) -> └─ $ dpkg -l | grep openssl ii libcurl3:amd64 7.35.0-1ubuntu2 amd64 easy-to-use client-side URL transfer library (OpenSSL flavour) ii libcurl4-openssl-dev:amd64 7.35.0-1ubuntu2 amd64 development files and documentation for libcurl (OpenSSL flavour) ii libgnutls-openssl27:amd64 2.12.23-12ubuntu2.1 amd64 GNU TLS library - OpenSSL wrapper ii openssl 1.0.1f-1ubuntu2.4 amd64 Secure Sockets Layer toolkit - cryptographic utility ii python-openssl 0.13-2ubuntu6 amd64 Python 2 wrapper around the OpenSSL library thread_native.h Error Description ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ make make: *** No rule to make target `/thread_native.h`, needed by `ossl.o`. Stop. Solution Add top_srcdir=../.. into Makefile (the 63th line as below) ┌─ (marslo@MarsloJiao ~/Tools/SourceCode/Ruby/ruby-2.1.2/ext/openssl) -> └─ $ grep top_srcdir Makefile -n 63: top_srcdir=../.. 279: ossl.o: $(top_srcdir)/thread_native.h $(top_srcdir)/thread_$(THREAD_MODEL).h sqlite3.h Error Description ┌─ (marslo@MarsloJiao ~) -> └─ $ gem install vmail ... Fetching: sqlite3-1.3.9.gem Building native extensions. This could take a while... ERROR: Error installing vmail: ERROR: Failed to build gem native extension. /usr/local/ruby/bin/ruby extconf.rb checking for sqlite3.h... no sqlite3.h is missing. Try 'port install sqlite3 +universal', 'yum install sqlite-devel' or 'apt-get install libsqlite3-dev' and check your shared library search path (the location where you sqlite3 shared library is located). *** extconf.rb failed *** ... Solution Install libsqlite3-dev in Ubuntu as the error logged ┌─ (marslo@MarsloJiao ~) -> └─ $ sudo apt-get install libsqlite3-dev libyaml-0.so.2 & psych.so Error Description ┌─ (marslo@MarsloJiao ~) -> └─ $ gem install compass /usr/local/ruby/lib/ruby/2.1.0/yaml.rb:4:in `': It seems your ruby installation is missing psych (for YAML output). To eliminate this warning, please install libyaml and reinstall your ruby. /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require': libyaml-0.so.2: cannot open shared object file: No such file or directory - /usr/local/ruby/lib/ruby/2.1.0/x86_64-linux/psych.so (LoadError) from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/psych.rb:1:in `' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/yaml.rb:5:in `' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/rubygems.rb:616:in `load_yaml' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/config_file.rb:328:in `load_file' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/config_file.rb:197:in `initialize' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/gem_runner.rb:74:in `new' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/gem_runner.rb:74:in `do_configuration' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/gem_runner.rb:39:in `run' from /usr/local/ruby/bin/gem:21:in `' Solution ┌─ (marslo@MarsloJiao ~) -> └─ # sudo apt-get install libyaml-dev Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:26 "},"tools/node/gitbook.html":{"url":"tools/node/gitbook.html","title":"tools","keywords":"gitbook","body":" Table of Contents generated with DocToc gitbook-cli installation initial book.json gitbook format hints tab code emoji Q&A if (cb) cb.apply(this, arguments) TypeError [ERR_INVALID_ARG_TYPE] in git init unexpected token: . reference: gitbook 简明教程 gitbook 入门教程 book.json emoji gitbook howto gitbook 安装配置 GitBook插件整理 - book.json Gitbook常用插件简介 gitbook使用及book.json详细配置 GitBookによるドキュメント作成 useful plugins gitbook-plugin-fbqx gitbook-cli installation install # mac $ brew install node # RHEL8 (https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-centos-8) $ sudo dnf module list nodejs $ sudo dnf module enable nodejs:12 $ sudo dnf install nodejs $ sudo npm i -g gitbook-cli [--save-dev] verify $ gitbook --version CLI version: 2.3.2 GitBook version: 3.2.3 check packages $ npm root -g /usr/local/lib/node_modules initial book.json gitbook install $ gitbook install info: installing 29 plugins using npm@3.9.2 info: info: installing plugin \"search-plus\" info: install plugin \"search-plus\" (^0.0.11) from NPM with version 0.0.11 /Users/marslo/mywork/tools/git/marslo/mbook └─┬ gitbook-plugin-search-plus@0.0.11 └── html-entities@1.2.0 .... gitbook install in fresh environment\" $ gitbook install --log=debug --debug Installing GitBook 3.2.3 SOLINK_MODULE(target) Release/.node CXX(target) Release/obj.target/fse/fsevents.o SOLINK_MODULE(target) Release/fse.node SOLINK_MODULE(target) Release/.node CXX(target) Release/obj.target/fse/fsevents.o SOLINK_MODULE(target) Release/fse.node gitbook@3.2.3 ../../var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/tmp-10600Rn1q3aFhRWiI/node_modules/gitbook ├── escape-html@1.0.3 ├── escape-string-regexp@1.0.5 ├── destroy@1.0.4 ├── ignore@3.1.2 ├── bash-color@0.0.4 ├── gitbook-plugin-livereload@0.0.1 ├── cp@0.2.0 ... alternatively $ gitbook serve Live reload server started on port: 35729 Press CTRL+C to quit ... info: 7 plugins are installed info: 31 explicitly listed Error: Couldn't locate plugins \"search-plus, simple-page-toc, github, github-buttons, prism, prism-themes, advanced-emoji, anchors, include-codeblock, ace, emphasize, katex, splitter, mermaid-gb3, tbfed-pagefooter, sectionx, local-video, anchor-navigation-ex, favicon, todo, alerts, include-csv, puml, sharing-plus, image-captions, donate, toggle-chapters, navigator, downloadpdf\", Run 'gitbook install' to install plugins from registry. gitbook install with proxy references: tbook install is not working when via proxy #33 Gitbook uses npmi, which requires npm-global, and npm-global further requires the currently installed npm on your machine. $ npm config set strict-ssl false $ npm config set proxy $http_proxy -g $ npm config set https-proxy $https_proxy -g gitbook format hints references: Simran-B/gitbook-plugin-callouts Hints and Callouts styles code info {% hint style='info' %} {% endhint %} tip {% hint style='tip' %} {% endhint %} danger {% hint style='danger' %} {% endhint %} warning {% hint style='warning' %} {% endhint %} success {% hint style='success' %} {% endhint %} success {% hint style='success' %} success {% endhint %} tip {% hint style='tip' %} info {% endhint %} or via [!TIP] [!TIP] > [!TIP] > tip > tip danger {% hint style='danger' %} danger {% endhint %} warning {% hint style='warning' %} warning {% endhint %} quote Important info: this note needs to be highlighted {% hint style='info' %} **Important info**: this *note* needs to be highlighted {% endhint %} tab [!TIP] this function only for native gitbook.io example: imarslo : kubernetes certicates reference: -Templating code gitbook.io {% tabs %} {% tab title=\"bash\" %} {% code title=\"filename: bash.sh\" %} # bash {% endcode %} {% endtab %} {% tab title=\"python\" %} python {% endtab %} {% endtabs %} gitbook-plugin-codetabs {% codetabs name=\"this is bash\", type=\"bash\" -%} # type=\"bash\" {%- language name=\"this is python\", type=\"python\" -%} # type=\"python\" {%- endcodetabs %} emoji reference: gist Emoji broken & new emojis Emojis list from https://api.github.com/emojis emoji-cheat-sheet.com emoji code :joy: :u7981: :u7121: :white_check_mark: :four_leaf_clover: Q&A if (cb) cb.apply(this, arguments) reference: How I fixed a \"cb.apply is not a function\" error while using Gitbook issue $ gitbook serve Live reload server started on port: 35729 Press CTRL+C to quit ... /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287 if (cb) cb.apply(this, arguments) ^ TypeError: cb.apply is not a function at /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287:18 solution: raw polyfills.js 62 fs.stat = statFix(fs.stat) 63 fs.fstat = statFix(fs.fstat) 64 fs.lstat = statFix(fs.lstat) fix polyfills.js 62 // fs.stat = statFix(fs.stat) 63 // fs.fstat = statFix(fs.fstat) 64 // fs.lstat = statFix(fs.lstat) TypeError [ERR_INVALID_ARG_TYPE] in git init issue $ gitbook init warn: no summary file in this book info: create README.md info: create SUMMARY.md TypeError [ERR_INVALID_ARG_TYPE]: The \"data\" argument must be of type string or an instance of Buffer, TypedArray, or DataView. Received an instance of Promise solution: downgrade the nodejs to 12.x.x purge nodejs$ brew uninstall node $ brew doctor $ brew cleanup --prune-prefix re-install node@12$ brew install node@12 $ brew link node@12 $ cat >> ~/.bash_profile unexpected token: . issue $ git serve ... unexpected token: . solution raw code '''bash $ k -n kube-system get pods \\ -o go-template \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' \\ | head ''' fixed code {% raw %} '''bash $ k -n kube-system get pods \\ -o go-template \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' \\ | head ''' {% endraw %} Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:19 "},"tools/node/node.html":{"url":"tools/node/node.html","title":"node & npm","keywords":"","body":" Table of Contents generated with DocToc npm configuration registry npm usage upgrade npm packages view details purge macOS QnA empty of npm ls -g env: node: No such file or directory reference: package.json NodeJs Quick Start npm configuration registry $ npm config -g set registry https://registry.npm.taobao.org $ npm config -g get registry https://registry.npm.taobao.org/ default: $ npm config get registry https://registry.npmjs.org/ $ npm config -g get registry https://registry.npmjs.org/ npm usage upgrade $ npm install -g npm-check-updates $ ncu -u or $ npm outdated -g --depth=0 Package Current Wanted Latest Location react-sticky 5.0.8 5.0.8 6.0.3 global $ npm update -g react-sticky npm packages view details $ npm view example $ npm view gitbook-cli gitbook-cli@2.3.2 | Apache-2.0 | deps: 11 | versions: 21 CLI to generate books and documentation using gitbook https://www.gitbook.com bin: gitbook dist .tarball: https://registry.npm.taobao.org/gitbook-cli/download/gitbook-cli-2.3.2.tgz .shasum: 5e893582e1f743f6fa920c3c3eb36b62ea4a31a0 dependencies: bash-color: 0.0.4 fs-extra: 3.0.1 npm: 5.1.0 optimist: 0.6.1 semver: 5.3.0 user-home: 2.0.0 commander: 2.11.0 lodash: 4.17.4 npmi: 1.0.1 q: 1.5.0 tmp: 0.0.31 maintainers: - aymeric-gb - gitbook-bot - jpreynat - samypesse dist-tags: latest: 2.3.2 published over a year ago by aarono purge macOS reference: uninstall node js from mac sudo rm -rf ~/.npm ~/.nvm ~/node_modules ~/.node-gyp ~/.npmrc ~/.node_repl_history sudo rm -rf /usr/local/bin/npm /usr/local/bin/node-debug /usr/local/bin/node /usr/local/bin/node-gyp sudo rm -rf /usr/local/share/man/man1/node* /usr/local/share/man/man1/npm* sudo rm -rf /usr/local/include/node /usr/local/include/node_modules sudo rm -rf /usr/local/lib/node /usr/local/lib/node_modules /usr/local/lib/dtrace/node.d sudo rm -rf /opt/local/include/node /opt/local/bin/node /opt/local/lib/node sudo rm -rf /usr/local/share/doc/node sudo rm -rf /usr/local/share/systemtap/tapset/node.stp brew uninstall node brew doctor brew cleanup --prune-prefix QnA empty of npm ls -g $ npm ls -g /usr/local/Cellar/node/15.0.1/lib └── (empty) solution $ brew rm node Uninstalling /usr/local/Cellar/node/15.0.1... (3,331 files, 61MB) $ brew install node Updating Homebrew... ==> Auto-updated Homebrew! Updated 2 taps (homebrew/core and homebrew/cask). ==> Updated Formulae Updated 3 formulae. ==> Updated Casks ithoughtsx ==> Downloading https://homebrew.bintray.com/bottles/node-15.0.1.catalina.bottle.tar.gz ==> Downloading from https://d29vzk4ow07wi7.cloudfront.net/9cdf039763f006eef0cc0aaebb13bc8173f017d961ac41c30f26d45a23ecffe0?response-content-dispositio ######################################################################## 100.0% ==> Pouring node-15.0.1.catalina.bottle.tar.gz ==> Caveats Bash completion has been installed to: /usr/local/etc/bash_completion.d ==> Summary ☕️ 🐸 /usr/local/Cellar/node/15.0.1: 3,331 files, 61MB verify $ npm ls -g /usr/local/lib ├── -@0.0.1 ├── commitizen@4.2.1 ├── ... └── verify-junit-xml@0.0.3 how to reproduce $ npm --version 7.0.3 $ npm root -g /usr/local/lib/node_module $ npm i -g npm@latest removed 51 packages, and changed 197 packages in 4s 2 packages are looking for funding run `npm fund` for details $ npm -v 6.14.8 $ npm root -g /usr/local/Cellar/node/15.0.1/lib/node_modules $ npm i -g npm@7.0.3 /usr/local/Cellar/node/15.0.1/bin/npm -> /usr/local/Cellar/node/15.0.1/lib/node_modules/npm/bin/npm-cli.js /usr/local/Cellar/node/15.0.1/bin/npx -> /usr/local/Cellar/node/15.0.1/lib/node_modules/npm/bin/npx-cli.js + npm@7.0.3 updated 248 packages in 6.481s $ npm -v 6.14.8 $ npm root -g /usr/local/Cellar/node/15.0.1/lib/node_modules deep investigation $ npm config -g ls -l | grep prefix ; prefix = \"/usr/local/Cellar/node/15.0.1\" ; overridden by builtin save-prefix = \"^\" tag-version-prefix = \"v\" prefix = \"/usr/local\" $ npm i -g npm@7.0.5 changed 1 package in 6s 10 packages are looking for funding run `npm fund` for details $ npm config -g ls -l | grep prefix prefix = \"/usr/local/Cellar/node/15.0.1\" save-prefix = \"^\" tag-version-prefix = \"v\" $ npm -v 7.0.5 $ npm ls -g /usr/local/Cellar/node/15.0.1/lib └── (empty) $ npm config -g set prefix '/usr/local' $ npm ls -g /usr/local/lib ├── -@0.0.1 ├── commitizen@4.2.1 ├── diff-so-fancy@1.3.0 ├── ... env: node: No such file or directory possible cause ╭─────────────────────────────────────────────────────────────────╮ │ │ │ New patch version of npm available! 6.14.8 → 6.14.10 │ │ Changelog: https://github.com/npm/cli/releases/tag/v6.14.10 │ │ Run npm install -g npm to update! │ │ │ ╰─────────────────────────────────────────────────────────────────╯ $ npm i -g npm /usr/local/bin/npx -> /usr/local/lib/node_modules/npm/bin/npx-cli.js /usr/local/bin/npm -> /usr/local/lib/node_modules/npm/bin/npm-cli.js + npm@6.14.10 added 435 packages from 887 contributors in 4.481s solution $ which node /usr/local/opt/node@12/bin/node $ sudo chown -R $(whoami) $(brew --prefix)/* $ brew link --overwrite node@12 Linking /usr/local/Cellar/node@12/12.20.0... 3808 symlinks created If you need to have this software first in your PATH instead consider running: echo 'export PATH=\"/usr/local/opt/node@12/bin:$PATH\"' >> /Users/marslo/.bash_profile Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:19 "},"tools/node/hexo.html":{"url":"tools/node/hexo.html","title":"hexo","keywords":"","body":" Table of Contents generated with DocToc prepare init add theme clone code install plugin generate new pages diable the default highlight settings prepare $ npm i -g hexo-cli init $ mkdir myblog && cd myblog $ hexo init $ hexo init INFO Cloning hexo-starter https://github.com/hexojs/hexo-starter.git INFO Install dependencies added 183 packages from 421 contributors and audited 189 packages in 22.277s 12 packages are looking for funding run `npm fund` for details found 0 vulnerabilities INFO Start blogging with Hexo! add theme credit belongs to snark clone code In a Git repoIn a folderUpdate theme$ git submodule add https://github.com/imarslo/hexo-theme-snark.git themes/snark$ git clone https://github.com/imarslo/hexo-theme-snark.git themes/snark $ sed '/highlight:/{n;s/^.*$/\\ \\ enable: false/}' -i _config.xml $ sed '/highlight:/{n;n;s/^.*$/\\ \\ line_number: false/}' -i _config.xml$ git submodule sync --recursive $ git submodule update --init --recursive install plugin $ npm install hexo-renderer-pug --save $ npm install hexo-renderer-sass --save $ npm install hexo-generator-feed --save $ npm install hexo-generator-search --save $ npm install hexo-generator-sitemap --save generate new pages $ hexo new page archives $ hexo new page categories $ hexo new page tags $ hexo new page about diable the default highlight settings default settings in _config.xml cmd with sedorresult$ sed '/highlight:/{n;s/^.*$/\\ \\ enable: false/;n;s/^.*$/\\ \\ line_number: false/;}' -i _config.xml$ sed '/highlight:/{n;s/^.*$/\\ \\ enable: false/}' -i _config.xml $ sed '/highlight:/{n;n;s/^.*$/\\ \\ line_number: false/}' -i _config.xml$ grep highlight: _config.yml -A 6 highlight: enable: false line_number: false auto_detect: false tab_replace: '' wrap: true hljs: false Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:19 "},"tools/node/github.page.html":{"url":"tools/node/github.page.html","title":"github.page","keywords":"","body":" Table of Contents generated with DocToc theme jekyll gh-pages Please use a personal access token instead token generation clean previous git credential theme reference: github.com » github.page theme jekyll-themes.com jekyllthemes.io jekyllthemes.org jamstackthemes.dev Solar DevJoural jekyll jellky usage install $ gem install github-pages Fetching em-websocket-0.5.1.gem Fetching colorator-1.1.0.gem Fetching eventmachine-1.2.7.gem ... start local service $ jekyll serve Configuration file: /Users/marslo/mywork/tools/git/marslo/marslo.github.io/_config.yml Source: /Users/marslo/mywork/tools/git/marslo/marslo.github.io Destination: /Users/marslo/mywork/tools/git/marslo/marslo.github.io/_site Incremental build: disabled. Enable with --incremental Generating... done in 0.593 seconds. Auto-regeneration: enabled for '/Users/marslo/mywork/tools/git/marslo/marslo.github.io' Server address: http://127.0.0.1:4000/ Server running... press ctrl-c to stop. gh-pages reference How to build and deploy a React app to Github pages in less than 5 minutes Please use a personal access token instead references: Authentication token format updates are generally available Creating a personal access token Other authentication methods jonjack/add-update-github-access-token-on-mac.md Updating credentials from the macOS Keychain Caching your GitHub credentials in Git Using the OS X Keychain to store and retrieve passwords Get Password from Keychain in Shell Scripts token generation login -> account -> settings -> Developer settings -> Personal access tokens clean previous git credential $ git credential-osxkeychain erase ⏎ host=github.com ⏎ protocol=https ⏎ ⏎ # and clean the previous git credential in keychain Access.app $ security delete-internet-password -l github.com check git credential helper $ git config --get credential.helper osxkeychain find item in keychain $ security find-internet-password -l github.com read password imarslo : read password in osx $ sudo security find-internet-password -ws github.com [-a ] or read all information $ sudo security find-internet-password -gs github.com Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:19 "},"tools/atlassian.html":{"url":"tools/atlassian.html","title":"Jira & Confluence","keywords":"","body":" Table of Contents generated with DocToc jira check fields check attachment generate OAuth consumer confluence get info publish to confluence reference: * Confluence REST API examples * Jira REST API examples Confluence Server REST API JIRA Server platform REST API reference jira $ jiraName='my.jira.com' $ jiraID='STORY-1' check fields $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID} | jq --raw-output check attachment check attachment ID $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID}?fields=attachment | jq --raw-output .fields.attachment[].id get attachments download url $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID}?fields=attachment | jq --raw-output .fields.attachment[].content download all attachments in Jira -I replace-str Replace occurrences of replace-str in the initial-arguments with names read from standard in- put. Also, unquoted blanks do not terminate input items; instead the separator is the new- line character. Implies -x and -L 1. $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID}?fields=attachment | jq --raw-output .fields.attachment[].content | xargs -I '{}' curl -sgOJL '{}' generate OAuth consumer $ openssl genrsa -out jira_privatekey.pem 1024 $ openssl req -newkey rsa:1024 -x509 -key jira_privatekey.pem -out jira_publickey.cer -days 365 $ openssl pkcs8 -topk8 -nocrypt -in jira_privatekey.pem -out jira_privatekey.pcks8 $ openssl x509 -pubkey -noout -in jira_publickey.cer > jira_publickey.pem confluence $ confluenceName='my.confluence.com' $ pageID='143765713' get page id: get info $ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq --raw-output get space$ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .space.key get title$ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .title get page history $ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .version.number get next versioncurrentVer=$(curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .version.number) newVer=$((currentVer+1)) publish to confluence sample script $ url=\"https://${confluenceName}/rest/api/content/${pageID}\" $ page=$(curl -s ${url}) $ space=$(echo \"${page}\" | jq .space.key) $ title=$(echo \"${page}\" | jq .title) $ currentVer=$(echo \"${page}\" | jq .version.number) $ newVer=$((currentVer+1)) $ cat > a.json Hi confluence\", \"representation\": \"storage\" } }, \"version\": {\"number\":${newVer}} } EOF $ curl -s \\ -i \\ -X PUT \\ -H 'Content-Type: application/json' \\ --data \"$(cat a.json)\" \\ https://${confluenceName}/rest/api/content/${pageID} result Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:19 "},"tools/app/app.html":{"url":"tools/app/app.html","title":"app","keywords":"","body":" Table of Contents generated with DocToc recommend apps screenshot keystore gif development system recommend apps screenshot jietu snagit snipaste ⇠ for windows keystore Visualize cn us keyCastr captin Carnac ⇠ for windows gif GIF Brewery 3 by Gfycat caches: $HOME/Movies/GIF Brewery 3/*.mp4 cn us LICEcap development macvim RegExRX cn us iTerm2 dash doctoc gnomon system psSafe iStat Menus Moon Alfed backup: user path: $HOME/Library/Application Support/Alfred Chrome Canary chrome extension downloader Chromium Karabiner-Elements Saviour of MadCatz R.A.T in MacOS Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:17 "},"tools/app/ms.html":{"url":"tools/app/ms.html","title":"microsoft office","keywords":"","body":" Table of Contents generated with DocToc outlook ms office logs reference: pbowden-msft/Unlicense Rebuild the Office database Outlook 2016 for Mac repeatedly prompts for authentication Office for Mac repeatedly requesting keychain access If your Mac keeps asking for the login keychain password How to remove Office license files on a Mac Troubleshoot install or activation errors for Office for Mac Configure keychain download Microsoft Office 16.45.21011103 Microsoft_Office_16.45.21011103_BusinessPro_Installer.pkg Microsoft_Word_16.45.21011103_Installer.pkg Update history for Office for Mac Release notes for Office for Mac Activate Office 2019 for macOS VoL.md Uninstall Office for Mac Release history for Microsoft Auto Update (MAU) Q&A \"There is a problem with your account. Try again later.\" - Mac (Sierra) Office 365 Business won't activate on Mac How to troubleshoot issues that you encounter when you sign in to Office apps for Mac, iPad, iPhone, or iPod Touch when using Active Directory Federation Services outlook profile $ ls ~/Library/Group Containers/UBF8T346G9.Office/Outlook/Outlook 15 Profiles/ reset outlook profile $ open \"/Applications/Microsoft Outlook.app/Contents/SharedSupport/Outlook Profile Manager.app\" ms office uninstall completely If you still meet the issue, I suggest you try the following steps and resign into Office to check the result: Navigated to Library folder and open Group Containers. Ctrl+click each of these folders if present, and Move to Trash. UBF8T346G9.ms UBF8T346G9.Office UBF8T346G9.OfficeOsfWebHost Warning: Outlook data will be removed when you move the three folders listed in this step to Trash. You should back up these folders before you delete them. $ ls -1d ~/Library/Group\\ Containers/UBF8T346G9.*/ /Users/marslo/Library/Group Containers/UBF8T346G9.Office/ /Users/marslo/Library/Group Containers/UBF8T346G9.OfficeOneDriveSyncIntegration/ /Users/marslo/Library/Group Containers/UBF8T346G9.OfficeOsfWebHost/ /Users/marslo/Library/Group Containers/UBF8T346G9.OneDriveStandaloneSuite/ /Users/marslo/Library/Group Containers/UBF8T346G9.com.microsoft.rdc/ /Users/marslo/Library/Group Containers/UBF8T346G9.ms/ pbowden-msft/Unlicense [FIX] Error When Opening Word or Outlook on Mac (EXC_BAD_INSTRUCTION) How to remove Office license files on a Mac Having problems with Office and Outlook for Mac 2016 (Sept/Oct 2017) logs word: ~/Library/Containers/com.microsoft.Word /Data/Library/Caches/Microsoft/uls/ Com.microsoft.Word /logs$ tail -f ~/Library/Containers/com.microsoft.Word/Data/Library/Caches/Microsoft/uls/com.microsoft.Word/logs/apple-device-log-20210114-2301.log Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:18 "},"tools/app/virtualbox.html":{"url":"tools/app/virtualbox.html","title":"virtualbox","keywords":"","body":" Table of Contents generated with DocToc install from commandline uninstall install vms Run Windows 10 on Mac with VirtualBox for Mac OS X vboxmanager list run delete vms troubleshooting collect debug report Result Code: NS_ERROR_FAILURE (0x80004005) install from commandline $ hdiutil attach VirtualBox-6.0.24-139119-OSX.dmg $ sudo installer -pkg /Volumes/VirtualBox/VirtualBox.pkg -target / # or $ usr/bin/sudo -E -- /usr/bin/env LOGNAME=marslo USER=marslo USERNAME=marslo \\ /usr/sbin/installer -pkg /usr/local/Caskroom/virtualbox-beta/6.1.0_BETA2,134221/VirtualBox.pkg \\ -target / \\ -applyChoiceChangesXML /var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/choices20201221-6005-wroatz.xml uninstall VirtualBox_Uninstall.tool) install vms Run Windows 10 on Mac with VirtualBox for Mac OS X vboxmanager setup VboxManager completion $ git clone https://github.com/alexandregz/VBoxManage-completion.git \\ ~/.marslo/completion $ cat >> ~/.marslo/.marslorc list $ VBoxManage list vms run $ VBoxManage startvm ubuntu --type gui delete vms $ VBoxManage unregistervm --delete \"Name of Virtual Machine\" troubleshooting collect debug report $ VBoxBugReport Oracle VM VirtualBox Bug Report Tool 6.1.16 (C) 2020 Oracle Corporation All rights reserved. 0% - collecting VBoxSVC.log... 20% - collecting VBoxSVC.log.1... 40% - collecting VirtualBox.xml... 60% - collecting HostUsbDevices... 80% - collecting HostUsbFilters... 100% - compressing... Report was written to '2020-12-21-11-03-22-bugreport.tgz' Result Code: NS_ERROR_FAILURE (0x80004005) test builds disable System Integrity Protection first macOS$ csrutil status $ csrutil disable solution $ csrutil enable --without debug --without fs $ VBOX_KEXT_DESTINATION=/Library/Apple/System/Library/Extensions $ sudo cp -a \"/Library/Application Support/VirtualBox/VBoxDrv.kext\" \"$VBOX_KEXT_DESTINATION\"/VBoxDrv.kext $ sudo cp -a \"/Library/Application Support/VirtualBox/VBoxNetFlt.kext\" \"$VBOX_KEXT_DESTINATION\"/VBoxNetFlt.kext $ sudo cp -a \"/Library/Application Support/VirtualBox/VBoxNetAdp.kext\" \"$VBOX_KEXT_DESTINATION\"/VBoxNetAdp.kext $ sudo cp -a \"/Library/Application Support/VirtualBox/VBoxUSB.kext\" \"$VBOX_KEXT_DESTINATION\"/VBoxUSB.kext $ sudo kextload -b org.virtualbox.kext.VBoxDrv $ sudo kextload -b org.virtualbox.kext.VBoxNetFlt $ sudo kextload -b org.virtualbox.kext.VBoxNetAdp $ sudo kextload -b org.virtualbox.kext.VBoxUSB and$ sudo kextload -b org.virtualbox.kext.VBoxDrv $ sudo kextload -b org.virtualbox.kext.VBoxNetFlt $ sudo kextload -b org.virtualbox.kext.VBoxNetAdp $ sudo kextload -b org.virtualbox.kext.VBoxUSB other info $ sudo kmutil showloaded | grep org.virtualbox No variant specified, falling back to release 196 3 0xffffff7fa2336000 0xb2000 0xb2000 org.virtualbox.kext.VBoxDrv (6.1.16) DAF044F0-5043-3B8E-8758-5A462567BDAA 197 0 0xffffff7fa2408000 0x2000 0x2000 org.virtualbox.kext.VBoxNetAdp (6.1.16) 76200407-D2F0-3D84-BCCF-7EEA18F16654 199 0 0xffffff7fa2413000 0x5000 0x5000 org.virtualbox.kext.VBoxUSB (6.1.16) CA33FA52-5933-3F0E-9B40-8B1ECF4D6A36 200 0 0xffffff7fa240e000 0x4000 0x4000 org.virtualbox.kext.VBoxNetFlt (6.1.16) C93EAF6A-676F-3370-BAE2-BDFD2BF16582 $ sudo kmutil load -b org.virtualbox.kext.VBoxDrv $ sudo dmesg Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:18 "},"tools/app/iterm2.html":{"url":"tools/app/iterm2.html","title":"iterm2","keywords":"","body":" Table of Contents generated with DocToc tab setup a colorful tab add favor color to a file (~/.marslo/.colors) hidden settings iTerm2 Python REPL tab setup a colorful tab pick colors using : tabset --list > $ while read i; do > c=$(echo $i | awk -F':' '{print $1}'); > echo === $c === ; > tabset --add m-$c $c; > done add favor color to a file (~/.marslo/.colors) $ echo \"\" >> ~/.marslo/.colors get color hex (for it2setcolor) [!TIP] download original csscolor.js if necessory: $ curl -fsSL -O https://raw.githubusercontent.com/jonathaneunice/iterm2-tab-set/master/csscolors.js $ while read -r i; do > rgb=$(grep -E \"\\s$i:\" csscolors.js | sed -re \"s:.*\\[(.*)\\],?$:\\1:\";) > hexc=$(for c in $(echo ${rgb} | sed -re 's:,::g'); do printf '%x' $c; done) > echo -e \"\"\"$i :\\t$rgb :\\t$hexc\"\"\" > echo \"$hexc\" >> ~/.marslo/.it2color > done result: $ ./rgb2hex.sh yellowgreen : 154, 205, 50 : 9acd32 wheat : 245, 222, 179 : f5deb3 tomato : 255, 99, 71 : ff6347 steelblue : 70, 130, 180 : 4682b4 tan : 210, 180, 140 : d2b48c sandybrown : 244, 164, 96 : f4a460 plum : 221, 160, 221 : dda0dd palegoldenrod : 238, 232, 170 : eee8aa palegreen : 152, 251, 152 : 98fb98 navajowhite : 255, 222, 173 : ffdead olive : 128, 128, 0 : 80800 moccasin : 255, 228, 181 : ffe4b5 chartreuse : 127, 255, 0 : 7fff0 palegreen : 152, 251, 152 : 98fb98 mediumorchid : 186, 85, 211 : ba55d3 royalblue : 65, 105, 225 : 4169e1 olivedrab : 107, 142, 35 : 6b8e23 khaki : 240, 230, 140 : f0e68c show color in iterm2 $ cat ~/.profile # iTerm2 tab titles function itit { if [ \"$1\" ]; then unset PROMPT_COMMAND echo -ne \"\\\\033]0;${1}\\\\007\" if [ 2 -eq $# ]; then case $2 in [cC] ) it2setcolor tab $(shuf -n 1 ~/.marslo/.it2colors) || echo ;; [bB] ) printf \"\\e]1337;SetBadgeFormat=%s\\a\" $(echo -n \"${1} \\(user.gitBranch)\" | base64) ;; [bB][cC] | [cC][bB] ) printf \"\\e]1337;SetBadgeFormat=%s\\a\" $(echo -n \"${1}\" | base64) it2setcolor tab $(shuf -n 1 ~/.marslo/.it2colors) || echo ;; esac fi else export PROMPT_COMMAND='echo -ne \"\\033]0;${PWD/#$HOME/\\~}\\007\";' printf \"\\e]1337;SetBadgeFormat=%s\\a\" $(echo -n \"\" | base64) it2setcolor tab default fi } EOF usage:$ itit 'title-string-here' [c][b] result: c\"> hidden settings To change the number of entries in the autocomplete menu: $ defaults write com.googlecode.iterm2 AutocompleteMaxOptions -int 10 To change the number of coprocess commands remembered: $ defaults write com.googlecode.iterm2 \"Coprocess MRU\" -int 10 To preserve whitespace in selections copied to the pasteboard: $ defaults write com.googlecode.iterm2 TrimWhitespaceOnCopy -bool false When you open a file from the finder in iTerm2 (e.g., by double-clicking a shell script), it will either open in a window or a tab. By default, it opens in a tab. You can change this with: $ defaults write com.googlecode.iterm2 OpenFileInNewWindows -bool true quite iTerm2 when the last session is closed $ defaults write com.googlecode.iterm2 MinRunningTime -float 10.0 increase the delay before it attempts to reconfigure itself after a change of monitors $ defaults write com.googlecode.iterm2 UpdateScreenParamsDelay -float 1.0 To change the number of paste history entries saved: defaults write com.googlecode.iterm2 MaxPasteHistoryEntries -int 20 Pastes (both regular and slow) are done by splitting the text to paste into chunks. There is a delay between the transmission of each chunk. To change the speed that \"paste\" pastes at: $ defaults write com.googlecode.iterm2 QuickPasteBytesPerCall -int 1024 $ defaults write com.googlecode.iterm2 QuickPasteDelayBetweenCalls -float 0.01 To change the speed that \"paste slowly\" pastes at: $ defaults write com.googlecode.iterm2 SlowPasteBytesPerCall -int 16 $ defaults write com.googlecode.iterm2 SlowPasteDelayBetweenCalls -float 0.125 To disable using the pinch gesture to change font size: $ defaults write com.googlecode.iterm2 PinchToChangeFontSizeDisabled -bool true To keep LC_CTYPE from being set when locale environment variables are set: $ defaults write com.googlecode.iterm2 DoNotSetCtype -bool true To allow Growl notifications to be posted for the current tab: $ defaults write com.googlecode.iterm2 GrowlOnForegroundTabs -bool true To tune smart cursor color settings: $ defaults write com.googlecode.iterm2.plist SmartCursorColorBgThreshold -float 0.5 $ defaults write com.googlecode.iterm2.plist SmartCursorColorFgThreshold -float 0.75 To allow a three-finger tap to act like a three-finger click: $ defaults write com.googlecode.iterm2.plist ThreeFingerTapEmulatesThreeFingerClick \\ -bool true To change the set of characters that are considered part of a URL (besides alphanumerics): $ defaults write com.googlecode.iterm2.plist URLCharacterSet -string \\ \".?\\\\/:;%=&_-,+~#@!*'()|[]\" To use some experimental optimizations that will improve performance (safety not guaranteed): $ defaults write com.googlecode.iterm2.plist ExperimentalOptimizationsEnabled \\ -bool true To tweak tab sizes: $ defaults write com.googlecode.iterm2 UseUnevenTabs -bool false $ defaults write com.googlecode.iterm2 MinTabWidth -int 75 $ defaults write com.googlecode.iterm2 MinCompactTabWidth -int 60 $ defaults write com.googlecode.iterm2 OptimumTabWidth -int 175 To change your search engine: $ defaults write com.googlecode.iterm2 SearchCommand \\ -string \"http://google.com/search?q=%@\" To adjust the speed of the animation of the hotkey window's appearance and disappearance: $ defaults write com.googlecode.iterm2 HotkeyTermAnimationDuration \\ -float 0.25 To adjust the amount of dimming of split panes. Set the value to a floating-point number between 0 (no dimming) and 1 (complete dimming). The default is 0.15: $ defaults write com.googlecode.iterm2 SplitPaneDimmingAmount \\ -float 0.25 iTerm2 Python REPL Welcome to the iTerm2 Python REPL! This is an interactive Python interpreter where you can experiment with scripts. Unlike standard Python interpreters, you can use \"await\" not inside an async function. Here's an example script to try: import iterm2 connection=await iterm2.Connection.async_create() await iterm2.Window.async_create(connection) ⌘-click here for iTerm2 Python API Docs >>> Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:18 "},"tools/app/browser.html":{"url":"tools/app/browser.html","title":"browser","keywords":"","body":" Table of Contents generated with DocToc firefox restart firefox customized firefox style chrome shortcut firefox restart firefox about:restartrequired customized firefox style userChrome.css Profiles - Where Firefox stores your bookmarks, passwords and other user data How To Customise Firefox 57+ UI with userChrome.css Aris-t2/CustomCSSforFx Steps: Open your currently active profile folder Create a new folder named chrome Create a desktop shortcut (alias) to the chrome folder for easier future access Make sure your OS is set to show you file extensions like .txt and .css Create a new text file inside the chrome folder named userChrome.css Change a preference in Firefox so it looks for your files at startup (in Firefox 69+) Unlock custom CSS usage in Firefox 69 and newer about:config toolkit.legacyUserProfileCustomizations.stylesheets true Where to find Firefox profile folder? The correct location for user styles about:support > Profile Folder > Open Folder or about:profiles > Root Directory > Open Folder User styles belong into \\chrome\\ folder Inspect ui or web content Enable once Tools > WebDeveloper > Toggle Tools > 'Customize Tools and get help button' > Settings > Enable browser chrome and add-on debugging toolboxes Tools > WebDeveloper > Toggle Tools > 'Customize Tools and get help button' > Settings > Enable remote debugging Hit Ctrl+Alt+Shift+I or open Tools > WebDeveloper > Browser Toolbox remove blue line for active tab How to hide or change the color of the blue line over the tab? /* Hide blue stripe on active tab */ .tab-line[selected=\"true\"] { opacity: 0 !important; } Take Out Blue On Top Of Tab .tab-line { display: none !important; } Is there any way to disable the blue line on top of the currently selected tab? #TabsToolbar .tabbrowser-tab[selected] .tab-line { display: none !important; } or #TabsToolbar .tabbrowser-tab .tab-line { display: none !important; } [help] The blue line on top of active tab is back in Firefox 60 #tabbrowser-tabs { --tab-line-color: var(--lwt-accent-color) !important; } Change active tab line color in Tree Style Tabs? :root .tab .highlighter::before { } How to remove the thin blue bar on top of active tabs?.tab-line { background-color:#f5f6f7 !important; } or.tabbrowser-tab:not([selected=\"true\"]):hover .tab-line { background-color: #cccdcf !important; } [SOLVED] How to change active tab background color in css? #main-window[lwthemetextcolor=bright] tab[selected=\"true\"] { color: blue !important; } #main-window[lwthemetextcolor=bright] tab[selected=\"true\"] .tab-background { background-color: gold !important; background-image: none !important; } or /* ACTIVE TAB BACKGROUND COLOR */ .tab-content[selected=\"true\"] { background: rgba(65, 85, 145, 0.4) !important; } chrome shortcut shift + w : move tab to new windows Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:17 "},"tools/app/skype.html":{"url":"tools/app/skype.html","title":"skype","keywords":"","body":" Table of Contents generated with DocToc Install skype in Ubuntu 64bit Install skype in Ubuntu 64bit Inspired from AskUbuntu Add i386 architecture $ sudo dpkg --add-architecture i386 $ sudo apt-get update Add Repo and install by apt-get $ sudo add-apt-repository \"deb http://archive.canonical.com/ $(lsb_release -sc) partner\" $ sudo apt-get update && sudo apt-get install skype OR Add by dpkg $ wget http://www.skype.com/go/getskype-linux-ubuntu-64/skype-ubuntu-quantal_4.1.0.20-1_amd64.deb $ sudo dpkg -i skype-ubuntu*.deb Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:18 "},"tools/app/teamviewer.html":{"url":"tools/app/teamviewer.html","title":"teamviewer","keywords":"","body":" Table of Contents generated with DocToc teamviewer installation. Inspired from Official Help teamviewer installation. Inspired from Official Help Add i386 architecture$ sudo dpkg --add-architecture i386 $ sudo apt-get update download teamview deb $ wget http://downloadeu2.teamviewer.com/download/teamviewer_linux.deb install the dependency by apt-get $ sudo apt-get install -f install teamviewer by dpkg $ sudo dpkg -i teamviewer_linux.deb Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:18 "},"tools/app/others.html":{"url":"tools/app/others.html","title":"others","keywords":"","body":" Table of Contents generated with DocToc shadowsocks service CentOS copy artical content from csdn color picker iterm2-tab-set terminal-colors 256 Foreground and Background Colors - Full Chart shadowsocks service CentOS basic environment $ sudo yum install python-setuptools && sudo easy_install pip $ sudo yum install epel-release $ sudo yum install libsodium # for aes-256-gcm $ sudo yum -y groupinstall \"Development Tools\" $ sudo yum -y install python3-pip # optional $ sudo -H python3 -m pip install --upgrade pip git $ sudo bash -c \"cat > /etc/yum.repos.d/wandisco-git.repo\" or nhahv/install_git2.x_on_centos.md$ sudo yum install http://opensource.wandisco.com/centos/6/git/x86_64/wandisco-git-release-6-1.noarch.rpm $ sudo yum install -y git copy artical content from csdn download html to local remove auto-switch to homepage function in html or remove all *.js ( and might be all *.css ) open the html in MS Word bingo! color picker references: The 5 Best Color Picker Apps for Mac 256 Colors Cheat Sheet iterm2-tab-set installation$ npm i iterm2-tab-set usage $ tabset --pick function cpick () { if test tabset; then rgb=$(tabset -p | sed -nr \"s:.*rgb\\(([^)]+)\\).*$:\\1:p\"); hexc=$(for c in $(echo \"${rgb}\" | sed -re 's:,: :g'); do printf '%02x' \"$c\"; done); echo -e \"\"\"\\t$rgb ~~> $hexc\"\"\"; fi } result$ cpick 125,199,53 ~~> 7dc735 terminal-colors install $ python3 -m pip install terminal-colors usage $ terminal-colors -l 256 Foreground and Background Colors - Full Chart Code Description 0 black 1 red 2 green 3 yellow 4 blue 5 magenta 6 cyan 7 light_gray 8 dark_gray 9 light_red 10 light_green 11 light_yellow 12 light_blue 13 light_magenta 14 light_cyan 15 white 16 grey_0 17 navy_blue 18 dark_blue 19 blue_3a 20 blue_3b 21 blue_1 22 dark_green 23 deep_sky_blue_4a 24 deep_sky_blue_4b 25 deep_sky_blue_4c 26 dodger_blue_3 27 dodger_blue_2 28 green_4 29 spring_green_4 30 turquoise_4 31 deep_sky_blue_3a 32 deep_sky_blue_3b 33 dodger_blue_1 34 green_3a 35 spring_green_3a 36 dark_cyan 37 light_sea_green 38 deep_sky_blue_2 39 deep_sky_blue_1 40 green_3b 41 spring_green_3b 42 spring_green_2a 43 cyan_3 44 dark_turquoise 45 turquoise_2 46 green_1 47 spring_green_2b 48 spring_green_1 49 medium_spring_green 50 cyan_2 51 cyan_1 52 dark_red_1 53 deep_pink_4a 54 purple_4a 55 purple_4b 56 purple_3 57 blue_violet 58 orange_4a 59 grey_37 60 medium_purple_4 61 slate_blue_3a 62 slate_blue_3b 63 royal_blue_1 64 chartreuse_4 65 dark_sea_green_4a 66 pale_turquoise_4 67 steel_blue 68 steel_blue_3 69 cornflower_blue 70 chartreuse_3a 71 dark_sea_green_4b 72 cadet_blue_2 73 cadet_blue_1 74 sky_blue_3 75 steel_blue_1a 76 chartreuse_3b 77 pale_green_3a 78 sea_green_3 79 aquamarine_3 80 medium_turquoise 81 steel_blue_1b 82 chartreuse_2a 83 sea_green_2 84 sea_green_1a 85 sea_green_1b 86 aquamarine_1a 87 dark_slate_gray_2 88 dark_red_2 89 deep_pink_4b 90 dark_magenta_1 91 dark_magenta_2 92 dark_violet_1a 93 purple_1a 94 orange_4b 95 light_pink_4 96 plum_4 97 medium_purple_3a 98 medium_purple_3b 99 slate_blue_1 100 yellow_4a 101 wheat_4 102 grey_53 103 light_slate_grey 104 medium_purple 105 light_slate_blue 106 yellow_4b 107 dark_olive_green_3a 108 dark_green_sea 109 light_sky_blue_3a 110 light_sky_blue_3b 111 sky_blue_2 112 chartreuse_2b 113 dark_olive_green_3b 114 pale_green_3b 115 dark_sea_green_3a 116 dark_slate_gray_3 117 sky_blue_1 118 chartreuse_1 119 light_green_2 120 light_green_3 121 pale_green_1a 122 aquamarine_1b 123 dark_slate_gray_1 124 red_3a 125 deep_pink_4c 126 medium_violet_red 127 magenta_3a 128 dark_violet_1b 129 purple_1b 130 dark_orange_3a 131 indian_red_1a 132 hot_pink_3a 133 medium_orchid_3 134 medium_orchid 135 medium_purple_2a 136 dark_goldenrod 137 light_salmon_3a 138 rosy_brown 139 grey_63 140 medium_purple_2b 141 medium_purple_1 142 gold_3a 143 dark_khaki 144 navajo_white_3 145 grey_69 146 light_steel_blue_3 147 light_steel_blue 148 yellow_3a 149 dark_olive_green_3 150 dark_sea_green_3b 151 dark_sea_green_2 152 light_cyan_3 153 light_sky_blue_1 154 green_yellow 155 dark_olive_green_2 156 pale_green_1b 157 dark_sea_green_5b 158 dark_sea_green_5a 159 pale_turquoise_1 160 red_3b 161 deep_pink_3a 162 deep_pink_3b 163 magenta_3b 164 magenta_3c 165 magenta_2a 166 dark_orange_3b 167 indian_red_1b 168 hot_pink_3b 169 hot_pink_2 170 orchid 171 medium_orchid_1a 172 orange_3 173 light_salmon_3b 174 light_pink_3 175 pink_3 176 plum_3 177 violet 178 gold_3b 179 light_goldenrod_3 180 tan 181 misty_rose_3 182 thistle_3 183 plum_2 184 yellow_3b 185 khaki_3 186 light_goldenrod_2a 187 light_yellow_3 188 grey_84 189 light_steel_blue_1 190 yellow_2 191 dark_olive_green_1a 192 dark_olive_green_1b 193 dark_sea_green_1 194 honeydew_2 195 light_cyan_1 196 red_1 197 deep_pink_2 198 deep_pink_1a 199 deep_pink_1b 200 magenta_2b 201 magenta_1 202 orange_red_1 203 indian_red_1c 204 indian_red_1d 205 hot_pink_1a 206 hot_pink_1b 207 medium_orchid_1b 208 dark_orange 209 salmon_1 210 light_coral 211 pale_violet_red_1 212 orchid_2 213 orchid_1 214 orange_1 215 sandy_brown 216 light_salmon_1 217 light_pink_1 218 pink_1 219 plum_1 220 gold_1 221 light_goldenrod_2b 222 light_goldenrod_2c 223 navajo_white_1 224 misty_rose1 225 thistle_1 226 yellow_1 227 light_goldenrod_1 228 khaki_1 229 wheat_1 230 cornsilk_1 231 grey_100 232 grey_3 233 grey_7 234 grey_11 235 grey_15 236 grey_19 237 grey_23 238 grey_27 239 grey_30 240 grey_35 241 grey_39 242 grey_42 243 grey_46 244 grey_50 245 grey_54 246 grey_58 247 grey_62 248 grey_66 249 grey_70 250 grey_74 251 grey_78 252 grey_82 253 grey_85 254 grey_89 255 grey_93 256 default Copyright © marslo 2020-2021 all right reserved，powered by GitbookLast Modified: 2022-06-27 16:15:18 "}}