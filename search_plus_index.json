{"./":{"url":"./","title":"Introduction","keywords":"","body":"life is hard, make it easier Introduction [!NOTE] This is a book powered by imarslo. The other docs build mocp from Source Code Precondiction Error and Solucton Error: BerkeleyDB (libdb) not found decoder.c:22:18: fatal error: ltdl.h FATAL_ERROR: No valid sound driver! goagent configuration Offical Website Latest Version Install Configuration Run GoAgent Older Version How to install 如何安装 Q&A windows build vim/gvim from source code Compile vim/gvim by source code Precondiction Compile and Install Make compiled vim as default text editor Q&A colorful windows command line Colorful Prompt Needed Tools and files Steps Specified Font Specified Cursor Size Set aliases in cmd Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 17:36:16 "},"cheatsheet/good.html":{"url":"cheatsheet/good.html","title":"cheatsheet","keywords":"","body":" redirect show stdout but redirect all to file time & date show date with timezone show cal synchronize date and time with another server over ssh download and extract check file without extract extract jar recursive download compress zip package with dot-file remove dot-file without skipping '..' '.' issue echo 256 colors commands ls PWD's secrets list the command startsWith fuzzy find for commands batch commands batch rename xargs rename batch move batch copy copy single file to multipule folders ldapsearch search specific user filter DN field only filter SAMAccountName, uid and uidNumber only filter particular group get userCertificates others directory diff show some command periodically clear use less as tail -f netcat & nmap-ncat alternatives & update-alternatives redirect show stdout but redirect all to file [!NOTE] references: redirect overview || visible in terminal || visible in file || existing Syntax || StdOut | StdErr || StdOut | StdErr || file ==========++==========+==========++==========+==========++=========== > || no | yes || yes | no || overwrite >> || no | yes || yes | no || append || | || | || 2> || yes | no || no | yes || overwrite 2>> || yes | no || no | yes || append || | || | || &> || no | no || yes | yes || overwrite &>> || no | no || yes | yes || append || | || | || | tee || yes | yes || yes | no || overwrite | tee -a || yes | yes || yes | no || append || | || | || n.e. (*) || yes | yes || no | yes || overwrite n.e. (*) || yes | yes || no | yes || append || | || | || |& tee || yes | yes || yes | yes || overwrite |& tee -a || yes | yes || yes | yes || append Redirect terminal output to file Bash: Redirect stdout and stderr show Command Output Redirection.pdf 3.6 Redirections * Beyond Linux From Scratch tips: echo to stderr$ echo 'abcdefg' >/dev/null $ echo 'abcdefg' >/dev/null >&2 abcdefg $ bash -c \"echo a;bahs;echo b;bhas\" >>file 2> >( tee -a file >&2 ) bash: line 1: bahs: command not found bash: line 1: bhas: command not found $ cat file a bash: line 1: bahs: command not found b bash: line 1: bhas: command not found stderr output with filter $ bash -c \"echo a;bahs;echo b;bhas\" >>file 2> >( tee -a file 2>&1 | grep -v bahs >&2 ) bash: line 1: bhas: command not found # or $ rm -rf file; bash -c \"echo a;bahs;echo b;bhas\" >>file 2> >( tee -a file | grep -v bahs >&2 ) bash: line 1: bhas: command not found $ cat file a bash: line 1: bahs: command not found b bash: line 1: bhas: command not found or $ bash -c \"set -e; echo a;bahs;echo b;bhas\" >>cmd.out 2> >( tee -a cmd.out >&2 ) bash: line 1: bahs: command not found $ cat cmd.out a bash: line 1: bahs: command not found time & date show date with timezone # with quotes $ TZ=':Asia/Shanghai' date # or without quotes $ TZ=America/Los_Angeles date show cal $ cal -y | tr '\\n' '|' | sed \"s/^/ /;s/$/ /;s/ $(date +%e) / $(date +%e | sed 's/./#/g') /$(date +%m | sed s/^0//)\" | tr '|' '\\n' 2014 January February March Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 1 1 5 6 7 8 9 10 11 2 3 4 5 6 7 8 2 3 4 5 6 7 8 12 13 14 15 16 17 18 9 10 11 12 13 14 15 9 10 11 12 13 14 15 19 20 21 22 23 24 25 16 17 18 19 20 21 22 16 17 ## 19 20 21 22 26 27 28 29 30 31 23 24 25 26 27 28 23 24 25 26 27 28 29 30 31 April May June Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 5 1 2 3 1 2 3 4 5 6 7 6 7 8 9 10 11 12 4 5 6 7 8 9 10 8 9 10 11 12 13 14 13 14 15 16 17 18 19 11 12 13 14 15 16 17 15 16 17 18 19 20 21 20 21 22 23 24 25 26 18 19 20 21 22 23 24 22 23 24 25 26 27 28 27 28 29 30 25 26 27 28 29 30 31 29 30 July August September Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 5 1 2 1 2 3 4 5 6 6 7 8 9 10 11 12 3 4 5 6 7 8 9 7 8 9 10 11 12 13 13 14 15 16 17 18 19 10 11 12 13 14 15 16 14 15 16 17 18 19 20 20 21 22 23 24 25 26 17 18 19 20 21 22 23 21 22 23 24 25 26 27 27 28 29 30 31 24 25 26 27 28 29 30 28 29 30 31 October November December Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa Su Mo Tu We Th Fr Sa 1 2 3 4 1 1 2 3 4 5 6 5 6 7 8 9 10 11 2 3 4 5 6 7 8 7 8 9 10 11 12 13 12 13 14 15 16 17 18 9 10 11 12 13 14 15 14 15 16 17 18 19 20 19 20 21 22 23 24 25 16 17 18 19 20 21 22 21 22 23 24 25 26 27 26 27 28 29 30 31 23 24 25 26 27 28 29 28 29 30 31 30 synchronize date and time with another server over ssh [!NOTE] inspired from commandlinefu.com) $ date --set=\"$(ssh [username]@[sshserver] date)\" download and extract *.gz $ wget -O - http://example.com/a.gz | tar xz *.zip $ curl -fsSL https://services.gradle.org/distributions/gradle-4.7-all.zip | bsdtar xzf - -C with zip password$ curl -fsSL \\ -u: \\ https://path/to/file.zip \\ | bsdtar -xzf- --passphrase - -C *.tar.gz $ curl -fsSL https://path/to/file.tar.gz | tar xzf - -C example$ curl -fsSL \\ -j \\ -k \\ -L \\ -H \"Cookie: oraclelicense=accept-securebackup-cookie\" \\ http://download.oracle.com/otn-pub/java/jdk/8u181-b13/96a7b8442fe848ef90c96a2fad6ed6d1/jdk-8u181-linux-x64.tar.gz \\ | tar xzf - -C '/opt/java' check file without extract $ tar -Oxvf myfile.tgz path/to/my.sh | less extract jar $ unzip .jar -d Delete files from JAR without unzip$ zip -d .jar recursive download [!TIP] references: download a directory and subdirectories using wget wget(1) - Linux man page params shortcuts : SHORT PARAMS LONG PARAMS -r --recursive -m --mirror -l --level -k --convert-links -K --backup-converted -P --directory-prefix -nv --no-verbose -nc --no-clobber -nd --no-directories -nH --no-host-directories -np --no-parent -x --force-directories -b --background -v --verbose -p --page-requisites $ wget --recursive \\ # -r --user=admin \\ --password=admin \\ # --ask-password --auth-no-challenge \\ # optional --no-host-directories \\ # -nH --no-parent \\ # -np --reject '*.html*' \\ --directory-prefix=./ \\ # -P --include-directories=local-dir \\ # -I http://example.com/remote-dir # or $ wget --recursive \\ # -r --no-parent \\ # -np : will not crawl links in folders above the base of the URL --convert-links \\ # -k : convert links with the domain name to relative and uncrawled to absolute --random-wait --wait 3 --no-http-keep-alive \\ # do not get banned --no-host-directories \\ # -nH : do not create folders with the domain name --execute robots=off --user-agent=Mozilla/5.0 \\ # I AM A HUMAN!!! --level=inf --accept '*' \\ # -l : do not limit to 5 levels or common file formats --reject=\"index.html*\" \\ # use this option if you need an exact mirror --cut-dirs=0 \\ # replace 0 with the number of folders in the path, 0 for the whole domain $URL mirror whole website$ wget -m https://www.baeldung.com/ download directly $ wget -r -np -nH --cut-dirs=1 https://www.baeldung.com/linux # or $ wget -r --no-parent --no-host-directories --cut-dirs=1 https://www.baeldung.com/linux with level $ wget -r -np -l 2 https://www.baeldung.com/linux/ # or $ wget -r --no-parent --level=2 https://www.baeldung.com/linux/ with credentials .wgetrc$ cat ~/.wgetrc user=admin password=admin from cmd $ wget --user=admin --password=admin # or $ wget --user=admin --ask-password Password for user 'admin': admin ignore credentials$ wget --no-check-certificate converting links for local viewing $ wget -r --no-parent --convert-links https://www.baeldung.com/linux/category/web switching off robot exclusion $ wget -r --level=1 --no-parent --convert-links -e robots=off -U=\"Mozilla\" compress zip package with dot-file .[^.]* $ zip name.zip * .[^.]*' shopt -s dotglob [!NOTE|label:references:] imarslo : bash/bash $ shopt -s dotglob $ zip name.zip * . $ zip -r name.zip . remove dot-file without skipping '..' '.' issue [!NOTE|label:references:] imarslo : bash/bash turn dotglob off$ shopt -u dotglob shopt -s dotglob $ shopt -s dotglob $ rm [-rf] * .[^.]* $ rm [-rf] .[^.]* .[!.]* $ rm [-rf] .[!.]* .??* $ rm [-rf] .??* echo 256 colors [!TIP] see also: imarslo : cheatsheet/colors imarslo : cheatsheet/tricky.html#highlight-output $ for i in {0..255}; do echo -e \"\\e[38;05;${i}m${i}\"; done | column -c 80 -s ' '; echo -e \"\\e[m\" # or $ yes \"$(seq 1 255)\" | while read i; do printf \"\\x1b[48;5;${i}m\\n\"; sleep .01; done commands ls [!TIP|label:references] Why not parse ls (and what to do instead)? Why you shouldn't parse the output of ls(1) list numeric names [!NOTE|label:references:] How can I get files with numeric names using ls command? $ ls git-[[:digit:]]*.png git-0.png git-1.png git-2.png git-3.png git-4.png git-5.png $ ls git-+([0-9])*.png git-0.png git-1.png git-2.png git-3.png git-4.png git-5.png PWD's secrets $ l | grep bc lrwxrwxrwx 1 marslo marslo 37 Mar 4 00:25 bc -> /home/marslo/Tools/Git/BrowserConfig// $ cd bc/ $ pwd -L /home/marslo/bc $ pwd -P /home/marslo/Tools/Git/BrowserConfig list the command startsWith $ compgen -c \"system-config-\" system-config-authentication system-config-authentication system-config-date system-config-firewall system-config-firewall-tui system-config-kdump system-config-keyboard system-config-keyboard system-config-network system-config-network system-config-network-cmd system-config-network-cmd system-config-network-tui system-config-printer system-config-printer-applet system-config-services system-config-services system-config-users fuzzy find for commands $ apropos editor | head Git::SVN::Editor (3pm) - commit driver for \"git svn set-tree\" and dcommit INIFILE (1) - OpenLink Virtuoso Opensource ini File Editor atobm (1) - bitmap editor and converter utilities for the X Window System bitmap (1) - bitmap editor and converter utilities for the X Window System bmtoa (1) - bitmap editor and converter utilities for the X Window System ed (1) - line-oriented text editor editor (1) - Nano's ANOther editor, an enhanced free Pico clone editres (1) - a dynamic resource editor for X Toolkit applications ex (1) - Vi IMproved, a programmers text editor gedit (1) - text editor for the GNOME Desktop batch commands batch rename $ l total 4.0K -rw-r--r-- 1 marslo marslo 10 Feb 21 00:43 a.b $ rename -v 's/\\./_/g' * a.b renamed as a_b $ l total 4.0K -rw-r--r-- 1 marslo marslo 10 Feb 21 00:43 a_b xargs rename $ shopt -s extglob $ ls git-+([0-9])*.png git-0.png git-1.png git-2.png git-3.png git-4.png git-5.png $ ls --color=none git-+([0-9])*.png | xargs rename -v 's/git-/git-for-windows-/' 'git-0.png' renamed to 'git-for-windows-0.png' 'git-1.png' renamed to 'git-for-windows-1.png' 'git-2.png' renamed to 'git-for-windows-2.png' 'git-3.png' renamed to 'git-for-windows-3.png' 'git-4.png' renamed to 'git-for-windows-4.png' 'git-5.png' renamed to 'git-for-windows-5.png' batch move [!NOTE] -I replace-str $ mkdir backup-folder && ls | grep -Ze \".*rar\" | xargs -d '\\n' -I {} mv {} backup-folder batch copy reference: Hack 22. Xargs Command Examples $ ls -1 a/b/* 11 12 | xargs cp -t copy-target-folder/ copy single file to multipule folders $ echo dir1 dir2 dir3 | xargs -n 1 cp file1 # or $ echo dir{1..10} | xargs -n 1 cp file1 ldapsearch [!NOTE] enhaanced script marslo/mytools reference: ldapsearch Examples The ldapsearch Tool Querying AD with ldapsearch-LLL # just a particular way to display the results -H ldap://wspace.mydomain.com # the URL where the LDAP server listens -x # use simple authentication, not SASL -D 'user1' # the account to use to authenticate to LDAP -w 'user1password' # the password that goes with the account on the previous line -E pr=1000/noprompt # ask the server for all pages, don't stop after one -b 'ou=mydomain,dc=wspace,dc=mydomain,dc=com' # the base of the search. We don't want results from e.g. 'ou=blah,dc=wspace,dc=mydomain,dc=com' '(&(objectClass=person)(uidNumber=*))' # Ask for any entry that has attributes objectClass=person and uidNumber has a value SAMAccountName uid uidNumber # Show only these attributes search specific user [!NOTE] info : ldap url : ldaps://ldap.mydomain.com:636 base search base : dc=mydomain,dc=com login user : user1 / user1password search : user2 remove #refldaps://.. remove #.*$ ldapsearch ... | sed -r '/^(#.*)$/d' remove empty lines$ ldapsearch ... | sed -r '/^\\s*$/d' remove all $ ldapsearch ... | sed -r '/^(#.*)$/d;/^\\s*$/d' # or $ ldapsearch ... | sed -r '/(^#.*)|(^\\s*)$/d' $ ldapsearch \\ -LLL \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ CN='user2' or insert password via interactive mode ( -W )$ ldapsearch \\ -LLL \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'dc=mydomain,dc=com' \\ -W \\ -D 'user1' \\ CN='user2' filter DN field only $ ldapsearch \\ [-LLL \\] -H 'ldaps://ldap.mydomain.com:636' \\ -b 'dc=mydomain,dc=com' \\ -x \\ -D 'user1' \\ -w 'user1password' \\ CN='user2' \\ DN filter SAMAccountName, uid and uidNumber only [!TIP] filter base on base DN (OU=Person,DC=mydomain,DC=com) $ ldapsearch \\ -LLL \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'ou=Workers,dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ -E 'pr=1000/noprompt' \\ '(&(objectClass=user)(sAMAccountName=*))' \\ SAMAccountName uid uidNumber DN filter particular group $ ldapsearch \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'OU=DL,OU=Groups,OU=GLOBAL,OU=Sites,dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ -E 'pr=1000/noprompt' \\ '(&(objectClass=group)(CN=*))' search particular group (cn=DL-name-group)$ ldapsearch \\ -x \\ -H 'ldaps://ldap.mydomain.com:636' \\ -b 'OU=DL,OU=Groups,OU=GLOBAL,OU=Sites,dc=mydomain,dc=com' \\ -D 'user1' \\ -w 'user1password' \\ -E 'pr=1000/noprompt' \\ CN='DL-name-group' get userCertificates [!NOTE|label:references:] Problems with ldap userCertificate attribute 9.2. Certificate Publishing # convert a pem certificate into der openssl x509 -outform DER -in incert.pem -out outcert.der # created LDIF file ldif -b \"usercertificate;binary\" cert.ldif # creates an usercertificate attribute encoded in base64 ldapmodify -x -W -D \"cn=Manager,dc=yourorg,dc=com\" -f cert.ldif get cert info $ ldapsearch marslo userCertificate | awk '{print $NF}' | xargs -i bash -c \"echo {} | base64 -d -w0 | openssl x509 -noout -dates -subject -issuer\" # or $ while read -r crt; do echo \"${crt}\" | base64 -d -w0 | openssl x509 -noout -dates -subject -issuer; done save local der$ while read -r n c; do echo \"-- ${n} --\"; echo \"${c}\" | base64 -d -w0 > cert_${n}.der; done crt$ while read -r n c; do echo \"-- ${n} --\"; echo \"${c}\" | base64 -d -w0 > cert_${n}.der; openssl x509 -in cert_${n}.der -inform DER -out cert_${n}.crt; done others directory diff $ diff --suppress-common-lines -y show some command periodically $ watch --interval 1 ls -alt watch with pipe$ watch -n 1 'ls -Altrh | grep ' clear $ printf \"\\ec\" use less as tail -f $ less +F netcat & nmap-ncat [!NOTE] references: * imarslo : epel * imarslo : adminTools - nc install $ sudo yum -y install epel-release [yum-utils] # or via url $ sudo dnf [re]install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm $ sudo dnf [re]install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm $ sudo yum update -y $ yum list | grep netcat netcat.x86_64 1.219-2.el8 @epel $ sudo yum install -y netcat.x86_64 # check $ sudo yum repolist switch with nmap & netcat $ ls -altrh /usr/local/bin/nc lrwxrwxrwx 1 root root 22 Mar 14 03:14 /usr/local/bin/nc -> /etc/alternatives/nmap $ sudo update-alternatives --config nmap There are 2 programs which provide 'nmap'. Selection Command ----------------------------------------------- *+ 1 /usr/bin/ncat 2 /usr/bin/netcat Enter to keep the current selection[+], or type selection number: 2 check # by using netcat $ nc -zv google.com 443 Connection to google.com (142.251.214.142) 443 port [tcp/https] succeeded! # by using nact $ ncat -zv google.com 443 Ncat: Version 7.70 ( https://nmap.org/ncat ) Ncat: Connected to 142.251.214.142:443. Ncat: 0 bytes sent, 0 bytes received in 0.07 seconds. check package $ rpm -ql netcat.x86_64 /usr/bin/nc /usr/bin/netcat /usr/lib/.build-id /usr/lib/.build-id/f3 /usr/lib/.build-id/f3/3de6290429f99a8d8f5fe646a93bcc952dafdd /usr/share/man/man1/nc.1.gz /usr/share/man/man1/netcat.1.gz $ rpm -ql nmap-ncat.x86_64 /usr/bin/nc /usr/bin/ncat ... alternatives & update-alternatives install $ sudo update-alternatives --install /usr/bin/java java /opt/java/jdk1.8.0_121/bin/java 999 $ sudo update-alternatives --auto java $ sudo update-alternatives --install /usr/bin/javac javac /opt/java/jdk1.8.0_121/bin/javac 999 $ sudo update-alternatives --auto javac modify $ ls -altrh $(which -a nc) lrwxrwxrwx 1 root root 22 Jun 1 04:02 /usr/bin/nc -> /etc/alternatives/nmap $ sudo alternatives --config nmap There are 2 programs which provide 'nmap'. Selection Command ----------------------------------------------- *+ 1 /usr/bin/netcat 2 /usr/bin/ncat Enter to keep the current selection[+], or type selection number: 1 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/bash/bash.html":{"url":"cheatsheet/bash/bash.html","title":"bash","keywords":"","body":" fancy bash alias bash - shell expansions IFS word splitting filename expansion quoting ternary arithmetic brace expansion segmented continuous scp multipule folder/file to target server all about {curly braces} in bash fast copy or moving or something (detials -> brace expansion) multiple directories creation copy single file to multipule folders pipe and stdin read stdin from pipe read -r var event designators word designators tilde expansion special parameters [!NOTE] references: Bash scripting cheatsheet Introduction to Bash Array Bash For Loop Array: Iterate Through Array Values $ declare -A foo=( [\"one\"]=\"apple\" [\"two\"]=\"orange\" [\"three\"]=\"banana\" ) # show keys $ echo ${!foo[@]} two three one # show values $ echo ${foo[@]} orange banana apple fancy bash [!NOTE] ohmybash/oh-my-bash Bash-it/bash-it akinomyoga/ble.sh alias $ echo ${BASH_ALIASES[ls]} ls --color=always bash - get bash login log ( for rc script debug ) $ bash -l -v run with only one startup file ( for sharing accounts ) $ bash -i --rcfile=\"$HOME/.marslo/.imarslo\" shell expansions references: Bash Reference Manual Bash Reference Manual ZH Brace Expansion Tilde Expansion Shell Parameter Expansion Command Substitution Arithmetic Expansion Process Substitution Word Splitting Filename Expansion Pattern Matching Quote Removal Parameter expansion and: The Set Builtin The Shopt Builtin and Bash Guide for Beginners Chapter 3. The Bash environment NAME EXAMPLE Brace Expansion echo a{d,c,b}e Tilde Expansion ~ Shell Parameter Expansion string=01234567890abc; echo ${string:7:2} Command Substitution $(command) or command Arithmetic Expansion $(( expression )) Process Substitution or >(list) Word Splitting $IFS Filename Expansion *, ? , [..],... IFS [!NOTE] bash read command splits line into words using space as delimiter even though space is not in IFS Bash/KSH: Define Delimiter (IFS) While Using read Command # default IFS $ echo \"${IFS@Q}\" $' \\t\\n' $ echo \"$IFS\" | od -tcx1 0000000 \\t \\n \\n 20 09 0a 0a 0000004 $ echo -n \"$IFS\" | od -tcx1 0000000 \\t \\n 20 09 0a 0000003 # i.e.: $ read a b c or $ cat -c -etv example $ IFS=' ' read -p 'Enter your first and last name : ' first last; echo \">> hello $first $last\" Enter your first and last name : marslo jiao >> hello marslo jiao # read from array $ foo=( x=y a=b ) $ while IFS='=' read -r var value; do echo \"$var >> $value\"; done > y a >> b word splitting # due to 7 fields are spitted via `:` in /etc/passwd IFS=':' read f1 f2 f3 f4 f5 f6 f7 filename expansion Bash scans each word for the characters '*', '?', and '[', unless the -f (set -f) option has been set CONDITION RESULT match found && nullglob disabled the word is regarded as a pattern no match found && nullglob disabled the word is left unchanged no match found && nullglob set the word is removed no match found && failglob set show error msg and cmd won't be exectued nocaseglob enabled patten match case insensitive set -o noglob or set -f * will not be expanded shopt -s dotglob * will including all .*. see zip package with dot-file quoting Difference between single and double quotes in Bash ANSI-C quoting with $'' - GNU Bash Manual Locale translation with $\"\" - GNU Bash Manual A three-point formula for quotes sample: a=apple # a simple variable arr=(apple) # an indexed array with a single element # Expression Result Comments 1 \"$a\" apple variables are expanded inside \"\" 2 '$a' $a variables are not expanded inside '' 3 \"'$a'\" 'apple' '' has no special meaning inside \"\" 4 '\"$a\"' \"$a\" \"\" is treated literally inside '' 5 '\\'' invalid can not escape a ' within ''; use \"'\" or $'\\'' (ANSI-C quoting) 6 \"red$arocks\" red $arocks does not expand $a; use ${a}rocks to preserve $a 7 \"redapple$\" redapple$ $ followed by no variable name evaluates to $ 8 '\\\"' \\\" \\ has no special meaning inside '' 9 \"\\'\" \\' \\' is interpreted inside \"\" but has no significance for ' 10 \"\\\"\" \" \\\" is interpreted inside \"\" 11 \"*\" * glob does not work inside \"\" or '' 12 \"\\t\\n\" \\t\\n \\t and \\n have no special meaning inside \"\" or ''; use ANSI-C quoting 13 \"echo hi\" hi `` and $() are evaluated inside \"\" (backquotes are retained in actual output) 14 'echo hi' echo` hi `` and $() are not evaluated inside '' (backquotes are retained in actual output) 15 '${arr[0]}' ${arr[0]} array access not possible inside '' 16 \"${arr[0]}\" apple array access works inside \"\" 17 $'$a\\'' $a' single quotes can be escaped inside ANSI-C quoting 18 \"$'\\t'\" $'\\t' ANSI-C quoting is not interpreted inside \"\" 19 '!cmd' !cmd history expansion character '!' is ignored inside '' 20 \"!cmd\" cmd args expands to the most recent command matching \"cmd\" 21 $'!cmd' !cmd history expansion character '!' is ignored inside ANSI-C quotes ternary arithmetic [!NOTE] Shell Scripting Ternary operator to get string result string $ [[ '.' = '.' ]] && path='.' || path='--' $ echo $path . $ [[ '.' = '-' ]] && path='.' || path='--' $ echo $path -- mathematical operation $ (( 3 == 3 ? (var=1) : (var=0) )) $ echo $var 1 $ (( 3 == 1 ? (var=1) : (var=0) )) $ echo $var 0 brace expansion segmented continuous # exclude 7 from 1-10 $ echo test-{{1..6},{8..10}} test-1 test-2 test-3 test-4 test-5 test-6 test-8 test-9 test-10 scp multipule folder/file to target server $ scp -r $(echo dir{1..10}) user@target.server:/target/server/path/ all about {curly braces} in bash $ echo 00{1..9} 0{10..99} 100 001 002 003 004 005 006 007 008 009 010 011 012 013 014 015 016 017 018 019 020 021 022 023 024 025 026 027 028 029 030 031 032 033 034 035 036 037 038 039 040 041 042 043 044 045 046 047 048 049 050 051 052 053 054 055 056 057 058 059 060 061 062 063 064 065 066 067 068 069 070 071 072 073 074 075 076 077 078 079 080 081 082 083 084 085 086 087 088 089 090 091 092 093 094 095 096 097 098 099 100 $ dec2bin=({0..1}{0..1}{0..1}{0..1}{0..1}{0..1}{0..1}{0..1}) $ echo ${dec2bin[1]} 00000001 $ echo ${dec2bin[0]} 00000000 $ echo ${dec2bin[255]} 11111111 $ month=(\"Jan\" \"Feb\" \"Mar\" \"Apr\" \"May\" \"Jun\" \"Jul\" \"Aug\" \"Sep\" \"Oct\" \"Nov\" \"Dec\") $ echo ${month[5]} Jun $ echo {10..0..2} 10 8 6 4 2 0 $ echo {1..100..3} 1 4 7 10 13 16 19 22 25 28 31 34 37 40 43 46 49 52 55 58 61 64 67 70 73 76 79 82 85 88 91 94 97 100 fast copy or moving or something (detials -> brace expansion) Example 1:$ ls | grep foo $ touch foo{1,2,3} $ ls | grep foo foo1 foo2 foo3 Example 2 $ ls | grep foo $ touch foo-{a..d} $ ls | grep foo foo-a foo-b foo-c foo-d Example 3 $ ls foo-* foo-a foo-b foo-c foo-d $ mv foo-{a,} $ ls foo-* foo- foo-b foo-c foo-d Example 4 $ mkdir -p test/{a,b,c,d} $ tree test/ test/ ├── a ├── b ├── c └── d 4 directories, 0 files multiple directories creation $ mkdir sa{1..50} $ mkdir -p sa{1..50}/sax{1..50} $ mkdir {a-z}12345 $ mkdir {1,2,3} $ mkdir test{01..10} $ mkdir -p `date '+%y%m%d'`/{1,2,3} $ mkdir -p $USER/{1,2,3} copy single file to multipule folders $ echo dir1 dir2 dir3 | xargs -n 1 cp file1 # or $ echo dir{1..10} | xargs -n 1 cp file1 pipe and stdin read stdin from pipe references: How to read mutliline input from stdin into variable and how to print one out in shell(sh,bash)? read /dev/stdin cat tee In a bash function, how do I get stdin into a variable TIL: Reading stdin to a BASH variable Pipe Output to Bash Function Guide to Stream Redirections in Linux Bash: Assign output of pipe to a variable read How To Use The Bash read Command $IFSIFS Effect On The Values of \"$@\" And \"$*\": $@ and $* are special command line arguments shell variables. The $@ holds list of all arguments passed to the script. The $* holds list of all arguments passed to the script. [!TIP] # with IFS $ echo ' hello world ' | { IFS='' read msg; echo \"${msg}\"; } | tr ' ' '.' ...hello..world... $ echo ' hello world ' | { IFS='' read msg; echo \"${msg}\" | sed -e 's/^[[:blank:]]*//;s/[[:blank:]]*$//'; } | tr ' ' '.' hello..world # without IFS $ echo ' hello world ' | { read msg; echo \"${msg}\"; } | tr ' ' '.' hello..world read -r var script as command line $ cat trim.sh #!/usr/bin/env bash trim() { echo \"$@\" | sed -e 's/^[[:blank:]]*//;s/[[:blank:]]*$//' } IFS='' read -r myvar trim \"${myvar}\" result$ IFS='' $ s=' aa bb ' $ echo \"${s}\" | tr ' ' '.' # ...aa..bb... $ echo \"${s}\" | ./trim.sh | tr ' ' '.' # aa..bb $ echo \" a | b | c \" | awk -F'|' '{print $2}' | tr ' ' '.' # .b. $ echo \" a | b | c \" | awk -F'|' '{print $2}' | ./trim.sh | tr ' ' '.' # b running inside the script $ cat example.sh #!/usr/bin/env bash trim() { IFS='' read -r str echo \"${str}\" | sed -e 's/^[[:blank:]]*//;s/[[:blank:]]*$//' } s=' aa bb ' echo \"${s}\" | tr ' ' '.' echo \"${s}\" | trim | tr ' ' '.' result$ ./example.sh ...aa..bb... aa..bb event designators option expression ! start a history substitution !n refer to command line n !-n refer to the command n lines back !! refer to the previous command !string refer to the most recent command preceding the current position in the history list starting with string !?string[?] refer to the most recent command preceding the current position in the history list containing string. ^string1^string2^ !!:s^string1^string2^ quick substitution. repeat the last command, replacing string1 with string2 !# the entire command line typed so far word designators option expression !! designates the preceding command !!:$ or !$ designates the last argument of the preceding command !fi:2 designates the second argument of the most recent command starting with the letters fi $_ VS. !$ reference: Understand the meaning of $_ -$_ bash variables if the invoking application doesn't pass a environment variable, the invoked bash shell will initialise $ to the argv[0] it receives itself which could be bash i.e. $ env | grep '^_=' _=/usr/local/opt/coreutils/libexec/gnubin/env # or $ env bash -c 'echo \"$_\"' /usr/local/opt/coreutils/libexec/gnubin/env !$ Word Designators equal to !!:$ tilde expansion CHARACTER DEFINITION EXAMPLE ~ $HOME ~/foo: $HOME/foo ~+ $PWD ~+/foo: $PWD/foo ~N dirs +N - ~+N dirs +N - ~-N dirs -N - # prepare $ mkdir -p a/b/c/d $ cd a && pushd . $ cd b && pushd . $ cd c && pushd . $ cd d && pushd . # result $ dirs -v 0 ~/a/b/c/d 1 ~/a/b/c/d 2 ~/a/b/c 3 ~/a/b 4 ~/a $ echo $(dirs -1) ~/a/b $ echo $(dirs -2) ~/a/b/c $ echo $(dirs -3) ~/a/b/c/d special parameters CHARACTER DEFINITION $* expands to the positional parameters, starting from one. when the expansion occurs within double quotes, it expands to a single word with the value of each parameter separated by the first character of the ifs special variable. $@ expands to the positional parameters, starting from one. when the expansion occurs within double quotes, each parameter expands to a separate word. $# expands to the number of positional parameters in decimal. $? expands to the exit status of the most recently executed foreground pipeline. $- a hyphen expands to the current option flags as specified upon invocation, by the set built-in command, or those set by the shell itself (such as the -i). $$ expands to the process id of the shell. $! expands to the process id of the most recently executed background (asynchronous) command. $0 expands to the name of the shell or shell script. $_ the underscore variable is set at shell startup and contains the absolute file name of the shell or script being executed as passed in the argument list. subsequently, it expands to the last argument to the previous command, after expansion. it is also set to the full pathname of each command executed and placed in the environment exported to that command. when checking mail, this parameter holds the name of the mail file. $* vs. $@: The implementation of \"$*\" has always been a problem and realistically should have been replaced with the behavior of \"$@\". In almost every case where coders use \"$*\", they mean \"$@\". \"$*\" Can cause bugs and even security holes in your software. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:24:59 "},"cheatsheet/bash/builtin.html":{"url":"cheatsheet/bash/builtin.html","title":"builtin","keywords":"","body":" eval set show current status option name shopt options examples readline && bind show options key bindings list all names inputrc show-mode-in-prompt tips [!TIP|label:references:] 3.5.3 Shell Parameter Expansion How can I use variable variables (indirect variables, pointers, references) or associative arrays? risk Eval command and security issues eval eval — construct command by concatenating arguments reference: Bash eval command functions / eval (source, CPAN) What is the “eval” command in bash? example without eval:$ foo='ls | less' $ $foo ls: cannot access '|': No such file or directory ls: cannot access 'less': No such file or directory with eval:$ foo='ls | less' $ eval $foo Applications Library System Users ... example $ x=10 $ y=x $ foo='$'$x $ echo $foo $x # with eval $ eval foo='$'$x # with eval $ echo $foo 10 # or $ foo=\\$$x $ eval echo $foo # with eval 10 $ echo $foo $x set [!NOTE] reference: Writing Robust Bash Shell Scripts 用内置的set和shopt命令来设置bash的选项 Bash history reuse and bang commands History Expansion | Event Designators !!: to repeat last commands set +H or set +o histexpand to disable set -H or set -o histexpand to enable more via $ man bash | less -Ip 'Event Designators' set set [--abefhkmnptuvxBCEHPT] [-o option-name] [argument …] set [+abefhkmnptuvxBCEHPT] [+o option-name] [argument …] example $ set | grep -e SHELLOPTS -e BASHOPTS BASHOPTS=cdspell:checkwinsize:cmdhist:complete_fullquote:expand_aliases:extglob:extquote:force_fignore:globasciiranges:histappend:interactive_comments:login_shell:progcomp:promptvars:sourcepath SHELLOPTS=braceexpand:emacs:hashall:histexpand:history:interactive-comments:monitor Use Bash Strict Mode (Unless You Love Debugging) OPTION EXPLANATION -a -o allexport -b cause the status of terminated background jobs to be reported immediately -e -o errexitExit immediately if a pipeline returns a non-zero status -f Disable filename expansion (globbing) -h -o hashall -k -o keyword -m -o monitor -n -o noexec -o option-name see option name -p -o privileged the $BASH_ENV and $ENV files are not processed -t -o onecmd -u -o unsettreat unset variables and parameters other than the special parameters '@' or '*' as an error -v verbose. print shell input lines as they are read -x -o xtrace[debug] print commands and their arguments as they are executed -B -o braceexpand shell will perform brace expansion -c -o noclobberprevent output redirection using '>', '>&', and '<>' from overwriting existing files. -E -o errtrace -H -o histexpand -P do not resolve symbolic links -T -o functraceany trap on DEBUG and RETURN are inherited by shell functions -- if no arguments follow this option, then the positional parameters are unset - signal the end of options, cause all remaining arguments to be assigned to the positional parameters show current status show on/off $ set -o $ set -o allexport off braceexpand on emacs on errexit off errtrace off functrace off hashall on histexpand on history on ignoreeof off interactive-comments on keyword off monitor on noclobber off noexec off noglob off nolog off notify off nounset off onecmd off physical off pipefail off posix off privileged off verbose off vi off xtrace off show +o/-o $ set +o $ set +o set +o allexport set -o braceexpand set -o emacs set +o errexit set +o errtrace set +o functrace set -o hashall set -o histexpand set -o history set +o ignoreeof set -o interactive-comments set +o keyword set -o monitor set +o noclobber set +o noexec set +o noglob set +o nolog set +o notify set +o nounset set +o onecmd set +o physical set +o pipefail set +o posix set +o privileged set +o verbose set +o vi set +o xtrace option name option expression allexport Same as -a. braceexpand Same as -B. emacs Use an emacs-style line editing interface. This also affects the editing interface used for read -e. errexit Same as -e. errtrace Same as -E. functrace Same as -T. hashall Same as -h. histexpand Same as -H. history Enable command history, as described in Bash History Facilities. This option is on by default in interactive shells. ignoreeof An interactive shell will not exit upon reading EOF. keyword Same as -k. monitor Same as -m. noclobber Same as -C. noexec Same as -n. noglob Same as -f. nolog Currently ignored. notify Same as -b. nounset Same as -u. onecmd Same as -t. physical Same as -P. pipefail If set, the return value of a pipeline is the value of the last (rightmost) command to exit with a non-zero status, or zero if all commands in the pipeline exit successfully. This option is disabled by default. posix Change the behavior of Bash where the default operation differs from the POSIX standard to match the standard (see Bash POSIX Mode). This is intended to make Bash behave as a strict superset of that standard. privileged Same as -p. verbose Same as -v. vi Use a vi-style line editing interface. This also affects the editing interface used for read -e. xtrace Same as -x. shopt set VS. shopt set originates from the bourne shell (sh) and is part of the POSIX standard; shopt is bourne-again shell (bash) specific $ set | grep -e SHELLOPTS -e BASHOPTS # for shopt BASHOPTS=cdspell:checkwinsize:cmdhist:complete_fullquote:expand_aliases:extglob:extquote:force_fignore:globasciiranges:histappend:interactive_comments:login_shell:progcomp:promptvars:sourcepath # for set SHELLOPTS=braceexpand:emacs:hashall:histexpand:history:interactive-comments:monitor $ set -o | column -t | grep -v off braceexpand on emacs on hashall on histexpand on history on interactive-comments on monitor on $ shopt | column -t | grep -v off cdspell on checkwinsize on cmdhist on complete_fullquote on expand_aliases on extglob on extquote on force_fignore on globasciiranges on histappend on interactive_comments on login_shell on progcomp on promptvars on sourcepath on [!TIP|label:tips:] iMarslo : filename expansion check the shopt on/off ( set +o ) off$ shopt -u extglob $ shopt extglob extglob off $ echo $? 1 on$ shopt -s extglob $ shopt extglob extglob on $ echo $? 0 check without output via -q on$ shopt -q extglob; echo $? 0 off$ shopt -q failglob; echo $? 1 shopt shopt [-pqsu] [-o] [optname …] option expression -s enable ( [s]et ) -u disable ( [u]nset ) -q suppresses normal output -o set -o options assoc_expand_once autocd cdable_vars cdspell checkhash checkjobs checkwinsize cmdhist compat31 compat32 compat40 compat41 compat42 compat43 compat44 complete_fullquote direxpand dirspell dotglob -s: * will including all .* execfail expand_aliases extdebug extglob extquote failglob -s: show error msg and cmd not been exectued force_fignore globasciiranges globstar gnu_errfmt histappend histreedit histverify hostcomplete huponexit inherit_errexit interactive_comments lastpipe lithist localvar_inherit localvar_unset login_shell mailwarn no_empty_cmd_completion nocaseglob nocasematch nullglob progcomp progcomp_alias promptvars restricted_shell shift_verbose sourcepath xpg_echo examples show all status $ shopt | column -t # or $ shopt -p $ shopt | column -t autocd off assoc_expand_once off cdable_vars off cdspell on checkhash off checkjobs off checkwinsize on cmdhist on compat31 off compat32 off compat40 off compat41 off compat42 off compat43 off compat44 off complete_fullquote on direxpand off dirspell off dotglob off execfail off expand_aliases on extdebug off extglob on extquote on failglob off force_fignore on globasciiranges on globskipdots on globstar off gnu_errfmt off histappend on histreedit off histverify off hostcomplete off huponexit off inherit_errexit off interactive_comments on lastpipe off lithist off localvar_inherit off localvar_unset off login_shell on mailwarn off no_empty_cmd_completion off nocaseglob off nocasematch off noexpand_translation off nullglob off patsub_replacement on progcomp on progcomp_alias off promptvars on restricted_shell off shift_verbose off sourcepath on varredir_close off xpg_echo off $ shopt -p shopt -u autocd shopt -u assoc_expand_once shopt -u cdable_vars shopt -s cdspell shopt -u checkhash shopt -u checkjobs shopt -s checkwinsize shopt -s cmdhist shopt -u compat31 shopt -u compat32 shopt -u compat40 shopt -u compat41 shopt -u compat42 shopt -u compat43 shopt -u compat44 shopt -s complete_fullquote shopt -u direxpand shopt -u dirspell shopt -u dotglob shopt -u execfail shopt -s expand_aliases shopt -u extdebug shopt -s extglob shopt -s extquote shopt -u failglob shopt -s force_fignore shopt -s globasciiranges shopt -u globstar shopt -u gnu_errfmt shopt -s histappend shopt -u histreedit shopt -u histverify shopt -u hostcomplete shopt -u huponexit shopt -u inherit_errexit shopt -s interactive_comments shopt -u lastpipe shopt -u lithist shopt -u localvar_inherit shopt -u localvar_unset shopt -s login_shell shopt -u mailwarn shopt -u no_empty_cmd_completion shopt -u nocaseglob shopt -u nocasematch shopt -u nullglob shopt -s progcomp shopt -u progcomp_alias shopt -s promptvars shopt -u restricted_shell shopt -u shift_verbose shopt -s sourcepath shopt -u xpg_echo show single option # shopt -s sourcepath $ shopt -q sourcepath; echo $? 0 # shopt -u xpg_echo $ shopt -q xpg_echo; echo $? 1 readline && bind [!NOTE|label:references:] Readline Interaction Readline Bare Essentials Readline Movement Commands Readline Killing Commands Readline Init File Sample Init File *hybrid readline readline init file syntax | KEY | EXPLAIN | | ------ | ------------------------------- | | \\C- | control prefix | | \\M- | meta prefix | | \\e | an escape character | | \\\\ | backslash | | \\\" | \", a double quotation mark | | \\' | ', a single quote or apostrophe | | \\a | alert (bell) | | \\b | backspace | | \\d | delete | | \\f | form feed | | \\n | newline | | \\r | carriage return | | \\t | horizontal tab | | \\v | vertical tab | | \\nnn | octal value | | \\xHH | hexadecimal value | more samples \"\\e[11~\" : ESC [ 1 1 ~’ : \"Function Key 1\" keynameControl-u: universal-argument Meta-Rubout: backward-kill-word Control-o: \"> output\" keyseq\"\\C-u\": universal-argument \"\\C-x\\C-r\": re-read-init-file \"\\e[11~\": \"Function Key 1\" show options # display readline variable names and values can be used as input or in a Readline initialization file $ bind -v # list current readline variable names and values $ bind -v set bind-tty-special-chars on set blink-matching-paren off set byte-oriented off set colored-completion-prefix off set colored-stats off set completion-ignore-case on set completion-map-case off set convert-meta off set disable-completion off set echo-control-characters on set enable-active-region off set enable-bracketed-paste off set enable-keypad off set enable-meta-key on set expand-tilde off set history-preserve-point off set horizontal-scroll-mode off set input-meta on set mark-directories on set mark-modified-lines off set mark-symlinked-directories on set match-hidden-files on set menu-complete-display-prefix off set meta-flag on set output-meta on set page-completions on set prefer-visible-bell on set print-completions-horizontally on set revert-all-at-newline off set show-all-if-ambiguous on set show-all-if-unmodified on set show-mode-in-prompt off set skip-completed-text on set visible-stats off set bell-style audible set comment-begin # set completion-display-width -1 set completion-prefix-display-length 0 set completion-query-items 100 set editing-mode emacs set emacs-mode-string @ set history-size 10000 set keymap emacs set keyseq-timeout 500 set vi-cmd-mode-string (cmd) set vi-ins-mode-string (ins) options active-region-start-color active-region-end-color bell-style bind-tty-special-chars blink-matching-paren colored-completion-prefix colored-stats comment-begin completion-display-width completion-ignore-case completion-map-case completion-prefix-display-length completion-query-items convert-meta disable-completion echo-control-characters editing-mode emacs-mode-string enable-active-region enable-bracketed-paste enable-keypad enable-meta-key expand-tilde history-preserve-point history-size horizontal-scroll-mode input-meta isearch-terminators keymap keyseq-timeout mark-directories mark-modified-lines mark-symlinked-directories match-hidden-files menu-complete-display-prefix output-meta page-completions print-completions-horizontally revert-all-at-newline show-all-if-ambiguous show-all-if-unmodified show-mode-in-prompt skip-completed-text vi-cmd-mode-string vi-ins-mode-string visible-stats key bindings # display readline function names and bindings can be used as input or in a readline initialization file $ bind -p # list current readline function names and bindings $ bind -P ## query $ bind -p ... \"\\e&\": tilde-expand # vi-tilde-expand (not bound .... $ bind -q tilde-expand tilde-expand can be invoked via \"\\e&\". list all names $ bind -l inputrc $ cat ~/.inputrc set convert-meta off # allow iso-latin1 characters to be inserted set input-meta on # don't strip characters to 7 bits when reading set completion-ignore-case on set show-all-if-ambiguous on set show-all-if-unmodified on set mark-symlinked-directories on set print-completions-horizontally on set enable-bracketed-paste off # https://groups.google.com/g/iterm2-discuss/c/K6YazwKUvjQ/m/7eqeT-AvBgAJ # set show-mode-in-prompt on # TAB: menu-complete # set colored-completion-prefix on # set colored-stats on set skip-completed-text on # set completion-query-items 100 # ask if more than 100 candidates # https://unix.stackexchange.com/a/409866/29178 set keymap emacs $if mode=emacs \"\\ee\": vi-editing-mode $endif set keymap vi-insert $if mode=vi-insert \"\\e\": vi-movement-mode # \"jk\": vi-movement-mode # \"kj\": vi-movement-mode $endif # set editing-mode vi # command mode set keymap vi-command $if mode=vi-command \"\\ee\": emacs-editing-mode v: \"\" Control-a: beginning-of-line Control-b: backward-char Control-d: delete-char Control-e: end-of-line Control-f: forward-char Control-k: kill-line Control-n: next-history Control-p: previous-history $endif # insert mode set keymap vi-insert $if mode=vi-insert \"\\C-k\": kill-line \"\\C-u\": unix-line-discard \"\\C-p\": previous-history \"\\C-n\": next-history \"\\C-a\": beginning-of-line \"\\C-e\": end-of-line \"\\C-f\": forward-char \"\\C-b\": backward-char \"\\C-l\": clear-screen \"\\C-d\": delete-char \"\\C-h\": backward-delete-char \"\\C-w\": unix-word-rubout \"\\et\": transpose-words \"\\ef\": forward-word \"\\eb\": backward-word \"\\ed\": kill-word \"\\e.\":yank-last-arg \"\\e_\": yank-last-arg \"\\C-_\": undo $endif $ cat /etc/inputrc # do not bell on tab-completion #set bell-style none set meta-flag on set input-meta on set convert-meta off set output-meta on # Completed names which are symbolic links to # directories have a slash appended. set mark-symlinked-directories on $if mode=emacs # for linux console and RH/Debian xterm \"\\e[1~\": beginning-of-line \"\\e[4~\": end-of-line # commented out keymappings for pgup/pgdown to reach begin/end of history #\"\\e[5~\": beginning-of-history #\"\\e[6~\": end-of-history \"\\e[5~\": history-search-backward \"\\e[6~\": history-search-forward \"\\e[3~\": delete-char \"\\e[2~\": quoted-insert \"\\e[5C\": forward-word \"\\e[5D\": backward-word \"\\e[1;5C\": forward-word \"\\e[1;5D\": backward-word # for rxvt \"\\e[8~\": end-of-line \"\\eOc\": forward-word \"\\eOd\": backward-word # for non RH/Debian xterm, can't hurt for RH/DEbian xterm \"\\eOH\": beginning-of-line \"\\eOF\": end-of-line # for freebsd console \"\\e[H\": beginning-of-line \"\\e[F\": end-of-line $endif show-mode-in-prompt [!NOTE|label:notes:] This is a patched version of bash 4.3.48 that adds support for custom prompt mode indicators. It also adds support for a \\m prompt escape to specify where in the prompt the indicator should occur. Different bash prompt for different vi editing mode? 96f66efe6fccbd914d3c92a45405af9a7cf25704 show-mode-in-prompt vi-cmd-mode-string vi-ins-mode-string example $ export PS1=\" ┌錄 \\[\\e[32m\\]\\u\\[\\e[m\\]\\[\\e[32m\\]@\\[\\e[m\\]\\[\\e[32m\\]\\h\\[\\e[m\\] \\w \\\\$ \\n \" $ bind 'set show-mode-in-prompt on' $ bind 'set vi-ins-mode-string \" └──錄 (ins):\"' $ bind 'set vi-cmd-mode-string \" └──錄 (cmd):\"' example #################### VIM #################### # FOR MORE INFORMATION CHECK: # https://wiki.archlinux.org/index.php/Readline # TURN ON VIM (E.G. FOR READLINE) set editing-mode vi # SHOW THE VIM MODE IN THE PROMPT (COMMAND OR INSERT) set show-mode-in-prompt on # SET THE MODE STRING AND CURSOR TO INDICATE THE VIM MODE # FOR THE NUMBER AFTER `\\e[`: # 0: blinking block # 1: blinking block (default) # 2: steady block # 3: blinking underline # 4: steady underline # 5: blinking bar (xterm) # 6: steady bar (xterm) set vi-ins-mode-string (ins)\\1\\e[5 q\\2 set vi-cmd-mode-string (cmd)\\1\\e[1 q\\2 example $ cat ~/.inputrc set editing-mode vi set vi-ins-mode-string \\1\\e[5 q\\e]12;green\\a\\2 set vi-cmd-mode-string \\1\\e[1 q\\e]12;orange\\a\\2 set show-mode-in-prompt on tips How to move the cursor word by word in the OS X Terminal $ bind -q backward-word backward-word can be invoked via \"\\M-b\". $ bind -q forward-word forward-word can be invoked via \"\\M-f\". re-read-init-file $ bind -q re-read-init-file re-read-init-file can be invoked via \"\\C-x\\C-r\". glob-list-expansions $ bind -q glob-list-expansions glob-list-expansions can be invoked via \"\\C-xg\" insert-comment $ bind -q insert-comment insert-comment can be invoked via \"\\e#\". insert-last-argument $ bind -q insert-last-argument insert-last-argument can be invoked via \"\\e.\", \"\\e_\". upcase-word && downcase-word && capitalize-word $ bind -q upcase-word upcase-word can be invoked via \"\\eu\". $ bind -q downcase-word downcase-word can be invoked via \"\\el\" $ bind -q capitalize-word capitalize-word can be invoked via \"\\ec\". block cursor set editing-mode vi set show-mode-in-prompt on set vi-ins-mode-string \\1\\e[6 q\\2 set vi-cmd-mode-string \\1\\e[2 q\\2 # optionally: # switch to block cursor before executing a command set keymap vi-insert RETURN: \"\\e\\n\" undo $ bind -q undo undo can be invoked via \"\\C-x\\C-u\", \"\\C-_\". hell-expand-line $ bind -q shell-expand-line shell-expand-line can be invoked via \"\\M-\\C-e\". display-shell-version $ bind -q display-shell-version display-shell-version can be invoked via \"\\C-x\\C-v\". Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-27 09:39:48 "},"cheatsheet/bash/sugar.html":{"url":"cheatsheet/bash/sugar.html","title":"syntactic sugar","keywords":"","body":" oneline commands cat and EOF ssh find and tar find and rename find and sort download and extract sync mirro using string as variable name , && > >(..) parameter substitution arguments substitution string manipulations compound comparison SC2155 SC2155 escape code alias for sudo echo echo var name from variable echo var name bash completion osx linux reference: ppo/gist/bash.md Unix / Linux - Shell Substitution ShellCheck Wiki Sitemap * cd is not a program oneline commands cat and EOF [!NOTE|label:references:] Chapter 19. Here Documents bash Heredoc using heredoc with sshssh -T user@host.com * POSIX.1 states...an operand naming a file can be specified as '-', which means to use the standard input instead of a named file .... kubectl apply from stdin [!NOTE|label:references:] Need some explaination of kubectl stdin and pipe $ cat git apply from stdin $ cat >> 'EOF' | git apply --inaccurate-eof --ignore-whitespace ... ... EOF # or $ git apply --inaccurate-eof --ignore-whitespace --stat git apply from clipboard [!NOTE|label:references:] Pipe (a patch in my clipboard) to git apply? $ pbpaste | git apply $ xsel --clipboard --input | git apply # or $ xclip -selection clipboard -o | git apply patch from stdin [!NOTE|label:references:] How can I run patch through a heredoc in bash? $ patch --dry-run --ignore-whitespace ssh compress and ssh and extract $ tar cf - . | ssh elsewhere tar xf - -C /other/dir tips [!NOTE|label:references:] How can I copy multiple files over scp in one command? # tips $ tar cfz - . | ssh otherhost \"cd /mydir; tar xvzf -\" # the z-flag to tar does compression. Or you can use -C to ssh: $ tar cf - . | ssh -C otherhost \"cd /mydir; tar xvf -\" find and tar $ find . -name builds -prune -o -type f -print | tar czf ~/m.tar.gz --files-from - # or find with maxdepth $ find . -type f -name \"config.xml\" -maxdepth 2 -prune -print | tar czf ~/config.xml.130.tar.gz --files-from - # find with special name $ find . -name config\\.xml -type f -print | tar czf ~/m.tar.gz --files-from - # and ssh and extract $ tar cf - . | ssh -C otherhost \"cd /mydir; tar xvf -\" find and rename $ find -iname \"*.sh\" -exec rename \"s/.sh$/.shell/\" {} \\; -print find and sort via timestamp [!NOTE] How to Find and Sort Files Based on Modification Date and Time in Linux$ find . -type f -printf \"\\n%AD %AT %p\" | head -n 11 | sort -k1.8n -k1.1nr -k1 # or $ find . -type f -printf \"\\n%Tm/%Td/%TY %TT %p\" | sort -k1.8n -k1.1nr -k1 * iMarslo : find printf * printf time formats$ find . -printf \"%T\\n\" sort by datetime format in bash how to sort file by DD-MM-YYYY dates Sort logs by date field in bash # via %T+ $ find ~/.marslo -type f -printf \"%10T+ | %p\\n\" | sort -r | head -10 # via %Td-%Tm-%TY $ find ~/.marslo -type f -printf \"\\n%Td-%Tm-%TY %TT %p\" | sort -b -k1.7,1.10 -k1.4,1.5 -k1.1,1.2 -r via awk+sort $ cat a.txt ABC,1/02/2022,05:50 OPQ,18/10/2023,07:50 HIJ,31/09/2023,08:50 DEF,1/02/2021,06:00 $ awk -F'[,/]' '{printf \"%04d-%02d-%02d\\t%s\\n\", $4,$3,$2, $0}' a | sort -r | cut -f2- OPQ,18/10/2023,07:50 HIJ,31/09/2023,08:50 ABC,1/02/2022,05:50 DEF,1/02/2021,06:00 download and extract tar.gz $ curl -fsSL https://dlcdn.apache.org/maven/maven-3/3.9.5/binaries/apache-maven-3.9.5-bin.tar.gz | tar xzf - -C /path/to/target tar.xz $ curl -fsSL https://ftp.gnu.org/gnu/glibc/glibc-2.38.tar.xz | tar -xJf - -C /path/to/target zip $ curl -fsSL https://downloads.gradle.org/distributions/gradle-8.4-bin.zip | bsdtar xzf - -C /path/to/target sync mirro [!NOTE] How to create public mirrors for CentOSCreatePublicMirrors.html) Configure DNF/Yum Mirror Server $ rsync -aqzH --delay-updates --delete-after msync.centos.org::CentOS /path/to/local/mirror/root # stream 9 $ rsync -aqzH --delay-updates --delete-after rsync.stream.centos.org::CentOS-Stream-All /path/to/local/mirror/root # or src $ rsync -aqzH --delay-updates --delete-after rsync.stream.centos.org::CentOS-Stream-nosrc /path/to/local/mirror/root # exclude debuginfo $ rsync -aqzH --delay-updates --delete-after rsync.stream.centos.org::CentOS-Stream-nodebug /path/to/local/mirror/root using string as variable name [!NOTE|label:references:] 3.5.3 Shell Parameter Expansion How to get a variable value if variable name is stored as string? Dynamic variable names in Bash eval $ aa='echo me' $ var='aa' $ eval echo \\$$var echo me ${!var} $ var1=\"this is the real value\" $ a=\"var1\" $ echo \"${!a}\" this is the real value more usage $ sunny=''' \\033[38;5;226m \\\\ / \\033[0m \\033[38;5;226m .-. \\033[0m \\033[38;5;226m ― ( ) ― \\033[0m \\033[38;5;226m `-’ \\033[0m \\033[38;5;226m / \\\\ \\033[0m ''' $ fewClouds=''' \\033[38;5;226m \\\\ /\\033[0m \\033[38;5;226m _ /\\\"\\\"\\033[38;5;250m.-. \\033[0m \\033[38;5;226m \\\\_\\033[38;5;250m( ). \\033[0m \\033[38;5;226m /\\033[38;5;250m(___(__) \\033[0m ''' $ codeMap=( [\"01\"]=\"sunny\" [\"02\"]=\"fewClouds\" ) $ icon=\"$(/usr/bin/curl -sg \"https://api.openweathermap.org/data/3.0/onecall?lat=37.3541132&lon=-121.955174&units=metric&exclude=hourly,daily,minutely,alerts&appid=${OWM_API_TOKEN}\" | jq -r .current.weather[].icon)\" $ echo ${icon} 02n $ echo -e \"${!codeMap[\"${icon:0:-1}\"]}\" , [!TIP] is Process Substitution The difference between and >(...) is merely which way the redirections are done && > >(..) [!NOTE] process substitution syntax $ command1 SubShell example: $ while read line; do echo \"-- ${line} --\"; done ls.txt $ while read line; do echo \"-- ${line} --\"; done $ wc [!TIP|label:referencs:] subshell tips: # If commandA can read the data from stdin commandB | commandA # You can now get the exit code of commandB from PIPESTATUS. commandB > >(commandA) # You can now get the exit code of commandB from $? (or by putting this in an if) # If commandA cannot read it from stdin, but requires a file argument commandB > >(commandA common usage $ diff >>>>>> /!d;=;p\" ${file} echo -e \"\\n\\033[1;33m---\\033[0m\" done > >(..) [!TIP] Process Substitution >(...) is used less frequently; the most common situation is in conjunction with tee(1). >(...) is handy when redirecting the output to multiple files, based on some criteria. # For example: $ some_command | tee >(grep A > A.out) >(grep B > B.out) >(grep C > C.out) > /dev/null parameter substitution reference: 10.2. Parameter Substitution * iMarslo: params EXPR DESCRIPTION ${variable-default} if variable is unset, use default ${variable=default} if variable is unset, set variable to default ${variable+alt} if variable is set, use alt, else use null string ${variable:-default} with \":[-=+]\", condition takes also \"declared but null\" arguments substitution reference: Process all arguments except the first one (in a bash script) Getting the last argument passed to a shell script Extract parameters before last parameter in \"$@\" EXPR DESCRIPTION $@ p1 p2 p3 p4 p5 p6 ${@: 0} ./args.sh p1 p2 p3 p4 p5 p6 ${@: 1} p1 p2 p3 p4 p5 p6 ${@: 2} p2 p3 p4 p5 p6 ${@: 2:1} p2 ${@: 2:2} p2 p3 ${@: -2} p5 p6 ${@: -2:1} p5 ${*: -1} or ${@: $#} p6 ${@: 1:$#-1} p1 p2 p3 p4 p5 sample with uncertain parameters local opt='' local loop=true local path params while ${loop} && [[ $# -gt 0 ]]; do case \"$1\" in -*) opt+=\"$1 \"; shift;; *) loop=false ;; esac done if [[ 1 = \"$#\" ]]; then path='' params=\"$1\" else path=${*: -1} params=${*:1:$#-1} fi echo '---------------- before shift -------------------' echo \".. \\$# : $#\" echo \".. \\$@ : $@\" echo \".. \\$* : $*\" echo '---------------- after shift -------------------' opt='' ss='' loop=true while $loop && [[ $# -gt 0 ]]; do case \"$1\" in -*) opt+=\"$1 \"; shift;; *) loop=false ;; esac done echo \".. \\$# : $#\" echo \".. \\$@ : $@\" echo \".. \\$* : $*\" echo \".. \\$opt : $opt\" if [[ 0 = \"$#\" ]]; then echo -e \"\\033[0;33mERROR: must provide at least one non-opt param\\033[0m\" exit 2 elif [[ 1 = \"$#\" ]]; then path='' params=\"$1\" else path=${*: -1} params=${*:1:$#-1} fi echo '---------------- result -------------------' echo \">> opt : ${opt}\" echo \">> params : ${params}\" echo \">> path : ${path}\" $ ./c.sh -1 -2 --3-4 a b c d e ---------------- before shift ------------------- .. $# : 8 .. $@ : -1 -2 --3-4 a b c d e .. $* : -1 -2 --3-4 a b c d e ---------------- after shift ------------------- .. $# : 5 .. $@ : a b c d e .. $* : a b c d e .. $opt : -1 -2 --3-4 .. $ss : a b c d e ---------------- result ------------------- >> opt : -1 -2 --3-4 >> params : a b c d >> path : e $ ./c.sh aa bb ---------------- before shift ------------------- .. $# : 2 .. $@ : aa bb .. $* : aa bb ---------------- after shift ------------------- .. $# : 2 .. $@ : aa bb .. $* : aa bb .. $opt : .. $ss : aa bb ---------------- result ------------------- >> opt : >> params : aa >> path : bb $ ./c.sh -1 ---------------- before shift ------------------- .. $# : 1 .. $@ : -1 .. $* : -1 ---------------- after shift ------------------- .. $# : 0 .. $@ : .. $* : .. $opt : -1 ERROR: must provide at least one non-opt param string manipulations reference: 10.1. Manipulating Strings EXPR DESCRIPTION ${#string} length ${string:position} substring, or positional parameter with $* and $# ${string:position:length} substring ${string#substring} deletes shortest match of $substring from front of $string ${string##substring} same but longest match ${string%substring} shortest from back ${string%%substring} longest from back ${string/substring/replacement} replace first match ${string//substring/replacement} replace all matches ${string/#substring/replacement} replace if matches front end of $string ${string/%substring/replacement} replace if matches back end of $string ${var^} uppercase first char ${var^^} uppercase all chars ${var,} lowercase first char ${var,,} lowercase all chars compound comparison SC2155 problematic code:([ \"$x\" ] || [ \"$y\" ]) && [ \"$z\" ] correct code:{ [ \"$x\" ] || [ \"$y\" ]; } && [ \"$z\" ] example git-retag SC2155 problematic code:export foo=\"$(mycmd)\" correct code:foo=\"$(mycmd)\" export foo escape code [!TIP] references: Color Codes, Escapes & Languages Escape codes Escape sequences Quote and Quote-like Operators ESCAPE CODE LANGUAGE DESCRIPTION \\x1b Node.js hex char \\x1b Node.js w/ TS hex char \\u001b Python hex char \\033 GNU Cpp octal char \\033 ANSI C octal char \\033 POSIX-compliant shells octal char \\e Bash - \\c[ - control char alias for sudo [!TIP|label:references:] Aliases not available when using sudo 6.6 Aliases alias sudo='sudo ' echo echo var name from variable [!NOTE] Chapter 28. Indirect References 3.5.3 Shell Parameter Expansion: {!parameter} 9.2. Typing variables: declare or typeset sample:$ foo=bar # `bar` is the var name $ bar=baz # `baz` is the var value typeset $ typeset -p \"${foo}\"$ declare -- bar=\"baz\" eval \\$$ $ eval echo \\$$foo baz more:$ echo \\$$foo $bar # or $ echo '$'$foo $bar {!parameter} $ echo \"${!foo}\" baz echo var name [!NOTE] Shell: print both variable name and value? * How to Echo the Variable Name Instead of Variable Value typeset -p sample$ a1='a' $ a2='aa' $ c1='c' $ c2='cc' typeset $ typeset -p c2 declare -- c2=\"cc\" {!parameter@} $ echo \"${!c@}\" c1 c2 $ echo \"${!a@}\" a1 a2 more superEcho() { echo \"$1 = ${!1}\" } $ superEcho foo foo = bar $ superEcho bar bar = baz bash completion [!NOTE|label:references] * Creating a bash completion script 8.7 Programmable Completion Builtins 8.6 Programmable Completion 8.8 A Programmable Completion Example cykerway/complete-alias Multi Level Bash Completion List all commands that a shell knows * iMarslo : _vim() 8.6 Programmable Completion : _completion_loader() 8.4.6 Letting Readline Type For You paths: osx: /usr/local/etc/bash_completion.d centos: /usr/share/bash-completion/completions or /etc/bash_completion.d ubuntu: /usr/share/bash-completion/completions print existing completion $ complete -p vim complete -o bashdefault -o default -F _fzf_opts_completion vim $ complete -p ffs complete -o bashdefault -o default -o nosort -F _fd ffs $ complete -p ff complete -o bashdefault -o default -o nosort -F _fd ff remove completion $ complete -p vim complete -o bashdefault -o default -F _fzf_opts_completion vim $ complete -r vim $ complete -p vim -bash: complete: vim: no completion specification list all completions $ complete # show all commands $ compgen -c more # aliases $ compgen -a # built-ins $ compgen -b # keywords $ compgen -k # functions $ compgen -A function # list all the above $ compgen -A function -abck $ complete complete -o default -F _quotaon quotaon complete -o default -F _fzf_path_completion mv complete -F _postcat postcat complete -o default -o nospace -v -F _fzf_var_completion printenv complete -o default -F __start_kubectl kcn complete -F _filedir_xspec mpg321 complete -F _filedir_xspec tex complete -F _make gmake complete -o bashdefault -o default -F _fzf_path_completion diff3 complete -o default -F _ansible ansible complete -o default -F _fzf_path_completion head complete -o default -F __start_kubectl kt1 complete -o default -F __start_kubectl kt2 complete -o default -F _fzf_path_completion uniq complete -F _command else complete -o default -F __start_kubectl kt3 complete -F _ldapdelete ldapdelete complete -F _configure configure complete -F _filedir_xspec freeamp complete -F _lzma lzma complete -o default -F __start_kubectl kcc complete -F _filedir_xspec gqmpeg complete -F _filedir_xspec texi2html complete -o default -F _complete_groovydoc groovydoc complete -F _filedir_xspec hbpp complete -F _xsltproc xsltproc complete -F _filedir_xspec jadetex complete -F _docker droot complete -o default -F _longopt mkfifo complete -o bashdefault -o default -F _fzf_path_completion svn complete -o default -F _fzf_path_completion tee complete -F _javaws javaws complete -F _mktemp mktemp complete -F _filedir_xspec rpm2cpio complete -F _docker dvi complete -F _make pmake complete -o default -F _repquota repquota complete -F _filedir_xspec hbrun complete -F _autoscan autoscan complete -o default -F __start_kubectl kubectl complete -o default -F _screen screen complete -F _filedir_xspec ps2pdf14 complete -o default -F _fzf_path_completion grep complete -F _fzf_path_completion vi complete -F _autoreconf autoheader complete -F _composite composite complete -F _fzf_path_completion bat complete -F _filedir_xspec ps2pdf13 complete -o default -F _longopt objdump complete -F _filedir_xspec ps2pdf12 complete -o default -F _longopt sha1sum complete -o default -F _longopt cut complete -F _filedir_xspec lyx complete -o bashdefault -o default -F _fzf_path_completion file complete -F _gcc gpc complete -F _filedir_xspec latex complete -o default -F _look look complete -F _gradle gradlew.bat complete -o bashdefault -o default -F _fzf_path_completion hx complete -F _filedir_xspec poedit complete -F _fzf_path_completion view complete -o bashdefault -o default -F _fzf_path_completion dirname complete -F _function typeset complete -o bashdefault -o default -F _fzf_path_completion hg complete -F _command nohup complete -a -F _fzf_alias_completion unalias complete -F _vipw vipw complete -g groupdel complete -F _make gnumake complete -u groups complete -F _filedir_xspec chromium-browser complete -F _filedir_xspec opera complete -F _filedir_xspec kbabel complete -F _fzf_host_completion telnet complete -F _gcc g77 complete -F _filedir_xspec bzme complete -o bashdefault -o default -F _fzf_complete_ssh ssh complete -F _command vsound complete -c which complete -F _fzf_path_completion tar complete -o default -F _longopt m4 complete -F _filedir_xspec madplay complete -o default -F _fzf_opts_completion fzf-tmux complete -F _docker drm complete -F _filedir_xspec dviselect complete -o default -F _fzf_path_completion cp complete -F _mas mas complete -F _animate animate complete -F _man whatis complete -o default -F _complete_groovysh groovysh.sh complete -F _filedir_xspec evince complete -o bashdefault -o default -F _brew brew complete -F _docker dcleanall complete -F _filedir_xspec realplay complete -o default -F _longopt strip complete -o bashdefault -o default -o nospace -F __git_wrap__gitk_main gitk complete -v readonly complete -o nospace -F _fzf_path_completion rsync complete -F _ctest ctest complete -o nospace -F _fzf_dir_completion cd complete -o default -F _complete_groovydoc groovydoc.bash complete -F _known_hosts showmount complete -F _filedir_xspec kdvi complete -o default -F _longopt tac complete -F _ldapaddmodify ldapmodify complete -F _filedir_xspec elinks complete -F _known_hosts fping complete -o default -F _longopt env complete -o default -F _quota quota complete -F _gradle ./gradlew complete -u chfn complete -F _docker drp complete -F _filedir_xspec compress complete -F _filedir_xspec pdfjadetex complete -F _filedir_xspec kghostview complete -F _man man complete -F _filedir_xspec pbunzip2 complete -o default -F _brctl brctl complete -c type complete -F _ldapcompare ldapcompare complete -F _known_hosts ssh-installkeys complete -F _filedir_xspec iceweasel complete -F _filedir_xspec gtranslator complete -F _fzf_path_completion unzip complete -o default -F _longopt expand complete -o default -F _complete_groovyConsole groovyConsole.bash complete -o bashdefault -o default -o nospace -F _fzf_path_completion git complete -F _filedir_xspec lrunzip complete -o default -F _fzf_path_completion ln complete -F _command aoss complete -F _docker drps complete -F _filedir_xspec ggv complete -F _filedir_xspec oomath complete -F _filedir_xspec dvipdfmx complete -o default -F _fzf_path_completion ld complete -F _fzf_path_completion gunzip complete -F _filedir_xspec makeinfo complete -F _filedir_xspec okular complete -o default -F _complete_groovysh groovysh complete -F _ldapsearch ldapsearch complete -F _command xargs complete -j -P '\"%' -S '\"' jobs complete -o default -F _complete_groovy groovy.sh complete -F _filedir_xspec oowriter complete -o bashdefault -o default -F _fzf_path_completion emacsclient complete -F _cpack cpack complete -o default -F _fzf_path_completion tail complete -o default -F _longopt unexpand complete -o default -F _longopt netstat complete -F _docker dexe complete -o default -F _fzf_path_completion ls complete -F _filedir_xspec epiphany complete -o nospace -F __gio gio complete -o bashdefault -o default -F _fzf_path_completion nvim complete -o dirnames -o nospace -F _fzf_dir_completion pushd complete -F _filedir_xspec acroread complete -o default -o nospace -v -F _fzf_var_completion unset complete -F _postmap postalias complete -F _nmap nmap complete -o default -F _longopt csplit complete -F _known_hosts rsh complete -F _filedir_xspec sxemacs complete -F _command exec complete -F _filedir_xspec aviplay complete -F _ldapmodrdn ldapmodrdn complete -F _filedir_xspec rgvim complete -F _chsh chsh complete -F _autoconf autoconf complete -o default -F _longopt nm complete -o default -F _longopt nl complete -o default -F _complete_grape grape.bash complete -o nospace -F _user_at_host ytalk complete -F _fzf_proc_completion kill complete -F _fzf_path_completion java complete -F _cmake cmake complete -u sux complete -F _cancel cancel complete -F _filedir_xspec znew complete -o default -F _complete_groovydoc groovydoc.sh complete -F _id id complete -o default -F _longopt paste complete -F _ldapaddmodify ldapadd complete -F _docker dip complete -o bashdefault -F _perldoc perldoc complete -F _filedir_xspec kwrite complete -F _root_command really complete -o default -F _complete_groovyc groovyc.bash complete -o bashdefault -o default -o nospace -F __git_wrap__tig_main tig complete -F _filedir_xspec firefox complete -o bashdefault -o default -F _fzf_path_completion open complete -F _ip ip complete -o default -F __start_kubectl klc complete -F _docker drit complete -F _filedir_xspec dvipdfm complete -F _filedir_xspec ly2dvi complete -F _filedir_xspec oodraw complete -F _docker drun complete -F _import import complete -o default -F __start_kubectl kcswatch complete -F _gzip pigz complete -o default -F __start_kubectl kln complete -F _autoscan autoupdate complete -F _known_hosts dig complete -o nospace -F _user_at_host talk complete -F _filedir_xspec xemacs complete -F _docker dls complete -o nospace -F _dd dd complete -F _jarsigner jarsigner complete -F _filedir_xspec kpdf complete -F _man apropos complete -o default -F _longopt df complete -F _command eval complete -F _docker di complete -F _postsuper postsuper complete -F _postconf postconf complete -F _filedir_xspec bibtex complete -o default -F _pip_completion pip complete -F _docker dclr complete -F _postfix postfix complete -F _fzf_path_completion chown complete -F _filedir_xspec netscape complete -o default -F _longopt wget complete -F _command do complete -F _cargo cargo complete -F _gradle gradle complete -F _pgrep pgrep complete -F _filedir_xspec gview complete -F _filedir_xspec lzfgrep complete -o bashdefault -o default -o nosort -F _fd ffs complete -F _filedir_xspec lzless complete -o default -F _fzf_path_completion du complete -F _renice renice complete -F _lsof lsof complete -F _docker dv complete -F _known_hosts tracepath complete -o default -F __start_kubectl kit complete -o default -F _fzf_path_completion wc complete -F _fzf_path_completion gzip complete -F _newgrp newgrp complete -o default -F _ansible-galaxy ansible-galaxy complete -F _filedir_xspec cdiff complete -F _fzf_path_completion emacs complete -F _filedir_xspec zipinfo complete -F _docker dcleani complete -F _filedir_xspec google-chrome complete -F _gcc c++ complete -F _crontab crontab complete -F _filedir_xspec rview complete -A shopt shopt complete -F _docker dcleanc complete -F _root_command sudo complete -F _killall pkill complete -F _fzf_path_completion javac complete -F _fzf_path_completion ftp complete -o default -F _longopt uname complete -o bashdefault -o default -F _rg rg complete -F _known_hosts ping complete -F _filedir_xspec wine complete -F _filedir_xspec galeon complete -F _filedir_xspec pdflatex complete -F _docker dex complete -F _known_hosts rlogin complete -o default -F _fzf_opts_completion fzf complete -F _filedir_xspec portecle complete -o default -F _longopt sha384sum complete -o default -F _fzf_path_completion rm complete -F _filedir_xspec modplugplay complete -F _ri ri complete -o default -F _quotaoff quotaoff complete -F _filedir_xspec dillo complete -F _filedir_xspec fbxine complete -F _filedir_xspec lokalize complete -F _root_command gksudo complete -F _command nice complete -o default -F _longopt tr complete -o default -F _npm_completion npm complete -F _filedir_xspec oocalc complete -o default -F _complete_groovyc groovyc.sh complete -F _gradle gradlew complete -o default -F _longopt sha256sum complete -F _root_command gksu complete -F _filedir_xspec qiv complete -F _chgrp chgrp complete -F _filedir_xspec ps2pdfwr complete -o default -F _edquota edquota complete -F _filedir_xspec harbour complete -o bashdefault -o default -F _fzf_path_completion basename complete -o default -F _longopt ptx complete -F _filedir_xspec dvitype complete -o nospace -F __gsettings gsettings complete -F _gradle ./gradlew.bat complete -F _known_hosts traceroute complete -F _fzf_path_completion bzip2 complete -j -P '\"%' -S '\"' fg complete -o bashdefault -o default -o nosort -F _fd ff complete -F _convert convert complete -F _filedir_xspec unpigz complete -o default -F _complete_groovy groovy complete -o bashdefault -o default -o nosort -F _fd fd complete -F _filedir_xspec mozilla complete -F _filedir_xspec dvips complete -o default -F _longopt who complete -F _montage montage complete -F _complete compgen complete -F _filedir_xspec ps2pdf complete -F _filedir_xspec gpdf complete -F _complete complete complete -F _filedir_xspec texi2dvi complete -o dirnames -F _umount umount complete -F _function function complete -o bashdefault -o default -F _fzf_path_completion mvim complete -o default -F _fzf_path_completion less complete -o default -F _longopt mknod complete -F _command padsp complete -F _passwd passwd complete -F _filedir_xspec kate complete -F _pkg_config pkg-config complete -o default -F _longopt bison complete -F _filedir_xspec mozilla-firefox complete -F _filedir_xspec kid3-qt complete -o default -F _longopt od complete -F _fzf_path_completion bunzip2 complete -o default -o dirnames -F _mount mount complete -F _function declare complete -F _filedir_xspec pdftex complete -F _ag ag complete -o default -o nospace -F _fzf_var_completion export complete -F _vipw vigr complete -o default -F _ansible-doc ansible-doc complete -F _nslookup nslookup complete -F _ssh slogin complete -o nospace -F _alias alias complete -F _fzf_path_completion gvim complete -F _filedir_xspec kaffeine complete -F _stream stream complete -F _docker drdp complete -o default -F _complete_grape grape.sh complete -F _filedir_xspec mpg123 complete -F _fzf_path_completion find complete -F _filedir_xspec lzegrep complete -o default -F _ansible-pull ansible-pull complete -o default -F _longopt split complete -o bashdefault -o default -F _fzf_path_completion zip complete -F _ssh autossh complete -F _filedir_xspec xv complete -o default -F _longopt fold complete -F _known_hosts mtr complete -o bashdefault -o default -F _fzf_path_completion ruby complete -o nospace -F _fzf_path_completion scp complete -F _known_hosts ping6 complete -F _filedir_xspec timidity complete -F _filedir_xspec xdvi complete -F _filedir_xspec xfig complete -F _filedir_xspec xpdf complete -o default -F _longopt indent complete -o bashdefault -o default -F _fzf_path_completion chmod complete -o nospace -F _user_at_host finger complete -o bashdefault -o default -o nospace -F _python_argcomplete pipx complete -F _ktutil ktutil complete -F _xz xz complete -F _filedir_xspec oobase complete -F _docker dpa complete -F _fzf_path_completion perl complete -F _root_command kdesudo complete -F _docker drmi complete -F _filedir_xspec ogg123 complete -F _filedir_xspec lzgrep complete -u w complete -F _filedir_xspec ee complete -F _sh sh complete -o default -F __start_kubectl kubecolor complete -F _docker dps complete -F _filedir_xspec gharbour complete -u su complete -o default -F _complete_grape grape complete -o default -F _longopt irb complete -F _known_hosts host complete -o default -F __start_kubectl k complete -o bashdefault -o default -F _fzf_path_completion ex complete -o default -F _complete_groovyConsole groovyConsole complete -o nospace -F __gdbus gdbus complete -F _sysctl sysctl complete -F _sqlite3 sqlite3 complete -o default -F _iconv iconv complete -F _command tsocks complete -F _docker d complete -F _xmllint xmllint complete -o default -F _fzf_path_completion diff complete -F _ldapwhoami ldapwhoami complete -F _bzip2 pbzip2 complete -F _postmap postmap complete -o bashdefault -o filenames -F _pandoc pandoc complete -F _filedir_xspec bzcat complete -F _filedir_xspec unlzma complete -F _filedir_xspec dragon complete -F _xzdec xzdec complete -o default -F _longopt shar complete -F _filedir_xspec ooimpress complete -F _cpio cpio complete -F _filedir_xspec xanim complete -o default -F _complete_groovysh groovysh.bash complete -o default -F _ansible-vault ansible-vault complete -j -P '\"%' -S '\"' disown complete -F _filedir_xspec xine complete -o default -F _longopt bash complete -o default -F _longopt md5sum complete -o bashdefault -o default -F _fzf_path_completion source complete -F _filedir_xspec amaya complete -F _filedir_xspec gv complete -F _make make complete -o default -F _fzf_path_completion curl complete -A stopped -P '\"%' -S '\"' bg complete -o default -F __start_kubectl kubeproxy complete -F _filedir_xspec kid3 complete -o nospace -F __gresource gresource complete -F _filedir_xspec lilypond complete -o default -F _longopt bc complete -F _identify identify complete -F _filedir_xspec modplug123 complete -o default -F __start_kubectl k4 complete -F _pack200 pack200 complete -A binding bind complete -o default -F _setquota setquota complete -b builtin complete -F _unpack200 unpack200 complete -o default -F _quotacheck quotacheck complete -F _filedir_xspec pbzcat complete -F _known_hosts tracepath6 complete -o default -F _complete_groovyc groovyc complete -o default -F _longopt shasum complete -F _command ltrace complete -o default -F __start_kubectl k3 complete -F _fzf_path_completion gcc complete -F __app gapplication complete -o bashdefault -o default -F _fzf_path_completion xdg-open complete -o default -F _ansible-playbook ansible-playbook complete -u write complete -F _known_hosts traceroute6 complete -F _fzf_path_completion jar complete -o default -F _longopt date complete -F _gcc gcj complete -F _filedir_xspec rgview complete -o default -F _fzf_path_completion cat complete -o default -F _fzf_path_completion awk complete -o default -F _complete_groovyConsole groovyConsole.sh complete -o default -F _longopt sha512sum complete -F _filedir_xspec unxz complete -o default -F _longopt seq complete -o default -F _longopt mkdir complete -F _filedir_xspec rvim complete -o default -F __start_kubectl krn complete -o default -F _longopt sha224sum complete -A helptopic help complete -F _fzf_path_completion sftp complete -A setopt set complete -o default -F __start_kubectl krc complete -F _compare compare complete -F _tmux tmux complete -F _ssh_copy_id ssh-copy-id complete -o default -F _fzf_path_completion sort complete -o default -F _longopt pr complete -o default -F _longopt colordiff complete -o default -F _fzf_path_completion patch complete -F _fzf_path_completion g++ complete -o bashdefault -o default -F _fzf_path_completion python complete -F _conjure conjure complete -F _ldappasswd ldappasswd complete -F _filedir_xspec playmidi complete -o default -F __start_kubectl kcEvicted complete -o default -F _openssl openssl complete -o default -F _longopt fmt complete -o default -F _fzf_path_completion sed complete -F _tcpdump tcpdump complete -F _javadoc javadoc complete -F _filedir_xspec lzcat complete -o default -F _longopt gperf complete -F _command time complete -F _filedir_xspec zcat complete -F _mogrify mogrify complete -F _display display complete -F _root_command fakeroot complete -o default -F _complete_groovy groovy.bash complete -F _filedir_xspec lynx complete -u slay complete -F _filedir_xspec uncompress complete -F _autoreconf autoreconf complete -F _filedir_xspec xzcat complete -o default -F _fzf_dir_completion rmdir complete -F _filedir_xspec slitex complete -o bashdefault -o default -F _fzf_opts_completion vim complete -F _filedir_xspec aaxine complete -F _filedir_xspec advi complete -o bashdefault -o default -F _fzf_path_completion more complete -o default -F _longopt units complete -F _docker dcleanfull complete -o default -F _longopt touch complete -F _filedir_xspec lzmore complete -F _command then complete -F _command command complete -F _docker dkill complete -o default -F __start_kubectl kd complete -F _known_hosts fping6 complete -u runuser complete -F _filedir_xspec dvipdf complete -o default -F __start_kubectl kc complete -F _gradle gradle.bat osx [!NOTE] Bash Completion How to Enable Bash Completion on macOS $ brew install bash-completion $ echo \"[ -f /usr/local/etc/bash_completion ] && . /usr/local/etc/bash_completion\" >> ~/.bash_profile $ cat ~/.bash_profile [ -f /usr/local/etc/bash_completion ] && . /usr/local/etc/bash_completion to check link of bash-completion $ brew unlink bash-completion --dry-run Would remove: /usr/local/etc/bash_completion /usr/local/etc/bash_completion.d/abook /usr/local/etc/bash_completion.d/ant ... add more completion files $ fd --gen-completions | sudo tee /usr/local/etc/bash_completion.d/fd more $ brew search completion ==> Formulae apm-bash-completion docker-completion open-completion stormssh-completion bash-completion ✔ fabric-completion packer-completion t-completion bash-completion@2 gem-completion pip-completion tmuxinator-completion boom-completion gradle-completion ✔ rails-completion vagrant-completion brew-cask-completion ✔ grunt-completion rake-completion wp-cli-completion bundler-completion kitchen-completion ruby-completion yarn-completion cap-completion launchctl-completion rustc-completion zsh-completions conda-zsh-completion maven-completion sonar-completion django-completion mix-completion spring-completion ==> Casks compositor linux enable if ! shopt -oq posix; then if [ -f /usr/share/bash-completion/bash_completion ]; then . /usr/share/bash-completion/bash_completion elif [ -f /etc/bash_completion ]; then . /etc/bash_completion fi fi add more completion files $ fd --gen-completions | sudo tee /usr/share/bash-completion/completions/fd centos$ fd --gen-completions | sudo tee /etc/bash_completion.d/fd Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-05 01:04:34 "},"cheatsheet/windows/windows.html":{"url":"cheatsheet/windows/windows.html","title":"windows","keywords":"","body":" system information manufacturer serial number product name uuid system slot cpu os system sensor status memory disk mac address process get the list of programs (wmic) ps auxf stop service & process via powershell CLSID usage details regedit Set %USERPROFILE% as ${HOME} for cygwin PuTTy disable screensaver Remove Graphics card context menu Set Environment Variables setx problem whoami check SID fingerprint pro enable gadgets issue about \"profile.d\\Active\"' is not recognized as an internal or external command stop windows beep outlook move hubbar to bottom shell utf-8 in windows terminal win + r debug in powershell show all environment variables setup environment via config file by powershell tricky enable LongPaths in windows Internet Explorer Enhanced Security Configuration is enabled powershell plugins openssh for windows troubleshooting Error code = 0x800f0954 reference: windows commandline TenForums system information 20 Useful wmic command examples in Windows | Cheat Sheet MS-DOS and Windows command line wmic command Find The Manufacturer, Model, Name And System Type Using The Command Prompt How to Find Your Windows 10 PC Hardware and System Specs How to get full PC memory specs (speed, size, type, part number, form factor) on Windows 10 4 Ways to Find Number of Cores in your CPU on Windows 10 View Disk Properties and LUN Information in Windows Get mac address from command line (CMD) How to check a PC's hard drive model, serial number, firmware version, and more using Command Prompt [!TIP|label:memorychip] supported types: ID TYPE 0 Unknown 1 Other 2 DRAM 3 Synchronous DRAM 4 Cache DRAM 5 EDO 6 EDRAM 7 VRAM 8 SRAM 9 RAM 10 ROM 11 Flash 12 EEPROM 13 FEPROM 14 EPROM 15 CDRAM 16 3DRAM 17 SDRAM 18 SGRAM 19 RDRAM 20 DDR 21 DDR2 22 DDR2 FB-DIMM 24 DDR3 25 FBD2 26 DDR4 supported form factors: ID FORM 0 Unknown 1 Other 2 SIP 3 DIP 4 ZIP 5 SOJ 6 Proprietary 7 SIMM 8 DIMM 9 TSOP 10 PGA 11 RIMM 12 SODIMM 13 SRIMM 14 SMD 15 SSMP 16 QFP 17 TQFP 18 SOIC 19 LCC 20 PLCC 21 BGA 22 FPBGA 23 LGA 24 FB-DIMM > wmic computersystem AdminPasswordStatus AutomaticManagedPagefile AutomaticResetBootOption AutomaticResetCapability BootOptionOnLimit BootOptionOnWatchDog BootROMSupported BootStatus BootupState Caption ChassisBootupState ChassisSKUNumber CreationClassName CurrentTimeZone DaylightInEffect Description DNSHostName Domain DomainRole EnableDaylightSavingsTime FrontPanelResetStatus HypervisorPresent InfraredSupported InitialLoadInfo InstallDate KeyboardPasswordStatus LastLoadInfo Manufacturer Model Name NameFormat NetworkServerModeEnabled NumberOfLogicalProcessors NumberOfProcessors OEMLogoBitmap OEMStringArray PartOfDomain PauseAfterReset PCSystemType PCSystemTypeEx PowerManagementCapabilities PowerManagementSupported PowerOnPasswordStatus PowerState PowerSupplyState PrimaryOwnerContact PrimaryOwnerName ResetCapability ResetCount ResetLimit Roles Status SupportContactDescription SystemFamily SystemSKUNumber SystemStartupDelay SystemStartupOptions SystemStartupSetting SystemType ThermalState TotalPhysicalMemory UserName WakeUpType Workgroup 3 TRUE TRUE TRUE TRUE {0, 0, 0, 0, 0, 0, 0, 0, 0, 0} Normal boot MY-WINDOWS 3 Default string Win32_ComputerSystem 480 AT/AT COMPATIBLE MY-WINDOWS computer.com 3 TRUE 3 FALSE FALSE 3 Supermicro SYS-1028U-E1CRTP+ MY-COMUTER TRUE 32 2 {\"Intel Haswell/Wellsburg/Grantley\", \"Supermicro motherboard-X10 Series\"} TRUE -1 4 4 3 0 3 Windows User 1 -1 -1 {\"LM_Workstation\", \"LM_Server\", \"NT\", \"Server_NT\"} OK Default string Default string x64-based PC 3 120139976704 6 REM computer system product > wmic csproduct Caption Description IdentifyingNumber Name SKUNumber UUID Vendor Version Computer System Product Computer System Product S2xxxxxxxxxxxxx SYS-xxxxU-Exxxxx+ 00000000-0000-0000-0000-0xxxxxxxxxxx Supermicro 0123456789 > wmic bios BiosCharacteristics BIOSVersion BuildNumber Caption CodeSet CurrentLanguage Description EmbeddedControllerMajorVersion EmbeddedControllerMinorVersion IdentificationCode InstallableLanguages InstallDate LanguageEdition ListOfLanguages Manufacturer Name OtherTargetOS PrimaryBIOS ReleaseDate SerialNumber SMBIOSBIOSVersion SMBIOSMajorVersion SMBIOSMinorVersion SMBIOSPresent SoftwareElementID SoftwareElementState Status SystemBiosMajorVersion SystemBiosMinorVersion TargetOperatingSystem Version {7, 11, 12, 15, 16, 17, 19, 23, 24, 25, 26, 27, 28, 29, 32, 33, 40, 42, 43} {\"- 1072009\", \"BIOS Date: 06/08/18 21:36:11 Ver: 05.0000B\"} BIOS Date: 06/08/18 21:36:11 Ver: 05.0000B BIOS Date: 06/08/18 21:36:11 Ver: 05.0000B 255 255 American Megatrends Inc. BIOS Date: 06/08/18 21:36:11 Ver: 05.0000B TRUE 20180608000000.000000+000 Sxxxxxxxxxxxxx2 3.1 3 0 TRUE BIOS Date: 06/08/18 21:36:11 Ver: 05.0000B 3 OK 5 6 0 - 1072009 > wmic cpu AddressWidth Architecture AssetTag Availability Caption Characteristics ConfigManagerErrorCode ConfigManagerUserConfig CpuStatus CreationClassName CurrentClockSpeed CurrentVoltage DataWidth Description DeviceID ErrorCleared ErrorDescription ExtClock Family InstallDate L2CacheSize L2CacheSpeed L3CacheSize L3CacheSpeed LastErrorCode Level LoadPercentage Manufacturer MaxClockSpeed Name NumberOfCores NumberOfEnabledCore NumberOfLogicalProcessors OtherFamilyDescription PartNumber PNPDeviceID PowerManagementCapabilities PowerManagementSupported ProcessorId ProcessorType Revision Role SecondLevelAddressTranslationExtensions SerialNumber SocketDesignation Status StatusInfo Stepping SystemCreationClassName SystemName ThreadCount UniqueId UpgradeMethod Version VirtualizationFirmwareEnabled VMMonitorModeExtensions VoltageCaps 64 9 3 Intel64 Family 6 Model 79 Stepping 1 252 1 Win32_Processor 1200 18 64 Intel64 Family 6 Model 79 Stepping 1 CPU0 100 179 2048 25600 0 6 2 GenuineIntel 3201 Intel(R) Xeon(R) CPU E5-2667 v4 @ 3.20GHz 8 8 16 FALSE BFEBFBFF000406F1 3 20225 CPU TRUE CPU1 OK 3 Win32_ComputerSystem MY-COMUTER 16 43 TRUE TRUE 64 9 3 Intel64 Family 6 Model 79 Stepping 1 252 1 Win32_Processor 1200 18 64 Intel64 Family 6 Model 79 Stepping 1 CPU1 100 179 2048 25600 0 6 1 GenuineIntel 3201 Intel(R) Xeon(R) CPU E5-2667 v4 @ 3.20GHz 8 8 16 FALSE BFEBFBFF000406F1 3 20225 CPU TRUE CPU2 OK 3 Win32_ComputerSystem MY-COMUTER 16 43 TRUE TRUE > wmic os BootDevice BuildNumber BuildType Caption CodeSet CountryCode CreationClassName CSCreationClassName CSDVersion CSName CurrentTimeZone DataExecutionPrevention_32BitApplications DataExecutionPrevention_Available DataExecutionPrevention_Drivers DataExecutionPrevention_SupportPolicy Debug Description Distributed EncryptionLevel ForegroundApplicationBoost FreePhysicalMemory FreeSpaceInPagingFiles FreeVirtualMemory InstallDate LargeSystemCache LastBootUpTime LocalDateTime Locale Manufacturer MaxNumberOfProcesses MaxProcessMemorySize MUILanguages Name NumberOfLicensedUsers NumberOfProcesses NumberOfUsers OperatingSystemSKU Organization OSArchitecture OSLanguage OSProductSuite OSType OtherTypeDescription PAEEnabled PlusProductID PlusVersionNumber PortableOperatingSystem Primary ProductType RegisteredUser SerialNumber ServicePackMajorVersion ServicePackMinorVersion SizeStoredInPagingFiles Status SuiteMask SystemDevice SystemDirectory SystemDrive TotalSwapSpaceSize TotalVirtualMemorySize TotalVisibleMemorySize Version WindowsDirectory \\Device\\HarddiskVolume2 14393 Multiprocessor Free Microsoft Windows Server 2016 Standard 1252 1 Win32_OperatingSystem Win32_ComputerSystem MY-COMUTER 480 TRUE TRUE TRUE 3 FALSE FALSE 256 2 104318100 16628652 123960128 20190906144511.000000+480 20220910175932.131994+480 20221108192010.474000+480 0409 Microsoft Corporation 4294967295 137438953344 {\"en-US\"} Microsoft Windows Server 2016 Standard|C:\\Windows|\\Device\\Harddisk0\\Partition3 0 90 11 7 64-bit 1033 272 18 FALSE TRUE 3 Windows User 003xx-6xxxx-00000-AAxxx 0 0 16777216 OK 272 \\Device\\HarddiskVolume3 C:\\Windows\\system32 C: 134101412 117324196 10.0.14393 C:\\Windows > wmic memorychip list BankLabel Capacity DataWidth Description DeviceLocator FormFactor HotSwappable InstallDate InterleaveDataDepth InterleavePosition Manufacturer MemoryType Model Name OtherIdentifyingInfo PartNumber PositionInRow PoweredOn Removable Replaceable SerialNumber SKU Speed Status Tag TotalWidth TypeDetail Version P0_Node0_Channel0_Dimm0 17179869184 64 Physical Memory P1-DIMMA1 8 0 0 Micron 0 Physical Memory 18ASF2G72PDZ-2G6E1 1 1D698284 2667 Physical Memory 0 72 128 P0_Node0_Channel1_Dimm0 17179869184 64 Physical Memory P1-DIMMB1 8 0 0 Micron 0 Physical Memory 18ASF2G72PDZ-2G6E1 1 1D69C62D 2667 Physical Memory 3 72 128 P0_Node0_Channel2_Dimm0 17179869184 64 Physical Memory P1-DIMMC1 8 0 0 Micron 0 Physical Memory 18ASF2G72PDZ-2G6E1 1 1D6975D6 2667 Physical Memory 6 72 128 P0_Node0_Channel3_Dimm0 17179869184 64 Physical Memory P1-DIMMD1 8 0 0 Micron 0 Physical Memory 18ASF2G72PDZ-2G6E1 1 1D697650 2667 Physical Memory 9 72 128 P1_Node1_Channel1_Dimm0 17179869184 64 Physical Memory P2-DIMMF1 8 0 0 Micron 0 Physical Memory 18ASF2G72PDZ-2G6E1 1 1D696E47 2667 Physical Memory 15 72 128 P1_Node1_Channel2_Dimm0 17179869184 64 Physical Memory P2-DIMMG1 8 0 0 Micron 0 Physical Memory 18ASF2G72PDZ-2G6E1 1 1D69C141 2667 Physical Memory 18 72 128 P1_Node1_Channel3_Dimm0 17179869184 64 Physical Memory P2-DIMMH1 8 0 0 Micron 0 Physical Memory 18ASF2G72PDZ-2G6E1 1 1D69BD45 2667 Physical Memory 21 72 128 > wmic diskdrive list Availability BytesPerSector Capabilities CapabilityDescriptions CompressionMethod ConfigManagerErrorCode ConfigManagerUserConfig DefaultBlockSize Description DeviceID ErrorCleared ErrorDescription ErrorMethodology Index InstallDate InterfaceType LastErrorCode Manufacturer MaxBlockSize MaxMediaSize MediaLoaded MediaType MinBlockSize Model Name NeedsCleaning NumberOfMediaSupported Partitions PNPDeviceID PowerManagementCapabilities PowerManagementSupported SCSIBus SCSILogicalUnit SCSIPort SCSITargetId SectorsPerTrack Signature Size Status StatusInfo SystemName TotalCylinders TotalHeads TotalSectors TotalTracks TracksPerCylinder 512 {3, 4} {\"Random Access\", \"Supports Writing\"} 0 FALSE Disk drive \\\\.\\PHYSICALDRIVE1 1 SCSI (Standard disk drives) TRUE Fixed hard disk media AVAGO SMC3108 SCSI Disk Device \\\\.\\PHYSICALDRIVE1 2 SCSI\\DISK&VEN_AVAGO&PROD_SMC3108\\5&1xxxxxxxxxxxxxxx0 1 0 0 1 63 7679261237760 OK MY-COMPUTER 933617 255 14998557105 238072335 255 512 {3, 4} {\"Random Access\", \"Supports Writing\"} 0 FALSE Disk drive \\\\.\\PHYSICALDRIVE0 0 SCSI (Standard disk drives) TRUE Fixed hard disk media AVAGO SMC3108 SCSI Disk Device \\\\.\\PHYSICALDRIVE0 3 SCSI\\DISK&VEN_AVAGO&PROD_SMC3108\\5&1xxxxxxxxxxxxxxx0 1 0 0 0 38 745584 239511336960 OK MY-COMPUTER 117242 105 467795580 12310410 105 or ctrl + r -> msinfo32 msinfo32 manufacturer > wmic computersystem get manufacturer anufacturer Supermicro serial number > wmic bios get serialnumber SerialNumber Sxxxxxxxxxxxxx2 product name > wmic computersystem get model,name,manufacturer,systemtype uuid > wmic csproduct get uuid UUID 00000000-0000-0000-0000-0xxxxxxxxxxx system slot > wmic systemslot get slotdesignation,currentusage,description,status CurrentUsage Description SlotDesignation Status 4 System Slot RSC-R1UW-2E16 SLOT1 PCI-E X16 OK 3 System Slot RSC-R1UW-2E16 SLOT2 PCI-E X16 OK 3 System Slot RSC-R1UW-E8R SLOT1 PCI-E X8 OK 4 System Slot AOC-URN2-i4GXS SLOT1 PCI-E 3.0 X8 OK cpu > wmic cpu get DeviceID,NumberOfCores,NumberOfLogicalProcessors,Manufacturer,Name,ProcessorId DeviceID Manufacturer Name NumberOfCores NumberOfLogicalProcessors ProcessorId CPU0 GenuineIntel Intel(R) Xeon(R) CPU E5-2667 v4 @ 3.20GHz 8 16 BFEBFBFF000406F1 CPU1 GenuineIntel Intel(R) Xeon(R) CPU E5-2667 v4 @ 3.20GHz 8 16 BFEBFBFF000406F1 REM or > wmic cpu get SocketDesignation, NumberOfCores, NumberOfLogicalProcessors /Format:List NumberOfCores=8 NumberOfLogicalProcessors=16 SocketDesignation=CPU1 NumberOfCores=8 NumberOfLogicalProcessors=16 SocketDesignation=CPU2 REM or > echo %NUMBER_OF_PROCESSORS% 32 or > Get-WmiObject –class Win32_processor | ft NumberOfCores,NumberOfLogicalProcessors NumberOfCores NumberOfLogicalProcessors ------------- ------------------------- 8 16 os > wmic os get Caption,CodeSet,Manufacturer,OSArchitecture,SerialNumber Caption CodeSet Manufacturer OSArchitecture SerialNumber icrosoft Windows Server 2016 Standard 1252 Microsoft Corporation 64-bit 003xx-6xxxx-00000-AAxxx system sensor status > wmic temperature get deviceid,name,status memory > wmic memphysical Caption CreationClassName Depth Description Height HotSwappable InstallDate Location Manufacturer MaxCapacity MaxCapacityEx MemoryDevices MemoryErrorCorrection Model Name OtherIdentifyingInfo PartNumber PoweredOn Removable Replaceable SerialNumber SKU Status Tag Use Version Weight Width Physical Memory Array Win32_PhysicalMemoryArray Physical Memory Array 3 805306368 805306368 12 6 Physical Memory Array Physical Memory Array 0 3 Physical Memory Array Win32_PhysicalMemoryArray Physical Memory Array 3 805306368 805306368 12 6 Physical Memory Array Physical Memory Array 1 3 > systeminfo | findstr /C:\"Total Physical Memory\" Total Physical Memory: 114,574 MB > wmic computersystem get TotalPhysicalMemory TotalPhysicalMemory 120139976704 > wmic os get TotalVirtualMemorySize, TotalVisibleMemorySize, FreePhysicalMemory, FreeVirtualMemory, MaxProcessMemorySize FreePhysicalMemory FreeVirtualMemory MaxProcessMemorySize TotalVirtualMemorySize TotalVisibleMemorySize 104338016 123980828 137438953344 134101412 117324196 disk > wmic diskdrive get model,index,firmwareRevision,status,interfaceType,totalHeads,totalTracks,totalCylinders,totalSectors,partitions FirmwareRevision Index InterfaceType Model Partitions Status TotalCylinders TotalHeads TotalSectors TotalTracks 4.68 1 SCSI AVAGO SMC3108 SCSI Disk Device 2 OK 933617 255 14998557105 238072335 4.68 0 SCSI AVAGO SMC3108 SCSI Disk Device 3 OK 117242 105 467795580 12310410 via diskpart > diskpart DISKPART> list volume Volume ### Ltr Label Fs Type Size Status Info ---------- --- ----------- ----- ---------- ------- --------- -------- Volume 0 E New Volume NTFS Simple 7151 GB Healthy Volume 1 System Rese NTFS Partition 500 MB Healthy System Volume 2 C NTFS Partition 221 GB Healthy Boot DISKPART> list disk Disk ### Status Size Free Dyn Gpt -------- ------------- ------- ------- --- --- Disk 0 Online 223 GB 0 B Disk 1 Online 7151 GB 0 B * * DISKPART> select disk 0 Disk 0 is now the selected disk. DISKPART> detail disk AVAGO SMC3108 SCSI Disk Device Disk ID: 000B6070 Type : RAID Status : Online Path : 1 Target : 0 LUN ID : 0 Location Path : PCIROOT(0)#PCI(0200)#PCI(0000)#RAID(P01T00L00) Current Read-only State : No Read-only : No Boot Disk : Yes Pagefile Disk : Yes Hibernation File Disk : No Crashdump Disk : Yes Clustered Disk : No Volume ### Ltr Label Fs Type Size Status Info ---------- --- ----------- ----- ---------- ------- --------- -------- Volume 1 System Rese NTFS Partition 500 MB Healthy System Volume 2 C NTFS Partition 221 GB Healthy Boot DISKPART> select disk 1 Disk 1 is now the selected disk. DISKPART> detail disk AVAGO SMC3108 SCSI Disk Device Disk ID: {057A21CC-17C6-45E2-893C-D68B128CAD35} Type : RAID Status : Online Path : 1 Target : 1 LUN ID : 0 Location Path : PCIROOT(0)#PCI(0200)#PCI(0000)#RAID(P01T01L00) Current Read-only State : No Read-only : No Boot Disk : No Pagefile Disk : No Hibernation File Disk : No Crashdump Disk : No Clustered Disk : No Volume ### Ltr Label Fs Type Size Status Info ---------- --- ----------- ----- ---------- ------- --------- -------- Volume 0 E New Volume NTFS Simple 7151 GB Healthy mac address > getmac Physical Address Transport Name =================== ========================================================== AC-xx-xx-xx-xx-xx Media disconnected N/A Hardware not present 0C-xx-xx-xx-xx-xx \\Device\\Tcpip_{BxxxxxxA-3xx1-4xxF-8xx5-3xxxxxxxxxxA} process get the list of programs (wmic) [12:26:33.40 C:\\Windows\\SysWOW64] $ wmic product get name,version Name Version ALM-Platform Loader 11.5x 11.52.444.0 icrosoft Lync Web App Plug-in 15.8.8308.577 Google App Engine 1.8.6.0 icrosoft Office Professional Plus 2010 14.0.6029.1000 icrosoft Office OneNote MUI (English) 2010 14.0.6029.1000 ... ps auxf tasklist > tasklist Image Name PID Session Name Session# Mem Usage ========================= ======== ================ =========== ============ System Idle Process 0 Services 0 4 K System 4 Services 0 8,236 K smss.exe 520 Services 0 1,164 K csrss.exe 864 Services 0 4,340 K wininit.exe 960 Services 0 4,744 K csrss.exe 968 Console 1 11,396 K services.exe 108 Services 0 7,776 K lsass.exe 96 Services 0 22,176 K stop service & process via powershell reference: Restart docker Windows 10 command line get service: PS > Get-Service | Where-Object {$_.name -ilike \"*docker*\" -and $_.Status -ieq \"Running\"} Status Name DisplayName ------ ---- ----------- Running docker Docker Engine # or PS > Get-Service | Where-Object {$_.name -ilike \"*docker*\" -and $_.Status -ieq \"Running\"} Status Name DisplayName ------ ---- ----------- Running docker Docker Engine stop service: PS > foreach($svc in (Get-Service | Where-Object {$_.name -ilike \"*docker*\" -and $_.Status -ieq \"Running\"})) { $svc | Stop-Service -ErrorAction Continue -Confirm:$false -Force } # or PS > Stop-Service docker -ErrorAction Continue -Confirm:$false -Force get process PS > Get-Process | Where-Object {$_.Name -ilike \"*docker*\"} Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName ------- ------ ----- ----- ------ -- -- ----------- 644 43 175288 56388 475.31 5080 0 dockerd stop process PS > Get-Process | Where-Object {$_.Name -ilike \"*docker*\"} | Stop-Process -ErrorAction Continue -Confirm:$false -Force restart docker service & process PS > Stop-Service docker -ErrorAction Continue -Confirm:$false -Force PS > Get-Process | Where-Object {$_.Name -ilike \"*docker*\"} | Stop-Process -ErrorAction Continue -Confirm:$false -Force PS > Start-Service docker PS > Get-Process | Where-Object {$_.Name -ilike \"*docker*\"} Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName ------- ------ ----- ----- ------ -- -- ----------- 371 26 142736 46460 1.06 5828 0 dockerd restart via batch reference: Restart docker Windows 10 command line > net stop docker > net stop com.docker.service > taskkill /IM \"dockerd.exe\" /F > taskkill /IM \"Docker for Windows.exe\" /F > net start docker > net start com.docker.service > \"c:\\program files\\docker\\docker\\Docker for Windows.exe\" CLSID reference CLSID Key (GUID) Shortcuts List for Windows 10 http://www.klapac.funsite.cz/mediawiki/index.php?title=List_of_Windows_10_CLSID_Key_(GUID)_Shortcuts usage > explorer.exe shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} or > explorer.exe /e,::{CLSID key number} details clsid regedit Set %USERPROFILE% as ${HOME} for cygwin [15:55:36.30 C:\\] > REG ADD HKCU\\Environment /v HOME /t REG_EXPAND_SZ /d ^%USERPROFILE^% PuTTy Backup PuTTy sessions > REGEDIT /e \"%userprofile%\\desktop\\putty-registry.reg\" HKEY_CURRENT_USER\\Software\\Simontatham Launchy PuTTy session as shortcut > [PuTTy.exe] -load [SessionName] Backup PuTTy session > REGEDIT /e \"%userprofile%\\desktop\\putty-sessions.reg\" HKEY_CURRENT_USER\\Software\\SimonTatham\\PuTTY\\Sessions disable screensaver reference Configure screensaver command line > REM Disable the screensaver > REG ADD \"HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Control Panel\\Desktop\" /v ScreenSaverIsSecure /t REG_SZ /d 0 /f > REG ADD \"HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Control Panel\\Desktop\" /v ScreenSaveActive /t REG_SZ /d 0 /f or by using autohotkey CoordMode, Mouse, Screen Loop { ; Move mouse MouseMove, 1, 1, 0, R ; Replace mouse to its original location MouseMove, -1, -1, 0, R ; Wait before moving the mouse again Sleep, 600000 } return or #Persistent SetTimer, WatchCursor, 100 return Loop { WatchCursor: MouseGetPos,X1 ,Y1 Sleep 10000 MouseGetPos,X2,Y2 if X1=X2 And Y1=Y2 { MouseMove,100,100 Sleep, 10000 MouseMove,200,200 Sleep, 10000 } } Remove Graphics card context menu Unregister igfxpph.dll > regsvr32 /u igfxpph.dll Remove register Setting from regedit > REG DELETE \"HKEY_CLASSES_ROOT\\Directory\\Background\\shellex\\ContextMenuHandlers\\igfxcui\" /f Setting from setx > REG DELETE \"HKEY_CLASSES_ROOT\\Directory\\Background\\shellex\\ContextMenuHandlers\\igfxcui\" /f Set Environment Variables Set User Varialbe > setx VIM_HOME C:\\Marslo\\MyProgramFiles\\Vim\\vim74\\gvim.exe Set System Variable > setx /M VIM_HOME C:\\Marslo\\MyProgramFiles\\Vim\\vim74\\gvim.exe details windows default environment variable setx problem > setx /M PATH %PATH%;%M2_HOME%\\bin ERROR: Invalid syntax. Default option is not allowed more than '2' time(s). Type \"SETX /?\" for usage. fix:> REG ADD \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v Path /t REG_SZ /d \"%path%;%M2_HOME%\\bin\" /f whoami check SID > whoami /user USER INFORMATION ---------------- User Name SID ================ =============================================== mj\\marslo_jiao S-1-5-21-354581543-3608027983-2995495404-970613 fingerprint pro URL: www.lenovo.com Help link: support.lenovo.com Installation folder: C:\\Program Files\\Lenovo\\Fingerprint Manager Pro\\ Uninstaller: \"C:\\Program Files\\InstallShield Installation Information\\{314FAD12-F785-4471-BCE8-AB506642B9A1}\\setup.exe\" -runfromtemp -l0x0409 -removeonly Estimated size: 70.21 MB enable gadgets Windows Registry Editor Version 5.00 [HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Windows\\Sidebar] \"TurnOffSidebar\"=- [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Windows\\Sidebar] \"TurnOffSidebar\"=- issue about \"profile.d\\Active\"' is not recognized as an internal or external command regedit [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Command Processor] \"Autorun\"=\"@CHCP 65001>nul\" cmd > REG ADD \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Command Processor\" /v AutoRun /t REG_SZ /d \"@CHCP 65001>nul\" /f stop windows beep [!NOTE|label:references:] How to disable PC Speaker beep sound in Windows 10 How to disable System Beep in Windows 10 > net stop beep > sc config beep start= disabled outlook move hubbar to bottom > REG ADD \"HKCU\\SOFTWARE\\Microsoft\\Office\\16.0\\Common\\ExperimentConfigs\\ExternalFeatureOverrides\\outlook\" /v \"Microsoft.Office.Outlook.Hub.HubBar\" /t REG_SZ /d \"false\" /f regedit Windows Registry Editor Version 5.00 [HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Office\\16.0\\Common\\ExperimentConfigs\\ExternalFeatureOverrides\\outlook] \"Microsoft.Office.Outlook.Hub.HubBar\"=\"false\" shell references: What is Windows Terminal? Appearance profile settings in Windows Terminal Windows Terminal tips and tricks Theme settings in Windows Terminal (Preview) utf-8 in windows terminal [!TIP] references: Use UTF-8 code pages in Windows apps Using UTF-8 in the Windows Terminal Using UTF-8 Encoding (CHCP 65001) in Command Prompt / Windows Powershell (Windows 10) Terminal should force pseudoconsole host into UTF-8 codepage by default #1802 How to use unicode characters in Windows command line? Change default code page of Windows console to UTF-8 win + r references: shell:folder appfolder > shell:appfolder startup folder > shell:startup > shell:Common Startup debug in powershell references: Set-PSDebug Troubleshoot by Using Set-PSDebug > Set-PSDebug -Trace 2 show all environment variables Write-Host \"System Environment: \" Get-ChildItem -Path Env: setup environment via config file by powershell references: Set-Content PS C:\\> cat .\\test.txt TEST_A=aa TEST_B=bb PS C:\\> cat .\\test.txt | ForEach-Object { >> $name, $value = $_ -split '=', 2 >> Set-Content env:\\\"$name\" $value >> } example PS C:\\> Get-Content -Path .\\test.txt | Foreach-Object { >> $name, $value = $_ -split '=', 2 >> echo \"`n>>> $name ~> $value\" >> Set-Content env:\\\"$name\" $value >> Get-ChildItem Env:\\\"$name\" >> } >>> TEST_A ~> aa Name Value ---- ----- TEST_A aa >>> TEST_B ~> bb TEST_B bb tricky enable LongPaths in windows [!NOTE|label:references:] Maximum Path Length Limitation The maximum path of 32,767 characters is approximate GetVolumeInformationA function How to Make Windows 10 Accept File Paths Over 260 Characters Enabling Windows Long Path (Windows 10 - 1803 build) regedit > REG ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\" /v LongPathsEnabled /t REG_DWORD /d 0x00000001 /f LongPathsEnabled\"> powershell > New-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\" -Name \"LongPathsEnabled\" -Value 1 -PropertyType DWORD -Force gpedit.msc Local Group Policy Editor -> Computer Configuration -> Administrative Templates -> System > Filesystem Enable win32 long paths -> Enabled Enable win32 long paths\"> Internet Explorer Enhanced Security Configuration is enabled powershell plugins # 1. 安装 PSReadline 包，该插件可以让命令行很好用，类似 zsh > Install-Module -Name PSReadLine -Scope CurrentUser -Force # 2. 安装 posh-git 包，让你的 git 更好用 > Install-Module posh-git -Scope CurrentUser # 3. 安装 oh-my-posh 包，让你的命令行更酷炫、优雅 > Install-Module oh-my-posh -Scope CurrentUser openssh for windows [!TIP|label:references:] * Get started with OpenSSH for Windows OpenSSH for Windows overview OpenSSH Server configuration for Windows Server and Windows Tutorial: SSH in Windows Terminal [Solved] Add-WindowsCapability failed. Error code = 0x800f0954 – RSAT Fix Installing and Configuring OpenSSH on Windows Server 2019 owerShell/Win32-OpenSSH Install Win32 OpenSSH pre-check # verify whehter if running as Administrator > (New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator) True > Get-Command -Noun WindowsCapability CommandType Name Version Source ----------- ---- ------- ------ Cmdlet Add-WindowsCapability 3.0 Dism Cmdlet Get-WindowsCapability 3.0 Dism Cmdlet Remove-WindowsCapability 3.0 Dism check openssh versions > Get-WindowsCapability -Online | Where-Object Name -like 'OpenSSH*' Name : OpenSSH.Client~~~~0.0.1.0 State : NotPresent Name : OpenSSH.Server~~~~0.0.1.0 State : NotPresent # or > Get-WindowsCapability -Name OpenSSH* -Online Name : OpenSSH.Client~~~~0.0.1.0 State : NotPresent DisplayName : OpenSSH Client Description : OpenSSH-based secure shell (SSH) client, for secure key management and access to remote machines. DownloadSize : 1323493 InstallSize : 5301402 Name : OpenSSH.Server~~~~0.0.1.0 State : NotPresent DisplayName : OpenSSH Server Description : OpenSSH-based secure shell (SSH) server, for secure key management and access from remote machines. DownloadSize : 1297677 InstallSize : 4946932 install client and server > Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0 > Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0 # or via dism ( Deployment Image Servicing and Management tool ) > dism /online /Add-Capability /CapabilityName:OpenSSH.Client~~~~0.0.1.0 Deployment Image Servicing and Management tool Version: 10.0.19041.3570 Image Version: 10.0.19044.3570 [==========================100.0%==========================] The operation completed successfully. > dism /online /Add-Capability /CapabilityName:OpenSSH.Server~~~~0.0.1.0 install for windows 2019 [!NOTE|label:references:] windows-dev-guide/install.ps1> choco install -y openssh --prerelease --force --params '/SSHServerFeature /PathSpecsToProbeForShellEXEString:$env:programfiles\\PowerShell\\*\\pwsh.exe' > Import-Module -force (resolve-path /prog*s/openssh*/opensshutils.psd1) > Repair-AuthorizedKeyPermission -file ~/.ssh/authorized_keys > Icacls authorized_keys /remove “NT SERVICE\\sshd” > Install-Module -Force OpenSSHUtils -Scope AllUsers > Set-ExecutionPolicy Bypass > Iwr https://chocolatey.org/install.ps1 -UseBasicParsing | iex > choco install nano -y # start services > Set-Service -Name ssh-agent -StartupType ‘Automatic’ > Set-Service -Name sshd -StartupType ‘Automatic’ > Start-Service ssh-agent > Start-Service sshd error 0x800f0954: [!NOTE|label:references:] UseWUServer > Get-ItemProperty -Path HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU -Name UseWUServer UseWUServer : 1 PSPath : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU PSParentPath : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate PSChildName : AU PSDrive : HKLM PSProvider : Microsoft.PowerShell.Core\\Registry > Get-ItemPropertyValue -Path HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU -Name UseWUServer 1 # or > REG query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU NoAutoUpdate REG_DWORD 0x0 AUOptions REG_DWORD 0x3 ScheduledInstallDay REG_DWORD 0x0 ScheduledInstallTime REG_DWORD 0x3 NoAutoRebootWithLoggedOnUsers REG_DWORD 0x1 DetectionFrequencyEnabled REG_DWORD 0x1 DetectionFrequency REG_DWORD 0x16 UseWUServer REG_DWORD 0x1 > REG query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU /v UseWUServer HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU UseWUServer REG_DWORD 0x1 DisableWindowsUpdateAccess: > Get-ItemProperty -Path HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\ -Name DisableWindowsUpdateAccess DisableWindowsUpdateAccess : 1 PSPath : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUp date\\ PSParentPath : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows PSChildName : WindowsUpdate PSDrive : HKLM PSProvider : Microsoft.PowerShell.Core\\Registry > Get-ItemPropertyValue -Path HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\ -Name DisableWindowsUpdateAccess 1 # or > REG query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\ HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate DisableWindowsUpdateAccess REG_DWORD 0x1 TargetGroupEnabled REG_DWORD 0x1 TargetGroup REG_SZ SC_Servers WUServer REG_SZ http://msi-wsus03.marvell.com WUStatusServer REG_SZ http://msi-wsus03.marvell.com HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU > REG query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\ /v DisableWindowsUpdateAccess HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate DisableWindowsUpdateAccess REG_DWORD 0x1 # set Windows Update Server Key to 0 > Set-ItemProperty -Path HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU -Name UseWUServer -Value 0 # Set Disable Windows Update Access to 0 > Set-ItemProperty -Path HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\ -Name DisableWindowsUpdateAccess -Value 0 # restart Windows Update Service > Restart-Service -Name wuauserv -Force or full process # get defautl values > $currentWU = Get-ItemPropertyValue -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" -Name \"UseWUServer\" > $currentWUAccess = Get-ItemPropertyValue -Path \"HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\" -Name \"DisableWindowsUpdateAccess\" # set Windows Update Server Key to 0 > Set-ItemProperty -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" -Name \"UseWUServer\" -Value 0 # set Disable Windows Update Access to 0 > Set-ItemProperty -Path HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate -Name DisableWindowsUpdateAccess -Value 0 # restart Windows Update Service ( wuauserv ) > Restart-Service wuauserv # or > Restart-Service -Name wuauserv -Force # install > Get-WindowsCapability -Name OpenSSH* -Online | Add-WindowsCapability –Online # or > dism /online /Add-Capability /CapabilityName:OpenSSH.Client~~~~0.0.1.0 > dism /online /Add-Capability /CapabilityName:OpenSSH.Server~~~~0.0.1.0 # or > Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0 > Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0 # revert > Set-ItemProperty -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" -Name \"UseWUServer\" -Value $currentWU > Set-ItemProperty -Path HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate -Name DisableWindowsUpdateAccess -Value $currentWUAccess > Restart-Service wuauserv # or > Restart-Service -Name wuauserv -Force update help > Update-Help install in win10-64 [!NOTE|label:references:] * provision.ps1 ssh-pubkey.ps1 Static-Binaries/openssh/INFO.md > curl -qfSLO \"https://raw.githubusercontent.com/Azathothas/Static-Binaries/main/openssh/openssh_amd_x86_Windows.msi\" > curl -qfSLO \"https://raw.githubusercontent.com/Azathothas/Static-Binaries/main/openssh/openssh_amd_x86_Windows.zip\" # or > Invoke-WebRequest -Uri \"https://raw.githubusercontent.com/Azathothas/Static-Binaries/main/openssh/openssh_amd_x86_Windows.msi\" -OutFile \"openssh.msi\" > Invoke-WebRequest -Uri \"https://raw.githubusercontent.com/Azathothas/Static-Binaries/main/openssh/openssh_amd_x86_Windows.zip\" -OutFile \"openssh.zip\" > msiexec /i openssh.msi > msiexec /i openssh.msi /l*vx install.log - download [OpenSSH-Win64.zip](https://github.com/PowerShell/Win32-OpenSSH/releases/download/v9.4.0.0p1-Beta/OpenSSH-Win64.zip) - extract to `c:\\Program Files\\OpenSSH-Win32` - execute as admin ```powershell cd \"c:\\Program Files\\OpenSSH-Win32\" powershell -executionpolicy bypass .\\install-sshd.ps1 .\\ssh-keygen.exe -A Start-Service ssh-agent .\\ssh-add ssh_host_dsa_key .\\ssh-add ssh_host_rsa_key .\\ssh-add ssh_host_ecdsa_key .\\ssh-add ssh_host_ed25519_key netsh advfirewall firewall add rule name=\"SSH Port\" dir=in action=allow protocol=TCP localport=22 .\\install-sshlsa.ps1 Set-Service sshd -StartupType Automatic Set-Service ssh-agent -StartupType Automatic .\\FixHostFilePermissions.ps1 -Confirm:$false .\\FixUserFilePermissions.ps1 -Confirm:$false Start-Service sshd ``` start services # Start the sshd service > Start-Service sshd > Start-Service ssh-agent # OPTIONAL but recommended: > Set-Service -Name sshd -StartupType 'Automatic' > Set-Service -Name ssh-agent -StartupType 'Automatic' # confirm the firewall rule is configured. it should be created automatically by setup. run the following to verify > if (!(Get-NetFirewallRule -Name \"OpenSSH-Server-In-TCP\" -ErrorAction SilentlyContinue | Select-Object Name, Enabled)) { Write-Output \"Firewall Rule 'OpenSSH-Server-In-TCP' does not exist, creating it...\" New-NetFirewallRule -Name 'OpenSSH-Server-In-TCP' -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22 } else { Write-Output \"Firewall rule 'OpenSSH-Server-In-TCP' has been created and exists.\" } verify> Get-Service *ssh* | Where-Object {$_.Status -eq \"Running\"} Status Name DisplayName ------ ---- ----------- Running sshd OpenSSH SSH Server connect via ssh > ssh domain\\username@servername # in wsl $ ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no marslo@server.sample.com marslo@dc5-ssdfw14's password: (c) 2018 Microsoft Corporation. All rights reserved. Clink v1.3.47.d5796b Copyright (c) 2012-2018 Martin Ridgers Portions Copyright (c) 2020-2022 Christopher Antos https://github.com/chrisant996/clink Clink v1.5.18 is available. - To apply the update, run 'clink update'. - To stop checking for updates, run 'clink set clink.autoupdate false'. - To view the release notes, visit the Releases page: https://github.com/chrisant996/clink/releases DOMAIN\\marslo@SERVER.SAMPLE.COM C:\\Users\\marslo> ssh key [!NOTE|label:references:] Windows SSH: Permissions for 'private-key' are too open Key-based authentication in OpenSSH for Windows Setting up SSH-Agent in Windows for Passwordless Git Authentication SSH_AUTH_SOCK and wsl-ssh-pageant.exe --winssh ssh-pageant Comprehensive Guide to ssh-agent on Windows and WSL generate keys > ssh-keygen -t ed25519 # By default the ssh-agent service is disabled. Configure it to start automatically. # Make sure you're running as an Administrator. > Get-Service ssh-agent | Set-Service -StartupType Automatic # Start the service > Start-Service ssh-agent # This should return a status of Running > Get-Service ssh-agent # Now load your key files into ssh-agent > ssh-add $env:USERPROFILE\\.ssh\\id_ed25519 standard user # Get the public key file generated previously on your client > $authorizedKey = Get-Content -Path $env:USERPROFILE\\.ssh\\id_ed25519.pub # Generate the PowerShell to be run remote that will copy the public key file generated previously on your client to the authorized_keys file on your server > $remotePowershell = \"powershell New-Item -Force -ItemType Directory -Path $env:USERPROFILE\\.ssh; Add-Content -Force -Path $env:USERPROFILE\\.ssh\\authorized_keys -Value '$authorizedKey'\" # Connect to your server and run the PowerShell using the $remotePowerShell variable > ssh username@domain1@contoso.com $remotePowershell administrative user [!NOTE] This example shows the steps for creating the administrators_authorized_keys file. This only applies to administrator accounts and must be user instead of the per user file within the user's profile location. AuthorizedKeysFile GSSAPIAuthentication # get the public key file generated previously on your client $authorizedKey = Get-Content -Path $env:USERPROFILE\\.ssh\\id_ed25519.pub # generate the powershell to be run remote that will copy the public key file generated previously on your client to the authorized_keys file on your server $remotePowershell = \"powershell Add-Content -Force -Path $env:ProgramData\\ssh\\administrators_authorized_keys -Value '$authorizedKey';icacls.exe \"\"$env:ProgramData\\ssh\\administrators_authorized_keys\"\" /inheritance:r /grant \"\"Administrators:F\"\" /grant \"\"SYSTEM:F\"\"\" # Connect to your server and run the PowerShell using the $remotePowerShell variable ssh username@domain1@contoso.com $remotePowershell > icacls.exe \"C:\\ProgramData\\ssh\\administrators_authorized_keys\" /inheritance:r /grant \"Administrators:F\" /grant \"SYSTEM:F\" troubleshooting [!NOTE] Permissions for '/path/to/private/key' are too open FixHostFilePermissions.ps1 FixUserFilePermissions.ps1 REM run as normal user > icacls private-key /inheritance:r > icacls private-key /grant:r \"%username%\":\"(R)\" more details cmd ::# Set Key File Variable: Set Key=\"%UserProfile%\\.ssh\\id_rsa\" ::# Remove Inheritance: Icacls %Key% /c /t /Inheritance:d ::# Set Ownership to Owner: :: # Key's within %UserProfile%: Icacls %Key% /c /t /Grant %UserName%:F :: # Key's outside of %UserProfile%: TakeOwn /F %Key% Icacls %Key% /c /t /Grant:r %UserName%:F ::# Remove All Users, except for Owner: Icacls %Key% /c /t /Remove:g \"Authenticated Users\" BUILTIN\\Administrators BUILTIN Everyone System Users ::# Verify: Icacls %Key% ::# Remove Variable: set \"Key=\" powershell # Set Key File Variable: New-Variable -Name Key -Value \"$env:UserProfile\\.ssh\\id_rsa\" # Remove Inheritance: Icacls $Key /c /t /Inheritance:d # Set Ownership to Owner: # Key's within $env:UserProfile: Icacls $Key /c /t /Grant ${env:UserName}:F # Key's outside of $env:UserProfile: TakeOwn /F $Key Icacls $Key /c /t /Grant:r ${env:UserName}:F # Remove All Users, except for Owner: Icacls $Key /c /t /Remove:g Administrator \"Authenticated Users\" BUILTIN\\Administrators BUILTIN Everyone System Users # Verify: Icacls $Key # Remove Variable: Remove-Variable -Name Key or > cat ~\\.ssh\\example-key.ecdsa | ssh-add -k - or # do the following in powerhsell if not already done # Set-ExecutionPolicy RemoteSigned # NOTE: edit the path in this command if needed $sshFiles=Get-ChildItem -Path \"$env:userprofile\\.ssh\" -Force $sshFiles | % { $key = $_ & icacls $key /c /t /inheritance:d & icacls $key /c /t /grant \"${echo $env:username}\":F & icacls $key /c /t /remove Administrator \"Authenticated Users\" BUILTIN\\Administrators BUILTIN Everyone System Users } # verify $sshFiles | % { icacls $_ } uninstall # uninstall the OpenSSH Client > Remove-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0 # uninstall the OpenSSH Server > Remove-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0 troubleshooting Error code = 0x800f0954 [!NOTE] [Solved] Add-WindowsCapability failed. Error code = 0x800f0954 – RSAT Fix Fix: RSAT Tools Installation Error 0x800f0954 on Windows How can I utilize the Add-WindowsCapability function through a proxy in PowerShell? RSAT and WSUS Locations via gpedit.msc win + r -> gpedit.msc Computer Configuration -> Administrative Templates -> System Specify settings for optional component installation and component repair Enable Enable: Download repair content and optional features directly from Windows update instead of Windows Server Update Services ( WSUS ) cmd run > gpupdate /force verify > Get-WindowsCapability -Name OpenSSH.Server~~~~0.0.1.0 -Online | Add-WindowsCapability -Online # for rast > Get-WindowsCapability -Name Rsat.ActiveDirectory.DS-LDS.Tools~~~0.0.1.0 -Online | Add-WindowsCapability -Online via wuauserv [!NOTE|label:references] Error Code 0x800F0954 on Windows 10 Windows 10 - 1809 - RSAT Toolset - error code of 0x800f0954 $currentWU = Get-ItemPropertyValue -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" -Name \"UseWUServer\" Set-ItemProperty -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" -Name \"UseWUServer\" -Value 0 Restart-Service wuauserv # install Get-WindowsCapability -Name OpenSSH* -Online | Add-WindowsCapability –Online Set-ItemProperty -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" -Name \"UseWUServer\" -Value $currentWU Restart-Service wuauserv or$currentWU = Get-ItemPropertyValue -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" -Name \"UseWUServer\" $currentWUAccess = Get-ItemPropertyValue -Path \"HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\" -Name \"DisableWindowsUpdateAccess\" Set-ItemProperty -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" -Name \"UseWUServer\" -Value 0 Restart-Service wuauserv # install Get-WindowsCapability -Name OpenSSH* -Online | Add-WindowsCapability –Online Set-ItemProperty -Path \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\" -Name \"UseWUServer\" -Value $currentWU Set-ItemProperty -Path HKLM:SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate -Name DisableWindowsUpdateAccess -Value $currentWUAccess Restart-Service wuauserv Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/windows/powershell.html":{"url":"cheatsheet/windows/powershell.html","title":"powershell","keywords":"","body":" basic echo system check current user is admin maximum path length limitation list installed appx install system apps restricted strategy enable pxe on the distribution point search cortana install ssh-agent deploy windows 10 in a test lab using configuration manager modules list installed modules get package source scripts environment timezone step-by-step guide to setup two-tier pki environment to execute powershell as administrator right click 'Run As Administrator' ctrl+r » powershell » ctrl + shift + enter to verify powershell running as admin> (New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator) True basic echo references Redirection Out-Null Write-Warning \"hello\" Write-Error \"hello\" Write-Output \"hello\" | Out-Null system check current user is admin references: How to: Tell if a PowerShell script is running as the Administrator Get started with OpenSSH for Windows Universal test for Admin privileges well-known SIDs S-1-5-32-544 : Administrators S-1-5-32-545 : Users S-1-5-32-547 : Power Users Powershell Admin rights dont work in Windows Forms > (New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator) True # or > $isAdmin = (new-object System.Security.Principal.WindowsPrincipal([System.Security.Principal.WindowsIdentity]::GetCurrent())).IsInRole(\"Administrators\") > echo $isAdmin True # or via SID > $isAdmin = (new-object System.Security.Principal.WindowsPrincipal([System.Security.Principal.WindowsIdentity]::GetCurrent())).IsInRole(([System.Security.Principal.SecurityIdentifier]\"S-1-5-32-544\")) > echo $isAdmin True or $currentPrincipal = New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent()) if (-not ($currentPrincipal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator))) { Write-Warning \"This script needs to be running as the administrator.\" Exit 1 } Write-Host \"You are running as the administrator.\" others > echo $currentPrincipal Identity : System.Security.Principal.WindowsIdentity UserClaims : {http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: WORKGROUP\\marslo, http://schemas.microsoft.com/ws/2008/06/identity/claims/primarysid: S-1-5-21-1801674531-527237240-682003330-164699, http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid: S-1-1-0, http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid: S-1-2-0...} DeviceClaims : {} Claims : {http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: WORKGROUP\\marslo, http://schemas.microsoft.com/ws/2008/06/identity/claims/primarysid: S-1-5-21-1801674531-527237240-682003330-164699, http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid: S-1-1-0, http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid: S-1-2-0...} Identities : {WORKGROUP\\marslo} maximum path length limitation references: Maximum Path Length Limitation Overcoming long path problem in Windows/PowerShell > New-ItemProperty ` -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\" ` -Name \"LongPathsEnabled\" ` -Value 1 ` -PropertyType DWORD ` -Force or via modify regedit > REG ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\" /v \"LongPathsEnabled\" /t REG_DWORD /d 0x00000001 /f REM .reg REM Windows Registry Editor Version 5.00 REM [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\FileSystem] REM \"LongPathsEnabled\"=dword:00000001 list installed appx references: Get-AppxPackage List all installed APPX packages, along with their display names How to view installed apps with PowerShell on Windows 10 > Get-AppxPackage –AllUsers | Select Name, PackageFullName # or > winget list or search via keywords PS C:\\Users\\marslo> Get-AppxPackage -Name *edge* Name : Microsoft.MicrosoftEdgeDevToolsClient Publisher : CN=Microsoft Corporation, O=Microsoft Corporation, L=Redmond, S=Washington, C=US Architecture : Neutral ResourceId : neutral Version : 1000.19041.1023.0 PackageFullName : Microsoft.MicrosoftEdgeDevToolsClient_1000.19041.1023.0_neutral_neutral_8wekyb3d8bbwe InstallLocation : C:\\Windows\\SystemApps\\Microsoft.MicrosoftEdgeDevToolsClient_8wekyb3d8bbwe IsFramework : False PackageFamilyName : Microsoft.MicrosoftEdgeDevToolsClient_8wekyb3d8bbwe PublisherId : 8wekyb3d8bbwe IsResourcePackage : False IsBundle : False IsDevelopmentMode : False NonRemovable : True IsPartiallyStaged : False SignatureKind : System Status : Ok # or > winget list chrome Name Id Version Source ------------------------------------------------- Google Chrome Google.Chrome 113.0.5672.93 winget or Get-AppxPackage | Get-AppxPackageManifest | ForEach-Object { $_.Package.Applications.Application.VisualElements.DisplayName } or exclude all ms-Get-AppxPackage | Get-AppxPackageManifest | ForEach-Object { $_.Package.Applications.Application.VisualElements.DisplayName } | Where-Object { $_ -notmatch '^ms' } or show name and display name $Packages=Get-AppxPackage -PackageTypeFilter Main $PackageManager = New-Object Windows.Management.Deployment.PackageManager foreach ($Package in $Packages) { Write-Output $Package.PackageFullName try { $PackageUWP = $PackageManager.FindPackage($Package.PackageFullName) Write-Output $PackageUWP.DisplayName Write-Output '' } catch { throw break } } Remove-Variable Packages,PackageManager,Package,PackageUWP install system apps references: SearchUI.exe Suspended Error on Windows 10 / 11 Fix How to Fix SearchUI.exe Suspended on Windows 10 > Get-AppXPackage -AllUsers | Where-Object {$_.InstallLocation -like \"*SystemApps*\"} | Foreach {Add-AppxPackage -DisableDevelopmentMode -Register \"$($_.InstallLocation)\\AppXManifest.xml\"} repaire all appx> Get-AppxPackage Microsoft.Windows.ShellExperienceHost | foreach {Add-AppxPackage -register \"$($_.InstallLocation)\\appxmanifest.xml\" -DisableDevelopmentMode} > Get-AppXPackage | Foreach {Add-AppxPackage -DisableDevelopmentMode -Register \"$($_.InstallLocation)\\AppXManifest.xml\"} restricted strategy references: How to fix search problems in Windows 10 Fix problems in Windows Search check policy > Get-ExecutionPolicy modify policy > Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy Unrestricted revert to previous policy > Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy # i.e.: > Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy Restricted enable pxe on the distribution point > WDSUTIL.exe /Set-Server /AnswerClients:None # check macaddress > (Get-NetAdapter \"Ethernet\").MacAddress search references: Windows 10 - Search bar not allowing me to type Troubleshoot Windows Search performance > Get-AppXPackage -Name Microsoft.Windows.Search Name : Microsoft.Windows.Search Publisher : CN=Microsoft Windows, O=Microsoft Corporation, L=Redmond, S=Washington, C=US Architecture : Neutral ResourceId : neutral Version : 1.14.9.19041 PackageFullName : Microsoft.Windows.Search_1.14.9.19041_neutral_neutral_cw5n1h2txyewy InstallLocation : C:\\Windows\\SystemApps\\Microsoft.Windows.Search_cw5n1h2txyewy IsFramework : False PackageFamilyName : Microsoft.Windows.Search_cw5n1h2txyewy PublisherId : cw5n1h2txyewy IsResourcePackage : False IsBundle : False IsDevelopmentMode : False NonRemovable : True IsPartiallyStaged : False SignatureKind : System Status : Ok scan health and restore health > DISM.exe /Online /Cleanup-image /Scanhealth > DISM.exe /Online /Cleanup-image /Restorehealth execute searching diagnostic > msdt -ep WindowsHelp id SearchDiagnostic defragment the index database > sc config wsearch start=disabled > net stop wsearch > esentutl.exe /d %AllUsersProfile%\\Microsoft\\Search\\Data\\Applications\\Windows\\Windows.edb > sc config wsearch start=delayed-auto > net start wsearch reinstall windows search > Get-AppXPackage -Name Microsoft.Windows.Search | Foreach {Add-AppxPackage -DisableDevelopmentMode -Register \"$($_.InstallLocation)\\AppXManifest.xml\"} reinstall cortana > Get-AppXPackage -Name Microsoft.Windows.Cortana | Foreach {Add-AppxPackage -DisableDevelopmentMode -Register \"$($_.InstallLocation)\\AppXManifest.xml\"} reinstall StartMenuExperienceHost > taskkill /f /im explorer.exe SUCCESS: The process \"explorer.exe\" with PID 20256 has been terminated. > Get-AppXPackage -Name Microsoft.Windows.StartMenuExperienceHost | Foreach {Add-AppxPackage -DisableDevelopmentMode -Register \"$($_.InstallLocation)\\AppXManifest.xml\"} > start explorer statusPS C:\\> Get-AppXPackage -Name Microsoft.Windows.StartMenuExperienceHost Name : Microsoft.Windows.StartMenuExperienceHost Publisher : CN=Microsoft Windows, O=Microsoft Corporation, L=Redmond, S=Washington, C=US Architecture : Neutral ResourceId : neutral Version : 10.0.19041.1023 PackageFullName : Microsoft.Windows.StartMenuExperienceHost_10.0.19041.1023_neutral_neutral_cw5n1h2txyewy InstallLocation : C:\\Windows\\SystemApps\\Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy IsFramework : False PackageFamilyName : Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy PublisherId : cw5n1h2txyewy IsResourcePackage : False IsBundle : False IsDevelopmentMode : False NonRemovable : True IsPartiallyStaged : False SignatureKind : System Status : Ok re-build ShellExperienceHost > taskkill /f /im explorer.exe > taskkill /f /im shellexperiencehost.exe > timeout /t 3 /NOBREAK > nul > del %localappdata%\\Packages\\Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy\\TempState\\* /q > timeout /t 2 /NOBREAK > nul > start explorer > @echo on cortana install references: SearchUI.exe Suspended Error on Windows 10 / 11 Fix How to Fix SearchUI.exe Suspended on Windows 10 > Get-AppXPackage -Name Microsoft.Windows.Cortana | Foreach {Add-AppxPackage -DisableDevelopmentMode -Register \"$($_.InstallLocation)\\AppXManifest.xml\"} remove the cache> RD /S /Q \"%LOCALAPPDATA%\\Packages\\Microsoft.Windows.Cortana_cw5n1h2txyewy\\RoamingState\" remove > Get-AppxPackage -AllUsers Microsoft.549981C3F5F10 Name : Microsoft.549981C3F5F10 Publisher : CN=Microsoft Corporation, O=Microsoft Corporation, L=Redmond, S=Washington, C=US Architecture : X64 ResourceId : Version : 4.2204.13303.0 PackageFullName : Microsoft.549981C3F5F10_4.2204.13303.0_x64__8wekyb3d8bbwe InstallLocation : C:\\Program Files\\WindowsApps\\Microsoft.549981C3F5F10_4.2204.13303.0_x64__8wekyb3d8bbwe IsFramework : False PackageFamilyName : Microsoft.549981C3F5F10_8wekyb3d8bbwe PublisherId : 8wekyb3d8bbwe PackageUserInformation : {S-1-5-21-1801674531-527237240-682003330-164699 [MARVELL\\marslo]: Installed} IsResourcePackage : False IsBundle : False IsDevelopmentMode : False NonRemovable : False Dependencies : {Microsoft.NET.Native.Framework.2.2_2.2.29512.0_x64__8wekyb3d8bbwe, Microsoft.NET.Native.Runtime.2.2_2.2.28604.0_x64__8wekyb3d8bbwe, Microsoft.VCLibs.140.00_14.0.30704.0_x64__8wekyb3d8bbwe, Microsoft.VCLibs.140.00.UWPDesktop_14.0.30704.0_x64__8wekyb3d8bbwe...} IsPartiallyStaged : False SignatureKind : Store Status : Ok > Get-AppxPackage -allusers Microsoft.549981C3F5F10 | Remove-AppxPackage install ssh-agent references: Get started with OpenSSH for Windows # check available version > Get-WindowsCapability -Online | Where-Object Name -like 'OpenSSH*' # install > Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0 > Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0 > Get-Service ssh-agent | Set-Service -StartupType Automatic -PassThru | Start-Service start service # Start the sshd service Start-Service sshd # OPTIONAL but recommended: Set-Service -Name sshd -StartupType 'Automatic' # Confirm the Firewall rule is configured. It should be created automatically by setup. Run the following to verify if (!(Get-NetFirewallRule -Name \"OpenSSH-Server-In-TCP\" -ErrorAction SilentlyContinue | Select-Object Name, Enabled)) { Write-Output \"Firewall Rule 'OpenSSH-Server-In-TCP' does not exist, creating it...\" New-NetFirewallRule -Name 'OpenSSH-Server-In-TCP' -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22 } else { Write-Output \"Firewall rule 'OpenSSH-Server-In-TCP' has been created and exists.\" } uninstall # Uninstall the OpenSSH Client Remove-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0 # Uninstall the OpenSSH Server Remove-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0 deploy windows 10 in a test lab using configuration manager references: Deploy Windows 10 in a test lab using Configuration Managerf prerequisites > Install-WindowsFeature Web-Windows-Auth,Web-ISAPI-Ext,Web-Metabase,Web-WMI,BITS,RDC,NET-Framework-Features,Web-Asp-Net,Web-Asp-Net45,NET-HTTP-Activation,NET-Non-HTTP-Activ # download SQLServer > Set-VMDvdDrive -VMName SRV1 -Path c:\\VHD\\SQLServer2014SP2-FullSlipstream-x64-ENU.iso > D:\\setup.exe /q /ACTION=Install /ERRORREPORTING=\"False\" /FEATURES=SQLENGINE,RS,IS,SSMS,TOOLS,ADV_SSMS,CONN /INSTANCENAME=MSSQLSERVER /INSTANCEDIR=\"C:\\Program Files\\Microsoft SQL Server\" /SQLSVCACCOUNT=\"NT AUTHORITY\\System\" /SQLSYSADMINACCOUNTS=\"BUILTIN\\ADMINISTRATORS\" /SQLSVCSTARTUPTYPE=Automatic /AGTSVCACCOUNT=\"NT AUTHORITY\\SYSTEM\" /AGTSVCSTARTUPTYPE=Automatic /RSSVCACCOUNT=\"NT AUTHORITY\\System\" /RSSVCSTARTUPTYPE=Automatic /ISSVCACCOUNT=\"NT AUTHORITY\\System\" /ISSVCSTARTUPTYPE=Disabled /ASCOLLATION=\"Latin1_General_CI_AS\" /SQLCOLLATION=\"SQL_Latin1_General_CP1_CI_AS\" /TCPENABLED=\"1\" /NPENABLED=\"1\" /IAcceptSQLServerLicenseTerms # elevated windows powershell > New-NetFirewallRule -DisplayName \"SQL Server\" -Direction Inbound -Protocol TCP -LocalPort 1433 -Action allow > New-NetFirewallRule -DisplayName \"SQL Admin Connection\" -Direction Inbound -Protocol TCP -LocalPort 1434 -Action allow > New-NetFirewallRule -DisplayName \"SQL Database Management\" -Direction Inbound -Protocol UDP -LocalPort 1434 -Action allow > New-NetFirewallRule -DisplayName \"SQL Service Broker\" -Direction Inbound -Protocol TCP -LocalPort 4022 -Action allow > New-NetFirewallRule -DisplayName \"SQL Debugger/RPC\" -Direction Inbound -Protocol TCP -LocalPort 135 -Action allow # download ADK : https://learn.microsoft.com/en-us/windows-hardware/get-started/adk-install microsoft configuration manager > $AdminKey = \"HKLM:\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\{A509B1A7-37EF-4b3f-8CFC-4F3A74704073}\" > Set-ItemProperty -Path $AdminKey -Name \"IsInstalled\" -Value 0 > Stop-Process -Name Explorer # download winmgmt (Microsoft Configuration Manager) : https://www.microsoft.com/en-us/evalcenter/evaluate-microsoft-endpoint-configuration-manager # verify WMI > Get-Service Winmgmt Status Name DisplayName ------ ---- ----------- Running Winmgmt Windows Management Instrumentation > Test-NetConnection -ComputerName 192.168.0.2 -Port 135 -InformationLevel Detailed ComputerName : 192.168.0.2 RemoteAddress : 192.168.0.2 RemotePort : 135 AllNameResolutionResults : MatchingIPsecRules : NetworkIsolationContext : Internet InterfaceAlias : Ethernet SourceAddress : 192.168.0.2 NetRoute (NextHop) : 0.0.0.0 PingSucceeded : True PingReplyDetails (RTT) : 0 ms TcpTestSucceeded : True # from bat > C:\\configmgr\\SMSSETUP\\BIN\\X64\\extadsch.exe > adsiedit.msc … # re-enable IE Enhanced Security Configuration > Set-ItemProperty -Path $AdminKey -Name \"IsInstalled\" -Value 1 > Stop-Process -Name Explorer download mdop and install dart prepare for zero touch installation create a boot image for configuration manager > Copy-Item -Path \"C:\\ProgramData\\Microsoft\\User Account Pictures\\user.bmp\" -Destination \"C:\\Sources\\OSD\\Branding\\contoso.bmp\" create a windows 10 reference image > Set-VMDvdDrive -VMName SRV1 -Path c:\\VHD\\w10-enterprise.iso ... # setup hyper-v host computer > New-VM -Name REFW10X64-001 -SwitchName poc-internal -NewVHDPath \"c:\\VHD\\REFW10X64-001.vhdx\" -NewVHDSizeBytes 60GB > Set-VMMemory -VMName REFW10X64-001 -DynamicMemoryEnabled $true -MinimumBytes 1024MB -MaximumBytes 1024MB -Buffer 20 > Set-VMDvdDrive -VMName REFW10X64-001 -Path c:\\VHD\\LiteTouchPE_x86.iso > Start-VM REFW10X64-001 > vmconnect localhost REFW10X64-001 add a windows 10 os image> New-Item -ItemType Directory -Path \"C:\\Sources\\OSD\\OS\\Windows 10 Enterprise x64\" > cmd /c copy /z \"C:\\MDTBuildLab\\Captures\\REFW10X64-001.wim\" \"C:\\Sources\\OSD\\OS\\Windows 10 Enterprise x64\" create a task sequence finalize the os configuration deploy windows 10 using pxe and configuration manager > New-VM -Name \"PC4\" -NewVHDPath \"c:\\vhd\\pc4.vhdx\" -NewVHDSizeBytes 40GB -SwitchName poc-internal -BootDevice NetworkAdapter -Generation 2 > Set-VMMemory -VMName \"PC4\" -DynamicMemoryEnabled $true -MinimumBytes 512MB -MaximumBytes 2048MB -Buffer 20 > Start-VM PC4 > vmconnect localhost PC4 deploy PC4 > New-VM -Name \"PC4\" -NewVHDPath \"c:\\vhd\\pc4.vhdx\" -NewVHDSizeBytes 60GB -SwitchName poc-internal -BootDevice NetworkAdapter -Generation 2 > Set-VMMemory -VMName \"PC4\" -DynamicMemoryEnabled $true -MinimumBytes 1024MB -MaximumBytes 2048MB -Buffer 20 > Set-VMNetworkAdapter -VMName PC4 -StaticMacAddress 00-15-5D-83-26-FF open configuration management property > control.exe smscfgrc replace a client with windows 10 using configuration manager modules [!NOTE|label:references:] PowerShell Gallery DockerProvider Difference between Docker from DockerProvider and DockerMsftProvider Get-InstalledModule Get-Module list installed modules > Get-InstalledModule Version Name Repository Description ------- ---- ---------- ----------- 1.13.0 7Zip4Powershell PSGallery Powershell module for creating and... 1.0.0.8 DockerMsftProvider PSGallery PowerShell module with commands fo... 0.87.3 PSWriteColor PSGallery Write-Color is a wrapper around Wr... 2.2.16 VSSetup PSGallery Visual Studio Setup PowerShell Module 0.5.2 WebKitDev PSGallery PowerShell scripts for WebKit deve... get package source > Get-PackageSource -ProviderName DockerMsftProvider Name ProviderName IsTrusted Location ---- ------------ --------- -------- DockerDefault DockerMsftPro... False https://go.microsoft.com/fwlink/?LinkID=825636&clcid=0x409 > Get-PackageSource Name ProviderName IsTrusted Location ---- ------------ --------- -------- PSGallery PowerShellGet False https://www.powershellgallery.com/api/v2 DockerDefault DockerMsftPro... False https://go.microsoft.com/fwlink/?LinkID=825636&clcid=0x409 scripts [!NOTE|label:references:] Windows Server 2019 - Scripting and Sharing * MicrosoftDockerProvider/DockerMsftProvider.psm1 * Install-DockerCE/install-docker-ce.ps1 * install_docker_msft.ps1 * install_docker_windows_server.ps1 * windows-tools-installation.md git_install.ps1) docker_install.ps1 golang_install.ps1 tcpdump_install.ps1 sshd_manage.ps1 environment setup proxy> [Environment]::SetEnvironmentVariable(\"HTTP_PROXY\", \"http://username:password@proxy:port/\", [EnvironmentVariableTarget]::Machine) timezone [!NOTE|label:references:] Virtualized time zone get timezone > tzutil /g Dateline Standard Time > Get-TimeZone Id : Dateline Standard Time DisplayName : (UTC-12:00) International Date Line West StandardName : Dateline Standard Time DaylightName : Dateline Daylight Time BaseUtcOffset : -12:00:00 SupportsDaylightSavingTime : False modify timezone > tzutil /s \"Samoa Standard Time\" > tzutil /g step-by-step guide to setup two-tier pki environment # Setup Standalone Root CA > Add-WindowsFeature ADCS-Cert-Authority -IncludeManagementTools > Install-ADcsCertificationAuthority -CACommonName “REBELAdmin Root CA” -CAType StandaloneRootCA -CryptoProviderName “RSA#Microsoft Software Key Storage Provider” -HashAlgorithmName SHA256 -KeyLength 2048 -ValidityPeriod Years -ValidityPeriodUnits 20 # DSConfigDN > certutil.exe –setreg ca\\DSConfigDN CN=Configuration,DC=rebeladmin,DC=com # CDP Location > Install-WindowsFeature Web-WebServer -IncludeManagementTools # for virtual directory > mkdir C:\\CertEnroll > New-smbshare -name CertEnroll C:\\CertEnroll -FullAccess SYSTEM,\"rebeladmin\\Domain Admins\" -ChangeAccess \"rebeladmin\\Cert Publishers\" # publish the CDP settings > certutil -setreg CA\\CRLPublicationURLs \"1:C:\\Windows\\system32\\CertSrv\\CertEnroll\\%3%8%9.crl \\n10:ldap:///CN=%7%8,CN=%2,CN=CDP,CN=Public Key Services,CN=Services,%6%10\\n2:http://crt.rebeladmin.com/CertEnroll/%3%8%9.crl\" # AIA Location (Authority Information Access) > certutil -setreg CA\\CACertPublicationURLs \"1:C:\\Windows\\system32\\CertSrv\\CertEnroll\\%1_%3%4.crt\\n2:ldap:///CN=%7,CN=AIA,CN=Public Key Services,CN=Services,%6%11\\n2:http://crt.rebeladmin.com/CertEnroll/%1_%3%4.crt\" # CA Time Limits > certutil -setreg ca\\ValidityPeriod \"Years\" > certutil -setreg ca\\ValidityPeriodUnits 10 # CRL Time Limits > Certutil -setreg CA\\CRLPeriodUnits 13 > Certutil -setreg CA\\CRLPeriod \"Weeks\" > Certutil -setreg CA\\CRLDeltaPeriodUnits 0 > Certutil -setreg CA\\CRLOverlapPeriodUnits 6 > Certutil -setreg CA\\CRLOverlapPeriod \"Hours\" > Restart-Service certsvc # New CRL > certutil -crl Publish Root CA Data in to Active Directory > certutil –f –dspublish \"REBEL-CRTROOT_REBELAdmin Root CA.crt\" RootCA > certutil –f –dspublish \"REBELAdmin Root CA.crl\" Setup Issuing CA > Add-WindowsFeature ADCS-Cert-Authority -IncludeManagementTools > Add-WindowsFeature ADCS-web-enrollment > Install-ADcsCertificationAuthority -CACommonName “REBELAdmin IssuingCA” -CAType EnterpriseSubordinateCA -CryptoProviderName “RSA#Microsoft Software Key Storage Provider” -HashAlgorithmName SHA256 -KeyLength 2048 > Install-ADCSwebenrollment Issue Certificate for Issuing CA > certreq -submit \"REBEL-CA1.rebeladmin.com_REBELAdmin IssuingCA.req\" go to Server Manager > Tools > Certificate Authority > Pending Certificates and the right click on the certificate > All Tasks > Issue export> certreq -retrieve 2 \"C:\\REBEL-CA1.rebeladmin.com_REBELAdmin_IssuingCA.crt\" > Certutil –installcert \"C:\\REBEL-CA1.rebeladmin.com_REBELAdmin_IssuingCA.crt\" > start-service certsvc Post Configuration Tasks # CDP Location > certutil -setreg CA\\CRLPublicationURLs \"1:%WINDIR%\\system32\\CertSrv\\CertEnroll\\%3%8%9.crl\\n2:http://crt.rebeladmin.com/CertEnroll/%3%8%9.crl\\n3:ldap:///CN=%7%8,CN=%2,CN=CDP,CN=Public Key Services,CN=Services,%6%10\" # AIA Location > certutil -setreg CA\\CACertPublicationURLs \"1:%WINDIR%\\system32\\CertSrv\\CertEnroll\\%1_%3%4.crt\\n2:http://crt.rebeladmin.com/CertEnroll/%1_%3%4.crt\\n3:ldap:///CN=%7,CN=AIA,CN=Public Key Services,CN=Services,%6%11\" # CA and CRL Time Limits > certutil -setreg CA\\CRLPeriodUnits 7 > certutil -setreg CA\\CRLPeriod “Days” > certutil -setreg CA\\CRLOverlapPeriodUnits 3 > certutil -setreg CA\\CRLOverlapPeriod “Days” > certutil -setreg CA\\CRLDeltaPeriodUnits 0 > certutil -setreg ca\\ValidityPeriodUnits 3 > certutil -setreg ca\\ValidityPeriod “Years” > Restart-Service certsvc > certutil -crl run PKIView.msc to verify the configuration. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/windows/wsl.html":{"url":"cheatsheet/windows/wsl.html","title":"wsl","keywords":"","body":" install start up WSL init check others q&a Error: 0x80040326 run-detectors: unable to find an interpreter tip wsl or ubuntu enable vim clipboard config cmds references: wsl: * How to install Linux on Windows with WSL * Manual installation steps for older versions of WSL Windows Server Installation Guide Windows10/11 三步安装wsl2 Ubuntu20.04（任意盘） WSL Linux 子系统，真香！完整实操 Install Hyper-V on Windows 10 在 Windows 10 上安装 Hyper-V Set up a WSL development environment Install Linux on Windows with WSL WSL Error code: Wsl/Service/0x80040326 Enable 256 colour support over SSH * Windows Subsystem for Linux (WSL) explained * Advanced settings configuration in WSL /etc/wsl.conf %USERPROFILE%\\.wslconfig general profile settings in windows terminal by default: \"startingDirectory\": \"%USERPROFILE%\" in wsl: \"startingDirectory\": \"\\\\\\\\wsl$\\\\DISTRO NAME\\\\home\\\\USERNAME\" or \"startingDirectory\": \"\\\\\\\\wsl.localhost\\\\DISTRO NAME\\\\home\\\\USERNAME\" i.e.: \\\\wsl.localhsot\\Ubuntu\\home\\marslo windows terminal: Windows Terminal 下载，美化，完整配置 Startup settings in Windows Terminal Window Terminal 安装以及使用(2021最新) How to Change Default Terminal Application in Windows 10 install hyper-v > Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All wsl > wsl --install Installing: Virtual Machine Platform Virtual Machine Platform has been installed. Installing: Windows Subsystem for Linux Windows Subsystem for Linux has been installed. Installing: Windows Subsystem for Linux Windows Subsystem for Linux has been installed. Installing: Ubuntu Ubuntu has been installed. The requested operation is successful. Changes will not be effective until the system is rebooted. more > wsl --list --online # or > wsl --install -d Microsoft-Windows-Subsystem-Linux > dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart Deployment Image Servicing and Management tool Version: 10.0.19041.844 Image Version: 10.0.19044.2604 Enabling feature(s) [==========================100.0%==========================] The operation completed successfully. or> Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux VirtualMachinePlatform > dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart Deployment Image Servicing and Management tool Version: 10.0.19041.844 Image Version: 10.0.19044.2604 Enabling feature(s) [==========================100.0%==========================] The operation completed successfully. set version to 2 > wsl --set-default-version 2 This application requires the Windows Subsystem for Linux Optional Component. The system may need to be restarted so the changes can take effect. start up WSL download > cd d:\\Linux > Invoke-WebRequest -Uri https://wsldownload.azureedge.net/Ubuntu_2004.2020.424.0_x64.appx -OutFile Ubuntu20.04.appx -UseBasicParsing rename > Rename-Item .\\Ubuntu20.04.appx Ubuntu.zip > Expand-Archive .\\Ubuntu.zip -Verbose > cd .\\Ubuntu\\ > .\\ubuntu2004.exe init > Restart-Computer check windows feature appwiz.cpl windows features > Get-WindowsOptionalFeature -Online | Where-Object {$_.State -eq \"Enabled\"} | format-table FeatureName State ----------- ----- WCF-Services45 Enabled WCF-TCP-PortSharing45 Enabled MediaPlayback Enabled SmbDirect Enabled MSRDC-Infrastructure Enabled MicrosoftWindowsPowerShellV2Root Enabled MicrosoftWindowsPowerShellV2 Enabled NetFx4-AdvSrvs Enabled Printing-PrintToPDFServices-Features Enabled Printing-XPSServices-Features Enabled SearchEngine-Client-Package Enabled WorkFolders-Client Enabled Internet-Explorer-Optional-amd64 Enabled Windows-Defender-Default-Definitions Enabled Printing-Foundation-Features Enabled Printing-Foundation-InternetPrinting-Client Enabled Microsoft-Windows-Subsystem-Linux Enabled VirtualMachinePlatform Enabled Microsoft-Hyper-V-All Enabled Microsoft-Hyper-V Enabled Microsoft-Hyper-V-Tools-All Enabled Microsoft-Hyper-V-Management-PowerShell Enabled Microsoft-Hyper-V-Hypervisor Enabled Microsoft-Hyper-V-Services Enabled Microsoft-Hyper-V-Management-Clients Enabled others mount # /mnt/c $ cat /etc/wsl.conf [automount] root=/ # mount usb ( i.e.: F: ) $ sudo mkdir /mnt/f $ sudo mount -t drvfs H: /mnt/f # mount dvd ( i.e.: G ) $ sudo mkdir /mnt/g $ sudo mount -t drvfs G: /mnt/g wsl files stored [!NOTE|label:references:] Accessing Linux files from Windows using \\wsl$ > cd %USERPROFILE%\\AppData\\Local\\Packages\\[distro name] REM i.e.: > %LOCALAPPDATA%\\Packages\\CanonicalGroupLimited.Ubuntu18.04onWindows_79rhkp1fndgsc\\LocalState\\rootfs\\home\\pawelb. enable or disable Hyper-V > DISM /Online /Enable-Feature /All /FeatureName:Microsoft-Hyper-V setup powershell startup # 引入 posh-git Import-Module posh-git # 引入 oh-my-posh Import-Module oh-my-posh # 引入 ps-read-line Import-Module PSReadLine # 设置 PowerShell 主题 Set-PoshPrompt -Theme gmay #------------------------------- Import Modules END ------------------------------- #------------------------------- Set Hot-keys BEGIN ------------------------------- # 设置预测文本来源为历史记录 Set-PSReadLineOption -PredictionSource History # 每次回溯输入历史，光标定位于输入内容末尾 Set-PSReadLineOption -HistorySearchCursorMovesToEnd # 设置 Tab 为菜单补全和 Intellisense Set-PSReadLineKeyHandler -Key \"Tab\" -Function MenuComplete # 设置 Ctrl+d 为退出 PowerShell Set-PSReadlineKeyHandler -Key \"Ctrl+d\" -Function ViExit # 设置 Ctrl+z 为撤销 Set-PSReadLineKeyHandler -Key \"Ctrl+z\" -Function Undo # 设置向上键为后向搜索历史记录 Set-PSReadLineKeyHandler -Key UpArrow -Function HistorySearchBackward # 设置向下键为前向搜索历史纪录 Set-PSReadLineKeyHandler -Key DownArrow -Function HistorySearchForward #------------------------------- Set Hot-keys END ------------------------------- #------------------------------- Functions BEGIN ------------------------------- # Python 直接执行 $env:PATHEXT += \";.py\" # 更新系统组件 function Update-Packages { # update pip Write-Host \"Step 1: 更新 pip\" -ForegroundColor Magenta -BackgroundColor Cyan $a = pip list --outdated $num_package = $a.Length - 2 for ($i = 0; $i -lt $num_package; $i++) { $tmp = ($a[2 + $i].Split(\" \"))[0] pip install -U $tmp } # update TeX Live $CurrentYear = Get-Date -Format yyyy Write-Host \"Step 2: 更新 TeX Live\" $CurrentYear -ForegroundColor Magenta -BackgroundColor Cyan tlmgr update --self tlmgr update --all # update Chocolotey Write-Host \"Step 3: 更新 Chocolatey\" -ForegroundColor Magenta -BackgroundColor Cyan choco outdated } #------------------------------- Functions END ------------------------------- #------------------------------- Set Alias BEGIN ------------------------------- # 1. 编译函数 make function MakeThings { nmake.exe $args -nologo } Set-Alias -Name make -Value MakeThings # 2. 更新系统 os-update Set-Alias -Name os-update -Value Update-Packages # 3. 查看目录 ls & ll function ListDirectory { (Get-ChildItem).Name Write-Host(\"\") } Set-Alias -Name ls -Value ListDirectory Set-Alias -Name ll -Value Get-ChildItem # 4. 打开当前工作目录 function OpenCurrentFolder { param ( # 输入要打开的路径 # 用法示例：open C:\\ # 默认路径：当前工作文件夹 $Path = '.' ) Invoke-Item $Path } Set-Alias -Name open -Value OpenCurrentFolder #------------------------------- Set Alias END ------------------------------- #------------------------------- Set Network BEGIN ------------------------------- # 1. 获取所有 Network Interface function Get-AllNic { Get-NetAdapter | Sort-Object -Property MacAddress } Set-Alias -Name getnic -Value Get-AllNic # 2. 获取 IPv4 关键路由 function Get-IPv4Routes { Get-NetRoute -AddressFamily IPv4 | Where-Object -FilterScript {$_.NextHop -ne '0.0.0.0'} } Set-Alias -Name getip -Value Get-IPv4Routes # 3. 获取 IPv6 关键路由 function Get-IPv6Routes { Get-NetRoute -AddressFamily IPv6 | Where-Object -FilterScript {$_.NextHop -ne '::'} } Set-Alias -Name getip6 -Value Get-IPv6Routes q&a Error: 0x80040326 issue Error: 0x80040326 Error code: Wsl/Service/CreateInstance/0x80040326 solution # start powershell with administrator > wsl --update Checking for updates. Updating Windows Subsystem for Linux... > wsl --shutdown > wsl -d ubuntu To run a command as administrator (user \"root\"), use \"sudo \". See \"man sudo_root\" for details. run-detectors: unable to find an interpreter [!INFO|label:references:] Interop Issue: unable to find interpreter for launching Windows .exe files using Interop gabrielelana/vim-markdown # execute in wsl2 sudo update-binfmts --disable cli more$ mount | grep binfmt_misc binfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc (rw,relatime) tip > set \"PATH=%ConEmuBaseDirShort%\\wsl;%PATH%\" & %ConEmuBaseDirShort%\\conemu-cyg-64.exe --wsl -cur_console:pm:/mnt enable windows programe in wsl $ cat /etc/wsl.conf [interop] enabled=false append windows path via regedit> REG ADD \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Lxss\" /v AppendNtPath /t REG_DWORD /d 0x00000000 via wsl.conf$ cat /etc/wsl.conf [interop] appendWindowsPath=false wsl or ubuntu [!TIP] In a bash script, how can I tell if the script is running under Ubuntu pure or in Linux subsystem for Windows? How can I check if the environment is WSL from a shell script? How to check if running in Cygwin, Mac or Linux? uname uname -r $ uname -r | grep -q \"Microsoft\" /proc/sys/kernel/osrelease or /proc/version $ cat /proc/version Linux version 5.15.133.1-microsoft-standard-WSL2 (root@1c602f52c2e4) (gcc (GCC) 11.2.0, GNU ld (GNU Binutils) 2.37) #1 SMP Thu Oct 5 21:02:42 UTC 2023 $ cat /proc/sys/kernel/osrelease 5.15.133.1-microsoft-standard-WSL2 enable vim clipboard [!NOTE|label:references:] Windows Subsystem Linux - Make VIM use the clipboard? How to copy/paste from Vim in WSL #10223 : Neovim pasting content with ^M at the end of lines Pasting from clipboard in vim $ sudo apt-get install vim-gtk $ vim --version | grep clipboard +clipboard +keymap +printer +vertsplit +eval -mouse_jsbterm -sun_workshop +xterm_clipboard # or $ sudo add-apt-repository ppa:jonathonf/vim $ sudo apt update $ sudo apt install vim vimrc set clipboard=unnamed set clipboard=unnamedplus \" or set clipboard^=unnamed set clipboard^=unnamedplus config /etc/wsl.conf [boot] systemd=true [network] generateResolvConf = false [automount] enable = true mountFsTab = true options = \"metadata,umask=22,fmask=11\" [interop] enable = false appendWindowsPath = false %USERPROFILE%\\.wslconfig # Settings apply across all Linux distros running on WSL 2 [wsl2] # Limits VM memory to use no more than 4 GB, this can be set as whole numbers using GB or MB memory=4GB # Sets the VM to use two virtual processors processors=4 # Specify a custom Linux kernel to use with your installed distros. The default kernel used can be found at https://github.com/microsoft/WSL2-Linux-Kernel # kernel=C:\\\\temp\\\\myCustomKernel # Sets additional kernel parameters, in this case enabling older Linux base images such as Centos 6 $ kernelCommandLine = vsyscall=emulate # Sets amount of swap storage space to 8GB, default is 25% of available RAM swap=4GB # Sets swapfile path location, default is %USERPROFILE%\\AppData\\Local\\Temp\\swap.vhdx swapfile=C:\\\\temp\\\\wsl-swap.vhdx # Disable page reporting so WSL retains all allocated memory claimed from Windows and releases none back when free pageReporting=false # Turn off default connection to bind WSL 2 localhost to Windows localhost localhostforwarding=true # Disables nested virtualization nestedVirtualization=false # Turns off output console showing contents of dmesg when opening a WSL 2 distro for debugging debugConsole=false # Enable experimental features [experimental] sparseVhd=true restart wsl > wsl --list --running Windows Subsystem for Linux Distributions: Ubuntu (Default) Ubuntu-22.04 > wsl --shutdown setup default bash [!NOTE|label:references:] How to change default shell for Linux susbsystem for Windows $ echo $SHELL /bin/bash # for current account $ chsh -s /usr/bin/bash # for root $ sudo chsh -s /usr/bin/bash $ exit # re-login $ echo $SHELL /usr/bin/bash # verify in /etc/passwd cmds wsl --update wsl --version wsl --list --running wsl --shutdown wsl hostname -i wsl -d ubuntu wsl -d Debian -u root Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/windows/wt.html":{"url":"cheatsheet/windows/wt.html","title":"wt","keywords":"","body":" install via download windows terminal shortcut key Open the quake mode window my settings gruvbox-dark global-wild togged hotkey quake all [!TIP|label:references:] * microsoft/terminal Custom actions in Windows Terminal 在windows下用下拉式中断yakuake(guake)指南 Settings JSON file stable : %LOCALAPPDATA%\\Packages\\Microsoft.WindowsTerminal_8wekyb3d8bbwe\\LocalState\\settings.json preview : %LOCALAPPDATA%\\Packages\\Microsoft.WindowsTerminalPreview_8wekyb3d8bbwe\\LocalState\\settings.json unpackaged(scoop, chocolately, ...) : %LOCALAPPDATA%\\Microsoft\\Windows Terminal\\settings.json Using command line arguments for Windows Terminal install via download [!NOTE|label:references:] WinGet configuration Preview winget.run winget get details > Get-Command -Module Microsoft.WinGet.Client CommandType Name Version Source ----------- ---- ------- ------ Function Add-WinGetSource 0.2.1 Microsoft.WinGet.Client Function Disable-WinGetSetting 0.2.1 Microsoft.WinGet.Client Function Enable-WinGetSetting 0.2.1 Microsoft.WinGet.Client Function Get-WinGetSettings 0.2.1 Microsoft.WinGet.Client Function Remove-WinGetSource 0.2.1 Microsoft.WinGet.Client Function Reset-WinGetSource 0.2.1 Microsoft.WinGet.Client Cmdlet Assert-WinGetPackageManager 0.2.1 Microsoft.WinGet.Client Cmdlet Find-WinGetPackage 0.2.1 Microsoft.WinGet.Client Cmdlet Get-WinGetPackage 0.2.1 Microsoft.WinGet.Client Cmdlet Get-WinGetSource 0.2.1 Microsoft.WinGet.Client Cmdlet Get-WinGetUserSettings 0.2.1 Microsoft.WinGet.Client Cmdlet Get-WinGetVersion 0.2.1 Microsoft.WinGet.Client Cmdlet Install-WinGetPackage 0.2.1 Microsoft.WinGet.Client Cmdlet Repair-WinGetPackageManager 0.2.1 Microsoft.WinGet.Client Cmdlet Set-WinGetUserSettings 0.2.1 Microsoft.WinGet.Client Cmdlet Test-WinGetUserSettings 0.2.1 Microsoft.WinGet.Client Cmdlet Uninstall-WinGetPackage 0.2.1 Microsoft.WinGet.Client Cmdlet Update-WinGetPackage 0.2.1 Microsoft.WinGet.Client install winget > Install-Module Microsoft.WinGet.Client Untrusted repository You are installing the modules from an untrusted repository. If you trust this repository, change its InstallationPolicy value by running the Set-PSRepository cmdlet. Are you sure you want to install the modules from 'PSGallery'? [Y] Yes [A] Yes to All [N] No [L] No to All [S] Suspend [?] Help (default is \"N\"): a or on Windows Sandbox$progressPreference = 'silentlyContinue' Write-Information \"Downloading WinGet and its dependencies...\" Invoke-WebRequest -Uri https://aka.ms/getwinget -OutFile Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle Invoke-WebRequest -Uri https://aka.ms/Microsoft.VCLibs.x64.14.00.Desktop.appx -OutFile Microsoft.VCLibs.x64.14.00.Desktop.appx Invoke-WebRequest -Uri https://github.com/microsoft/microsoft-ui-xaml/releases/download/v2.7.3/Microsoft.UI.Xaml.2.7.x64.appx -OutFile Microsoft.UI.Xaml.2.7.x64.appx Add-AppxPackage Microsoft.VCLibs.x64.14.00.Desktop.appx Add-AppxPackage Microsoft.UI.Xaml.2.7.x64.appx Add-AppxPackage Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbundle list upgarde > winget upgrade Name Id Version Available Source ------------------------------------------------------------------------------------------------------------------------------------- AutoHotkey AutoHotkey.AutoHotkey 2.0.0 2.0.4 winget Git Git.Git 2.40.1 2.41.0.3 winget Microsoft 365 Apps for enterprise - en-us Microsoft.Office 16.0.16130.20644 16.0.16529.20164 winget 搜狗输入法 13.4.0正式版 Sogou.SogouInput 13.4.0.7202 13.7.0.7991 winget WinSCP 5.19.6 WinSCP.WinSCP 5.19.6 6.1.1 winget Microsoft Visual C++ 2015-2019 Redistributable (x86) - 14… Microsoft.VCRedist.2015+.x86 14.28.29914.0 14.36.32532.0 winget 7-Zip 21.07 (x64 edition) 7zip.7zip 21.07.00.0 23.01 winget VMware Horizon Client VMware.HorizonClient 8.6.0.29364 8.9.0.35399 winget Microsoft Visual Studio Code (User) Microsoft.VisualStudioCode 1.78.2 1.81.0 winget Beyond Compare 4 ScooterSoftware.BeyondCompare4 4.1.3.20814 4.4.6.27483 winget PuTTY release 0.76 PuTTY.PuTTY 0.76.0.0 0.78.0.0 winget Adobe Acrobat Reader DC Adobe.Acrobat.Reader.32-bit 22.001.20117 23.003.20244 winget Zoom(64bit) Zoom.Zoom upgrade > winget upgrade --all # or > winget upgrade # i.e.: > winget upgrade Git Found Git [Git.Git] Version 2.41.0.3 This application is licensed to you by its owner. Microsoft is not responsible for, nor does it grant any licenses to, third-party packages. Downloading https://github.com/git-for-windows/git/releases/download/v2.41.0.windows.3/Git-2.41.0.3-64-bit.exe ██████████████████████████████ 58.3 MB / 58.3 MB Successfully verified installer hash Starting package install... Successfully installed windows terminal [!NOTE|label:references:] Windows Terminalv1.16.10261.0> winget install -e --id Microsoft.WindowsTerminal show versions> winget show Microsoft.WindowsTerminal --versions Found Windows Terminal [Microsoft.WindowsTerminal] Version ------------ 1.16.10261.0 1.16.10231.0 1.15.3465.0 1.15.2874.0 1.15.2524.0 1.14.2281.0 1.13.11431.0 1.12.10983.0 1.12.10982.0 1.12.10733.0 1.12.10732.0 1.12.10393.0 1.12.10334.0 ... show available pacakges> winget search windowsterminal Name Id Version Source ------------------------------------------------------------------------------- Windows Terminal Preview Microsoft.WindowsTerminal.Preview 1.17.10234.0 winget Windows Terminal Microsoft.WindowsTerminal 1.16.10261.0 winget shortcut key [!NOTE|label:references:] globalSummon action #12047: Global keyboard shortcut for launching Terminal #2983: Shortcut key to launch Terminal@ECHO OFF start /B C:\\Users\\user\\AppData\\Local\\Microsoft\\WindowsApps\\wt.exe Bring up the Windows Terminal in a keystroke ahk #12220: Minimize to tray not working\"minimizeToNotificationArea\": true KEYS CMD/ACTIONS TARGET/MODE ctrl+shift+f find - ctrl+shift+space openNewTabDropdown - ctrl+, openSettings settingsUI ctrl+shift+, openSettings settingsFile ctrl+alt+, openSettings defaultsFile alt+space openSystemMenu - alt+enter toggleFullscreen - f11 toggleFullscreen - ctrl+shift+d duplicateTab - ctrl+shift+t newTab - ctrl+tab nextTab - ctrl+shift+tab prevTab - ctrl+shift+n newWindow - alt+shift+d splitPane duplicate alt+shift+- splitPane horizontal alt+shift++ splitPane vertical ctrl+shift+w closePane - alt+down moveFocus down alt+up moveFocus up alt+left moveFocus left alt+right moveFocus right moveFocus moveFocus previous alt+shift+down resizePane down alt+shift+up resizePane up alt+shift+left resizePane left alt+shift+right resizePane right ctrl+c copy - ctrl+shift+c copy - ctrl+insert copy - enter copy - ctrl+v paste - ctrl+shift+v paste - shift+insert paste - ctrl+shift+a selectAll - ctrl+shift+m markMode - ctrl+shift+up scrollUp - ctrl+shift+down scrollDown - ctrl+shift+pgup scrollUpPage - ctrl+shift+pgdn scrollDownPage - ctrl+shift+home scrollToTop - ctrl+shift+end scrollToBottom - ctrl+= adjustFontSize 1 ctrl+- adjustFontSize -1 ctrl+numpad_plus adjustFontSize 1 ctrl+numpad_minus adjustFontSize -1 ctrl+0, ctrl+numpad_0 resetFontSize - example // Summon the most recently used (MRU) window, to the current virtual desktop, // to the monitor the mouse cursor is on, without an animation. If the window is // already in the foreground, then minimize it. { \"keys\": \"ctrl+1\", \"command\": { \"action\": \"globalSummon\" } }, // Summon the MRU window, by going to the virtual desktop the window is // currently on. Move the window to the monitor the mouse is on. { \"keys\": \"ctrl+2\", \"command\": { \"action\": \"globalSummon\", \"desktop\": \"any\" } }, // Summon the MRU window to the current desktop, leaving the position of the window untouched. { \"keys\": \"ctrl+3\", \"command\": { \"action\": \"globalSummon\", \"monitor\": \"any\" } }, // Summon the MRU window, by going to the virtual desktop the window is // currently on, leaving the position of the window untouched. { \"keys\": \"ctrl+4\", \"command\": { \"action\": \"globalSummon\", \"desktop\": \"any\", \"monitor\": \"any\" } }, // Summon the MRU window with a dropdown duration of 200ms. { \"keys\": \"ctrl+5\", \"command\": { \"action\": \"globalSummon\", \"dropdownDuration\": 200 } }, // Summon the MRU window. If the window is already in the foreground, do nothing. { \"keys\": \"ctrl+6\", \"command\": { \"action\": \"globalSummon\", \"toggleVisibility\": false } }, // Summon the window named \"_quake\". If no window with that name exists, then create a new window. { \"keys\": \"ctrl+7\", \"command\": { \"action\": \"globalSummon\", \"name\": \"_quake\" } } Open the quake mode window { \"keys\": \"win+`\", \"command\": { \"action\": \"globalSummon\", \"name\": \"_quake\", \"dropdownDuration\": 200, \"toggleVisibility\": true, \"monitor\": \"toMouse\", \"desktop\": \"toCurrent\" } } my settings gruvbox-dark \"schemes\": [ { \"background\": \"#282828\", \"black\": \"#282828\", \"blue\": \"#458588\", \"brightBlack\": \"#928374\", \"brightBlue\": \"#83A598\", \"brightCyan\": \"#8EC07C\", \"brightGreen\": \"#B8BB26\", \"brightPurple\": \"#D3869B\", \"brightRed\": \"#FB4934\", \"brightWhite\": \"#EBDBB2\", \"brightYellow\": \"#FABD2F\", \"cursorColor\": \"#FFFFFF\", \"cyan\": \"#689D6A\", \"foreground\": \"#EBDBB2\", \"green\": \"#98971A\", \"name\": \"gruvbox-dark\", \"purple\": \"#B16286\", \"red\": \"#CC241D\", \"selectionBackground\": \"#1D2021\", \"white\": \"#A89984\", \"yellow\": \"#D79921\" } ], global-wild togged hotkey \"actions\": [ { \"keys\": \"ctrl+alt+o\", \"command\": { \"action\": \"globalSummon\" } }, ], \"minimizeToNotificationArea\": true, quake \"actions\": [ { \"command\": { \"action\": \"globalSummon\", \"name\": \"_quake\" } }, { \"command\": { \"action\": \"globalSummon\", \"desktop\": \"toCurrent\", \"dropdownDuration\": 200, \"monitor\": \"toMouse\", \"name\": \"_quake\", \"toggleVisibility\": true }, \"keys\": \"shift+space\" }, ], all { \"$help\": \"https://aka.ms/terminal-documentation\", \"$schema\": \"https://aka.ms/terminal-profiles-schema-preview\", \"actions\": [ { \"command\": { \"action\": \"globalSummon\", \"name\": \"_quake\" } }, { \"command\": { \"action\": \"globalSummon\", \"desktop\": \"toCurrent\", \"dropdownDuration\": 200, \"monitor\": \"toMouse\", \"name\": \"_quake\", \"toggleVisibility\": true }, \"keys\": \"shift+space\" }, { \"keys\": \"ctrl+alt+o\", \"command\": { \"action\": \"globalSummon\" } }, { \"command\": { \"action\": \"moveTab\", \"direction\": \"backward\" }, \"keys\": \"alt+shift+l\" }, { \"command\": { \"action\": \"clearBuffer\", \"clear\": \"all\" }, \"keys\": \"ctrl+l\" }, { \"command\": { \"action\": \"moveFocus\", \"direction\": \"left\" } }, { \"command\": { \"action\": \"nextTab\" }, \"keys\": \"ctrl+shift+l\" }, { \"command\": \"paste\" }, { \"command\": { \"action\": \"copy\", \"singleLine\": false }, \"keys\": \"ctrl+c\" }, { \"command\": { \"action\": \"moveTab\", \"direction\": \"forward\" }, \"keys\": \"alt+shift+h\" }, { \"command\": \"find\", \"keys\": \"ctrl+shift+f\" }, { \"command\": { \"action\": \"splitPane\", \"split\": \"auto\", \"splitMode\": \"duplicate\" }, \"keys\": \"alt+shift+d\" }, { \"command\": \"unbound\", \"keys\": \"ctrl+v\" }, { \"command\": { \"action\": \"prevTab\" }, \"keys\": \"ctrl+shift+h\" } ], \"alwaysShowNotificationIcon\": true, \"alwaysShowTabs\": true, \"autoHideWindow\": false, \"centerOnLaunch\": true, \"copyFormatting\": \"none\", \"copyOnSelect\": true, \"defaultProfile\": \"{51855cb2-8cce-5362-8f54-464b92b32386}\", \"experimental.rendering.forceFullRepaint\": true, \"experimental.rendering.software\": true, \"focusFollowMouse\": true, \"initialCols\": 116, \"initialPosition\": \",\", \"initialRows\": 28, \"language\": \"en-US\", \"launchMode\": \"default\", \"minimizeToNotificationArea\": true, \"newTabMenu\": [ { \"type\": \"remainingProfiles\" } ], \"newTabPosition\": \"afterCurrentTab\", \"profiles\": { \"defaults\": { \"bellStyle\": \"none\", \"closeOnExit\": \"graceful\", \"colorScheme\": \"One Half Dark\", \"cursorShape\": \"bar\", \"experimental.retroTerminalEffect\": true, \"font\": { \"cellHeight\": \"1\", \"face\": \"Rec Mono Casual\", \"size\": 19.0 }, \"opacity\": 98 }, \"list\": [ { \"colorScheme\": \"Campbell Powershell\", \"commandline\": \"%SystemRoot%\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\", \"cursorShape\": \"underscore\", \"font\": { \"face\": \"GohuFont uni14 Nerd Font Mono\", \"size\": 20.0 }, \"guid\": \"{61c54bbd-c2c6-5271-96e7-009a87ff44bf}\", \"hidden\": false, \"name\": \"Windows PowerShell\", \"opacity\": 98 }, { \"colorScheme\": \"Solarized Dark\", \"commandline\": \"%SystemRoot%\\\\System32\\\\cmd.exe\", \"cursorShape\": \"underscore\", \"font\": { \"face\": \"GohuFont uni14 Nerd Font Mono\", \"size\": 20.0 }, \"guid\": \"{0caa0dad-35be-5f56-a8ff-afceeeaa6101}\", \"hidden\": false, \"name\": \"Command Prompt\", \"opacity\": 86, \"useAcrylic\": true }, { \"guid\": \"{2c4de342-38b7-51cf-b940-2309a097f518}\", \"hidden\": true, \"name\": \"Ubuntu\", \"opacity\": 98, \"source\": \"Windows.Terminal.Wsl\" }, { \"guid\": \"{b453ae62-4e3d-5e58-b989-0a998ec441b8}\", \"hidden\": true, \"name\": \"Azure Cloud Shell\", \"source\": \"Windows.Terminal.Azure\" }, { \"colorScheme\": \"gruvbox-dark\", \"cursorShape\": \"doubleUnderscore\", \"font\": { \"face\": \"Rec Mono Casual\", \"size\": 20.0, \"weight\": \"semi-light\" }, \"guid\": \"{51855cb2-8cce-5362-8f54-464b92b32386}\", \"hidden\": false, \"name\": \"Ubuntu\", \"opacity\": 98, \"source\": \"CanonicalGroupLimited.Ubuntu_79rhkp1fndgsc\", \"useAcrylic\": false }, { \"colorScheme\": \"gruvbox-dark\", \"guid\": \"{17bf3de4-5353-5709-bcf9-835bd952a95e}\", \"hidden\": true, \"name\": \"Ubuntu-22.04\", \"opacity\": 98, \"source\": \"Windows.Terminal.Wsl\" }, { \"colorScheme\": \"gruvbox-dark\", \"font\": { \"size\": 18.0 }, \"guid\": \"{d7b20cea-47a9-518c-95a4-c8bd91e2e1c6}\", \"hidden\": false, \"name\": \"Ubuntu 22.04.2 LTS\", \"opacity\": 98, \"source\": \"CanonicalGroupLimited.Ubuntu22.04LTS_79rhkp1fndgsc\" }, { \"commandline\": \"ubuntu.exe\", \"font\": { \"size\": 14.0 }, \"guid\": \"{12f6614d-02ac-48e7-881a-e9ff89f9170f}\", \"hidden\": false, \"name\": \"_quake\" } ] }, \"schemes\": [ { \"background\": \"#0C0C0C\", \"black\": \"#0C0C0C\", \"blue\": \"#0037DA\", \"brightBlack\": \"#767676\", \"brightBlue\": \"#3B78FF\", \"brightCyan\": \"#61D6D6\", \"brightGreen\": \"#16C60C\", \"brightPurple\": \"#B4009E\", \"brightRed\": \"#E74856\", \"brightWhite\": \"#F2F2F2\", \"brightYellow\": \"#F9F1A5\", \"cursorColor\": \"#FFFFFF\", \"cyan\": \"#3A96DD\", \"foreground\": \"#CCCCCC\", \"green\": \"#13A10E\", \"name\": \"Campbell\", \"purple\": \"#881798\", \"red\": \"#C50F1F\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#CCCCCC\", \"yellow\": \"#C19C00\" }, { \"background\": \"#012456\", \"black\": \"#0C0C0C\", \"blue\": \"#0037DA\", \"brightBlack\": \"#767676\", \"brightBlue\": \"#3B78FF\", \"brightCyan\": \"#61D6D6\", \"brightGreen\": \"#16C60C\", \"brightPurple\": \"#B4009E\", \"brightRed\": \"#E74856\", \"brightWhite\": \"#F2F2F2\", \"brightYellow\": \"#F9F1A5\", \"cursorColor\": \"#FFFFFF\", \"cyan\": \"#3A96DD\", \"foreground\": \"#CCCCCC\", \"green\": \"#13A10E\", \"name\": \"Campbell Powershell\", \"purple\": \"#881798\", \"red\": \"#C50F1F\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#CCCCCC\", \"yellow\": \"#C19C00\" }, { \"background\": \"#282C34\", \"black\": \"#282C34\", \"blue\": \"#61AFEF\", \"brightBlack\": \"#5A6374\", \"brightBlue\": \"#61AFEF\", \"brightCyan\": \"#56B6C2\", \"brightGreen\": \"#98C379\", \"brightPurple\": \"#C678DD\", \"brightRed\": \"#E06C75\", \"brightWhite\": \"#DCDFE4\", \"brightYellow\": \"#E5C07B\", \"cursorColor\": \"#FFFFFF\", \"cyan\": \"#56B6C2\", \"foreground\": \"#DCDFE4\", \"green\": \"#98C379\", \"name\": \"One Half Dark\", \"purple\": \"#C678DD\", \"red\": \"#E06C75\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#DCDFE4\", \"yellow\": \"#E5C07B\" }, { \"background\": \"#FAFAFA\", \"black\": \"#383A42\", \"blue\": \"#0184BC\", \"brightBlack\": \"#4F525D\", \"brightBlue\": \"#61AFEF\", \"brightCyan\": \"#56B5C1\", \"brightGreen\": \"#98C379\", \"brightPurple\": \"#C577DD\", \"brightRed\": \"#DF6C75\", \"brightWhite\": \"#FFFFFF\", \"brightYellow\": \"#E4C07A\", \"cursorColor\": \"#4F525D\", \"cyan\": \"#0997B3\", \"foreground\": \"#383A42\", \"green\": \"#50A14F\", \"name\": \"One Half Light\", \"purple\": \"#A626A4\", \"red\": \"#E45649\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#FAFAFA\", \"yellow\": \"#C18301\" }, { \"background\": \"#002B36\", \"black\": \"#002B36\", \"blue\": \"#268BD2\", \"brightBlack\": \"#073642\", \"brightBlue\": \"#839496\", \"brightCyan\": \"#93A1A1\", \"brightGreen\": \"#586E75\", \"brightPurple\": \"#6C71C4\", \"brightRed\": \"#CB4B16\", \"brightWhite\": \"#FDF6E3\", \"brightYellow\": \"#657B83\", \"cursorColor\": \"#FFFFFF\", \"cyan\": \"#2AA198\", \"foreground\": \"#839496\", \"green\": \"#859900\", \"name\": \"Solarized Dark\", \"purple\": \"#D33682\", \"red\": \"#DC322F\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#EEE8D5\", \"yellow\": \"#B58900\" }, { \"background\": \"#FDF6E3\", \"black\": \"#002B36\", \"blue\": \"#268BD2\", \"brightBlack\": \"#073642\", \"brightBlue\": \"#839496\", \"brightCyan\": \"#93A1A1\", \"brightGreen\": \"#586E75\", \"brightPurple\": \"#6C71C4\", \"brightRed\": \"#CB4B16\", \"brightWhite\": \"#FDF6E3\", \"brightYellow\": \"#657B83\", \"cursorColor\": \"#002B36\", \"cyan\": \"#2AA198\", \"foreground\": \"#657B83\", \"green\": \"#859900\", \"name\": \"Solarized Light\", \"purple\": \"#D33682\", \"red\": \"#DC322F\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#EEE8D5\", \"yellow\": \"#B58900\" }, { \"background\": \"#000000\", \"black\": \"#000000\", \"blue\": \"#3465A4\", \"brightBlack\": \"#555753\", \"brightBlue\": \"#729FCF\", \"brightCyan\": \"#34E2E2\", \"brightGreen\": \"#8AE234\", \"brightPurple\": \"#AD7FA8\", \"brightRed\": \"#EF2929\", \"brightWhite\": \"#EEEEEC\", \"brightYellow\": \"#FCE94F\", \"cursorColor\": \"#FFFFFF\", \"cyan\": \"#06989A\", \"foreground\": \"#D3D7CF\", \"green\": \"#4E9A06\", \"name\": \"Tango Dark\", \"purple\": \"#75507B\", \"red\": \"#CC0000\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#D3D7CF\", \"yellow\": \"#C4A000\" }, { \"background\": \"#FFFFFF\", \"black\": \"#000000\", \"blue\": \"#3465A4\", \"brightBlack\": \"#555753\", \"brightBlue\": \"#729FCF\", \"brightCyan\": \"#34E2E2\", \"brightGreen\": \"#8AE234\", \"brightPurple\": \"#AD7FA8\", \"brightRed\": \"#EF2929\", \"brightWhite\": \"#EEEEEC\", \"brightYellow\": \"#FCE94F\", \"cursorColor\": \"#000000\", \"cyan\": \"#06989A\", \"foreground\": \"#555753\", \"green\": \"#4E9A06\", \"name\": \"Tango Light\", \"purple\": \"#75507B\", \"red\": \"#CC0000\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#D3D7CF\", \"yellow\": \"#C4A000\" }, { \"background\": \"#300A24\", \"black\": \"#171421\", \"blue\": \"#0037DA\", \"brightBlack\": \"#767676\", \"brightBlue\": \"#08458F\", \"brightCyan\": \"#2C9FB3\", \"brightGreen\": \"#26A269\", \"brightPurple\": \"#A347BA\", \"brightRed\": \"#C01C28\", \"brightWhite\": \"#F2F2F2\", \"brightYellow\": \"#A2734C\", \"cursorColor\": \"#FFFFFF\", \"cyan\": \"#3A96DD\", \"foreground\": \"#FFFFFF\", \"green\": \"#26A269\", \"name\": \"Ubuntu-22.04-ColorScheme\", \"purple\": \"#881798\", \"red\": \"#C21A23\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#CCCCCC\", \"yellow\": \"#A2734C\" }, { \"background\": \"#300A24\", \"black\": \"#171421\", \"blue\": \"#0037DA\", \"brightBlack\": \"#767676\", \"brightBlue\": \"#08458F\", \"brightCyan\": \"#2C9FB3\", \"brightGreen\": \"#26A269\", \"brightPurple\": \"#A347BA\", \"brightRed\": \"#C01C28\", \"brightWhite\": \"#F2F2F2\", \"brightYellow\": \"#A2734C\", \"cursorColor\": \"#FFFFFF\", \"cyan\": \"#3A96DD\", \"foreground\": \"#FFFFFF\", \"green\": \"#26A269\", \"name\": \"Ubuntu-ColorScheme\", \"purple\": \"#881798\", \"red\": \"#C21A23\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#CCCCCC\", \"yellow\": \"#A2734C\" }, { \"background\": \"#000000\", \"black\": \"#000000\", \"blue\": \"#000080\", \"brightBlack\": \"#808080\", \"brightBlue\": \"#0000FF\", \"brightCyan\": \"#00FFFF\", \"brightGreen\": \"#00FF00\", \"brightPurple\": \"#FF00FF\", \"brightRed\": \"#FF0000\", \"brightWhite\": \"#FFFFFF\", \"brightYellow\": \"#FFFF00\", \"cursorColor\": \"#FFFFFF\", \"cyan\": \"#008080\", \"foreground\": \"#C0C0C0\", \"green\": \"#008000\", \"name\": \"Vintage\", \"purple\": \"#800080\", \"red\": \"#800000\", \"selectionBackground\": \"#FFFFFF\", \"white\": \"#C0C0C0\", \"yellow\": \"#808000\" }, { \"background\": \"#282828\", \"black\": \"#282828\", \"blue\": \"#458588\", \"brightBlack\": \"#928374\", \"brightBlue\": \"#83A598\", \"brightCyan\": \"#8EC07C\", \"brightGreen\": \"#B8BB26\", \"brightPurple\": \"#D3869B\", \"brightRed\": \"#FB4934\", \"brightWhite\": \"#EBDBB2\", \"brightYellow\": \"#FABD2F\", \"cursorColor\": \"#FFFFFF\", \"cyan\": \"#689D6A\", \"foreground\": \"#EBDBB2\", \"green\": \"#98971A\", \"name\": \"gruvbox-dark\", \"purple\": \"#B16286\", \"red\": \"#CC241D\", \"selectionBackground\": \"#1D2021\", \"white\": \"#A89984\", \"yellow\": \"#D79921\" } ], \"showTabsInTitlebar\": true, \"startOnUserLogin\": true, \"tabWidthMode\": \"equal\", \"themes\": [], \"useAcrylicInTabRow\": false, \"wordDelimiters\": \" \\\\()\\\"',:;<>!#$%^&*|+=[]{}?\\u2502\" } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/windows/shortcut.html":{"url":"cheatsheet/windows/shortcut.html","title":"shortcut","keywords":"","body":" shortcuts windows terminal ubuntu 18.04 cmd admin cmd admin without UAC check via Task Scheduler lansettings Desktop Icon Settings Notification Area Icons Personalization Screen Saver System System Icon user environment variables icons reference reference : Windows Start | Run commands List of Commands to Open Control Panel Items in Windows 10 shortcuts [!TIP] windows apps location: %LocalAppData%\\Microsoft\\WindowsApps windows terminal reference : 8 Ways to Open the Windows Terminal in Windows 11 PNG to ICO Converter insert commands %LocalAppData%\\Microsoft\\WindowsApps\\wt.exe icon download terminal.ico ubuntu 18.04 insert commands %LocalAppData%\\Microsoft\\WindowsApps\\ubuntu1804.exe icon download ubuntu.ico cmd admin references: Create Elevated Command Prompt Shortcut in Windows 10 Open Elevated Command Prompt in Windows 10 create shortcut by New -> Shortcut insert commands setup shortcut name setup Run as administrator for the shortcut move shortcut to Start Menu : Ctrl + r -> shell:Programs cmd admin without UAC check via Task Scheduler references: Create Administrator Mode Shortcuts Without UAC Prompts in Windows 10 How to Create Administrator Shortcut Without UAC Password Prompt configuration in Task Scheduler win -> insert Task Scheduler -> Enter Task Scheduler (Local) -> Create Task... General Tab : -> Name: RunAdminCMD (or any you want) -> [x] Run with highest privileges Conditions Tab : -> [ ] Start the task only if the computer is on AC power Actions Tab : -> New -> Browse Program/script: -> select the path (i.e.: C:\\Windows\\System32\\cmd.exe) -> OK or Triggers Tab : -> New -> Begin the task: : At Startup (or At log on) -> OK Settings Tab : -> [ ] Stop the task if runing longer than: 3 days -> OK Save and Run shortcut setup right click -> New -> Shortcut Type the location of the item: : schtasks /run /tn \"\" -> Next schtasks /run /tn \"\" i.e.:schtasks /run /tn \"RunAdminCMD\" Type a name of this shortbut: : any name you want (i.e.: Command Prompt) -> Finish right click the new shortcut -> Properties -> Shortcut Tab : Change Icon Look for icons in this file : %SystemRoot%\\System32\\imageres.dll put the shortcut to anywhere you want lansettings Internet Settings > inetcpl.cpl Internet Settings with Connections Tab > rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,4 or > inetcpl.cpl ,4 or > control inetcpl.cpl,,4 proxy setup > REG ADD \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyServer /d \"hhttp=proxy-url:port;https=proxy-url:port;ftp=proxy-url:port;socks=proxy-url:port;\" /t REG_SZ /f Desktop Icon Settings > rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,0 Notification Area Icons > explorer shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} Personalization > explorer shell:::{ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} Screen Saver > rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,1 System > control /name Microsoft.System or > control sysdm.cpl System Icon > explorer shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} \\SystemIcons,,0 user environment variables rundll32.exe sysdm.cpl,EditEnvironmentVariables icons %SystemRoot%\\System32\\shell32.dll %SystemRoot%\\system32\\imageres.dll %systemroot%\\system32\\DeviceCenter.dll %systemroot%\\explorer.exe %systemroot%\\system32\\ddores.dll %systemroot%\\system32\\mmcndmgr.dll %systemroot%\\system32\\mmres.dll %systemroot%\\system32\\netcenter.dll %systemroot%\\system32\\networkexplorer.dll %systemroot%\\system32\\pnidui.dll %systemroot%\\system32\\setupapi.dll %systemroot%\\system32\\compstui.dll %systemroot%\\system32\\dsuiext.dll %systemroot%\\system32\\mstscax.dll %systemroot%\\system32\\comres.dll %systemroot%\\system32\\mstsc.exe %systemroot%\\system32\\actioncentercpl.dll %systemroot%\\system32\\aclui.dll %systemroot%\\system32\\autoplay.dll %systemroot%\\system32\\comctl32.dll %systemroot%\\system32\\xwizards.dll %systemroot%\\system32\\ncpa.cpl %systemroot%\\system32\\url.dll %systemroot%\\system32\\pifmgr.dll %systemroot%\\system32\\accessibilitycpl.dl %systemroot%\\system32\\moricons.dll %systemroot%system32\\netshell.dll %systemroot%\\system32\\sensorscpl.dll %systemroot%\\system32\\wmploc.dll %systemroot%\\system32\\wpdshext.dll systemroot%\\system32\\ieframe.dll %systemroot%\\system32\\wiashext.dll reference Control Panel Item Commands Add a Device wizard %windir%\\System32\\DevicePairingWizard.exe Add Hardware wizard %windir%\\System32\\hdwwiz.exe Add a Printer wizard rundll32.exe shell32.dll,SHHelpShortcuts_RunDLL AddPrinter Additional Clocks rundll32.exe shell32.dll,Control_RunDLL timedate.cpl,,1 Administrative Tools control /name Microsoft.AdministrativeTools OR control admintools AutoPlay control /name Microsoft.AutoPlay Backup and Restore (Windows 7) control /name Microsoft.BackupAndRestoreCenter BitLocker Drive Encryption control /name Microsoft.BitLockerDriveEncryption Color and Appearance explorer shell:::{ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} -Microsoft.Personalization\\pageColorization Color Management control /name Microsoft.ColorManagement Credential Manager control /name Microsoft.CredentialManager Date and Time (Date and Time) control /name Microsoft.DateAndTime OR control timedate.cpl OR control date/time OR rundll32.exe shell32.dll,Control_RunDLL timedate.cpl,,0 Date and Time (Additional Clocks) rundll32.exe shell32.dll,Control_RunDLL timedate.cpl,,1 Default Programs control /name Microsoft.DefaultPrograms Desktop Background explorer shell:::{ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} -Microsoft.Personalization\\pageWallpaper Desktop Icon Settings rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,0 Device Manager control /name Microsoft.DeviceManager OR control hdwwiz.cpl OR devmgmt.msc Devices and Printers control /name Microsoft.DevicesAndPrinters OR control printers Ease of Access Center control /name Microsoft.EaseOfAccessCenter OR control access.cpl File Explorer Options (General tab) control /name Microsoft.FolderOptions OR control folders OR rundll32.exe shell32.dll,Options_RunDLL 0 File Explorer Options (View tab) rundll32.exe shell32.dll,Options_RunDLL 7 File Explorer Options (Search tab) rundll32.exe shell32.dll,Options_RunDLL 2 File History control /name Microsoft.FileHistory Fonts control /name Microsoft.Fonts OR control fonts Game Controllers control /name Microsoft.GameControllers OR control joy.cpl Get Programs control /name Microsoft.GetPrograms OR rundll32.exe shell32.dll,Control_RunDLL appwiz.cpl,,1 HomeGroup control /name Microsoft.HomeGroup Indexing Options control /name Microsoft.IndexingOptions OR rundll32.exe shell32.dll,Control_RunDLL srchadmin.dll Infrared control /name Microsoft.Infrared OR control irprops.cpl OR control /name Microsoft.InfraredOptions Internet Properties (General tab) control /name Microsoft.InternetOptions OR control inetcpl.cpl OR rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,0 Internet Properties (Security tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,1 Internet Properties (Privacy tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,2 Internet Properties (Content tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,3 Internet Properties (Connections tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,4 Internet Properties (Programs tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,5 Internet Properties (Advanced tab) rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,6 iSCSI Initiator control /name Microsoft.iSCSIInitiator Keyboard control /name Microsoft.Keyboard OR control keyboard Language control /name Microsoft.Language Mouse Properties (Buttons tab 0) control /name Microsoft.Mouse OR control main.cpl OR control mouse OR rundll32.exe shell32.dll,Control_RunDLL main.cpl,,0 Mouse Properties (Pointers tab 1) control main.cpl,,1 OR rundll32.exe shell32.dll,Control_RunDLL main.cpl,,1 Mouse Properties (Pointer Options tab 2) control main.cpl,,2 OR rundll32.exe shell32.dll,Control_RunDLL main.cpl,,2 Mouse Properties (Wheel tab 3) control main.cpl,,3 OR rundll32.exe shell32.dll,Control_RunDLL main.cpl,,3 Mouse Properties (Hardware tab 4) control main.cpl,,4 OR rundll32.exe shell32.dll,Control_RunDLL main.cpl,,4 Network and Sharing Center control /name Microsoft.NetworkAndSharingCenter Network Connections control ncpa.cpl OR control netconnections Network Setup Wizard control netsetup.cpl Notification Area Icons explorer shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} ODBC Data Source Administrator control odbccp32.cpl Offline Files control /name Microsoft.OfflineFiles Performance Options (Visual Effects) %windir%\\system32\\SystemPropertiesPerformance.exe Performance Options (Data Execution Prevention) %windir%\\system32\\SystemPropertiesDataExecutionPrevention.exe Personalization explorer shell:::{ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} Phone and Modem control /name Microsoft.PhoneAndModem OR control telephon.cpl Power Options control /name Microsoft.PowerOptions OR control powercfg.cpl Power Options - Advanced settings control powercfg.cpl,,1 Power Options - Create a Power Plan control /name Microsoft.PowerOptions /page pageCreateNewPlan Power Options - Edit Plan Settings control /name Microsoft.PowerOptions /page pagePlanSettings Power Options - System Settings control /name Microsoft.PowerOptions /page pageGlobalSettings Presentation Settings %windir%\\system32\\PresentationSettings.exe Programs and Features control /name Microsoft.ProgramsAndFeatures OR control appwiz.cpl Recovery control /name Microsoft.Recovery Region (Formats tab) control /name Microsoft.RegionAndLanguage OR control /name Microsoft.RegionalAndLanguageOptions /page /p:\"Formats\" OR control intl.cpl OR control international Region (Location tab) control /name Microsoft.RegionalAndLanguageOptions /page /p:\"Location\" Region (Administrative tab) control /name Microsoft.RegionalAndLanguageOptions /page /p:\"Administrative\" RemoteApp and Desktop Connections control /name Microsoft.RemoteAppAndDesktopConnections Scanners and Cameras control /name Microsoft.ScannersAndCameras OR control sticpl.cpl Screen Saver Settings rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,1 Security and Maintenance control /name Microsoft.ActionCenter OR control wscui.cpl Set Associations control /name Microsoft.DefaultPrograms /page pageFileAssoc Set Default Programs control /name Microsoft.DefaultPrograms /page pageDefaultProgram Set Program Access and Computer Defaults rundll32.exe shell32.dll,Control_RunDLL appwiz.cpl,,3 Sound (Playback tab) control /name Microsoft.Sound OR control mmsys.cpl OR %windir%\\System32\\rundll32.exe shell32.dll,Control_RunDLL mmsys.cpl,,0 Sound (Recording tab) %windir%\\System32\\rundll32.exe shell32.dll,Control_RunDLL mmsys.cpl,,1 Sound (Sounds tab) %windir%\\System32\\rundll32.exe shell32.dll,Control_RunDLL mmsys.cpl,,2 Sound (Communications tab) %windir%\\System32\\rundll32.exe shell32.dll,Control_RunDLL mmsys.cpl,,3 Speech Recognition control /name Microsoft.SpeechRecognition Storage Spaces control /name Microsoft.StorageSpaces Sync Center control /name Microsoft.SyncCenter System control /name Microsoft.System OR control sysdm.cpl System Icons explorer shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} \\SystemIcons,,0 System Properties (Computer Name) %windir%\\System32\\SystemPropertiesComputerName.exe System Properties (Hardware) %windir%\\System32\\SystemPropertiesHardware.exe System Properties (Advanced) %windir%\\System32\\SystemPropertiesAdvanced.exe System Properties (System Protection) %windir%\\System32\\SystemPropertiesProtection.exe System Properties (Remote) %windir%\\System32\\SystemPropertiesRemote.exe Tablet PC Settings control /name Microsoft.TabletPCSettings Text to Speech control /name Microsoft.TextToSpeech Troubleshooting explorer shell:::{26EE0668-A00A-44D7-9371-BEB064C98683}\\0\\::{C58C4893-3BE0-4B45-ABB5-A63E4B8C8651} User Accounts control /name Microsoft.UserAccounts OR control userpasswords User Accounts (netplwiz) netplwiz OR control userpasswords2 Windows Defender Firewall control /name Microsoft.WindowsFirewall OR control firewall.cpl Windows Defender Firewall Allowed apps explorer shell:::{4026492F-2F69-46B8-B9BF-5654FC07E423} -Microsoft.WindowsFirewall\\pageConfigureApps Windows Defender Firewall with Advanced Security %WinDir%\\System32\\WF.msc Windows Features %windir%\\System32\\OptionalFeatures.exe OR rundll32.exe shell32.dll,Control_RunDLL appwiz.cpl,,2 Windows Mobility Center control /name Microsoft.MobilityCenter Work Folders %windir%\\System32\\WorkFolders.exe Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/windows/clsid.html":{"url":"cheatsheet/windows/clsid.html","title":"clsid","keywords":"","body":" Usage List reference Usage > explorer.exe shell:::{05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} or > explorer.exe /e,::{CLSID key number} List Opens CLSID key (GUID) Add Network Location {D4480A50-BA28-11d1-8E75-00C04FA31A86} Administrative Tools {D20EA4E1-3957-11d2-A40B-0C5020524153} Applications {4234d49b-0245-4df3-b780-3893943456e1} AutoPlay {9C60DE1E-E5FC-40f4-A487-460851A8D915} BitLocker Drive Encryption {D9EF8727-CAC2-4e60-809E-86F80A666C91} Bluetooth Devices {28803F59-3A75-4058-995F-4EE5503B023C} Color Management {B2C761C6-29BC-4f19-9251-E6195265BAF1} Command Folder {437ff9c0-a07f-4fa0-af80-84b6c6440a16} Common Places FS Folder {d34a6ca6-62c2-4c34-8a7c-14709c1ad938} Control Panel {5399E694-6CE5-4D6C-8FCE-1D8870FDCBA0} Control Panel (All Tasks) {ED7BA470-8E54-465E-825C-99712043E01C} Control Panel (always Category view) {26EE0668-A00A-44D7-9371-BEB064C98683} Control Panel (always Icons view) {21EC2020-3AEA-1069-A2DD-08002B30309D} Credential Manager {1206F5F1-0569-412C-8FEC-3204630DFB70} Date and Time {E2E7934B-DCE5-43C4-9576-7FE4F75E7480} Default Programs {17cd9488-1228-4b2f-88ce-4298e93e0966} delegate folder that appears in Computer {b155bdf8-02f0-451e-9a26-ae317cfd7779} Desktop (folder) {B4BFCC3A-DB2C-424C-B029-7FE99A87C641} Device Manager {74246bfc-4c96-11d0-abef-0020af6b0b7a} Devices and Printers {A8A91A66-3A7D-4424-8D24-04E180695C7A} Display {C555438B-3C23-4769-A71F-B6D3D9B6053A} Documents (folder) {A8CDFF1C-4878-43be-B5FD-F8091C1C60D0} Downloads (folder) {374DE290-123F-4565-9164-39C4925E467B} Ease of Access Center {D555645E-D4F8-4c29-A827-D93C859C4F2A} E-mail (default e-mail program) {2559a1f5-21d7-11d4-bdaf-00c04f60b9f0} Family Safety {96AE8D84-A250-4520-95A5-A47A7E3C548B} Favorites {323CA680-C24D-4099-B94D-446DD2D7249E} File Explorer Options {6DFD7C5C-2451-11d3-A299-00C04F8EF6AF} File History {F6B6E965-E9B2-444B-9286-10C9152EDBC5} Font Settings {93412589-74D4-4E4E-AD0E-E0CB621440FD} Fonts (folder) {BD84B380-8CA2-1069-AB1D-08000948F534} Frequent folders {3936E9E4-D92C-4EEE-A85A-BC16D5EA0819} Games Explorer {ED228FDF-9EA8-4870-83b1-96b02CFE0D52} Get Programs {15eae92e-f17a-4431-9f28-805e482dafd4} Help and Support {2559a1f1-21d7-11d4-bdaf-00c04f60b9f0} HomeGroup (settings) {67CA7650-96E6-4FDD-BB43-A8E774F73A57} HomeGroup (users) {B4FB3F98-C1EA-428d-A78A-D1F5659CBA93} Hyper-V Remote File Browsing {0907616E-F5E6-48D8-9D61-A91C3D28106D} Indexing Options {87D66A43-7B11-4A28-9811-C86EE395ACF7} Infared (if installed) {A0275511-0E86-4ECA-97C2-ECD8F1221D08} Installed Updates {d450a8a1-9568-45c7-9c0e-b4f9fb4537bd} Internet Options (Internet Explorer) {A3DD4F92-658A-410F-84FD-6FBBBEF2FFFE} Keyboard Properties {725BE8F7-668E-4C7B-8F90-46BDB0936430} Language settings {BF782CC9-5A52-4A17-806C-2A894FFEEAC5} Libraries {031E4825-7B94-4dc3-B131-E946B44C8DD5} Location Information (Phone and Modem Control Panel) {40419485-C444-4567-851A-2DD7BFA1684D} Location Settings {E9950154-C418-419e-A90A-20C5287AE24B} Media Servers {289AF617-1CC3-42A6-926C-E6A863F0E3BA} Mouse Properties {6C8EEC18-8D75-41B2-A177-8831D59D2D50} Music (folder) {1CF1260C-4DD0-4ebb-811F-33C572699FDE} My Documents {450D8FBA-AD25-11D0-98A8-0800361B1103} Network {F02C1A0D-BE21-4350-88B0-7367FC96EF3C} Network and Sharing Center {8E908FC9-BECC-40f6-915B-F4CA0E70D03D} Network Connections (in PC settings) {38A98528-6CBF-4CA9-8DC0-B1E1D10F7B1B} Network Connections {7007ACC7-3202-11D1-AAD2-00805FC1270E}OR{992CFFA0-F557-101A-88EC-00DD010CCC48} Network (WorkGroup) {208D2C60-3AEA-1069-A2D7-08002B30309D} Notification Area Icons {05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} NVIDIA Control Panel (if installed) {0bbca823-e77d-419e-9a44-5adec2c8eeb0} Offline Files Folder {AFDB1F70-2A4C-11d2-9039-00C04F8EEB3E} OneDrive {018D5C66-4533-4307-9B53-224DE2ED1FE6} Pen and Touch {F82DF8F7-8B9F-442E-A48C-818EA735FF9B} Personalization {ED834ED6-4B5A-4bfe-8F11-A626DCB6A921} Pictures (folder) {3ADD1653-EB32-4cb0-BBD7-DFA0ABB5ACCA} Portable Devices {35786D3C-B075-49b9-88DD-029876E11C01} Power Options {025A5937-A6BE-4686-A844-36FE4BEC8B6D} Previous Versions Results Folder {f8c2ab3b-17bc-41da-9758-339d7dbf2d88} printhood delegate folder {ed50fc29-b964-48a9-afb3-15ebb9b97f36} Printers {2227A280-3AEA-1069-A2DE-08002B30309D}OR{863aa9fd-42df-457b-8e4d-0de1b8015c60} Programs and Features {7b81be6a-ce2b-4676-a29e-eb907a5126c5} Public (folder) {4336a54d-038b-4685-ab02-99bb52d3fb8b} Quick access {679f85cb-0220-4080-b29b-5540cc05aab6} Recent places {22877a6d-37a1-461a-91b0-dbda5aaebc99} Recovery {9FE63AFD-59CF-4419-9775-ABCC3849F861} Recycle Bin {645FF040-5081-101B-9F08-00AA002F954E} Region and Language {62D8ED13-C9D0-4CE8-A914-47DD628FB1B0} RemoteApp and Desktop Connections {241D7C96-F8BF-4F85-B01F-E2B043341A4B} Remote Printers {863aa9fd-42df-457b-8e4d-0de1b8015c60} Removable Storage Devices {a6482830-08eb-41e2-84c1-73920c2badb9} Results Folder {2965e715-eb66-4719-b53f-1672673bbefa} Run {2559a1f3-21d7-11d4-bdaf-00c04f60b9f0} Search {9343812e-1c37-4a49-a12e-4b2d810d956b} Search Everywhere (modern) {2559a1f8-21d7-11d4-bdaf-00c04f60b9f0} Search Files (modern) {2559a1f0-21d7-11d4-bdaf-00c04f60b9f0} Security and Maintenance {BB64F8A7-BEE7-4E1A-AB8D-7D8273F7FDB6} Set Program Access and Computer Defaults {2559a1f7-21d7-11d4-bdaf-00c04f60b9f0} Show Desktop {3080F90D-D7AD-11D9-BD98-0000947B0257} Sound {F2DDFC82-8F12-4CDD-B7DC-D4FE1425AA4D} Speech Recognition {58E3C745-D971-4081-9034-86E34B30836A} Storage Spaces {F942C606-0914-47AB-BE56-1321B8035096} Sync Center {9C73F5E5-7AE7-4E32-A8E8-8D23B85255BF} Sync Setup Folder {2E9E59C0-B437-4981-A647-9C34B9B90891} System {BB06C0E4-D293-4f75-8A90-CB05B6477EEE} System Icons {05d7b0f4-2121-4eff-bf6b-ed3f69b894d9} \\SystemIcons Tablet PC Settings {80F3F1D5-FECA-45F3-BC32-752C152E456E} Taskbar and Navigation properties {0DF44EAA-FF21-4412-828E-260A8728E7F1} Text to Speech {D17D1D6D-CC3F-4815-8FE3-607E7D5D10B3} This PC {20D04FE0-3AEA-1069-A2D8-08002B30309D} Troubleshooting {C58C4893-3BE0-4B45-ABB5-A63E4B8C8651} User Accounts {60632754-c523-4b62-b45c-4172da012619} User Accounts (netplwiz) {7A9D77BD-5403-11d2-8785-2E0420524153} User Pinned {1f3427c8-5c10-4210-aa03-2ee45287d668} %UserProfile% {59031a47-3f72-44a7-89c5-5595fe6b30ee} Videos (folder) {A0953C92-50DC-43bf-BE83-3742FED03C9C} Web browser (default) {871C5380-42A0-1069-A2EA-08002B30309D} Windows Defender {D8559EB9-20C0-410E-BEDA-7ED416AECC2A} Windows Mobility Center {5ea4f148-308c-46d7-98a9-49041b1dd468} Windows Features {67718415-c450-4f3c-bf8a-b487642dc39b} Windows Firewall {4026492F-2F69-46B8-B9BF-5654FC07E423} Windows To Go {8E0C279D-0BD1-43C3-9EBD-31C3DC5B8A77} Windows Update {36eef7db-88ad-4e81-ad49-0e313f0c35f8} Work Folders {ECDB0924-4208-451E-8EE0-373C0956DE16} reference C:\\Users\\marslo>Netsh netsh>interface In future versions of Windows, Microsoft might remove the Netsh functionality for TCP/IP. Microsoft recommends that you transition to Windows PowerShell if you currently use netsh to configure and manage TCP/IP. Type Get-Command -Module NetTCPIP at the Windows PowerShell prompt to view a list of commands to manage TCP/IP. Visit https://go.microsoft.com/fwlink/?LinkId=217627 for additional information about PowerShell commands for TCP/IP. netsh interface>show helper Helper GUID DLL Filename Command -------------------------------------- ------------ ------- {02BC1F81-D927-4EC5-8CBC-8DD65E3E38E8} AUTHFWCFG.DLL advfirewall {FB10CBCA-5430-46CE-B732-079B4E23BE24} AUTHFWCFG.DLL consec {35342B49-83B4-4FCC-A90D-278533D5BEA2} AUTHFWCFG.DLL firewall {4BD827F7-1E83-462D-B893-F33A80C5DE1D} AUTHFWCFG.DLL mainmode {4D0FEFCB-8C3E-4CDE-B39B-325933727297} AUTHFWCFG.DLL monitor {A31CB05A-1213-4F4E-B420-0EE908B896CB} PEERDISTSH.DLL branchcache {555EA58E-72B1-4F0A-9055-779D0F5400B2} PEERDISTSH.DLL smb {00770721-44EA-11D5-93BA-00B0D022DD1F} HNETMON.DLL bridge {6DC31EC5-3583-4901-9E28-37C28113656A} DHCPCMONITOR.DLL dhcpclient {8A6D23B3-0AF2-4101-BC6E-8114B325FE17} NETIOHLP.DLL dnsclient {8B3A0D7F-1F30-4402-B753-C4B2C7607C97} FWCFG.DLL firewall {44F3288B-DBFF-4B31-A86E-633F50D706B3} NSHHTTP.DLL http {0705ECA1-7AAC-11D2-89DC-006008B0E5B9} IFMON.DLL interface {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL 6to4 {97C192DB-A774-43E6-BE78-1FABD795EEAB} NETIOHLP.DLL httpstunnel {725588AC-7A11-4220-A121-C92C915E8B73} NETIOHLP.DLL ipv4 {500F32FD-7064-476B-8FD6-2171EA46428F} NETIOHLP.DLL ipv6 {90E1CBE1-01D9-4174-BB4D-EB97F3F6150D} NETIOHLP.DLL 6to4 {90E1CBE1-01D9-4174-BB4D-EB97F3F6150D} NETIOHLP.DLL isatap {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL isatap {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL portproxy {78197B47-2BEF-49CA-ACEB-D8816371BAA8} NETIOHLP.DLL tcp {1C151866-F35B-4780-8CD2-E1924E9F03E1} NETIOHLP.DLL teredo {F7E0BC27-BA6E-4145-A123-012F1922F3F1} NSHIPSEC.DLL ipsec {F7E0BC29-BA6E-4145-A123-012F1922F3F1} NSHIPSEC.DLL dynamic {F7E0BC28-BA6E-4145-A123-012F1922F3F1} NSHIPSEC.DLL static {3BB6DA1D-AC0C-4972-AC05-B22F49DEA9B6} NSHWFP.DLL ipsecdosprotection {1D8240C7-48B9-47CC-9E40-4F7A0A390E71} DOT3CFG.DLL lan {B341E8BA-13AA-4E08-8CF1-A6F2D8B0C229} NETIOHLP.DLL namespace {931852E2-597D-40B9-B927-55FFC81A6104} NETIOHLP.DLL netio {0705ECA2-7AAC-11D2-89DC-006008B0E5B9} RASMONTR.DLL ras {42E3CC21-098C-11D3-8C4D-00104BCA495B} RASMONTR.DLL aaaa {90FE6CFC-B6A2-463B-AA12-25E615EC3C66} RASMONTR.DLL diagnostics {13D12A78-D0FB-11D2-9B76-00104BCA495B} RASMONTR.DLL ip {36B3EF76-94C1-460F-BD6F-DF0178D90EAC} RASMONTR.DLL ipv6 {592852F7-5F6F-470B-9097-C5D33B612975} RPCNSH.DLL rpc {C07E293F-9531-4426-8E5C-D7EBBA50F693} RPCNSH.DLL filter {D3E9D893-852F-4E22-B05D-99293065773D} NETTRACE.DLL trace {3BB6DA1D-AC0C-4972-AC05-B22F49DEA9B6} NSHWFP.DLL wfp {0BFDC146-56A3-4311-A7D5-7D9953F8326E} WHHELPER.DLL winhttp {B2C0EEF4-CCE5-4F55-934E-ABF60F3DCF56} WSHELPER.DLL winsock Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/windows/env.html":{"url":"cheatsheet/windows/env.html","title":"env","keywords":"","body":" default Windows Environment Variables List default Windows Environment Variables List Variable Default value assuming the system drive is C: ALLUSERSPROFILE C:\\ProgramData APPDATA C:\\Users\\{username}\\AppData\\Roaming ClientName Terminal servers only - the ComputerName of a remote host. CMDEXTVERSION The current Command Processor Extensions version number. (NT = \"1\", Win2000+ = \"2\".) CMDCMDLINE The original command line that invoked the Command Processor. CommonProgramFiles C:\\Program Files\\Common Files COMMONPROGRAMFILES(x86) C:\\Program Files (x86)\\Common Files COMPUTERNAME {computername} COMSPEC C:\\Windows\\System32\\cmd.exe or if running a 32 bit WOW - C:\\Windows\\SysWOW64\\cmd.exe ERRORLEVEL The current ERRORLEVEL value, automatically set when a program exits. HOMEDRIVE C: HOMEPATH C:\\Users\\{username} LOCALAPPDATA C:\\Users\\{username}\\AppData\\Local LOGONSERVER \\\\{domain_logon_server} NUMBER_OF_PROCESSORS The Number of processors running on the machine. OS Operating system on the user's workstation. System C:\\Windows\\System32\\;C:\\Windows\\;C:\\Windows\\System32\\Wbem;{plus program paths} ProgramData C:\\ProgramData ProgramFiles C:\\Program Files or C:\\Program Files (x86) ProgramFiles(x86) 1 C:\\Program Files (x86) (but only available when running under a 64 bit OS) RANDOM A random integer number, anything from 0 to 32,767 (inclusive). %SessionName% Terminal servers only - for a terminal server session, SessionName is a combination of the connection name, followed by #SessionNumber. For a console session, SessionName returns \"Console\". SYSTEMDRIVE C: SYSTEMROOT By default, Windows is installed to C:\\Windows but there's no guarantee of that, Windows can be installed to a different folder, or a different drive letter. TEMP and TMP C:\\Users\\{Username}\\AppData\\Local\\Temp; Under XP this was C:\\{username}\\Local Settings\\Temp TIME The current time using same format as TIME. USERPROFILE %SystemDrive%\\Users{username}. This is equivalent to the $HOME environment variable in Unix/Linux WINDIR %windir% is a regular User variable and can be changed, which makes it less robust than %SystemRoot%; Set by default as windir=%SystemRoot% Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/windows/shell-folder.html":{"url":"cheatsheet/windows/shell-folder.html","title":"shell:folder","keywords":"","body":" Usage List Usage win + r run> shell:startup List credit belongs to How to Open Hidden System Folders with Windows’ Shell Command Shell Commands to Access the Special Folders in Windows 10/8/7/Vista/XP Shell: folder shortcuts COMMANDS LOCATION shell:AccountPictures %AppData%\\Microsoft\\Windows\\AccountPictures shell:AddNewProgramsFolder Control Panel\\All Control Panel Items\\Get Programs shell:Administrative Tools %AppData%\\Microsoft\\Windows\\Start Menu\\Programs\\Administrative Tools shell:AppData %AppData% shell:Application Shortcuts %LocalAppData%\\Microsoft\\Windows\\Application Shortcuts shell:AppsFolder Applications shell:AppUpdatesFolder Installed Updates shell:Cache %LocalAppData%\\Microsoft\\Windows\\INetCache shell:Camera Roll %UserProfile%\\Pictures\\Camera Roll shell:CD Burning %LocalAppData%\\Microsoft\\Windows\\Burn\\Burn shell:ChangeRemoveProgramsFolder Control Panel\\All Control Panel Items\\Programs and Features shell:Common Administrative Tools %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Administrative Tools shell:Common AppData %ProgramData% shell:Common Desktop %Public%\\Desktop shell:Common Documents %Public%\\Documents shell:CommonDownloads %Public%\\Downloads shell:CommonMusic %Public%\\Music shell:CommonPictures %Public%\\Pictures shell:Common Programs %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs shell:CommonRingtones %ProgramData%\\Microsoft\\Windows\\Ringtones shell:Common Start Menu %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs shell:Common Startup %ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup shell:Common Templates %ProgramData%\\Microsoft\\Windows\\Templates shell:CommonVideo %Public%\\Videos shell:ConflictFolder Control Panel\\All Control Panel Items\\Sync Center\\Conflicts shell:ConnectionsFolder Control Panel\\All Control Panel Items\\Network Connections shell:Contacts %UserProfile%\\Contacts shell:ControlPanelFolder Control Panel\\All Control Panel Items shell:Cookies %LocalAppData%\\Microsoft\\Windows\\INetCookies shell:Cookies\\Low %LocalAppData%\\Microsoft\\Windows\\INetCookies\\Low shell:CredentialManager %AppData%\\Microsoft\\Credentials shell:CryptoKeys %AppData%\\Microsoft\\Crypto shell:desktop Desktop shell:device Metadata Store %ProgramData%\\Microsoft\\Windows\\DeviceMetadataStore shell:documentsLibrary Libraries\\Documents shell:downloads %UserProfile%\\Downloads shell:dpapiKeys %AppData%\\Microsoft\\Protect shell:Favorites %UserProfile%\\Favorites shell:Fonts %WinDir%\\Fonts shell:Games Games shell:GameTasks %LocalAppData%\\Microsoft\\Windows\\GameExplorer shell:History %LocalAppData%\\Microsoft\\Windows\\History shell:HomeGroupCurrentUserFolder Homegroup\\{username} shell:HomeGroupFolder Homegroup shell:ImplicitAppShortcuts %AppData%\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\ImplicitAppShortcuts shell:InternetFolder Internet Explorer shell:Libraries Libraries shell:Links %UserProfile%\\Links shell:Local AppData %LocalAppData% shell:LocalAppDataLow %UserProfile%\\AppData\\LocalLow shell:MusicLibrary Libraries\\Music shell:MyComputerFolder This PC shell:My Music %UserProfile%\\Music shell:My Pictures %UserProfile%\\Pictures shell:My Video %UserProfile%\\Videos shell:NetHood %AppData%\\Microsoft\\Windows\\Network Shortcuts shell:NetworkPlacesFolder Network shell:OneDrive OneDrive shell:OneDriveCameraRoll %UserProfile%\\OneDrive\\Pictures\\Camera Roll shell:OneDriveDocuments %UserProfile%\\OneDrive\\Documents shell:OneDriveMusic %UserProfile%\\OneDrive\\Music shell:OneDrivePictures %UserProfile%\\OneDrive\\Pictures shell:Personal %UserProfile%\\Documents shell:PicturesLibrary Libraries\\Pictures shell:PrintersFolder All Control Panel Items\\Printers shell:PrintHood %AppData%\\Microsoft\\Windows\\Printer Shortcuts shell:Profile %UserProfile% shell:ProgramFiles %ProgramFiles% shell:ProgramFilesCommon %ProgramFiles%\\Common Files shell:ProgramFilesCommonX64 %ProgramFiles%\\Common Files (64 bit Windows only) shell:ProgramFilesCommonX86 %ProgramFiles(x86)%\\Common Files (64 bit Windows only) shell:ProgramFilesX64 %ProgramFiles% (64 bit Windows only) shell:ProgramFilesX86 %ProgramFiles(x86)% (64 bit Windows only) shell:Programs %AppData%\\Microsoft\\Windows\\Start Menu\\Programs shell:Public %Public% shell:PublicAccountPictures %Public%\\AccountPictures shell:PublicGameTasks %ProgramData%\\Microsoft\\Windows\\GameExplorer shell:PublicLibraries %Public%\\Libraries shell:Quick Launch %AppData%\\Microsoft\\Internet Explorer\\Quick Launch shell:Recent %AppData%\\Microsoft\\Windows\\Recent shell:RecordedTVLibrary Libraries\\Recorded TV shell:RecycleBinFolder Recycle Bin shell:ResourceDir %WinDir%\\Resources shell:Ringtones %ProgramData%\\Microsoft\\Windows\\Ringtones shell:Roamed Tile Images %LocalAppData%\\Microsoft\\Windows\\RoamedTileImages shell:Roaming Tiles %AppData%\\Microsoft\\Windows\\RoamingTiles shell:SavedGames %UserProfile%\\Saved Games shell:Screenshots %UserProfile%\\Pictures\\Screenshots shell:Searches %UserProfile%\\Searches shell:SearchHistoryFolder %LocalAppData%\\Microsoft\\Windows\\ConnectedSearch\\History shell:SearchHomeFolder search ms: shell:SearchTemplatesFolder %LocalAppData%\\Microsoft\\Windows\\ConnectedSearch\\Templates shell:SendTo %AppData%\\Microsoft\\Windows\\SendTo shell:Start Menu %AppData%\\Microsoft\\Windows\\Start Menu shell:StartMenuAllPrograms StartMenuAllPrograms shell:Startup %AppData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup shell:SyncCenterFolder Control Panel\\All Control Panel Items\\Sync Center shell:SyncResultsFolder Control Panel\\All Control Panel Items\\Sync Center\\Sync Results shell:SyncSetupFolder Control Panel\\All Control Panel Items\\Sync Center\\Sync Setup shell:System %WinDir%\\System32 shell:SystemCertificates %AppData%\\Microsoft\\SystemCertificates shell:SystemX86 %WinDir%\\SysWOW64 shell:Templates %AppData%\\Microsoft\\Windows\\Templates shell:ThisPCDesktopFolder Desktop shell:UsersFilesFolder %UserProfile% shell:User Pinned %AppData%\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned shell:UserProfiles %HomeDrive%\\Users shell:UserProgramFiles %LocalAppData%\\Programs shell:UserProgramFilesCommon %LocalAppData%\\Programs\\Common shell:UsersLibrariesFolder Libraries shell:VideosLibrary Libraries\\Videos shell:Windows %WinDir% Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/character/character.html":{"url":"cheatsheet/character/character.html","title":"character","keywords":"","body":" charset encryption base64 show align numfmt combinations single line to multiple lines combine every 2 lines combine every 3 lines format output diff comm column get next line by the pattern get lines between 2 patterns awk sed with empty line return first matching pattern return second matching pattern xargs complex commands with xargs multiple move subset of arguments sort all shell script by line number diff every git commit against its parent running multiple commands with xargs read by char find output file name only cat config file in all .git folder exec and sed find and rename find and exclude find && tar inject commands inside find printf trim trim tailing chars remove leading & trailing whitespace search and replace replace with position check line ending remove the ending '\\n' fold check the params valid insert new line write a file without indent space cat and reference: 10 Awk Tips, Tricks and Pitfalls FIND -EXEC VS. FIND | XARGS charset [!NOTE|label:references:] ASCII Table, ISO 1252 Latin-1 Chart & Character Set ASCII Character Chart with Decimal, Binary and Hexadecimal Conversions The difference between \"binary\" and \"text\" files control character HEX NAME ABBREVIATION ESCAPE CODE 0x00 null NUL \\0 ^@ 0x07 bell BEL \\a ^G 0x08 backspace BS \\b ^H 0x09 horizontal tab HT \\t ^I 0x0a line feed LF \\n ^J 0x0b vertical tab VT \\v ^K 0x0c form feed FF \\f ^L 0x0d carriage return CR \\r ^M 0x1a Control-Z SUB - ^Z 0x1b escape ESC \\e ^[ list all charset $ iconv --list convert text-file from utf-8 to iso-8859-1 $ iconv --from-code=UTF-8 --to-code=ISO-8859-1 inputfile.txt > outputfile.txt encryption base64 $ echo \"marslo\" | base64 -w0 bWFyc2xvCg== decryption$ echo \"bWFyc2xvCg==\" | base64 --decode marslo show align [!NOTE|label:see also] iMarslo: padRight # right-align $ printf _\"%10s\"_ \"foobar\" _ foobar_ # left-align $ printf _\"%-10s\"_ \"foobar\" _foobar _ numfmt [!NOTE|label:references:] * iMarslo : math * numfmt - A number reformatting utility numfmt(1) — Linux manual page numfmt - Convert numbers from/to human-readable strings The Numfmt Command Tutorial With Examples For Beginners setup # generic $ npm install numfmt # osx $ brew install coreutils $ brew list coreutils | grep bin /usr/local/Cellar/coreutils/9.4/bin/md5sum /usr/local/Cellar/coreutils/9.4/bin/gsha512sum /usr/local/Cellar/coreutils/9.4/bin/gusers /usr/local/Cellar/coreutils/9.4/bin/gprintenv /usr/local/Cellar/coreutils/9.4/bin/gmknod /usr/local/Cellar/coreutils/9.4/bin/shuf /usr/local/Cellar/coreutils/9.4/bin/gdd /usr/local/Cellar/coreutils/9.4/bin/gtsort /usr/local/Cellar/coreutils/9.4/bin/grealpath /usr/local/Cellar/coreutils/9.4/bin/grmdir /usr/local/Cellar/coreutils/9.4/bin/gfold /usr/local/Cellar/coreutils/9.4/bin/gnl /usr/local/Cellar/coreutils/9.4/bin/greadlink /usr/local/Cellar/coreutils/9.4/bin/gshred /usr/local/Cellar/coreutils/9.4/bin/gmv /usr/local/Cellar/coreutils/9.4/bin/runcon /usr/local/Cellar/coreutils/9.4/bin/gmkdir /usr/local/Cellar/coreutils/9.4/bin/gkill /usr/local/Cellar/coreutils/9.4/bin/guniq /usr/local/Cellar/coreutils/9.4/bin/gpr /usr/local/Cellar/coreutils/9.4/bin/ptx /usr/local/Cellar/coreutils/9.4/bin/ghead /usr/local/Cellar/coreutils/9.4/bin/glink /usr/local/Cellar/coreutils/9.4/bin/gstat /usr/local/Cellar/coreutils/9.4/bin/gmktemp /usr/local/Cellar/coreutils/9.4/bin/gyes /usr/local/Cellar/coreutils/9.4/bin/gsha1sum /usr/local/Cellar/coreutils/9.4/bin/b2sum /usr/local/Cellar/coreutils/9.4/bin/grm /usr/local/Cellar/coreutils/9.4/bin/gsha256sum /usr/local/Cellar/coreutils/9.4/bin/gfalse /usr/local/Cellar/coreutils/9.4/bin/gwho /usr/local/Cellar/coreutils/9.4/bin/gcut /usr/local/Cellar/coreutils/9.4/bin/gvdir /usr/local/Cellar/coreutils/9.4/bin/gdir /usr/local/Cellar/coreutils/9.4/bin/gchmod /usr/local/Cellar/coreutils/9.4/bin/gbase32 /usr/local/Cellar/coreutils/9.4/bin/sha224sum /usr/local/Cellar/coreutils/9.4/bin/ghostid /usr/local/Cellar/coreutils/9.4/bin/gnohup /usr/local/Cellar/coreutils/9.4/bin/gtr /usr/local/Cellar/coreutils/9.4/bin/gdirname /usr/local/Cellar/coreutils/9.4/bin/gsha384sum /usr/local/Cellar/coreutils/9.4/bin/gchroot /usr/local/Cellar/coreutils/9.4/bin/gpaste /usr/local/Cellar/coreutils/9.4/bin/timeout /usr/local/Cellar/coreutils/9.4/bin/tac /usr/local/Cellar/coreutils/9.4/bin/numfmt /usr/local/Cellar/coreutils/9.4/bin/gid /usr/local/Cellar/coreutils/9.4/bin/gpinky /usr/local/Cellar/coreutils/9.4/bin/genv /usr/local/Cellar/coreutils/9.4/bin/basenc /usr/local/Cellar/coreutils/9.4/bin/nproc /usr/local/Cellar/coreutils/9.4/bin/gln /usr/local/Cellar/coreutils/9.4/bin/gbasename /usr/local/Cellar/coreutils/9.4/bin/gtruncate /usr/local/Cellar/coreutils/9.4/bin/stdbuf /usr/local/Cellar/coreutils/9.4/bin/chcon /usr/local/Cellar/coreutils/9.4/bin/gcp /usr/local/Cellar/coreutils/9.4/bin/gls /usr/local/Cellar/coreutils/9.4/bin/factor /usr/local/Cellar/coreutils/9.4/bin/gtrue /usr/local/Cellar/coreutils/9.4/bin/gchown /usr/local/Cellar/coreutils/9.4/bin/gsync /usr/local/Cellar/coreutils/9.4/bin/guptime /usr/local/Cellar/coreutils/9.4/bin/gsum /usr/local/Cellar/coreutils/9.4/bin/gtac /usr/local/Cellar/coreutils/9.4/bin/gexpand /usr/local/Cellar/coreutils/9.4/bin/gruncon /usr/local/Cellar/coreutils/9.4/bin/gpathchk /usr/local/Cellar/coreutils/9.4/bin/gnice /usr/local/Cellar/coreutils/9.4/bin/gecho /usr/local/Cellar/coreutils/9.4/bin/gdu /usr/local/Cellar/coreutils/9.4/bin/gb2sum /usr/local/Cellar/coreutils/9.4/bin/gtouch /usr/local/Cellar/coreutils/9.4/bin/gmkfifo /usr/local/Cellar/coreutils/9.4/bin/gdf /usr/local/Cellar/coreutils/9.4/bin/gjoin /usr/local/Cellar/coreutils/9.4/bin/gtest /usr/local/Cellar/coreutils/9.4/bin/gmd5sum /usr/local/Cellar/coreutils/9.4/bin/gunexpand /usr/local/Cellar/coreutils/9.4/bin/gsort /usr/local/Cellar/coreutils/9.4/bin/gshuf /usr/local/Cellar/coreutils/9.4/bin/gfmt /usr/local/Cellar/coreutils/9.4/bin/gunlink /usr/local/Cellar/coreutils/9.4/bin/gcsplit /usr/local/Cellar/coreutils/9.4/bin/g[ /usr/local/Cellar/coreutils/9.4/bin/gwhoami /usr/local/Cellar/coreutils/9.4/bin/gsplit /usr/local/Cellar/coreutils/9.4/bin/gseq /usr/local/Cellar/coreutils/9.4/bin/sha1sum /usr/local/Cellar/coreutils/9.4/bin/sha256sum /usr/local/Cellar/coreutils/9.4/bin/gdircolors /usr/local/Cellar/coreutils/9.4/bin/ginstall /usr/local/Cellar/coreutils/9.4/bin/gsha224sum /usr/local/Cellar/coreutils/9.4/bin/shred /usr/local/Cellar/coreutils/9.4/bin/sha384sum /usr/local/Cellar/coreutils/9.4/bin/gcomm /usr/local/Cellar/coreutils/9.4/bin/gtty /usr/local/Cellar/coreutils/9.4/bin/gcksum /usr/local/Cellar/coreutils/9.4/bin/gexpr /usr/local/Cellar/coreutils/9.4/bin/gbase64 /usr/local/Cellar/coreutils/9.4/bin/gwc /usr/local/Cellar/coreutils/9.4/bin/gnproc /usr/local/Cellar/coreutils/9.4/bin/base32 /usr/local/Cellar/coreutils/9.4/bin/gptx /usr/local/Cellar/coreutils/9.4/bin/gtimeout /usr/local/Cellar/coreutils/9.4/bin/pinky /usr/local/Cellar/coreutils/9.4/bin/hostid /usr/local/Cellar/coreutils/9.4/bin/gpwd /usr/local/Cellar/coreutils/9.4/bin/gtail /usr/local/Cellar/coreutils/9.4/bin/gchcon /usr/local/Cellar/coreutils/9.4/bin/glogname /usr/local/Cellar/coreutils/9.4/bin/guname /usr/local/Cellar/coreutils/9.4/bin/gtee /usr/local/Cellar/coreutils/9.4/bin/gstty /usr/local/Cellar/coreutils/9.4/bin/gchgrp /usr/local/Cellar/coreutils/9.4/bin/gcat /usr/local/Cellar/coreutils/9.4/bin/ggroups /usr/local/Cellar/coreutils/9.4/bin/gsleep /usr/local/Cellar/coreutils/9.4/bin/sha512sum /usr/local/Cellar/coreutils/9.4/bin/gfactor /usr/local/Cellar/coreutils/9.4/bin/god /usr/local/Cellar/coreutils/9.4/bin/gprintf /usr/local/Cellar/coreutils/9.4/bin/gstdbuf /usr/local/Cellar/coreutils/9.4/bin/gnumfmt /usr/local/Cellar/coreutils/9.4/bin/gbasenc /usr/local/Cellar/coreutils/9.4/bin/gdate /usr/local/Cellar/coreutils/9.4/libexec/gnubin/tee /usr/local/Cellar/coreutils/9.4/libexec/gnubin/md5sum /usr/local/Cellar/coreutils/9.4/libexec/gnubin/split /usr/local/Cellar/coreutils/9.4/libexec/gnubin/cat /usr/local/Cellar/coreutils/9.4/libexec/gnubin/shuf /usr/local/Cellar/coreutils/9.4/libexec/gnubin/mkfifo /usr/local/Cellar/coreutils/9.4/libexec/gnubin/pathchk /usr/local/Cellar/coreutils/9.4/libexec/gnubin/runcon /usr/local/Cellar/coreutils/9.4/libexec/gnubin/expand /usr/local/Cellar/coreutils/9.4/libexec/gnubin/tty /usr/local/Cellar/coreutils/9.4/libexec/gnubin/basename /usr/local/Cellar/coreutils/9.4/libexec/gnubin/install /usr/local/Cellar/coreutils/9.4/libexec/gnubin/nice /usr/local/Cellar/coreutils/9.4/libexec/gnubin/truncate /usr/local/Cellar/coreutils/9.4/libexec/gnubin/echo /usr/local/Cellar/coreutils/9.4/libexec/gnubin/du /usr/local/Cellar/coreutils/9.4/libexec/gnubin/ptx /usr/local/Cellar/coreutils/9.4/libexec/gnubin/join /usr/local/Cellar/coreutils/9.4/libexec/gnubin/df /usr/local/Cellar/coreutils/9.4/libexec/gnubin/pwd /usr/local/Cellar/coreutils/9.4/libexec/gnubin/test /usr/local/Cellar/coreutils/9.4/libexec/gnubin/csplit /usr/local/Cellar/coreutils/9.4/libexec/gnubin/sort /usr/local/Cellar/coreutils/9.4/libexec/gnubin/whoami /usr/local/Cellar/coreutils/9.4/libexec/gnubin/touch /usr/local/Cellar/coreutils/9.4/libexec/gnubin/unlink /usr/local/Cellar/coreutils/9.4/libexec/gnubin/b2sum /usr/local/Cellar/coreutils/9.4/libexec/gnubin/sleep /usr/local/Cellar/coreutils/9.4/libexec/gnubin/fmt /usr/local/Cellar/coreutils/9.4/libexec/gnubin/stty /usr/local/Cellar/coreutils/9.4/libexec/gnubin/logname /usr/local/Cellar/coreutils/9.4/libexec/gnubin/chgrp /usr/local/Cellar/coreutils/9.4/libexec/gnubin/printenv /usr/local/Cellar/coreutils/9.4/libexec/gnubin/seq /usr/local/Cellar/coreutils/9.4/libexec/gnubin/uname /usr/local/Cellar/coreutils/9.4/libexec/gnubin/sha224sum /usr/local/Cellar/coreutils/9.4/libexec/gnubin/od /usr/local/Cellar/coreutils/9.4/libexec/gnubin/date /usr/local/Cellar/coreutils/9.4/libexec/gnubin/base64 /usr/local/Cellar/coreutils/9.4/libexec/gnubin/realpath /usr/local/Cellar/coreutils/9.4/libexec/gnubin/readlink /usr/local/Cellar/coreutils/9.4/libexec/gnubin/dircolors /usr/local/Cellar/coreutils/9.4/libexec/gnubin/timeout /usr/local/Cellar/coreutils/9.4/libexec/gnubin/tac /usr/local/Cellar/coreutils/9.4/libexec/gnubin/numfmt /usr/local/Cellar/coreutils/9.4/libexec/gnubin/wc /usr/local/Cellar/coreutils/9.4/libexec/gnubin/basenc /usr/local/Cellar/coreutils/9.4/libexec/gnubin/comm /usr/local/Cellar/coreutils/9.4/libexec/gnubin/nproc /usr/local/Cellar/coreutils/9.4/libexec/gnubin/expr /usr/local/Cellar/coreutils/9.4/libexec/gnubin/stdbuf /usr/local/Cellar/coreutils/9.4/libexec/gnubin/cksum /usr/local/Cellar/coreutils/9.4/libexec/gnubin/printf /usr/local/Cellar/coreutils/9.4/libexec/gnubin/groups /usr/local/Cellar/coreutils/9.4/libexec/gnubin/chcon /usr/local/Cellar/coreutils/9.4/libexec/gnubin/factor /usr/local/Cellar/coreutils/9.4/libexec/gnubin/tail /usr/local/Cellar/coreutils/9.4/libexec/gnubin/env /usr/local/Cellar/coreutils/9.4/libexec/gnubin/pr /usr/local/Cellar/coreutils/9.4/libexec/gnubin/head /usr/local/Cellar/coreutils/9.4/libexec/gnubin/kill /usr/local/Cellar/coreutils/9.4/libexec/gnubin/uniq /usr/local/Cellar/coreutils/9.4/libexec/gnubin/stat /usr/local/Cellar/coreutils/9.4/libexec/gnubin/link /usr/local/Cellar/coreutils/9.4/libexec/gnubin/sum /usr/local/Cellar/coreutils/9.4/libexec/gnubin/tsort /usr/local/Cellar/coreutils/9.4/libexec/gnubin/mknod /usr/local/Cellar/coreutils/9.4/libexec/gnubin/users /usr/local/Cellar/coreutils/9.4/libexec/gnubin/dd /usr/local/Cellar/coreutils/9.4/libexec/gnubin/who /usr/local/Cellar/coreutils/9.4/libexec/gnubin/sha1sum /usr/local/Cellar/coreutils/9.4/libexec/gnubin/mktemp /usr/local/Cellar/coreutils/9.4/libexec/gnubin/cut /usr/local/Cellar/coreutils/9.4/libexec/gnubin/sha256sum /usr/local/Cellar/coreutils/9.4/libexec/gnubin/dir /usr/local/Cellar/coreutils/9.4/libexec/gnubin/mkdir /usr/local/Cellar/coreutils/9.4/libexec/gnubin/nl /usr/local/Cellar/coreutils/9.4/libexec/gnubin/shred /usr/local/Cellar/coreutils/9.4/libexec/gnubin/fold /usr/local/Cellar/coreutils/9.4/libexec/gnubin/rmdir /usr/local/Cellar/coreutils/9.4/libexec/gnubin/sha384sum /usr/local/Cellar/coreutils/9.4/libexec/gnubin/mv /usr/local/Cellar/coreutils/9.4/libexec/gnubin/dirname /usr/local/Cellar/coreutils/9.4/libexec/gnubin/id /usr/local/Cellar/coreutils/9.4/libexec/gnubin/base32 /usr/local/Cellar/coreutils/9.4/libexec/gnubin/pinky /usr/local/Cellar/coreutils/9.4/libexec/gnubin/ln /usr/local/Cellar/coreutils/9.4/libexec/gnubin/hostid /usr/local/Cellar/coreutils/9.4/libexec/gnubin/chroot /usr/local/Cellar/coreutils/9.4/libexec/gnubin/ls /usr/local/Cellar/coreutils/9.4/libexec/gnubin/true /usr/local/Cellar/coreutils/9.4/libexec/gnubin/cp /usr/local/Cellar/coreutils/9.4/libexec/gnubin/sync /usr/local/Cellar/coreutils/9.4/libexec/gnubin/yes /usr/local/Cellar/coreutils/9.4/libexec/gnubin/unexpand /usr/local/Cellar/coreutils/9.4/libexec/gnubin/chown /usr/local/Cellar/coreutils/9.4/libexec/gnubin/chmod /usr/local/Cellar/coreutils/9.4/libexec/gnubin/uptime /usr/local/Cellar/coreutils/9.4/libexec/gnubin/rm /usr/local/Cellar/coreutils/9.4/libexec/gnubin/vdir /usr/local/Cellar/coreutils/9.4/libexec/gnubin/false /usr/local/Cellar/coreutils/9.4/libexec/gnubin/sha512sum /usr/local/Cellar/coreutils/9.4/libexec/gnubin/[ /usr/local/Cellar/coreutils/9.4/libexec/gnubin/tr /usr/local/Cellar/coreutils/9.4/libexec/gnubin/paste /usr/local/Cellar/coreutils/9.4/libexec/gnubin/nohup usage $ bc -l convert format $ echo 1G | numfmt --from=si 1000000000 $ echo 1G | numfmt --from=iec 1073741824 $ echo 500G | numfmt --from=si --to=iec 466G $ numfmt --field=2 --from-unit=1024 --to=iec-i --suffix B 'numfmt --header --field=2 --to=iec-i --round=nearest LC_ALL=en_US numfmt --header --field=3 --group --invalid=ignore --padding=16 | > pr -TW$COLUMNS' $ for method in up down nearest; do > echo $method > numfmt --to=iec --round=$method 4095 4096 4097 > done | paste - - - - up 4.0K 4.0K 4.1K down 3.9K 4.0K 4.0K nearest 4.0K 4.0K 4.0K padding $ du -s * | numfmt --to=si --padding=10 12 awk.md 40 character.md 4 html.md 16 json.md 8 markdown.md 4 regex.md 16 sed.md $ du -s * | numfmt --to=si --padding=-10 12 awk.md 40 character.md 4 html.md 16 json.md 8 markdown.md 4 regex.md 16 sed.md field $ ls -l total 100 -rw-r--r-- 1 marslo staff 9720 Sep 7 00:37 awk.md -rw-r--r-- 1 marslo staff 40500 Sep 7 00:51 character.md $ ls -l | numfmt --field 5 --to=si total 100 -rw-r--r-- 1 marslo staff 9.8K Sep 7 00:37 awk.md -rw-r--r-- 1 marslo staff 41K Sep 7 00:51 character.md $ df -B1 | head -3 Filesystem 1B-blocks Used Available Use% Mounted on devtmpfs 540881096704 0 540881096704 0% /dev tmpfs 540899667968 258048 540899409920 1% /dev/shm $ df -B1 | head -3 | numfmt --header --field 2-4 --to=si Filesystem 1B-blocks Used Available Use% Mounted on devtmpfs 541G 0 541G 0% /dev tmpfs 541G 259K 541G 1% /dev/shm combinations single line to multiple lines [!TIP] $ echo 'a b c' a b c xargs -n $ echo 'a b c' | xargs -n1 a b c $ echo {a..c}.{1..2} | xargs -n1 | xargs -I{} echo -{}- -a.1- -a.2- -b.1- -b.2- -c.1- -c.2- fmt $ echo 'a b c' | fmt -1 a b c $ echo {a..c}.{1..2} | fmt -1 | xargs -I{} echo -{}- -a.1- -a.2- -b.1- -b.2- -c.1- -c.2- awk $ echo 'a b c' | awk '{ OFS=RS; $1=$1 }1' a b c tr $ echo 'a b c' | tr -s ' ' '\\n' a b c printf $ printf '%s\\n' a b c a b c execute commands from file create files [!TIP] precondition $ cat a.txt a b c $ echo 'a b c' | xargs -n1 -t touch touch a touch b touch c $ echo 'a b c' | xargs -n1 -p touch touch a?...y touch b?...y touch c?...y -t, --verbose Print the command line on the standard error output before executing it. -p, --interactive Prompt the user about whether to run each command line and read a line from the terminal. Only run the command line if the response starts with `y' or `Y'. Implies -t. -I replace-str Replace occurrences of replace-str in the initial-arguments with names read from standard in- put. Also, unquoted blanks do not terminate input items; instead the separator is the new- line character. Implies -x and -L 1. combine every 2 lines [!NOTE|label:references:] How to merge every two lines into one from the command line? Automatic documentation of gitconfig aliases using sed or awk sample output $ echo -e \"1\\na\\n2\\nb\\n3\\nc 1 a 2 b 3 c also using for sed output : $ git --no-pager log -3 --no-color | sed -nr 's!^commit\\s*(.+)$!\\1!p; s!^\\s*Change-Id:\\s*(.*$)!\\1!p' d9a9adfb591bb129d6b1af9532fea0fcf069b176 I5d99e9ccd4edbba608e7da70e575fd6bd091ce42 7aed870eeb203336e5e29b03714905f28ec3e60d Ie3b4d5fd09a43385a44282a2e6961e220ae6293a 09a652f7c78f416da7a561451ed274f930c27dec I244d2fec5d25e453fd30d08d1c75c16143b7f7a3 xargs $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | xargs -n2 -d'\\n' 1 a 2 b 3 c paste $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | paste -s -d',\\n' 1,a 2,b 3,c $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | paste -d \" \" - - 1 a 2 b 3 c sed $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | sed 'N;s/\\n/ : /' 1 : a 2 : b 3 : c awk $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | awk '{ key=$0; getline; print key \" : \" $0; }' 1 : a 2 : b 3 : c # or $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | awk 'ORS=NR%2?FS:RS' 1 a 2 b 3 c # or $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | awk 'NR%2{ printf \"%s : \",$0;next; }1' 1 : a 2 : b 3 : c # or $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | awk '{ if ( NR%2 != 0 ) line=$0; else { printf(\"%s : %s\\n\", line, $0); line=\"\"; } } END { if ( length(line) ) print line; }' 1 : a 2 : b 3 : c while $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | while read line1; do read line2; echo \"$line1 : $line2\"; done 1 : a 2 : b 3 : c combine every 3 lines paste # or every 3 lines $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | paste -d ' ' - - - 1 a 2 b 3 c awk $ echo -e \"1\\na\\n2\\nb\\n3\\nc\" | awk 'NR%3{ printf \"%s : \",$0;next; }1' 1 : a : 2 b : 3 : c xargs $ echo {1..9} | fmt -1 | xargs -n3 1 2 3 4 5 6 7 8 9 format output [!TIP|label:sample data] $ paste display two files side by side by pr display two files side by side by paste Displaying Files Side by Side in Linux Print two files in two columns side-by-side 11.4. Side-by-Side diffs: sdiff diff [!NOTE|label:references:] Linux diff command * GNU Diffutils * Comparing and Merging Files 13.1 Options to diff Diff and \"--GTYPE-group-format\" diff - output line-numbers show all status $ diff --side-by-side c d d f | e show diff only $ diff --suppress-common-lines --side-by-side c f | e show diff with ---group-format VARIABLE APPLICABLE old GTYPE, LTYPE new GTYPE, LTYPE unchanged GTYPE, LTYPE changed GTYPE [!NOTE|label:tips:] line format: [G]TYPE : [g]roup : ---group-format group format [L]TYPE : [l]ine : ---line-format $ diff --old-group-format=\"L %\" --unchanged-group-format=\"\" a.txt b.txt R c L f R e # with line number $ diff --unchanged-line-format=\"\" --old-line-format=\" %dn: %L\" 3: c 5: e # beging-end $ diff --old-group-format='\\begin{em} -> % ' --new-group-format='\\begin{bf} -> %>\\end{bf} -> ' --changed-group-format='\\begin{em} -> % \\begin{bf} -> %>\\end{bf} -> ' --unchanged-group-format='%=' \\ -> --unchanged-group-format='' \\ -> --old-group-format='-------- %dn line%(n=1?:s) deleted at %df: % --new-group-format='-------- %dN line%(N=1?:s) added after %de: %>' \\ -> --changed-group-format='-------- %dn line%(n=1?:s) changed at %df: %' \\ -> show common $ diff --unchanged-line-format=\"%L\" --new-line-format=\"\" --old-line-format=\"\" create patch [!NOTE|label:references:] Is this a good way to create a patch?$ diff -Naru file_original file_updated > file.patch $ diff -c c 4c5 e comm diff $ comm -3 a.txt b.txt c e f $ comm -3 common $ comm -12 column [!NOTE|label:references:] How do I center-align a column in UNIX? Set alignment of numeric columns when columnating data $ ( printf \"PERM LINKS OWNER GROUP SIZE MONTH DAY HH:MM/YEAR NAME\\n\"; ls -l | sed 1d ) | column -t PERM LINKS OWNER GROUP SIZE MONTH DAY HH:MM/YEAR NAME -rw-r--r-- 1 marslo staff 8 Sep 12 20:10 a.txt -rw-r--r-- 1 marslo staff 10 Sep 12 19:34 b.txt $ paste with header$ paste get next line by the pattern $ cat a.txt 1a 2b 3c * (2 lines after `^3c$`) 4d 5e 6f 7g awk $ cat a.txt | awk '$0==\"3c\"{getline; print; getline; print}' 4d 5e $ cat a.txt | awk '/3c/{getline; print; getline; print}' 4d 5e or $ cat a.txt | awk '/^3c$/ {s=NR;next} s && NR or $ cat a.txt | awk '{if(a-->0){print;next}} /3c/{a=2}' 4d 5e or get second column of next line of pattern $ awk '/my.company.com$/{getline; print}' ~/.marslo/.netrc login marslo $ awk '/my.company.com$/{getline; print $2}' ~/.marslo/.netrc marslo sed $ cat a.txt | sed -n '/3c/{n;p;n;p}' 4d 5e $ cat a.txt | sed -n '/3c/{N;p;n;p}' 3c 4d 5e get lines between 2 patterns [!NOTE|label:reference:] How to print lines between two patterns, inclusive or exclusive (in sed, AWK or Perl)? Print lines between PAT1 and PAT2 How to select lines between two marker patterns which may occur multiple times with awk/sed Print lines between (and excluding) two patterns see also * imarslo : get first matching patten ( for CERTIFICATE ) [!TIP] sample data: $ cat a.txt 1a 2b 3c * (start) 4d 5e 6f 7g 8h * (end) 9i 10j 11k awk include pattern$ cat a.txt | awk '/3c/,/8h/' 3c 4d 5e 6f 7g 8h sed include all patterns $ cat a.txt | sed -n '/3c/,/8h/p' 3c 4d 5e 6f 7g 8h exclude both patterns $ sed -n '/3c/,/8h/{//!p;}' a.txt 4d 5e 6f 7g $ sed -n '/3c/,/8h/{/3c/!{/8h/!p}}' a.txt 4d 5e 6f 7g $ cat a.txt | sed '1,/3c/d;/8h/,$d' 4d 5e 6f 7g $ cat a.txt | sed '/3c/,/8h/!d;//d' 4d 5e 6f 7g exclude single pattern $ sed -n '/3c/,/8h/{/8h/!p}' a.txt 3c 4d 5e 6f 7g $ sed -n '/3c/,/8h/{/3c/!p}' a.txt 4d 5e 6f 7g 8h with empty line [!NOTE] use case : * imarslo : show top summary $ cat a.txt 1a 2b 3c * (start) 4d 5e 6f * (ending) 7g 8h 9i 10j 11k $ cat a.txt | sed -n '/3c/,/^$/p' 3c 4d 5e 6f return first matching pattern references: How to select first occurrence between two patterns including them [!TIP] $ cat sample.crt -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- -----BEGIN CERTIFICATE----- second paragraph -----END CERTIFICATE----- sed $ cat sample.crt | sed '/-END CERTIFICATE-/q' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- # or `-n /../p` # `-n` `p` # | | # v v $ cat sample.crt | sed -n '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p; /-END CERTIFICATE-/q' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- # or `/../!d` # no `-n` `!d` # | | # v v $ cat sample.crt | sed '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/!d; /-END CERTIFICATE-/q' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- awk $ cat sample.crt | awk '/-BEGIN CERTIFICATE-/{a=1}; a; /-END CERTIFICATE-/{exit}' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- # or $ cat sample.crt | awk '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/ {print} /-END CERTIFICATE-/ {exit}' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- # or $ cat sample.crt | awk '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/ {print;f=1} f&&/-END CERTIFICATE-/ {exit}' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- # or $ cat sample.crt | awk '/-BEGIN CERTIFICATE-/ {f=1} /-END CERTIFICATE-/ {f=0;print;exit} f' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- return second matching pattern references: Copying second occurrence pattern to a new file in sed [!TIP] $ cat sample.crt -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- -----BEGIN CERTIFICATE----- second paragraph -----END CERTIFICATE----- $ cat sample.crt | awk '/-BEGIN CERTIFICATE-/ && c++, /-END CERTIFICATE-/' -----BEGIN CERTIFICATE----- second paragraph -----END CERTIFICATE----- xargs references: xargs running multiple commands with xargs Xargs Command in Linux How to Use the Linux xargs Command xargs - Construct an argument list and run a command tips: --delimiter=delim, -d delim -I{} == -i -n max-args, --max-args=max-args -t, --verbose complex commands with xargs [!NOTE|label:references:] using xargs with output piped to awk throws syntax error How to use xarg (or awk or sed) to run each line of screen output as a command exactly as displayed? $ echo ip1 ip2 ip3 ... | fmt -1 | xargs -i printf 'echo -e \"\\\\n..... {} .....\"; /sbin/ping -t1 -c1 -W0 {} | sed \"/^$/d\"\\n' | xargs -d\\\\n -n1 bash -c # so xargs will execute : `echo -e \"\\n..... {} .....\"; /sbin/ping -t1 -c1 -W0 {} | sed \"/^$/d\"` one by one or using $@$ echo ip1 ip2 ip3 ... | fmt -1 | xargs -n1 bash -c 'echo -e \"\\n...... $@ ......\"; /sbin/ping -t1 -c1 -W0 \"$@\" | sed '/^$/d'' _ multiple move $ mkdir ~/backups $ find /path -type f -name '*~' -print0 | xargs -0 -I % cp -a % ~/backups # multiple cp $ find /path -type f -name '*~' -print0 | xargs -0 sh -c 'if [ $# -gt 0 ]; then cp -a \"$@\" ~/backup; fi' sh subset of arguments $ echo {0..9} | xargs -n 2 0 1 2 3 4 5 6 7 8 9 sort all shell script by line number [!TIP] Pipe xargs into find $ find . -name \"*.sh\" | xargs wc -l | sort -hr diff every git commit against its parent $ git log --format=\"%H %P\" | xargs -L 1 git diff running multiple commands with xargs [!TIP] precondition: $ cat a.txt a b c 123 ###this is a comment $ myCommandWithDifferentQuotes=$(cat echo \"command 1: $@\"; echo 'will you do the fandango?'; echo \"command 2: $@\"; echo -> EOF -> ) $ or $ cat a.txt | xargs -I @@ bash -c \"$myCommandWithDifferentQuotes\" -- @@ or $ while read stuff; do echo \"command 1: $stuff\"; echo 'will you do the fandango?'; echo \"command 2: $stuff\"; echo done compress sub-folders $ find . -maxdepth 1 ! -path . -type d -print0 | xargs -0 -I @@ bash -c '{ \\ tar caf \"@@.tar.lzop\" \"@@\" \\ && echo Completed compressing directory \"@@\" ; \\ }' ping multiple IPs [!TIP] -a file, --arg-file=file Read items from file instead of standard input. If you use this option, stdin remains unchanged when commands are run. Otherwise, stdin is redirected from /dev/null. $ cat a.txt 8.8.8.8 1.1.1.1 $ xargs -L1 -a a.txt /sbin/ping -c 1 PING 8.8.8.8 (8.8.8.8): 56 data bytes 64 bytes from 8.8.8.8: icmp_seq=0 ttl=44 time=82.868 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 packets received, 0.0% packet loss round-trip min/avg/max/stddev = 82.868/82.868/82.868/0.000 ms PING 1.1.1.1 (1.1.1.1): 56 data bytes 64 bytes from 1.1.1.1: icmp_seq=0 ttl=63 time=1.016 ms --- 1.1.1.1 ping statistics --- 1 packets transmitted, 1 packets received, 0.0% packet loss round-trip min/avg/max/stddev = 1.016/1.016/1.016/0.000 ms or$ echo domain-{1..4}.com | fmt -1 | xargs -L1 ping -c1 -t1 -W0 read by char $ printf 'mark spitz' | while read -r -n1 c; do printf \"[%c]\" \"$c\"; done [m][a][r][k][][s][p][i][t][z] find [!NOTE|label:reference:] Everything CLI: FIND -EXEC VS. FIND | XARGS How to get only names from find command without path output file name only # has `./` by default $ find . -type f ./cfssl-scan ./cfssl-certinfo ./cfssl-bundle ./cfssl ./cfssl-newkey ./multirootca ./mkbundle ./cfssljson # to show filename only by `-exec basename` $ find . -type f -exec basename {} -print \\; cfssl-scan cfssl-certinfo cfssl-bundle cfssl cfssl-newkey multirootca mkbundle cfssljson # or $ find . -type f -execdir basename {} ';' cfssl-scan cfssl-certinfo cfssl-bundle cfssl cfssl-newkey multirootca mkbundle cfssljson cat config file in all .git folder xargs && cat $ find . -type d -name '.git' -print0 | xargs -0 -I {} cat {}/config find && -exec $ find . -type d -name '.git' -exec cat {}/config \\; exec and sed change bunches IP address$ find ${JENKINS_HOME}/jobs \\ -type f \\ -name \"config.xml\" \\ -maxdepth 2 \\ -exec sed -i 's/1.2.3./4.5.6./g' {} \\; -print find and rename $ find -iname \"*.sh\" -exec rename \"s/.sh$/.shell/\" {} \\; -print find and exclude $ find . -regextype posix-egrep -regex \".*\\.(js|vue|s?css|php|html|json)$\" -and -not -regex \".*/(node_modules|vendor)/.*\" or$ find . -regex-type posix-extended -regex \".*def/incoming.*|.*456/incoming.*\" -prune -o -print find && tar [!TIP] more can be found in imarslo: find and tar backup all config.xml in JENKINS_HOME $ find ${JENKINS_HOME}/jobs -maxdepth 2 -name config\\.xml -type f -print | tar czf ~/config.xml.tar.gz --files-from - back build history $ find ${JENKINS_HOME}/jobs -name builds -prune -o -type f -print | tar czf ~/m.tar.gz --files-from - inject commands inside find [!NOTE|label:references:] Find functions, commands, and builtins [duplicate] find -exec bash -c ' print_echo() { printf \"This is print_echo Function: %s\\n\" \"$@\" } print_echo \"$@\" ' find-bash {} + printf [!NOTE|label:references:] How to Use find -printf in Linux? time formats [!NOTE|label:references:] printf time formatsfind . -printf \"%T\\n\" @: unix epoch a | A : abbreviated | full weekday ( Wed | Wednesday ) b/h | B : abbreviated | full month name ( Aug | August ) m : month : 01..12 d : day of month : 01..31 w : day of week 01: Monday 02: Tuesday j: day of year : 001..366 U : week number of the year Sunday as first day of week: 00..53 W : week number of the year Monday as first day of week: 00..53 y | Y : last two digits of year | year : 00..99 | 1970.. r : time in 12-hour format : hh:mm:ss [AP]M $ find . -type f -printf \"\\n%Td-%Tm-%TY %Tr %p\" | head -1 4-10-2023 02:38:42 AM /Users/marslo/.marslo/.marslorc T : time in 24-hour format : hh:mm:ss.xxxxxxxxxx $ find . -type f -printf \"\\n%Td-%Tm-%TY %TT %p\" | head -1 14-10-2023 02:38:42.5626405780 /Users/marslo/.marslo/.marslorc X : locale time : hh:mm:ss.xxxxxxxxxx c : locale time in ctime format $ find . -type f -printf \"\\n%Tc %p\" | head -1 Sat Oct 14 02:38:42 2023 /Users/marslo/.marslo/.marslorc D : date : mm/dd/yy F : date : yyyy-mm-dd x : locale date : mm/dd/yy R : hour and minute in 24 hour format : HH:MM + : date and time $ find . -printf \"%T+ | %p\\n\" | head -1 2023-10-14+02:38:42.5626405780 | /Users/marslo/.marslo/.marslor Formatting Tips center-align$ find . -printf \"%15TA | %p\\n\" Monday | /Users/marslo/.marslo/bin/iweather Saturday | /Users/marslo/.marslo/.marslorc left-align $ find . -printf \"%-15TA | %p\\n\" Monday | /Users/marslo/.marslo/bin/iweather Saturday | /Users/marslo/.marslo/.marslorc mixed align $ find . -type f -printf \"%10T+ %-10TA | %m | %p\\n\" | sort -r | head -2 2023-10-16+20:25:53.5005192040 Monday | 755 | /Users/marslo/.marslo/bin/iweather 2023-10-14+02:38:42.5626405780 Saturday | 755 | /Users/marslo/.marslo/.marslorc # more find . -type d -printf \"%d %-30p %-10u %-10g %-5m %T+\\n\" | sort trim trim tailing chars str='1234567890' awk + rev $ echo $str | rev | cut -c4- | rev 1234567 ${var:: -x}) $ echo ${str:: -3} 1234567 remove leading & trailing whitespace $ str=\" aaaa bbbb \" $ echo \"$str\" | sed 's:^ *::; s: *$::' # i.e.: $ echo .$(echo \"$str\" | sed 's:^ *::; s: *$::'). .aaaa bbbb. remove all spaces $ echo .${str// }. .aaaabbbb. remove leading space(s) $ echo .${str##+([[:space:]])}. .aaaa bbbb . remove leading space(s) $ echo .${str%%+([[:space:]])}. . aaaa bbbb. function in pip function trim() { IFS='' read -r str; echo \"${str}\" | sed -e 's/^[[:blank:]]*//;s/[[:blank:]]*$//'; } $ echo ..$(echo \" aaa bbb \" | trim).. ..aaa bbb.. search and replace [!NOTE|label:reference] shellcheck SC2001 sample code: str='aa bb cc' ${variable//search/replace} $ shopt -s extglob $ echo ${str//+( )/|} aa|bb|cc or $ echo \"${str//+([[:blank:]])/|}\" aa|bb|cc sed # DO NOT USE \"${str}\" $ echo ${str} | sed 's: :|:g' aa|bb|cc or $ echo \"$str\" | sed 's:[ ][ ]*:|:g' aa|bb|cc # or $ echo \"$str\" | sed 's:\\s\\s*:|:g' aa|bb|cc echo \"${string:0:$(( position - 1 ))}${replacement}${string:position}\" # or $ sed 's:\\s\\s*:|:g' tr $ echo \"$str\" | tr -s ' ' '|' aa|bb|cc replace with position $ string=aaaaa $ replacement=b $ position=3 $ echo \"${string:0:$(( position - 1 ))}${replacement}${string:position}\" aabaa or$ echo \"${string:0:position-1}${replacement}${string:position}\" aabaa check line ending [!NOTE|label:references:] check ascii via terminal $ man ascii $ cat /usr/share/misc/ascii How Hexdump works ASCII Table ASCII/Binary of 0x0a Newline OS CHARACTER ENCODING ABBREVIATION HEX DEC ESCAPE SEQUENCE UNIX or Unix-like ASCII LF 0A 10 \\n MS-DOS ASCII CR LF 0D 0A 13 10 \\r\\n Commodore 8-bit machines ASCII CR 0D 13 \\r QNX pre-POSIX ASCII RS 1E 30 \\036 Acorn BBC and RISC OS ASCII LF CR 0A 0D 10 13 \\n\\r Atari 8-bit machines ATASCII - 9B 155 - IBM mainframe systems EBCDIC NL 15 21 \\025 ZX80 and ZX81 non-ASCII NEWLINE 76 118 - od -c $ echo 'abc' | od -c 0000000 a b c \\n 0000004 $ echo -n 'abc' | od -c 0000000 a b c 0000003 hexdump -c $ echo 'abc' | hexdump -c 0000000 a b c \\n 0000004 $ echo -n 'abc' | hexdump -c 0000000 a b c 0000003 hexdump -C $ echo 'abc' | hexdump -C 00000000 61 62 63 0a |abc.| 00000004 # ^ # | # 0x0a: LF $ echo -n 'abc' | hexdump -C 00000000 61 62 63 |abc| 00000003 $ cat a.txt | hexdump -C # 0x0a # v 00000000 61 61 61 61 0a |aaaa.| 00000005 $ unix2dos a.txt unix2dos: converting file a.txt to DOS format... $ cat a.txt | hexdump -C # 0x0d 0x0a # v v 00000000 61 61 61 61 0d 0a |aaaa..| 00000006 $ cat a.txt | hexdump -c 0000000 a a a a \\r \\n 0000006 $ file a.txt a.txt: ASCII text, with CRLF line terminators vim $ vim a.txt :%!hexdump -C # or $ vim -c '%!xxd' a.txt remove the ending '\\n' [!NOTE|label:references:] Why should text files end with a newline? original file $ cat foo.txt abc efg $ cat -A foo.txt abc$ efg$ $ cat foo.txt | od -c 0000000 a b c \\n e f g \\n 0000010 truncate $ truncate -s -1 foo.txt $ od -c foo.txt 0000000 a b c \\n e f g 0000007 sed $ sed -z s/.$// foo.txt | od -c 0000000 a b c \\n e f g 0000007 $ sed -z s/\\\\n$// foo.txt | od -c 0000000 a b c \\n e f g 0000007 $ sed -z 's/\\n$//' foo.txt | od -c 0000000 a b c \\n e f g 0000007 printf $ printf %s \"$( head $ head -c -1 foo.txt | od -c 0000000 a b c \\n e f g 0000007 vim $ od -c foo.txt 0000000 a b c \\n e f g \\n 0000010 $ vim -c \"set binary noeol\" -c \"wq\" foo.txt $ od -c foo.txt 0000000 a b c \\n e f g 0000007 # or : https://stackoverflow.com/a/39627416/2940319 $ vim -c \"set noendofline nofixendofline\" -c \"wq\" foo.txt $ od -c foo.txt 0000000 a b c \\n e f g 0000007 fold check the params valid available params should be contained by 'iwfabcem' # case insensitive param=$( tr '[:upper:]' '[:lower:]' insert new line insert right after the second match string originalexpectedDCR DCR DCRDCR DCR check DCR $ echo -e \"DCR\\nDCR\\nDCR\" | awk 'BEGIN {t=0}; { print }; /DCR/ { t++; if ( t==2) { print \"check\" } }' write a file without indent space $ sed -e 's:^\\s*::' > ~/file-without-indent-space.txt or$ sed -e 's:^\\s*::' > find.aql example$ sed -e 's:^\\s*::' cat and Here Documents: This type of redirection instructs the shell to read input from the current source until a line containing only delimiter (with no trailing blanks) is seen. All of the lines read up to that point are then used as the standard input for a command. The format of here-documents is: No parameter expansion, command substitution, arithmetic expansion, or pathname expansion is performed on word. If any characters in word are quoted, the delimiter is the result of quote removal on word, and the lines in the here-document are not expanded. If word is unquoted, all lines of the here-document are subjected to parameter expansion, command substitution, and arithmetic expansion. In the latter case, the character sequence \\ is ignored, and \\ must be used to quote the characters \\, $, and `. cat with specific character $ man tab ... -T, --show-tabs display TAB characters as ^I other references: Multi-line string with extra space (preserved indentation) Bash - Removing white space from indented multiline strings How to avoid heredoc expanding variables? [duplicate] $ cat -A sample.sh LANG=C tr a-z A-Z $ cat -A sample.sh LANG=C tr a-z A-Z Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:25:00 "},"cheatsheet/character/awk.html":{"url":"cheatsheet/character/awk.html","title":"awk","keywords":"","body":" convert row to column split print chars and length summary all user used memory (ps aux) calculate word count in a file remove non-duplicated lines show matched values field separator variable references: awk printf 4.5 Specifying How Fields Are Separated awk裡好用的變數：FS, OFS, RS, ORS, NR, NF, FILENAME, FNR convert row to column [!TIP|label:original content] $ cat sample.txt job salary c++ 13 java 14 php 12 awk '{ for ( i=1; i resultjob c++ java php salary 13 14 12 split $ echo \"12:34:56\" | awk '{ len = split( $0, a, \":\" ) ; for( i=1; i split with result [!NOTE|label:real situation] original string > git config --list --show-origin --name-only | head -3 file:C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig diff.astextplain.textconv file:C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig filter.lfs.clean file:C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig filter.lfs.smudge +-------------------------------------------------------+ wanted string filter via : REM file:C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig filter.lfs.smudge REM +---+-+-------------------------------------------------------------------------+ REM | | | REM v v v REM $1 $2 $3 > git config --list --show-origin --name-only | head -3 | awk -F: '{print $2}' C C C > git config --list --show-origin --name-only | head -3 | awk -F: '{print $3}' /Users/marslo/AppData/Local/Programs/Git/etc/gitconfig diff.astextplain.textconv /Users/marslo/AppData/Local/Programs/Git/etc/gitconfig filter.lfs.clean /Users/marslo/AppData/Local/Programs/Git/etc/gitconfig filter.lfs.smudge REM via split REM \"FS\" $2 REM | | REM v v REM ___ ___________________________________________________________________________ REM | | | REM file:C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig filter.lfs.smudge REM + + + + REM ......................................................... ................. REM v v REM arr[1] arr[2] > git config --list --show-origin --name-only | head -3 | awk 'BEGIN { FS=\"file:\" }; { print $2 }' C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig diff.astextplain.textconv C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig filter.lfs.clean C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig filter.lfs.smudge > git config --list --show-origin --name-only | head -3 | awk 'BEGIN { FS=\"file:\" }; { n=split($2, arr, \" \"); print arr[1] }' C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig print chars and length $ awk '{ for(i=1; i or using while$ while IFS= read -r line; do echo \"${line}: ${#line}\" done summary all user used memory (ps aux) $ awk '{sum += $1} END {print sum}' or$ ps -u marslo -o pcpu,pmem,pid,command | awk '{sum += $2} END {print sum}' calculate word count in a file $ or$ cat sample.txt | xargs -n1 echo | sort | uniq -c | awk '{print $2,$1}' | sort -gk2 or$ awk '{ for(w=1;w remove non-duplicated lines pre-condition $ cat sample.txt | xargs a a b c d e e e f $ awk '{ print $1 }' sample.txt | sort | uniq -cd | sort -g or $ awk '{ arr[$1]++ } END { for (key in arr) { if ( arr[key] > 1 ){ print arr[key], key } } }' \\ sample.txt show only duplicated lines $ awk 'seen[$1]++' sample.txt show only non-duplicated lines$ awk '!seen[$1]++' sample.txt show matched values Comparison Operators Regular Expressions How to check the checksum through commandline? find distrib name from /etc/lsb-release $ awk -F= '$1 == \"DISTRIB_ID\" {print $2;}' /etc/lsb-release Ubuntu # or $ awk -F= '$1==\"ID\" {print $2;}' /etc/os-release ubuntu find multiple matches $ awk -F= '$1 ~ /DISTRIB_ID|DISTRIB_RELEASE/ {print $2;}' /etc/lsb-release Ubuntu 18.04 return true or false according to matches result $ standard='2cf1b1652a5b268ec80717ef33fef111' $ md5sum ~/.bashrc | awk '$1 != \"${standard}\" {exit 1}' # or $ md5sum ~/.bashrc | awk '$1 == \"${standard}\" {print \"true\"}' field separator variable multiple separators [!NOTE|label:multiple separators] references: Two field separators (colon and space) in awk How to match space or \\s via regex in awk 8 Powerful Awk Built-in Variables – FS, OFS, RS, ORS, NR, NF, FILENAME, FNR How to split a delimited string into an array in awk? Retrieve information Text/Word from HTML code using awk/sed example target : set both : (colon) and (space/blank) as separators # orignal contents > git config --list --show-origin --name-only | head -3 file:C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig diff.astextplain.textconv file:C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig filter.lfs.clean file:C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig filter.lfs.smudge # +......................................................+ # v # wanted string # via `-F ` > git config --list --show-origin --name-only | head -3 | awk -F\"[: ]\" '{print $2\":\"$3}' C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig # or via `FS=` > git config --list --show-origin --name-only | head -3 | awk -v FS='[:[:space:]]+' '{print $2\":\"$3}' F C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig # `[[:blank:]]` or `[[:space:]]` > git config --list --show-origin --name-only | head -3 | awk -v FS='[:[:blank:]]+' '{print $2\":\"$3}' C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig > git config --list --show-origin --name-only | head -3 | awk 'BEGIN { FS=\"[:[:blank:]]+\" }; { print $2\":\"$3 }' C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"cheatsheet/character/sed.html":{"url":"cheatsheet/character/sed.html","title":"sed","keywords":"","body":" execute multiple sed commands example : show only root and nobody in /etc/passwd range specific line until empty line n~m range pattern matches range print print all lines range print print matched pattern delete delete all range delete conditional delete substitute substitute-flags multiple replaces get matched pattern & substitution grouping cheatsheet get first matching patten ( for CERTIFICATE ) remove both '#' and empty lines show top summary escape [!NOTE] references: character classes CHARACTER REGULAR EXPRESSION EXPLANATION [[:alnum:]] [A-Za-z0-9] Alphanumeric characters [[:alpha:]] [A-Za-z] Alphabetic characters [[:blank:]] [ \\t] Space or tab characters only [[:cntrl:]] [\\x00-\\x1F\\x7F] Control characters [[:digit:]] [0-9] Numeric characters [[:graph:]] [!-~] Printable and visible characters [[:lower:]] [a-z] Lower-case alphabetic characters [[:print:]] [ -~] Printable (non-Control) characters [[:punct:]] [!-/:-@[-{-~]` Punctuation characters [[:space:]] [ \\t\\v\\f\\n\\r] All whitespace chars [[:upper:]] [A-Z] Upper-case alphabetic characters [[:xdigit:]] [0-9a-fA-F] Hexadecimal digit characters execute multiple sed commands [!TIP] -e command Append the editing commands specified by the command argument to the list of commands. references: 50 sed Command Examples example : show only root and nobody in /etc/passwd -e : $ sed -n -e '/^root/p' -e '/^nobody/p' /etc/passwd nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false root:*:0:0:System Administrator:/var/root:/bin/sh ; : $ sed -n -e '/^root/p;/^nobody/p' /etc/passwd nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false root:*:0:0:System Administrator:/var/root:/bin/sh '{}' : $ sed -n '{ /^root/p /^nobody/p }' /etc/passwd nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false root:*:0:0:System Administrator:/var/root:/bin/sh range specific line 2nd line : N until empty line references: Remove everything before a blank line using sed Remove empty line before a pattern using sed Grep starting from a fixed text, until the first blank line Delete unknown number of lines from * until blank line remove only the first blank line sed Use sed to insert text before two blank lines htop output to human readable file $HOME/.toprc $ top -bn1 | sed -n '0,/^\\s*$/p' top - 03:41:45 up 258 days, 19:05, 1 user, load average: 2.33, 0.92, 0.95 Tasks: 856 total, 2 running, 447 sleeping, 0 stopped, 36 zombie %Cpu(s): 0.3 us, 0.4 sy, 0.0 ni, 99.2 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st KiB Mem : 52802012+total, 11152644+free, 24536944 used, 39195673+buff/cache KiB Swap: 0 total, 0 free, 0 used. 49137280+avail Mem or$ top -bn1 | sed -e '/^$/Q' top - 03:45:55 up 258 days, 19:09, 1 user, load average: 0.17, 0.51, 0.77 Tasks: 857 total, 2 running, 448 sleeping, 0 stopped, 36 zombie %Cpu(s): 0.1 us, 0.4 sy, 0.0 ni, 99.4 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st KiB Mem : 52802012+total, 11151089+free, 24546520 used, 39196272+buff/cache KiB Swap: 0 total, 0 free, 0 used. 49136291+avail Mem n~m range n~m lines : n,m n to end lines : n,$ m lines starting with n : n, +m start n skip m via ~ : pattern matches comments 1~2 1,3,5,7,... start frmo 1, print every 2 lines 2~2 2,4,6,8,... start from 2, print every 2 lines 1~3 1,4,7,10,... start from 1, print every 3 lines 2~3 2,5,8,11,... start from 2, print every 3 lines pattern matches range between pattern_1 to pattern_2 : /pattern_1/,/pattern_2/ first line to pattern_2 : 0,/pattern_2/ from pattern to first empty line $ top -bn1 | sed -n '/^top.*/,/^\\s*$/p' top - 03:49:02 up 258 days, 19:13, 1 user, load average: 0.43, 0.41, 0.68 Tasks: 853 total, 1 running, 448 sleeping, 0 stopped, 36 zombie %Cpu(s): 0.3 us, 0.4 sy, 0.0 ni, 99.3 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st KiB Mem : 52802012+total, 11150942+free, 24543500 used, 39196720+buff/cache KiB Swap: 0 total, 0 free, 0 used. 49136582+avail Mem print print all lines print every line twice$ sed 'p' employee.txt 101,John Doe,CEO 101,John Doe,CEO 102,Jason Smith,IT Manager 102,Jason Smith,IT Manager 103,Raj Reddy,Sysadmin 103,Raj Reddy,Sysadmin 104,Anand Ram,Developer 104,Anand Ram,Developer 105,Jane Miller,Sales Manager 105,Jane Miller,Sales Manager print all lines : $ sed -n 'p' employee.txt range print print the 2nd line : $ sed -n '2 p' employee.txt n,m range print 1~4 lines : $ sed -n '1,4 p' employee.txt print all lines since the 2nd line: $ sed -n '2,$ p' employee.txt ~ to skip lines print only odd numbered lines : sed -n '1~2 p' employee.txt + ( n, +m ) : sed -n 'n,+m p' employee.txt print matched pattern find pattern to the end :$ sed -n '/Raj/,$ p' employee.txt 103,Raj Reddy,Sysadmin 104,Anand Ram,Developer 105,Jane Miller,Sales Manager find pattern and line after the matches line : $ sed -n '/Raj/, +1 p' employee.txt 103,Raj Reddy,Sysadmin 104,Anand Ram,Developer find pattern to 4th line : $ sed -n '/Raj/,4 p' employee.txt 103,Raj Reddy,Sysadmin 104,Anand Ram,Developer find pattern until find another pattern ( Jason to Anand ) : $ sed -n '/Jason/,/Anand/p' employee.txt 102,Jason Smith,IT Manager 103,Raj Reddy,Sysadmin 104,Anand Ram,Developer delete delete all $ sed 'd' employee.txt range delete delete the 2nd line : $ sed '2 d' /path/to/file delete between 1 and 4 lines : $ sed '1,4 d' /path/to/file conditional delete delete all empty lines: $ sed '/^$/ d' /path/to/file delete all comment lines : $ sed '/^#/ d' /path/to/file substitute substitute-flags flag comments i ignore case flag g global flag 1,2,... number flag p print flag w write flag e execute flag multiple replaces $ sed '{ s/Developer/IT Manager/ s/Manager/Director/ }' employee.txt 101,John Doe,CEO 102,Jason Smith,IT Director 103,Raj Reddy,Sysadmin 104,Anand Ram,IT Director 105,Jane Miller,Sales Director get matched pattern & When & is used in the replacement-string, it replaces it with whatever text matched the original-string or the regular-expression. $ sed 's/^[0-9][0-9][0-9]//g' employee.txt ,John Doe,CEO ,Jason Smith,IT Manager ,Raj Reddy,Sysadmin ,Anand Ram,Developer ,Jane Miller,Sales Manager substitution grouping $ sed 's/^\\([0-9][0-9][0-9]\\).*//g' employee.txt or via -r $ sed -r 's/^([0-9][0-9][0-9]).*//g' employee.txt # or $ sed -nr 's/^([0-9][0-9][0-9])(.*)/\\2/gp' employee.txt ,John Doe,CEO ,Jason Smith,IT Manager ,Raj Reddy,Sysadmin ,Anand Ram,Developer ,Jane Miller,Sales Manager cheatsheet reference: Sed cheatsheet ssstonebraker/sed cheatsheet sed Cheat Sheet Erik's Cheat Sheet : sed cheatsheet_sed.pdf more samples: * imarslo : get lines between 2 matched patterns get first matching patten ( for CERTIFICATE ) [!TIP] sample.crt$ cat sample.crt -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- -----BEGIN CERTIFICATE----- second paragraph -----END CERTIFICATE----- regular pattern $ cat sample.crt | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- -----BEGIN CERTIFICATE----- second paragraph -----END CERTIFICATE----- # or for short $ cat sample.crt | sed -ne '/-BEGIN/,/-END/p' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- -----BEGIN CERTIFICATE----- second paragraph -----END CERTIFICATE----- get first [!TIP] How to print the text between the first occurence of a pair of strings? [duplicate] How to select first occurrence between two patterns including them more : * imarslo : get second matching pattern # or `-n /../p` # `-n` `p` # | | # v v $ cat sample.crt | sed -n '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p; /-END CERTIFICATE-/q' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- # or `/../!d` # no `-n` `!d` # | | # v v $ cat sample.crt | sed '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/!d; /-END CERTIFICATE-/q' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- # or for short $ cat sample.crt | sed '/-END CERTIFICATE-/q' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- # or $ cat sample.crt | sed '/-END/q' -----BEGIN CERTIFICATE----- first paragraph -----END CERTIFICATE----- remove both '#' and empty lines $ .. | sed -r '/^(#.*)$/d' | sed -r '/^\\s*$/d' # or $ .. | sed -r '/^(#.*)$/d;/^\\s*$/d' # or $ .. | sed -r '/(^#.*)|(^\\s*)$/d' example$ ldapsearch CN=marslo DN | sed -r '/^(#.*)$/d;/^\\s*$/d' dn: CN=marslo,OU=Workers,DC=company,DC=com show top summary [!NOTE] see sed until empty line contains empty line $ top -bn1 | sed -n '0,/^\\s*$/p' top - 03:41:45 up 258 days, 19:05, 1 user, load average: 2.33, 0.92, 0.95 Tasks: 856 total, 2 running, 447 sleeping, 0 stopped, 36 zombie %Cpu(s): 0.3 us, 0.4 sy, 0.0 ni, 99.2 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st KiB Mem : 52802012+total, 11152644+free, 24536944 used, 39195673+buff/cache KiB Swap: 0 total, 0 free, 0 used. 49137280+avail Mem without empty line [!TIP] references: Exiting with \"q\" and \"d\" - SED Tutorial manual: The \"q\" command prints the current line again in less the -n flag was used on the command line and exits the script completely q[exit-code] (quit) Exit sed without processing any more commands or input. Q[exit-code] (quit) This command is the same as q, but will not print the contents of pattern space. Like q, it provides the ability to return an exit code to the caller. $ top -bn1 | sed -e '/^$/Q' top - 03:45:55 up 258 days, 19:09, 1 user, load average: 0.17, 0.51, 0.77 Tasks: 857 total, 2 running, 448 sleeping, 0 stopped, 36 zombie %Cpu(s): 0.1 us, 0.4 sy, 0.0 ni, 99.4 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st KiB Mem : 52802012+total, 11151089+free, 24546520 used, 39196272+buff/cache KiB Swap: 0 total, 0 free, 0 used. 49136291+avail Mem escape [!NOTE|label:references:] * How to escape single quotes within single quoted strings \\ to \\\\ $ echo \"\\(\\)\" | sed 's/\\\\/\\\\\\\\\\\\/g' \\\\\\(\\\\\\) morealias rxvt='urxvt -fg'\\''#111111'\\'' -bg '\\''#111111'\\'' │ │┊┊| │┊┊│ │┊┊│ │┊┊│ └─STRING──┘┊┊└─STRIN─┘┊┊└─STR─┘┊┊└─STRIN─┘┊┊│ ┊┊ ┊┊ ┊┊ ┊┊│ ┊┊ ┊┊ ┊┊ ┊┊│ └┴─────────┴┴───┰───┴┴─────────┴┘│ All escaped single quotes │ │ ? alias rc='sed '\"'\"':a;N;$!ba;s/\\n/, /g'\"'\" alias rc='sed '\\'':a;N;$!ba;s/\\n/, /g'\\' Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"cheatsheet/character/markdown.html":{"url":"cheatsheet/character/markdown.html","title":"markdown","keywords":"","body":" useful unicode Combining Diacritical Marks useful unicode reference HTML Symbols HTML Entities UTF-8 Greek and Coptic DerivedAge-14.0.0.txt Other Symbol Other Neutral symbols unicode HTML entity nubmer entity Name desc   &#160; &nbsp; space 003C &#60; &#x3C; &lt; less than > 003E &#62; &#x3E; &gt; greater than « 00AB &#171; &#xab; &laquo; left-pointing double angle quotation mark » 00BB &#187 &#xbb; &raquo; right-pointing Double angle quotation mark › 203A &#8250; &#x203a; &rsaquo; right-pointing single guillemet ‹ 2039 &#8249; &#x2039; &lsaquo; left-pointing single guillemet & 0026 &#38; &#x26; &amp; ampersand | 007C &#124; &#x7C; &verbar; &vert; &VerticalLine; vertical bar ← 2190 &#8592; &#x2190; &larr; &ShortLeftArrow; leftwards arrow → 2192 &#8594; &#x2192; &rarr; &rightarrow; rightwards arrow ↑ 2191 &#8593; &#x2191; &uarr; &ShortUpArrow; upwards arrow ↓ 2193 &#8595; &#x2193; &darr; &ShortDownArrow; downwards arrow ☐ 2610 &#9744; &#x2610; - Ballot Box ⃞ 20DE &#8414; &#x20DE; - Combining Enclosing Square ▢ 25A2 &#9634; &#x25A2; - White Square with Rounded Cners ⬚ 2B1A &#11034; &#x2B1A; - Dotted Square ✅ 2705 &#9989; &#x2705; - White Heavy Check Mark ☑ 2611 &#9745; &#x2611; - Ballot Box with Check ☒ 2612 &#9746; &#x2612; - Ballot Box with X 𐄂 10102 &#65794; &#x10102; - Aegean Check Mark ☓ 2613 &#9747; &#x2613; - Saltire ✓ 2713 &#10003; &#x2713; &check; Check Mark ✔ 2714 &#10004; &#x2714; - Heavy Check Mark ⍻ 237B &#9083; &#x237B; - Not Check Mark ✕ 2715 &#10005; &#x2715; - Multiplication X ✖ 2716 &#10006; &#x2716; - Heavy Multiplication X ✗ 2717 &#10007; &#x2717; - Ballot X ✘ 2718 &#10008; &#x2718; - Heavy Ballot X Combining Diacritical Marks mark unicode character construct result ̀ &#768; a +  ̀ » à a&#768; à ́ &#769; a +  ́ » á a&#769; á ̂ &#770; a +  ̂ » â a&#770; â ̃ &#771; a +  ̃ » ã a&#771; ã ̀ &#768; O +  ̀ » Ò O&#768; Ò ́ &#769; O +  ́ » Ó O&#769; Ó ̂ &#770; O +  ̂ » Ô O&#770; Ô ̃ &#771; O +  ̃ » Õ O&#771; Õ Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"cheatsheet/character/html.html":{"url":"cheatsheet/character/html.html","title":"html","keywords":"","body":" useful html snippets checkbox warnning box useful html snippets checkbox non-editable checked checkbox example: non-editable non-chekced checkbox example: warnning box [!TIP] references: Extended Choice Parameter Warning : The current version of this plugin contains multiple vulnerabilities: CSRF vulnerability and missing permission checks allow SSRF Arbitrary JSON and property file read vulnerability Stored XSS vulnerability Stored XSS vulnerability example: Warning : The current version of this plugin contains multiple vulnerabilities: CSRF vulnerability and missing permission checks allow SSRF Arbitrary JSON and property file read vulnerability Stored XSS vulnerability Stored XSS vulnerability Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"cheatsheet/character/json.html":{"url":"cheatsheet/character/json.html","title":"json","keywords":"","body":" basic syntax for jq Dealing with json objects Slicing and Filtering join split replacing space in the key builtin operators debug select contains inside toUpperCase : ascii_upcase to_entries[] from_entries with_entries as json online player: Online JSON Formatter & Validator jq online player: https://jqplay.org reference: jq manual (development version) Parsing JSON with jq olih/jq-cheetsheet.md Use jq to filter objects list with regex jq: Cannot iterate over number / string and number cannot be added Guide to Linux jq Command for JSON Processing Reshaping JSON with jq * jq cheat sheet Replacing a missing or null property Replacing substrings in a string basic syntax for jq Syntax Description , Filters separated by a comma will produce multiple independent outputs ? Will ignores error if the type is unexpected [] Array construction {} Object construction + Concatenate or Add - Difference of sets or Substract length Size of selected element ⎮ Pipes are used to chain commands in a similar fashion than bash Dealing with json objects Description Command Display all keys jq 'keys' Adds + 1 to all items jq 'map_values(.+1)' Delete a key jq 'del(.foo)' Convert an object to array to_entries ⎮ map([.key, .value]) Slicing and Filtering Description Command All jq .[] First jq '.[0]' Range jq '.[2:4]' First 3 jq '.[:3]' Last 2 jq '.[-2:]' Before Last jq '.[-2]' split jq '.[] ⎮ split(\"/\")[1]' Select array of int by value jq 'map(select(. >= 2))' Select array of objects by value jq '.[] ⎮ select(.id == \"second\")' Select by type jq '.[] ⎮ numbers' with type been arrays, objects, iterables, booleans, numbers, normals, finites, strings, nulls, values, scalars join [!TIP] references: to output multiple values on a single line join multiple values $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' | jq -r '[.some, .json] | join(\":\")' thing:like or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' | jq -r '[.some, .json] | \"\\(.[0]) \\(.[1])\"' thing like or $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' | jq -r '[.some, .json] | \"\\(.[0]): \\(.[1])\"' thing: like or with reduce $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' | jq -r '[.some, .json] | reduce .[1:][] as $i (\"\\(.[0])\"; . + \",\\($i)\")' thing,like or $ echo '{ \"k1\": \"v1\", \"k2\": \"v2\", \"k3\": \"v3\", \"k4\": \"v4\" }' | jq -r '[.k1, .k2, .k3] | reduce .[1:][] as $i (\"\\(.[0])\"; . + \",\\($i)\")' v1,v2,v3 or with .first and .last $ echo '{ \"users\": [ { \"first\": \"Stevie\", \"last\": \"Wonder\" }, { \"first\": \"Michael\", \"last\": \"Jackson\" } ] }' | jq -r '.users[] | .first + \" \" + .last' Stevie Wonder Michael Jackson or$ echo '{ \"users\": [ { \"first\": \"Stevie\", \"last\": \"Wonder\" }, { \"first\": \"Michael\", \"last\": \"Jackson\" } ] }' | jq -r '.users[] | .first + \" \" + (.last|tostring)' or$ echo '{ \"users\": [ { \"first\": \"Stevie\", \"last\": \"Wonder\", \"number\": 1 }, { \"first\": \"Michael\", \"last\": \"Jackson\", \"number\": 2 } ] }' | jq -r '.users[] | .first + \" \" + (.number|tostring)' Stevie 1 Michael 2 split [!TIP] references: remove a substring from a string split(str)) Splits an input string on the separator argument. example&j=%22a%2C%20b%2Cc%2Cd%2C%20e%2C%20%22)jq 'split(\", \")' Input \"a, b,c,d, e, \" Output [\"a\",\"b,c,d\",\"e\",\"\"] $ echo '[{\"uri\" : \"/1\" }, {\"uri\" : \"/2\"}, {\"uri\" : \"/3\"}]' | jq -r '.[].uri' /1 /2 /3 $ echo '[{\"uri\" : \"/1\" }, {\"uri\" : \"/2\"}, {\"uri\" : \"/3\"}]' | jq -r '.[].uri | split(\"/\")[1]' 1 2 3 try online$ echo '[{\"uri\" : \"/1\" }, {\"uri\" : \"/2\"}, {\"uri\" : \"/3\"}]' | jq '.[].uri | split(\"/\")[]' \"\" \"1\" \"\" \"2\" \"\" \"3\" $ echo '[{\"uri\" : \"/1\" }, {\"uri\" : \"/2\"}, {\"uri\" : \"/3\"}]' | jq -r '.[].uri | split(\"/\")' [ \"\", \"1\" ] [ \"\", \"2\" ] [ \"\", \"3\" ] replacing [!TIP] references: Replacing substrings in a string sub(regex; tostring), sub(regex; string; flags)sub(regex;string;flags)) Emit the string obtained by replacing the first match of regex in the input string with tostring, after interpolation. tostring should be a jq string, and may contain references to named captures. The named captures are, in effect, presented as a JSON object (as constructed by capture) to tostring, so a reference to a captured variable named \"x\" would take the form: \"(.x)\". $ echo '[{\"uri\" : \"/1\" }, {\"uri\" : \"/2\"}, {\"uri\" : \"/3\"}]' | jq -r '.[].uri' /1 /2 /3 $ echo '[{\"uri\" : \"/1\" }, {\"uri\" : \"/2\"}, {\"uri\" : \"/3\"}]' | jq -r '.[].uri | sub(\"/\"; \"\")' 1 2 3 space in the key $ echo '{ \"k1 name\": \"v1\", \"k2 name\": \"v2\", \"k3\": \"v3\", \"k4\": \"v4\" }' | jq -r '.\"k1 name\"' v1 builtin operators [!NOTE] reference: jq manual - Builtin operators and functions debug without debug$ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"SECOND\", \"val\": 3}]''' | jq '.[] | select( .val == (2, 3) )' with debug:$ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"SECOND\", \"val\": 3}]''' | jq '.[] | select( .val == (2, 3) | debug )' [\"DEBUG:\",false] [\"DEBUG:\",false] [\"DEBUG:\",true] { \"id\": \"second\", \"val\": 2 } [\"DEBUG:\",false] [\"DEBUG:\",false] [\"DEBUG:\",true] { \"id\": \"SECOND\", \"val\": 3 } select [!NOTE|label:refrences:] imarslo: example on jenkins api analysis imarslo: example on gerrit api analysis jq tips : remove emtpy line Filter empty and/or null values with jqto_entries[] | select(.value | . == null or . == \"\") | if .value == \"\" then .value |= \"\\\"\\(.)\\\"\" else . end | \"\\(.key): \\(.value)\" $ echo \"[1,5,3,0,7]\" | jq 'map(select(. >= 2))' [ 5, 3, 7 ] or $ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}]''' | jq '.[] | select(.id == \"second\")' { \"id\": \"second\", \"val\": 2 } contains reference: imarslo: example on artifactory api analysis imarslo: example on list Error pods in kuberetnes $ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"second-one\", \"val\": 3}]''' | jq '.[] | select( .id | contains(\"second\") )' { \"id\": \"second\", \"val\": 2 } { \"id\": \"second-one\", \"val\": 3 } by using test$ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"second.one\", \"val\": 3}]''' | jq '.[] | select( .id | test(\"sec*\") )' { \"id\": \"second\", \"val\": 2 } { \"id\": \"second.one\", \"val\": 3 } inside $ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"second-one\", \"val\": 3}]''' | jq '.[] | select( [.val] | inside([2,3]) )' { \"id\": \"second\", \"val\": 2 } { \"id\": \"second-one\", \"val\": 3 } or$ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"SECOND\", \"val\": 3}]''' | jq '.[] | select( .val == (2, 3) )' { \"id\": \"second\", \"val\": 2 } { \"id\": \"SECOND\", \"val\": 3 } toUpperCase : ascii_upcase $ echo '''[{\"id\": \"first\", \"val\": 1}, {\"id\": \"second\", \"val\": 2}, {\"id\": \"SECOND\", \"val\": 3}]''' | jq '.[] | select(.id | ascii_upcase == \"SECOND\")' { \"id\": \"second\", \"val\": 2 } { \"id\": \"SECOND\", \"val\": 3 } to_entries[] [!NOTE] references: jq: filter input based on if key ends with specified string # original $ echo '{ \"name\" : \"marslo\" }' | jq -r { \"name\": \"marslo\" } # `to_entries[]` $ echo '{ \"name\" : \"marslo\" }' | jq -r 'to_entries[]' { \"key\": \"name\", \"value\": \"marslo\" } # or `to_entries` $ echo '{\"a\": 1, \"b\": 2}' | jq -r to_entries [ { \"key\": \"a\", \"value\": 1 }, { \"key\": \"b\", \"value\": 2 } ] example to get key and value $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' \\ | jq -r 'to_entries[] | \"\\(.key)\\t\\(.value)\"' some thing json like or output format to @csv $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' | jq -r '[.some, .json] | @csv' \"thing\",\"like\" or output format to @tsv $ echo '{ \"some\": \"thing\", \"json\": \"like\" }' | jq -r '[.some, .json] | @tsv' thing like to_entries and select # orignal $ echo '{ \"name/\" : \"marslo\", \"age/\" : \"18\", \"citizenship\" : \"china\" }' | jq -r { \"name/\": \"marslo\", # wants value if key ends with '/' \"age/\": \"18\", # wants value if key ends with '/' \"citizenship\": \"china\" } # select $ echo '{ \"name/\" : \"marslo\", \"age/\" : \"18\", \"citizenship\" : \"china\" }' | jq -r 'to_entries[] | select(.key|endswith(\"/\")) ' { \"key\": \"name/\", \"value\": \"marslo\" } { \"key\": \"age/\", \"value\": \"18\" } # get `.value` after selected $ echo '{ \"name/\" : \"marslo\", \"age/\" : \"18\", \"citizenship\" : \"china\" }' | jq -r 'to_entries[] | select(.key|endswith(\"/\")) | .value' marslo 18 from_entries $ echo '[{\"key\":\"a\", \"value\":1}, {\"key\":\"b\", \"value\":2}]' | jq -r from_entries { \"a\": 1, \"b\": 2 } with_entries $ echo '{\"a\": 1, \"b\": 2}' | jq 'with_entries(.key |= \"KEY_\" + .)' { \"KEY_a\": 1, \"KEY_b\": 2 } as [!NOTE|label:references] jq: filter input based on if key ends with specified string $ echo '{ \"name/\" : \"marslo\", \"age/\" : \"18\", \"citizenship\" : \"china\" }' | jq -r '. as $o | keys_unsorted[] | select(endswith(\"/\")) | $o[.]' marslo 18 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"cheatsheet/character/regex.html":{"url":"cheatsheet/character/regex.html","title":"regex","keywords":"","body":" special chars samples get URL matches if exits not matche a word not matches multiple keywords references: Regular expression syntax cheat sheet Regular Expressions Reference Table of Contents special chars CHARACTER COMMENTS ?: non capturing group ?= positive look ahead ?! negative look ahead ? positive look behind ? negative look behind samples get URL $ echo http://www.baidu.com | awk '{for(i=1;i references: cheat-sheet for password crackers matches if exits [!NOTE|label:samples:] ✔️ keyword.baz.com ✔️ string-keyword.baz.com ✔️ keyword-staging.bar.com ✔️ keyword-staging.foo.com ^.*keyword(?:-staging)?\\.[^\\]+\\.com not matche a word [!NOTE|label:samples:] ❌ /etc/kubernetes/config.backup/config.backup.20220303/admin.conf ✔️ /etc/kubernetes/pki/admin.conf ^((?!backup).)+(admin|kubelet)\\.conf$ not matches multiple keywords [!NOTE|label:samples:] ❌ foo-jenkins.domain.com ❌ foo-jenkins.domain.com/Monitor/ ❌ marslo.github.com ❌ 127.0.0.1 ^((?!.*\\-jenkins\\.[^\\.]+\\.com|.*Monitor/$|.*detail.*pipeline|.*api|marslo.github.*|shields.io|127.0.0.1|0.0.0.0|localhost).)*$ Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"cheatsheet/osx.html":{"url":"cheatsheet/osx.html","title":"osx","keywords":"","body":" system information Get OSX Info Reboot if system freezed Setup HostName and LocalHostname Setup Bash as default SHELL Disable Guest User Go to Hidden path in Finder ReIndex Spotlight copy STDOUT into clipboard Copy path from finder System Integrity Protection change Mac default settings development environment Setup JAVA_HOME xCode Homebrew system settings accessory QnA x86_64 liblzma.dylib in nokogiri Reference system information Get OSX Info $ sw_vers ProductName: Mac OS X ProductVersion: 10.15.6 BuildVersion: 19G73 $ /usr/sbin/system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Name: MacBook Pro Model Identifier: MacBookPro15,1 Processor Name: 6-Core Intel Core i7 Processor Speed: 2.2 GHz Number of Processors: 1 Total Number of Cores: 6 L2 Cache (per Core): 256 KB L3 Cache: 9 MB Hyper-Threading Technology: Enabled Memory: 16 GB Boot ROM Version: 1037.147.1.0.0 (iBridge: 17.16.16065.0.0,0) Serial Number (system): C02XFGWEJG5H Hardware UUID: 4EA008BF-9B36-5F1D-9151-AD4F64808AAB Activation Lock Status: Enabled get CPU information $ sysctl -n machdep.cpu.brand_string Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz # or $ sysctl machdep.cpu machdep.cpu.max_basic: 22 machdep.cpu.max_ext: 2147483656 machdep.cpu.vendor: GenuineIntel machdep.cpu.brand_string: Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz machdep.cpu.family: 6 ... get more details $ sysctl -a Reboot if system freezed $ sudo systemsetup -setrestartfreeze on Setup HostName and LocalHostname $ sudo scutil --set HostName [HOSTNAME] $ sudo scutil --set LocalHostName [HOSTNAME] $ sudo scutil --set ComputerName [HOSTNAME] # Optional $ dscacheutil -flushcache # Flush the DNS Cache $ sudo shutdown -r now Setup Bash as default SHELL $ chsh -s /bin/bash # OR $ chsh -s `which bash` Disable Guest User $ dscl . delete /Users/Guest $ sudo defaults write /Library/Preferences/com.apple.AppleFileServer guestAccess -bool NO $ sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server AllowGuestAccess -bool NO Go to Hidden path in Finder Command+Shift+G ReIndex Spotlight $ sudo mdutil -i on / $ sudo mdutil -E / $ sudo mdutil -E /Volumes/marslo/ or$ sudo dutil -i off / $ sudo rm -rf /.Spotlight-V100 $ sudo rm -rf /.Spotlight-V200 $ sudo mdutil -i on / $ sudo mdutil -E / $ sudo mdutil -E /Volumes/marslo/ copy STDOUT into clipboard refer to: osx/tricky Copy path from finder refer to: osx/tricky System Integrity Protection refer to: osx/tricky change Mac default settings refer to: osx/defaults development environment Setup JAVA_HOME $ /usr/libexec/java_home -v 1.8.0.162 -exec javac -versioin xCode refer to osx xCode installation Install from App Store Offline Package xCode 9.0.1 Command_Line_Tools_macOS_10.13_for_Xcode_9.0.1 All Packages more details xCode Setup $ sudo xcodebuild -license [accept] xCode CommandLine Tools Verify installed or not $ xcode-select -p xCode CommandLine tools Installation $ xcode-select --install xcode-select: note: install requested for command line developer tools upgrade CommandLine tools $ softwareupdate --all --install --force or $ sudo rm -rf /Library/Developer/CommandLineTools $ sudo xcode-select --install xcode Components Installation $ for pkg in /Applications/Xcode.app/Contents/Resources/Packages/*.pkg; do > sudo installer -pkg \"$pkg\" -target /; > done example: $ ls -altrh /Applications/Xcode.app/Contents/Resources/Packages/ total 180512 -rw-r--r-- 1 root wheel 87K Mar 10 2017 MobileDeviceDevelopment.pkg -rw-r--r-- 1 root wheel 5.4M Sep 30 05:28 XcodeSystemResources.pkg -rw-r--r-- 1 root wheel 11K Sep 30 05:28 XcodeExtensionSupport.pkg -rw-r--r-- 1 root wheel 83M Sep 30 05:28 MobileDevice.pkg drwxr-xr-x 6 root wheel 204B Oct 11 05:23 ./ drwxr-xr-x 87 root wheel 2.9K Oct 11 05:55 ../ $ for pkg in /Applications/Xcode.app/Contents/Resources/Packages/*.pkg; do -> sudo installer -pkg \"$pkg\" -target /; -> done installer: Package name is MobileDevice installer: Upgrading at base path / installer: The upgrade was successful. installer: Package name is MobileDeviceDevelopment installer: Installing at base path / installer: The install was successful. installer: Package name is XcodeExtensionSupport installer: Installing at base path / installer: The install was successful. installer: Package name is XcodeSystemResources installer: Installing at base path / installer: The install was successful. Enable Developer Mode $ DevToolsSecurity -enable show SDK path $ xcrun --show-sdk-path /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk Homebrew refer to: osx/apps.md system settings refer to: osx/apps accessory refer to: osx/apps QnA x86_64 liblzma.dylib in nokogiri Solution 1: $ brew unlink xz $ gem install nokogiri # or gem install cupertino $ brew link xz Solutioin 2 (using system libraies): $ brew install libxml2 $ gem install nokogiri -- --use-system-libraries --with-xml2-include=$(brew --prefix libxml2)/include/libxml2 or $ bundle config build.nokogiri --use-system-libraries --with-xml2-include=$(brew --prefix libxml2)/include/libxml2 $ bundle install or $ brew link --force libxml2 $ gem install nokogiri -v '1.7.0.1' -- --use-system-libraries --with-xml2-include=/usr/include/libxml2 --with-xml2-lib=/usr/lib Reference osx chflags man page Show Hidden Files in Mac OS X Mac Keyboard Shortcuts How to reinstall macOS How to Find the Wi-Fi Password of your Current Network How to Find Wi-Fi Network Passwords from Command Line on Mac 5 Stupid Terminal Tricks to Keep You Entertained Install Nokogiri OSX实用命令 Locking files and folders to prevent changes Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/curl.html":{"url":"cheatsheet/curl.html","title":"curl","keywords":"","body":" install via source curl-config get get JSON get XML get http_code or response_code get http_code for multiple urls get size_download get time post post JSON data using Curl post a file using Curl post form data using Curl post XML put send PUT request delete send a DELETE request authorization Basic Auth Credentials Bearer Token Authorization Header Curl with a proxy content type set the content type for a Curl request others ssl send http header with curl request set a timeout send a head request send a OPTIONS request send a CORS request send Cookies set the User-Agent string convert convert to python requests convert to javascript/ajax calls convert to php code convert to http request 12 Essential Curl Commands for Linux, Windows and macOS references Top 20 Curl Flags write-out references: online rest & soap api testing tool : curl curl.1 the man page available %-symbols: content_type curl_version errormsg exitcode filename_effective ftp_entry_path http_code - The numerical response code that was found in the last retrieved HTTP(S) or FTP(s) transfer http_connect http_version json local_ip local_port method num_connects num_headers num_redirects proxy_ssl_verify_result redirect_url referer remote_ip remote_port response_code - The numerical response code that was found in the last transfer (formerly known as http_code) scheme size_download size_header size_request size_upload speed_download speed_upload ssl_verify_result stderr stdout time_appconnect time_connect time_namelookup time_pretransfer time_redirect time_starttransfer time_total url url_effective urlnum get via $ curl -sSLg \\ -k \\ -o /dev/null \\ -w \"%{json}\" \\ https://domain.name.com | jq -r 'keys[]' | sort install via source [!NOTE|label:references:] Re: Using libcurl to send shell commands through SSH? libcurl 8 How to Build and Install latest cURL version on CentOS and Ubuntu? how to install curl and libcurl release curl/curl environment [!TIP] centos: gcc : appstream libssh2 : @epel libssh2-devel : @epel : $ dnf install libssh2 libssh2-devel libssh2-docs libssh2-doc : @epel zlib : @centos-baseos brotli : @centos-baseos : $ sudo dnf install brotli-devel.i686 libpsl : @centos-baseos openssl : @centos-baseos libidn2 : @centos-baseos $ sudo dnf install -y autoconf automake libtool $ sudo dnf install -y wget gcc openssl-devel libssh2 libssh2-devel libssh2-docs brotli brotli-devel # nice to have $ sudo dnf install -y zstd libzstd libzstd-devel $ curl -fsSLgk -O https://github.com/curl/curl/releases/download/curl-8_2_1/curl-8.2.1.tar.gz $ tar xzf curl-8.2.1.tar.gz $ cd curl-8.2.1 build [!NOTE|label:references] --prefix=/usr/local will install in : /usr/local/lib /usr/local/bin /usr/local/include /usr/local/share $ ./configure --with-libssh \\ --with-libssh2 \\ --with-ssl \\ --with-wolfssh \\ --with-gssapi \\ --enable-websockets \\ --prefix=/opt/curl \\ ... configure: Configured to build curl/libcurl: Host setup: x86_64-pc-linux-gnu Install prefix: /opt/curl Compiler: gcc CFLAGS: -Werror-implicit-function-declaration -O2 -Wno-system-headers -pthread CPPFLAGS: LDFLAGS: LIBS: -lssh2 -lssh2 -lssl -lcrypto -lssl -lcrypto -lgssapi_krb5 -lzstd -lz curl version: 8.2.1 SSL: enabled (OpenSSL) SSH: enabled (libSSH2) zlib: enabled brotli: no (--with-brotli) zstd: enabled (libzstd) GSS-API: enabled (MIT Kerberos/Heimdal) GSASL: no (libgsasl not found) TLS-SRP: enabled resolver: POSIX threaded IPv6: enabled Unix sockets: enabled IDN: no (--with-{libidn2,winidn}) Build libcurl: Shared=yes, Static=yes Built-in manual: enabled --libcurl option: enabled (--disable-libcurl-option) Verbose errors: enabled (--disable-verbose) Code coverage: disabled SSPI: no (--enable-sspi) ca cert bundle: /etc/pki/tls/certs/ca-bundle.crt ca cert path: no ca fallback: no LDAP: no (--enable-ldap / --with-ldap-lib / --with-lber-lib) LDAPS: no (--enable-ldaps) RTSP: enabled RTMP: no (--with-librtmp) PSL: no (libpsl not found) Alt-svc: enabled (--disable-alt-svc) Headers API: enabled (--disable-headers-api) HSTS: enabled (--disable-hsts) HTTP1: enabled (internal) HTTP2: no (--with-nghttp2, --with-hyper) HTTP3: no (--with-ngtcp2 --with-nghttp3, --with-quiche, --with-msh3) ECH: no (--enable-ech) WebSockets: enabled Protocols: DICT FILE FTP FTPS GOPHER GOPHERS HTTP HTTPS IMAP IMAPS MQTT POP3 POP3S RTSP SCP SFTP SMB SMBS SMTP SMTPS TELNET TFTP WS WSS Features: AsynchDNS GSS-API HSTS HTTPS-proxy IPv6 Kerberos Largefile NTLM NTLM_WB SPNEGO SSL TLS-SRP UnixSockets alt-svc libz threadsafe zstd WARNING: Websockets enabled but marked EXPERIMENTAL. Use with caution! $ make -j $ sudo make install # check $ tree -L 2 /opt/curl /opt/curl ├── bin │ ├── curl │ └── curl-config ├── include │ └── curl ├── lib │ ├── libcurl.a │ ├── libcurl.la │ ├── libcurl.so -> libcurl.so.4.8.0 │ ├── libcurl.so.4 -> libcurl.so.4.8.0 │ ├── libcurl.so.4.8.0 │ └── pkgconfig └── share ├── aclocal └── man full configure $ ./configure --with-libssh \\ --with-libssh2 \\ --with-ssl \\ --with-openssl \\ --with-zstd \\ --with-wolfssh \\ --with-gnu-ld \\ --with-gssapi \\ --with-zlib \\ --with-brotli \\ # ../lib/.libs/libcurl.so: undefined reference to `BrotliDecoderCreateInstance'` --with-quiche \\ --with-nghttp3 \\ --with-ngtcp2 \\ --with-libidn2 \\ --with-zsh-functions-dir --enable-debug \\ --enable-optimize \\ --enable-warnings \\ --enable-werror \\ --enable-curldebug \\ --enable-http \\ --enable-ftp \\ --enable-file \\ --enable-ldaps \\ --enable-proxy \\ --enable-dict \\ --enable-telnet \\ --enable-tftp \\ --enable-smb \\ --enable-manual \\ --enable-libcurl-option \\ --enable-libgcc \\ --enable-ipv6 \\ --enable-openssl-auto-load-config \\ --enable-verbose \\ --enable-unix-sockets \\ --enable-socketpair \\ --enable-http-auth \\ --enable-netrc \\ --enable-dnsshuffle \\ --enable-websockets \\ --enable-hsts \\ --enable-headers-api \\ --enable-alt-svc \\ --enable-get-easy-options \\ --prefix=/usr/local Host setup: x86_64-pc-linux-gnu Install prefix: /usr/local Compiler: gcc CFLAGS: -Werror-implicit-function-declaration -g -O2 -std=gnu89 -pedantic -Wall -W -Wpointer-arith -Wwrite-strings -Wunused -Wshadow -Winline -Wnested-externs -Wmissing-declarations -Wmissing-prototypes -Wno-long-long -Wbad-function-cast -Wfloat-equal -Wno-multichar -Wsign-compare -Wundef -Wno-format-nonliteral -Wendif-labels -Wstrict-prototypes -Wdeclaration-after-statement -Wold-style-definition -Wstrict-aliasing=3 -Wcast-align -Wtype-limits -Wold-style-declaration -Wmissing-parameter-type -Wempty-body -Wclobbered -Wignored-qualifiers -Wconversion -Wno-sign-conversion -Wvla -ftree-vrp -Wdouble-promotion -Wformat=2 -Warray-bounds=2 -Wshift-negative-value -Wshift-overflow=2 -Wnull-dereference -fdelete-null-pointer-checks -Wduplicated-cond -Wunused-const-variable -Wduplicated-branches -Wrestrict -Walloc-zero -Wformat-overflow=2 -Wformat-truncation=2 -Wimplicit-fallthrough=4 -Wno-system-headers -pthread CPPFLAGS: LDFLAGS: -L/usr/lib LIBS: -lssh2 -lssh2 -lssl -lcrypto -lssl -lcrypto -lgssapi_krb5 -lldap -llber -lzstd -lzstd -lz -lgcc curl version: 8.2.1 SSL: enabled (OpenSSL) SSH: enabled (libSSH2) zlib: enabled brotli: enabled (libbrotlidec) zstd: enabled (libzstd) GSS-API: enabled (MIT Kerberos/Heimdal) GSASL: no (libgsasl not found) TLS-SRP: enabled resolver: POSIX threaded IPv6: enabled Unix sockets: enabled IDN: no (--with-{libidn2,winidn}) Build libcurl: Shared=yes, Static=yes Built-in manual: enabled --libcurl option: enabled (--disable-libcurl-option) Verbose errors: enabled (--disable-verbose) Code coverage: disabled SSPI: no (--enable-sspi) ca cert bundle: /etc/pki/tls/certs/ca-bundle.crt ca cert path: no ca fallback: no LDAP: enabled (OpenLDAP) LDAPS: enabled RTSP: enabled RTMP: no (--with-librtmp) PSL: no (libpsl not found) Alt-svc: enabled (--disable-alt-svc) Headers API: enabled (--disable-headers-api) HSTS: enabled (--disable-hsts) HTTP1: enabled (internal) HTTP2: no (--with-nghttp2, --with-hyper) HTTP3: no (--with-ngtcp2 --with-nghttp3, --with-quiche, --with-msh3) ECH: no (--enable-ech) WebSockets: enabled Protocols: DICT FILE FTP FTPS GOPHER GOPHERS HTTP HTTPS IMAP IMAPS LDAP LDAPS MQTT POP3 POP3S RTSP SCP SFTP SMB SMBS SMTP SMTPS TELNET TFTP WS WSS Features: AsynchDNS GSS-API HSTS HTTPS-proxy IPv6 Kerberos Largefile NTLM NTLM_WB SPNEGO SSL TLS-SRP UnixSockets alt-svc brotli libz threadsafe zstd WARNING: Websockets enabled but marked EXPERIMENTAL. Use with caution! $ make -j && sudo make install $ curl --version WARNING: this libcurl is Debug-enabled, do not use in production curl 8.2.1 (x86_64-pc-linux-gnu) libcurl/8.2.1 OpenSSL/1.1.1k-fips zlib/1.2.11 zstd/1.4.4 libssh2/1.9.0 OpenLDAP/2.4.46 Release-Date: 2023-07-26 Protocols: dict file ftp ftps gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtsp scp sftp smb smbs smtp smtps telnet tftp ws wss Features: alt-svc AsynchDNS Debug GSS-API HSTS HTTPS-proxy IPv6 Kerberos Largefile libz NTLM NTLM_WB SPNEGO SSL threadsafe TLS-SRP TrackMemory UnixSockets zstd $ curl-config --configure '--without-brotli' '--with-quiche' '--with-zstd' '--with-nghttp3' '--with-ngtcp2' '--with-ssl' '--with-gssapi' '--enable-debug' '--enable-optimize' '--enable-warnings' '--enable-werror' '--enable-curldebug' '--enable-http' '--enable-ftp' '--enable-file' '--enable-ldaps' '--enable-proxy' '--enable-dict' '--enable-telnet' '--enable-tftp' '--enable-smb' '--enable-manual' '--enable-libcurl-option' '--enable-libgcc' '--enable-ipv6' '--enable-openssl-auto-load-config' '--enable-verbose' '--enable-unix-sockets' '--enable-socketpair' '--enable-http-auth' '--enable-netrc' '--enable-dnsshuffle' '--enable-websockets' '--enable-hsts' '--enable-headers-api' '--enable-alt-svc' '--enable-get-easy-options' '--with-openssl' '--with-gnu-ld' '--with-zlib' '--with-libssh2' '--with-libssh' '--with-wolfssh' '--with-libidn2' '--with-zsh-functions-dir' '--prefix=/usr/local' for issue: undefined reference to 'BrotliDecoderCreateInstance': $ make -j ../lib/.libs/libcurl.so: undefined reference to 'BrotliDecoderCreateInstance' ../lib/.libs/libcurl.so: undefined reference to 'BrotliDecoderVersion' ../lib/.libs/libcurl.so: undefined reference to 'BrotliDecoderDestroyInstance' ../lib/.libs/libcurl.so: undefined reference to 'BrotliDecoderDecompressStream' ../lib/.libs/libcurl.so: undefined reference to 'BrotliDecoderGetErrorCode' collect2: error: ld returned 1 exit status make[2]: *** [Makefile:1018: curl] Error 1 solution:$ ./configure --without-brotli ... set [!NOTE|label:OPTIONAL] no need if using /usr/local as --prefix $ sudo update-alternatives --install /usr/local/bin/curl curl /opt/curl/bin/curl 999 $ sudo update-alternatives --install /usr/local/bin/curl-config curl-config /opt/curl/bin/curl-config 999 # or /opt/curl $ bash -c \"echo 'export LD_LIBRARY_PATH=/opt/curl/lib:$LD_LIBRARY_PATH' >> /etc/bashrc\" $ bash -c \"echo 'export LD_RUN_PATH=/opt/curl/lib:$LD_RUN_PATH' >> /etc/bashrc\" # or /usr/local $ bash -c \"echo 'export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH' >> /etc/bashrc\" $ bash -c \"echo 'export LD_RUN_PATH=/usr/local/lib:$LD_RUN_PATH' >> /etc/bashrc\" check $ alternatives --list | grep curl curl auto /opt/curl/bin/curl curl-config auto /opt/curl/bin/curl-config $ curl --version curl 8.2.1 (x86_64-pc-linux-gnu) libcurl/8.2.1 OpenSSL/1.1.1k-fips zlib/1.2.11 zstd/1.4.4 libssh2/1.9.0 Release-Date: 2023-07-26 Protocols: dict file ftp ftps gopher gophers http https imap imaps mqtt pop3 pop3s rtsp scp sftp smb smbs smtp smtps telnet tftp ws wss Features: alt-svc AsynchDNS GSS-API HSTS HTTPS-proxy IPv6 Kerberos Largefile libz NTLM NTLM_WB SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd $ curl --help all curl-config [!NOTE|label:references:] curl-config.1 -- man page $ curl-config --libs -L/usr/local/Cellar/curl/8.2.1/lib -lcurl $ curl-config --feature AsynchDNS GSS-API HSTS HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile MultiSSL NTLM NTLM_WB SPNEGO SSL TLS-SRP UnixSockets alt-svc brotli libz threadsafe zstd $ curl-config --cflags -I/usr/local/Cellar/curl/8.2.1/include $ curl-config --configure '--disable-debug' '--disable-dependency-tracking' '--disable-silent-rules' '--prefix=/usr/local/Cellar/curl/8.2.1' '--with-ssl=/usr/local/opt/openssl@3' '--without-ca-bundle' '--without-ca-path' '--with-ca-fallback' '--with-secure-transport' '--with-default-ssl-backend=openssl' '--with-libidn2' '--with-librtmp' '--with-libssh2' '--without-libpsl' '--with-gssapi' 'CC=clang' get get JSON $ curl https://reqbin.com/echo/get/json \\ -H \"Accept: application/json\" get XML $ curl https://reqbin.com/echo/get/xml \\ -H \"Accept: application/xml\" get http_code or response_code $ curl -s -o /dev/null -w \"%{http_code}\" https://github.com 200 or $ curl -s -o /dev/null -w \"response: '%{response_code}'\" https://github.com response: '200' or $ curl -sSgL -X GET https://github.com/fake/url | sed -nre 's!^.*\"status\"\\s*:\\s*([0-9]+).*$!\\1!gp' 404 or $ curl http://www.example.org -o >(cat >&1) -w \"%{http_code}\\n\" 1>&2 get http_code for multiple urls $ xargs -n1 curl -sk -o /dev/null -w '%{http_code} ' or $ echo \"https://1.domain.com https://2.domain.com \" > urls.txt $ xargs -n1 curl -sk -o /dev/null -w '%{http_code} ' or $ curl -sSgL -X GET https://1.domain.com https://2.domain.com | sed -nre 's!^.*\"status\"\\s*:\\s*([0-9]+).*$!\\1!gp' 404 200 get size_download $ curl -R -s -S -w \"\\nhttp: %{http_code}. size: %{size_download}\\n\" -o /dev/null https://github.com get time $ curl -s \\ -w 'results: \\n Lookup time:\\t%{time_namelookup} Connect time:\\t%{time_connect} PreXfer time:\\t%{time_pretransfer} StartXfer time:\\t%{time_starttransfer} AppCon time:\\t%{time_appconnect} Redirect time:\\t%{time_redirect}\\n Total time:\\t%{time_total}\\n' \\ -o /deve/null \\ https://github.com results: Lookup time: 0.001288 Connect time: 0.001617 PreXfer time: 0.080264 StartXfer time: 0.119895 AppCon time: 0.080165 Redirect time: 0.000000 Total time: 0.120600 post post JSON data using Curl $ curl -X POST https://reqbin.com/echo/post/json \\ -H 'Content-Type: application/json' \\ -d '{\"login\":\"my_login\",\"password\":\"my_password\"}' post a file using Curl $ curl -d @data.json https://reqbin.com/echo/post/json post form data using Curl $ curl -X POST https://reqbin.com/echo/post/form \\ -H \"Content-Type: application/x-www-form-urlencoded\" \\ -d \"param1=value1&param2=value2\" post XML $ curl -X POST https://reqbin.com/echo/post/xml \\ -H \"Content-Type: application/xml\" \\ -H \"Accept: application/xml\" \\ -d \"my_loginmy_password\" put send PUT request $ curl -X PUT https://reqbin.com/echo/put/json \\ -d \"PUT request data\" delete syntax: $ curl -X DELETE [URL] [options] send a DELETE request $ curl -X DELETE http://reqbin.com/sample/delete/json?id=1 \\ -H \"Accept: application/json\" authorization Basic Auth Credentials $ curl https://reqbin.com/echo \\ -u \"login:password\" Bearer Token Authorization Header $ curl https://reqbin.com/echo/get/json \\ -H \"Accept: application/json\" \\ -H \"Authorization: Bearer {token}\" Curl with a proxy $ curl https://reqbin.com/echo \\ -x myproxy.com:8080 \\ -U login:password content type set the content type for a Curl request $ curl -X POST https://reqbin.com/echo/post/json \\ -H 'Content-Type: application/json' \\ -H 'Accept: application/json' \\ -d '{\"Id\": 78912, \"Quantity\": 1, \"Price\": 19.00}' others ssl ignore invalid and self-signed SSL certificate errors in Curl $ curl -k https://expired.badssl.com make HTTPS requests with Curl $ curl -k https://expired.badssl.com with SSL connections $ curl -k https://expired.badssl.com send http header with curl request $ curl https://reqbin.com/echo/get/json \\ -H \"X-Custom-Header: value\" \\ -H \"Content-Type: application/json\" set a timeout $ curl --connection-timeout 5 https://reqbin.com/echo send a head request $ curl -I https://reqbin.com/echo send a OPTIONS request $ curl https://api.reqbin.com/api/v1/requests \\ -X OPTIONS \\ -H \"Access-Control-Request-Method: POST\" \\ -H \"Access-Control-Request-Headers: content-type\" \\ -H \"Origin: https://reqbin.com\" send a CORS request $ curl -H \"Origin: https://example.reqbin.com\" \\ https://reqbin.com/echo send Cookies $ curl --cookie \"Name=Value\" https://reqbin.com/echo set the User-Agent string $ curl https://reqbin.com/echo \\ -A \"ReqBin Curl Client/1.0\" convert convert to python requests $ curl -X POST https://reqbin.com/echo/post/json \\ -H \"Content-Type: application/json\" \\ -d \"{\\\"login\\\":\\\"my_login\\\",\\\"password\\\":\\\"my_password\\\"}\" convert to javascript/ajax calls $ curl -X POST https://reqbin.com/echo/post/json \\ -H \"Content-Type: application/json\" \\ -d \"{\\\"login\\\":\\\"my_login\\\",\\\"password\\\":\\\"my_password\\\"}\" convert to php code $ curl -X POST https://reqbin.com/echo/post/json \\ -H \"Content-Type: application/json\" \\ -d \"{\\\"login\\\":\\\"my_login\\\",\\\"password\\\":\\\"my_password\\\"}\" convert to http request $ curl https://reqbin.com/echo/get/json \\ -H \"Content-Type: application/json\" \\ -H \"Accept: application/json\" 12 Essential Curl Commands for Linux, Windows and macOS get resource content by url$ curl https://reqbin.com/echo save url content to a file$ curl -o logo.png https://reqbin.com/static/img/logo.png download multiple files at once$ curl -O https://reqbin.com/static/img/code/curl.png \\ -O https://reqbin.com/static/img/code/java.png \\ -O https://reqbin.com/static/img/code/python.png check page http headers bash force curl to use http/2 protocol$ curl --http2 https://reqbin.com do follow redirects$ curl -L http://www.reqbin.com/echo use proxy server$ curl -x proxy.domain.com:8080 -U user:password https://reqbin.com provide additional http headers with request$ curl -H \"Accept: application/json\" https://reqbin.com/echo/get/json send data to the server$ curl -d '{\"id\": 123456}' \\ -H \"Content-Type: application/json\" \\ https://reqbin.com/echo/post/json change the user-agent string$ curl --user-agent \"MyAppName 1.0\" https://reqbin.com/echo send cookies to website$ curl -b \"name1=value1; name2=value2\" https://reqbin.com references Top 20 Curl Flags Flags Description Syntax -O Download the file and save it under the original name curl -O [URL] -o Download the file and save it with a different name curl -o [file name] [URL] -X Specify the HTTP method to be used when sending the request curl -X [method] [URL] -I or -head Print the title without the body of the document curl -I [URL] -d Specify the data to send to the server curl -d \"key1=value1&key2=value2\" [URL] -k or -insecure Ignore SSL Certificate Errors curl -k [URL] -u or --user Specify the authentication data by passing a pair of login-password curl -u [user:password] [URL] -F Submit form data as POST request curl -F @field_name=@path/to/myFile --cookie Send HTTP cookies curl --cookie \"Name=Value\" [URL] -x or --proxy Use a proxy server to upload files curl -x \"[protocol://][host][:port]\" [URL] [options] --limit-rate Limit the download speed curl --limit-rate [speed] -O [URL] -L or --location Follow Curl redirect using HTTP Location header curl -L [URL] -v Makes Curl verbose curl -v [URL] -m or --max-time Set a limit in seconds for the entire operation curl -m [SECONDS] [URL] --connect-timeout Set a limit in seconds for a connection request curl --connect-timeout [SECONDS] [URL] -T Transfers the specified local file to a remote URL curl -T [file name] [URL] -H or --header Add additional HTTP request header curl -H \"X-Header: value\" [URL] -D Save the HTTP headers that the site sends back curl -D [URL] -A or --user-agent Set User-Agent string curl -A \"value\" [URL] -C Resume an interrupted or intentionally stopped download curl -C [OFFSET] -O [URL] write-out Option Description Lookup time (time_namelookup) The time, in seconds, it took from the start until the name resolving was completed Connect time (time_connect) The time, in seconds, it took from the start until the TCP connect to the remote host was completed PreXfer time (time_pretransfer) The time, in seconds, it took from the start until the file transfer was just about to begin. This includes all ‘pre-transfer’ commands and negotiations that are specific to the particular protocol(s) involved StartXfer time (time_starttransfer) The time, in seconds, it took from the start until the first byte was just about to be transferred. This includes ‘time_pretransfer’ and also the time the server needed to calculate the result AppCon time (time_appconnect) The time, in seconds, it took from the start until the SSL/SSH/etc connect/handshake to the remote host was completed (Added in 7.19.0) Redirect time (time_redirect) The time, in seconds, it took for all redirection steps include name lookup, connect, pretransfer and transfer before the final transaction was started. ‘time_redirect’ shows the complete execution time for multiple redirections. (Added in 7.12.3) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"cheatsheet/tricky.html":{"url":"cheatsheet/tricky.html","title":"tricky","keywords":"","body":" highlight output ack less grep highlight ccat others remove highlight alias bash - get cookie from firefox authentication Special Characters in Usernames and Passwords downlaods bookmark highlight output [!TIP] references: Colorized grep -- viewing the entire file with highlighted matches Highlight text similar to grep, but don't filter out text [duplicate] kilobyte/colorized-logs ack $ curl -sg https://my.api.com | ack --passthru 'keyword' less $ curl -sg https://my.api.com | less -i -p 'keyword' grep $ command | grep --color=always 'pattern\\|$' $ command | grep --color=always -E 'pattern|$' $ command | egrep --color=always 'pattern|$' example $ curl -sg 'https://my.api.com | jq -r . | grep --color=always '.*keyword.*\\|$' # or $ curl -sg 'https://my.api.com | jq -r . | grep --color=always -E '| .*keyword.*' highlight [!TIP] Highlight was designed to offer a flexible but easy to use syntax highlighter for several output formats. Instead of hardcoding syntax or colouring information, all relevant data is stored in configuration scripts. These scripts may be altered or enhanced with plug-in scripts. $ highlight -i git.groovy -o git.groovy.html --syntax groovy --inline-css --include-style --line-numbers ccat [!TIP] ccat is the colorizing cat. It works similar to cat but displays content with syntax highlighting. $ ccat /path/to/file.groovy # output html format $ ccat file.py --bg=dark --html # get colors $ ccat --palette others dev-shell-essentials remove highlight [!TIP] references: Removing colors from output $ | sed -r \"s/\\x1B\\[([0-9]{1,3}(;[0-9]{1,2};?)?)?[mGK]//g\" # or $ alias decolorize='sed -r \"s/\\\\x1B\\\\[([0-9]{1,3}(;[0-9]{1,2})?)?[mGK]//g\"' $ command | decolorize tips $ git br -a | cat -A * ^[[1;32mmarslo^[[m$ ^[[31mremotes/origin/marslo^[[m$ ^[[31mremotes/origin/gh-pages^[[m$ ^[[31mremotes/origin/gitbook^[[m$ ^[[31mremotes/origin/master^[[m$ ^[[33mgh-pages^[[m$ ^[[33mmaster^[[m$ ^[[31mremotes/origin/sample^[[m$ $ git br -a | decolorize | cat -A * marslo$ remotes/origin/marslo$ remotes/origin/gh-pages$ remotes/origin/gitbook$ remotes/origin/master$ gh-pages$ master$ remotes/origin/sample$ alias [!NOTE|label:references:] _complete_alias cykerway/complete-alias How do I get bash completion for command aliases? make-completion-wrapper make-completion-wrapper bash-completion/README $ echo ${BASH_ALIASES[ls]} ls --color=always bash - get bash login log ( for rc script debug ) $ bash -l -v run with only one startup file ( for sharing accounts ) $ bash -i --rcfile=\"$HOME/.marslo/.imarslo\" get cookie from firefox $ grep -oP '\"url\":\"\\K[^\"]+' $(ls -t ~/.mozilla/firefox/*/sessionstore.js | sed q) authentication Special Characters in Usernames and Passwords references: percent-encoding CHARACTERS PERCENT-ENCODED ] %5B [ %5D ? %3F / %2F %3C ~ %7E # %23 ``` %6D ! %21 @ %40 $ %24 % %25 ^ %5E & %26 * %2A ( %28 ) %29 + %2B = %3D } %7D ` %7C : %3A \" %22 ; %3B ' %27 , %2C > %3E { %7B space %20 downlaods bookmark [!TIP] references: terrorgum.com Bash Cookbook Becoming the Hacker Deep Learning Revolution linux basics for hackers.pdf Linux In Nutshell.pdf pdfprof.com Advanced Bash-Scripting Guide Linux Bash Shell Cheat Sheet dye784/collection Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/widget.html":{"url":"cheatsheet/widget.html","title":"widget","keywords":"","body":" prompt linux/osx windows weather iweather uriel1998/weather.sh szantaii/bash-weather others figlet toilet prompt linux/osx now #!/bin/bash # NAME: now # PATH: $HOME/bin # DESC: Display current weather, calendar and time # CALL: Called from terminal or ~/.bashrc # DATE: Apr 6, 2017. Modified: May 24, 2019. # UPDT: 2019-05-24 If Weather unavailable nicely formatted error message. # NOTE: To display all available toilet fonts use this one-liner: # for i in ${TOILET_FONT_PATH:=/usr/share/figlet}/*.{t,f}lf; do j=${i##*/}; toilet -d \"${i%/*}\" -f \"$j\" \"${j%.*}\"; done # Setup for 92 character wide terminal DateColumn=34 # Default is 27 for 80 character line, 34 for 92 character line TimeColumn=61 # Default is 49 for \" \" \" \" 61 \" \" \" \" # Replace Edmonton with your city name, GPS, etc. See: curl wttr.in/:help curl wttr.in/Edmonton?0 --silent --max-time 3 > /tmp/now-weather # Timeout #. Increase for slow connection---^ readarray aWeather /tmp/terminal1 # -h not supported in Ubuntu 18.04. Use second answer: https://askubuntu.com/a/1028566/307523 tr -cd '\\11\\12\\15\\40\\60-\\136\\140-\\176' /tmp/terminal CalLineCnt=1 Today=$(date +\"%e\") printf \"\\033[32m\" # color green -- see list above. while IFS= read -r Cal; do printf \"%s\" \"$Cal\" if [[ $CalLineCnt -gt 2 ]] ; then # See if today is on current line & invert background tput cub 22 for (( j=0 ; j /dev/null; then echo \" $(date +\"%I:%M %P\") \" | \\ toilet -f future --filter border > /tmp/terminal # Do we have the figlet package? elif hash figlet 2>/dev/null; then # echo $(date +\"%I:%M %P\") | figlet > /tmp/terminal date +\"%I:%M %P\" | figlet > /tmp/terminal # else use standard font else # echo $(date +\"%I:%M %P\") > /tmp/terminal date +\"%I:%M %P\" > /tmp/terminal fi while IFS= read -r Time; do printf \"\\033[01;36m\" # color cyan printf \"%s\" \"$Time\" tput cud1 # Up one line tput cuf $TimeColumn # Move 49 columns right done another now # NAME: now # PATH: $HOME/bin # DESC: Display current weather, calendar and time # CALL: Called from terminal or ~/.bashrc # DATE: Apr 6, 2017. Modified: Mar 30, 2018. # NOTE: To display all available toilet fonts use this one-liner: # for i in ${TOILET_FONT_PATH:=/usr/share/figlet}/*.{t,f}lf; do j=${i##*/}; toilet -d \"${i%/*}\" -f \"$j\" \"${j%.*}\"; done # Setup for 92 character wide terminal DateColumn=34 # Default is 27 for 80 character line, 34 for 92 character line TimeColumn=61 # Default is 49 for \" \" \" \" 61 \" \" \" \" #--------- WEATHER ---------------------------------------------------------- # Current weather, already in color so no need to override echo \" \" # Replace Edmonton with your city name, GPS, etc. See: curl wttr.in/:help curl wttr.in/Edmonton?0 --silent --max-time 3 # Timeout #. Increase for slow connection---^ echo \" \" echo \" \" # Pad with blank lines for calendar & time to fit #--------- DATE ------------------------------------------------------------- # calendar current month with today highlighted. # colors 00=bright white, 31=red, 32=green, 33=yellow, 34=blue, 35=purple, # 36=cyan, 37=white tput sc # Save cursor position. # Move up 9 lines while [ $((++i)) -lt 10 ]; do tput cuu1; done # Depending on length of your city name and country name you will: # 1. Comment out next three lines of code. Uncomment fourth code line. # 2. Change subtraction value and set number of print spaces to match # subtraction value. Then place comment on fourth code line. Column=$(($DateColumn - 10)) tput cuf $Column # Move x column number printf \" \" # Blank out \", country\" with x spaces #tput cuf $DateColumn # Position to column 27 for date display # -h needed to turn off formating: https://askubuntu.com/questions/1013954/bash-substring-stringoffsetlength-error/1013960#1013960 cal -h > /tmp/terminal CalLineCnt=1 Today=$(date +\"%d\") # Prefix with space when length 2 ]] ; then # See if today is on current line & invert background tput cub 22 for (( j=0 ; j /dev/null; then echo \" \"$(date +\"%I:%M %P\")\" \" | \\ toilet -f future --filter border > /tmp/terminal # Do we have the figlet package? elif hash figlet 2>/dev/null; then echo $(date +\"%I:%M %P\") | figlet > /tmp/terminal # else use standard font else echo $(date +\"%I:%M %P\") > /tmp/terminal fi while IFS= read -r Time; do printf \"\\033[01;36m\" # color cyan printf \"$Time\" tput cud1 # Up one line tput cuf $TimeColumn # Move 49 columns right done windows nijikokun/WinScreeny modified WinScreeny #!/usr/bin/env bash # # Windows Screenfetch (Without the Screenshot functionality) # Hacked together by Nijikokun # License: AOL # Downloaded from: https://github.com/nijikokun/WinScreeny # Modified from Windows to Windows Subsystem for Linux (Ubuntu initially) version='0.4' # Displayment display=( Host Cpu OS Arch Shell Motherboard HDD Memory Uptime Resolution DE WM WMTheme Font ) # Color Loop bld=$'\\e[1m' rst=$'\\e[0m' inv=$'\\e[7m' und=$'\\e[4m' f=3 b=4 for j in f b; do for i in {0..7}; do printf -v $j$i %b \"\\e[${!j}${i}m\" done done # Debugging debug= Debug () { echo -e \"\\e[1;31m:: \\e[0m$1\" } # Flag Check while getopts \"vVh\" flags; do case $flags in h) echo -e \"${und}Usage${rst}:\" echo -e \" screeny [Optional Flags]\" echo \"\" echo \"WinScreeny - A CLI Bash Script to show System Information for Windows!\" echo \"\" echo -e \"${und}Options${rst}:\" echo -e \" ${bld}-v${rst} Verbose / Debug Output\" echo -e \" ${bld}-V${rst} Display script version\" echo -e \" ${bld}-h${rst} Display this file\" exit;; V) echo -e \"${und}WinScreeny${rst} - Version ${version}\" echo -e \"Copyright (C) Nijiko Yonskai (nijikokun@gmail.com)\" echo \"\" echo -e \"This is free software, under the AOL license: http://aol.nexua.org\" echo -e \"Source can be downloaded from: https://github.com/Nijikokun/WinScreeny\" exit;; v) debug=1 continue;; esac done # Prevent Unix Output unameOutput=`uname`GARBAGE if [[ \"$unameOutput\" == 'Linux' ]] || [[ \"$unameOutput\" == 'Darwin' ]] ; then echo 'This script is for Windows, silly!' exit 0 fi # Begin Detection detectHost () { user=$(echo \"$USER\") host=$(hostname) [[ \"$debug\" -eq \"1\" ]] && Debug \"Finding hostname, and user.... Found as: '$user@$host'\" } detectCpu () { cpu=$(awk -F':' '/model name/{ print $2 }' /proc/cpuinfo | head -n 1 | tr -s \" \" | sed 's/^ //') [[ \"$debug\" -eq \"1\" ]] && Debug \"Finding cpu.... Found as: '$cpu'\" } detectOS () { os=`uname -r` } detectArch () { arch=`lsb_release -a 2>&1 | awk '{ print $2 \" \" $3 \" \" $4}' | head -3 | tail -1` [[ \"$debug\" -eq \"1\" ]] && Debug \"Finding Architecture.... Found as: '$arch'\" } detectHDD () { size=`df -H | awk '{ print $2}' | head -2 | tail -1 | tr -d '\\r '` free=`df -H | awk '{ print $4 }' | head -2 | tail -1 | tr -d '\\r '` } detectResolution () { width=`/mnt/c/Windows/System32/wbem/WMIC.exe desktopmonitor get screenwidth | grep -vE '[a-z]+' | tr -d '\\r\\n '` height=`/mnt/c/Windows/System32/wbem/WMIC.exe desktopmonitor get screenheight | grep -vE '[a-z]+' | tr -d '\\r\\n '` } detectUptime () { uptime=`awk -F. '{print $1}' /proc/uptime` secs=$((${uptime}%60)) mins=$((${uptime}/60%60)) hours=$((${uptime}/3600%24)) days=$((${uptime}/86400)) uptime=\"${mins}m\" if [ \"${hours}\" -ne \"0\" ]; then uptime=\"${hours}h ${uptime}\" fi if [ \"${days}\" -ne \"0\" ]; then uptime=\"${days}d ${uptime}\" fi [[ \"$debug\" -eq \"1\" ]] && Debug \"Finding Uptime.... Found as: '$uptime${rst}'\" } detectMemory () { total_mem=$(awk '/MemTotal/ { print $2 }' /proc/meminfo) totalmem=$((${total_mem}/1024)) free_mem=$(awk '/MemFree/ { print $2 }' /proc/meminfo) used_mem=$((${total_mem} - ${free_mem})) usedmem=$((${used_mem}/1024)) mem=\"${usedmem}MB / ${totalmem}MB\" [[ \"$debug\" -eq \"1\" ]] && Debug \"Finding Memory.... Found as: '$mem${rst}'\" } detectShell () { myshell=`bash --version | head -1` [[ \"$debug\" -eq \"1\" ]] && Debug \"Finding Shell.... Found as: '$myshell'\" } detectMotherboard () { board=`/mnt/c/Windows/System32/wbem/WMIC.exe baseboard get product | tail -2 | tr -d '\\r '` } detectDE () { winver=`/mnt/c/Windows/System32/wbem/WMIC.exe os get version | grep -o '^[0-9]'` if [ \"$winver\" == \"7\" ]; then de='Aero' elif [ \"$winver\" == \"6\" ]; then de='Aero' else de=$winver fi [[ \"$debug\" -eq \"1\" ]] && Debug \"Finding Desktop Environment.... Found as: '$de'\" } detectWM () { vcxsrv=`/mnt/c/Windows/System32/tasklist.exe | grep -o 'vcxsrv' | tr -d '\\r \\n'` wind=`/mnt/c/Windows/System32/tasklist.exe | grep -o 'Windawesome' | tr -d '\\r \\n'` if [ \"$vcxsrv\" = \"vcxsrv\" ]; then wm=\"VcXsrv\" elif [ \"$wind\" = \"Windawesome\" ]; then wm=\"Windawesome\" else wm=\"DWM\" fi [[ \"$debug\" -eq \"1\" ]] && Debug \"Finding Window Manager.... Found as: '$wm'\" } detectWMTheme () { themeFile=\"$(/mnt/c/Windows/System32/reg.exe query 'HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Themes' /v 'CurrentTheme' | grep -o '[A-Z]:\\\\.*')\" # theme=$(echo $themeFile | awk -F\"\\\\\" '{print $NF}' | grep -o '[0-9A-z. ]*$' | grep -o '^[0-9A-z ]*') theme=$themeFile [[ \"$debug\" -eq \"1\" ]] && Debug \"Finding Window Theme.... Found as: '$theme'\" } detectFont () { # font=$(cat $HOME/.minttyrc | grep '^Font=.*' | grep -o '[0-9A-Za-z ]*$') font=\"Consolas\" [[ \"$debug\" -eq \"1\" ]] && Debug \"Finding Font.... Found as: '$font'\" # if [ -z $font ]; then # font=\"Lucida Console\" # fi } # Loops :> for i in \"${display[@]}\"; do [[ \"${display[*]}\" =~ \"$i\" ]] && detect${i} done # Output cat *\\` $rst EOF weather wttr.in constants.py: WEATHER_SYMBOL_WEGO icons Some frame options openweathermap One Call API 3.0 How to get icon URL lat & lon $ curl -g \"https://api.openweathermap.org/geo/1.0/direct?q=San%20Jose&limit=5&appid=\" # i.e. Santa Clara City $ /usr/bin/curl -sg \"https://api.openweathermap.org/geo/1.0/direct?q=Santa%20Clara&limit=5&appid=\" | jq -r '.[] | select(.state == \"California\") | (.lat|tostring) + \" : \" + (.lon|tostring)' 37.3541132 : -121.955174 weather $ /usr/bin/curl -sg \"https://api.openweathermap.org/data/3.0/onecall?lat=37.3541132&lon=-121.955174&units=metric&appid=\" | jq -r .current { \"dt\": 1691720508, # date -d @ \"sunrise\": 1691673584, # date -d @ \"sunset\": 1691723206, # date -d @ \"temp\": 24.13, # °C : units=metric \"feels_like\": 24.17, # °C : units=metric \"pressure\": 1013, \"humidity\": 60, \"dew_point\": 15.88, # °C : units=metric \"uvi\": 0.26, \"clouds\": 40, # % \"visibility\": 10000, # m == 10.0km \"wind_speed\": 8.75, # m/s \"wind_deg\": 350, \"weather\": [ { \"id\": 802, \"main\": \"Clouds\", \"description\": \"scattered clouds\", \"icon\": \"03d\" } ] } # unscramble # date: $ TZ=America/Los_Angeles date -d @1691720508 Thu Aug 10 19:21:48 PDT 2023 $ TZ=America/Los_Angeles date -d @1691673584 Thu Aug 10 06:19:44 PDT 2023 $ TZ=America/Los_Angeles date -d @1691723206 Thu Aug 10 20:06:46 PDT 2023 iweather #!/usr/bin/env bash # shellcheck disable=SC2034,SC1111,SC1110 # =========================================================================== # FileName : iweather # Author : marslo # Created : 2023-08-11 03:05:27 # LastChange : 2023-08-12 00:55:09 # =========================================================================== shopt -s extglob # https://github.com/ppo/bash-colors # shellcheck disable=SC2154,SC1091 source \"${iRCHOME}\"/bin/bash-color.sh function die() { echo -e \"$(c R)~~> ERROR$(c) : $*\" >&2; exit 2; } function showHelp() { echo -e \"${usage}\"; exit 0; } function capitalized() { result='' for _i in \"$@\"; do result+=${_i^}; result+=' '; done echo \"${result}\" } function windDirection() { direction=$1 if (( $(echo \"0 \"${locFile}\" if [[ ! -s ${locFile} ]] || [[ ! -f \"${locFile}\" ]]; then echo '-1' else cat \"${locFile}\" fi } function getWeatherData() { param=\"$*\" loc=$(getLatLon \"$param\") [[ '-1' = \"${loc}\" ]] && die \"city '$(c Y)${param}$(c)' cannot be found ! manual check the valid name from https://openweathermap.org/ !\" units='metric' exclude='hourly,daily,minutely,alerts' # shellcheck disable=SC1111,SC1110,SC2086 ${CURL} -skg \"${API_HOME}/data/3.0/onecall?${loc}&units=${units}&exclude=${exclude}&appid=${appid}\" \\ | jq -r .current > ${tempfile} } # shellcheck disable=SC2086,SC1091 source \"$(dirname $0)/iweather.icon\" API_HOME=\"https://api.openweathermap.org\" CURL='/usr/local/opt/curl/bin/curl' tempfile='/tmp/open-weather-map.json' locFile='/tmp/omw-lat-lon' cname='San Jose' verbose='false' appid=\"${OWM_API_TOKEN}\" # shellcheck disable=SC1078,SC1079 usage=\"\"\" $(c M)iweather$(c) - show weather status of city \\nNOTICE: \\n\\t1. requires https://openweathermap.org/api API key first! and setup environment variable: \\t $(c Y)\\$ export OWM_API_TOKEN=xxxxx$(c) \\t2. copy or move $(c G)iweather.icon$(c) into same directory with current script \\t $(c Y)\\$ cp mylinux/config/home/.marslo/bin/iweather.icon .$(c) \\t $(c sW)# or$(c) \\t $(c Y)\\$ curl -o iweather.icon https://raw.githubusercontent.com/marslo/mylinux/master/confs/home/.marslo/bin/iweather.icon$(c) \\nSYNOPSIS: \\n\\t$(c sY)\\$ iweather [ -h | -v | -c ]$(c) \\nEXAMPLE: \\n\\tshow help \\t $(c G)\\$ iweather -h$(c) \\n\\tto show current weather stats \\t $(c G)\\$ iweather $(c) | $(c G)iweather -c $(c) USAGE: \\n\\t $ iweather -v \\t $(c G)Santa Clara$(c) : Few Clouds \\t \\t \\033[38;5;226m \\\\ /\\033[0m \\033[38;5;214m17.36\\033[0m °C \\t \\033[38;5;226m _ /\"\"\\033[38;5;250m.-. \\033[0m → \\033[38;5;220m3.6\\033[0m m/s \\t \\033[38;5;226m \\\\_\\033[38;5;250m( ). \\033[0m 10.00 km \\t \\033[38;5;226m /\\033[38;5;250m(___(__) \\033[0m 80 % \\t 0 mW/cm2 \\n\\t $ iweather -c beijing -v \\t $(c G)Beijing$(c) : Clear Sky \\t \\t\\033[38;5;226m \\\\ / \\033[0m \\033[38;5;214m31.94\\033[0m °C \\t\\033[38;5;226m .-. \\033[0m ↑ \\033[38;5;220m2.05\\033[0m m/s \\t\\033[38;5;226m ― ( ) ― \\033[0m 10.00 km \\t\\033[38;5;226m \\`-’ \\033[0m 57 % \\t\\033[38;5;226m / \\\\ \\033[0m 4.6 mW/cm2 \"\"\" if [[ 0 -eq $# ]]; then # shellcheck disable=SC2269 cname=\"${cname}\" # simple usage: not starts with '-' && not contains '=' elif [[ 1 -eq $# ]] && [[ '-' != \"${1::1}\" ]] ; then cname=\"$1\" else # credit belongs to https://stackoverflow.com/a/28466267/519360 # shellcheck disable=SC2295 while getopts :hvc:-: OPT; do if [ \"$OPT\" = \"-\" ]; then OPT=\"${OPTARG%%=*}\" OPTARG=\"${OPTARG#$OPT}\" OPTARG=\"${OPTARG#=}\" fi case \"$OPT\" in h ) help='true' ;; v ) verbose=true ;; c ) cname=\"$OPTARG\" ;; ??* ) die \"Illegal option --$OPT\" ;; ? ) die \"Illegal option --$OPT\" ;; esac done [[ 1 -eq $OPTIND ]] && showHelp fi [[ 'true' = \"${help}\" ]] && showHelp [[ -z \"${OWM_API_TOKEN}\" ]] && die \"setup environment variable '$(c M)OWM_API_TOKEN$(c)' first! check details via $(c Y)$ iweather -h$(c).\" [[ -z \"${sunny}\" ]] && die \"setup $(c G)weather.icon$(c) first!\" getWeatherData \"${cname}\" weatherIcon=\"$(jq -r .weather[].icon ## more for weather icons: https://erikflowers.github.io/weather-icons/ sunny=''' \\033[38;5;226m \\\\ / \\033[0m \\033[38;5;226m .-. \\033[0m \\033[38;5;226m ― ( ) ― \\033[0m \\033[38;5;226m `-’ \\033[0m \\033[38;5;226m / \\\\ \\033[0m ''' fewClouds=''' \\033[38;5;226m \\\\ /\\033[0m \\033[38;5;226m _ /\"\"\\033[38;5;250m.-. \\033[0m \\033[38;5;226m \\\\_\\033[38;5;250m( ). \\033[0m \\033[38;5;226m /\\033[38;5;250m(___(__) \\033[0m ''' scatteredClouds=''' \\033[38;5;250m .--. \\033[0m \\033[38;5;250m .-( ). \\033[0m \\033[38;5;250m (___.__)__) \\033[0m ''' brokenClouds=''' \\033[38;5;240;1m .--. \\033[0m \\033[38;5;240;1m .-( ). \\033[0m \\033[38;5;240;1m (___.__)__) \\033[0m ''' lightShowers=''' \\033[38;5;226m _`/\"\"\\033[38;5;250m.-. \\033[0m \\033[38;5;226m ,\\\\_\\033[38;5;250m( ). \\033[0m \\033[38;5;226m /\\033[38;5;250m(___(__) \\033[0m \\033[38;5;111m ‘ ‘ ‘ ‘ \\033[0m \\033[38;5;111m ‘ ‘ ‘ ‘ \\033[0m ''' heavyShowers=''' \\033[38;5;226m _`/\"\"\\033[38;5;240;1m.-. \\033[0m \\033[38;5;226m ,\\\\_\\033[38;5;240;1m( ). \\033[0m \\033[38;5;226m /\\033[38;5;240;1m(___(__) \\033[0m \\033[38;5;21;1m ‚‘‚‘‚‘‚‘ \\033[0m \\033[38;5;21;1m ‚’‚’‚’‚’ \\033[0m ''' lightSnowShowers=''' \\033[38;5;226m _`/\"\"\\033[38;5;250m.-. \\033[0m \\033[38;5;226m ,\\\\_\\033[38;5;250m( ). \\033[0m \\033[38;5;226m /\\033[38;5;250m(___(__) \\033[0m \\033[38;5;255m * * * \\033[0m \\033[38;5;255m * * * \\033[0m ''' heavySnowShowers=''' \\033[38;5;226m _`/\"\"\\033[38;5;240;1m.-. \\033[0m \\033[38;5;226m ,\\\\_\\033[38;5;240;1m( ). \\033[0m \\033[38;5;226m /\\033[38;5;240;1m(___(__) \\033[0m \\033[38;5;255;1m * * * * \\033[0m \\033[38;5;255;1m * * * * \\033[0m ''' lightSleetShowers=''' \\033[38;5;226m _`/\"\"\\033[38;5;250m.-. \\033[0m \\033[38;5;226m ,\\\\_\\033[38;5;250m( ). \\033[0m \\033[38;5;226m /\\033[38;5;250m(___(__) \\033[0m \\033[38;5;111m ‘ \\033[38;5;255m*\\033[38;5;111m ‘ \\033[38;5;255m* \\033[0m \\033[38;5;255m *\\033[38;5;111m ‘ \\033[38;5;255m*\\033[38;5;111m ‘ \\033[0m ''' showerRain=''' \\033[38;5;226m _`/\"\"\\033[38;5;250m.-. \\033[0m \\033[38;5;226m ,\\\\_\\033[38;5;250m( ). \\033[0m \\033[38;5;226m /\\033[38;5;250m(___(__) \\033[0m \\033[38;5;228;5m ⚡\\033[38;5;111;25m‘ ‘\\033[38;5;228;5m⚡\\033[38;5;111;25m‘ ‘ \\033[0m \\033[38;5;111m ‘ ‘ ‘ ‘ \\033[0m ''' thunderStorm=''' \\033[38;5;240;1m .-. \\033[0m \\033[38;5;240;1m ( ). \\033[0m \\033[38;5;240;1m (___(__) \\033[0m \\033[38;5;21;1m ‚‘\\033[38;5;228;5m⚡\\033[38;5;21;25m‘‚\\033[38;5;228;5m⚡\\033[38;5;21;25m‚‘ \\033[0m \\033[38;5;21;1m ‚’‚’\\033[38;5;228;5m⚡\\033[38;5;21;25m’‚’ \\033[0m ''' thunderySnowShowers=''' \\033[38;5;226m _`/\"\"\\033[38;5;250m.-. \\033[0m \\033[38;5;226m ,\\\\_\\033[38;5;250m( ). \\033[0m \\033[38;5;226m /\\033[38;5;250m(___(__) \\033[0m \\033[38;5;255m *\\033[38;5;228;5m⚡\\033[38;5;255;25m*\\033[38;5;228;5m⚡\\033[38;5;255;25m* \\033[0m \\033[38;5;255m * * * \\033[0m ''' rain=''' \\033[38;5;250m .-. \\033[0m \\033[38;5;250m ( ). \\033[0m \\033[38;5;250m (___(__) \\033[0m \\033[38;5;111m ‘ ‘ ‘ ‘ \\033[0m \\033[38;5;111m ‘ ‘ ‘ ‘ \\033[0m ''' heavyRain=''' \\033[38;5;240;1m .-. \\033[0m \\033[38;5;240;1m ( ). \\033[0m \\033[38;5;240;1m (___(__) \\033[0m \\033[38;5;21;1m ‚‘‚‘‚‘‚‘ \\033[0m \\033[38;5;21;1m ‚’‚’‚’‚’ \\033[0m ''' snow=''' \\033[38;5;250m .-. \\033[0m \\033[38;5;250m ( ). \\033[0m \\033[38;5;250m (___(__) \\033[0m \\033[38;5;255m * * * \\033[0m \\033[38;5;255m * * * \\033[0m ''' heavySnow=''' \\033[38;5;240;1m .-. \\033[0m \\033[38;5;240;1m ( ). \\033[0m \\033[38;5;240;1m (___(__) \\033[0m \\033[38;5;255;1m * * * * \\033[0m \\033[38;5;255;1m * * * * \\033[0m ''' lightSleet=''' \\033[38;5;250m .-. \\033[0m \\033[38;5;250m ( ). \\033[0m \\033[38;5;250m (___(__) \\033[0m \\033[38;5;111m ‘ \\033[38;5;255m*\\033[38;5;111m ‘ \\033[38;5;255m* \\033[0m \\033[38;5;255m *\\033[38;5;111m ‘ \\033[38;5;255m*\\033[38;5;111m ‘ \\033[0m ''' mist=''' \\033[38;5;251m _ - _ - _ - \\033[0m \\033[38;5;251m _ - _ - _ \\033[0m \\033[38;5;251m _ - _ - _ - \\033[0m ''' associated now cmd #------------------------------ WEATHER ------------------------------------- if ! curl ${curlOpt} wttr.in/sanjose?QmM0 --fail --silent --max-time 3 > /tmp/now-weather; then # timeout #. increase for slow connection---^ ~/.marslo/bin/iweather > /tmp/now-weather fi # was valid weather report found or an error message? if grep '°C' /tmp/now-weather >/dev/null 2>&1; then WeatherSuccess=true cat /tmp/now-weather else WeatherSuccess=false echo \" \" echo \" \" echo \" \" echo \" \" echo \" \" # replace edmonton with your city echo \" \" echo \" \" echo \" \" fi echo \" \" # pad blank lines for calendar & time to fit rm -rf /tmp/now-weather uriel1998/weather.sh How to start using professional collections szantaii/bash-weather others ruanyf/simple-bash-scripts figlet [!NOTE|label:references:] font examples font database FIGlet Fonts Library cmatsuoka/figlet-fonts Figlet cheatsheet list all fonts $ while read -r _font; do echo -e \"\\n\\n>> ${_font}\"; date +\"%I:%M %P\" | figlet -w 300 -f ${_font} -d /usr/local/share/figlet; done result >> /usr/local/share/figlet/smblock.tlf ▗▌ ▞▀▖ ▗▌ ▛▀▌ ▌ ▗▘▐▌ ▌ ▐ ▛▀▖▛▚▀▖ ▌ ▗▘ ▗▖ ▌ ▌ ▙▄▘▌▐ ▌ ▝▀ ▀▀▘▝▘▝▀ ▘ ▌ ▘▝ ▘ >> /usr/local/share/figlet/smbraille.tlf ⢺ ⠊⡱ ⢺ ⠉⡹ ⣀⡀ ⣀⣀ ⠼⠄ ⠮⠤: ⠼⠄ ⠸ ⡧⠜ ⠇⠇⠇ >> /usr/local/share/figlet/future.tlf ╺┓ ┏━┓ ╺┓ ┏━┓ ┏━┓┏┳┓ ┃ ┏━┛╹ ┃ ┃ ┣━┛┃┃┃ ╺┻╸┗━╸╹╺┻╸ ╹ ╹ ╹ ╹ >> /usr/local/share/figlet/fonts/straight.flf __ ___ /| _). /| / _ _ | /__. | / |_)||| | $ realpath /usr/local/share/figlet/fonts/straight.flf /usr/local/Cellar/figlet/2.2.5/share/figlet/fonts/straight.flf $ realpath /usr/local/share/figlet/future.tlf /usr/local/Cellar/toilet/0.3/share/figlet/future.tlf $ realpath /usr/local/share/figlet/smbraille.tlf /usr/local/Cellar/toilet/0.3/share/figlet/smbraille.tlf $ realpath /usr/local/share/figlet/smblock.tlf /usr/local/Cellar/toilet/0.3/share/figlet/smblock.tlf toilet fonts $ ls $(brew --prefix toilet)/share/figlet ascii12.tlf bigascii9.tlf circle.tlf future.tlf mono9.tlf smascii9.tlf smmono12.tlf ascii9.tlf bigmono12.tlf emboss.tlf letter.tlf pagga.tlf smblock.tlf smmono9.tlf bigascii12.tlf bigmono9.tlf emboss2.tlf mono12.tlf smascii12.tlf smbraille.tlf wideterm.tlf list all fonts $ while read -r _path; do _n=$(basename $_path); _fname=${_n//\\.?lf/}; echo -e \"\\n\\n>> ${_fname}\"; date +\"%I:%M %P\" | toilet -f \"${_fname}\"; done Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-27 12:48:19 "},"cheatsheet/proxy.html":{"url":"cheatsheet/proxy.html","title":"proxy","keywords":"","body":" proxy for bash proxy for curl proxy for yum proxy for apt proxy for docker for docker build for docker pull proxy for pip setup via command line using directly proxy for ssh nc corkscrew ncat connect socat proxy for git http.proxy and https.proxy core.gitproxy core.sshCommand proxy for npm proxy for nc proxy for ssl Q&A nc : nc: Proxy error: \"HTTP/1.1 200 Connection established\" proxy with kubeconfig proxy with windows references: How to Use Netcat Commands: Examples and Cheat Sheets SSH Tunneling and Proxying bryanpkc/corkscrew nc / netcat gotoh/ssh-connect larryhou/connect-proxy proxy for bash # global settings $ cat /etc/bashrc export http_proxy=http://proxy.domain.com:80/ export https_proxy=http://proxy.domain.com:80/ # individual account settings $ cat ~/.bashrc export http_proxy=http://proxy.domain.com:80/ export https_proxy=http://proxy.domain.com:80/ proxy for curl $ curl -x http://proxy.domain.com:80 to get head only$ curl -kvI -x http://proxy.domain.com:80 proxy for yum $ cat /etc/yum.conf [main] proxy=http://proxy.domain.com:80 proxy for apt [!TIP|label:see also] * imarlso : APT Configuration $ cat /etc/apt/apt.conf Acquire::http::Proxy \"http://proxy.domain.com:80\"; Acquire::https::Proxy \"http://proxy.domain.com:80\"; Acquire::ftp::Proxy \"http://proxy.domain.com:80\"; proxy for docker [!TIP|label:see also] * imarslo : docker proxy for docker build $ mkdir -p ~/.docker $ cat > ~/.docker/config.json or via cmd directly$ docker build \\ --build-arg http_proxy=http://proxy.domain.com:80 \\ --build-arg https_proxy=http://proxy.domain.com:443 \\ for docker pull # for rootless mode $ mkdir -p ~/.config/systemd/user/docker.service.d/ # or regular mode $ sudo mkdir -p /etc/systemd/system/docker.service.d $ sudo bash -c \"cat > /etc/systemd/system/docker.service.d\" proxy for pip [!TIP|label:paths] MS Windows: %APPDATA%\\pip\\pip.ini MacOS: $HOME/Library/Application Support/pip/pip.conf Unix: $HOME/.config/pip/pip.conf setup via command line $ pip config set global.proxy http://proxy.domain.com:80 using directly $ pip install --proxy http://proxy.domain.com:80 git-review proxy for ssh nc $ ssh -vT \\ -o \"ProxyCommand=nc -X connect -x proxy.domain.com:80 %h %p\" \\ -p 22 \\ ssh://remote.git.com # or $ ssh -vT \\ -o \"ProxyCommand=netcat -X connect -x proxy.domain.com:80 %h %p\" \\ -p 22 \\ ssh://remote.git.com $ cat ~/.ssh/config Host github.com User my.account@mail.com ServerAliveInterval 60 Hostname ssh.github.com Port 443 ProxyCommand nc -X connect -x proxy.domain.com:80 %h %p for socks5ProxyCommand nc -X 5 -x proxy.domain.com:80 %h %p corkscrew $ brew install corkscrew $ ssh -vT \\ -o \"ProxyCommand=corkscrew proxy.domain.com 80 %h %p\" \\ -p 22 \\ ssh://remote.git.com $ cat ~/.ssh/config Host github.com User my.account@mail.com ServerAliveInterval 60 Hostname ssh.github.com Port 443 ProxyCommand corkscrew proxy.domain.com 80 %h %p ncat $ brew install nmap $ ssh -vT \\ -o \"ProxyCommand=ncat --proxy proxy.domain.com:80 --proxy-type http %h %p\" \\ -p 22 \\ ssh://remote.git.com $ cat ~/.ssh/config Host github.com User my.account@mail.com ServerAliveInterval 60 Hostname ssh.github.com Port 443 ProxyCommand ncat --proxy proxy.domain.com:80 --proxy-type http %h %p for socks5ProxyCommand ncat --proxy proxy.domain.com:80 --proxy-type socks5 %h %p connect [!NOTE] applicable to git for windows $ brew install connect $ ssh -vT \\ -o \"ProxyCommand=connect -H proxy.domain.com:80 %h %p\" \\ -p 22 \\ ssh://remote.git.com $ cat ~/.ssh/config Host github.com User my.account@mail.com ServerAliveInterval 60 Hostname ssh.github.com Port 443 ProxyCommand connect -H proxy.domain.com:80 %h %p for socks5ProxyCommand connect -S proxy.domain.com:80 %h %p socat [!NOTE] he socat Command in Linux sit/gitproxy-socat proxy for git [!NOTE|label:references] evantoli/GitConfigHttpProxy.md Using git with a proxy yougg/proxy.md evantoli/GitConfigHttpProxy.md Tutorial: how to use git through a proxy cms-sw/cms-git-tools no ssl verify: set GIT_SSL_NO_VERIFY=true echo http{,s} | fmt -1 | xargs -i git config --global {}.sslVerify=false how to debug: https : GIT_CURL_VERBOSE=1 git ... or GIT_TRACE_CURL=true git ... ssh : GIT_SSH_COMMAND='ssh -v' git ... or git -c sshCommand='ssh -v' ... core.gitproxy A \"proxy command\" to execute (as command host port) instead of establishing direct connection to the remote server when using the Git protocol for fetching. If the variable value is in the \"COMMAND for DOMAIN\" format, the command is applied only on hostnames ending with the specified domain string. This variable may be set multiple times and is matched in the given order; the first match wins. Can be overridden by the GIT_PROXY_COMMAND environment variable (which always applies universally, without the special \"for\" handling). http.proxy and https.proxy $ git config --global https.proxy 'http://proxy.domain.com:80' # using privoxy convert socks to http $ git config --global http.proxy 'http://proxy.domain.com:80' $ git config --global https.sslVerify false # unable to access '...': Unknown SSL protocol error in connection to ...:443 $ git config --global http.sslVerify false # unable to access '...': Unknown SSL protocol error in connection to ...:443 for specific url $ git config --global http.https://github.com http://proxy.domain.com:80 $ git config --global http.https://chromium.googlesource.com http://proxy.domain.com:80 or $ cat ~/.gitconfig [http] proxy = http://proxy.domain.com:80 [https] proxy = http://proxy.domain.com:80 [http \"https://chromium.googlesource.com\"] proxy = http://proxy.domain.com:80 [http \"https://github.com\"] proxy = http://proxy.domain.com:80 for socks5 $ git config --global socks.proxy \"proxy.domain.com:80\" # or $ git config --global socks.proxy \"socks5://proxy.domain.com:80\" additional usage $ cat ~/.gitconfig ... [url \"git@ssh.github.com\"] insteadOf = git@github.com [url \"git@ssh.github.com:\"] insteadOf = https://github.com/ [http] sslVerify = false postBuffer = 524288000 # sslVersion = tlsv1.1 # sslVersion = tlsv1.2 # sslVersion = tlsv1.3 ... show current configure $ git config --global --get-regexp http.* $ git config --global --get-regexp .*proxy.* unset $ git config --global --unset http.proxy $ git config --global --unset http.https://github.com $ git config --global --unset http.sslVerify $ git config --global --unset http.https://domain.com.sslVerify core.gitproxy $ git config --global core.gitproxy https://proxy.domain.com:80 $ git config --global url.git://github.com/.insteadOf git@github.com: core.sshCommand [!NOTE] core.sshCommand since 26 Jun 2016 commit 3c8ede3 A new configuration variable core.sshCommand has been added to specify what value for GIT_SSH_COMMAND to use per repository. $ git config --global core.sshCommand \"ssh -v -o 'ProxyCommand=connect -H proxy.domain.com:80 %h %p'\" # or $ git -c core.sshCommand \"ssh -v -o 'ProxyCommand=commect -H proxy.domain.com:80 %h %p'\" clone git@github.com/marslo/ibook.git proxy for npm [!NOTE|label:referencs] npm config Is there a way to make npm install (the command) to work behind proxy? How to fix SSL certificate error when running Npm on Windows? $ npm config set proxy http://proxy.domain.com:80/ $ npm config set https-proxy http://proxy.domain.com:80/ $ npm config set noproxy '127.0.0.1,my.noproxy.com' # optional $ npm config set strict-ssl false or$ cat ~/.npmrc strict-ssl=false proxy=http://proxy.domain.com:80/ https-proxy=http://proxy.domain.com:80/ proxy for nc [!NOTE|label:manual page] -X proxy_version Requests that nc should use the specified protocol when talking to the proxy server. Supported protocols are: - “4” (SOCKS v.4) - “5” (SOCKS v.5) - “connect” (HTTPS proxy) If the protocol is not specified, SOCKS version 5 is used. additional-T protocols=all # with proxy $ nc -zv -X connect -x proxy.domain.com:80 google.com 443 nc: Proxy error: \"HTTP/1.1 200 Connection established\" # without proxy $ nc -zv google.com 443 nc: connectx to google.com port 443 (tcp) failed: Operation timed out proxy for ssl [!NOTE|label:https proxy] Since version 7.52.0, curl can do HTTPS to the proxy separately from the connection to the server. This TLS connection is handled separately from the server connection so instead of --insecure and --cacert to control the certificate verification, you use --proxy-insecure and --proxy-cacert. With these options, you make sure that the TLS connection and the trust of the proxy can be kept totally separate from the TLS connection to the server. Q&A nc : nc: Proxy error: \"HTTP/1.1 200 Connection established\" issue $ nc -X connect -x 127.0.0.1:8080 -zv git.domain.com 22 nc: Proxy error: \"HTTP/1.1 200 Connection established\" solution $ corkscrew 127.0.0.1 8080 git.domain.com 22 SSH-2.0-GerritCodeReview_2.16.27-RP-1.10.2.4 (SSHD-CORE-2.0.0) ^C $ ncat --proxy 127.0.0.1:1087 --proxy-type http sample.gerrit.com 29418 SSH-2.0-GerritCodeReview_2.16.27-RP-1.10.2.4 (SSHD-CORE-2.0.0) ^C $ cat ~/.ssh/config Host git.domain.com Hostname git.domain.com User marslo Port 22 StrictHostKeyChecking no UserKnownHostsFile ~/.ssh/known_hosts ProxyCommand corkscrew 127.0.0.1 8080 %h %p # or ProxyCommand ncat --proxy 127.0.0.1:8080 --proxy-type http %h %p # verify in ssh $ ssh -vT -o \"ProxyCommand=corkscrew 127.0.0.1 8080 %h %p\" -p 22 git.domain.com proxy with kubeconfig [!NOTE|label:see also] * imarslo : Kubectl context and configuration $ kubectl config set-cluster --proxy-url= # i.e. $ kubectl config set-cluster development --proxy-url=http://proxy.domain.com:8080 proxy with windows [!NOTE] How can we configure the .pac proxy to git otahi/pacproxy add/modify > reg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyEnable /t REG_DWORD /d 1 > reg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyServer /t REG_SZ /d name:port > reg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyUser /t REG_SZ /d username > reg add \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" /v ProxyPass /t REG_SZ /d password > netsh winhttp import proxy source=ie or > netsh winhttp set proxy proxy-server=\"socks=localhost:9090\" bypass-list=\"localhost\" REM show > netsh winhttp show proxy REM reset > netsh winhttp reset proxy or > netsh winhttp set proxy 127.0.0.1:1080 > netsh winhttp set proxy proxy-server=\"socks=127.0.0.1:9150\" bypass-list=\"127.0.0.1\" > netsh winhttp set proxy proxy-server=\"socks=localhost:9150\" bypass-list=\"localhost\" > netsh winhttp set proxy proxy-server=\"http=127.0.0.1:1080\" bypass-list=\"127.0.0.1\" > netsh winhttp set proxy proxy-server=\"https=127.0.0.1:1080\" bypass-list=\"127.0.0.1\" check $ reg query \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" | find AutoConfigURL AutoConfigURL REG_SZ http://proxy.domain.com/file.pac REM full list $ reg query \"HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings CertificateRevocation REG_DWORD 0x1 DisableCachingOfSSLPages REG_DWORD 0x0 IE5_UA_Backup_Flag REG_SZ 5.0 PrivacyAdvanced REG_DWORD 0x1 SecureProtocols REG_DWORD 0x800 User Agent REG_SZ Mozilla/5.0 (compatible; MSIE 9.0; Win32) SecureProtocolsUpdated REG_DWORD 0x1 EnableNegotiate REG_DWORD 0x1 ProxyEnable REG_DWORD 0x0 MigrateProxy REG_DWORD 0x1 AutoConfigURL REG_SZ http://proxy.domain.com/file.pac Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:10:10 "},"cheatsheet/colors.html":{"url":"cheatsheet/colors.html","title":"colors","keywords":"","body":" ansicolors xterm 256 colors xterm 256 colors chart 256 colors cheat sheet man page colors settings using vim as man pager ansicolor issues in man page reference: * 256 Colors Cheat Sheet * 256 colors * XTerm Color Cheat Sheet * Color names * Web colors * colors.sh * fromhex() & tohex() 256 Foreground and Background Colors - Full Chart scripts/color-chart Bash tips: Colors and formatting (ANSI/VT100 Control sequences) Bash Colors color grid Colours and Cursor Movement With tput The 5 Best Color Picker Apps for Mac xterm 256color chart.svg Modifying the color of grep [!TIP] foreground colors┏━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓ ┃ ### ┃ GNOME Terminal ┃ xterm ┃ non-GUI TTY ┃ ┡━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩ │ 39 │ «reset this color» │ «reset this color» │ «reset this color» │ ├─────┼─────────────────────────┼─────────────────────────┼───────────────────────┤ │ 30 │ very dark grey │ black │ black │ │ 31 │ dull red │ red │ light red │ │ 32 │ dull green │ light green │ light green │ │ 33 │ dull yellow │ yellow │ yellow │ │ 34 │ greyish blue │ dark blue │ sky blue │ │ 35 │ dull purple │ purple │ purple │ │ 36 │ teal │ cyan │ cyan │ │ 37 │ light grey │ light grey │ light grey │ ├─────┼─────────────────────────┼─────────────────────────┼───────────────────────┤ │ 90 │ dark grey │ dull grey │ dull grey │ │ 91 │ red │ bright red │ bright red │ │ 92 │ lime green │ bright green │ bright green │ │ 93 │ yellow │ bright yellow │ pure yellow │ │ 94 │ light greyish blue │ dull blue │ deep blue │ │ 95 │ light purple │ magenta │ magenta │ │ 96 │ cyan │ bright cyan │ bright cyan │ │ 97 │ off white │ white │ white │ ├─────┴──────┬──────────────────┴─────────────────────────┴───────────────────────┤ │ 38;2;ʀ;ɢ;ʙ │ replace ʀ, ɢ, and ʙ with RGB values from 0 to 255 │ │ │ for closest supported color (non-GUI TTY has only 16 colors!) │ │ 38;5;ɴ │ replace ɴ with value from 256-color chart below │ │ │ for closest supported color (non-GUI TTY has only 16 colors!) │ └────────────┴────────────────────────────────────────────────────────────────────┘ background colors┏━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓ ┃ ### ┃ GNOME Terminal ┃ xterm ┃ non-GUI TTY ┃ ┡━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩ │ 49 │ «reset this color» │ «reset this color» │ «reset this color» │ ├─────┼─────────────────────────┼─────────────────────────┼───────────────────────┤ │ 40 │ very dark grey │ black │ black │ │ 41 │ dull red │ red │ light red │ │ 42 │ dull green │ light green │ light green │ │ 43 │ dull yellow │ yellow │ yellow │ │ 44 │ greyish blue │ dark blue │ sky blue │ │ 45 │ dull purple │ purple │ purple │ │ 46 │ teal │ cyan │ cyan │ │ 47 │ light grey │ light grey │ light grey │ ├─────┼─────────────────────────┼─────────────────────────┼╶╴╶╴╶╴╶╴╶╴╶╴╶╴╶╴╶╴╶╴╶╴╶┤ │ 100 │ dark grey │ dull grey │ black │ │ 101 │ red │ bright red │ light red │ │ 102 │ lime green │ bright green │ light green │ │ 103 │ yellow │ bright yellow │ yellow │ │ 104 │ light greyish blue │ dull blue │ sky blue │ │ 105 │ light purple │ magenta │ purple │ │ 106 │ cyan │ bright cyan │ cyan │ │ 107 │ off white │ white │ light grey │ ├─────┴──────┬──────────────────┴─────────────────────────┴───────────────────────┤ │ 48;2;ʀ;ɢ;ʙ │ replace ʀ, ɢ, and ʙ with RGB values from 0 to 255 │ │ │ for closest supported color (non-GUI TTY has only 8 colors!) │ │ 48;5;ɴ │ replace ɴ with value from 256-color chart below │ │ │ for closest supported color (non-GUI TTY has only 8 colors!) │ └────────────┴────────────────────────────────────────────────────────────────────┘ text styling┏━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓ ┃ ### ┃ GNOME Terminal ┃ xterm ┃ non-GUI TTY ┃ ┡━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩ │ │ «reset style+colors» │ «reset style+colors» │ «reset style+colors» │ │ 0 │ «reset style+colors» │ «reset style+colors» │ «reset style+colors» │ ├─────┼─────────────────────────┼─────────────────────────┼───────────────────────┤ │ 1 │ +bold, +brighter color │ +bold, +brighter color │ +brighter color, │ │ │ │ │ -forced grey │ │ 2 │ +fainter color │ +fainter color │ +forced grey │ │ 3 │ +italic │ +italic │ +forced green │ │ │ │ │ ● overrides 2 and 4 │ │ 4 │ +underline │ +underline │ +forced cyan │ │ │ │ │ ● overrides 2 │ │ 5 │ «no effect» │ +blink │ «no effect» │ │ 7 │ +invert colors │ +invert colors │ +invert colors │ │ 8 │ +invisible │ +invisible │ «no effect» │ │ │ │ ● underline appears │ │ │ 9 │ +strikethrough │ +strikethrough │ «no effect» │ ├─────┼─────────────────────────┤ ├───────────────────────┤ │ 21 │ -bold, -brighter color, │ +double underline │ -brighter color, │ │ │ -fainter color ├─────────────────────────┤ -forced grey │ │ 22 │ -bold, -brighter color, │ -bold, -brighter color, │ -brighter color, │ │ │ -fainter color │ -fainter color │ -forced grey │ │ 23 │ -italic │ -italic │ -forced green │ │ 24 │ -underline │ -underline, │ -forced cyan │ │ │ │ -double underline │ │ │ 25 │ «no effect» │ -blink │ «no effect» │ │ 27 │ -invert colors │ -invert colors │ -invert colors │ │ 28 │ -invisible │ -invisible │ «no effect» │ │ 29 │ -strikethrough │ -strikethrough │ «no effect» │ └─────┴─────────────────────────┴─────────────────────────┴───────────────────────┘ Font Effects┏━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ ┃ Code ┃ Effect ┃ Note ┃ ┡━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩ │ 0 │ Reset / Normal │ all attributes off │ │ 1 │ Bold or increased intensity │ │ │ 2 │ Faint (decreased intensity) │ Not widely supported. │ │ 3 │ Italic │ Not widely supported. Sometimes treated as inverse. │ │ 4 │ Underline │ │ │ 5 │ Slow Blink │ less than 150 per minute │ │ 6 │ Rapid Blink │ MS-DOS ANSI.SYS; 150+ per minute; not widely supported │ │ 7 │ [[reverse video]] │ swap foreground and background colors │ │ 8 │ Conceal │ Not widely supported. │ │ 9 │ Crossed-out │ Characters legible, but marked for deletion. Not widely supported. │ │ 10 │ Primary(default) font │ │ │ 11–19 │ Alternate font │ Select alternate font n-10 │ │ 20 │ Fraktur │ hardly ever supported │ │ 21 │ Bold off or Double Underline │ Bold off not widely supported; double underline hardly ever supported. │ │ 22 │ Normal color or intensity │ Neither bold nor faint │ │ 23 │ Not italic, not Fraktur │ │ │ 24 │ Underline off │ Not singly or doubly underlined │ │ 25 │ Blink off │ │ │ 27 │ Inverse off │ │ │ 28 │ Reveal │ conceal off │ │ 29 │ Not crossed out │ │ │ 30–37 │ Set foreground color │ See color table below │ │ 38 │ Set foreground color │ Next arguments are 5; or 2;;;, see below │ │ 39 │ Default foreground color │ implementation defined (according to standard) │ │ 40–47 │ Set background color │ See color table below │ │ 48 │ Set background color │ Next arguments are 5; or 2;;;, see below │ │ 49 │ Default background color │ implementation defined (according to standard) │ │ 51 │ Framed │ │ │ 52 │ Encircled │ │ │ 53 │ Overlined │ │ │ 54 │ Not framed or encircled │ │ │ 55 │ Not overlined │ │ │ 60 │ ideogram underline │ hardly ever supported │ │ 61 │ ideogram double underline │ hardly ever supported │ │ 62 │ ideogram overline │ hardly ever supported │ │ 63 │ ideogram double overline │ hardly ever supported │ │ 64 │ ideogram stress marking │ hardly ever supported │ │ 65 │ ideogram attributes off │ reset the effects of all of 60-64 │ │ 90–97 │ Set bright foreground color │ aixterm (not in standard) │ │ 100–107 │ Set bright background color │ │ └─────────┴──────────────────────────────┴────────────────────────────────────────────────────────────────────────┘ quick show colors:$ for i in {0..255}; do echo -e \"\\033[38;5;${i}m $i \\033[0m\"; done ansicolors [!NOTE] references: How to have multiple colors in a Windows batch file? 256 colors function 256color() { for i in {0..255}; do echo -e \"\\e[38;05;${i}m█${i}\"; done | column -c 180 -s ' '; echo -e \"\\e[m\" } #!/bin/bash # This program is free software. It comes without any warranty, to # the extent permitted by applicable law. You can redistribute it # and/or modify it under the terms of the Do What The Fuck You Want # To Public License, Version 2, as published by Sam Hocevar. See # http://sam.zoy.org/wtfpl/COPYING for more details. for fgbg in 38 48 ; do # Foreground / Background for color in {0..255} ; do # Colors # Display the color printf \"\\e[${fgbg};5;%sm %3s \\e[0m\" $color $color # Display 6 colors per lines if [ $((($color + 1) % 6)) == 4 ] ; then echo # New line fi done echo # New line done exit 0 colors and formatting reference: 256-colors.sh #!/bin/sh # From: https://misc.flogisoft.com/bash/tip_colors_and_formatting#colors2 # Modified by steve.tarver@gmail.com to work in Alpine Linux ash # This program is free software. It comes without any warranty, to # the extent permitted by applicable law. You can redistribute it # and/or modify it under the terms of the Do What The Fuck You Want # To Public License, Version 2, as published by Sam Hocevar. See # http://sam.zoy.org/wtfpl/COPYING for more details. #Background for clbg in {40..47} {100..107} 49 ; do #Foreground for clfg in {30..37} {90..97} 39 ; do #Formatting for attr in 0 1 2 4 5 7 ; do #Print the result echo -en \"\\e[${attr};${clbg};${clfg}m ^[${attr};${clbg};${clfg}m \\e[0m\" done echo #Newline done done exit 0 for attr in 0 1 2 3 4 5 6 7; do echo \"------------------------------------------------\" printf \"ESC[%s;Foreground;Background - \\n\" $attr for fore in 30 31 32 33 34 35 36 37; do for back in 40 41 42 43 44 45 46 47; do printf '\\033[%s;%s;%sm %02s;%02s\\033[0m' $attr $fore $back $fore $back done printf '\\n' done printf '\\033[0m' done solarized color #!/bin/bash # solarized ansicolors (exporting for grins) export base03='\\033[0;30;40m' export base02='\\033[1;30;40m' export base01='\\033[0;32;40m' export base00='\\033[0;33;40m' export base0='\\033[0;34;40m' export base1='\\033[0;36;40m' export base2='\\033[0;37;40m' export base3='\\033[1;37;40m' export yellow='\\033[1;33;40m' export orange='\\033[0;31;40m' export red='\\033[1;31;40m' export magenta='\\033[1;35;40m' export violet='\\033[0;35;40m' export blue='\\033[1;34;40m' export cyan='\\033[1;36;40m' export green='\\033[1;32;40m' export reset='\\033[0m' colors () { echo -e \"base03 ${base03}Test$reset\" echo -e \"base02 ${base02}Test$reset\" echo -e \"base01 ${base01}Test$reset\" echo -e \"base00 ${base00}Test$reset\" echo -e \"base0 ${base0}Test$reset\" echo -e \"base1 ${base1}Test$reset\" echo -e \"base2 ${base2}Test$reset\" echo -e \"base3 ${base3}Test$reset\" echo -e \"yellow ${yellow}Test$reset\" echo -e \"orange ${orange}Test$reset\" echo -e \"red ${red}Test$reset\" echo -e \"magenta ${magenta}Test$reset\" echo -e \"violet ${violet}Test$reset\" echo -e \"blue ${blue}Test$reset\" echo -e \"cyan ${cyan}Test$reset\" echo -e \"green ${green}Test$reset\" } colors xterm 256 colors [!TIP] Web colors blue brown cyan gray.black green orange pink purple.magenta red white yellow xterm 256 colors chart 256 colors cheat sheet XTERM NUMBER XTERM NAME HEX RGB HSL ANSI COLOR CODE 0 blackBlack (SYSTEM) #000000 rgb(0,0,0) hsl(0,0%,0%) \\e[38;5;0m 1 redMaroon (SYSTEM) #800000 rgb(128,0,0) hsl(0,100%,25%) \\e[38;5;1m 2 greenGreen (SYSTEM) #008000 rgb(0,128,0) hsl(120,100%,25%) \\e[38;5;2m 3 yellowOlive (SYSTEM) #808000 rgb(128,128,0) hsl(60,100%,25%) \\e[38;5;3m 4 blueNavy (SYSTEM) #000080 rgb(0,0,128) hsl(240,100%,25%) \\e[38;5;4m 5 magentaPurple (SYSTEM) #800080 rgb(128,0,128) hsl(300,100%,25%) \\e[38;5;5m 6 cyanTeal (SYSTEM) #008080 rgb(0,128,128) hsl(180,100%,25%) \\e[38;5;6m 7 light_graySilver (SYSTEM) #c0c0c0 rgb(192,192,192) hsl(0,0%,75%) \\e[38;5;7m 8 dark_grayGrey (SYSTEM) #808080 rgb(128,128,128) hsl(0,0%,50%) \\e[38;5;8m 9 light_redRed (SYSTEM) #ff0000 rgb(255,0,0) hsl(0,100%,50%) \\e[38;5;9m 10 light_greenLime (SYSTEM) #00ff00 rgb(0,255,0) hsl(120,100%,50%) \\e[38;5;10m 11 light_yellowYellow (SYSTEM) #ffff00 rgb(255,255,0) hsl(60,100%,50%) \\e[38;5;11m 12 light_blueBlue (SYSTEM) #0000ff rgb(0,0,255) hsl(240,100%,50%) \\e[38;5;12m 13 light_magentaFuchsia (SYSTEM) #ff00ff rgb(255,0,255) hsl(300,100%,50%) \\e[38;5;13m 14 light_cyanAqua (SYSTEM) #00ffff rgb(0,255,255) hsl(180,100%,50%) \\e[38;5;14m 15 whiteWhite (SYSTEM) #ffffff rgb(255,255,255) hsl(0,0%,100%) \\e[38;5;15m 16 grey_0Grey0 #000000 rgb(0,0,0) hsl(0,0%,0%) \\e[38;5;16m 17 navy_blueNavyBlue #00005f rgb(0,0,95) hsl(240,100%,18%) \\e[38;5;17m 18 dark_blueDarkBlue #000087 rgb(0,0,135) hsl(240,100%,26%) \\e[38;5;18m 19 blue_3aBlue3 #0000af rgb(0,0,175) hsl(240,100%,34%) \\e[38;5;19m 20 blue_3bBlue3 #0000d7 rgb(0,0,215) hsl(240,100%,42%) \\e[38;5;20m 21 blue_1Blue1 #0000ff rgb(0,0,255) hsl(240,100%,50%) \\e[38;5;21m 22 dark_greenDarkGreen #005f00 rgb(0,95,0) hsl(120,100%,18%) \\e[38;5;22m 23 deep_sky_blue_4aDeepSkyBlue4 #005f5f rgb(0,95,95) hsl(180,100%,18%) \\e[38;5;23m 24 deep_sky_blue_4bDeepSkyBlue4 #005f87 rgb(0,95,135) hsl(97,100%,26%) \\e[38;5;24m 25 deep_sky_blue_4cDeepSkyBlue4 #005faf rgb(0,95,175) hsl(07,100%,34%) \\e[38;5;25m 26 dodger_blue_3DodgerBlue3 #005fd7 rgb(0,95,215) hsl(13,100%,42%) \\e[38;5;26m 27 dodger_blue_2DodgerBlue2 #005fff rgb(0,95,255) hsl(17,100%,50%) \\e[38;5;27m 28 green_4Green4 #008700 rgb(0,135,0) hsl(120,100%,26%) \\e[38;5;28m 29 spring_green_4SpringGreen4 #00875f rgb(0,135,95) hsl(62,100%,26%) \\e[38;5;29m 30 turquoise_4Turquoise4 #008787 rgb(0,135,135) hsl(180,100%,26%) \\e[38;5;30m 31 deep_sky_blue_3aDeepSkyBlue3 #0087af rgb(0,135,175) hsl(93,100%,34%) \\e[38;5;31m 32 deep_sky_blue_3bDeepSkyBlue3 #0087d7 rgb(0,135,215) hsl(02,100%,42%) \\e[38;5;32m 33 dodger_blue_1DodgerBlue1 #0087ff rgb(0,135,255) hsl(08,100%,50%) \\e[38;5;33m 34 green_3aGreen3 #00af00 rgb(0,175,0) hsl(120,100%,34%) \\e[38;5;34m 35 spring_green_3aSpringGreen3 #00af5f rgb(0,175,95) hsl(52,100%,34%) \\e[38;5;35m 36 dark_cyanDarkCyan #00af87 rgb(0,175,135) hsl(66,100%,34%) \\e[38;5;36m 37 light_sea_greenLightSeaGreen #00afaf rgb(0,175,175) hsl(180,100%,34%) \\e[38;5;37m 38 deep_sky_blue_2DeepSkyBlue2 #00afd7 rgb(0,175,215) hsl(91,100%,42%) \\e[38;5;38m 39 deep_sky_blue_1DeepSkyBlue1 #00afff rgb(0,175,255) hsl(98,100%,50%) \\e[38;5;39m 40 green_3bGreen3 #00d700 rgb(0,215,0) hsl(120,100%,42%) \\e[38;5;40m 41 spring_green_3bSpringGreen3 #00d75f rgb(0,215,95) hsl(46,100%,42%) \\e[38;5;41m 42 spring_green_2aSpringGreen2 #00d787 rgb(0,215,135) hsl(57,100%,42%) \\e[38;5;42m 43 cyan_3Cyan3 #00d7af rgb(0,215,175) hsl(68,100%,42%) \\e[38;5;43m 44 dark_turquoiseDarkTurquoise #00d7d7 rgb(0,215,215) hsl(180,100%,42%) \\e[38;5;44m 45 turquoise_2Turquoise2 #00d7ff rgb(0,215,255) hsl(89,100%,50%) \\e[38;5;45m 46 green_1Green1 #00ff00 rgb(0,255,0) hsl(120,100%,50%) \\e[38;5;46m 47 spring_green_2bSpringGreen2 #00ff5f rgb(0,255,95) hsl(42,100%,50%) \\e[38;5;47m 48 spring_green_1SpringGreen1 #00ff87 rgb(0,255,135) hsl(51,100%,50%) \\e[38;5;48m 49 medium_spring_greenMediumSpringGreen #00ffaf rgb(0,255,175) hsl(61,100%,50%) \\e[38;5;49m 50 cyan_2Cyan2 #00ffd7 rgb(0,255,215) hsl(70,100%,50%) \\e[38;5;50m 51 cyan_1Cyan1 #00ffff rgb(0,255,255) hsl(180,100%,50%) \\e[38;5;51m 52 dark_red_1DarkRed #5f0000 rgb(95,0,0) hsl(0,100%,18%) \\e[38;5;52m 53 deep_pink_4aDeepPink4 #5f005f rgb(95,0,95) hsl(300,100%,18%) \\e[38;5;53m 54 purple_4aPurple4 #5f0087 rgb(95,0,135) hsl(82,100%,26%) \\e[38;5;54m 55 purple_4bPurple4 #5f00af rgb(95,0,175) hsl(72,100%,34%) \\e[38;5;55m 56 purple_3Purple3 #5f00d7 rgb(95,0,215) hsl(66,100%,42%) \\e[38;5;56m 57 blue_violetBlueViolet #5f00ff rgb(95,0,255) hsl(62,100%,50%) \\e[38;5;57m 58 orange_4aOrange4 #5f5f00 rgb(95,95,0) hsl(60,100%,18%) \\e[38;5;58m 59 grey_37Grey37 #5f5f5f rgb(95,95,95) hsl(0,0%,37%) \\e[38;5;59m 60 medium_purple_4MediumPurple4 #5f5f87 rgb(95,95,135) hsl(240,17%,45%) \\e[38;5;60m 61 slate_blue_3aSlateBlue3 #5f5faf rgb(95,95,175) hsl(240,33%,52%) \\e[38;5;61m 62 slate_blue_3bSlateBlue3 #5f5fd7 rgb(95,95,215) hsl(240,60%,60%) \\e[38;5;62m 63 royal_blue_1RoyalBlue1 #5f5fff rgb(95,95,255) hsl(240,100%,68%) \\e[38;5;63m 64 chartreuse_4Chartreuse4 #5f8700 rgb(95,135,0) hsl(7,100%,26%) \\e[38;5;64m 65 dark_sea_green_4aDarkSeaGreen4 #5f875f rgb(95,135,95) hsl(120,17%,45%) \\e[38;5;65m 66 pale_turquoise_4PaleTurquoise4 #5f8787 rgb(95,135,135) hsl(180,17%,45%) \\e[38;5;66m 67 steel_blueSteelBlue #5f87af rgb(95,135,175) hsl(210,33%,52%) \\e[38;5;67m 68 steel_blue_3SteelBlue3 #5f87d7 rgb(95,135,215) hsl(220,60%,60%) \\e[38;5;68m 69 cornflower_blueCornflowerBlue #5f87ff rgb(95,135,255) hsl(225,100%,68%) \\e[38;5;69m 70 chartreuse_3aChartreuse3 #5faf00 rgb(95,175,0) hsl(7,100%,34%) \\e[38;5;70m 71 dark_sea_green_4bDarkSeaGreen4 #5faf5f rgb(95,175,95) hsl(120,33%,52%) \\e[38;5;71m 72 cadet_blue_2CadetBlue #5faf87 rgb(95,175,135) hsl(150,33%,52%) \\e[38;5;72m 73 cadet_blue_1CadetBlue #5fafaf rgb(95,175,175) hsl(180,33%,52%) \\e[38;5;73m 74 sky_blue_3SkyBlue3 #5fafd7 rgb(95,175,215) hsl(200,60%,60%) \\e[38;5;74m 75 steel_blue_1aSteelBlue1 #5fafff rgb(95,175,255) hsl(210,100%,68%) \\e[38;5;75m 76 chartreuse_3bChartreuse3 #5fd700 rgb(95,215,0) hsl(3,100%,42%) \\e[38;5;76m 77 pale_green_3aPaleGreen3 #5fd75f rgb(95,215,95) hsl(120,60%,60%) \\e[38;5;77m 78 sea_green_3SeaGreen3 #5fd787 rgb(95,215,135) hsl(140,60%,60%) \\e[38;5;78m 79 aquamarine_3Aquamarine3 #5fd7af rgb(95,215,175) hsl(160,60%,60%) \\e[38;5;79m 80 medium_turquoiseMediumTurquoise #5fd7d7 rgb(95,215,215) hsl(180,60%,60%) \\e[38;5;80m 81 steel_blue_1bSteelBlue1 #5fd7ff rgb(95,215,255) hsl(195,100%,68%) \\e[38;5;81m 82 chartreuse_2aChartreuse2 #5fff00 rgb(95,255,0) hsl(7,100%,50%) \\e[38;5;82m 83 sea_green_2SeaGreen2 #5fff5f rgb(95,255,95) hsl(120,100%,68%) \\e[38;5;83m 84 sea_green_1aSeaGreen1 #5fff87 rgb(95,255,135) hsl(135,100%,68%) \\e[38;5;84m 85 sea_green_1bSeaGreen1 #5fffaf rgb(95,255,175) hsl(150,100%,68%) \\e[38;5;85m 86 aquamarine_1aAquamarine1 #5fffd7 rgb(95,255,215) hsl(165,100%,68%) \\e[38;5;86m 87 dark_slate_gray_2DarkSlateGray2 #5fffff rgb(95,255,255) hsl(180,100%,68%) \\e[38;5;87m 88 dark_red_2DarkRed #870000 rgb(135,0,0) hsl(0,100%,26%) \\e[38;5;88m 89 deep_pink_4bDeepPink4 #87005f rgb(135,0,95) hsl(17,100%,26%) \\e[38;5;89m 90 dark_magenta_1DarkMagenta #870087 rgb(135,0,135) hsl(300,100%,26%) \\e[38;5;90m 91 dark_magenta_2DarkMagenta #8700af rgb(135,0,175) hsl(86,100%,34%) \\e[38;5;91m 92 dark_violet_1aDarkViolet #8700d7 rgb(135,0,215) hsl(77,100%,42%) \\e[38;5;92m 93 purple_1aPurple #8700ff rgb(135,0,255) hsl(71,100%,50%) \\e[38;5;93m 94 orange_4bOrange4 #875f00 rgb(135,95,0) hsl(2,100%,26%) \\e[38;5;94m 95 light_pink_4LightPink4 #875f5f rgb(135,95,95) hsl(0,17%,45%) \\e[38;5;95m 96 plum_4Plum4 #875f87 rgb(135,95,135) hsl(300,17%,45%) \\e[38;5;96m 97 medium_purple_3aMediumPurple3 #875faf rgb(135,95,175) hsl(270,33%,52%) \\e[38;5;97m 98 medium_purple_3bMediumPurple3 #875fd7 rgb(135,95,215) hsl(260,60%,60%) \\e[38;5;98m 99 slate_blue_1SlateBlue1 #875fff rgb(135,95,255) hsl(255,100%,68%) \\e[38;5;99m 100 yellow_4aYellow4 #878700 rgb(135,135,0) hsl(60,100%,26%) \\e[38;5;100m 101 wheat_4Wheat4 #87875f rgb(135,135,95) hsl(60,17%,45%) \\e[38;5;101m 102 grey_53Grey53 #878787 rgb(135,135,135) hsl(0,0%,52%) \\e[38;5;102m 103 light_slate_greyLightSlateGrey #8787af rgb(135,135,175) hsl(240,20%,60%) \\e[38;5;103m 104 medium_purpleMediumPurple #8787d7 rgb(135,135,215) hsl(240,50%,68%) \\e[38;5;104m 105 light_slate_blueLightSlateBlue #8787ff rgb(135,135,255) hsl(240,100%,76%) \\e[38;5;105m 106 yellow_4bYellow4 #87af00 rgb(135,175,0) hsl(3,100%,34%) \\e[38;5;106m 107 dark_olive_green_3aDarkOliveGreen3 #87af5f rgb(135,175,95) hsl(90,33%,52%) \\e[38;5;107m 108 dark_green_seaDarkSeaGreen #87af87 rgb(135,175,135) hsl(120,20%,60%) \\e[38;5;108m 109 light_sky_blue_3aLightSkyBlue3 #87afaf rgb(135,175,175) hsl(180,20%,60%) \\e[38;5;109m 110 light_sky_blue_3bLightSkyBlue3 #87afd7 rgb(135,175,215) hsl(210,50%,68%) \\e[38;5;110m 111 sky_blue_2SkyBlue2 #87afff rgb(135,175,255) hsl(220,100%,76%) \\e[38;5;111m 112 chartreuse_2bChartreuse2 #87d700 rgb(135,215,0) hsl(2,100%,42%) \\e[38;5;112m 113 dark_olive_green_3bDarkOliveGreen3 #87d75f rgb(135,215,95) hsl(100,60%,60%) \\e[38;5;113m 114 pale_green_3bPaleGreen3 #87d787 rgb(135,215,135) hsl(120,50%,68%) \\e[38;5;114m 115 dark_sea_green_3aDarkSeaGreen3 #87d7af rgb(135,215,175) hsl(150,50%,68%) \\e[38;5;115m 116 dark_slate_gray_3DarkSlateGray3 #87d7d7 rgb(135,215,215) hsl(180,50%,68%) \\e[38;5;116m 117 sky_blue_1SkyBlue1 #87d7ff rgb(135,215,255) hsl(200,100%,76%) \\e[38;5;117m 118 chartreuse_1Chartreuse1 #87ff00 rgb(135,255,0) hsl(8,100%,50%) \\e[38;5;118m 119 light_green_2LightGreen #87ff5f rgb(135,255,95) hsl(105,100%,68%) \\e[38;5;119m 120 light_green_3LightGreen #87ff87 rgb(135,255,135) hsl(120,100%,76%) \\e[38;5;120m 121 pale_green_1aPaleGreen1 #87ffaf rgb(135,255,175) hsl(140,100%,76%) \\e[38;5;121m 122 aquamarine_1bAquamarine1 #87ffd7 rgb(135,255,215) hsl(160,100%,76%) \\e[38;5;122m 123 dark_slate_gray_1DarkSlateGray1 #87ffff rgb(135,255,255) hsl(180,100%,76%) \\e[38;5;123m 124 red_3aRed3 #af0000 rgb(175,0,0) hsl(0,100%,34%) \\e[38;5;124m 125 deep_pink_4cDeepPink4 #af005f rgb(175,0,95) hsl(27,100%,34%) \\e[38;5;125m 126 medium_violet_redMediumVioletRed #af0087 rgb(175,0,135) hsl(13,100%,34%) \\e[38;5;126m 127 magenta_3aMagenta3 #af00af rgb(175,0,175) hsl(300,100%,34%) \\e[38;5;127m 128 dark_violet_1bDarkViolet #af00d7 rgb(175,0,215) hsl(88,100%,42%) \\e[38;5;128m 129 purple_1bPurple #af00ff rgb(175,0,255) hsl(81,100%,50%) \\e[38;5;129m 130 dark_orange_3aDarkOrange3 #af5f00 rgb(175,95,0) hsl(2,100%,34%) \\e[38;5;130m 131 indian_red_1aIndianRed #af5f5f rgb(175,95,95) hsl(0,33%,52%) \\e[38;5;131m 132 hot_pink_3aHotPink3 #af5f87 rgb(175,95,135) hsl(330,33%,52%) \\e[38;5;132m 133 medium_orchid_3MediumOrchid3 #af5faf rgb(175,95,175) hsl(300,33%,52%) \\e[38;5;133m 134 medium_orchidMediumOrchid #af5fd7 rgb(175,95,215) hsl(280,60%,60%) \\e[38;5;134m 135 medium_purple_2aMediumPurple2 #af5fff rgb(175,95,255) hsl(270,100%,68%) \\e[38;5;135m 136 dark_goldenrodDarkGoldenrod #af8700 rgb(175,135,0) hsl(6,100%,34%) \\e[38;5;136m 137 light_salmon_3aLightSalmon3 #af875f rgb(175,135,95) hsl(30,33%,52%) \\e[38;5;137m 138 rosy_brownRosyBrown #af8787 rgb(175,135,135) hsl(0,20%,60%) \\e[38;5;138m 139 grey_63Grey63 #af87af rgb(175,135,175) hsl(300,20%,60%) \\e[38;5;139m 140 medium_purple_2bMediumPurple2 #af87d7 rgb(175,135,215) hsl(270,50%,68%) \\e[38;5;140m 141 medium_purple_1MediumPurple1 #af87ff rgb(175,135,255) hsl(260,100%,76%) \\e[38;5;141m 142 gold_3aGold3 #afaf00 rgb(175,175,0) hsl(60,100%,34%) \\e[38;5;142m 143 dark_khakiDarkKhaki #afaf5f rgb(175,175,95) hsl(60,33%,52%) \\e[38;5;143m 144 navajo_white_3NavajoWhite3 #afaf87 rgb(175,175,135) hsl(60,20%,60%) \\e[38;5;144m 145 grey_69Grey69 #afafaf rgb(175,175,175) hsl(0,0%,68%) \\e[38;5;145m 146 light_steel_blue_3LightSteelBlue3 #afafd7 rgb(175,175,215) hsl(240,33%,76%) \\e[38;5;146m 147 light_steel_blueLightSteelBlue #afafff rgb(175,175,255) hsl(240,100%,84%) \\e[38;5;147m 148 yellow_3aYellow3 #afd700 rgb(175,215,0) hsl(1,100%,42%) \\e[38;5;148m 149 dark_olive_green_3DarkOliveGreen3 #afd75f rgb(175,215,95) hsl(80,60%,60%) \\e[38;5;149m 150 dark_sea_green_3bDarkSeaGreen3 #afd787 rgb(175,215,135) hsl(90,50%,68%) \\e[38;5;150m 151 dark_sea_green_2DarkSeaGreen2 #afd7af rgb(175,215,175) hsl(120,33%,76%) \\e[38;5;151m 152 light_cyan_3LightCyan3 #afd7d7 rgb(175,215,215) hsl(180,33%,76%) \\e[38;5;152m 153 light_sky_blue_1LightSkyBlue1 #afd7ff rgb(175,215,255) hsl(210,100%,84%) \\e[38;5;153m 154 green_yellowGreenYellow #afff00 rgb(175,255,0) hsl(8,100%,50%) \\e[38;5;154m 155 dark_olive_green_2DarkOliveGreen2 #afff5f rgb(175,255,95) hsl(90,100%,68%) \\e[38;5;155m 156 pale_green_1bPaleGreen1 #afff87 rgb(175,255,135) hsl(100,100%,76%) \\e[38;5;156m 157 dark_sea_green_5bDarkSeaGreen2 #afffaf rgb(175,255,175) hsl(120,100%,84%) \\e[38;5;157m 158 dark_sea_green_5aDarkSeaGreen1 #afffd7 rgb(175,255,215) hsl(150,100%,84%) \\e[38;5;158m 159 pale_turquoise_1PaleTurquoise1 #afffff rgb(175,255,255) hsl(180,100%,84%) \\e[38;5;159m 160 red_3bRed3 #d70000 rgb(215,0,0) hsl(0,100%,42%) \\e[38;5;160m 161 deep_pink_3aDeepPink3 #d7005f rgb(215,0,95) hsl(33,100%,42%) \\e[38;5;161m 162 deep_pink_3bDeepPink3 #d70087 rgb(215,0,135) hsl(22,100%,42%) \\e[38;5;162m 163 magenta_3bMagenta3 #d700af rgb(215,0,175) hsl(11,100%,42%) \\e[38;5;163m 164 magenta_3cMagenta3 #d700d7 rgb(215,0,215) hsl(300,100%,42%) \\e[38;5;164m 165 magenta_2aMagenta2 #d700ff rgb(215,0,255) hsl(90,100%,50%) \\e[38;5;165m 166 dark_orange_3bDarkOrange3 #d75f00 rgb(215,95,0) hsl(6,100%,42%) \\e[38;5;166m 167 indian_red_1bIndianRed #d75f5f rgb(215,95,95) hsl(0,60%,60%) \\e[38;5;167m 168 hot_pink_3bHotPink3 #d75f87 rgb(215,95,135) hsl(340,60%,60%) \\e[38;5;168m 169 hot_pink_2HotPink2 #d75faf rgb(215,95,175) hsl(320,60%,60%) \\e[38;5;169m 170 orchidOrchid #d75fd7 rgb(215,95,215) hsl(300,60%,60%) \\e[38;5;170m 171 medium_orchid_1aMediumOrchid1 #d75fff rgb(215,95,255) hsl(285,100%,68%) \\e[38;5;171m 172 orange_3Orange3 #d78700 rgb(215,135,0) hsl(7,100%,42%) \\e[38;5;172m 173 light_salmon_3bLightSalmon3 #d7875f rgb(215,135,95) hsl(20,60%,60%) \\e[38;5;173m 174 light_pink_3LightPink3 #d78787 rgb(215,135,135) hsl(0,50%,68%) \\e[38;5;174m 175 pink_3Pink3 #d787af rgb(215,135,175) hsl(330,50%,68%) \\e[38;5;175m 176 plum_3Plum3 #d787d7 rgb(215,135,215) hsl(300,50%,68%) \\e[38;5;176m 177 violetViolet #d787ff rgb(215,135,255) hsl(280,100%,76%) \\e[38;5;177m 178 gold_3bGold3 #d7af00 rgb(215,175,0) hsl(8,100%,42%) \\e[38;5;178m 179 light_goldenrod_3LightGoldenrod3 #d7af5f rgb(215,175,95) hsl(40,60%,60%) \\e[38;5;179m 180 tanTan #d7af87 rgb(215,175,135) hsl(30,50%,68%) \\e[38;5;180m 181 misty_rose_3MistyRose3 #d7afaf rgb(215,175,175) hsl(0,33%,76%) \\e[38;5;181m 182 thistle_3Thistle3 #d7afd7 rgb(215,175,215) hsl(300,33%,76%) \\e[38;5;182m 183 plum_2Plum2 #d7afff rgb(215,175,255) hsl(270,100%,84%) \\e[38;5;183m 184 yellow_3bYellow3 #d7d700 rgb(215,215,0) hsl(60,100%,42%) \\e[38;5;184m 185 khaki_3Khaki3 #d7d75f rgb(215,215,95) hsl(60,60%,60%) \\e[38;5;185m 186 light_goldenrod_2aLightGoldenrod2 #d7d787 rgb(215,215,135) hsl(60,50%,68%) \\e[38;5;186m 187 light_yellow_3LightYellow3 #d7d7af rgb(215,215,175) hsl(60,33%,76%) \\e[38;5;187m 188 grey_84Grey84 #d7d7d7 rgb(215,215,215) hsl(0,0%,84%) \\e[38;5;188m 189 light_steel_blue_1LightSteelBlue1 #d7d7ff rgb(215,215,255) hsl(240,100%,92%) \\e[38;5;189m 190 yellow_2Yellow2 #d7ff00 rgb(215,255,0) hsl(9,100%,50%) \\e[38;5;190m 191 dark_olive_green_1aDarkOliveGreen1 #d7ff5f rgb(215,255,95) hsl(75,100%,68%) \\e[38;5;191m 192 dark_olive_green_1bDarkOliveGreen1 #d7ff87 rgb(215,255,135) hsl(80,100%,76%) \\e[38;5;192m 193 dark_sea_green_1DarkSeaGreen1 #d7ffaf rgb(215,255,175) hsl(90,100%,84%) \\e[38;5;193m 194 honeydew_2Honeydew2 #d7ffd7 rgb(215,255,215) hsl(120,100%,92%) \\e[38;5;194m 195 light_cyan_1LightCyan1 #d7ffff rgb(215,255,255) hsl(180,100%,92%) \\e[38;5;195m 196 red_1Red1 #ff0000 rgb(255,0,0) hsl(0,100%,50%) \\e[38;5;196m 197 deep_pink_2DeepPink2 #ff005f rgb(255,0,95) hsl(37,100%,50%) \\e[38;5;197m 198 deep_pink_1aDeepPink1 #ff0087 rgb(255,0,135) hsl(28,100%,50%) \\e[38;5;198m 199 deep_pink_1bDeepPink1 #ff00af rgb(255,0,175) hsl(18,100%,50%) \\e[38;5;199m 200 magenta_2bMagenta2 #ff00d7 rgb(255,0,215) hsl(09,100%,50%) \\e[38;5;200m 201 magenta_1Magenta1 #ff00ff rgb(255,0,255) hsl(300,100%,50%) \\e[38;5;201m 202 orange_red_1OrangeRed1 #ff5f00 rgb(255,95,0) hsl(2,100%,50%) \\e[38;5;202m 203 indian_red_1cIndianRed1 #ff5f5f rgb(255,95,95) hsl(0,100%,68%) \\e[38;5;203m 204 indian_red_1dIndianRed1 #ff5f87 rgb(255,95,135) hsl(345,100%,68%) \\e[38;5;204m 205 hot_pink_1aHotPink #ff5faf rgb(255,95,175) hsl(330,100%,68%) \\e[38;5;205m 206 hot_pink_1bHotPink #ff5fd7 rgb(255,95,215) hsl(315,100%,68%) \\e[38;5;206m 207 medium_orchid_1bMediumOrchid1 #ff5fff rgb(255,95,255) hsl(300,100%,68%) \\e[38;5;207m 208 dark_orangeDarkOrange #ff8700 rgb(255,135,0) hsl(1,100%,50%) \\e[38;5;208m 209 salmon_1Salmon1 #ff875f rgb(255,135,95) hsl(15,100%,68%) \\e[38;5;209m 210 light_coralLightCoral #ff8787 rgb(255,135,135) hsl(0,100%,76%) \\e[38;5;210m 211 pale_violet_red_1PaleVioletRed1 #ff87af rgb(255,135,175) hsl(340,100%,76%) \\e[38;5;211m 212 orchid_2Orchid2 #ff87d7 rgb(255,135,215) hsl(320,100%,76%) \\e[38;5;212m 213 orchid_1Orchid1 #ff87ff rgb(255,135,255) hsl(300,100%,76%) \\e[38;5;213m 214 orange_1Orange1 #ffaf00 rgb(255,175,0) hsl(1,100%,50%) \\e[38;5;214m 215 sandy_brownSandyBrown #ffaf5f rgb(255,175,95) hsl(30,100%,68%) \\e[38;5;215m 216 light_salmon_1LightSalmon1 #ffaf87 rgb(255,175,135) hsl(20,100%,76%) \\e[38;5;216m 217 light_pink_1LightPink1 #ffafaf rgb(255,175,175) hsl(0,100%,84%) \\e[38;5;217m 218 pink_1Pink1 #ffafd7 rgb(255,175,215) hsl(330,100%,84%) \\e[38;5;218m 219 plum_1Plum1 #ffafff rgb(255,175,255) hsl(300,100%,84%) \\e[38;5;219m 220 gold_1Gold1 #ffd700 rgb(255,215,0) hsl(0,100%,50%) \\e[38;5;220m 221 light_goldenrod_2bLightGoldenrod2 #ffd75f rgb(255,215,95) hsl(45,100%,68%) \\e[38;5;221m 222 light_goldenrod_2cLightGoldenrod2 #ffd787 rgb(255,215,135) hsl(40,100%,76%) \\e[38;5;222m 223 navajo_white_1NavajoWhite1 #ffd7af rgb(255,215,175) hsl(30,100%,84%) \\e[38;5;223m 224 misty_rose1MistyRose1 #ffd7d7 rgb(255,215,215) hsl(0,100%,92%) \\e[38;5;224m 225 thistle_1Thistle1 #ffd7ff rgb(255,215,255) hsl(300,100%,92%) \\e[38;5;225m 226 yellow_1Yellow1 #ffff00 rgb(255,255,0) hsl(60,100%,50%) \\e[38;5;226m 227 light_goldenrod_1LightGoldenrod1 #ffff5f rgb(255,255,95) hsl(60,100%,68%) \\e[38;5;227m 228 khaki_1Khaki1 #ffff87 rgb(255,255,135) hsl(60,100%,76%) \\e[38;5;228m 229 wheat_1Wheat1 #ffffaf rgb(255,255,175) hsl(60,100%,84%) \\e[38;5;229m 230 cornsilk_1Cornsilk1 #ffffd7 rgb(255,255,215) hsl(60,100%,92%) \\e[38;5;230m 231 grey_100Grey100 #ffffff rgb(255,255,255) hsl(0,0%,100%) \\e[38;5;231m 232 grey_3Grey3 #080808 rgb(8,8,8) hsl(0,0%,3%) \\e[38;5;232m 233 grey_7Grey7 #121212 rgb(18,18,18) hsl(0,0%,7%) \\e[38;5;233m 234 grey_11Grey11 #1c1c1c rgb(28,28,28) hsl(0,0%,10%) \\e[38;5;234m 235 grey_15Grey15 #262626 rgb(38,38,38) hsl(0,0%,14%) \\e[38;5;235m 236 grey_19Grey19 #303030 rgb(48,48,48) hsl(0,0%,18%) \\e[38;5;236m 237 grey_23Grey23 #3a3a3a rgb(58,58,58) hsl(0,0%,22%) \\e[38;5;237m 238 grey_27Grey27 #444444 rgb(68,68,68) hsl(0,0%,26%) \\e[38;5;238m 239 grey_30Grey30 #4e4e4e rgb(78,78,78) hsl(0,0%,30%) \\e[38;5;239m 240 grey_35Grey35 #585858 rgb(88,88,88) hsl(0,0%,34%) \\e[38;5;240m 241 grey_39Grey39 #626262 rgb(98,98,98) hsl(0,0%,37%) \\e[38;5;241m 242 grey_42Grey42 #6c6c6c rgb(108,108,108) hsl(0,0%,40%) \\e[38;5;242m 243 grey_46Grey46 #767676 rgb(118,118,118) hsl(0,0%,46%) \\e[38;5;243m 244 grey_50Grey50 #808080 rgb(128,128,128) hsl(0,0%,50%) \\e[38;5;244m 245 grey_54Grey54 #8a8a8a rgb(138,138,138) hsl(0,0%,54%) \\e[38;5;245m 246 grey_58Grey58 #949494 rgb(148,148,148) hsl(0,0%,58%) \\e[38;5;246m 247 grey_62Grey62 #9e9e9e rgb(158,158,158) hsl(0,0%,61%) \\e[38;5;247m 248 grey_66Grey66 #a8a8a8 rgb(168,168,168) hsl(0,0%,65%) \\e[38;5;248m 249 grey_70Grey70 #b2b2b2 rgb(178,178,178) hsl(0,0%,69%) \\e[38;5;249m 250 grey_74Grey74 #bcbcbc rgb(188,188,188) hsl(0,0%,73%) \\e[38;5;250m 251 grey_78Grey78 #c6c6c6 rgb(198,198,198) hsl(0,0%,77%) \\e[38;5;251m 252 grey_82Grey82 #d0d0d0 rgb(208,208,208) hsl(0,0%,81%) \\e[38;5;252m 253 grey_85Grey85 #dadada rgb(218,218,218) hsl(0,0%,85%) \\e[38;5;253m 254 grey_89Grey89 #e4e4e4 rgb(228,228,228) hsl(0,0%,89%) \\e[38;5;254m 255 grey_93Grey93 #eeeeee rgb(238,238,238) hsl(0,0%,93%) \\e[38;5;255m man page colors references: Bug 666587 - Some man pages include partial escape codes in output when piped or redirected Bug 81003 - xman displays terminal control sequences How to install man pages on CentOS Linux 6/7/8 Using Color with less Colors in Man Pages How to View Colored Man Pages in Linux? Documentation on LESSTERMCAP* variables? settings printf # The color of man page export LESS_TERMCAP_mb=$(printf \"\\\\e[1;31m\") # begin blinding export LESS_TERMCAP_md=$(printf \"\\\\e[1;31m\") # begin bold export LESS_TERMCAP_me=$(printf \"\\\\e[0m\") # end mode export LESS_TERMCAP_se=$(printf \"\\\\e[0m\") # end stadout-mode export LESS_TERMCAP_so=$(printf \"\\\\e[1;44;33m\") # begin stadout-mode - info box export LESS_TERMCAP_so=$(printf \"\\\\e[1;33m\") # begin stadout-mode - info box export LESS_TERMCAP_ue=$(printf \"\\\\e[0m\") # end underline export LESS_TERMCAP_us=$(printf \"\\\\e[1;32m\") # begin underline export GROFF_NO_SGR=1 # For Konsole and Gnome-terminal export LESS='-eirMXR' export SYSTEMD_LESS=FRXMK export MANPAGER='less -s -M +Gg' tput export LESS_TERMCAP_mb=$(tput bold; tput setaf 2) # green export LESS_TERMCAP_md=$(tput bold; tput setaf 6) # cyan export LESS_TERMCAP_me=$(tput sgr0) export LESS_TERMCAP_so=$(tput bold; tput setaf 3; tput setab 4) # yellow on blue export LESS_TERMCAP_se=$(tput rmso; tput sgr0) export LESS_TERMCAP_us=$(tput smul; tput bold; tput setaf 7) # white export LESS_TERMCAP_ue=$(tput rmul; tput sgr0) export LESS_TERMCAP_mr=$(tput rev) export LESS_TERMCAP_mh=$(tput dim) export LESS_TERMCAP_ZN=$(tput ssubm) export LESS_TERMCAP_ZV=$(tput rsubm) export LESS_TERMCAP_ZO=$(tput ssupm) export LESS_TERMCAP_ZW=$(tput rsupm) export GROFF_NO_SGR=1 # For Konsole and Gnome-terminal $'\\e' export LESS_TERMCAP_mb=$'\\e[01;31m' # begin blinking export LESS_TERMCAP_md=$'\\e[01;37m' # begin bold export LESS_TERMCAP_me=$'\\e[0m' # end all mode like so, us, mb, md, mr export LESS_TERMCAP_se=$'\\e[0m' # end standout-mode export LESS_TERMCAP_so=$'\\e[45;93m' # start standout mode export LESS_TERMCAP_ue=$'\\e[0m' # end underline export LESS_TERMCAP_us=$'\\e[4;93m' # start underlining using vim as man pager [!TIP] Using vim as a man-page viewer under Unix export PAGER=\"/bin/sh -c \\\"unset PAGER;col -b -x | \\ vim -R -c 'set ft=man nomod nolist' -c 'map q :q' \\ -c 'map ' -c 'map b ' \\ -c 'nmap K :Man =expand(\\\\\\\"\\\\\\\")' -\\\"\" ansicolor issues in man page error 1mNAME0m solution $ yum install man-pages man-db man # or $ sudo yum update man-pages man-db man Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-06 21:20:42 "},"cheatsheet/math.html":{"url":"cheatsheet/math.html","title":"math","keywords":"","body":" sum awk datamash bc jq $(()) sum from file advanced computing logarithm power square decimal to binary binary <> decimal <> hexadecimal [!NOTE|label:references:] Bash 的算术运算 Linux 中bc命令实现自然对数、指数运算、自然指数、平方根的运算 bc to Perform Advanced Arithmetic Operations in BASH Using vim as calculator sum [!INFO|label:references:] Shell command to sum integers, one per line? Summing a List of Numbers awk $ seq 10 | awk '{s+=$1} END {print s}' 55 # or $ awk 'BEGIN{print '\"1+2+3\"'}' 6 file sizes $ ls -l total 12 -rw-r--r-- 1 marslo staff 3480 Dec 21 21:21 README.md -rw-r--r-- 1 marslo staff 7516 Dec 21 21:21 SUMMARY.md drwxr-xr-x 7 marslo staff 224 Sep 19 19:52 artifactory drwxr-xr-x 15 marslo staff 480 Dec 21 21:19 cheatsheet drwxr-xr-x 12 marslo staff 384 Aug 17 21:11 devops drwxr-xr-x 9 marslo staff 288 Sep 29 17:31 jenkins drwxr-xr-x 10 marslo staff 320 Sep 19 19:52 linux drwxr-xr-x 9 marslo staff 288 Sep 19 19:52 osx drwxr-xr-x 6 marslo staff 192 Aug 17 21:11 programming drwxr-xr-x 27 marslo staff 864 Aug 17 22:10 screenshot drwxr-xr-x 7 marslo staff 224 Oct 11 19:41 tools drwxr-xr-x 8 marslo staff 256 Aug 30 16:39 vim drwxr-xr-x 5 marslo staff 160 Aug 17 21:11 virtualization $ ls -l | awk '{sum += $5} END {print sum}' 14676 datamash [!TIP|label:reference:] Shell command to sum integers, one per line? $ seq 10 | datamash sum 1 55 bc paste + bc $ seq 10 | paste -sd+ - 1+2+3+4+5+6+7+8+9+10 $ seq 10 | paste -sd+ - | bc 55 xargs + bc $ seq 10 | xargs printf \"- - %s\" | xargs | bc 55 sed + bc $ seq 10 | sed 's/^/.+/' | bc 1 3 6 10 15 21 28 36 45 55 jq $ seq 10 | jq -s 'add' 55 $(()) $ f=$(seq 10) $ echo $(( ${f//$'\\n'/+} )) 55 # or $ echo $(( $(seq 10 | tr \"\\n\" \"+\") 0 )) 55 # or from file $ echo $(( $( tr \"\\n\" \"+\" sum from file [!NOTE|label:sample file:] $ cat numbers.txt 73.27 218.38 14.15 9.18 16.60 How can I quickly sum all numbers in a file? awk $ awk '{ sum += $1 } END { print sum }' numbers.txt 331.58 paste && bc $ paste -sd+ numbers.txt 73.27+218.38+14.15+9.18+16.60 $ paste -sd+ numbers.txt | bc 331.58 Σn where 1$ seq 100000 | paste -sd+ | bc -l 5000050000 jq $ paste -sd' ' numbers.txt | jq -s add 331.58 advanced computing [!NOTE|label:references:] How to calculate the log of a number using bc? 指数与对数 n次方根 logarithm bc $ bc -l 🫠$ bc -l awk $ echo 512 | awk '{print log($1)/log(2)}' 9 power bc $ bc $(()) $ echo $(( 2**8 )) 256 square $ bc -l decimal to binary [!NOTE|label:references:] Prevent bc from auto truncating leading zeros when converting from hex to binary How to make bc output a desired number of base-2 binary digits bc $ bc binary <> decimal <> hexadecimal [!NOTE] obase : [o]utput base ibase : [i]utput base # bin -> dec $ bc hex $ bc bin $ bc hex $ bc bin $ bc dec $ bc Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/media.html":{"url":"cheatsheet/media.html","title":"media","keywords":"","body":" highly recommanded Video Get Audio from video Convert flv to mp4 convert png to mp4 scale the media(https://www.everythingcli.org/convert-pdf-to-mp4/) Combine video and audio Image convert webp to png identity an image convert svg to png convert HEIC/HEIF to PNG highly recommanded cmd.to Video Get Audio from video $ ffmpeg -i source.mpg -f s16le -acodec pcm_s16le audio.raw Convert flv to mp4 $ ffmpeg -i name.flv -qscale 0 name.mp4 convert png to mp4 options: pic-%02d.png: Read all images from the current folder with the prefix pic-, a following number of 2 digits (%02d) and an ending of .png -r 1/5 : Displays each image for 5 seconds r 30 : Output framerate of 30 fps. -c:v libx264 : Output video codec: h264 pix_fmt yuv420p : YUV pixel format $ ffmpeg -r 1/5 -i pic-%02d.png -c:v libx264 -r 30 -pix_fmt yuv420p out.mp4 scale the media(https://www.everythingcli.org/convert-pdf-to-mp4/) $ ffmpeg -i out.mp4 -vf scale=-1:720 out_720p.mp4 convert to 5 mins (300 sec) $ ffmpeg -i name.mp4 -ss 0 -t 300 name-5m.mp4 sequence convert (every 5 mins ~> 300 secs) first 5 mins (0 ~> 300)$ ffmpeg -i name.mp4 -ss 0 -t 300 name-5m-1.mp4 second 5 mins (300*1 ~> 300)$ ffmpeg -i name.mp4 -ss 300 -t 300 name-5m-2.mp4 third 5 mins (300*2 ~> 300)$ ffmpeg -i name.mp4 -ss 600 -t 300 name-5m-3.mp4 convert pdf to png -density 400 : Set the horizontal resolution of the image $ convert -density 400 input.pdf pic.png Combine video and audio $ ffmpeg -i -i -c copy -map 0:0 -map 1:0 -shortest Image convert webp to png $ ffmpeg -i file.webp out.png for multiple images$ for x in ls *.webp; do ffmpeg -i \"$x\" \"${x%.webp}.jpg\" done identity an image $ identify arms009.jpg | grep -o \"[[:digit:]]*x[[:digit:]]*\" | tail -1 1024x768 convert svg to png references: Command-line application for converting SVG to PNG on Mac OS X \"Bake\" an SVG image into a PNG at a given resolution? [closed] Converting large SVG to PNG file qlmanage $ qlmanage -t -s 1000 -o . k-1.svg convert $ convert -resize 128x128 input.svg output.png # or $ convert -density 500 -resize 128x128 input.svg output.png $ convert -density 1200 -resize 10000x10000 your.svg your.png $ convert -background none -size 1024x1024 infile.svg outfile.png convert HEIC/HEIF to PNG $ brew install imagemagick --with-libheif # for single convert $ magick convert [-monitor] .HEIC .png # for batch convert $ magick mogrify [-monitor] -format png *.HEIC. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/ssl/ssl.html":{"url":"cheatsheet/ssl/ssl.html","title":"ssl","keywords":"","body":" openssl ssl cert create cert for server ca (root cert) cert for server (csr) generate cert for client (cert) and singed by CA Update the file perm verify certificate in Nginx get remote server certs keytool openssl cheatsheet generate private key and csr generate a self-signed certificate check ssl certificate check who has issued the ssl certificate check whom the ssl certificate is issued to check for what dates the ssl certificate is valid show multiple informations show fingerprint extract all information from the ssl certificate (decoded) show the ssl certificate check ssl certificate expiration date verifying the keys match manage certificate in OS (client) OSX add search remove others Windows Linux ubuntu Artifactory HTTPS [!TIP|label:see also] * imarslo : kubernetes/certificates * iMarslo : artifactory/certificates * k8s: Generate Certificates Manually easyrsa openssl cfssl * 手动生成证书 reference: * cheatsheet: Check SSL Certificate with OpenSSL * cheatsheet: Check SSL Certificate Chain with OpenSSL Examples Understanding X509 Certificate with Openssl Command Protect the Docker daemon socket generating SSL Certificates sethvargo/create-certs.sh How can I add a private key to my keychain? Kubernetes Authentication and Authorization with X509 client certificates Proactively Handling Certificate Expiration With ssl-cert-check Matty9191/ssl-cert-check Converting a Java Keystore into PEM Format *.jks - keystore in java format. *.p12 - keystore in PKCS#12 format. *.pem - all keys and certs from keystore, in PEM format. Additional Keystore Formats (PKCS12) How to setup Microsoft Active Directory Certificate Services [AD CS] openssl check version $ openssl version OpenSSL 3.1.2 1 Aug 2023 (Library: OpenSSL 3.1.2 1 Aug 2023) $ openssl version -a OpenSSL 3.1.2 1 Aug 2023 (Library: OpenSSL 3.1.2 1 Aug 2023) built on: Tue Aug 1 13:36:55 2023 UTC platform: darwin64-x86_64-cc options: bn(64,64) compiler: clang -fPIC -arch x86_64 -O3 -Wall -DL_ENDIAN -DOPENSSL_PIC -D_REENTRANT -DOPENSSL_BUILDING_OPENSSL -DNDEBUG OPENSSLDIR: \"/usr/local/etc/openssl@3\" ENGINESDIR: \"/usr/local/Cellar/openssl@3/3.1.2/lib/engines-3\" MODULESDIR: \"/usr/local/Cellar/openssl@3/3.1.2/lib/ossl-modules\" Seeding source: os-specific CPUINFO: OPENSSL_ia32cap=0x7ffaf3bfffebffff:0x40000000029c67af $ openssl version -d OPENSSLDIR: \"/usr/local/etc/openssl@3\" ssl cert create cert for server ca (root cert) commandmore details$ openssl genrsa -aes256 -out ca.key 2048 $ openssl req -new \\ -x509 \\ -sha256 \\ -days 365 \\ -key ca.key \\ -out ca.crt \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=sample.artifactory.com\"$ openssl genrsa -aes256 -out ca.key 2048 Generating RSA private key, 2048 bit long modulus ....................................................................+++ ...................................................+++ unable to write 'random state' e is 65537 (0x10001) Enter pass phrase for ca.key:artifactory Verifying - Enter pass phrase for ca.key:artifactory $ openssl req -new \\ -x509 \\ -sha256 \\ -days 365 \\ -key ca.key \\ -out ca.crt \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com\" Enter pass phrase for ca.key:artifactory cert for server (csr) commandmore details$ openssl genrsa -out server.key 2048 $ openssl req -new\\ -sha256 \\ -key server.key \\ -out server.csr \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com\"$ openssl genrsa -out server.key 2048 Generating RSA private key, 2048 bit long modulus ......................................................................+++ ............................................................................................................................................................................................................................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req -new \\ -sha256 \\ -key server.key \\ -out server.csr \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com\" sign the server cert with CA commandmore details$ echo subjectAltName = DNS:sample.artifactory.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -CAcreateserial \\ -CA ca.crt \\ -CAkey ca.key \\ -in server.csr \\ -out server.crt \\ -extfile extfile.cnf$ echo subjectAltName = DNS:sample.artifactory.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -CAcreateserial \\ -CA ca.crt \\ -CAkey ca.key \\ -in server.csr \\ -out server.crt \\ -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com Getting CA Private Key Enter pass phrase for ca.key:artifactory unable to write 'random state' $ ls extfile.cnf ca.key server.csr www.srl ca.crt server.crt server.key generate cert for client (cert) and singed by CA commandmore details$ openssl genrsa -out client.key $ openssl req -new \\ -key client.key \\ -out client.csr \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com\" $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -CAcreateserial \\ -CA ca.crt \\ -CAkey ca.key \\ -in client.csr \\ -out client.cert \\ -extfile extfile.cnf$ openssl genrsa -out client.key 2048 Generating RSA private key, 2048 bit long modulus ................................................+++ .......................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req -new \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com\" \\ -key client.key \\ -out client.csr $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ cat extfile.cnf subjectAltName = DNS:sample.artifactory.com,IP:130.147.219.19 gxtendedKeyUsage = serverAuth extendedKeyUsage = clientAuth $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -CAcreateserial \\ -CA ca.crt \\ -CAkey ca.key \\ -in client.csr \\ -out client.cert \\ -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com Getting CA Private Key Enter pass phrase for ca.key:artifactor unable to write 'random state' Update the file perm $ sudo chmod -v 0444 ca.crt \\ server.crt \\ client.cert $ sudo chmod -v 0400 ca.key \\ client.key \\ server.key verify crt commandopenssl x509 ca.crtopenssl x509 server.crt$ openssl x509 -noout \\ -text \\ -in server.crt$ openssl x509 -noout \\ -text \\ -in ca.crt Certificate: Data: Version: 3 (0x2) Serial Number: 15145698426239402702 (0xd23054792b3142ce) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com Validity Not Before: Jan 2 11:35:31 2018 GMT Not After : Jan 2 11:35:31 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:d0:3f:b6:c5:e5:52:8d:c7:26:3f:e7:0a:7a:5f: c1:71:2a:9e:34:07:7e:10:4a:3d:c4:4f:f7:df:58: 93:0d:fa:00:e8:21:75:6d:d1:45:7d:bd:27:f2:c5: 08:13:8f:4f:be:91:9f:28:19:7e:c3:a7:42:1b:fc: b4:96:21:8a:33:59:79:27:a3:cf:13:3e:cd:92:0d: 7e:b9:9f:0d:01:bf:27:5f:e4:7a:7d:db:69:a3:78: 96:a8:c3:a9:2d:31:28:97:ba:6c:20:17:ab:eb:85: ce:2c:25:e8:3e:a0:8b:c0:0b:b2:a9:e1:ac:9f:e1: 57:35:bb:64:6a:99:2e:8f:27:f1:04:40:a7:16:32: 31:4e:ad:18:5e:9e:0b:dd:42:17:af:8a:58:c6:1a: e9:00:52:97:7b:7a:24:cc:b1:81:8d:b9:20:60:e4: 96:d5:77:82:07:4e:df:9c:3a:26:95:d5:ed:aa:a1: 24:94:64:0e:93:9a:9e:9b:d4:78:6b:46:50:69:05: 19:6a:ff:7b:1d:1b:0f:ce:6b:30:33:c7:99:9d:6a: 30:0c:fc:f8:74:00:df:65:6f:fa:1b:24:0a:73:77: 4d:94:45:27:9b:93:a6:81:37:57:57:6f:e9:ae:e4: 5e:a8:b8:be:31:0f:73:4b:9e:1b:ed:78:5c:48:ec: 0b:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: IP Address:130.147.219.19 X509v3 Subject Key Identifier: 23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Authority Key Identifier: keyid:23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Basic Constraints: CA:TRUE Signature Algorithm: sha256WithRSAEncryption 69:a3:fe:35:63:a5:e8:4e:e6:3e:4f:9d:f6:82:3d:73:f2:a7: 22:c1:46:e5:09:5e:61:81:b7:70:3c:62:ba:43:7d:bd:ac:67: d0:41:ea:a7:b8:41:47:04:bc:41:9a:46:35:31:3f:62:10:7a: 58:73:45:3a:59:3b:41:6b:2b:1e:62:42:b7:7e:c1:6b:92:25: 2a:df:3f:69:b5:26:8e:c7:5d:c6:24:a0:65:21:b7:63:74:60: 7f:3b:0e:9a:80:a4:4f:a2:79:20:19:92:64:60:b7:53:5c:09: 6e:46:6e:7a:d7:ee:ef:f4:2e:27:7a:1a:0e:da:5b:8b:7a:bf: 40:56:9f:16:63:6b:89:ab:48:65:07:45:e0:a0:21:7c:0f:6d: 9c:2a:ab:ca:d0:02:06:8a:39:7a:ea:65:b9:04:13:0f:6b:cd: ea:e5:9f:59:c5:d2:06:b2:e4:c3:cb:ab:59:69:aa:11:e6:08: 49:12:cc:d4:29:21:2b:59:c1:dc:bb:e6:a9:7d:96:68:a4:7b: 61:76:8a:21:a9:69:a5:83:d5:8b:f6:08:4e:c0:34:64:6b:65: 96:ac:ed:cd:c1:0b:54:7d:a9:57:07:77:0c:6a:43:9e:4f:c0: 6c:12:88:e8:cf:34:08:67:af:1c:2f:bb:49:54:1b:17:95:89: b3:2d:c9:5f $ openssl x509 -noout \\ -text \\ -in server.crt Certificate: Data: Version: 3 (0x2) Serial Number: 12625600037876864867 (0xaf37245755cf1763) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com Validity Not Before: Jan 2 11:39:47 2018 GMT Not After : Jan 2 11:39:47 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: DNS:sample.artifactory.com, IP Address:130.147.219.19 X509v3 Extended Key Usage: TLS Web Server Authentication Signature Algorithm: sha256WithRSAEncryption 3d:e8:81:f2:ab:89:47:e2:2c:8c:5a:54:31:c2:2a:11:37:e6: ab:89:ff:d1:c2:8c:8e:3a:7d:d2:1d:28:3e:9e:5f:9e:89:08: 78:2e:16:32:52:e7:35:ab:66:09:a4:83:85:42:55:d6:7c:4f: 37:cf:8d:37:bd:57:d0:00:f2:9c:67:68:a2:ed:49:c6:eb:0f: b7:49:ba:ae:12:35:82:a6:a5:b6:5e:f7:68:08:f7:3f:a1:73: d2:94:3e:7a:d9:5c:e1:e2:ab:12:46:66:9d:59:3a:e1:2d:aa: a6:53:97:40:ac:a3:ca:80:6d:5b:75:dc:c4:ee:10:48:55:2c: 10:00:43:07:e6:c4:16:09:fb:04:5d:78:8e:85:21:21:75:01: a5:af:c0:c0:d1:fd:33:6e:5b:24:8b:f8:e6:1c:df:b7:f1:e5: 38:02:d4:a8:e1:09:93:2e:8d:19:ea:e2:11:3f:c1:fe:75:bb: ef:03:6e:c3:50:77:a5:54:7d:7e:e0:cd:85:20:08:41:38:b2: 86:65:aa:58:51:1b:7b:ed:6a:07:0f:cc:ab:49:d8:34:ec:5d: fd:0d:75:48:81:3c:a5:bc:ce:c0:95:8c:8e:d3:8c:0f:0d:a3: a7:73:70:bc:59:89:7c:42:25:0b:cb:2f:b0:86:4a:46:56:f2: e9:d9:63:f1 csr commandopenss req$ openssl req -noout \\ -text \\ -in server.csr$ openssl req -noout \\ -text \\ -in server.csr Certificate Request: Data: Version: 0 (0x0) Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany, OU=CDI, CN=sample.artifactory.com/emailAddress=marslo.jiao@mycompany.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) Attributes: a0:00 Signature Algorithm: sha256WithRSAEncryption 74:99:e5:36:44:b4:48:a9:50:83:eb:61:02:37:6c:8a:46:45: 0e:58:04:40:66:55:56:fc:fd:cf:15:a0:31:be:de:3a:16:4f: 9a:46:1d:17:33:7f:38:dd:36:a9:76:e5:92:b2:48:29:60:e7: af:c0:f6:76:0d:9a:a6:40:43:a8:98:75:90:c3:c1:2a:7d:51: 1d:df:1b:50:8b:69:ce:7c:74:cf:03:9d:69:6b:41:7f:ed:bc: f1:6c:c0:93:22:36:5e:f7:8c:d0:f7:f5:0f:dc:51:93:1e:23: cc:12:cd:f3:0e:6c:1b:4e:b2:df:01:86:5b:d0:79:c8:6e:c8: 57:72:a8:dd:81:8a:af:c3:52:e2:ff:e8:f1:3d:6f:cb:e4:a9: 1c:51:58:b9:31:00:c0:88:5e:ca:63:59:f8:d7:82:d4:22:30: 0c:d8:bd:e6:01:11:d2:4a:68:64:d1:8e:d5:a1:19:0c:5a:99: 25:cd:c2:e5:ed:f3:48:e3:c0:7a:00:a3:a8:09:8e:d3:50:2a: 84:29:63:66:50:3e:42:af:43:ea:fa:5b:28:f9:f1:84:89:88: 2e:7f:8d:bf:44:29:83:fa:89:b3:b8:3c:13:98:20:76:6c:d3: 67:ce:03:9e:15:ea:3e:9d:4b:cb:c2:78:ab:57:1d:b7:e8:9e: 81:1b:b5:1f certificate in Nginx $ grep ssl_certificate /etc/nginx/sites-enabled/artifactoryv2.conf ssl_certificate /etc/nginx/certs/sample.artifactory.com/server.crt; ssl_certificate_key /etc/nginx/certs/sample.artifactory.com/server.key; get remote server certs [!TIP] references: * imarslo: get cert from domain * imarslo: get first matching pattern * Checking A Remote Certificate Chain With OpenSSL Using openssl to get the certificate from a server SSL Certificate Verification keytool $ keytool -printcert \\ -rfc \\ -sslserver : \\ > cacert.crt check # convert to pem $ openssl x509 -inform PEM -in cacert.crt -out outcert.pem -text # or $ openssl x509 \\ -in cacert.crt \\ -noout \\ -text openssl [!NOTE|label:see more] iMarslo : Artifactory SSL Certification $ echo | openssl s_client -showcerts \\ -servername \\ -connect : 2>/dev/null | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' \\ > cacert.crt # or $ echo | openssl s_client \\ -showcerts \\ -connect : 2>/dev/null | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p; /-END CERTIFICATE-/q' | openssl x509 -text -noout | grep Not check$ keytool -printcert -v -file cacert.crt cheatsheet generate private key and csr $ openssl genrsa -out privateKey.key 2048 $ openssl req -new -key privateKey.key -out CSR.csr # or $ openssl req -out CSR.csr \\ -new -newkey rsa:2048 \\ -nodes \\ -keyout privateKey.key \\ -subj \"/C=US/ST=Florida/L=Saint Petersburg/O=Your Company, Inc./OU=IT/CN=yourdomain.com\" need to input the following info to generate CSR : Country Name: 2-digit country code where our organization is legally located. State/Province: Write the full name of the state where the organization is legally located. City: Write the full name of the city where our organization is legally located. Organization Name: Write the legal name of our organization. Organization Unit: Name of the department Common Name: Fully Qualified Domain Name generate a self-signed certificate $ openssl req -x509 \\ -sha256 \\ -nodes \\ -days 365 \\ -newkey rsa:2048 \\ -keyout privateKey.key \\ -out certificate.crt check ssl certificate check private key info$ openssl rsa -text \\ -in privateKey.key \\ -noout check csr info$ openssl req -text \\ -in CSR.csr \\ -noout view ssl certificate info$ openssl x509 -text \\ -in certificate.crt \\ -noout check who has issued the ssl certificate $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -issuer check whom the ssl certificate is issued to $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -subject check for what dates the ssl certificate is valid $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -dates notBefore=Sep 8 00:00:00 2021 GMT notAfter=Aug 18 23:59:59 2022 GMT show multiple informations $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -dates -subject -issuer show fingerprint $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -fingerprint extract all information from the ssl certificate (decoded) $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -text show the ssl certificate $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -----BEGIN CERTIFICATE----- ... -----END CERTIFICATE----- check ssl certificate expiration date $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 -noout -dates # or $ openssl x509 -enddate -noout -in /path/to/name.pem verifying the keys match $ openssl pkey -pubout -in privateKey.key | openssl sha256 # or $ openssl req -pubkey -in CSR.csr -noout | openssl sha256 # or $ openssl x509 -pubkey -in certificate.crt -noout | openssl sha256 manage certificate in OS (client) OSX add $ sudo security add-trusted-cert -d \\ -r trustRoot \\ -k \"/Library/Keychains/System.keychain\" \\ \"/Users/marslo/Downloads/ca.crt\" search commandmore details$ security find-certificate -a -c -Z $ security find-certificate -a -c artifactor -Z | grep SHA-1 SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E $ security list-keychain \"/Users/marslo/Library/Keychains/login.keychain-db\" \"/Library/Keychains/System.keychain\"$ security find-certificate -a -c artifactor -Z SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E keychain: \"/Library/Keychains/System.keychain\" version: 256 class: 0x80001000 attributes: \"alis\"=\"marslo.jiao@mycompany.com\" \"cenc\"=0x00000003 \"ctyp\"=0x00000001 \"hpky\"=0x2332BC619E*** \"#2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"issu\"=0x3081A3310B*** \"0\\201\\..Sichuan1\\0200\\016\\..Chengdu1\\0200\\016\\..mycompany1\\0140\\012\\..CDI1(0&\\006\\..sample.artifactory.com1&0$\\006\\011*\\206H\\206\\..marslo.jiao@mycompany.com\" \"labl\"=\"sample.artifactory.com\" \"skid\"=0x2332BC619E*** \"#2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"snbr\"=0x00D2305479*** \"\\000\\3220Ty+1B\\316\" \"subj\"=0x3081A3310B*** \"0\\201\\..Sichuan1\\0200\\016\\..Chengdu1\\0200\\016\\..mycompany1\\0140\\012\\..CDI1(0&\\006\\..sample.artifactory.com1&0$\\006\\011*\\206H\\206\\..marslo.jiao@mycompany.com\" $ security find-certificate -a -c artifactor -Z -p -m SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E email addresses: marslo.jiao@mycompany.com -----BEGIN CERTIFICATE----- MIIELDCCAxSgAwIBAgIJANIwVHkrMULOMA0GCSqGSIb3DQEBCwUAMIGjMQswCQYD VQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdkdTEQMA4G A1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cuYXJ0aWZh Y3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJzbG8uamlh b0BwaGlsaXBzLmNvbTAeFw0xODAxMDIxMTM1MzFaFw0xOTAxMDIxMTM1MzFaMIGj MQswCQYDVQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdk dTEQMA4GA1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cu YXJ0aWZhY3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJz bG8uamlhb0BwaGlsaXBzLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC ggEBANA/tsXlUo3HJj/nCnpfwXEqnjQHfhBKPcRP999Ykw36AOghdW3RRX29J/LF CBOPT76RnygZfsOnQhv8tJYhijNZeSejzxM+zZINfrmfDQG/J1/ken3baaN4lqjD qS0xKJe6bCAXq+uFziwl6D6gi8ALsqnhrJ/hVzW7ZGqZLo8n8QRApxYyMU6tGF6e C91CF6+KWMYa6QBSl3t6JMyxgY25IGDkltV3ggdO35w6JpXV7aqhJJRkDpOanpvU eGtGUGkFGWr/ex0bD85rMDPHmZ1qMAz8+HQA32Vv+hskCnN3TZRFJ5uTpoE3V1dv 6a7kXqi4vjEPc0ueG+14XEjsC6UCAwEAAaNhMF8wDwYDVR0RBAgwBocEgpPbEzAd BgNVHQ4EFgQUIzK8YZ5RjpQiMFuuaIp+jlPSRXwwHwYDVR0jBBgwFoAUIzK8YZ5R jpQiMFuuaIp+jlPSRXwwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEA aaP+NWOl6E7mPk+d9oI9c/KnIsFG5QleYYG3cDxiukN9vaxn0EHqp7hBRwS8QZpG NTE/YhB6WHNFOlk7QWsrHmJCt37Ba5IlKt8/abUmjsddxiSgZSG3Y3RgfzsOmoCk T6J5IBmSZGC3U1wJbkZuetfu7/QuJ3oaDtpbi3q/QFafFmNriatIZQdF4KAhfA9t nCqrytACBoo5eupluQQTD2vN6uWfWcXSBrLkw8urWWmqEeYISRLM1CkhK1nB3Lvm qX2WaKR7YXaKIalppYPVi/YITsA0ZGtllqztzcELVH2pVwd3DGpDnk/AbBKI6M80 CGevHC+7SVQbF5WJsy3JXw== -----END CERTIFICATE----- remove $ sudo security delete-certificate -Z 915D019F0993F369C09D75C6B8DA201B8DE2636E others 1st: commandmore details$ cd /etc/nginx/ $ sudo openssl genrsa -des3 -out server.key 1024 $ sudo openssl req -new -key server.key -out server.csr $ sudo cp server.key{,.org} $ sudo cp server.csr{,.org} $ sudo openssl rsa -in server.key.org \\ -out server.key $ sudo openssl x509 -req \\ -days 365 \\ -signkey server.key \\ -in server.csr \\ -out server.crt$ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled $ sudo openssl genrsa -des3 -out server.key 1024 Generating RSA private key, 1024 bit long modulus .................................................................++++++ ......++++++ e is 65537 (0x10001) Enter pass phrase for server.key: artifactory Verifying - Enter pass phrase for server.key: artifactory $ sudo openssl req -new \\ -key server.key \\ -out server.csr Enter pass phrase for server.key: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Organizational Unit Name (eg, section) []:mycompany Common Name (e.g. server FQDN or YOUR name) []:docker-2.artifactory Email Address []:marslo.jiao@mycompany.com Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:artifactory An optional company name []:mycompany $ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled -rw-r--r-- 1 root root 951 Dec 26 18:32 server.key -rw-r--r-- 1 root root 785 Dec 26 18:36 server.csr -rw-r--r-- 1 root root 951 Dec 26 18:38 server.key.org -rw-r--r-- 1 root root 785 Dec 26 18:38 server.csr.org $ sudo openssl rsa \\ -in server.key.org \\ -out server.key Enter pass phrase for server.key.org: writing RSA key $ sudo openssl x509 -req \\ -days 365 \\ -signkey server.key \\ -in server.csr \\ -out server.crt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=mycompany/CN=docker-2.artifactory/emailAddress=marslo.jiao@mycompany.com Getting Private key 2nd: /etc/nginx$ sudo openssl req \\ -x509 \\ -nodes \\ -sha256 \\ -days 365 \\ -newkey rsa:2048 \\ -keyout certs/sample.artifactory.com.key \\ -out certs/sample.artifactory.com.crt Generating a 2048 bit RSA private key ........+++ ..............................................................+++ writing new private key to 'certs/sample.artifactory.com.key' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Organizational Unit Name (eg, section) []:mycompany Common Name (e.g. server FQDN or YOUR name) []:sample.artifactory.com Email Address []:marslo.jiao@mycompany.com 3rd: genreate key and cert by one command $ openssl req -new \\ -newkey rsa:2048 \\ -nodes \\ -out www_artifactory__mycompany_com.csr \\ -keyout www_artifactory__mycompany_com.key \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=mycompany/OU=CDI/CN=sample.artifactory.com\" Windows Linux ubuntu add $ sudo cp ca.crt /usr/local/share/ca-certificates/ $ ls -Altrh !$ ls -altrh /usr/local/share/ca-certificates/ total 12K -rw-r--r-- 1 root root 1.5K Jan 3 16:03 ca.crt $ sudo update-ca-certificates Updating certificates in /etc/ssl/certs... 1 added, 0 removed; done. Running hooks in /etc/ca-certificates/update.d... done. $ sudo systemctl restart docker.service remove$ sudo rm -rf /usr/local/share/ca-certificates/ca.crt $ sudo update-ca-certificates --fresh $ sudo systemctl restart docker.service Artifactory HTTPS commandSSL With DomainSSL with IP$ sudo openssl genrsa -des3 -out artifactory.key 2048 $ sudo openssl req -new -key artifactory.key -out artifactorycsr $ sudo cp artifactory.key{,.org} $ sudo openssl rsa -in artifactory.key.org -out artifactory.key $ sudo openssl x509 -req -days 365 -in artifactorycsr -signkey artifactory.key -out artifactory.crt$ sudo openssl genrsa -des3 -out artifactory.key 2048 Generating RSA private key, 2048 bit long modulus .........................+++ ........................................................................+++ e is 65537 (0x10001) Enter pass phrase for artifactory.key: artifactory Verifying - Enter pass phrase for artifactory.key: artifactory $ sudo openssl req -new -key artifactory.key -out artifactorycsr Enter pass phrase for artifactory.key: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Ltd Organizational Unit Name (eg, section) []:. Common Name (e.g. server FQDN or YOUR name) []:192.168.1.102 Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactory.key{,.org} $ sudo openssl rsa -in artifactory.key.org -out artifactory.key Enter pass phrase for artifactory.key.org: artifactory writing RSA key $ sudo openssl x509 -req \\ -days 365 \\ -in artifactorycsr \\ -signkey artifactory.key \\ -out artifactory.crt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany Ltd/CN=192.168.1.102 Getting Private key $ openssl x509 -text \\ -noout \\ -in ssl_ip/artifactory.crt Certificate: Data: Version: 1 (0x0) Serial Number: 9804858425156156035 (0x8811daca106dba83) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, CN=192.168.1.102 Validity Not Before: Dec 26 16:23:15 2017 GMT Not After : Dec 26 16:23:15 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, CN=192.168.1.102 Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:ad:32:26:35:8a:8f:09:82:ff:59:61:14:14:1b: 9c:da:02:74:09:48:2a:d5:05:1d:ad:8a:d0:e0:70: 1f:9b:44:b4:df:4d:c5:4c:5a:1b:8a:52:7b:2a:69: a2:77:d3:cf:c7:fb:a6:ef:34:d1:bb:23:8d:d0:78: e6:48:3f:8c:12:3c:69:d5:62:2d:74:24:b8:49:a8: 59:c7:36:5f:64:97:5a:d1:8f:9a:5b:2f:aa:a8:65: 6c:75:28:60:55:b9:2a:5b:41:71:a4:fa:eb:10:7e: 84:4b:fb:c3:57:9c:55:8e:e8:2a:4a:c1:45:74:54: 58:d5:09:0d:59:d4:14:94:db:5b:67:91:9c:23:24: c4:07:10:d1:f1:28:fa:97:38:01:da:81:c4:f3:63: d7:84:24:dc:3c:ff:04:64:b2:3e:41:f0:d8:08:66: 06:cc:7c:05:3c:90:97:0b:02:b6:b5:2f:03:28:b7: 4c:38:aa:84:23:3e:9e:d4:b0:3a:58:4c:f3:74:df: 36:63:f2:18:ac:d1:0d:ef:05:6b:f3:dc:b6:d3:c7: f0:91:7b:b8:69:4f:ae:19:da:34:b7:38:1e:e2:9a: 10:2e:a9:a0:54:f6:61:b9:da:e6:98:c8:9b:76:83: d6:59:77:d9:18:c6:57:8c:cf:af:a4:89:5a:87:99: c4:15 Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption 5a:06:ad:9b:d0:07:d7:9b:92:2a:77:71:ff:80:6e:c1:39:bd: 81:e8:0f:21:39:bd:80:3e:96:a9:6b:7a:73:f1:80:70:4e:b1: d4:b7:1e:54:be:62:dc:35:c0:b9:d8:8c:d1:24:75:8a:42:ec: a9:dd:9b:9a:f2:4b:ad:6e:38:d7:a2:fa:7a:70:be:7b:8c:37: 63:71:10:fe:73:18:de:e5:9c:c5:6e:1a:4e:cb:7b:51:26:56: 68:56:fb:4f:71:d7:7b:94:b6:55:b9:f8:9b:31:a8:26:a5:e5: 32:36:33:65:7b:1d:9f:27:7d:f1:b0:d2:06:7c:75:d7:39:bb: 7a:44:92:e1:b8:fc:2b:fd:3c:43:93:d6:47:19:f6:ad:d3:cc: 82:dd:15:bd:d3:a0:e2:2d:92:fd:65:44:60:44:21:b9:1f:31: fd:91:c2:78:86:d9:aa:77:fd:54:ae:2f:4c:ae:5d:5e:c7:a3: 43:0d:6b:32:23:d9:61:b6:a7:c4:47:eb:bc:c2:79:6c:06:f0: a6:af:e8:45:c6:02:d5:1c:09:26:8a:a7:b0:ff:74:50:85:82: 1d:88:b2:2c:eb:20:3e:bf:3b:4e:9b:ab:b7:4f:e8:14:a8:1a: 33:50:e9:a8:24:3e:5e:2a:68:ea:fa:f3:12:30:94:8e:0f:0d: da:6c:17:60$ sudo openssl genrsa -des3 -out artifactory.key 2048 Generating RSA private key, 2048 bit long modulus ........................+++ .......................................+++ e is 65537 (0x10001) Enter pass phrase for artifactory.key: artifactory Verifying - Enter pass phrase for artifactory.key: artifactory $ sudo openssl req \\ -new \\ -key artifactory.key \\ -out artifactorycsr Enter pass phrase for artifactory.key: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:mycompany Ltd Organizational Unit Name (eg, section) []:mycompany CDI Common Name (e.g. server FQDN or YOUR name) []:docker-1.artifactory Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactory.key{,.org} $ sudo openssl rsa \\ -in artifactory.key.org \\ -out artifactory.key Enter pass phrase for artifactory.key.org: artifactory writing RSA key $ sudo openssl x509 -req \\ -days 365 \\ -in artifactorycsr \\ -signkey artifactory.key \\ -out artifactory.crt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=mycompany Ltd/OU=mycompany CDI/CN=docker-1.artifactory Getting Private key $ openssl x509 -text -noout -in ssl/artifactory.crt Certificate: Data: Version: 1 (0x0) Serial Number: 15006671364169185053 (0xd0426818d254b71d) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, OU=mycompany CDI, CN=docker-1.artifactory Validity Not Before: Dec 26 16:02:10 2017 GMT Not After : Dec 26 16:02:10 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=mycompany Ltd, OU=mycompany CDI, CN=docker-1.artifactory Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:dc:30:6b:83:56:92:fb:f3:fb:bc:da:3e:a9:5c: 67:c3:19:42:9a:8f:8f:30:e6:27:fa:a9:9d:c9:3e: 9c:31:3d:aa:d8:9f:ae:9b:64:b0:75:2a:01:51:ad: 04:c4:00:5d:f4:f8:b4:af:bb:20:f3:77:45:65:28: d8:38:28:b2:03:46:d0:67:d1:91:8e:7b:65:66:a0: 7e:a5:e2:fe:80:00:5e:54:95:50:52:9c:44:2a:aa: dc:a2:80:be:16:07:79:b4:13:1d:f5:8a:ca:c3:ab: 1c:76:de:f3:b8:23:9b:54:17:28:be:ac:e5:68:5c: f3:83:49:61:55:d2:e1:ea:0c:e7:72:75:6e:90:5a: 90:a8:85:01:c6:cc:69:94:5b:c4:f9:14:6d:70:0a: 8e:45:e0:b9:28:aa:99:3a:22:12:db:0b:d7:d9:6e: aa:35:36:5e:e6:00:eb:99:ab:46:6d:7b:e5:12:b1: f9:0c:5c:d3:c0:47:7b:b3:e4:03:15:fa:8d:42:f8: a1:c1:ce:dc:42:d2:81:88:18:0d:26:28:7e:90:cf: e8:05:84:75:94:e9:ac:20:47:95:c7:50:1c:d8:42: c3:d7:8b:90:f9:a9:48:cc:a5:8d:88:3b:54:a9:ef: 20:ce:ee:4c:6d:04:65:eb:6c:f7:22:9d:c8:13:33: b1:6d Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption c3:c7:c8:0d:19:d1:0b:05:ac:11:e3:e4:af:25:0e:95:f5:f5: 31:ed:90:4e:7f:1a:2b:a2:2f:4d:a3:d9:57:40:a2:f6:af:55: 90:53:bf:72:39:81:5d:53:41:85:e0:1d:26:9f:9e:33:05:46: 9c:fc:51:99:19:5c:7d:ef:aa:cc:50:61:0b:f4:11:69:bd:9e: 2a:34:48:e9:9d:7c:d0:e0:80:a5:42:67:ac:8e:0c:d6:84:19: 8e:cb:05:97:9f:21:c5:e0:78:8f:97:f6:53:fa:f2:ec:49:3f: fb:11:68:ed:ea:c0:8c:c5:be:08:61:e4:bd:4e:05:5f:89:99: f6:47:6f:b3:1e:5f:49:62:ff:37:dc:f0:c4:4b:bb:a4:15:06: b1:80:4d:24:ef:bb:25:d6:a5:60:13:34:57:73:ba:b4:b0:8b: 42:0f:18:ef:0e:17:60:83:4d:61:bd:ef:55:b9:52:6a:47:ab: c3:ee:b3:11:27:86:aa:87:18:d5:60:b8:b4:34:c2:fa:75:48: 0e:f1:f4:30:b3:fa:b3:ad:a9:8a:6e:e6:62:71:02:5a:72:bd: 5c:45:a0:23:ea:1d:84:16:24:3d:88:a0:12:20:61:7a:f8:bd: dc:0f:fb:26:c0:f3:2f:1f:66:7e:64:35:b6:45:05:c4:00:43: 2d:18:da:a1 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 20:37:49 "},"cheatsheet/ssl/keystore.html":{"url":"cheatsheet/ssl/keystore.html","title":"keystore","keywords":"","body":" Keytool Options get cert from domain add crt into Java keystore generate a certificate create java keystore from cert file append to existing java keystore import an entire keystore into another keystore export items to cert file references: keytool - Key and Certificate Management Tool To Use keytool to Create a Server Certificate gencert importcert changealias Examples 5 Creating, Exporting, and Importing SSL Certificates To Generate a Certificate by Using keytool Error Importing SSL certificate : Not an X.509 Certificate generate key and certificate using keytool How to Creat JKS KeyStore file from existing private key and certificate How to Generate a Keystore and CSR Using the Keytool Command The Most Common Java Keytool Keystore Commands Error unable to find valid certification path Java Keytool - Create Keystore ARTIFACTORY: How to Resolve an “unable to find valid certification path to requested target” Error Working with Certificates and SSL Keytool Options KEYTOOL OPTIONS DESCRIPTION -delete Deletes an entry from the Keystore -exportcert Exports a certificate from a Keystore -genkeypair Generates a key pair -genseckey Generates a secret key pair -gencert Generates a certificate from a certificate request -importcert Import a certificate or a certificate chain to keystore -importpass Imports a password -importkeystore Imports one or all entries from another keystore to a keystore -keypasswd Changes the key password of an entry in keystore -list Lists entries in a keystore -printcert Prints the content of a certificate -printcertreq Prints the content of a certificate request -printcrl Prints the content of a CRL file -storepasswd Changes the store password of a keystore get cert from domain $ keytool -printcert \\ -rfc \\ -sslserver google.com:443 > google.com.new.crt check crt file$ openssl x509 \\ -in google.com.new.crt \\ -noout \\ -text | grep \"Not \" Not Before: Aug 30 01:36:08 2021 GMT Not After : Nov 22 01:36:07 2021 GMT or$ keytool -printcert \\ -v \\ -file google.com.new.crt | head Certificate[1]: Owner: CN=*.google.com Issuer: CN=GTS CA 1C3, O=Google Trust Services LLC, C=US Serial number: 1a46a5eeaea1c2610a00000000fcefe4 Valid from: Sun Aug 29 18:36:08 PDT 2021 until: Sun Nov 21 17:36:07 PST 2021 Certificate fingerprints: MD5: 58:83:A1:72:6A:FC:96:FD:18:BF:93:57:AD:64:BE:55 SHA1: 5D:F7:6F:AC:E9:D8:13:9F:68:E3:32:9C:42:CD:11:44:67:0A:E7:E6 SHA256: 03:FF:12:79:0E:57:B2:90:65:37:F2:5D:EA:62:A5:36:62:C6:1E:C0:2E:58:12:10:33:66:2D:49:2B:0C:3B:D5 Signature algorithm name: SHA256withRSA add crt into Java keystore [!TIP] imarslo: get remote server certs generate a certificate $ keytool -genkey \\ -alias google.com \\ -keyalg RSA \\ -keystore keystore.jks \\ -keysize 2048 create java keystore from cert file $ keytool -importcert \\ -alias google.com \\ -keystore google.com.jks \\ -storepass changeit \\ -file google.com.new.crt Trust this certificate? [no]: yes Certificate was added to keystore using -noprompt -trustcacerts will skip manual input yes for Trust this certificate verify $ keytool -list \\ [-v] \\ -keystore google.com.jks \\ -storepass changeit Keystore type: jks Keystore provider: SUN Your keystore contains 1 entry google.com, Sep 27, 2021, trustedCertEntry, Certificate fingerprint (SHA1): 5D:F7:6F:AC:E9:D8:13:9F:68:E3:32:9C:42:CD:11:44:67:0A:E7:E6 append to existing java keystore $ keytool -import \\ -noprompt \\ -trustcacerts \\ -alias google.com \\ -keystore google.com.new.jks \\ -file google.com.new.crt import an entire keystore into another keystore $ keytool -importkeystore \\ -srckeystore key.jks -destkeystore NONE \\ -srcstoretype JKS -deststoretype PKCS11 \\ -srcstorepass \\ -deststorepass import only single alias from keystore to another keystore$ keytool -importkeystore \\ -srckeystore key.jks -destkeystore NONE \\ -srcstoretype JKS -deststoretype PKCS11 \\ -srcstorepass \\ -deststorepass \\ -srcalias myprivatekey -destalias myoldprivatekey \\ -srckeypass \\ -destkeypass \\ -noprompt export items to cert file history: This command was named -export in previous releases. This old name is still supported in this release and will be supported in future releases, but for clarify the new name, -exportcert, is preferred going forward. $ keytool -export \\ -keystore google.com.jks \\ -alias google.com \\ -file google.com.crt Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/ssl/verification.html":{"url":"cheatsheet/ssl/verification.html","title":"verification","keywords":"","body":" verify local cert s_client with cert debug curl openssl get crt information get csr information java ssl InstallCert.java verify remote cert openssl & s_client verify certs curl keytool nmap check in kubernetes certifactes as well verify local cert s_client $ openssl s_client -state -msg -connect my.server.com:443 with cert debug $ openssl s_client -state \\ -debug \\ -connect my.server.com:443 \\ -cert my.server.com-server.crt \\ -key my.server.com-server.key \\ curl $ curl -vvv \\ [--cacert server.crt \\] https://my.server.com:443/artifactory or$ curl -vvv \\ -i \\ -L \\ [--cacert server.crt \\] \\ https://my.server.com:443/artifactory openssl get crt information ca.crt $ openssl verify ca.crt or$ openssl x509 -noout -text -in ca.crt server.crt $ openssl x509 -inform PEM \\ -in server.crt \\ -text \\ -out certdata.pem get csr information $ openssl req -noout -text -in server.csr java ssl to add cert into Java for Java services (i.e.: Jenkins) reference: 4ndrej/SSLPoke.java bric3/SSLPoke.java klasen/sslpoke Test of java SSL / keystore / cert setup Code Examples SSLSocketClient.java // SSLPoke.java import javax.net.ssl.SSLParameters; import javax.net.ssl.SSLSocket; import javax.net.ssl.SSLSocketFactory; import java.io.*; /** Establish a SSL connection to a host and port, writes a byte and * prints the response. See * http://confluence.atlassian.com/display/JIRA/Connecting+to+SSL+services */ public class SSLPoke { public static void main(String[] args) { if (args.length != 2) { System.out.println(\"Usage: \"+SSLPoke.class.getName()+\" \"); System.exit(1); } try { SSLSocketFactory sslsocketfactory = (SSLSocketFactory) SSLSocketFactory.getDefault(); SSLSocket sslsocket = (SSLSocket) sslsocketfactory.createSocket(args[0], Integer.parseInt(args[1])); SSLParameters sslparams = new SSLParameters(); sslparams.setEndpointIdentificationAlgorithm(\"HTTPS\"); sslsocket.setSSLParameters(sslparams); InputStream in = sslsocket.getInputStream(); OutputStream out = sslsocket.getOutputStream(); // Write a test byte to get a reaction :) out.write(1); while (in.available() > 0) { System.out.print(in.read()); } System.out.println(\"Successfully connected\"); } catch (Exception exception) { exception.printStackTrace(); System.exit(1); } } } extract cert from server:$ openssl s_client -connect server:443 negative test cert/keytool:$ java SSLPoke server 443 you should get something likejavax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target import cert into default keytool:$ keytool -import -alias alias.server.com -keystore $JAVA_HOME/jre/lib/security/cacerts positive test cert / keytool: java SSLPoke server 443 // you should get this: // Successfully connected import certificate into your local TrustStore -Djavax.net.ssl.trustStore will override the default truststore (cacerts). copy the default one and then add cert and set it via -Djavax.net.ssl.trustStore so default CA won't be lost. $ keytool -import \\ -trustcacerts \\ -storepass changeit \\ -file \"./class 1 root ca.cer\" \\ -alias C1_ROOT_CA \\ -keystore ./LocalTrustStore # use it in JAVA: $ java -Djavax.net.ssl.trustStore=./LocalTrustStore -jar SSLPoke.jar $HOST $PORT list expired date for all in cacerts $ keytool --list -v --keystore cacerts | grep \"until:\" | sed 's/^.*until: //' InstallCert.java reference: unable to find valid certification path to requested target compile first $ javac InstallCert.java Access server, and retrieve certificate (accept default certificate 1)$ java InstallCert [host]:[port] Extract certificate from created jssecacerts keystore$ keytool -exportcert -alias [host]-1 -keystore jssecacerts -storepass changeit -file [host].cer Import certificate into system keystore$ keytool -importcert -alias [host] -keystore [path to system keystore] -storepass changeit -file [host].cer verify remote cert reference: Checking A Remote Certificate Chain With OpenSSL How to extract SSL data from any website openssl & s_client $ openssl s_client -showcerts -connect www.domain.com:443 or $ openssl s_client -showcerts \\ -starttls imap \\ -connect www.domain.com:443 CONNECTED(00000005) or using local client cert for debug purpose $ openssl s_client -showcerts \\ -cert cert.cer \\ -key cert.key \\ -connect www.domain.com:443 or $ openssl s_client -connect www.domain.com:443 | openssl x509 -text -noout | grep -A 1 -i key or use specify acceptable ciphers for ssl handshake $ openssl s_client -showcerts \\ -cipher DHE-RSA-AES256-SHA \\ -connect www.domain.com:443 or get enddate only $ echo | openssl s_client \\ -connect www.domain.com:443 2>/dev/null | openssl x509 -noout -enddate notAfter=Nov 28 23:59:59 2020 GMT verify certs $ echo | openssl s_client -showcerts \\ -servername www.domain.com \\ -connect www.domain.com:443 2>/dev/null | openssl x509 -inform pem -noout -text get ssl only$ echo | openssl s_client -showcerts \\ -connect www.domain.com:443 2>/dev/null | sed -n '/BEGIN.*-/,/END.*-/p' curl $ curl -vvI https://www.domain.com print ssl only$ curl --insecure \\ -vvI https://www.domain.com 2>&1 | awk 'BEGIN { cert=0 } /^\\* SSL connection/ { cert=1 } /^\\*/ { if (cert) print }' keytool $ keytool -printcert -sslserver www.domain.com:443 nmap $ nmap -p 443 --script ssl-cert www.domain.com [-v] Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"cheatsheet/havefun.html":{"url":"cheatsheet/havefun.html","title":"havefun","keywords":"","body":" I'm very busy Press Any Key to Continue Simulate type mechine [Pretty Cool!!] Get how many days left this years Get week number DOS tree Set Volume by command cat and tac ASCII chart Char chart Hate someone Star war I'm very busy $ cat /dev/urandom | hexdump -C | grep \"ca fe\" Press Any Key to Continue $ read -sn 1 -p \"Press any key to continue...\" && echo \"\\n\" Press any key to continue...\\n Simulate type mechine [Pretty Cool!!] $ sudo apt-get intall pv $ echo \"Very very very very very long words\" | pv -qL $[10+(-2 + RANDOM%5)] # or $ sudo apt-get install randtype $ echo \"Very very very very very long words\" | randtype -m 4 Get how many days left this years $ echo \"There are $(($(date +%j -d\"Dec 31, $(date +%Y)\")-$(date +%j))) left in year $(date +%Y).\" There are 323 left in year 2014. Get week number $ date +\"%V\" 08 DOS tree $ find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g' . |____a_b |____b_a Set Volume by command $ pacmd set-sink-volume 0 0x10000 Welcome to PulseAudio! Use \"help\" for usage information. cat and tac $ cat a_b 1 2 3 $ tac a_b 3 2 1 ASCII chart $ figlet Marslo __ __ _ | \\/ | __ _ _ __ ___| | ___ | |\\/| |/ _` | '__/ __| |/ _ \\ | | | | (_| | | \\__ \\ | (_) | |_| |_|\\__,_|_| |___/_|\\___/ Char chart $ toilet marslo \"\"# mmmmm mmm m mm mmm # mmm # # # \" # #\" \" # \" # #\" \"# # # # m\"\"\"# # \"\"\"m # # # # # # \"mm\"# # \"mmm\" \"mm \"#m#\" Hate someone ┌─ (marslo@MarsloJiao ~) -> └─ $ :(){ :|: & };: Star war ┌─ (marslo@MarsloJiao ~) -> └─ $ telnet towel.blinkenlights.nl Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"vim/vim.html":{"url":"vim/vim.html","title":"vim","keywords":"","body":" check where vim executable package check vimdoc with keyword cursor and cursor shape vimrc examples reference: * Vim help files Bram Moolenaar vim:tip Best Vim Tips Search for visually selected text Mastering Vim Grammar Syntax highlighting is extremely slow when scrolling up in recent version (v8.0.1599) #2712 Slow vim in huge projects Setting up Vim for YAML editing check where vim executable package :echo v:progpath check vimdoc with keyword :helpgrep \" i.e. :helpgrep slow or:echo $VIM cursor and cursor shape [!NOTE|label:references:] cursor shape mode settings: t_SI = INSERT mode : let &t_SI.=\"\\e[5 q\" t_SR = REPLACE mode : let &t_SR.=\"\\e[4 q\" t_EI = NORMAL mode (ELSE) : let &t_EI.=\"\\e[1 q\" cursor settings: 1 -> blinking block 2 -> solid block 3 -> blinking underscore 4 -> solid underscore 5 -> blinking vertical bar 6 -> solid vertical bar andyfowler/.vimrc Change cursor shape in different modes Vim change block cursor when in insert mode Configuring the cursor :help guicorsor * iMarslo : redirect message into file guicursor $ /Applications/MacVim.app/Contents/bin/mvim -u NONE \\ -c 'redir > ~/Desktop/guicursor.txt' \\ -c 'echo &guicursor' \\ -c 'redir END' \\ -c 'q' $ cat ~/Desktop/guicursor.txt n-v-c:block-Cursor/lCursor,ve:ver35-Cursor,o:hor50-Cursor,i-ci:ver25-Cursor/lCursor,r-cr:hor20-Cursor/lCursor,sm:block-Cursor-blinkwait175-blinkoff150-blinkon175 # after modified $ /Applications/MacVim.app/Contents/bin/mvim -c 'redir! > ~/Desktop/guicursor.txt' \\ -c 'echo &guicursor' \\ -c 'redir END' \\ -c 'q' $ cat ~/Desktop/guicursor.txt a:hor10-Cursor-blinkon0,i-r-c-ci-cr-o:hor10-iCursor-blinkon0,n:hor10-Cursor-blinkwait700-blinkon400-blinkoff250,v-ve:block-Cursor cursorcolumn [!NOTE|label:references:] Setting Vim cursorline colors? set cursorcolumn autocmd InsertEnter * highlight CursorColumn ctermfg=White ctermbg=Yellow cterm=bold guifg=white guibg=yellow gui=bold autocmd InsertLeave * highlight CursorColumn ctermfg=Black ctermbg=Yellow cterm=bold guifg=Black guibg=yellow gui=NONE \" or simplely via set cursorcolumn highlight CursorColumn ctermfg=White ctermbg=gray cterm=bold guifg=white guibg=gray gui=bold vimrc examples reiter/.vim-files/vimrc Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"vim/install.html":{"url":"vim/install.html","title":"install","keywords":"","body":" OSX Linux vim gvim Windows setup environment ( via cygwin ) gvim.exe vim.exe [!NOTE|label:verify] $ vim +\"py3 print('hello') +qa\" references: * travis : vim/vim * travis : macvim-dev/macvim * Compile Customized Vim on Mac OS * vim/src/INSTALLmac.txt * script to build vim in mac Compiling Vim How to Install Vim 8.2 on CentOS 7 notmii/install-vim.sh Building Vim Build Vim in Windows with Cygwin joshukraine/compile-vim.md Building VIM from source code travis CI : vim configurable.nix How can I fix this error when making vim on Fedora 23 OSX [!TIP] $ brew install pcre2 gettext libtool tips: os_mac.txt --disable-darwin will make -clipboard references: nvim install.sh Install vim on macOS High Sierra using source code $ ./configure --help `configure' configures this package to adapt to many kinds of systems. Usage: auto/configure [OPTION]... [VAR=VALUE]... To assign environment variables (e.g., CC, CFLAGS...), specify them as VAR=VALUE. See below for descriptions of some of the useful variables. Defaults for the options are specified in brackets. Configuration: -h, --help display this help and exit --help=short display options specific to this package --help=recursive display the short help of all the included packages -V, --version display version information and exit -q, --quiet, --silent do not print `checking ...' messages --cache-file=FILE cache test results in FILE [disabled] -C, --config-cache alias for `--cache-file=config.cache' -n, --no-create do not create output files --srcdir=DIR find the sources in DIR [configure dir or `..'] Installation directories: --prefix=PREFIX install architecture-independent files in PREFIX [/usr/local] --exec-prefix=EPREFIX install architecture-dependent files in EPREFIX [PREFIX] By default, `make install' will install all the files in `/usr/local/bin', `/usr/local/lib' etc. You can specify an installation prefix other than `/usr/local' using `--prefix', for instance `--prefix=$HOME'. For better control, use the options below. Fine tuning of the installation directories: --bindir=DIR user executables [EPREFIX/bin] --sbindir=DIR system admin executables [EPREFIX/sbin] --libexecdir=DIR program executables [EPREFIX/libexec] --sysconfdir=DIR read-only single-machine data [PREFIX/etc] --sharedstatedir=DIR modifiable architecture-independent data [PREFIX/com] --localstatedir=DIR modifiable single-machine data [PREFIX/var] --libdir=DIR object code libraries [EPREFIX/lib] --includedir=DIR C header files [PREFIX/include] --oldincludedir=DIR C header files for non-gcc [/usr/include] --datarootdir=DIR read-only arch.-independent data root [PREFIX/share] --datadir=DIR read-only architecture-independent data [DATAROOTDIR] --infodir=DIR info documentation [DATAROOTDIR/info] --localedir=DIR locale-dependent data [DATAROOTDIR/locale] --mandir=DIR man documentation [DATAROOTDIR/man] --docdir=DIR documentation root [DATAROOTDIR/doc/PACKAGE] --htmldir=DIR html documentation [DOCDIR] --dvidir=DIR dvi documentation [DOCDIR] --pdfdir=DIR pdf documentation [DOCDIR] --psdir=DIR ps documentation [DOCDIR] X features: --x-includes=DIR X include files are in DIR --x-libraries=DIR X library files are in DIR Optional Features: --disable-option-checking ignore unrecognized --enable/--with options --disable-FEATURE do not include FEATURE (same as --enable-FEATURE=no) --enable-FEATURE[=ARG] include FEATURE [ARG=yes] --enable-fail-if-missing Fail if dependencies on additional features specified on the command line are missing. --disable-darwin Disable Darwin (Mac OS X) support. --disable-smack Do not check for Smack support. --disable-selinux Do not check for SELinux support. --disable-xsmp Disable XSMP session management --disable-xsmp-interact Disable XSMP interaction --enable-luainterp=OPTS Include Lua interpreter. default=no OPTS=no/yes/dynamic --enable-mzschemeinterp Include MzScheme interpreter. --enable-perlinterp=OPTS Include Perl interpreter. default=no OPTS=no/yes/dynamic --enable-pythoninterp=OPTS Include Python interpreter. default=no OPTS=no/yes/dynamic --enable-python3interp=OPTS Include Python3 interpreter. default=no OPTS=no/yes/dynamic --enable-tclinterp=OPTS Include Tcl interpreter. default=no OPTS=no/yes/dynamic --enable-rubyinterp=OPTS Include Ruby interpreter. default=no OPTS=no/yes/dynamic --enable-cscope Include cscope interface. --disable-netbeans Disable NetBeans integration support. --disable-channel Disable process communication support. --enable-terminal Enable terminal emulation support. --enable-autoservername Automatically define servername at vim startup. --enable-multibyte Include multibyte editing support. --disable-rightleft Do not include Right-to-Left language support. --disable-arabic Do not include Arabic language support. --disable-farsi Deprecated. --enable-xim Include XIM input support. --enable-fontset Include X fontset output support. --enable-gui=OPTS X11 GUI. default=auto OPTS=auto/no/gtk2/gnome2/gtk3/motif/haiku/photon/carbon --enable-gtk2-check If auto-select GUI, check for GTK+ 2 default=yes --enable-gnome-check If GTK GUI, check for GNOME default=no --enable-gtk3-check If auto-select GUI, check for GTK+ 3 default=yes --enable-motif-check If auto-select GUI, check for Motif default=yes --disable-gtktest Do not try to compile and run a test GTK program --disable-icon-cache-update update disabled --disable-desktop-database-update update disabled --disable-largefile omit support for large files --disable-canberra Do not use libcanberra. --disable-libsodium Do not use libsodium. --disable-acl No check for ACL support. --enable-gpm=OPTS Use gpm (Linux mouse daemon). default=yes OPTS=yes/no/dynamic --disable-sysmouse Don't use sysmouse (mouse in *BSD console). --disable-nls Don't support NLS (gettext()). Optional Packages: --with-PACKAGE[=ARG] use PACKAGE [ARG=yes] --without-PACKAGE do not use PACKAGE (same as --with-PACKAGE=no) --with-mac-arch=ARCH current, intel, ppc or both --with-developer-dir=PATH use PATH as location for Xcode developer tools --with-local-dir=PATH search PATH instead of /usr/local for local libraries. --without-local-dir do not search /usr/local for local libraries. --with-vim-name=NAME what to call the Vim executable --with-ex-name=NAME what to call the Ex executable --with-view-name=NAME what to call the View executable --with-global-runtime=DIR global runtime directory in 'runtimepath', comma-separated for multiple directories --with-modified-by=NAME name of who modified a release version --with-features=TYPE tiny, normal or huge (default: huge) --with-compiledby=NAME name to show in :version message --with-lua-prefix=PFX Prefix where Lua is installed. --with-luajit Link with LuaJIT instead of Lua. --with-plthome=PLTHOME Use PLTHOME. --with-python-command=NAME name of the Python 2 command (default: python2 or python) --with-python-config-dir=PATH Python's config directory (deprecated) --with-python3-command=NAME name of the Python 3 command (default: python3 or python) --with-python3-config-dir=PATH Python's config directory (deprecated) --with-tclsh=PATH which tclsh to use (default: tclsh8.0) --with-ruby-command=RUBY name of the Ruby command (default: ruby) --with-x use the X Window System --with-gnome-includes=DIR Specify location of GNOME headers --with-gnome-libs=DIR Specify location of GNOME libs --with-gnome Specify prefix for GNOME files --with-motif-lib=STRING Library for Motif --with-tlib=library terminal library to be used Some influential environment variables: CC C compiler command CFLAGS C compiler flags LDFLAGS linker flags, e.g. -L if you have libraries in a nonstandard directory LIBS libraries to pass to the linker, e.g. -l CPPFLAGS (Objective) C/C++ preprocessor flags, e.g. -I if you have headers in a nonstandard directory CPP C preprocessor XMKMF Path to xmkmf, Makefile generator for X Window System Use these variables to override the choices made by `configure' or to help it to find libraries and programs with nonstandard names/locations. Report bugs to the package provider. # optional $ NPROC=$(getconf _NPROCESSORS_ONLN) $ make distclean && make clean $ ./configure --with-features=huge \\ --enable-cscope \\ --enable-largefile \\ --enable-rubyinterp=dynamic \\ --with-python3-config-dir=$(python3-config --configdir) \\ --enable-python3interp=dynamic \\ --with-lua-prefix=/usr/local \\ --enable-luainterp=dynamic \\ --enable-libsodium \\ --enable-multibyte \\ --with-tlib=ncurses \\ --enable-terminal \\ --enable-autoservername \\ --enable-nls \\ --with-mac-arch=current \\ --enable-darwin \\ --with-compiledby=\"marslo \" \\ --prefix=/usr/local/vim \\ --exec-prefix=/usr/local/vim \\ --enable-fail-if-missing ## ... build ... $ make # or $ make -j${NPROC} # or $ make -j$(nproc) ## ... install ... $ sudo make install # or uninstall if necessary $ sudo make uninstall && sudo make install # optional $ sudo cp src/vim /usr/local/vim/bin/vim ## ... validate ... $ src/vim --version $ make indenttest $ make -C runtime/doc vimtags VIMEXE=../../src/vim ## ... check object files ... $ otool -L \"src/vim\" | grep '\\.dylib\\s' | grep -v '^\\s*/usr/lib/' $ lipo -archs \"src/vim\" | grep '^x86_64$' ## ... check language support ... macvim_excmd() { ./src/vim -u NONE -i NONE -f -X -V1 -es \"$@\" -c 'echo \"\"' -c 'qall!' 2>&1 } macvim_excmd -c 'lua print(\"Test\")' macvim_excmd -c 'perl VIM::Msg(\"Test\")' macvim_excmd -c 'py3 import sys; print(\"Test\")' macvim_excmd -c 'ruby puts(\"Test\")' macvim_excmd -c 'lang es_ES' -c 'version' | grep Enlazado $ vim --version VIM - Vi IMproved 9.1 (2024 Jan 02, compiled Jan 8 2024 16:50:47) macOS version - x86_64 Included patches: 1-16 Compiled by marslo Huge version without GUI. Features included (+) or not (-): +acl +file_in_path +mouse_urxvt -tag_any_white +arabic +find_in_path +mouse_xterm -tcl +autocmd +float +multi_byte +termguicolors +autochdir +folding +multi_lang +terminal +autoservername -footer -mzscheme +terminfo -balloon_eval +fork() +netbeans_intg +termresponse +balloon_eval_term +gettext +num64 +textobjects -browse -hangul_input +packages +textprop ++builtin_terms +iconv +path_extra +timers +byte_offset +insert_expand -perl +title +channel +ipv6 +persistent_undo -toolbar +cindent +job +popupwin +user_commands -clientserver +jumplist +postscript +vartabs +clipboard +keymap +printer +vertsplit +cmdline_compl +lambda +profile +vim9script +cmdline_hist +langmap -python +viminfo +cmdline_info +libcall +python3/dyn +virtualedit +comments +linebreak +quickfix +visual +conceal +lispindent +reltime +visualextra +cryptv +listcmds +rightleft +vreplace +cscope +localmap +ruby/dyn +wildignore +cursorbind +lua/dyn +scrollbind +wildmenu +cursorshape +menu +signs +windows +dialog_con +mksession +smartindent +writebackup +diff +modify_fname +sodium -X11 +digraphs +mouse +sound -xattr -dnd -mouseshape +spell -xfontset -ebcdic +mouse_dec +startuptime -xim +emacs_tags -mouse_gpm +statusline -xpm +eval -mouse_jsbterm -sun_workshop -xsmp +ex_extra +mouse_netterm +syntax -xterm_clipboard +extra_search +mouse_sgr +tag_binary -xterm_save -farsi -mouse_sysmouse -tag_old_static system vimrc file: \"$VIM/vimrc\" user vimrc file: \"$HOME/.vimrc\" 2nd user vimrc file: \"~/.vim/vimrc\" user exrc file: \"$HOME/.exrc\" defaults file: \"$VIMRUNTIME/defaults.vim\" fall-back for $VIM: \"/usr/local/vim/share/vim\" Compilation: gcc -c -I. -Iproto -DHAVE_CONFIG_H -I/usr/local/include -I/usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/include -I/usr/local/opt/openldap/include -I/usr/local/opt/curl/include -I/usr/local/opt/binutils/include -I/usr/local/opt/sqlite/include -I/usr/local/opt/readline/include -I/usr/local/opt/openssl/include -I/usr/local/opt/node@21/include -I/usr/local/opt/tcl-tk/include -I/usr/local/Cellar/icu4c@71.1/71.1/include -I/usr/local/opt/llvm/include -I/usr/local/opt/libiconv/include -I/usr/local/opt/ncurses/include -DMACOS_X -DMACOS_X_DARWIN -I/usr/local/include -I/usr/local/opt/tcl-tk/include -I/usr/local/Cellar/libsodium/1.0.19/include -D_REENTRANT -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=1 Linking: gcc -L/usr/local/lib -L/usr/local/opt/readline/lib -L/usr/local/opt/openldap/lib -L/usr/local/opt/curl/lib -L/usr/local/opt/binutils/lib -L/usr/local/opt/python@3.12/lib -L/usr/local/opt/tcl-tk/lib -L/usr/local/opt/sqlite/lib -L/usr/local/opt/openssl/lib -L/usr/local/opt/node@21/lib -L/usr/local/Cellar/icu4c@71.1/71.1/lib -L/usr/local/opt/ncurses/lib -L/usr/local/opt/libiconv/lib -L/usr/local/opt/llvm/lib -L/usr/local/opt/llvm/lib/c++ -Wl,-rpath,/usr/local/opt/llvm/lib/c++ -o vim -lm -lncurses -L/usr/local/Cellar/libsodium/1.0.19/lib -lsodium -liconv -lintl -framework AppKit additonal options --enable-fontset # no GUI selected; xim has been disabled --enable-xim # no GUI selected; xim has been disabled --enable-perlinterp --enable-tclinterp --enable-rubyinterp --with-python3-command=python # using :python instead of :py --enable-mzschemeinterp --with-mac-arch --with-developer-dir --with-global-runtime --with-modified-by --enable-terminal : yes --enable-browse : only for {Win32, Athena, Motif, GTK and Mac GUI} default options --with-local-dir : /usr/local --with-vim-name : vim --with-ex-name : ex dislabed --disable-smack --disable-selinux --disable-netbeans : no --disable-channel : no --disable-rightleft : no --disable-arabic : no none supported --with-client-server --enable-browse options for GUI [!TIP] references: ahmedrmusa/vim--with-x Vim can't build the athena GUI on macOS High Sierra --with-x --disable-darwin --enable-gui=athena --disable-darwin --with-x --enable-gui=motif --disable-darwin --enable-gui=carbon --enable-gui --enable-darwin --with-mac-arch --enable-xim [!TIP] references: Bugreport/Compile Issue >8.1.224 MacOSX, gui_mac.c undefined local symbol How do I compile vim with the --enable-gui=yes flag on OS X 10.8.2export CFLAGS=\"-I/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.7.sdk/Developer/Headers/FlatCarbon/\" in xCode 11.3: /Library/Developer/CommandLineTools/SDKs/MacOSX11.3.sdk/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/CarbonCore.framework/Versions/A/Headers/CarbonCore.r /Library/Developer/CommandLineTools/SDKs/MacOSX11.3.sdk/System/Library/Frameworks/Carbon.framework/Versions/A/Headers/Carbon.h /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/Carbon.framework/Versions/A/Headers/Carbon.h Linux vim install python3.11 and vim9 python3.11 [!TIP|label:references:] * iMarslo: build python from source # ubuntu # to provide python3-config # v $ sudo apt install python3.11 python3.11-dev $ NPROC=$(getconf _NPROCESSORS_ONLN) $ curl -O https://www.python.org/ftp/python/3.11.6/Python-3.11.6.tgz | tar xzf - -C /opt/python && cd /opt/python $ sudo ./configure --enable-optimizations --enable-shared --prefix=/opt/python/python3.11 # or $ ./configure --enable-optimizations --enable-shared --with-lto --with-system-expat --with-ensurepip $ sudo make -j ${NPROC} $ sudo make altinstall $ export LD_LIBRARY_PATH=/opt/python/Python-3.11.6:$LD_LIBRARY_PATH # optional $ echo 'PATH=$PATH:/usr/local/bin' lua 5.4.6 ( with shared libs ) [!TIP] iMarslo: build lua with shared lib $ mkdir /opt/lua $ curl -fsSL https://www.lua.org/ftp/lua-5.4.6.tar.gz | tar xzf - -C /opt/lua $ cd /opt/lua/lua-5.4.6 $ patch --ignore-whitespace ruby ( via rbenv ) [!TIP] iMarslo: install ruby with rbenv $ curl -fsSL https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer | bash $ ~/.rbenv/bin/rbenv init $ echo 'export PATH=\"$PATH:$HOME/.rbenv/bin\"' >> ~/.bashrc $ echo 'eval \"$(/home/marslo/.rbenv/bin/rbenv init - bash)\"' >> ~/.bashrc $ rbenv install 3.3.0 $ rbenv global 3.3.0 vim9 $ git clone https://github.com/vim/vim && cd vim ./configure --with-features=huge \\ --enable-cscope \\ --enable-rubyinterp=dynamic \\ --enable-python3interp=dynamic \\ --with-python3-config-dir=$(python3.11-config --configdir) \\ --enable-luainterp=dynamic \\ --with-lua-prefix=/usr/local \\ --enable-libsodium \\ --enable-multibyte \\ --with-tlib=ncurses \\ --enable-terminal \\ --enable-autoservername \\ --enable-nls \\ --with-compiledby=\"marslo \" \\ --prefix=/usr/local/vim \\ --exec-prefix=/usr/local/vim \\ --enable-fail-if-missing $ make -j${NPROC} # or $ make -j$(nproc) $ sudo make install $ sudo alternatives --install /usr/local/bin/vim vim /usr/local/vim/bin/vim 99 $ sudo alternatives --install /usr/local/bin/vimdiff vimdiff /usr/local/vim/bin/vimdiff 99 $ sudo alternatives --install /usr/local/bin/vimtutor vimtutor /usr/local/vim/bin/vimtutor 99 $ sudo alternatives --auto vim $ sudo alternatives --auto vimdiff $ sudo alternatives --auto vimtutor $ ./configure --with-features=huge \\ --enable-python3interp \\ --with-python3-config-dir=$(python3.11-config --configdir) \\ --enable-libsodium \\ --enable-multibyte \\ --with-tlib=ncurses \\ --enable-terminal \\ --enable-autoservername \\ --enable-nls \\ --with-compiledby=\"marslo \" \\ --prefix=/usr/local/vim \\ --exec-prefix=/usr/local/vim \\ --enable-fail-if-missing $ /usr/local/bin/vim --version VIM - Vi IMproved 9.1 (2024 Jan 02, compiled Jan 4 2024 18:32:13) Included patches: 1-11 Compiled by marslo Huge version without GUI. Features included (+) or not (-): +acl +file_in_path +mouse_urxvt -tag_any_white +arabic +find_in_path +mouse_xterm -tcl +autocmd +float +multi_byte +termguicolors +autochdir +folding +multi_lang +terminal +autoservername -footer -mzscheme +terminfo -balloon_eval +fork() +netbeans_intg +termresponse +balloon_eval_term +gettext +num64 +textobjects -browse -hangul_input +packages +textprop ++builtin_terms +iconv +path_extra +timers +byte_offset +insert_expand -perl +title +channel +ipv6 +persistent_undo -toolbar +cindent +job +popupwin +user_commands -clientserver +jumplist +postscript +vartabs -clipboard +keymap +printer +vertsplit +cmdline_compl +lambda +profile +vim9script +cmdline_hist +langmap -python +viminfo +cmdline_info +libcall +python3/dyn +virtualedit +comments +linebreak +quickfix +visual +conceal +lispindent +reltime +visualextra +cryptv +listcmds +rightleft +vreplace +cscope +localmap +ruby/dyn +wildignore +cursorbind +lua/dyn +scrollbind +wildmenu +cursorshape +menu +signs +windows +dialog_con +mksession +smartindent +writebackup +diff +modify_fname -sodium -X11 +digraphs +mouse -sound +xattr -dnd -mouseshape +spell -xfontset -ebcdic +mouse_dec +startuptime -xim +emacs_tags -mouse_gpm +statusline -xpm +eval -mouse_jsbterm -sun_workshop -xsmp +ex_extra +mouse_netterm +syntax -xterm_clipboard +extra_search +mouse_sgr +tag_binary -xterm_save -farsi -mouse_sysmouse -tag_old_static system vimrc file: \"$VIM/vimrc\" user vimrc file: \"$HOME/.vimrc\" 2nd user vimrc file: \"~/.vim/vimrc\" user exrc file: \"$HOME/.exrc\" defaults file: \"$VIMRUNTIME/defaults.vim\" fall-back for $VIM: \"/usr/local/vim/share/vim\" Compilation: gcc -c -I. -Iproto -DHAVE_CONFIG_H -g -O2 -D_REENTRANT -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=1 Linking: gcc -Wl,--as-needed -o vim -lm -lelf -lselinux -lncurses -lrt -ldl shell script vim #!/usr/bin/env bash VIM_SRC=$(dirname $(readlink -f $0))/vimsrc if [ ! -d \"$VIM_SRC\" ]; then echo \"Bad VIM source path. Exit.\" exit 1 fi pushd $VIM_SRC git clean -dffx * git checkout -- * make clean distclean git pull ./configure --prefix=$HOME/.marslo/myprograms/vim74 \\ --enable-pythoninterp=yes \\ --with-python-config-dir=/usr/local/lib/python2.7/config \\ --enable-rubyinterp=yes \\ --with-features=huge \\ --disable-smack \\ --enable-fail-if-missing \\ --with-compiledby=marslo@appliance > vim-build.log make -j3 >> vim-build.log make install >> vim-build.log popd gvim #!/bin/bash VIM_SRC=$(dirname $(readlink -f $0))/vimsrc if [ ! -d \"$VIM_SRC\" ]; then echo \"Bad VIM source path. Exit.\" exit 1 fi pushd ${VIM_SRC} git clean -dffx * git checkout -- * make clean distclean git pull ./configure --enable-gui=gnome2 \\ --enable-cscope \\ --enable-multibyte \\ --enable-xim \\ --enable-fontset \\ --with-features=huge \\ --enable-pythoninterp=yes \\ --enable-rubyinterp=yes \\ --enable-python3interp=yes \\ --disable-smack \\ --enable-fail-if-missing \\ --with-compiledby=marslo@china \\ --prefix=/home/marslo/.vim/tools > vim-build.log make -j3 >> vim-build.log make install >> vim-build.log popd Windows [!NOTE] by cygwin setup environment ( via cygwin ) mandatory gcc gcc-g++ make ncurses bc (Math) optional Flex bison gettext gettext-devel textinfo other wget curl tree rsync scp lynx using apt-cyg to install cygwin package $ wget http://rawgit.com/transcode-open/apt-cyg/master/apt-cyg $ mv apt-cyg{.txt,} $ install apt-cyg /bin gvim.exe > make -B \\ -f Make_cyg.mak \\ PYTHON=/cygdrive/c/Marslo/MyProgramFiles/Python27 \\ DYNAMIC_PYTHON=yes \\ PYTHON_VER=27 \\ PYTHON3=/cygdrive/c/Marslo/MyProgramFiles/Python35 \\ DYNAMIC_PYTHON3=yes \\ PYTHON3_VER=35 \\ FEATURES=huge \\ IME=yes \\ GIME=yes \\ MBYTE=yes \\ CSCOPE=yes \\ USERNAME=Marslo.Jiao \\ USERDOMAIN=China \\ GUI=yes vim.exe > make -B \\ -f Make_cyg.mak \\ PYTHON=/cygdrive/c/Marslo/MyProgramFiles/Python27 \\ DYNAMIC_PYTHON=yes \\ PYTHON_VER=27 \\ PYTHON3=/cygdrive/c/Marslo/MyProgramFiles/Python35 \\ DYNAMIC_PYTHON3=yes \\ PYTHON3_VER=35 \\ FEATURES=huge \\ IME=yes \\ GIME=yes \\ MBYTE=yes \\ CSCOPE=yes \\ USERNAME=Marslo.Jiao \\ USERDOMAIN=China \\ GUI=no Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:19:55 "},"vim/color.html":{"url":"vim/color.html","title":"color","keywords":"","body":" linux terminal with solarized [!NOTE|label:references:] * vimcolorschemes Using GUI color settings in a terminal Using vim color schemes with Putty linux terminal with solarized bundle \" Vim Bundle filetype off set rtp+=~/.vim/bundle/snipmate.vim/snippets/ set rtp+=~/.vim/bundle/Vundle.vim/ call vundle#begin() Bundle 'VundleVim/Vundle.vim' Bundle 'tpope/vim-pathogen' Bundle 'altercation/vim-colors-solarized' call vundle#end() call pathogen#infect() filetype plugin indent on syntax enable on solarized if has('gui_running') || 'xterm-256color' == $TERM set background=dark let psc_style='cool' \"\"\" solarized let &t_Co=256 set t_Co=256 let g:solarized_termcolors = 256 let g:solarized_termtrans = 1 let g:solarized_extra_hi_groups = 1 \" ┐ let g:solarized_visibility = \"high\" \" | nice to have let g:solarized_contrast = \"high\" \" | let s:base03 = \"255\" \" ┘ \" set termguicolors \" do not enable colorscheme solarized endif customrized colors highlight clear SpellBad Conceal PmenuSel SpecialKey Exception Folded TabLineSel Search CorsorLine highlight SpellBad term=underline cterm=underline ctermbg=NONE ctermfg=160 highlight Conceal term=NONE cterm=NONE ctermbg=NONE ctermfg=239 highlight SpecialKey term=NONE cterm=NONE ctermfg=130 highlight Constant term=NONE ctermfg=99 highlight LineNr term=NONE ctermbg=NONE ctermfg=235 guifg=#586e75 highlight CursorLineNr term=underline cterm=NONE ctermbg=NONE ctermfg=124 highlight CursorLine term=NONE cterm=NONE ctermbg=NONE ctermfg=NONE highlight Exception term=bold ctermbg=NONE ctermfg=136 highlight Visual term=NONE cterm=underline ctermbg=NONE highlight Comment ctermfg=234 guifg=#002b36 highlight Folded term=underline cterm=underline ctermfg=235 ctermbg=0 highlight FoldColumn term=NONE cterm=NONE ctermfg=235 ctermbg=0 highlight StatusLineNC term=NONE cterm=NONE ctermfg=235 ctermbg=black highlight StatusLine cterm=NONE ctermfg=238 ctermbg=black highlight CmdLineEnter cterm=NONE ctermfg=238 highlight CmdLineLeave cterm=NONE ctermfg=238 highlight MsgArea cterm=NONE ctermfg=238 highlight vimGroup term=NONE cterm=NONE ctermfg=4 highlight NonText cterm=NONE ctermfg=239 highlight Pmenu term=NONE cterm=NONE ctermfg=2 ctermbg=NONE highlight PmenuSel term=NONE cterm=NONE ctermfg=121 ctermbg=NONE highlight PmenuSbar term=NONE cterm=NONE ctermfg=15 ctermbg=234 highlight PmenuThumb term=NONE cterm=NONE ctermfg=15 ctermbg=234 highlight TabLineSel term=underline cterm=underline ctermbg=NONE highlight VertSplit cterm=NONE ctermfg=12 ctermbg=NONE highlight MatchParen term=inverse cterm=inverse highlight Search term=NONE cterm=NONE ctermbg=12 ctermfg=4 highlight Statement term=NONE cterm=NONE ctermfg=11 ctermbg=NONE highlight Type term=NONE cterm=NONE ctermfg=136 ctermbg=NONE highlight Visual term=bold,underline cterm=bold,underline ctermfg=NONE ctermbg=NONE highlight Normal ctermfg=23 guifg=#586e75 highlight Boolean ctermfg=196 highlight Number ctermfg=61 highlight String ctermfg=88 highlight Function ctermfg=105 highlight Structure ctermfg=202 highlight Define ctermfg=179 highlight Conditional ctermfg=190 highlight Operator ctermfg=208 highlight PreProc term=NONE cterm=NONE ctermfg=166 ctermbg=NONE highlight ColorColumn cterm=NONE ctermfg=244 ctermbg=NONE highlight CollumnLimit cterm=NONE ctermfg=244 ctermbg=NONE highlight VertSplit ctermfg=235 gui=reverse highlight IncSearch term=standout cterm=standout ctermfg=148 ctermbg=238 highlight Search cterm=NONE ctermfg=64 ctermbg=238 guifg=Black guibg=Yellow Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"vim/plugins.html":{"url":"vim/plugins.html","title":"plugins","keywords":"","body":" usage Tabularize align with the N pattern align on specific symbol useful commands highly recommended LunarWatcher/auto-pairs junegunn/fzf.vim luochen1990/rainbow Yggdroot/indentLine airblade/vim-gitgutter vim-airline/vim-airline dense-analysis/ale programming vim-syntastic/syntastic tpope/vim-commentary ycm-core/YouCompleteMe install tips extra ycm-core/lsp-examples GroovyLanguageServer/groovy-language-server others utils vim-scripts/AuthorInfoDetect sjl/gundo.vim yegappan/mru markdown preservim/vim-markdown dhruvasagar/vim-table-mode godlygeek/tabular git tpope/vim-fugitive APZelos/blamer.nvim zivyangll/git-blame.vim color and theme ryanoasis/vim-devicons others deprecated not been using troubleshooting ycmd ycm download failed tabnine airline references: * vimcolorschemes Spelling And Grammar With Vim * amix/vimrc usage Tabularize [!TIP] Tabular cheatsheet align with first space : /^\\s*\\S\\+\\zs/l0c1l0 align the second = to left : /^\\(.\\{-}\\zs=\\)\\{2}/l1l0 specifier comments l left-align (with N spaces padding) r right-align (with N spaces padding) c center-align (with N spaces padding) :Tabularize /,/r1c1l0 means: splitting fields on commas (:) print everything before the first comma right aligned, then 1 space then the comma center aligned, then 1 space, then everything after the comma left aligned. including the align to left :Tabularize / or:Tabularize //l1 align to center :Tabularize //r1c1l0 align without [!NOTE] help /zs :Tabularize /\\zs/ align with the N pattern i.e.: the second match (=) refer to matches the N pattern align on first matche align the first ::Tabularize /^[^:]*\\zs: or:Tabularize /:.* via vim cmd [!NOTE] only for default left-alignemnt. Not support customized right/middle alignment. i.e.: /r1c1l0 command! -nargs=1 -range First exec . ',' . . 'Tabularize /^[^' . escape(, '\\^$.[?*~') . ']*\\zs' . escape(, '\\^$.[?*~') align with 2nd matches :Tabularize /^\\(.\\{-}\\zs=\\)\\{N}/ | `^` means start of the line or with \\v (very magic) reference: :help \\v vim pattern: overview of ordinary atoms :Tabularize /\\v^(.{-}\\zs\\=){N}/ for every N matches: Tabularize /\\(.\\{-}\\zs=\\)\\{N}/ | no `^` means every `{N}` matches or:Tabularize /\\v(.{-}\\zs\\=){N}/ align on specific symbol [!NOTE|label:pre condition:] align the first : and last matches , as below:[ isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , ] first : reference: via /^[^;]*\\zs: /^[^;]*\\zs:/r1c1l0 /^[^;]*/r1c1l0 /^[^:]*\\zs: isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , /^[^:]*\\zs/r1c1l0 isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , /^[^:]*\\zs:/r1c1l0 isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , /^[^:]*/r1c1l0 isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , /^[^:]*:/r1c1l0: isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , last , tips: actually the pattern not matches with the final ,, but matches with ) , sample code: isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , /)[^,]*\\zs, isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , or even better align :1,3Tabularize /, or :'Tabularize /, isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , :Tabularize /)[^,]*\\zs, isRunning : proc.getOrDefault( 'run' , false ) , name : proc.getOrDefault( 'name' , '') , runningStage : proc.getOrDefault( 'stage' , ['all'] ) , type : proc.type.split('^.*\\\\u00BB\\\\s*').last() , useful commands command! -nargs=0 -bar -range=% Reverse \\ let save_mark_t = getpos(\"'t\") \\ kt \\ exe \",g/^/m't\" \\ call setpos(\"'t\", save_mark_t) nnoremap r :Reverse nohlsearch xnoremap r :Reverse nohlsearch command! -nargs=0 DocToc execute 'silent !/usr/local/bin/doctoc --notitle --update-only --github --maxlevel 3 %' | execute 'redraw!' command! -nargs=0 FullPath execute 'echo expand(\"%:p\")' highly recommended [!NOTE|label:references:] Vim Plugin Audit LunarWatcher/auto-pairs \" LunarWatcher/auto-pairs let g:AutoPairs = autopairs#AutoPairsDefine({ '' }) let g:AutoPairsMapBS = 1 let g:AutoPairsFlyMode = 0 let g:AutoPairsCompleteOnlyOnSpace = 1 let g:AutoPairsNoJump = 0 let g:AutoPairsSpaceCompletionRegex = '\\w' \" to avoid impact with ctrl-p ( :Files ) let g:AutoPairsShortcutToggleMultilineClose = 0 let g:AutoPairsShortcutBackInsert = '' let g:AutoPairsPrefix = '' let g:AutoPairsShortcutJump = '' let g:AutoPairsShortcutToggle = '' augroup DevOps autocmd FileType markdown,html let g:AutoPairsCompleteOnlyOnSpace = 0 autocmd FileType markdown,html let b:AutoPairs = autopairs#AutoPairsDefine({ \\ '':'', '':'', '':'', '':'', \\ '':'', '':'', \\ '':'', '':'', '':'' \\ }) augroup END junegunn/fzf.vim set runtimepath+=/usr/local/opt/fzf \" $ brew install fzf Plug '/usr/local/opt/fzf' Plug 'junegunn/fzf.vim' \" fzf.vim nnoremap :Files nnoremap :GFiles nnoremap :Ag nnoremap l :Buffers nnoremap H :Helptags nnoremap g :Commits let g:fzf_layout = { 'window': { 'width': 0.9, 'height': 0.6, 'relative': v:true } } let g:fzf_history_dir = '~/.vim/cache/fzf-history' let g:fzf_vim = {} let g:fzf_vim.preview_window = [ 'right,50%', 'ctrl-\\' ] let g:fzf_vim.tags_command = 'ctags -R' let g:fzf_vim.commits_log_options = '--graph --color=always --format=\"%C(auto)%h%d %s %C(black)%C(bold)%cr\"' command! -bang -nargs=? -complete=dir Files \\ call fzf#vim#files(, {'options': ['--layout=reverse', '--info=inline', '--preview', 'bat --color=always {}']}, 0) command! -bang -complete=dir -nargs=? LS \\ call fzf#run(fzf#wrap('ls', {'source': 'ls', 'dir': }, 0)) inoremap fzf#vim#complete(fzf#wrap({ \\ 'prefix': '^.*$', \\ 'source': 'rg -n ^ --color always', \\ 'options': '--ansi --delimiter : --nth 3..', \\ 'reducer': { lines -> join(split(lines[0], ':\\zs')[2:], '') }} \\ ) \\ ) let g:fzf_action = { \\ 'ctrl-t': 'tab split', \\ 'ctrl-x': 'split', \\ 'ctrl-v': 'vsplit' \\ } let g:fzf_colors = { \\ 'fg': ['fg', 'Normal'], \\ 'bg': ['bg', 'Normal'], \\ 'preview-bg': ['bg', 'NormalFloat'], \\ 'hl': ['fg', 'Comment'], \\ 'fg+': ['fg', 'CursorLine', 'CursorColumn', 'Normal'], \\ 'bg+': ['bg', 'CursorLine', 'CursorColumn'], \\ 'hl+': ['fg', 'Statement'], \\ 'info': ['fg', 'PreProc'], \\ 'border': ['fg', 'Ignore'], \\ 'prompt': ['fg', 'Conditional'], \\ 'pointer': ['fg', 'Exception'], \\ 'marker': ['fg', 'Keyword'], \\ 'spinner': ['fg', 'Label'], \\ 'header': ['fg', 'Comment'] \\ } luochen1990/rainbow \" install Plug 'luochen1990/rainbow' \" luochen1990/rainbow \" for i in '75' '147' '108' '196' '208' '66' '106' '172' '115' '129'; do echo -e \"\\e[38;05;${i}m${i}\"; done | column -c 250 -s ' '; echo -e \"\\e[m\" let g:rainbow_active = 1 let g:rainbow_operators = 1 let g:rainbow_conf = { \\ 'guifgs' : [ '#6A5ACD', '#ff6347', '#b58900', '#9acd32', '#EEC900', '#9A32CD', '#EE7600', '#268bd2', '#183172' ], \\ 'ctermfgs' : 'xterm-256color' == $TERM ? [ '75', '147', '108', '196', '208', '66', '106', '172', '115', '129' ] : [ 'lightblue', 'lightgreen', 'yellow', 'red', 'magenta' ], \\ 'parentheses': [ ['(',')'], ['\\[','\\]'], ['{','}'] ], \\ 'separately': { \\ '*': {}, \\ 'markdown': { \\ 'parentheses_options': 'containedin=markdownCode contained', \\ }, \\ 'css': { \\ 'parentheses': [ ['(',')'], ['\\[','\\]'] ], \\ }, \\ 'scss': { \\ 'parentheses': [ ['(',')'], ['\\[','\\]'] ], \\ }, \\ 'html': { \\ 'parentheses': [ ['(',')'], ['\\[','\\]'], ['{','}'] ], \\ }, \\ 'stylus': { \\ 'parentheses': [ 'start=/{/ end=/}/ fold contains=@colorableGroup' ], \\ } \\ } \\} Yggdroot/indentLine \" install Plug 'Yggdroot/indentLine' \" settings nnoremap idl :IndentLineEnable let g:indentLine_enabled = 1 let g:indentLine_color_gui = \"#282828\" let g:indentLine_color_term = 239 let g:indentLine_indentLevel = 20 let g:indentLine_showFirstIndentLevel = 1 let g:indentLine_color_tty = 0 let g:indentLine_faster = 1 let g:indentLine_concealcursor = 'inc' let g:indentLine_conceallevel = 2 if has( 'gui_running' ) || 'xterm-256color' == $TERM let g:indentLine_char = '¦' elseif has( 'win32' ) let g:indentLine_color_term = 8 let g:indentLine_char = '|' else let g:indentLine_color_tty_dark = 0 let g:indentLine_char = '¦' endif airblade/vim-gitgutter [!NOTE|label:references:] GitGutter Documentation Can't enable gitgutter with GitGutterEnable after disabling it on startup How to display in real time Plug 'airblade/vim-gitgutter' \" airblade/vim-gitgutter let g:gitgutter_git_executable = '/usr/local/bin/git' let g:gitgutter_enabled = 1 let g:gitgutter_realtime = 0 let g:gitgutter_eager = 0 set updatetime=250 set signcolumn=yes highlight clear SignColumn vim-airline/vim-airline [!NOTE|label:references:] * iMarso : osx/apps/powerline ryanoasis/powerline-extra-symbols * Getting started with vim-airline How do I fix the status bar symbols in the Airline plugin? Airline status line and tab line text changes colour when the vimrc is sourced. Vim Airline Setup autoload/airline/init.vim Getting started with vim-airline section: #787: How to modify contents of section Y? #1087: How to replace section_y with contents of section_x? #1845: how to disable additional section totally. tips: check loaded extensions : :AirlineExtension #1373 How can I show system time in airline? * FAQ Plug 'tpope/vim-fugitive' Plug 'vim-airline/vim-airline' Plug 'vim-airline/vim-airline-themes' \" vim-airline/vim-airline let g:airline_powerline_fonts = 1 let g:airline_highlighting_cache = 1 let g:airline_detect_spelllang = 0 \" disable spelling language let g:airline_exclude_preview = 0 \" disable in preview window let g:airline_theme = 'base16_embers'\" 'base16' 'apprentice', 'gruvbox', 'zenburn' let g:Powerline_symbols = 'fancy' let g:airline_section_y = '' \" fileencoding let g:airline_section_x = '' let g:airline_section_z = \"%3p%% %l/%L:%c [%B]\" let g:airline_skip_empty_sections = 1 let g:airline_detect_modified = 1 let g:airline_detect_paste = 1 let g:airline#extensions#wordcount#enabled = 0 let g:airline#extensions#quickfix#enabled = 0 let g:airline#extensions#quickfix#quickfix_text = 'Quickfix' let g:airline#extensions#tabline#fnamemod = ':t' let g:airline_stl_path_style = 'short' let g:airline#extensions#tabline#enabled = 1 \" ╮ enable airline tabline let g:airline#extensions#tabline#show_close_button = 0 \" │ remove 'X' at the end of the tabline let g:airline#extensions#tabline#show_buffers = 1 \" │ let g:airline#extensions#tabline#show_splits = 0 \" │ disables the buffer name that displays on the right of the tabline let g:airline#extensions#tabline#tab_min_count = 2 \" │ minimum of 2 tabs needed to display the tabline let g:airline#extensions#tabline#show_tabs = 1 \" │ let g:airline#extensions#tabline#tab_nr_type = 1 \" ╯ tab number let g:airline#extensions#branch#format = 2 let g:airline#extensions#ale#enabled = 1 \" ╮ let airline#extensions#ale#error_symbol = ' ᓆ :' \" │ let airline#extensions#ale#warning_symbol = ' ᣍ :' \" ├ ale let airline#extensions#ale#show_line_numbers = 1 \" │ let airline#extensions#ale#open_lnum_symbol = '(␊:' \" │ let airline#extensions#ale#close_lnum_symbol = ')' \" ╯ if !exists('g:airline_symbols') | let g:airline_symbols = {} | endif let g:airline_symbols.dirty = ' ♪' let g:airline_left_sep = '' let g:airline_right_sep = '' function! AirlineInit() let g:airline_section_a = airline#section#create([ '[', 'mode', ']', '  ', '%{&fenc}' ]) let g:airline_section_y = airline#section#create([ '%{strftime(\"%H:%M %b-%d %a\")} ', '['.&ff.']' ]) let g:airline_section_c = '% tips remove section_ let g:airline_section_ = '' \" remove the filetype part let g:airline_skip_empty_sections = 1 \" remove separators for empty sections setup short mode let g:airline_mode_map = { '__': '-', 'n' : 'N', 'i' : 'I', 'R' : 'R', 'c' : 'C', 'v' : 'V', 'V' : 'V', '\u0016': 'V', 's' : 'S', 'S' : 'S', '\u0013': 'S', } unicode symbols [!NOTE|label:symbols] :help airline \" powerline symbols let g:airline_left_sep = '' \" \\ue0b0 let g:airline_left_alt_sep = '' \" \\ue0b1 let g:airline_right_sep = '' \" \\ue0b2 let g:airline_right_alt_sep = '' \" \\ue0b3 let g:airline_symbols.branch = '' \" \\ue0a0 let g:airline_symbols.colnr = ' ℅:' \" \\u2105 \\u3a let g:airline_symbols.readonly = '' \" \\ue0a2 let g:airline_symbols.linenr = ' :' \" \\ue0a1 let g:airline_symbols.maxlinenr = '☰ ' \" \\u2630 let g:airline_symbols.dirty = '⚡' \" \\u26a1 \" old vim-powerline symbols let g:airline_left_sep = '⮀' \" \\u2b80 let g:airline_left_alt_sep = '⮁' \" \\u2b81 let g:airline_right_sep = '⮂' \" \\u2b82 let g:airline_right_alt_sep = '⮃' \" \\u2b83 let g:airline_symbols.branch = '⭠' \" \\u2b60 let g:airline_symbols.readonly = '⭤' \" \\u2b64 let g:airline_symbols.linenr = '⭡' \" \\u2b61 \" unicode symbols let g:airline_left_sep = '»' \" \\u00bb let g:airline_left_sep = '▶' \" \\u25b6 let g:airline_right_sep = '«' \" \\u00ab let g:airline_right_sep = '◀' \" \\u25c0 let g:airline_symbols.colnr = ' ㏇:' \" \\u33C7 let g:airline_symbols.colnr = ' ℅:' \" \\u2105 let g:airline_symbols.crypt = '🔒' \" \\U0001f512 let g:airline_symbols.linenr = '☰' \" \\u2630 let g:airline_symbols.linenr = ' ␊:' \" \\u240a let g:airline_symbols.linenr = ' :' \" \\u2424 let g:airline_symbols.linenr = '¶' \" \\u00b6 let g:airline_symbols.maxlinenr = '' let g:airline_symbols.maxlinenr = '㏑' \" \\u33d1 let g:airline_symbols.branch = '⎇' \" \\u2387 let g:airline_symbols.paste = 'ρ' \" \\u03c1 let g:airline_symbols.paste = 'Þ' \" \\u00de let g:airline_symbols.paste = '∥' \" \\u2225 let g:airline_symbols.spell = 'Ꞩ' \" \\ua7a8 let g:airline_symbols.notexists = 'Ɇ' \" \\u0246 let g:airline_symbols.notexists = '∄' \" \\u2204 let g:airline_symbols.whitespace = 'Ξ' \" \\u039e :help airline-customization \" unicode symbols let g:airline_left_sep = '»' let g:airline_left_sep = '▶' let g:airline_right_sep = '«' let g:airline_right_sep = '◀' let g:airline_symbols.linenr = '␊' let g:airline_symbols.linenr = ' ' let g:airline_symbols.linenr = '¶' let g:airline_symbols.branch = '⎇' let g:airline_symbols.paste = 'ρ' let g:airline_symbols.paste = 'Þ' let g:airline_symbols.paste = '∥' let g:airline_symbols.whitespace = 'Ξ' let g:airline_symbols.branch = '⎇' \" ╮ let g:airline_symbols.paste = 'ρ' \" ├ unicode symbols let g:airline_symbols.dirty = ' ↯' \" ╯ get theme randomly [!NOTE] #2145 : Align section C to the left when overflowed let g:airline_theme = 'random' sections [!NOTE|label:references:] #696 : Accents may cause status line exceed width let g:airline_section_x = \"%-{strftime(\\\"%H:%M\\ %d/%m/%y\\\")} %1*--%n%%--%*\" let g:airline_section_y = \"%{&fenc}%{&bomb ? '[bom]' : ''}%{strlen(&ff) > 0 ? '['.&ff.']' : ''}\" let g:airline#parts#ffenc#skip_expected_string ='utf-8[unix]' let g:airline_section_c_only_filename = 0 function! AirlineInit() \" NORMAL  docs/vim/ let g:airline_section_a = airline#section#create([ 'mode', '  ', '%{join( split(getcwd(), \"/\")[-2:-1], \"/\" )}', '/' ]) \" NORMAL  docs/vim/plugins.md let g:airline_section_a = airline#section#create([ 'mode', '  ', '%{join( split(expand(\"%:p\"), \"/\")[-3:-1], \"/\" )}' ]) let g:airline_section_y = airline#section#create(['%{strftime(\"%H:%M %b-%d %a\")} ', '['.&ff.']']) let g:airline_section_c = '% section_a [!NOTE|label:paths:] show relative path %F : let g:airline_section_c = airline#section#create([ '%F' ]) -> ~/.vimrc show filename only %f : let g:airline_section_c = airline#section#create([ '%f' ]) -> .vimrc via function function! ShortPath() let pathlist=split(expand(\"%:p:~\"), \"/\") return len(pathlist) i.e.: function! ShortPath() let pathlist=split(expand(\"%:p:~\"), \"/\") return len(pathlist) via %{} function! AirlineInit() let pathlist=split( expand(\"%:p:~\"), \"/\" ) let g:airline_section_a = airline#section#create([ 'mode', '  ', '%{len(pathlist) sections with length limitation %: let g:airline_section_c = '% %-0.xx{} : let g:airline_section_c = '% i.e.: let g:airline_section_c = '% themes n-st/vim-airline-screenshots * Change the vim-airline theme :AirlineTheme random : let g:airline_theme='random' : :echo g:airline_theme tomorrow distinguished base16 angr zenburn zenburn wombat great themes base16_embers base16 apprentice gruvbox zenburn angr selenized/selenized_bw biogoo base16_default base16color base16_chalk base16_bright biogoo ( dark background in insert mode ) nice themes owo hybrid bubblegum supernova alduin base16_summerfruit base16_atelierseaside raven ( no background color ) peaksea ( no background color change ) dense-analysis/ale [!NOTE|label:references:] How do I disable \"annotations\" generated by ALE in vim? How do i get rid of Ale errors on the line i am editing? Plug 'stephpy/vim-yaml' Plug 'pedrohdz/vim-yaml-folds' Plug 'dense-analysis/ale' \" yamllint \" brew install yamllint \" ale \" :help g:ale_echo_msg_format let g:ale_echo_msg_format = '[%linter%] %code%: %s [%severity%] ' let g:ale_virtualtext_prefix = '%comment% %type% [%code%]: ' let g:ale_sign_error = '💢' \" ✘ 👾 💣 🙅 🤦 let g:ale_sign_warning = 'ᑹᑹ' \" ⚠ ⸮ ⸘ ☹ let g:ale_sign_info = 'ᓆ' \" ⸚ ϔ 𐘿 𐰦 let g:ale_sign_style_error = '⍥' \" ᑹ let g:ale_sign_style_warning = 'ᓍ' \" ᓏ let g:ale_lint_on_text_changed = 'never' let g:ale_fix_on_save = 0 let g:ale_lint_on_save = 1 let g:ale_warn_about_trailing_blank_lines = 1 let g:ale_warn_about_trailing_whitespace = 1 let g:ale_set_balloons = 1 let g:ale_hover_to_preview = 1 let g:ale_floating_preview = 1 let g:ale_close_preview_on_insert = 1 programming vim-syntastic/syntastic [!NOTE|label:references:] #1577 : Unknown function: SyntasticStatuslineFlag In Editor Linting with Syntastic:SyntasticInfo Plug 'vim-syntastic/syntastic' \" syntastic settings \" Plug 'vim-syntastic/syntastic' set statusline+=%#warningmsg# set statusline+=%{SyntasticStatuslineFlag()} set statusline+=%* let g:syntastic_always_populate_loc_list = 1 let g:syntastic_auto_loc_list = 1 let g:syntastic_check_on_open = 1 let g:syntastic_check_on_wq = 0 let g:syntastic_loc_list_height = 2 let g:syntastic_ignore_files = ['\\.py$'] let g:syntastic_html_tidy_ignore_errors = [\" proprietary attribute \\\"ng-\"] let g:syntastic_enable_signs = 1 let g:syntastic_info_symbol = 'ೲ' \" ࠵ ϊ let g:syntastic_error_symbol = '✗' \" ஓ ௐ ྾ let g:syntastic_warning_symbol = '⍨' \" ᓆ ᓍ let g:syntastic_style_error_symbol = '⍥' let g:syntastic_style_warning_symbol = 'ఠ' \" ⍤ ൠ highlight link SyntasticErrorSign Error highlight link SyntasticWarningSign GruvboxYellow highlight link SyntasticStyleErrorSign GruvboxRedSign highlight link SyntasticStyleWarningSign GruvboxPurpleSign Bundle 'vim-syntastic/syntastic' \" configure syntastic syntax checking to check on open as well as save set statusline+=%#warningmsg# set statusline+=\\ %{SyntasticStatuslineFlag()} \" vim-syntastic/syntastic set statusline+=\\ %* | let g:syntastic_always_populate_loc_list = 1 let g:syntastic_auto_loc_list = 1 let g:syntastic_check_on_open = 1 let g:syntastic_check_on_wq = 0 let g:syntastic_loc_list_height = 2 let g:syntastic_ignore_files = ['\\.py$'] let g:syntastic_html_tidy_ignore_errors = [\" proprietary attribute \\\"ng-\"] tpope/vim-commentary \" tpope/vim-commentary map gcc map x gcc imap CommentaryLineA xmap Commentary augroup DevOps autocmd FileType ignore,gitconfig setlocal commentstring=#\\ %s augroup END ycm-core/YouCompleteMe [!NOTE|label:references:] * iMarslo: build python from source * iMarslo: build vim from source gitter room ycm-core/YouCompleteMe Eclipse Downloads jdt-language-server-1.19.0-202301090450.tar.gz) Vim/YouCompleteMe 在vim中配置最新YouCompleteMe代码自动补全插件 * How to Set Up Code-Completion for Vim in macOS install [!TIP|label:references:] Building Vim from source * Installation * macOS Linux 64-bit Windows Full Installation Guide Full installation on CentOS Windows Installation Guide for Unix‐like Environments * Troubleshooting steps for ycmd server SHUT DOWN issue with sudo npm install -g$ sudo chown -R $USER /usr/local/lib/node_modules $ npm install -g .. OPTION LANGUAGE TOOL DEPENDENCIES --clang-completer C, C++, Objective-C Clang（libclang） Clang --clangd-completer C, C++, Objective-C clang-tools-extra(clangd) clang-tools-extra --cs-completer C# Mono Runtime Mono Runtime --rust-completer Rust RustToolChains RustToolChains --go-completer golang GoToolchain GoToolchain --js-completer JavaScript Tern node.js、npm --ts-completer JavaScript, TypeScript tsserver node.js、npm --java-completer Java eclipse.jdt.ls JDK8 --all all - - environment setup macOS [!NOTE|label:references:] #1925 How to build using -march=native? vim ycm c++ 环境搭建 MAC安装YCM C/C++/Objective-C/Objective-C++：--clang-completer C#：brew install Mono first and enabled by --cs-completer Go：brew install go and enabled by --go-completer TypeScript：insall Node.js and npm，and enable typescript via npm install -g typescript JavaScript: install Node.js and npm，and enabled via --js-completer Rust: install Rust，--rust-completer Java: brew install java，enabled via --java-completer for all support : enabled via --all $ brew install cmake python go nodejs $ pip install urllib3 $ pip install --user cmake $ sudo xcode-select -switch /Applications/Xcode.app $ brew install java $ sudo ln -sfn $(brew --prefix java)/libexec/openjdk.jdk /Library/Java/JavaVirtualMachines/openjdk.jdk # optioinal for C# $ brew install mono # optional $ brew install jdtls ## check # cmake $ ~/Library/Python/3.12/bin/cmake --version cmake version 3.28.1 CMake suite maintained and supported by Kitware (kitware.com/cmake). $ /usr/local/bin/cmake --version cmake version 3.28.1 CMake suite maintained and supported by Kitware (kitware.com/cmake). # java $ java -version openjdk version \"20.0.1\" 2023-04-18 OpenJDK Runtime Environment Homebrew (build 20.0.1) OpenJDK 64-Bit Server VM Homebrew (build 20.0.1, mixed mode, sharing) # c/c++ $ xbuild --version >>>> xbuild tool is deprecated and will be removed in future updates, use msbuild instead python [!NOTE|label:install python from source] iMarslo: build python from source $ python --version Python 3.11.4 $ pip --version pip 23.2.1 from /usr/local/lib/python3.11/site-packages/pip (python 3.11) wsl/ubuntu install [!NOTE|label:references:] nodejs/snap How to install cmake 3.2 on Ubuntu tips using snap instead of apt for nodejs due to$ sudo apt install nodejs $ node --version v12.22.9 $ sudo mkdir -p /etc/apt/keyrings $ curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg $ echo \"deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_current.x nodistro main\" | sudo tee /etc/apt/sources.list.d/nodesource.list $ sudo apt install build-essential cmake vim-nox python3-dev $ sudo apt install mono-complete golang openjdk-17-jdk openjdk-17-jre npm # nodejs/golang using snap instead of $ sudo apt isntall nodejs $ sudo snap install node --classic --channel=15 # upgrade version to 20.x $ sudo snap refresh --channel=20 node node (20/stable) 20.8.0 from OpenJS Foundation (iojs✓) refreshed # check $ go version go version go1.18.1 linux/amd64 $ node --version v20.10.0 $ cmake --version cmake version 3.22.1 CMake suite maintained and supported by Kitware (kitware.com/cmake). $ java --version openjdk 19.0.2 2023-01-17 OpenJDK Runtime Environment (build 19.0.2+7-Ubuntu-0ubuntu322.04) OpenJDK 64-Bit Server VM (build 19.0.2+7-Ubuntu-0ubuntu322.04, mixed mode, sharing) snap install for cmake and golang $ sudo snap install cmake --classic $ sudo snap install go --classic # or $ sudo apt install golang-go $ go version go version go1.21.5 linux/amd64 offline ( only allows apt and git ) [!NOTE|label:references:] Installing Gradle Gradle Installing manually Go: Download and install How to fix npm throwing error without sudo Don’t use sudo with npm Ubuntu setup # c/c++ $ sudo apt install build-essential cmake vim-nox $ sudo apt install build-essential cmake vim-nox $ sudo apt install python3.11-dev python3-pip $ python3 -m pip install --upgrade pip # java $ sudo apt install openjdk-21-doc openjdk-21-jdk $ export JAVA_HOME='/usr/lib/jvm/java-21-openjdk-amd64' # go $ curl -LO https://go.dev/dl/go1.21.5.linux-amd64.tar.gz # or $ sudo apt install golang-1.21 golang-1.21-go golang-1.21-doc $ sudo update-alternatives --install /usr/bin/go go /usr/lib/go-1.21/bin/go 99 $ sudo update-alternatives --install /usr/bin/gofmt gofmt /usr/lib/go-1.21/bin/gofmt 99 $ sudo update-alternatives --auto go $ sudo update-alternatives --auto gofmt # node/npm $ npm config set registry https://artifactory.sample.com/artifactory/api/npm/npm-remote/ $ sudo mkdir -p /usr/local/n && sudo chwon -R $(whoami) /usr/local/n $ sudo n latest $ npm i -g npm-completion --verbose # gradle $ curl -O https://services.gradle.org/distributions/gradle-7.6.1-bin.zip # download somewhere and sync to server $ unzip gradle-7.6.1-bin.zip -d /opt/gradle $ ln -sf /opt/gradle/gradle-7.6.1 /opt/gradle/latest $ sudo update-alternatives --install /usr/local/bin/gralde gradle /opt/gradle/latest/bin/gradle 99 $ sudo update-alternatives --auto gradle centos [!NOTE] #2756: CMake Error,no libclang found Using LLVM 13.0.1 Toolset PDF: Red Hat Developer Tools 1: Using LLVM 13.0.1 Toolset Getting Started with the LLVM System > - `dnf install gcc-c++` dnf install $ sudo dnf install cmake make * iMarslo: build python from source # or $ sudo dnf install python3-devel * iMarslo: build gcc from source * iMarslo: build ruby from source * iMarslo: build mono from source or $ sudo dnf install -y cmake \\ clang clang-devel clang-libs clang-tools-extra \\ # no libclang found llvm llvm-libs \\ go $ curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh $ sudo dnf install java-17-openjdk-devel java-17-openjdk # upgrade nodejs $ node --version v12.22.5 $ sudo npm i -g n $ sudo mkdir -p /usr/local/n && sudo chown -R $(whoami) /usr/local/n $ sudo n latest $ which -a node /usr/local/bin/node /usr/bin/node $ node --version v20.8.1 $ /usr/bin/node --version v12.22.5 install with install.py # full install $ cd ~/.vim/bundle/YouCompleteMe $ python3 install.py --all --verbose with --system-libclang $ brew install llvm $ cd ~/.vim/bundle/YouCompleteMe $ python3 install.py --system-libclang --all --verbose $ cat ~/.vimrc ... let g:ycm_clangd_binary_path = trim(system('brew --prefix llvm')).'/bin/clangd' ... install with install.sh $ cd ~/.vim/bundle/YouCompleteMe $ ./install.py --all --verbose # or $ ./install.py --clangd-completer --verbose # or ./install.py --verbose tips popup [!NOTE|label:references] YCM documentation hover - should we enable it by default :help completeopt :help previewpopup :help completepopup The g:ycm_add_preview_to_completeopt option let g:ycm_add_preview_to_completeopt = 0 let g:ycm_autoclose_preview_window_after_insertion = 1 let g:ycm_autoclose_preview_window_after_completion = 1 set completeopt-=preview set completeopt+=popup hint # highlight highlight link YcmInlayHint Comment extra .ycm_extra_conf.py [!NOTE|label:references] * ycm-core/ycmd/.ycm_extra_conf.py iogf's ycm_extra_conf ycm_extra_conf/ycm_extra_conf.py nemausus/dotfiles/ycm_extra_conf.py A better YouCompleteMe Config CM代码补全插件找不到c++头文件 to disable prompt message for extra config in vimrclet g:ycm_confirm_extra_conf = 0 # create simple file for sample.cpp $ g++ -v test.cpp #include “…” search starts here: #include search starts here: /usr/include/c++/11 /usr/include/x86_64-linux-gnu/c++/11 /usr/include/c++/11/backward /usr/lib/gcc/x86_64-linux-gnu/11/include /usr/local/include /usr/include/x86_64-linux-gnu /usr/include $ cat >> ~/.ycm_extra_conf.py \" flag, clang won't know which # language to use when compiling headers. So it will guess. Badly. So C++ # headers will be compiled as C headers. You don't want that so ALWAYS specify # a \"-std=\". # For a C project, you would set this to something like 'c99' instead of # 'c++11'. '-std=c++11', # ...and the same thing goes for the magic -x option which specifies the # language that the files to be compiled are written in. This is mostly # relevant for c++ headers. # For a C project, you would set this to 'c' instead of 'c++'. '-x', 'c++', '-I', '.', '-isystem', '/usr/include/c++/11', '-isystem', '/usr/include/x86_64-linux-gnu/c++/11', '-isystem', '/usr/include/c++/11/backward', '-isystem', '/usr/lib/gcc/x86_64-linux-gnu/11/include', '-isystem', '/usr/local/include', '-isystem', '/usr/include/x86_64-linux-gnu', '-isystem', '/usr/include', ] EOF vimrc [!NOTE|label:references:] chxuan/vimplus/.vimrc A better YouCompleteMe Config ycm vimrc_ycm_minimal test/vimrc #3906 completion popmenu close automatically After type . Plug 'ycm-core/YouCompleteMe', { 'do': 'python3 install.py --all' } Plug 'ycm-core/lsp-examples', { 'do': 'python3 install.py --all' } \" ycm-core/YouCompleteMe nnoremap gc :YcmCompleter GoToDeclaration nnoremap gf :YcmCompleter GoToDefinition nnoremap go :YcmCompleter GoToInclude nnoremap gg :YcmCompleter GoToDefinitionElseDeclaration nnoremap gd :YcmDiags let g:ycm_extra_conf_globlist = ['~/.marslo/ycm/*', '~/.vim/plugged/YouCompleteMe/*'] let g:ycm_key_invoke_completion = '' let g:ycm_echo_current_diagnostic = 'virtual-text' let g:ycm_error_symbol = '✗' let g:ycm_warning_symbol = '✹' let g:ycm_seed_identifiers_with_syntax = 1 let g:ycm_complete_in_comments = 1 let g:ycm_complete_in_strings = 1 let g:ycm_collect_identifiers_from_tags_files = 1 let g:ycm_keep_logfiles = 1 let g:ycm_log_level = 'debug' let g:ycm_show_detailed_diag_in_popup = 1 let g:ycm_filepath_completion_use_working_dir = 1 let g:ycm_min_num_of_chars_for_completion = 1 let g:ycm_complete_in_comments = 1 let g:ycm_autoclose_preview_window_after_insertion = 1 let g:ycm_filetype_whitelist = { '*': 1, 'ycm_nofiletype': 1 } let g:ycm_filetype_specific_completion_to_disable = { 'gitcommit': 1, 'vim': 1 } let g:ycm_filetype_blacklist = { \\ 'tagbar' : 1, \\ 'notes' : 1, \\ 'netrw' : 1, \\ 'unite' : 1, \\ 'vimwiki' : 1, \\ 'infolog' : 1, \\ 'leaderf' : 1, \\ 'mail' : 1, \\ 'help' : 1, \\ 'undo' : 1 \\ } let g:ycm_semantic_triggers = { \\ 'c' : [ '->', '.'], \\ 'objc' : [ '->', '.', 're!\\[[_a-zA-Z]+\\w*\\s', 're!^\\s*[^\\W\\d]\\w*\\s', 're!\\[.*\\]\\s'], \\ 'ocaml' : [ '.', '#'], \\ 'cpp,cuda,objcpp' : [ '->', '.', '::'], \\ 'perl' : [ '->'], \\ 'php' : [ '->', '::'], \\ 'cs,d,elixir,go,groovy,java,javascript,julia,perl6,python,scala,typescript,vb': ['.'], \\ 'ruby,rust' : [ '.', '::'], \\ 'lua' : [ '.', ':'], \\ 'erlang' : [ ':'], \\ } \" ycm-core/lsp-examples let g:ycm_lsp_dir = expand( pluginHome . 'lsp-examples' ) let s:pip_os_dir = 'bin' if has( 'win32' ) | let s:pip_os_dir = 'Scripts' | end source $HOME/.vim/plugged/lsp-examples/vimrc.generated augroup YCMCustomized autocmd! autocmd Filetype vim let g:ycm_complete_in_strings = 3 autocmd FileType c,cpp,sh,python,groovy,Jenkinsfile let b:ycm_hover = { \\ 'command': 'GetDoc', \\ 'syntax': &filetype, \\ 'popup_params': { \\ 'maxwidth': 80, \\ 'border': [], \\ 'borderchars': ['─', '│', '─', '│', '┌', '┐', '┘', '└'], \\ }, \\ } augroup END ycm-core/lsp-examples [!NOTE|label:references:] YouCompleteMe YouCompleteMe with JSON YouCompleteMe with YAML YouCompleteMe with VimL My Julia setup for vim with YCM on Linux Language Server Protocol Specification - 3.17 vimrc $ cat ~/.vimrc Plug 'ycm-core/lsp-examples' vim +BundleInstall +qa install $ cd ~/.vim/plugged/lsp-examples $ python install.py --all ## add into .vimrc source $HOME/.vim/plugged/lsp-examples/vimrc.generated $ cd ~/.vim/bundle/lsp-examples $ python install.py --enable-cmake \\ --enable-python \\ --enable-viml \\ --enable-bash \\ --enable-json \\ --enable-yaml \\ --enable-groovy \\ --enable-docker $ cat /Users/marslo/.vim/bundle/lsp-examples/vimrc.generated | pbcopy # paste into .vimrc sample vimrc\"\"\" ycm lsp let g:ycm_lsp_dir = '~/.vim/bundle/lsp-examples' let s:pip_os_dir = 'bin' let g:ycm_language_server = [ \\ { 'name': 'docker', \\ 'filetypes': [ 'dockerfile' ], \\ 'cmdline': [ expand( g:ycm_lsp_dir . '/docker/node_modules/.bin/docker-langserver' ), '--stdio' ] \\ }, \\ { \\ 'name': 'cmake', \\ 'cmdline': [ expand( g:ycm_lsp_dir . '/cmake/venv/' . s:pip_os_dir . '/cmake-language-server' )], \\ 'filetypes': [ 'cmake' ], \\ }, \\ { \\ 'name': 'python', \\ 'cmdline': [ 'node', expand( g:ycm_lsp_dir . '/python/node_modules/.bin/pyright-langserver' ), '--stdio' ], \\ 'filetypes': [ 'python' ], \\ }, \\ { 'name': 'vim', \\ 'filetypes': [ 'vim' ], \\ 'cmdline': [ expand( g:ycm_lsp_dir . '/viml/node_modules/.bin/vim-language-server' ), '--stdio' ] \\ }, \\ { \\ 'name': 'bash', \\ 'cmdline': [ 'node', expand( g:ycm_lsp_dir . '/bash/node_modules/.bin/bash-language-server' ), 'start' ], \\ 'filetypes': [ 'sh', 'bash' ], \\ }, \\ { \\ 'name': 'json', \\ 'cmdline': [ 'node', expand( g:ycm_lsp_dir . '/json/node_modules/.bin/vscode-json-languageserver' ), '--stdio' ], \\ 'filetypes': [ 'json' ], \\ 'capabilities': { 'textDocument': { 'completion': { 'completionItem': { 'snippetSupport': v:true } } } }, \\ }, \\ { \\ 'name': 'yaml', \\ 'cmdline': [ 'node', expand( g:ycm_lsp_dir . '/yaml/node_modules/.bin/yaml-language-server' ), '--stdio' ], \\ 'filetypes': [ 'yaml' ], \\ 'capabilities': { \\ 'workspace': { 'configuration': v:true }, \\ 'textDocument': { \\ 'completion': { \\ 'completionItem': { 'snippetSupport': v:true }, \\ } \\ } \\ }, \\ }, \\ { \\ 'name': 'groovy', \\ 'cmdline': [ 'java', '-jar', expand( g:ycm_lsp_dir . '/groovy/groovy-language-server/build/libs/groovy-language-server-all.jar' ) ], \\ 'filetypes': [ 'groovy' ] \\ } \\ ] GroovyLanguageServer/groovy-language-server # java has to be less than jdk 19 $ brew install openjdk@17 $ export JAVA_HOME='/usr/local/opt/openjdk@17' $ export PATH=${JAVA_HOME}/bin:${PATH} $ export CPPFLAGS=\"-I${JAVA_HOME}/include ${CPPFLAGS}\" $ git clone git@github.com:GroovyLanguageServer/groovy-language-server.git $ ./gradew build # run $ git@github.com:GroovyLanguageServer/groovy-language-server.git others vim-easycomplete [!NOTE|label:references:] How to improve your vim/nvim coding experience with vim-easycomplete? Vim-EasyComplete 体验优化踩坑记录 vim-easycomplete VS vim-lsp Which lsp plugin should I use? utils vim-scripts/AuthorInfoDetect Plug 'marslo/authorinfo' noremap aid :AuthorInfoDetect let g:vimrc_author = 'marslo' let g:vimrc_email = 'marslo.jiao@gmail.com' autocmd BufWritePre, FileWritePre * :AuthorInfoDetect autocmd BufWritePre * :AuthorInfoDetect sjl/gundo.vim [!TIP] delete undo file for 3 days ago$ find ~/.vim/undo -mtime +3 # or $ fd --type=file \\ --change-older-than=30days \\ . \\ ~/.cache/vim/{backup,swap,undo}/ \\ -x rm -v Plug 'sjl/gundo.vim' noremap u :GundoToggle set undodir=~/.vim/undo/ set undofile yegappan/mru noremap re :MRU let MRU_Auto_Close = 1 \" most recently used(mru) let MRU_Max_Entries = 10 let MRU_Exclude_Files = '^/tmp/.*\\|^/temp/.*\\|^/media/.*\\|^/mnt/.*' markdown preservim/vim-markdown Plug 'preservim/vim-markdown' \" preservim/vim-markdown let g:vim_markdown_toc_autofit = 1 let g:vim_markdown_conceal = 0 let g:vim_markdown_conceal_code_blocks = 0 let g:vim_markdown_strikethrough = 1 let g:vim_markdown_folding_disabled = 1 \" let g:vim_markdown_frontmatter = 1 \" let g:vim_markdown_json_frontmatter = 1 \" let g:vim_markdown_autowrite = 1 \" let g:vim_markdown_follow_anchor = 1 \" let g:vim_markdown_anchorexpr = \"'>'\" dhruvasagar/vim-table-mode Plug 'dhruvasagar/vim-table-mode' noremap tm :TableModeToggle let g:table_mode_corner = '|' let g:table_mode_header_fillchar = '-' let g:table_mode_align_char = \":\" let g:table_mode_corner = \"|\" let g:table_mode_align_char = \":\" \" let g:table_mode_corner_corner = '+' function! s:isAtStartOfLine(mapping) let text_before_cursor = getline('.')[0 : col('.')-1] let mapping_pattern = '\\V' . escape(a:mapping, '\\') let comment_pattern = '\\V' . escape(substitute(&l:commentstring, '%s.*$', '', ''), '\\') return (text_before_cursor =~? '^' . ('\\v(' . comment_pattern . '\\v)?') . '\\s*\\v' . mapping_pattern . '\\v$') endfunction inoreabbrev \\ isAtStartOfLine('\\|\\|') ? \\ ':TableModeEnable' : '' inoreabbrev __ \\ isAtStartOfLine('__') ? \\ ':silent! TableModeDisable' : '__' let g:tabular_loaded = 1 godlygeek/tabular \" install Plug 'godlygeek/tabular' \" settings noremap tb :TableModeToggle let g:table_mode_corner='|' let g:table_mode_header_fillchar='-' let g:table_mode_corner_corner='|' function! s:isAtStartOfLine(mapping) let text_before_cursor = getline('.')[0 : col('.')-1] let mapping_pattern = '\\V' . escape(a:mapping, '\\') let comment_pattern = '\\V' . escape(substitute(&l:commentstring, '%s.*$', '', ''), '\\') return (text_before_cursor =~? '^' . ('\\v(' . comment_pattern . '\\v)?') . '\\s*\\v' . mapping_pattern . '\\v$') endfunction inoreabbrev \\ isAtStartOfLine('\\|\\|') ? \\ ':TableModeEnable' : '' inoreabbrev __ \\ isAtStartOfLine('__') ? \\ ':silent! TableModeDisable' : '__' let g:tabular_loaded = 1 if exists(\":Tabularize\") nmap a= :Tabularize /= vmap a= :Tabularize /= nmap a: :Tabularize /:\\zs vmap a: :Tabularize /:\\zs inoremap :call table_auto_align() function! s:table_auto_align() let p = '^\\s*|\\s.*\\s|\\s*$' if exists(':Tabularize') && getline('.') =~# '^\\s*|' \\ && (getline(line('.')-1) =~# p || getline(line('.')+1) =~# p) let column = strlen(substitute(getline('.')[0:col('.')],'[^|]','','g')) let position = strlen(matchstr(getline('.')[0:col('.')],'.*|\\s*\\zs.*')) Tabularize/|/l1 normal! 0 call search(repeat('[^|]*|',column).'\\s\\{-\\}'.repeat('.',position),'ce',line('.')) endif endfunction endif git call bash cmd in silent modennoremap mp :execute 'silent !git push --force' \\| redraw! tpope/vim-fugitive Plug 'tpope/vim-fugitive' \" fugitive nnoremap mp :silent exec '! git mp' nnoremap ga :Git add %:p nnoremap gs :Gstatus nnoremap gl :silent! Glog:bot copen nnoremap gp :Ggrep nnoremap gb :Git branch nnoremap go :Git checkout nnoremap gc :Git commit -am \"\" command! -bar -nargs=* Gpull execute 'Git pull' command! -bar -nargs=* Gpush execute 'Git push' APZelos/blamer.nvim Plug 'APZelos/blamer.nvim' \" APZelos/blamer.nvim nnoremap bb :BlamerToggle let g:blamer_enabled = 0 let g:blamer_delay = 100 let g:blamer_show_in_visual_modes = 0 let g:blamer_show_in_insert_modes = 0 let g:blamer_relative_time = 1 \" let g:blamer_prefix = ' » ' zivyangll/git-blame.vim \" zivyangll/git-blame.vim nnoremap ebb :call gitblame#echo() color and theme [!NOTE|label:references:] Highlighting color strings with correspondent color plugins: chrisbra/Colorizer gko/vim-coloresque ap/vim-css-color skammer/vim-css-color ryanoasis/vim-devicons [!NOTE|label:unicodes] filetype: U+E5FA to U+E9F9 requires nerd fonts | nerd fonts preview and download others deprecated kien/ctrlp.vim Plug 'kien/ctrlp.vim' let g:ctrlp_map = '' \" CtrlP let g:ctrlp_working_path_mode = 'ra' \" search parents as well (stop searching safety) let g:ctrlp_max_height = 8 let g:ctrlp_max_depth = 100 let g:ctrl_root_makers = ['.ctrlp'] \" stop search if these files present let g:ctrlp_use_caching = 1 let g:ctrlp_clear_cache_on_exit = 0 \" cross session caching if has('win32') || has('win95') || has('win64') let g:ctrlp_cache_dir = $VIM . '/cache/ctrlp' else let g:ctrlp_cache_dir = '$HOME/.vim/cache/ctrlp' endif let g:ctrlp_custom_ignore = { \\ 'dir': '\\v[\\/]\\.(git|hg|svn)$', \\ 'file': '\\v\\.(exe|so|dll|rpm|tar|gz|bz2|zip|ctags|tags)|tags|ctags$', \\ 'link': 'some_bad_symbolic_links', \\ } tabnine-vim [!DANGER|label:ERROR] not working for python3.9+, using codota/tabnine-nvim tabnine/YouCompleteMe \" tabnine-vim if index(['vim'], &filetype) == -1 | let g:loaded_youcompleteme = 1 | endif if !(&filetype == 'vim') | let g:loaded_youcompleteme = 1 | endif if &filetype ==# 'vim' | let g:loaded_youcompleteme = 0 | endif let g:ycm_filetype_blacklist = { 'vim':0 } let b:ycm_largefile = 1 let g:ycm_disable_for_files_larger_than_kb = 1000 let g:ycm_python_binary_path = '/usr/local/opt/python/libexec/bin/python' let g:ycm_min_num_of_chars_for_completion = 2 let g:ycm_python_binary_path = '/usr/local/opt/python@3.9/libexec/bin/python' let g:ycm_filetype_specific_completion_to_disable = { 'gitcommit': 1 } let g:ycm_semantic_triggers = { \\ 'c': ['->', '.'], \\ 'objc': ['->', '.', 're!\\[[_a-zA-Z]+\\w*\\s', 're!^\\s*[^\\W\\d]\\w*\\s', \\ 're!\\[.*\\]\\s'], \\ 'ocaml': ['.', '#'], \\ 'cpp,cuda,objcpp': ['->', '.', '::'], \\ 'perl': ['->'], \\ 'php': ['->', '::'], \\ 'cs,d,elixir,go,groovy,java,javascript,julia,perl6,python,scala,typescript,vb': ['.'], \\ 'ruby,rust': ['.', '::'], \\ 'lua': ['.', ':'], \\ 'erlang': [':'], \\ } function! TriggerYCM() if g:loaded_youcompleteme == 1 let g:loaded_youcompleteme = 0 else let g:loaded_youcompleteme = 1 endif endfunction nmap :call TriggerYCM() disable tabnine for vim\" tabnine-vim \" Plug 'codota/tabnine-vim' if index(['vim'], &filetype) == -1 | let g:loaded_youcompleteme = 1 | endif if !( &filetype == 'vim' ) | let g:loaded_youcompleteme = 1 | endif vim-scripts/EnhCommentify.vim\" EnhCommentify let g:EnhCommentifyAlignRight = 'Yes' let g:EnhCommentifyRespectIndent = 'yes' let g:EnhCommentifyPretty = 'Yes' let g:EnhCommentifyMultiPartBlocks = 'Yes' let g:EnhCommentifyUseSyntax = 'Yes' honza/vim-snippetsPlug 'honza/vim-snippets' not been using msanders/snipmate.vim Plug 'msanders/snipmate.vim' \" Snippet imap snipMateNextOrTrigger smap snipMateNextOrTrigger imap snipMateNextOrTrigger jiangmiao/auto-pairs [!NOTE|label:references:] #128 : Disable autopairs for certain filetypesau Filetype markdown let b:AutoPairs={'(':')', '[':']', '{':'}','\"':'\"', '`':'`'} Plug 'jiangmiao/auto-pairs' \" or Plug 'marslo/auto-pairs' \" settings let g:AutoPairs = {'(':')', '[':']', '{':'}', '',\"'\":\"'\",'\"':'\"', '`':'`'} let g:AutoPairsParens = {'(':')', '[':']', '{':'}', ''} let g:AutoPairsFlyMode = 0 let g:AutoPairsShortcutBackInsert = '' gabrielelana/vim-markdown Plug 'gabrielelana/vim-markdown' nnoremap cc :let &cole=(&cole == 2) ? 0 : 2 echo 'conceallevel ' . &cole let g:vim_markdown_folding_style_pythonic = 1 let g:vim_markdown_override_foldtext = 0 let g:vim_markdown_autowrite = 1 let g:vim_markdown_new_list_item_indent = 4 let g:vim_markdown_toc_autofit = 1 let g:vim_markdown_conceal = 0 set conceallevel = 2 let g:vim_markdown_frontmatter = 1 let g:vim_markdown_json_frontmatter = 1 let g:markdown_enable_spell_checking = 0 let g:markdown_enable_input_abbreviations = 0 let g:markdown_enable_conceal = 0 hi markdownItalic guifg=gray25 gui=underline hi MarkdownHeadingDelimiter gui=bold guifg=gray25 hi htmlSpecialChar guifg=black hi markdownBold gui=bold guifg=gray25 hi markdownUrl guifg=#2fb3a6 hi markdownAutomaticLink guifg=#2fb3a6 hi markdownLinkText guifg=#317849 hi markdownUrlTitle guifg=#317849 hi markdownBlockquote guifg=#317849 gui=bold hi markdownId guifg=#2fb3a6 hi markdownIdDeclaration guifg=#317849 gui=bold hi markdownListMarker guifg=#317849 tpope/vim-markdown Plug 'tpope/vim-markdown' \" for tpope vim-markdown let g:markdown_fenced_languages = ['html', 'python', 'bash=sh'] let g:markdown_syntax_conceal = 0 let g:markdown_minlines = 100 troubleshooting [!TIP|label:how to debug:] :message :YcmDebugInfo :YcmDiags :YcmToggleLogs :py3 import sys; print( sys.version) : 3.12.1 (main, Dec 7 2023, 20:45:44) [Clang 15.0.0 (clang-1500.0.40.1)] ycmd c++/libclang.dylib cannot be found issue [!NOTE] libclang #1925 How to build using -march=native? #1141 Compilation errors with --system-libclang on macOS Mojave $ ln -sf $(brew --prefix llvm)/lib/libclang.dylib $(brew --prefix llvm)/lib/c++/libclang.dylib # or : https://github.com/ycm-core/YouCompleteMe/issues/1925#issuecomment-173184661 $ EXTRA_CMAKE_ARGS=\"-DCMAKE_CXX_FLAGS=-march=native\" ./install.py --clang-completer --system-libclang # for libclang $ EXTRA_CMAKE_ARGS='-DPATH_TO_LLVM_ROOT=/path/to/your/llvm' ./install.py --clang-completer --system-libclang Question can be turned off with options, see YCM docs Found /path/to/.ycm_extra_conf.py. Load? (Question can be turned off with options, see YCM docs) solutionlet g:ycm_extra_conf_globlist = ['~/path/to/ycm_extra_conf/*', '~/.vim/plugged/YouCompleteMe/*'] ycm download failed download failed for jdt-language-server-1.14.0-202207211651.tar.gz [!NOTE|label:related issues:] #4063: Failing to build, Java Error 404 HTTP #4136: Installing jdt.ls for Java support...FAILED (Similar to #3972 & #3974) #3974: 404 error downloading JDT.LS solution 1: using ycm-core/YouCompleteMe instead of tabnine/YouCompleteMe ( details ) solution 2: $ git diff -- build.py diff --git a/build.py b/build.py index 4f586f28..01c19315 100755 --- a/build.py +++ b/build.py @@ -89,10 +89,10 @@ DYNAMIC_PYTHON_LIBRARY_REGEX = \"\"\" )$ \"\"\" -JDTLS_MILESTONE = '1.14.0' -JDTLS_BUILD_STAMP = '202207211651' +JDTLS_MILESTONE = '1.19.0' +JDTLS_BUILD_STAMP = '202301090450' JDTLS_SHA256 = ( - '4978ee235049ecba9c65b180b69ef982eedd2f79dc4fd1781610f17939ecd159' + 'acfd91918c51770a2e63a5a4d72f3543611ad7e1610b917c28797548b84e8460' ) RUST_TOOLCHAIN = 'nightly-2022-08-17' solution 3 download the tar.gz manually snapshots milestone copy/move clangd-16.0.1-x86_64-apple-darwin.tar.bz2 into YouCompleteme/third_party/ycmd/third_party/eclipse.jdt.ls/target/cache/ $ mkdir -p YouCompleteme/third_party/ycmd/third_party/eclipse.jdt.ls/target/cache/ && cd !$ $ wget https://github.com/ycm-core/llvm/releases/download/16.0.1/clangd-16.0.1-x86_64-apple-darwin.tar.bz2 download failed for clangd-17.0.1-x86_64-apple-darwin.tar.bz2 | clangd-17.0.1-x86_64-unknown-linux-gnu.tar.bz2 $ mkdir -p YouCompleteMe/third_party/ycmd/third_party/clangd/cache # osx $ curl -o YouCompleteMe/third_party/ycmd/third_party/clangd/cache/clangd-17.0.1-x86_64-apple-darwin.tar.bz2 \\ -fsSL https://github.com/ycm-core/llvm/releases/download/17.0.1/clangd-17.0.1-x86_64-apple-darwin.tar.bz2 # wsl (windows) $ curl -o YouCompleteMe/third_party/ycmd/third_party/clangd/cache/clangd-17.0.1-x86_64-unknown-linux-gnu.tar.bz2 -fsSL https://github.com/ycm-core/llvm/releases/download/17.0.1/clangd-17.0.1-x86_64-unknown-linux-gnu.tar.bz2 download failed for omnisharp.http-osx.tar.gz v1.37.11 | omnisharp.http-linux-x64.tar.gz $ mkdir -p YouCompleteMe/third_party/ycmd/third_party/omnisharp-roslyn/v1.37.11 # osx $ curl -o YouCompleteMe/third_party/ycmd/third_party/omnisharp-roslyn/v1.37.11/omnisharp.http-osx.tar.gz \\ -fsSL https://github.com/OmniSharp/omnisharp-roslyn/releases/download/v1.37.11/omnisharp.http-osx.tar.gz # wsl (ubuntu) $ curl -o YouCompleteMe/third_party/ycmd/third_party/omnisharp-roslyn/v1.37.11/omnisharp.http-linux-x64.tar.gz \\ -fsSL https://github.com/OmniSharp/omnisharp-roslyn/releases/download/v1.37.11/omnisharp.http-linux-x64.tar.gz scripts for download # osx $ curl -fsSL -o ~/Desktop/clangd-17.0.1-x86_64-apple-darwin.tar.bz2 https://github.com/ycm-core/llvm/releases/download/17.0.1/clangd-17.0.1-x86_64-apple-darwin.tar.bz2 $ curl -fsSL -o ~/Desktop/omnisharp.http-osx.tar.gz https://github.com/OmniSharp/omnisharp-roslyn/releases/download/v1.37.11/omnisharp.http-osx.tar.gz # wsl (windows) $ curl -fsSL -o ~/Desktop/clangd-17.0.1-x86_64-unknown-linux-gnu.tar.bz2 https://github.com/ycm-core/llvm/releases/download/17.0.1/clangd-17.0.1-x86_64-unknown-linux-gnu.tar.bz2 $ curl -fsSL -o ~/Desktop/omnisharp.http-linux-x64.tar.gz https://github.com/OmniSharp/omnisharp-roslyn/releases/download/v1.37.11/omnisharp.http-linux-x64.tar.gz $ for _d in YouCompleteMe/YouCompleteMe/third_party/ycmd/third_party/clangd/cache/ \\ YouCompleteMe/third_party/ycmd/third_party/clangd/cache \\ YouCompleteMe/third_party/ycmd/third_party/eclipse.jdt.ls/target/cache \\ YouCompleteMe/third_party/ycmd/third_party/eclipse.jdt.ls/target/cache/third_party/ycmd/third_party/eclipse.jdt.ls; do mkdir -p \"${_d}\" # osx cp ~/Desktop/clangd-17.0.1-x86_64-apple-darwin.tar.bz2 ${_d} # wsl ( windows ) cp ~/Desktop/clangd-17.0.1-x86_64-unknown-linux-gnu.tar.bz2 \"${_d}\" done # oxx $ mkdir -p YouCompleteMe/third_party/ycmd/third_party/omnisharp-roslyn/v1.37.11/ && cp ~/Desktop/omnisharp.http-osx.tar.gz YouCompleteMe/third_party/ycmd/third_party/omnisharp-roslyn/v1.37.11/ # wsl ( windows ) $ mkdir -p YouCompleteMe/third_party/ycmd/third_party/omnisharp-roslyn/v1.37.11/ && cp ~/Desktop/omnisharp.http-linux-x64.tar.gz YouCompleteMe/third_party/ycmd/third_party/omnisharp-roslyn/v1.37.11/ all caches $ find YouCompleteMe/ -name '*.zip' -o -name '*.tar.*' YouCompleteMe/YouCompleteMe/third_party/ycmd/third_party/clangd/cache/clangd-17.0.1-x86_64-apple-darwin.tar.bz2 YouCompleteMe/third_party/ycmd/ycmd/tests/testdata/python-future/embedded_standard_library/python35.zip YouCompleteMe/third_party/ycmd/clang_archives/libclang-17.0.1-x86_64-apple-darwin.tar.bz2 YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/honnef.co/go/tools/@v/v0.4.2.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/mvdan.cc/gofumpt/@v/v0.4.0.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/mvdan.cc/xurls/v2/@v/v2.4.0.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/vuln/@v/v0.0.0-20230110180137-6ad3e3d07815.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/tools/gopls/@v/v0.13.2.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/tools/@v/v0.11.2-0.20230810185051-cc6b5804b8cf.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/sys/@v/v0.10.0.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/text/@v/v0.11.0.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/sync/@v/v0.3.0.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/exp/typeparams/@v/v0.0.0-20221212164502-fae10dda9338.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/exp/@v/v0.0.0-20220722155223-a9213eeb770e.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/mod/@v/v0.12.0.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/github.com/!burnt!sushi/toml/@v/v1.2.1.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/github.com/google/go-cmp/@v/v0.5.9.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/github.com/sergi/go-diff/@v/v1.1.0.zip YouCompleteMe/third_party/ycmd/third_party/clangd/cache/clangd-17.0.1-x86_64-apple-darwin.tar.bz2 YouCompleteMe/third_party/ycmd/third_party/jedi_deps/jedi/test/examples/zipped_imports/pkg.zip YouCompleteMe/third_party/ycmd/third_party/jedi_deps/jedi/test/examples/zipped_imports/not_pkg.zip YouCompleteMe/third_party/ycmd/third_party/omnisharp-roslyn/v1.37.11/omnisharp.http-osx.tar.gz YouCompleteMe/third_party/ycmd/third_party/eclipse.jdt.ls/target/cache/jdt-language-server-1.26.0-202307271613.tar.gz YouCompleteMe/third_party/ycmd/third_party/eclipse.jdt.ls/target/cache/third_party/ycmd/third_party/eclipse.jdt.ls/clangd-17.0.1-x86_64-apple-darwin.tar.bz2 YouCompleteMe/third_party/ycmd/third_party/eclipse.jdt.ls/target/cache/clangd-17.0.1-x86_64-apple-darwin.tar.bz2 $ find YouCompleteMe/ -name '*.zip' -o -name '*.tar.*' YouCompleteMe/third_party/ycmd/ycmd/tests/testdata/python-future/embedded_standard_library/python35.zip YouCompleteMe/third_party/ycmd/clang_archives/libclang-16.0.1-x86_64-apple-darwin.tar.bz2 YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/honnef.co/go/tools/@v/v0.3.2.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/mvdan.cc/gofumpt/@v/v0.3.1.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/mvdan.cc/xurls/v2/@v/v2.4.0.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/vuln/@v/v0.0.0-20220725105440-4151a5aca1df.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/tools/gopls/@v/v0.9.4.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/tools/@v/v0.1.13-0.20220812184215-3f9b119300de.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/sys/@v/v0.0.0-20220722155257-8c9f86f7a55f.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/text/@v/v0.3.7.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/sync/@v/v0.0.0-20220722155255-886fb9371eb4.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/exp/typeparams/@v/v0.0.0-20220722155223-a9213eeb770e.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/golang.org/x/mod/@v/v0.6.0-dev.0.20220419223038-86c51ed26bb4.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/github.com/!burnt!sushi/toml/@v/v1.2.0.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/github.com/google/go-cmp/@v/v0.5.8.zip YouCompleteMe/third_party/ycmd/third_party/go/pkg/mod/cache/download/github.com/sergi/go-diff/@v/v1.1.0.zip YouCompleteMe/third_party/ycmd/third_party/clangd/cache/clangd-16.0.1-x86_64-apple-darwin.tar.bz2 YouCompleteMe/third_party/ycmd/third_party/jedi_deps/jedi/test/examples/zipped_imports/pkg.zip YouCompleteMe/third_party/ycmd/third_party/jedi_deps/jedi/test/examples/zipped_imports/not_pkg.zip YouCompleteMe/third_party/ycmd/third_party/omnisharp-roslyn/v1.37.11/omnisharp.http-osx.tar.gz YouCompleteMe/third_party/ycmd/third_party/eclipse.jdt.ls/target/cache/jdt-language-server-1.14.0-202207211651.tar.gz YouCompleteMe/third_party/ycmd/third_party/eclipse.jdt.ls/target/cache/clangd-16.0.1-x86_64-apple-darwin.tar.bz2 tips libclang download failure error $ python install.py --all ... -- Downloading libclang 6.0.0 from https://dl.bintray.com/micbou/libclang/libclang-6.0.0-x86_64-apple-darwin.tar.bz2 -- [download 0% complete] CMake Error at ycm/CMakeLists.txt:108 (file): file DOWNLOAD cannot compute hash on failed download solution: ultimate solution: using YouCompleteMe/third_party/ycmd replace the tabnine-vim/third_party/ycmd $ cd ~/.vim/bundle $ mv tabnine-vim/third_party/ycmd{,.bak} $ cp -r YouCompleteMe/third_party/ycmd tabnine-vim/third_party/ $ python install.py --all replace the libclang 6.0.0 to 16.0.1 ./ycmd/cpp/ycm/CMakeLists.txt # https://github.com/ycm-core/llvm/releases/download/16.0.1/libclang-16.0.1-x86_64-apple-darwin.tar.bz2 $ git diff -- third_party/ycmd/cpp/ycm/CMakeLists.txt diff --git a/third_party/ycmd/cpp/ycm/CMakeLists.txt b/third_party/ycmd/cpp/ycm/CMakeLists.txt index 047b118d..9d912c98 100644 --- a/third_party/ycmd/cpp/ycm/CMakeLists.txt +++ b/third_party/ycmd/cpp/ycm/CMakeLists.txt @@ -30,12 +30,12 @@ if ( USE_CLANG_COMPLETER AND NOT PATH_TO_LLVM_ROOT AND NOT EXTERNAL_LIBCLANG_PATH ) - set( CLANG_VERSION 6.0.0 ) + set( CLANG_VERSION 16.0.1 ) if ( APPLE ) set( LIBCLANG_DIRNAME \"libclang-${CLANG_VERSION}-x86_64-apple-darwin\" ) set( LIBCLANG_SHA256 - \"fd12532e3eb7b67cfede097134fc0a5b478c63759bcbe144ae6897f412ce2fe6\" ) + \"43f7e4e72bc1d661eb01ee61666ee3a62a97d2993586c0b98efa6f46a96e768f\" ) elseif ( WIN32 ) if( 64_BIT_PLATFORM ) set( LIBCLANG_DIRNAME \"libclang-${CLANG_VERSION}-win64\" ) @@ -84,7 +84,7 @@ if ( USE_CLANG_COMPLETER AND set( LIBCLANG_DOWNLOAD ON ) set( LIBCLANG_URL - \"https://dl.bintray.com/micbou/libclang/${LIBCLANG_FILENAME}\" ) + \"https://github.com/ycm-core/llvm/releases/download/${CLANG_VERSION}/${LIBCLANG_FILENAME}\" ) # Check if the Clang archive is already downloaded and its checksum is # correct. If this is not the case, remove it if needed and download it. full logs $ python install.py --all --verbose Searching Python 3.11 libraries... Found Python library: /usr/local/opt/python@3.11/Frameworks/Python.framework/Versions/3.11/lib/python3.11/config-3.11-darwin/libpython3.11.dylib Found Python headers folder: /usr/local/opt/python@3.11/Frameworks/Python.framework/Versions/3.11/include/python3.11 -- The C compiler identification is AppleClang 14.0.3.14030022 -- The CXX compiler identification is AppleClang 14.0.3.14030022 -- Detecting C compiler ABI info -- Detecting C compiler ABI info - done -- Check for working C compiler: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/cc - skipped -- Detecting C compile features -- Detecting C compile features - done -- Detecting CXX compiler ABI info -- Detecting CXX compiler ABI info - done -- Check for working CXX compiler: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/c++ - skipped -- Detecting CXX compile features -- Detecting CXX compile features - done -- Found Python3: /usr/local/opt/python@3.11/bin/python3.11 (found suitable version \"3.11.6\", minimum required is \"3.6\") found components: Interpreter Development Development.Module Development.Embed -- Performing Test CMAKE_HAVE_LIBC_PTHREAD -- Performing Test CMAKE_HAVE_LIBC_PTHREAD - Success -- Found Threads: TRUE -- Using libclang archive: /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp/../clang_archives/libclang-17.0.1-x86_64-apple-darwin.tar.bz2 -- Using libclang to provide semantic completion for C/C++/ObjC -- Using external libclang: /private/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/ycm_build_o7x3lu3s/lib/libclang.dylib -- Using Abseil hash tables -- Configuring done (13.9s) -- Generating done (0.6s) -- Build files have been written to: /private/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/ycm_build_o7x3lu3s [ 0%] Building CXX object absl/absl/time/CMakeFiles/absl_civil_time.dir/internal/cctz/src/civil_time_detail.cc.o [ 3%] Building CXX object absl/absl/time/CMakeFiles/absl_time_zone.dir/internal/cctz/src/time_zone_format.cc.o [ 3%] Building CXX object absl/absl/base/CMakeFiles/absl_log_severity.dir/log_severity.cc.o [ 3%] Building CXX object absl/absl/time/CMakeFiles/absl_time_zone.dir/internal/cctz/src/time_zone_fixed.cc.o [ 4%] Building CXX object absl/absl/time/CMakeFiles/absl_time_zone.dir/internal/cctz/src/time_zone_if.cc.o [ 6%] Building CXX object absl/absl/base/CMakeFiles/absl_exponential_biased.dir/internal/exponential_biased.cc.o [ 8%] Building CXX object absl/absl/numeric/CMakeFiles/absl_int128.dir/int128.cc.o [ 8%] Building CXX object absl/absl/time/CMakeFiles/absl_time_zone.dir/internal/cctz/src/time_zone_impl.cc.o [ 8%] Building CXX object absl/absl/time/CMakeFiles/absl_time_zone.dir/internal/cctz/src/time_zone_libc.cc.o [ 8%] Building CXX object absl/absl/time/CMakeFiles/absl_time_zone.dir/internal/cctz/src/time_zone_lookup.cc.o [ 8%] Building CXX object absl/absl/time/CMakeFiles/absl_time_zone.dir/internal/cctz/src/time_zone_info.cc.o [ 8%] Building CXX object absl/absl/base/CMakeFiles/absl_spinlock_wait.dir/internal/spinlock_wait.cc.o [ 9%] Linking CXX static library libabsl_spinlock_wait.a [ 9%] Built target absl_spinlock_wait [ 11%] Building CXX object absl/absl/time/CMakeFiles/absl_time_zone.dir/internal/cctz/src/time_zone_posix.cc.o [ 13%] Linking CXX static library libabsl_exponential_biased.a [ 13%] Built target absl_exponential_biased [ 13%] Building CXX object absl/absl/time/CMakeFiles/absl_time_zone.dir/internal/cctz/src/zone_info_source.cc.o [ 13%] Linking CXX static library libabsl_log_severity.a [ 13%] Built target absl_log_severity [ 14%] Linking CXX static library libabsl_civil_time.a [ 14%] Building CXX object absl/absl/base/CMakeFiles/absl_raw_logging_internal.dir/internal/raw_logging.cc.o [ 16%] Linking CXX static library libabsl_int128.a [ 16%] Built target absl_civil_time [ 16%] Built target absl_int128 [ 18%] Linking CXX static library libabsl_time_zone.a [ 19%] Linking CXX static library libabsl_raw_logging_internal.a [ 19%] Built target absl_time_zone [ 19%] Built target absl_raw_logging_internal [ 19%] Building CXX object absl/absl/debugging/CMakeFiles/absl_debugging_internal.dir/internal/address_is_readable.cc.o [ 21%] Building CXX object absl/absl/types/CMakeFiles/absl_bad_variant_access.dir/bad_variant_access.cc.o [ 21%] Building CXX object absl/absl/base/CMakeFiles/absl_throw_delegate.dir/internal/throw_delegate.cc.o [ 21%] Building CXX object absl/absl/types/CMakeFiles/absl_bad_optional_access.dir/bad_optional_access.cc.o [ 21%] Building CXX object absl/absl/debugging/CMakeFiles/absl_debugging_internal.dir/internal/vdso_support.cc.o [ 21%] Building CXX object absl/absl/base/CMakeFiles/absl_base.dir/internal/sysinfo.cc.o [ 24%] Building CXX object absl/absl/base/CMakeFiles/absl_base.dir/internal/spinlock.cc.o [ 24%] Building CXX object absl/absl/base/CMakeFiles/absl_base.dir/internal/thread_identity.cc.o [ 26%] Building CXX object absl/absl/debugging/CMakeFiles/absl_debugging_internal.dir/internal/elf_mem_image.cc.o [ 26%] Building CXX object absl/absl/base/CMakeFiles/absl_base.dir/internal/cycleclock.cc.o [ 26%] Building CXX object absl/absl/base/CMakeFiles/absl_base.dir/internal/unscaledcycleclock.cc.o [ 27%] Linking CXX static library libabsl_debugging_internal.a [ 29%] Linking CXX static library libabsl_bad_variant_access.a /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libabsl_debugging_internal.a(elf_mem_image.cc.o) has no symbols /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libabsl_debugging_internal.a(vdso_support.cc.o) has no symbols /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libabsl_debugging_internal.a(elf_mem_image.cc.o) has no symbols /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libabsl_debugging_internal.a(vdso_support.cc.o) has no symbols /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libabsl_bad_variant_access.a(bad_variant_access.cc.o) has no symbols /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libabsl_bad_variant_access.a(bad_variant_access.cc.o) has no symbols warning: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: archive library: libabsl_bad_variant_access.a the table of contents is empty (no object file members in the library define global symbols) [ 29%] Built target absl_debugging_internal [ 29%] Built target absl_bad_variant_access [ 29%] Building CXX object absl/absl/debugging/CMakeFiles/absl_stacktrace.dir/stacktrace.cc.o [ 31%] Linking CXX static library libabsl_bad_optional_access.a /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libabsl_bad_optional_access.a(bad_optional_access.cc.o) has no symbols /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libabsl_bad_optional_access.a(bad_optional_access.cc.o) has no symbols warning: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: archive library: libabsl_bad_optional_access.a the table of contents is empty (no object file members in the library define global symbols) [ 31%] Built target absl_bad_optional_access [ 32%] Linking CXX static library libabsl_stacktrace.a [ 32%] Built target absl_stacktrace [ 32%] Linking CXX static library libabsl_throw_delegate.a [ 32%] Built target absl_throw_delegate [ 34%] Linking CXX static library libabsl_base.a [ 34%] Built target absl_base [ 34%] Building CXX object absl/absl/debugging/CMakeFiles/absl_demangle_internal.dir/internal/demangle.cc.o [ 34%] Building CXX object absl/absl/hash/CMakeFiles/absl_city.dir/internal/city.cc.o [ 37%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings_internal.dir/internal/ostringstream.cc.o [ 37%] Building CXX object absl/absl/base/CMakeFiles/absl_malloc_internal.dir/internal/low_level_alloc.cc.o [ 37%] Building CXX object absl/absl/hash/CMakeFiles/absl_wyhash.dir/internal/wyhash.cc.o [ 39%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings_internal.dir/internal/escaping.cc.o [ 39%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings_internal.dir/internal/utf8.cc.o [ 40%] Linking CXX static library libabsl_wyhash.a [ 40%] Built target absl_wyhash [ 42%] Linking CXX static library libabsl_city.a [ 42%] Built target absl_city [ 42%] Linking CXX static library libabsl_strings_internal.a [ 42%] Built target absl_strings_internal [ 42%] Linking CXX static library libabsl_malloc_internal.a [ 42%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/ascii.cc.o [ 45%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/internal/charconv_bigint.cc.o [ 45%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/escaping.cc.o [ 45%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/charconv.cc.o [ 47%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/internal/charconv_parse.cc.o [ 47%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/internal/memutil.cc.o [ 49%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/match.cc.o [ 50%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/str_cat.cc.o [ 50%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/numbers.cc.o [ 50%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/str_replace.cc.o [ 52%] Linking CXX static library libabsl_demangle_internal.a [ 52%] Built target absl_malloc_internal [ 54%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/str_split.cc.o [ 54%] Built target absl_demangle_internal [ 55%] Building CXX object absl/absl/synchronization/CMakeFiles/absl_graphcycles_internal.dir/internal/graphcycles.cc.o [ 55%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/string_view.cc.o [ 57%] Building CXX object absl/absl/strings/CMakeFiles/absl_strings.dir/substitute.cc.o [ 57%] Linking CXX static library libabsl_graphcycles_internal.a [ 57%] Built target absl_graphcycles_internal [ 57%] Linking CXX static library libabsl_strings.a /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libabsl_strings.a(string_view.cc.o) has no symbols /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libabsl_strings.a(string_view.cc.o) has no symbols [ 57%] Built target absl_strings [ 57%] Building CXX object absl/absl/time/CMakeFiles/absl_time.dir/format.cc.o [ 59%] Building CXX object absl/absl/strings/CMakeFiles/absl_cord.dir/cord.cc.o [ 59%] Building CXX object absl/absl/time/CMakeFiles/absl_time.dir/civil_time.cc.o [ 60%] Building CXX object absl/absl/debugging/CMakeFiles/absl_symbolize.dir/symbolize.cc.o [ 60%] Building CXX object absl/absl/time/CMakeFiles/absl_time.dir/clock.cc.o [ 62%] Building CXX object absl/absl/hash/CMakeFiles/absl_hash.dir/internal/hash.cc.o [ 63%] Building CXX object absl/absl/strings/CMakeFiles/absl_cord.dir/internal/cord_internal.cc.o [ 65%] Building CXX object absl/absl/time/CMakeFiles/absl_time.dir/duration.cc.o [ 65%] Building CXX object absl/absl/strings/CMakeFiles/absl_cord.dir/internal/cord_rep_ring.cc.o [ 67%] Building CXX object absl/absl/time/CMakeFiles/absl_time.dir/time.cc.o In file included from /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp/absl/absl/strings/cord.cc:15: In file included from /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp/absl/absl/strings/cord.h:78: /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp/absl/absl/functional/function_ref.h:124:16: warning: definition of implicit copy constructor for 'FunctionRef' is deprecated because it has a user-declared copy assignment operator [-Wdeprecated-copy] FunctionRef& operator=(const FunctionRef& rhs) = delete; ^ /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp/absl/absl/strings/cord.h:1325:33: note: in implicit copy constructor for 'absl::FunctionRef' first required here return ForEachChunkAux(rep, callback); ^ [ 67%] Linking CXX static library libabsl_hash.a [ 67%] Linking CXX static library libabsl_symbolize.a [ 67%] Built target absl_hash [ 67%] Built target absl_symbolize [ 67%] Linking CXX static library libabsl_time.a [ 67%] Built target absl_time [ 67%] Building CXX object absl/absl/synchronization/CMakeFiles/absl_synchronization.dir/blocking_counter.cc.o [ 68%] Building CXX object absl/absl/synchronization/CMakeFiles/absl_synchronization.dir/internal/create_thread_identity.cc.o [ 70%] Building CXX object absl/absl/synchronization/CMakeFiles/absl_synchronization.dir/barrier.cc.o [ 70%] Building CXX object absl/absl/synchronization/CMakeFiles/absl_synchronization.dir/internal/per_thread_sem.cc.o [ 70%] Building CXX object absl/absl/synchronization/CMakeFiles/absl_synchronization.dir/notification.cc.o [ 72%] Building CXX object absl/absl/synchronization/CMakeFiles/absl_synchronization.dir/internal/waiter.cc.o [ 73%] Building CXX object absl/absl/synchronization/CMakeFiles/absl_synchronization.dir/mutex.cc.o 1 warning generated. [ 75%] Linking CXX static library libabsl_cord.a [ 75%] Built target absl_cord [ 75%] Linking CXX static library libabsl_synchronization.a [ 75%] Built target absl_synchronization [ 77%] Building CXX object absl/absl/container/CMakeFiles/absl_hashtablez_sampler.dir/internal/hashtablez_sampler_force_weak_definition.cc.o [ 77%] Building CXX object absl/absl/container/CMakeFiles/absl_hashtablez_sampler.dir/internal/hashtablez_sampler.cc.o [ 78%] Linking CXX static library libabsl_hashtablez_sampler.a [ 78%] Built target absl_hashtablez_sampler [ 78%] Building CXX object absl/absl/container/CMakeFiles/absl_raw_hash_set.dir/internal/raw_hash_set.cc.o [ 80%] Linking CXX static library libabsl_raw_hash_set.a [ 80%] Built target absl_raw_hash_set [ 81%] Building CXX object ycm/CMakeFiles/ycm_core.dir/Character.cpp.o [ 81%] Building CXX object ycm/CMakeFiles/ycm_core.dir/Candidate.cpp.o [ 83%] Building CXX object ycm/CMakeFiles/ycm_core.dir/IdentifierUtils.cpp.o [ 83%] Building CXX object ycm/CMakeFiles/ycm_core.dir/CodePoint.cpp.o [ 86%] Building CXX object ycm/CMakeFiles/ycm_core.dir/Repository.cpp.o [ 86%] Building CXX object ycm/CMakeFiles/ycm_core.dir/Result.cpp.o [ 86%] Building CXX object ycm/CMakeFiles/ycm_core.dir/IdentifierCompleter.cpp.o [ 86%] Building CXX object ycm/CMakeFiles/ycm_core.dir/Word.cpp.o [ 86%] Building CXX object ycm/CMakeFiles/ycm_core.dir/PythonSupport.cpp.o [ 86%] Building CXX object ycm/CMakeFiles/ycm_core.dir/IdentifierDatabase.cpp.o [ 90%] Building CXX object ycm/CMakeFiles/ycm_core.dir/versioning.cpp.o [ 90%] Building CXX object ycm/CMakeFiles/ycm_core.dir/Utils.cpp.o [ 90%] Building CXX object ycm/CMakeFiles/ycm_core.dir/ycm_core.cpp.o [ 91%] Building CXX object ycm/CMakeFiles/ycm_core.dir/ClangCompleter/ClangCompleter.cpp.o [ 91%] Building CXX object ycm/CMakeFiles/ycm_core.dir/ClangCompleter/ClangHelpers.cpp.o [ 93%] Building CXX object ycm/CMakeFiles/ycm_core.dir/ClangCompleter/ClangUtils.cpp.o [ 93%] Building CXX object ycm/CMakeFiles/ycm_core.dir/ClangCompleter/CompilationDatabase.cpp.o [ 95%] Building CXX object ycm/CMakeFiles/ycm_core.dir/ClangCompleter/CompletionData.cpp.o [ 95%] Building CXX object ycm/CMakeFiles/ycm_core.dir/ClangCompleter/Documentation.cpp.o [ 96%] Building CXX object ycm/CMakeFiles/ycm_core.dir/ClangCompleter/Range.cpp.o [ 96%] Building CXX object ycm/CMakeFiles/ycm_core.dir/ClangCompleter/TranslationUnit.cpp.o [ 98%] Building CXX object ycm/CMakeFiles/ycm_core.dir/ClangCompleter/TranslationUnitStore.cpp.o [100%] Linking CXX shared library /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/ycm_core.cpython-311-darwin.so ld: warning: directory not found for option '-L/usr/local/Cellar/node/20.8.0/lib' ld: warning: dylib (/usr/local/opt/python@3.11/Frameworks/Python.framework/Versions/3.11/lib/python3.11/config-3.11-darwin/libpython3.11.dylib) was built for newer macOS version (14.0) than being linked (13.3) ld: warning: dylib (/usr/local/opt/llvm/lib/libunwind.dylib) was built for newer macOS version (14.0) than being linked (13.3) ld: warning: dylib (/usr/local/opt/llvm/lib/libunwind.dylib) was built for newer macOS version (14.0) than being linked (13.3) [100%] Built target ycm_core running build running build_py creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/regex copying regex_3/__init__.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/regex copying regex_3/regex.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/regex copying regex_3/_regex_core.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/regex copying regex_3/test_regex.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/regex running build_ext building 'regex._regex' extension creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/3 creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/3/temp.macosx-14-x86_64-cpython-311 creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/3/temp.macosx-14-x86_64-cpython-311/regex_3 clang -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX14.sdk -I/usr/local/opt/tcl-tk/include -I/usr/local/opt/openjdk@17/include -I/usr/local/opt/openldap/include -I/usr/local/opt/curl/include -I/usr/local/opt/binutils/include -I/usr/local/opt/sqlite/include -I/usr/local/include -I/usr/local/opt/readline/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/Cellar/node/20.8.0/include -I/usr/local/opt/libressl/include -I/usr/local/opt/tcl-tk/include -I/usr/local/opt/ruby/include -I/usr/local/Cellar/icu4c@71.1/71.1/include -I/usr/local/opt/llvm/include -I/usr/local/opt/python@3.11/Frameworks/Python.framework/Versions/3.11/include/python3.11 -c regex_3/_regex.c -o /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/3/temp.macosx-14-x86_64-cpython-311/regex_3/_regex.o regex_3/_regex.c:24940:23: warning: unused function 'contains_repeat' [-Wunused-function] 24940 | Py_LOCAL_INLINE(BOOL) contains_repeat(RE_CODE* code, RE_CODE* end_code) { | ^~~~~~~~~~~~~~~ 1 warning generated. clang -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX14.sdk -I/usr/local/opt/tcl-tk/include -I/usr/local/opt/openjdk@17/include -I/usr/local/opt/openldap/include -I/usr/local/opt/curl/include -I/usr/local/opt/binutils/include -I/usr/local/opt/sqlite/include -I/usr/local/include -I/usr/local/opt/readline/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/Cellar/node/20.8.0/include -I/usr/local/opt/libressl/include -I/usr/local/opt/tcl-tk/include -I/usr/local/opt/ruby/include -I/usr/local/Cellar/icu4c@71.1/71.1/include -I/usr/local/opt/llvm/include -I/usr/local/opt/python@3.11/Frameworks/Python.framework/Versions/3.11/include/python3.11 -c regex_3/_regex_unicode.c -o /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/3/temp.macosx-14-x86_64-cpython-311/regex_3/_regex_unicode.o clang -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX14.sdk -L/usr/local/opt/openldap/lib -L/usr/local/opt/curl/lib -L/usr/local/opt/binutils/lib -L/usr/local/opt/python@3.11/lib -L/usr/local/opt/ruby/lib -L/usr/local/opt/tcl-tk/lib -L/usr/local/opt/sqlite/lib -L/usr/local/lib -L/usr/local/opt/readline/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/Cellar/node/20.8.0/lib -L/usr/local/opt/libressl/lib -L/usr/local/Cellar/icu4c@71.1/71.1/lib -L/usr/local/opt/llvm/lib -I/usr/local/opt/tcl-tk/include -I/usr/local/opt/openjdk@17/include -I/usr/local/opt/openldap/include -I/usr/local/opt/curl/include -I/usr/local/opt/binutils/include -I/usr/local/opt/sqlite/include -I/usr/local/include -I/usr/local/opt/readline/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/Cellar/node/20.8.0/include -I/usr/local/opt/libressl/include -I/usr/local/opt/tcl-tk/include -I/usr/local/opt/ruby/include -I/usr/local/Cellar/icu4c@71.1/71.1/include -I/usr/local/opt/llvm/include /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/3/temp.macosx-14-x86_64-cpython-311/regex_3/_regex.o /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/3/temp.macosx-14-x86_64-cpython-311/regex_3/_regex_unicode.o -o /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/regex-build/regex/_regex.cpython-311-darwin.so ld: warning: directory not found for option '-L/usr/local/Cellar/node/20.8.0/lib' running build running build_py creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3 creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog copying src/watchdog/watchmedo.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog copying src/watchdog/version.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog copying src/watchdog/events.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog copying src/watchdog/__init__.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/utils copying src/watchdog/utils/patterns.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/utils copying src/watchdog/utils/__init__.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/utils copying src/watchdog/utils/event_debouncer.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/utils copying src/watchdog/utils/dirsnapshot.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/utils copying src/watchdog/utils/delayed_queue.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/utils copying src/watchdog/utils/platform.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/utils copying src/watchdog/utils/process_watcher.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/utils copying src/watchdog/utils/bricks.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/utils copying src/watchdog/utils/echo.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/utils creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/fsevents.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/inotify.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/__init__.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/api.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/inotify_buffer.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/winapi.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/read_directory_changes.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/kqueue.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/inotify_c.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/polling.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers copying src/watchdog/observers/fsevents2.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/observers creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/tricks copying src/watchdog/tricks/__init__.py -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog/tricks running egg_info writing src/watchdog.egg-info/PKG-INFO writing dependency_links to src/watchdog.egg-info/dependency_links.txt writing entry points to src/watchdog.egg-info/entry_points.txt writing requirements to src/watchdog.egg-info/requires.txt writing top-level names to src/watchdog.egg-info/top_level.txt reading manifest file 'src/watchdog.egg-info/SOURCES.txt' reading manifest template 'MANIFEST.in' warning: no files found matching '*.h' under directory 'src' warning: no files found matching 'docs/*.txt' adding license file 'LICENSE' adding license file 'COPYING' adding license file 'AUTHORS' writing manifest file 'src/watchdog.egg-info/SOURCES.txt' copying src/watchdog/py.typed -> /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/watchdog running build_ext building '_watchdog_fsevents' extension creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/3 creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/3/temp.macosx-14-x86_64-cpython-311 creating /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/3/temp.macosx-14-x86_64-cpython-311/src clang -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX14.sdk -I/usr/local/opt/tcl-tk/include -I/usr/local/opt/openjdk@17/include -I/usr/local/opt/openldap/include -I/usr/local/opt/curl/include -I/usr/local/opt/binutils/include -I/usr/local/opt/sqlite/include -I/usr/local/include -I/usr/local/opt/readline/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/Cellar/node/20.8.0/include -I/usr/local/opt/libressl/include -I/usr/local/opt/tcl-tk/include -I/usr/local/opt/ruby/include -I/usr/local/Cellar/icu4c@71.1/71.1/include -I/usr/local/opt/llvm/include -DWATCHDOG_VERSION_STRING=\\\"3.0.0\\\" -DWATCHDOG_VERSION_MAJOR=3 -DWATCHDOG_VERSION_MINOR=0 -DWATCHDOG_VERSION_BUILD=0 -I/usr/local/opt/python@3.11/Frameworks/Python.framework/Versions/3.11/include/python3.11 -c src/watchdog_fsevents.c -o /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/3/temp.macosx-14-x86_64-cpython-311/src/watchdog_fsevents.o -std=c99 -pedantic -Wall -Wextra -fPIC -Wno-nullability-completeness -Wno-nullability-extension -Wno-newline-eof -Wno-error=unused-command-line-argument src/watchdog_fsevents.c:681:5: warning: 'FSEventStreamScheduleWithRunLoop' is deprecated: first deprecated in macOS 13.0 - Use FSEventStreamSetDispatchQueue instead. [-Wdeprecated-declarations] 681 | FSEventStreamScheduleWithRunLoop(stream_ref, run_loop_ref, kCFRunLoopDefaultMode); | ^ /Library/Developer/CommandLineTools/SDKs/MacOSX14.sdk/System/Library/Frameworks/CoreServices.framework/Frameworks/FSEvents.framework/Headers/FSEvents.h:1153:1: note: 'FSEventStreamScheduleWithRunLoop' has been explicitly marked deprecated here 1153 | FSEventStreamScheduleWithRunLoop( | ^ 1 warning generated. clang -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX14.sdk -L/usr/local/opt/openldap/lib -L/usr/local/opt/curl/lib -L/usr/local/opt/binutils/lib -L/usr/local/opt/python@3.11/lib -L/usr/local/opt/ruby/lib -L/usr/local/opt/tcl-tk/lib -L/usr/local/opt/sqlite/lib -L/usr/local/lib -L/usr/local/opt/readline/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/Cellar/node/20.8.0/lib -L/usr/local/opt/libressl/lib -L/usr/local/Cellar/icu4c@71.1/71.1/lib -L/usr/local/opt/llvm/lib -I/usr/local/opt/tcl-tk/include -I/usr/local/opt/openjdk@17/include -I/usr/local/opt/openldap/include -I/usr/local/opt/curl/include -I/usr/local/opt/binutils/include -I/usr/local/opt/sqlite/include -I/usr/local/include -I/usr/local/opt/readline/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/Cellar/node/20.8.0/include -I/usr/local/opt/libressl/include -I/usr/local/opt/tcl-tk/include -I/usr/local/opt/ruby/include -I/usr/local/Cellar/icu4c@71.1/71.1/include -I/usr/local/opt/llvm/include /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/3/temp.macosx-14-x86_64-cpython-311/src/watchdog_fsevents.o -lm -o /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/watchdog_deps/watchdog/build/lib3/_watchdog_fsevents.cpython-311-darwin.so -framework CoreFoundation -framework CoreServices ld: warning: directory not found for option '-L/usr/local/Cellar/node/20.8.0/lib' Installing Omnisharp v1.37.11 Using cached Omnisharp: omnisharp.http-osx.tar.gz Extracting Omnisharp to /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/omnisharp-roslyn...DONE Done installing Omnisharp go: downloading golang.org/x/tools/gopls v0.13.2 go: downloading golang.org/x/tools v0.11.2-0.20230810185051-cc6b5804b8cf go: downloading honnef.co/go/tools v0.4.2 go: downloading github.com/sergi/go-diff v1.1.0 go: downloading mvdan.cc/gofumpt v0.4.0 go: downloading mvdan.cc/xurls/v2 v2.4.0 go: downloading golang.org/x/mod v0.12.0 go: downloading golang.org/x/sync v0.3.0 go: downloading golang.org/x/text v0.11.0 go: downloading golang.org/x/sys v0.10.0 go: downloading golang.org/x/vuln v0.0.0-20230110180137-6ad3e3d07815 go: downloading github.com/google/go-cmp v0.5.9 go: downloading golang.org/x/exp/typeparams v0.0.0-20221212164502-fae10dda9338 go: downloading github.com/BurntSushi/toml v1.2.1 go: downloading golang.org/x/exp v0.0.0-20220722155223-a9213eeb770e npm notice created a lockfile as package-lock.json. You should commit this file. npm WARN tern_runtime No repository field. npm WARN tern_runtime No license field. added 30 packages from 125 contributors in 7.411s 1 package is looking for funding run `npm fund` for details info: downloading installer info: profile set to 'default' info: default host triple is x86_64-apple-darwin info: skipping toolchain installation Rust is installed now. Great! To get started you need Cargo's bin directory (/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/rust_install_b3bomd59/bin) in your PATH environment variable. This has not been done automatically. To configure your current shell, run: source \"/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/rust_install_b3bomd59/env\" info: syncing channel updates for 'nightly-2023-08-18-x86_64-apple-darwin' info: latest update on 2023-08-18, rust version 1.73.0-nightly (076887268 2023-08-17) info: downloading component 'cargo' info: downloading component 'clippy' info: downloading component 'rust-docs' info: downloading component 'rust-std' info: downloading component 'rustc' 56.1 MiB / 56.1 MiB (100 %) 38.3 MiB/s in 1s ETA: 0s info: downloading component 'rustfmt' info: installing component 'cargo' info: installing component 'clippy' info: installing component 'rust-docs' 13.8 MiB / 13.8 MiB (100 %) 4.0 MiB/s in 3s ETA: 0s info: installing component 'rust-std' 25.0 MiB / 25.0 MiB (100 %) 11.8 MiB/s in 2s ETA: 0s info: installing component 'rustc' 56.1 MiB / 56.1 MiB (100 %) 12.8 MiB/s in 4s ETA: 0s info: installing component 'rustfmt' nightly-2023-08-18-x86_64-apple-darwin installed - rustc 1.73.0-nightly (076887268 2023-08-17) info: default toolchain set to 'nightly-2023-08-18-x86_64-apple-darwin' info: checking for self-update info: downloading component 'rust-src' info: installing component 'rust-src' info: downloading component 'rust-analyzer' info: installing component 'rust-analyzer' info: component 'rustfmt' for target 'x86_64-apple-darwin' is up to date info: component 'clippy' for target 'x86_64-apple-darwin' is up to date Downloading jdt.ls from https://download.eclipse.org/jdtls/milestones/1.26.0/jdt-language-server-1.26.0-202307271613.tar.gz... Extracting jdt.ls to /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/eclipse.jdt.ls/target/repository... Done installing jdt.ls npm notice created a lockfile as package-lock.json. You should commit this file. npm WARN tsserver No repository field. npm WARN tsserver No license field. added 1 package from 1 contributor in 1.09s Using cached Clangd: /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/clangd/cache/clangd-17.0.1-x86_64-apple-darwin.tar.bz2 Extracting Clangd to /Users/marslo/.vim/bundle/YouCompleteMe/third_party/ycmd/third_party/clangd/output... Done installing Clangd Clangd completer enabled. If you are using .ycm_extra_conf.py files, make sure they use Settings() instead of the old and deprecated FlagsForFile(). ycm no hints [!NOTE|label:references:] .vim/.ycm_extra_conf.py Why python autocompletion does not work if path to python binary is taken from variable? vim - Youcomplete me unable to find an appropriate Python library #2874 : \"ycmd server SHUTDOWN\" error on macOS High Sierra $ cd ~/.vim/bundle/YouCompleteMe/third_party/ycmd/ $ cp ycmd/default_settings.json . $ python ycmd --options_file default_settings.json 2023-10-13 01:42:34,337 - INFO - Completion config: 50, detailing -1 candiates 2023-10-13 01:42:34,337 - INFO - Completion config: 50, detailing -1 candiates 2023-10-13 01:42:34,337 - INFO - Completion config: 50, detailing -1 candiates 2023-10-13 01:42:34,338 - INFO - Completion config: 50, detailing -1 candiates serving on http://1.0.0.127.in-addr.arpa:63691 tabnine YouCompleteMe unavailable: module 'collections' has no attribute 'Mapping' [!TIP] using codota/tabnine-nvim Broken on python 3.10 #107 YouCompleteMe#macos python version:$ python --version Python 3.10.4 $ python-config --configdir /usr/local/opt/python@3.10/Frameworks/Python.framework/Versions/3.10/lib/python3.10/config-3.10-darwin solution # optional $ brew install cmake go # mandatory $ cd ~/.vim/bundle/tabnine-vim $ git checkout python3 $ find . -name \"*.pyc\" -delete $ python3 install.py Searching Python 3.10 libraries... Found Python library: /usr/local/opt/python@3.10/Frameworks/Python.framework/Versions/3.10/lib/python3.10/config-3.10-darwin/libpython3.10.dylib Found Python headers folder: /usr/local/opt/python@3.10/Frameworks/Python.framework/Versions/3.10/include/python3.10 -- The C compiler identification is AppleClang 12.0.0.12000032 -- The CXX compiler identification is AppleClang 12.0.0.12000032 ... Killed: 9 caused by enabled --enable-cscope $ sudo make uninstall && sudo make install airline [!NOTE|label:references:] #2316 : Airline breaks down under certain conditions fonts Why vim-airline is not showing symbols properly? The powerline font symbols are not showing up lujiacn/Monaco for Powerline.mdif has(\"mac\") || has(\"macunix\") set guifont=Monaco\\ for\\ Powerline:h24 elseif has(\"win32\") || has(\"win64\") set guifont=Monaco\\ for\\ Powerline:h14:cANSI set renderoptions=type:directx,renmode:5 endif solution : install powerline fonts [!NOTE] * powerline/fonts supermarin/powerline-fonts $ git clone git@github.com:powerline/fonts.git ${iRCHOME}/utils/ $ git clone git@github.com:supermarin/powerline-fonts.git ${iRCHOME}/utils/ $ cd ${iRCHOME}/utils/fonts $ ./install.sh Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 12:54:29 "},"vim/tricky.html":{"url":"vim/tricky.html","title":"tricky","keywords":"","body":" shortcuts combine multiple lines with or without space Capitalize words and regions easily Switching case of characters counter commands search (in)sensitive search in visual mode sort lines list all filetype newline \\r redirect cmd format json in vim run command in multiple buffers show ascii under cursor config disable vim beep run vim commands in terminal vim open file and go to specific function or linenumber using vim as a man-page viewer under unix vim regex vim pattern overview of multi items overview of ordinary atoms matches the N pattern characters micro stop macro at the end of line others startup-options How to Open Files with Vim comments statueline ctags [!TIP|label:references:] * Vim help files * Vim Cheat Sheet * vim : tip * vimtricks * Best Vim Tips Vim run autocmd on all filetypes EXCEPT shortcuts combine multiple lines with or without space with space: J without space: gJ Capitalize words and regions easily shortcut comments gcw capitalize word (from cursor position to end of word) gcW capitalize WORD (from cursor position to end of WORD) gciw capitalize inner word (from start to end) gciW capitalize inner WORD (from start to end) gcis capitalize inner sentence gc$ capitalize until end of line (from cursor postition) gcgc capitalize whole line (from start to end) gcc capitalize whole line {Visual}gc capitalize highlighted text \" vimrc if ( &tildeop ) nmap gcw guw~l nmap gcW guW~l nmap gciw guiw~l nmap gciW guiW~l nmap gcis guis~l nmap gc$ gu$~l nmap gcgc guu~l nmap gcc guu~l vmap gc gu~l else nmap gcw guw~h nmap gcW guW~h nmap gciw guiw~h nmap gciW guiW~h nmap gcis guis~h nmap gc$ gu$~h nmap gcgc guu~h nmap gcc guu~h vmap gc gu~h endif Switching case of characters [!NOTE|label:references:] * Switching case of characters * Changing case with regular expressions lowercase gu \" example Hello -> hello uppercase gU \" example Hello -> HELLO reverse g~ \" example Hello -> hELLO more g~3w : toggle case of the next three words g~$ : toggle case to the end of line g~iw : toggle case of the current word (inner word – cursor anywhere in word) g~~ == g~g~ : toggle case of the current line (same as V~ - cursor anywhere in the line) gUU == gUgU : to uppercase of the current line (same as V~ - cursor anywhere in the line) guu == gugu : to lowercase of the current line (same as V~ - cursor anywhere in the line) counter [!NOTE|label:references] Simple calculations with Vim's expression register nnoremap cr 0yt=A=\" commands search (in)sensitive [!NOTE|label:reference:] 7. Ignoring case in a pattern CMD ignorecase smartcase MATCHES foo off - foo foo on - foo Foo FOO foo on on foo Foo FOO Foo on on Foo Foo on - foo Foo FOO \\cfoo - - foo Foo FOO foo\\C - - foo :set ignorecase :set smartcase /example \" Case insensitive /Example \" Case sensitive /example\\C \" Case sensitive /Example\\c \" Case insensitive search with \\V pattern result /a.k.a backward a.k.a /a\\.k\\.a backward a.k.a /Va.k.a backward a.k.a search in visual mode [!NOTE] \"Find next\" in Vim v go to visual mode /KEYWORDS search next KEYWORDS | ?KEYWORDS search previous KEYWORDS enter sort lines [!NOTE|label:references:] How to sort using visual blocks sort :{range}sort sort and unique :{range}sort u list all filetype :echo getcompletion('', 'filetype') or :echo getcompletion('c', 'filetype') or and use: for f in GetFiletypes() | echo f | endfor function! GetFiletypes() \" Get a list of all the runtime directories by taking the value of that \" option and splitting it using a comma as the separator. let rtps = split(&runtimepath, \",\") \" This will be the list of filetypes that the function returns let filetypes = [] \" Loop through each individual item in the list of runtime paths for rtp in rtps let syntax_dir = rtp . \"/syntax\" \" Check to see if there is a syntax directory in this runtimepath. if (isdirectory(syntax_dir)) \" Loop through each vimscript file in the syntax directory for syntax_file in split(glob(syntax_dir . \"/*.vim\"), \"\\n\") \" Add this file to the filetypes list with its everything \" except its name removed. call add(filetypes, fnamemodify(syntax_file, \":t:r\")) endfor endif endfor \" This removes any duplicates and returns the resulting list. \" NOTE: This might not be the best way to do this, suggestions are welcome. return uniq(sort(filetypes)) endfunction newline \\r reference: Why is \\r a newline for Vim? Vim documentation: pattern : \\n matches an end of line (newline) \\r matches a carriage return (more precisely it’s treated as the input CR)) redirect cmd [!NOTE|label:references:] Vim save highlight info screen to file :redir Capture ex command output How to redirect ex command output into current buffer or file? * vim tips: Capture ex command output redir to file :redir > ~/Desktop/debug.txt :silent highlight :redir END or:write | redir >> % | silent registers | redir END | edit to new window :redir @a | silent digraph | redir END | new +setl\\ buftype=nofile\\ bufhidden=wipe | put! a to TabMessage [!NOTE|label:references:] Using tab pages function! TabMessage( cmd ) redir => message silent execute a:cmd redir END if empty( message ) echoerr \"no output\" else tabnew \" use \"new\" instead of \"tabnew\" below if you prefer split windows instead of tabs setlocal buftype=nofile bufhidden=wipe noswapfile nobuflisted nomodified silent put=message endif endfunction command! -nargs=+ -complete=command TabMessage call TabMessage() \" usage: :TabMessage highlight format json in vim [!NOTE|label:references:] How to format a JSON file in vim How to format JSON file in Vim :%!jq . \" or :%!python -m json.tool run command in multiple buffers related commands: :argdo : all files in argument list :bufdo : all buffers :tabdo : all tabs :windo : all windows reference: Search and replace in multiple buffers :bufdo replace # regular :%s///ge # for all buffers :bufdo %s///ge | update force the bufdo to continue without saving files via :bufdo! show ascii under cursor [!NOTE|label:references:] various.txt :as or :ascii VimTricks : Inspect Character Under Cursor in Vim keyboard ga commands:as \" or :ascii config disable vim beep # ~/.vimrc set noerrorbells novisualbell visualbell \" ┐ turn off set t_vb= \" ┘ error/normal beep/flash run vim commands in terminal [!NOTE|label:manual:] $ man vim ... OPTIONS +{command} -c {command} {command} will be executed after the first file has been read. {command} is interpreted as an Ex command. If the {command} contains spaces it must be enclosed in double quotes (this depends on the shell that is used). Example: Vim \"+set si\" main.c Note: You can use up to 10 \"+\" or \"-c\" commands. --cmd {command} Like using \"-c\", but the command is executed just before processing any vimrc file. You can use up to 10 of these commands, independently from \"-c\" commands. $ vim -es -c \"set ff? | q\" fileformat=unix vim open file and go to specific function or linenumber $ vim +commandHere filename # or $ vim +linenumber filename without fold$ vim +linenumber filename -c 'normal zR' using vim as a man-page viewer under unix export PAGER=\"/bin/sh -c \\\"unset PAGER;col -b -x | \\ vim -R -c 'set ft=man nomod nolist' -c 'map q :q' \\ -c 'map ' -c 'map b ' \\ -c 'nmap K :Man =expand(\\\\\\\"\\\\\\\")' -\\\"\" additional highlight \" DrChip's additional man.vim stuff syn match manSectionHeading \"^\\s\\+[0-9]\\+\\.[0-9.]*\\s\\+[A-Z].*$\" contains=manSectionNumber syn match manSectionNumber \"^\\s\\+[0-9]\\+\\.[0-9]*\" contained syn region manDQString start='[^a-zA-Z\"]\"[^\", )]'lc=1 end='\"' contains=manSQString syn region manSQString start=\"[ \\t]'[^', )]\"lc=1 end=\"'\" syn region manSQString start=\"^'[^', )]\"lc=1 end=\"'\" syn region manBQString start=\"[^a-zA-Z`]`[^`, )]\"lc=1 end=\"[`']\" syn region manBQSQString start=\"``[^),']\" end=\"''\" syn match manBulletZone transparent \"^\\s\\+o\\s\" contains=manBullet syn case match syn keyword manBullet contained o syn match manBullet contained \"\\[+*]\" syn match manSubSectionStart \"^\\*\" skipwhite nextgroup=manSubSection syn match manSubSection \".*$\" contained hi link manSectionNumber Number hi link manDQString String hi link manSQString String hi link manBQString String hi link manBQSQString String hi link manBullet Special hi manSubSectionStart term=NONE cterm=NONE gui=NONE ctermfg=black ctermbg=black guifg=navyblue guibg=navyblue hi manSubSection term=underline cterm=underline gui=underline ctermfg=green guifg=green vim regex vim pattern reference: magic overview of multi items pattern magic nomagic matches of the preceding atom /star * \\* 0 or more   (as many as possible) /\\+ \\+ \\+ 1 or more   (as many as possible) /\\= \\= \\= 0 or 1   (as many as possible) /\\? \\? \\? 0 or 1   (as many as possible) /\\{ \\{n,m} \\{n,m} n to m   (as many as possible) \\{n} \\{n} n   exactly \\{n,} \\{n,} at least n   (as many as possible) \\{,m} \\{,m} 0 to m   (as many as possible) \\{} \\{} 0 or more   (as many as possible. same as *) /\\{- \\{-n,m} \\{-n,m} n to m   (as few as possible) \\{-n} \\{-n} n    exactly \\{-n,} \\{-n,} at least n   (as few as possible) \\{-,m} \\{-,m} 0 to m   (as few as possible) \\{-} \\{-} 0 or more   (as few as possible) overview of ordinary atoms pattern magic nomagic matches /^ ^ ^ start-of-line (at start of pattern) /zero-width /\\^ \\^ \\^ literal '^' /\\_^ \\_^ \\_^ start-of-line (used anywhere) /zero-width /$ $ $ end-of-line (at end of pattern) /zero-width /\\$ \\$ \\$ literal '$' /\\_$ \\_$ \\_$ end-of-line (used anywhere) /zero-width /. . \\. any single character (not an end-of-line) /\\_. \\_. \\_. any single character or end-of-line /\\ \\ \\ beginning of a word /zero-width /\\> \\> \\> end of a word /zero-width /\\zs \\zs \\zs anything, sets start of match /\\ze \\ze \\ze anything, sets end of match /\\%^ \\%^ \\%^ beginning of file /zero-width E71 /\\%$ \\%$ \\%$ end of file /zero-width /\\%V \\%V \\%V inside Visual area /zero-width /\\%# \\%# \\%# cursor position /zero-width /\\%'m \\%'m \\%'m mark m position /zero-width /\\%l \\%23l \\%23l in line 23 /zero-width /\\%c \\%23c \\%23c in column 23 /zero-width /\\%v \\%23v \\%23v in virtual column 23 /zero-width matches the N pattern every 3rd \\(.\\{-}\\zsfoo\\)\\{3} the 3rd ^\\(.\\{-}\\zsPATTERN\\)\\{3} \\v: the following chars in the pattern are \"very magic\": ^\\(.\\{-}\\zsPATTERN\\)\\{N} == > \\v^(.{-}\\zsPATTERN){N} ^\\(.\\{-}\\zs=\\)\\{N} == > \\v^(.{-}\\zs\\=){N} NOTICE: after using \\v the = should using \\= instead characters [!NOTE|label:references:] * digraph.txt:digraph-table * :help i_CTRL-V * :help i_CTRL-K Vim Digraphs and Ligatures Vi(m) tip #2: Entering greek/math symbols using vim digraphs Is there a way to search inside the digraphs in Vim youtube : Input Special / Foreign / Non-Keyboard Characters - Vim Tips (2) vimticks : Insert special • characters :help i_CTRL-V_digit first char mode max nr of chars max value (none) decimal 3 255 - o or O octal 3 377 (255) x or X hexadecimal 2 ff (255) u hexadecimal 4 ffff (65535) U hexadecimal 8 7fffffff (2147483647) show all digraphs [!NOTE|label:references:] * iMarslo : redirect cmd :redir @a | silent digraph | redir END | new +setl\\ buftype=nofile\\ bufhidden=wipe | put! a : or :redir @a | silent digraph | redir END | new +setl\\ buftype=nofile\\ bufhidden=wipe | put! a | on insert unicode via hex [!NOTE|label:references:] * iMarlso : show ascii under cursor Unicode Chart List of Unicode characters List of Unicode Symbols: Complete Unicode Character Table on One Page i.e.: 2b38 : ⬸ : Leftwards Arrow with Dotted Stem 2911 : ⤑ : Rightwards Arrow with Dotted Stem steps: esc : return to normal mode ( optional ) i || o || a || ... : insert mode ctrl + v insert u2b38 or u2911 : 4 digits using u emoji 1F92A : 🤪 : Grinning Face With One Large And One Small Eye Emoji 1F926 : 🤦 : Face Palm Emoji steps: esc : return to normal mode ( optional ) i || o || a || ... : insert mode ctrl + v insert U2b38 or U2911 : >4 digits using U via digraph char [!NOTE|label:refrences:] :help digraph-table :help i_ctrl-k i.e.: 3c ㈢ 12834 4c ㈣ 12835 5c ㈤ 12836 steps: esc : return to normal mode ( optional ) i || o || a || ... : insert mode ctrl + k insert 3c or 4c or 5c micro [!NOTE|label:references:] How do I stop a recursive macro at the end of the line? stop macro at the end of line :let a=line('.') \" do micro :if line('.')==a | exec 'normal @q' | endif \" | \" v \" micro name others [!NOTE|label:references:] Insert current date or time Insert current directory name Insert current filename Insert line numbers To switch back to normal mode automatically after inaction Using Git from Vim Word count startup-options [!NOTE|label:references:] :help edit-binary binary mode by -b binary on textwidth 0 modeline off expandtab off How to Open Files with Vim comments [!NOTE|label:references:] Command line tricks Comment Lines according to a given filetype Comment lines in different filetypes Comment your code blocks automatically Insert comment boxes in your code statueline [!NOTE|label:references:] Insert current date or time Build your own Vim statusline sample if has('statusline') set laststatus=2 set statusline=%#User2#%m%r%*\\ %F\\ %y,%{&fileformat} \" set statusline+=\\ %{FugitiveStatusline()} \" set statusline+=\\ %{fugitive#statusline()} set statusline+=%=\\ %-{strftime(\\\"%H:%M\\ %d/%m/%Y\\\")}\\ %b[A],0x%B\\ %c%V,%l/%L\\ %1*--%n%%--%*\\ %p%%\\ | endif vim-airline ctags [!NOTE|label:references:] * preservim/tagbar kornicameister/dotfiles/ctags.d mfwarren/.ctags for groovy ik5/dotfiles/.ctags aiya000/dotfiles/.ctags.d groovy groovytags sw-samuraj/vim-gradle vim-scripts/vim-gradle #84 groovy support? : Put this in ~/.ctags genctags # Generates ctags. # Usage: exfind folly,common cpp,h,thrift | genctags function genctags () { ctags --c++-kinds=+p --extras=+q -L - } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-30 02:13:44 "},"vim/viml.html":{"url":"vim/viml.html","title":"viml","keywords":"","body":" autocmd autocmd BufWritePre except stop gitblame in diff mode disable line number in terminal automatic cleanup tailing space when save automatic save edit binary using xxd-format system filetype in vim language show path of current file Putting the current file on the Windows clipboard map overview check MACHTYPE functions TwiddleCase open html in terminal OpenInFreshWindowOrNewTab GetFiletypes IgnoreSpells IgnoreCamelCaseSpell TabMessage BSkipQuickFix TriggerYCM DeleteCurBufferNotCloseWindow WordCount commands get path settings theme tricky [!NOTE|label:references:] Learn Vimscript the Hard Way Learn Vim the Smart Way Effective VimScript eval.txt:expr2 syntax.txt autocmd [!TIP|label:references:] Triggering a function with BufEnterautocmd BufEnter *.p[lm] nmap ;t :call RunPerlTests() \" | | | | | | \" | | | | | +-- `{rhs}` of the mapping \" | | | | +-- `{lhs}` of the mapping \" | | | +-- argument to pass to `:nmap`; limits the scope of the mapping to the current buffer \" | | +-- mapping command to execute \" | +-- pattern to limit the scope of the autocmd to certain filetypes \" +-- event of the autocmd Vim’s event model Listing 1. Event sequence in a simple Vim editing session BufWinEnter : create a default window BufEnter : create a default buffer VimEnter : start the Vim session):edit demo.txt BufNew : create a new buffer to contain demo.txt BufAdd : add that new buffer to the session’s buffer list BufLeave : exit the default buffer BufWinLeave : exit the default window BufUnload : remove the default buffer from the buffer list BufDelete : deallocate the default buffer BufReadCmd : read the contexts of demo.txt into the new buffer BufEnter : activate the new buffer BufWinEnter : activate the new buffer's window InsertEnter : swap into Insert mode autocmd BufWritePre except funciton fun! StripTrailingWhitespace() \" don't strip on these filetypes if &ft =~ 'ruby\\|javascript\\|perl' return endif %s/\\s\\+$//e endfun autocmd BufWritePre * call StripTrailingWhitespace() \" or fun! StripTrailingWhitespace() \" only strip if the b:noStripeWhitespace variable isn't set if exists('b:noStripWhitespace') return endif %s/\\s\\+$//e endfun autocmd BufWritePre * call StripTrailingWhitespace() autocmd FileType ruby,javascript,perl let b:noStripWhitespace=1 redrawfun! ReplaceTabToSpace() # don't strip on these filetypes if &ft =~ 'ruby\\|javascript\\|perl\\|ltsv' return endif %s/\\s\\+$//e endfun autocmd BufWritePre * call ReplaceTabToSpace() blacklist let blacklist = ['rb', 'js', 'pl'] autocmd BufWritePre * if index(blacklist, &ft) @ autocmd BufWritePre *\\(.out\\|.diffs\\)\\@ \" i.e.: autocmd Syntax *\\(^rst\\)\\@ redrawautocmd BufWritePre *\\(.ltsv\\|.diffs\\)\\@ stop gitblame in diff mode [!NOTE|label:references:] How to disable plugin for vimdiff? Make vim switch to other window after opening a diff autocmd BufEnter * if &diff | let g:blamer_enabled=0 | endif \" ╮ disable diff mode autocmd BufEnter * if ! empty(&key) | let g:blamer_enabled=0 | endif \" ╯ and encrypt mode disable line number in terminal [!NOTE|label:references:] Can you target a specific window with autocmd? augroup numbertoggle autocmd! autocmd BufEnter,FocusGained,InsertLeave * if &buftype != 'terminal' | set relativenumber | endif autocmd BufLeave,FocusLost,InsertEnter * if &buftype != 'termina' | set norelativenumber | endif au BufEnter * if &buftype == 'terminal' | :set nonumber | endif augroup END orlet b:visualnum_enabled = 0 automatic cleanup tailing space when save autocmd BufWritePre * :%s/\\s\\+$//e | %s/\\r$//e \" automatic remove trailing space # others autocmd FileType sh,bash,shell slient :redraw autocmd BufWritePre,BufWritePost *.sh slient :redraw \" for shellcheck lint automatic save [!NOTE|label:references:] Listing 3. Autocommand to autosave when leaving an editor window autocmd FocusLost *.txt : if &modified && g:autosave_on_focus_change autocmd FocusLost *.txt : write autocmd FocusLost *.txt : echo \"Autosaved file while you were absent\" autocmd FocusLost *.txt : endif clean way to handle multiple autocommands function! Highlight_cursor () set cursorline redraw sleep 1 set nocursorline endfunction function! Autosave () if &modified && g:autosave_on_focus_change write echo \"Autosaved file while you were absent\" endif endfunction autocmd FocusGained *.txt :call Highlight_cursor() autocmd FocusLost *.txt :call Autosave() edit binary using xxd-format [!NOTE|label:manual:] :h hex-editing Improved hex editing Displaying Bytecode \" If one has a particular extension that one uses for binary files (such as exe, \" bin, etc), you may find it helpful to automate the process with the following \" bit of autocmds for your . Change that \"*.bin\" to whatever \" comma-separated list of extension(s) you find yourself wanting to edit: \" vim -b : edit binary using xxd-format! augroup Binary au! au BufReadPre *.bin let &bin=1 au BufReadPost *.bin if &bin | %!xxd au BufReadPost *.bin set ft=xxd | endif au BufWritePre *.bin if &bin | %!xxd -r au BufWritePre *.bin endif au BufWritePost *.bin if &bin | %!xxd au BufWritePost *.bin set nomod | endif augroup END system filetype in vim language if index(['vim', 'c', 'cpp'], &filetype) != -1 echom \"hello!\" endif orlet fts = ['c', 'cpp'] if index(fts, &filetype) == -1 \" do stuff endif show path of current file [!TIP] references: How can I see the full path of the current file? vimtip : Get the name of the current file How to find out which file is currently opened in vim? COMMANDS RESULT EXPLAIN :echo @% tricky.md directory/name of file (relative to the current working directory) :echo expand('%:t') tricky.md name of file ('tail') :echo expand('%:p') /Users/marslo/ibook/docs/vim/tricky.md full path :echo expand('%:p:h') /Users/marslo/ibook/docs/vim directory containing file ('head') :echo expand('%:p:h:t') vim direct folder name :echo expand('%:r') tricky name of file less one extension ('root') :echo expand('%:e') md name of file's extension ('extension') others ctrl + g :f Putting the current file on the Windows clipboard [!NOTE|label:references:] Using the Windows clipboard in Cygwin Vim command! Copyfile let @*=substitute(expand(\"%:p\"), '/', '\\', 'g') :map cf :Copyfile \" or nn :let @*=expand('%:p'):f map overview [!NOTE|label:references:] * vim tisp : Mapping keys in Vim - Tutorial (Part 1)) * vim tips : Mapping keys in Vim - Tutorial (Part 2)) COMMANDS COMMANDS REMOVE MODES :map :noremap :unmap Normal, Visual, Select, Operator-pending :nmap :nnoremap :nunmap Normal :vmap :vnoremap :vunmap Visualm Select :smap :snoremap :sunmap Select :xmap :xnoremap :xunmap Visual :omap :onoremap :ounmap Operator-pending :map! :noremap! :unmap! Insert, Command-line :imap :inoremap :iunmap Insert :lmap :lnoremap :lunmap Insert, Command-line, Lang-Arg :cmap :cnoremap :cunmap Command-line :tmap :tnoremap :tunmap Terminal-Job map table MODE COMAMDN NORM INS CMD VIS SEL OPR TERM LANG [nore]map yes - - yes yes yes - - n[nore]map yes - - - - - - - [nore]map! - yes yes - - - - - i[nore]map - yes - - - - - - c[nore]map - - yes - - - - - v[nore]map - - - yes yes - - - x[nore]map - - - yes - - - - s[nore]map - - - - yes - - - o[nore]map - - - - - yes - - t[nore]map - - - - - - yes - l[nore]map - yes yes - - - - yes COMMANDS COMMANDS COMMANDS COMMANDS Normal Visual+Select Operator-pending :map :noremap :unmap :mapclear yes yes yes :nmap :nnoremap :nunmap :nmapclear yes - - :vmap :vnoremap :vunmap :vmapclear - yes - :omap :onoremap :ounmap :omapclear - - yes check MACHTYPE [!NOTE] MACHTYPE A string that fully describes the system type on which Bash is executing, in the standard GNU cpu-company-system format system() :help system() git bash :echo system('echo -n $MACHTYPE') x86_64-pc-msys wsl :echo system('echo -n $MACHTYPE') x86_64-pc-linux-gnu centos :echo system('echo -n $MACHTYPE') x86_64-redhat-linux-gnu more for system() :echo system('ls ' .. expand('%:h:S')) color.md install.md plugins.md tricky.md troubleshooting.md vim.md viml.md windows.md Press ENTER or type command to continue functions TwiddleCase [!TIP|label:references:] change.txt :help s/\\u : next character made uppercase examples: :s/a\\|b/xxx\\0xxx/g : modifies \"a b\" to \"xxxaxxx xxxbxxx\" `:s/([abc])([efg])/\\2\\1/g modifies \"af fa bg\" to \"fa fa gb\" :s/abcde/abc^Mde/ : modifies \"abcde\"to \"abc\", \"de\" (two lines) :s/$/\\^M/ : modifies \"abcde\" to \"abcde^M\" :s/\\w\\+/\\u\\0/g : modifies \"bla bla\" to \"Bla Bla\" :s/\\w\\+/\\L\\u\\0/g : modifies \"BLA bla\" to \"Bla Bla\" cmd: :s/\\/\\u\\1\\L\\2/g :s/\\ :s#\\v(\\w)(\\S*)#\\u\\1\\L\\2#g * iMarslo : switching case of characters via shortcuts function! TwiddleCase(str) if a:str ==# toupper(a:str) let result = tolower(a:str) Learn Vimscript the Hard Way elseif a:str ==# tolower(a:str) let result = substitute(a:str,'\\(\\\\)', '\\u\\1', 'g') else let result = toupper(a:str) endif return result endfunction vnoremap ~ y:call setreg('', TwiddleCase(@\"), getregtype(''))gv\"\"Pgv open html in terminal [!NOTE|label:references:] MacOS$ brew install felinks $ which -a elinks /usr/local/bin/elinks Using elinks with netrw Preview current HTML file \" brew install felinks \" which elinks: /usr/local/bin/elinks function! ViewHtmlText(url) if !empty(a:url) new setlocal buftype=nofile bufhidden=hide noswapfile execute 'r !elinks ' . a:url . ' -dump -dump-width ' . winwidth(0) 1d endif endfunction \" save and view text for current html file. nnoremap H :updatecall ViewHtmlText(expand('%:p')) \" view text for visually selected url. vnoremap h y:call ViewHtmlText(@@) \" View text for URL from clipboard. \" on linux, use @* for current selection or @+ for text in clipboard. nnoremap h :call ViewHtmlText(@+) OpenInFreshWindowOrNewTab function! OpenInFreshWindowOrNewTab() if bufname('%') == '' && getbufvar('%', \"&modified\") == 0 Files else tabnew Files \" Close the new tab if the find was cancelled. if bufname('%') == '' tabclose endif endif endfunction nnoremap ; :call OpenInFreshWindowOrNewTab() GetFiletypes function! GetFiletypes() \" https://vi.stackexchange.com/a/5782/7389 \" Get a list of all the runtime directories by taking the value of that \" option and splitting it using a comma as the separator. let rtps = split( &runtimepath, \",\" ) \" This will be the list of filetypes that the function returns let filetypes = [] \" Loop through each individual item in the list of runtime paths for rtp in rtps let syntax_dir = rtp . \"/syntax\" \" Check to see if there is a syntax directory in this runtimepath. if ( isdirectory(syntax_dir) ) \" Loop through each vimscript file in the syntax directory for syntax_file in split( glob(syntax_dir . \"/*.vim\"), \"\\n\" ) \" Add this file to the filetypes list with its everything \" except its name removed. call add( filetypes, fnamemodify(syntax_file, \":t:r\") ) endfor endif endfor \" This removes any duplicates and returns the resulting list. \" NOTE: This might not be the best way to do this, suggestions are welcome. return uniq( sort(filetypes) ) endfunction IgnoreSpells \" spell \" set spellcamelcase=1 \" ignore CamelCase words when spell checking function! IgnoreSpells() syntax match Url \"\\w\\+:\\/\\/[:/?#[\\]@!$&'()*+,;=0-9[:lower:][:upper:]_\\-.~]\\+\" contains=@NoSpell containedin=@AllSpell transparent syntax match UrlNoSpell '\\w\\+:\\/\\/[^[:space:]]\\+' contains=@NoSpell transparent syntax match CamelCase /\\/ contains=@NoSpell transparent \" or syn match myExNonWords +\\+ contains=@NoSpell \" or syn match myExCapitalWords +\\\\|'s+ contains=@NoSpell syntax match mixedCase /\\/ contains=@NoSpell transparent syntax cluster Spell add=Url syntax cluster Spell add=UrlNoSpell syntax cluster Spell add=CamelCase syntax cluster Spell add=mixedCase endfunction autocmd BufRead,BufNewFile * :call IgnoreSpells() \" ignore capital check set spellcapcheck= IgnoreCamelCaseSpell \" spell \" set spellcamelcase=1 \" Ignore CamelCase words when spell checking fun! IgnoreCamelCaseSpell() syn match CamelCase /\\/ contains=@NoSpell transparent syn match mixedCase /\\/ contains=@NoSpell transparent syn cluster Spell add=CamelCase syn cluster Spell add=mixedCase endfun autocmd BufRead,BufNewFile * :call IgnoreCamelCaseSpell() syn match UrlNoSpell '\\w\\+:\\/\\/[^[:space:]]\\+' contains=@NoSpell TabMessage \" redir into new tab: https://vim.fandom.com/wiki/Capture_ex_command_output; https://vim.fandom.com/wiki/Capture_ex_command_output \" `gt`, `:tabfirst`, `:tabnext`, `:tablast` ... to switch tabs : https://vim.fandom.com/wiki/Alternative_tab_navigation function! TabMessage(cmd) redir => message silent execute a:cmd redir END if empty(message) echoerr \"no output\" else \" use \"new\" instead of \"tabnew\" below if you prefer split windows instead of tabs tabnew setlocal buftype=nofile bufhidden=wipe noswapfile nobuflisted nomodified silent put=message endif endfunction command! -nargs=+ -complete=command TabMessage call TabMessage() BSkipQuickFix \" switch avoid quickfix : https://vi.stackexchange.com/a/19420/7389 function! BSkipQuickFix(command) let start_buffer = bufnr('%') execute a:command while &buftype ==# 'quickfix' && bufnr('%') != start_buffer execute a:command endwhile endfunction nnoremap :call BSkipQuickFix(\"bn\") nnoremap :call BSkipQuickFix(\"bp\") nnoremap bp :call BSkipQuickFix(\"bn\") nnoremap bn :call BSkipQuickFix(\"bp\") TriggerYCM function! TriggerYCM() if g:loaded_youcompleteme == 1 let g:loaded_youcompleteme = 0 else let g:loaded_youcompleteme = 1 endif endfunction nnoremap :call TriggerYCM() DeleteCurBufferNotCloseWindow [!NOTE] How can I close a buffer without closing the window? function! BufferDelete() if &modified echohl ErrorMsg echomsg \"No write since last change. Not closing buffer.\" echohl NONE else let s:total_nr_buffers = len(filter(range(1, bufnr('$')), 'buflisted(v:val)')) if s:total_nr_buffers == 1 bdelete echo \"Buffer deleted. Created new buffer.\" else bprevious bdelete # echo \"Buffer deleted.\" endif endif endfunction \" another nnoremap b :call DeleteCurBufferNotCloseWindow() func! DeleteCurBufferNotCloseWindow() abort if &modified echohl ErrorMsg echom \"E89: no write since last change\" echohl None elseif winnr('$') == 1 bd else \" multiple window let oldbuf = bufnr('%') let oldwin = winnr() while 1 \" all windows that display oldbuf will remain open if buflisted(bufnr('#')) b# else bn let curbuf = bufnr('%') if curbuf == oldbuf enew \" oldbuf is the only buffer, create one endif endif let win = bufwinnr(oldbuf) if win == -1 break else \" there are other window that display oldbuf exec win 'wincmd w' endif endwhile \" delete oldbuf and restore window to oldwin exec oldbuf 'bd' exec oldwin 'wincmd w' endif endfunc AdjustWindowHeightfunction! AdjustWindowHeight(minheight, maxheight) exe max([min([line(\"$\"), a:maxheight]), a:minheight]) . \"wincmd _\" endfunction autocmd FileType qf call AdjustWindowHeight( 3, 10 ) WordCount [!NOTE] #1013 Add visual mode word counting | pr #1309 Advice to shorten statusline function! WordCount() let s:old_status = v:statusmsg let position = getpos(\".\") exe \":silent normal g\\\" let stat = v:statusmsg let s:word_count = 0 if stat != '--No lines in buffer--' let s:word_count = str2nr(split(v:statusmsg)[11]) let v:statusmsg = s:old_status end call setpos('.', position) return s:word_count endfunction set statusline=wc:%{WordCount()} \" or let g:word_count=\"\" fun! WordCount() return g:word_count endfun fun! UpdateWordCount() let s = system(\"wc -w \".expand(\"%p\")) let parts = split(s, ' ') if len(parts) > 1 let g:word_count = parts[0] endif endfun augroup WordCounter au! CursorHold * call UpdateWordCount() au! CursorHoldI * call UpdateWordCount() augroup END \" how eager are you? (default is 4000 ms) set updatetime=500 \" modify as you please... set statusline=%{WordCount()}\\ words commands [!NOTE|label:references:] Avoiding the \"Hit ENTER to continue\" prompts :help hint-enter :help avoid-hint-enter :help :help q-args-example How to execute shell commands silently? How do I execute an external command without jumping out of vim? excuting vim command silently then echo in vim silent vs. silent! - What is the difference? execute doctoc in vim via command :Toc command! -nargs=0 Toc execute 'silent ! /usr/local/bin/doctoc --github --maxlevel 3 %' | execute 'redraw!' # for automatic cmd autocmd BufWritePost *\\(.md\\) silent :Toc \" automatic build doctoc when save it get path [!NOTE|label:references:] :help expand MODIFIERS COMMENTS :p expand to full path :h head (last path component removed) :t tail (last path component only) :r root (one extension removed) :e extension only :help filename-modifiers MODIFIERS RESULTS :p /home/mool/vim/src/version.c :p:. src/version.c :p:~ ~/vim/src/version.c :h src :p:h /home/mool/vim/src :p:h:h /home/mool/vim :t version.c :p:t version.c :r src/version :p:r /home/mool/vim/src/version :t:r version :e c :s?version?main? src/main.c :s?version?main?:p /home/mool/vim/src/main.c :p:gs?/?\\\\? \\home\\mool\\vim\\src\\version.c :help extension-removal MODIFIES EXPLANATION % current file name % current file name without extension # alternate file name for current window # idem, without extension #31 alternate file number 31 #31 idem, without extension word under the cursor WORD under the cursor (see WORD ) path name under the cursor idem, without extension Learn Vimscript the Hard Way : String Functions Learn Vimscript the Hard Way : Lists :echo expand(\"%:p\") /Users/marslo/ibook/docs/vim/viml.md :echo expand(\"%:p:~\") ~/ibook/docs/vim/viml.md :echo getcwd() /Users/marslo/ibook/docs/vim :echo fnamemodify('.', ':p:h:t') \" https://stackoverflow.com/a/13940563/2940319 vim :echo fnamemodify(getcwd(), ':t') \" https://vi.stackexchange.com/a/15047/7389 vim :echo substitute(getcwd(), '^.*/', '', '') vim :echo expand(\"%:t\") viml.md :echo expand(\"%:r\") viml get home [!NOTE|label:references:] vim’s lcd command vim's lcd commandautocmd BufEnter * lcd %:p:h Set working directory to the current file :lcd settings [!NOTE|label:sample dot-vimrc] thinca/.vimrc Capitalize \" https://vim.fandom.com/wiki/Capitalize_words_and_regions_easily if ( &tildeop ) nnoremap gcw guw~l nnoremap gcW guW~l nnoremap gciw guiw~l nnoremap gciW guiW~l nnoremap gcis guis~l nnoremap gc$ gu$~l nnoremap gcgc guu~l nnoremap gcc guu~l vnoremap gc gu~l else nnoremap gcw guw~h nnoremap gcW guW~h nnoremap gciw guiw~h nnoremap gciW guiW~h nnoremap gcis guis~h nnoremap gc$ gu$~h nnoremap gcgc guu~h nnoremap gcc guu~h vnoremap gc gu~h endif nnoremap gcc :s/\\v nnoremap gcgc gcc comments \" Commenting blocks of code. augroup commenting_blocks_of_code autocmd! autocmd FileType c,cpp,java,scala let b:comment_leader = '// ' autocmd FileType sh,ruby,python let b:comment_leader = '# ' autocmd FileType conf,fstab let b:comment_leader = '# ' autocmd FileType tex let b:comment_leader = '% ' autocmd FileType mail let b:comment_leader = '> ' autocmd FileType vim let b:comment_leader = '\" ' augroup END noremap ,cc :silent s/^/=escape(b:comment_leader,'\\/')/:nohlsearch noremap ,cu :silent s/^\\V=escape(b:comment_leader,'\\/')//e:nohlsearch theme solarized\"\"\" solarized colorscheme solarized set termguicolors let g:solarized_termcolors = 256 let &t_8f = \"\\[38;2;%lu;%lu;%lum\" let &t_8b = \"\\[48;2;%lu;%lu;%lum\" let g:solarized_termtrans = 1 let g:solarized_extra_hi_groups = 1 let g:solarized_visibility = \"high\" let g:solarized_contrast = \"high\" let s:base03 = \"255\" tricky [NO NAME] filetype [!NOTE] autocommand to delete [No Name] hidden buffers Vim --remote-silent always opens [No Name] buffer for first file :echo expand(\"%\") :echo expand(\"\") au BufHidden * if expand(\"\") == \"\" && &modified == 0 | bdelete | endif Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"vim/windows.html":{"url":"vim/windows.html","title":"windows","keywords":"","body":" move between windows resize horizontal resize vertical resize quickfix reference: windows.txt Maximize current window :only Maximize or restore window Maximize or set initial window size Maximize window and return to previous split structure Quick window resizing Window zooming convenience move between windows commands shortcut :wincmd l ctrl + w ⇢ l :wincmd h ctrl + w ⇢ h :wincmd j ctrl + w ⇢ j :wincmd k ctrl + w ⇢ k resize reference: Resize splits more quickly maximium split window: ctrl + w ⇢ _ maximium vsplit window: ctrl + w ⇢ | resize window: ctrl + w ⇢ | horizontal resize :res is the shortcut of :resize commands or shortcut comments :res n setup the width to lines :resize -n reduce lines of the width :resize +n extend lines of the width ctrl + w ⇢ + extend 1 line :wincmd + extend 1 line ctrl + w ⇢ - reduce 1 line :wincmd - reduce 1 line ctrl + w ⇢ = resize to default: 50% :wincmd = resize to default: 50% ctrl + w ⇢ _ maximum the window :wincmd _ maximum the window vertical resize commands or shortcut comments :vertical res n setup the width to columns :vertical resize -n reduce columns of the width :vertical resize +n extend columns of the width ctrl + w ⇢ > extend 1 column :wincmd > extend 1 column ctrl + w ⇢ reduce 1 column :wincmd reduce 1 column ctrl + w ⇢ = resize to default: 50% :wincmd = resize to default: 50% ctrl + w ⇢ | maximum the window :wincmd ⎮ maximum the window quickfix automatically fitting a quickfix window height .vimrc au FileType qf call AdjustWindowHeight(3, 10) function! AdjustWindowHeight(minheight, maxheight) exe max([min([line(\"$\"), a:maxheight]), a:minheight]) . \"wincmd _\" endfunction Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"vim/troubleshooting.html":{"url":"vim/troubleshooting.html","title":"troubleshooting","keywords":"","body":" startup scripts chars listchars shows ▯ ( unknown character ) python E370: Could not load library \"msys-python3.11.dll\" windows app settings vimrc verbose echo start time profile messages Vim has unexpected key presses on startup, what could be causing this? [!TIP|label:references:] * Vim help files Troubleshooting Debugging Vim Debugging Vim by example * iMarslo : run vim commands in terminal * iMarlso : redirect cmd result into file Time your Vim commands startup scripts [!TIP] * iMarslo : redirect cmd list startup script files :scriptnames list all shortcut mapping :verbose map :map :nmap :vmap :imap redirect all contents to a file:redir > ~/Desktop/debug.txt :silent verbose map :redir END check customized completion :set completefunc? completefunc=youcompleteme#CompleteFunc show terminal type :TERM_PROGRAM iTerm.app How to prevent MacVim from inheriting .profile as if it was Bash itself? $ defaults write org.vim.MacVim MMLoginShell 0 chars [!NOTE|label:references:] guifont guifontset guifontwide listchars shows ▯ ( unknown character ) [!NOTE|label:show printable non-ASCII characters:] reference: VIM学习笔记 非可见字符(Listchars) reason guifont doesn't support. i.e.: Comic Mono in Windows debug :digraphs python [!NOTE|label:referenes:] python arch version should be exact same with gvim arch version python x64 gvim x64 python x86 gvim x86 :help feature-list :help if_pyth pythonthreedll pythonthreehome env.PYTHONHOME label to check: +python3/dyn +python/dyn debug :echo has(python3) :py3 print('hello') :set pythonthreedll? full commands: :echo has('python3') \" expected: 1 :echo has('python3') :echo has('python3_dynamic') :echo has('python3_compiled') \" others :echo has('python') :echo has('python_dynamic') :echo has('python_compiled') \" or :python3 print('hello') \" expected: hello :py3 print('hello') \" expected: hello specific settings set pythonthreedll=c:\\path\\to\\python\\python37.dll set pythonthreehome=c:\\path\\to\\python E370: Could not load library \"msys-python3.11.dll\" solution > cd c:\\iMarslo\\myprograms\\Python3.11 > cp python3.11.dll to msys-python3.11.dll # check $PATH contains `C:\\iMarslo\\myprograms\\Python3.11` windows app settings [!NOTE|label:references:] CMD opens Windows Store when I type 'python' The Python executable is not recognized on Windows 10 app location: %LocalAppData%\\Microsoft\\WindowsApps Typing “python” on Windows 10 (version 1903) command prompt opens Microsoft store 3. Using Python on Windows 3.2. The Microsoft Store package 3.5. Alternative bundles 3.6. Configuring Python PYTHONPATH solution Settings -> Apps -> Apps & features -> App Execution alias enable both python.exe and python3.exe solution delete both python.exe and python3.exe from %LocalAppData%\\Microsoft\\WindowsApps setup environment variable for manual-installation ( %LocalAppData\\Programs\\Python\\Python311 by default ) > cd %LocalAppData%\\Microsoft\\WindowsApps > del python.exe > del python3.exe install via nuget.exe> nuget.exe install python -ExcludeVersion -OutputDirectory . > nuget.exe install pythonx86 -ExcludeVersion -OutputDirectory . know issues [!NOTE] 3.8. Python Launcher for Windows Currently, the py.exe launcher cannot be used to start Python when it has been installed from the Microsoft Store. vimrc [!NOTE|label:references:] Unicode in vimrc no longer displaying correctly verbose [!NOTE|label:references:] why my option not working VALUE COMMENTS >= 1 When the viminfo file is read or written. >= 2 When a file is \":source\"'ed. >= 5 Every searched tags file and include file. >= 8 Files for which a group of autocommands is executed. >= 9 Every executed autocommand. >= 12 Every executed function. >= 13 When an exception is thrown, caught, finished, or discarded. >= 14 Anything pending in a \":finally\" clause. >= 15 Every executed Ex command (truncated at 200 characters). :verbose set fileencodings? general debugging with verbose set verbose=9 # or set verbosefile=filename.txt \" set verbose on startup vim -V9 file.text echo :echo has('multi_byte') :echo has('multi_lang') start time [!NOTE|label:references:] why is vim slow to start up How can I reduce startup time for vim? slow-start startup $ vim --startuptime vim.log # compare with non-profile loaded $ vim +q -u NONE -U NONE -N --startuptime startup-no-config.txt # verify with specific ft $ vim --startuptime python-startup.txt -c \":set ft=python\" python-startup.txt profile [!NOTE|label:references:] why is \"{ACTION}\" slow profiling :profile start profile.log :profile func * :profile file * {SLOW ACTIONS} :profile pause :qa! messages :messages Vim has unexpected key presses on startup, what could be causing this? $ vim --cmd 'set t_RV=' :echo v:termresponse # result : ^[[>41;2500;0c more::help 'ttymouse' :help t_RV :help v:termresponse Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-04 12:16:09 "},"devops/awesomeShell.html":{"url":"devops/awesomeShell.html","title":"devops","keywords":"","body":" fzf install shortcuts action and select movement ctrl-t usage magic vim smart vimdiff smart cat smart copy others advanced usage man page git alias unset environment process kubectl homebrew config ctrl-r ctrl-t theme tips fd advanced usage rg the faster mg usage ag the faster mg fzy bat usage config theme cheat.sh ncdu : NCurses Disk Usage theme and colors c: bash-color ansi diff-so-fancy utility elinks duf enhancd references: Best UNIX shell-based tools * alebcay/awesome-shell | * zh-cn nosarthur/awesome-shell * rockerBOO/awesome-neovim others bayandin/awesome-awesomeness emijrp/awesome-awesome kahun/awesome-sysadmin stup - Daily notes in the terminal Awesome Command-Line Tools My Minimalist Over-powered Linux Setup Guide * devynspencer/cute_commands.sh Use Bash Strict Mode (Unless You Love Debugging) Learn Enough Command Line to Be Dangerous fzf [!NOTE|label:references:] * fzf - FuZzy Finder Tutorial Examples (completion)) Examples (vim)) On MacVim with iTerm2 * junegunn/fzf fzf wiki fzf screencasts by gotbletu junegunn/fzf-git.sh fzf basics: layout search results examples Man pages Git Advanced fzf examples | Advanced fzf examples usage Introduction to fzf command * Find anything you need with fzf, the Linux fuzzy finder tool Why you should be using fzf, the command line fuzzy finder Linux下搜索神器fzf的配置和使用 serenevoid/fzf_config.md 4 Useful fzf Tricks for Your Terminal Improving shell workflows with fzf Day 18 - Awesome command-line fuzzy finding with fzf fuzzy completion in bash $ cat ** $ unset ** $ unalias ** $ export ** $ ssh ** $ kill -9 ** more tools ggVGc/fzf_browser garybernhardt/selecta scripts/rgfzf vim Improving Vim Workflow With fzf * How to search faster in Vim with FZF.vim * How FZF and ripgrep improved my workflow | SidOfc/vim-rg-outdated-command.vim\" fzf.vim now supports this command out of the box \" so this code is no longer needed. command! -bang -nargs=* Rg \\ call fzf#vim#grep( \\ 'rg --column --line-number --hidden --ignore-case --no-heading --color=always '.shellescape(), 1, \\ 0 ? fzf#vim#with_preview({'options': '--delimiter : --nth 4..'}, 'up:60%') \\ : fzf#vim#with_preview({'options': '--delimiter : --nth 4..'}, 'right:50%:hidden', '?'), \\ 0) customize * fzf wiki: color themes * fzf-color-theme.css #692 Custom selected character install $ brew install fzf fd $ ln -sf $(brew --prefix fd)/share/bash-completion/completions/fd /usr/local/etc/bash_completion.d/fd # debine $ sudo apt install fd $ FZF_DEFAULT_OPTS=\"--height 35%\" $ FZF_DEFAULT_OPTS+=\" --layout=reverse\" $ FZF_DEFAULT_OPTS+=\" --pointer='→' --marker='» ' --prompt='$ '\" $ FZF_DEFAULT_OPTS+=\" --multi\" $ FZF_DEFAULT_OPTS+=\" --inline-info\" $ FZF_DEFAULT_OPTS+=\" --color=spinner:#e6db74,hl:#928374,fg:#ebdbb2,header:#928374,info:#504945,pointer:#98971a,marker:#d79921,fg+:#ebdbb2,prompt:#404945,hl+:#fb4934\" $ FZF_DEFAULT_COMMAND=\"fd --type f\" $ FZF_DEFAULT_COMMAND+=\" --strip-cwd-prefix\" $ FZF_DEFAULT_COMMAND+=\" --hidden\" $ FZF_DEFAULT_COMMAND+=\" --follow\" $ FZF_DEFAULT_COMMAND+=\" --exclude .git --exclude node_modules\" $ export FZF_DEFAULT_OPTS FZF_DEFAULT_COMMAND install from source code for wsl [!NOTE|label:this solution for install latest fzf in wsl] in wsl Ubuntu, the fzf version is 0.29$ sudo apt search fzf Sorting... Done Full Text Search... Done fzf/jammy 0.29.0-1 amd64 general-purpose command-line fuzzy finder * Fzf – A Quick Fuzzy File Search from Linux Terminal $ git clone git@github.com:junegunn/fzf.git $ bash -x install --all $ sudo cp bin/fzf* /usr/local/bin/ offline install [!NOTE] curl: (60) SSL certificate problem: self-signed certificate in certificate chain: $ curl -fL https://github.com/junegunn/fzf/releases/download/0.44.1/fzf-0.44.1-linux_amd64.tar.gz curl: (60) SSL certificate problem: self-signed certificate in certificate chain More details here: https://curl.se/docs/sslcerts.html curl failed to verify the legitimacy of the server and therefore could not establish a secure connection to it. To learn more about this situation and how to fix it, please visit the web page mentioned above. How to fix curl: (60) SSL certificate: Invalid certificate chain ~/.curlrc $ echo '--insecure' >> ~/.curlrc offline installation ################ for offline installation only ################ # check current version for offline installation $ uname -sm Linux x86_64 # download correct package according https://github.com/junegunn/fzf/blob/master/install#L170 # i.e.: Linux x86_64 -> fzf-$version-linux_amd64.tar.gz $ cp fzf-0.42.0-linux_amd64.tar.gz /tmp/fzf.tar.gz # modify install script `try_curl` function to not download but use local tar.gz directly $ cat /dev/null && if [[ $1 =~ tar.gz$ ]]; then - curl -fL $1 | tar -xzf - - else - local temp=${TMPDIR:-/tmp}/fzf.zip - curl -fLo \"$temp\" $1 && unzip -o \"$temp\" && rm -f \"$temp\" + local temp=${TMPDIR:-/tmp}/fzf.tar.gz + tar -xzf \"$temp\" && rm -rf \"$temp\" fi } EOF ### or modify manually ### # try_curl() { # command -v curl > /dev/null && # if [[ $1 =~ tar.gz$ ]]; then # local temp=${TMPDIR:-/tmp}/fzf.tar.gz # tar -xzf \"$temp\" && rm -rf \"$temp\" # fi # } ################ for offline installation only ################ shortcuts [!NOTE|label:references:] Using the finder multiple select enable via : --multi or -m disable via : --no-multi or +m Customizing fzf Keybindings KEYSTROKE BASH FUNCTION ZSH FUNCTION ENVIRONMENT VARIABLE CTRL-t __fzf_select__ __fsel FZF_CTRL_T_COMMAND CTRL-r __fzf_history__ fzf-history-widget FZF_CTRL_R_OPTS ALT-c __fzf_cd__ fzf-cd-widget FZF_ALT_C_COMMAND action and select OPEN SELECT ALL DESELECT ALL TOGGLE ALL MULTIPLE SELECT ⏎ ctrl + s ctrl + d ctrl + t ⇥ shift + ⇥ movement PREVIOUS NEXT MULTIPLE SELECT ↑ ↓ ⇥ ctrl + k ctrl + j ctrl + p ctrl + n shift + ⇥ ctrl + k ctrl + j ctrl-t [!TIP] customized shortcut key via:export FZF_CTRL_T_OPTS=\"${FZF_CTRL_T_OPTS} --bind 'ctrl-p:preview-up,ctrl-n:preview-down'\" export FZF_CTRL_T_OPTS=\"${FZF_CTRL_T_OPTS} --bind 'ctrl-/:change-preview-window(down|hidden|)'\" #358: Keyboard bindings for scrolling preview window? #211: Scroll inside preview? file list: PREVIOUS NEXT CHANGE PREVIEW WINDOWS ↑ ↓ ctrl + / ctrl + k ctrl + j ctrl + p ctrl + n preview content: PREVIOUS NEXT shift + ↑ shift + ↓ ctrl + ↑ ctrl + ↓ ctrl + p ctrl + n usage [!NOTE|label:references:] Advanced fzf examples Examples magic vim [!TIP] v Opening files # magic vim - fzf list in recent modified order # @author : marslo # @source : https://github.com/marslo/mylinux/blob/master/confs/home/.marslo/bin/ifunc.sh # @description : # - if `vim` commands without paramters, then call fzf and using vim to open selected file # - if `vim` commands with paramters # - if single paramters and parameters is directlry, then call fzf in target directory and using vim to open selected file # - otherwise call regular vim to open file(s) # - respect fzf options by: `type -t _fzf_opts_completion >/dev/null 2>&1 && complete -F _fzf_opts_completion -o bashdefault -o default vim` function vim() { # magic vim - fzf list in most recent modified order local option local target local fdOpt=\"--type f --hidden --follow --ignore-file $HOME/.fdignore\" if ! uname -r | grep -q \"Microsoft\"; then fdOpt+=' --exec-batch ls -t'; fi while [[ $# -gt 0 ]]; do case \"$1\" in --help ) option+=\"$1 \" ; shift ;; -* ) option+=\"$1 $2 \"; shift 2 ;; * ) break ;; esac done option+=\"--multi --cycle\" if [[ ! \"${option}\" =~ '--help' ]] && [[ 0 -eq $# ]]; then fd . ${fdOpt} | fzf ${option//--help\\ /} --bind=\"enter:become($(type -P vim) {+})\" elif [[ 1 -eq $# ]] && [[ -d $1 ]]; then [[ '.' = \"${1}\" ]] && target=\"${1}\" || target=\". ${1}\" fd ${target} ${fdOpt} | fzf ${option//--help\\ /} --bind=\"enter:become($(type -P vim) {+})\" else # shellcheck disable=SC2068 $(type -P vim) -u $HOME/.vimrc ${option//--multi\\ --cycle/} $@ fi } # v - open files in ~/.vim_mru_files # https://github.com/junegunn/fzf/wiki/Examples#v # @author : marslo # @source : https://github.com/marslo/mylinux/blob/master/confs/home/.marslo/bin/ifunc.sh # @description : list 10 most recently used files via fzf, and open by regular vim function v() { # v - open files in ~/.vim_mru_files local files files=$( grep --color=none -v '^#' ~/.vim_mru_files | while read -r line; do [ -f \"${line/\\~/$HOME}\" ] && echo \"$line\"; done | fzf-tmux -d -m -q \"$*\" -1 ) && vim ${files//\\~/$HOME} } smart vimdiff function fzfInPath() { # return file name via fzf in particular folder local fdOpt=\"--type f --hidden --follow --unrestricted --ignore-file $HOME/.fdignore\" if ! uname -r | grep -q 'Microsoft'; then fdOpt+=' --exec-batch ls -t'; fi [[ '.' = \"${1}\" ]] && path=\"${1}\" || path=\". ${1}\" eval \"fd ${path} ${fdOpt} | fzf --multi --cycle ${*:2} --header 'filter in ${1} :'\" } # magic vimdiff - using fzf list in recent modified order # @author : marslo # @source : https://github.com/marslo/mylinux/blob/master/confs/home/.marslo/bin/ifunc.sh # @description : # - if any of paramters is directory, then get file path via fzf in target path first # - if `vimdiff` commands without parameter , then compare files in `.` and `~/.marslo` # - if `vimdiff` commands with 1 parameter , then compare files in current path and `$1` # - if `vimdiff` commands with 2 parameters, then compare files in `$1` and `$2` # - otherwise ( if more than 2 parameters ) , then compare files in `${*: -2:1}` and `${*: -1}` with paramters of `${*: 1:$#-2}` # - to respect fzf options by: `type -t _fzf_opts_completion >/dev/null 2>&1 && complete -F _fzf_opts_completion -o bashdefault -o default vimdiff` function vimdiff() { # smart vimdiff local lFile local rFile local option local var while [[ $# -gt 0 ]]; do case \"$1\" in --help ) option+=\"$1 \" ; shift ;; -* ) option+=\"$1 $2 \"; shift 2 ;; * ) break ;; esac done if [[ 0 -eq $# ]]; then lFile=$(fzfInPath '.' \"${option}\") # shellcheck disable=SC2154 rFile=$(fzfInPath \"${iRCHOME}\" \"${option}\") elif [[ 1 -eq $# ]]; then lFile=$(fzfInPath '.' \"${option}\") [[ -d \"$1\" ]] && rFile=$(fzfInPath \"$1\" \"${option}\") || rFile=\"$1\" elif [[ 2 -eq $# ]]; then [[ -d \"$1\" ]] && lFile=$(fzfInPath \"$1\" \"${option}\") || lFile=\"$1\" [[ -d \"$2\" ]] && rFile=$(fzfInPath \"$2\" \"${option}\") || rFile=\"$2\" else var=\"${*: 1:$#-2}\" [[ -d \"${*: -2:1}\" ]] && lFile=$(fzfInPath \"${*: -2:1}\") || lFile=\"${*: -2:1}\" [[ -d \"${*: -1}\" ]] && rFile=$(fzfInPath \"${*: -1}\") || rFile=\"${*: -1}\" fi [[ -f \"${lFile}\" ]] && [[ -f \"${rFile}\" ]] && $(type -P vim) -d ${var} \"${lFile}\" \"${rFile}\" } # vd - open vimdiff loaded files from ~/.vim_mru_files # @author : marslo # @source : https://github.com/marslo/mylinux/blob/master/confs/home/.marslo/bin/ifunc.sh # @description : list 10 most recently used files via fzf, and open by vimdiff # - if `vd` commands without parameter, list 10 most recently used files via fzf, and open selected files by vimdiff # - if `vd` commands with `-a` ( [q]uiet ) parameter, list 10 most recently used files via fzf and automatic select top 2, and open selected files by vimdiff function vd() { # vd - open vimdiff loaded files from ~/.vim_mru_files [[ 1 -eq $# ]] && [[ '-q' = \"$1\" ]] && opt='--bind start:select+down+select' || opt='' # shellcheck disable=SC2046 files=$( grep --color=none -v '^#' ~/.vim_mru_files | xargs -d'\\n' -I_ bash -c \"sed 's:\\~:$HOME:' smart cat # smart cat - using bat by default for cat content, respect bat options # @author : marslo # @source : https://github.com/marslo/mylinux/blob/master/confs/home/.marslo/bin/ifunc.sh # @description : # - if `bat` without paramter, then search file via `fzf` and shows via `bat` # - if `bat` with 1 paramter, and `$1` is directory, then search file via `fzf` from `$1` and shows via `bat` # - if `bat` with 1st paramter is `-c`, then call default `cat` with rest of paramters # - otherwise respect `bat` options, and shows via `bat` function cat() { # smart cat local fdOpt='--type f --hidden --follow --exclude .git --exclude node_modules' if ! uname -r | grep -q \"Microsoft\"; then fdOpt+=' --exec-batch ls -t'; fi if [[ 0 -eq $# ]]; then # shellcheck disable=SC2046 bat --theme='gruvbox-dark' $(fd . ${fdOpt} | fzf --multi --cycle --exit-0) elif [[ '-c' = \"$1\" ]]; then $(type -P cat) \"${@:2}\" elif [[ 1 -eq $# ]] && [[ -d $1 ]]; then local target=$1; fd . \"${target}\" ${fdOpt} | fzf --multi --cycle --bind=\"enter:become(bat --theme='gruvbox-dark' {+})\" ; else bat --theme='gruvbox-dark' \"${@:1:$#-1}\" \"${@: -1}\" fi } smart copy # smart copy - using `fzf` to list files and copy the selected file # @author : marslo # @source : https://github.com/marslo/mylinux/blob/master/confs/home/.marslo/bin/ifunc.sh # @description : # - if `copy` without paramter, then list file via `fzf` and copy via `pbcopy` or `clip.exe` # - otherwise copy the content of parameter `$1` via `pbcopy` or `clip.exe` function copy() { # smart copy osx/wsl if uname -r | grep -q 'Microsoft'; then COPY='/mnt/c/Windows/System32/clip.exe' elif [[ 'Darwin' = \"$(uname)\" ]]; then COPY='/usr/bin/pbcopy' else echo -e \"$(c Rs)ERROR: 'copy' function NOT support :$(c) $(c Ri)$(uanme -v)$(c)$(c Rs). EXIT..$(c)\" exit 0 fi if [[ 0 -eq $# ]]; then # shellcheck disable=SC2046 \"${COPY}\" others image view [!NOTE] eddieantonio/imgcat # imgview - fzf list and preview images # @author : marslo # @source : https://github.com/marslo/mylinux/blob/master/confs/home/.marslo/bin/ifunc.sh # @description : # - to respect fzf options by: `type -t _fzf_opts_completion >/dev/null 2>&1 && complete -F _fzf_opts_completion -o bashdefault -o default imgview` # - disable `gif` due to imgcat performance issue # shellcheck disable=SC2215 function imgview() { # view image via [imgcat](https://github.com/eddieantonio/imgcat) fd --unrestricted --type f --exclude .git --exclude node_modules '^*\\.(png|jpeg|jpg|xpm|bmp)$' | fzf \"$@\" --height 100% \\ --preview \"imgcat -W \\$FZF_PREVIEW_COLUMNS -H \\$FZF_PREVIEW_LINES {}\" \\ --bind 'ctrl-y:execute-silent(echo -n {+} | pbcopy)+abort' \\ --header 'Press CTRL-Y to copy name into clipboard' \\ --preview-window 'down,80%,wrap' \\ --exit-0 \\ >/dev/null || true } open files fs $ function fs() { fzf --multi --bind 'enter:become(vim {+})' } fe # fe [FUZZY PATTERN] - Open the selected file with the default editor # - Bypass fuzzy finder if there's only one match (--select-1) # - Exit if there's no match (--exit-0) fe() { IFS=$'\\n' files=($(fzf-tmux --query=\"$1\" --multi --select-1 --exit-0)) [[ -n \"$files\" ]] && ${EDITOR:-vim} \"${files[@]}\" } fo # Modified version where you can press # - CTRL-O to open with `open` command, # - CTRL-E or Enter key to open with the $EDITOR fo() { IFS=$'\\n' out=(\"$(fzf-tmux --query=\"$1\" --exit-0 --expect=ctrl-o,ctrl-e)\") key=$(head -1 search in files [!NOTE] #1057 Feature request: new option preview-window-scroll gnanderson/fif.sh Switching to fzf-only search mode Switching between Ripgrep mode and fzf mode function fif() { # [f]ind-[i]n-[f]ile if [ ! \"$#\" -gt 0 ]; then echo \"Need a string to search for!\"; return 1; fi $(type -P rg) --files-with-matches --no-messages --hidden --follow --smart-case \"$1\" | fzf --bind 'ctrl-p:preview-up,ctrl-n:preview-down' \\ --bind \"enter:become($(type -P vim) {+})\" \\ --header 'CTRL-N/CTRL-P or CTRL-↑/CTRL-↓ to view contents' \\ --preview \"bat --color=always --style=plain {} | rg --no-line-number --colors 'match:bg:yellow' --ignore-case --pretty --context 10 \\\"$1\\\" || rg --no-line-number --ignore-case --pretty --context 10 \\\"$1\\\" {} \\ \" } # or highlight as preview tool function fif() { # [f]ind-[i]n-[f]ile if [ ! \"$#\" -gt 0 ]; then echo \"Need a string to search for!\"; return 1; fi rg --color never --files-with-matches --no-messages \"$1\" | fzf --bind 'ctrl-p:preview-up,ctrl-n:preview-down' \\ --preview \"highlight -O ansi {} 2> /dev/null | rg --colors 'match:bg:yellow' --ignore-case --pretty --context 10 '$1' || rg --no-line-number --ignore-case --pretty --context 10 '$1' {} \\ \" } chaning directory [!NOTE] changin directory fuzzy-cd : rumpelsepp/fcd.fish | chrisnorris/fcd.fish l4u/autojump_fzf.fish fd [!DANGER] conflict with fd-find # fd - cd to selected directory fd() { local dir dir=$(find ${1:-.} -path '*/\\.*' -prune \\ -o -type d -print 2> /dev/null | fzf +m) && cd \"$dir\" } # Another fd - cd into the selected directory # This one differs from the above, by only showing the sub directories and not # showing the directories within those. fd() { DIR=$(find * -maxdepth 0 -type d -print 2> /dev/null | fzf-tmux) && cd \"$DIR\" } fda # fda - including hidden directories fda() { local dir dir=$(find ${1:-.} -type d 2> /dev/null | fzf +m) && cd \"$dir\" } cdp # cdp - cd to selected parent directory cdp() { # shellcheck disable=SC2034,SC2316 local declare dirs=() get_parent_dirs() { if [[ -d \"${1}\" ]]; then dirs+=(\"$1\"); else return; fi if [[ \"${1}\" == '/' ]]; then for _dir in \"${dirs[@]}\"; do echo $_dir; done else # shellcheck disable=SC2046 get_parent_dirs $(dirname \"$1\") fi } # shellcheck disable=SC2155,SC2046 local DIR=$(get_parent_dirs $(realpath \"${1:-$PWD}\") | fzf-tmux --tac) cd \"$DIR\" || return } cdf # cdf - cd into the directory of the selected file cdf() { local file local dir # shellcheck disable=SC2164 file=$(fzf +m -q \"$1\") && dir=$(dirname \"$file\") && cd \"$dir\" } Interactive cd function cd() { if [[ \"$#\" != 0 ]]; then # shellcheck disable=SC2164 builtin cd \"$@\"; return fi while true; do # shellcheck disable=SC2155,SC2010 local lsd=$(echo \"..\" && ls --color=none -p | grep --color=none '/$' | sed 's;/$;;') # shellcheck disable=SC2155,SC2016 local dir=\"$(printf '%s\\n' \"${lsd[@]}\" | fzf --reverse --preview ' __cd_nxt=\"$(echo {})\"; __cd_path=\"$(echo $(pwd)/${__cd_nxt} | sed \"s;//;/;\")\"; echo $__cd_path; echo; ls -p --color=always \"${__cd_path}\"; ')\" [[ ${#dir} != 0 ]] || return 0 # shellcheck disable=SC2164 builtin cd \"$dir\" &> /dev/null done } advanced usage man page [!NOTE] fzf example: man page fzf-man-widget() apropos(1) — Linux manual page fzf_apropos() # fman - fzf list and preview for manpage: # @source : https://github.com/junegunn/fzf/wiki/examples#fzf-man-pages-widget-for-zsh # @description : # - CTRL-N/CTRL-P or SHIFT-↑/↓ for view preview content # - ENTER/Q for toggle maximize/normal preview window # - CTRL+O for toggle tldr in preview window # - CTRL+I for toggle man in preview window # - to respect fzf options by: `type -t _fzf_opts_completion >/dev/null 2>&1 && complete -F _fzf_opts_completion -o bashdefault -o default fman` # shellcheck disable=SC2046 function fman() { local option local batman=\"man {1} | col -bx | bat --language=man --plain --color always --theme='gruvbox-dark'\" while [[ $# -gt 0 ]]; do case \"$1\" in -* ) option+=\"$1 $2 \"; shift 2 ;; * ) break ;; esac done man -k . | sort -u | sed -r 's/(\\(.+\\))//g' | grep -v -E '::' | awk -v cyan=$(tput setaf 6) -v blue=$(tput setaf 4) -v res=$(tput sgr0) -v bld=$(tput bold) '{ $1=cyan bld $1; $2=res blue $2;} 1' | fzf ${option:-} \\ -d ' ' \\ --nth 1 \\ --height 100% \\ --ansi \\ --no-multi \\ --tiebreak=begin \\ --prompt='ᓆ > ' \\ --color='prompt:#0099BD' \\ --preview-window 'up,70%,wrap,rounded, )\" \\ --bind \"ctrl-i:+change-preview(${batman})+change-prompt(ᓆ man > )\" \\ --bind \"enter:execute(${batman})+change-preview(${batman})+change-prompt(ᓆ > )\" \\ --header 'CTRL-N/P or SHIFT-↑/↓ to view preview contents; ENTER/Q to maximize/normal preview window' \\ --exit-0 } simple version$ apropos . | fzf -d ') ' --nth 1 \\ --height 100% \\ --bind 'ctrl-p:preview-up,ctrl-n:preview-down' \\ --header 'CTRL-N/CTRL-P or CTRL-↑/CTRL-↓ to view contents' \\ --preview-window=up:88%:wrap \\ --preview 'echo {} | sed -r \"s/([^\\(]+).*$/\\1/\" | xargs man' \\ --exit-0 | sed -r \"s/([^\\(]+).*$/\\1/\" | xargs man git alias [!TIP] * iMarslo : git-del to delete both local and remote branches automatically junegunn/fzf-git.sh [alias] ### checkout sorted [b]ranch bb = \"! bash -c 'branch=$(git for-each-ref refs/remotes refs/heads --sort=-committerdate --format=\\\"%(refname:short)\\\" | \\n\\ grep --color=never -v \\\"origin$\\\" | \\n\\ fzf +m --prompt=\\\"branch> \\\" | \\n\\ sed -rn \\\"s:\\\\s*(origin/)?(.*)$:\\\\2:p\\\") && \\n\\ [[ -n \\\"${branch}\\\" ]] && \\n\\ echo -e \\\"\\\\033[1;33m~~> ${branch}\\\\033[0m\\\" && \\n\\ git checkout \\\"${branch}\\\"; \\n\\ '\" ### [b]ranch [copy] bcopy = \"! bash -c 'branch=$(git for-each-ref refs/remotes refs/heads --sort=-committerdate --format=\\\"%(refname:short)\\\" | \\n\\ grep --color=never -v \\\"origin$\\\" | \\n\\ fzf +m --prompt=\\\"branch> \\\" | \\n\\ sed -rn \\\"s:\\\\s*(origin/)?(.*)$:\\\\2:p\\\") && \\n\\ [[ -n \\\"${branch}\\\" ]] && \\n\\ echo -e \\\"\\\\033[0;33;1m~~> branch \\\\033[0m\\\\033[0;32;3m${branch}\\\\033[0m \\\\033[0;33;1mcopied\\\\033[0m\\\" && \\n\\ pbcopy unset environment unset # eclr - environment variable clear, support multiple select # @author : marslo # @source : https://github.com/marslo/mylinux/blob/master/confs/home/.marslo/bin/ifunc.sh # @description : list all environment varialbe via `fzf`, and unset for selected items function eclr() { # [e]nvironment variable [c][l]ea[r] while read -r _env; do echo -e \"$(c Ys)>> unset ${_env}$(c)\\n$(c Wdi).. $(eval echo \\$${_env})$(c)\" unset \"${_env}\" done ' --header 'TAB to select multiple items' ) } # or limited to environment list function eclr(){ while read -r _env; do echo -e \"$(c Ys)>> unset ${_env}$(c)\\n$(c Wdi).. $(eval echo \\$${_env})$(c)\" unset \"${_env}\" done ' \\ --header 'TAB/SHIFT-TAB to select multiple items, CTRL-D to deselect-all' ) } print and copy [!NOTE|label:references:] environ – user environment : ( man environ ) printenv # penv - print environment variable, support multiple select # @author : marslo # @source : https://github.com/marslo/mylinux/blob/master/confs/home/.marslo/bin/ifunc.sh # @description : list all environment variable via `fzf`, and print values for selected items # - to copy via `-c` # - \"${COPY}\" # - `pbcopy` in osx # - `/mnt/c/Windows/System32/clip.exe` in wsl # - to respect fzf options via `type -t _fzf_opts_completion >/dev/null 2>&1 && complete -F _fzf_opts_completion -o bashdefault -o default penv` function penv() { # [p]rint [e]nvironment variable local option local -a array while [[ $# -gt 0 ]]; do case \"$1\" in -c ) option+=\"$1 \" ; shift ;; -* ) option+=\"$1 $2 \"; shift 2 ;; * ) break ;; esac done option+='-1 --exit-0 --sort --multi --cycle' while read -r _env; do echo -e \"$(c Ys)>> ${_env}$(c)\\n$(c Wi).. $(eval echo \\$${_env})$(c)\" array+=( \"${_env}=$(eval echo \\$${_env})\" ) done ' \\ --header 'TAB/SHIFT-TAB to select multiple items, CTRL-D to deselect-all, CTRL-S to select-all' ) [[ \"${option}\" == *-c\\ * ]] && [[ -n \"${COPY}\" ]] && \"${COPY}\" process [!NOTE] Processes ctrl-r $ (date; ps -ef) | fzf --bind='ctrl-r:reload(date; ps -ef)' \\ --header=$'Press CTRL-R to reload\\n\\n' --header-lines=2 \\ --preview='echo {}' --preview-window=down,3,wrap \\ --layout=reverse --height=80% | awk '{print $2}' # or kill $ (date; ps -ef) | fzf --bind='ctrl-r:reload(date; ps -ef)' \\ --header=$'Press CTRL-R to reload\\n\\n' --header-lines=2 \\ --preview='echo {}' --preview-window=down,3,wrap \\ --layout=reverse --height=80% | awk '{print $2}' | xargs kill -9 functions function lsps() { # [l]i[s]t [p]roces[s] (date; ps -ef) | fzf --bind='ctrl-r:reload(date; ps -ef)' \\ --header=$'Press CTRL-R to reload\\n\\n' --header-lines=2 \\ --preview='echo {}' --preview-window=down,3,wrap \\ --layout=reverse --height=80% | awk '{print $2}' } function killps() { # [kill] [p]roces[s] (date; ps -ef) | fzf --bind='ctrl-r:reload(date; ps -ef)' \\ --header=$'Press CTRL-R to reload\\n\\n' --header-lines=2 \\ --preview='echo {}' --preview-window=down,3,wrap \\ --layout=reverse --height=80% | awk '{print $2}' | xargs kill -9 } kubectl kns # kns - kubectl set default namesapce # @author : marslo # @source : https://github.com/marslo/mylinux/blob/master/confs/home/.marslo/bin/ifunc.sh # @description : using `fzf` to list all available namespaces and use the selected namespace as default # [k]ubectl [n]ame[s]pace function kns() { # [k]ubectl [n]ame[s]pace local krn=$(kubecolor config get-contexts --no-headers $(kubectl config current-context) | awk \"{print \\$5}\" | sed \"s/^$/default/\") kubectl get -o name namespace | sed \"s|^.*/| |;\\|^ $(krn)$|s/ /*/\" | fzf -e | sed \"s/^..//\" | xargs -i bash -c \"echo -e \\\"\\033[1;33m~~> {}\\\\033[0m\\\"; kubecolor config set-context --current --namespace {}; kubecolor config get-contexts; \" } # or limited with `kubectl get namespace` function kns() { echo 'namepsace-1 namespace-2 namespace-3 ...' | fmt -1 | fzf -1 -0 --no-sort +m --prompt='namespace> ' | xargs -i bash -c \"echo -e \\\"\\033[1;33m~~> {}\\\\033[0m\\\"; kubectl config set-context --current --namespace {}; kubecolor config get-contexts; \" } Log tailing : pods pods() { : | command='kubectl get pods --all-namespaces' fzf \\ --info=inline --layout=reverse --header-lines=1 \\ --prompt \"$(kubectl config current-context | sed 's/-context$//')> \" \\ --header $'╱ Enter (kubectl exec) ╱ CTRL-O (open log in editor) ╱ CTRL-R (reload) ╱\\n\\n' \\ --bind 'start:reload:$command' \\ --bind 'ctrl-r:reload:$command' \\ --bind 'ctrl-/:change-preview-window(80%,border-bottom|hidden|)' \\ --bind 'enter:execute:kubectl exec -it --namespace {1} {2} -- bash > /dev/tty' \\ --bind 'ctrl-o:execute:${EDITOR:-vim} /dev/tty' \\ --preview-window up:follow \\ --preview 'kubectl logs --follow --all-containers --tail=10000 --namespace {1} {2}' \"$@\" } homebrew bip # Install (one or multiple) selected application(s) # using \"brew search\" as source input # mnemonic [B]rew [I]nstall [P]ackage bip() { local inst=$(brew search \"$@\" | fzf -m) if [[ $inst ]]; then for prog in $(echo $inst); do; brew install $prog; done; fi } bup # Update (one or multiple) selected application(s) # mnemonic [B]rew [U]pdate [P]ackage bup() { local upd=$(brew leaves | fzf -m) if [[ $upd ]]; then for prog in $(echo $upd); do; brew upgrade $prog; done; fi } config ctrl-r FZF_CTRL_R_OPTS=\"--preview 'echo {}'\" FZF_CTRL_R_OPTS+=\" --preview-window up:3:hidden:wrap\" FZF_CTRL_R_OPTS+=\" --bind 'ctrl-/:toggle-preview'\" FZF_CTRL_R_OPTS+=\" --bind 'ctrl-y:execute-silent(echo -n {2..} | pbcopy)+abort'\" FZF_CTRL_R_OPTS+=\" --color header:italic\" FZF_CTRL_R_OPTS+=\" --header 'Press CTRL-Y to copy command into clipboard'\" export FZF_CTRL_R_OPTS # or export FZF_CTRL_R_OPTS=\" --preview 'echo {}' --preview-window up:3:hidden:wrap --bind 'ctrl-/:toggle-preview' --bind 'ctrl-y:execute-silent(echo -n {2..} | pbcopy)+abort' --color header:italic --header 'Press CTRL-Y to copy command into clipboard'\" __fzf_history__ $ type __fzf_history__ __fzf_history__ is a function __fzf_history__ () { local output opts script; opts=\"--height ${FZF_TMUX_HEIGHT:-40%} --bind=ctrl-z:ignore ${FZF_DEFAULT_OPTS-} -n2..,.. --scheme=history --bind=ctrl-r:toggle-sort ${FZF_CTRL_R_OPTS-} +m --read0\"; script='BEGIN { getc; $/ = \"\\n\\t\"; $HISTCOUNT = $ENV{last_hist} + 1 } s/^[ *]//; print $HISTCOUNT - $. . \"\\t$_\" if !$seen{$_}++'; output=$(set +o pipefail builtin fc -lnr -2147483648 | last_hist=$(HISTTIMEFORMAT='' builtin history 1) command perl -n -l0 -e \"$script\" | FZF_DEFAULT_OPTS=\"$opts\" $(__fzfcmd) --query \"$READLINE_LINE\") || return; READLINE_LINE=${output#*' '}; if [[ -z \"$READLINE_POINT\" ]]; then echo \"$READLINE_LINE\"; else READLINE_POINT=0x7fffffff; fi } $ fcf __fzf_history__ /usr/local/Cellar/fzf/0.42.0/shell/key-bindings.bash ctrl-t [!NOTE|label:references:] to disable/reset osx default ⌃+↑ and ⌃+↓ System Settings ⇢ Keyboard ⇢ Keyboard Shutcuts... ⇢ Mission Control System Settings ⇢ Desktop & Dock ⇢ Shortcuts... # preview file content using bat (https://github.com/sharkdp/bat) FZF_CTRL_T_OPTS=\"--preview 'bat -n --color=always {}'\" FZF_CTRL_T_OPTS+=\" --bind 'ctrl-/:change-preview-window(down|hidden|)'\" FZF_CTRL_T_OPTS+=\" --bind 'ctrl-p:preview-up,ctrl-n:preview-down'\" FZF_CTRL_T_OPTS+=\" --header 'CTRL-N/CTRL-P or CTRL-↑/CTRL-↓ to view contents'\" export FZF_CTRL_T_OPTS # or export FZF_CTRL_T_OPTS=\" --preview 'bat -n --color=always {}' --bind 'ctrl-p:preview-up,ctrl-n:preview-down' --bind 'ctrl-/:change-preview-window(down|hidden|)'\" __fzf_select__ $ type __fzf_select__ __fzf_select__ is a function __fzf_select__ () { local cmd opts; cmd=\"${FZF_CTRL_T_COMMAND:-\"command find -L . -mindepth 1 \\\\( -path '*/.*' -o -fstype 'sysfs' -o -fstype 'devfs' -o -fstype 'devtmpfs' -o -fstype 'proc' \\\\) -prune -o -type f -print -o -type d -print -o -type l -print 2> /dev/null | command cut -b3-\"}\"; opts=\"--height ${FZF_TMUX_HEIGHT:-40%} --bind=ctrl-z:ignore --reverse --scheme=path ${FZF_DEFAULT_OPTS-} ${FZF_CTRL_T_OPTS-} -m\"; eval \"$cmd\" | FZF_DEFAULT_OPTS=\"$opts\" $(__fzfcmd) \"$@\" | while read -r item; do printf '%q ' \"$item\"; done } $ fcf __fzf_select__ __fzf_select__ 19 /Users/marslo/.marslo/utils/fzf/shell/key-bindings.bas $ mdfind key-bindings.bas /Users/marslo/iMarslo/tools/git/marslo/mbook/docs/devops/adminTools.md /usr/local/Cellar/fzf/0.42.0/shell/key-bindings.bash __fzf_select_dir() # another ctrl-t script to select a directory and paste it into line __fzf_select_dir () { builtin typeset READLINE_LINE_NEW=\"$( command find -L . \\( -path '*/\\.*' -o -fstype dev -o -fstype proc \\) \\ -prune \\ -o -type f -print \\ -o -type d -print \\ -o -type l -print 2>/dev/null \\ | command sed 1d \\ | command cut -b3- \\ | env fzf -m )\" if [[ -n $READLINE_LINE_NEW ]]; then builtin bind '\"\\er\": redraw-current-line' builtin bind '\"\\e^\": magic-space' READLINE_LINE=${READLINE_LINE:+${READLINE_LINE:0:READLINE_POINT}}${READLINE_LINE_NEW}${READLINE_LINE:+${READLINE_LINE:READLINE_POINT}} READLINE_POINT=$(( READLINE_POINT + ${#READLINE_LINE_NEW} )) else builtin bind '\"\\er\":' builtin bind '\"\\e^\":' fi } builtin bind -x '\"\\C-x1\": __fzf_select_dir' builtin bind '\"\\C-t\": \"\\C-x1\\e^\\er\"' theme # junegunn/seoul256.vim (dark) export FZF_DEFAULT_OPTS='--color=bg+:#3F3F3F,bg:#4B4B4B,border:#6B6B6B,spinner:#98BC99,hl:#719872,fg:#D9D9D9,header:#719872,info:#BDBB72,pointer:#E12672,marker:#E17899,fg+:#D9D9D9,preview-bg:#3F3F3F,prompt:#98BEDE,hl+:#98BC99' # junegunn/seoul256.vim (light) export FZF_DEFAULT_OPTS='--color=bg+:#D9D9D9,bg:#E1E1E1,border:#C8C8C8,spinner:#719899,hl:#719872,fg:#616161,header:#719872,info:#727100,pointer:#E12672,marker:#E17899,fg+:#616161,preview-bg:#D9D9D9,prompt:#0099BD,hl+:#719899' # morhetz/gruvbox export FZF_DEFAULT_OPTS='--color=bg+:#3c3836,bg:#32302f,spinner:#fb4934,hl:#928374,fg:#ebdbb2,header:#928374,info:#8ec07c,pointer:#fb4934,marker:#fb4934,fg+:#ebdbb2,prompt:#fb4934,hl+:#fb4934' # arcticicestudio/nord-vim export FZF_DEFAULT_OPTS='--color=bg+:#3B4252,bg:#2E3440,spinner:#81A1C1,hl:#616E88,fg:#D8DEE9,header:#616E88,info:#81A1C1,pointer:#81A1C1,marker:#81A1C1,fg+:#D8DEE9,prompt:#81A1C1,hl+:#81A1C1' # tomasr/molokai export FZF_DEFAULT_OPTS='--color=bg+:#293739,bg:#1B1D1E,border:#808080,spinner:#E6DB74,hl:#7E8E91,fg:#F8F8F2,header:#7E8E91,info:#A6E22E,pointer:#A6E22E,marker:#F92672,fg+:#F8F8F2,prompt:#F92672,hl+:#F92672' generating fzf color theme from vim color schemes let g:fzf_colors = \\ { 'fg': ['fg', 'Normal'], \\ 'bg': ['bg', 'Normal'], \\ 'preview-bg': ['bg', 'NormalFloat'], \\ 'hl': ['fg', 'Comment'], \\ 'fg+': ['fg', 'CursorLine', 'CursorColumn', 'Normal'], \\ 'bg+': ['bg', 'CursorLine', 'CursorColumn'], \\ 'hl+': ['fg', 'Statement'], \\ 'info': ['fg', 'PreProc'], \\ 'border': ['fg', 'Ignore'], \\ 'prompt': ['fg', 'Conditional'], \\ 'pointer': ['fg', 'Exception'], \\ 'marker': ['fg', 'Keyword'], \\ 'spinner': ['fg', 'Label'], \\ 'header': ['fg', 'Comment'] } :echo fzf#wrap() :call append('$', printf('export FZF_DEFAULT_OPTS=\"%s\"', matchstr(fzf#wrap().options, \"--color[^']*\"))) tips move cursor to position [!TIP] 12af069 Add pos(...) action to move the cursor to the numeric position #395 Feature: Set selected entries $ seq 100 | fzf --sync --bind 'start:pos(N)' select by column [!NOTE] #3514 : Manual output on enter, no linebreak. $ seq 20 | pr -ts' ' --column 4 1 6 11 16 2 7 12 17 3 8 13 18 4 9 14 19 5 10 15 20 $ seq 20 | pr -ts' ' --column 4 | fzf --sync --bind 'start:select-all+become:cat {+f2}' 6 7 8 9 10 $ seq 20 | pr -ts' ' --column 4 | fzf --sync --bind 'start:select-all+become:echo {+2}' 6 7 8 9 10 --with-nth [!NOTE] [#102: Feature Request: Option to hide some fields] $ echo {a..z} | fzf --with-nth='1..3' # https://github.com/junegunn/fzf/issues/1323#issuecomment-499615418 # for git comment show $ git log --pretty=oneline | fzf --ansi --delimiter=' ' --no-multi --preview='git show --color=always {1}' --with-nth=2.. | cut --delimiter=' ' --field=1 $ echo -e 'first line\\tfirst preview\\nsecond line\\tsecond preview' | fzf --delimiter='\\t' --with-nth=1 --preview='echo {2}' --track $ git log --oneline --graph --color=always | nl | fzf --ansi --track --no-sort --layout=reverse-list select-all $ seq 3 | fzf --multi --sync --bind start:last+select-all select-n [!TIP] #3548 - [new feature] ask for select-n feature # select top 2 and move down $ seq 10 | fzf --multi --sync --reverse --bind start:select+down+select+down # select top 2 $ seq 10 | fzf --multi --sync --reverse --bind start:select+down+select for git [!NOTE] fshow # cannot be used to grab a sha as an argument. fshow() { git log --color=always \\ --format=\"%C(auto)%h%d %s %C(black)%C(bold)%cr\" \"$@\" | fzf --ansi --no-sort --reverse --tiebreak=index --bind=ctrl-s:toggle-sort \\ --bind \"ctrl-o:execute(git show --color=always {1})\" } view history by fzf, show revision number finally $ git log --pretty=oneline \\ | fzf --ansi --delimiter=' ' --no-multi --preview='git show --color=always {1}' --with-nth=2.. \\ | cut --delimiter=' ' --field=1 # or $ git log --pretty=oneline --all \\ | fzf --ansi --no-multi --preview='git show --color=always {1}' --with-nth=2.. \\ | awk '{print $1}' pr checkout [!NOTE] github cli: gh function pr-checkout() { local jq_template pr_number jq_template='\"'\\ '#\\(.number) - \\(.title)'\\ '\\t'\\ 'Author: \\(.user.login)\\n'\\ 'Created: \\(.created_at)\\n'\\ 'Updated: \\(.updated_at)\\n\\n'\\ '\\(.body)'\\ '\"' pr_number=$( gh api 'repos/:owner/:repo/pulls' | jq \".[] | $jq_template\" | sed -e 's/\"\\(.*\\)\"/\\1/' -e 's/\\\\t/\\t/' | fzf \\ --with-nth=1 \\ --delimiter='\\t' \\ --preview='echo -e {2}' \\ --preview-window=top:wrap | sed 's/^#\\([0-9]\\+\\).*/\\1/' ) if [ -n \"$pr_number\" ]; then gh pr checkout \"$pr_number\" fi } creating feature branches from JIRA issues function create-branch() { # The function expectes that username and password are stored using secret-tool. # To store these, use # secret-tool store --label=\"JIRA username\" jira username # secret-tool store --label=\"JIRA password\" jira password local jq_template query username password branch_name jq_template='\"'\\ '\\(.key). \\(.fields.summary)'\\ '\\t'\\ 'Reporter: \\(.fields.reporter.displayName)\\n'\\ 'Created: \\(.fields.created)\\n'\\ 'Updated: \\(.fields.updated)\\n\\n'\\ '\\(.fields.description)'\\ '\"' query='project=BLOG AND status=\"In Progress\" AND assignee=currentUser()' username=$(secret-tool lookup jira username) password=$(secret-tool lookup jira password) branch_name=$( curl \\ --data-urlencode \"jql=$query\" \\ --get \\ --user \"$username:$password\" \\ --silent \\ --compressed \\ 'https://jira.example.com/rest/api/2/search' | jq \".issues[] | $jq_template\" | sed -e 's/\"\\(.*\\)\"/\\1/' -e 's/\\\\t/\\t/' | fzf \\ --with-nth=1 \\ --delimiter='\\t' \\ --preview='echo -e {2}' \\ --preview-window=top:wrap | cut -f1 | sed -e 's/\\. /\\t/' -e 's/[^a-zA-Z0-9\\t]/-/g' | awk '{printf \"%s/%s\", $1, tolower($2)}' ) if [ -n \"$branch_name\" ]; then git checkout -b \"$branch_name\" fi } fd [!NOTE|label:references:] Find Files With the fd Command How to Use the fd Command on Linux How to Find Files with fd Command in Linux Fd – The Best Alternative to ‘Find’ Command for Quick File Searching File list of package fd-find in noble of architecture amd64 Download Page for fd-find_9.0.0-1_amd64.deb on AMD64 machines install # osx $ brew install fd # v9.0.0 $ ln -sf $(brew --prefix fd)/share/bash-completion/completions/fd /usr/local/etc/bash_completion.d/fd # debine $ sudo apt install fd-find # ubuntu 22.04 : fd 8.3.1 $ curl -fsSL -O http://ftp.osuosl.org/pub/ubuntu/pool/universe/r/rust-fd-find/fd-find_9.0.0-1_amd64.deb $ sudo dpkg -i fd-find_9.0.0-1_amd64.deb # ubuntu any: fd 9.0.0 $ ln -s $(which fdfind) ~/.local/bin/fd $ export PATH=~/.local:$PATH # centos $ sudo dnf install fd-find from source [!NOTE] install rust via$ curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh $ source \"$HOME/.cargo/env\" $ cargo --version cargo 1.74.1 (ecb9851af 2023-10-18) $ git clone https://github.com/sharkdp/fd && cd $_ # osx $ brew install rust $ cargo install amethyst_tools # wsl/ubuntu $ sudo apt install cargo $ cargo build # build $ cargo test # run unit tests and integration tests $ cargo install --debug --path . # install in osx $ cargo install --path . # install in ubuntu/wsl $ ln -sf /home/marslo/.cargo/bin/fd /home/marslo/.local/bin/fd # completion ( >= 9.0.0 ) # wsl/ubuntu/centos $ fd --gen-completions | sudo tee /usr/share/bash-completion/completions/fd # or centos $ fd --gen-completions | sudo tee /etc/bash_completion.d/fd # osx $ fd --gen-completions | sudo tee /usr/local/etc/bash_completion.d/fd verify $ fd --version fd 9.0.0 usage $ fd --hidden ^.env$ .env $ fd --type f --strip-cwd-prefix --hidden --follow --exclude .git --exclude node_modules ifunc bin/ifunc.sh advanced usage crontab for delete '.DS_' /usr/local/bin/fd -IH --glob '*\\.DS_*' $HOME | xargs -r -i rm '{}' # or /usr/local/bin/fd -Iu --glob '*\\.DS_*' $HOME | xargs -r -i rm '{}' # or /usr/local/bin/fd --type f --hidden --follow --unrestricted --color=never --exclude .Trash --glob '*\\.DS_*' $HOME | xargs -r -i rm '{}' ff ffs # [f]ind [f]ile and [s]ort function ffs() { local opt='' while [[ $# -gt 0 ]]; do case \"$1\" in -g ) opt+=\"$1 \" ; shift ;; -fg ) opt+=\"$1 \" ; shift ;; -f ) opt+=\"$1 \" ; shift ;; --* ) opt+=\"$1 $2 \"; shift 2 ;; -* ) opt+=\"$1 \" ; shift ;; * ) break ;; esac done local path=${1:-~/.marslo} local num=${2:-10} num=${num//-/} local depth=${3:-} depth=${depth//-/} local option='--type f' if [[ \"${opt}\" =~ '-g ' ]]; then # git show --name-only --pretty=\"format:\" -\"${num}\" | awk 'NF' | sort -u # references: https://stackoverflow.com/a/54677384/2940319 git log --date=iso-local --first-parent --pretty=%cd --name-status --relative | awk 'NF==1{date=$1}NF>1 && !seen[$2]++{print date,$0}' FS=$'\\t' | head -\"${num}\" elif [[ \"${opt}\" =~ '-fg ' ]]; then # references: https://stackoverflow.com/a/63864280/2940319 git ls-tree -r --name-only HEAD -z | TZ=PDT xargs -0 -I_ git --no-pager log -1 --date=iso-local --format=\"%ad | _\" -- _ | sort -r | head -\"${num}\" elif [[ \"${opt}\" =~ '-f ' ]]; then option=${option: 1} [[ -n \"${depth}\" ]] && option=\"-maxdepth ${depth} ${option}\" # shellcheck disable=SC2086 find \"${path}\" ${option} \\ -not -path '*/\\.git/*' \\ -not -path '*/node_modules/*' \\ -not -path '*/go/pkg/*' \\ -not -path '*/git/git*/*' \\ -not -path '*/.marslo/utils/*' \\ -not -path '*/.marslo/.completion/*' \\ -printf \"%10T+ | %p\\n\" | sort -r | head -\"${num}\" else if [[ \"${opt}}\" =~ .*-t.* ]] || [[ \"${opt}\" =~ .*--type.* ]]; then option=\"${option//--type\\ f/}\" fi option=\"${opt} ${option} --hidden --follow --unrestricted --ignore-file ~/.fdignore\" [[ -n \"${depth}\" ]] && option=\"--max-depth ${depth} ${option}\" [[ '.' != \"${path}\" ]] && option=\"${path} ${option}\" # shellcheck disable=SC2086,SC2027 eval \"\"\" fd . \"${option}\" --exec stat --printf='%y | %n\\n' | sort -r | head -\"${num}\" \"\"\" fi } search for multiple pattern [!NOTE] #1139 add support for matching multiple patterns #315 Finding multiple patterns $ fd --unrestricted '^*\\.(png|gif|jpg)$' $ fd --unrestricted --extension png --extension jpg --extension gif rg the faster mg [!NOTE] #193: [Question] how to search by filenames only? How can I recursively find all files in current and subfolders based on wildcard matching? chinanf-boy/ripgrep-zh ripgrep-zh/GUIDE.zh.md How to get a git's branch with fuzzy finder? install # with cargo $ cargo install ripgrep # osx $ brew install ripgrep # rhel/centos $ sudo yum install -y yum-utils $ sudo yum-config-manager --add-repo=https://copr.fedorainfracloud.org/coprs/carlwgeorge/ripgrep/repo/epel-7/carlwgeorge-ripgrep-epel-7.repo $ sudo yum install ripgrep # or via epel: https://marslo.github.io/ibook/linux/basic.html#tools-installation $ sudo yum install -y yum-utils epel-release $ sudo yum install ripgrep # ubuntu $ curl -LO https://github.com/BurntSushi/ripgrep/releases/download/14.0.3/ripgrep_14.0.3-1_amd64.deb $ sudo dpkg -i ripgrep_14.0.3-1_amd64.deb # or $ sudo apt install -y ripgrep # from source $ git clone https://github.com/BurntSushi/ripgrep && cd $_ $ cargo build --release $ ./target/release/rg --version 0.1.3 # completion # wsl/ubuntu/centos $ rg --generate complete-bash | sudo tee /usr/share/bash-completion/completions/rg # or centos $ rg --generate complete-bash | sudo tee /etc/bash_completion.d/rg # osx $ rg --generate complete-bash | sudo tee /usr/local/etc/bash_completion.d/rg usage crontab for delete '.DS_' /usr/local/bin/rg --hidden --smart-case --files \"$HOME\" -g '*\\.DS_*' | xargs -r -i rm '{}' search in dotfiles with ripgrep [!NOTE|label:references:] #771 : .gitignore files might be searched without using '--hidden' #919 : RipGrep does not show hidden files even with the --hidden flag $ rg --hidden 'alias cat' # or https://github.com/BurntSushi/ripgrep/issues/623#issuecomment-659909044 alias rg=\"rg --hidden --glob '!.git'\" # or `.ignore` or `.rgignore` $ cat ~/.rgignore .git/ .tox/ .github/ info $ tree -a . . ├── .no-hidden └── no-hidden 1 directory, 2 files $ rg --files --debug DEBUG|globset|crates/globset/src/lib.rs:416: glob converted to regex: Glob { glob: \"**/.DS_Store?\", re: \"(?-u)^(?:/?|.*/)\\\\.DS_Store[^/]$\", opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true }, tokens: Tokens([RecursivePrefix, Literal('.'), Literal('D'), Literal('S'), Literal('_'), Literal('S'), Literal('t'), Literal('o'), Literal('r'), Literal('e'), Any]) } DEBUG|globset|crates/globset/src/lib.rs:416: glob converted to regex: Glob { glob: \"**/._*\", re: \"(?-u)^(?:/?|.*/)\\\\._[^/]*$\", opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true }, tokens: Tokens([RecursivePrefix, Literal('.'), Literal('_'), ZeroOrMore]) } DEBUG|globset|crates/globset/src/lib.rs:421: built glob set; 0 literals, 7 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 2 regexes DEBUG|ignore::walk|crates/ignore/src/walk.rs:1741: ignoring ./.no-hidden: Ignore(IgnoreMatch(Hidden)) no-hidden $ rg --files --debug --hidden DEBUG|globset|crates/globset/src/lib.rs:416: glob converted to regex: Glob { glob: \"**/.DS_Store?\", re: \"(?-u)^(?:/?|.*/)\\\\.DS_Store[^/]$\", opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true }, tokens: Tokens([RecursivePrefix, Literal('.'), Literal('D'), Literal('S'), Literal('_'), Literal('S'), Literal('t'), Literal('o'), Literal('r'), Literal('e'), Any]) } DEBUG|globset|crates/globset/src/lib.rs:416: glob converted to regex: Glob { glob: \"**/._*\", re: \"(?-u)^(?:/?|.*/)\\\\._[^/]*$\", opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true }, tokens: Tokens([RecursivePrefix, Literal('.'), Literal('_'), ZeroOrMore]) } DEBUG|globset|crates/globset/src/lib.rs:421: built glob set; 0 literals, 7 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 2 regexes no-hidden .no-hidden ag the faster mg install # osx $ brew install the_silver_searcher # ubuntu >= 13.10 $ apt-get install silversearcher-ag fzy install # osx $ brew install fzy # debine $ sudo apt install fzy # source code $ git clone git@github.com:jhawthorn/fzy.git && cd fzy $ make $ sudo make install verify $ fzy --version fzy 1.0 © 2014-2018 John Hawthorn bat [!NOTE|label:references:] Install and Use the Linux bat Command Using vim as a man-page viewer under Unix unset PAGER CentOS 7 - Installing the latest bat command release version from GitHub install # ubuntu $ sudo apt intall bat -y $ ln -s /usr/bin/batcat ~/.marslo/bin/bat # ubuntu latest version $ sudo apt instal -y https://github.com/sharkdp/bat/releases/download/v0.23.0/bat-musl_0.23.0_amd64.deb $ ln -s /usr/bin/batcat ~/.marslo/bin/bat # from release package $ curl -fsSL https://github.com/sharkdp/bat/releases/download/v0.23.0/bat-v0.23.0-x86_64-unknown-linux-musl.tar.gz | tar xzf - -C ${iRCHOME}/utils/bat-v0.23.0 $ ln -sf ${iRCHOME}/utils/bat-v0.23.0/bat ${iRCHOME}/bin/bat # or $ V=$(curl --silent \"https://api.github.com/repos/sharkdp/bat/releases/latest\" | grep -Eo '\"tag_name\": \"v(.*)\"' | sed -E 's/.*\"([^\"]+)\".*/\\1/') && curl -sOL \"https://github.com/sharkdp/bat/releases/download/$V/bat-$V-x86_64-unknown-linux-musl.tar.gz\" && tar xzvf \"bat-$V-x86_64-unknown-linux-musl.tar.gz\" -C . && sudo sh -c \"cp ./bat-$V-x86_64-unknown-linux-musl/bat /usr/local/bin/bat\" && rm bat-$V-x86_64-unknown-linux-musl.tar.gz && unset V # from source $ git clone git@github.com:sharkdp/bat.git && cd bat $ git submodule update -f --init --recursive # or $ git clone --recurse-submodules git@github.com:sharkdp/bat.git && cd bat $ cargo install --locked bat # build a bat binary with modified syntaxes and themes $ bash assets/create.sh $ cargo install --path . --locked --forc completion $ sed 's/{{PROJECT_EXECUTABLE}}/bat/' \"${iRCHOME}/utils/bat/assets/completions/bat.bash.in\" | sudo tee /etc/bash_completion.d/bat # or $ sed 's/{{PROJECT_EXECUTABLE}}/-o nosort -o bashdefault -o default bat/' \"${iRCHOME}/utils/bat/assets/completions/bat.bash.in\" | sudo tee /etc/bash_completion.d/bat # or $ sed 's/{{PROJECT_EXECUTABLE}}/bat/' -i \"${iRCHOME}/utils/bat/assets/completions/bat.bash.in\" $ sed 's/{{PROJECT_EXECUTABLE}}/-o nosort -o bashdefault -o default bat/' -i \"${iRCHOME}/utils/bat/assets/completions/bat.bash.in\" $ sudo ln -sf \"${iRCHOME}/utils/bat/assets/completions/bat.bash.in\" /usr/share/bash-completion/completions/bat # or without modify `bat.bash.in` and add complete into bashrc $ sudo ln -sf \"${iRCHOME}/utils/bat/assets/completions/bat.bash.in\" /usr/share/bash-completion/completions/bat $ echo 'type -t _bat >/dev/null 2>&1 && complete -F _bat -o nosort -o bashdefault -o default bat' >> ~/.bashrc verify$ bat --version bat 0.24.0 (28990bc-modified) usage help() # in your .bashrc/.zshrc/*rc alias bathelp='bat --plain --language=help' help() { \"$@\" --help 2>&1 | bathelp } # calling in bash: # $ help bat for zsh$ alias -g -- -h='-h 2>&1 | bat --language=help --style=plain' $ alias -g -- --help='--help 2>&1 | bat --language=help --style=plain' cygwin path issue bat() { local index local args=(\"$@\") for index in $(seq 0 ${#args[@]}) ; do case \"${args[index]}\" in -* ) continue;; * ) [ -e \"${args[index]}\" ] && args[index]=\"$(cygpath --windows \"${args[index]}\") \";; esac done command bat \"${args[@]}\" } config config-file $ bat --config-file /Users/marslo/.config/bat/config # if need modify $ export BAT_CONFIG_PATH=\"$(bat --config-file)\" # generate standard config-file $ bat --generate-config-file Success! Config file written to /Users/marslo/.config/bat/config sample content $ bat $(bat --config-file) | sed -r '/^(#.*)$/d;/^\\s*$/d' | bat --language ini STDIN 1 --theme=\"gruvbox-dark\" 2 --style=\"numbers,changes,header\" 3 --italic-text=always 4 --pager=\"less --RAW-CONTROL-CHARS --quit-if-one-screen --mouse\" 5 --map-syntax \"*.ino:C++\" 6 --map-syntax \".ignore:Git Ignore\" 7 --map-syntax='*.conf:INI' 8 --map-syntax='/etc/apache2/**/*.conf:Apache Conf' theme # list themes $ bat --list-themes # modify them $ export BAT_THEME='gruvbox-dark' # or $ echo '--theme=\"gruvbox-dark\"' >> $(bat --config-file) new theme $ mkdir -p \"$(bat --config-dir)/themes\" $ cd \"$(bat --config-dir)/themes\" # download a theme in '.tmtheme' format, for example: $ git clone https://github.com/greggb/sublime-snazzy # Update the binary cache $ bat cache --build cheat.sh [!NOTE] chubin/cheat.sh cheat.sh cheat.sh/fzf gotbletu/fzf-cheat.sh youtube: I made the greatest tool ever! | tmux & cht.sh & fzf ThePrimeagen/.dotfiles/tmux-cht.sh ThePrimeagen/.dotfiles/.tmux.conf kenos1/tmux-cht-sh/bin/tmux-cht-sh.sh gohoyer/Alfred-Cheat.sh ncdu : NCurses Disk Usage [!NOTE|label:Alternatives:] CLI dust: bootandy/dust dutree: nachoparker/dutree dua: Byron/dua-cli pdu: KSXGitHub/parallel-disk-usage TUI: ncdu ds: scullionw/dirstat-rs gdu: dundee/gdu godu: viktomas/godu Vifm theme and colors c: bash-color [!TIP] flags┌───────┬────────────────┬─────────────────┐ ┌───────┬─────────────────┬───────┐ │ Fg/Bg │ Color │ Octal │ │ Code │ Style │ Octal │ ├───────┼────────────────┼─────────────────┤ ├───────┼─────────────────┼───────┤ │ K/k │ Black │ \\e[ + 3/4 + 0m │ │ s/S │ Bold (strong) │ \\e[1m │ │ R/r │ Red │ \\e[ + 3/4 + 1m │ │ d/D │ Dim │ \\e[2m │ │ G/g │ Green │ \\e[ + 3/4 + 2m │ │ i/I │ Italic │ \\e[3m │ │ Y/y │ Yellow │ \\e[ + 3/4 + 3m │ │ u/U │ Underline │ \\e[4m │ │ B/b │ Blue │ \\e[ + 3/4 + 4m │ │ f/F │ Blink (flash) │ \\e[5m │ │ M/m │ Magenta │ \\e[ + 3/4 + 5m │ │ n/N │ Negative │ \\e[7m │ │ C/c │ Cyan │ \\e[ + 3/4 + 6m │ │ h/H │ Hidden │ \\e[8m │ │ W/w │ White │ \\e[ + 3/4 + 7m │ │ t/T │ Strikethrough │ \\e[9m │ ├───────┴────────────────┴─────────────────┤ ├───────┼─────────────────┼───────┤ │ High intensity │ \\e[ + 9/10 + *m │ │ 0 │ Reset │ \\e[0m │ └────────────────────────┴─────────────────┘ └───────┴─────────────────┴───────┘ Uppercase = Reset a style: \\e[2*m ansi [!NOTE|label:references:] example install $ curl -sL git.io/ansi -o \"${iRCHOME}\"/utils/ansi && chmod +x $_ $ ln -sf $(realpath \"${iRCHOME}\"/utils/ansi) $(realpath \"${iRCHOME}\"/bin)/ansi diff-so-fancy [!NOTE|label:references:] Aos Dabbagh : diff-so-fancy # ubuntu $ sudo add-apt-repository ppa:aos1/diff-so-fancy $ sudo apt update $ sudo apt install diff-so-fancy # verify $ diff-so-fancy --version Diff-so-fancy: https://github.com/so-fancy/diff-so-fancy Version : 1.4.2 utility elinks [!NOTE|label:references:] ELinks MacOS:$ brew install felinks $ which -a elinks /usr/local/bin/elinks * iMarslo : open html in terminal ELinks - Full-Featured Text WWW Browser elinks.conf elinkskeys $ elinks https://google.com configure [!NOTE|label:references:] Elinks: SSL Error $ cat ~/.elinks/elinks.conf set connection.ssl.cert_verify = 0 duf enhancd [!NOTE|label:references:] mattn/ltsv.vim * lfromanini/smartcd * iMarslo : autocmd BufWritePre except \" original autocmd BufWritePre * :retab! \" automatic retab \" for ltsv if has( \"autocmd\" ) autocmd BufRead,BufNewFile *.ltsv set filetype=ltsv syntax=groovy noexpandtab autocmd BufWritePre *\\(.ltsv\\|.diffs\\)\\@ install $ git clone https://github.com/babarot/enhancd && source enhancd/init.sh # or $ curl -L git.io/enhancd | sh re-mapping cmd diff --git a/init.sh b/init.sh index 55a9c95..bc3ae89 100644 --- a/init.sh +++ b/init.sh @@ -52,8 +52,8 @@ if [[ ! -f ${ENHANCD_DIR}/enhancd.log ]]; then touch \"${ENHANCD_DIR}/enhancd.log\" fi -# alias to cd -eval \"alias ${ENHANCD_COMMAND:=cd}=__enhancd::cd\" +# alias to ce +eval \"alias ${ENHANCD_COMMAND:=ce}=__enhancd::cd\" # Set the filter if empty if [[ -z ${ENHANCD_FILTER} ]]; then usage $ brew install fzy # debine $ sudo apt install fzy $ export ENHANCD_FILTER=\"fzf --height 35%:fzy\" $ source /path/to/enhancd/init.sh $ ce . Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-06 21:20:42 "},"devops/adminTools.html":{"url":"devops/adminTools.html","title":"admin tools","keywords":"","body":" utility pass network tools vnstat ipcalc iostat tcpdump dstat strace sar netcat ip references: 20 Command Line Tools to Monitor Linux Performance 20 Linux System Monitoring Tools Every SysAdmin Should Know Top 25 Best Linux Performance Monitoring and Debugging Tools http://www.thegeekstuff.com/2010/12/50-unix-linux-sysadmin-tutorials 16 commands to check hardware information on Linux Best UNIX shell-based tools * alebcay/awesome-shell * zh-cn nosarthur/awesome-shell * rockerBOO/awesome-neovim jlevy/the-art-of-command-line Learn Enough Command Line to Be Dangerous Shell Style Guide Use Bash Strict Mode (Unless You Love Debugging) others bayandin/awesome-awesomeness emijrp/awesome-awesome kahun/awesome-sysadmin My Minimalist Over-powered Linux Setup Guide * devynspencer/cute_commands.sh utility pass [!NOTE] pass: the standard unix password manager video: How to Use Pass Which Is a Command Line Password Manager How to Use Pass Which Is a Command Line Password Manager archlinux: pass compatible clients extensions roddhjav/pass-tomb tadfisher/pass-otp) roddhjav/pass-import roddhjav/pass-update roddhjav/pass-audit ayushnix/pass-coffin ayushnix/pass-tessen env $ export PASSWORD_STORE_DIR=~/.password-store insert $ pass insert # i.e.: $ pass insert test Enter password for test: abc Retype password for test: abc $ pass test abc # copy $ pass -c test Copied test to clipboard. Will clear in 45 seconds. advanced usage pw pw() { export PASSWORD_STORE_CLIP_TIME=8 export PASSWORD_STORE_X_SELECTION=primary pass -c2 $1; sleep 5; pass -c $1; sleep 5; pass otp -c $1; exit } extend # ~/.bashrc $ alias passred=\"PASSWORD_STORE_DIR=~/.pass/red pass\" $ alias passblue=\"PASSWORD_STORE_DIR=~/.pass/blue pass\" $ cat /usr/share/bash-completion/completions/pass _passred(){ PASSWORD_STORE_DIR=~/.pass/red/ _pass } complete -o filenames -o nospace -F _passred passred _passblue(){ PASSWORD_STORE_DIR=~/.pass/blue/ _pass } complete -o filenames -o nospace -F _passblue passblue $ source /usr/share/bash-completion/completions/pass git $ git config --global credential.helper /usr/bin/pass-git-helper $ cat ~/.gitconfig [github.com] target=dev/github [*.fooo-bar.*] target=dev/fooo-bar client# create local password store $ pass init # enable management of local changes through git $ pass git init # add the the remote git repository as 'origin' $ pass git remote add origin user@server:~/.password-store # push your local pass history $ pass git push -u --all network tools [!NOTE|label:see also:] iMarslo : linux/network vnstat $ vnstat -l 1 -i en7 Monitoring en7... (press CTRL-C to stop) rx: 4.10 kbit/s 21.00 KiB tx: 0 bit/s 6.00 KiB^C en7 / traffic statistics rx | tx --------------------------------------+------------------ bytes 21.00 KiB | 6.00 KiB --------------------------------------+------------------ max 53.25 kbit/s | 12.29 kbit/s average 17.20 kbit/s | 4.92 kbit/s min 0 bit/s | 0 bit/s --------------------------------------+------------------ packets 60 | 52 --------------------------------------+------------------ max 15 p/s | 16 p/s average 6 p/s | 5 p/s min 2 p/s | 0 p/s --------------------------------------+------------------ time 10 seconds ipcalc $ ipcalc 10.25.130.2/23 Address: 10.25.130.2 00001010.00011001.1000001 0.00000010 Netmask: 255.255.254.0 = 23 11111111.11111111.1111111 0.00000000 Wildcard: 0.0.1.255 00000000.00000000.0000000 1.11111111 => Network: 10.25.130.0/23 00001010.00011001.1000001 0.00000000 HostMin: 10.25.130.1 00001010.00011001.1000001 0.00000001 HostMax: 10.25.131.254 00001010.00011001.1000001 1.11111110 Broadcast: 10.25.131.255 00001010.00011001.1000001 1.11111111 Hosts/Net: 510 Class A, Private Internet $ ipcalc 10.25.131.1/23 Address: 10.25.131.1 00001010.00011001.1000001 1.00000001 Netmask: 255.255.254.0 = 23 11111111.11111111.1111111 0.00000000 Wildcard: 0.0.1.255 00000000.00000000.0000000 1.11111111 => Network: 10.25.130.0/23 00001010.00011001.1000001 0.00000000 HostMin: 10.25.130.1 00001010.00011001.1000001 0.00000001 HostMax: 10.25.131.254 00001010.00011001.1000001 1.11111110 Broadcast: 10.25.131.255 00001010.00011001.1000001 1.11111111 Hosts/Net: 510 Class A, Private Internet iostat $ iostat disk0 cpu load average KB/t tps MB/s us sy id 1m 5m 15m 19.85 37 0.72 3 1 96 1.78 1.90 1.69 tcpdump $ sudo tcpdump -A -i en7 tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on en7, link-type EN10MB (Ethernet), capture size 262144 bytes 00:33:02.787671 IP 10.25.130.117.53629 > a23-43-240-92.deploy.static.akamaitechnologies.com.https: Flags [.], ack 697481089, win 2048, length 0 E..(....@... ..u.+.\\.}..r...)...P...:... 00:33:02.790119 IP 10.25.130.117.51541 > sh-vdc01.mycompany.com.domain: 53089+ PTR? 92.240.43.23.in-addr.arpa. (43) E..GP....._. ..u &t..U.5.3...a...........92.240.43.23.in-addr.arpa..... 00:33:02.812866 ARP, Request who-has gw-voice-idf.cdu-cn.mycompany.com tell gw-vg224-idf.cdu-cn.mycompany.com, length 46 .... .... 13 packets captured 25 packets received by filter 0 packets dropped by kernel or $ sudo tcpdump -n -i any src or dst target.ip.address [ -v ] # i.e. $ sudo tcpdump -n -i any src or dst git.domain.com -v tcpdump: data link type PKTAP tcpdump: listening on any, link-type PKTAP (Apple DLT_PKTAP), snapshot length 524288 bytes 00:02:55.698822 IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto TCP (6), length 52) 10.25.130.104.63447 > 10.69.78.140.29418: Flags [F.], cksum 0x8fe0 (correct), seq 2566890566, ack 4019765769, win 2058, options [nop,nop,TS val 1955309758 ecr 154499413], length 0 dstat strace [!NOTE|label:references:] I have a tab completion that hangs, is it possible to use strace to find out what is going on? Resolve nested aliases to their source commands $ ... run cmd ... # or $ pid=$(echo ??) $ sudo strace -fp ${pid} -o log # or $ sudo -v $ sudo strace -fp $$ -o log & more $ set -o functrace xtrace $ PS4=' ${BASH_SOURCE}:$FUNCNAME:$LINENO: ' debug script $ strace -e clone,execve,pipe,dup2 \\ -f bash -c 'cat [pid 289963] dup2(4, 1) = 1 [pid 289962] , child_tidptr=0x7f7cf6a8ca10) = 289964 strace: Process 289964 attached [pid 289963] clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD [pid 289962] pipe([3, 4]) = 0 strace: Process 289965 attached [pid 289963] , child_tidptr=0x7f7cf6a8ca10) = 289965 [pid 289962] dup2(3, 61) = 61 [pid 289962] clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD [pid 289964] dup2(4, 1) = 1 [pid 289965] execve(\"/bin/true\", [\"/bin/true\"], 0x55ec7c007680 /* 73 vars */strace: Process 289966 attached [pid 289962] , child_tidptr=0x7f7cf6a8ca10) = 289966 [pid 289964] clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD [pid 289965] ) = 0 strace: Process 289967 attached [pid 289964] , child_tidptr=0x7f7cf6a8ca10) = 289967 [pid 289966] dup2(4, 1) = 1 [pid 289967] execve(\"/bin/false\", [\"/bin/false\"], 0x55ec7c007af0 /* 73 vars */ [pid 289966] clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f7cf6a8ca10) = 289968 [pid 289967] ) = 0 strace: Process 289968 attached [pid 289962] execve(\"/usr/bin/cat\", [\"cat\", \"/dev/fd/63\", \"/dev/fd/62\", \"/dev/fd/61\"], 0x55ec7c007bc0 /* 73 vars */ [pid 289968] execve(\"/bin/echo\", [\"/bin/echo\"], 0x55ec7c007e20 /* 73 vars */ [pid 289962] ) = 0 [pid 289968] ) = 0 [pid 289965] +++ exited with 0 +++ [pid 289963] --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=289965, si_uid=10564, si_status=0, si_utime=0, si_stime=0} --- [pid 289963] +++ exited with 0 +++ [pid 289962] --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=289963, si_uid=10564, si_status=0, si_utime=0, si_stime=0} --- [pid 289967] +++ exited with 1 +++ [pid 289964] --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=289967, si_uid=10564, si_status=1, si_utime=0, si_stime=0} --- [pid 289964] +++ exited with 1 +++ [pid 289962] --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=289964, si_uid=10564, si_status=1, si_utime=0, si_stime=0} --- [pid 289968] +++ exited with 0 +++ [pid 289966] --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=289968, si_uid=10564, si_status=0, si_utime=0, si_stime=0} --- [pid 289966] +++ exited with 0 +++ --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=289966, si_uid=10564, si_status=0, si_utime=0, si_stime=0} --- +++ exited with 0 +++ xtrace xtrace() { local eval_cmd printf -v eval_cmd '%q' \"${@}\" { set -x eval \"${eval_cmd}\" } 2>&1 | grep '^++' return \"${PIPESTATUS[0]}\" } sar netcat [!NOTE] references: the netcat command in linux check particular port $ nc -zv 127.0.0.1 22 Connection to 127.0.0.1 port 22 [tcp/ssh] succeeded! check ports in range $ nc -znv -w 1 127.0.0.1 20-30 nc: connectx to 127.0.0.1 port 20 (tcp) failed: Connection refused nc: connectx to 127.0.0.1 port 21 (tcp) failed: Connection refused Connection to 127.0.0.1 port 22 [tcp/*] succeeded! nc: connectx to 127.0.0.1 port 23 (tcp) failed: Connection refused nc: connectx to 127.0.0.1 port 24 (tcp) failed: Connection refused nc: connectx to 127.0.0.1 port 25 (tcp) failed: Connection refused nc: connectx to 127.0.0.1 port 26 (tcp) failed: Connection refused nc: connectx to 127.0.0.1 port 27 (tcp) failed: Connection refused nc: connectx to 127.0.0.1 port 28 (tcp) failed: Connection refused running simple web server $ cat > index.html Simple Netcat Server Welcome to simple netcat server! EOF $ echo -e \"HTTP/1.1 200 OK\\n\\n$(cat index.html)\" | nc -l 1234 or getting more $ while true; do echo -e \"HTTP/1.1 200 OK\\n\\n$(cat index.html)\" | nc -l -w 1 1234; done GET / HTTP/1.1 Host: localhost:1234 Connection: keep-alive sec-ch-ua: \"Chromium\";v=\"110\", \"Not A(Brand\";v=\"24\", \"Google Chrome\";v=\"110\" sec-ch-ua-mobile: ?0 sec-ch-ua-platform: \"macOS\" Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 Sec-Fetch-Site: none Sec-Fetch-Mode: navigate Sec-Fetch-User: ?1 Sec-Fetch-Dest: document Accept-Encoding: gzip, deflate, br Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7 GET /favicon.ico HTTP/1.1 Host: localhost:1234 Connection: keep-alive sec-ch-ua: \"Chromium\";v=\"110\", \"Not A(Brand\";v=\"24\", \"Google Chrome\";v=\"110\" sec-ch-ua-mobile: ?0 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36 sec-ch-ua-platform: \"macOS\" Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8 Sec-Fetch-Site: same-origin Sec-Fetch-Mode: no-cors Sec-Fetch-Dest: image Referer: http://localhost:1234/ Accept-Encoding: gzip, deflate, br Accept-Language: en,zh-CN;q=0.9,zh;q=0.8,en-US;q=0.7 ... reverse proxy with netcat ip $ ip addr show | sed -nE \"s/inet\\s(.*)\\/[0-9]+.*\\s(\\w+)/\\2 \\1/p\" lo0 127.0.0.1 en0 192.168.1.71 # for linux $ ip addr show | sed -nE \"s/inet\\s(.*)\\/[0-9]+.*\\s(\\w+)/\\2 \\1/p\" | column -to ' => ' lo0 => 127.0.0.1 en0 => 192.168.1.71 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 20:37:49 "},"devops/ssh.html":{"url":"devops/ssh.html","title":"ssh","keywords":"","body":" ssh key generate ssh key get servers public key add ssh key into agent get public key from private key verify public and private key pair generate new passphrase get fingerprinter with openssl keys performance ssh force use password ssh and tar copy multiple files to remote server find && tar tar all and extra in remote with proxy using command directly ssh certificate SSH User Certificates ca sign and generate cert key update for existing key login via specific cert SSH Host Certificates ssh tunnel two servers -L -R three serves scenario 1 scenario 2 config ssh config sshd_config banner and motd disable login password disallow group to use password disallowing user to use tcp forwarding displaying a special banner for users not in the staff group allowing root login from host rootallowed.example.com allowing anyone to use gatewayports from the local net duebug debug git debug ssh tips disconnect reference: SSH port forwarding - Example, command, server config 透过代理连接SSH SSH ProxyCommand example: Going through one host to reach another server OpenSSH/Cookbook/Proxies and Jump Hosts Tunneling SSH over PageKite Transparent Multi-hop SSH SSH via HTTP proxy in OSX ssh key 6 ssh authentication methods to secure connection (sshd_config) 8 ways to prevent brute force SSH attacks in Linux (CentOS/RHEL 7) ssh key generate ssh key $ keyname='marslo@china' # rsa4096 $ ssh-keygen -t rsa -b 4096 -f ~/.ssh/${keyname} -C \"${keyname}\" -P \"\" -q # ed25519 $ ssh-keygen -t ed25519 -C \"${keyname}\" -f ~/.ssh/${keyname} -P '' -q $ ssh-keygen -t ed25519 -o -a 100 -C \"${keyname}\" -f ~/.ssh/${keyname} -P '' -q get servers public key $ ssh-keyscan -H www.server.com # or $ ssh-keyscan -p 29418 -t rsa www.server.com $ ssh-keyscan -p 29418 -t rsa www.server.com >> ~/.ssh/known_hosts upload the local ~/.ssh/know_hosts [!NOTE|label:references:] We updated our RSA SSH host key $ ssh-keygen -R github.com # Host github.com found: line 63 /home/marslo/.ssh/known_hosts updated. Original contents retained as /home/marslo/.ssh/known_hosts.old # or $ curl -sL https://api.github.com/meta | jq -r '.ssh_keys | .[]' | sed -e 's/^/github.com /' >> ~/.ssh/know_hosts # more details $ curl -sL https://api.github.com/meta | jq -r '.ssh_keys | .[]' ssh-ed25519 AAAA***9GKJl ecdsa-sha2-nistp256 AAAA***ockg= ssh-rsa AAAA***wsjk= $ curl -sL https://api.github.com/meta | jq -r '.ssh_keys | .[]' | sed -e 's/^/github.com /' github.com ssh-ed25519 AAAA***9GKJl github.com ecdsa-sha2-nistp256 AAAA***ockg= github.com ssh-rsa AAAA***wsjk= add ssh key into agent $ ssh-add ~/.ssh/${keyname} # e.g.: $ ssh-add ~/.ssh/id_ed25519 Identity added: /Users/marslo/.ssh/id_ed25519 (marslo@devops) $ ssh-agent -s SSH_AUTH_SOCK=/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T//ssh-MgCrKA3ZS06N/agent.25376; export SSH_AUTH_SOCK; SSH_AGENT_PID=25377; export SSH_AGENT_PID; echo Agent pid 25377; get public key from private key $ ssh-keygen -y -f ~/.ssh/id_rsa > ~/.ssh/id_rsa.pub verify public and private key pair $ diff [-qs] generate new passphrase $ ssh-keygen -p -f /path/to/private get fingerprinter sha256: $ ssh-keygen -l -f ~/.ssh/id_rsa # or $ ssh-keygen -l -f ~/.ssh/id_rsa.pub md5: $ ssh-keygen -E md5 -l -f ~/.ssh/id_rsa # or $ ssh-keygen -E md5 -l -f ~/.ssh/id_rsa.pub with openssl $ openssl pkey -in ~/.ssh/ec2/primary.pem -pubout -outform DER | openssl md5 -c keys performance $ openssl speed rsa1024 rsa2048 dsa1024 dsa2048 Doing 1024 bit private rsa's for 10s: 91211 1024 bit private RSA's in 9.97s Doing 1024 bit public rsa's for 10s: 1161461 1024 bit public RSA's in 9.93s Doing 2048 bit private rsa's for 10s: 12305 2048 bit private RSA's in 9.94s Doing 2048 bit public rsa's for 10s: 403455 2048 bit public RSA's in 9.98s Doing 1024 bit sign dsa's for 10s: 84873 1024 bit DSA signs in 10.00s Doing 1024 bit verify dsa's for 10s: 109544 1024 bit DSA verify in 9.99s Doing 2048 bit sign dsa's for 10s: 30010 2048 bit DSA signs in 9.99s Doing 2048 bit verify dsa's for 10s: 33202 2048 bit DSA verify in 9.98s OpenSSL 1.0.2t 10 Sep 2019 built on: reproducible build, date unspecified options:bn(64,64) rc4(ptr,int) des(idx,cisc,16,int) aes(partial) idea(int) blowfish(idx) compiler: clang -I. -I.. -I../include -fPIC -fno-common -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch x86_64 -O3 -DL_ENDIAN -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM sign verify sign/s verify/s rsa 1024 bits 0.000109s 0.000009s 9148.5 116964.9 rsa 2048 bits 0.000808s 0.000025s 1237.9 40426.4 sign verify sign/s verify/s dsa 1024 bits 0.000118s 0.000091s 8487.3 10965.4 dsa 2048 bits 0.000333s 0.000301s 3004.0 3326.9 ssh force use password $ ssh -o PreferredAuthentications=password -o PubkeyAuthentication=no user@target.server ssh and tar copy multiple files to remote server $ tar cvzf - -T list_of_filenames | ssh hostname tar xzf - find && tar backup all config.xml in JENKINS_HOME $ find ${JENKINS_HOME}/jobs \\ -maxdepth 2 \\ -name config\\.xml \\ -type f -print | tar czf ~/config.xml.tar.gz --files-from - back build history $ find ${JENKINS_HOME}/jobs \\ -name builds \\ -prune -o \\ -type f \\ -print | tar czf ~/m.tar.gz --files-from - tar all and extra in remote # ssh -C # no `-z` `-C` # | | # v v $ tar cf - . | ssh -C hostname \"cd ~/.marslo/test/; tar xvf -\" Warning: Permanently added '10.69.78.40' (ECDSA) to the list of known hosts. ./ ./temp/ ./a/ ./a/a.txt ./c/ ./b/ # tar z-flag # `-z` no `-C` # | | # v v $ tar cfz - . | ssh hostname \"cd ~/.marslo/test/; tar xvzf -\" with proxy using command directly Linux: $ ssh -o 'ProxyCommand nc -x proxy.url.com proxy-port %h %p' -vT user@target.server # or $ ssh -o 'ProxyCommand corkscrew proxy.url.com proxy-port %h %p' -vT user@target.server windows: git for windows $ ssh -o 'ProxyCommand connect -H http://proxy.url.com:proxy-port %h %p' user@target.server cygwin $ apt-cyg install corkscrew $ ssh -o 'ProxyCommand corkscrew proxy.url.com proxy-port %h %p' user@target.server # or $ apt-cyg install nc $ ssh -o 'ProxyCommand nc -X connect -x proxy.url.com:proxy-port %h %p' -vT git@github.com ssh certificate [!NOTE|label:references:] * OpenSSH/Cookbook/Certificate-based Authentication * Configure ssh certificate based authentication 14.3.3. Creating SSH CA Certificate Signing Keys Files Associated with SSH Host Certificates Certificate Authority (ca) - a private key generated for signing other keys Certificate public key - the public component of the certificate authority Host Public Key - the actual key that the SSH daemon uses to identify itself to the clients Host Certificate - the signature made for the Host Public Key using the Certificate Authority How to Generate and Configure SSH Certificate-Based Authentication If you’re not using SSH certificates you’re doing SSH wrong How to configure and setup SSH certificates for SSH authentication How To Configure SSH Key-Based Authentication on a Linux Server Tightening SSH access using short-lived SSH certificates How to setup SSH certificates for SSH authentication SSH User Certificates ca remote $ ssh-keygen -t ed25519 -b 4096 -f devops@ca -C 'devops@ca' -P '' -q remote $ sudo cp devops@ca* /etc/ssh/ remote $ echo 'TrustedUserCAKeys /etc/ssh/devops@ca.pub' | sudo tee -a /etc/ssh/sshd_config remote $ sudo grep TrustedUserCAKeys /etc/ssh/sshd_config TrustedUserCAKeys /etc/ssh/devops@ca.pub sign and generate cert key # download devops@ca # key id principals # v v local $ ssh-keygen -s devops@ca -I marslo -n marslo -V +52w ~/.ssh/marslo.pub $ ls ~/.ssh/marslo* /Users/marslo/.ssh/marslo /Users/marslo/.ssh/marslo-cert.pub /Users/marslo/.ssh/marslo.pub verify $ ssh-keygen -Lf ~/.ssh/marslo-cert.pub /Users/marslo/.ssh/marslo-cert.pub: Type: ssh-ed25519-cert-v01@openssh.com user certificate Public key: ED25519-CERT SHA256:JfJnCDxjWhLwW3BcBX3XycBr3dT3JtHTwD1M4H3828E Signing CA: ED25519 SHA256:5dNlpIIjX/pdoNSpmtfcGQijSrl3W87TByA9KeCe2M0 (using ssh-ed25519) Key ID: \"marslo\" Serial: 0 Valid: from 2023-08-17T17:41:00 to 2024-08-15T17:42:52 Principals: marslo Critical Options: (none) Extensions: permit-X11-forwarding permit-agent-forwarding permit-port-forwarding permit-pty permit-user-rc $ ssh -i ~/.ssh/marslo marslo@remote \"cat /home/marslo/.ssh/authorized_keys; du -hs /home/marslo/.ssh/authorized_keys; hostname\" 0 /home/marslo/.ssh/authorized_keys remote update for existing key # serial # v $ ssh-keygen -s devops@ca -I 'edcba' -z '0002' -n marslo marslo.pub Signed user key marslo-cert.pub: id \"edcba\" serial 2 for marslo valid forever # verify $ ssh-keygen -f marslo-cert.pub -L marslo-cert.pub: Type: ssh-ed25519-cert-v01@openssh.com user certificate Public key: ED25519-CERT SHA256:JfJnCDxjWhLwW3BcBX3XycBr3dT3JtHTwD1M4H3828E Signing CA: ED25519 SHA256:5dNlpIIjX/pdoNSpmtfcGQijSrl3W87TByA9KeCe2M0 (using ssh-ed25519) Key ID: \"edcba\" Serial: 2 Valid: forever Principals: marslo Critical Options: (none) Extensions: permit-X11-forwarding permit-agent-forwarding permit-port-forwarding permit-pty permit-user-rc login via specific cert [!NOTE|label:references:] OpenSSH/Cookbook/Certificate-based Authentication$ ssh -o CertificateFile=server01.ed25519-cert.pub -i server01.ed25519 \\ fred@server01.example.org $ ssh marslo@sample.server.com marslo@sample.server.com's password: $ ssh -o CertificateFile=marslo-cert.pub marslo@sample.server.com \"du -hs ~/.ssh/authorized_keys\" 0 /home/marslo/.ssh/authorized_keys # via config $ cat ~/.ssh/confg Host example sample.server.com Hostname sample.server.com User marslo IdentitiesOnly yes IdentityFile /home/marslo/.ssh/marslo CertificateFile /home/marslo/.ssh/marslo-cert.pub SSH Host Certificates ssh tunnel references: ssh端口转发(跳板机)实战详解 SSH 通过跳板机直接访问内网机器 [!TIP] key point: -L : -R : --> basic command line $ ssh -Nf -L ::: usage: 1 -> [2 ->] 3 : ssh host2:port2:host3:port3 host1:port1 if ignore host2. default using local.host two servers -L in jumper [!TIP] purpose:local:22 --> jumper:6666 # -L : -R [!TIP] status: current status | v mymac:22 + # login to jumper first via GUI destination | v $ ssh -Nf -R 6666::22 marslo@ $ ps auxfww | grep ssh | grep -v grep marslo 2281 0.0 0.0 11716 4064 ? Ss 19:55 0:00 \\_ ssh -Nf -R 6666::22 marslo@ $ sudo netstat -anp | grep ssh tcp 0 0 :46176 :22 ESTABLISHED 2281/ssh # verify in $ netstat -an | grep 6666 tcp4 0 0 127.0.0.1.6666 *.* LISTEN tcp6 0 0 ::1.6666 *.* LISTEN $ ssh -p 7777 localhost ## or $ cat ~/.ssh/config Host jumper Hostname localhost Port 7777 $ ssh jumper three serves scenario 1 in jumper purpose:local:6666 # -R : --> $ ssh user@jumper $ ssh -Nf -R [jumper:]6666:local:6666 root@remote # verify ## in remote $ ssh root@remote $ scp -P 6666 root@localhost:/remote/path/file /local/path ## in local $ scp -P 6666 /local/path/file root@localhost:/remote/path/file $ ssh user@jumper $ ps awwx | grep ssh | grep 6666 17549 ? Ss 0:00 ssh -Nf -L 6666:remote:22 root@remote 18740 ? Ss 3:50 ssh -Nf -R 6666:local:6666 root@remote scenario 2 [!TIP] details : current status -------------- | | mymac destination | ^ wants: v | -------------->-------------- visit directly # login to jumper $ ssh -Nf -R7777::22 marslo@ $ ps auxfww | grep ssh | grep -v grep marslo 41 0.0 0.0 11716 5832 ? Ss 21:51 0:00 \\_ ssh -Nf -R7777::22 marslo@ # verify in mymac $ ssh -p 7777 localhost # localhost in == $ netstat -an | grep 7777 tcp6 0 0 ::1.7777 ::1.65371 ESTABLISHED tcp6 0 0 ::1.65371 ::1.7777 ESTABLISHED tcp4 0 0 127.0.0.1.7777 *.* LISTEN tcp6 0 0 ::1.7777 *.* LISTEN config ssh config $ cat ~/.ssh/config HOST * LogLevel ERROR HostkeyAlgorithms +ssh-rsa GSSAPIAuthentication no StrictHostKeyChecking no UserKnownHostsFile /dev/null IdentityFile ~/.ssh/id_ed25519 IdentityFile ~/.ssh/id_rsa # keep the older key if necessary # PubkeyAcceptedAlgorithms +ssh-rsa Include config.d/* Host github.com User marslo.jiao@gmail.com Hostname ssh.github.com IdentityFile /C/Marslo/my@key IdentitiesOnly yes Port 443 # ProxyCommand nc -X connect -x proxy.com:8080 %h %p # ProxyCommand /usr/bin/nc -X 5 -x 127.0.0.1:1087 %h %p # ProxyCommand /usr/local/bin/corkscrew 127.0.0.1 1087 %h %p sshd_config references: Three locks for your SSH door 保护 SSH 的三把锁 7 Default OpenSSH Security Options You Should Change in /etc/ssh/sshd_config sshd_config (4) [!TIP] disable Root Login : PermitRootLogin allow only specific users or groups : AllowUsers, AllowGroups deny specific users or groups : DenyUsers, DenyGroups change sshd port number : Port change login grace time : LoginGraceTime Restrict the Interface (IP Address) to Login : ListenAddress disconnect ssh when no activity : ClientAliveInterval banner and motd [!TIP] files: /etc/pam.d/sshd : session optional pam_motd.so : /usr/lib64/security/pam_motd.so /etc/motd /etc/ssh/sshd_config : Banner /path/to/banner force disable all banner or motd$ ssh user@host $ touch ~/.hushlogin disable login password $ cat /etc/ssh/sshd_config ChallengeResponseAuthentication no PasswordAuthentication no UsePAM no scripts: TIMESTAMPE=$(date +\"%Y%m%d%H%M%S\") SSHDFILE=\"/etc/ssh/sshd_config\" sudo cp \"${SSHDFILE}{,.org.${TIMESTAMPE}}\" sudo bash -c '/bin/sed -i -e \"s:^\\(UsePAM.*$\\):# \\1:\" ${SSHDFILE}' sudo bash -c '/bin/sed -i -e \"s:^\\(PermitRootLogin.*$\\):# \\1:\" ${SSHDFILE}' sudo bash -c '/bin/sed -i -e \"s:^\\(ChallengeResponseAuthentication.*$\\):# \\1:\" ${SSHDFILE}' sudo bash -c '/bin/sed -i -e \"s:^\\(PasswordAuthentication.*$\\):# \\1:\" ${SSHDFILE}' if ! grep 'Add my marslo' ${SSHDFILE} > /dev/null 2>&1; then sudo bash -c \"cat >> ${SSHDFILE}\" disallow group to use password [!TIP|label:references:] Directive 'UsePAM' is not allowed within a Match block Directive 'ChallengeResponseAuthentication' is not allowed within a Match block Directive 'PrintMotd' is not allowed within a Match block Directive 'LoginGraceTime' is not allowed within a Match block if ! grep 'Add my marslo' ${SSHDFILE} > /dev/null 2>&1; then sudo bash -c \"cat >> ${SSHDFILE}\" disallowing user to use tcp forwarding Match User testuser AllowTcpForwarding no displaying a special banner for users not in the staff group Match Group *,!staff Banner /etc/banner.text allowing root login from host rootallowed.example.com Match Host rootallowed.example.com PermitRootLogin yes allowing anyone to use gatewayports from the local net Match Address 192.168.0.0/24 GatewayPorts yes duebug debug git GIT_SSH_COMMAND $ GIT_SSH_COMMAND=\"ssh -vvT\" git clone git@github.com:Marslo/myblog.git Cloning into 'myblog'... OpenSSH_7.9p1, LibreSSL 2.7.3 debug1: Reading configuration data /Users/marslo/.ssh/config debug1: /Users/marslo/.ssh/config line 1: Applying options for * debug1: /Users/marslo/.ssh/config line 13: Applying options for github.com debug1: Reading configuration data /etc/ssh/ssh_config debug1: /etc/ssh/ssh_config line 48: Applying options for * debug1: Connecting to github.com port 22. ^C GIT_TRACE $ GIT_TRACE=1 git st 00:30:44.772137 git.c:703 trace: exec: git-st 00:30:44.772540 run-command.c:663 trace: run_command: git-st 00:30:44.772894 git.c:384 trace: alias expansion: st => status 00:30:44.772903 git.c:764 trace: exec: git status 00:30:44.772907 run-command.c:663 trace: run_command: git status 00:30:44.777379 git.c:440 trace: built-in: git status On branch master Your branch is up to date with 'origin/master'. 00:30:44.782714 run-command.c:663 trace: run_command: GIT_INDEX_FILE=.git/index git submodule summary --cached --for-status --summary-limit -1 HEAD 00:30:44.787490 git.c:703 trace: exec: git-submodule summary --cached --for-status --summary-limit -1 HEAD 00:30:44.788038 run-command.c:663 trace: run_command: git-submodule summary --cached --for-status --summary-limit -1 HEAD 00:30:44.838222 git.c:440 trace: built-in: git rev-parse --git-dir 00:30:44.845054 git.c:440 trace: built-in: git rev-parse --git-path objects 00:30:44.852811 git.c:440 trace: built-in: git rev-parse -q --git-dir 00:30:44.870362 git.c:440 trace: built-in: git rev-parse --show-prefix 00:30:44.878755 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:44.893984 git.c:440 trace: built-in: git rev-parse -q --verify --default HEAD HEAD 00:30:44.899709 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:44.905200 git.c:440 trace: built-in: git rev-parse --sq --prefix -- 00:30:44.911762 git.c:440 trace: built-in: git diff-index --cached --ignore-submodules=dirty --raw 52c94664ffc09cde2308c6bf9824ca0355ff5ff7 -- 00:30:44.917374 run-command.c:663 trace: run_command: GIT_INDEX_FILE=.git/index git submodule summary --files --for-status --summary-limit -1 00:30:44.922165 git.c:703 trace: exec: git-submodule summary --files --for-status --summary-limit -1 00:30:44.922568 run-command.c:663 trace: run_command: git-submodule summary --files --for-status --summary-limit -1 00:30:44.965375 git.c:440 trace: built-in: git rev-parse --git-dir 00:30:44.972784 git.c:440 trace: built-in: git rev-parse --git-path objects 00:30:44.979117 git.c:440 trace: built-in: git rev-parse -q --git-dir 00:30:44.991077 git.c:440 trace: built-in: git rev-parse --show-prefix 00:30:44.997718 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:45.012365 git.c:440 trace: built-in: git rev-parse -q --verify --default HEAD 00:30:45.018759 git.c:440 trace: built-in: git rev-parse --show-toplevel 00:30:45.024687 git.c:440 trace: built-in: git rev-parse --sq --prefix -- 00:30:45.031664 git.c:440 trace: built-in: git diff-files --ignore-submodules=dirty --raw -- nothing to commit, working tree clean debug ssh references: OpenSSH Test Mode OpenSSH Tip: Check Syntax Errors before Restarting SSHD Server How to check SSH server's configuration validity debug mode$ sudo /usr/sbin/sshd -d [-d] [-d] test mode # -T : extended test mode $ sudo /usr/sbin/sshd -T [-f /path/to/sshd_config] # -t : test mode $ sudo /usr/sbin/sshd -t [-f /path/to/sshd_config] tips disconnect [!TIP] Enter + ~ + . + Enter references: Linux / UNIX kill unresponsive hung SSH session Kill an unresponsive ssh session without closing the terminal How to kill or disconnect hung ssh session in Linux $ $ ~? Supported escape sequences: ~. - terminate connection (and any multiplexed sessions) ~B - send a BREAK to the remote system ~C - open a command line ~R - request rekey ~V/v - decrease/increase verbosity (LogLevel) ~^Z - suspend ssh ~# - list forwarded connections ~& - background ssh (when waiting for connections to terminate) ~? - this message ~~ - send the escape character by typing it twice (Note that escapes are only recognized immediately after newline.) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:10:10 "},"devops/git/git.html":{"url":"devops/git/git.html","title":"git","keywords":"","body":"git command study and practice appoint git alias specifying ranges commit get commit id get abbrev commit ids get previous commit id get next commit id branch get current branch create empty branch get branch name from reversion get upstream branch get local/remote branches sort local branch via committerdate change head get first parent branch status list ignored log short stat show renamed status show files and status without comments show submodule changes get change from .git/objects get change history for deleted files search by contents search by message rebase automatic edit by git rebase -i auto rebaes fix typo in commits undo delete after push change latest comments in local change remote comments change root comments change author and committer mv case sensitive clean clean untracked directory and item in .gitignore diff diff-highlight get difference between two branches diff ignore whitespace tag discribe get distance between tags get revision in particular branch show all tags for particular revision get tag and distance (depth) checkout sparse-checkout checkout specific commit checkout particular commit and submodules checkout single branch blame blame in line range format tricky for-each-ref get refs days ago format date format reference: git reference * 🌳🚀 CS Visualized: Useful Git Commands git cheatsheet git commands schacon/plumbing.md git-tips/tips 521xueweihan/git-tips CS Visualized: Useful Git Commands 10.8 Git Internals - Environment Variables GitHub Flow Like a Pro with these 13 Git Aliases gitglossary(7) Manual Page appoint git alias br = branch co = checkout coa = commit --amend --no-edit pl = !git --no-pager log --color --graph --pretty=tformat:'%C(red)%h%C(reset) -%C(yellow)%d%C(reset) %s %C(green)(%cr) %C(blue)%C(reset)' --abbrev-commit --date=relative --max-count=3 pls = log --color --graph --pretty=tformat:'%C(red)%h%C(reset) -%C(yellow)%d%C(reset) %s %C(green)(%cr)%C(reset) %C(blue)%C(reset)' --abbrev-commit --date=relative fpl = log --color --graph --pretty=tformat:'%C(red)%H%C(reset) -%C(yellow)%d%C(reset) %s %C(green)(%cr)%C(reset) %C(blue)%C(reset)' --abbrev-commit --date=relative fl = log -p --graph --color --graph rlog = \"!bash -c 'while read branch; do \\n\\ git fetch --all --force; \\n\\ git pl remotes/origin/$branch; \\n\\ done specifying ranges references: gitrevisions First master absolute commit referencing... git reflog git reflog reset using tilde (~) and caret (^) combined commit exclusions ^ (caret) notation : To exclude commits reachable from a commit, a prefix ^ notation is used. E.g. ^r1 r2 means commits reachable from r2 but exclude the ones reachable from r1 (i.e. r1 and its ancestors) dotted range notations .. (two-dot) range notation r1..r2 : commits that are reachable from r2 excluding those that are reachable from r1 by ^r1 r2 ... (three-dot) symmetric difference notation r1...r2 : called symmetric difference of r1 and r2It is the set of commits that are reachable from either one of r1 (left side) or r2 (right side) but not from both commit get commit id the can be: commit id branch name HEAD, HEAD~n, HEAD^^ $ git rev-parse ^{commit} get abbrev commit ids [!NOTE] references: --abbrev-commit format: %H : commit hash %h : abbreviated commit hash $ git rev-list HEAD -n 3 --abbrev=11 --abbrev-commit 446c656814d e747154df34 22d0ee9b131 # or via `git log` $ git log -n 3 --format='%h' --abbrev=11 # or $ git log -3 --format='%h' --abbrev=11 446c656814 e747154df3 22d0ee9b13 get previous commit id $ git rev-list --no-walk ^ get next commit id [!NOTE] references: xueliu/version-up.sh $ git rev-list --no-walk ..HEAD | tail -1 branch get current branch $ git branch --show-current or $ git rev-parse --abbrev-ref HEAD or $ git symbolic-ref --short HEAD or$ git symbolic-ref HEAD | sed -e \"s/^refs\\/heads\\///\" or$ git symbolic-ref --quiet --short HEAD || git rev-parse --short or$ git name-rev --name-only HEAD for detached branch $ git st HEAD detached at d4beb6ac ... $ git branch --no-color \\ --remote \\ --verbose \\ --no-abbrev \\ --contains | sed -rne 's:^[^/]*/([^\\ ]+).*$:\\1:p' marslo/sandbox # or $ git branch --no-color \\ --remote \\ --verbose \\ --no-abbrev \\ --contains | sed -rne 's:^[ \\s]*origin/([^\\ ]+).*$:\\1:p' or $ git name-rev --name-only HEAD | sed -rne 's:^[ \\s]*([^\\]+/){2}([^~]+).*$:\\2:p' # or $ git name-rev --name-only HEAD | sed -rne 's:^[ \\s]*remotes/origin/([^~]+).*$:\\1:p' create empty branch create an empty branch $ mkdir && cd $_ $ git init $ git remote add origin $ git fetch --all --progress --force $ git checkout -b push to remote $ git add --all . $ git commit -m 'inital an empty branch' $ git push --force -u origin HEAD: git alias .gitalias : [alias] init-repo = \"!f() { \\ declare help=\\\"\\\"\\\"\\ USAGE: git init-repo [DEFAULT_BRANCH] [LOCAL_DIR] \\n\\ OPT: \\n\\ REMOTE_URL: mandatory \\n\\ DEFAULT_BRANCH: optinal. default is 'master' \\n\\ LOCAL_DIR: optional. default is current directory: '\\\"$(pwd)\\\"' \\n\\ \\\"\\\"\\\"; \\ declare remoteURL=\\\"$1\\\"; \\ declare defaultBr='master'; \\ declare localDir='.'; \\ [ 2 -le $# ] && defaultBr=\\\"$2\\\"; \\ [ 3 -eq $# ] && localDir=\\\"$3\\\"; \\ if [ 0 -eq $# ] || [ 3 -lt $# ]; then \\ echo \\\"${help}\\\"; \\ else \\ [ -d ${localDir} ] || mkdir -p ${localDir}; \\ cd ${localDir} ; \\ git init && \\ git remote add origin ${remoteURL} && \\ git fetch --all --force --quiet && \\ git checkout -b ${defaultBr}; \\ fi \\ }; f \\ \" get branch name from reversion branch -a --contians $ git branch -a --contains a3879d3 * master remotes/origin/master or $ git branch -r --contains a3879d3 origin/master name-rev $ git name-rev a3879d3 a3879d3 master~12 get upstream branch get current $ git rev-parse --abbrev-ref --symbolic-full-name @{u} origin/marslo or$ git for-each-ref --format='%(upstream)' $(git symbolic-ref -q HEAD) refs/remotes/origin/marslo or for meta/config$ git symbolic-ref -q HEAD refs/heads/meta/config $ git for-each-ref --format='%(upstream)' $(git symbolic-ref -q HEAD) refs/remotes/origin/meta/config $ git for-each-ref --format='%(upstream:short)' $(git symbolic-ref -q HEAD) origin/meta/config or$ git status -bsuno ## master...origin/master get specific $ git rev-parse --abbrev-ref gh-pages@{upstream} origin/gh-pages or$ git for-each-ref --format='%(upstream:short)' $(git rev-parse --symbolic-full-name meta/config) origin/meta/config get local/remote branches local$ git for-each-ref --format='%(refname:short)' refs/heads/ remote$ git for-each-ref --format='%(refname:short)' refs/remotes/origin/ sort local branch via committerdate references: How can I get a list of Git branches, ordered by most recent commit? sort git branch by default$ git config --global branch.sort -committerdate $ git for-each-ref --sort=-committerdate refs/heads/ # or using git branch (since version 2.7.0) $ git branch --sort=-committerdate # DESC $ git branch --sort=committerdate # ASC advanced usage $ git for-each-ref \\ --sort=-committerdate \\ refs/heads/ \\ --format='%(HEAD) %(color:yellow)%(refname:short)%(color:reset) - %(color:red)%(objectname:short)%(color:reset) - %(contents:subject) - %(authorname) (%(color:green)%(committerdate:relative)%(color:reset))' for remote $ git for-each-ref --sort=-committerdate refs/remotes more on git tips git-list-branches-by-date() { local current_branch=$(git rev-parse --symbolic-full-name --abbrev-ref HEAD) local normal_text=$(echo -ne '\\E[0m') local yellow_text=$(echo -ne '\\E[0;33m') local yellow_bg=$(echo -ne '\\E[7;33m') git for-each-ref --sort=-committerdate \\ --format=$' %(refname:short) \\ \\t%(committerdate:short)\\t%(authorname)\\t%(objectname:short)' \\ refs/heads \\ | column -t -s $'\\t' -n \\ | sed -E \"s:^ (${current_branch}) :* ${yellow_bg}\\1${normal_text} :\" \\ | sed -E \"s:^ ([^ ]+): ${yellow_text}\\1${normal_text}:\" } git alias() [alias] sb = \"! git branch --sort=-committerdate --format='%(HEAD) %(color:red)%(objectname:short)%(color:reset) - %(color:yellow)%(refname:short)%(color:reset) - %(subject) %(color:bold green)(%(committerdate:relative))%(color:reset) %(color:blue)%(color:reset)' --color=always\" recent = \"! f() { \\ declare help=\\\"USAGE: git recent [remotes|tags] [count]\\\"; \\ declare refs; \\ declare count; \\ if [ 2 -lt $# ]; then \\ echo \\\"${help}\\\"; \\ exit 1; \\ else \\ if [ 'remotes' = \\\"$1\\\" ]; then \\ refs='refs/remotes/origin'; \\ elif [ 'tags' = \\\"$1\\\" ]; then \\ refs='refs/tags'; \\ elif [ 1 -eq $# ]; then \\ count=$1; \\ fi; \\ if [ 2 -eq $# ]; then \\ count=$2; \\ fi; \\ fi; \\ git for-each-ref \\ --sort=-committerdate \\ ${refs:='refs/heads'} \\ --format='%(HEAD) %(color:yellow)%(refname:short)%(color:reset) - %(color:red)%(objectname:short)%(color:reset) - %(contents:subject) - %(authorname) %(color:green)(%(committerdate:relative))%(color:reset)' \\ --color=always \\ --count=${count:=5}; \\ }; f \\ \" change head reference: warning: ignoring broken ref refs/remotes/origin/HEAD check refs $ git status warning: ignoring broken ref refs/remotes/origin/HEAD $ git symbolic-ref refs/remotes/origin/HEAD refs/remotes/origin/new_master fix warning$ git symbolic-ref refs/remotes/origin/HEAD refs/remotes/origin/new_master or$ git remote set-head origin --delete $ git remote set-head origin --auto or$ git fetch --all --force $ git remote set-head origin refs/remotes/origin/new_master get first parent branch [!NOTE|label:references:] How to find the nearest parent of a Git branch joechrysler/who_is_my_mummy.sh * explainshell.com status list ignored [!NOTE|label:references:] Git command to show which specific files are ignored by .gitignore Is there a way to tell git-status to ignore the effects of .gitignore files? git update-index ignoring files How can I stop .gitignore from appearing in the list of untracked files? status $ git status --ignored On branch master Your branch is up to date with 'origin/master'. Ignored files: (use \"git add -f ...\" to include in what will be committed) bin/ nothing to commit, working tree clean # short status $ git status --ignored --short !! bin/ $ git status --porcelain --ignored !! bin/ $ git st --ignored --untracked-files=all ## master...origin/master !! bin/cfssl !! bin/cfssl-bundle !! bin/cfssl-certinfo !! bin/cfssl-newkey !! bin/cfssl-scan !! bin/cfssljson !! bin/mkbundle !! bin/multirootca check-ignore $ git check-ignore * bin $ git check-ignore -v * .gitignore:4:bin bin $ git check-ignore -v $(find . -type f -print) .gitignore:4:bin ./bin/cfssl-scan .gitignore:4:bin ./bin/cfssl-certinfo .gitignore:4:bin ./bin/cfssl-bundle .gitignore:4:bin ./bin/cfssl .gitignore:4:bin ./bin/cfssl-newkey .gitignore:4:bin ./bin/multirootca .gitignore:4:bin ./bin/mkbundle .gitignore:4:bin ./bin/cfssljso $ find . -not -path './.git/*' | git check-ignore --stdin ./bin ./bin/cfssl-scan ./bin/cfssl-certinfo ./bin/cfssl-bundle ./bin/cfssl ./bin/cfssl-newkey ./bin/multirootca ./bin/mkbundle ./bin/cfssljson $ find . -path ./.git -prune -o -print | git check-ignore --no-index --stdin --verbose .gitignore:4:bin ./bin .gitignore:4:bin ./bin/cfssl-scan .gitignore:4:bin ./bin/cfssl-certinfo .gitignore:4:bin ./bin/cfssl-bundle .gitignore:4:bin ./bin/cfssl .gitignore:4:bin ./bin/cfssl-newkey .gitignore:4:bin ./bin/multirootca .gitignore:4:bin ./bin/mkbundle .gitignore:4:bin ./bin/cfssljson ls-files $ git ls-files --others --ignored --exclude-standard # or $ git ls-files -o -i --exclude-standard bin/cfssl bin/cfssl-bundle bin/cfssl-certinfo bin/cfssl-newkey bin/cfssl-scan bin/cfssljson bin/mkbundle bin/multirootca # or list only directories $ git ls-files --others --ignored --exclude-standard --directory bin/ # or from `.gitignore` file $ git ls-files --ignored --others --exclude-from=.gitignore bin/cfssl bin/cfssl-bundle bin/cfssl-certinfo bin/cfssl-newkey bin/cfssl-scan bin/cfssljson bin/mkbundle bin/multirootca clean $ git clean -ndX Would remove bin/ log short stat $ git log --show-signature # or $ git log --shortstat show renamed status $ git log -M --summary | grep rename # or $ git log -M --summary | grep -E '^\\s*rename.*{.*=>.*}' show files and status without comments $ git log --color --stat --abbrev-commit --date=relative --graph --submodule --format=\"%H\" more # or $ git log --color --stat --abbrev-commit --date=relative --graph --submodule --format=\"%h %ad- %s [%an]\" # or $ git log --color --stat --abbrev-commit --date=relative --graph --submodule --format='%C(red)%h%Creset %C(yellow)(%ad)%Creset %s %C(blue)%Creset' e.g.: $ git log -3 --color --stat --abbrev-commit --date=relative --graph --submodule --format=\"%H\" * 50ede51fcc3cf0311fd85b3e9c4a36d4beb89e69 | | devops/git/gerrit.md | 6 ++++-- | devops/git/git.md | 5 +++++ | 2 files changed, 9 insertions(+), 2 deletions(-) * 41d58dabcd0aaee33edd1de7793ffd82c7cffa89 | | SUMMARY.md | 2 +- | 1 file changed, 1 insertion(+), 1 deletion(-) * 4460a32d8fddbe7c5c434947aea153273ce215d4 | | devops/git/{gitStudy.md => git.md} | 117 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++- | 1 file changed, 116 insertions(+), 1 deletion(-) show submodule changes $ git submodule status $ git log -- get change from .git/objects $ find .git/objects -type f -printf \"%P\\n\" | sed s,/,, get change history for deleted files full-history $ git log --all --full-history -- or $ git log --all --full-history --oneline -- or $ git log --oneline --follow -- or $ git log --diff-filter=D --summary | find \"delete\" | grep --follow $ git log --follow search by contents $ git log -S'add' --oneline -3 6f7877c2 update git for fetch more refs after cloned via --single-branch, and add tricky for vim 30ce195e add jenkins plugin jira-steps 913a7f29 update jenkins recommended plugins or# -p, --paginate # Pipe all output into less (or if set, $PAGER) if standard output is a terminal. This overrides the # pager. configuration options (see the \"Configuration Mechanism\" section below) $ git pls -S'add' -p search by message $ git log --grep='jira' --oneline 30ce195e add jenkins plugin jira-steps d17dd3aa add jira api or$ git pls --grep='jira' rebase [!TIP] about GIT_SEQUENCE_EDITOR git rebase in depth automatic edit by git rebase -i inspired from .gitconfig & Is there a way to squash a number of commits non-interactively? $ COUNT=$1 $ GIT_EDITOR=\"sed -i -e '2,$COUNT s/^pick /s /;/# This is the 2nd commit message:/d'\" git rebase -i HEAD~$COUNT git alias [alias] sq = ! \"f() { TARGET=$1 && GIT_EDITOR=\\\"sed -i -e '2,$TARGET s/^pick /s /;/# This is the 2nd commit message:/,$ {d}'\\\" git rebase -i HEAD~$TARGET; }; f\" example or $ GIT_SEQUENCE_EDITOR=\"sed -i 's/^pick ce5efdb /edit ce5efdb /;/^pick ce6efdb /d'\" git rebase -i ${SHA} or edit $ GIT_SEQUENCE_EDITOR=\"sed -i -re 's/^pick 134567/e 1234567/'\" git rebase -i 1234567^ or sequence.editor $ git -c sequence.editor='sed -i s/pick/reword/' rebase -i ${SHA} auto rebaes .gitconfig [alias] arebase = ! ~/.marslo/bin/arebase.sh ~/.marslo/bin/arebase.sh #!/bin/bash ACTION=$1 COMMIT=$(git rev-parse --short $2) [[ \"$COMMIT\" ]] || exit 1 CORRECT= for A in p pick r reword e edit s squash f fixup d drop t split; do [[ $ACTION == $A ]] && CORRECT=1 done [[ \"$CORRECT\" ]] || exit 1 git merge-base --is-ancestor $COMMIT HEAD || exit 1 if [[ $ACTION == \"drop\" || $ACTION == \"d\" ]]; then GIT_SEQUENCE_EDITOR=\"sed -i -e '/^pick $COMMIT/d'\" git rebase -i $COMMIT^^ elif [[ $ACTION == \"split\" || $ACTION == \"t\" ]]; then GIT_SEQUENCE_EDITOR=\"sed -i -e 's/^pick $COMMIT/edit $COMMIT/'\" git rebase -i $COMMIT^^ || exit 1 git reset --soft HEAD^ echo \"Hints:\" echo \" Select files to be commited using 'git reset', 'git add' or 'git add -p'\" echo \" Commit using 'git commit -c $COMMIT'\" echo \" Finish with 'git rebase --continue'\" else GIT_SEQUENCE_EDITOR=\"sed -i -e 's/^pick $COMMIT/$1 $COMMIT/'\" git rebase -i $COMMIT^^ fi fix typo in commits $ EDITOR=\"sed -i -e 's/borken/broken/g'\" GIT_SEQUENCE_EDITOR=\"sed -i -e 's/pick/reword/g'\" git rebase -i --root or: $ VISUAL=\"sed -i -e '/^[[:blank:]]*Change-Id/ d'\" GIT_SEQUENCE_EDITOR=\"sed -i -e 's/pick/reword/g'\" git rebase -i --root or: $ GIT_EDITOR=\"sed -i -e 's/kyewrod/keyword/g'\" GIT_SEQUENCE_EDITOR=\"sed -i -e 's/pick/reword/g'\" git rebase -i --root undo delete after push delete only the latest commit $ git push origin +^: # e.g.: $ git pl --pretty=format:\"%h\" --no-patch * cb46bdc * 936543c * a83ac6b # delete cb46bdc $ git push origin +cb46bdc^:master delete multiple commits revert local $ git reset --hard HEAD~ # or $ git reset --hard HEAD^^^ # or $ git reset --hard # or $ git rebase -i HEAD~ push to remote $ git push [--force] origin + # e.g.: $ git push [--force] origin +master revert deleted branches [!TIP] references: Can I recover a branch after its deletion in Git? How to Restore a Deleted Branch or Commit with Git Reflog How to restore a deleted branch # find the HEAD of deleted branch $ git log --graph --decorate $(git rev-list -g --all) $ git checkout $ git checkout -b /branch/name or find out recent actions $ git reflog --no-abbrev or find all losts $ git fsck --full \\ --no-reflogs \\ --unreachable \\ --lost-found | grep commit | cut -d\\ -f3 | xargs -n 1 git log -n 1 --pretty=oneline show diff $ git log -p revert single file to remotes $ git checkout origin/ -- revert changes in submodule $ git submodule update -f --init or$ git submodule foreach --recursive git reset --hard or$ git submodule update -f --recursive or$ git submodule foreach --recursive git reset --hard $ git submodule update --recursive --init Git Reset vs Revert vs Checkout reference Command Scope Common use cases git reset Commit-level Discard commits in a private branch or throw away uncommited changes git reset File-level Unstage a file git checkout Commit-level Switch between branches or inspect old snapshots git checkout File-level Discard changes in the working directory git revert Commit-level Undo commits in a public branch git revert File-level (N/A) git reset via git reflog git reset --hard git reset --soft git revert change latest comments in local $ git commit --amend change comments in remote $ git pl * a79d384 - (HEAD -> master, origin/master, origin/HEAD) update (11 seconds ago) * 7cef7c7 - update (7 hours ago) * e1d7a64 - update (7 hours ago) # change comments on a79d384 $ git commit --amend $ git push --force-with-lease origin master # result $ git fetch --all --force $ git pl remotes/origin/master Fetching origin * ba49259 - (HEAD -> master, origin/master, origin/HEAD) update a79d384 for change comments (24 seconds ago) * 7cef7c7 - update (7 hours ago) * e1d7a64 - update (7 hours ago) change remote comments $ git rebase -i HEAD~ And then change pick to reword example $ git pls * 1e7d979 - (HEAD -> master, origin/master, origin/HEAD) f (24 seconds ago) * 9b89ed7 - c (40 seconds ago) * beb575f - d (51 seconds ago) * 25d010d - e (57 seconds ago) * c502e34 - b (64 seconds ago) * 8890288 - init commit (4 minutes ago) $ git rebase -i HEAD~5 reword c502e34 b pick 25d010d e pick beb575f d reword 9b89ed7 c pick 1e7d979 f $ git push --force origin master # or $ git push origin +master change root comments $ git rebase -i --root $ git push origin + change author and committer rebase and amend go to interactive mode$ git config --local user.name \"name\" $ git config --local user.email \"name@email.com\" $ git rebase -i modify pick to edit amend one by one $ git commit --amend --no-edit --only --author=\"name\" # or $ git commit --amend --no-edit --date=\"$(git log -n 1 --format=%aD)\" --reset-author $ git rebase --continue git replace rebase --onto [!TIP] see also rebase onto [alias] reauthor = !bash -c 'git rebase --onto $1 --exec \\\"git commit --amend --author=$2\\\" $1' -- $ git config --local user.name \"name\" $ git config --local user.email \"\" $ git rebase --no-edit \\ --onto HEAD~9 \\ --exec 'GIT_COMMITTER_DATE=\"$(git log -n 1 --format=%aD)\" \\ git commit --amend \\ --date=\"$(git log -n 1 --format=%aD)\"' \\ --author=\"name\" \\ # or --reset-author HEAD~9 check commits with author # get commits by name $ git log --oneline --author=\"name\" # get commits by email $ git log --oneline --author=\"\" mv case sensitive error with regular git mv $ git config --global core.ignorecase true $ git mv Tig tig fatal: renaming 'confs/home/Tig' failed: Invalid argument renmae $ git mv Tig temp $ git aa $ git mv temp tig $ git aa $ git st On branch master Your branch is up to date with 'origin/master'. Changes to be committed: (use \"git restore --staged ...\" to unstage) renamed: Tig/.tig/marslo.tigrc -> tig/.tig/marslo.tigrc renamed: Tig/.tigrc -> tig/.tigrc renamed: Tig/.tigrc_latest -> tig/.tigrc_latest renamed: Tig/tigrc_2.4.1_1_example -> tig/tigrc_2.4.1_1_example renamed: Tig/tigrc_Marslo -> tig/tigrc_Marslo clean clean untracked directory and item in .gitignore gitignore.io $ git clean -dfx quick generate .gitignore # show result $ curl -skL https://www.gitignore.io/api/groovy # download $ curl -skL https://www.toptal.com/developers/gitignore/api/groovy,java,python,go -o .gitignore using -f twice if you really want to remove such a directory $ git st On branch meta/config Your branch is based on 'origin/meta/config', but the upstream is gone. (use \"git branch --unset-upstream\" to fixup) Untracked files: (use \"git add ...\" to include in what will be committed) my-sbumodule/ nothing added to commit but untracked files present (use \"git add\" to track) $ git clean -dfx Skipping repository my-submodule/ $ git clean -dffx Removing my-submodule/ diff diff-highlight [!NOTE] references: How to improve git's diff highlighting? git and diff-highlight # centos8 $ rpm -ql git | grep diff-highlight /usr/share/git-core/contrib/diff-highlight # or ubuntu $ dpkg -L git | grep diff-highlight $ sudo ln -sf /usr/share/git-core/contrib/diff-highlight /usr/local/bin/diff-highlight get difference between two branches $ git log --left-right --graph --cherry-pick --oneline origin/..origin/ or$ git rev-list --reverse \\ --pretty=\"TO_TEST %h () %s\" \\ --cherry-pick \\ --right-only origin/...origin/ \\ | grep \"^TO_TEST \" diff ignore whitespace [!NOTE|label:references:] Ignore all whitespace changes with git-diff between commits Error in console fatal: cannot enforce both tab-in-indent and indent-with-non-tab indentation configuration only for some files How to show space and tabs with git-diff ignore tab [!TIP|label:tab-in-indent] Git v1.7.2 Release Notes $ git config core.whitespace '-tab-in-indent' $ git diff HEAD^.. ignore tab-in-indent for *.config and *.ltsv only$ cat ~/.gitattributes File: /Users/marslo/.gitattributes 1 *.config text diff=config whitespace=-tab-in-indent 2 *.ltsv text diff=ltsv whitespace=-tab-in-indent ignore all $ git config core.whitespace '-trailing-space,-indent-with-non-tab,-tab-in-indent' tag reference : git like a pro: sort git tags by date How do you achieve a numeric versioning scheme with Git? discribe $ git describe --tags --long # v2.5-0-gdeadbee # ^ ^ ^^ # | | || # | | |'-- SHA of HEAD (first seven chars) # | | '--- \"g\" is for git # | '----- distance : number of commits since last tag # | # '---------- last tag name get distance between tags $ git describe HEAD --tags or$ git describe HEAD --all --long get revision in particular branch $ git tag -l --sort='creatordate' --merged get latest tag references: Get the most recent tag in git GIT LIKE A PRO: SORT GIT TAGS BY DATE $ git tag -l --sort='creatordate' --merged | tail -1 or # the command can be executed in .git folder (! -is-inside-work-tree) $ git describe --tags --abbrev=0 --always or $ git for-each-ref --sort=taggerdate \\ --format '%(tag)' \\ refs/tags | tail -1 to get verbose output$ git for-each-ref --sort=taggerdate \\ --format '%(tag) %(taggerdate:raw) %(taggername) %(subject)' \\ refs/tags or$ git for-each-ref --sort=taggerdate \\ --format '%(tag)_,,,_%(taggerdate:raw)_,,,_%(taggername)_,,,_%(subject)' \\ refs/tags | awk 'BEGIN { FS = \"_,,,_\" } ; { printf \"%-20s %-18s %-25s %s\\n\", $2, $1, $4, $3 }' or$ git log --tags \\ --simplify-by-decoration \\ --pretty=\"format:%ai %d\" | sort or formatted date$ git for-each-ref --sort=taggerdate \\ --format '%(tag)_,,,_%(taggerdate:raw)_,,,_%(taggername)_,,,_%(subject)' \\ refs/tags | awk 'BEGIN { FS = \"_,,,_\" } ; { t=strftime(\"%Y-%m-%d %H:%M\",$2); printf \"%-20s %-18s %-25s %s\\n\", t, $1, $4, $3 }' or git aliastags = !\"git for-each-ref \\ --sort=taggerdate \\ --format '%(tag)_,,,_%(taggerdate:raw)_,,,_%(taggername)_,,,_%(subject)' refs/tags \\ | awk 'BEGIN { FS = \\\"_,,,_\\\" } ; { t=strftime(\\\"%Y-%m-%d %H:%M\\\",$2); printf \\\"%-20s %-18s %-25s %s\\\\n\\\", t, $1, $4, $3 }'\" get revision from latest tag in particular branch $ git rev-list -1 --no-patch $(git tag -l --sort='creatordate' --merged | tail -1) show all tags for particular revision $ git tag --points-at get tags for HEAD:$ git tag --points-at HEAD or$ git name-rev --tags --name-only $(git rev-parse ) example$ git name-rev --tags --name-only $(git rev-parse HEAD) get tag and distance (depth) reference: Why does git-describe prefix the commit ID with the letter 'g'? man of git-describe: The hash suffix is \"-g\" + an unambigous abbreviation for the tip commit of parent. The length of the abbreviation scales as the repository grows, using the approximate number of objects in the repository and a bit of math around the birthday paradox, and defaults to a minimum of 7. $ git describe --long --tags v1.0.0-epsilon-2-g46b7ebb | | + -g | + distance (commits on top) + tag name # or $ git describe --dirty --tags --long v1.0.0-epsilon-2-g46b7ebb | | | | \\___ ___/ | + commit hash of the current commit most + commits on top recent tag or --all $ git describe --all --long to filter the tags $ git describe --dirty --tags --long --match *nightly* nightly#82-2001310818-1765-gc18894b193 sort git tags by ascending and descending semver [!TIP] prepend \"-\" to reverse sort order. ascending : --sort= descending : --sort=- references: How to sort git tags by version string order of form rc-X.Y.Z.W? How can I list all tags in my Git repository by the date they were created? GIT LIKE A PRO: SORT GIT TAGS BY DATE via v:refname or version:refname by created data $ git for-each-ref --sort=creatordate --format='%(refname) %(creatordate)' refs/tags # or $ git tag --format='%(creatordate:short)%09%(refname:strip=2)' --sort=creatordate # or $ git for-each-ref --sort=taggerdate --format='%(tag) %(taggerdate) %(taggername) %(subject)' refs/tags # much better $ git for-each-ref --sort=taggerdate \\ --format '%(tag)_,,,_%(taggerdate:raw)_,,,_%(taggername)_,,,_%(subject)' refs/tags | awk 'BEGIN { FS = \"_,,,_\" } ; { t=strftime(\"%Y-%m-%d %H:%M\",$2); printf \"%-20s %-18s %-25s %s\\n\", t, $1, $4, $3 }' checkout sparse-checkout [!NOTE|label:references:] Git submodule prepare for sparse checkout$ git submodule absorbgitdirs $ git -C config core.sparseCheckout true $ echo 'path/to/*' >>.git/modules//info/sparse-checkout How to do submodule sparse-checkout with Git? git sparse-checkout of a submodule from a root repo checkout specific commit # make a new blank repository in the current directory git init # add a remote git remote add origin url://to/source/repository # fetch a commit (or branch or tag) of interest # Note: the full history up to this commit will be retrieved unless # you limit it with '--depth=...' or '--shallow-since=...' git fetch origin # reset this repository's master branch to the commit of interest git reset --hard FETCH_HEAD checkout particular commit and submodules [!TIP] references: How to checkout old git commit including all submodules recursively? nicktoumpelis/repo-rinse.sh $ git checkout --recurse-submodules or # [optional] create new branch $ git branch $ git checkout $ git checkout $ git submodule init # optional $ git submodule update --recursive or $ git clean -xfd $ git submodule foreach --recursive git clean -xfd $ git reset --hard $ git submodule foreach --recursive git reset --hard $ git submodule update --init --recursive checkout single branch $ git clone --single-branch --branch url://to/source/repository [target dir] add more branches $ git config remote.origin.fetch \"+refs/heads/*:refs/remotes/origin/*\" $ git fetch origin or $ cat ~/.marslo/.gitalias [alias] # [a]dd [f]etch [r]efs afr = !bash -c 'git config --add remote.origin.fetch \"+refs/heads/$1:refs/remotes/origin/$1\"' $ git afr 'sandbox/marslo/*' blame blame in line range -L , $ git blame -L 1,3 README.md a03bebd23 (marslo Nov 2 2020 1) --- a03bebd23 (marslo Nov 2 2020 2) disqus: false a03bebd23 (marslo Nov 2 2020 3) --- $ git blame -L 1,+3 README.md a03bebd23 (marslo Nov 2 2020 1) --- a03bebd23 (marslo Nov 2 2020 2) disqus: false a03bebd23 (marslo Nov 2 2020 3) --- -L : $ git blame -L :pkgInstallation belloHAKubeCluster.sh 38327eac (marslo 2019-09-17 22:10:53 +0800 test1) function pkgInstallation() { 38327eac (marslo 2019-09-17 22:10:53 +0800 test2) dockerInstallation 38327eac (marslo 2019-09-17 22:10:53 +0800 test3) k8sInstallation 38327eac (marslo 2019-09-17 22:10:53 +0800 test4) cfsslInstallation 38327eac (marslo 2019-09-17 22:10:53 +0800 test5) etcdInstallation bdfe4340 (marslo 2019-09-23 16:35:08 +0800 test6) helmInstallation 38327eac (marslo 2019-09-17 22:10:53 +0800 test7) } 38327eac (marslo 2019-09-17 22:10:53 +0800 test8) # or $ git blame -L '/pkgInstallation/,+3' belloHAKubeCluster.sh 38327eac (marslo 2019-09-17 22:10:53 +0800 test1) function pkgInstallation() { 38327eac (marslo 2019-09-17 22:10:53 +0800 test2) dockerInstallation 38327eac (marslo 2019-09-17 22:10:53 +0800 test3) k8sInstallation by keywords ( git log -S ) $ git pls -S pkgInstallation belloHAKubeCluster.sh ... * 38327ea - update (2 years, 10 months ago) format -s $ git blame -s README.md | head -2 a03bebd23 1) --- a03bebd23 2) disqus: false -n, --show-number $ git blame -n -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac 553 (marslo 2019-09-17 22:10:53 +0800 test1) function pkgInstallation() { -f, --show-name $ git blame -f -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac kubernetes/belloHAKubeCluster.sh (marslo 2019-09-17 22:10:53 +0800 test1) function pkgInstallation() { -e, --show-email [!TIP] This can also be controlled via the blame.showEmail config option. $ git blame -e -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac ( 2019-09-17 22:10:53 +0800 test1) function pkgInstallation() { -l $ git blame -l -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac9b01d57c13d1865d58d822a81717d60f (marslo 2019-09-17 22:10:53 +0800 test1) function pkgInstallation() { --date [!TIP] check : imarslo: date format setup global in ~/.gitconfig : [blame] date=\"format:%Y-%m-%d %H:%M:%S %p\" $ for i in iso iso-strict relative local rfc short raw human unix 'format:%c' '\"format:%Y-%m-%d %H:%M:%S\"'; do cmd=\"git blame --date=${i} -L '/pkgInstallation/,+1' belloHAKubeCluster.sh\"; echo ${cmd}; eval ${cmd}; echo \"\"; done git blame --date=iso -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo 2019-09-17 22:10:53 +0800 test1) function pkgInstallation() { git blame --date=iso-strict -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo 2019-09-17T22:10:53+08:00 test1) function pkgInstallation() { git blame --date=relative -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo 2 years, 10 months ago test1) function pkgInstallation() { git blame --date=local -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo Tue Sep 17 22:10:53 2019 test1) function pkgInstallation() { git blame --date=rfc -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo Tue, 17 Sep 2019 22:10:53 +0800 test1) function pkgInstallation() { git blame --date=short -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo 2019-09-17 test1) function pkgInstallation() { git blame --date=raw -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo 1568729453 +0800 test1) function pkgInstallation() { git blame --date=human -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo Sep 17 2019 test1) function pkgInstallation() { git blame --date=unix -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo 1568729453 test1) function pkgInstallation() { git blame --date=format:%c -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo Tue Sep 17 22:10:53 2019 test1) function pkgInstallation() { git blame --date=\"format:%Y-%m-%d %H:%M:%S\" -L '/pkgInstallation/,+1' belloHAKubeCluster.sh 38327eac (marslo 2019-09-17 22:10:53 test1) function pkgInstallation() { --color-lines [!TIP] references: color.blame.repeatedLines example: [color \"blame\"] repeatedLines = 130 --color-by-age [!TIP] references: color.blame.highlightRecent BuonOmo/.gitconfig example: [color \"blame\"] highlightRecent = 239, 20 month ago, 240, 18 month ago, 241, 16 month ago, 242, 14 month ago, 243, 12 month ago, 244, 10 month ago, 245, 8 month ago, 246, 6 month ago, 247, 4 month ago, 131, 3 month ago, 137, 2 month ago, 172, 1 month ago, 167, 3 weeks ago, 166, 2 weeks ago, 203, 1 week ago, 202 // others [color \"blame\"] highlightRecent = 237, 20 month ago, 238, 19 month ago, 239, 18 month ago, 240, 17 month ago, 241, 16 month ago, 242, 15 month ago, 243, 14 month ago, 244, 13 month ago, 245, 12 month ago, 246, 11 month ago, 247, 10 month ago, 248, 9 month ago, 249, 8 month ago, 250, 7 month ago, 251, 6 month ago, 252, 5 month ago, 253, 4 month ago, 254, 3 month ago, 231, 2 month ago, 230, 1 month ago, 229, 3 weeks ago, 228, 2 weeks ago, 227, 1 week ago, 226 tricky --since $ git blame --since=3.weeks -- foo # or $ git blame v2.6.18.. -- foo for-each-ref get refs days ago while read revision branch commitDate; do benchmark=$(date +%s --date=\"1 year ago\") # echo \"benchmark: $benchmark\" if [[ commitDate -le benchmark ]]; then git for-each-ref ${branch} --format='%(refname:short) - %(align:right,20)%(committerdate:format:%Y-%m-%d %H:%M:%S)%(end)' fi done to archive $ git push origin refs/remotes/origin/sandbox/marslo/test:refs/remotes/archive/sandbox/marslo/test Total 0 (delta 0), reused 0 (delta 0), pack-reused 0 remote: Processing changes: refs: 1, done remote: GitMS - update replicated. To ssh://gerrit.domain.com:29418/storage/ssdfw/devops/jenkins * [new reference] origin/sandbox/marslo/test -> archive/sandbox/marslo/test to delete # delete local refs $ git update-ref -d refs/remotes/origin/sandbox/marslo/test -m 'already archived in refs/remotes/archive/sandbox/marslo/test' # delete remote refs $ git push . :refs/remotes/origin/sandbox/marslo/test # or delete without `refs/remotes/` $ git push origin --delete archive/sandbox/marslo/test $ git push origin --delete origin/sandbox/marslo/test delete via origin will get issue internal server error$ git push origin --force :refs/remotes/origin/sandbox/marslo/test remote: Processing changes: refs: 1, done remote: error: ref update is a no-op: DELETE: 0000000000000000000000000000000000000000 0000000000000000000000000000000000000000 refs/remotes/origin/sandbox/marslo/test To ssh://gerrit.domain.com:29418/storage/ssdfw/devops/jenkins ! [remote rejected] origin/sandbox/marslo/test (internal server error) error: failed to push some refs to 'ssh://gerrit.domain.com:29418/storage/ssdfw/devops/jenkins' to retrive # fetch single ref $ git fetch origin refs/remotes/archive/sandbox/marslo/test From ssh://gerrit.domain.com:29418/storage/ssdfw/devops/jenkins * remote-tracking branch archive/sandbox/marslo/test -> FETCH_HEAD $ git checkout FETCH_HEAD HEAD is now at 749bd27d test # fetch all ref $ git fetch origin refs/remotes/archive/*:refs/archive/* remote: Counting objects: 4507, done remote: Finding sources: 100% (57/57) remote: Total 57 (delta 20), reused 49 (delta 20) Unpacking objects: 100% (57/57), 14.52 KiB | 424.00 KiB/s, done. From ssh://gerrit.domain.com:29418/storage/ssdfw/devops/jenkins * [new ref] archive/sandbox/marslo/test -> refs/archive/sandbox/marslo/test * [new ref] archive/sandbox/marslo/sandbox -> refs/archive/sandbox/marslo/sandbox * [new ref] archive/sandbox/marslo/sample -> refs/archive/sandbox/marslo/sample format (subject) : \"the subject line\" %(subject:sanitize) : \"the-subject-line\" [!TIP] field names foramttinghttps://git-scm.com/docs/git-for-each-ref/2.21.0#Documentation/git-for-each-ref.txt---formatltformatgt git/t/t6300-for-each-ref.sh format: %00 -> \\0 (NUL) %09 -> \\t (tab) %0a -> \\n (LF) field names: head : refname: -> refs/heads/master refname:short -> master refname:lstrip=1 -> heads/master refname:lstrip=2 -> master refname:lstrip=-1 -> master refname:lstrip=-2 -> heads/master refname:rstrip=1 -> refs/heads refname:rstrip=2 -> refs refname:rstrip=-1 -> refs refname:rstrip=-2 -> refs/heads refname:strip=1 -> heads/master refname:strip=2 -> master refname:strip=-1 -> master refname:strip=-2 -> heads/master upstream -> refs/remotes/origin/master upstream:short -> origin/master upstream:lstrip=2 -> origin/master upstream:lstrip=-2 -> origin/master upstream:rstrip=2 -> refs/remotes upstream:rstrip=-2 -> refs/remotes upstream:strip=2 -> origin/master upstream:strip=-2 -> origin/master push -> refs/remotes/myfork/master push:short -> myfork/master push:lstrip=1 -> remotes/myfork/master push:lstrip=-1 -> master push:rstrip=1 -> refs/remotes/myfork push:rstrip=-1 -> refs push:strip=1 -> remotes/myfork/master push:strip=-1 -> master objecttype -> commit objectsize -> $((131 + hexlen)) objectsize:disk -> $disklen deltabase -> $ZERO_OID parent -> '' parent:short -> '' parent:short=1 -> '' parent:short=10 -> '' numparent -> 0 object -> '' type -> '' '*objectname' -> '' '*objecttype' -> '' author -> 'A U Thor 1151968724 +0200' authorname -> 'A U Thor' authoremail -> '' authoremail:trim -> 'author@example.com' authoremail:localpart -> 'author' tag -> '' tagger -> '' taggername -> '' taggeremail -> '' taggeremail:trim -> '' taggeremail:localpart -> '' taggerdate -> '' subject -> 'Initial' subject:sanitize -> 'Initial' contents:subject -> 'Initial' body -> '' contents:body -> '' contents:signature -> '' contents -> 'Initial' HEAD -> '*' objectname -> $(git rev-parse refs/heads/master) objectname:short -> $(git rev-parse --short refs/heads/master) objectname:short=1 -> $(git rev-parse --short=1 refs/heads/master) objectname:short=10 -> $(git rev-parse --short=10 refs/heads/master) tree -> $(git rev-parse refs/heads/master^{tree}) tree:short -> $(git rev-parse --short refs/heads/master^{tree}) tree:short=1 -> $(git rev-parse --short=1 refs/heads/master^{tree}) tree:short=10 -> $(git rev-parse --short=10 refs/heads/master^{tree}) authordate -> 'Tue Jul 4 01:18:44 2006 +0200' committer -> 'C O Mitter 1151968723 +0200' committername -> 'C O Mitter' committeremail -> '' committeremail:trim -> 'committer@example.com' committeremail:localpart -> 'committer' committerdate -> 'Tue Jul 4 01:18:43 2006 +0200' objectname:short=1 -> $(git rev-parse --short=1 refs/heads/master) objectname:short=10 -> $(git rev-parse --short=10 refs/heads/master) creator -> 'C O Mitter 1151968723 +0200' creatordate -> 'Tue Jul 4 01:18:43 2006 +0200' tags: refname -> refs/tags/testtag refname:short -> testtag upstream -> '' push -> '' objecttype -> tag objectsize -> $((114 + hexlen)) objectsize:disk -> $disklen '*objectsize:disk' -> $disklen deltabase -> $ZERO_OID '*deltabase' -> $ZERO_OID tree -> '' tree:short -> '' tree:short=1 -> '' tree:short=10 -> '' parent -> '' parent:short -> '' parent:short=1 -> '' parent:short=10 -> '' numparent -> '' type -> 'commit' '*objecttype' -> 'commit' author -> '' authorname -> '' authoremail -> '' authoremail:trim -> '' authoremail:localpart -> '' authordate -> '' committer -> '' committername -> '' committeremail -> '' committeremail:trim -> '' committeremail:localpart -> '' committerdate -> '' tag -> 'testtag' body -> '' contents:body -> '' contents:signature -> '' contents -> `'Tagging at 1151968727`` object -> $(git rev-parse refs/tags/testtag^0) objectname -> $(git rev-parse refs/tags/testtag) objectname:short -> $(git rev-parse --short refs/tags/testtag) '*objectname' -> $(git rev-parse refs/tags/testtag^{}) tagger -> 'C O Mitter 1151968725 +0200' taggername -> 'C O Mitter' taggeremail -> '' taggeremail:trim -> 'committer@example.com' taggeremail:localpart -> 'committer' taggerdate -> 'Tue Jul 4 01:18:45 2006 +0200' creator -> 'C O Mitter 1151968725 +0200' creatordate -> 'Tue Jul 4 01:18:45 2006 +0200' subject -> 'Tagging at 1151968727' subject:sanitize -> 'Tagging-at-1151968727' contents:subject -> 'Tagging at 1151968727' date format [!TIP] references: Specification for syntax of git dates strftime strftime format: relative local default iso ( or iso8601 ) rfc ( or rfc2822 ) short raw format:%Y-%m-%d %I:%M %p strftime : %a : Abbreviated weekday name %A : Full weekday name %b : Abbreviated month name %B : Full month name %c : Date and time representation appropriate for locale %d : Day of month as decimal number (01 – 31) %H : Hour in 24-hour format (00 – 23) %I : Hour in 12-hour format (01 – 12) %j : Day of year as decimal number (001 – 366) %m : Month as decimal number (01 – 12) %M : Minute as decimal number (00 – 59) %p : Current locale's A.M./P.M. indicator for 12-hour clock %S : Second as decimal number (00 – 59) %U : Week of year as decimal number, with Sunday as first day of week (00 – 53) %w : Weekday as decimal number (0 – 6; Sunday is 0) %W : Week of year as decimal number, with Monday as first day of week (00 – 53) %x : Date representation for current locale %X : Time representation for current locale %y : Year without century, as decimal number (00 – 99) %Y : Year with century, as decimal number %% : Percent sign %z, %Z : Either the time-zone name or time zone abbreviation, depending on registry settings how to use $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate)' Mon Aug 30 21:50:57 2021 +0800 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:relative)' 9 months ago $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:raw)' 1630331457 +0800 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:iso)' 2021-08-30 21:50:57 +0800 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:rfc)' Mon, 30 Aug 2021 21:50:57 +0800 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:local)' Mon Aug 30 21:50:57 2021 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:format:%Y-%m-%d %I:%M %p)' 2021-08-30 09:50 PM $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(committerdate:format:%Y-%m-%d %H:%M:%S)' 2021-08-30 21:50:57 color [!TIP] usage: %(color:) %(color:reset) example $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(color:yellow)%(committerdate:iso)%(color:reset)' \\ --color =always 2021-08-30 21:50:57 +0800 $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(color:blue)%(committerdate:iso)%(color:reset)' \\ --color=always 2021-08-30 21:50:57 +0800 condition [!TIP] %(if)...%(then)...%(else)...%(end) %(align:,left) ... %(end) example $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(if)%(committerdate)%(then)%(committerdate:format:%Y-%m-%d %I:%M %p)%(else)%(taggerdate:format:%Y-%m-%d %I:%M %p)%(end)' 2021-08-30 09:50 PM $ git for-each-ref --sort=-taggerdate refs/tags \\ --format='%(align:left,50)[%(objecttype) : %(refname:short)]%(end) (%(committerdate:format:%Y-%m-%d %H:%M)) ' \\ --color \\ --count=10 [commit : sandbox/marslo/tag-1] (2021-08-30 21:50) alias [alias] ### [p]retty [t]ag pt = \"!git for-each-ref --sort=-taggerdate refs/tags --format='%(color:red)%(objectname:short)%(color:reset) - %(align:left,38)%(color:bold yellow)[%(objecttype) : %(refname:short)]%(color:reset)%(end) %(subject) %(color:green)(%(if)%(taggerdate)%(then)%(taggerdate:format:%Y-%m-%d %H:%M)%(else)%(committerdate:format:%Y-%m-%d %H:%M)%(end))%(color:reset) %(color:blue)%(if)%(taggername)%(then)%(else)%(end)%(color:reset)' --color --count=10\" pts = \"!git for-each-ref --sort=-taggerdate refs/tags --format='%(color:red)%(objectname:short)%(color:reset) - %(color:bold yellow)[%(objecttype) : %(refname:short)]%(color:reset) - %(subject) %(color:green)(%(if)%(taggerdate)%(then)%(taggerdate:format:%Y-%m-%d %H:%M)%(else)%(committerdate:format:%Y-%m-%d %H:%M)%(end))%(color:reset) %(color:blue)%(if)%(taggername)%(then)%(else)%(end)%(color:reset)' --color\" ### [p]retty [b]ranch pb = \"! git for-each-ref refs/heads refs/remotes --sort=-committerdate --format='%(color:red)%(objectname:short)%(color:reset) - %(color:bold yellow)%(committerdate:format:%Y-%m-%d %H:%M:%S)%(color:reset) - %(align:left,20)%(color:cyan)%(color:reset)%(end) %(color:bold red)%(if)%(HEAD)%(then)* %(else) %(end)%(color:reset)%(refname:short)' --color --count=10\" pbs = \"! git for-each-ref refs/heads refs/remotes --sort=-committerdate --format='%(color:red)%(objectname:short)%(color:reset) - %(color:bold yellow)%(committerdate:format:%Y-%m-%d %H:%M:%S)%(color:reset) - %(align:left,20)%(color:cyan)%(color:reset)%(end) %(color:bold red)%(if)%(HEAD)%(then)* %(else) %(end)%(color:reset)%(refname:short)' --color\" Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/git/config.html":{"url":"devops/git/config.html","title":"config","keywords":"","body":" installation from source location get locations list get from all configure default configuration tig install from source references: 8.1 Customizing Git - Git Configuration Improving cross-subsystem git workflow: The different git configuration files git config git-config - Get and set repository or global options Git config 10.8 Git Internals - Environment Variables installation [!NOTE|label:references:] Download for Linux and Unix 1.5 Getting Started - Installing Git ubuntu$ sudo add-apt-repository ppa:git-core/ppa $ sudo apt update $ sudo apt install git from source [!NOTE|label:references:] 1.5 Getting Started - Installing Git index : git.git Compile and install Git from source How do I correctly install the tools in git's contrib directory? * CheckInstall$ sudo apt-get update -y && sudo apt-get install checkinstall -y MHMDhub/Install Git from source How To Install Git from Source on Ubuntu 20.04 [Quickstart] #1053: Adjusting the documentation - 1.5 installing git - getopt package dependencies [!NOTE|label:references:] * iMarslo : linux troubleshooting 1.5 Per Iniziare - Installing Git Extra Packages for Enterprise Linux (EPEL) osx * tools-scripts/build-darwin Install Git on Mac OS X git-install.sh git-install.bash Install git from source on OS X compile-git-debian10 NO_GETTEXT=true How should I resolve a \"ld: library not found for -liconv\" error when running \"cargo build\"? git-core # debian $ sudo apt install -y dh-autoreconf libexpat1-dev gettext libz-dev libssl-dev $ sudo apt install -y libcurl4-openssl-dev $ sudo apt install -y libcurl4-gnutls-dev # centos/rhel $ sudo dnf config-manager --set-enabled powertools $ sudo dnf install epel-release epel-next-release $ sudo dnf install -y dh-autoreconf libcurl-devel curl-devel expat-devel gettext-devel openssl-devel perl-devel zlib-devel # osx $ brew install gcc autoconf automake openssl@3 expat gettext zlib libtool libiconv ncurses $ brew install perl $ sudo PERL_MM_OPT=\"INSTALL_BASE=$HOME/perl5\" cpan local::lib $ eval \"$(sudo perl -I$HOME/perl5/lib/perl5 -Mlocal::lib=$HOME/perl5)\" git-doc # debian $ sudo apt install -y asciidoc xmlto docbook2x hunspell libhunspell-dev # centos/rhel $ sudo dnf install -y asciidoc xmlto docbook2X docbook-style-xsl # or $ sudo dnf install -y --enablerepo=*epel* docbook2X $ sudo ln -s /usr/bin/db2x_docbook2texi /usr/bin/docbook2x-texi # osx $ brew install asciidoc xmlto docbook2x docbook-xsl hunspell $ ln -sf /usr/local/bin/docbook2texi /usr/local/bin/docbook2x-texi git-info # debian $ sudo apt install -y install-info # centos/rhel $ sudo dnf install -y util-linux # deprecated $ sudo dnf install -y getopt # osx $ brew install gnu-getopt others # audio output $ apt install libao-dev # centos $ sudo dnf install -y libao libao-devel # osx $ brew install libao install [!NOTE|label:release package:] git-for-windows git /pub/software/scm/git/ * iMarslo : linux troubleshooting A1.4 Appendix A: Git in Other Environments - Git in Bash A1.6 Appendix A: Git in Other Environments - Git in Powershell How to make bash as default shell in git alias? $ curl -fsSL https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.42.0.tar.gz | tar -zxf -C ${iRCHOME}/utils/git && cd ${iRCHOME}/utils/git $ make configure $ ./configure --prefix=/usr/local --with-shell=/usr/local/bin/bash $ make -j all doc info $ sudo make install install-doc install-html install-info # additional $ chmod +x ${iRCHOME}/utils/git/contrib/completion/* $ sudo ln -sf ${iRCHOME}/utils/git/contrib/completion/git-prompt.sh /usr/local/libexec/git-core/git-prompt.sh $ sudo ln -sf ${iRCHOME}/utils/git/contrib/completion/git-completion.bash /usr/share/bash-completion/completions/git # or $ sudo ln -sf ${iRCHOME}/utils/git/contrib/completion/* /usr/share/doc/git/contrib/completion/ $ sudo ln -sf ${iRCHOME}/utils/git/contrib/completion/git-completion.bash /usr/share/bash-completion/completions/git result # git-for-windows $ git --version git version 2.42.0.windows.2.5.g49aad3ca52 # git $ git --version git version 2.42.0.325.g3a06386e31 pacakges: [!TIP|label:check apt package bin path without install:] $ sudo apt-file list git bins : /usr/local/bin git-core : /usr/local/libexec/git-core or $ git --exec-path diff-highlight : /usr/share/doc/git/contrib/diff-highlight/diff-highlight git-prompt.sh : /usr/local/libexec/git-core/git-prompt.sh git-completion : /usr/share/bash-completion/completions/git git-info : /usr/local/share/info bindir=$(cd '/usr/local/bin' && pwd) && \\ execdir=$(cd '/usr/local/libexec/git-core' && pwd) && \\ destdir_from_execdir_SQ=$(echo 'libexec/git-core' | sed -e 's|[^/][^/]*|..|g') && \\ { test \"$bindir/\" = \"$execdir/\" || \\ for p in git scalar git-shell git-cvsserver; do \\ rm -f \"$execdir/$p\" && \\ test -n \"\" && \\ ln -s \"$destdir_from_execdir_SQ/bin/$p\" \"$execdir/$p\" || \\ { test -z \"\" && \\ ln \"$bindir/$p\" \"$execdir/$p\" 2>/dev/null || \\ cp \"$bindir/$p\" \"$execdir/$p\" || exit; } \\ done; \\ } && \\ for p in git-receive-pack git-upload-archive git-upload-pack; do \\ rm -f \"$bindir/$p\" && \\ test -n \"\" && \\ ln -s \"git\" \"$bindir/$p\" || \\ { test -z \"\" && \\ ln \"$bindir/git\" \"$bindir/$p\" 2>/dev/null || \\ ln -s \"git\" \"$bindir/$p\" 2>/dev/null || \\ cp \"$bindir/git\" \"$bindir/$p\" || exit; }; \\ done && \\ for p in git-add git-am git-annotate git-apply git-archive git-bisect git-blame git-branch git-bugreport git-bundle git-cat-file git-check-attr git-check-ignore git-check-mailmap git-check-ref-format git-checkout--worker git-checkout-index git-checkout git-clean git-clone git-column git-commit-graph git-commit-tree git-commit git-config git-count-objects git-credential-cache--daemon git-credential-cache git-credential-store git-credential git-describe git-diagnose git-diff-files git-diff-index git-diff-tree git-diff git-difftool git-fast-export git-fast-import git-fetch-pack git-fetch git-fmt-merge-msg git-for-each-ref git-for-each-repo git-fsck git-fsmonitor--daemon git-gc git-get-tar-commit-id git-grep git-hash-object git-help git-hook git-index-pack git-init-db git-interpret-trailers git-log git-ls-files git-ls-remote git-ls-tree git-mailinfo git-mailsplit git-merge-base git-merge-file git-merge-index git-merge-ours git-merge-recursive git-merge-tree git-merge git-mktag git-mktree git-multi-pack-index git-mv git-name-rev git-notes git-pack-objects git-pack-redundant git-pack-refs git-patch-id git-prune-packed git-prune git-pull git-push git-range-diff git-read-tree git-rebase git-receive-pack git-reflog git-remote-ext git-remote-fd git-remote git-repack git-replace git-rerere git-reset git-rev-list git-rev-parse git-revert git-rm git-send-pack git-shortlog git-show-branch git-show-index git-show-ref git-sparse-checkout git-stash git-stripspace git-submodule--helper git-symbolic-ref git-tag git-unpack-file git-unpack-objects git-update-index git-update-ref git-update-server-info git-upload-archive git-upload-pack git-var git-verify-commit git-verify-pack git-verify-tag git-worktree git-write-tree git-cherry git-cherry-pick git-format-patch git-fsck-objects git-init git-maintenance git-merge-subtree git-restore git-show git-stage git-status git-switch git-version git-whatchanged; do \\ rm -f \"$execdir/$p\" && \\ if test -z \"\"; \\ then \\ test -n \"\" && \\ ln -s \"$destdir_from_execdir_SQ/bin/git\" \"$execdir/$p\" || \\ { test -z \"\" && \\ ln \"$execdir/git\" \"$execdir/$p\" 2>/dev/null || \\ ln -s \"git\" \"$execdir/$p\" 2>/dev/null || \\ cp \"$execdir/git\" \"$execdir/$p\" || exit; }; \\ fi \\ done && \\ remote_curl_aliases=\"git-remote-https git-remote-ftp git-remote-ftps\" && \\ for p in $remote_curl_aliases; do \\ rm -f \"$execdir/$p\" && \\ test -n \"\" && \\ ln -s \"git-remote-http\" \"$execdir/$p\" || \\ { test -z \"\" && \\ ln \"$execdir/git-remote-http\" \"$execdir/$p\" 2>/dev/null || \\ ln -s \"git-remote-http\" \"$execdir/$p\" 2>/dev/null || \\ cp \"$execdir/git-remote-http\" \"$execdir/$p\" || exit; } \\ done install -d -m 755 '/usr/local/share/man/man3' (cd perl/build/man/man3 && tar cf - .) | \\ (cd '/usr/local/share/man/man3' && umask 022 && tar xof -) location [!NOTE|label:locations] Where system, global and local Git config files on Windows and Ubuntu Linux are Where do the settings in my Git configuration come from? git on Windows - location of configuration files SCOPE WINDOWS UNIX-LIKE system \\etc\\gitconfig /etc/gitconfig system example %LOCALAPPDATA%\\Programs\\Git\\etc\\gitconfig /usr/local/etc/gitconfig global %USERPROFILE%\\.gitconfig $HOME/.gitconfig local \\.git\\config /.git/config portable %PROGRAMDATA%\\Git\\config - get locations windows > git config --list --show-origin --name-only | sed -r 's/^file:(.+)\\s+.*$/\\1/g' | sort.exe /unique REM or > git config --list --show-origin --name-only | sed -r 's/^file:(.+)\\s+.*$/\\1/g' | powershell -nop \"$input | sort -unique\" REM or > git config --list --show-origin --name-only | sed -r 's/^file:(.+)\\s+.*$/\\1/g' | powershell -nop \"$input | Sort-Object -unique\" .git/config C:/Users/marslo/.gitconfig C:/Users/marslo/AppData/Local/Programs/Git/etc/gitconfig osx $ git config --list --show-origin --name-only | awk -F'[:[:blank:]]' '{print $2}' | sort -u .git/config /Users/marslo/.gitconfig /Users/marslo/.marslo/.gitalias /usr/local/etc/gitconfig edit config file $ git config --edit --system $ git config --edit --global # or $ sudo git -c core.editor=ls\\ -al config --system --edit list list all with scope $ git config --list --show-scope system credential.helper=osxkeychain system core.ignorecase=false system filter.lfs.clean=git-lfs clean -- %f list origin $ git config --list --show-origin --show-scope system file:/usr/local/etc/gitconfig credential.helper=osxkeychain system file:/usr/local/etc/gitconfig core.ignorecase=false system file:/usr/local/etc/gitconfig filter.lfs.clean=git-lfs clean -- %f list single scope only list local only $ git config --list --local core.repositoryformatversion=0 core.filemode=true core.bare=false list global $ git config --list --global user.name=marslo user.email=marslo@gmail.com push.default=matching list system $ git config --list --system credential.helper=osxkeychain core.ignorecase=false filter.lfs.clean=git-lfs clean -- %f filter.lfs.smudge=git-lfs smudge -- %f filter.lfs.process=git-lfs filter-process filter.lfs.required=true get from all configure $ git config --show-origin --show-scope --get-all user.name global file:/Users/marslo/.gitconfig marslo local file:.git/config marslo default configuration core.editor use vim ( the ubiqutos text editor ) as Git's default editor$ git config --get core.editor vim init.defaultBranch override the default branch name for new repositories$ git config --get init.defaultBranch development core.autocrlf [!TIP|label:see also:] * iMarslo : core.autocrlf checkout windows-style, commit unix-style line endings$ git config --get core.autocrlf true checkout as-is, commit unix-style line endings$ git config --get core.autocrlf input checkout as-is, commit as-is$ git config --get core.autocrlf false pull.rebase $ git config --get pull.rebase true core.fscache & core.symlinks enable file system caching $ git config --get core.fscache true enable symbolic links $ git config --get core.symlinks true core.fsmonitor enable experimental built-in file system monitor$ git config --get core.fsmonitor true tig [!NOTE|label:references:] How to fix \"fatal error: ncursesw/ncurses.h: No such file or directory\" tig : Installation instructions Tig - cheat sheet # ubuntu $ sudo apt-get install libncursesw5-dev # centos/rhel $ sudo yum install ncurses-devel $ git clone git@github.com:jonas/tig.git ${iRCHOME}/utils/ && cd !$/tig $ make -j prefix=/usr/local $ sudo make install prefix=/usr/local $ /usr/local/bin/tig --version tig version 2.5.8-5-g1894954 ncursesw version 6.3.20211021 install from source $ git clone git@github.com:jonas/tig.git && cd tig $ make # or $ make prefix=/usr/local $ make install # or $ sudo make install prefix=/usr/local $ sudo make install-doc INSTALL doc/tig.1 -> /root/share/man/man1 INSTALL doc/tigrc.5 -> /root/share/man/man5 INSTALL doc/tigmanual.7 -> /root/share/man/man7 INSTALL doc/tig.1.html -> /root/share/doc/tig INSTALL doc/tigrc.5.html -> /root/share/doc/tig INSTALL doc/manual.html -> /root/share/doc/tig INSTALL README.html -> /root/share/doc/tig INSTALL INSTALL.html -> /root/share/doc/tig INSTALL NEWS.html -> /root/share/doc/tig # or $ [sudo] make install-release-doc GIT_INDEX_FILE=.tmp-doc-index git read-tree origin/release GIT_INDEX_FILE=.tmp-doc-index git checkout-index -f --prefix=./ doc/tig.1 doc/tigrc.5 doc/tigmanual.7 rm -f .tmp-doc-index make install-doc-man make[1]: Entering directory '/home/marslo/iMarslo/tools/git/tools/tig' INSTALL doc/tig.1 -> /home/marslo/share/man/man1 INSTALL doc/tigrc.5 -> /home/marslo/share/man/man5 INSTALL doc/tigmanual.7 -> /home/marslo/share/man/man7 make[1]: Leaving directory '/home/marslo/iMarslo/tools/git/tools/tig' GIT_INDEX_FILE=.tmp-doc-index git read-tree origin/release GIT_INDEX_FILE=.tmp-doc-index git checkout-index -f --prefix=./ doc/tig.1.html doc/tigrc.5.html doc/manual.html README.html INSTALL.html NEWS.html rm -f .tmp-doc-index make install-doc-html make[1]: Entering directory '/home/marslo/iMarslo/tools/git/tools/tig' GEN doc/manual.toc ASCIIDOC doc/manual.html INSTALL doc/tig.1.html -> /home/marslo/share/doc/tig INSTALL doc/tigrc.5.html -> /home/marslo/share/doc/tig INSTALL doc/manual.html -> /home/marslo/share/doc/tig INSTALL README.html -> /home/marslo/share/doc/tig INSTALL INSTALL.html -> /home/marslo/share/doc/tig INSTALL NEWS.html -> /home/marslo/share/doc/tig make[1]: Leaving directory '/home/marslo/iMarslo/tools/git/tools/tig' result $ which -a tig /usr/local/bin/tig $ tig --version tig version 2.5.8-17-ge543cfe ncursesw version 6.1.20180224 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-06 21:20:42 "},"devops/git/alias.html":{"url":"devops/git/alias.html","title":"alias","keywords":"","body":" basic pretty show branch commit and push find alias get Change-Ids revision count [!NOTE|label:references:] Must Have Git Aliases: Advanced Examples mwhite/git-aliases.md How to make bash as default shell in git alias? basic [alias] aa = add --all st = status -sb sts = status rb = rebase co = checkout --force --recurse-submodules cb = rev-parse --abbrev-ref HEAD cl = clean -dffx cn = clone --recurse-submodules --tags cp = cherry-pick wc = whatchanged gca = gc --aggressive fa = fetch --prune --prune-tags --force --all ma = merge --all --progress psa = push origin --all pst = push origin --tags root = rev-parse --show-toplevel first = rev-list --max-parents=0 HEAD last = cat-file commit HEAD undo = reset HEAD~1 --mixed ### [c]onflict [f]ile cf = \"! bash -c 'grep --color=always -rnw \\\"^pretty show [alias] ### [p]retty [t]ag ls = log --stat --pretty=short --graph ### [p]retty [l]og(s) pl = !git --no-pager log --color --graph --pretty=tformat:'%C(red)%h%C(reset) -%C(yellow)%d%C(reset) %s %C(green)(%cr) %C(blue)%C(reset)' --abbrev-commit --date=relative --max-count=3 pls = log --color --graph --pretty=tformat:'%C(red)%h%C(reset) -%C(yellow)%d%C(reset) %s %C(green)(%cr)%C(reset) %C(blue)%C(reset)' --abbrev-commit --date=relative ### [p]revious branch [p]retty [l]og ppl = !git --no-pager log --color --graph --pretty=tformat:'%C(red)%h%C(reset) -%C(yellow)%d%C(reset) %s %C(green)(%cr) %C(blue)%C(reset)' --abbrev-commit --date=relative --max-count=3 @{-1} ### [f]ull [p]retty [l]log fpl = log --color --graph --pretty=tformat:'%C(red)%H%C(reset) -%C(yellow)%d%C(reset) %s %C(green)(%cr)%C(reset) %C(blue)%C(reset)' --abbrev-commit --date=relative ### Showing all branches and their relationshps tree = log --color --graph --pretty=oneline --format=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)' --decorate --abbrev-commit --all clog = log --color --graph --all --decorate --simplify-by-decoration --oneline ### [p]retty [t]ag(s) pt = \"! git for-each-ref --sort=-taggerdate refs/tags --format='%(color:red)%(objectname:short)%(color:reset) - %(align:left,38)%(color:bold yellow)[%(objecttype) : %(refname:short)]%(color:reset)%(end) %(subject) %(color:green)(%(if)%(taggerdate)%(then)%(taggerdate:format:%Y-%m-%d %H:%M:%S)%(else)%(committerdate:format:%Y-%m-%d %H:%M:%S)%(end))%(color:reset) %(color:blue)%(if)%(taggername)%(then)%(else)%(end)%(color:reset)' --color --count=10\" pts = \"! git for-each-ref --sort=-taggerdate refs/tags --format='%(color:red)%(objectname:short)%(color:reset) - %(color:bold yellow)[%(objecttype) : %(refname:short)]%(color:reset) - %(subject) %(color:green)(%(if)%(taggerdate)%(then)%(taggerdate:format:%Y-%m-%d %H:%M:%S)%(else)%(committerdate:format:%Y-%m-%d %H:%M:%S)%(end))%(color:reset) %(color:blue)%(if)%(taggername)%(then)%(else)%(end)%(color:reset)' --color\" # https://stackoverflow.com/a/53535353/2940319 ### [p]retty [b]ranch(s) pb = \"! git for-each-ref refs/heads refs/remotes --sort=-committerdate --format='%(color:red)%(objectname:short)%(color:reset) - %(color:bold yellow)%(committerdate:format:%Y-%m-%d %H:%M:%S)%(color:reset) - %(align:left,20)%(color:cyan)%(color:reset)%(end) %(color:bold red)%(if)%(HEAD)%(then)* %(else) %(end)%(color:reset)%(refname:short)' --color --count=10\" pbs = \"! git for-each-ref refs/heads refs/remotes --sort=-committerdate --format='%(color:red)%(objectname:short)%(color:reset) - %(color:bold yellow)%(committerdate:format:%Y-%m-%d %H:%M:%S)%(color:reset) - %(align:left,20)%(color:cyan)%(color:reset)%(end) %(color:bold red)%(if)%(HEAD)%(then)* %(else) %(end)%(color:reset)%(refname:short)' --color\" ### sort local/remote branch via committerdate (DESC). usage: $ git recent; $ git recent remotes 10 recent = \"!f() { \\ declare help=\\\"USAGE: git recent [remotes|tags] [count]\\\"; \\ declare refs; \\ declare count; \\ if [ 2 -lt $# ]; then \\ echo \\\"${help}\\\"; \\ exit 1; \\ else \\ if [ 'remotes' = \\\"$1\\\" ]; then \\ refs='refs/remotes/origin'; \\ elif [ 'tags' = \\\"$1\\\" ]; then \\ refs='refs/tags'; \\ elif [ 1 -eq $# ]; then \\ count=$1; \\ fi; \\ if [ 2 -eq $# ]; then \\ count=$2; \\ fi; \\ fi; \\ git for-each-ref \\ --sort=-committerdate \\ ${refs:='refs/heads'} \\ --format='%(HEAD) %(color:yellow)%(refname:short)%(color:reset) - %(color:red)%(objectname:short)%(color:reset) - %(contents:subject) - %(authorname) %(color:green)(%(committerdate:relative))%(color:reset)' \\ --color=always \\ --count=${count:=5}; \\ }; f \\ \" branch [alias] ### [s]ort [b]ranch sb = \"! git branch --sort=-committerdate --format='%(HEAD) %(color:red)%(objectname:short)%(color:reset) - %(color:yellow)%(refname:short)%(color:reset) - %(subject) %(color:bold green)(%(committerdate:relative))%(color:reset) %(color:blue)%(color:reset)' --color=always\" # [c]urrent [b]ranch rbr = \"! f(){ git branch -ra | grep $1; }; f\" commit and push [alias] # [c]ommit -[a]m ca = \"!f() { \\ git add --all $(git rev-parse --show-toplevel) ; \\ git commit -am \\\"$1\\\" ; \\ }; f \\ \" ### [c]omm[i]t --[a]mend cia = \"!f() { \\ declare authorDate=\\\"${GIT_AUTHOR_DATE}\\\"; \\ declare commiterDate=\\\"${GIT_COMMITTER_DATE}\\\"; \\ OPT='commit --amend --allow-empty'; \\ if [ 0 -eq $# ]; then \\ git ${OPT} ; \\ else \\ if [ \\\"o\\\" == \\\"$1\\\" ] || [ \\\"original\\\" == \\\"$1\\\" ]; then \\ declare dd=\\\"$(git log -n 1 --format=%aD)\\\"; \\ export GIT_AUTHOR_DATE=\\\"${dd}\\\"; \\ export GIT_COMMITTER_DATE=\\\"${dd}\\\"; \\ git ${OPT} --date=\\\"${dd}\\\" -m \\\"${@:2}\\\" ; \\ else \\ git ${OPT} -m \\\"$@\\\" ; \\ fi; \\ unset GIT_AUTHOR_DATE; \\ unset GIT_COMMITTER_DATE; \\ fi; \\ }; f \\ \" ### [m]arslo force [p]ush mp = \"! bash -c 'while read branch; do \\n\\ echo -e \\\"\\\\033[1;33m~~> ${branch}\\\\033[0m\\\" \\n\\ git add --all $(git rev-parse --show-toplevel) \\n\\ git commit --amend --no-edit \\n\\ if [ 'meta/config' == \\\"${branch}\\\" ]; then \\n\\ git push -u --force origin HEAD:refs/meta/config \\n\\ git fetch origin --force refs/meta/config:refs/remotes/origin/meta/config ; \\n\\ git reset --hard remotes/origin/${branch} ; \\n\\ else \\n\\ git push -u --force origin ${branch} \\n\\ fi \\n\\ done find alias [alias] # https://stackoverflow.com/q/53841043/2940319 ### show [g]it alia[s] as = \"! bash -c '''grep --no-group-separator -A1 -e \\\"^\\\\s*###\\\" \\\"$HOME\\\"/.marslo/.gitalias | \\n\\ awk \\\"END{if((NR%2))print p}!(NR%2){print\\\\$0p}{p=\\\\$0}\\\" | \\n\\ sed -re \\\"s/( =)(.*)(###)/*/g\\\" | \\n\\ sed -re \\\"s:[][]::g\\\" | \\n\\ awk -F* \\\"{printf \\\\\\\"\\\\033[1;33m%-20s\\\\033[0m » \\\\033[0;34m%s\\\\033[0m\\\\n\\\\\\\", \\\\$1, \\\\$2}\\\" | \\n\\ sort \\n\\ ''' \\n\\ \" # https://brettterpstra.com/2014/08/04/shell-tricks-one-git-alias-to-rule-them-all/ ### [find] [a]lias by keywords finda = \"!grepalias() { git config --get-regexp alias | \\ grep -i \\\"$1\\\" | \\ awk -v nr=2 '{ \\ sub(/^alias\\\\./,\\\"\\\") }; \\ {printf \\\"\\\\033[31m%15s :\\\\033[1;37m\\\", $1}; \\ {sep=FS}; \\ { for (x=nr; xget Change-Ids [alias] ### [c]hange-[i][d] cid = \"!f() { \\ ref='HEAD'; \\ if [ 0 -ne $# ]; then ref=\\\"$@\\\"; fi; \\ echo \\\"\\\\033[1;33m~~> Commit-Id : Change-Id :\\\\033[0m\\\"; \\ git --no-pager log -1 --no-color ${ref} | \\ sed -nr 's!^commit\\\\s*(.+)$!\\\\1!p; s!^\\\\s*Change-Id:\\\\s*(.*$)!\\\\1!p' | \\ awk '{ key=$0; getline; print key \\\" : \\\" $0; }'; \\ }; f \\ \" ### [c]hange-[i][d][s] cids = \"!f() { \\ OPT='-3'; \\ if [ 0 -ne $# ]; then OPT=\\\"$@\\\"; fi; \\ echo \\\"\\\\033[1;33m~~> Commit-Id : Change-Id :\\\\033[0m\\\"; \\ git --no-pager log --no-color ${OPT} | \\ sed -nr 's!^commit\\\\s*(.+)$!\\\\1!p; s!^\\\\s*Change-Id:\\\\s*(.*$)!\\\\1!p' | \\ awk '{ key=$0; getline; print key \\\" : \\\" $0; }'; \\ }; f \\ \" ### [c]hange-[i][d] to [rev]sion cid2rev = \"!f() { \\ if [ 0 -ne $# ]; then \\ changeId=\\\"$@\\\" ; \\ for _i in $(git rev-list --do-walk HEAD); do \\ if git --no-pager show ${_i} --no-patch --format='%B' | grep -F \\\"Change-Id: ${changeId}\\\" >/dev/null 2>&1; then \\ echo ${_i} ; \\ break ; \\ fi ; \\ done ; \\ else \\ exit 1; \\ fi; \\ }; f \\ \" ### [c]hange-[id] [rev]ision [count] cid-rev-count = \"!f() { \\ echo \\\"\\\\033[1;33m~~> Revision-Count : Commit-Id : Change-Id :\\\\033[0m\\\"; \\ git rev-list --no-color --reverse HEAD | nl | sort -nr | \\ while read number revision; do \\ cid=$(git show -s \\\"${revision}\\\" --format='%B' | sed -rn 's/^\\\\s*Change-Id:\\\\s*(.+)$/\\\\1/p') ; \\ if [[ \\\"${cid}\\\" = \\\"$1\\\" ]]; then echo \\\"${number} : ${revision} : ${cid}\\\"; break; fi; \\ done; \\ }; f\" revision count [alias] show-rev = \"!f(){ git rev-list --count $1; }; f\" rev-number = \"!bash -c 'git rev-list --reverse HEAD | nl | sort -nr | awk \\\"{ if(\\\\$1 == \"$0\") { print \\\\$2 }}\\\"'\" rev-count = \"!f() { \\ declare hash=$(git rev-parse \\\"$1\\\"); \\ git rev-list --no-color --reverse HEAD | nl | sort -nr | \\ while read number revision ; do \\ if [[ \\\"${revision}\\\" = \\\"${hash}\\\" ]]; then echo \\\"${number}\\\"; break; fi; \\ done; \\ }; f\" ### [c]hange-[id] [rev]ision [count] cid-rev-count = \"!f() { \\ echo \\\"\\\\033[1;33m~~> Revision-Count : Commit-Id : Change-Id :\\\\033[0m\\\"; \\ git rev-list --no-color --reverse HEAD | nl | sort -nr | \\ while read number revision; do \\ cid=$(git show -s \\\"${revision}\\\" --format='%B' | sed -rn 's/^\\\\s*Change-Id:\\\\s*(.+)$/\\\\1/p') ; \\ if [[ \\\"${cid}\\\" = \\\"$1\\\" ]]; then echo \\\"${number} : ${revision} : ${cid}\\\"; break; fi; \\ done; \\ }; f\" show-remote-rev = \"!bash -c 'git ls-remote --heads $(git config --get remote.origin.url) | \\n\\ grep \\\"refs/heads/$0\\\" | \\n\\ cut -f 1 \\n\\ ' \\n\\ \" revset = \"!bash -c 'ix=0; for ih in $(git rev-list --reverse HEAD); do \\n\\ TCMD=\\\"git notes --ref linrev\\\"; \\n\\ TCMD=\\\"$TCMD add $ih -m \\\\\\\"(r\\\\$((++ix)))\\\\\\\"\\\"; \\n\\ eval \\\"$TCMD\\\"; \\n\\ done; \\n\\ echo \\\"Linear revision notes are set.\\\" \\n\\ ' \\n\\ \" revunset = \"!bash -c 'ix=0; for ih in $(git rev-list --reverse HEAD); do \\n\\ TCMD=\\\"git notes --ref linrev\\\"; \\n\\ TCMD=\\\"$TCMD remove $ih\\\"; \\n\\ eval \\\"$TCMD 2>/dev/null\\\"; \\n\\ done; \\n\\ echo \\\"Linear revision notes are unset.\\\" \\n\\ ' \\n\\ \" Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/git/submodule.html":{"url":"devops/git/submodule.html","title":"submodule","keywords":"","body":" init submodule update submodule revert changes in submodule submodule update history list submodules HEAD:.gitmodules get name get path get url get branch working with submodule pull from remote push to remote remove submodule [!TIP|label:reference:] Git Submodules git-submodule - Initialize, update or inspect submodules gitmodules - Defining submodule properties Gerrit Code Review - Superproject subscription to submodules updateshttps://gerrit-review.googlesource.com/Documentation/user-submodules.html init submodule $ git submodule add --name -b $ git submodule init $ git submodule update --init i.e.:$ git submodule add --name ansible-completion \\ -b master \\ https://github.com/dysosmus/ansible-completion.git \\ confs/home/.marslo/.completion/ansible-completion $ git submodule add --name bash-completion \\ -b master \\ https://github.com/scop/bash-completion.git \\ confs/home/.marslo/bin/bash-completion $ git submodule init $ git submodule update --init update submodule # update branch $ git config -f .gitmodules submodule..branch $ git submodule update --remote revert changes in submodule references: How do I revert my changes to a git submodule? nicktoumpelis/repo-rinse.sh $ git submodule deinit -f . $ git submodule update --init or$ git submodule foreach --recursive git clean -dffx $ git submodule foreach --recursive git reset --hard submodule update history references: Git - View history for a specific submodule with corresponding hashes $ git log --oneline [--name-only] -- /path/to/submodule # list all $ git config --blob HEAD:.gitmodules --get-regexp path | awk '{print $NF}' | xargs -I{} bash -c \"echo -e \\\"\\\\n~~> {}:\\\"; git log -1 --oneline -- {}\" list submodules [!TIP|label:references:] git plumbing command to get submodule remote Get submodule hash from bare repository How to make shallow git submodules? example: $ git config --blob HEAD:.gitmodules --get-regexp [url|branch|path] # or $ git config --blob HEAD:.gitmodules --get-regexp ^submodule.\\(.+\\).\\(path\\|url\\|branch\\) HEAD:.gitmodules $ git config --blob HEAD:.gitmodules --list # or $ git show HEAD:.gitmodules | git config --file - --list get dynamic refs $ git cat-file -p :.gitmodules # or $ git show -p :.gitmodules get name $ git submodule foreach --quiet 'echo $name' # or $ git submodule foreach --quiet 'echo $name' | xargs -I{} bash -c \"git ls-tree -z -d HEAD -- {}; echo ''\" get path $ git show HEAD:.gitmodules | git config --file - --get-regexp path # or $ git --no-pager config \\ --file \\$(git rev-parse --show-toplevel)/.gitmodules \\ --get-regexp ^submodule.\\\\(.+\\\\).path get url $ git show HEAD:.gitmodules | git config --file - --get-regexp url # or $ git --no-pager config \\ --file \\$(git rev-parse --show-toplevel)/.gitmodules \\ --get-regexp ^submodule.\\\\(.+\\\\).url # or $ git submodule foreach -q git config remote.origin.url # or $ find .git/modules/ -name config -exec grep url {} \\; # or $ git config --list | grep -E ^submodule.*.url get branch $ git config --blob HEAD:.gitmodules --get-regexp branch working with submodule pull from remote update submodule only$ git submodule update --remote --recursive --force --rebase update both super and submodule$ git pull [--rebase] --recurse-submodules push to remote push submodule only$ cd ./path/to/submodule $ git push --recurse-submodule=on-demand push for both super and submodule $ cd ./path/to/submodule $ git add --all $ git commit -am \".. comments here ..\" $ git push --recurse-submodule=on-demand $ cd $(git rev-parse --show-superproject-working-tree) # or: https://stackoverflow.com/a/7359782/2940319 $ cd $(git rev-parse --show-superproject-working-tree --show-toplevel | head -1) $ git add --all $ git commit -am \".. comments here ..\" $ git push origin $(git rev-parse --abbrev-ref HEAD) remove submodule references: How do I remove a submodule? The best way to remove a submodule from git $ git submodule deinit -f ### operational $ git rm --cached $ rm -rf $ rm -rf .git/modules/ $ git config -f .gitmodules --remove-section submodule. ### or $ rm -rf .gitmodules $ git config -f .git/config --remove-section submodule. ### or $ vim .git/config Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/git/eol.html":{"url":"devops/git/eol.html","title":"eol","keywords":"","body":" list list eol in repo list config check one by one theory core.autocrlf set in GUI please notice practice force using lf in both remote and local ignore warning: LF will be replaced by CRLF [!NOTE|label:references:] git-config - Get and set repository or global options git config Git config Force LF eol in git repo and working copy list list eol in repo $ git ls-files --eol # list all crlf $ git ls-files --eol | grep '/crlf' # list all lf which not been controlled by gitattributes file $ git ls-files --eol | grep -E '[iw]/lf' | grep -v -E 'attr/.+eol=' or $ find . -type f -exec sh -c \"file {} | grep 'with CRLF'\" \\; # or $ find . -type f -follow -print0 | xargs -0 file | grep 'with CRLF' # or get file list $ find . -type f -exec sh -c \"file {} | grep 'with CRLF'\" \\; | awk -F':' '{print $1}' list config get all config : --get-all$ git config --show-origin --show-scope --get-all core.autocrlf global file:/home/marslo/.gitconfig false local file:.git/config input get active config : --get $ git config --show-origin --show-scope --get core.autocrlf local file:.git/config input core.eol $ git config --show-origin --show-scope --get core.eol global file:/home/marslo/.gitconfig lf $ git config --show-origin --show-scope --get-all core.eol global file:/home/marslo/.gitconfig lf core.safecrlf $ git config --show-origin --show-scope --get-all core.safecrlf global file:/home/marslo/.gitconfig warn check one by one worktree $ git config --worktree --show-scope --show-origin --get-all core.autocrlf local file:.git/config input local $ git config --local --show-scope --show-origin --get-all core.autocrlf local file:.git/config input system $ git config --system --show-scope --show-origin --get-all core.autocrlf global $ git config --global --show-scope --show-origin --get-all core.autocrlf global file:/home/marslo/.gitconfig false theory core.autocrlf parameters core.autocrlf false input true git commit lf > lf cr > cr crlf > crlf lf > lf cr > cr crlf > lf lf > lf cr > cr crlf > lf git checkout lf > lf cr > cr crlf > crlf lf > lf cr > cr crlf > crlf lf > lf cr > cr crlf > crlf normally, it will looks like core.autocrlf=true: core.autocrlf=input: core.autocrlf=false: repo repo repo ^ V ^ V ^ V / \\ / \\ / \\ crlf->lf lf->crlf crlf->lf \\ / \\ / \\ / \\ / \\ set in GUI checkout Windows-style, commit Unix-style line endings: $ git config --global core.autocrlf true Text files checked-out from the repository that have only LF characters are normalized to CRLF in your working tree; files that contain CRLF in the repository will not be touched Text files that have only LF characters in the repository, are normalized from CRLF to LF when committed back to the repository. Files that contain CRLF in the repository will be committed untouched. Checkout as-is, commit Unix-Style line endings: $ git config --global core.autocrlf input Text files checked-out from the repository will keep original EOL characters in your working tree. Text files in your working tree with CRLFcharacters are normalized to LF when committed back to the repository. Checkout as-is, commit as-is: $ git config --global core.autocrlf false core.eol dictates EOL characters in the text files of your working tree. core.eol = native by default, which means Windows EOLs are CRLF and *nix EOLs are LF in working trees. Repository gitattributes settings determines EOL character normalization for commits to the repository (default is normalization to LF characters). please notice eol This attribute sets a specific line-ending style to be used in the working directory. It enables end-of-line conversion without any content checks, effectively setting the text attribute. Note that setting this attribute on paths which are in the index with CRLF line endings may make the paths to be considered dirty. Adding the path to the index again will normalize the line endings in the index. practice force using lf in both remote and local $ git config core.eol lf $ git config core.autocrlf input or$ git config --global core.eol lf $ git config --global core.autocrlf input ignore warning: LF will be replaced by CRLF $ git config --global core.safecrlf false Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/git/example.html":{"url":"devops/git/example.html","title":"example","keywords":"","body":" rebase Without Confilite file With Confilite file rebase Without Confilite file Precondiction $ git pl 37a0595 - (HEAD, master) 2: 2.txt (5 seconds ago) 1d9bcce - Initial commit (65 minutes ago) $ git rlog 4e3106e - (origin/master, origin/HEAD) 1: 1.txt (2 minutes ago) 1d9bcce - Initial commit (65 minutes ago) $ git br master $ git push To git@github.com:Marslo/GitStudy.git ! [rejected] master -> master (non-fast-forward) error: failed to push some refs to 'git@github.com:Marslo/GitStudy.git' hint: Updates were rejected because the tip of your current branch is behind hint: its remote counterpart. Merge the remote changes (e.g. 'git pull') hint: before pushing again. hint: See the 'Note about fast-forwards' in 'git push --help' for details. Merge with rebase Use command: git pulll --rebase $ git pull --rebase First, rewinding head to replay your work on top of it... Applying: 2: 2.txt Check the status after pull rebase Check the status The status of meraged file hasn't been changed $ git st # On branch master # Your branch is ahead of 'origin/master' by 1 commit. # (use \"git push\" to publish your local commits) # nothing to commit, working directory clean The branch hasn't been changed $ git br master Log added the remote new version $ git pl 7bc54e0 - (HEAD, master) 2: 2.txt (12 seconds ago) 4e3106e - (origin/master, origin/HEAD) 1: 1.txt (4 minutes ago) 1d9bcce - Initial commit (68 minutes ago) $ git rlog 4e3106e - (origin/master, origin/HEAD) 1: 1.txt (4 minutes ago) 1d9bcce - Initial commit (68 minutes ago) With Confilite file Precondiction $ git pl 94a5935 - (HEAD, master) 2: 1 (25 seconds ago) 1d9bcce - Initial commit (25 minutes ago) $ git rlog b9709fe - (origin/master, origin/HEAD) 1: 1 (71 seconds ago) $ git br master $ git push To git@github.com:Marslo/GitStudy.git ! [rejected] master -> master (non-fast-forward) error: failed to push some refs to 'git@github.com:Marslo/GitStudy.git' hint: Updates were rejected because the tip of your current branch is behind hint: its remote counterpart. Merge the remote changes (e.g. 'git pull') hint: before pushing again. hint: See the 'Note about fast-forwards' in 'git push --help' for details. Merge by rebase Using command: git pull --rebase $ git pull --rebase First, rewinding head to replay your work on top of it... Applying: 2: 1 Using index info to reconstruct a base tree... M README.md Falling back to patching base and 3-way merge... Auto-merging README.md CONFLICT (content): Merge conflict in README.md Failed to merge in the changes. Patch failed at 0001 2: 1 The copy of the patch that failed is found in: /home/marslo/Tools/Git/2_GitStudy/.git/rebase-apply/patch When you have resolved this problem, run \"git rebase --continue\". If you prefer to skip this patch, run \"git rebase --skip\" instead. To check out the original branch and stop rebasing, run \"git rebase --abort\". Check the status after pull rebase branch is changed (master -> no branch) $ git br (no branch, rebasing master) master Status from unchanged and staged -> Umerged $ git st # HEAD detached at b9709fe # You are currently rebasing branch 'master' on 'b9709fe'. # (fix conflicts and then run \"git rebase --continue\") # (use \"git rebase --skip\" to skip this patch) # (use \"git rebase --abort\" to check out the original branch) # # Unmerged paths: # (use \"git reset HEAD ...\" to unstage) # (use \"git add ...\" to mark resolution) # # both modified: README.md # no changes added to commit (use \"git add\" and/or \"git commit -a\") Log changed: New committed version has been removed Remote new version has been *added $ git rlog b9709fe - (HEAD, origin/master, origin/HEAD) 1: 1 (2 minutes ago) 1d9bcce - Initial commit (26 minutes ago) $ git pl b9709fe - (HEAD, origin/master, origin/HEAD) 1: 1 (2 minutes ago) 1d9bcce - Initial commit (26 minutes ago) The conflicted file has been meraged $ git add . $ git st # HEAD detached at b9709fe # You are currently rebasing branch 'master' on 'b9709fe'. # (all conflicts fixed: run \"git rebase --continue\") # # Changes to be committed: # (use \"git reset HEAD ...\" to unstage) # # modified: README.md # $ git br (no branch, rebasing master) master $ git diff --staged diff --git a/README.md b/README.md index b1acca3..12afed2 100644 --- a/README.md +++ b/README.md @@ -1 +1,5 @@ +>>>>>> 2: 1 open all conflicted files $ git diff --name-only --diff-filter=U | uniq | xargs $EDITOR Return to master branch $ git rebase --continue Applying: 2: 1 Check the status The merged file (Unmerged) -> staged $ git st # On branch master # Your branch is ahead of 'origin/master' by 1 commit. # (use \"git push\" to publish your local commits) # nothing to commit, working directory clean Log added the remote new version $ git pl d6962d6 - (HEAD, master) 2: 1 (4 seconds ago) b9709fe - (origin/master, origin/HEAD) 1: 1 (3 minutes ago) 1d9bcce - Initial commit (27 minutes ago) $ git rlog b9709fe - (origin/master, origin/HEAD) 1: 1 (3 minutes ago) 1d9bcce - Initial commit (27 minutes ago) Branch changed no branch, rebasing master -> master $ git br master Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/git/gerrit.html":{"url":"devops/git/gerrit.html","title":"gerrit","keywords":"","body":" .gitconfig default groups refs/meta/config get project.config publish to remote update meta/config if remotes update reset to remotes useful refs restriction for branches (feature1, feature2 and master) for only allow code review merge, forbidden code push rules.pl submit by a non author ticket check api basic usage change who approval the CR+2 get all vote CR-2 who approval the V+1 reference integrate in Jenkins css for code block [!NOTE|label:references:] Gerrit Code Review - Access Controls Special and magic references Magic references Access Categories .gitconfig $ git config --global gitreview.username $ git config --global gitreview.remote origin default groups [!TIP] Gerrit Code Review - Access Controls System Groups Anonymous Users Change Owner Project Owners Registered Users Predefined Groups Administrators Non-Interactive Users ~Service Users~ Special references refs/changes/* refs/meta/config refs/meta/dashboards/* refs/notes/review Magic references refs/for/ refs/meta/config get project.config clone the repo $ git clone # or update the local repo to HEAD $ git pull [--rebase] checkout meta/config $ git fetch origin refs/meta/config:refs/remotes/origin/meta/config $ git checkout meta/config or $ git fetch ssh://localhost:29418/project refs/meta/config $ git checkout FETCH_HEAD publish to remote $ git add --all . $ git commit -m \"\" submit directly $ git push origin meta/config:meta/config or $ git push origin HEAD:refs/meta/config submit review [!NOTE|label:references:] smirn0v/gist:b8e6c4bedebed23a0328 $ git push origin HEAD:refs/for/refs/meta/config or$ git push origin meta/config:refs/for/refs/meta/config update meta/config if remotes update $ git fetch origin --force refs/meta/config:refs/remotes/origin/meta/config $ git pull origin refs/meta/config # or $ git merge meta/config reset to remotes $ git fetch origin --force refs/meta/config:refs/remotes/origin/meta/config $ git reset --hard remotes/origin/meta/config useful refs sandbox: refs/heads/sandbox/${username}/* its-jira: for project specific [commentlink \"its-jira\"] match = ^[ \\\\t]*PROJECT-([0-9]{1,5}): link = https://:/browse/PROJECT-$1 for common setup [plugin \"its-jira\"] association = OPTIONAL branch = ^refs/heads/.* branch = ^refs/heads/stable-.* commentOnChangeAbandoned = false commentOnChangeCreated = true commentOnChangeMerged = true commentOnChangeRestored = false commentOnCommentAdded = false commentOnFirstLinkedPatchSetCreated = true commentOnPatchSetCreated = false commentOnRefUpdatedGitWeb = true enabled = enforced [commentlink \"its-jira\"] match = ^[ \\\\t]*([A-Za-z]*-[0-9]{1,5}): link = https://:/browse/$1 [commentlink \"changeid\"] match = (I[0-9a-f]{8,40}) link = \"#/q/$1\" verified label [label \"Verified\"] function = MaxWithBlock defaultValue = 0 copyAllScoresIfNoCodeChange = true value = -1 Fails value = 0 No score value = +1 Verified change-id [receive] requireChangeId = true createNewChangeForAllNotInTarget = false maxObjectSizeLimit = 6m maxBatchChanges = 1 [commentlink \"changeid\"] match = (I[0-9a-f]{8,40}) link = \"#/q/$1\" freeze master branch [!TIP] One quirk is that the shortest possible pattern expansion must be a valid ref name thus ^refs/heads/.*/name will fail because refs/heads//name is not a valid reference but ^refs/heads/.+/name will work. About the refs/for namespace [!TIP] references: what is the use refs/for/refs/* in gerrit? refs/for/* syntax is just a short name for refs/for/refs/*: project.config [access \"refs/for/refs/heads/master\"] push = block group user/Marslo Jiao (marslo) push = block group Registered Users submit = block group Registered Users submit = block group group user/Marslo Jiao (marslo) addPatchSet = block group user/Marslo Jiao (marslo) addPatchSet = block group Registered Users pushMerge = block group user/Marslo Jiao (marslo) pushMerge = block group Registered Users groups ... global:Project-Owners Project Owners global:Registered-Users Registered Users ... user:marslo user/Marslo Jiao(marslo) ... freeze multiple branches (stable & release) for the specific account project.config [access \"^refs/for/refs/heads/(stable|release)$\"] push = block group Registered Users submit = block group Registered Users addPatchSet = block group Registered Users pushMerge = block group Registered Users [access \"^refs/heads/(stable|release)$\"] read = group user/Marslo Jiao (marslo) push = +force group user/Marslo Jiao (marslo) pushMerge = group user/Marslo Jiao (marslo) or using exclusiveGroupPermissions[access \"^refs/heads/backup/(master|dev|staging|stable)/.+$\"] exclusiveGroupPermissions = create delete push pushMerge create = group Project Owners create = block group Registered Users delete = block group Registered Users push = block group Registered Users pushMerge = block group Registered Users [access \"^refs/for/refs/heads/backup/(master|dev|staging|stable)/.+$\"] exclusiveGroupPermissions = addPatchSet create push pushMerge submit addPatchSet = block group Registered Users create = block group Registered Users push = block group Registered Users pushMerge = block group Registered Users submit = block group Registered Users groups ... global:Project-Owners Project Owners global:Registered-Users Registered Users ... user:marslo user/Marslo Jiao(marslo) ... restriction for branches (feature1, feature2 and master) for only allow code review merge, forbidden code push project.config [access \"refs/*\"] read = group Project Owners read = group user/Marslo Jiao (marslo) [access \"refs/for/*\"] addPatchSet = group Project Owners addPatchSet = group user/Marslo Jiao (marslo) push = group Project Owners push = group user/Marslo Jiao (marslo) pushMerge = group Project Owners pushMerge = group user/Marslo Jiao (marslo) [access \"^refs/heads/(feature1|feature2|master)$\"] push = block group Registered Users pushMerge = block group Registered Users submit = group Change Owner groups ... global:Project-Owners Project Owners global:Registered-Users Registered Users ... user:marslo user/Marslo Jiao(marslo) ... example of project.config project.config[project] description = Gerrit Code Review [access \"refs/*\"] owner = group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/heads/*\"] label-Code-Review = -2..+2 group google/gerritcodereview-maintainers@googlegroups.com label-Code-Review = -2..+2 group polygerrit-maintainers label-Verified = -1..+1 group Change Owner label-Verified = -1..+1 group gerrit-verifiers label-Code-Style = -1..+1 group gerrit-verifiers label-Verified-Notedb = -1..+1 group gerrit-verifiers label-Library-Compliance = -1..+1 group gerrit-lib label-Library-Compliance = -1..+0 group google/gerritcodereview-maintainers@googlegroups.com submit = group Change Owner submit = group google/gerritcodereview-maintainers@googlegroups.com create = group google/gerritcodereview-maintainers@googlegroups.com abandon = group gerrit-verifiers editTopicName = +force group google/gerritcodereview-maintainers@googlegroups.com removeReviewer = group google/gerritcodereview-maintainers@googlegroups.com publishDrafts = group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/tags/*\"] create = group gerrit-release-creators create = group google/gerritcodereview-maintainers@googlegroups.com createTag = group gerrit-release-creators createTag = group google/gerritcodereview-maintainers@googlegroups.com createSignedTag = group gerrit-release-creators createSignedTag = group google/gerritcodereview-maintainers@googlegroups.com [access] inheritFrom = Public-Projects [receive] rejectImplicitMerges = true [reviewer] enableByEmail = true [label \"Verified\"] function = MaxNoBlock copyAllScoresIfNoCodeChange = true value = -1 Fails value = 0 No score value = +1 Verified defaultValue = 0 [label \"Code-Style\"] function = MaxWithBlock copyAllScoresIfNoCodeChange = true value = -1 Wrong Style or Formatting value = 0 No score value = +1 Style Verified defaultValue = 0 [label \"Library-Compliance\"] function = MaxWithBlock copyAllScoresIfNoCodeChange = true copyAllScoresOnTrivialRebase = true value = -1 Do not submit value = 0 No score value = +1 Approved defaultValue = 0 [access \"refs/for/refs/meta/dashboards/*\"] push = group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/meta/dashboards/*\"] label-Code-Review = -2..+2 group google/gerritcodereview-maintainers@googlegroups.com label-Code-Review = -1..+1 group Registered Users label-Verified = -1..+1 group gerrit-verifiers label-Verified = -1..+1 group google/gerritcodereview-maintainers@googlegroups.com submit = group google/gerritcodereview-maintainers@googlegroups.com forgeAuthor = group google/gerritcodereview-maintainers@googlegroups.com label-Code-Style = -1..+1 group google/gerritcodereview-maintainers@googlegroups.com [access \"refs/for/refs/meta/config\"] push = group gerrit-verifiers [notify \"polygerrit-reviews\"] email = polygerrit-reviews@google.com type = all_comments type = submitted_changes header = cc filter = file:polygerrit-ui [access \"refs/heads/infra/config\"] push = group gerrit-tricium-admins rules.pl submit by a non author [!TIP] check also: Exclude author from gerrit review submit_rule(S) :- gerrit:default_submit(X), X =.. [submit | Ls], add_non_author_approval(Ls, R), S =.. [submit | R]. add_non_author_approval(S1, S2) :- gerrit:commit_author(A), gerrit:commit_label(label('Code-Review', 2), R), R \\= A, !, S2 = [label('Non-Author-Code-Review', ok(R)) | S1]. add_non_author_approval(S1, [label('Non-Author-Code-Review', need(_)) | S1]). by project.config[access \"refs/*\"] label-Code-Review = block -2..+2 group Change Owner exclusiveGroupPermissions = label-Code-Review ticket check [!TIP] check also: Prolog Gerrit - validate label if commit message contains a specific string optional validation submit_rule(S) :- gerrit:default_submit(X), X =.. [submit | Ls], require_ticket_check_for_ticket(Ls, Nls), S =.. [submit | Nls]. require_ticket_check_for_ticket(S1, S2) :- gerrit:commit_message_matches('^issue-[\\\\d]+\\\\s?:\\\\s?[\\\\w\\\\W]+'), !, S2 = [label('Ticket-Checked', need(_)) | S1]. require_ticket_check_for_ticket(S1, S2) :- !, S2 = S1. optional validation with auto vote submit_rule(S) :- gerrit:default_submit(X), X =.. [submit | Ls], require_ticket_check_for_ticket(Ls, Nls), S =.. [submit | Nls]. require_ticket_check_for_ticket(S1, S2) :- gerrit:commit_message_matches('\\\\[issue-[\\\\d]{2}\\\\]\\\\s?:\\\\s?[\\\\w\\\\W]+'), !, S2 = [label('Ticket-Checked', ok(user(824))) | S1]. require_ticket_check_for_ticket(S1, S2) :- !, S2 = S1. mandatory validation submit_rule(S) :- gerrit:default_submit(X), % get the current submit structure X=.. [submit | Ls], require_ticket_check_for_ticket(Ls, Nls), S=.. [submit | Nls]. require_ticket_check_for_ticket(S1, S2) :- gerrit:commit_message_matches('\\\\[issue-[\\\\d]{2}\\\\][\\\\s\\\\S]+'), !, S2 = [label('Ticket-Checked', ok(user(790))) | S1]. % Add the label and automatically approval by user-id: 790 require_ticket_check_for_ticket(S1, [label('Ticket-Checked', need(_)) | S1]). api reference: Gerrit Code Review - REST API Developers' Notes Gerrit Code Review - REST API basic usage regular options a might means [a]pi ⇡ $ curl -X PUT http://domain.name/a/path/to/api/ $ curl -X POST http://domain.name/a/path/to/api/ $ curl -X DELETE http://domain.name/a/path/to/api/ sending data json with file $ curl -X PUT \\ -d@testdata.json \\ --header \"Content-Type: application/json\" \\ http://domain.name/a/path/to/api/ json with string $ curl -X POST \\ -H \"Content-Type: application/json\" https://domain.name/a/changes//move \\ -d '{ \"destination_branch\" : \"target/branch/name\" }' )]}' { \"id\": \"marslo-project~target%2Fbranch%2Fname~Id90057ab632eb93be2fa9128a9d624664008cb4a\", \"project\": \"marslo-project\", \"branch\": \"target/branch/name\", \"hashtags\": [], \"change_id\": \"Id90057ab632eb93be2fa9128a9d624664008cb4a\", \"subject\": \"marslo: testing api move\", \"status\": \"NEW\", \"created\": \"2022-01-21 05:21:25.000000000\", \"updated\": \"2022-05-17 06:56:37.000000000\", \"submit_type\": \"FAST_FORWARD_ONLY\", \"mergeable\": false, \"insertions\": 8, \"deletions\": 8, \"unresolved_comment_count\": 0, \"has_review_started\": true, \"_number\": 94490, \"owner\": { \"_account_id\": 790 }, \"requirements\": [] } # or $ curl -X POST \\ -H \"Content-Type: application/json\" https://domain.name/a/changes//move \\ -d '{ \"destination_branch\" : \"target/branch/name\" }' | tail -n +2 | jq -r .branch txt $ curl -X PUT \\ --data-binary @testdata.txt \\ --header \"Content-Type: text/plain\" \\ http://domain.name/a/path/to/api/ verifying header content $ curl -v -n -X DELETE http://domain.name/a/path/to/api/ change get change via change-id $ curl -X GET 'https://domina.name/a/changes/' get change via commit-id $ changeid=$(git show --no-patch --format=\"%s%n%n%b\" | sed -nre 's!Change-Id: (.*$)!\\1!p') $ curl -X GET \"https://domina.name/a/changes/${changeid}\" or $ project=$(echo 'path/to/project' | sed 's:/:%2F:g') $ branch='dev' $ changeid=$(git show --no-patch --format=\"%s%n%n%b\" | sed -nre 's!Change-Id: (.*$)!\\1!p') $ curl -X GET \"https://domina.name/a/changes/${project}~${branch}~${changeid}\" who approval the CR+2 $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r '.labels.\"Code-Review\".approved.name' get all vote CR-2 example output for .labels..all[]{ \"value\": -2, \"date\": \"2021-05-31 07:57:14.000000000\", \"permitted_voting_range\": { \"min\": -2, \"max\": 2 }, \"_account_id\": 790, \"name\": \"Marslo Jiao\", \"email\": \"marslo.jiao@gmail.com\", \"username\": \"marslo\" } { \"value\": 0, \"permitted_voting_range\": { \"min\": -2, \"max\": 2 }, \"_account_id\": 124, \"name\": \"John Doe\", \"email\": \"john@gmail.com\", \"username\": \"john\" } reference: Select objects based on value of variable in object using jq jq select or statement How to select items in JQ based on value in array $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r '.labels.\"Code-Review\".all[] | select ( .value == -2 ) | .username' : |⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂| : : ⇣ : : select \".value\"== -2 : : : ⇣ ⇣ pipe pipe # or $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r '( .labels.\"Code-Review\".all[] | select ( .value == -2 ) ).username' : : ⇣ ⇣ expression expression # or $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r '[ .labels.\"Code-Review\".all[] | select ( .value == -2 ) ][].username' : : ⇣ ⇣ expression expression # or $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r '.labels.\"Code-Review\".all[] | select ( .value == -2 )' | jq -r .username : ⇣ pipe who approval the V+1 $ curl -s -X GET https://domain.name/a/changes/${changeid}/detail | tail -n +2 | jq -r .labels.Verified.approved.username reference project owner guide Gerrit Code Review - Access Controls Gerrit Code Review - Uploading Changes The refs/for namespace gerrit/gerrit/refs/meta/config gerrit 权限控制 its-jira plugin md Rule base configuration Gerrit push not working. Remote rejected, prohibited by gerrit Gerrit Code Review - Project Configuration File Format Review UI integrate in Jenkins [!NOTE|label:references:] Gerrit Trigger How does the Gerrit- trigger plugin in Jenkins works? stream-events # permission requies $ ssh -i id_rsa jenkins@gerrit.domain.com -p 29418 gerrit stream-events stream events not permitted # verify $ ssh -i id_rsa jenkins@gerrit.domain.com -p 29418 gerrit stream-events | jq -r .type ref-updated comment-added build current patches only [!NOTE] Warning: The current implementation takes into account that 'Build Current Patches Only' with 'Abort new patch sets' and 'Abort patch sets with same topic' are enabled (see help for more). generate ssh-key $ keyname='devops@jenkins' $ ssh-keygen -m PEM -t rsa -f ~/.ssh/${keyname} -C \"${keyname}\" -P '' -q css for code block .gr-formatted-text-0 gr-linked-text.pre.gr-formatted-text, gr-linked-text[class*=\"pre\"], gr-linked-text[class*=\"pre\"] #output { font-family: \"Comic Mono\", \"Monaco\", \"Menlo\", \"Andale Mono\", \"Ubuntu Mono\", \"monofur\" !important; font-size: 16px !important; } .gr-formatted-text-0 gr-linked-text.pre.gr-formatted-text, gr-linked-text[class*=\"pre\"] { color: #c8c8c8 !important; background: #272727 !important; border-radius: .75em !important; box-shadow: 0 4px 8px 0 rgb(0 0 0 / 20%), 0 6px 20px 0 rgb(0 0 0 / 19%); overflow: auto; display: block; padding: 12px 12px 1px 12px; margin: 0px; } gruvbox background : #272727 front-color: #e8dbb6 ubunut background : #3a122e front-color: #eee solarized background : #0d2a34 front-color: #869395 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/git/github.html":{"url":"devops/git/github.html","title":"github","keywords":"","body":" hooks jenkins branch actions apps references: Testing webhooks GitHub Integration: Webhooks GitHub Webhook: Non-Multibranch Jobs GitHub Webhook: Pipeline Multibranch GitHub: Webhook Troubleshooting GitHub: How to configure status checks per Pipeline stage for Pull Requests GitHub Permissions and API token Scopes for Jenkins CloudBees Pull Request Builder for GitHub plugin GitHub webhooks Guide for Troubleshooting GitHub Webhooks How to update Jenkins build status in GitHub pull requests [Step-by-Step Tutorial] How to set GitHub commit status with Jenkinsfile NOT using a pull request builder GitHub REST API documentation workflow && checks: Commit Message Checker for pull request GS Commit Message Checker Skipping workflow runs * api: Commit statuses ci/jenkins: How to update Jenkins build status in GitHub pull requests [Step-by-Step Tutorial] How to Use Custom GitHub Checks Using Jenkins Pipeline?! * Custom GitHub Checks With Jenkins Pipeline Show current state of Jenkins build on GitHub repo How to Integrate Your GitHub Repository to Your Jenkins Project Jenkins GitHub Integration for CI/CD Pipelines example Branches and Pull Requests kad/JENKINS-28447.workaround.groovy Use setGithubPullRequestStatus as a standalone feature #102 Replay in pr-builder pipeline doesn't update GitHub PR status OR restarting a pipeline stage will not update pull request status sample code: * Lonor/kubernetes-springboot-demo plugins: GitHubCommitStatusSetter githubPRComment GitHub Checks hooks in github pull request: /github-pull-request-hook/ push /github-webhook/ jenkins branch +refs/pull/*:refs/remotes/origin/pr/* +refs/heads/*:refs/remotes/origin/* actions [!NOTE|label:references] marketplace First interaction github-action-auto-format cloudposse/github-action-auto-release jenkins Setup Jenkins test.yml jenkins.yaml Jenkins-Action Build Jenkins jobs Trigger a Jenkins Job TriggerJenkinsBuild Run jenkins jobs GitHub Actions Linting jenkins-action-parametrized Jenkins Job Builder jenkins-job-action Trigger Jenkins Job and Return Result Run Jenkins Job with Build Result Run Jenkins Job and get build result halilsafakkilic/jenkins-action git Commit Message Checker for pull request Check Commit Message Git matching commits Git matching commits Commit Message Checker for pull request GS Commit Message Checker Git Commit Data Generate semver pre-commit pre-commit ci utillity Upload a Build Artifact Download a Build Artifact GitHub API Request Checkout Configure GitHub Pages GitHub API Request GitHub Script Git Version Load available actions Secret output Ansible Publish Jira Add Comment Setup Jira Release-Notes-Preview Trigger CircleCI Pipeline Deploy Helm to EKS Docker Build Tag Publish Deploy Helm to EKS Kubectl tool installer Kubernetes Set Context Helm tool installer apps [!NOTE|label:references:] Slack + GitHub CommitCheck Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/git/troubleshooting.html":{"url":"devops/git/troubleshooting.html","title":"troubleshooting","keywords":"","body":" debug opt git debug options Linux example windows plugins/components diff-highlight: command not found error: RPC failed installation Ubuntu no refs in common and none specified; doing nothing. CentOS /bin/sh: cc openssl/ssl.h expat.h asciidoc docbook2x-texi xmlto gnu/stubs-64.h git diff extreamly slow way to debug solution debug opt git debug options [!TIP] commit 14e2411, commit 81590bf, commit 4527aa1, commit 4eee6c6 (07 Sep 2016) Use the new GIT_TRACE_CURL environment variable instead of the deprecated GIT_CURL_VERBOSE. GIT_TRACE_CURL=1 or GIT_CURL_VERBOSE=1 GIT_TRACE2_PERF_BRIEF=1 and GIT_TRACE2_PERF=~/log.perf GIT_TRACE or GIT_TR2 How can I debug git/git-shell related problems? OPTION DESCRIPTION GIT_TRACE Enable general trace messages GIT_CURL_VERBOSE DEPRECATED: Print HTTP headers (similar to curl -v) GIT_TRACE_CURL Print HTTP headers (similar to curl -v) GIT_TRACE_CURL_NO_DATA - GIT_SSH_COMMAND=\"ssh -vvv\" Print SSH debug messages (similar to ssh -vvv) GIT_TRACE_PACK_ACCESS Enable trace messages for all accesses to any packs GIT_TRACE_PACKET Enable trace messages for all packets coming in or out of a given program GIT_TRACE_PACKFILE Enable tracing of packfiles sent or received by a given program GIT_TRACE_PERFORMANCE Enable performance related trace messages GIT_TRACE_SETUP Enable trace messages printing the .git, working tree and current working directory after Git has completed its setup phase GIT_TRACE_SHALLOW Enable trace messages that can help debugging fetching/cloning of shallow repositories Linux $ GIT_TRACE=true \\ GIT_CURL_VERBOSE=true \\ GIT_SSH_COMMAND=\"ssh -vvv\" \\ GIT_TRACE_PACK_ACCESS=true \\ GIT_TRACE_PACKET=true \\ GIT_TRACE_PACKFILE=true \\ GIT_TRACE_PERFORMANCE=true \\ GIT_TRACE_SETUP=true \\ GIT_TRACE_SHALLOW=true \\ or $ GIT_SSH_COMMAND='ssh -vvT' or $ set -x; $ GIT_TRACE=2 \\ GIT_CURL_VERBOSE=2 \\ GIT_TRACE_PERFORMANCE=2 \\ GIT_TRACE_PACK_ACCESS=2 \\ GIT_TRACE_PACKET=2 \\ GIT_TRACE_PACKFILE=2 \\ GIT_TRACE_SETUP=2 \\ GIT_TRACE_SHALLOW=2 \\ git pull origin master -v -v; $ set +x example GIT_TRACE_PACK_ACCESS $ GIT_TRACE_PACK_ACCESS=true git status 17:25:02.292444 packfile.c:1656 .git/objects/pack/pack-2c56c1344ec68590771337aac300d34d4419b7a8.pack 182822 17:25:02.292570 packfile.c:1656 .git/objects/pack/pack-2c56c1344ec68590771337aac300d34d4419b7a8.pack 251298 On branch marslo Your branch is up to date with 'origin/marslo'. Changes not staged for commit: (use \"git add ...\" to update what will be committed) (use \"git restore ...\" to discard changes in working directory) modified: devops/git/config.md modified: devops/git/troubleshooting.md 17:25:03.107800 packfile.c:1656 .git/objects/pack/pack-2c56c1344ec68590771337aac300d34d4419b7a8.pack 182822 17:25:03.115308 packfile.c:1656 .git/objects/pack/pack-2c56c1344ec68590771337aac300d34d4419b7a8.pack 251298 no changes added to commit (use \"git add\" and/or \"git commit -a\") GIT_TRACE_PACKET $ GIT_TRACE_PACKET=true git ls-remote origin 17:26:07.252939 pkt-line.c:85 packet: ls-remote command=ls-refs 17:26:07.253120 pkt-line.c:85 packet: ls-remote> agent=git/2.42.0.325.g3a06386e31 17:26:07.253141 pkt-line.c:85 packet: ls-remote> object-format=sha1 17:26:07.253145 pkt-line.c:85 packet: ls-remote> 0001 17:26:07.253149 pkt-line.c:85 packet: ls-remote> peel 17:26:07.253152 pkt-line.c:85 packet: ls-remote> symrefs 17:26:07.253190 pkt-line.c:85 packet: ls-remote> unborn 17:26:07.253194 pkt-line.c:85 packet: ls-remote> 0000 17:26:07.442198 pkt-line.c:85 packet: ls-remote 0000 GIT_TRACE_PERFORMANCE $ GIT_TRACE_PERFORMANCE=true git gc 17:26:40.366194 trace.c:414 performance: 0.647718530 s: git command: /usr/local/libexec/git-core/git pack-refs --all --prune 17:26:41.773137 trace.c:414 performance: 1.370108227 s: git command: /usr/local/libexec/git-core/git reflog expire --all 17:26:42.948989 read-cache.c:2388 performance: 0.005399312 s: read cache .git/index Enumerating objects: 147825, done. Counting objects: 100% (147825/147825), done. Delta compression using up to 4 threads Compressing objects: 100% (29746/29746), done. Writing objects: 100% (147825/147825), done. Total 147825 (delta 116636), reused 147130 (delta 115980), pack-reused 0 17:27:22.708361 trace.c:414 performance: 40.753740844 s: git command: /usr/local/libexec/git-core/git pack-objects --local --delta-base-offset .git/objects/pack/.tmp-26505-pack --keep-true-parents --honor-pack-keep --non-empty --all --reflog --indexed-objects 17:27:24.196894 trace.c:414 performance: 1.380585771 s: git command: /usr/local/libexec/git-core/git pack-objects --local --delta-base-offset .git/objects/pack/.tmp-26505-pack --cruft --cruft-expiration=2.weeks.ago --honor-pack-keep --non-empty Removing duplicate objects: 100% (256/256), done. 17:27:28.456295 trace.c:414 performance: 46.624001391 s: git command: /usr/local/libexec/git-core/git repack -d -l --cruft --cruft-expiration=2.weeks.ago 17:27:28.540513 read-cache.c:2388 performance: 0.014518135 s: read cache .git/index Checking connectivity: 147825, done. 17:27:35.103105 trace.c:414 performance: 6.640800087 s: git command: /usr/local/libexec/git-core/git prune --expire 2.weeks.ago 17:27:35.176525 trace.c:414 performance: 0.052737824 s: git command: /usr/local/libexec/git-core/git worktree prune --expire 3.months.ago 17:27:35.246068 trace.c:414 performance: 0.067587160 s: git command: /usr/local/libexec/git-core/git rerere gc 17:27:35.502502 trace.c:414 performance: 55.861145774 s: git command: git gc GIT_TRACE_SETUP $ GIT_TRACE_SETUP=true git status 17:28:21.186201 trace.c:314 setup: git_dir: .git 17:28:21.186281 trace.c:315 setup: git_common_dir: .git 17:28:21.186288 trace.c:316 setup: worktree: /mnt/c/iMarslo/tools/git/marslo/ibook 17:28:21.186290 trace.c:317 setup: cwd: /mnt/c/iMarslo/tools/git/marslo/ibook 17:28:21.186292 trace.c:318 setup: prefix: docs/ 17:28:21.186300 chdir-notify.c:68 setup: chdir from '/mnt/c/iMarslo/tools/git/marslo/ibook' to '/mnt/c/iMarslo/tools/git/marslo/ibook' On branch marslo Your branch is up to date with 'origin/marslo'. Changes not staged for commit: (use \"git add ...\" to update what will be committed) (use \"git restore ...\" to discard changes in working directory) modified: devops/git/config.md modified: devops/git/troubleshooting.md 17:28:25.320340 trace.c:314 setup: git_dir: .git 17:28:25.320399 trace.c:315 setup: git_common_dir: .git 17:28:25.320404 trace.c:316 setup: worktree: /mnt/c/iMarslo/tools/git/marslo/ibook 17:28:25.320405 trace.c:317 setup: cwd: /mnt/c/iMarslo/tools/git/marslo/ibook 17:28:25.320407 trace.c:318 setup: prefix: (null) 17:28:25.630382 trace.c:314 setup: git_dir: .git 17:28:25.630449 trace.c:315 setup: git_common_dir: .git 17:28:25.630454 trace.c:316 setup: worktree: /mnt/c/iMarslo/tools/git/marslo/ibook 17:28:25.630456 trace.c:317 setup: cwd: /mnt/c/iMarslo/tools/git/marslo/ibook 17:28:25.630458 trace.c:318 setup: prefix: (null) no changes added to commit (use \"git add\" and/or \"git commit -a\") windows C:\\> set GIT_TRACE=true C:\\> set GIT_CURL_VERBOSE=true C:\\> set GIT_SSH_COMMAND=ssh -vvv C:\\> plugins/components diff-highlight: command not found ubuntu$ dpkg -L git | grep diff-highlight centos/rhel$ rpm -ql git | grep diff-highlight arch$ pacman -Ql git | grep diff-highlight $ sudo ln -sf /path/to/diff-highlight /usr/bin/diff-highlight error: RPC failed [!TIP] error: RPC failed; curl 92 LibreSSL SSL_read: error:02FFF03C:system library:func(4095):Operation timed out references: Git push getting failed. error: RPC failed; curl 56 LibreSSL SSL_read: SSL_ERROR_SYSCALL, errno 60 $ git config [--global] http.postBuffer 524288000 $ git config [--global] http.sslVerify false installation Ubuntu no refs in common and none specified; doing nothing. error $ git push No refs in common and none specified; doing nothing. Perhaps you should specify a branch such as 'master'. Everything up-to-date solution: git push -u origin master $ git push -u origin master Counting objects: 40, done. Delta compression using up to 4 threads. Compressing objects: 100% (40/40), done. Writing objects: 100% (40/40), 133.46 KiB | 0 bytes/s, done. Total 40 (delta 6), reused 0 (delta 0) To git@github.com:Marslo/LaunchySkins.git \\* [new branch] master -> master \\* Branch master set up to track remote branch master from origin. CentOS /bin/sh: cc error: $ make prefix=/usr/local/myprograms/git GIT_VERSION = 2.1.0 * new build flags CC credential-store.o /bin/sh: cc: command not found make: *** [credential-store.o] Error 127 solution: $ yum install gcc gcc-g++ g++ make openssl/ssl.h error: $ make prefix=/usr/local/myprograms/git CC credential-store.o In file included from cache.h:4, from credential-store.c:1: git-compat-util.h:213:25: warning: openssl/ssl.h: No such file or directory git-compat-util.h:214:25: warning: openssl/err.h: No such file or directory git-compat-util.h:326:25: warning: openssl/evp.h: No such file or directory git-compat-util.h:327:26: warning: openssl/hmac.h: No such file or directory git-compat-util.h:329:28: warning: openssl/x509v3.h: No such file or directory In file included from credential-store.c:1: cache.h:12:21: warning: openssl/sha.h: No such file or directory cache.h:20:18: warning: zlib.h: No such file or directory In file included from credential-store.c:1: cache.h:22: error: expected specifier-qualifier-list before ‘z_stream’ make: *** [credential-store.o] Error 1 solution: $ yum install openssl openssl-devel zlib-devel libcurl libcurl-devel expat.h error: $ make prefix=/usr/local/myprograms/git http-push.c:17:19: warning: expat.h: No such file or directory http-push.c:832: warning: type defaults to ‘int’ in declaration of ‘XML_Char’ http-push.c:832: error: expected ‘;’, ‘,’ or ‘)’ before ‘*’ token solution: $ sudo yum install expat-devel asciidoc error: /bin/sh: line 1: asciidoc: command not found make[1]: *** [git-add.html] Error 127 make[1]: Leaving directory `/root/Software/git-master/Documentation' make: *** [doc] Error 2 solution: $ sudo yum install docbook-style-xsl $ sudo rpm -ivh http://pkgs.repoforge.org/asciidoc/asciidoc-8.6.9-1.el6.rfx.noarch.rpm # or $ wget http://downloads.sourceforge.net/project/asciidoc/asciidoc/8.6.9/asciidoc-8.6.9.tar.gz $ tar xf asciidoc-8.6.9.tar.gz $ autoconf $ ./configure $ make $ sudo make install docbook2x-texi error: DB2TEXI user-manual.texi /bin/sh: 2: docbook2x-texi: not found make[1]: *** [user-manual.texi] Error 127 make[1]: Leaving directory `/home/marslo/Tools/Software/Programming/Git/git-master/Documentation' make: *** [info] Error 2 solution: $ sudo yum -y --enablerepo=*epel* install docbook2X $ sudo ln -s /usr/bin/db2x_docbook2texi /usr/bin/docbook2x-texi xmlto error: /bin/sh: line 1: xmlto: command not found make[1]: *** [git-add.1] Error 127 make[1]: Leaving directory `/root/Software/git-master/Documentation' make: *** [doc] Error 2 solution: $ sudo yum install xmlto gnu/stubs-64.h error: In file included from /usr/include/features.h:399:0, from /usr/include/unistd.h:25, from git-compat-util.h:158, from cache.h:4, from credential-store.c:1: /usr/include/gnu/stubs.h:10:27: fatal error: gnu/stubs-64.h: No such file or directory # include ^ compilation terminated. make: *** [credential-store.o] Error 1 solution: $ sudo yum install glibc-devel git diff extreamly slow [!NOTE|label:references:] * AMD was contacted but no response... diagram from Windows 10 2018 microsoft/terminal issue 9744 #1071 : 2.11.1 slow enough to make it unusable in Windows 10 x64 - upgraded from 2.9 lighting fastI solved the Radeon/MinTTy issue (for me at least!). After blaming AMD - and updating their driver (twice) hoping for a fix, i checked for an update to my onboard intel driver - and - indeed there was! I updated to the latest for my Intel 530 HD graphics and i'm back to normal! __git_ps1 extremely slow in kernel tree Git is extremely slow on Windows Git Bash (mintty) is extremely slow on Windows 10 OS git-prompt.sh bash-git-prompt #4197 : [wsl2] filesystem performance is much slower than wsl1 in /mnt Git is really slow for 100,000 objects. Any fixes? way to improve git status performance The performance of git status should improve with Git 2.13 (Q2 2017) * Understanding the performance bottlenecks GIT_PS1_SHOWDIRTYSTATE: 58 milliseconds. GIT_PS1_SHOWUNTRACKEDFILES: 106 milliseconds. GIT_PS1_SHOWSTASHSTATE: 8.7 milliseconds. GIT_PS1_SHOWUPSTREAM: 10.6 milliseconds. Improving performance way to debug [!NOTE|label:references:] __git_ps1 extremely slow in kernel tree Diagnosing performance issues $ bash -x $ time __git_ps1 or$ bash --debugger $ PS4='+ ${BASH_SOURCE[0]} ' $ set -x ; __git_ps1 ; set +x solution [!WARN|label:not been fixed yet] index : git.git check status [!NOTE|label:references:] #1070 : Git commands have a 2-3 second delay before returning to the promp $ git --version --build-options git version 2.42.0 cpu: x86_64 no commit associated with this build sizeof-long: 8 sizeof-size_t: 8 shell-path: /bin/sh > cmd.exe /c ver Microsoft Windows [Version 10.0.19044.3448] $ cat '/mnt/c/Program Files/Git/etc/install-options.txt' Editor Option: VIM Custom Editor Path: Default Branch Option: Path Option: Cmd SSH Option: OpenSSH Tortoise Option: false CURL Option: OpenSSL CRLF Option: LFOnly Bash Terminal Option: MinTTY Git Pull Behavior Option: Rebase Use Credential Manager: Enabled Performance Tweaks FSCache: Enabled Enable Symlinks: Enabled Enable Pseudo Console Support: Disabled Enable FSMonitor: Disabled modify configures [!NOTE|label:references:] remove options for unusable on a tree the size of the kernel Git Bash is extremely slow on Windows 7 x64 GIT_PS1 $ export GIT_PS1_SHOWDIRTYSTATE=true $ export GIT_PS1_SHOWUNTRACKEDFILES=true # or export GIT_PS1_SHOWDIRTYSTATE= export GIT_PS1_SHOWUNTRACKEDFILES= more on GIT_PS1 env GIT_PS1_SHOWDIRTYSTATE=true GIT_PS1_SHOWSTASHSTATE=true GIT_PS1_SHOWUNTRACKEDFILES=true GIT_PS1_SHOWUPSTREAM=\"auto\" GIT_PS1_HIDE_IF_PWD_IGNORED=true GIT_PS1_SHOWCOLORHINTS=true bash.showDirtyState $ git config --global bash.showDirtyState true # and override this for the kernel tree only $ git config bash.showDirtyState false gc more: core.fscache git config --global core.preloadindex true git config --global core.fscache true git config --global gc.auto 256 enable parallel index preload $ git config --global core.preloadindex true submodule $ git config --global status.submoduleSummary false # or $ git config --global submodule.fetchJobs 8 AMD Radeon graphics driver [!NOTE|label:references:] * AMD was contacted but no response... diagram from Windows 10 2018 microsoft/terminal issue 9744 Git Bash (mintty) is extremely slow on Windows 10 OS #1071 : 2.11.1 slow enough to make it unusable in Windows 10 x64 - upgraded from 2.9 lighting fast #1070 : Git commands have a 2-3 second delay before returning to the promp #1129 : git commands running slow as hell I had the similar issue as yours on my Lenovo e450c laptop. And found the performance turned back to normal when I disabled AMD Radeon graphics driver in Windows device manager and switched to integrated Intel HD graphics. fast_git_ps1 fast_git_ps1 () { printf -- \"$(git branch 2>/dev/null | grep -e '\\* ' | sed 's/^..\\(.*\\)/ {\\1} /')\" } PS1='\\[\\033]0;$MSYSTEM:\\w\\007 \\033[32m\\]\\u@\\h \\[\\033[33m\\w$(fast_git_ps1)\\033[0m\\] $ ' or (git symbolic-ref --short -q HEAD || git rev-parse --short HEAD) 2> /dev/null no refresh index $ git config core.checkStat minimal $ git config core.trustctime false # or $ git config --global core.checkStat minimal $ git config --global core.trustctime false core.preloadIndex $ git config --global core.preloadIndex true commands repack $ git repack -ad gc $ git gc --aggressive Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-29 04:32:40 "},"devops/git/tricky.html":{"url":"devops/git/tricky.html","title":"tricky","keywords":"","body":" tricky quick edit gitocnfig create git patch get current branch get previous branch quick push to current branch remove warning: CRLF will be replaced by LF in xxx file for .gitattributes create multiple commits revision git commit git path .gitattributes git summaries scripts fetch merge all gfall iGitOpt effort others alias check help in previw.app disk size push to github with credential tricky references: git-tips/tips git 的奇技淫巧 k88hudson/git-flight-rules git飞行规则(flight rules) firstaidgit.io unixorn/git-extra-commands tj/git-extras shell tricks: one git alias to rule them all quick edit gitocnfig $ git config --edit --global # quick repalce config $ git config --global --replace-all core.pager cat create git patch $ git diff --no-color HEAD^..HEAD > .patch # or $ git format-patch HEAD^^ # create 3 patch files automatically $ git format-patch -1 # create 1 patch file only get current branch $ git branch sandbox/marslo * master branch $ git branch --show-current # or $ git branch --show # or $ git branch | sed -ne 's:^\\*\\s*\\(.*\\)$:\\1:p' master symbolic-ref $ git symbolic-ref --short HEAD master $ git symbolic-ref HEAD refs/heads/master name-rev $ git name-rev --name-only HEAD remotes/origin/master describe $ git describe --contains --all HEAD master get previous branch get previous branch name $ git rev-parse --symbolic-full-name @{-1} refs/heads/sandbox/marslo/291 or $ git describe --all $(git rev-parse @{-1}) heads/sandbox/marslo/291 checkout to previous branch $ git checkout - or$ git checkout @{-1} quick diff with previous branch $ git diff ..@{-1} # or $ git diff @..@{-1} # or $ git diff HEAD..@{-1} quick push to current branch @@ alone is a shortcut for HEAD. references: gitrevisions(7) Manual Page $ git push origin @ # or $ git push origin HEAD remove warning: CRLF will be replaced by LF in xxx file for .gitattributes $ git add --all -u --renormalize . or ignore the warning$ git config --global core.safecrlf false create multiple commits $ for c in {0..10}; do echo \"$c\" >> squash.txt git add squash.txt git commit -m \"add '${c}' to squash.txt\" done revision the first revision $ git rev-list --max-parents=0 HEAD git commit emoji git path get absolute root path $ git rev-parse --show-toplevel get relative root path $ git rev-parse --show-cdup get absolute root path inside submodules $ git rev-parse --show-superproject-working-tree get .git path $ git rev-parse --git-dir inside the work tree or not $ git rev-parse --is-inside-work-tree .gitattributes Refreshing the repository after committing .gitattributes reference: Please Add .gitattributes To Your Git Repository Git tip: Add a .gitattributes file to deal with line endings gitattributes - Defining attributes per path Force LF eol in git repo and working copy $ rm -rf .git/index # or $ git rm --cached -r . # or $ git ls-files -z | xargs -0 rm $ git reset --hard or $ echo \"* text=auto\" >.gitattributes $ git add --renormalize . $ git status # Show files that will be normalized $ git commit -m \"Introduce end-of-line normalization\" format reference Be a Git ninja: the .gitattributes file $ cat .gitattributes * text=auto *.sh eol=lf path/to/file eol=lf git summaries get repo active days $ git log --pretty='format: %ai' $1 | cut -d ' ' -f 2 | sort -r | uniq | awk '{ sum += 1 } END {print sum}' get commit count since particular commit$ git log --oneline | wc -l | tr -d ' ' 635 since the initial commit$ git log --oneline | wc -l | tr -d ' ' 780 get all files count in the repo $ git ls-files | wc -l | tr -d ' ' get contributors $ git shortlog -n -s -e 110 marslo 31 marslo collection $ git shortlog -n -s -e | awk ' { sum += $1 if ($NF in emails) { emails[$NF] += $1 } else { email = $NF emails[email] = $1 # set commits/email to empty $1=$NF=\"\" sub(/^[[:space:]]+/, \"\", $0) sub(/[[:space:]]+$/, \"\", $0) name = $0 if (name in names) { # when the same name is associated with existed email, # merge the previous email into the later one. emails[email] += emails[names[name]] emails[names[name]] = 0 } names[name] = email } } END { for (name in names) { email = names[name] printf \"%6d\\t%s\\n\", emails[email], name } }' 141 marslo format the author $ git shortlog -n -s -e | awk ' { args[NR] = $0; sum += $0 } END { for (i = 1; i 78.0% 31 marslo 22.0% show diff file only $ git log --numstat --pretty=\"%H\" --author=marslo HEAD~3..HEAD 9fdb297ba0d2d51975e91d2b7e40fb5e96be4f5f 8 1 docs/artifactory/artifactory.md 095ec79c89d98831c0a485f55011bf81c6f712ad 49 11 docs/linux/disk.md 5 1 docs/osx/util.md f15a40c8dea2927db54570268aca4203cd50a416 1 0 docs/SUMMARY.md - - docs/screenshot/tools/ms/outlook-keychain-1.png 81 0 docs/tools/ms.md repo age $ git log --reverse --pretty=oneline --format=\"%ar\" | head -n 1 | LC_ALL=C sed 's/ago//' 4 months scripts fetch merge all $ cat ~/.gitconfig ... [alias] ua = \"!bash -c 'while read branch; do \\n\\ echo -e \\\"\\\\033[1;33m~~> ${branch}\\\\033[0m\\\" \\n\\ git fetch --all --force; \\n\\ if [ 'meta/config' == \\\"${branch}\\\" ]; then \\n\\ git fetch origin --force refs/${branch}:refs/remotes/origin/${branch} \\n\\ fi \\n\\ git rebase -v refs/remotes/origin/${branch}; \\n\\ git merge --all --progress refs/remotes/origin/${branch}; \\n\\ git remote prune origin; \\n\\ if git --no-pager config --file $(git rev-parse --show-toplevel)/.gitmodules --get-regexp url; then \\n\\ git submodule sync --recursive; \\n\\ git submodule update --init --recursive \\n\\ fi \\n\\ done gfall iGitOpt ig.sh effort references: tj/git-extras How can I calculate the number of lines changed between two commits in Git? --stat $ git diff --stat HEAD^ HEAD docs/programming/groovy/groovy.md | 1 + docs/vim/tricky.md | 81 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-------------------- 2 files changed, 61 insertions(+), 21 deletions(-) for particular account$ git --no-pager diff --author='marslo' --stat HEAD^ HEAD docs/programming/groovy/groovy.md | 1 + docs/vim/tricky.md | 81 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-------------------- 2 files changed, 61 insertions(+), 21 deletions(-) --numstat $ git --no-pager log --numstat --author=\"marslo\" HEAD^..HEAD commit c361ddf2687319f978bb4ec0069b4b996607615f (HEAD -> marslo, origin/marslo) Author: marslo Date: Wed Jul 28 22:21:03 2021 +0800 add bufdo for vim 1 0 docs/programming/groovy/groovy.md 60 21 docs/vim/tricky.md for total count of changes $ git log --numstat --pretty=\"%H\" --author=\"marslo\" HEAD^..HEAD | awk 'NF==3 {plus+=$1; minus+=$2} END {printf(\"+%d, -%d\\n\", plus, minus)}' +61, -21 or for pretty format $ git log HEAD^..HEAD --numstat --pretty=\"%H\" | awk 'NF==3 {added+=$1; deleted+=$2} NF==1 {commit++} END {printf(\"total lines added: +%d\\ntotal lines deleted: -%d\\ntotal commits: %d\\n\", added, deleted, commit)}' total lines added: +61 total lines deleted: -21 total commits: 1 or $ git log --numstat --format=\"\" HEAD^..HEAD | awk '{files += 1}{ins += $1}{del += $2} END{print \"total: \"files\" files, \"ins\" insertions(+) \"del\" deletions(-)\"}' total: 2 files, 61 insertions(+) 21 deletions(-) git alias [alias] summary = \"!git log --numstat --format=\\\"\\\" \\\"$@\\\" | awk '{files += 1}{ins += $1}{del += $2} END{print \\\"total: \\\"files\\\" files, \\\"ins\\\" insertions(+) \\\"del\\\" deletions(-)\\\"}' #\" --shortstat $ git diff --shortstat HEAD^..HEAD 2 files changed, 61 insertions(+), 21 deletions(-) or check for multiple commits$ git diff $(git log -5 --pretty=format:\"%h\" | tail -1) --shortstat 7 files changed, 253 insertions(+), 24 deletions(-) others alias references: putermancer/.gitconfig List Git aliases Shell Tricks: One Git Alias to Rule Them All automatic documentation of gitconfig aliases using sed or awk git config alias escaping show git alias $ git --list-cmds=alias # or $ git config --get-regexp '^alias\\.' [alias] # https://stackoverflow.com/q/53841043/2940319 ### show [g]it alia[s] as = \"! bash -c '''grep --no-group-separator -A1 -e \\\"^\\\\s*###\\\" \\\"$HOME\\\"/.marslo/.gitalias | \\n\\ awk \\\"END{if((NR%2))print p}!(NR%2){print\\\\$0p}{p=\\\\$0}\\\" | \\n\\ sed -re \\\"s/( =)(.*)(###)/*/g\\\" | \\n\\ sed -re \\\"s:[][]::g\\\" | \\n\\ awk -F* \\\"{printf \\\\\\\"\\\\033[1;33m%-20s\\\\033[0m » \\\\033[0;34m%s\\\\033[0m\\\\n\\\\\\\", \\\\$1, \\\\$2}\\\" | \\n\\ sort \\n\\ '''\" or [alias] alias = \"!sh -c '[ $# = 2 ] && git config --global alias.\\\"$1\\\" \\\"$2\\\" && exit 0 || [ $# = 1 ] && [ $1 = \\\"--list\\\" ] && git config --list | grep \\\"alias\\\\.\\\" | sed \\\"s/^alias\\\\.\\\\([^=]*\\\\)=\\\\(.*\\\\).*/\\\\1@@@@=>@@@@\\\\2/\\\" | sort | column -ts \\\"@@@@\\\" && exit 0 || echo \\\"usage: git alias \\\\n git alias --list\\\" >&2 && exit 1' -\" or [alias] aliases = !git config --get-regexp ^alias\\\\. | sed -e s/^alias.// -e s/\\\\ /\\\\ $(printf \\\"\\\\043\\\")--\\\\>\\\\ / | column -t -s $(printf \\\"\\\\043\\\") or $ git config --global --get-regexp alias | awk -v nr=2 '{sub(/^alias\\./,\"\")}; \\ { printf \"\\033[31m%_10s\\033[1;37m\", $1}; \\ {sep=FS}; \\ {for (x=nr; x finda[alias] finda = \"!grepalias() { git config --global --get-regexp alias | grep -i \\\"$1\\\" | awk -v nr=2 '{sub(/^alias\\\\./,\\\"\\\")};{printf \\\"\\\\033[31m%_10s\\\\033[1;37m\\\", $1};{sep=FS};{for (x=nr; x or show-cmd [alias] show-cmd = \"!f() { \\ sep=\"㊣\" ;\\ name=${1:-alias};\\ echo -n -e '\\\\033[48;2;255;255;01m' ;\\ echo -n -e '\\\\033[38;2;255;0;01m' ;\\ echo \"$name\"; \\ echo -n -e '\\\\033[m' ;\\ git config --get-regexp ^$name\\\\..*$2+ | \\ cut -c 1-40 | \\ sed -e s/^$name.// \\ -e s/\\\\ /\\\\ $(printf $sep)--\\\\>\\\\ / | \\ column -t -s $(printf $sep) | \\ sort -k 1 ;\\ }; f\" ls references: putermancer/.gitconfig taxilian/.gitconfig [alias] ls = \"!git status -suno\" ls-modified = \"!git status --porcelain -uno | awk 'match($1, /M/) {print $2}'\" ls-added = \"!git status --porcelain -uno | awk 'match($1, /A/) {print $2}'\" ls-deleted = \"!git status --porcelain -uno | awk 'match($1, /D/) {print $2}'\" ls-renamed = \"!git status --porcelain -uno | awk 'match($1, /R/) {print $2}'\" ls-copied = \"!git status --porcelain -uno | awk 'match($1, /C/) {print $2}'\" ls-updated = \"!git status --porcelain -uno | awk 'match($1, /U/) {print $2}'\" ls-staged = \"!git status --porcelain -uno | grep -P '^[MA]' | awk '{ print $2 }'\" ls-untracked = \"!git status --porcelain -uall | awk '$1 == \\\"??\\\" {print $2}'\" git alias escaping [alias] # https://stackoverflow.com/a/39616600/2940319 # Quote / unquote a sh command, converting it to / from a git alias string quote-string = \"!read -r l; printf \\\\\\\"!; printf %s \\\"$l\\\" | sed 's/\\\\([\\\\\\\"]\\\\)/\\\\\\\\\\\\1/g'; printf \\\" #\\\\\\\"\\\\n\\\" #\" quote-string-undo = \"!read -r l; printf %s \\\"$l\\\" | sed 's/\\\\\\\\\\\\([\\\\\\\"]\\\\)/\\\\1/g'; printf \\\"\\\\n\\\" #\" check help in previw.app $ MANWIDTH=80 MANPAGER='col -bx' git help rev-parse | groff -P-pa4 -Tps -mandoc -c | open -f -a Preview.app disk size # reachable objects $ git rev-list --disk-usage --objects --all # plus reflogs $ git rev-list --disk-usage --objects --all --reflog # total disk size used $ du -c .git/objects/pack/*.pack .git/objects/??/* # alternative to du: add up \"size\" and \"size-pack\" fields $ git count-objects -v # report the disk size of each branch $ git for-each-ref --format='%(refname)' | while read branch; do size=$(git rev-list --disk-usage --objects HEAD..$branch) echo \"$size $branch\" done | sort -n # compare the on-disk size of branches in one group of refs, excluding another $ git rev-list --disk-usage --objects --remotes=$suspect --not --remotes=origin push to github with credential [!NOTE] git config credential.helper store git remote set-url credential.helper Credential stores GPG/pass compatible files $ git config credential.helper store # or git remote set-url origin https://[TOKEN]@github.com/path/to/repo.git Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-06 21:20:42 "},"devops/git/statistics.html":{"url":"devops/git/statistics.html","title":"statistics","keywords":"","body":" list all user commits history with line changes commits total commits user commits line changes full history total changes user changes tools git-stat git-stats references: * git-quick stats * IonicaBizau/git-stats * shitchell/git-user-stats * Git statistics for repo per author eyecatchup/git-commit-log-stats.md Counting your contribution to a git repository pstadler/.git-stats.sh Which Git commit stats are easy to pull GET CONTRIBUTOR STATS FROM GIT How to count total lines changed by a specific author in a Git repository? list all user commits history with line changes $ git log ${GIT_OPT} --author=\"marslo\" --oneline --shortstat [--no-merges] commits [!TIP] within time slots : --after=\"2021-01-01\" --before=\"2022-01-01\" GIT_OPT='--after=\"2021-01-01\" --before=\"2022-01-01\"' total commits $ git shortlog -s -n ${GIT_OPT} | awk '{ sum += $1; } END { print sum; }' 304 user commits $ git shortlog -sn ${GIT_OPT} 101 marslo ... # or with email $ git shortlog -sne ${GIT_OPT} 101 marslo ... # or specific account only $ git shortlog -sne ${GIT_OPT} --author='marslo' 101 marslo # or via `rev-list --count` $ git rev-list HEAD ${GIT_OPT} --author='marslo' --count 101 line changes [!NOTE] references: git contribution per author (lines) escaping alias commands in a gitconfig files full history $ git ls-files -z | xargs -0n1 git blame -w | perl -n -e '/^.*?\\((.*?)\\s+[\\d]{4}/; print $1,\"\\n\"' | sort -f | uniq -c | sort -nr # or using sed instead of perl $ git ls-files -z | xargs -0n1 git blame -w -C | sed -r 's/^[^(]+\\((.*) [0-9]{4}-.*/\\1/' | sed -r 's/ +$//' | sort -f | uniq -c | sort -nr total changes $ git log ${GIT_OPT} --numstat --pretty=tformat: | grep -v '^-' | awk '{ add+=$1; remove+=$2; loc += $1 - $2 } END \\ { printf \".. added: %s, removed: %s, total: %s .\", add, remove, loc }' .. added: 18111, removed: 11153, total: 6958 . # or : https://stackoverflow.com/a/48575013/2940319 $ git log ${GIT_OPT} --pretty=format:'' --numstat --author | awk 'NF' | awk '{insertions+=$1; deletions+=$2} END \\ {print NR, \"files changed,\", insertions, \"insertions(+),\", deletions, \"deletions(+)\"}'; # or : https://stackoverflow.com/a/4593065/2940319 # https://gist.github.com/pstadler/4722416 $ git log --shortstat ${GIT_OPT} --author 'marslo' | grep \"files\\? changed\" | awk '{files+=$1; inserted+=$4; deleted+=$6} END \\ {print \".. files changed :\", files, \"; lines inserted :\", inserted, \"; lines deleted :\", deleted , \";\"}' .. files changed : 1046 ; lines inserted : 14096 ; lines deleted : 8871 ; # or $ git log --shortstat ${GIT_OPT} --author='marslo' --oneline --format=tformat: | awk '{ files+=$1; inserted+=$4; deleted+=$6 } END \\ { print \".. files changed :\", files, \"\\n.. lines inserted :\", inserted, \"\\n.. lines deleted :\", deleted }' .. files changed : 1046 .. lines inserted : 14096 .. lines deleted : 887 # or : https://gist.github.com/eyecatchup/3fb7ef0c0cbdb72412fc $ git log --author=\"marslo\" --after=\"2022-01-01\" --pretty=tformat: --numstat | awk '{ inserted+=$1; deleted+=$2; delta+=$1-$2; ratio=deleted/inserted } END \\ { printf \"Commit stats:\\n- Lines added (total).... %s\\n- Lines deleted (total).. %s\\n- Total lines (delta).... %s\\n- Add./Del. ratio (1:n).. 1 : %s\\n\", inserted, deleted, delta, ratio }' - Commit stats: - Lines added (total).... 14090 - Lines deleted (total).. 8877 - Total lines (delta).... 5213 - Add./Del. ratio (1:n).. 1 : 0.630021 user changes $ git log \"${GIT_OPT}\" --author='marslo' --numstat --pretty=tformat: | grep -v '^-' | awk '{ add+=$1; remove+=$2; loc += $1 - $2 } END { printf \".. added: %s, removed: %s, total: %s .\", add, remove, loc }' .. added: 14090, removed: 8877, total: 5213 . tools git-stat [!NOTE] download from github.com/marslo/mytools usage: example: git-stats $ export NODE_TLS_REJECT_UNAUTHORIZED=0 $ npm config set strict-ssl false $ npm i -g git-stats (node:2823) Warning: Setting the NODE_TLS_REJECT_UNAUTHORIZED environment variable to '0' makes TLS connections and HTTPS requests insecure by disabling certificate verification. /usr/local/bin/git-stats -> /usr/local/lib/node_modules/git-stats/bin/git-stats > git-stats@3.1.1 postinstall /usr/local/lib/node_modules/git-stats > node scripts/migration/2.0.0.js + git-stats@3.1.1 added 100 packages from 57 contributors in 15.748s # optional $ npm i -g git-stats-importer $ npm i -g git-stats-html # usage $ git-stats --raw | git-stats-html -o out.html $ npm i -g pageres-cli # usage $ pageres out.html 775x250 $ curl -sk https://raw.githubusercontent.com/IonicaBizau/git-stats/master/scripts/init-git-post-commit | bash Setting up git-stats hooks. Set new global git template dir at /Users/marslo/.git-templates Successfully set up git-stats hook at /Users/marslo/.git-templates/hooks/post-commit. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/ansible.html":{"url":"devops/ansible.html","title":"ansible","keywords":"","body":" environment install upgrade completion ansible-vault encrypted files prompt for the password reset key encrypt decrypt view ansible-galaxy ansible-playbook tags ansible-config get all default plugin lookup troubleshooting [!NOTE|label:references:] Ansible 详解（四）：Ansible-vault Ansible中文权威指南 Vault Playbooks Ansible Documentation Installing Ansible Protecting sensitive data with Ansible vault * Ansible Vault Tips and tricks ansible.builtin.template 10 ansible vault examples to decrypt/encrypt string & files environment $ sudo dnf install wget yum-utils make gcc openssl-devel bzip2-devel libffi-devel zlib-devel $ sudo dnf groupinstall 'development tools $ sudo dnf -y install epel-release $ sudo dnf install python39 $ sudo update-alternatives --config python $ sudo update-alternatives --config python3 install $ python -m pip install --user ansible install for development$ python -m pip install --user https://github.com/ansible/ansible/archive/devel.tar.gz upgrade $ python -m pip install --user --upgrade ansible completion $ python -m pip install --user argcomplete $ cat >> ~/.bashrc /dev/null && eval $(register-python-argcomplete ansible) && eval $(register-python-argcomplete ansible-config) && eval $(register-python-argcomplete ansible-console) && eval $(register-python-argcomplete ansible-doc) && eval $(register-python-argcomplete ansible-galaxy) && eval $(register-python-argcomplete ansible-inventory) && eval $(register-python-argcomplete ansible-playbook) && eval $(register-python-argcomplete ansible-pull) && eval $(register-python-argcomplete ansible-vault) EOF completion.bash $ mkdir -p ~/.marslo/.completion $ git clone git@github.com:dysosmus/ansible-completion.git ~/.marslo/.completion/ansible-completion $ cat >> ~/.bashrc or via ln$ ls -1 --color=none /path/to/ansible-completion/*.bash | xargs -t -I{} bash -c \"ln -svf {} /usr/local/share/bash-completion/completions/\\$(basename {} | awk -F'.' '{print \\$1}')\" ansible-vault [!NOTE] Encrypting content with Ansible Vault * iMarslo : check line ending * iMarslo : remove the ending '\\n' encrypted files [!NOTE|label:references:] Why should text files end with a newline? Removing a newline character at the end of a file$ truncate -s -1 /path/to/yaml sed solution$ sed -z s/.$// pw.txt | od -c 0000000 a b c 0000003 printf solution $ printf %s \"$( head solution $ head -c -1 pw.txt | od -c 0000000 a b c \\n e f g 0000007 $ truncate -s -1 foo.yml $ ansible-vault create --vault-id @prompt foo.yml New vault password (default): Confirm new vault password (default): $ cat foo.yml $ANSIBLE_VAULT;1.1;AES256 65393763393937353538636266646432646265643531343530623436373462633663333234653032 6131396532663939376339306261616637316561343531350a393536353331343837653265383037 30343839316531666530336134623135313535336136653232653533643131303364306265393336 3234366662313332640a613963633766663061643064356530643863373138393039326466333638 3638 create with name $ ansible-vault create --vault-id test@prompt foo.yml New vault password (test): Confirm new vault password (test): $ cat foo.yml $ANSIBLE_VAULT;1.2;AES256;test 33303164313336626433376532306266633237333038653931386531616637666637626238346339 3764383262343066636236626666613562363130636565630a313966376138323931333635333266 32633330356132626637663534633165356133653639653130303839336338336261316362343065 3964613438623337630a663735313836353566326333323732303232303864393063646432353463 3631 prompt for the password [!TIP] via --vault-id @prompt How to see special characters? be aware of the echo will automatically appending the \\n in the end of the line:$ echo 'abc' | od -c 0000000 a b c \\n 0000004 with echo -n$ echo -n 'abc' | od -c 0000000 a b c 0000003 $ echo -n 'Test123!' | ansible-vault encrypt_string --vault-id @prompt New vault password (default): Confirm new vault password (default): Reading plaintext input from stdin. (ctrl-d to end input, twice if your content does not already have a newline) Encryption successful !vault | $ANSIBLE_VAULT;1.1;AES256 62306630653236616438653236353135623936626332636337396432346235376364386233363938 3930663634396138373139643031396433386339353634640a323938323431356330323363353335 61636134636539326539623665393261643462396239653864313861393761633762313161386464 3166333136366465370a323765386238646539613438333334633434613533373565326464383836 6464 or$ ansible-vault encrypt_string New Vault password: Confirm New Vault password: Reading plaintext input from stdin. (ctrl-d to end input, twice if your content does not already have a newline) abc^D # ctrl-d twice Encryption successful !vault | $ANSIBLE_VAULT;1.1;AES256 39323234633365393633306135386362373463356636633937336236643763616232383832396333 3136343265346534306638343738363435393964353262330a313331323161653832656365336331 36356564653565613664666631346434306366666163393463633030363732336436346364613638 3038303934366166320a633064326333623062663362343031633065333138313762353534643530 633 reset key $ ansible-vault rekey --vault-id @prompt /path/to/file encrypt $ ansible-vault encrypt --vault-id @prompt /path/to/file decrypt $ ansible-vault decrypt --vault-id @prompt /path/to/file decrypt from string # encrypt $ echo -n 'a' | ansible-vault encrypt_string Reading plaintext input from stdin. (ctrl-d to end input, twice if your content does not already have a newline) Encryption successful !vault | $ANSIBLE_VAULT;1.1;AES256 63666334316139653431343330386139346466356439373263643566373062613666653362353738 3630386133363464313964666230313062666662396161650a313165353966393136643932643434 64306666613835333130613866303730623538313136323236653732663461623532343035626262 3932643631653739350a306131666337633831653233623638396438386535623938626133653332 3464 # decrypt $ echo -n '$ANSIBLE_VAULT;1.1;AES256 63666334316139653431343330386139346466356439373263643566373062613666653362353738 3630386133363464313964666230313062666662396161650a313165353966393136643932643434 64306666613835333130613866303730623538313136323236653732663461623532343035626262 3932643631653739350a306131666337633831653233623638396438386535623938626133653332 3464' | ansible-vault decrypt Decryption successful a view $ ansible-vault view --vault-id @prompt /path/to/file ansible-galaxy [!NOTE|label:references:] * Kubernetes Collection for Ansible ansible-collections/kubernetes.core kubernetes.core.k8s kubernetes.core kubernetes.core.k8s Collections in the Kubernetes Namespace Kubernetes.Core installing roles and collections from the same requirements.yml file helm – Manages Kubernetes packages with the Helm package manager The Inside Playbook Creating Kubernetes Dynamic Inventories with kubernetes.core Modules * Automating Helm using Ansible k8s_taint Kubernetes Meets Event-Driven Ansible $ ansible-galaxy collection install kubernetes.core # or $ ansible-galaxy install -r requirements.yml example - name: Deploy latest version of Prometheus chart inside monitoring namespace (and create it) kubernetes.core.helm: name: test chart_ref: stable/prometheus release_namespace: monitoring create_namespace: true # From repository - name: Add stable chart repo kubernetes.core.helm_repository: name: stable repo_url: \"https://kubernetes.github.io/ingress-nginx\" - name: Deploy latest version of Grafana chart inside monitoring namespace with values kubernetes.core.helm: name: test chart_ref: stable/grafana release_namespace: monitoring values: replicas: 2 - name: Deploy Grafana chart on 5.0.12 with values loaded from template kubernetes.core.helm: name: test chart_ref: stable/grafana chart_version: 5.0.12 values: \"{{ lookup('template', 'somefile.yaml') | from_yaml }}\" - name: Deploy Grafana chart using values files on target kubernetes.core.helm: name: test chart_ref: stable/grafana release_namespace: monitoring values_files: - /path/to/values.yaml - name: Remove test release and waiting suppression ending kubernetes.core.helm: name: test state: absent wait: true - name: Separately update the repository cache kubernetes.core.helm: name: dummy namespace: kube-system state: absent update_repo_cache: true - name: Deploy Grafana chart using set values on target kubernetes.core.helm: name: test chart_ref: stable/grafana release_namespace: monitoring set_values: - value: phase=prod value_type: string # From git - name: Git clone stable repo on HEAD ansible.builtin.git: repo: \"http://github.com/helm/charts.git\" dest: /tmp/helm_repo - name: Deploy Grafana chart from local path kubernetes.core.helm: name: test chart_ref: /tmp/helm_repo/stable/grafana release_namespace: monitoring # From url - name: Deploy Grafana chart on 5.6.0 from url kubernetes.core.helm: name: test chart_ref: \"https://github.com/grafana/helm-charts/releases/download/grafana-5.6.0/grafana-5.6.0.tgz\" release_namespace: monitoring # Using complex Values - name: Deploy new-relic client chart kubernetes.core.helm: name: newrelic-bundle chart_ref: newrelic/nri-bundle release_namespace: default force: True wait: True replace: True update_repo_cache: True disable_hook: True values: global: licenseKey: \"{{ nr_license_key }}\" cluster: \"{{ site_name }}\" newrelic-infrastructure: privileged: True ksm: enabled: True prometheus: enabled: True kubeEvents: enabled: True logging: enabled: True ansible-playbook [!NOTE|label:references:] passwordless via environment variables # without password $ export ANSIBLE_VAULT_PASSWORD_FILE=/path/to/password.txt $ ansible-playbook -i hosts /path/to/yaml # with password $ ansible-playbook -i hosts /path/to/yaml --vault-id @prompt tags [!NOTE|label:references] Special tags: always and never Use Ansible tags to save time on playbook runs never $ cat sample.yaml --- - hosts: localhost gather_facts: False tasks: - name: Hello tag example debug: msg: \"Hello!\" tags: - hello - name: No tag example debug: msg: \"How are you?\" - name: Goodbye tag example debug: msg: \"Goodbye!\" tags: - goodbye - never # will not be executed unless using `--tags goodbye` result $ ansible-playbook sample.yaml PLAY [localhost] ************************************************************************* TASK [Hello tag example] ***************************************************************** ok: [localhost] => { \"msg\": \"Hello!\" } TASK [No tag example] ******************************************************************** ok: [localhost] => { \"msg\": \"How are you?\" } PLAY RECAP ******************************************************************************* localhost : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 result with --tags $ ansible-playbook sample.yaml --tags goodbye PLAY [localhost] ************************************************************************* TASK [Goodbye tag example] *************************************************************** ok: [localhost] => { \"msg\": \"Goodbye!\" } PLAY RECAP ******************************************************************************* localhost : ok=1 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 ansible-config [!NOTE|label:referencs:] v2.4 Configuration file get all default $ ansible-config init --disabled -t all disable localhost warning$ cat ansible.cfg [defaults] localhost_warning=false plugin lookup [!NOTE|label:references:] 自动化运维 | Ansible lookup sample code $ ls --color=none lookup* | xargs -n1 -t cat cat lookup-content.txt hello world cat lookup.yaml --- - hosts: localhost tasks: vars: contents: \"{{ lookup('file', '/home/marslo/iMarslo/study/code/ansible/lookup-content.txt')}}\" tasks: - debug: msg=\"the content of file lookup-content.txt is {{contents}}\" $ ansible-playbook lookup.yaml PLAY [localhost] ************************************************************************* TASK [Gathering Facts] ******************************************************************* Monday 24 July 2023 17:43:51 -0700 (0:00:00.007) 0:00:00.007 *********** ok: [localhost] TASK [debug] ***************************************************************************** Monday 24 July 2023 17:43:51 -0700 (0:00:00.935) 0:00:00.943 *********** ok: [localhost] => {} MSG: the content of file lookup-content.txt is hello world PLAY RECAP ******************************************************************************* localhost : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Monday 24 July 2023 17:43:52 -0700 (0:00:00.030) 0:00:00.974 *********** =============================================================================== Gathering Facts ------------------------------------------------------------------- 0.94s debug ----------------------------------------------------------------------------- 0.03s troubleshooting generate the final yaml via ansible.builtin.template# in tasks/main.yaml - name: Template a file to local ansible.builtin.template: src: file_in_template.yaml dest: /local/path/to/yaml Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/vault.html":{"url":"devops/vault.html","title":"vault","keywords":"","body":" environment install compltion status get info auth security create approle via CLI via API get secret_id and role_id usage API CLI path-help stdin Files basic usage [!NOTE|label:references] vault CLI Integrate HashiCorp Vault with CICD tool(Jenkins) How To Read Vault’s Secrets from Jenkin’s Declarative Pipeline Hashicorp vault how to list all roles AppRole auth method environment install macos $ brew tap hashicorp/tap $ brew install hashicorp/tap/vault ubunut/debian $ wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg $ echo \"deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main\" | sudo tee /etc/apt/sources.list.d/hashicorp.list $ sudo apt update && sudo apt install vault centos/rhel $ sudo yum install -y yum-utils $ sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo $ sudo yum -y install vault compltion $ vault -autocomplete-install status $ vault status Key Value --- ----- Seal Type shamir Initialized true Sealed false Total Shares 5 Threshold 3 Version 1.9.0 Build Date n/a Storage Type file Cluster Name vault-cluster-ea2f5821 Cluster ID e034c5c3-53c6-2d38-2adf-e9bbd57ad87c HA Enabled false get info auth list role type $ vault auth list Path Type Accessor Description Version ---- ---- -------- ----------- ------- approle/ approle auth_approle_375212fa n/a n/a ldap/ ldap auth_ldap_8fc0eb82 n/a n/a token/ token auth_token_f61ed5a6 token based credentials n/a list roles $ vault list auth/approle/role Keys ---- jenkins jenkins-role read role $ vault read auth/approle/role/jenkins Key Value --- ----- bind_secret_id true local_secret_ids false secret_id_bound_cidrs secret_id_num_uses 0 secret_id_ttl 0s token_bound_cidrs [] token_explicit_max_ttl 0s token_max_ttl 4h token_no_default_policy false token_num_uses 0 token_period 0s token_policies [service-ssh] token_ttl 1h token_type default security list all path $ vault secrets list [ -detailed ] Path Type Accessor Description ---- ---- -------- ----------- devops/ kv kv_374198a0 for devops list keys $ vault kv list devops/service-account/ Keys ---- read-only read-write read-write-delete get contents $ vault kv get devops/service-account/read-only =============== Secret Path =============== devops/data/service-account/read-only ======= Metadata ======= Key Value --- ----- created_time 2023-03-06T15:52:45.827580966Z custom_metadata deletion_time n/a destroyed false version 5 ============ Data ============ Key Value --- ----- cn read-only dn CN=read-only,OU=Service-Accounts,DC=example,DC=com password ******** sAMAccountName read-only username read-only create approle via CLI pre-setup $ export VAULT_ADDR='https://vault.domain.com' $ export VAULT_TOKEN='s.s**********************K' setup $ vault write auth/approle/role/devops \\ token_num_uses=0 \\ secret_id_num_uses=0 \\ policies=\"devops\" Success! Data written to: auth/approle/role/devops $ vault read auth/approle/role/devops Key Value --- ----- bind_secret_id true local_secret_ids false policies [devops] secret_id_bound_cidrs secret_id_num_uses 0 secret_id_ttl 0s token_bound_cidrs [] token_explicit_max_ttl 0s token_max_ttl 0s token_no_default_policy false token_num_uses 0 token_period 0s token_policies [devops] token_ttl 0s token_type default via API # enable auth method $ curl \\ --header \"X-Vault-Token: ...\" \\ --request POST \\ --data '{\"type\": \"approle\"}' \\ http://127.0.0.1:8200/v1/sys/auth/approle # create approle with policy $ curl \\ --header \"X-Vault-Token: ...\" \\ --request POST \\ --data '{\"policies\": \"dev-policy,test-policy\"}' \\ http://127.0.0.1:8200/v1/auth/approle/role/my-role # check identifier of role $ curl \\ --header \"X-Vault-Token: ...\" \\ http://127.0.0.1:8200/v1/auth/approle/role/my-role/role-id { \"data\": { \"role_id\": \"988a9dfd-ea69-4a53-6cb6-9d6b86474bba\" } } # create new security $ curl \\ --header \"X-Vault-Token: ...\" \\ --request POST \\ http://127.0.0.1:8200/v1/auth/approle/role/my-role/secret-id { \"data\": { \"secret_id_accessor\": \"45946873-1d96-a9d4-678c-9229f74386a5\", \"secret_id\": \"37b74931-c4cd-d49a-9246-ccc62d682a25\", \"secret_id_ttl\": 600, \"secret_id_num_uses\": 40 } } get secret_id and role_id # read for role-id $ vault read auth/approle/role/devops/role-id Key Value --- ----- role_id 1*******-****-****-****-***********5 $ vault write -f auth/approle/role/srv-ssd-fw-devops/secret-id Key Value --- ----- secret_id 3*******-****-****-****-***********3 secret_id_accessor 9*******-****-****-****-***********b secret_id_ttl 0 # list for secret_id $ vault list auth/approle/role/devops/secret-id Keys ----- 9*******-****-****-****-***********b usage API [!NOET|label:references:] api v1.14.x $ curl \\ -H \"X-Vault-Token: f3b09679-3001-009d-2b80-9c306ab81aa6\" \\ -H \"X-Vault-Namespace: ns1/ns2/\" \\ -X GET \\ http://127.0.0.1:8200/v1/secret/foo # or $ curl \\ -H \"X-Vault-Token: f3b09679-3001-009d-2b80-9c306ab81aa6\" \\ -X GET \\ http://127.0.0.1:8200/v1/ns1/ns2/secret/foo CLI [!NOTE|label:references:] * Vault commands (CLI) Rotate Azure auth method root credentials with Vault CLI auth kv list secrets policy debug print curl commands $ vault write -output-curl-string auth/userpass/users/bob password=\"long-password\" curl -X PUT -H \"X-Vault-Request: true\" -H \"X-Vault-Token: $(vault print token)\" -d '{\"password\":\"long-password\"}' http://127.0.0.1:8200/v1/auth/userpass/users/bob print policy requirements$ vault kv put -output-policy kv/secret value=itsasecret path \"kv/data/secret\" { capabilities = [\"create\", \"update\"] } path-help $ vault path-help devops ... ^.*$ ^config$ Configures settings for the KV store ^data/(?P.*)$ Write, Patch, Read, and Delete data in the Key-Value Store. ^delete/(?P.*)$ Marks one or more versions as deleted in the KV store. ^destroy/(?P.*)$ Permanently removes one or more versions in the KV store ^metadata/(?P.*)$ Configures settings for the KV store ^undelete/(?P.*)$ Undeletes one or more versions from the KV store. and more $ vault path-help sys/mounts Request: mounts Matching Route: ^mounts$ ## DESCRIPTION This path responds to the following HTTP methods. GET / Lists all the mounted secret backends. GET / Get information about the mount at the specified path. POST / Mount a new secret backend to the mount point in the URL. POST //tune Tune configuration parameters for the given mount point. DELETE / Unmount the specified mount point. stdin $ echo -n '{\"value\":\"itsasecret\"}' | vault kv put secret/password - # or $ echo -n \"itsasecret\" | vault kv put secret/password value=- Files $ vault kv put secret/password @data.json # or $ vault kv put secret/password value=@data.txt basic usage $ export VAULT_ADDR='http://127.0.0.1:8200' $ export VAULT_TOKEN=root # enable azure $ vault auth enable azure # write config $ vault write auth/azure/config \\ tenant_id=\"${TENANT_ID}\" \\ client_id=\"${CLIENT_ID}\" \\ client_secret=\"${CLIENT_SECRET}\" \\ resource=\"https://management.azure.com/\" # write role $ vault write auth/azure/role/rotation-role \\ bound_subscription_ids=\"${SUBSCRIPTION_ID}\" \\ bound_resource_groups=\"${RESOURCE_GROUP_NAME}\" # login $ vault write auth/azure/login \\ role=\"rotation-role\" \\ jwt=\"${ACCESS_TOKEN_JWT}\" \\ subscription_id=\"${SUBSCRIPTION_ID}\" \\ resource_group_name=\"${RESOURCE_GROUP_NAME}\" \\ vm_name=\"${VM_NAME}\" resultKey Value --- ----- token hvs.XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX token_accessor XXXXXXXXXXXXXXXXXXXXXX token_duration 768h token_renewable true token_policies [\"default\"] identity_policies [] policies [\"default\"] token_meta_vm_name vault-azure-tests-vm token_meta_resource_group_name vault_azure_tests_XXXXXXXX token_meta_role rotation-role token_meta_subscription_id XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXX Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"artifactory/artifactory.html":{"url":"artifactory/artifactory.html","title":"artifactory","keywords":"","body":" reference integration with pipeline aql Artifactory SSL Certification configuration allow partial folder in particular repo access token [!NOTE|label:reference:] How to enable verbose log on JVM Garbage Collection JAVA_OPTIONS:-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xloggc:/path/to/file/gc.log reference integration with pipeline Scripted Pipeline Syntax Jenkins Pipeline Examples aql Jenkins Artifactory Plugin AQL download latest artifact matching pattern $pair = \"$($art_user):$($art_pass)\" Write-Verbose \"Attempting to convert Artifactory credentials to a base64 string for automation\" $encodedCreds = [System.Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes($pair)) $basicAuthValue = \"Basic $encodedCreds\" $headers = @{ Authorization = $basicAuthValue } Write-Host \"Attempting to perform a AQL search.\" $aql_search = $art_base_url + \"/api/search/aql\" Write-Host \"Building aql query with the following parameters, groupID: $group_id, artifactID: $artifact_id, version: $version, classifier: $classifier and repos: $art_generic_repokey.\" $aql_query = 'items.find({\"repo\":\"' + $art_generic_repokey + '\",\"$or\":[{\"$and\":[{\"path\":{\"$match\":\"' + $group_id + '/' + $artifact_id + '/' + $version + '\"},\"name\":{\"$match\":\"' + $artifact_id + '*' + $classifier + '*.' + $extension + '\"}}]}]}).sort({\"$desc\":[\"modified\"]}).limit(1)' Write-Host \"Built the following aql query: '$aql_query' .\" $aql_content = Invoke-RestMethod -Uri $aql_search -Headers $headers -Method Post -Body $aql_query -ContentType 'text/plain' Write-Host \"Attempting to submit the aql query to the following artifactory server: $art_base_url.\" $aql_results = ($aql_content).results Write-Host \"Attempting to parse query results and build the artifact download uri.\" $aql_repo,$aql_path,$aql_name = ($aql_results).repo,($aql_results).path,($aql_results).name $artifactDownloadUri = $art_base_url + '/' + $aql_repo + '/' + $aql_path + '/' + $aql_name Write-Host \"Found the following uri: $artifactDownloadUri !!\" if ($artifactMimeType -eq 'application/zip' -or $extension -eq 'zip') { Write-Verbose \"Attempting to save the artifact to $download_dir/$art_dist_name.zip\" Invoke-RestMethod -Uri $artifactDownloadUri -Headers $headers -OutFile \"$download_dir/$art_dist_name.zip\" } Artifactory SSL Certification [!NOTE|label:references:] ARTIFACTORY: How to Resolve an “unable to find valid certification path to requested target” Error Using TLS Certificates as a Client Working with Certificates and SSL ibook : ssl/keystore [!TIP|label:see also:] iMarslo: get remote server certs get remote cert $ openssl s_client -showcerts -connect : #i.e. $ echo -n | openssl s_client -connect : -debug | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > .crt # or $ keytool -printcert \\ -rfc \\ -sslserver : > .crt # or # https://www.howtouselinux.com/post/openssl-command-to-generate-view-check-certificate $ echo -n | openssl s_client \\ [-servername ] \\ -connect : 2>/dev/null | openssl x509 [!NOTE] if issue (i:) is the same as subject (s:). Therefore, this is the root certificat. i.e. : $ openssl s_client -connect cdn.redhat.com:443 -showcerts import to truststore $ sudo keytool -importcert \\ -keystore /usr/local/java/jdk1.8.0_60/jre/lib/security/cacerts \\ -storepass changeit \\ -file .crt \\ -alias \"-crt\" configuration allow partial folder in particular repo access token [!NOTE|label:references:] ARTIFACTORY: Creating Access Tokens in Artifactory Access Tokens generating expirable tokens from version 7.21.1, this can be specified by setting the token.max-expiry parameter in the $JFROG_HOME/artifactory/var/etc/artifactory/access.config.yml file ( prior to version 7.21.1, the parameter to set was artifactory.access.token.non.admin.max.expires.in ). if the token.max-expiry is equal to 0 (which is the default), there is no limitation to the token expiry. However, if the maximum expiry is greater than 0, the user cannot create a non-expirable token. the token.max-expiry parameter must be set to a value higher than the token.default-expiry parameter value. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"artifactory/api.html":{"url":"artifactory/api.html","title":"api","keywords":"","body":" variable list list subfolders in 1st depth list docker image tags list docker registry repo check repo exists get all repos get all local repos get repo size build info list all build-info id list all timestamps in ${buildName} List specific build-info filter \"buildInfo.env.JOB_NAME\" in all builds cleanup delete all in my-repo 4 weeks ago trash can builds rotation via api/build/retention promote property search deploy deploy single artifacts deploy bundle artifact variable $ rtUrl='https://my.artifactory.com/artifactory' $ repoName='my-repo' $ buildName='my - repo' $ buildNumber=12345 $ curlOpt=\"-s -g --netrc-file ~/.marslo/.netrc\" list list subfolders in 1st depth [!TIP] references: File ListUsage: GET /api/storage/{repoKey}/{folder-path}?list[&deep=0/1][&depth=n][&listFolders=0/1][&mdTimestamps=0/1][&includeRootPath=0/1] $ /usr/bin/curl ${curlOpt} \\ -X GET \"${rtUrl}/api/storage/${repoName}-local?list&deep=1&listFolders=1&depth=1\" | jq -r '.files[].uri | split(\"/\")[1])' list docker image tags [!NOTE|label:references:] List Docker Tags GET /api/docker/{repo-key}/v2/{image name}/tags/list?n=&last= # API: /api/docker//v2//tags/list # i.e.: $ curl -fsSL -XGET https://artifactory.example.com/artifactory/api/docker/devops-docker/v2/devops/ubuntu/tags/list | jq -r .tags [ \"1.1-bionic\", \"1.1-bionic-dind\", \"1.2-bionic\", \"1.2-bionic-dind\", \"1.4-bionic\", \"1.4-bionic-dind\", ... ] list docker registry [!NOTE|label:references:] List Docker Repositories $ curl -fsSL -XGET https://artifactory.example.com/artifactory/api/docker/devops-docker/v2/_catalog | jq -r .repositories [ \"busybox\", \"centos\", ... ] repo check repo exists $ /usr/bin/curl ${curlOpt} \\ -X GET \"${rtUrl}/api/repositories\" | jq .[].key | grep \"${repo}\" get all repos [!NOTE] api/repositories $ curl -sSg \\ -X GET \\ https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | .type + \" ~> \" + .key' LOCAL ~> local-repo REMOTE ~> remote-repo VIRTUAL ~> virtual-repo ... get all local repos $ curl -sSg \\ -X GET \\ https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | select(.type == \"LOCAL\") | .key' get all virtual repos $ curl -sSg \\ -X GET \\ https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | select(.type == \"VIRTUAL\") | .key' get all virtual repos, and repo name starts with ''$ curl -sSg \\ -X GET https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | select((.type == \"VIRTUAL\") and select(.key | startswith(\"\"))) | .key' get defaultDeployRepo for all virutal repos who named starts with ''$ for i in $(curl -sSg \\ -XGET https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | select((.type == \"VIRTUAL\") and select(.key | startswith(\"\"))) | .key' ); do echo \"${i} : \" curl -sSg \\ --netrc-file /home/marslo/.marslo/.netrc \\ -XGET https://my.artifactory.com/artifactory/api/repositories/${i} | jq .defaultDeploymentRepo echo ' ' done get all remote repos $ curl -sSg \\ -X GET \\ https://my.artifactory.com/artifactory/api/repositories | jq -r '.[] | select(.type == \"REMOTE\") | .key' get repo size [!NOTE] api/storageinfo get storage summary [!NOTE] including: binariesSummary fileStoreSummary repositoriesSummaryList $ curl -s \\ -XGET \\ https://${rtUrl}/artifactory/api/storageinfo | jq '[.binariesSummary, .fileStoreSummary][]' { \"binariesCount\": \"10,959\", \"binariesSize\": \"167.36 GB\", \"artifactsSize\": \"349.80 GB\", \"optimization\": \"47.85%\", \"itemsCount\": \"30,700\", \"artifactsCount\": \"20,547\" } { \"storageType\": \"file-system\", \"storageDirectory\": \"/opt/jfrog/artifactory/data/filestore\", \"totalSpace\": \"25.34 TB\", \"usedSpace\": \"10.41 TB (41.09%)\", \"freeSpace\": \"14.93 TB (58.91%)\" } build info list all build-info id $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X GET ${rtUrl}/api/build/${buildName} | jq -r '.buildsNumbers[].uri | split(\"/\")[1]' | sort -Vr list all timestamps in ${buildName} $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X GET ${rtUrl}/api/build/${buildName} \\ | jq .buildsNumbers[].started List specific build-info $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X GET ${rtUrl}/api/build/${buildName}/${buildNumber} get start timestampe$ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X GET ${rtUrl}/api/build/${buildName}/${buildNumber} \\ | jq .buildInfo.started \"2020-09-30T02:38:32.264-0700\" filter \"buildInfo.env.JOB_NAME\" in all builds $ BUILD_NAME='my - job' $ RT_URL='https://my.artifactory.com/artifactory' $ for i in $(curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}\" | jq -r '.[][]?.uri' ); do echo \"~~~> ${i}\" curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}${i}\" | jq --raw-output '.buildInfo.properties.\"buildInfo.env.JOB_NAME\"' echo '' done or #!/usr/bin/env bash BUILD_NAME='my - build' CURL_OPT=\"-sg --netrc-file $HOME/.marslo/.netrc\" RT_URL='https://my.artifactory.com/artifactory' for bid in $(curl ${CURL_OPT} -X GET \"${RT_URL}/api/build/${BUILD_NAME}\" | jq -r '.[][]?.uri'); do curl ${CURL_OPT} -X GET \"${RT_URL}/api/build/${BUILD_NAME}${bid}\" \\ | jq -r '.buildInfo.properties | select(.\"buildInfo.env.JOB_NAME\" | contains(\"marslo\"))' \\ | jq -r '[.\"buildInfo.env.JOB_NAME\" , .\"buildInfo.env.BUILD_URL\"]' done filter \"buildInfo.env.JOB_NAME\" by keyword $ BUILD_ID='/297' $ curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}${BUILD_ID}\" \\ | jq -r '.buildInfo.properties | select(.\"buildInfo.env.JOB_NAME\" | contains(\"marslo\"))' \\ | jq -r '.\"buildInfo.env.JOB_NAME\"' marslo/rc filter both \"buildInfo.env.BUILD_URL\" and \"buildInfo.env.JOB_NAME\" if JOB_NAME contains keyword $ curl -sg -X GET \"${RT_URL}/api/build/${BUILD_NAME}${BUILD_ID}\" \\ | jq -r '.buildInfo.properties | select(.\"buildInfo.env.JOB_NAME\" | contains(\"marslo\"))' \\ | jq -r '[.\"buildInfo.env.JOB_NAME\" , .\"buildInfo.env.BUILD_URL\"]' [ \"marslo/rc\", \"https://my.jenkins.com/job/marslo/job/rc/297/\" ] cleanup delete all in my-repo 4 weeks ago find.aql $ cat find.aql items.find({ \"repo\": \"my-repo\", \"type\" : \"folder\" , \"depth\" : \"1\", \"created\" : { \"$before\" : \"4w\" } }) delete artifacts and buildinfo rtURL='https://my.artifactory.com/artifactory' cibuild='my-jenkins-build' repo='my-repo' curlOpt= '-s -g --netrc-file ~/.marslo/.netrc' for _i in $(curl ${curlOpt} \\ -X POST ${rtURL}/api/search/aql \\ -T find.aql | jq --raw-output .results[].name \\ ); do curl ${curlOpt} -X DELETE \"${rtURL}/${repo}/${_i}\" curl ${curlOpt} -X DELETE \"${rtURL}/api/build/${cibuild}?buildNumbers=${_i}&artifacts=1\" curl ${curlOpt} -X DELETE \"${rtUrl}/api/trash/clean/${repo}/${_i}\" curl ${curlOpt} -X DELETE \"${rtUrl}/api/trash/clean/artifactory-build-info\" done trash can empty trash can $ curl -s \\ -g \\ --netrc-file ~/.marslo/.netrc' \\ -X POST \\ \"${rtUrl}/api/trash/empty\" list items in trash can $ curl -s \\ -g \\ --netrc-file ~/.marslo/.netrc' \\ -X GET \\ \"${rtURL}/api/storage/auto-trashcan\" | jq .children[].uri builds rotation via api/build/retention $ date -d 'now - 2 months' +%s%3N 1597232120161 $ date -d @$(echo '1597232120161' | rev | cut -c4- | rev) Wed Aug 12 19:35:20 CST 2020 $ cat rotation.json { \"deleteBuildArtifacts\" : true , \"count\" : 3 , \"minimumBuildDate\" : 1597232120161 , \"buildNumbersNotToBeDiscarded\" : [] } $ curl -s \\ -g \\ -X POST \\ -d @rotation.json \\ -H \"Content-Type: application/json\" \\ --netrc-file ~/.marslo/.netrc' \\ \"https://my.artifactory.com/artifactory/api/build/retention/build%20-%20name?async=false\" promote reference: How do I promote a build using the REST-API? build promotion $ cat promot.json { \"status\": \"released\", \"ciUser\": \"ci-user\", \"dryRun\" : false, \"targetRepo\" : \"my-repo-release\", \"copy\": true, \"artifacts\" : true, \"dependencies\" : true, \"scopes\" : [ \"compile\", \"runtime\" ], \"properties\": { \"release-name\": [\"marslo-test\"] } } $ curl -s \\ -g \\ -i \\ -k \\ -H \"Content-type:application/json\" \\ -d @promot.json \\ -X POST \\ '${rtURL}/api/build/promote/${buildName}/' property add property $ path='libs-release-local/pkg' $ properties=$('os=win,linux|qa=done' | sed 's:|:%7C:') $ curl -s \\ -g \\ -I \\ --netrc-file ~/.marslo/.netrc \\ -X PUT \\ '${rtURL}/storage/${repoName}-local/${path}?properties=${properties}&recursive=1' get result $ curl -sgI \\ --netrc-file ~/.marslo/.netrc \\ -X PUT \\ '${rtURL}/storage/${repoName}-local/${path}?properties=${properties}&recursive=1' \\ | sed -rn 's:^HTTP/2\\s?([0-9]+)\\s?:\\1:gp' 204 # or 400 # or 404 search via pattern search $ pattern='*/pkg/*/*.jar' $ curl -s \\ -g \\ -k \\ --netrc-file ~/.marslo/.netrc \\ -X GET \\ \"${rtURL}/search/pattern?pattern=${repoName}-local:${pattern}\" via aql search $ curl -s \\ -k \\ -X POST \\ -H 'Content-Type:text/plain' \\ 'https://artifactory.domain.com/artifactory/api/search/aql' \\ -d 'builds.find({ \"name\": \"my - build - dev\", \"created\": {\"$before\": \"3days\"} }).sort({\"$desc\": [\"created\"]}).limit(1) ' deploy deploy single artifacts $ curl -gsSL \\ --netrc-file ~/.marslo/.netrc \\ -XPUT \\ \"https://artifactory.domain.com/artifactory//\" \\ -T .txt deploy bundle artifact $ curl -g \\ -s \\ -SL \\ -H \"X-Explode-Archive-Atomic: true\" \\ -X PUT \\ \"https://artifactory.domain.com/artifactory///\" \\ -T .[zip\\|tar.gz\\|tgz] Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"artifactory/cli.html":{"url":"artifactory/cli.html","title":"cli","keywords":"","body":" CLI setup completion Environment Variables jf options CLI CLI configuration ping discarding old builds from artifactory search with aql CLI setup [!NOTE|label:reference:] * JFrog CLI v2 * Artifactory CLI * Get Cli JFrog CLI INSTALL JFROG CLI jfrog/jfrog-cli windows # Command Prompt > powershell \"Start-Process -Wait -Verb RunAs powershell '-NoProfile iwr https://releases.jfrog.io/artifactory/jfrog-cli/v2-jf/2.41.1/jfrog-cli-windows-amd64/jf.exe -OutFile $env:USERPROFILE\\jf.exe'\" # verify > %USERPROFILE%\\jf.exe --help NAME: jf - See https://github.com/jfrog/jfrog-cli for usage instructions. USAGE: jf [global options] command [command options] [arguments...] ... homebrew $ brew install jfrog-cli centos # via curl $ curl -fL https://install-cli.jfrog.io | sh # or $ sudo bash -c \"cat > /etc/yum.repos.d/jfrog-cli.repo\" ubuntu # via curl $ curl -fL https://install-cli.jfrog.io | sh # or $ wget -qO - https://releases.jfrog.io/artifactory/jfrog-gpg-public/jfrog_public_gpg.key | sudo apt-key add - $ echo \"deb https://releases.jfrog.io/artifactory/jfrog-debs xenial contrib\" | sudo tee -a /etc/apt/sources.list $ sudo apt update $ sudo apt install -y jfrog-cli-v2-jf docker # slim $ docker run releases-docker.jfrog.io/jfrog/jfrog-cli-v2-jf jf -v # full $ docker run releases-docker.jfrog.io/jfrog/jfrog-cli-full-v2-jf jf -v npm$ npm install -g jfrog-cli-v2-jf && jf intro npm $ npm i -g jfrog-cli-go homebrew $ brew install jfrog-cli-go docker $ docker run docker.bintray.io/jfrog/jfrog-cli-go:latest jfrog completion bash $ jf completion bash --install zsh $ jf completion zsh --install Oh My Zsh plugins=(git mvn npm sdk jfrog) fish $ jf completion fish --install Environment Variables jf options VARIABLE NAME DEFAULT SUPPORTED JFROG_CLI_LOG_LEVEL INFO DEBUG, INFO, WARN, ERROR JFROG_CLI_LOG_TIMESTAMP TIME TIME, DATE_AND_TIME, OFF JFROG_CLI_HOME_DIR ~/.jfrog - JFROG_CLI_TEMP_DIR - - JFROG_CLI_PLUGINS_SERVER - - JFROG_CLI_PLUGINS_REPO jfrog-cli-plugins - JFROG_CLI_RELEASES_REPO - - JFROG_CLI_SERVER_ID - - CI false - CLI VARIABLE NAME DEFAULT JFROG_CLI_MIN_CHECKSUM_DEPLOY_SIZE_KB 10 JFROG_CLI_RELEASES_REPO - JFROG_CLI_DEPENDENCIES_DIR $JFROG_CLI_HOME_DIR/dependencies JFROG_CLI_REPORT_USAGE true JFROG_CLI_SERVER_ID - JFROG_CLI_BUILD_NAME - JFROG_CLI_BUILD_NUMBER - JFROG_CLI_BUILD_PROJECT - JFROG_CLI_BUILD_URL - JFROG_CLI_ENV_EXCLUDE *password*;*secret*;*key*;*token* JFROG_CLI_TRANSITIVE_DOWNLOAD_EXPERIMENTAL false CLI reference: CLI for JFrog Artifactory ABBREVIATION COMMANDS atc access-token-create bad build-add-dependencies bag build-add-git ba build-append bc build-clean bce build-collect-env bdi build-discard bdc build-docker-create bpr build-promote bp build-publish bs build-scan cp copy cl curl del delete delp delete-props dpr docker-promote dpl docker-pull dp docker-push donet dotnet dotnetc dotnet-config dl download glc git-lfs-clean go go - go-config gp go-publish - gradle gradlec gradle-config gau group-add-users gc group-create gdel group-delete h help mv move mvn mvn mvnc mvn-config npmci npm-ci npmc npm-config npmi npm-install npmp npm-publish nuget nuget nugetc nuget-config ndt nuget-deps-tree osb oc ptc permission-target-create ptdel permission-target-delete ptt permission-target-template ptu permission-target-update p ping pipc pip-config pipi pip-install ppl podman-pull pp podman-push rplc replication-create rpldel replication-delete rplt replication-template rc repo-create rdel repo-delete rpt repo-template ru repo-update s search sp set-props - transfer-config - transfer-config-merge - transfer-files - transfer-plugin-install - transfer-settings u upload - user-create uc users-create udel users-delete yarn yarn yarnc yarn-config configuration via ssh $ jf c add --url=ssh://artifactory.example.com:1339 \\ --ssh-key-path=/Users/marslo/.ssh/id_rsa \\ myrt $ jf c show myrt Server ID: myrt JFrog Platform URL: ssh://artifactory.example.com:1339/ Artifactory URL: ssh://artifactory.example.com:1339/ SSH key file path: /Users/marslo/.ssh/id_rsa Default: true via api key $ jfrog rt c myrt --url=https://artifactory.example.com/artifactory --apikey=*********** JFrog Distribution URL (Optional): For commands which don't use external tools or the JFrog Distribution service, JFrog CLI supports replacing the configured username and password/API key with automatically created access token that's refreshed hourly. Enable this setting? (y/n) [y]? n Is the Artifactory reverse proxy configured to accept a client certificate? (y/n) [n]? n $ jfrog rt c show Server ID: myrt Url: https://artifactory.example.com/artifactory/ API key: *************** Default: true via username/password $ jfrog rt c myrt --url=https://artifactory.example.com/artifactory --user=myaccount --password=mypassword JFrog Distribution URL (Optional): For commands which don't use external tools or the JFrog Distribution service, JFrog CLI supports replacing the configured username and password/API key with automatically created access token that's refreshed hourly. Enable this setting? (y/n) [y]? n Is the Artifactory reverse proxy configured to accept a client certificate? (y/n) [n]? n [Info] Encrypting password... in docker $ docker run -it \\ --rm \\ -v $(PWD):/root docker.bintray.io/jfrog/jfrog-cli-go \\ jfrog rt c prod \\ --url=https://artifactory.example.com/artifactory \\ --user=myaccount \\ --password=mypassword ping check configuration or remote server $ jf rt p OK # or $ jfrog rt p --server-id=myrt OK discarding old builds from artifactory clean build info and artifacts 30 days before $ jfrog rt use myrt $ jfrog rt bdi --max-days=30 --delete-artifacts=true \"my-job-build\" using cli via docker $ docker run \\ -it \\ --rm \\ -v $(PWD):/root docker.bintray.io/jfrog/jfrog-cli-go \\ jfrog rt bdi --max-days=45 --delete-artifacts 'ci - buildinfo - name' search with aql [!NOTE|label:references:] Jfrog artifactory delete folder of containing artifacts after remove them $ cat spec.json { \"files\": [{ \"aql\": { \"items.find\": { \"repo\": \"my-repo\", \"type\":\"folder\", \"depth\" : \"1\", \"created\": { \"$before\": \"15d\" } } } }] } $ jfrog rt s --spec spec.json delete with aql search$ jfrog rt del --spec spec.json Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"artifactory/aql.html":{"url":"artifactory/aql.html","title":"aql","keywords":"","body":" syntax Entities and Fields Comparison Operators relative time operators find in files by name/pattern find items (folder) some times ago by aql [!TIP|label:references:] jfrog/artifactory-scripts syntax Entities and Fields DOMAIN FIELD NAME TYPE item repo String item path String item name String item created Date item modified Date item updated Date item created_by String item modified_by String item type Enum item depth Int item original_md5 String item actual_md5 String item original_sha1 String item actual_sha1 String item sha256 String item size Long item virtual_repos String entry name String entry path String promotion created String promotion created_by String promotion status String promotion repo String promotion comment String promotion user String build url String build name String build number String build created Date build created_by String build modified Date build modified_by String build Started Date property key String property value String stat downloaded Date stat downloads Int stat downloaded_by String stat remote_downloads Int stat remote_downloaded Date stat remote_downloaded_by String stat remote_origin String stat remote_path String artifact name String artifact type String artifact sha1 String artifact md5 String module name String dependency name String dependency scope String dependency type String dependency sha1 String dependency md5 String release name String release version String release status String release created String release signature String release_artifact path String Comparison Operators OPERATOR TYPES $ne string, date, int, long $eq string, date, int, long $gt string, date, int, long $gte string, date, int, long $lt string, date, int, long $lte string, date, int, long $match string, date, int, long $nmatch string, date, int, long relative time operators [!NOTE|label:references:] aqlCleanup.groovy Advanced Cleanup Using Artifactory Query Language (AQL) AQL supports specifying time intervals for queries using relative time. In other words, the time interval for the query will always be relative to the time that the query is run, so you don't have to change or formulate the time period, in some other way, each time the query is run. For example, you may want to run a query over the last day, or for the time period up to two weeks ago. Relative time is specified using the following two operators: OPERATORS PARAPHRASE $before The query is run over complete period up to specified time. $last The query is run over period from the specified time until the query is run Time periods are specified with a number and one of the following suffixes: TIME PERIOD SUFFIXES milliseconds \"mills\", \"ms\" seconds \"seconds\", \"s\" minutes \"minutes\" days \"days\", \"d\" weeks \"weeks\", \"w\" months \"months\", \"mo\" years \"years\", \"y\" find in files by name/pattern running via curl -d $ curl -s -u ${account}:${password} \\ -X POST \"${RT_URL}/artifactory/api/search/aql\" \\ -H 'content-type: text/plain' \\ -d 'items.find ({ \"path\" : { \"\\$ne\" : \".\" }, \"\\$or\" : [{ \"\\$and\" : [{ \"repo\" : \"${repo}\", \"path\" : { \"\\$match\": \"${path}\" } , \"name\" : { \"\\$match\": \"${name}\" } }] }, { \"\\$and\" : [{ \"repo\" : \"${repo}\", \"path\" : { \"\\$match\" : \"${path}/*\" } , \"name\" : { \"\\$match\" : \"${name}\"} }] }] }).include( \"name\", \"repo\", \"path\", \"actual_md5\", \"actual_sha1\", \"size\", \"type\", \"property\" ) ' running via curl -T $ cat find.aql tems.find ({ \"path\" : { \"$ne\" : \".\" }, \"repo\" : \"rt-repo\", \"$or\" : [{ \"$and\" : [{ \"path\" : { \"$match\": \"path/to/folder\" } , \"name\" : { \"$match\": \"name.zip\" } }] }, { \"$and\" : [{ \"path\" : { \"$match\" : \"path/to/folder/*\" } , \"name\" : { \"$match\" : \"name.zip\"} }] }] }).include( \"name\", \"repo\", \"path\", \"actual_md5\", \"actual_sha1\", \"size\", \"type\", \"property\" ) $ curl -s -u \"${account}\":\"${password}\" \\ -XPOST \\ \"${RT_URL}/artifactory/api/search/aql\" \\ -T find.aql in same repo $ cat find.aql tems.find ({ \"path\" : { \"$ne\" : \".\" }, \"repo\" : \"rt-repo\", \"$or\" : [{ \"$and\" : [{ \"path\" : { \"$match\": \"path/to/folder\" } , \"name\" : { \"$match\": \"name.zip\" } }] }, { \"$and\" : [{ \"path\" : { \"$match\" : \"path/to/folder/*\" } , \"name\" : { \"$match\" : \"name.zip\"} }] }] }).include( \"name\", \"repo\", \"path\", \"actual_md5\", \"actual_sha1\", \"size\", \"type\", \"property\" ) in different repo $ cat find.aql tems.find ({ \"path\" : { \"$ne\" : \".\" }, \"$or\" : [{ \"$and\" : [{ \"repo\" : \"rt-repo-1\", \"path\" : { \"$match\": \"path/to/folder/*\" } , \"name\" : { \"$match\": \"name.txt\" } }] }, { \"$and\" : [{ \"repo\" : \"rt-repo-2\", \"path\" : { \"$match\" : \"path/to/folder/*\" } , \"name\" : { \"$match\" : \"name.txt\"} }] }] }).include( \"name\", \"repo\", \"path\", \"actual_md5\", \"actual_sha1\", \"size\", \"type\", \"property\" ) find items (folder) some times ago by aql find root folder && 4 weeks ago (by using -T, --upload-file) [!NOTE] imarslo: write a file without indent space $ cat find.aql items.find ({ \"repo\": \"my-repo\", \"type\" : \"folder\" , \"depth\" : \"1\", \"created\" : { \"$before\" : \"4w\" } }) $ curl [-s] \\ -X POST \\ -uadmin:password https://my.artifactory.com/artifactory/api/search/aql \\ -T find.aql -T, --upload-file This transfers the specified local file to the remote URL. If there is no file part in the specified URL, curl will append the local file name. NOTE that you must use a trailing / on the last directory to really prove to Curl that there is no file name or curl will think that your last directory name is the remote file name to use. That will most likely cause the upload operation to fail. If this is used on an HTTP(S) server, the PUT command will be used. Use the file name \"-\" (a single dash) to use stdin instead of a given file. Alternately, the file name \".\" (a single period) may be specified instead of \"-\" to use stdin in non-blocking mode to allow reading server output while stdin is being uploaded. You can specify one -T, --upload-file for each URL on the command line. Each -T, --upload- file + URL pair specifies what to upload and to where. curl also supports \"globbing\" of the -T, --upload-file argument, meaning that you can upload multiple files to a single URL by using the same URL globbing style supported in the URL, like this: curl --upload-file \"{file1,file2}\" http://www.example.com or even curl -T \"img[1-1000].png\" ftp://ftp.example.com/upload/ search by using -d, --data $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X POST https://my.artifactory.com/artifactory/api/search/aql \\ -H \"Content-Type: text/plain\" \\ -d \"\"\"items.find ({ \\\"repo\\\": \\\"my-repo\\\", \\\"type\\\" : \\\"folder\\\" , \\\"depth\\\" : \\\"1\\\", \\\"created\\\" : { \\\"\\$before\\\" : \\\"4mo\\\" } }) \"\"\" $ cat ~/.marslo/.netrc machine my.artifactory.com login admin password password d, --data (HTTP) Sends the specified data in a POST request to the HTTP server, in the same way that a browser does when a user has filled in an HTML form and presses the submit button. This will cause curl to pass the data to the server using the content-type application/x-www-form- urlencoded. Compare to -F, --form. --data-raw is almost the same but does not have a special interpretation of the @ character. To post data purely binary, you should instead use the --data-binary option. To URL-encode the value of a form field you may use --data-urlencode. If any of these options is used more than once on the same command line, the data pieces specified will be merged together with a separating &-symbol. Thus, using '-d name=daniel -d skill=lousy' would generate a post chunk that looks like 'name=daniel&skill=lousy'. If you start the data with the letter @, the rest should be a file name to read the data from, or - if you want curl to read the data from stdin. Multiple files can also be speci- fied. Posting data from a file named from a file like that, carriage returns and newlines will be stripped out. If you don't want the @ character to have a special interpretation use --data-raw instead. See also --data-binary and --data-urlencode and --data-raw. This option overrides -F, --form and -I, --head and -T, --upload-file. or $ curl -s \\ --netrc-file ~/.marslo/.netrc \\ -X POST https://my.artifactory.com/artifactory/api/search/aql \\ -H \"Content-Type: text/plain\" \\ -d \"\"\"items.find ({ \\ \\\"repo\\\": \\\"my-repo\\\", \\ \\\"type\\\" : \\\"folder\\\" , \\ \\\"depth\\\" : \\\"1\\\", \\ \\\"created\\\" : { \\\"\\$before\\\" : \\\"4mo\\\" } \\ }) \"\"\" \\ | jq --raw-output .results[].name? or (with sort and limit) Artifactory query language (AQL). How to write a not match query with $nmatch $ curl -X POST \\ -k \\ -H 'Content-Type:text/plain' \\ -i \\ 'https://my.artifactory.com/artifactory/api/search/aql' \\ -d 'items.find ({ \"repo\": \"proj-1-local\", \"type\" : \"folder\" , \"depth\" : \"1\", \"created\" : { \"$before\" : \"3days\" } }).sort({\"$desc\":[\"created\"]}).limit(1) ' or -d @ JFrog Artifactory REST API in 5min $ cat builds.json builds.find({ \"name\" : \"ci - build - name\", \"created\" : { \"$before\" : \"10d\" } }) $ curl -s \\ -g \\ -d @builds.json \\ -H \"Content-Type: text/plain\" \\ -X POST \"https://${rtURL}/api/search/aql\" Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:21 "},"artifactory/nginx-cert.html":{"url":"artifactory/nginx-cert.html","title":"nginx cert","keywords":"","body":" nginx installation configuration ssl cert generate cert for server check certs cert in Nginx cert in os MacOS artifactory https general SSL certs nginx installation $ sudo apt udpate $ sudo apt install nginx configuration $ sudo ufw app list Available applications: CUPS Nginx Full Nginx HTTP Nginx HTTPS OpenSSH Postfix Postfix SMTPS Postfix Submission or$ sudo ufw allow 'Nginx HTTP' ssl cert generate cert for server CA (root cert) $ openssl genrsa -aes256 \\ -out sample.artifactory.com-ca.key \\ 2048 $ openssl req -new \\ -x509 \\ -days 365 \\ -sha256 \\ -key sample.artifactory.com-ca.key \\ -out sample.artifactory.com-ca.crt \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName/OU=CDI/CN=sample.artifactory.com\" $ openssl genrsa -aes256 -out sample.artifactory.com-ca.key 2048 Generating RSA private key, 2048 bit long modulus ....................................................................+++ ...................................................+++ unable to write 'random state' e is 65537 (0x10001) Enter pass phrase for sample.artifactory.com-ca.key:artifactory Verifying - Enter pass phrase for sample.artifactory.com-ca.key:artifactory $ openssl req -new \\ -x509 \\ -sha256 \\ -days 365 \\ -key sample.artifactory.com-ca.key \\ -out sample.artifactory.com-ca.crt \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com\" Enter pass phrase for sample.artifactory.com-ca.key:artifactory cert for server $ openssl genrsa -out sample.artifactory.com-server.key 2048 $ openssl req -sha256 -new -key sample.artifactory.com-server.key -out sample.artifactory.com-server.csr -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com\" $ openssl genrsa -out sample.artifactory.com-server.key 2048 Generating RSA private key, 2048 bit long modulus ......................................................................+++ ............................................................................................................................................................................................................................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req -sha256 \\ -new \\ -key sample.artifactory.com-server.key \\ -out sample.artifactory.com-server.csr \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com\" sign the server cert with CA $ echo subjectAltName = DNS:sample.artifactory.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req -days 365 -sha256 -in sample.artifactory.com-server.csr -CA sample.artifactory.com-ca.crt -CAkey sample.artifactory.com-ca.key -CAcreateserial -out sample.artifactory.com-server.crt -extfile extfile.cnf $ echo subjectAltName = DNS:sample.artifactory.com,IP:130.147.219.19 >> extfile.cnf $ echo extendedKeyUsage = serverAuth >> extfile.cnf $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -in sample.artifactory.com-server.csr \\ -CA sample.artifactory.com-ca.crt \\ -CAkey sample.artifactory.com-ca.key \\ -CAcreateserial \\ -out sample.artifactory.com-server.crt \\ -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com Getting CA Private Key Enter pass phrase for sample.artifactory.com-ca.key:artifactory unable to write 'random state' $ ls extfile.cnf sample.artifactory.com-ca.key sample.artifactory.com-server.csr www.srl sample.artifactory.com-ca.crt sample.artifactory.com-server.crt sample.artifactory.com-server.key generate client cert and signed by CA $ openssl genrsa -out sample.artifactory.com-client.key $ openssl req -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com\" -new -key sample.artifactory.com-client.key -out sample.artifactory.com-client.csr $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -in sample.artifactory.com-client.csr \\ -CA sample.artifactory.com-ca.crt \\ -CAkey sample.artifactory.com-ca.key \\ -CAcreateserial \\ -out sample.artifactory.com-client.cert \\ -extfile extfile.cnf $ openssl genrsa -out sample.artifactory.com-client.key 2048 Generating RSA private key, 2048 bit long modulus ................................................+++ .......................+++ unable to write 'random state' e is 65537 (0x10001) $ openssl req \\ -subj \"/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com\" -new \\ -key sample.artifactory.com-client.key \\ -out sample.artifactory.com-client.csr $ echo extendedKeyUsage = clientAuth >> extfile.cnf $ cat extfile.cnf subjectAltName = DNS:sample.artifactory.com,IP:130.147.219.19 extendedKeyUsage = serverAuth extendedKeyUsage = clientAuth $ openssl x509 -req \\ -days 365 \\ -sha256 \\ -in sample.artifactory.com-client.csr \\ -CA sample.artifactory.com-ca.crt \\ -CAkey sample.artifactory.com-ca.key \\ -CAcreateserial \\ -out sample.artifactory.com-client.cert \\ -extfile extfile.cnf Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName/OU=CDI/CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com Getting CA Private Key Enter pass phrase for sample.artifactory.com-ca.key:artifactor unable to write 'random state' update the file perm $ sudo chmod -v 0444 sample.artifactory.com-ca.crt sample.artifactory.com-server.crt client.cert $ sudo chmod -v 0400 sample.artifactory.com-ca.key client.key sample.artifactory.com-server.key check certs crt $ openssl x509 -noout \\ -text \\ -in sample.artifactory.com-server.crt $ openssl x509 -noout -text -in sample.artifactory.com-ca.crt Certificate: Data: Version: 3 (0x2) Serial Number: 15145698426239402702 (0xd23054792b3142ce) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=CompanyName, OU=CDI, CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com Validity Not Before: Jan 2 11:35:31 2018 GMT Not After : Jan 2 11:35:31 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=CompanyName, OU=CDI, CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:d0:3f:b6:c5:e5:52:8d:c7:26:3f:e7:0a:7a:5f: c1:71:2a:9e:34:07:7e:10:4a:3d:c4:4f:f7:df:58: 93:0d:fa:00:e8:21:75:6d:d1:45:7d:bd:27:f2:c5: 08:13:8f:4f:be:91:9f:28:19:7e:c3:a7:42:1b:fc: b4:96:21:8a:33:59:79:27:a3:cf:13:3e:cd:92:0d: 7e:b9:9f:0d:01:bf:27:5f:e4:7a:7d:db:69:a3:78: 96:a8:c3:a9:2d:31:28:97:ba:6c:20:17:ab:eb:85: ce:2c:25:e8:3e:a0:8b:c0:0b:b2:a9:e1:ac:9f:e1: 57:35:bb:64:6a:99:2e:8f:27:f1:04:40:a7:16:32: 31:4e:ad:18:5e:9e:0b:dd:42:17:af:8a:58:c6:1a: e9:00:52:97:7b:7a:24:cc:b1:81:8d:b9:20:60:e4: 96:d5:77:82:07:4e:df:9c:3a:26:95:d5:ed:aa:a1: 24:94:64:0e:93:9a:9e:9b:d4:78:6b:46:50:69:05: 19:6a:ff:7b:1d:1b:0f:ce:6b:30:33:c7:99:9d:6a: 30:0c:fc:f8:74:00:df:65:6f:fa:1b:24:0a:73:77: 4d:94:45:27:9b:93:a6:81:37:57:57:6f:e9:ae:e4: 5e:a8:b8:be:31:0f:73:4b:9e:1b:ed:78:5c:48:ec: 0b:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: IP Address:130.147.219.19 X509v3 Subject Key Identifier: 23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Authority Key Identifier: keyid:23:32:BC:61:9E:51:8E:94:22:30:5B:AE:68:8A:7E:8E:53:D2:45:7C X509v3 Basic Constraints: CA:TRUE Signature Algorithm: sha256WithRSAEncryption 69:a3:fe:35:63:a5:e8:4e:e6:3e:4f:9d:f6:82:3d:73:f2:a7: 22:c1:46:e5:09:5e:61:81:b7:70:3c:62:ba:43:7d:bd:ac:67: d0:41:ea:a7:b8:41:47:04:bc:41:9a:46:35:31:3f:62:10:7a: 58:73:45:3a:59:3b:41:6b:2b:1e:62:42:b7:7e:c1:6b:92:25: 2a:df:3f:69:b5:26:8e:c7:5d:c6:24:a0:65:21:b7:63:74:60: 7f:3b:0e:9a:80:a4:4f:a2:79:20:19:92:64:60:b7:53:5c:09: 6e:46:6e:7a:d7:ee:ef:f4:2e:27:7a:1a:0e:da:5b:8b:7a:bf: 40:56:9f:16:63:6b:89:ab:48:65:07:45:e0:a0:21:7c:0f:6d: 9c:2a:ab:ca:d0:02:06:8a:39:7a:ea:65:b9:04:13:0f:6b:cd: ea:e5:9f:59:c5:d2:06:b2:e4:c3:cb:ab:59:69:aa:11:e6:08: 49:12:cc:d4:29:21:2b:59:c1:dc:bb:e6:a9:7d:96:68:a4:7b: 61:76:8a:21:a9:69:a5:83:d5:8b:f6:08:4e:c0:34:64:6b:65: 96:ac:ed:cd:c1:0b:54:7d:a9:57:07:77:0c:6a:43:9e:4f:c0: 6c:12:88:e8:cf:34:08:67:af:1c:2f:bb:49:54:1b:17:95:89: b3:2d:c9:5f $ openssl x509 -noout -text -in sample.artifactory.com-server.crt Certificate: Data: Version: 3 (0x2) Serial Number: 12625600037876864867 (0xaf37245755cf1763) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=CompanyName, OU=CDI, CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com Validity Not Before: Jan 2 11:39:47 2018 GMT Not After : Jan 2 11:39:47 2019 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=CompanyName, OU=CDI, CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Alternative Name: DNS:sample.artifactory.com, IP Address:130.147.219.19 X509v3 Extended Key Usage: TLS Web Server Authentication Signature Algorithm: sha256WithRSAEncryption 3d:e8:81:f2:ab:89:47:e2:2c:8c:5a:54:31:c2:2a:11:37:e6: ab:89:ff:d1:c2:8c:8e:3a:7d:d2:1d:28:3e:9e:5f:9e:89:08: 78:2e:16:32:52:e7:35:ab:66:09:a4:83:85:42:55:d6:7c:4f: 37:cf:8d:37:bd:57:d0:00:f2:9c:67:68:a2:ed:49:c6:eb:0f: b7:49:ba:ae:12:35:82:a6:a5:b6:5e:f7:68:08:f7:3f:a1:73: d2:94:3e:7a:d9:5c:e1:e2:ab:12:46:66:9d:59:3a:e1:2d:aa: a6:53:97:40:ac:a3:ca:80:6d:5b:75:dc:c4:ee:10:48:55:2c: 10:00:43:07:e6:c4:16:09:fb:04:5d:78:8e:85:21:21:75:01: a5:af:c0:c0:d1:fd:33:6e:5b:24:8b:f8:e6:1c:df:b7:f1:e5: 38:02:d4:a8:e1:09:93:2e:8d:19:ea:e2:11:3f:c1:fe:75:bb: ef:03:6e:c3:50:77:a5:54:7d:7e:e0:cd:85:20:08:41:38:b2: 86:65:aa:58:51:1b:7b:ed:6a:07:0f:cc:ab:49:d8:34:ec:5d: fd:0d:75:48:81:3c:a5:bc:ce:c0:95:8c:8e:d3:8c:0f:0d:a3: a7:73:70:bc:59:89:7c:42:25:0b:cb:2f:b0:86:4a:46:56:f2: e9:d9:63:f1 csr $ openssl req -noout -text -in sample.artifactory.com-server.csr $ openssl req -noout -text -in sample.artifactory.com-server.csr Certificate Request: Data: Version: 0 (0x0) Subject: C=CN, ST=Sichuan, L=Chengdu, O=CompanyName, OU=CDI, CN=sample.artifactory.com/emailAddress=marslo.jiao@CompanyName.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:b9:af:45:ba:6d:99:42:34:09:c5:ef:da:be:a6: c4:ff:09:9a:bf:7c:89:51:a8:c6:df:c8:ba:b3:a6: 42:24:36:d5:5d:ff:f3:ab:df:de:6e:05:8b:81:4a: ec:4c:58:16:ca:0c:56:9e:a7:0e:2d:ba:93:68:e1: 0d:f9:f6:82:ce:98:9b:65:53:8f:ba:27:c9:0c:f8: f1:4c:14:11:67:ef:97:5c:bb:15:16:ae:c4:eb:16: e2:22:29:7a:36:fd:aa:19:f3:ad:93:9a:a3:5c:0c: 92:77:d3:cc:75:b1:29:b4:8d:cd:74:57:18:5c:d2: c2:00:7a:d4:b2:54:81:0a:44:e7:b8:ef:44:36:86: 4f:04:ab:21:0c:fe:79:9c:93:31:f5:44:46:9d:d8: 36:79:4b:c0:dd:5b:8e:6f:dc:0c:8a:0a:a4:d7:4d: 5a:5c:b0:c0:af:4d:38:45:30:79:3f:a1:69:8a:5b: 19:49:25:bd:5f:19:d8:4f:e0:03:9a:43:fb:ad:6d: 2b:cc:7c:eb:c5:7c:64:fc:9b:bf:83:91:50:ac:21: a1:b6:3f:70:23:cb:d6:af:eb:48:71:cf:f4:da:41: 4e:97:84:64:0c:b4:4d:5f:cb:30:f5:47:a6:35:3d: 02:99:6f:3f:e9:e9:56:42:a0:58:54:21:04:87:f9: 7a:a5 Exponent: 65537 (0x10001) Attributes: a0:00 Signature Algorithm: sha256WithRSAEncryption 74:99:e5:36:44:b4:48:a9:50:83:eb:61:02:37:6c:8a:46:45: 0e:58:04:40:66:55:56:fc:fd:cf:15:a0:31:be:de:3a:16:4f: 9a:46:1d:17:33:7f:38:dd:36:a9:76:e5:92:b2:48:29:60:e7: af:c0:f6:76:0d:9a:a6:40:43:a8:98:75:90:c3:c1:2a:7d:51: 1d:df:1b:50:8b:69:ce:7c:74:cf:03:9d:69:6b:41:7f:ed:bc: f1:6c:c0:93:22:36:5e:f7:8c:d0:f7:f5:0f:dc:51:93:1e:23: cc:12:cd:f3:0e:6c:1b:4e:b2:df:01:86:5b:d0:79:c8:6e:c8: 57:72:a8:dd:81:8a:af:c3:52:e2:ff:e8:f1:3d:6f:cb:e4:a9: 1c:51:58:b9:31:00:c0:88:5e:ca:63:59:f8:d7:82:d4:22:30: 0c:d8:bd:e6:01:11:d2:4a:68:64:d1:8e:d5:a1:19:0c:5a:99: 25:cd:c2:e5:ed:f3:48:e3:c0:7a:00:a3:a8:09:8e:d3:50:2a: 84:29:63:66:50:3e:42:af:43:ea:fa:5b:28:f9:f1:84:89:88: 2e:7f:8d:bf:44:29:83:fa:89:b3:b8:3c:13:98:20:76:6c:d3: 67:ce:03:9e:15:ea:3e:9d:4b:cb:c2:78:ab:57:1d:b7:e8:9e: 81:1b:b5:1f cert in Nginx $ grep ssl_certificate /etc/nginx/sites-enabled/artifactoryv2.conf ssl_certificate /etc/nginx/certs/sample.artifactory.com/sample.artifactory.com-server.crt; ssl_certificate_key /etc/nginx/certs/sample.artifactory.com/sample.artifactory.com-server.key; cert in os MacOS add $ sudo security add-trusted-cert -d \\ -r trustRoot \\ -k \"/Library/Keychains/System.keychain\" \\ \"/Users/marslo/Downloads/sample.artifactory.com-ca.crt\" search $ security find-certificate -a -c -Z $ security find-certificate -a -c artifactor -Z | grep SHA-1 SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E $ security list-keychain \"/Users/marslo/Library/Keychains/login.keychain-db\" \"/Library/Keychains/System.keychain\" $ security find-certificate -a -c artifactor -Z SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E keychain: \"/Library/Keychains/System.keychain\" version: 256 class: 0x80001000 attributes: \"alis\"=\"marslo.jiao@CompanyName.com\" \"cenc\"=0x00000003 \"ctyp\"=0x00000001 \"hpky\"=0x2332.. \"##2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"issu\"=0x3081.. \"0\\201\\2431..CN1\\0200..Sichuan1\\0200..Chengdu1\\0200..mycompany1\\0140..CDI1(0&\\006..sample.artifactory.com1&0$\\006..*\\206H\\..marslo.jiao@CompanyName.com\" \"labl\"=\"sample.artifactory.com\" \"skid\"=0x2332.. \"##2\\274a\\236Q\\216\\224\"0[\\256h\\212~\\216S\\322E|\" \"snbr\"=0x00D23054792B3142CE \"\\000\\3220Ty+1B\\316\" \"subj\"=0x3081.. \"0\\201\\2431..CN1\\0200..Sichuan1\\0200..Chengdu1\\0200..mycompany1\\0140..CDI1(0&\\006..sample.artifactory.com1&0$\\006..*\\206H\\..marslo.jiao@CompanyName.com\" $ security find-certificate -a -c artifactor -Z -p -m SHA-1 hash: 915D019F0993F369C09D75C6B8DA201B8DE2636E email addresses: marslo.jiao@CompanyName.com -----BEGIN CERTIFICATE----- MIIELDCCAxSgAwIBAgIJANIwVHkrMULOMA0GCSqGSIb3DQEBCwUAMIGjMQswCQYD VQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdkdTEQMA4G A1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cuYXJ0aWZh Y3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJzbG8uamlh b0BwaGlsaXBzLmNvbTAeFw0xODAxMDIxMTM1MzFaFw0xOTAxMDIxMTM1MzFaMIGj MQswCQYDVQQGEwJDTjEQMA4GA1UECAwHU2ljaHVhbjEQMA4GA1UEBwwHQ2hlbmdk dTEQMA4GA1UECgwHUGhpbGlwczEMMAoGA1UECwwDQ0RJMSgwJgYDVQQDDB9wd3cu YXJ0aWZhY3RvcnkuY2RpLnBoaWxpcHMuY29tMSYwJAYJKoZIhvcNAQkBFhdtYXJz bG8uamlhb0BwaGlsaXBzLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC ggEBANA/tsXlUo3HJj/nCnpfwXEqnjQHfhBKPcRP999Ykw36AOghdW3RRX29J/LF CBOPT76RnygZfsOnQhv8tJYhijNZeSejzxM+zZINfrmfDQG/J1/ken3baaN4lqjD qS0xKJe6bCAXq+uFziwl6D6gi8ALsqnhrJ/hVzW7ZGqZLo8n8QRApxYyMU6tGF6e C91CF6+KWMYa6QBSl3t6JMyxgY25IGDkltV3ggdO35w6JpXV7aqhJJRkDpOanpvU eGtGUGkFGWr/ex0bD85rMDPHmZ1qMAz8+HQA32Vv+hskCnN3TZRFJ5uTpoE3V1dv 6a7kXqi4vjEPc0ueG+14XEjsC6UCAwEAAaNhMF8wDwYDVR0RBAgwBocEgpPbEzAd BgNVHQ4EFgQUIzK8YZ5RjpQiMFuuaIp+jlPSRXwwHwYDVR0jBBgwFoAUIzK8YZ5R jpQiMFuuaIp+jlPSRXwwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEA aaP+NWOl6E7mPk+d9oI9c/KnIsFG5QleYYG3cDxiukN9vaxn0EHqp7hBRwS8QZpG NTE/YhB6WHNFOlk7QWsrHmJCt37Ba5IlKt8/abUmjsddxiSgZSG3Y3RgfzsOmoCk T6J5IBmSZGC3U1wJbkZuetfu7/QuJ3oaDtpbi3q/QFafFmNriatIZQdF4KAhfA9t nCqrytACBoo5eupluQQTD2vN6uWfWcXSBrLkw8urWWmqEeYISRLM1CkhK1nB3Lvm qX2WaKR7YXaKIalppYPVi/YITsA0ZGtllqztzcELVH2pVwd3DGpDnk/AbBKI6M80 CGevHC+7SVQbF5WJsy3JXw== -----END CERTIFICATE----- remove $ sudo security delete-certificate -Z 915D019F0993F369C09D75C6B8DA201B8DE2636E Others 1st$ cd /etc/nginx/ $ sudo openssl genrsa -des3 -out server.key 1024 $ sudo openssl req -new -key server.key -out server.csr $ sudo cp server.key{,.org} $ sudo cp server.csr{,.org} $ sudo openssl rsa -in server.key.org -out server.key $ sudo openssl x509 -req \\ -days 365 \\ -in server.csr \\ -signkey server.key \\ -out server.crt $ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled $ sudo openssl genrsa -des3 -out server.key 1024 Generating RSA private key, 1024 bit long modulus .................................................................++++++ ......++++++ e is 65537 (0x10001) Enter pass phrase for server.key: artifactory Verifying - Enter pass phrase for server.key: artifactory $ sudo openssl req -new \\ -key server.key \\ -out server.csr Enter pass phrase for server.key: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:CompanyName Organizational Unit Name (eg, section) []:CompanyName Common Name (e.g. server FQDN or YOUR name) []:docker-2.artifactory Email Address []:marslo.jiao@CompanyName.com Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:artifactory An optional company name []:CompanyName $ ls -Altrh total 80K -rw-r--r-- 1 root root 3.0K May 3 2017 win-utf -rw-r--r-- 1 root root 664 May 3 2017 uwsgi_params -rw-r--r-- 1 root root 636 May 3 2017 scgi_params -rw-r--r-- 1 root root 180 May 3 2017 proxy_params -rw-r--r-- 1 root root 1.5K May 3 2017 nginx.conf -rw-r--r-- 1 root root 3.9K May 3 2017 mime.types -rw-r--r-- 1 root root 2.2K May 3 2017 koi-win -rw-r--r-- 1 root root 2.8K May 3 2017 koi-utf -rw-r--r-- 1 root root 1007 May 3 2017 fastcgi_params -rw-r--r-- 1 root root 1.1K May 3 2017 fastcgi.conf drwxr-xr-x 2 root root 4.0K Jul 27 04:11 modules-available drwxr-xr-x 2 root root 4.0K Jul 27 04:11 conf.d drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-available drwxr-xr-x 2 root root 4.0K Dec 26 18:08 snippets drwxr-xr-x 2 root root 4.0K Dec 26 18:08 sites-enabled drwxr-xr-x 2 root root 4.0K Dec 26 18:08 modules-enabled -rw-r--r-- 1 root root 951 Dec 26 18:32 server.key -rw-r--r-- 1 root root 785 Dec 26 18:36 server.csr -rw-r--r-- 1 root root 951 Dec 26 18:38 server.key.org -rw-r--r-- 1 root root 785 Dec 26 18:38 server.csr.org $ sudo openssl rsa -in server.key.org -out server.key Enter pass phrase for server.key.org: writing RSA key $ sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName/OU=CompanyName/CN=docker-2.artifactory/emailAddress=marslo.jiao@CompanyName.com Getting Private key 2nd: /etc/nginx$ sudo openssl req \\ -newkey rsa:2048 \\ -nodes \\ -sha256 \\ -keyout certs/sample.artifactory.com.key \\ -x509 \\ -days 365 \\ -out certs/sample.artifactory.com.crt Generating a 2048 bit RSA private key ........+++ ..............................................................+++ writing new private key to 'certs/sample.artifactory.com.key' ***** You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:CompanyName Organizational Unit Name (eg, section) []:CompanyName Common Name (e.g. server FQDN or YOUR name) []:sample.artifactory.com Email Address []:marslo.jiao@CompanyName.com artifactory https general SSL certs $ sudo openssl genrsa -des3 -out artifactorykey 2048 $ sudo openssl req -new -key artifactorykey -out artifactorycsr $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey $ sudo openssl x509 -req -days 365 -in artifactorycsr -signkey artifactorykey -out artifactorycrt $ sudo openssl genrsa -des3 -out artifactorykey 2048 Generating RSA private key, 2048 bit long modulus .........................+++ ........................................................................+++ e is 65537 (0x10001) Enter pass phrase for artifactorykey: artifactory Verifying - Enter pass phrase for artifactorykey: artifactory $ sudo openssl req -new \\ -key artifactorykey \\ -out artifactorycsr Enter pass phrase for artifactorykey: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:CompanyName Ltd Organizational Unit Name (eg, section) []:. Common Name (e.g. server FQDN or YOUR name) []:192.168.1.102 Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactorykey{,.org} $ sudo openssl rsa \\ -in artifactorykey.org \\ -out artifactorykey Enter pass phrase for artifactorykey.org: artifactory writing RSA key $ sudo openssl x509 -req \\ -days 365 \\ -in artifactorycsr \\ -signkey artifactorykey \\ -out artifactorycrt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName Ltd/CN=192.168.1.102 Getting Private key $ openssl x509 -text -noout -in ssl_ip/artifactorycrt Certificate: Data: Version: 1 (0x0) Serial Number: 9804858425156156035 (0x8811daca106dba83) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=CompanyName Ltd, CN=192.168.1.102 Validity Not Before: Dec 26 16:23:15 2017 GMT Not After : Dec 26 16:23:15 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=CompanyName Ltd, CN=192.168.1.102 Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:ad:32:26:35:8a:8f:09:82:ff:59:61:14:14:1b: 9c:da:02:74:09:48:2a:d5:05:1d:ad:8a:d0:e0:70: 1f:9b:44:b4:df:4d:c5:4c:5a:1b:8a:52:7b:2a:69: a2:77:d3:cf:c7:fb:a6:ef:34:d1:bb:23:8d:d0:78: e6:48:3f:8c:12:3c:69:d5:62:2d:74:24:b8:49:a8: 59:c7:36:5f:64:97:5a:d1:8f:9a:5b:2f:aa:a8:65: 6c:75:28:60:55:b9:2a:5b:41:71:a4:fa:eb:10:7e: 84:4b:fb:c3:57:9c:55:8e:e8:2a:4a:c1:45:74:54: 58:d5:09:0d:59:d4:14:94:db:5b:67:91:9c:23:24: c4:07:10:d1:f1:28:fa:97:38:01:da:81:c4:f3:63: d7:84:24:dc:3c:ff:04:64:b2:3e:41:f0:d8:08:66: 06:cc:7c:05:3c:90:97:0b:02:b6:b5:2f:03:28:b7: 4c:38:aa:84:23:3e:9e:d4:b0:3a:58:4c:f3:74:df: 36:63:f2:18:ac:d1:0d:ef:05:6b:f3:dc:b6:d3:c7: f0:91:7b:b8:69:4f:ae:19:da:34:b7:38:1e:e2:9a: 10:2e:a9:a0:54:f6:61:b9:da:e6:98:c8:9b:76:83: d6:59:77:d9:18:c6:57:8c:cf:af:a4:89:5a:87:99: c4:15 Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption 5a:06:ad:9b:d0:07:d7:9b:92:2a:77:71:ff:80:6e:c1:39:bd: 81:e8:0f:21:39:bd:80:3e:96:a9:6b:7a:73:f1:80:70:4e:b1: d4:b7:1e:54:be:62:dc:35:c0:b9:d8:8c:d1:24:75:8a:42:ec: a9:dd:9b:9a:f2:4b:ad:6e:38:d7:a2:fa:7a:70:be:7b:8c:37: 63:71:10:fe:73:18:de:e5:9c:c5:6e:1a:4e:cb:7b:51:26:56: 68:56:fb:4f:71:d7:7b:94:b6:55:b9:f8:9b:31:a8:26:a5:e5: 32:36:33:65:7b:1d:9f:27:7d:f1:b0:d2:06:7c:75:d7:39:bb: 7a:44:92:e1:b8:fc:2b:fd:3c:43:93:d6:47:19:f6:ad:d3:cc: 82:dd:15:bd:d3:a0:e2:2d:92:fd:65:44:60:44:21:b9:1f:31: fd:91:c2:78:86:d9:aa:77:fd:54:ae:2f:4c:ae:5d:5e:c7:a3: 43:0d:6b:32:23:d9:61:b6:a7:c4:47:eb:bc:c2:79:6c:06:f0: a6:af:e8:45:c6:02:d5:1c:09:26:8a:a7:b0:ff:74:50:85:82: 1d:88:b2:2c:eb:20:3e:bf:3b:4e:9b:ab:b7:4f:e8:14:a8:1a: 33:50:e9:a8:24:3e:5e:2a:68:ea:fa:f3:12:30:94:8e:0f:0d: da:6c:17:60 $ sudo openssl genrsa -des3 -out artifactorykey 2048 Generating RSA private key, 2048 bit long modulus ........................+++ .......................................+++ e is 65537 (0x10001) Enter pass phrase for artifactorykey: artifactory Verifying - Enter pass phrase for artifactorykey: artifactory $ sudo openssl req -new -key artifactorykey -out artifactorycsr Enter pass phrase for artifactorykey: artifactory You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ***** Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Sichuan Locality Name (eg, city) []:Chengdu Organization Name (eg, company) [Internet Widgits Pty Ltd]:CompanyName Ltd Organizational Unit Name (eg, section) []:CompanyName CDI Common Name (e.g. server FQDN or YOUR name) []:docker-1.artifactory Email Address []:. Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:. An optional company name []:. $ sudo cp artifactorykey{,.org} $ sudo openssl rsa -in artifactorykey.org -out artifactorykey Enter pass phrase for artifactorykey.org: artifactory writing RSA key $ sudo openssl x509 -req \\ -days 365 \\ -in artifactorycsr \\ -signkey artifactorykey \\ -out artifactorycrt Signature ok subject=/C=CN/ST=Sichuan/L=Chengdu/O=CompanyName Ltd/OU=CompanyName CDI/CN=docker-1.artifactory Getting Private key $ openssl x509 -text \\ -noout \\ -in ssl/artifactorycrt Certificate: Data: Version: 1 (0x0) Serial Number: 15006671364169185053 (0xd0426818d254b71d) Signature Algorithm: sha256WithRSAEncryption Issuer: C=CN, ST=Sichuan, L=Chengdu, O=CompanyName Ltd, OU=CompanyName CDI, CN=docker-1.artifactory Validity Not Before: Dec 26 16:02:10 2017 GMT Not After : Dec 26 16:02:10 2018 GMT Subject: C=CN, ST=Sichuan, L=Chengdu, O=CompanyName Ltd, OU=CompanyName CDI, CN=docker-1.artifactory Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (2048 bit) Modulus: 00:dc:30:6b:83:56:92:fb:f3:fb:bc:da:3e:a9:5c: 67:c3:19:42:9a:8f:8f:30:e6:27:fa:a9:9d:c9:3e: 9c:31:3d:aa:d8:9f:ae:9b:64:b0:75:2a:01:51:ad: 04:c4:00:5d:f4:f8:b4:af:bb:20:f3:77:45:65:28: d8:38:28:b2:03:46:d0:67:d1:91:8e:7b:65:66:a0: 7e:a5:e2:fe:80:00:5e:54:95:50:52:9c:44:2a:aa: dc:a2:80:be:16:07:79:b4:13:1d:f5:8a:ca:c3:ab: 1c:76:de:f3:b8:23:9b:54:17:28:be:ac:e5:68:5c: f3:83:49:61:55:d2:e1:ea:0c:e7:72:75:6e:90:5a: 90:a8:85:01:c6:cc:69:94:5b:c4:f9:14:6d:70:0a: 8e:45:e0:b9:28:aa:99:3a:22:12:db:0b:d7:d9:6e: aa:35:36:5e:e6:00:eb:99:ab:46:6d:7b:e5:12:b1: f9:0c:5c:d3:c0:47:7b:b3:e4:03:15:fa:8d:42:f8: a1:c1:ce:dc:42:d2:81:88:18:0d:26:28:7e:90:cf: e8:05:84:75:94:e9:ac:20:47:95:c7:50:1c:d8:42: c3:d7:8b:90:f9:a9:48:cc:a5:8d:88:3b:54:a9:ef: 20:ce:ee:4c:6d:04:65:eb:6c:f7:22:9d:c8:13:33: b1:6d Exponent: 65537 (0x10001) Signature Algorithm: sha256WithRSAEncryption c3:c7:c8:0d:19:d1:0b:05:ac:11:e3:e4:af:25:0e:95:f5:f5: 31:ed:90:4e:7f:1a:2b:a2:2f:4d:a3:d9:57:40:a2:f6:af:55: 90:53:bf:72:39:81:5d:53:41:85:e0:1d:26:9f:9e:33:05:46: 9c:fc:51:99:19:5c:7d:ef:aa:cc:50:61:0b:f4:11:69:bd:9e: 2a:34:48:e9:9d:7c:d0:e0:80:a5:42:67:ac:8e:0c:d6:84:19: 8e:cb:05:97:9f:21:c5:e0:78:8f:97:f6:53:fa:f2:ec:49:3f: fb:11:68:ed:ea:c0:8c:c5:be:08:61:e4:bd:4e:05:5f:89:99: f6:47:6f:b3:1e:5f:49:62:ff:37:dc:f0:c4:4b:bb:a4:15:06: b1:80:4d:24:ef:bb:25:d6:a5:60:13:34:57:73:ba:b4:b0:8b: 42:0f:18:ef:0e:17:60:83:4d:61:bd:ef:55:b9:52:6a:47:ab: c3:ee:b3:11:27:86:aa:87:18:d5:60:b8:b4:34:c2:fa:75:48: 0e:f1:f4:30:b3:fa:b3:ad:a9:8a:6e:e6:62:71:02:5a:72:bd: 5c:45:a0:23:ea:1d:84:16:24:3d:88:a0:12:20:61:7a:f8:bd: dc:0f:fb:26:c0:f3:2f:1f:66:7e:64:35:b6:45:05:c4:00:43: 2d:18:da:a1 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:40:47 "},"devops/klocwork/klocwork.html":{"url":"devops/klocwork/klocwork.html","title":"klocwork","keywords":"","body":" environment analysis initial a klocwork analysis full build analysis incremental build analysis load result from both windows and linux using kwwrap plus kwinject to generate a build specification when editing the makefile is not an option authentication get ltoken import your projects and server settings report creating a report CI Jenkinsfile ssl renew LDAP cert using a secure klocwork server connection reference: * Klocwork Documentation Klocwork Build integration for C Cplus plus projects EN Command Reference Troubleshooting an incomplete kwinject build specification Providing a build specification template for your developers Compiler options for kwbuildproject Klocwork Jenkins CI plugin Synchronizing status changes and comments across projects Continuous integration and Klocwork analysis examples Klocwork - Knowledgebase Running the C and C++ integration build analysis Running your first integration build analysis Running your next integration build analysis Creating a C/C++ build specification C/C++ integration build analysis - Cheat sheet example about integrate with Jenkins 最佳实践：Klocwork增量/VerifyCI检查 Running a distributed Klocwork C/C++ analysis Security Best Practices + Klocwork Integrating Static Code Analysis and Defect Tracking.pdf klocwork 2020 Setting up Klocwork with Containers (Linux) Limitations checkers C and C++ checker reference UNUSED.FUNC.GEN UNUSED.FUNC.WARN CERT community C and C++ checker reference How can I know which parts in the code are never used? -Wunused -Wunreachable-code How do I locate Uncalled Functions? Cppcheck$ cppcheck --enable=unusedFunction . Checking foo.c... 1/2 files checked 0% done Checking main.c... 2/2 files checked 0% done [foo.c:1]: (style) The function 'foo' is never used. Dead code detection in legacy C/C++ project environment reference: Install and Configure Klocwork cmd client User manual | Installation and Upgrade Klocwork Desktop for C/C++ project setup overview video: Build integration for C/C++ projects video: Klocwork Demo Useful resources Creating the Python script bwinhwang/PyKW analysis issue severity 1 - Critical 2 - Error 3 - Warning 4 - Review 5 - Severity 5 6 - Severity 6 7 - Severity 7 8 - Severity 8 9 - Severity 9 10 - Severity 10 initial a klocwork analysis sample code capture build settings $ kwinject --output \"\" i.e.:$ kwinject --output \"~/npp/npp.out\" devenv \"~/npp/PowerEditor/visual.net/notepadPlus.sln\" /Rebuild run an analysis using the build spec $ kwbuildproject --url \"/\" \\ --tables-directory \"\" \\ \"\" i.e.:$ kwbuildproject --url \"http://klocwork.domain.com/NotepadPlusPlus\" --tables-directory \"~/npp/npp_tables\" \"~/npp/npp.out\" load the database $ kwadmin --url \"\" \\ load \"\" \\ \"\" i.e.: $ kwadmin --url \"http://klocwork.domain.com\" load \"NotepadPlusPlus\" \"~/npp/npp_tables\" debug for authentication issue $ kwadmin --debug --url list-projects logout via$ kwauth --log-out full build analysis sample code re-create the build spec $ kwinject --output \"~/kw.out\" i.e.$ kwinject --output \"~/npp/npp.out\" devenv \"~/npp/PowerEditor/visual.net/notepadPlus.sln\" /Rebuild force a full analysis $ kwbuildproject --url \"/\" \\ --tables-directory \"\" \\ --force \"\" i.e.:$ kwbuildproject --url \"http://klocwork.domain.com/NotepadPlusPlus\" --tables-directory \"~/npp/npp_tables\" --force \"~/npp/npp.out\" load the result $ kwadmin --url \"\" \\ load \"\" \\ \"\" i.e.:$ kwadmin --url http://klocwork.domain.com/ load NotepadPlusPlus \"~/npp/npp_tables\" incremental build analysis sample code update the build settings $ kwinject --update \"\" i.e.:$ kwinject --update \"~/npp/npp.out\" devenv \"~/npp/PowerEditor/visual.net/notepadPlus.sln\" /Build execute the incremental analysis $ kwbuildproject --url \"/\" \\ --tables-directory \"\" \\ --incremental \"\" i.e.:$ kwbuildproject --url \"http://klocwork.domain.com/NotepadPlusPlus\" --tables-directory \"~/npp/npp_tables\" --incremental \"~/npp/npp_tables\" load the result $ kwadmin --url \"\" \\ load \"\" \\ \"\" i.e.:$ kwadmin --url \"http://klocwork.domain.com\" load NotepadPlusPlus \"~/npp/npp_tables\" load result from both windows and linux sample code kwbuildproject create an integration project on kw server via command line $ kwadmin --url \"\" \\ create-project \"\" i.e.:$ kwadmin --url http://klocwork.domain.com create-project NotepadPlusPlus capture build settings on linux machine $ kwinject --output \"\" i.e.:$ kwinject --output \"~/npp/npp.out\" make run an analysis using the build spec on linux $ kwbuildproject --url \"/\" \\ [--project \"\"] --tables-directory \"\" \\ \"\" i.e.:$ kwbuildproject --url \"http://klocwork.domain.com/NotepadPlusPlus\" \\ --tables-directory \"~/npp/npp_tables\" \\ \"~/npp/npp.out\" load multiple specification$ kwbuildproject --tables-directory \\ [--url http://:/] \\ [] \\ [...] load the database on windows $ kwadmin --url \"\" \\ load \"\" \\ \"\" i.e.:$ kwadmin --url \"http://klocwork.domain.com/NotepadPlusPlus\" \\ load NotepadPlusPlus \\ \"~/npp/npp_tables\" using kwwrap plus kwinject to generate a build specification reference: Using a build trace to troubleshoot build specification problems Can I concatenate the results of more than one kwinject.out file? Running a distributed analysis Note: For distributed builds, you must run the following procedure on all build machines and merge the resultant build trace files. inserting the kwwrap command line before your compiler and linker names CC = gcc convert to CC = kwwrap -o gcc // or CC = kwwrap -o $(command -v gcc) or via creating wrapper scripts execute the original build command Convert the build trace into a build specification with kwinject$ kwinject --trace-in \\ --output i.e.:$ kwinject --trace-in C:/temp/kwwrap.trace \\ --output C:/Klocwork/temp/kwinject.out when editing the makefile is not an option i.e.: is /temp/kwwrap.trace using environment variables create environment variables $ LDSHARED=\"kwwrap -o /temp/kwwrap.trace $(command -v gcc)\" $ CC=\"kwwrap -o /temp/kwwrap.trace $(command -v gcc)\" $ C++=\"kwwrap -o /temp/kwwrap.trace $(command -v g++)\" $ CMAKE=\"kwwrap -o /temp/kwwrap.trace $(command -v cmake)\" $ AR=\"kwwrap -o /temp/kwwrap.trace $(command -v ar) rc\" $ export CC C++ CMAKE AR LDSHARED build with original command $ cmake use kwwrap with CMake and generate the trace $ kwinject --trace-in /temp/kwwrap.trace --output kwinject.out using wrapper scripts creating wrapper scripts $ echo \"kwwrap -r -o $(command -v gcc)\" > $HOME/.hook/gcc $ echo \"kwwrap -r -o $(command -v g++)\" > $HOME/.hook/g++ $ echo \"kwwrap -r -o $(command -v cmake)\" > $HOME/.hook/cmake $ chmod +x $HOME/.hook/* setup environment variables $ export KWWRAP_HOOKS_DIR=\"$HOME/.hook\" $ export PATH=${KWWRAP_HOOKS_DIR}:${PATH} build with original command $ cmake # the original command use kwwrap with CMake and generate the trace $ kwinject --trace-in /temp/kwwrap.trace --output kwinject.out authentication [!TIP] references: Authentication using the ltoken Failing authentication if host name is not found You can enable kwauth to fail authentication in the case where the server host name was not found in the certificate CN or Subject Alternative Name by setting the verifyCertificate option to true. Enabling this results in the following error message if the host name cannot be found: Unable to authenticate using SSL with To set this value to true, create a 'client_config.xml' file in your {client_tools_install_folder}\\config\\ folder (if it does not already exist). The file must contain the following: Note that setting resolveHost=\"false\" is not mandatory, but doing so can prevent the Klocwork Server from resolving the wrong FQDN as the Server will use whatever host you specify in a remote server URL. ltoken is used to authenticate users with tools such as kwbuildproject: Windows:C:\\Users\\.klocwork\\ltoken Unix:~/.klocwork/ltoken Mac:~/.klocwork/ltoken If there is no ltoken file in your .klocwork directory, run kwauth to generate the file. get ltoken $ export KLOCWORK_LTOKEN=/home/marslo/.klocwork/ltoken $ kwauth --url https://klocwork.domain.com:443 Login: marslo Password: **** $ cat /home/marslo/.klocwork/ltoen klocwork.domain.com;443;marslo;abcdefg1234567************************************************** import your projects and server settings [!NOTE|label:references:] Import your projects and server settings Import your projects and server settings Import your existing projects into a new projects root Using the search API kwadmin import-config Kwxsync api # import project $ curl --data \"action=import_project&user=myself&project=my_project&sourceURL=http://oldserver:8080&sourceAdmin=user&sourcePassword=pwd\" http://local.klocwork.com:8080/review/api # import server configuration $ curl --data \"action=import_server_configuration&user=myself&sourceURL=http://oldserver:8080&sourceAdmin=user&sourcePassword=pwd\" http://local.klocwork.com:8080/review/api cli # import $ kwadmin import-config # i.e.: $ kwadmin import-config workspace C:\\Klocwork\\OurMetrics.mconf # export $ kwadmin export-config [options] # i.e.: $ kwadmin export-config Toolbus ExportedOurMetrics.mconf C:\\Klocwork\\OurMetrics.mconf # kwxsync import single project $ kwxsync [] | | [...] # i.e.: $ kwxsync --url https://klocwork.domain.com:443 -f -c project project-backup report creating a report CI reference: Klocwork Jenkins CI plugin Continuous integration and Klocwork analysis Ebook: klocwork ci/cd best practice.pdf Video: Add Static Code Analysis to Your CI/CD Pipelines Jenkinsfile pipeline { agent any environment { KLOCWORK_URL = \"http://localhost:8080\" KLOCWORK_PROJECT = \"zlib-pipeline\" KLOCWORK_LICENSE_HOST = \"flexlm-server\" KLOCWORK_LICENSE_PORT = \"27000\" KLOCWORK_LTOKEN = \"\" } stages { stage('Get src from git') { steps { git 'https://github.com/madler/zlib.git' } } // stage : clone code stage('Klocwork Build') { steps { klocworkBuildSpecGeneration([ additionalOpts: '', buildCommand: 'c:\\\\dev\\\\zlib-git.bat', ignoreErrors: true, output: 'kwinject.out', tool: 'kwinject' ]) } } // stage : klocwork build stage('Klocwork Analysis') { steps { klocworkIntegrationStep1([ additionalOpts: '', buildSpec: 'kwinject.out', disableKwdeploy: true, duplicateFrom: '', enabledCreateProject: true, ignoreCompileErrors: true, importConfig: '', incrementalAnalysis: false, tablesDir: 'kwtables' ]) } } // stage : klocwork analysis stage('Klocwork Db-load') { steps { klocworkIntegrationStep2 reportConfig: [ displayChart: true, query: 'status:Analyze' ], serverConfig: [ additionalOpts: '', buildName: '', tablesDir: 'kwtables' ] } } // stage : klocwork db-load stage('Build Failure Conditions') { steps { klocworkFailureCondition([ enableCiFailureCondition: true, failureConditionCiConfigs: [[ withDiffList: true, diffFileList: 'my_list.txt', enableHTMLReporting: true, name: 'one', reportFile: '', threshold: '1',]] ]) } } // stage : build failure conditions } // stages } // pipeline full static code analysisstage(\"full static code analysis\") { steps{ echo \"performance integration analysis\" klocworkIntegrationStep1([ buildSpec: \"${KLOCWORK_BUILDSPEC}\", tableDir: \"${KLONWORK_TABLES}\", incrementalAnalysis : true, ignoreCompileErrors: false, importConfig : \"\", additionalOpts: \"--replace-path ${WORKSPACE}=workspace\", disableKwdeploy: true ]) } } ssl renew LDAP cert [!NOTE|label:references:] keytool and java : /opt/Klocwork/Server/_jvm/bin Security Best Practices + Klocwork Simple bind failed error when trying to connect to Active Directory Klocwork 部署的安全最佳实践 [SOLVED]-LDAPS : SIMPLE BIND FAILED-JAVA- -djdk.tls.client.protocols=tlsv1 + -djdk.tls.client.protocols=tlsv1,tlsv1.1,tlsv1.2,tlsv1.3 2020.4.1 Error occurred during SSL handshake Using a secure Klocwork Server connection Troubleshooting Setting up LDAP access control $ keytool -import -alias ldaproot -file rootca.cer -keystore cacerts $ keytool -import -alias ldapInter -file inter.cer -keystore cacerts $ keytool -import -alias ldap -file ldap.cer -keystore cacerts using a secure klocwork server connection [!TIP] for klocwork 2020.4 Build 20.4.0.81 Create a self-signed keystore file # from , run the following command: # The keystore is saved into the Tomcat config directory at /tomcat/conf. $ _jvm/bin/keytool -genkeypair -alias tomcat \\ -keyalg RSA \\ -keystore /tomcat/conf/.keystore \\ -dname \"cn=, ou=,o=\" \\ -keypass changeit \\ -storepass changeit # i.e.: $ _jvm/bin/keytool -genkeypair -alias tomcat \\ -keyalg RSA \\ -keystore /tomcat/conf/.keystore \\ -dname \"cn=testserver.klocwork.com, ou=Development, o=Klocwork\" \\ -keypass changeit \\ -storepass changeit Configure the Klocwork Server to use SSL (manually) $ grep klocwork.protocol /config/admin.conf - klocwork.protocol=http + klocwork.protocol=https $ grep Connector /tomcat/conf/server.template - + restart klocwork service [!TIP|label:see also:] iMarslo: start/restart service $ kwservice --projects-root stop $ kwservice --projects-root start # or $ kwservice --projects-root restart klocwork verify $ kwadmin --ssl --host klocwork.example.com -port 443 list-projects # same as $ kwadmin --url https://klocwork.example.com:443 list-projects disabling the ssl connection [!NOTE] Simple bind failed error when trying to connect to Active Directorysimple bind failed: ad.hostname.com:636 import the ldap server public certificate directly into the klocwork keystore # location \\_jvm\\lib\\security\\cacerts ask your LDAP administrator to set this extension of your LDAP server certificate to non-critical [!NOTE|label:references:] Third Party Application Fails Using LDAP over SSL Troubleshoot LDAP over SSL connection problems Enable LDAP over SSL (LDAPS) for Microsoft Active Directory servers Enable LDAP over SSL with a third-party certification authority How to Enable LDAP over TLS on a SonicWall without a Certificate Authority (CA) LDAP over SSL configuration in Active Directory Windows Server – Enable LDAPS Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/klocwork/kwadmin.html":{"url":"devops/klocwork/kwadmin.html","title":"kwadmin","keywords":"","body":" list projects and properties project create project delete project duplicate project rename project project properties get project properties set project properties project configuration files list configuration files list configuration types import configuration files delete configuration files build list builds delete build rename build keep builds by default Project properties displayed by kwadmin reference: command line references: kwadmin Kwagent Kwauth Kwcheck Kwciagent Kwinject Kwwrap kwadmin Reference for integration project and build properties Build properties displayed by kwadmin Admin Tools Improving database performance Backing up Klocwork data Build properties displayed by kwadmin list projects and properties $ kwadmin list-projects project create project $ kwadmin create-project [--encoding utf-8] delete project $ kwadmin delete-project duplicate project $ kwadmin duplicate-project rename project $ kwadmin rename-project project properties get project properties $ kwadmin get-project-properties set project properties $ kwadmin set-project-property change Issue grouping previous url : issue grouping $ kwadmin set-project-property grouping_on_default false project configuration files Configuration files that you can import into integration projects list configuration files $ kwadmin list-config-files example$ kwadmin list-config-files sample_project analysis_profile.pconf (Problems Configuration) metrics_default.mconf (Metrics Thresholds) kw_override.h (Override File) list configuration types $ kwadmin list-config-types Build Specification Template (.tpl) User Defined Attributes (.atr) Source Ownership (.sow) User Metrics (.ume) Size of Types (.szt) User Defined Relationships (.rel) Taxonomy Configuration (.tconf) Metrics Thresholds (.mconf) Override File (.h) Problems Configuration (.pconf) Java Function Behavior Knowledge Base (.jkb) Function Behavior Knowledge Base (.kb) import configuration files $ kwadmin import-config delete configuration files $ kwadmin delete-config build list builds $ kwadmin list-builds delete build $ kwadmin delete-build rename build $ kwadmin rename-build keep builds by default $ kwadmin set-project-property auto_delete_threshold Project properties displayed by kwadmin Property Description auto_delete_threshold specifies the number of builds to save when the auto delete feature is enabled bug_tracker_schema Used to replace {0} with id, and convert id to a hyperlink copy_tables specifies whether Klocwork tables will be copied to projects_root by kwadmin load description project description grouping_on_default changes the way the system displays server issues. By default, desktop issues are shown with grouping off while server issues are shown with grouping on. If you want server issues for a project to persistently show issues with grouping off, change the setting to false. language programming language of the source files in the project locale overrides the locale for the project set during project creation. Should only be set before running an integration build analysis with kwbuildproject, so that the language of issue messages and traceback will be consistent in all builds source_encoding language encoding of project source files. See kwadmin create-project. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/klocwork/kwservice.html":{"url":"devops/klocwork/kwservice.html","title":"kwserver","keywords":"","body":" setup server config start/restart service check license status references: Security Best Practices + Klocwork Klocwork Insight 10.0 SR3 - Installation and Upgrade.pdf setup server config [!TIP] can be one of: database license klocwork is the projects_root where the servers are running $ kwservice set-service-property klocwork host my.klocwork.com Using projects root: /projects/root # kwservice check Using projects root: /projects/root Local Host is: klocwork-server-7*********-****q [10.244.6.65] Checking License Server [running on klocwork-license:443] Checking Database Server [running on localhost:3306] (projects root is /projects/root) Checking Klocwork Server [running on my.klocwork.com:8080] start/restart service [!TIP] references: Managing the Klocwork Servers start $ kwservice --projects-root /projects/root start restart $ kwservice --projects-root /projects/root restart Using projects root: /projects_root Local Host is: klocwork-server-7*********-****4 [10.244.6.68] Re-starting License Server [already running on klocwork-license:443] Re-starting Database Server [started on localhost:3306] (projects root is /projects/root) Re-starting Klocwork Server stop $ kwservice --projects-root /projects/root stop Using projects root: /projects_root Local Host is: devops-klocwork-7********b-s***b [10.244.6.81] Stopping License Server [running on l******2:3***8] Stopping Database Server [stopped] Stopping Klocwork Server [stopped] check license status [!TIP] references: Licensing How licensing works Can't connect to License Server Changing the vendor daemon port in your license file Licensing with multiple projects_root directories Setting up redundant license servers How Structure101 licensing works $ kwservice --projects-root /projects/root check license Using projects root: /projects/root Local Host is: klocwork-server-755dc7966b-ndb94 [10.244.6.68] Checking License Server [running on klocwork-license:443] Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/klocwork/api.html":{"url":"devops/klocwork/api.html","title":"api","keywords":"","body":" api list all projects list builds info from project actions server access project builds issue report api [!NOTE] api url: http(s)://sample.klocwork.com:443/review/api reference: Klocwork Web API cookbook Klocwork Code Review Web API cookbook Klocwork Insight Web API cookbook Access control API examples Issue and metric API examples Authentication using the ltoken $ export KLOCWORK_LTOKEN=/path/to/ltoken default path for kwauth: Windows: %APPDATA%\\.klocwork\\ltoken Unix: ~/.klocwork/ltoken Mac: ~/.klocwork/ltoken Klocwork Static Code Analysis Web API Reference to access Web API send a POST request to http://sample.klocwork.com/review/api with the following parameters: user* Klocwork user name ltoken kwauth login token action* action name builds: retrieve the list of builds for a project. example: curl --data \"action=builds&user=myself&project=project_name\" http://sample.klocwork.com/review/api project* : project name username : username list all projects $ username='account' $ ltoken='abc123**********************************************************' $ url='https://sample.klocwork.com:8080' $ curl -skg \\ --data \"action=projects&user=${username}&ltoken=${ltoken}\" \\ \"${url}/review/api\" | jq -r .id list builds info from project ltoek is got from ${KLOCWORK_LTOKEN} file reference: Klocwork Insight Web API cookbook Issue states Issue statuses api additional header : -H \"Content-Type: application/x-www-form-urlencoded;charset=UTF-8\" via api $ curl --data \"action=builds&user=&ltoken=&project=\" http://sample.klocwork.com/review/api i.e.:$ curl --data \"action=builds&user=marslo&ltoken=abcd1234****&project=marslo-kw\" \\ https://sample.klocwork.com:443/review/api {\"id\":3,\"name\":\"build_3\",\"date\":1619437882164,\"keepit\":false} {\"id\":2,\"name\":\"build_2\",\"date\":1619436216567,\"keepit\":false} {\"id\":1,\"name\":\"build_1\",\"date\":1619434698145,\"keepit\":false} via kwadmin $ kwadmin --url https://sample.klocwork.com:443 list-builds marslo-kw build_1 build_2 build_3 list project config files$ kwadmin --url https://sample.klocwork.com:443 list-config-files marslo-kw analysis_profile.pconf (Problems Configuration) metrics_default.mconf (Metrics Thresholds) query only new issues [!NOTE:label:references:] Using the search API search retrieve the list of detected issues. example: curl --data \"action=search&user=myself&project=my_project&query=file:MyFile.c\" http://sample.klocwork.com/review/api project* : project name query : search query, such as narrowing by file (for example, 'file:MyFile.c') view : view name limit : search result limit summary : include summary record to output stream Searching in Klocwork Static Code Analysis: Searching in Klocwork Static Code Analysis NOTE: You can only search by one build at a time. Other acceptable syntax: build:'123' - searches for build which contains substring '123' build:+123 - searches for build with name 123 build:+'123string' - searches for build with name equal to '123string' $ ltoken='abcd1234*****' $ username='marslo' $ project='marslo-kw' $ query='build:build_3 state:New' $ url='https://sample.klocwork.com:443' $ curl --data \"action=search&user=${username}&ltoken=${ltoken}&project=${project}&query=${query}\" \\ ${url}/review/api | jq --raw-output . actions [!NOTE|label:references:] Klocwork Web API server ACTIONS DATA import_server_configuration action=import_server_configuration&user=myself&sourceURL=http://oldserver:8080&sourceAdmin=user&sourcePassword=pwd license_count action=license_count&user=myself&feature=kwadmin10 task_status action=task_status&user=myself version action=version&user=myself access ACTIONS DATA roles action=roles&user=myself&search=rolename create_role action=create_role&user=myself&name=myrole&create_project=true&manage_roles=false&change_issue_status=true&allowed_status_transitions=Any,Analyze;Analyze,Fix delete_role action=delete_role&user=myself&name=my_role users action=users&user=myself&search=username&limit=1000 create_user action=create_user&user=myself&name=user_name&password=thepassword delete_user action=delete_user&user=myself&name=user_name role_assignments action=role_assignments&user=myself&search=rolename update_role_assignment action=update_role_assignment&user=myself&name=myrole&project=myproject&account=jdoe&group=false&remove=falseaction=update_role_assignment&user=myself&name=myrole&project=myproject&account=jdoe&group=false&remove=falseaction=update_role_assignment&user=myself&name=myrole&project=myproject&account=jdoe&group=false&remove=falseaction=update_role_assignment&user=myself&name=myrole&project=myproject&account=jdoe&group=false&remove=falseaction=update_role_assignment&user=myself&name=myrole&project=myproject&account=jdoe&group=false&remove=false update_role_permissions action=update_role_permissions&user=myself&name=myrole&create_project=true&manage_roles=false&change_issue_status=true&allowed_status_transitions=Any,Analyze;Analyze,Fix project ACTIONS DATA groups action=groups&user=myself&search=groupname&limit=1000 create_group action=create_group&user=myself&name=group_name&users=User1,User2 delete_group action=delete_group&user=myself&name=group_name update_group action=update_group&user=myself&name=group_name&users=User1,User2 projects action=projects&user=myself import_project action=import_project&user=myself&project=my_project&sourceURL=http://oldserver:8080&sourceAdmin=user&sourcePassword=pwd delete_project action=delete_project&user=myself&name=my_project update_project action=update_project&user=myself&name=myproject&new_name=my_project import_status action=import_status&user=myself modules action=modules&user=myself&project=my_project project_configuration action=project_configuration&user=myself&project=my_project&build=build_name taxonomies action=taxonomies&user=myself&project=my_project builds ACTIONS DATA builds action=builds&user=myself&project=my_project defect_types action=defect_types&user=myself&project=my_project update_defect_type action=update_defect_type&user=myself&project=my_project&code=ECC.EMPTY&enabled=false delete_build action=delete_build&user=myself&project=my_project&name=build_1 create_module action=create_module&user=myself&project=my_project&name=test&allow_all=true&paths=\"**/test/*\" delete_module action=delete_module&user=myself&project=my_project&name=my_module update_module action=update_module&user=myself&project=my_project&name=test&new_name=aux&allow_all=true&paths=\"**/test/*,**/assert/*\" update_build action=update_build&user=myself&name=build_1&new_name=build_03_11_2011 issue ACTIONS DATA issue_details action=issue_details&user=myself&project=my_project&id=650 search action=search&user=myself&project=my_project&query=file:MyFile.c update_status action=update_status&user=myself&project=my_project&ids=ids_list&status=new_status&comment=new_comment&owner=new_owner report ACTIONS DATA views action=views&user=myself&project=my_project create_view action=create_view&user=myself&project=my_project&name=critical&query=severity:1-3 delete_view action=delete_view&user=myself&project=my_project&name=my_view update_view action=update_view&user=myself&project=my_project&tags=c,security&name=my_view fchurns action=fchurns&user=myself&component=Component metrics action=metrics&user=myself&project=my_project&query=file:MyFile.c report action=report&user=myself&project=my_project&build=build_1&x=Category&y=Component Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:10:10 "},"devops/klocwork/qa.html":{"url":"devops/klocwork/qa.html","title":"q&a","keywords":"","body":" kwauth doesn't properly set HTTP/1.1 header kwauth doesn't properly set HTTP/1.1 header [!NOTE] Limitations kwlimitations Authentication using the ltoken [!TIP] Sometimes when the Klocwork Server IP address is associated with multiple host names or located behind a reverse proxy, kwauth does not properly resolve the FDQN of the Klocwork Server. Workaround: To resolve this problem, we added a conditional host resolution based on a parameter in a specified configuration file. If you set it to 'false', then you can specify FQDN for the URL of the remote server. To set host resolution to 'false', you need to create a configuration file on the client side with the following address: {client_tools_install_folder}\\config\\client_config.xml The file must have the following structure: Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/android.html":{"url":"devops/android.html","title":"android","keywords":"","body":" sdkmanager list download sdk while building debug install android package management list remote sdk list local sdk update sdk manual download sdkmanager list list available package $ sdkmanager --no_https --proxy=socks --proxy_port=1880 --proxy_host=localhost --list Installed packages:=====================] 100% Computing updates... Path | Version | Description | Location ------- | ------- | ------- | ------- tools | 26.1.1 | Android SDK Tools 26.1.1 | tools/ Available Packages: Path | Version | Description ------- | ------- | ------- add-ons;addon-google_apis-google-15 | 3 | Google APIs add-ons;addon-google_apis-google-16 | 4 | Google APIs add-ons;addon-google_apis-google-17 | 4 | Google APIs add-ons;addon-google_apis-google-18 | 4 | Google APIs add-ons;addon-google_apis-google-19 | 20 | Google APIs add-ons;addon-google_apis-google-21 | 1 | Google APIs add-ons;addon-google_apis-google-22 | 1 | Google APIs add-ons;addon-google_apis-google-23 | 1 | Google APIs add-ons;addon-google_apis-google-24 | 1 | Google APIs add-ons;addon-google_gdk-google-19 | 11 | Glass Development Kit Preview build-tools;19.1.0 | 19.1.0 | Android SDK Build-Tools 19.1 build-tools;20.0.0 | 20.0.0 | Android SDK Build-Tools 20 build-tools;21.1.2 | 21.1.2 | Android SDK Build-Tools 21.1.2 ... list $ find /opt/android-sdk/ -name package.xml -exec sh -c 'eval $(xmllint --xpath \"//*[local-name()='\\'localPackage\\'']/@path\" $0) && echo $path' {} \\; platforms;android-26 platforms;android-17 platforms;android-22 platforms;android-23 platforms;android-24 platforms;android-18 platforms;android-21 platforms;android-19 platforms;android-25 platforms;android-16 docs build-tools;24.0.1 build-tools;22.0.1 build-tools;25.0.2 build-tools;25.0.3 build-tools;23.0.1 ... $ sdkmanager --list --verbose Info: Parsing legacy package: /opt/android-sdk/android-ndk Info: Parsing /opt/android-sdk/build-tools/19.1.0/package.xml Info: Parsing /opt/android-sdk/build-tools/20.0.0/package.xml Info: Parsing /opt/android-sdk/build-tools/21.1.2/package.xml Info: Parsing /opt/android-sdk/build-tools/22.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.1/package.xml ... list target $ android list target Available Android targets: ---------- id: 1 or \"android-15\" Name: Android 4.0.3 Type: Platform API level: 15 Revision: 5 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800 Tag/ABIs : no ABIs. ---------- id: 2 or \"android-16\" Name: Android 4.1.2 Type: Platform API level: 16 Revision: 5 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800, WXGA800-7in Tag/ABIs : no ABIs. ---------- ... download sdk while building GRADLE_OPTS='-Dorg.gradle.daemon=false -Dandroid.builder.sdkDownload=true -Dorg.gradle.jvmargs=-Xmx2048M -Dhttp.proxyHost=sample.localnet -Dhttp.proxyPort=80 -Dhttps.proxyHost=sample.localnet -Dhttps.proxyPort=80' HTTPS_PROXY=http://sample.localnet:80 HTTP_PROXY=http://sample.localnet:80 _JAVA_OPTIONS='-Dhttp.proxyHost=sample.localnet -Dhttp.proxyPort=80 -Dhttps.proxyHost=sample.localnet -Dhttps.proxyPort=80' http_proxy=http://sample.localnet:80 https_proxy=http://sample.localnet:80 debug $ strace -e trace=network -y -s 256 -f -o strace.log tools/bin/sdkmanager --update install $ sdkmanager \"platform-tools\" \"platforms;android-26\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 --verbose Info: Parsing legacy package: /opt/android-sdk/android-ndk Info: Parsing /opt/android-sdk/build-tools/19.1.0/package.xml Info: Parsing /opt/android-sdk/build-tools/20.0.0/package.xml Info: Parsing /opt/android-sdk/build-tools/21.1.2/package.xml Info: Parsing /opt/android-sdk/build-tools/22.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.2/package.xml Info: Parsing /opt/android-sdk/build-tools/23.0.3/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.0/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.1/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.2/package.xml Info: Parsing /opt/android-sdk/build-tools/24.0.3/pac kage.xml ... plugin installation $ sdkmanager \"extras;m2repository;com;android;support;constraint;constraint-layout;1.0.2\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 /opt/android-sdk/extras/m2repository/com/android/support/constraint/constraint-layout/1.0.2/constraint-layout-1.0.2.aar $ sdkmanager \"extras;android;m2repository;com;android;support;multidex;1.0.2\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 /opt/android-sdk/extras/android/m2repository/com/android/support/multidex/1.0.1/multidex-1.0.1.aar \"extras;android;m2repository;com;android;support;multidex;1.0.2\" $ sdkmanager \"add-ons;addon-google_apis-google-21\" --no_https --proxy=http --proxy_host=192.168.1.100 --proxy_port=8000 Done /opt/android-sdk/add-ons/addon-google_apis-google-21 android package management list remote sdk $ android list sdk --no-https --proxy-host 192.168.1.100 --proxy-port 8000 Refresh Sources: Fetching http://dl.google.com/android/repository/addons_list-2.xml Validate XML Parse XML Fetched Add-ons List successfully Refresh Sources Fetching URL: http://dl.google.com/android/repository/repository-11.xml Validate XML: http://dl.google.com/android/repository/repository-11.xml Parse XML: http://dl.google.com/android/repository/repository-11.xml Fetching URL: http://dl.google.com/android/repository/addon.xml Validate XML: http://dl.google.com/android/repository/addon.xml ... list local sdk $ android list Available Android targets: ---------- id: 1 or \"android-16\" Name: Android 4.1.2 Type: Platform API level: 16 Revision: 5 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800, WXGA800-7in Tag/ABIs : no ABIs. ---------- id: 2 or \"android-17\" Name: Android 4.2.2 Type: Platform API level: 17 Revision: 3 Skins: HVGA, QVGA, WQVGA400, WQVGA432, WSVGA, WVGA800 (default), WVGA854, WXGA720, WXGA800, WXGA800-7in Tag/ABIs : no ABIs. ---------- ... update sdk $ android update sdk --no-ui --no-https --proxy-host 192.168.1.100 --proxy-port 8000 Refresh Sources: Fetching http://dl.google.com/android/repository/addons_list-2.xml Validate XML Parse XML Fetched Add-ons List successfully Refresh Sources Fetching URL: http://dl.google.com/android/repository/repository-11.xml Validate XML: http://dl.google.com/android/repository/repository-11.xml Parse XML: http://dl.google.com/android/repository/repository-11.xml Fetching URL: http://dl.google.com/android/repository/addon.xml Validate XML: http://dl.google.com/android/repository/addon.xml Parse XML: http://dl.google.com/android/repository/addon.xml Fetching URL: http://dl.google.com/android/repository/glass/addon.xml Validate XML: http://dl.google.com/android/repository/glass/addon.xml Parse XML: http://dl.google.com/android/repository/glass/addon.xml Fetching URL: http://dl.google.com/android/repository/extras/intel/addon.xml Validate XML: http://dl.google.com/android/repository/extras/intel/addon.xml ... manual download https://dl.google.com/android/repository/ https://dl.google.com/android/repository/tools_r25.2.5-linux.zip Tools: Android SDK Platform-tools https://dl.google.com/android/repository/platform-tools_r25.0.3-linux.zip https://dl.google.com/android/repository/platform-tools_r25.0.3-linux.zip Android SDK Build-tools: - https://dl.google.com/android/repository/build-tools_r25.0.2-linux.zip - https://dl.google.com/android/repository/build-tools_r25.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r25-linux.zip - https://dl.google.com/android/repository/build-tools_r24.0.3-linux.zip - https://dl.google.com/android/repository/build-tools_r24.0.2-linux.zip - https://dl.google.com/android/repository/build-tools_r24.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r24-linux.zip - https://dl.google.com/android/repository/build-tools_r23.0.3-linux.zip - https://dl.google.com/android/repository/build-tools_r23.0.2-linux.zip - https://dl.google.com/android/repository/build-tools_r23.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r22.0.1-linux.zip - https://dl.google.com/android/repository/build-tools_r21.1.2-linux.zip - https://dl.google.com/android/repository/build-tools_r20-linux.zip - https://dl.google.com/android/repository/build-tools_r19.1-linux.zip Android 7.1.1 (API 25) - SDK Platform: https://dl.google.com/android/repository/platform-25_r03.zip platforms/android-25 Android 7.0 (API 24) - SDK Platform: https://dl.google.com/android/repository/platform-24_r02.zip platforms/android-24 - Document: https://dl.google.com/android/repository/docs-24_r01.zip docs/ - Google APIs https://dl.google.com/android/repository/google_apis-24_r1.zip add-ons/addon-google_apis-google-24 Android 6.0 (API 23) - SDK Platform https://dl.google.com/android/repository/platform-23_r03.zip platforms/android-23 - Document: https://dl.google.com/android/repository/docs-23_r01.zip docs/ - Google APIs https://dl.google.com/android/repository/google_apis-23_r01.zip add-ons/addon-google_apis-google-23 Android 5.1.1 (API 22) - SDK Platform https://dl.google.com/android/repository/android-22_r02.zip platforms/android-23 - Google APIs https://dl.google.com/android/repository/google_apis-22_r01.zip add-ons/addon-google_apis-google-22 Extra: - Android Support Repository https://dl.google.com/android/repository/android_m2repository_r44.zip extras/android/m2repository - Android Auto Desktop Head Unit emulator https://dl.google.com/android/repository/desktop-head-unit-linux_r01.1.zip extras/google/auto - Google Play Services https://dl.google.com/android/repository/google_play_services_v9_rc41.zip extras/google/google_play_services - Google Repository https://dl.google.com/android/repository/google_m2repository_gms_v9_rc41_wear_2_0_rc6.zip extras/google/m2repository - Google Play APK Expansion library https://dl.google.com/android/repository/market_apk_expansion-r03.zip extras/google/market_apk_expansion - Google Play Licensing Library https://dl.google.com/android/repository/market_licensing-r02.zip extras/google/market_licensing - Google Play Billing Library https://dl.google.com/android/repository/play_billing_r05.zip extras/google/play_billing - Android Auto API Simulators https://dl.google.com/android/repository/simulator_r01.zip extras/google/simulators - Google USD Driver https://dl.google.com/android/repository/usb_driver_r11-windows.zip extras/google/usb_driver - Google Web Driver https://dl.google.com/android/repository/webdriver_r02.zip extras/google/webdriver - Intel x86 Emulator Accelerator (HAXM Installer) http://mirrors.neusoft.edu.cn/android/repository/extras/intel/ Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"devops/mobile.html":{"url":"devops/mobile.html","title":"mobile","keywords":"","body":" ios get info idevice list apps install app idevicediagnostics andriod environment get info show list install & uninstall ios get info get info from *.plist $ /usr/libexec/PlistBuddy -c \"Print :CFBundleIdentifier\" package/Info.plist com.mycompany.myapp.demo $ /usr/libexec/PlistBuddy -c print package/Info.plist | grep CFBundleVersion CFBundleVersion = 185 get ipa file information $ gem install shenzhen $ ipa info myapp-0.3.0/myapp.ipa security: SecPolicySetValue: One or more parameters passed to a function were not valid. +-----------------------------+---------------------------------------------------------+ | AppIDName | mymobileapp | | ApplicationIdentifierPrefix | 9BXY7H1234 | | CreationDate | 2017-04-13T04:58:51+00:00 | | Platform | iOS | | Entitlements | keychain-access-groups: [\"9BXY7H1234.*\"] | | | get-task-allow: false | | | application-identifier: 9BXY7H1234.com.mycompany.my.app | | | com.apple.developer.healthkit: true | | | com.apple.developer.team-identifier: 9BXY7H1234 | | | aps-environment: production | | ExpirationDate | 2018-04-13T04:58:51+00:00 | | Name | myappPilotAppDistribution | | ProvisionsAllDevices | true | | TeamIdentifier | 9BXY7H1234 | | TeamName | mycompany (China) Investment Co., Ltd | | TimeToLive | 365 | | UUID | 4b73738f-d730-49e4-a8eb-0031275cdee4 | | Version | 1 | | Codesigned | False | +-----------------------------+---------------------------------------------------------+ check version mobileprovision $ unzip -l myapp-0.3.0/myapp.ipa | grep mobileprovision 7589 06-30-2017 17:29 Payload/myapp.app/embedded.mobileprovision get version $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D | egrep \\(.*) details $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D | grep version security: SecPolicySetValue: One or more parameters passed to a function were not valid. $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D | egrep \\1 $ unzip -p myapp-0.3.0/myapp.ipa \"Payload/myapp.app/embedded.mobileprovision\" | security cms -D security: SecPolicySetValue: One or more parameters passed to a function were not valid. AppIDName myapp ApplicationIdentifierPrefix 9BXY7H1234 ... get uuid uuid=$(/usr/libexec/PlistBuddy -c 'Print :UUID' /dev/stdin idevice list real devices $ idevice_id -l 02be8bb96f479db9ff691f7e57c2344d170b363c 521d2bba6b5da32ad61aa7ea516fc45e31300a0f list simulator & devices $ instruments -s devices Known Devices: devops-slave08 [BEFBB759-F3EF-5053-94B4-EC21E6F032F7] devops-iphone (11.2.6) [521d2bba6b5da32ad61aa7ea516fc45e31300a0f] devops-ipad (11.2.6) [02be8bb96f479db9ff691f7e57c2344d170b363c] Apple TV 1080p (10.2) [F546057D-6F75-40C6-ADB2-958ED8ACAF45] (Simulator) iPad (5th generation) (10.3.1) [7D221270-6E99-4C25-B3F0-FD3ABF4ADE38] (Simulator) iPad Air (10.3.1) [C4AC315A-FD89-4D6B-B7B9-3CDA2088A36E] (Simulator) iPad Air 2 (10.3.1) [01F1D17D-5666-4B40-A8DC-F38FB7E3A266] (Simulator) ... list apps $ ideviceinstaller -u ${DEVICEID} --list-apps CFBundleIdentifier, CFBundleVersion, CFBundleDisplayName com.mycompany.my.app, \"1384\", \"myapp\" List the 3rd part apps $ ideviceinstaller -u ${DEVICEID} --list-apps -o list_user CFBundleIdentifier, CFBundleVersion, CFBundleDisplayName com.mycompany.my.app, \"1384\", \"myapp\" list default apps $ ideviceinstaller -u ${DEVICEID} --list-apps -o list_system CFBundleIdentifier, CFBundleVersion, CFBundleDisplayName com.apple.AXUIViewService, \"1\", \"AXUIViewService\" com.apple.AccountAuthenticationDialog, \"1.0\", \"AccountAuthenticationDialog\" com.apple.AdSheetPhone, \"1.0\", \"iAd\" com.apple.AppStore, \"1\", \"App Store\" com.apple.AskPermissionUI, \"1.0\", \"AskPermissionUI\" com.apple.CTCarrierSpaceAuth, \"1\", \"CTCarrierSpaceAuth\" ... install app $ /usr/local/bin/ideviceinstaller -u ${DEVICEID} --install $(find ${WORKSPACE}/package -name \"*.ipa\") WARNING: could not locate iTunesMetadata.plist in archive! WARNING: could not locate Payload/myapp.app/SC_Info/myapp.sinf in archive! Copying '/Users/devops/workspace/platform_mobile_deploy/package/myapp_ios_app-1.1.1389.ipa' to device... DONE. Installing 'com.mycompany.my.app' Install: CreatingStagingDirectory (5%) Install: ExtractingPackage (15%) Install: InspectingPackage (20%) Install: TakingInstallLock (20%) Install: PreflightingApplication (30%) Install: InstallingEmbeddedProfile (30%) Install: VerifyingApplication (40%) Install: CreatingContainer (50%) Install: InstallingApplication (60%) Install: PostflightingApplication (70%) Install: SandboxingApplication (80%) Install: GeneratingApplicationMap (90%) Install: Complete idevicediagnostics restart device $ idevicediagnostics restart -u ${DEVICEID} Restarting device. get provision $ idevicediagnostics diagnostics All -u ${DEVICEID} GasGauge CycleCount 3 DesignCapacity 1810 FullChargeCapacity 1900 Status Success idevicepair $ idevicepair pair -u 521d2bba6b5da32ad61aa7ea516fc45e31300a0f SUCCESS: Paired with device 521d2bba6b5da32ad61aa7ea516fc45e31300a0f $ idevicepair pair -u 02be8bb96f479db9ff691f7e57c2344d170b363c SUCCESS: Paired with device 02be8bb96f479db9ff691f7e57c2344d170b363c ideviceprovision $ ideviceprovision list -u ${DEVICEID} Device has 4 provisioning profiles installed: 4b73738f-d730-49e4-a8eb-0031275cdee4 - myappPilotAppDistribution b84ef185-a387-4a1d-8a41-3230708c6b31 - iOS Team Provisioning Profile: com.mycompany.cdtest.WebDriverAgentRunner 59ecee46-f43f-4a87-a89e-f9b03f14cf01 - XC iOS: com.mycompany.myapp.demo 83d90272-79fe-4f8f-8ea5-8f18f60b5683 - myappDemoDev andriod environment $ ln -sf /opt/android/platform-tools/adb /usr/local/bin/adb $ ln -sf /opt/android/build-tools/27.0.3/aapt /usr/local/bin/aapt $ ln -sf /opt/android/build-tools/27.0.3/aapt2 /usr/local/bin/aapt2 get info get bundle id from *.ipa $ aapt dump badging ${apkFile} | grep package | sed -r -e \"s:^.*name='([^']*).*$:\\\\1:\" $ aapt dump badging package/myapp-1.3.85.apk | grep package | sed -r -e \"s:^.*name='([^']*).*$:\\\\1:\" com.mycompany.myapp.demo $ aapt dump badging package/myapp-1.3.85.apk | grep package package: name='com.mycompany.myapp.demo' versionCode='1030085' versionName='1.3.85' platformBuildVersionName='8.0.0' $ aapt dump badging package/myapp-1.3.85.apk package: name='com.mycompany.myapp.demo' versionCode='1030085' versionName='1.3.85' platformBuildVersionName='8.0.0' sdkVersion:'19' targetSdkVersion:'26' uses-permission: name='android.permission.INTERNET' uses-permission: name='android.permission.ACCESS_NETWORK_STATE' uses-permission: name='android.permission.ACCESS_WIFI_STATE' uses-permission: name='android.permission.READ_PHONE_STATE' uses-permission: name='android.permission.WRITE_EXTERNAL_STORAGE' uses-permission: name='android.permission.READ_EXTERNAL_STORAGE' ... get imei $ adb shell service call iphonesubinfo 1 | awk -F \"'\" '{print $2}' | sed '1 d' | tr -d '.' | awk '{print}' ORS= 864226033999836 $ echo \"[device.imei]: [$(adb shell service call iphonesubinfo 1 | awk -F \"'\" '{print $2}' | sed '1 d'| tr -d '\\n' | tr -d '.' | tr -d ' ')]\" [device.imei]: [864226033999836] $ echo \"[device.imei]: [$(adb shell service call iphonesubinfo 1 | awk -F \"'\" '{print $2}' | sed '1 d'| tr -d '\\n' | tr -d '.' | tr -d ' ')]\"; adb shell getprop | grep \"model\\|version.sdk\\|manufacturer\\|ro.serialno\\|product.name\\|brand\\|version.release\\|build.id\\|security_patch\" | sed 's/ro\\.//g' [device.imei]: [864226033999836] [persist.sys.modelnumber]: [NX569H] [build.id]: [MMB29M] [build.version.release]: [6.0.1] [build.version.sdk]: [23] [build.version.security_patch]: [2017-02-01] [product.brand]: [nubia] [product.manufacturer]: [nubia] [product.model]: [NX569H] [product.name]: [NX569H] [serialno]: [fac7ea46] get andriod version $ adb shell getprop ro.build.version.release 6.0.1 show list list installed apps $ adb -s fac7ea46 shell 'pm list packages' | grep 'com.mycompany.myapp.demo' package:com.mycompany.myapp.demo list all apps $ adb -s ${DEVICEID} shell 'pm list packages -f' | sed -e 's/.*=//' | sed 's/\\r//g' | sort android cn.nubia.accounts cn.nubia.aftersale cn.nubia.applockmanager cn.nubia.apps cn.nubia.appsettingsinfoproviders cn.nubia.autoagingtest cn.nubia.bbs cn.nubia.bootanimationinfo ... list connected device $ adb devices List of devices attached fac7ea46 device $ adb devices -l List of devices attached fac7ea46 device usb:343089152X product:NX569H model:NX569H device:NX569H transport_id:2 install & uninstall install $ adb -s ${DEVICEID} install -r \"$(find . -name '*.apk')\" $ adb -s fac7ea46 install ${WORKSPACE}/package/myapp-1.3.84.apk [ 0%] /data/local/tmp/myapp-1.3.84.apk [ 1%] /data/local/tmp/myapp-1.3.84.apk [ 2%] /data/local/tmp/myapp-1.3.84.apk [ 3%] /data/local/tmp/myapp-1.3.84.apk [ 3%] /data/local/tmp/myapp-1.3.84.apk [ 4%] /data/local/tmp/myapp-1.3.84.apk [ 5%] /data/local/tmp/myapp-1.3.84.apk [ 6%] /data/local/tmp/myapp-1.3.84.apk [ 7%] /data/local/tmp/myapp-1.3.84.apk [ 7%] /data/local/tmp/myapp-1.3.84.apk ... uninstall $ adb -s ${DEVICEID} uninstall ${BUNDLEID} e.g.: $ adb -s fac7ea46 uninstall com.mycompany.myapp.demo Success $ if adb -s fac7ea46 shell 'pm list packages' | grep 'com.mycompany.myapp.demo'; then > adb -s fac7ea46 uninstall com.mycompany.myapp.demo > fi Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:22 "},"jenkins/jenkins.html":{"url":"jenkins/jenkins.html","title":"jenkins","keywords":"","body":" basic Java requirements CPS Viewing Jenkins Jobs' Configuration as XML using style in Jenkins crumb issuer get crumb visit API via crumb restart Jenkins instance run Jenkins in docker in kubernetes via helm build Jenkins docker image run Jenkins API out of Jenkins jenkins-core references: CloudBeesTV Jenkins Tutorials Jenkins Plugin Developer Series Jenkins X CloudBees CI ci.jenkins.io basic Java requirements [!NOTE] Jenkins requires Java 11 or 17 since Jenkins 2.357 and LTS 2.361.1. Read more about this in the announcement blog post Jenkins requires Java 11 or newer Java 11 end of life in Jenkins Java Support Policy references: Java 11 to 17 upgrade guidelines Java 8 to 11 upgrade guidelines proxy Setting JVM Options for Application Servers ava HotSpot VM Command-Line Options SUPPORTED JAVA VERSION LTS RELEASE WEEKLY RELEASE Java 11, Java 17 or Java 21 N/A 2.419 (August 2023) Java 11, Java 17 2.361.1 (September 2022) 2.357 (June 2022) Java 8, Java 11 or Java 17 2.346.1 (June 2022) 2.340 (March 2022) Java 8, Java 17 2.164.1 (March 2019) 2.164 (February 2019) CPS references: Jenkins Pipelines Generator Configuring Content Security Policy Rendering User Content How to Serve Resources from Jenkins Content Security Policy (CSP) for Web Report Unable to embed Jenkins page into an iframe. How to fix it? Continuous Integration series Multi-environment deployments with Jenkins and Octopus Deploying to Amazon EKS with Docker and Jenkins Building a Docker image in Jenkinsfile and publishing to ECR Deploying to Amazon EKS with Docker and Jenkins Jenkins security tips How to install a Jenkins instance with Helm How to install Jenkins on Docker Using dynamic build agents to automate scaling in Jenkins Jenkins & Python Setting Jenkins CI for python application Jenkins and Python others Where to download hudson library? Hooking into the Jenkins (Hudson) API, Part 1 Hooking into the Jenkins (Hudson) API, Part 2 How to import the class hudson outside jenkins? org.jenkins-ci.main » jenkins-core war packages Jenkins Custom WAR Packager The default rule set results in the following: No JavaScript allowed at all No plugins (object/embed) allowed No inline CSS, or CSS from other sites allowed No images from other sites allowed No frames allowed No web fonts allowed No XHR/AJAX allowed Viewing Jenkins Jobs' Configuration as XML install Job Configuration History open in browser:job url : http: //localhost:8080/job// conig url : http: //localhost:8080/job//config.xml using style in Jenkins references: * imarslo: css alert The Curious Case of the Slow Jenkins Job bootstrap alert callout success Success Alert ! This is a success alert with an example link. Give it a click if you like. warning Warning Alert ! This is a warning alert with an example link. Give it a click if you like. info Info Alert ! This is a info alert with an example link. Give it a click if you like. crumb issuer more info: CSRF Protection Explained Improved CSRF protection CSRF Protection Remote Access API Jenkins REST API example using crumb About the Jenkins infrastructure project jenkins on jenkins ci.jenkins.io azure.ci.jenkins.io.yaml trusted-ci.yaml get crumb jq for multiple values and another answer via groovy script import hudson.security.csrf.DefaultCrumbIssuer DefaultCrumbIssuer issuer = jenkins.model.Jenkins.instance.crumbIssuer jenkinsCrumb = \"${issuer.crumbRequestField}:${issuer.crumb}\" resultprintln jenkinsCrumb Jenkins-Crumb:7248f4a5*********** via curl $ domain='jenkins.marslo.com' $ COOKIEJAR=\"$(mktemp)\" $ curl -s \\ --cookie-jar \"${COOKIEJAR} \\ https://${domain}/crumbIssuer/api/json | jq -r '[.crumbRequestField, .crumb] | \"\\(.[0]):\\(.[1])\"' Jenkins-Crumb:8b87b6ed98ef923****** or imarslo: json cheatsheet $ domain='jenkins.marslo.com' $ COOKIEJAR=\"$(mktemp)\" $ curl -sSLg \\ --cookie-jar \"${COOKIEJAR} \\ https://${domain}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb' or $ COOKIEJAR=\"$(mktemp)\" $ curl -s \\ --cookie-jar \"${COOKIEJAR} \\ http://jenkins.marslo.com/crumbIssuer/api/json | jq -r '[.crumbRequestField, .crumb] | join(\":\")' or via xml $ COOKIEJAR=\"$(mktemp)\" $ curl -sSLg \\ --cookie-jar \"${COOKIEJAR} \\ \"http://${JENKINS_URL}/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,\\\":\\\",//crumb)\" Jenkins-Crumb:8b87b6ed98ef923****** via web page via wget after jenkins 2.176.2 # via xml api $ COOKIEJAR=\"$(mktemp)\" $ wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ --save-cookies \"${COOKIEJAR}\" \\ --keep-session-cookies \\ -q \\ --output-document \\ - \\ \"https://localhost:8080/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,%22:%22,//crumb)\")\" # via json api $ COOKIEJAR=\"$(mktemp)\" $ wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ --save-cookies \"${COOKIEJAR}\" \\ --keep-session-cookies \\ -q \\ --output-document \\ - \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' before jenkins 2.176.2 # via xml $ wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ -q \\ --output-document \\ - \\ 'http://localhost:8080/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,\":\",//crumb)' # via json $ wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ -q \\ --output-document \\ - \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' visit API via crumb @Current after 2.176.2 COOKIEJAR=\"$(mktemp)\" CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"${COOKIEJAR}\" \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' ) @Dprecated before jenkins 2.176.2 url='http://jenkins.marslo.com' CRUMB=\"$(curl -sSLg ${url}/crumbIssuer/api/json | jq -r .crumb \\ )\" CRUMB=\"Jenkins-Crumb:${CRUMB}\" # or CRUMB=\"$(curl -s ${url}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb' \\ )\" $ COOKIEJAR=\"$(mktemp)\" $ CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"${COOKIEJAR}\" \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' ) $ curl -H \"${CRUMB}\" \\ -d 'cities=Lanzhou' \\ http://jenkins.marslo.com/job/marslo/job/sandbox/buildWithParameters or $ domain='jenkins.marslo.com' $ url=\"https://${domain}\" $ COOKIEJAR=\"$(mktemp)\" $ curl -H \"$(curl -s \\ --cookie-jar \"${COOKIEJAR}\" \\ ${url}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb' \\ )\" \\ -d 'cities=Lanzhou' \\ ${url}/job/marslo/job/sandbox/buildWithParameters or $ curl -H \"Jenkins-Crumb:${CRUMB}\" \\ --data 'cities=Leshan,Chengdu' \\ --data 'provinces=Sichuan' \\ http://jenkins.marslo.com/job/marslo/job/sandbox/buildWithParameters or $ domain='jenkins.marslo.com' $ url=\"https://${domain}\" $ curl -H \"$(curl -s ${url}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb')\" \\ --data 'cities=Leshan,Chengdu' \\ --data 'provinces=Sichuan' \\ ${url}/job/marslo/job/sandbox/buildWithParameters build a job using the REST API and cURL $ curl -X POST http://developer:developer@localhost:8080/job/test/build # build with parameters $ curl -X POST \\ http://developer:developer@localhost:8080/job/test/build \\ --data-urlencode json='{\"parameter\": [{\"name\":\"paramA\", \"value\":\"123\"}]}' restart Jenkins instance @Current after 2.176.2 COOKIEJAR=\"$(mktemp)\" CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"${COOKIEJAR}\" \\ 'https://jenkins.marslo.com/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' ) @Dprecated before jenkins 2.176.2 CRUMB=\"$(curl -sSLg http://jenkins.marslo.com/crumbIssuer/api/json | jq -r .crumb \\ )\" CRUMB=\"Jenkins-Crumb:${CRUMB}\" # or CRUMB=\"$(curl -s ${url}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb' \\ )\" $ curl -X POST \\ -H \"${CRUMB}\" \\ http://jenkins.marslo.com/safeRestart or$ domain='jenkins.marslo.com' $ url=\"https://${domain}\" $ COOKIEJAR=\"$(mktemp)\" $ curl -X POST \\ -H \"$(curl -s \\ --cookie-jar \"${COOKIEJAR}\" \\ ${url}/crumbIssuer/api/json | jq -r '.crumbRequestField + \":\" + .crumb' \\ )\" \\ ${url}/safeRestart run Jenkins refernce: How to install Jenkins on Docker Jenkins Features Controlled with System Properties -Dhudson.security.ArtifactsPermission=true remoting configuration IMPORTANT JENKINS COMMAND unable to deactivate CSRF via JCasC Security updates for Jenkins core hudson.model.ParametersAction.keepUndefinedParameters=true hudson.model.ParametersAction.safeParameters [!TIP|label: latest jdk11 JAVA_OPT:] -Duser.timezone='America/Los_Angeles' -Dhudson.model.DirectoryBrowserSupport.CSP=\"\" -Djenkins.slaves.NioChannelSelector.disabled=true -Djenkins.slaves.JnlpSlaveAgentProtocol3.enabled=false -Djava.awt.headless=true -Djenkins.security.ClassFilterImpl.SUPPRESS_WHITELIST=true -Dhudson.model.ParametersAction.keepUndefinedParameters=true -Dcom.cloudbees.workflow.rest.external.ChangeSetExt.resolveCommitAuthors=true -Djenkins.install.runSetupWizard=true -Dpermissive-script-security.enabled=true -DsessionTimeout=1440 -DsessionEviction=43200 -Dgroovy.grape.report.downloads=true -Divy.message.logger.level=4 -Dhudson.plugins.active_directory.ActiveDirectorySecurityRealm.forceLdaps=false -Dfile.encoding=UTF-8 -Dsun.jnu.encoding=utf-8 -Djenkins.model.Jenkins.logStartupPerformance=true -Dhudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID=true -Xms192g -Xmx192g -XX:+AlwaysPreTouch -XX:+HeapDumpOnOutOfMemoryError -XX:+UseG1GC -XX:+UseStringDeduplication -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+ParallelRefProcEnabled -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:G1NewSizePercent=20 -XX:+PrintGC -XX:+PrintGCDetails -XX:+LogVMOutput -XX:InitialRAMPercentage=50.0 -XX:MaxRAMPercentage=50.0 -XX:HeapDumpPath=/var/jenkins_home/logs -XX:ErrorFile=/var/jenkins_home/logs/hs_err_%p.log -XX:LogFile=/var/jenkins_home/logs/jvm.log -Xlog:gc*=info,gc+heap=debug,gc+ref*=debug,gc+ergo*=trace,gc+age*=trace:file=/var/jenkins_home/logs/gc-%t.log:utctime,pid,level,tags:filecount=2,filesize=100M in docker $ docker run \\ --name jenkins \\ --rm \\ --detach \\ --network jenkins \\ --env DOCKER_HOST=tcp://docker:2376 \\ --env DOCKER_CERT_PATH=/certs/client \\ --env DOCKER_TLS_VERIFY=1 \\ --publish 8080:8080 \\ --publish 50000:50000 \\ --volume jenkins-data:/var/jenkins_home \\ --volume jenkins-docker-certs:/certs/client:ro \\ jenkins/jenkins:latest docker run with JAVA_OPTS [!TIP] more on Properties in Jenkins Core for JAVA_OPTS encoding How locale setting can break unicode/UTF-8 in Java/Tomcat $ docker run \\ --name jenkins \\ --detach \\ --rm \\ --network jenkins \\ --env DOCKER_HOST=tcp://docker:2376 \\ --env DOCKER_CERT_PATH=/certs/client \\ --env DOCKER_TLS_VERIFY=1 \\ --publish 8080:8080 \\ --publish 50000:50000 \\ --env JENKINS_ADMIN_ID=admin \\ --env JENKINS_ADMIN_PW=admin \\ --env JAVA_OPTS=\" \\ -XX:+UseG1GC \\ -Xms8G \\ -Xmx16G \\ -Dfile.encoding=UTF-8 \\ -Dsun.jnu.encoding=utf-8 \\ -DsessionTimeout=1440 \\ -DsessionEviction=43200 \\ -Djava.awt.headless=true \\ -Djenkins.ui.refresh=true \\ -Divy.message.logger.level=4 \\ -Dhudson.Main.development=true \\ -Duser.timezone='Asia/Chongqing' \\ -Dgroovy.grape.report.downloads=true \\ -Djenkins.install.runSetupWizard=true \\ -Dpermissive-script-security.enabled=true \\ -Dhudson.footerURL=https://jenkins.marslo.com \\ -Djenkins.slaves.NioChannelSelector.disabled=true \\ -Djenkins.slaves.JnlpSlaveAgentProtocol3.enabled=false \\ -Dhudson.model.ParametersAction.keepUndefinedParameters=true \\ -Djenkins.security.ClassFilterImpl.SUPPRESS_WHITELIST=true \\ -Dhudson.security.ArtifactsPermission=true \\ -Dhudson.security.LDAPSecurityRealm.groupSearch=true \\ -Dhudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID=true \\ -Dcom.cloudbees.workflow.rest.external.ChangeSetExt.resolveCommitAuthors=true \\ -Dhudson.plugins.active_directory.ActiveDirectorySecurityRealm.forceLdaps=false \\ -Dhudson.model.DirectoryBrowserSupport.CSP=\\\"sandbox allow-same-origin allow-scripts; default-src 'self'; script-src * 'unsafe-eval'; img-src *; style-src * 'unsafe-inline'; font-src *;\\\" \\ \" \\ --env JNLP_PROTOCOL_OPTS=\"-Dorg.jenkinsci.remoting.engine.JnlpProtocol3.disabled=false\" \\ --volume /opt/JENKINS_HOME:/var/jenkins_home \\ --volume /var/run/docker.sock:/var/run/docker.sock \\ jenkins/jenkins:latest backup the docker volume $ docker run --rm \\ -v jenkins_home:/var/jenkins_home \\ -v $(pwd):/backup \\ ubuntu \\ tar cvf /backup/backup.tar /var/jenkins_home running docker images as services $ cat /etc/systemd/system/docker-jenkins.service [Unit] Description=Jenkins [Service] SyslogIdentifier=docker-jenkins ExecStartPre=-/usr/bin/docker create -m 0b -p 8080:8080 -p 50000:50000 --restart=always --name jenkins jenkins/jenkins:lts-jdk11 ExecStart=/usr/bin/docker start -a jenkins ExecStop=-/usr/bin/docker stop --time=0 jenkins [Install] WantedBy=multi-user.target $ sudo systemctl daemon-reload $ sudo systemctl enable docker-jenkins $ sudo systemctl start docker-jenkins # check log $ sudo journalctl -u docker-jenkins -f in kubernetes reference: official yaml official sa yaml $ cat for nginx ingress--- apiVersion: extensions/v1beta1 kind: Ingress metadata: name: jenkins namespace: devops annotations: kubernetes.io/ingress.class: \"nginx\" nginx.ingress.kubernetes.io/secure-backends: \"true\" nginx.ingress.kubernetes.io/backend-protocol: \"HTTP\" kubernetes.io/ingress.allow-http: \"false\" spec: tls: - hosts: - jenkins.mysite.com secretName: mysite-certs rules: - host: jenkins.mysite.com http: paths: - path: backend: serviceName: jenkins servicePort: 8080 via helm [!TIP] How to install a Jenkins instance with Helm OctopusSamples/jenkins-complete-image $ helm repo add jenkins https://charts.jenkins.io $ helm repo update $ helm upgrade --install myjenkins jenkins/jenkins $ kubectl exec --namespace default \\ -it svc/myjenkins \\ -c jenkins -- /bin/cat /run/secrets/chart-admin-password && echo forward port $ kubectl --namespace default port-forward svc/myjenkins 8080:8080 show Load Balancer $ helm show values jenkins/jenkins ... controller: serviceType: LoadBalancer ... upgrade $ helm upgrade --install -f values.yaml myjenkins jenkins/jenkins get info $ kubectl get svc --namespace default myjenkins --template \"{{ range (index .status.loadBalancer.ingress 0) }}{{ . }}{{ end }}\" a84aa6226d6e5496882cfafdd6564a35-901117307.us-west-1.elb.amazonaws.com $ kubectl get pods NAME READY STATUS RESTARTS AGE java-9-k0hmj-vcvdz-wknh4 0/1 ContainerCreating 0 1s myjenkins-0 2/2 Running 0 49m customizing installing additional plugins ... controller: additionalPlugins: - octopusdeploy:3.1.6 ... customizing jenkins docker image ... controller: image: \"docker.io/mcasperson/myjenkins\" tag: \"latest\" installPlugins: false ... adding jenkins agents ... agent: podName: default customJenkinsLabels: default resources: limits: cpu: \"1\" memory: \"2048Mi\" ... defines a second pod template... agent: podName: default customJenkinsLabels: default resources: limits: cpu: \"1\" memory: \"2048Mi\" additionalAgents: maven: podName: maven customJenkinsLabels: maven image: jenkins/jnlp-agent-maven tag: latest ... jenkinsfilepipeline { agent { kubernetes { inheritFrom 'maven' } } // ... } backup jenkins home $ kubectl exec -c jenkins myjenkins-0 -- tar czf /tmp/backup.tar.gz /var/jenkins_home $ kubectl cp -c jenkins myjenkins-0:/tmp/backup.tar.gz ./backup.tar.gz build Jenkins docker image [!TIP] jenkins-complete-image/Dockerfile FROM jenkins/jenkins:lts-jdk11 USER root RUN apt update && \\ apt install -y --no-install-recommends gnupg curl ca-certificates apt-transport-https && \\ curl -sSfL https://apt.octopus.com/public.key | apt-key add - && \\ sh -c \"echo deb https://apt.octopus.com/ stable main > /etc/apt/sources.list.d/octopus.com.list\" && \\ apt update && apt install -y octopuscli RUN jenkins-plugin-cli --plugins octopusdeploy:3.1.6 kubernetes:1.29.2 workflow-aggregator:2.6 git:4.7.1 configuration-as-code:1.52 USER jenkins run Jenkins API out of Jenkins references: * Jenkins API * Jenkins API - how to trigger a Jenbkins job programmatically * Jenkins REST Plugin jenkinsci/java-client-api cdancy/jenkins-rest Dependency management with Grape Hooking into the Jenkins (Hudson) API, Part 1 Hooking into the Jenkins (Hudson) API, Part 2 kellyrob99/Jenkins-api-tour Where to download hudson library? XmlPullParserException thrown when trying to run groovy script from within a Jenkins job How do I Import a Jenkins plugins in Groovyscript? How to import the jenkins-api in Groovy? What are the Java arguments for proxy authorization? Dependencies and Class Loading javadoc Package hudson.util Package hudson.model mvnrepository.com org.eclipse.hudson.main » hudson-core org.jenkins-ci.main » jenkins-core Pipeline: Job : org.jenkins-ci.plugins.workflow » workflow-job Pipeline: Groovy : org.jenkins-ci.plugins.workflow » workflow-cps Pipeline: API : org.jenkins-ci.plugins.workflow » workflow-api Pipeline: Nodes and Processes : org.jenkins-ci.plugins.workflow » workflow-durable-task-step Pipeline: Parent : org.jenkins-ci.plugins.workflow » workflow-pom RESTEasy JAX RS Implementation : org.jboss.resteasy » resteasy-jaxrs RESTEasy Jackson 2 Provider : org.jboss.resteasy » resteasy-jackson2-provider javax/ws/rs JAX RS API : javax.ws.rs » javax.ws.rs com/clarolab maven central maven.glassfish.org repo.jenkins-ci.org source code jenkins/core/src/main/java/jenkins/model/Jenkins.java more JAX-RS @GrabResolver(name='jenkins', root='https://repo.jenkins-ci.org/public/') @Grapes([ @Grab(group='org.jenkins-ci.main', module='jenkins-core', version='2.167') ]) import hudson.model.* or@GrabResolver(name='jenkins', root='https://repo.jenkins-ci.org/public/') @Grab(group='org.jenkins-ci.main', module='jenkins-core', version='2.377') jenkins-core @GrabResolver(name='jenkins', root='https://repo.jenkins-ci.org/releases') @Grab(group='org.jenkins-ci.main', module='jenkins-core', version='2.377') import hudson.Util println Util.XS_DATETIME_FORMATTER.format( new Date() ) result2022-11-23T13:39:34Z org.jenkinsci.plugins.workflow // Groovy Version: 3.0.13 JVM: 11.0.15.1 @GrabResolver(name='jenkins', root='https://repo.jenkins-ci.org/releases') @Grab(group='org.jenkins-ci.main', module='jenkins-core', version='2.377') @Grab(group='org.jenkins-ci.plugins.workflow', module='workflow-job', version='1254.v3f64639b_11dd') @Grab(group='org.jenkins-ci.plugins.workflow', module='workflow-basic-steps', version='991.v43d80fea_ff66', scope='test') @Grab(group='org.jenkins-ci.plugins.workflow', module='workflow-api', version='1192.v2d0deb_19d212') import jenkins.model.Jenkins import hudson.model.Job import hudson.Util import org.jenkinsci.plugins.workflow.job.WorkflowJob import org.jenkinsci.plugins.workflow.flow.BlockableResume String rootUrl = 'https://my.jenkins.com' Map jobs = jenkins.getJobs() println jobs // output // Caught: groovy.lang.MissingPropertyException: No such property: jenkins for class: jenkins-job com.cdancy.jenkins.rest.JenkinsClient @GrabResolver(name='jenkins', root='https://repo.jenkins-ci.org/releases') @Grab(group='org.jenkins-ci.main', module='jenkins-core', version='2.377') @Grab(group='org.jenkins-ci.plugins.workflow', module='workflow-api', version='1200.v8005c684b_a_c6') @Grab(group='org.jenkins-ci.plugins.workflow', module='workflow-job', version='1254.v3f64639b_11dd') @Grab(group='org.jenkins-ci.plugins.workflow', module='workflow-step-api', version='639.v6eca_cd8c04a_a_') @Grab(group='javax.ws', module='rs', version='2.0.1') @Grab(group='io.github.cdancy', module='jenkins-rest', version='1.0.2') import jenkins.model.Jenkins import hudson.Util import hudson.model.Job import org.jenkinsci.plugins.workflow.job.WorkflowJob import com.cdancy.jenkins.rest.JenkinsClient String jenkinsUrl = 'https://my.jenkins.com' String userName = 'admin' String password = 'admin' JenkinsClient client = JenkinsClient.builder() .endPoint( jenkinsUrl ) .credentials( \"${userName}:${password}\" ) .build(); println client.getClass() println client.api().systemApi().systemInfo().getClass() println client.api().getClass() // Groovy Version: 3.0.13 JVM: 11.0.15.1 // output // class com.cdancy.jenkins.rest.JenkinsClient // class com.cdancy.jenkins.rest.domain.system.AutoValue_SystemInfo // class com.sun.proxy.$Proxy68 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/config/config.html":{"url":"jenkins/config/config.html","title":"config","keywords":"","body":" upgrading jenkins java configuration threadDump agent Mailing format Properties in Jenkins Core for JAVA_OPTS System Properties Configuring HTTP tips references: Jenkins Features Controlled with System Properties * How to Setup Jenkins Build Agents on Kubernetes Pods Quick and Simple — How to Setup Jenkins Distributed (Master-Slave) Build on Kubernetes [stable/jenkins] Add Custom Trusted CA certificates How to install a Jenkins instance with Helm helm-charts/charts/jenkins/README.md docker/README.md InfoSec812/pipeline-libraries.groovy to get groovy version: println GroovySystem.version official yml jenkins-sa.yaml jenkins-volume.yaml jenkins-deployment.yaml jenkins-service.yaml upgrading jenkins jenkins 2.357 requires Java 11 Beginning with Jenkins 2.357 (released on June 28, 2022) and the forthcoming September LTS release, Jenkins requires Java 11. Additionally, beginning with Jenkins 2.355 (released on June 14, 2022) and Jenkins 2.346.1 LTS (released on June 22, 2022), Jenkins supports Java 17. Plugins have already been prepared in JENKINS-68446. Use the Plugin Manager to upgrade all plugins before and after upgrading to Jenkins 2.357. refrences: Upgrading Jenkins Java version from 8 to 11 JVM version on agents Java requirements Downloading and running Jenkins in Docker ** Prepare Jenkins for Support JVM Recommended Arguments Upgrading to Java 11 or 17 Setting JVM Options for Application Servers-Xms1024m -Xmx2048m -XX:PermSize=32m -XX:MaxPermSize=512m -Xss2m Java Documentations get Java version from Jenkins master println \" >> jenkins.rootUrl: ${Jenkins.instance.rootUrl} \" println \" >> jenkins.version: ${Jenkins.instance.version} \" System.getProperties().findAll { k, v -> k.toLowerCase().contains( 'java' ) }.each { k, v -> println \" >>> ${k} ~> ${v} \" } \"DONE\" result >> jenkins.rootUrl: https://my-dev.jenkins.com/ >> jenkins.version: 2.360 >>> java.specification.version ~> 11 >>> java.runtime.version ~> 11.0.15+10 >>> java.class.path ~> /usr/share/jenkins/jenkins.war >>> java.vm.vendor ~> Eclipse Adoptium >>> javamelody.maven-repositories ~> /var/jenkins_home/.m2/repository,http://repo1.maven.org/maven2,http://repo.jenkins-ci.org/public >>> java.runtime.name ~> OpenJDK Runtime Environment >>> javamelody.gzip-compression-disabled ~> true >>> java.vendor.url ~> https://adoptium.net/ >>> javamelody.About Monitoring ~> https://plugins.jenkins.io/monitoring/ >>> java.vm.specification.version ~> 11 >>> java.vm.name ~> OpenJDK 64-Bit Server VM >>> java.vendor.version ~> Temurin-11.0.15+10 >>> javamelody.http-transform-pattern ~> /\\d+/|(?>> sun.java.launcher ~> SUN_STANDARD >>> sun.java.command ~> /usr/share/jenkins/jenkins.war >>> java.vendor.url.bug ~> https://github.com/adoptium/adoptium-support/issues >>> javamelody.system-actions-enabled ~> true >>> java.io.tmpdir ~> /tmp >>> javamelody.storage-directory ~> //var/jenkins_home/monitoring >>> java.version ~> 11.0.15 >>> javamelody.custom-reports ~> Jenkins Info,About Monitoring >>> java.specification.vendor ~> Oracle Corporation >>> java.vm.specification.name ~> Java Virtual Machine Specification >>> java.awt.printerjob ~> sun.print.PSPrinterJob >>> java.version.date ~> 2022-04-19 >>> java.home ~> /opt/java/openjdk >>> java.vm.compressedOopsMode ~> Zero based >>> java.library.path ~> /usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib >>> java.specification.name ~> Java Platform API Specification >>> java.vm.specification.vendor ~> Oracle Corporation >>> java.vm.info ~> mixed mode >>> java.vendor ~> Eclipse Adoptium >>> java.vm.version ~> 11.0.15+10 >>> java.awt.graphicsenv ~> sun.awt.X11GraphicsEnvironment >>> java.awt.headless ~> true >>> javamelody.csrf-protection-enabled ~> true >>> java.class.version ~> 55.0 >>> javamelody.Jenkins Info ~> /systemInfo >>> javamelody.no-database ~> true Result: DONE get Java version from Jenkins agent println \" >> jenkins.rootUrl: ${Jenkins.instance.rootUrl}\" println \" >> jenkins.version: ${Jenkins.instance.version}\" Jenkins.instance.nodes.each { agent -> println \" >> agent: ${agent.displayName}\" agent.computer.getSystemProperties().findAll{ k, v -> k.toLowerCase().contains( 'java' ) }.each { k, v -> println \" ~~> ${k} -> ${v}\" } } result>> jenkins.rootUrl: https://my-dev.jenkins.com/ >> jenkins.version: 2.360 >> agent: yaml-15-x946w-s48xb-jqkn0 ~~> java.awt.graphicsenv -> sun.awt.X11GraphicsEnvironment ~~> java.awt.printerjob -> sun.print.PSPrinterJob ~~> java.class.path -> /usr/share/jenkins/slave.jar ~~> java.class.version -> 55.0 ~~> java.home -> /usr/lib/jvm/java-11-openjdk-amd64 ~~> java.io.tmpdir -> /tmp ~~> java.library.path -> /usr/java/packages/lib:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib ~~> java.runtime.name -> OpenJDK Runtime Environment ~~> java.runtime.version -> 11.0.15+10-Ubuntu-0ubuntu0.18.04.1 ~~> java.specification.name -> Java Platform API Specification ~~> java.specification.vendor -> Oracle Corporation ~~> java.specification.version -> 11 ~~> java.vendor -> Private Build ~~> java.vendor.url -> Unknown ~~> java.vendor.url.bug -> Unknown ~~> java.version -> 11.0.15 ~~> java.version.date -> 2022-04-19 ~~> java.vm.compressedOopsMode -> Zero based ~~> java.vm.info -> mixed mode, sharing ~~> java.vm.name -> OpenJDK 64-Bit Server VM ~~> java.vm.specification.name -> Java Virtual Machine Specification ~~> java.vm.specification.vendor -> Oracle Corporation ~~> java.vm.specification.version -> 11 ~~> java.vm.vendor -> Private Build ~~> java.vm.version -> 11.0.15+10-Ubuntu-0ubuntu0.18.04.1 ~~> javamelody.no-database -> true ~~> sun.java.command -> hudson.remoting.jnlp.Main -headless -tunnel 1.2.3.4:12345 -url https://my-dev.jenkins.com/ -workDir /home/devops ae62043877285d6ba763f254ce041f64674ce2c4768d9872621af0ea65c07b2d yaml-15-x946w-s48xb-jqkn0 ~~> sun.java.launcher -> SUN_STANDARD Result: [KubernetesSlave name: yaml-15-x946w-s48xb-jqkn0] or via RemotingDiagnostics import hudson.util.RemotingDiagnostics import jenkins.model.Jenkins println \" >> jenkins.rootUrl: ${Jenkins.instance.rootUrl}\" println \" >> jenkins.version: ${Jenkins.instance.version}\" String result String javaVersion = \"\"\" def stdout = new StringBuffer() def stderr = new StringBuffer() \"java -version\".execute().waitForProcessOutput( stdout, stderr ) println stderr \"\"\" Jenkins.instance.nodes.each { agent -> println \">> agent: ${agent.displayName}\" result = RemotingDiagnostics.executeGroovy( javaVersion.trim(), agent.channel ) .tokenize( '\\n' ) .collect{ \"\\t${it}\" } .join( '\\n' ) } println \">>> java version: \\n${result}\" result>> jenkins.rootUrl: https://my-dev.jenkins.com/ >> jenkins.version: 2.360 >> agent: yaml-15-x946w-s48xb-jqkn0 >>> java version: openjdk version \"11.0.15\" 2022-04-19 OpenJDK Runtime Environment (build 11.0.15+10-Ubuntu-0ubuntu0.18.04.1) OpenJDK 64-Bit Server VM (build 11.0.15+10-Ubuntu-0ubuntu0.18.04.1, mixed mode, sharing) java configuration [!TIP|label:official recommended] ** A. Java Configuration ** Memory problem: 'unable to create new native thread' * Too many open files * Supported Java 8 arguments * Supported Java 11 arguments ** Java Heap settings Best Practice Minimum and maximum heap sizes Enterprise JVM Administration and Jenkins Performance CloudBees Jenkins JVM troubleshooting How to Troubleshoot and Address Jenkins Startup Performances How to generate a thread dump? Jenkins : Obtaining a thread dump Required Data: Jenkins Hang Issue On Linux Upgrading to Jenkins 2.176.2 : Improved CSRF protection JENKINS-71273: Gerrit Trigger fails to connect Gerrit 2.14 - com.jcraft.jsch.JSchException: verify: false-Djsch.client_pubkey=\"ssh-ed25519,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,rsa-sha2-512,rsa-sha2-256,ssh-rsa\" -Djsch.server_host_key=\"ssh-ed25519,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,rsa-sha2-512,rsa-sha2-256,ssh-rsa\" java 11 [!NOTE] Omitting -XX:+UnlockDiagnosticVMOptions or -XX:+UnlockExperimentalVMOptions might cause your instance to fail to startup. To increase GC logs to a longer period of time, we suggest increasing the value of the arguments -Xlog option filecount=2 and/or filesize=100M and as ultimate option use file=${LOGDIR}/gc-%t.log instead of file=${LOGDIR}/gc.log. With the parameter %t, the JVM create a new set of GC files each time that the instance is restarted. It is well known that when the GC log folder gets big enough in terms of size, the support bundle might produce performance issues in the instance given that it needs to compress all of them. -XX:+AlwaysPreTouch -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=${LOGDIR} -XX:+UseG1GC -XX:+UseStringDeduplication -XX:+ParallelRefProcEnabled -XX:+DisableExplicitGC -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -Xlog:gc*=info,gc+heap=debug,gc+ref*=debug,gc+ergo*=trace,gc+age*=trace:file=${LOGDIR}/gc.log:utctime,pid,level,tags:filecount=2,filesize=100M -XX:ErrorFile=${LOGDIR}/hs_err_%p.log -XX:+LogVMOutput -XX:LogFile=${LOGDIR}/jvm.log # Heap setting for CloudBees CI on modern cloud platforms: # -XX:InitialRAMPercentage=50.0 -XX:MaxRAMPercentage=50.0 # Heap setting for CloudBees CI on traditional platforms: # Heap Size `-Xmx` and `-Xms` should be set to the same value, and determined by following the above section \"JVM Heap Size\" java 8 [!NOTE] To increase GC logs to a longer period of time, we suggest increasing the value of the arguments -XX:GCLogFileSize and -XX:NumberOfGCLogFiles and as ultimate option use -Xloggc:${LOGDIR}/gc-%t.log instead of -Xloggc:${LOGDIR}/gc.log. With the parameter %t, the JVM create a new set of GC files each time that the instance is restarted. It is well known that when the GC log folder gets big enough in terms of size, the support bundle might produce performance issues in the instance given that it needs to compress all of them. -Dhudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID=true -Djenkins.model.Jenkins.logStartupPerformance=true -Xms192G -Xmx192G -XX:+AlwaysPreTouch -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/var/jenkins_home/logs -XX:+UseG1GC -XX:+UseStringDeduplication -XX:+ParallelRefProcEnabled -XX:+DisableExplicitGC -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -verbose:gc -XX:+PrintGC -XX:+PrintGCDetails -XX:ErrorFile=/var/jenkins_home/logs/hs_err_%p.log -XX:+LogVMOutput -XX:LogFile=/var/jenkins_home/logs/jvm.log -XX:InitialRAMPercentage=50.0 -XX:MaxRAMPercentage=50.0 -Xlog:gc*=info,gc+heap=debug,gc+ref*=debug,gc+ergo*=trace,gc+age*=trace:file=/var/jenkins_home/logs/gc-%t.log:utctime,pid,level,tags:filecount=2,filesize=100M more info$ docker run --rm openjdk:8-jre java -XX:MaxRAMPercentage=75 -help 2>&1 | head Improperly specified VM option 'MaxRAMPercentage=75' Error: Could not create the Java Virtual Machine. Error: A fatal exception has occurred. Program will exit. $ docker run --rm openjdk:8-jre java -XX:MaxRAMPercentage=75.0 -help 2>&1 | head Usage: java [-options] class [args...] (to execute a class) or java [-options] -jar jarfile [args...] (to execute a jar file) where options include: -d32 use a 32-bit data model if available -d64 use a 64-bit data model if available -server to select the \"server\" VM The default VM is server, because you are running on a server-class machine. -XX:+AlwaysPreTouch -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=${LOGDIR} -XX:+UseG1GC -XX:+UseStringDeduplication -XX:+ParallelRefProcEnabled -XX:+DisableExplicitGC -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -verbose:gc -Xloggc:${LOGDIR}/gc.log -XX:NumberOfGCLogFiles=2 -XX:+UseGCLogFileRotation -XX:GCLogFileSize=100m -XX:+PrintGC -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintHeapAtGC -XX:+PrintGCCause -XX:+PrintTenuringDistribution -XX:+PrintReferenceGC -XX:+PrintAdaptiveSizePolicy -XX:ErrorFile=${LOGDIR}/hs_err_%p.log -XX:+LogVMOutput -XX:LogFile=${LOGDIR}/jvm.log # Heap setting for CloudBees CI on modern cloud platforms: # -XX:InitialRAMPercentage=50.0 -XX:MaxRAMPercentage=50.0 # Heap setting for CloudBees CI on traditional platforms: # Heap Size `-Xmx` and `-Xms` should be set to the same value, and determined by following the above section \"JVM Heap Size\" threadDump [!NOTE] visit via GUI: https://.domain.com/threadDump Using Thread Dumps How to generate a thread dump? Jenkins : Obtaining a thread dump agent ssh agent dockerfile JVM 11 for windows windowsservercore-ltsc2019 nanoserver-ltsc2019 alpine bullseye Launching inbound TCP agents Connecting inbound agents $ sudo update-alternatives --remove java /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java Mailing format Show the logs after building Format:${BUILD_LOG, maxLines, escapeHtml} maxLines: 250 For example:${BUILD_LOG, maxLines=8000, escapeHtml=true} Properties in Jenkins Core for JAVA_OPTS disable the true Disabling CSRF Protection reference: CSRF Protection -Dhudson.security.csrf.GlobalCrumbIssuerConfiguration.DISABLE_CSRF_PROTECTION=true CSRF protection tokens did not expire SECURITY-626 : Scripts that obtain a crumb using the /crumbIssuer/api URL will now fail to perform actions protected from CSRF unless the scripts retain the web session ID in subsequent requests. -Dhudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID=true enable crumb proxy compatibility -Djenkins.model.Jenkins.crumbIssuerProxyCompatibility=true change workspace name # default -Djenkins.model.Jenkins.workspaceDirName='workspace' workspace path # default -Djenkins.model.Jenkins.workspacesDir=\"${JENKINS_HOME}/workspace/${ITEM_FULL_NAME}\" a cache for UserDetails should be valid # default 2 mins -Djenkins.security.UserDetailsCache.EXPIRE_AFTER_WRITE_SEC=120 copyArtifacts v1.29 : JENKINS-14999 : Support for QueueItemAuthenticator -Dhudson.security.ArtifactsPermission=true Unauthorized view fragment access # to disable the feature -Djenkins.security.stapler.StaplerDispatchValidator.disabled=false System Properties java.lang.System java.util.Properties jenkins.util.SystemProperties Controlling features of Hudson using system properties set property System.setProperty('org.apache.commons.jelly.tags.fmt.timeZone', 'Asia/Shanghai') System.setProperty('user.timezone', 'Asia/Shanghai') setup user.timezone in Jenkins println( System.getProperty('user.timezone') ); System.setProperty('user.timezone', 'Asia/Shanghai'); println( System.getProperty('user.timezone') ) enable crumb proxy compatibility System.setProperty('jenkins.model.Jenkins.crumbIssuerProxyCompatibility', 'true') System.getProperty('jenkins.model.Jenkins.crumbIssuerProxyCompatibility') setup CSRF protection tokens did not expire for SECURITY-626 System.setProperty('hudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID', 'true') System.getProperty('hudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID') get property get all properties System.getProperties() or System.getProperties().each { k, v -> println \" >>> ${k} ~> ${v} \" } get system environment : System.getenv()System.getenv().each { k, v -> println \" >>> ${k} ~> ${v} \" } i.e.:System.getenv().JAVA_OPTS Configuring HTTP remote configuration information: ${PROTOCOL_FULLY_QUALIFIED_NAME}.disabled: where PROTOCOL_FULLY_QUALIFIED_NAME equals PROTOCOL_HANDLER_CLASSNAME without the Handler suffix. description hudson.remoting.FlightRecorderInputStream.BUFFER_SIZE : Size (in bytes) of the flight recorder ring buffer used for debugging remoting issues hudson.remoting.Launcher.pingIntervalSec : Seconds between ping checks to monitor health of agent nodes; 0 to disable ping | hudson.remoting.Launcher.pingTimeoutSec : If ping of agent node takes longer than this, consider it dead; 0 to disable ping | hudson.remoting.RemoteClassLoader.force : Class name String. Forces loading of the specified class name on incoming requests. Works around issues like JENKINS-19445 | hudson.remoting.Engine.socketTimeout : Socket read timeout in milliseconds. If timeout happens and the failOnSocketTimeoutInReader property is true, the channel will be interrupted. | hudson.remoting.SynchronousCommandTransport.failOnSocketTimeoutInReader : Boolean flag. Enables the original aggressive behavior, when the channel reader gets interrupted by any SocketTimeoutException | hudson.remoting.ExportTable.unexportLogSize : Defines number of entries to be stored in the unexport history, which is being analyzed during the invalid object ID analysis. | ${PROTOCOL_FULLY_QUALIFIED_NAME}.disabled : Boolean flag, which allows disabling particular protocols in remoting. Property example: org.jenkinsci.remoting.engine.JnlpProtocol3.disabled | org.jenkinsci.remoting.nio.NioChannelHub.disabled : Boolean flag to disable NIO-based socket connection handling, and switch back to classic IO. Used to isolate the problem. | org.jenkinsci.remoting.engine.JnlpAgentEndpointResolver.protocolNamesToTry : If specified, only the protocols from the list will be tried during the connection. The option provides protocol names, but the order of the check is defined internally and cannot be changed. | System property Default value Since Jenkins version(s) Related issues hudson.remoting.FlightRecorderInputStream.BUFFER_SIZE 1048576 2.41 1.563 JENKINS-22734 hudson.remoting.Launcher.pingIntervalSec 0 since 2.60, 600 before 2.0 1.367 JENKINS-35190 hudson.remoting.Launcher.pingTimeoutSec 240 2.0 1.367 N/A hudson.remoting.RemoteClassLoader.force null 2.58 2.4 JENKINS-19445 (workaround) hudson.remoting.Engine.socketTimeout 30 minutes 2.58 2.4 JENKINS-34808 hudson.remoting.SynchronousCommandTransport.failOnSocketTimeoutInReader false 2.60 TODO JENKINS-22722 hudson.remoting.ExportTable.unexportLogSize 1024 2.40 ? JENKINS-20707 ${PROTOCOL_FULLY_QUALIFIED_NAME}.disabled false 2.59 2.4 JENKINS-34819 org.jenkinsci.remoting.nio.NioChannelHub.disabled false 2.62.3 TODO JENKINS-39290 org.jenkinsci.remoting.engine.JnlpAgentEndpointResolver.protocolNamesToTry false TODO TODO JENKINS-41730 tips Add Users to Jenkins with \"Allow users to sign up\" Disabled $JENKINS_URL/securityRealm/addUser sa.yml [!NOTE|label:references:] How To Setup Jenkins On Kubernetes Cluster – Beginners Guide How to Setup Jenkins Build Agents on Kubernetes Pods sample 1 --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: jenkins-admin rules: - apiGroups: [\"\"] resources: [\"*\"] verbs: [\"*\"] --- apiVersion: v1 kind: ServiceAccount metadata: name: jenkins-admin namespace: devops-tools --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: jenkins-admin roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: jenkins-admin subjects: - kind: ServiceAccount name: jenkins-admin namespace: devops-tools sample 2 apiVersion: v1 kind: ServiceAccount metadata: name: jenkins-admin namespace: devops-tools --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: jenkins namespace: devops-tools labels: \"app.kubernetes.io/name\": 'jenkins' rules: - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/exec\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/log\"] verbs: [\"get\",\"list\",\"watch\"] - apiGroups: [\"\"] resources: [\"secrets\"] verbs: [\"get\"] --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: jenkins-role-binding namespace: devops-tools roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: jenkins subjects: - kind: ServiceAccount name: jenkins-admin namespace: devops-tools ssl [!NOTE|label:references:] SSL Certificates Troubleshooting How to install a new SSL certificate on Traditional Platforms? jenkins-scripts/scriptler/checkSSLConnection.groovy JAVA_OPT: Jenkins Features Controlled with System Properties $ kubectl exec -it devops-jenkins-0 -- /bin/bash $ jrunscript -Djavax.net.ssl.trustStore=/opt/java/openjdk/lib/security/cacerts -Djavax.net.ssl.trustStorePassword=changeit -e \"println(new java.net.URL(\\\"https://k8s-api.example.com:16443\\\").openConnection().getResponseCode())\" Warning: Nashorn engine is planned to be removed from a future JDK release java.lang.RuntimeException: javax.net.ssl.SSLHandshakeException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target at jdk.scripting.nashorn/jdk.nashorn.internal.runtime.ScriptRuntime.apply(ScriptRuntime.java:531) ... $ mkdir -p /var/jenkins_home/cacerts-share $ cp /opt/java/openjdk/lib/security/cacerts /var/jenkins_home/cacerts-share/cacerts $ chmod 644 /var/jenkins_home/cacerts-share/cacerts $ keytool -import -noprompt -trustcacerts -alias k8s-api -keystore /var/jenkins_home/cacerts-share/cacerts -file /run/secrets/additional/devops_kubernetes_api.crt -storepass changeit Certificate was added to keystore $ jrunscript -Djavax.net.ssl.trustStore=/var/jenkins_home/cacerts-share/cacerts -Djavax.net.ssl.trustStorePassword=changeit -e \"println(new java.net.URL(\\\"https://k8s-api.example.com:16443\\\").openConnection().getResponseCode())\" Warning: Nashorn engine is planned to be removed from a future JDK release 403 full step$ keytool -printcert -rfc -sslserver ssdfw-k8s-api.marvell.com:16443 > /run/secrets/additional/devops_kubernetes_api.crt # or $ echo -n | openssl s_client -connect ssdfw-k8s-api.marvell.com:16443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > /run/secrets/additional/devops_kubernetes_api.crt Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/config/windows.html":{"url":"jenkins/config/windows.html","title":"windows","keywords":"","body":" create an agent in Jenkins install install as a service start service remove service winsw prepare install and start agent service stop services Q&A a windows service must first be installed ( using installutil.exe ) references: how to create an agent node in jenkins Jenkins : Installing Jenkins as a Windows service Launch inbound agent via Windows Scheduler installing a jenkins agent on windows (via winsw) Jenkins Tutorials : how to install jenkins agent on windows How to install Windows agents as a service? Managing agents * enable open-ssh in windows : Configure Cygwin’s port of OpenSSH others Upgrading Jenkins Java version from 8 to 11 Jenkins Remoting Upgrading Windows masters and agents for 2.60.1 create an agent in Jenkins install install as a service reference windows agent: How to create an agent in Linux from console How to Install Several Windows Agents as a Service? Launch Java Web Start slave agent via Windows Scheduler Step by step guide to set up master and agent machines on Windows Jenkins : Installing Jenkins as a Windows service windows services: sc.exe query start service [!DANGER] for v2.0 removed: Stop supporting .NET Framework 2.0 for launching agents, 4.0 is the minimum required version (#43) @NextTurn Windows Support Policy in Jenkins New features and improvements JENKINS-60005, JENKINS-61862 - Switch to the .NET Framework 4.0 for WinSW distribution (#43) @NextTurn Use built-in WinSW features for permission elevation ans strong cryptography (#43) @NextTurn open the node connection page -> Launch -> File -> Install as a server setup jenkins-slave.exe jenkins jenkins the windows agent for jenkins https://jenkins.sample.com C:\\Program Files\\Java\\jdk-11.0.16.1\\bin\\java.exe -Xrs -jar \"%BASE%\\agent.jar\" -jnlpUrl https://jenkins.sample.com/computer/win-server-01/slave-agent.jnlp -secret c**************************************************************1 --> rotate %BASE%\\jenkins_agent.pid 5000 false install and start service by cmd -> sc.exe [!NOTE] references: windows_slave_installer jenkins-slave.xml jenkins-slave.exe.config Messages.properties sc.exe reference Create a user-defined service use instsrv instead of sc.exe: Run path\\to\\instsrv \"Jenkins Slave\" path\\to\\srvany.exe Run regedit Create HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Jenkins Slave\\Parameters Add the following registry keys: HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Jenkins Slave\\Description=\"Jenkins Continuous Integration Slave\" HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Jenkins Slave\\Parameters\\AppParameters=\"-jar path\\to\\slave.jar -jnlpUrl http://jenkins-master:8080/computer/jenkins-slave/slave-agent.jnlp\" HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Jenkins Slave\\Parameters\\Application=\"C:\\WINDOWS\\system32\\java.exe\" [!TIP] Configure Slave Service to Run as Domain User (Windows Server 2008 R2 x64)) regex: HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurePipeServers\\winreg Install Slave as a Windows service (cmd version))sc.exe create \"\" start= auto binPath= \"\" DisplayName= \"\" is the name of the registry key that will define the service (this will not be displayed) display name is the label that will identify the service in the service manager interface also can be checked in Computer\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\ Launch Java Web Start slave agent via Windows Scheduler Uninstallation C:\\WINDOWS\\system32> sc.exe create \"jenkins\" start= auto binPath= \"E:\\devops\\jenkins-slave.exe\" DisplayName= \"jenkins\" [SC] CreateService SUCCESS C:\\WINDOWS\\system32> sc description jenkins \"the windows agent for jenkins >\" [SC] ChangeServiceConfig2 SUCCESS C:\\WINDOWS\\system32> sc start jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 2 START_PENDING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 PID : 27784 FLAGS : service configuration C:\\WINDOWS\\system32> sc config jenkins start= disabled [SC] ChangeServiceConfig SUCCESS C:\\WINDOWS\\system32> sc query jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 4 RUNNING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 list all services C:\\WINDOWS\\system32> sc queryex type=service state=all | find /i \"SERVICE_NAME:\" SERVICE_NAME: AJRouter SERVICE_NAME: ALG SERVICE_NAME: AppIDSvc SERVICE_NAME: Appinfo SERVICE_NAME: AppMgmt SERVICE_NAME: AppReadiness SERVICE_NAME: AppVClient SERVICE_NAME: AppXSvc SERVICE_NAME: AudioEndpointBuilder SERVICE_NAME: Audiosrv SERVICE_NAME: AxInstSV ... setup service remove service [!TIP] or remove HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\jenkins C:\\WINDOWS\\system32> sc stop jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 3 STOP_PENDING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 C:\\WINDOWS\\system32> sc delete jenkins [SC] DeleteService SUCCESS C:\\WINDOWS\\system32> taskkill /F /IM mmc.exe SUCCESS: The process \"mmc.exe\" with PID 19572 has been terminated. winsw references: winsw/winsw winsw release winsw installation guide prepare download agent.jar > curl -s -o j:\\jenkins\\agent.jar https://jenkins.sample.com/jnlpJars/agent.jar download winws.exe and rename references: WinSW v2.11.0 REM x64 > curl -s -o j:\\jenkins\\jenkins-agent.exe https://github.com/winsw/winsw/releases/download/v2.11.0/WinSW-x64.exe REM x64 > curl -s -o j:\\jenkins\\jenkins-agent.exe https://github.com/winsw/winsw/releases/download/v2.11.0/WinSW-x86.exe create xml references: Runaway Process Killer extension jvm 11 download XML configuration file YAML configuration file sample xml complete.xml jenkins.xml minimal shared-directory-mapper.xml examples sample-allOption.yml sample-allOptions.xml sample-minimal.xml) J:\\jenkins> cat > j:\\jenkins\\jenkins-agent.xml jenkins-agent jenkins-agent the jenkins agent process connect to https://jenkins.sample.com. C:\\Program Files\\Java\\jdk-11.0.16.1\\bin\\java.exe -jar %BASE%\\agent.jar -jnlpUrl https://jenkins.sample.com/computer/windows-agent/jenkins-agent.jnlp -secret f**************************************************************8 -workDir \"J:\\jenkins\" EOF [!TIP] tips on xml label : : 2022-11-30 06:31:38,022 INFO - Downloading: https://jenkins.sample.com/jnlpJars/agent.jar to J:\\jenkins\\agent.jar. failOnError=False install and start agent service references: CLI commands [!TIP] check available cli commands J:\\jenkins> jenkins-agent.exe --help A wrapper binary that can be used to host executables as Windows services Usage: winsw [] Missing arguments triggers the service mode Available commands: install install the service to Windows Service Controller uninstall uninstall the service start start the service (must be installed before) stop stop the service stopwait stop the service and wait until it's actually stopped restart restart the service restart! self-restart (can be called from child processes) status check the current status of the service test check if the service can be started and then stopped testwait starts the service and waits until a key is pressed then stops the service version print the version info help print the help info (aliases: -h,--help,-?,/?) Extra options: /redirect redirect the wrapper's STDOUT and STDERR to the specified file WinSW 2.11.0.0 More info: https://github.com/winsw/winsw Bug tracker: https://github.com/winsw/winsw/issues J:\\jenkins> jenkins-agent.exe install 2022-11-30 06:09:59,907 INFO - Installing service 'jenkins (jenkins)'... 2022-11-30 06:10:00,033 INFO - Service 'jenkins (jenkins)' was installed successfully. J:\\jenkins> sc query jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 1 STOPPED WIN32_EXIT_CODE : 1077 (0x435) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 REM start service J:\\jenkins> jenkins-agent.exe start 2022-11-30 06:11:26,118 INFO - Starting service 'jenkins (jenkins)'... 2022-11-30 06:11:27,510 INFO - Service 'jenkins (jenkins)' started successfully. J:\\jenkins> sc query jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 2 START_PENDING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 J:\\jenkins> sc query jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 4 RUNNING (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 2022-11-30 06:31:37,126 DEBUG - Starting WinSW in console mode 2022-11-30 06:31:37,166 INFO - Starting service 'jenkins (jenkins)'... 2022-11-30 06:31:37,903 DEBUG - Starting WinSW in service mode 2022-11-30 06:31:37,940 INFO - Service 'jenkins (jenkins)' started successfully. 2022-11-30 06:31:38,022 INFO - Downloading: https://jenkins.sample.com/jnlpJars/agent.jar to J:\\jenkins\\agent.jar. failOnError=False 2022-11-30 06:31:38,945 INFO - Skipped downloading unmodified resource 'https://jenkins.sample.com/jnlpJars/agent.jar' 2022-11-30 06:31:39,029 INFO - Starting C:\\Program Files\\Java\\jdk-11.0.16.1\\bin\\java.exe -jar agent.jar -jnlpUrl https://jenkins.sample.com/computer/windows-agent/jenkins-agent.jnlp -secret f**************************************************************8 -workDir \"J:\\jenkins\" 2022-11-30 06:31:39,066 INFO - Started process 4928 2022-11-30 06:31:39,079 DEBUG - Forwarding logs of the process System.Diagnostics.Process (java) to WinSW.RollingLogAppender 2022-11-30 06:31:44,302 DEBUG - Starting WinSW in console mode Nov 30, 2022 6:31:39 AM org.jenkinsci.remoting.engine.WorkDirManager initializeWorkDir INFO: Using J:\\jenkins\\remoting as a remoting work directory Nov 30, 2022 6:31:39 AM org.jenkinsci.remoting.engine.WorkDirManager setupLogging INFO: Both error and output logs will be printed to J:\\jenkins\\remoting Nov 30, 2022 6:31:40 AM hudson.remoting.jnlp.Main createEngine INFO: Setting up agent: sc-jenkins112 Nov 30, 2022 6:31:40 AM hudson.remoting.Engine startEngine INFO: Using Remoting version: 3044.vb_940a_a_e4f72e Nov 30, 2022 6:31:40 AM org.jenkinsci.remoting.engine.WorkDirManager initializeWorkDir INFO: Using J:\\jenkins\\remoting as a remoting work directory Nov 30, 2022 6:31:40 AM hudson.remoting.jnlp.Main$CuiListener status INFO: WebSocket connection open Nov 30, 2022 6:31:40 AM hudson.remoting.jnlp.Main$CuiListener status INFO: Connected WARNING: An illegal reflective access operation has occurred WARNING: Illegal reflective access by org.jenkinsci.plugins.envinject.service.EnvInjectMasterEnvVarsSetter to method java.lang.Class.getDeclaredFields0(boolean) WARNING: Please consider reporting this to the maintainers of org.jenkinsci.plugins.envinject.service.EnvInjectMasterEnvVarsSetter WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations WARNING: All illegal access operations will be denied in a future release stop services J:\\jenkins> jenkins-agent.exe stop 2022-11-30 06:15:28,194 INFO - Stopping service 'jenkins (jenkins)'... 2022-11-30 06:15:28,216 INFO - Service 'jenkins (jenkins)' stopped successfully. J:\\jenkins> sc query jenkins SERVICE_NAME: jenkins TYPE : 10 WIN32_OWN_PROCESS STATE : 1 STOPPED WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 Q&A a windows service must first be installed ( using installutil.exe ) [!TIP] references: Windows service start failure: Cannot start service from the command line or debugger [duplicate] Run a Windows Service as a console app How to: Install and uninstall Windows services Install using InstallUtil.exe utility C:\\WINDOWS\\system32> cd C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319 C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319> InstallUtil.exe J:\\jenkins\\jenkins-slave.exe Microsoft (R) .NET Framework Installation utility Version 4.8.3761.0 Copyright (C) Microsoft Corporation. All rights reserved. Running a transacted installation. Beginning the Install phase of the installation. See the contents of the log file for the J:\\jenkins\\jenkins-slave.exe assembly's progress. The file is located at J:\\jenkins\\jenkins-slave.InstallLog. Installing assembly 'J:\\jenkins\\jenkins-slave.exe'. Affected parameters are: logtoconsole = logfile = J:\\jenkins\\jenkins-slave.InstallLog assemblypath = J:\\jenkins\\jenkins-slave.exe No public installers with the RunInstallerAttribute.Yes attribute could be found in the J:\\jenkins\\jenkins-slav e.exe assembly. The Install phase completed successfully, and the Commit phase is beginning. See the contents of the log file for the J:\\jenkins\\jenkins-slave.exe assembly's progress. The file is located at J:\\jenkins\\jenkins-slave.InstallLog. Committing assembly 'J:\\jenkins\\jenkins-slave.exe'. Affected parameters are: logtoconsole = logfile = J:\\jenkins\\jenkins-slave.InstallLog assemblypath = J:\\jenkins\\jenkins-slave.exe No public installers with the RunInstallerAttribute.Yes attribute could be found in the J:\\jenkins\\jenkins-slav e.exe assembly. Remove InstallState file because there are no installers. The Commit phase completed successfully. The transacted install has completed. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/troubleshooting.html":{"url":"jenkins/troubleshooting.html","title":"troubleshooting","keywords":"","body":" troubleshooting tools thread dump other tools [!TIP|label:official recommended] Prepare Jenkins for Support CloudBees Jenkins JVM troubleshooting * Supported Java 8 arguments * Supported Java 11 arguments * collectPerformanceData Script Diagnosing Errors Tuning Jenkins GC For Responsiveness and Stability with Large Instances ** Java Heap settings Best Practice Minimum and maximum heap sizes How to Troubleshoot and Address Jenkins Startup Performances troubleshooting [!NOTE|label:references:] How to Troubleshoot and Address Jenkins Startup Performances Required Data: Jenkins Hang Issue On Linux collectPerformanceData Script collectPerformanceData.sh Understanding Thread Dumps fastthread.io gceasy.io What causes high CPU usage and how can I reduce it Unrecognized VM Option UseGCLogFileRotation GCLogFileSize=100m PrintGCDateStamps PrintGCCause PrintTenuringDistribution PrintReferenceGC PrintAdaptiveSizePolicy tools [!NOTE|label:tools] iostat nfsiostat nfsstat vmstatUnderstanding Thread DumpUnderstanding Thread Dumpss top top -H netstat jstack stap prepare $ apt update $ apt install sudo vim netstat net-tools sysstat nfs-common $ sudo systemctl start sysstat $ sudo systemctl enable sysstat $ cat /etc/cron.d/sysstat [!NOTE|label:tips for sar] if you wanted to check your memory usage instead, you could use the -r argument rather than -u$ sar -r 2 30 collectPerformanceData.sh $ curl -sO https://s3.amazonaws.com/cloudbees-jenkins-scripts/e206a5-linux/collectPerformanceData.sh $ chmod +x collectPerformanceData.sh $ sudo -u $JENKINS_USER sh collectPerformanceData.sh $JENKINS_PID 300 5 $ or $ bash collectPerformanceData.sh $JENKINS_PID 300 5 [INFO] Collected a threadDump for PID 8. [INFO] A new collection will start in 5 seconds. [INFO] Taking top data collection. [INFO] Taking TopdashH data collection. [INFO] Taking vmstat data collection. [INFO] Taking netstat collection. [INFO] Taking iostat data collection. [INFO] Taking nfsiostat data collection. [INFO] Taking nfsstat data collection. [!NOTE] 300: \"Length to run the script in seconds\" 5: \"Intervals to execute commands in seconds\" thread dump generated via monitor plugin generated via jmap [!NOTE|label:references:] List All the Classes Loaded in the JVM $ pid=$(ps auxfww | grep devops-jenkins | awk '{print $2}') $ jmap -dump:format=b,file=/opt/tmp/heapdump.bin ${pid} analysis via fastthread.io MAT: Eclipse Memory Analyzer VisualVM i.e.: visualvm.exe --jdkhome \"C:\\Software\\Java\\jdk1.6.0\" --userdir \"C:\\Temp\\visualvm_userdir\" other tools Decimal to Hexadecimal Converter GC Log Analyzer Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/jenkinsfile/jenkinsfile.html":{"url":"jenkins/jenkinsfile/jenkinsfile.html","title":"jenkinsfile","keywords":"","body":" jenkins API update node name raw build manager.build.result.isBetterThan customized build display name description exception using hudson.AbortException show catch message reference: Pipeline Examples Jenkins Pipeline Syantx Jenkins Pipeline Cookbook Pipeline Steps Reference org.jenkinsci.plugins.workflow.steps Pipeline Utility Steps Jenkins Pipeline Cookbook Class Exception Class TimeoutStepExecution Class TimeoutStepExecution.ExceededTimeout TimeoutStepExecution.java Understanding the Differences Between Jenkins Scripted and Declarative Pipeline: A Comprehensive Guide with Real-World Examples jenkins API update node name get label @NonCPS def getLabel(){ for (node in jenkins.model.Jenkins.instance.nodes) { if (node.getNodeName().toString().equals(\"${env.NODE_NAME}\".toString())) { currentLabel = node.getLabelString() return currentLabel } } } set label @NonCPS def updateLabel(nodeName, newLabel) { def node = jenkins.model.Jenkins.instance.getNode(nodeName) if (node) { node.setLabelString(newLabel) node.save() } } Jenkinsfile Example String curLabel = null String newLabel = null String testNodeName = null String curProject = env.JOB_NAME String curBuildNumber = env.BUILD_NUMBER node( 'controller' ) { try{ stage(\"reserve node\") { node(\"${params.tmNode}\") { testNodeName = env.NODE_NAME curLabel = getLabel() newLabel = \"${curLabel}~running_${curProject}#${curBuildNumber}\" echo \"~~> lock ${testNodeName}. update lable: ${curLabel} ~> ${newLabel}\" updateLabel(testNodeName, newLabel) } // node } // reserve stage } finally { if (newLabel) { stage(\"release node\") { nodeLabels = \"${newLabel}\".split('~') orgLabel = nodeLabels[0] echo \"~~> release ${testNodeName}. update lable ${newLabel} ~> ${orgLabel}\" updateLabel(testNodeName, orgLabel) } // release stage } // if } // finally raw build reference: org.jenkinsci.plugins.workflow.support.steps.build.RunWrapper hudson.model.Build hudson.model.Run Map buildResult = [:] node( 'controller' ) { buildResult = build job: '/marslo/artifactory-lib', propagate: true, wait: true buildResult.each { println it } println \"\"\" \"result\" : ${buildResult.result} \"getBuildVariables()\" : ${buildResult.getBuildVariables()} \"getBuildVariables().mytest\" : ${buildResult.getBuildVariables().mytest} \"getRawBuild().getEnvVars()\" : ${buildResult.getRawBuild().getEnvVars()} \"getRawBuild().getEnvironment()\" : ${buildResult.getRawBuild.getEnvironment()} \"getBuildCauses()\" : ${buildResult.getBuildCauses()} \"getChangeSets()\" : ${buildResult.getChangeSets()} \"buildVariables[\"mytest\"]\" : ${buildResult.buildVariables[\"mytest\"]} \"buildResult.rawBuild\" : ${buildResult.rawBuild} \"buildResult.rawBuild.log\" : ${buildResult.rawBuild.log} \"rawBuild.environment.RUN_CHANGES_DISPLAY_URL\" : ${buildResult.rawBuild.environment.RUN_CHANGES_DISPLAY_URL} \"\"\" } // node get changeSets reference: hudson.plugins.git.GitChangeSet hudson.scm.ChangeLogSet Interface ChangeLogSet.AffectedFile Class ChangeLogSet.Entry hudson.model.AbstractBuild How to access Changelogs in a Pipeline Job? lsjostro/changesets.groovy def res = [:] timestamps { ansiColor('xterm') { node( 'controller' ){ cleanWs() buildResult = build '/marslo/down' if( currentBuild.rawBuild.changeSets.isEmpty() ) { println \"no new code committed\" } else { buildResult.rawBuild.changeSets.each { cs -> cs.items.each { item -> println \"\"\" ----------------------------- revision : ${item.commitId} author : ${item.author} message : ${item.msg} affected files : \\t\\t${item.affectedFiles.collect{ f -> f.editType.name + ' - ' + f.path }.join('\\n\\t\\t\\t\\t')} \"\"\" } } } } }} via api $ curl -sSg \\ https://my.jenkins.com/job//job///api/json | jq -r .changeSets[] # or $ curl -sSg \\ https://my.jenkins.com/job//job///api/json?depth=100&&tree=changeSets[*[*]] manager.build.result.isBetterThan if( manager.build.result.isBetterThan(hudson.model.Result.UNSTABLE) ) { def cmd = 'ssh -p 29418 $host gerrit review --verified +1 --code --review +2 --submit $GERRIT_CHANGE_NUMBER,$GERRIT_PATCHSET_NUMBER' cmd = manager.build.environment.expand(cmd) manager.listener.logger.println(\"Merge review: '$cmd'\") def p = \"$cmd\".execute() manager.listener.logger.println(p.in.text) manager.addShortText(\"M\") } customized build display name currentBuild.displayName = '#' + Integer.toString(currentBuild.number) + ' mytest' description currentBuild.description = 'this is whitebox' exception [!TIP] references: Class Exception How to time out Jenkins Pipeline stage and keep the pipeline running? using hudson.AbortException import hudson.AbortException throw new AbortException( \"throw aborted exception\" ) show catch message try { throw new AbortException( \"throw aborted exception\" ) } catch(e) { def sw = new StringWriter() e.printStackTrace( new PrintWriter(sw) ) println sw.toString() // throw e // if not throw error, the catch process will only print the error message } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/jenkinsfile/utility.html":{"url":"jenkins/jenkinsfile/utility.html","title":"utility","keywords":"","body":" pipeline utility steps findFiles send mail with catch error tips Evaluate a Groovy source file into the Pipeline script load a constant extend the pipeline timeout DSL others handle api running in temporaray folders check git branch exists in local repo withCredentials push with ssh private credentials ssh-agent(https://plugins.jenkins.io/ssh-agent) code clone pipeline utility steps findFiles jenkinsfilesh \"touch a.txt\" def files = findFiles ( glob: \"**/*.txt\" ) println \"\"\" name : ${files[0].name} path : ${files[0].path} directory : ${files[0].directory} length : ${files[0].length} lastModified : ${files[0].lastModified} \"\"\" result [Pipeline] sh (hide) + touch a.txt [Pipeline] findFiles [Pipeline] echo name : a.txt path : a.txt directory : false length : 0 lastModified : 1605525397000 send mail with catch error try { sh 'might fail' mail subject: 'all well', to: 'admin@somewhere', body: 'All well.' } catch (e) { def w = new StringWriter() e.printStackTrace(new PrintWriter(w)) mail subject: \"failed with ${e.message}\", to: 'admin@somewhere', body: \"Failed: ${w}\" throw e } tips java.io.NotSerializableException: groovy.lang.IntRange refenrece: Groovy Range Examples Groovy For Loop Examples caused via (1..5).each { println it } solution IntRange.flatten()(1..5).flatten().each { println it } IntRange.toList()(1..5).toList().each { println it } Evaluate a Groovy source file into the Pipeline script references: Load From File load a constant see also imarslo: groovy metaClass groovy file ( constant.groovy ) @Field final Map> FOO = [ 'k1' : [ 'k11' : 'v11' ], 'k2' : [ 'k21' : 'v21', 'k22' : 'v22' ] ] Jenkinsfile Object matrix = load( '/path/to/constant.groovy' ) if ( matrix.metaClass.hasProperty(matrix, 'FOO') ) { println \"\"\" matrix.FOO : ${matrix.FOO} matrix.FOO.k1 : ${matrix.FOO.k1} matrix.type : ${matrix.metaClass.hasProperty(matrix, 'FOO').type} \"\"\" } result matrix.FOO : [k1:[k11:v11], k2:[k21:v21, k22:v22]] matrix.FOO.k1 : [k11:v11] matrix.type : interface java.util.Map extend the pipeline groovy script ( builtInStage.groovy ) String str = \"this is string A\" def stageA( String path ) { stage('scenario A') { println path } } def stageB() { stage('scenario B') { println str } } def stageC() { stage('scenario C') { String strC = \"this is string C\" sh \"echo ${strC}\" println strC } } def runAllStages( String basePath ) { stageA( basePath ) stageB() stageC() } return this jenkinsfile node('controller') { stage( 'download code' ) { echo 'prepare' sh \"cat ${WORKSPACE}/builtInStage.groovy\" } test = load \"builtInStage.groovy\" test.runAllStages( \"${WORKSPACE}/mypath\" ) stage( 'publish' ) { echo 'done!' } } stage view timeout references: plain-catch-blocks How to time out Jenkins Pipeline stage and keep the pipeline running? Class TimeoutStepExecution Class org.jenkinsci.plugins.workflow.steps.TimeoutStepExecution.ExceededTimeout Class CauseOfInterruption.UserInterruption Class User TimeoutStepExecution.java sample jenkins pipeline import jenkins.model.CauseOfInterruption import org.jenkinsci.plugins.workflow.steps.TimeoutStepExecution stage( 'wating' ) { catchError( buildResult: 'SUCCESS', stageResult: 'ABORTED' ) { try { timeout( time: 5, unit: 'SECONDS' ) { sleep( time: 10, unit: 'SECONDS' ) } } catch ( org.jenkinsci.plugins.workflow.steps.FlowInterruptedException e ) { String msg if ( e.causes[0] instanceof TimeoutStepExecution.ExceededTimeout ) { msg = 'NOT_BUILT: aborted by timeout' currentBuild.result = 'NOT_BUILT' } else if ( e.causes[0] instanceof CauseOfInterruption.UserInterruption ) { User user = e.causes[0]?.user println \"${user.fullName} : ${user.absoluteUrl}\" msg = \"ABORTED : by user : ${user.displayName} [ ${user.id} ]\" currentBuild.result = 'ABORTED' } println \"${msg}\" currentBuild.description = msg } catch ( Throwable e ) { def sw = new StringWriter() e.printStackTrace(new PrintWriter(sw)) println sw.toString() throw e } // try | catch } // catchError } // stage get previous build abort [!TIP] see also iMarslo : get builds abort cause // jenksinfile println libs.isTimeout( env.JOB_NAME, currentBuild.previousBuild.number ) // libs.groovy Boolean isTimeout( String name, int nubmer ) { Jenkins.instance .getItemByFullName( name ) .getBuildByNumber( nubmer ) .getActions( jenkins.model.InterruptedBuildAction.class ) .causes .flatten() .any{ it instanceof TimeoutStepExecution.ExceededTimeout } } DSL original DSL: cleanWs( deleteDirs: true, disableDeferredWipeout: true, notFailBuild: true, patterns: [ [ pattern: 'b.txt', type: 'INCLUDE' ] , [ pattern: 'a.txt', type: 'INCLUDE' ] ] ) Spread Operator Groovy Goodness: the Spread Operato List p = [ 'a.txt', 'b.txt' ] cleanWs( deleteDirs: true, disableDeferredWipeout: true, notFailBuild: true, patterns: [ *p.collect { [pattern: \"${it}\", type: 'INCLUDE'] } ] ) List.collect List p = [ 'a.txt', 'b.txt' ] cleanWs( deleteDirs: true, disableDeferredWipeout: true, notFailBuild: true, patterns: p.collect { [pattern: \"${it}\", type: 'INCLUDE'] } ) with API import hudson.plugins.ws_cleanup.Pattern import hudson.plugins.ws_cleanup.Pattern.PatternType List p = [ 'a.txt', 'b.txt' ] cleanWs( deleteDirs: true, disableDeferredWipeout: true, notFailBuild: true, patterns: p.collect { new Pattern(it, PatternType.INCLUDE) } ) with pure API Javadoc: hudson.plugins.ws_cleanup.WsCleanup hudson.plugins.ws_cleanup.Pattern hudson.plugins.ws_cleanup.Pattern.PatternType FilePath Launcher TaskListener get FilePath : Using FilePath to access workspace on slave in Jenkins pipeline import hudson.plugins.ws_cleanup.WsCleanup import hudson.plugins.ws_cleanup.Pattern import hudson.plugins.ws_cleanup.Pattern.PatternType List p = [ 'a.txt', 'b.txt' ] WsCleanup wsc = new WsCleanup() wsc.setDeleteDirs(true) wsc.setDisableDeferredWipeout(true) wsc.setNotFailBuild(true) wsc.setPatterns( p.each { new Pattern( it, PatternType.INCLUDE ) } ) // unresolved wsc.perform( currentBuild.rawBuild, , , ) others handle api Demo: Processing Github JSON from Groovy import groovy.json.JsonSlurper String username = System.getenv('GITHUB_USERNAME') String password = System.getenv('GITHUB_PASSWORD') String GITHUB_API = 'https://api.github.com/repos' String repo = 'groovy' String PR_ID = '2' // Pull request ID String url = \"${GITHUB_API}/${username}/${repo}/pulls/${PR_ID}\" println \"Querying ${url}\" def text = url.toURL().getText(requestProperties: ['Authorization': \"token ${password}\"]) def json = new JsonSlurper().parseText(text) def bodyText = json.body // Check if Pull Request body has certain text if ( bodyText.find('Safari') ) { println 'Found Safari user' } running in temporaray folders using pwd(temp:true) node ( 'built-in' ) { dir( pwd('tmp':true) ) { sh \"\"\" pwd ls -altrh \"\"\" } //dir } // node console output16:13:46 + pwd 16:13:46 /home/devops/workspace/marslo/sandbox/func@tmp 16:13:46 + ls -altrh 16:13:46 total 0 16:13:46 drwxr-xr-x 4 devops devops 42 Jul 13 08:13 .. 16:13:46 drwxr-xr-x 3 devops devops 19 Jul 13 08:13 . using System.currentTimeMillis() node ( 'built-in' ) { dir( System.currentTimeMillis().toString() ) { sh \"\"\" pwd ls -altrh \"\"\" } //dir } // node console output16:26:14 + pwd 16:26:14 /home/devops/workspace/marslo/sandbox/func/1657700773771 16:26:14 + ls -altrh 16:26:14 total 0 16:26:14 drwxr-xr-x 2 devops devops 6 Jul 13 08:26 . 16:26:14 drwxr-xr-x 4 devops devops 52 Jul 13 08:26 .. check git branch exists in local repo /** * check whether if the git refs exists in local repo or not * * @param name the git base references, can be branch name or revision or tag or pointer refs ( i.e. {@code HEAD}, {@code FETCH_HEAD}, ... ) * @param type the references type. can be {@code [ heads | tags | refs ]}. revision will be considered as {@code refs} * @param dir the local repo location. using current directory by default * @param verbose whether or not to show debug information **/ Boolean hasLocalReference( String name , String type = 'refs' , String dir = pwd() , Boolean verbose = true ) { if ( ! [ 'heads', 'tags', 'refs' ].contains(type) ) println( \"ERROR: invalid type ! available type : 'heads', 'tags' or 'refs'\" ) if ( verbose ) println ( \"~~> check whether if ${type} : '${name}' exists in local repository : '${dir}'\" ) String refs = [ 'heads', 'tags' ].contains(type) ? \"refs/${type}/${name}\" : name sh ( returnStatus : true , script : \"\"\" set -x ; [ -d \"${dir}\" ] && \\ git -C \"${dir}\" rev-parse --is-inside-work-tree >/dev/null 2>&1 && \\ git -C \"${dir}\" cat-file -e ${refs} \"\"\" ) == 0 } or via show-ref/** * check whether if the branch exists in local repository * * @param name the branch name will be checked * @param type to using {@code refs/${type}} to check branch or tags in local * @param dir the local repo location. using current directory by default * @param verbose whether or not to show debug information **/ Boolean hasLocalBranch ( String name , String type , String dir = pwd() , Boolean verbose = true ) { if ( ! [ 'heads', 'tags' ].contains(type) ) util.showError( \"ERROR: invalid type! available type : 'heads' or 'tags'\" ) if ( verbose ) color.echo( LOGGER_COLOR, \"~~> check whether if ${refName(type)} : '${name}' exists in local repository : '${dir}'\" ) sh ( returnStatus : true , script : \"\"\" set +x; [ -d \"${dir}\" ] && \\ git -C \"${dir}\" rev-parse --is-inside-work-tree >/dev/null 2>&1 && \\ git -C '${dir}' show-ref --quiet refs/${type}/${name} \"\"\" ) == 0 } // hasLocalBranch withCredentials references: JENKINS-47514 : Special characters in password are not escaped properly in git plugin's withCredentials Both gitUsernamePassword and gitSshPrivateKey bindings depend on the Credential Plugin to retrieve user’s credential using the Credentials API. Git SSH Private Key Binding The gitSshPrivateKey implementation provides git authentication support over SSH protocol using private key and passphrase credentials of a user. The binding uses two git specific environment variables depending upon the minimum CLI-git version GIT_SSH_COMMAND - If version is greater than or equal to 2.3, then the GIT_SSH_COMMAND environment variable provides the ssh command including necessary options which are: path to the private key and host key checking, to authenticate and connect to the git server without using an executable script. SSH_ASKPASS - If version is less than 2.3, an executable script is attached to the variable which provides the ssh command including necessary options which are: path to the private key and host key checking, to authenticate and connect to the git server push with ssh private credentials references: Git Credentials Binding for sh, bat, powershell Git credentials binding for sh, bat, and powershell Is it possible to Git merge / push using Jenkins pipeline Pipeline - Equivalent to Git Publisher Git from Jenkins pipeline is using wrong SSH private key to push back into Git repository Credentials Binding Plugin for username & password by gitUsernamePassword : withCredentials([ gitUsernamePassword( credentialsId: 'my-credentials-id', gitToolName: 'git-tool' ) ]) { bat 'git submodule update --init --recursive' } [!NOTE] If for any particular reason, the push must be done using a different method the URL needs to be configured accordingly: git config url.git@github.com/.insteadOf https://github.com/ : if the checkout was done through HTTPS but push must be done using SSH git config url.https://github.com/.insteadOf git@github.com/ : if the checkout was done through SSH but push must be done using HTTPS escaping characters in the ECHO commands of the askpass script:.replace(\"%\", \"%%\") .replace(\"^\", \"^^\") .replace(\"&\", \"^&\") .replace(\"\", \"^>\") .replace(\"|\", \"^|\") .replace(\"'\", \"^'\") .replace(\"`\", \"^`\") .replace(\",\", \"^,\") .replace(\";\", \"^;\") .replace(\"=\", \"^=\") .replace(\"(\", \"^(\") .replace(\")\", \"^)\") .replace(\"!\", \"^!\") .replace(\"\\\"\", \"^\\\"\") withCredentials([ sshUserPrivateKey( credentialsId : 'GITSSHPRIVATEKEY', keyFileVariable : 'SSHKEY', usernameVariable : 'USERNAME' ) ]) { sh \"\"\" GIT_SSH_COMMAND=\"ssh -i ${SSHKEY} -o User=${USERNAME} -o StrictHostKeyChecking=no\" \\ git ls-remote --heads \\ git push origin : \"\"\" } or def withSSHCredential( String credential, Boolean verbose = true ) { [ run : { command -> if ( verbose ) println ( \"~~> run '${command}' with credential ${credential} :\" ) withCredentials([ sshUserPrivateKey( credentialsId : credentialsId , keyFileVariable : 'SSHKEY' , usernameVariable : 'USERNAME' ) ]) { String sshCommand = \"GIT_SSH_COMMAND=\\\"ssh -i '${SSHKEY}' \" + \"-l '${USERNAME}' \" + \"-o StrictHostKeyChecking=no\" + '\"' sh ( returnStatus : true , script : \"\"\" set +x -e ; ${sshCommand} ${command} \"\"\" ) == 0 } // sshUserPrivateKey } // run ] } // withCredential // withSSHCredential( 'credentialID' ).run( 'git ls-remote git@github.com:sample/repo.git' ) ssh-agent(https://plugins.jenkins.io/ssh-agent) references: How is your Jenkins 'controller' configured for SSH push in the Jenkinsfile? #5 Use ssh credentials in jenkins pipeline with ssh, scp or sftp sample codesteps { sshagent (credentials: ['jenkins-generated-ssh-key']) { sh(\"\"\" git tag ${props['DATE_TAG']} git push --tags \"\"\") } } code clone String repo = 'https://github.com/sample-code' String branch = 'develop' String refsepc = \"+refs/heads/${branch}:/remotes/origin/${branch}\" String revision = 'abcdefg' // or 'HEAD' try { checkout([ $class: 'GitSCM', branches: [[ name: revision ]], extensions: [ [ $class : 'CloneOption', honorRefspec : true, noTags : false, reference : '', shallow : false ], [ $class : 'AuthorInChangelog' ] ], userRemoteConfigs: [[ credentialsId : , refspec : branch , url : repo ]] ]) } catch ( Exception e ) { def sw = new StringWriter() e.printStackTrace( new PrintWriter(sw) ) echo sw.toString() if ( e instanceof java.lang.NullPointerException ) { error ( \"${repo} CANNOT be found !\") } else if ( e instanceof hudson.AbortException ) { println ( \"failed to clone repo ${repo}\\n${e.message}\" ) if ( 'determineRevisionToBuild' == e.stackTrace.collect { it.methodName }.first() ) { error ( \"'${revision}' cannot be found in refs : '${branch}' ! provide correct revision number or branch name.\" + \"${e.message}\" ) } if ( 'retrieveChanges' == e.stackTrace.collect { it.methodName }.first() ) { error ( \"'${branch}' or '${revision}' cannot be found in ${repo} !${e.message}\" ) } } throw e } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/jenkinsfile/parallel.html":{"url":"jenkins/jenkinsfile/parallel.html","title":"parallel","keywords":"","body":" parallel static dynamic reference: Jobs In Parallel Parallel From List Parallel Multiple Nodes Trigger Job On All Nodes parallel static timestamps { ansiColor('xterm') { parallel([ 'k1 \\u00BB v1': { stage( 'build k1' ) { node( 'controller' ) { println \"KEY= k1, VALUE=v1\" sleep 3 } // node } }, 'k2 \\u00BB v2': { stage( 'build k2' ) { node( 'controller' ) { println \"KEY= k2, VALUE=v2\" sleep 3 } // node } }, 'k3 \\u00BB v3': { stage( 'build k3' ) { node('controller') { println \"KEY= k3, VALUE=v3\" sleep 3 } // node } } ]) println 'done' }} // ansiColor | timestamps dynamic timestamps { ansiColor('xterm') { Map worker = [:] Map data = [ \"k1\": \"v1\", \"k2\": \"v2\", \"k3\": \"v3\", ] data.each { k ,v -> worker[ \"${k} \\u00BB ${v}\" ] = { stage( \"build ${k}\" ) { node( 'controller' ) { println \"\"\" --------------- \"KEY=${k} VALUE=${v}\" --------------- \"\"\" sleep 3 } // node : controller } // stage } // work } parallel worker println \"done !\" }} // ansiColor | timestamps Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/jenkinsfile/build.html":{"url":"jenkins/jenkinsfile/build.html","title":"build","keywords":"","body":" build & current build get all current build parameters check previous build status Stop the current build get current build info trigger downstream builds get changelogs others stage and build warnError catchError error unstable get stage of a build Build Result isWorthThan build & current build get all current build parameters import hudson.model.* timestamps { ansiColor('xterm') { node('controller') { def parameters = currentBuild.rawBuild?.actions.find{ it instanceof ParametersAction }?.parameters parameters.each { println \"parameter ${it.name}:\" println it.dump() println \"-\" * 80 } } }} check previous build status useful info: method hudson.model.Run getPreviousBuild method hudson.model.Run getResult method org.jenkinsci.plugins.workflow.support.steps.build.RunWrapper getRawBuild if( ! hudson.model.Result.SUCCESS.equals(currentBuild.rawBuild.getPreviousBuild()?.getResult()) ) { echo \"last build failed\" } Stop the current build stop current // stop and show status to UNSTABLE if ( 'UNSTABLE' == currentBuild.result ) { currentBuild.getRawBuild().getExecutor().interrupt(Result.UNSTABLE) } or // stop and show status to NOT_BUILT if ( 'ABORTED' == currentBuild.result ) { currentBuild.rawBuild.executor.interrupt( Result.NOT_BUILT ) } or import hudson.model.Result import hudson.model.Run import jenkins.model.CauseOfInterruption Run previousBuild = currentBuild.getPreviousBuildInProgress() while ( previousBuild ) { if ( previousBuild.isInProgress() && previousBuild.getExecutor() ) { println \">> aborting previous build #${previousBuild.number}\" def cause = { \"interrupted by build #${currentBuild.getId()}\" as String } as CauseOfInterruption previousBuild.getExecutor().interrupt( Result.ABORTED, cause ) } previousBuilds = currentBuild.getPreviousBuildInProgress() } abort previous running build import hudson.model.Result import hudson.model.Run import jenkins.model.CauseOfInterruption def abortPreviousBuilds() { Run previousBuild = currentBuild.getPreviousBuildInProgress() while (previousBuild != null) { if (previousBuild.isInProgress()) { def executor = previousBuild.getExecutor() if (executor != null) { println \">> Aborting older build #${previousBuild.number}\" def cause = { \"interrupted by build #${currentBuild.getId()}\" as String } as CauseOfInterruption executor.interrupt(Result.ABORTED, cause) } } previousBuild = previousBuild.getPreviousBuildInProgress() } } or Stopping Jenkins job in case newer one is started import hudson.model.Result import jenkins.model.CauseOfInterruption //iterate through current project runs build.getProject()._getRuns().each { id, run -> def exec = run.getExecutor() //if the run is not a current build and it has executor (running) then stop it if( run!=build && exec!=null ) { //prepare the cause of interruption def cause = new CauseOfInterruption() { public String getShortDescription() { return \"interrupted by build #${build.getId()}\" } } exec.interrupt( Result.ABORTED, cause ) } } //just for test do something long... Thread.sleep(10000) stop all Thread.getAllStackTraces().keySet().each() { t -> if (t.getName()==\"YOUR THREAD NAME\" ) { t.interrupt(); } // or t.stop(); } // and Jenkins.instance.getItemByFullName(\"JobName\") .getBuildByNumber(JobNumber) .finish( hudson.model.Result.ABORTED, new java.io.IOException(\"Aborting build\") ); get current build info [!TIP] reference: How to get Jenkins build job details? get BUILD_NUMBER Jenkins.instance.getItemByFullName(env.JOB_NAME).getLastBuild().getNumber().toInteger() get previous build numbercurrentBuild.previousBuild.number get build id of lastSuccessfulBuild get via api sh \"\"\" curl -sSLg 'https:///job//api/json' -o 'output.json' \"\"\" def data = readJSON file: 'output.json' println data.lastSuccessfulBuild.number get via Jenkins.instance.getItemByFullName(env.JOB_NAME) Jenkins.instance.getItemByFullName(env.JOB_NAME).lastSuccessfulBuild.number get last build id Jenkins.instance.getItemByFullName(env.JOB_NAME).getLastBuild().getNumber().toInteger() trigger downstream builds timestamps { ansiColor('xterm') { node( 'controller' ) { stage( 'trigger downstream' ) { buildRes = build job: '/marslo/downstream', propagate: false, parameters: [ string( name: 'stringParams', value: 'string' ) , string( name: 'choiceParams', value: 'validChoice' ) , booleanParam( name: 'booleanParams', value: false ) , ] String log = \"\"\" result : ${buildRes.result} url : ${buildRes.absoluteUrl} build number : ${buildRes.number.toString()} \"\"\" println log } // stage : trigger downstream } // node : controller }} // ansiColor | timestamps trigger downstream with active choice parameters /marslo/sandbox timestamps { ansiColor('xterm') { podTemplate( cloud: 'DevOps Kubernetes' ) { node( POD_LABEL ) { List newParams = [ [$class: 'StringParameterValue' , name: 'lastName' , value: 'Jiao' ] , [$class: 'StringParameterValue' , name: 'firstName' , value: 'Marslo' ] , [$class: 'StringParameterValue' , name: 'provinces' , value: 'Gansu' ] , [$class: 'StringParameterValue' , name: 'cities' , value: 'Lanzhou,Dingxi' ] , [$class: 'BooleanParameterValue', name: 'notify', value: false] ] def res = build ( job: '/marslo/sandbox' , propagate : false , wait : true , parameters: newParams ) println \"\"\" result : ${res.result} url : ${res.absoluteUrl} build number : ${res.number.toString()} \"\"\" }} // node | podTemplate }} // ansiColor | timestamp get changelogs def changeLogSets = currentBuild.changeSets for ( int i = 0; i Pipeline Supporting APIs Plugin older than 2.2def changeLogSets = currentBuild.rawBuild.changeSets for ( int i = 0; i others Thread.currentThread().executable import hudson.model.* def build = Thread.currentThread().executable def buildNumber = build.number def workspace = build.getEnvVars()[\"WORKSPACE\"]' def jobname = build.getEnvVars()[\"JOB_NAME\"] ... stage and build reference: Jenkins Pipeline Stage Result Visualization Improvements org.jenkinsci.plugins.workflow.steps.Step /plugin/workflow-basic-steps/org/jenkinsci/plugins/workflow/steps/ pipeline-stage-step-plugin/blob/master/src/main/java/org/jenkinsci/plugins/workflow/support/steps/StageStep.java org.jenkinsci.plugins.workflow.steps.CatchErrorStep org.jenkinsci.plugins.workflow.steps.WarnErrorStep warnError: Catch error and set build and stage result to unstable catchError: Catch error and set build result to failure Set a stage status in Jenkins Pipelines How to time out Jenkins Pipeline stage and keep the pipeline running? warnError node( 'controller' ) { warnError( 'Script failed!' ) { sh( 'false' ) } } catchError stage( 'false' ) { catchError( buildResult : 'SUCCESS', message : 'stage failed, but build succeed', stageResult : 'FAILURE' ){ sh label: env.STAGE_NAME, script: 'exit 2' } } or just be simply: catchError( buildResult: 'SUCCESS', stageResult: 'FAILURE' ) { sh( 'false' ) } set unstable catchError( message: 'script failed', buildResult: 'UNSTABLE', stageResult: 'UNSTABLE' ) { sh( 'false' ) } catchError unstable error Signals an error. Useful if you want to conditionally abort some part of your program. You can also just throw new Exception(), but this step will avoid printing a stack trace error( 'failed the build' ) unstable Prints a message to the log and sets the overall build result and the stage result to UNSTABLE. The message will also be associated with the stage result and may be shown in visualizations. unstable( 'unstable the build' ) get stage of a build get stage namestage( 'build' ) { println \"${env.STAGE_NAME}\" } get all stages of a build WorkflowRun run = Jenkins.instance.getItemByFullName(\"####YOUR_JOB_NAME####\")._getRuns()[0] FlowExecution exec = run.getExecution() PipelineNodeGraphVisitor visitor = new PipelineNodeGraphVisitor(run) def flowNodes = visitor.getPipelineNodes() for (Iterator iterator = flowNodes.iterator(); iterator.hasNext();) { def node = iterator.next() if (node.getType() == FlowNodeWrapper.NodeType.STAGE) { String stageName = node.getDisplayName() def stageResult = node.getStatus().getResult() println \"Result of stage ${stageName} is ${stageResult}\" } } or import org.jenkinsci.plugins.workflow.graph.FlowGraphWalker import org.jenkinsci.plugins.workflow.graph.FlowNode try { // just for demo, a success step and a failure step node { sh 'true' sh 'false' } } finally { FlowGraphWalker walker = new FlowGraphWalker(currentBuild.rawBuild.getExecution()) for (FlowNode flowNode: walker) { // do whatever you want with flowNode echo flowNode.dump() } } Build Result reference How to manipulate the build result of a Jenkins pipeline job How to set current build result in Pipeline hudson.module.Result API isWorthThan import hudson.model.Result ansiColor( 'xterm' ) { List r = [ 'SUCCESS', 'UNSTABLE', 'FAILURE', 'NOT_BUILT', 'ABORTED' ] r.each { b -> println \" ~~> ${b}\" Result base = Result.fromString(b) ( r - b ).each { o -> Result x = Result.fromString(o) res = base.isWorseThan(x) color.echo( \"${res ? 'green' : 'red'}\", \"${base} isWorthThan ${x} : ${res}\" ) } } } // ansiColor Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/jenkinsfile/envvar.html":{"url":"jenkins/jenkinsfile/envvar.html","title":"envvar","keywords":"","body":" environment variables get current customized environment get downstream build environment get previous build environment global environment System.getenv() sh 'env' or sh 'printenv' env.getEnvironment() or currentBuild.getRawBuild().getEnvironment() get builds environment setup environment using groovy script creating local environment variables references: Jenkins Pipeline Environment Variables - The Definitive Guide Using environment variables in Jenkins pipelines - with examples Jenkins Pipeline - set and use environment variables Pipeline - Build failed due to MissingPropertyException: No such property: env environment variables get current customized environment println currentBuild.getBuildVariables()?.MY_ENV get downstream build environment def res = build job: 'downstream-job', propagate: false println res.getBuildVariables()?.MY_ENV get previous build environment println currentBuild.getPreviousBuild().getBuildVariables()?.MY_ENV global environment System.getenv() To get the Jenkins Global environment variables System.getenv().collect { k, v -> \"$k=$v\" }.join('\\n>>> ') resultPATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin >>> PWD=/ >>> LANGUAGE=en_US:en >>> LC_ALL=en_US.UTF-8 >>> SHLVL=0 >>> JAVA_HOME=/opt/java/openjdk >>> JENKINS_VERSION=2.284 >>> JAVA_VERSION=jdk8u282-b08 >>> JENKINS_UC=https://updates.jenkins.io >>> JAVA_OPTS=-Xms48G -Xmx144G -Duser.timezone='America/Los_Angeles' -XX:+UseG1GC -Dhudson.model.DirectoryBrowserSupport.CSP=\"sandbox allow-same-origin allow-scripts; default-src 'self'; script-src * 'unsafe-eval'; img-src *; style-src * 'unsafe-inline'; font-src *;\" -Djenkins.slaves.NioChannelSelector.disabled=true -Djenkins.slaves.JnlpSlaveAgentProtocol3.enabled=false -Djava.awt.headless=true -Djenkins.security.ClassFilterImpl.SUPPRESS_WHITELIST=true -Dhudson.model.ParametersAction.keepUndefinedParameters=true -Dcom.cloudbees.workflow.rest.external.ChangeSetExt.resolveCommitAuthors=true -Djenkins.install.runSetupWizard=true -Dpermissive-script-security.enabled=true -DsessionTimeout=1440 -DsessionEviction=43200 -Dgroovy.grape.report.downloads=true -Divy.message.logger.level=4 -Dhudson.plugins.active_directory.ActiveDirectorySecurityRealm.forceLdaps=false ... sh 'env' or sh 'printenv' running script in agent, so the result is the agent system environment variables + job itself variables (i.e: params and ${env.JENKINS_xxx}) sh 'env' // or sh 'printenv | sort' resultAGENT_WORKDIR=/home/devops/agent BUILD_DISPLAY_NAME=#1332 BUILD_ID=1332 BUILD_NUMBER=1332 BUILD_TAG=jenkins-marslo-sandbox-1332 BUILD_TIMESTAMP=2021-05-07 00:02:22 PDT JENKINS_HOME=/var/jenkins_home JOB_BASE_NAME=sandbox MY_TEST=works // particular environment setup in agent itself (linux) PATH=/it/my/test:/test/again:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin SHLVL=1 TERM=xterm ... env.getEnvironment() or currentBuild.getRawBuild().getEnvironment() pure Jenkins job's environment variables (and parameters) references: Retrieve all properties of env in Jenkinsfile println currentBuild.getRawBuild().getEnvironment() // or println prettyPrint( toJson(env.getEnvironment()) ) result {BUILD_DISPLAY_NAME=#1332, BUILD_ID=1332, BUILD_NUMBER=1332, BUILD_TAG=jenkins-marslo-sandbox-1332, BUILD_TIMESTAMP=2021-05-07 00:02:22 PDT, CLASSPATH=, HUDSON_HOME=/var/jenkins_home, JENKINS_HOME=/var/jenkins_home, ...} // or { \"BUILD_DISPLAY_NAME\": \"#1335\", \"BUILD_ID\": \"1335\", \"BUILD_NUMBER\": \"1335\", \"BUILD_TAG\": \"jenkins-marslo-sandbox-1335\", \"BUILD_TIMESTAMP\": \"2021-05-07 00:26:40 PDT\", \"CLASSPATH\": \"\", \"HUDSON_HOME\": \"/var/jenkins_home\", \"JOB_NAME\": \"marslo/sandbox\", ... } get builds environment references: Access to build environment variables from a groovy script in a Jenkins build step (Windows) import hudson.model.* def build = Thread.currentThread().executable def myVar = build.getBuildVariables().get('myVar') or import hudson.slaves.EnvironmentVariablesNodeProperty import hudson.EnvVars import hudson.model.BuildableItem import hudson.model.Job import jenkins.model.*; jenkins = Jenkins.instance; EnvironmentVariablesNodeProperty prop = jenkins.getGlobalNodeProperties() .get(EnvironmentVariablesNodeProperty.class) EnvVars env = prop.getEnvVars() println env['MY_VAR'] setup environment using groovy script import hudson.EnvVars; import hudson.slaves.EnvironmentVariablesNodeProperty; import hudson.slaves.NodeProperty; import hudson.slaves.NodePropertyDescriptor; import hudson.util.DescribableList; import jenkins.model.Jenkins; public createGlobalEnvironmentVariables(String key, String value){ Jenkins instance = Jenkins.getInstance(); DescribableList, NodePropertyDescriptor> globalNodeProperties = instance.getGlobalNodeProperties(); List envVarsNodePropertyList = globalNodeProperties.getAll(EnvironmentVariablesNodeProperty.class); EnvironmentVariablesNodeProperty newEnvVarsNodeProperty = null; EnvVars envVars = null; if ( envVarsNodePropertyList == null || envVarsNodePropertyList.size() == 0 ) { newEnvVarsNodeProperty = new hudson.slaves.EnvironmentVariablesNodeProperty(); globalNodeProperties.add(newEnvVarsNodeProperty); envVars = newEnvVarsNodeProperty.getEnvVars(); } else { envVars = envVarsNodePropertyList.get(0).getEnvVars(); } envVars.put(key, value) instance.save() } createGlobalEnvironmentVariables('Var1','Dummy') creating local environment variables declarative pipelinepipeline { agent any environment { DISABLE_AUTH = 'true' //can be used in whole pipeline } stages { stage(“Build”) { steps { echo env.DISABLE_AUTH } } } } scripted pipelinenode{ stage('Build') { withEnv([\"DISABLE_AUTH=true\"]) { echo env.DISABLE_AUTH } } } update Jenkins envvars in Jenkisnfile import jenkins.* import jenkins.model.* import hudson.* import hudson.model.* import hudson.slaves.* def updateEnvVar() { script { instance = Jenkins.getInstance() globalNodeProperties = instance.getGlobalNodeProperties() envVarsNodePropertyList = globalNodeProperties.getAll(hudson.slaves.EnvironmentVariablesNodeProperty.class) newEnvVarsNodeProperty = null envVars = null if ( envVarsNodePropertyList == null || envVarsNodePropertyList.size() == 0 ) { newEnvVarsNodeProperty = new hudson.slaves.EnvironmentVariablesNodeProperty(); globalNodeProperties.add(newEnvVarsNodeProperty); envVars = newEnvVarsNodeProperty.getEnvVars(); envVars.put(NEW_VAR, \"toto\"); } else { for (property in envVarsNodePropertyList) { envVars = property.getEnvVars(); envVars.put(\"EXISTING_VAR\",\"tata\"); } } instance.save() } } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/jenkinsfile/properties.html":{"url":"jenkins/jenkinsfile/properties.html","title":"properties","keywords":"","body":" parameters active choice parameters file paramter hidden parameter mixed parameters Jenkins 2.0 pipeline: Scripting active parameters for SCM reference: Class ParametersAction Class ParameterValue parameters Parameterized System Groovy script How to retrieve Jenkins build parameters using the Groovy API? parameters properties([ parameters([ string( defaultValue: '', name: 'stringParams', description: '', trim: false ), string( defaultValue: 'default', name: 'stringDefaultParams', description: '', trim: false ), validatingString( defaultValue: '', name: 'validatingString', regex: '.+', description: 'format: .+', failedValidationMessage: 'cannot be empty' ), choice( choices: ['a', 'b', 'c', 'd'], name: 'choiceParams', description: '' ), booleanParam( defaultValue: false, name: 'booleanParams', description: '' ) ]) ]) active choice parameters properties([ parameters([ [ $class: 'ChoiceParameter', name: 'provinces', choiceType: 'PT_SINGLE_SELECT', description: '', script: [ $class: 'GroovyScript', fallbackScript: [classpath: [], sandbox: false, script: '#!groovy return [\"accept in ScriptApproval first\"]'], script: [classpath: [], sandbox: false, script: '''return[ \\'Gansu\\', \\'Sichuan\\', \\'Disabled:disabled\\' ]''' ] ] ], // ChoiceParameter [ $class: 'CascadeChoiceParameter', name: 'cities', referencedParameters: 'provinces', choiceType: 'PT_CHECKBOX', description: '', script: [ $class: 'GroovyScript', fallbackScript: [classpath: [], sandbox: false, script: '#!groovy return [\"accept in ScriptApproval first\"]'], script: [classpath: [], sandbox: false, script: '''if (provinces.equals(\"Gansu\")) { return [\"Lanzhou\", \"Dingxi\"] } else if (provinces.equals(\"Sichuan\")) { return [\"Leshan\", \"Guangyuan:disabled\", \"Chengdu:selected\"] } else if (provinces.equals(\"Disabled\")) { return [\"notshow:selected\"] } else { return [\"Unknown provinces\"] }''' ] ]], // CascadeChoiceParameter [ $class: 'StringParameterDefinition' , name: 'lastName' , defaultValue: 'Joe' , description: '' ], // StringParameterDefinition [ $class: 'BooleanParameterDefinition', name: 'notify', defaultValue: false, description: '' ] // BooleanParameterDefinition ]) ]) or import groovy.transform.Field import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript @Field def props = [] @Field def newParams = [] @Field def fb = new SecureGroovyScript(\"\"\"return ['Script Error!']\"\"\", false) @Field def ps = new SecureGroovyScript(\"\"\"return[ 'Gansu', 'Sichuan', 'Disabled:disabled' ]\"\"\", false ) @Field def cs = new SecureGroovyScript(\"\"\"#!groovy Map citySets = [ Gansu : ['Lanzhou', 'Dingxi'] , Sichuan : ['Leshan', 'Guangyuan', 'Chengdu:selected'] , Disabled : ['notshow:selected'] ] return citySets[provinces] \"\"\", false) newParams += [$class: 'ChoiceParameter', name: 'provinces', choiceType: 'PT_SINGLE_SELECT', script: [ $class: 'GroovyScript', script: ps, fallbackScript: fb ], description: '' ] newParams += [$class: 'CascadeChoiceParameter', name: 'cities', referencedParameters: 'provinces', choiceType: 'PT_CHECKBOX', script: [ $class: 'GroovyScript', script: cs, fallbackScript: fb ], description: '' ] props += [$class: 'ParametersDefinitionProperty', parameterDefinitions: newParams] properties( properties: props ) file paramter [!NOTE|label:references] * jenkinsci/file-parameters-plugin Package io.jenkins.plugins.file_parameters JENKINS-27413 : Handle file parameters JENKINS-47333 : file parameter not working in pipeline job JENKINS-51245 : file parameter issue in jenkins pipeline JENKINS-29289 : InputStep doesn't support File Parameters How to overcome Jenkins pipeline inability to use file parameters janvrany/jenkinsci-unstashParam-library create file parameter final List props = [] final List newParams = [] newParams += [ $class: 'StashedFileParameterDefinition' , name: 'jsonFile', description: 'to upload file' ] props += [ $class: 'ParametersDefinitionProperty' , parameterDefinitions: newParams ] properties( properties: props ) // or properties([ parameters([ stashedFile('FILE') ]) ]) use file parameter /** * get the original filename who was uploaded via File Parameter * * @param name the parameter name * @see File Parameter **/ String getFilename( String name ) { env.getEnvironment().find { \"${name}_FILENAME\" == it.key }?.value ?: '' } /** * unstash the file who was uploaded via File Parameter * * @param name the parameter name * @see File Parameter **/ Boolean unstashFile( String name ) { String filename = getFilename( name ) if ( filename ) { unstash \"${name}\" sh \"\"\" set +x; mv \"${name}\" ${filename} \"\"\" return util.fileFinder( filename, 0 ) && true } else { color.alert( '... no uploaded file found ...' ) return false } } hidden parameter [!NOTE|label:references:] Hidden Parameter How Do I Use a Hidden Parameter in a Jenkins Declarative Pipeline Class WHideParameterDefinition setup final List props = [] final List newParams = [] newParams += [ $class: 'WHideParameterDefinition' , name: 'HIDDEN_PARAM', description: 'Hidden param' ] props += [ $class: 'ParametersDefinitionProperty' , parameterDefinitions: newParams ] properties( properties: props ) // or properties([ parameters([ hidden( name: 'hidden_param', defaultValue: 'hidden_value', description: 'Hidden parameter' ) ]) ]) mixed parameters [!NOTE|label:references:] $class: 'ValidatingStringParameterDefinition' $class: 'hudson.model.ChoiceParameterDefinition' $class: 'io.jenkins.plugins.file_parameters.StashedFileParameterDefinition' import groovy.transform.Field import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript @Field def props = [] @Field def newParams = [] @Field def fb = new SecureGroovyScript(\"\"\"return ['Script Error!']\"\"\", false) @Field def ps = new SecureGroovyScript(\"\"\"return[ 'Gansu', 'Sichuan', 'Disabled:disabled' ]\"\"\", false ) @Field def cs = new SecureGroovyScript(\"\"\"#!groovy Map citySets = [ Gansu : ['Lanzhou', 'Dingxi'] , Sichuan : ['Leshan', 'Guangyuan', 'Chengdu:selected'] , Disabled : ['notshow:selected'] ] return citySets[provinces] \"\"\", false) newParams += [ $class: 'StashedFileParameterDefinition' , name: 'filename' , description: 'to upload file' ] newParams += [ $class: 'StringParameterDefinition' , name: 'lastName' , defaultValue: 'Joe' , description: '' ] newParams += [ $class: 'StringParameterDefinition' , name: 'firstName' , defaultValue: 'Dan' , description: '' ] newParams += [ $class : 'ValidatingStringParameterDefinition' , defaultValue : '' , description : 'timestamps format: YYMMDDHHMMSS' , failedValidationMessage : 'Cannot be empty or failed by Regex validation !' , name : 'timeStamps' , regex : '\\\\d{2,4}(0[1-9]|1[0-2])(0[1-9]|[1-2][0-9]|3[0-1])(2[0-3]|[01][0-9])[0-5][0-9]\\\\d{0,2}' ] newParams += [ $class : 'ChoiceParameter' , name : 'provinces' , choiceType : 'PT_SINGLE_SELECT' , script : [ $class : 'GroovyScript' , script : ps , fallbackScript : fb ] , description : '' ] newParams += [ $class : 'CascadeChoiceParameter' , name : 'cities' , referencedParameters : 'provinces' , choiceType : 'PT_CHECKBOX' , script : [ $class : 'GroovyScript' , script : cs , fallbackScript : fb ] , description : '' ] newParams += [ $class: 'BooleanParameterDefinition' , name: 'notify' , defaultValue: false , description: '' ] props += [ $class: 'ParametersDefinitionProperty' , parameterDefinitions: newParams ] properties( properties: props ) podTemplate(cloud: 'DevOps Kubernetes') { node(POD_LABEL) { stage('run') { println \"\"\" lastName : ${params.lastName} firstName : ${params.firstName} provinces : ${params.provinces} cities : ${params.cities} notify : ${params.notify} timeStamps : ${params.timeStamps} filename : ${getFilename('filename')} \"\"\" } // stage } // node } // podTemplate String getFilename( String name ) { env.getEnvironment().find { \"${name}_FILENAME\" == it.key }?.value ?: '' } Jenkins 2.0 pipeline: Scripting active parameters for SCM import groovy.transform.Field import org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript @Field def props = [] @Field def newParams = [] node('mster') { setNewProps() } // node void setNewProps() { //Parameters are unknown at first load try { regenerateJob = (params.RegenerateJob == null) ? true : params.RegenerateJob } catch (MissingPropertyException e) { regenerateJob = true } if (regenerateJob) { def fb = new SecureGroovyScript(\"\"\"return ['Script Error!']\"\"\", false) def ps = new SecureGroovyScript(\"\"\"return[ 'Gansu', 'Sichuan', 'Disabled:disabled' ]\"\"\", false ) def cs = new SecureGroovyScript(\"\"\"#!groovy Map citySets = [ Gansu : ['Lanzhou', 'Dingxi'] , Sichuan : ['Leshan', 'Guangyuan', 'Chengdu:selected'] , Disabled : ['notshow:selected'] ] return citySets[provinces] \"\"\", false) println \"Jenkins job ${env.JOB_NAME} gets updated.\" currentBuild.displayName = \"#\" + Integer.toString(currentBuild.number) + \": Initialize job\" newParams += [$class: 'StringParameterDefinition' , name: 'lastName' , defaultValue: 'Joe' , description: ''] newParams += [$class: 'StringParameterDefinition' , name: 'firstName' , defaultValue: 'Dan' , description: ''] newParams += [ $class : 'ValidatingStringParameterDefinition', name : 'timeStamps' , description : 'timestamps format: YYMMDDHHMMSS' , failedValidationMessage : 'Cannot be empty or failed by Regex validation !' , defaultValue : '' , regex : '\\\\d{2,4}(0[1-9]|1[0-2])(0[1-9]|[1-2][0-9]|3[0-1])(2[0-3]|[01][0-9])[0-5][0-9]\\\\d{0,2}' ] newParams += [ $class : 'ChoiceParameter' , name : 'provinces' , choiceType : 'PT_SINGLE_SELECT' , script : [ $class : 'GroovyScript' , script : ps , fallbackScript : fb ] , description : '' ] newParams += [ $class : 'CascadeChoiceParameter' , name : 'cities' , referencedParameters : 'provinces' , choiceType : 'PT_CHECKBOX' , script : [ $class : 'GroovyScript' , script : cs , fallbackScript : fb ] , description : '' ] newParams += [$class: 'BooleanParameterDefinition' , name: 'notify' , defaultValue: false , description: ''] props += [ $class : 'BuildDiscarderProperty', strategy : [$class: 'LogRotator', daysToKeepStr: '30', artifactDaysToKeepStr: '1', artifactNumToKeepStr: ''] ] props += [$class: 'ParametersDefinitionProperty', parameterDefinitions: newParams] properties( properties: props ) } } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/jenkinsfile/trigger.html":{"url":"jenkins/jenkinsfile/trigger.html","title":"trigger","keywords":"","body":" trigger poll SCM parameterizedCron triggered by libs GerritCause trigger poll SCM properties([ // every 6 hours pipelineTriggers([ pollSCM( ignorePostCommitHooks: true, scmpoll_spec: 'H H/6 * * *' ) ]) ]) properties([ pipelineTriggers([ [ $class: \"SCMTrigger\", scmpoll_spec: 'H/5 * * * *' ], ]) ]) declarative:triggers { pollSCM ignorePostCommitHooks: true, scmpoll_spec: 'H H * * *' } parameterizedCron properties([ parameters([ choice(choices: ['', 'a', 'b', 'c'], description: '', name: 'var1') choice(choices: ['', 'a', 'b', 'c'], description: '', name: 'var2') ]), pipelineTriggers([ parameterizedCron( ''' H/3 * * * * % var1=a; var2=b H/6 * * * * % var1=b; var2=a ''' ) ]) ]) triggered by references: gitlab CauseAction.class Cause.UpstreamCause Cause.UserIdCause RebuildCause ReplayCause TimerTrigger.TimerTriggerCause ParameterizedTimerTriggerCause source code : yet-another-build-visualizer-plugin get build cause import hudson.model.Cause.UserIdCause import org.jenkinsci.plugins.workflow.job.WorkflowRun workflowRun build = currentBuild.rawBuild println build.getCauses().collect { it.getClass().getCanonicalName() } println build.getCauses().collect { it.getClass().getCanonicalName() }.collect { it.tokenize('.').last() } println \"\"\" cause : ${build.getCauses().toString()} cause.getClass() : ${build.getCauses().getClass()} : ${build.getCauses().getClass().getCanonicalName()} build.getCause( UserIdCause.class ) : ${build.getCause( UserIdCause.class )} \"\"\" console output [Pipeline] echo [hudson.model.Cause.UserIdCause] [Pipeline] echo [UserIdCause] [Pipeline] echo cause : [hudson.model.Cause$UserIdCause@bf8cb337] cause.getClass() : class java.util.Collections$UnmodifiableRandomAccessList : java.util.Collections.UnmodifiableRandomAccessList build.getCause( UserIdCause.class ) : hudson.model.Cause$UserIdCause@bf8cb337 get user id if triggered by manually import hudson.model.Cause.UserIdCause import org.jenkinsci.plugins.workflow.job.WorkflowRun workflowRun build = currentBuild.rawBuild if ( build.getCause(UserIdCause.class) ) { println \"\"\" username : ${build.getCause(hudson.model.Cause.UserIdCause.class).getUserName()} id : ${build.getCause(hudson.model.Cause.UserIdCause.class).getUserId()} mail : ${build.getCause(hudson.model.Cause.UserIdCause.class).getUserId()}@domain.com \"\"\" } or import hudson.model.Cause.UserIdCause if ( build.getCause(UserIdCause.class) ) { println \"\"\" username : ${build.getCause(UserIdCause.class).getUserName()} id : ${build.getCause(UserIdCause.class).getUserId()} mail : ${build.getCause(UserIdCause.class).getUserId()}@domain.com \"\"\" } get causedby import org.jenkinsci.plugins.workflow.job.WorkflowRun import hudson.model.Cause.* import hudson.triggers.TimerTrigger.TimerTriggerCause import org.jenkinsci.plugins.workflow.cps.replay.ReplayCause import org.jenkinsci.plugins.parameterizedscheduler.ParameterizedTimerTriggerCause import org.jenkinsci.plugins.workflow.cps.replay.ReplayCause import com.sonyericsson.rebuild.RebuildCause def getCasuedBy( workflowRun build = currentBuild.rawBuild ) { CauseAction causeAction = currentBuild.rawBuild.getAction(CauseAction.class) causeAction.getCauses().each { Cause cause -> if ( cause instanceof Cause.UpstreamCause ) println ( 'by upstream' ) if ( cause instanceof Cause.UserIdCause ) println ( 'by user' ) if ( cause instanceof ReplayCause ) println ( 'by reply' ) if ( cause instanceof RebuildCause ) println ( 'by rebuild' ) if ( cause instanceof TimerTriggerCause ) println ( 'by timer' ) if ( cause instanceof ParameterizedTimerTriggerCause ) println ( 'by ParameterizedTimerTrigger' ) } } gitlab currentBuild.rawBuild.getCause(com.dabsquared.gitlabjenkins.cause.GitLabWebHookCause).getData() // or commit = currentBuild.rawBuild.getCause(com.dabsquared.gitlabjenkins.cause.GitLabWebHookCause).getData().getLastCommit() libs import hudson.model.Cause.* import hudson.triggers.TimerTrigger.TimerTriggerCause import org.jenkinsci.plugins.parameterizedscheduler.ParameterizedTimerTriggerCause import org.jenkinsci.plugins.workflow.cps.replay.ReplayCause import com.sonyericsson.rebuild.RebuildCause Boolean byCron( WorkflowRun build = currentBuild.rawBuild ) { build.getCause( TimerTriggerCause.class ) && true } Boolean byParameterizedCron( WorkflowRun build = currentBuild.rawBuild ) { build.getCause( ParameterizedTimerTriggerCause.class ) && true } Boolean byTimer( WorkflowRun build = currentBuild.rawBuild ) { byCron( build ) || byParameterizedCron( build ) } Boolean byUpstream( WorkflowRun build = currentBuild.rawBuild ) { build.getCause( Cause.UpstreamCause.class ) && true } Boolean byUserId( WorkflowRun build = currentBuild.rawBuild ) { build.getCause( Cause.UserIdCause.class ) && true } Boolean byReplay( WorkflowRun build = currentBuild.rawBuild ) { byUserId( build ) && build.getCause( ReplayCause.class ) } Boolean byRebuild( WorkflowRun build = currentBuild.rawBuild ) { byUserId( build ) && build.getCause( RebuildCause.class ) } GerritCause check imarslo : GerritCause Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/jenkinsfile/node.html":{"url":"jenkins/jenkinsfile/node.html","title":"node","keywords":"","body":" yaml with resources with POD_LABEL default yaml container reference: kubernetes Kubernetes plugin yaml #!/usr/bin/env groovy import groovy.transform.Field @Field final String CLUSTER = 'DevOps Kubernetes' @Field final String NAMESPACE = 'devops' String label = env.BUILD_TAG ansiColor('xterm') { timestamps { podTemplate( label: label , cloud: CLUSTER , namespace: NAMESPACE , showRawYaml: true, yaml: \"\"\" apiVersion: v1 kind: Pod metadata: labels: jenkins: jnlp-inbound-agent spec: hostNetwork: true nodeSelector: : \"\" containers: - name: jnlp image: jenkins/inbound-agent:latest workingDir: /home/jenkins tty: true \"\"\" ) { node (label) { container(name:'jnlp', shell:'/bin/bash') { stage('prepare') { sh \"\"\" whoami pwd realpath ${WORKSPACE} \"\"\" } // stage }}} // container | node | podTemplate }} // timestamp | ansiColor // vim: ft=Jenkinsfile ts=2 sts=2 sw=2 et with resources #!/usr/bin/env groovy import groovy.transform.Field @Field final String CLUSTER = 'Jenkins Kubernetes' @Field final String NAMESPACE = 'jenkins' String label = env.BUILD_TAG ansiColor('xterm') { timestamps { podTemplate( label: label , cloud: CLUSTER , namespace: NAMESPACE , showRawYaml: true, yaml: \"\"\" apiVersion: v1 kind: Pod metadata: labels: jenkins: jnlp-inbound-agent spec: hostNetwork: true nodeSelector: : \"\" containers: - name: jnlp image: jenkins/inbound-agent:latest workingDir: /home/jenkins tty: true resources: limits: memory: 1Gi cpu: 1 requests: memory: 500Mi cpu: 0.5 \"\"\" ) { node (label) { container(name:'jnlp', shell:'/bin/bash') { stage('prepare') { sh \"\"\" whoami pwd \"\"\" } // stage }}} // container | node | podTemplate }} // timestamp | ansiColor // vim: ft=Jenkinsfile ts=2 sts=2 sw=2 et with POD_LABEL #!/usr/bin/env groovy import groovy.transform.Field @Field final String CLUSTER = 'Jenkins Kubernetes' @Field final String NAMESPACE = 'jenkins' ansiColor('xterm') { timestamps { podTemplate( cloud: CLUSTER , namespace: NAMESPACE , showRawYaml: true, yaml: \"\"\" apiVersion: v1 kind: Pod metadata: labels: jenkins: jnlp-inbound-agent spec: hostNetwork: true nodeSelector: : \"\" containers: - name: jnlp image: jenkins/inbound-agent:latest workingDir: /home/jenkins tty: true resources: limits: memory: 1Gi cpu: 1 requests: memory: 500Mi cpu: 0.5 \"\"\" ) { node (POD_LABEL) { container(name:'jnlp', shell:'/bin/bash') { stage('prepare') { sh \"\"\" whoami pwd ls -Altrh /home/ ls -Altrh /home/jenkins/ touch a.txt realpath ${WORKSPACE} realpath a.txt \"\"\" } // stage }}} // container | node | podTemplate }} // timestamp | ansiColor // vim: ft=Jenkinsfile ts=2 sts=2 sw=2 et default yaml podTemplate(cloud: 'DevOps Kubernetes') { node(POD_LABEL) { stage('Run shell') { sh 'echo hello world' } } } windows (kubernetes) /* * Runs a build on a Windows pod. * Tested in EKS: https://docs.aws.amazon.com/eks/latest/userguide/windows-support.html */ podTemplate(yaml: ''' apiVersion: v1 kind: Pod spec: containers: - name: jnlp image: jenkins/inbound-agent:windowsservercore-1809 - name: shell image: mcr.microsoft.com/powershell:preview-windowsservercore-1809 command: - powershell args: - Start-Sleep - 999999 nodeSelector: kubernetes.io/os: windows ''') { node(POD_LABEL) { container('shell') { powershell 'Get-ChildItem Env: | Sort Name' } } } maven (kubernetes) // Build a Maven project using the standard image and Scripted syntax. // Rather than inline YAML, you could use: yaml: readTrusted('jenkins-pod.yaml') // Or, to avoid YAML: containers: [containerTemplate(name: 'maven', image: 'maven:3.6.3-jdk-8', command: 'sleep', args: 'infinity')] podTemplate(yaml: ''' apiVersion: v1 kind: Pod spec: containers: - name: maven image: maven:3.6.3-jdk-8 command: - sleep args: - infinity ''') { node(POD_LABEL) { // or, for example: git 'https://github.com/jglick/simple-maven-project-with-tests' writeFile file: 'pom.xml', text: ''' 4.0.0 sample sample 1.0-SNAPSHOT org.apache.maven.plugins maven-surefire-plugin 2.18.1 junit junit 4.12 test UTF-8 1.8 1.8 ''' writeFile file: 'src/test/java/sample/SomeTest.java', text: ''' package sample; public class SomeTest { @org.junit.Test public void checks() {} } ''' container('maven') { sh 'mvn -B -ntp -Dmaven.test.failure.ignore verify' } junit '**/target/surefire-reports/TEST-*.xml' archiveArtifacts '**/target/*.jar' } } container podTemplate(cloud: 'DevOps Kubernetes', containers: [ containerTemplate( name: 'jnlp', image: 'jenkins/inbound-agent:latest', ttyEnabled: true, privileged: false, alwaysPullImage: false, workingDir: '/home/jenkins' ) ]) { node(POD_LABEL) { stage ('run') { echo 'yes!' sh \"\"\" id whoami echo ${WORKSPACE} realpath ${WORKSPACE} \"\"\" } }} Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/script/script.html":{"url":"jenkins/script/script.html","title":"script","keywords":"","body":" script console usage setup system (temporary) extend built-in node executor execute shell script in console read & write files jenkins system jobs & builds list build status with percentage get all builds status during certain start-end time list builds which running for more than 24 hours get workspace shelve jobs plugins via api : imarslo: list plugins simple list list for helm-value.yaml with delegate to Servlet container security realm list plugin and dependencies scriptApproval backup & restore all scriptApproval items automatic approval all pending disable the scriptApproval logRotator show logRotator reference: Script Console Jenkins Features Controlled with System Properties samrocketman/jenkins-script-console-scripts monitor and slack * jenkinsci/jenkins-scripts * cloudbees/jenkins-scripts mubbashir/Jenkins+Script+Console.md Sam Gleske’s jenkins-script-console-scripts repository Sam Gleske’s jenkins-bootstrap-shared repository Some scripts at JBoss.org mikejoh/jenkins-and-groovy-snippets.md Jenkins : Jenkins Script Console Jenkins : Use Jenkins Java API Usage Example jenkins.model.Jenkins jenkins.model.BuildDiscarder org.jenkinsci.plugins.workflow.steps I have a stuck Pipeline and I can not stop it others Jenkins : Monitor and Restart Offline Slaves Jenkins : Monitoring Scripts Jenkins : Printing a list of credentials and their IDs Jenkins : Wipe workspaces for a set of jobs on all nodes Jenkins : Invalidate Jenkins HTTP sessions Jenkins : Grant Cancel Permission for user and group that have Build permission [!TIP] to list methods on a class instance: thing.metaClass.methods*.name.sort().unique() to determine a class from an instance: thing.class // or thing.getClass() script console usage [!TIP] CSRF Protection Explained if you authenticate your API calls with a username and a user API token then a crumb is not required from Jenkins 2.96 to get CSRF crumb via curl $ SERVER=\"https://localhost:8080\" $ COOKIEJAR=\"$(mktemp)\" $ CRUMB=$(curl -u \"admin:admin\" -s --cookie-jar \"$COOKIEJAR\" \"$SERVER/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,%22:%22,//crumb)\") # to run script via curl $ curl -d \"script=System.getProperties()\" \\ -u \"admin:admin\" \\ --cookie \"$COOKIEJAR\" \\ -H \"$CRUMB\" \\ https://${SERVER}/scriptText or$ SERVER=\"https://localhost:8080\" $ COOKIEJAR=\"$(mktemp)\" $ CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"${COOKIEJAR}\" \\ 'https://${SERVER}/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' ) # verify $ echo $CRUMB Jenkins-Crumb:c11dc*******************************************************e463 $ curl -d \"script=System.getProperties()\" \\ -u \"admin:admin\" \\ -s \\ --cookie \"$COOKIEJAR\" \\ -H \"$CRUMB\" \\ https://${SERVER}/scriptText $ curl --data-urlencode \"script=$( remote access $ curl -d \"script=\" https://jenkins/script # or to get output as a plain text result (no HTML) $ curl -d \"script=\" https://jenkins/scriptText curl submitting groovy file $ curl --data-urlencode \"script=$( via api token$ curl --user 'username:api-token' \\ --data-urlencode \\ \"script=$( via pythonwith open('somescript.groovy', 'r') as fd: data = fd.read() r = requests.post('https://jenkins/scriptText', auth=('username', 'api-token'), data={'script': data}) setup system (temporary) [!TIP|label:references:] Jenkins Features Controlled with System Properties Configuring Content Security Policy timestampe System.setProperty('org.apache.commons.jelly.tags.fmt.timeZone', 'America/Los_Angeles') shell step aborts System.setProperty(\"org.jenkinsci.plugins.durabletask.BourneShellScript.HEARTBEAT_CHECK_INTERVAL\", 36000) to clear property System.clearProperty(\"hudson.model.DirectoryBrowserSupport.CSP\") to get property System.setProperty(\"hudson.model.DirectoryBrowserSupport.CSP\", \"\") to get all properties System.getProperties() // or System.getProperties().sort().collectEntries{[ (it.key), (it.value) ]} System.getProperties().sort().each { println \"${it.key} ~> ${it.value}\" } System.getProperties().sort().collect{ \"${it.key} ~> ${it.value}\" }.join('\\n') extend built-in node executor import jenkins.model.* Jenkins.instance.setNumExecutors(5) execute shell script in console [!TIP|label:references:] Run scripts from controller Script Console on agents println (\"uname -a\".execute().text) // or println (\"printenv\".execute().in.text) result Linux devops-jenkins-685cf57df9-znfs8 4.19.12-1.el7.elrepo.x86_64 #1 SMP Fri Dec 21 11:06:36 EST 2018 x86_64 GNU/Linux or import hudson.util.RemotingDiagnostics import jenkins.model.Jenkins String agentName = 'your agent name' //groovy script you want executed on an agent groovy_script = ''' println System.getenv(\"PATH\") println \"uname -a\".execute().text '''.trim() String result Jenkins.instance.slaves.find { agent -> agent.name == agentName }.with { agent -> result = RemotingDiagnostics.executeGroovy(groovy_script, agent.channel) } println result read & write files // write new File('/tmp/file.txt').withWriter('UTF-8') { writer -> try { writer write file in agent import hudson.FilePath import hudson.remoting.Channel import jenkins.model.Jenkins String agentName = 'some-agent' String filePath = '/tmp/file.txt' Channel agentChannel = Jenkins.instance.slaves.find { agent -> agent.name == agentName }.channel new FilePath(agentChannel, filePath).write().with { os -> try { os read file from an agent import hudson.FilePath import hudson.remoting.Channel import jenkins.model.Jenkins import java.io.BufferedReader import java.io.InputStreamReader import java.nio.charset.StandardCharsets import java.util.stream.Collectors String agentName = 'some-agent' String filePath = '/tmp/file.txt' Channel agentChannel = Jenkins.instance.slaves.find { it.name == agentName }.channel String fileContents = '' new FilePath(agentChannel, filePath).read().with { is -> try { fileContents = new BufferedReader( new InputStreamReader(is, StandardCharsets.UTF_8)) .lines() .collect(Collectors.joining(\"\\n\") ) } finally { is.close() } } // with // print contents of the file from the agent println '===' println(fileContents) println '===' modify log level references: How to change the default or package log levels Configure Loggers for Jenkins Disable HttpClient logging Viewing logs System.setProperty(\"org.apache.commons.logging.Log\", \"org.apache.commons.logging.impl.SimpleLog\"); System.setProperty(\"org.apache.commons.logging.simplelog.showdatetime\", \"true\"); System.setProperty(\"org.apache.commons.logging.simplelog.log.httpclient.wire.header\", \"error\"); System.setProperty(\"org.apache.commons.logging.simplelog.log.org.apache.http\", \"error\"); System.setProperty(\"log4j.logger.org.apache.http\", \"error\"); System.setProperty(\"log4j.logger.org.apache.http.wire\", \"error\"); System.setProperty(\"org.apache.commons.logging.simplelog.log.org.apache.commons.httpclient\", \"error\"); check log levelprintln System.getProperty(\"org.apache.commons.logging.Log\"); println System.getProperty(\"org.apache.commons.logging.simplelog.showdatetime\"); println System.getProperty(\"org.apache.commons.logging.simplelog.log.httpclient.wire.header\"); println System.getProperty(\"org.apache.commons.logging.simplelog.log.org.apache.http\"); println System.getProperty(\"log4j.logger.org.apache.http\"); println System.getProperty(\"log4j.logger.org.apache.http.wire\"); println System.getProperty(\"org.apache.commons.logging.simplelog.log.org.apache.commons.httpclient\"); jenkins system references: AnalogJ/you-dont-know-jenkins-init 3003.plugin-pipeline-library.groovy Using Hudson/Features controlled by system properties import jenkins.model.*; import org.jenkinsci.main.modules.sshd.*; def instance = Jenkins.instance instance.setDisableRememberMe( false ) instance.setNumExecutors( 2 ) instance.setSystemMessage( 'welcome to the Jenkins Master' ) instance.setRawBuildsDir() instance.save() def sshd = SSHD.get() sshd.setPort( 12345 ) sshd.save() jobs & builds [!TIP|label:get more:] * imarslo : jobs * imarslo : builds list build status with percentage get all builds result percentage get builds result percentage within 24 hours get builds result and percentage within certain start-end time get all builds status during certain start-end time list all builds within 24 hours get last 24 hours failure builds get last 24 hours failure builds via Map structure get builds result during certain start-end time get builds result and percentage within certain start-end time list builds which running for more than 24 hours list job which running for more than 24 hours get last 24 hours failure builds get last 24 hours failure builds via Map structure get builds result percentage within 24 hours get builds result during certain start-end time get builds result and percentage within certain start-end time get workspace hudson.FilePath workspace = hudson.model.Executor.currentExecutor().getCurrentWorkspace() get absolute pathprintln(\"script directory: ${new File(__FILE__).parent.absolutePath}\") shelve jobs //You have to install the Shelve Project Plugin on your Jenkins Master //The maximum value for daysBack is 365, going beyond 365 will break the script. import org.jvnet.hudson.plugins.shelveproject.ShelveProjectTask def daysBack=365; Jenkins.instance.getAllItems(AbstractProject.class).each { it -> def lastBuild = it.getLastBuild() if( lastBuild != null ) { def back = Calendar.getInstance() back.set( Calendar.DAY_OF_YEAR,back.get(Calendar.DAY_OF_YEAR) - daysBack ) if ( lastBuild.getTime().compareTo(back.getTime()) plugins via api : imarslo: list plugins simple list Jenkins.instance .pluginManager .plugins .each { plugin -> println ( \"${plugin.getDisplayName()} (${plugin.getShortName()}): ${plugin.getVersion()}\" ) } list for helm-value.yaml Jenkins.instance .pluginManager .plugins .sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase() } .each { plugin -> println \"- ${plugin.getShortName()}:${plugin.getVersion()}\" } \"DONE\" with delegate to Servlet container security realm ExtensionList.lookup( UnprotectedRootAction ).each { println String.format( \"URL: '%s/' provided by '%s' in '%s'\", it.urlName, Jenkins.get().pluginManager.whichPlugin(it.class)?.shortName?:\"Jenkins Core\", it.class.name ) } list plugin and dependencies println Jenkins.instance.pluginManager.plugins .sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase() } .collect { plugin -> \"~~> ${plugin.shortName} : ${plugin.version} : ${plugin.displayName}\" + ( plugin.dependants ? \"\\n\\t+++ ${plugin.dependants.join('\\n\\t+++ ')}\" : '' ) + ( plugin.dependencies ? \"\\n\\t... ${plugin.dependencies.join('\\n\\t... ')}\" : '' ) } .join('\\n') get specific plugin dependencies List keywords = [ 'jsch' ] println Jenkins.instance.pluginManager.plugins .findAll { plugin -> keywords.any { it == plugin.shortName } } .sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase() } .collect { plugin -> \"~~> ${plugin.shortName} : ${plugin.version} : ${plugin.displayName}\" + ( plugin.dependants ? \"\\n\\t+++ ${plugin.dependants.join('\\n\\t+++ ')}\" : '' ) + ( plugin.dependencies ? \"\\n\\t... ${plugin.dependencies.join('\\n\\t... ')}\" : '' ) } .join('\\n') get dependency tree import hudson.PluginWrapper def getDependencyTree( String keyword, Integer benchmark = 2, Integer index = 0 ) { String prefix = index ? '\\t' + \"|\\t\"*(index-1) + \"|... \" : '' PluginWrapper plugin = jenkins.model.Jenkins.instance.pluginManager.plugins.find { keyword == it.shortName } List dependencies = plugin.collect { it.dependencies }.flatten() ?: [] println prefix + \"${plugin.shortName} ( ${plugin.version} )\" if ( dependencies && benchmark != index ) { dependencies.collect{ it.shortName }.each { getDependencyTree (it, benchmark, index+1) } } } getDependencyTree( 'jsch', 100 ) \"DONE\" resultjsch ( 0.2.8-65.v052c39de79b_2 ) |... ssh-credentials ( 305.v8f4381501156 ) | |... credentials ( 1254.vb_96f366e7b_a_d ) | | |... structs ( 324.va_f5d6774f3a_d ) | | | |... javax-activation-api ( 1.2.0-6 ) | | | |... javax-mail-api ( 1.6.2-9 ) | | | | |... javax-activation-api ( 1.2.0-6 ) | | | |... instance-identity ( 173.va_37c494ec4e5 ) | | | | |... bouncycastle-api ( 2.28 ) | | |... configuration-as-code ( 1647.ve39ca_b_829b_42 ) | | | |... caffeine-api ( 3.1.6-115.vb_8b_b_328e59d8 ) | | | |... commons-text-api ( 1.10.0-36.vc008c8fcda_7b_ ) | | | | |... commons-lang3-api ( 3.12.0-36.vd97de6465d5b_ ) | | | | | |... javax-activation-api ( 1.2.0-6 ) | | | | | |... javax-mail-api ( 1.6.2-9 ) | | | | | | |... javax-activation-api ( 1.2.0-6 ) | | | | | |... instance-identity ( 173.va_37c494ec4e5 ) | | | | | | |... bouncycastle-api ( 2.28 ) | | | |... snakeyaml-api ( 1.33-95.va_b_a_e3e47b_fa_4 ) | |... trilead-api ( 2.84.v72119de229b_7 ) | |... instance-identity ( 173.va_37c494ec4e5 ) | | |... bouncycastle-api ( 2.28 ) |... trilead-api ( 2.84.v72119de229b_7 ) |... javax-activation-api ( 1.2.0-6 ) |... javax-mail-api ( 1.6.2-9 ) | |... javax-activation-api ( 1.2.0-6 ) |... instance-identity ( 173.va_37c494ec4e5 ) | |... bouncycastle-api ( 2.28 ) others def plugins = Jenkins.instance .pluginManager .plugins .sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase() } println \"jenkins instance : ${Jenkins.instance.getComputer('').hostName} + ${Jenkins.instance.rootUrl}\\n\" + \"installed plugins:\\n\" + \"==================\" plugins.each { plugin -> println \" ${plugin.getShortName()} : ${plugin.getVersion()} | ${plugin.getDisplayName()}\" } println \"\\nplugins dependency tree (...: dependencies; +++: dependants) :\\n\" + \"=======================\" plugins.each { plugin -> println \"\"\" ${plugin.getShortName()} : ${plugin.getVersion()} | ${plugin.getDisplayName()} +++ ${plugin.getDependants()} ... ${plugin.getDependencies()} \"\"\" } or def jenkins = Jenkins.instance println \"\"\" Jenkins Instance : ${jenkins.getComputer('').hostName} + ${jenkins.rootUrl} Installed Plugins: ================== \"\"\" jenkins.pluginManager .plugins .sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase() }.each { plugin -> println \"${plugin.getShortName()}: ${plugin.getVersion()} | ${plugin.getDisplayName()}\" } println \"\"\" Plugins Dependency tree (...: dependencies; +++: dependants) : ======================= \"\"\" jenkins.pluginManager .plugins .sort(false) { a, b -> a.getShortName().toLowerCase() b.getShortName().toLowerCase() }.each { plugin -> println \"\"\" ${plugin.getShortName()} : ${plugin.getVersion()} | ${plugin.getDisplayName()} +++ ${plugin.getDependants()} ... ${plugin.getDependencies()} \"\"\" } scriptApproval references: Class ScriptApproval ScriptApproval.java SecureGroovyScript.java jenkins.model.CauseOfInterruption backup & restore all scriptApproval items backup import java.lang.reflect.* import jenkins.model.Jenkins import jenkins.model.* import org.jenkinsci.plugins.scriptsecurity.scripts.* import org.jenkinsci.plugins.scriptsecurity.sandbox.whitelists.* import static groovy.json.JsonOutput.* scriptApproval = ScriptApproval.get() alreadyApproved = new HashSet<>(Arrays.asList(scriptApproval.getApprovedSignatures())) println prettyPrint( toJson(alreadyApproved.sort()) ) restore def scriptApproval = org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval.get() String[] signs = [ 'method org.jenkinsci.plugins.workflow.steps.FlowInterruptedException getCauses' , 'method org.jenkinsci.plugins.workflow.support.steps.input.Rejection getUser' ] for( String sign : signs ) { scriptApproval.approveSignature( sign ) } scriptApproval.save() example import java.lang.reflect.*; import jenkins.model.Jenkins; import jenkins.model.*; import org.jenkinsci.plugins.scriptsecurity.scripts.*; import org.jenkinsci.plugins.scriptsecurity.sandbox.whitelists.*; import static groovy.json.JsonOutput.* ScriptApproval scriptApproval = ScriptApproval.get() HashSet alreadyApproved = new HashSet<>(Arrays.asList(scriptApproval.getApprovedSignatures())) Closure approveSignature = { String signature -> if ( ! alreadyApproved?.contains(signature) ) scriptApproval.approveSignature( signature ) } [ 'field org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval$PendingSignature dangerous' , 'field org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval$PendingSignature signature' , 'method org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval$PendingThing getContext' , 'method org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval approveSignature java.lang.String' , 'method org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval getPendingScripts' , 'method org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval getPendingSignatures' , 'staticMethod org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval get' , 'staticMethod org.codehaus.groovy.runtime.DefaultGroovyMethods flatten java.util.Set' , 'method org.jenkinsci.plugins.workflow.support.steps.build.RunWrapper getRawBuild' ].each { println \"~~> ${it}\"; approveSignature(it) } scriptApproval.save() Jenkinsfile #!/usr/bin/env groovy import org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval timestamps { ansiColor('xterm') { def requester = currentBuild.rawBuild.getCause(UserIdCause.class)?.getUserId() ?: 'jenkins' final List description = [] try { ScriptApproval scriptApproval = ScriptApproval.get() final LinkedHashSet pendingScripts = new HashSet<>(Arrays.asList( scriptApproval.getPendingScripts() )).flatten() final LinkedHashSet pendingSignature = new HashSet<>(Arrays.asList( scriptApproval.getPendingSignatures() )).flatten() if ( ! pendingScripts && ! pendingSignature ) { currentBuild.description = 'NOT_BUILT: nothing can be approved' currentBuild.rawBuild.executor.interrupt( Result.NOT_BUILT ) } if ( pendingScripts ) { println 'scripts pending approval ...' pendingScripts.collect().each { ps -> String log = \"${ps.context.user}@${ps.context.psem.fullName} : ${ps.hash} ( ${ps.language.class.simpleName} )\" description ${log}. scripts: \\n ${ps.script}\" scriptApproval.approveScript( ps.hash ) } scriptApproval.save() } // pendingScripts if ( pendingSignature ) { println 'signatures pending approval ...' pendingSignature.collect().each { ps -> String signature = ps.signature if ( ! ps.dangerous ) { description '${signature}'\" scriptApproval.approveSignature( signature ) } else { println \"~~> '${signature}' is too dangerous to be approval automatically. contact with Jenkins administrator.\" } scriptApproval.save() } } } catch(e) { def sw = new StringWriter() e.printStackTrace( new PrintWriter(sw) ) echo sw.toString() throw e } finally { if ( description ) { currentBuild.description = \"@${requesterId} \" + \"${buildResults.isSuccess(currentBuild.currentResult) ? 'successful' : 'failed to'} \" + \"approved : '${description.join('; ')}'\" } } // try/catch/finally }} // ansiColor | timestamps // vim: ft=Jenkinsfile ts=2 sts=2 sw=2 et automatic approval // libs.groovy def autoAccept( Closure body ) { try { body() } catch ( org.jenkinsci.plugins.scriptsecurity.sandbox.RejectedAccessException e ) { String msg = \"NOT_BUILT : interrupted by approval scripts or signature\" def cause = { msg as String } as CauseOfInterruption currentBuild.rawBuild.executor.interrupt( Result.NOT_BUILT, cause ) currentBuild.description = msg build wait: false, job: '/marslo/scriptApproval' } } // jenkinsfile libs.autoAccept() { ...content... } automatic approval all pending list pending scriptApproval import org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval ScriptApproval scriptApproval = ScriptApproval.get() scriptApproval.pendingScripts.each { scriptApproval.approveScript( it.hash ) } job dsl support for scriptapproval import jenkins.model.Jenkins def scriptApproval = Jenkins.instance .getExtensionList('org.jenkinsci.plugins.scriptsecurity.scripts.ScriptApproval')[0] def hashesToApprove = scriptApproval.pendingScripts .findAll{ it.script.startsWith(approvalPrefix) } .collect{ it.getHash() } hashesToApprove.each { scriptApproval.approveScript(it) } disable the scriptApproval [!NOTE|label:@deprecated] file: $JENKINS_HOME/init.groovy.d/disable-script-security.groovy import javaposse.jobdsl.plugin.GlobalJobDslSecurityConfiguration import jenkins.model.GlobalConfiguration // disable Job DSL script approval GlobalConfiguration.all().get(GlobalJobDslSecurityConfiguration.class).useScriptSecurity=false GlobalConfiguration.all().get(GlobalJobDslSecurityConfiguration.class).save() logRotator references: Class LogRotator Jenkins : Manually run log rotation on all jobs jenkins/core/src/main/java/hudson/tasks/LogRotator.java show logRotator List projects = [ 'project' ] Jenkins.instance.getAllItems(Job.class).findAll { projects.any { p -> it.fullName.startsWith(p) } }.each { println \"\"\" ~~> ${it.fullName} : artifactDaysToKeep : ${it.logRotator?.artifactDaysToKeep ?: '' } artifactDaysToKeepStr : ${it.logRotator?.artifactDaysToKeepStr ?: '' } artifactNumToKeep : ${it.logRotator?.artifactNumToKeep ?: '' } artifactNumToKeepStr : ${it.logRotator?.artifactNumToKeepStr ?: '' } daysToKeep : ${it.logRotator?.daysToKeep ?: '' } daysToKeepStr : ${it.logRotator?.daysToKeepStr ?: '' } numToKeep : ${it.logRotator?.numToKeep ?: '' } numToKeepStr : ${it.logRotator?.numToKeepStr ?: '' } -------------------------------------------------------------------------------- getArtifactDaysToKeep() : ${it.logRotator?.getArtifactDaysToKeep() ?: '' } getArtifactDaysToKeepStr() : ${it.logRotator?.getArtifactDaysToKeepStr() ?: '' } getArtifactNumToKeep() : ${it.logRotator?.getArtifactNumToKeep() ?: '' } getArtifactNumToKeepStr() : ${it.logRotator?.getArtifactNumToKeepStr() ?: '' } getDaysToKeep() : ${it.logRotator?.getDaysToKeep() ?: '' } getDaysToKeepStr() : ${it.logRotator?.getDaysToKeepStr() ?: '' } getNumToKeep() : ${it.logRotator?.getNumToKeep() ?: '' } getNumToKeepStr() : ${it.logRotator?.getNumToKeepStr() ?: '' } \"\"\" } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/script/job.html":{"url":"jenkins/script/job.html","title":"job","keywords":"","body":" list items get name and classes list all jobs and folders list all pipeline jobs list all abstract Project list all folders list deactive jobs disable and enable jobs disable all particular projects jobs undo disable jobs in particular projects find all disabled projects/jobs get pipeline definitions get pipeline scriptPath get pipeline scm branch get pipeline scm definition get pipeline bare script get logRotator get single job properties get particular job status Find Jenkins projects that build periodically list job which running for more than 24 hours reference: groovy to list all jobs javadoc org.jenkinsci.plugins.workflow.job.WorkflowJob hudson.model.AbstractProject com.cloudbees.hudson.plugins.folder.Folder source code: AbstractBuild.java sample code: Jenkins : Failed Jobs list items get name and classes Jenkins.instance.getAllItems( Job.class ).each { println it.name + \" -> \" + it.fullName + ' ~> ' + it.class } resultmarslo - class org.jenkinsci.plugins.workflow.job.WorkflowJob fs - class hudson.model.FreeStyleProject list all jobs and folders Jenkins.instance.getAllItems( AbstractItem.class ).each { println(it.fullName) } result:marslo/marslo marslo/fs list all pipeline jobs import org.jenkinsci.plugins.workflow.job.WorkflowJob Jenkins.instance.getAllItems( WorkflowJob.class ).each { println it.fullName } list all abstract Project Abstract Project: freestyle, maven, etc... Jenkins.instance.getAllItems( AbstractProject.class ).each { println it.fullName } list all folders import com.cloudbees.hudson.plugins.folder.Folder Jenkins.instance.getAllItems( Folder.class ).each { println it.fullName + ' ~> ' + it.getClass() } list deactive jobs [!NOTE] List jobs haven't been built in 6 months final long CURRENT_TIME = System.currentTimeMillis() final long BENCH_MARK = 6*30*24*60*60 Jenkins.instance.getAllItems( Job.class ).collect { project -> project.getLastBuild() }.findAll { build -> build && ( CURRENT_TIME - build.startTimeInMillis ) / 1000 > BENCH_MARK } disable and enable jobs disable all particular projects jobs List projects = [ 'project-1', 'project-2', 'project-n' ] Jenkins.instance.getAllItems(Job.class).findAll { projects.any { p -> it.fullName.startsWith(p) } }.each { println \"~~> ${it.fullName}\" it.disabled = true it.save() } undo disable jobs in particular projects List projects = [ 'project-1', 'project-2', 'project-n' ] Jenkins.instance.getAllItems(Job.class).findAll { it.disabled && projects.any{ p -> it.fullName.startsWith(p) } }.each { println \"~~> ${it.fullName}\" it.disabled = false it.save() } find all disabled projects/jobs Jenkins.instance .getAllItems( Job.class ) .findAll { it.disabled } .collect { it.fullName } or jenkins.model .Jenkins .instance .getAllItems(jenkins.model.ParameterizedJobMixIn.ParameterizedJob.class) .findAll{ it.disabled } .each { println it.fullName; } or jenkins.model .Jenkins .instance .getAllItems(jenkins.model.ParameterizedJobMixIn.ParameterizedJob.class) .findAll{ it.disabled } .collect { it.fullName } get pipeline definitions [!TIP] How to get the pipeline configuration field 'Script Path' when executing the Jenkinsfile? Groovy script to get Jenkins pipeline's script path WorkflowDefinitionContext.groovy BuildConfigToJobMapper.java get pipeline scriptPath [!TIP] Class CpsScmFlowDefinition import org.jenkinsci.plugins.workflow.job.WorkflowJob Jenkins.instance.getAllItems(WorkflowJob.class).findAll{ it.definition instanceof org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition }.each { println it.fullName.toString().padRight(30) + ' ~> ' + it?.definition?.getScriptPath() } \"DONE\" -- result -- marslo/sandbox/sandbox ~> jenkins/jenkinsfile/sandbox.Jenkinsfile marlso/sandbox/dump ~> jenkins/jenkinsfile/dump.Jenkinsfile ... get pipeline scm branch import org.jenkinsci.plugins.workflow.job.WorkflowJob String branch = 'develop' jenkins.model.Jenkins.instance.getAllItems(WorkflowJob.class).findAll{ it.definition instanceof org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition }.findAll { ! ( it.definition?.scm instanceof hudson.scm.NullSCM ) && ! it.definition?.scm?.branches?.any{ it.getName().contains(branch) } }.each { println it.fullName.toString().padRight(50) + ' : ' + it.definition?.scm?.branches?.collect{ it.getName() }?.join(', ') } \"DONE\" -- result -- $ ssh jenkins.domain.com groovy = get pipeline scm definition [!TIP] Class SCM Class hudson.plugins.git.GitSCM Class org.eclipse.jgit.transport.RemoteConfig import org.jenkinsci.plugins.workflow.job.WorkflowJob Jenkins.instance.getAllItems(WorkflowJob.class).findAll{ it.definition instanceof org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition }.each { println it.fullName.toString().padRight(30) + (it.definition?.scm?.branches?.join() ?: '').padRight(30) + it.definition?.scm?.repositories?.collect{ it.getURIs() }?.flatten()?.join() } \"DONE\" -- result -- marslo/sandbox/sandbox */main git://github.com:marslo/pipelines marslo/sandbox/dump */dev git://github.com:marslo/pipelines ... check pipeline not get from particular branche [!TIP] hudson.plugins.git.BranchSpec import org.jenkinsci.plugins.workflow.job.WorkflowJob String branch = 'develop' Jenkins.instance.getAllItems(WorkflowJob.class).findAll{ it.definition instanceof org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition && ! ( it.definition.scm instanceof hudson.scm.NullSCM ) }.findAll { ! it.definition?.scm?.branches?.any{ it.getName().contains(branch) } }.each { println it.fullName.toString().padRight(50) + ' : ' + it.definition?.scm?.branches?.collect{ it.getName() }?.join(', ') } \"DONE\" get pipeline bare script [!TIP] Class CpsFlowDefinition import org.jenkinsci.plugins.workflow.job.WorkflowJob Jenkins.instance.getAllItems(WorkflowJob.class).findAll{ it.definition instanceof org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition }.each { println it.fullName.toString().padRight(30) + ' ~> ' + it?.definition?.getScript() } \"DONE\" get logRotator import org.jenkinsci.plugins.workflow.job.WorkflowJob import hudson.tasks.LogRotator String JOB_PATTERN = 'pattern' Jenkins.instance.getAllItems(WorkflowJob.class).findAll{ it.fullName.startsWith( JOB_PATTERN ) && it.buildDiscarder }.each { job -> LogRotator discarder = job.buildDiscarder println job.fullName.toString().padRight(30) + ' : ' + \"builds=(${discarder.daysToKeep} days, ${discarder.numToKeep} total) \" + \"artifacts=(${discarder.artifactDaysToKeep} days, ${discarder.artifactNumToKeep} total)\" } \"DONE\" get single job properties Java Code Examples for jenkins.model.Jenkins#getItemByFullName() def job = Jenkins.instance.getItemByFullName('/') println \"\"\" job.getClass() : ${job.getClass()} job.isBuildable() : ${job.isBuildable()} job.getFirstBuild() : ${job.getFirstBuild()} job.getACL() : ${job.getACL()} \"=======================\" job.getBuilds() : ${job.getBuilds()} \"\"\" get particular job status def job = Jenkins.instance.getItemByFullName('/') println \"\"\" Last success : ${job.getLastSuccessfulBuild()} All builds : ${job.getBuilds().collect{ it.getNumber() }} Last build : ${job.getLastBuild()} Is building : ${job.isBuilding()} \"\"\" Find Jenkins projects that build periodically example 1: import hudson.model.* import hudson.triggers.* TriggerDescriptor TIMER_TRIGGER_DESCRIPTOR = Hudson.instance.getDescriptorOrDie(TimerTrigger.class) for(item in Jenkins.instance.getAllItems(Job)) { def timertrigger = item.getTriggers().get(TIMER_TRIGGER_DESCRIPTOR) if (timertrigger) { if (item.class.canonicalName == \"hudson.model.FreeStyleProject\") { item.removeTrigger(TIMER_TRIGGER_DESCRIPTOR) println(item.name + \" Build periodically disabled\"); } else { println(item.name + \" Build periodically remains enabled; not as Freestyle project\"); } } } example 2: Jenkins.instance.getAllItems(Job).each{ def jobBuilds=it.getBuilds() // Check the last build only jobBuilds[0].each { build -> def runningSince = groovy.time.TimeCategory.minus( new Date(), build.getTime() ) def currentStatus = build.buildStatusSummary.message def cause = build.getCauses()[0] //we keep the cause //triggered by a user def user = cause instanceof Cause.UserIdCause? cause.getUserId():null; if( !user ) { println \"[AUTOMATION] ${build}\" } else { println \"[${user}] ${build}\" } } } return list job which running for more than 24 hours [!TIP] only for lastBuild. /* We had to write this script several times. Time to have it stored, it is a very simple approach but will serve as starting point for more refined approaches. */ Jenkins.instance.getAllItems( Job ) .findAll{ job -> job.isBuildable() } .each { job -> def myBuild= job.getLastBuild() def runningSince = groovy.time.TimeCategory.minus( new Date(), myBuild.getTime() ) if ( runningSince.hours >= 24 ){ println job.name +\"---- ${runningSince.hours} hours:${runningSince.minutes} minutes\" } } return null Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/script/build.html":{"url":"jenkins/script/build.html","title":"build","keywords":"","body":" build get build get WorkflowRun by build number get build details get culprits setup next build number build log get console output check whether if log kept check last N logs build changesets code clone via DSL get SCM info get repo url get build time sort last build sort all buildable jobs list builds list all running builds list builds via job pattern list all builds byTimestamp ( within 24 hours ) get last 24 hours failure builds get last 24 hours failure builds via Map structure stop builds abort single build abort previous running builds by params condition stop all queue and running jobs stop all running builds stop all running builds started in 24 hours get queue jobs parameters list all queue tasks and blocked reason build results get all builds result percentage get builds result percentage within 24 hours get builds result during certain start-end time list all running builds get builds result and percentage within certain start-end time build cause trigger casue get build cause get builds cause (within 24 hours) details on Cause.UserIdCause GerritCause abort cause builds aborted by timeout abort by userId CauseOfInterruption.UserInterruption get all abort causes build parameters get build parameters get builds parameters get wanted parameter values in builds get only String type parameters retrieving parameters and triggering another build remove builds delete multiple builds javadoc org.jenkinsci.plugins.workflow.job.WorkflowRun How to get details of Successful Jenkins build in last x days build.getAction(ParametersAction.class) Variables defined in groovy script always resolve to null build.buildVariableResolver.resolve groovy.lang.MissingPropertyException: No such property: jenkins for class: groovy.lang.Binding Class BuildVariableResolver batmat/get-jenkins-build-time.groovy source code: WorkflowRun.java GitSCM.java GitChangeSetList.java sample code: Jenkins : Enable Timestamper plugin on all jobs Jenkins : Display timer triggers Jenkins : Display the number of jobs using SCM Polling from Freestyle, Pipeline and Maven Jenkins : Delete workspace for all disabled jobs Jenkins : Delete .tmp files left in workspace-files Jenkins : Change publish over SSH configuration references: jenkins.model.BuildDiscarder jenkins.model.BuildDiscarderProperty build [!TIP] references: currentBuild.class == Class RunWrapper currentBuild.rawBuild.class == Jenkins.instance.getItemByFullName(String).getBuildByNumber(int).class == Class WorkflowRun references: Jenkins : Find builds currently running that has been executing for more than N seconds Jenkins : Display list of projects that were built more than 1 day ago Jenkins : Display jobs group by the build steps they use [!TIP|style:flat|label:get builds|icon:fa fa-bullhorn] inherited from hudson.model.Job : WorkflowJob.getBuilds() : [marslo/sandbox #2, marslo/sandbox #1] WorkflowJob.getBuildsAsMap() : [2:marslo/sandbox #2, 1:marslo/sandbox #1] WorkflowJob.getLastFailedBuild() : get last failed build WorkflowJob.getLastStableBuild() : get last stable build WorkflowJob.getLastSuccessfulBuild() : get last successful build WorkflowJob.getLastUnstableBuild() : get last unstalbe build WorkflowJob.getLastUnsuccessfulBuild() : get last unsuccessful build WorkflowJob.getLastCompletedBuild() : get last completed only build from org.jenkinsci.plugins.workflow.job.WorkflowJob : WorkflowJob.getBuildByNumber(int n) : get specific build by number WorkflowJob.getFirstBuild() : get first build WorkflowJob.getLastBuild() : get last build WorkflowJob.getNearestBuild(int n) : gets the youngest build #m that satisfies n WorkflowJob.getNearestOldBuild(int n) : gets the latest build #m that satisfies m get build get WorkflowRun by build number final String JOB_NAME = 'marslo/sandbox' final int BUILD_NUMBER = 6458 def build = Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( BUILD_NUMBER ) get build details import org.jenkinsci.plugins.workflow.job.WorkflowJob import hudson.util.RunList WorkflowJob job = Jenkins.instance.getItemByFullName( '/marslo/sandbox/test' ) RunList runList = job.getBuilds() println \"\"\" all builds : ${job.getBuildsAsMap().collect{ k, v -> k }} build exists : ${job.getBuilds().collect { it.id }.contains( 25.toString() )} completedOnly() : ${runList.completedOnly().collect{ it.id }} failureOnly() : ${runList.failureOnly().collect{ it.id }} getLastBuild() : ${runList.getLastBuild()} getFirstBuild() : ${runList.getFirstBuild()} getLastCompletedBuild() : ${job.getLastCompletedBuild()} getLastFailedBuild() : ${job.getLastFailedBuild()} getLastStableBuild() : ${job.getLastStableBuild()} getLastSuccessfulBuild() : ${job.getLastSuccessfulBuild()} getLastUnstableBuild() : ${job.getLastUnstableBuild()} getLastUnsuccessfulBuild() : ${job.getLastUnsuccessfulBuild()} isInQueue() : ${job.isInQueue()} getActions.causes : ${runList.collect{ run -> run.id + ': ' + run.getActions( jenkins.model.InterruptedBuildAction.class ).causes.flatten().collect{ it.class.simpleName } }} \"\"\" result: all builds : [42, 41, 40, 39, 38, 37, 36, 35, 34, 33, 32, 31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1] build exists : true completedOnly() : [42, 41, 40, 39, 38, 37, 36, 35, 34, 33, 32, 31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1] failureOnly() : [42, 41, 40, 36, 35, 34, 33, 32, 31, 30, 29, 28, 27, 26, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1] getLastBuild() : marslo/abort #42 getFirstBuild() : marslo/abort #1 getLastCompletedBuild() : marslo/abort #42 getLastFailedBuild() : marslo/abort #32 getLastStableBuild() : marslo/abort #39 getLastSuccessfulBuild() : marslo/abort #39 getLastUnstableBuild() : null getLastUnsuccessfulBuild() : marslo/abort #42 isInQueue() : false getActions.causes : [42: [ExceededTimeout], 41: [ExceededTimeout], 40: [ExceededTimeout], 36: [ExceededTimeout], 35: [ExceededTimeout], 34: [ExceededTimeout], 33: [ExceededTimeout], 32: [], 31: [], 30: [ExceededTimeout], 29: [], 28: [], 27: [], 26: [], 24: [], 23: [], 22: [ExceededTimeout], 21: [], 20: [], 19: [ExceededTimeout], 18: [ExceededTimeout], 17: [], 16: [], 15: [], 14: [], 13: [], 12: [], 11: [], 10: [ExceededTimeout], 9: [ExceededTimeout], 8: [UserInterruption], 7: [ExceededTimeout], 6: [UserInterruption], 5: [UserInterruption], 4: [ExceededTimeout], 3: [ExceededTimeout], 2: [UserInterruption], 1: [ExceededTimeout]] get culprits println build.getCulprits() setup next build number Jenkins.instance .getItemByFullName( '/path/to/job' ) .updateNextBuildNumber( n ) build log get console output references: org.kohsuke.stapler.framework.io.LargeText How To Read Console Output In Jenkins During Build [FIXED] Jenkins console output not in realtime How To Read Console Output In Jenkins During Build Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( BUILD_NUMBER ) .logFile .text check whether if log kept import org.jenkinsci.plugins.workflow.job.WorkflowJob workflowJob job = Jenkins.getInstance().getItemByFullName( '/sandbox/job' ) job.builds.findAll { Run run -> run.isKeepLog() } .collect { Run run -> run.id } or List projects = [ 'project-1', 'project-2', 'project-n' ] Jenkins.instance .getAllItems( Job.class ) .findAll { projects.any { p -> it.fullName.startsWith(p) } } .collectEntries {[ ( it.fullName.toString() ) : it.builds.findAll { Run run -> run.isKeepLog() } .collect { Run run -> run.id } ]} .findAll { it.value } .each { k, v -> println \"~~> ${k}:\\n\\t#${v.join('\\n\\t#')}\" } \"DONE\" check last N logs [!NOTE|label:original log:] 21:19:37 Running on Jenkins in /var/jenkins_home/workspace/marslo/desc [Pipeline] { [Pipeline] sh 21:19:37 + sleep 10 21:19:47 21:19:47 real 0m10.003s 21:19:47 user 0m0.000s 21:19:47 sys 0m0.003s [Pipeline] } [Pipeline] // node [Pipeline] } 21:19:47 [Pipeline] // ansiColor [Pipeline] } [Pipeline] // timestamps [Pipeline] End of Pipeline Finished: SUCCESS Jenkins.instance.getItemByFullName( ) .getBuildByNumber( ) .getLog( 30 ) .find{ it.contains('real\\t') } .split( '\\t' ) .last() .trim() // Result: 0m10.003s build changesets code clone via DSL checkout([ $class: 'GitSCM', branches: [[ name: 'refs/heads/sandbox' ]], browser: [ $class: 'GitWeb', repoUrl: 'https://my.gerrit.com/path/to/repo' ], userRemoteConfigs: [[ credentialsId: 'SSHCredential', url: 'git://my.gerrit.com/path/to/repo.git' ]] ]) references: hudson.plugins.git.GitChangeSet hudson.plugins.git.GitChangeSetList jenkins.plugins.git.AbstractGitSCMSource hudson.model.AbstractBuild get changeset in Jenkisnfile Jenkins.instance .getItemByFullName( '/marslo/up' ) .getBuildByNumber( 195 ) .changeSets .each { it.items.each { i -> println \"\"\" \\n-----------------------------\\n paths : ${i.paths} parent commit : ${i.parentCommit} commitId : ${i.commitId} : ${i.revision} author : ${i.author} authorName : ${i.authorName} authorEmail : ${i.authorEmail} committerTime : ${i.committerTime} message : ${i.msg} repoUrl : ${it.browser?.repoUrl ?: ''} affected files : \\t\\t${i.affectedFiles.collect{ f -> f.editType.name + ' : ' + f.path }.join('\\n\\t\\t\\t\\t')} \"\"\" } } get changeSets to List>: def getChangeSets( String name, int nubmer ) { Jenkins.instance .getItemByFullName( name ) .getBuildByNumber( number ) .changeSets } def changeSetsEntry( def changeSets ) { List> changeSetsEntry = [] changeSets.collect { it.items.collect { i -> changeSetsEntry += [ 'parentCommit' : i.parentCommit , 'commitId' : i.commitId , 'revision' : i.revision , 'author' : i.author.toString() , 'authorName' : i.authorName , 'authorEmail' : i.authorEmail , 'committerTime' : i.committerTime , 'msgAnnotated' : i.msg , 'affectedFiles' : i.affectedFiles.collect{ f -> ['editType' : f.editType.name, 'path' : f.path ] } ] }} return changeSetsEntry } // testing List> totalChangeSets = [] totalChangeSets += changeSetsEntry( getChangeSets('/path/to/pipeline', 123) ) totalChangeSets += changeSetsEntry( getChangeSets('/path/to/pipeline', 456) ) totalChangeSets.each { println \"\"\" it.getClass() it.author it.commitId \"\"\" } get SCM info references: jenkins.triggers.SCMTriggerItem hudson.plugins.git.GitSCM hudson.plugins.git.UserRemoteConfig Poll SCM and Timer triggers include \"Changes\" for a Pipeline for any/all Shared Libraries jenkins.scm.SCMCheckoutStrategy Jenkins.instance .getItemByFullName( '/path/to/pipeline' ) .getBuildByNumber( n ) .SCMs .each { println \"\"\" ....................... repoUrl : ${it.userRemoteConfigs.url.join(',')} remotes : ${it.userRemoteConfigs.name.join(',')} branches : ${it.branches.join(',')} ....................... \"\"\" } get repo url references: hudson.scm.SCM def job = Jenkins.instance .getItemByFullName( '/path/to/pipeline' ) .getBuildByNumber( n ) job.changeSets .each { it.items.each { i -> println \"\"\" \\n-----------------------------\\n repoUrl : ${ it.browser.repoUrl } repoUrl : ${ job.SCMs.collect { s -> s.browser?.repoUrl }.findAll().join() } url : ${ job.SCMs.collect { s -> s.browser?.url }.findAll().join() } ormalizeUrl : ${ job.SCMs.collect { s -> s.browser?.normalizeUrl } } absoluteUrl : ${ job.SCMs.collect { s -> s.browser?.getChangeSetLink(i) }.findAll().join() } commitId : ${i.commitId} : ${i.revision} \"\"\" } } result ----------------------------- repoUrl : https://my.gerrit.com/admin/repos/sandbox repoUrl : https://my.gerrit.com/admin/repos/sandbox url : https://my.gerrit.com/admin/repos/sandbox ormalizeUrl : [null, false] absoluteUrl : https://my.gerrit.com/admin/repos/sandbox?a=commit&h=095e4470964ee8ca6ab50ceea7acf88094dc08d4 commitId : 095e4470964ee8ca6ab50ceea7acf88094dc08d4 : 095e4470964ee8ca6ab50ceea7acf88094dc08d4 get build time more details can be found in imarslo: groovy programming -> time [!TIP] reference : Getting current timestamp in inline pipeline script using pipeline plugin of hudson get Job && build by number for the Job and all related to time convert milliseconds to date-time format Date.format(String format) final long NOW = System.currentTimeMillis() final int BENCH_MARK = 1*24*60*60*1000 println \"\"\" NOW : ${NOW} NOW - BENCH_MARK : ${NOW - BENCH_MARK} Date(NOW).format() : ${new Date(NOW).format(\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\")} Date(NOW-BENCH_MARK).format() : ${new Date(NOW - BENCH_MARK).format(\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\")} \"\"\" result: NOW : 1619790803151 NOW - BENCH_MARK : 1619704403151 Date(NOW).format() : 2021-04-30T06:53:23.151Z Date(NOW-BENCH_MARK).format() : 2021-04-29T06:53:23.151Z import java.time.LocalDateTime import java.time.LocalDate import java.util.Calendar final String JOB_PATTERN = '/' final LocalDateTime DATE_TIME = LocalDateTime.now() final LocalDate DATE_TAG = java.time.LocalDate.now() final long CURRENT_TIME = System.currentTimeMillis() final long RIGHT_NOW = Calendar.getInstance().getTimeInMillis() println \"\"\" ~~> current time : DATE_TIME : ${DATE_TIME} DATE_TAG : ${DATE_TAG} CURRENT_TIME : ${CURRENT_TIME} RIGHT_NOW : ${RIGHT_NOW} \"\"\" Jenkins.instance.getAllItems( Job.class ).each { job -> if ( job.fullName.contains( JOB_PATTERN ) ) { def build = job.getLastBuild() println \"\"\" ~~> ${job.getFullName()} : ${build.getId()} : build.getTimestampString() : ${build.getTimestampString()} build.getTimestampString2() : ${build.getTimestampString2()} build.getTime() : ${build.getTime()} build.startTimeInMillis : ${build.startTimeInMillis} build.startTimeInMillis.getClass() : ${build.startTimeInMillis.getClass()} duration : ${groovy.time.TimeCategory.minus( new Date(), build.getTime() )} \"\"\" } } \"DONE\" result: or : final String JOB_PATTERN = '/' // keywords Jenkins.instance.getAllItems( Job.class ).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> def build = job.getLastBuild() println \"\"\" build.getTime() : ${build.getTime()} build.getTimeInMillis() : ${build.getTimeInMillis()} build.getTimestamp() : ${build.getTimestamp()} build.getStartTimeInMillis() : ${build.getStartTimeInMillis()} build.getTimestampString() : ${build.getTimestampString()} build.getTimestampString2() : ${build.getTimestampString2()} \"\"\" } result build.getTime() : Thu Apr 29 04:08:08 PDT 2021 build.getTimeInMillis() : 1619694488799 build.getTimestamp() : java.util.GregorianCalendar[time=1619694488799,areFieldsSet=true,areAllFieldsSet=true,lenient=true,zone=sun.util.calendar.ZoneInfo[id=\"America/Los_Angeles\",offset=-28800000,dstSavings=3600000,useDaylight=true,transitions=185,lastRule=java.util.SimpleTimeZone[id=America/Los_Angeles,offset=-28800000,dstSavings=3600000,useDaylight=true,startYear=0,startMode=3,startMonth=2,startDay=8,startDayOfWeek=1,startTime=7200000,startTimeMode=0,endMode=3,endMonth=10,endDay=1,endDayOfWeek=1,endTime=7200000,endTimeMode=0]],firstDayOfWeek=1,minimalDaysInFirstWeek=1,ERA=1,YEAR=2021,MONTH=3,WEEK_OF_YEAR=18,WEEK_OF_MONTH=5,DAY_OF_MONTH=29,DAY_OF_YEAR=119,DAY_OF_WEEK=5,DAY_OF_WEEK_IN_MONTH=5,AM_PM=0,HOUR=4,HOUR_OF_DAY=4,MINUTE=8,SECOND=8,MILLISECOND=799,ZONE_OFFSET=-28800000,DST_OFFSET=3600000] build.getStartTimeInMillis() : 1619694488807 build.getTimestampString() : 2 min 1 sec build.getTimestampString2() : 2021-04-29T11:08:08Z sort last build [!TIP] references: Date.format(String format)) Convert milliseconds to yyyy-MM-dd date-time format in Groovy java.util.Date * imarslo : groovy/time details:java.util.Date : job.getLastBuild()?.getTime() java.lang.Long : job.getLastBuild()?.getTimeInMillis() Date.getTime() : java.util.Date -> java.lang.Long : job.getLastBuild()?.getTime() -> job.getLastBuild()?.getTime().getTime() Date.format(String) : java.lang.Long -> java.lang.String : job.getLastBuild()?.getTimeInMillis() -> new Date(job.getLastBuild()?.getTimeInMillis())?.format(\"yyyy-MM-dd'T'HH : mm : ss.SSS'Z'\") example:println \"${job.getLastBuild()?.getTime()} ~> ${job.getLastBuild()?.getTime()?.getClass()}\" println \"${new Date(job.getLastBuild()?.getTimeInMillis())?.format(\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\")} ~> ${new Date(job.getLastBuild()?.getTimeInMillis())?.format(\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\")?.getClass()}\" println \"${job.getLastBuild()?.getTimeInMillis()} ~> ${job.getLastBuild()?.getTimeInMillis()?.getClass()}\" println \"${job.getLastBuild()?.getTime()?.getTime()} ~> ${job.getLastBuild()?.getTime()?.getTime()?.getClass()}\" -- result -- Thu Aug 11 06:28:00 PDT 2022 ~> class java.util.Date 2022-08-11T06:28:00.220Z ~> class java.lang.String 1660224480220 ~> class java.lang.Long 1660224480220 ~> class java.lang.Long List projects = [ 'project-1', 'project-2', 'project-n' ] Jenkins.instance .getAllItems( Job.class ) .findAll { projects.any { p -> it.fullName.startsWith(p) } } .collectEntries {[ (it.fullName) : it.getLastBuild()?.getTime() ]} .sort() { a, b -> b.value?.getTime() a.value?.getTime() } // Date to timeToMillis .each { println \"${it.key.padRight(30)} ~> ${it.value}\" } \"DONE\" resultmarslo/dangling ~> Fri Nov 04 02:28:14 PDT 2022 marslo/abort ~> Thu Aug 11 06:28:00 PDT 2022 marslo/dump ~> Thu Aug 11 01:29:39 PDT 2022 marslo/agent ~> Tue Aug 09 06:19:43 PDT 2022 marslo/docker ~> null Result: DONE sort all buildable jobs Jenkins.instance .getAllItems( org.jenkinsci.plugins.workflow.job.WorkflowJob.class ) .findAll { it.isBuildable() } .collectEntries {[ (it.fullName + ' #' + it.getLastBuild()?.id) : it.getLastBuild()?.getTime() ]} .sort() { a, b -> b.value?.getTime() a.value?.getTime() } // Date to timeToMillis .each { println \"${it.key.padRight(40)} ~> ${it.value}\" } \"DONE\" list builds list all running builds jenkins.model.Jenkins.instance.computers .collect { it.executors } .flatten() .findAll { it.isBusy() } .collect { it.currentExecutable.parentExecutable } list builds via job pattern import hudson.model.Job import hudson.model.Result import hudson.model.Run import jenkins.model.Jenkins final String JOB_PATTERN = '/' Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.startsWith( JOB_PATTERN ) }.collectEntries { Job job -> [ ( job.fullName ) : job.builds.findAll { Run run -> run.isBuilding() }.collect { Run run -> run.id } ] }.findAll{ it.value } .each { println \"${it.key} : ${it.value.size()} :\\n\\t#${it.value.join(', #')}\\n\" } \"DONE\" list all builds byTimestamp ( within 24 hours ) [!TIP|label:references:] hudson.util.RunList List Jenkins job build detials for last one year along with the user who triggered the build public RunList byTimestamp(long start, long end))Filter the list by timestamp. s String JOB_PATTERN = '[/]' // keywords final long CURRENT_TIME = System.currentTimeMillis() final int BENCH_MARK = 1*24*60*60*1000 // days * hours * minutes * seconds * microseconds (1000) Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> def history = job.getBuilds().byTimestamp( CURRENT_TIME - BENCH_MARK, CURRENT_TIME ) if ( history ) { println \"\"\" ~~> ${job.fullName} : ${history.size()} : history : ${history.join('\\n\\t\\t\\t ')} \"\"\" } } get last 24 hours failure builds import hudson.model.Job import hudson.model.Result import hudson.model.Run import java.util.Calendar import jenkins.model.Jenkins final Calendar RIGHT_NOW = Calendar.getInstance() final long BENCH_MARK = 1*24*60*60*1000 final String JOB_PATTERN = '' Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.collect { Job job -> job.builds.findAll { Run run -> run.result == Result.FAILURE && ( RIGHT_NOW.getTimeInMillis() - run.getStartTimeInMillis() ) get last 24 hours failure builds via Map structure import hudson.model.Job import hudson.model.Result import hudson.model.Run import java.util.Calendar import jenkins.model.Jenkins import static groovy.json.JsonOutput.* final Calendar RIGHT_NOW = Calendar.getInstance() final long BENCH_MARK = 1*24*60*60*1000 final String JOB_PATTERN = '' Map results = [:] Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> results.(job.fullName) = job.builds.findAll { Run run -> ! run.isBuilding() && run.result == Result.FAILURE && ( RIGHT_NOW.getTimeInMillis() - run.getStartTimeInMillis() ) [ (run.id) : run.getAbsoluteUrl() ] } } println prettyPrint( toJson(results.findAll{ !it.value.isEmpty() }) ) or import hudson.model.Job import hudson.model.Result import hudson.model.Run import jenkins.model.Jenkins import static groovy.json.JsonOutput.* final long CURRENT_TIME = java.util.Calendar.getInstance().getTimeInMillis() final long BENCH_MARK = 1*24*60*60*1000 final String JOB_PATTERN = '' Map results = [:] Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> results.(job.fullName) = job.getBuilds().byTimestamp( CURRENT_TIME - BENCH_MARK, CURRENT_TIME ).findAll { Run run -> ! run.isBuilding() && run.result == Result.FAILURE }.collectEntries { Run run -> [ run.id, run.getAbsoluteUrl() ] } } println prettyPrint( toJson(results.findAll{ !it.value.isEmpty() }) ) or import hudson.model.Job import hudson.model.Result import hudson.model.Run import jenkins.model.Jenkins import static groovy.json.JsonOutput.* final long CURRENT_TIME = java.util.Calendar.getInstance().getTimeInMillis() final long BENCH_MARK = 1*24*60*60*1000 final String JOB_PATTERN = '' Map results = [:] Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains(JOB_PATTERN) }.each { Job job -> def history = job.getBuilds().byTimestamp( CURRENT_TIME - BENCH_MARK, CURRENT_TIME ) if( history ) { results.(job.fullName) = history.findAll { Run run -> !run.isBuilding() && run.result == Result.FAILURE }.collectEntries { Run run -> [ (run.id) : run.getAbsoluteUrl() ] } } } println prettyPrint( toJson(results.findAll{ !it.value.isEmpty() }) ) stop builds [!TIP] stop all queued jobs:jenkins.model.Jenkins.instance.queue.clear() stop all running builds ( in executor ) : * imarslo : force interrupt executorsjenkins.model.Jenkins.instance .computers.collect { c -> c.executors } .collectMany { it.findAll{ it.isBusy() } } .each { it.interrupt() } If your build isn’t aborting visit : https:///threadDump abort single build final String JOB_NAME = env.JOB_NAME final Integer BUILD_NUMBER = env.BUILD_NUMBER Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( BUILD_NUMBER ) .finish( hudson.model.Result.ABORTED, new java.io.IOException( \"Aborting build\" ) ) abort previous running builds by params condition [!NOTE|label:reference:] Controlling the Flow with Stage, Lock, and Milestone I have a stuck Pipeline and I can not stop it Aborting a build Cancel queued builds and aborting executing builds using Groovy for Jenkins String JOB_NAME = env.JOB_NAME String EXCLUDE_JOB_NUMBER = env.BUILD_NUMBER Map condition = [ 'str1': params.str1 ] currentBuild.description = params.collect{ \"${it.key}: ${it.value}\" }.join('') Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuilds() .findAll { Run run -> run.id run.setDescription( \"aborted by ${currentBuild.fullDisplayName} due to new pathcset triggered !\" + (run.getDescription() ?: '') ) run.finish( hudson.model.Result.ABORTED, new java.io.IOException( \"Aborting build due to new patchset has been triggered\" ) ) } abort running builds if new one is running import hudson.model.Result import jenkins.model.CauseOfInterruption // iterate through current project runs build.getProject()._getRuns().iterator().each { run -> def exec = run.getExecutor() // if the run is not a current build and it has executor (running) then stop it if( run != build && exec != null ) { // prepare the cause of interruption def cause = { \"interrupted by build #${build.getId()}\" as String } as CauseOfInterruption exec.interrupt( Result.ABORTED, cause ) } } or import hudson.model.Result import hudson.model.Run import jenkins.model.CauseOfInterruption.UserInterruption def abortPreviousBuilds() { Run previousBuild = currentBuild.rawBuild.getPreviousBuildInProgress() while ( previousBuild != null ) { if ( previousBuild.isInProgress() ) { def executor = previousBuild.getExecutor() if ( executor != null ) { echo \">> Aborting older build #${previousBuild.number}\" executor.interrupt( Result.ABORTED, new UserInterruption( \"Aborted by newer build #${currentBuild.number}\" )) } } previousBuild = previousBuild.getPreviousBuildInProgress() } } // abortPreviousBuilds or: cancel builds same job /** * Author: Isaac S Cohen * This script works with workflow to cancel other running builds for the same job * Use case: many build may go to QA, but only the build that is accepted is needed, * the other builds in the workflow should be aborted **/ def JOB_NAME = env.JOB_NAME int BUILD_NUMBER = env.BUILD_NUMBER.toInteger() def job = Jenkins.instance.getItemByFullName( JOB_NAME ) for ( build in job.builds ) { if ( !build.isBuilding() ) { continue; } if ( BUILD_NUMBER == build.getNumber().toInteger() ) { continue; println \"equals\" } build.doStop() } or: properly stop only running pipelines stop all queue and running jobs [!TIP] reference: cancel queue buildsJenkins.instance.queue.clear() import java.util.ArrayList import hudson.model.* import jenkins.model.Jenkins // Remove everything which is currently queued def q = Jenkins.instance.queue for ( queued in Jenkins.instance.queue.items ) { q.cancel( queued.task ) } // stop all the currently running jobs for ( job in Jenkins.instance.items ) { stopJobs(job) } def stopJobs( job ) { if ( job in com.cloudbees.hudson.plugins.folder.Folder ) { for ( child in job.items ) { stopJobs( child ) } } else if ( job in org.jenkinsci.plugins.workflow.multibranch.WorkflowMultiBranchProject ) { for ( child in job.items ) { stopJobs( child ) } } else if ( job in org.jenkinsci.plugins.workflow.job.WorkflowJob && job.isBuilding() ) { for ( build in job.builds ) { build.doKill() } } } stop all running builds import hudson.model.Job import hudson.model.Result import hudson.model.Run import java.util.Calendar import jenkins.model.Jenkins final Calendar RIGHT_NOW = Calendar.getInstance() final String JOB_PATTERN = '/' Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.startsWith( JOB_PATTERN ) }.collect { Job job -> job.builds.findAll { Run run -> run.isBuilding() } .collect { Run run -> run.setDescription( 'aborted by Jenkins restart' + run.getDescription() ) // or run.doStop(), run.doTerm(), run.doKill() run.finish( hudson.model.Result.ABORTED, new java.io.IOException( \"aborted by Jenkins restart\" ) ) } } or cancel builds in same job /* Author: Isaac S Cohen This script works with workflow to cancel other running builds for the same job Use case: many build may go to QA, but only the build that is accepted is needed, the other builds in the workflow should be aborted */ final String JOB_NAME = env.JOB_NAME final int BUILD_NUMBER = env.BUILD_NUMBER.toInteger() def job = Jenkins.instance.getItemByFullName( JOB_NAME ) for ( build in job.builds ) { if ( !build.isBuilding() ) { continue } if ( BUILD_NUMBER == build.getNumber().toInteger() ) { continue; println \"equals\" } build.doStop() } stop all running builds started in 24 hours import hudson.model.Job import hudson.model.Result import hudson.model.Run import java.util.Calendar import jenkins.model.Jenkins final Calendar RIGHT_NOW = Calendar.getInstance() final long BENCH_MARK = 1*24*60*60*1000 final String JOB_PATTERN = '/' Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.startsWith( JOB_PATTERN ) }.collect { Job job -> job.builds.findAll { Run run -> run.isBuilding() && ( RIGHT_NOW.getTimeInMillis() - run.getStartTimeInMillis() ) run.setDescription( 'aborted by Jenkins restart' + run.getDescription() ) run.finish( hudson.model.Result.ABORTED, new java.io.IOException( \"aborted by Jenkins restart\" ) ) } } get all running builds within 24 hours import hudson.model.Job import hudson.model.Result import hudson.model.Run import java.util.Calendar import jenkins.model.Jenkins final Calendar RIGHT_NOW = Calendar.getInstance() final long BENCH_MARK = 1*24*60*60*1000 final String JOB_PATTERN = '/' Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.startsWith( JOB_PATTERN ) }.collect { Job job -> job.builds.findAll { Run run -> run.isBuilding() && ( RIGHT_NOW.getTimeInMillis() - run.getStartTimeInMillis() ) get queue jobs parameters refernece: cg-soft/explore.groovy def q = Jenkins.instance.queue q.items.each { println(\"${it.task.name}:\") println(\"Parameters: ${it.params}\") } list all queue tasks and blocked reason Jenkins.instance.queue.items.each { println \"\"\" getId : ${it.getId()} isBuildable : ${it.isBuildable()} getFullDisplayName : ${it.task.getFullDisplayName()} getDisplayName : ${it.task.getDisplayName()} isConcurrentBuild : ${it.task.isConcurrentBuild()} getAffinityKey : ${it.task.getAffinityKey()} getUrl : ${it.task.getUrl()} getWhyBlocked : ${it.task.getWhyBlocked()} getCauseOfBlockage() : ${it.task.getCauseOfBlockage()} \"\"\" // println it.task.metaClass.methods*.name.sort().unique() } result: getId : 80210 isBuildable : false getFullDisplayName : marslo » sandbox » test getDisplayName : test isConcurrentBuild : false getAffinityKey : marslo » sandbox » test getUrl : job/marslo/job/sandbox/job/test/ getWhyBlocked : Build #27 is already in progress (ETA: 3 min 28 sec) getCauseOfBlockage() : Build #27 is already in progress (ETA: 3 min 28 sec) build results get all builds result percentage final String JOB_PATTERN = '/' Map> results = [:] int sum = 0 Jenkins.instance.getAllItems( Job.class ).findAll{ project -> project.fullName.contains( JOB_PATTERN ) // or // project.fullName.startsWith( JOB_PATTERN ) }.each { project -> results.\"${project.fullName}\" = [ SUCCESS:0, UNSTABLE:0, FAILURE:0, ABORTED:0, INPROGRESS:0, NOT_BUILT:0 ] def build = project.getLastBuild() while ( build ) { // if job is building, then results.\"${project.fullName}\".\"${build.result}\" will be null if ( build.isBuilding() ) { results.\"${project.fullName}\".INPROGRESS = results.\"${project.fullName}\".INPROGRESS + 1 } else { // println \"$project.name;$build.id;$build.result\" results.\"${project.fullName}\".\"${build.result}\" = results.\"${project.fullName}\".\"${build.result}\" + 1 } build = build.getPreviousBuild() } } results.each{ name, status -> sum = status.values().sum() println \"${name}: ${sum} : \" status.each{ r, c -> if ( c ) println \"\\t${r.padRight(11)}: ${c.toString().padRight(10)}: percentage: \" + (sum ? \"${c * 100 / sum}%\" : '0%') } } \"DONE\" result get builds result percentage within 24 hours final String JOB_PATTERN = '' final long CURRENT_TIME = System.currentTimeMillis() final int BENCH_MARK = 1*24*60*60*1000 Map> results = [:] int sum = 0 Jenkins.instance.getAllItems( Job.class ).findAll{ project -> project.fullName.startsWith( JOB_PATTERN ) // or // project.fullName.contains( JOB_PATTERN ) }.each { project -> if ( project.getBuilds().byTimestamp(CURRENT_TIME - BENCH_MARK, CURRENT_TIME).size() > 0 ) { results.\"${project.fullName}\" = [ SUCCESS:0, UNSTABLE:0, FAILURE:0, ABORTED:0, INPROGRESS:0, NOT_BUILT:0 ] def build = project.getLastBuild() while ( build && (CURRENT_TIME - build.startTimeInMillis) sum = status.values().sum() println \"\\n~~> ${name}: ${sum} : \" status.each{ r, c -> if ( c ) println \"\\t${r.padRight(11)}: ${c.toString().padRight(5)}: percentage: \" + ( sum ? \"${c * 100 / sum}%\" : '0%' ) } } \"DONE\" result get builds result during certain start-end time [!TIP] find only String type parameters: Map params = build?.getAction( ParametersAction.class )?.parameters?.findAll{ it instanceof StringParameterValue }?.dump() import java.text.SimpleDateFormat import java.util.Date import static groovy.json.JsonOutput.* final String JOB_PATTERN = '[/]' // keywords final Map PARAM = [ 'param_name' : 'param_value' ] Map> results = [:] SimpleDateFormat simpleDateFormat = new SimpleDateFormat( \"yyyy-MM-dd HH:mm:ss\" ) final String START_DATE = '2021-04-26 00:00:00' final String END_DATE = '2021-04-27 00:00:00' long start = simpleDateFormat.parse( START_DATE ).getTime() long end = simpleDateFormat.parse( END_DATE ).getTime() Jenkins.instance.getAllItems( Job.class ).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> results.\"${job.fullName}\" = [:] job.getBuilds().byTimestamp( start, end ).each { Run build -> Map params = build?.getAction( ParametersAction.class )?.parameters?.findAll{ it instanceof StringParameterValue }?.collectEntries { [ it.name, it.value ] } results.\"${job.fullName}\".\"${build.getId()}\" = [ 'time' : build.getTime().toString() , 'params' : params?.collect { k, v -> \"${k} : ${v}\"}, 'paramsExist': params?.entrySet()?.containsAll( PARAM.entrySet() ) ] if ( build.isBuilding() ) { results.\"${job.fullName}\".\"${build.getId()}\" if ( v.paramsExist ) { count += 1 println \"\"\" #${k} : ${v.status} : ${v.time} ${v.params} \"\"\" } } println \"total number: ${count}\" \"DONE\" result: list all running builds import static groovy.json.JsonOutput.* final String JOB_PATTERN = '[/]' // project/job keywords Map> results = [:] Jenkins.instance.getAllItems(Job.class).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> results.(job.fullName) = job.builds.findAll { Run run -> run.isBuilding() // or `run.result.equals(null)` }.collectEntries { Run run -> [ (run.id) : run.getAbsoluteUrl() ] } } results.findAll{ !it.value.isEmpty() } .each { name, builds -> println \"\"\" ~~> ${name} : ${builds.size()} ${builds.collect{ \"#${it.key} : ${it.value}\" }.join('\\n' + ' '*16)} \"\"\" } \"DONE\" get builds result and percentage within certain start-end time import java.util.Date import java.text.DecimalFormat import java.text.SimpleDateFormat import static groovy.json.JsonOutput.* DecimalFormat df = new DecimalFormat(\"0.00\") // keep two decimal places SimpleDateFormat simpleDateFormat = new SimpleDateFormat( \"yyyy-MM-dd HH:mm:ss\" ) final String JOB_PATTERN = '[/]' // project/job keywords final Map PARAM = [ 'param_name' : 'param_value' ] // setup PARAM as non-empty to list all wanted results // final Map PARAM = [ : ] // setup PARAM as empty to list all results without params validation final long START final long END Map> results = [:] Map> status = [:] // start-end time format for x days/hours/minutes ago final long NOW_TIME = System.currentTimeMillis() final int BENCH_MARK = 1*24*60*60*1000 // | | | | + milliseconds // | | | + seconds // | | + minutes // | + housrs // + days // start-end time format for time-x to time-y // final String START_TIME = '2021-04-26 00:00:00' // final String END_TIME = '2021-04-29 00:00:00' if ( NOW_TIME && BENCH_MARK ) { START = NOW_TIME - BENCH_MARK END = NOW_TIME } else if ( START_TIME && END_TIME ) { START = simpleDateFormat.parse( START_TIME ).getTime() END = simpleDateFormat.parse( END_TIME ).getTime() } else { return } Jenkins.instance.getAllItems( Job.class ).findAll { Job job -> job.fullName.contains( JOB_PATTERN ) }.each { Job job -> results.\"${job.fullName}\" = [:] job.getBuilds().byTimestamp( START, END ).each { Run build -> Map params = PARAM ? build?.getAction( ParametersAction.class )?.parameters?.findAll{ it instanceof StringParameterValue }?.collectEntries { [ it.name, it.value ] } : [:] results.\"${job.fullName}\".\"${build.getId()}\" = [ 'time' : build.getTime().toString() , 'params' : params , 'paramsExist': params?.entrySet()?.containsAll( PARAM.entrySet() ) ] if ( build.isBuilding() ) { results.\"${job.fullName}\".\"${build.getId()}\" \"${k} ~> ${v}\"}.join(' ')}\" : 'for all builds' ) + ' :' results.each { name, values -> status.\"${name}\" = [ SUCCESS:0, UNSTABLE:0, FAILURE:0, ABORTED:0, INPROGRESS:0, NOT_BUILT:0 ] Map wanted = values.findAll { k, v -> v.get('paramsExist') == true } wanted.each { k, v -> status.\"${name}\".\"${v.status}\" += 1 } println \"\\n~~> ${name} : ${wanted.size()} : \" status.\"${name}\".each { r, c -> if (c) { println '\\t\\t' + r + ' :\\ttotal : ' + c + '\\tpercentage : ' + (wanted.size() ? \"${df.format(c * 100 / wanted.size())}%\" : '0%') + '\\n' + '\\t\\t\\t\\tbuilds :\\t' + wanted.findAll { k, v -> v.get('status') == r }?.keySet()?.collect{ \"#${it}\" }.join(', ') } // print only exists status } \"DONE\" result build cause trigger casue references: Cause.UpstreamCause Cause.UserIdCause RebuildCause ReplayCause TimerTrigger.TimerTriggerCause ParameterizedTimerTriggerCause see also imarslo: jenkinsfile/triggered by import org.jenkinsci.plugins.parameterizedscheduler.ParameterizedTimerTriggerCause import hudson.model.Cause.UpstreamCause import org.jenkinsci.plugins.workflow.cps.replay.ReplayCause import com.sonyericsson.rebuild.RebuildCause import hudson.model.Cause.UserIdCause import com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.GerritCause import org.jenkinsci.plugins.workflow.job.WorkflowJob import hudson.util.RunList WorkflowJob job = Jenkins.instance.getItemByFullName( '/path/to/job' ) RunList builds = job.getBuilds() builds.each { build -> println build.number println build.getCauses() println build.getCauses().collect { it.getClass().getCanonicalName() } println \"byUser : ${build.getCause( UserIdCause.class ) && true }\" println \"byRebuild : ${build.getCause( RebuildCause.class ) && true }\" println \"byReplay : ${build.getCause( ReplayCause.class ) && true }\" println \"byUpstream : ${build.getCause( Cause.UpstreamCause.class ) && true }\" println \"byGerritCause : ${build.getCause( GerritCause.class ) && true }\" } \"DONE\" get build cause List projects = [ 'project-1', 'project-2', 'project-n' ] Jenkins.instance.getAllItems( Job.class ).findAll { projects.any { p -> it.fullName.startsWith(p) } }.each { println it.name + \"\\t -> \" + it.fullName + \"\\t ~> \" + ( it.getLastBuild()?.getCauses()?.collect { it.getClass().getCanonicalName() }?.join(', ') ?: 'no build' ) } \"DONE\" result user-trigger -> marslo/user-trigger ~> hudson.model.Cause.UserIdCause sandbox -> marslo/sandbox ~> hudson.model.Cause.UserIdCause, org.jenkinsci.plugins.workflow.cps.replay.ReplayCause whitebox -> marslo/whitebox ~> org.jenkinsci.plugins.workflow.support.steps.build.BuildUpstreamCause, hudson.model.Cause.UserIdCause, com.sonyericsson.rebuild.RebuildCause replay -> marslo/reply ~> org.jenkinsci.plugins.workflow.cps.replay.ReplayCause, hudson.model.Cause.UserIdCause, com.sonyericsson.rebuild.RebuildCause no-build -> marslo/no-build ~> no build rebuild -> marslo/rebuild ~> org.jenkinsci.plugins.workflow.cps.replay.ReplayCause, hudson.model.Cause.UserIdCause, com.sonyericsson.rebuild.RebuildCause upstream -> marslo/upstream ~> org.jenkinsci.plugins.workflow.support.steps.build.BuildUpstreamCause Result: DONE or List projects = [ 'project-1', 'project-2', 'project-n' ] Jenkins.instance.getAllItems( Job.class ).findAll { projects.any { p -> it.fullName.startsWith(p) } }.each { println it.name + \"\\t -> \" + it.fullName + \" :\\n\\t\\t\" + ( it.getLastBuild()?.getCauses()?.collect { it.getClass().getCanonicalName() }.join('\\n\\t\\t') ?: 'no-builds' ) } \"DONE\" get builds cause (within 24 hours) import hudson.model.Job import hudson.model.Run import java.util.Calendar import jenkins.model.Jenkins final List PROJECTS = [ 'project-1' ] final long BENCH_MARK = 1*24*60*60*1000 final Calendar RIGHT_NOW = Calendar.getInstance() Jenkins.instance.getAllItems(Job.class).findAll { Job job -> PROJECTS.any { job.fullName.startsWith(it) } }.collectEntries { Job job -> [ ( job.fullName ) : job.builds.findAll { Run run -> ( RIGHT_NOW.getTimeInMillis() - run.getStartTimeInMillis() ) [ (run.id) : run.getCauses()?.collect { it.getClass().getSimpleName() }?.join(' -> ') ] } ] }.collectEntries { k, v -> [ (k) : v.groupBy( {it.value} ) .collectEntries{ x, y -> [ (x) : y.keySet() ] } ] }.each{ k, v -> println \"~~> ${k} : ${v.values().flatten().size()}\" println v.collect { \"\\t${it.key} : \\n\\t\\t${it.value.join('\\n\\t\\t')}\" }.join('\\n') } \"DONE\" result~~> project-1 : 4 BuildUpstreamCause : 122 123 BuildUpstreamCause -> UserIdCause -> RebuildCause : 124 UserIdCause -> ReplayCause : 125 Result: DONE details on Cause.UserIdCause Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( JOB_NUMBER ) .getActions( hudson.model.CauseAction.class ) .causes .flatten() .each { c -> println c.userId println c.getUserName() println c.getShortDescription() println c.getUserUrl() } GerritCause references: gerrit-events/Change.java gerrit-events/GerritTriggeredEvent.java gerrit-events/Provider.java APIs: All Classes GerritCause GerritUserCause GerritManualCause ManualPatchsetCreated TriggerContext ManualTriggerAction GerritEventLifecycleListener GerritProject import org.jenkinsci.plugins.workflow.job.WorkflowJob import hudson.util.RunList import com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.GerritCause import com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.GerritUserCause import com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.GerritManualCause import com.sonymobile.tools.gerrit.gerritevents.dto.events.CommentAdded import com.sonymobile.tools.gerrit.gerritevents.dto.events.RefUpdated import com.sonymobile.tools.gerrit.gerritevents.dto.events.PatchsetCreated WorkflowJob job = Jenkins.instance.getItemByFullName( '/path/to/pipeline' ) RunList builds = job.getBuilds() builds.each { build -> if ( build.getCause( GerritCause.class ) && true ) { println build.number println \"context : ${build.getCause( GerritCause.class ).getContext()}\" println \" build number : ${build.getCause( GerritCause.class ).getContext().getThisBuild().getBuildNumber().toString()}\" println \" project name : ${build.getCause( GerritCause.class ).getContext().getThisBuild().getProjectId()}\" println \"description : ${build.getCause( GerritCause.class ).getShortDescription()}\" println \"url : ${build.getCause( GerritCause.class ).getUrl()}\" println \"events : ${build.getCause( GerritCause.class ).getEvent().getClass()}\" println \" byCommentAdded : \" + ( build.getCause(GerritCause.class).getEvent() instanceof CommentAdded ).toString() println \" byRefUpdated : \" + ( build.getCause(GerritCause.class).getEvent() instanceof RefUpdated ).toString() println \" byPathUpdated : \" + ( build.getCause(GerritCause.class).getEvent() instanceof PatchsetCreated).toString() println \" server hostname : \" + build.getCause( GerritCause.class ).getEvent().getProvider().host println \" server port : \" + build.getCause( GerritCause.class ).getEvent().getProvider().port println \" server version : \" + build.getCause( GerritCause.class ).getEvent().getProvider().version println '.'*10 println \"userCause? : ${build.getCause( GerritUserCause.class ) && true}\" if (build.getCause( GerritUserCause.class ) && true) { println \" comments : \" + build.getCause( GerritUserCause.class )?.getEvent().comment println \" approvals : \" + build.getCause( GerritUserCause.class )?.getEvent().approvals println \" change : \" + build.getCause( GerritUserCause.class )?.getEvent().change println \" usernmae : \" + build.getCause( GerritUserCause.class )?.getUserName() println \" description : \" + build.getCause( GerritUserCause.class )?.getShortGerritDescription() println \" changer account : \" + build.getCause( GerritUserCause.class )?.getEvent().getAccount().name println \" changer email : \" + build.getCause( GerritUserCause.class )?.getEvent().getAccount().email } println '.'*10 println \"manualCause? : ${build.getCause( GerritManualCause.class ) && true}\" println '~'*30 } } \"DONE\" 10121 context : com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.data.TriggerContext@6fbdc2a5 build number : 10121 project name : /path/to/project description : Retriggered by user marslo for Gerrit: https://my.gerrit.com/c/my/project/+/72667 url : https://my.gerrit.com/c/my/project/+/72667 events : class com.sonymobile.tools.gerrit.gerritevents.dto.events.CommentAdded byCommentAdded : true byRefUpdated : false byPathUpdated : false server hostname : my.gerrit.com server port : 29418 server version : 2.16.27-RP-1.10.1.1 .......... userCause? : true comments : Patch Set 104: Code-Review+2 approvals : [Approval: Verified 0, Approval: Code-Review 2] change : Change-Id for #72667: I68e47b094e142a63cec7c698094320d79f5350f8 usernmae : marslo description : Retriggered by user marslo for Gerrit: https://my.gerrit.com/c/my/project/+/72667 changer account : Marslo Jiao changer email : marslo@gmail.com .......... manualCause? : false ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 10120 context : com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.data.TriggerContext@26ab2c12 build number : 10120 project name : /path/to/project description : Triggered by Gerrit: https://my.gerrit.com/c/my/project/+/123069 url : https://my.gerrit.com/c/my/project/+/123069 events : class com.sonymobile.tools.gerrit.gerritevents.dto.events.CommentAdded byCommentAdded : true byRefUpdated : false byPathUpdated : false server hostname : my.gerrit.com server port : 29418 server version : 2.16.27-RP-1.10.1.1 .......... userCause? : false .......... manualCause? : false ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ abort cause references: FlowInterruptedException cause is not available in post condition org.jenkinsci.plugins.workflow.support.steps.build.BuildTriggerCancelledCause org.jenkinsci.plugins.workflow.support.steps.build.DownstreamFailureCause Halt a jenkins pipeline job early Thread.getAllStackTraces() Pipeline: How to add an input step, with timeout, that continues if timeout is reached, using a default value How to time out Jenkins Pipeline stage and keep the pipeline running? Pipeline retry operation doesn't retry when there is a timeout inside of it jenkins.model.InterruptedBuildAction Class InterruptedBuildAction Cancelling of concurrent pipeline run due to milestone wrongly claims that user aborted via FlowInterruptedException#actualInterruption Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( BUILD_NUMBER ) .getActions( jenkins.model.InterruptedBuildAction.class ) .causes .flatten() builds aborted by timeout import org.jenkinsci.plugins.workflow.steps.TimeoutStepExecution Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( BUILD_NUMBER ) .getActions( jenkins.model.InterruptedBuildAction.class ) .causes .flatten() .any { it instanceof TimeoutStepExecution.ExceededTimeout } or import org.jenkinsci.plugins.workflow.steps.TimeoutStepExecution import org.jenkinsci.plugins.workflow.job.WorkflowJob WorkflowJob job = Jenkins.instance.getItemByFullName( JOB_NAME ) job.builds.findAll { Run run -> BUILD_NUMBER.toString() == run.id }.collect { Run run -> run.getActions( jenkins.model.InterruptedBuildAction.class ) .causes .flatten() .any { it instanceof TimeoutStepExecution.ExceededTimeout } } abort by userId CauseOfInterruption.UserInterruption import org.jenkinsci.plugins.workflow.support.steps.build.BuildTriggerCancelledCause import jenkins.model.CauseOfInterruption Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( BUILD_NUMBER ) .getActions( jenkins.model.InterruptedBuildAction.class ) .causes .flatten() .any { c -> [ CauseOfInterruption.UserInterruption, BuildTriggerCancelledCause ].any { it.isAssignableFrom( c.getClass() ) } } get user details import jenkins.model.CauseOfInterruption Jenkins.instance .getItemByFullName( '/marslo/sandbox/abort' ) .getBuildByNumber(159) .getActions( jenkins.model.InterruptedBuildAction.class ) .causes .flatten() .findAll { c -> [ CauseOfInterruption.UserInterruption ].any { it.isAssignableFrom(c.getClass()) } } .each { c -> User user = c.user println c.getShortDescription() println \"${user.fullName} : ${user.absoluteUrl}\" currentBuild.description = 'ABORTED by user : ' + \"${user.displayName} [ ${user.id} ]\" currentBuild.result = 'NOT_BUILT' } get all abort causes import org.jenkinsci.plugins.workflow.job.WorkflowJob WorkflowJob job = Jenkins.instance.getItemByFullName( JOB_NAME ) job.builds.findAll { Run run -> run.getActions( jenkins.model.InterruptedBuildAction.class ).causes }.collect{ Run run -> List c = run.getActions( jenkins.model.InterruptedBuildAction.class ).causes \"#${run.id} : ${c.flatten().collect{ it.class.simpleName }.first()}\" }.join('\\n') result#42 : ExceededTimeout #41 : ExceededTimeout #40 : ExceededTimeout #36 : ExceededTimeout #35 : ExceededTimeout #34 : ExceededTimeout #33 : ExceededTimeout #30 : ExceededTimeout #22 : ExceededTimeout #19 : ExceededTimeout #18 : ExceededTimeout #10 : ExceededTimeout #9 : ExceededTimeout #8 : UserInterruption #7 : ExceededTimeout #6 : UserInterruption #5 : UserInterruption #4 : ExceededTimeout #3 : ExceededTimeout #2 : UserInterruption #1 : ExceededTimeout build parameters get build parameters reference: build?.actions.find{ it instanceof ParametersAction } Jenkins & Groovy – accessing build parameters Parameterized System Groovy script Jenkins : Display job parameters Let users specify any kind of parameters when creating a job from a pipeline template and handle them in the job created GenericBuild.groovy def job = Jenkins.getInstance().getItemByFullName( '/marlso/sandbox' ) job.builds.each { Run run -> String parameters = run?.getAction(ParametersAction.class)?.parameters?.collectEntries { [ it.name, it.value ] }.collect { k, v -> \"\\t\\t${k}\\t: ${v}\" } .join('\\n') println \"#${run.id}: ${parameters}\" } \"DONE\" result #7: id : marslo gender : female #6: id : marslo gender : female #5: id : marslo gender : female #4: id : marslo gender : female #3: name : marslo gender : female #2: name : marslo gender : female #1: or via action instanceof ParametersAction def job = Jenkins.getInstance().getItemByFullName( 'others-tests/sandbox' ) job.getBuilds().each { Run build -> String parameters = build?.actions.find{ it instanceof ParametersAction }?.parameters?.collectEntries { [ it.name, it.value ] }.collect { k, v -> \"\\t\\t${k}\\t: ${v}\" } .join('\\n') println \"#${build.getId()}: ${parameters}\" } or by using Job Parameter Summary Plugin import hudson.model.* for( item in Hudson.instance.items ) { prop = item.getProperty( ParametersDefinitionProperty.class ) if( prop ) { println( \"--- Parameters for \" + item.name + \" ---\" ) for( param in prop.getParameterDefinitions() ) { try { println( param.name + \" \" + param.defaultValue ) } catch( Exception e ) { println( param.name ) } } println() } } result --- Parameters for GRA-00-UploadIntoClearCase --- ONCSDAP1_USER jdoe ONCSDAP1_PASSWORD GRA_ZIP_NAME GRA_Delivery_r.2.0.0_28-5_impl.zip GRA_RELEASE n.28 --- Parameters for IN8-03-DeployXnetWebAppToRecette --- STOP_START_AS get builds parameters [!TIP] running following snippet in Jenkinsfile params.each { param -> println \" ~~> '${param.key.trim()}' -> '${param.value}' \" } or : Jenkins : Parameterized System Groovy scriptdef parameters = currentBuild.rawBuild?.getActions(ParametersAction.class)?.parameters parameters.each { println \" ~~> ${it.name} -> ${it.value} -> ${it.description ?: ''} \" println \"-\" * 20 } ordef parameters = currentBuild.rawBuild?.actions.find{ it instanceof ParametersAction }?.parameters get wanted parameter values in builds final String PARAM = 'id' Map params = [:] def job = Jenkins.getInstance().getItemByFullName( 'others-tests/sandbox' ) job.getBuilds().each { Run build -> params.\"${build.getId()}\" = build?.getActions(ParametersAction.class)?.parameters?.collectEntries { [ it.name , it.value ] } } println params.collect { k , v -> \"build #${k} ~~> ${v ? \"${PARAM} : ${v.getOrDefault(PARAM, \"No '${PARAM}' found\")}\" : 'No Params Found'}\" }.join('\\n') resultbuild #7 ~~> id : marslo build #6 ~~> id : marslo build #5 ~~> id : marslo build #4 ~~> id : marslo build #3 ~~> id : No 'id' found build #2 ~~> id : No 'id' found build #1 ~~> No Params Found get only String type parameters Map params = build?.getAction( ParametersAction.class ) .parameters?.findAll{ it instanceof StringParameterValue }?.dump() or Map params = build?.getAction( ParametersAction.class ) .parameters?.findAll{ it instanceof StringParameterValue }?.collectEntries { [ it.name, it.value ] } or Map params = build?.actions .find{ it instanceof ParametersAction }?.parameters?.findAll{ it instanceof StringParameterValue }?.dump() retrieving parameters and triggering another build import hudson.model.* import hudson.AbortException import hudson.console.HyperlinkNote import java.util.concurrent.CancellationException // Retrieve parameters of the current build def foo = build.buildVariableResolver.resolve(\"FOO\") println \"FOO=$foo\" // Start another job def job = Hudson.instance.getJob('MyJobName') def anotherBuild try { def params = [ new StringParameterValue('FOO', foo), ] def future = job.scheduleBuild2(0, new Cause.UpstreamCause(build), new ParametersAction(params)) println \"Waiting for the completion of \" + HyperlinkNote.encodeTo('/' + job.url, job.fullDisplayName) anotherBuild = future.get() } catch (CancellationException x) { throw new AbortException(\"${job.fullDisplayName} aborted.\") } println HyperlinkNote.encodeTo('/' + anotherBuild.url, anotherBuild.fullDisplayName) + \" completed. Result was \" + anotherBuild.result // Check that it succeeded build.result = anotherBuild.result if (anotherBuild.result != Result.SUCCESS && anotherBuild.result != Result.UNSTABLE) { // We abort this build right here and now. throw new AbortException(\"${anotherBuild.fullDisplayName} failed.\") } // Do something with the output. // On the contrary to Parameterized Trigger Plugin, you may now do something from that other build instance. // Like the parsing the build log (see http://javadoc.jenkins-ci.org/hudson/model/FreeStyleBuild.html ) // You probably may also wish to update the current job's environment. build.addAction(new ParametersAction(new StringParameterValue('BAR', '3'))) remove builds delete multiple builds import org.jenkinsci.plugins.workflow.job.WorkflowJob final String JOB_PATTERN = '/' WorkflowJob project = Jenkins.instance.getItemByFullName( JOB_PATTERN ) final int START_BUILD = final int END_BUILD = project.getLastCompletedBuild().getId().toInteger() ( START_BUILD..END_BUILD ).each { project.getBuildByNumber( it ).delete() } setup next build number if necessaryJenkins.instance.getItemByFullName( JOB_PATTERN ).updateNextBuildNumber( START_BUILD+1 ) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/script/stage.html":{"url":"jenkins/script/stage.html","title":"stage","keywords":"","body":" build stage show build stages details get parent stage ID get stage build status via parent stage name build stage [!NOTE|label:references:] Access Stage results in Workflow/ Pipeline plugin pipeline中任务分段日志获取 GuillaumeSmaha/build-stages-status.groovy Access Stage name during the build in Jenkins pipeline jenkinsci/plugins/workflow/cps/FlowDurabilityTest.java show build stages details import org.jenkinsci.plugins.workflow.job.* import org.jenkinsci.plugins.workflow.flow.* import io.jenkins.blueocean.rest.impl.pipeline.* import org.jenkinsci.plugins.workflow.cps.* import org.jenkinsci.plugins.workflow.graph.FlowNode; final String JOB_NAME = '/marslo/sandbox' final int BUILD_NUMBER = 17 WorkflowRun run = Jenkins.instance .getItemByFullName( JOB_NAME ) .getBuildByNumber( BUILD_NUMBER ) PipelineNodeGraphVisitor visitor = new PipelineNodeGraphVisitor(run) List flowNodes = visitor.getPipelineNodes() flowNodes.each { println \"\"\" ${it.getDisplayName()} : getRun() : ${it.getRun()} getResult : ${it.status.getResult()} getState : ${it.status.getState()} getType : ${it.getType()} getId : ${it.getId()} isActive : ${it.node.active} searchUrl : ${it.node.getSearchUrl()} getUrl : ${Jenkins.instance.getRootUrl() + it.node.getUrl()} iconColor : ${it.node.getIconColor()} \"\"\" // println \"\"\" // getError : ${it.node.getError()} // getAction : ${it.node.getActions()} // getDisplayFunctionName : ${it.node.getDisplayFunctionName()} // getTypeDisplayName : ${it.node.getTypeDisplayName()} // getTypeFunctionName : ${it.node.getTypeFunctionName()} // it.node.metaClass.methods.name : ${it.node.metaClass.methods*.name.sort().unique()} // it.getClass() : ${it.getClass()} // \"\"\" println \" parents : \" + it.getParents().collect { p -> [ 'name' : p.displayName, 'status' : p.status.getResult(), 'id' : p.id, 'active' : p.node.active ] }.flatten() println '--------------' } result get parent stage ID import org.jenkinsci.plugins.workflow.job.* import org.jenkinsci.plugins.workflow.flow.* import org.jenkinsci.plugins.workflow.cps.* import org.jenkinsci.plugins.workflow.graph.FlowNode; import io.jenkins.blueocean.rest.impl.pipeline.* import io.jenkins.blueocean.rest.model.* import io.jenkins.blueocean.rest.model.BlueRun.* def withFlowNodes( String name, int buildNumber, Closure body ) { WorkflowRun run = Jenkins.instance .getItemByFullName( name ) .getBuildByNumber( buildNumber ) PipelineNodeGraphVisitor visitor = new PipelineNodeGraphVisitor( run ) List flowNodes = visitor.getPipelineNodes() body( flowNodes ) } def isStageFinished( String keyword, String job, int buildNumber, String type = 'parallel' ) { withFlowNodes ( job, buildNumber ) { flowNodes -> List parentIds = flowNodes.findAll { it.displayName.startsWith(keyword) && it.getType() == FlowNodeWrapper.NodeType.valueOf( type.toUpperCase() ) }.collectMany { it.parents.collect{ p -> p.id } }.unique() flowNodes.findAll { parentIds.contains( it.id ) }.every { it.status.getState() == BlueRun.BlueRunState.FINISHED } } // withFlowNodes } get stage build status via parent stage name import org.jenkinsci.plugins.workflow.job.* import org.jenkinsci.plugins.workflow.flow.* import org.jenkinsci.plugins.workflow.cps.* import org.jenkinsci.plugins.workflow.graph.FlowNode; import io.jenkins.blueocean.rest.impl.pipeline.* import io.jenkins.blueocean.rest.model.* import io.jenkins.blueocean.rest.model.BlueRun.* @NonCPS def on( String job, int buildNumber ) { [ isBuilding : { -> isBuilding( job, buildNumber ) } stageStatus : { String keyword, String type = 'parallel', String parentStage = 'Parallel' -> stageStatus ( keyword, job, buildNumber, type, parentStage ) } ] } Boolean isBuilding( String job, int buildNumber ) { Jenkins.instance .getItemByFullName( job ) .getBuildByNumber( buildNumber ) .isInProgress() } def withFlowNodes( String name, int buildNumber, Closure body ) { WorkflowRun run = Jenkins.instance .getItemByFullName( name ) .getBuildByNumber( buildNumber ) PipelineNodeGraphVisitor visitor = new PipelineNodeGraphVisitor( run ) List flowNodes = visitor.getPipelineNodes() body( flowNodes ) } def stageStatus( String keyword , String job , int buildNumber , String type = 'parallel' , String parentStage = 'Parallel' ) { if ( ! isBuilding(job, buildNumber) ) { println( \"pipeline ${job} #${buildNumber} haven't started yet\" ) return false } withFlowNodes ( job, buildNumber ) { flowNodes -> List parentIds = flowNodes.findAll { it.displayName.startsWith(keyword) && it.getType() == FlowNodeWrapper.NodeType.valueOf( type.toUpperCase() ) }.collectMany { it.parents.findAll { p -> p.displayName == parentStage } .collect { p -> p.id } }.unique() return parentIds ? flowNodes.findAll { parentIds.contains( it.id ) }.collect { it.status.getState() } : false } // withFlowNodes } // call on( BUILD_NAME, BUILD_NUMBER ).stageStatus( stageName ) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/script/agent.html":{"url":"jenkins/script/agent.html","title":"agent","keywords":"","body":" get information get all Computer and Node get projects tied to agent get ip address of node get agent environment variable get a list of all Jenkins nodes assigned with label cloud agents check how many cloud agent running KubernetesComputer executor basic usage get executor status stop all running builds via WorkflowRun force interrupt executors to WorkflowRun to WorkUnit and SubTask ( ExecutorStepExecution.PlaceholderTask ) to Computer Managing Nodes Monitor and Restart Offline Agents Create a Permanent Agent from Groovy Console update agent label jenkins-scripts/scriptler/disableSlaveNodeStartsWith.groovy disable agent disconnect agent offline agent delete agent monitor for jenkins master send alerts for jenkins agents references: SSH Agents leak \"Computer.threadPoolForRemoting\" threads JENKINS-27514: Core - Thread spikes in Computer.threadPoolForRemoting leading to eventual server OOM JENKINS-19465: Slave hangs while being launched CloudBees: Managing agents CloudBees: Create a Permanent Agent from Groovy Console DumbSlave JNLPLauncher Create a new Jenkins node, and run your Jenkins agent as a service WebSocket get information API: hudson.model.Computer hudson.model.Node hudson.model.Slave hudson.slaves.DumbSlave references: Display Information About Nodes jenkins-scripts/scriptler/showAgentJavaVersion.groovy jenkins-scripts/scriptler/checkNodesLauncherVersion.groovy Skip Jenkins Pipeline Steps If Node Is Offline sample scripts: jenkins-scripts/scriptler/findOfflineSlaves.groovy jenkins-scripts/scriptler/showAgentJavaVersion.groovy jenkins-scripts/scriptler/checkNodesLauncherVersion.groovy Jenkins : Monitoring Scripts Jenkins : Display Tools Location on All Nodes Jenkins : Display Information About Nodes get all get all agents including Jenkins master: jenkins.model.Jenkins.instance.computers jenkins.model.Jenkins.instance.get().computers jenkins.model.Jenkins.instance.computers.each { agent -> println \"${agent.displayName} : ${agent.class} : ${agent.class.superclass}\" println \" >> is master : ${jenkins.model.Jenkins.MasterComputer.isInstance(agent)}\" println \" >> is cloud : ${hudson.slaves.AbstractCloudComputer.isInstance(agent)} \" } or jenkins.model.Jenkins.instance.get().computers.each { agent -> println \"${agent.displayName} : ${agent.class} : ${agent.class.superclass}\" println \" >> is master : ${jenkins.model.Jenkins.MasterComputer.isInstance(agent)}\" println \" >> is cloud : ${hudson.slaves.AbstractCloudComputer.isInstance(agent)} \" } Computer and Node hudson.model.Computer -> hudson.model.Node via computer.setNode() hudson.model.Node -> hudson.model.Computer via node.toComputer() example for Computer Object get description Jenkins.instance.getNode('').toComputer().description get all info String agentName = 'marslo-test' Jenkins.instance.computers.findAll { computer -> agentName == computer.name }.each { computer -> String moreinfo = computer.online ? \"properties : ${computer.getSystemProperties().collect { k, v -> \"$k=$v\" }.join('\\n\\t\\t\\t>>> ')}\" : \" logs : ${computer.getLog()}\" println \"\"\" ~~> ${computer.displayName} : class : ${computer.getClass()} class : ${computer.class.superclass?.simpleName} online? : ${computer.online} description : ${computer.description} connectTime : ${computer.connectTime} offlineCauseReason : ${computer.offlineCauseReason} executor : ${computer.numExecutors} ${moreinfo} \"\"\" } result ~~> marslo-test : class : class hudson.slaves.SlaveComputer class : Computer online? : false description : marslo test agent offline connectTime : 1620478291102 offlineCauseReason : This agent is offline because Jenkins failed to launch the agent process on it. executor : 1 logs : SSHLauncher{host='1.2.3.4', port=22, credentialsId='DevOpsSSHCredential', jvmOptions='', javaPath='', prefixStartSlaveCmd='', suffixStartSlaveCmd='', launchTimeoutSeconds=30, maxNumRetries=5, retryWaitTime=30, sshHostKeyVerificationStrategy=hudson.plugins.sshslaves.verifiers.NonVerifyingKeyVerificationStrategy, tcpNoDelay=true, trackCredentials=true} [05/08/21 05:51:31] [SSH] Opening SSH connection to 1.2.3.4:22. connect timed out SSH Connection failed with IOException: \"connect timed out\", retrying in 30 seconds. There are 5 more retries left. connect timed out ... example for Node Object import hudson.slaves.* DumbSlave agent = jenkins.model.Jenkins.instance.getNode( 'marslo-test' ) println \"\"\" display name : ${agent.getDisplayName()} node name : ${agent.getNodeName()} description : ${agent.getNodeDescription()} executor : ${agent.getNumExecutors()} label string : ${agent.getLabelString()} node mode : ${agent.getMode()} hold off launch : ${agent.isHoldOffLaunchUntilSave()} \"\"\" result display name : marslo-test node name : marslo-test description : marslo test agent offline executor : 1 label string : node mode : NORMAL hold off launch : true setup hold off launch via: agent.holdOffLaunchUntilSave = true node -> computer String agent = 'marslo-test' Jenkins.instance.getNode(agent).toComputer().isOnline() or hudson.model.Hudson.instance.getNode(agent).toComputer().isOnline() or get log println jenkins.model.Jenkins.instance.getNode( 'marslo-test' ).toComputer().getLog() // result SSHLauncher{host='1.2.3.4', port=22, credentialsId='DevOpsSSHCredential', jvmOptions='', javaPath='', prefixStartSlaveCmd='', suffixStartSlaveCmd='', launchTimeoutSeconds=30, maxNumRetries=5, retryWaitTime=30, sshHostKeyVerificationStrategy=hudson.plugins.sshslaves.verifiers.NonVerifyingKeyVerificationStrategy, tcpNoDelay=true, trackCredentials=true} [05/24/21 03:59:16] [SSH] Opening SSH connection to 1.2.3.4:22. connect timed out SSH Connection failed with IOException: \"connect timed out\", retrying in 30 seconds. There are 5 more retries left. get projects tied to agent reference: jenkins.model.Computer.allExecutors hudson.model.Executor.currentWorkUnit hudson.model.queue.WorkUnit.work import hudson.model.* import jenkins.model.* import hudson.slaves.* String name = 'myagent' Computer computer = jenkins.model.Jenkins.instance.getNode(name)?.computer ?: null println computer.allExecutors.collect { it.currentWorkUnit?.work?.runId ?: '' }.join(', ') ?: '' result or println computer.getAllExecutors().collect { it.getCurrentWorkUnit()?.work?.runId ?: '' } or via hudson.model.queue.WorkUnit.context println computer.allExecutors.collect { it.currentWorkUnit?.context?.task?.runId ?: '' } get running job from label [!TIP] solution: hudson.model.Executor -> hudson.model.queue.WorkUnit -> org.jenkinsci.plugins.workflow.support.steps.ExecutorStepExecution$PlaceholderTask hudson.model.Executor -> hudson.model.queue.WorkUnit -> hudson.model.queue.WorkUnitContext -> org.jenkinsci.plugins.workflow.support.steps.ExecutorStepExecution$PlaceholderTask might helps: Label Linked Jobs jenkins.model.Jenkins.instance.getNode(name)?.computer?.allExecutors.each { println it.currentWorkUnit.work.getClass() println '.................' println it.currentWorkUnit.work.label println it.currentWorkUnit.work.runId println '.................' println it.currentWorkUnit?.context?.task?.label println it.currentWorkUnit?.context?.task?.runId println '.................' println it.currentWorkUnit.work.getOwnerTask().getClass() println it.currentWorkUnit.work.getOwnerTask().getFullDisplayName() println '.................' } // result class org.jenkinsci.plugins.workflow.support.steps.ExecutorStepExecution$PlaceholderTask ................. MY_AGENT_001 marslo/sandbox#6460 ................. MY_AGENT_001 marslo/sandbox#6460 ................. class org.jenkinsci.plugins.workflow.job.WorkflowJob marslo » sandbox ................. Result: [Thread[Executor #0 for MY_AGENT_001 : executing PlaceholderExecutable:ExecutorStepExecution.PlaceholderTask{runId=marslo/sandbox#6460,label=CI-WP-CD-RPI005,context=CpsStepContext[3:node]:Owner[marslo/sandbox/6460:marslo/sandbox #6460],cookie=null,auth=null},5,]] get number of executor of agents jenkins.model.Jenkins.instance.getNode(name)?.computer?.allExecutors?.size get ip address of node import hudson.model.Computer.ListPossibleNames println jenkins.model .Jenkins.instance .getNode( '' ).computer .getChannel().call(new ListPossibleNames()) or println jenkins.model .Jenkins.instance .getNode( '' ).computer .getHostName() or println InetAddress.localHost.hostAddress get agent environment variable import hudson.slaves.EnvironmentVariablesNodeProperty jenkins.model.Jenkins.instance.slaves.each { agent -> List props = agent.nodeProperties.getAll(hudson.slaves.EnvironmentVariablesNodeProperty.class) if ( props ) { println \"\"\" name : ${agent.name} : props : ${props.collect{ prop -> prop.envVars.collect { \"${it.key} ~> ${it.value}\" } }.flatten().join(', ')} \"\"\" } } \"DONE\" or for ( slave in jenkins.model.Jenkins.instance.slaves ) { println( slave.name + \": \" ) def props = slave.nodeProperties.getAll(hudson.slaves.EnvironmentVariablesNodeProperty.class) for ( prop in props ) { for ( envvar in prop.envVars ) { println envvar.key + \" -> \" + envvar.value } } } get a list of all Jenkins nodes assigned with label def nodes = jenkins.model.Jenkins.get().computers .findAll{ it.node.labelString.contains(label) } .collect{ it.node.selfLabel.name } or@NonCPS def hostNames(label) { def nodes = [] jenkins.model.Jenkins.get.computers.each { c -> if (c.node.labelString.contains(label)) { nodes.add(c.node.selfLabel.name) } } return nodes } orJenkins.instance.getLabel('my-label').getNodes().collect{ it.getNodeName() } cloud agents check how many cloud agent running println jenkins.model.Jenkins.instance.getNodes().findAll { [ 'AbstractCloudSlave', 'AbstractCloudComputer' ].contains(it.class.superclass?.simpleName) }.size() KubernetesComputer [!NOTE] references: org.csanchez.jenkins.plugins.kubernetes.KubernetesComputer io.fabric8.kubernetes.api.model.Container 1.0.28 2.0.4 4.9.2 io.fabric8.kubernetes.api.model.ResourceRequirements io.fabric8.kubernetes.api.model.EnvVar io.fabric8.kubernetes.api.model.ResourceRequirements io.fabric8.kubernetes.api.model.ContainerPort import org.csanchez.jenkins.plugins.kubernetes.KubernetesComputer import io.fabric8.kubernetes.api.model.Container import io.fabric8.kubernetes.api.model.EnvVar import io.fabric8.kubernetes.api.model.VolumeMount String sep = ' ' * 16 String subsep = ' ' * 20 jenkins.model.Jenkins.instance.computers.findAll{ it instanceof KubernetesComputer && it.isOnline()}.each { computer -> println \"\"\" name : ${computer.getDisplayName()} images : ${computer.getContainers().collect{ it.image }.join(', ')} os : ${computer.getOSDescription()} isJnlpAgent : ${computer.isJnlpAgent()} jobs : ${computer.allExecutors.collect { it.currentWorkUnit?.work?.runId ?: '' }.join(', ') ?: ''} env : ${computer.containers.collect{ it.getEnv() }.flatten().collect{ \"${it.name} : ${it.value}\" }.join( '\\n' + sep )} resources : limits : ${computer.containers.collect{ it.getResources().getLimits() }?.first().collect{ \"${it.key} : ${it.value}\"}.join( '\\n' + subsep ) ?: ''} requests : ${computer.containers.collect{ it.getResources().getRequests() }?.first().collect{ \"${it.key} : ${it.value}\"}.join( '\\n' + subsep ) ?: ''} volume : ${computer.containers.collect { it.getVolumeMounts() }.flatten().collect{ \"${it.name} : ${it.mountPath}\" }.join( '\\n' + sep )} commands : ${computer.containers.collect{ it.getCommand() }.join(', ')} agrs : ${computer.containers.collect{ it.getArgs() }.join(', ')} workingDir : ${computer.containers.collect{ it.getWorkingDir() }.join()} message : ${computer.containers.collect{ it.getTerminationMessagePath()}.join()} isLaunching : ${computer.isLaunching()} isOnline : ${computer.isOnline()} \"\"\" } result name : jenkins-sample-job-381-fcql9-j2mp9 images : artifactory.domain.com/docker/jnlp:2.0.2-py38-bionic os : Unix isJnlpAgent : true jobs : sample-job#381 env : JENKINS_SECRET : 43406803cb55dc7457242e08232c9e762cfb68e08157485e31d2c1fff4624d72 JENKINS_TUNNEL : 10.69.78.73:30380 JENKINS_AGENT_NAME : jenkins-sample-job-381-fcql9-j2mp9 JENKINS_NAME : jenkins-sample-job-381-fcql9-j2mp9 JENKINS_AGENT_WORKDIR : /home/devops JENKINS_URL : https://jenkins.domain.com/ resources : limits : cpu : 1 ephemeral-storage : 500Mi memory : 1Gi requests : cpu : 500m ephemeral-storage : 50Mi memory : 512Mi volume : workspace-volume : /home/devops default-token-m6bqf : /var/run/secrets/kubernetes.io/serviceaccount commands : [] agrs : [] workingDir : /home/devops message : /dev/termination-log isLaunching : false isOnline : true executor reference: hudson.model.Executor jenkins.model.Computer.allExecutors hudson.model.Executor.currentWorkUnit hudson.model.queue.WorkUnit.work Interface Queue.Executable [!NOTE|label:getParentExecutable] @CheckForNull default Queue.Executable getParentExecutable() An umbrella executable (such as a Run) of which this is one part. Some invariants: - `getParent().getOwnerTask() == getParent()` || `getParentExecutable().getParent() == getParent().getOwnerTask()` - `getParent().getOwnerExecutable() == null` || `getParentExecutable() == getParent().getOwnerExecutable()` Returns: a distinct executable (never this, unlike the default of SubTask.getOwnerTask()!); or null if this executable was already at top level See Also: SubTask.getOwnerExecutable() basic usage List> executors = Jenkins.instance.computers.collect {c -> c.executors} println executors.collect{ e -> e.collect{ it.getClass() } } // Result: // [[class hudson.model.Executor, class hudson.model.Executor], [class hudson.model.Executor]] get executor status import jenkins.model.Jenkins int active_builds = 0 int inactive_executors = 0 Jenkins.instance.slaves.findAll { agent -> ! agent.computer.isOffline() }.each { agent -> def executors = agent.computer.executors executors.each { executor -> if ( executor.isBusy() ) { active_builds++ } else { inactive_executors++ } } } println \"\"\" Queue : ${Jenkins.instance.queue.items.size()} Active : ${active_builds} Free executors : ${inactive_executors} \"\"\" result Queue : 0 Active : 10 Free executors : 100 features jenkins.model.Jenkins.instance .computers.collect { c -> c.executors } .collectMany { e -> e.findAll{ it.isBusy() } } .each{ e -> println '\\n>> e.owenr:' println \"\\te.owner : ${e.owner}\" println \"\\te.owner.countBusy : ${e.owner.countBusy()}\" println \"\\te.owner.countExecutors : ${e.owner.countExecutors()}\" println \"\\te.owner.log : ${e.owner.log.split('\\n').join('\\n\\t\\t\\t')}\" println '\\n>> e.status:' println \"\\te.isBusy() : ${e.isBusy()}\" println \"\\te.isIdle() : ${e.isIdle()}\" println \"\\te.isLikelyStuck() : ${e.isLikelyStuck()}\" println \"\\te.isParking() : ${e.isParking()}\" println '\\n>> e.currentWorkUnit.work:' println \"\\tfullDisplayName : ${e.currentWorkUnit.work.fullDisplayName}\" println \"\\trunId: ${e.currentWorkUnit.work.runId}\" println \"\\tlabel: ${e.currentWorkUnit.work.label}\" println \"\\townerTask : ${e.currentWorkUnit.work.ownerTask}\" println \"\\tgetResourceList() : ${e.currentWorkUnit.work.getResourceList()}\" println \"\\tisBuildBlocked() : ${e.currentWorkUnit.work.isBuildBlocked()}\" println \"\\tisConcurrentBuild() : ${e.currentWorkUnit.work.isConcurrentBuild()}\" println \"\\tisContinued() : ${e.currentWorkUnit.work.isContinued()}\" println \"\\n>> e.currentExecutable:\" println \"\\turl : ${e.currentExecutable?.url}\" println \"\\tnumber : ${e.currentExecutable?.number}\" println \"\\testimatedDuration : ${e.currentExecutable?.estimatedDuration}\" println \"\\tfullDisplayName : ${e.currentExecutable?.fullDisplayName}\" println \"\\n>> e.currentExecutable.parentExecutable:\" println \"\\tcurrentExecutable.parentExecutable: ${e.currentExecutable.parentExecutable.getClass()}\" println \"\\n>> e.currentWorkUnit.work.ownerTask:\" println \"\\townerTask : ${e.currentWorkUnit.work.ownerTask.getClass()}\" } result >> e.owenr: e.owner : KubernetesComputer name: jenkins-yaml-31-51jcr-wclf1 agent: KubernetesSlave name: jenkins-yaml-31-51jcr-wclf1 e.owner.countBusy : 1 e.owner.countExecutors : 1 e.owner.log : Inbound agent connected from 10.244.13.0/10.244.13.0:33584 Remoting version: 4.13 Launcher: KubernetesLauncher Communication Protocol: JNLP4-connect This is a Unix agent Agent successfully connected and online >> e.status: e.isBusy() : true e.isIdle() : false e.isLikelyStuck() : false e.isParking() : false >> e.currentWorkUnit.work: fullDisplayName : yaml #31 (show info) runId: yaml#31 label: jenkins-yaml-31-51jcr-wclf1 ownerTask : org.jenkinsci.plugins.workflow.job.WorkflowJob@775876ce[yaml] getResourceList() : {} isBuildBlocked() : false isConcurrentBuild() : false isContinued() : true >> e.currentExecutable: url : job/yaml/31/ number : 31 estimatedDuration : 17227 fullDisplayName : yaml #31 (show info) >> e.currentExecutable.parentExecutable: currentExecutable.parentExecutable: class org.jenkinsci.plugins.workflow.job.WorkflowRun >> e.currentWorkUnit.work.ownerTask: ownerTask : class org.jenkinsci.plugins.workflow.job.WorkflowJob stop all running builds via WorkflowRun [!NOTE] using WorkflowRun.finish might cause issue : https://stackoverflow.com/q/75651552/2940319 List> executors = Jenkins.instance.computers.collect { c -> c.executors } List busyExecutors = Jenkins.instance.computers.collect { c -> c.executors }.collectMany { it.findAll{ it.isBusy() } } busyExecutors.each { org.jenkinsci.plugins.workflow.job.WorkflowRun run = it?.currentExecutable?.parentExecutable run.setDescription( 'aborted by Jenkins restart' ) run.finish( hudson.model.Result.NOT_BUILT, new java.io.IOException( \"aborted by Jenkins restart\" ) ) } force interrupt executors List> executors = Jenkins.instance.computers.collect { c -> c.executors } List busyExecutors = Jenkins.instance.computers.collect { c -> c.executors }.collectMany { it.findAll{ it.isBusy() } } busyExecutors.each { it.interrupt() } // or simply in one line jenkins.model.Jenkins.instance .computers.collect { c -> c.executors } .collectMany { it.findAll{ it.isBusy() } } .each { it.interrupt() } to WorkflowRun [!NOTE|label:basic concept] Computer -> Executor -> ExecutorStepExecution$PlaceholderTask$PlaceholderExecutable -> WorkflowRun jenkins.model.Jenkins.instance .computers.collect { c -> c.executors } // all executors .collectMany { it.findAll{ it.isBusy() } } // running executors .collectMany {[ it?.getClass(), // Executor it?.currentExecutable?.getClass(), // org.jenkinsci.plugins.workflow.support.steps.ExecutorStepExecution$PlaceholderTask$PlaceholderExecutable it?.currentExecutable?.parentExecutable?.getClass() // org.jenkinsci.plugins.workflow.job.WorkflowRun ]} to WorkUnit and SubTask ( ExecutorStepExecution.PlaceholderTask ) jenkins.model.Jenkins.instance.computers.findAll { computer -> '' == computer.name }.collect { it.executors } .flatten() .each { e -> println e // class hudson.model.Executor println e.currentWorkUnit // hudson.model.queue.WorkUnit println e.currentWorkUnit.work // org.jenkinsci.plugins.workflow.support.steps.ExecutorStepExecution$PlaceholderTask } resulte : Thread[Executor #0 for jenkins-sandbox-sample-11998-r16jc-nj9fc : executing PlaceholderExecutable:ExecutorStepExecution.PlaceholderTask{runId=sandbox/sample#11998,label=jenkins-sandbox-sample-11998,context=CpsStepContext[10:node]:Owner[sandbox/sample/11998:sandbox/sample #11998],cookie=null,auth=null},5,] e.currentWorkUnit : hudson.model.queue.WorkUnit@5e2236a4[work=part of sandbox » sample #11998] e.currentWorkUnit.work : ExecutorStepExecution.PlaceholderTask{runId=sandbox/sample#11998,label=jenkins-sandbox-sample-11998-r16jc-nj9fc,context=CpsStepContext[10:node]:Owner[sandbox/sample/11998:sandbox/sample #11998],cookie=80f25325-1b41-48fc-89aa-5b81e8288c5f,auth=null} to Computer Jenkins.instance.computers.findAll { computer -> '' == computer.name }.collect { it.executors } .flatten() .each { e -> println e // class hudson.model.Executor println e.owner // class org.csanchez.jenkins.plugins.kubernetes.KubernetesComputer } resulte : Thread[Executor #0 for jenkins-sandbox-sample-11998-r16jc-nj9fc : executing PlaceholderExecutable:ExecutorStepExecution.PlaceholderTask{runId=sandbox/sample#11998,label=jenkins-sandbox-sample-11998,context=CpsStepContext[10:node]:Owner[sandbox/sample/11998:sandbox/sample #11998],cookie=null,auth=null},5,] owner : KubernetesComputer name: jenkins-sandbox-sample-11998-r16jc-nj9fc agent: null Managing Nodes Monitor and Restart Offline Agents import hudson.node_monitors.* import hudson.slaves.* import java.util.concurrent.* jenkins = Jenkins.instance import javax.mail.internet.*; import javax.mail.* import javax.activation.* def sendMail (agent, cause) { message = agent + \" agent is down. Check http://JENKINS_HOSTNAME:JENKINS_PORT/computer/\" + agent + \"\\nBecause \" + cause subject = agent + \" agent is offline\" toAddress = \"JENKINS_ADMIN@YOUR_DOMAIN\" fromAddress = \"JENKINS@YOUR_DOMAIN\" host = \"SMTP_SERVER\" port = \"SMTP_PORT\" Properties mprops = new Properties(); mprops.setProperty(\"mail.transport.protocol\",\"smtp\"); mprops.setProperty(\"mail.host\",host); mprops.setProperty(\"mail.smtp.port\",port); Session lSession = Session.getDefaultInstance(mprops,null); MimeMessage msg = new MimeMessage(lSession); //tokenize out the recipients in case they came in as a list StringTokenizer tok = new StringTokenizer(toAddress,\";\"); ArrayList emailTos = new ArrayList(); while(tok.hasMoreElements()) { emailTos.add(new InternetAddress(tok.nextElement().toString())); } InternetAddress[] to = new InternetAddress[emailTos.size()]; to = (InternetAddress[]) emailTos.toArray(to); msg.setRecipients(MimeMessage.RecipientType.TO,to); InternetAddress fromAddr = new InternetAddress(fromAddress); msg.setFrom(fromAddr); msg.setFrom(new InternetAddress(fromAddress)); msg.setSubject(subject); msg.setText(message) Transport transporter = lSession.getTransport(\"smtp\"); transporter.connect(); transporter.send(msg); } def getEnviron(computer) { def env def thread = Thread.start(\"Getting env from ${computer.name}\", { env = computer.environment }) thread.join(2000) if (thread.isAlive()) thread.interrupt() env } def agentAccessible(computer) { getEnviron(computer)?.get('PATH') != null } def numberOfflineNodes = 0 def numberNodes = 0 for (agent in jenkins.getNodes()) { def computer = agent.computer numberNodes ++ println \"\" println \"Checking computer ${computer.name}:\" def isOK = (agentAccessible(computer) && !computer.offline) if (isOK) { println \"\\t\\tOK, got PATH back from agent ${computer.name}.\" println('\\tcomputer.isOffline: ' + computer.isOffline()); println('\\tcomputer.isTemporarilyOffline: ' + computer.isTemporarilyOffline()); println('\\tcomputer.getOfflineCause: ' + computer.getOfflineCause()); println('\\tcomputer.offline: ' + computer.offline); } else { numberOfflineNodes ++ println \" ERROR: can't get PATH from agent ${computer.name}.\" println('\\tcomputer.isOffline: ' + computer.isOffline()); println('\\tcomputer.isTemporarilyOffline: ' + computer.isTemporarilyOffline()); println('\\tcomputer.getOfflineCause: ' + computer.getOfflineCause()); println('\\tcomputer.offline: ' + computer.offline); sendMail(computer.name, computer.getOfflineCause().toString()) if (computer.isTemporarilyOffline()) { if (!computer.getOfflineCause().toString().contains(\"Disconnected by\")) { computer.setTemporarilyOffline(false, agent.getComputer().getOfflineCause()) } } else { computer.connect(true) } } } println (\"Number of Offline Nodes: \" + numberOfflineNodes) println (\"Number of Nodes: \" + numberNodes) Create a Permanent Agent from Groovy Console api: hudson.plugins.sshslaves.SSHLauncher hudson.plugins.sshslaves.verifiers.SshHostKeyVerificationStrategy hudson.slaves.DumbSlave hudson.slaves.ComputerLauncher references: jenkins-scripts/createAgentsScript.groovy GroovyJenkins/src/main/groovy/AddNodeToJenkins.groovy useful libs: import jenkins.model.* import hudson.slaves.* import hudson.slaves.NodePropertyDescriptor import hudson.plugins.sshslaves.* import hudson.plugins.sshslaves.verifiers.* import hudson.model.* import hudson.model.Node import hudson.model.Queue import hudson.model.queue.CauseOfBlockage import hudson.slaves.EnvironmentVariablesNodeProperty.Entry import java.util.ArrayList import com.synopsys.arc.jenkinsci.plugins.jobrestrictions.nodes.JobRestrictionProperty import com.synopsys.arc.jenkinsci.plugins.jobrestrictions.Messages import com.synopsys.arc.jenkinsci.plugins.jobrestrictions.restrictions.JobRestriction import com.synopsys.arc.jenkinsci.plugins.jobrestrictions.restrictions.JobRestrictionBlockageCause import hudson.Extension import hudson.slaves.NodeProperty import org.kohsuke.stapler.DataBoundConstructor SSH host verification strategy: // Known hosts file Verification Strategy new KnownHostsFileKeyVerificationStrategy() // Manually provided key Verification Strategy new ManuallyProvidedKeyVerificationStrategy(\"\") // Manually trusted key Verification Strategy new ManuallyTrustedKeyVerificationStrategy(false /*requires initial manual trust*/) // Non verifying Verification Strategy new NonVerifyingKeyVerificationStrategy() import hudson.model.* import jenkins.model.* import hudson.slaves.* import hudson.slaves.EnvironmentVariablesNodeProperty.Entry import hudson.plugins.sshslaves.verifiers.* // Pick one of the strategies from the comments below this line // SshHostKeyVerificationStrategy hostKeyVerificationStrategy = new KnownHostsFileKeyVerificationStrategy() //= new KnownHostsFileKeyVerificationStrategy() // Known hosts file Verification Strategy //= new ManuallyProvidedKeyVerificationStrategy(\"\") // Manually provided key Verification Strategy //= new ManuallyTrustedKeyVerificationStrategy(false /*requires initial manual trust*/) // Manually trusted key Verification Strategy //= new NonVerifyingKeyVerificationStrategy() // Non verifying Verification Strategy // Define a \"Launch method\": \"Launch agents via SSH\" ComputerLauncher launcher = new hudson.plugins.sshslaves.SSHLauncher( \"1.2.3.4\", // Host 22, // Port \"MyCredentials\", // Credentials (String)null, // JVM Options (String)null, // JavaPath (String)null, // Prefix Start Agent Command (String)null, // Suffix Start Agent Command (Integer)null, // Connection Timeout in Seconds (Integer)null, // Maximum Number of Retries (Integer)null, // The number of seconds to wait between retries new NonVerifyingKeyVerificationStrategy() // Host Key Verification Strategy ) // Define a \"Permanent Agent\" Slave agent = new DumbSlave( \"marslo-test\", \"/home/devops\", launcher) agent.nodeDescription = \"marslo test agent\" agent.numExecutors = 1 agent.labelString = \"\" agent.mode = Node.Mode.NORMAL agent.retentionStrategy = new RetentionStrategy.Always() List env = new ArrayList(); env.add(new Entry(\"key1\",\"value1\")) env.add(new Entry(\"key2\",\"value2\")) EnvironmentVariablesNodeProperty envPro = new EnvironmentVariablesNodeProperty(env); agent.getNodeProperties().add(envPro) // Create a \"Permanent Agent\" Jenkins.instance.addNode(agent) return \"Node has been created successfully.\" or import hudson.model.* import jenkins.model.* import hudson.slaves.* import hudson.plugins.sshslaves.verifiers.* import hudson.slaves.EnvironmentVariablesNodeProperty.Entry String name = 'marslo-test' String description = 'marslo test agent' String rootDir = '/home/marslo' String nodeLabel = '' String ip = '1.2.3.4' String credential = 'MyCredential' Map envVars = [ 'key1' : 'value1', 'key2' : 'value2' ] SshHostKeyVerificationStrategy hostKeyVerificationStrategy = new NonVerifyingKeyVerificationStrategy() List env = new ArrayList(); envVars.each { k, v -> env.add(new Entry(k, v)) } EnvironmentVariablesNodeProperty envPro = new EnvironmentVariablesNodeProperty(env); Slave agent = new DumbSlave( name, description, rootDir, \"1\", Node.Mode.NORMAL, nodeLabel, new hudson.plugins.sshslaves.SSHLauncher( ip, // Host 22, // Port credential, // Credentials (String)null, // JVM Options (String)null, // JavaPath (String)null, // Prefix Start Agent Command (String)null, // Suffix Start Agent Command (Integer)null, // Connection Timeout in Seconds (Integer)null, // Maximum Number of Retries (Integer)null, // The number of seconds to wait between retries hostKeyVerificationStrategy // Host Key Verification Strategy ) , new RetentionStrategy.Always(), new LinkedList() ) agent.getNodeProperties().add(envPro) Jenkins.instance.addNode(agent) update agent label references: Groovy script for modifying Jenkins nodes labels get label def getLabel( String label ){ for ( node in jenkins.model.Jenkins.instance.nodes ) { if ( node.getNodeName().toString().equals(label) ) { return node.getLabelString() } } } or def getLabel( String label ){ jenkins.model.Jenkins.instance.nodes.find { it.getNodeName().toString().equals(label) }.getLabelString() } update label def updateLabel( String agent, String label ) { def node = jenkins.model.Jenkins.instance.getNode( agent ) if ( node ) { node.setLabelString(label) node.save() } } jenkins-scripts/scriptler/disableSlaveNodeStartsWith.groovy disable agent references: cloudbees/jenkins-scripts/disableAgents.groovy disconnect agent reconnect: agent.computer.connect( true ) jenkins.model.Jenkins.instance.getNode( name ).computer.connect( true ) reference: awslabs/ec2-spot-jenkins-plugin | or import hudson.slaves.* String name = 'marslo-test' String cause = \"disconnet the agent automatically via ${env.BUILD_URL}\" DumbSlave agent = jenkins.model.Jenkins.instance.getNode( name ) if ( agent && ! ['AbstractCloudComputer', 'AbstractCloudSlave'].contains(agent.computer?.class.superclass?.simpleName) && ! (agent.computer instanceof jenkins.model.Jenkins.MasterComputer) ) { Boolean online = agent.computer.isOnline() Boolean busy = agent.computer.countBusy() != 0 if( online && !busy ) { agent.computer.disconnect( new OfflineCause.ChannelTermination(new UnsupportedOperationException(cause)) ) } } offline agent offline agent is normally for workspace cleanup reference: codecentric/jenkins-scripts Display Information About Nodes bring node online computer.setTemporarilyOffline( false, null ) import hudson.slaves.* String name = 'marslo-test' String cause = \"temporary offline for the agent workspace cleanup\" DumbSlave agent = jenkins.model.Jenkins.instance.getNode( name ) if ( agent && ! ['AbstractCloudComputer', 'AbstractCloudSlave'].contains(agent.computer?.class.superclass?.simpleName) && ! (agent.computer instanceof jenkins.model.Jenkins.MasterComputer) ) { Boolean online = agent.computer.isOnline() Boolean busy = agent.computer.countBusy() != 0 if( online && !busy ) { agent.computer.setTemporarilyOffline( true, new hudson.slaves.OfflineCause.ByCLI(\"disk cleanup on slave\") ) } } delete agent references: cloudbees/jenkins-scripts/deleteAgents.groovy def isAgentExists( String name ) { jenkins.model.Jenkins.instance.getNodes().any { name == it.computer?.name } } def removeAgent( String name ) { Boolean deleted = false DumbSlave agent = jenkins.model.Jenkins.instance.getNode( name ) if ( agent && ! AbstractCloudComputer.isInstance( agent.computer ) && ! AbstractCloudSlave.isInstance( agent.computer ) && ! ( agent.computer instanceof jenkins.model.Jenkins.MasterComputer ) ) { Boolean online = agent.computer.isOnline() Boolean busy = agent.computer.countBusy() != 0 if ( !busy ) { println \"\"\" \"${online ? ' offline and' : ''} remove agent ${name} :\" display name : ${agent.getDisplayName()} description : ${agent.getNodeDescription()} executor : ${agent.getNumExecutors()} node mode : ${agent.getMode()} online? : ${online} busy? : ${busy} offline cause? : ${agent.computer.getOfflineCause()} \"\"\" if ( online ) { agent.computer.setTemporarilyOffline( true, new hudson.slaves.OfflineCause.ByCLI('offline due to agent will be removed automatically') ) Thread.sleep( 5*1000 ) } agent.computer.doDoDelete() deleted = ! isAgentExists( name ) println( \"INFO: agent ${name} ${deleted ? 'has been successfully removed' : 'failed been removed'} from ${env.JENKINS_URL}computer\") } else { println(\"WARN: the agent ${name} cannot be removed due to project is tie to it\" ) } } else { println('WARN: cloud agent or Jenkins master cannot be removed!' ) } return deleted } monitor references: Jenkins : Invalidate Jenkins HTTP sessions Jenkins : Display monitors status for jenkins master execute gc import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; before = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory(); System.gc(); after = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory(); println I18N.getFormattedString(\"ramasse_miette_execute\", Math.round((before - after) / 1024)); display http sessions import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; println SessionListener.getSessionCount() + \" sessions:\"; sessions = SessionListener.getAllSessionsInformations(); for (session in sessions) { println session; } display a simple threads dump import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; java = new JavaInformations(Parameters.getServletContext(), true); threads = java.getThreadInformationsList(); println threads.size() + \" threads (\" + java.activeThreadCount + \" http threads active):\"; for (thread in threads) { println \"\"; println thread; for (s in thread.getStackTrace()) println \" \" + s; } display deadlocked threads import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; java = new JavaInformations(Parameters.getServletContext(), true); threads = java.getThreadInformationsList(); deadlocked = new java.util.ArrayList(); for (thread in threads) { if (thread.deadlocked) deadlocked.add(thread); } println deadlocked.size() + \" deadlocked threads / \" + threads.size() + \" threads (\" + java.activeThreadCount + \" http threads active)\"; for (thread in deadlocked) { println \"\"; println thread; for (s in thread.getStackTrace()) println \" \" + s; } display some memory data import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; memory = new MemoryInformations(); println \"\\nused memory:\\n \" + Math.round(memory.usedMemory / 1024 / 1024) + \" Mb\"; println \"\\nmax memory:\\n \" + Math.round(memory.maxMemory / 1024 / 1024) + \" Mb\"; println \"\\nused perm gen:\\n \" + Math.round(memory.usedPermGen / 1024 / 1024) + \" Mb\"; println \"\\nmax perm gen:\\n \" + Math.round(memory.maxPermGen / 1024 / 1024) + \" Mb\"; println \"\\nused non heap:\\n \" + Math.round(memory.usedNonHeapMemory / 1024 / 1024) + \" Mb\"; println \"\\nused physical memory:\\n \" + Math.round(memory.usedPhysicalMemorySize / 1024 / 1024) + \" Mb\"; println \"\\nused swap space:\\n \" + Math.round(memory.usedSwapSpaceSize / 1024 / 1024) + \" Mb\"; display some jvm data import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; java = new JavaInformations(Parameters.getServletContext(), true); println \"\\nsessions count:\\n \" + java.sessionCount; println \"\\nactive HTTP threads count:\\n \" + java.activeThreadCount; println \"\\nthreads count:\\n \" + java.threadCount; println \"\\nsystem load average:\\n \" + java.systemLoadAverage; println \"\\nsystem cpu load:\\n \" + java.systemCpuLoad; // since 1.59 println \"\\navailable processors:\\n \" + java.availableProcessors; println \"\\nhost:\\n \" + java.host; println \"\\nos:\\n \" + java.os; println \"\\njava version:\\n \" + java.javaVersion; println \"\\njvm version:\\n \" + java.jvmVersion; println \"\\npid:\\n \" + java.pid; println \"\\nserver info:\\n \" + java.serverInfo; println \"\\ncontext path:\\n \" + java.contextPath; println \"\\nstart date:\\n \" + java.startDate; println \"\\nfree disk space in Jenkins directory:\\n \" + Math.round(java.freeDiskSpaceInTemp / 1024 / 1024) + \" Mb\"; display heap histogram (object instances per class) import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; classes = VirtualMachine.createHeapHistogram().getHeapHistogram(); println \"class instances bytes source\"; println \"=====================================\"; for ( c in classes ) { println c.name + \" \" + c.instancesCount + \" \" + c.bytes + \" \" + c.source; } take a heap dump import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; if (System.getProperty(\"java.vendor\").contains(\"IBM\")) { Action.HEAP_DUMP.ibmHeapDump(); println I18N.getString(\"heap_dump_genere_ibm\"); } else { heapDumpPath = Action.HEAP_DUMP.heapDump().getPath(); println I18N.getFormattedString(\"heap_dump_genere\", heapDumpPath); } display some MBean attribute value import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; exampleAttribute = \"java.lang:type=OperatingSystem.ProcessCpuTime\"; println exampleAttribute + \" = \" + MBeans.getConvertedAttributes(exampleAttribute); Display stats of builds and build steps having mean time greater than severe threshold (By default, severe threshold = 2 x stddev of all durations and warning threshold = 1 x stddev) import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; buildCounter = CounterRunListener.getBuildCounter(); aggreg = new CounterRequestAggregation(buildCounter); for ( request in aggreg.getRequests() ) { if ( request.getMean() >= aggreg.getSevereThreshold() || request.getCpuTimeMean() >= aggreg.getSevereThreshold() ) { println( request.getName() + \", hits=\" + request.getHits() + \", mean=\" + request.getMean() + \", max=\" + request.getMaximum() + \", stddev=\" + request.getStandardDeviation() + \", cpuTimeMean=\" + request.getCpuTimeMean() + \", systemErrorPercentage=\" + request.getSystemErrorPercentage() ); } } send alerts [!TIP] suppose that you want to check: every 15 minutes on the Jenkins master, if the system load average is above 50 if the active HTTP threads count is above 100 if there are deadlocked threads if there are less than 10 Gb free disk space left: by: create a freestyle job in jenkins by clicking \"New Item\". check \"build periodically\" and write a schedule, \"/15 *\" for example. add a build step \"execute system groovy script\" and write a script or any script with monitoring values in this page add a post-build action \"E-mail Notification\" and write your email in \"Recipients\". you can also configure \"Discard old builds\" and write a description. save. click \"Build now\" to test it. import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; java = new JavaInformations(Parameters.getServletContext(), true); memory = java.memoryInformations; println \"used memory = \" + Math.round(memory.usedMemory / 1024 / 1024) + \" Mb\"; println \"active HTTP threads count = \" + java.activeThreadCount; println \"system load average = \" + java.systemLoadAverage; println \"free disk space in Jenkins directory = \" + Math.round(java.freeDiskSpaceInTemp / 1024 / 1024) + \" Mb\"; threads = java.getThreadInformationsList(); deadlocked = new java.util.ArrayList(); for (thread in threads) { if (thread.deadlocked) deadlocked.add(thread); } println deadlocked.size() + \" deadlocked threads / \" + threads.size() + \" threads\"; for (thread in deadlocked) { println \"\"; println thread; for (s in thread.getStackTrace()) println \" \" + s; } if (java.systemLoadAverage > 50) throw new Exception(\"Alert for Jenkins: systemLoadAverage is \" + java.systemLoadAverage); if (java.activeThreadCount > 100) throw new Exception(\"Alert for Jenkins: activeThreadCount is \" + java.activeThreadCount); if (deadlocked.size() > 0) throw new Exception(\"Alert for Jenkins: \" + deadlocked.size() + \" deadlocked threads\"); if (java.freeDiskSpaceInTemp / 1024 / 1024 for jenkins agents display jvm data, memory data, deadlocked threads by node import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; String nodeName = null ; // null for all nodes, not null for a particular node Map mapByNodeName = new RemoteCallHelper(nodeName).collectJavaInformationsListByName(); for (node in mapByNodeName.keySet()) { java = mapByNodeName.get(node); println \"\\nNode:\\n \" + node; println \"\\nsessions count:\\n \" + java.sessionCount; println \"\\nactive HTTP threads count:\\n \" + java.activeThreadCount; println \"\\nthreads count:\\n \" + java.threadCount; println \"\\nsystem load average:\\n \" + java.systemLoadAverage; println \"\\nsystem cpu load:\\n \" + java.systemCpuLoad; // since 1.59 println \"\\navailable processors:\\n \" + java.availableProcessors; println \"\\nhost:\\n \" + java.host; println \"\\nos:\\n \" + java.os; println \"\\njava version:\\n \" + java.javaVersion; println \"\\njvm version:\\n \" + java.jvmVersion; println \"\\npid:\\n \" + java.pid; println \"\\nserver info:\\n \" + java.serverInfo; println \"\\ncontext path:\\n \" + java.contextPath; println \"\\nstart date:\\n \" + java.startDate; println \"\"; memory = java.memoryInformations; println \"\\nused memory:\\n \" + Math.round(memory.usedMemory / 1024 / 1024) + \" Mb\"; println \"\\nmax memory:\\n \" + Math.round(memory.maxMemory / 1024 / 1024) + \" Mb\"; println \"\\nused perm gen:\\n \" + Math.round(memory.usedPermGen / 1024 / 1024) + \" Mb\"; println \"\\nmax perm gen:\\n \" + Math.round(memory.maxPermGen / 1024 / 1024) + \" Mb\"; println \"\\nused non heap:\\n \" + Math.round(memory.usedNonHeapMemory / 1024 / 1024) + \" Mb\"; println \"\\nused physical memory:\\n \" + Math.round(memory.usedPhysicalMemorySize / 1024 / 1024) + \" Mb\"; println \"\\nused swap space:\\n \" + Math.round(memory.usedSwapSpaceSize / 1024 / 1024) + \" Mb\"; println \"\"; threads = java.getThreadInformationsList(); deadlocked = new java.util.ArrayList(); for (thread in threads) { if (thread.deadlocked) deadlocked.add(thread); } println deadlocked.size() + \" deadlocked threads / \" + threads.size() + \" threads (\" + java.activeThreadCount + \" threads active)\"; for (thread in deadlocked) { println \"\"; println thread; for (s in thread.getStackTrace()) println \" \" + s; } println \"\"; println \"*************************************************************\"; println \"\"; } display some mbean attributes values by node import net.bull.javamelody.*; import net.bull.javamelody.internal.model.*; import net.bull.javamelody.internal.common.*; String exampleAttributes = \"java.lang:type=OperatingSystem.ProcessCpuTime|java.lang:type=Memory.HeapMemoryUsage\"; String nodeName = null; // null for all nodes, not null for a particular node List values = new RemoteCallHelper(nodeName).collectJmxValues(exampleAttributes); for (String value in values) { println exampleAttributes + \" = \" + value; } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/script/authorization.html":{"url":"jenkins/script/authorization.html","title":"security & authorization","keywords":"","body":" security get securityRealm authorization strategy decrypt credentials.xml list all Jenkins supported authorization permissions get current authorization strategy class get raw authorization and permissions info ProjectMatrixAuthorizationStrategy RoleBasedAuthorizationStrategy crumb issuer get crumb issuer set crumb issuer clean up all pending Async Resource Disposers items get crumb via cmd credential list all credentials StandardUsernamePasswordCredentials BasicSSHUserPrivateKey CertificateCredentials SystemCredentialsProvider VaultUsernamePasswordCredential VaultAppRoleCredential VaultSSHUserPrivateKeyImpl VaultStringCredentialImpl VaultUsernamePasswordCredentialImpl encrypt/decrypt password tricky Access granted with Overall/SystemRead Access granted with Overall/Manage security get securityRealm import hudson.security.* import jenkins.security.* import jenkins.model.Jenkins def jenkins = jenkins.model.Jenkins.getInstance() println jenkins.securityRealm println jenkins.authorizationStrategy // result // hudson.security.LDAPSecurityRealm@7d090e41 // hudson.security.ProjectMatrixAuthorizationStrategy@6d51bb9d authorization strategy reference: hudson.security.Permission hudson.security.ProjectMatrixAuthorizationStrategy matrix-auth-plugin/src/main/java/hudson/security/ProjectMatrixAuthorizationStrategy.java How to add permission in GlobalMatrixAuthorizationStrategy through the groovy - for hudson.sercurity.item.Move Jenkins : Grant Cancel Permission for user and group that have Build permission Accessing and dumping Jenkins credentials decrypt credentials.xml [!NOTE|label:references:] How to decrypt Jenkins passwords from credentials.xml? tweksteen/jenkins-decrypt menski/jenkins-decrypt.py hudson.util.Secret.fromString('{..string..}').getPlainText() // or hudson.util.Secret.fromString('{..string..}').getEncryptedValue() examplehudson.util.Secret.fromString('{AQAAABAAAAAQszhBK4LXdjzjqP/7w8yQWbD4+Kf1ql4XnYEnPUyvP2o=}').getPlainText() // 123456 list all Jenkins supported authorization permissions hudson.security.Permission.getAll().each { p -> println \"${p.name} :\\n\" + \"\\t${p.id} : ${p.description}\" } better one import hudson.security.GlobalMatrixAuthorizationStrategy import hudson.security.Permission import hudson.security.ProjectMatrixAuthorizationStrategy import jenkins.model.Jenkins String shortName( Permission p ) { Map replacement = [ 'Hudson' : 'Overall' , 'Computer' : 'Agent' , 'Item' : 'Job' , 'CredentialsProvider' : 'Credentials' ] p.id .tokenize('.')[-2..-1] .collect { replacement.get(it) ?: it } .join(' ') } Map permissionIds = Permission.all.findAll { permission -> List nonConfigurablePerms = ['RunScripts', 'UploadPlugins', 'ConfigureUpdateCenter'] permission.enabled && ! permission.id.startsWith('hudson.security.Permission') && ! nonConfigurablePerms.any { permission.id.endsWith(it) } }.collect { permission -> [ (shortName(permission)): permission ] }.sum() // show result println permissionIds.collect { it.key + ' : ' + it.value.id }.join ('\\n') 'DONE' get current authorization strategy class import hudson.model.* import hudson.security.* Hudson instance = Jenkins.getInstance() def strategy = instance.getAuthorizationStrategy() println strategy.getClass() // result // class hudson.security.ProjectMatrixAuthorizationStrategy get raw authorization and permissions info Jenkins.instance .authorizationStrategy .grantedPermissions .collect{ p, u -> [ (p.id), u ] } orJenkins.instance .authorizationStrategy .grantedPermissions .each { p, u -> println \"\\n${p} :\\n\\t${u}\" } ProjectMatrixAuthorizationStrategy grant permission to user import hudson.security.GlobalMatrixAuthorizationStrategy import hudson.security.Permission import hudson.security.ProjectMatrixAuthorizationStrategy import jenkins.model.Jenkins ProjectMatrixAuthorizationStrategy authorizationStrategy = new ProjectMatrixAuthorizationStrategy() String id = 'hudson.model.Hudson.Administer' String user = 'marslo' authorizationStrategy.add( Permission.fromId(id), user ) // save strategy Jenkins.instance.authorizationStrategy = authorizationStrategy Jenkins.instance.save() add new configurations according to Map structure create new instance new import hudson.security.* ProjectMatrixAuthorizationStrategy authorizationStrategy = new ProjectMatrixAuthorizationStrategy() via getAuthorizationStrategy import hudson.model.* import hudson.security.* def strategy = Jenkins.getInstance().getAuthorizationStrategy() def authorizationStrategy = strategy.class.newInstance() new instance from name String instanceName = 'hudson.security.ProjectMatrixAuthorizationStrategy' def strategy = Class.forName(instanceName).newInstance() println strategy.class // result // class hudson.security.ProjectMatrixAuthorizationStrategy get groups list import hudson.model.* import hudson.security.* ProjectMatrixAuthorizationStrategy authorizationStrategy = new ProjectMatrixAuthorizationStrategy() println authorizationStrategy.getGroups() RoleBasedAuthorizationStrategy add 'admin' user to all permissions import hudson.* import hudson.security.* import jenkins.model.* import java.util.* import com.michelin.cio.hudson.plugins.rolestrategy.* import com.synopsys.arc.jenkins.plugins.rolestrategy.* import java.lang.reflect.* import java.util.logging.* import groovy.json.* import jenkins.* import com.michelin.cio.hudson.plugins.rolestrategy.* String admin = 'admin' // Turn security on RoleBasedAuthorizationStrategy authorizationStrategy = new RoleBasedAuthorizationStrategy() // ProjectMatrixAuthorizationStrategy authorizationStrategy = new ProjectMatrixAuthorizationStrategy() Jenkins.instance.setAuthorizationStrategy(authorizationStrategy) Constructor[] constrs = Role.class.getConstructors() for (Constructor c : constrs) { c.setAccessible(true) } Method assignRoleMethod = RoleBasedAuthorizationStrategy.class.getDeclaredMethod( \"assignRole\", String.class, Role.class, String.class ) assignRoleMethod.setAccessible( true ) Set adminPermissions = new HashSet() hudson.security.Permission.getAll(){ adminPermissions.add(Permission.fromId(it) } Role adminRole = new Role( admin, adminPermissions ) authorizationStrategy.addRole( RoleBasedAuthorizationStrategy.GLOBAL, adminRole ) crumb issuer reference: hudson.security.csrf.CrumbIssuer ivan-pinatti/jenkins-set-default-crumb-issuer.groovy get crumb issuer import hudson.security.csrf.DefaultCrumbIssuer DefaultCrumbIssuer issuer = jenkins.model.Jenkins.instance.crumbIssuer String jenkinsCrumb = \"${issuer.crumbRequestField}:${issuer.crumb}\" println jenkinsCrumb // Jenkins-Crumb:b8a9cd5*********** set crumb issuer import jenkins.model.Jenkins Jenkins jenkins = jenkins.model.Jenkins.instance jenkins.setCrumbIssuer(new DefaultCrumbIssuer(true)) jenkins.save() clean up all pending Async Resource Disposers items import org.jenkinsci.plugins.resourcedisposer.AsyncResourceDisposer import org.jenkinsci.plugins.strictcrumbissuer.StrictCrumbIssuer AsyncResourceDisposer disposer = AsyncResourceDisposer.get() StrictCrumbIssuer issuer = jenkins.model.Jenkins.instance.crumbIssuer String jenkinsCrumb = \"${issuer.crumbRequestField}:${issuer.crumb}\" String url = Jenkins.instance.rootUrl + disposer.url disposer.getBacklog().each { item -> println \"\\n${item.id} : \\t${url}/stopTracking/?id=${item.id} : \\t${item.class.simpleName} : \\n\" + \"\\t${item.getLastState().getDisplayName()} : \\n\" + \"\\t${item.getDisposable().node} : ${item.getDisposable().path}\\n\" + \"\\t${item.toString()}\" println \"removeing ${item.id} : \" [ 'bash', '-c', 'curl -v -s ' + '-u : ' + '-X POST ' + \"-H \\\"Content-Type: application/json\\\" \" + \"-H \\\"Accept: application/json\\\" \" + \"-H \\\"${jenkinsCrumb}\\\" \" + \"${url}/stopTracking/?id=${item.id} \" ].execute().with{ def stdout = new StringBuffer() def stderr = new StringBuffer() it.waitForProcessOutput( stdout, stderr ) println \"EXIT CODE: ${it.exitValue()}\" println \"ERROR: ${stderr}\" println \"OUTPUT: ${stdout}\" } } get crumb via cmd [!TIP|local:references:] CSRF Protection Explained curl # after 2.176.2 $ SERVER=\"https://localhost:8080\" $ COOKIEJAR=\"$(mktemp)\" $ CRUMB=$(curl -u \"admin:admin\" -s --cookie-jar \"$COOKIEJAR\" \"$SERVER/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,%22:%22,//crumb)\") # verify $ echo $CRUMB Jenkins-Crumb:786**********************************************************932 # trigger a build $ curl -X POST \\ -u \"admin:admin\" \\ --cookie \"$COOKIEJAR\" \\ -H \"$CRUMB\" \\ https://${SERVER}/job/sandbox/build # to run script $ curl -d \"script=System.getProperties()\" \\ -u \"admin:admin\" \\ --cookie \"$COOKIEJAR\" \\ -H \"$CRUMB\" \\ https://${SERVER}/scriptText via wget # after 2.176.2 $ SERVER=\"https://localhost:8080\" $ COOKIEJAR=\"$(mktemp)\" $ CRUMB=\"$(wget --quiet --user=admin --password=admin --auth-no-challenge --save-cookies \"$COOKIEJAR\" --keep-session-cookies -q --output-document - \"$SERVER/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,%22:%22,//crumb)\")\" $ wget --user=admin --password=admin \\ --auth-no-challenge \\ --load-cookies \"$COOKIEJAR\" \\ --header=\"$CRUMB\" \\ --post-data=\"\" \\ --quiet \\ \"$SERVER\"/job/someJob/build credential references: * Setting Jenkins Credentials with Groovy * menski/jenkins-decrypt.py * addCredentials : hayderimran7/Jenkins_ssh_groovy.md * Jenkins Credentials Store Access via Groovy * Adding Google Service Account Credentials by a groovy script * Fetch the domain for each credential returned in a job template. Extension Points defined in Credentials Plugin CredentialsProvider.java Jenkins Pipelines: How to use withCredentials() from a shared-variable script Jenkins Credentials Store Access via Groovy How to get android signing certificate back from jenkins plugin Go Decrypt Jenkins * Jenkins: Decrypting all passwords in credentials.xml (via Jenkins execution console) How to get android signing certificate back from jenkins plugin bstapes/jenkins-decrypt * tuxfight3r/jenkins-decrypt.groovy * How to decrypt Jenkins passwords from credentials.xml? [!TIP] something else : kubernetes-credentials-provider-plugin api : com.cloudbees.plugins.credentials CertificateCredentials DomainRestrictedCredentials IdCredentials PasswordCredentials StandardCertificateCredentials StandardCredentials StandardUsernameCredentials StandardUsernamePasswordCredentials UsernameCredentials UsernamePasswordCredentials VaultUsernamePasswordCredential list all credentials import com.cloudbees.plugins.credentials.common.StandardCredentials import com.cloudbees.plugins.credentials.common.StandardUsernamePasswordCredentials import com.cloudbees.plugins.credentials.CredentialsProvider import com.cloudbees.jenkins.plugins.sshcredentials.SSHUserPrivateKey; import com.cloudbees.plugins.credentials.SystemCredentialsProvider CredentialsProvider.lookupCredentials( StandardCredentials.class, jenkins.model.Jenkins.instance) .sort{ it.id } .each{ switch( it.class.simpleName ) { case 'BasicSSHUserPrivateKey' : println \"\"\" type : ${it.class.simpleName} id : ${it.id} scope : ${it.scope} username : ${it.username} description : ${it.description} privateKeysLastModified : ${it.privateKeysLastModified} usernameSecret : ${it.usernameSecret ?: 'false'} privateKeys : ${it.privateKeys.join('\\n')} \"\"\" break; case 'CertificateCredentialsImpl' : println \"\"\" type : ${it.class.simpleName} id : ${it.id} scope : ${it.scope} password : ${it.password} description : ${it.description} keyStore.type : ${it.keyStore.type} keyStoreSource.keyStoreBytes : ${it.keyStoreSource.keyStoreBytes} keyStoreSource.uploadedKeystoreBytes : ${it.keyStoreSource.uploadedKeystoreBytes} properties : ${it.properties} properties.password : ${it.properties.password} properties.passwordEmpty : ${it.properties.passwordEmpty} properties.keyStore.type : ${it.properties.keyStore.type} \"\"\" break; case 'StringCredentialsImpl' : println \"\"\" type : ${it.class.simpleName} id : ${it.id} secret : ${it.secret} description : ${it.description} scope : ${it.scope} \"\"\" break; case 'UsernamePasswordCredentialsImpl' : println \"\"\" type : ${it.class.simpleName} id : ${it.id} username : ${it.username} password : ${it.password} description : ${it.description} usernameSecret : ${it.usernameSecret ?: 'false'} \"\"\" break; } } with vault import com.cloudbees.plugins.credentials.common.StandardCredentials import com.cloudbees.plugins.credentials.common.StandardUsernamePasswordCredentials import com.cloudbees.plugins.credentials.CredentialsProvider import com.cloudbees.jenkins.plugins.sshcredentials.SSHUserPrivateKey; import com.cloudbees.plugins.credentials.SystemCredentialsProvider import com.datapipe.jenkins.vault.credentials.common.VaultUsernamePasswordCredential import com.datapipe.jenkins.vault.credentials.VaultAppRoleCredential import com.datapipe.jenkins.vault.credentials.common.VaultSSHUserPrivateKeyImpl import com.datapipe.jenkins.vault.credentials.common.VaultStringCredentialImpl CredentialsProvider.lookupCredentials( StandardCredentials.class, jenkins.model.Jenkins.instance) .sort{ it.id } .each{ switch( it.class.simpleName ) { case 'BasicSSHUserPrivateKey' : println \"\"\" type : ${it.class.simpleName} id : ${it.id} scope : ${it.scope} username : ${it.username} description : ${it.description} privateKeysLastModified : ${it.privateKeysLastModified} usernameSecret : ${it.usernameSecret ?: 'false'} privateKeys : ${it.privateKeys.join('\\n')} \"\"\" break; case 'CertificateCredentialsImpl' : println \"\"\" type : ${it.class.simpleName} id : ${it.id} scope : ${it.scope} password : ${it.password} description : ${it.description} keyStore.type : ${it.keyStore.type} keyStoreSource.keyStoreBytes : ${it.keyStoreSource.keyStoreBytes} keyStoreSource.uploadedKeystoreBytes : ${it.keyStoreSource.uploadedKeystoreBytes} properties : ${it.properties} properties.password : ${it.properties.password} properties.passwordEmpty : ${it.properties.passwordEmpty} properties.keyStore.type : ${it.properties.keyStore.type} \"\"\" break; case 'StringCredentialsImpl' : println \"\"\" type : ${it.class.simpleName} id : ${it.id} secret : ${it.secret} description : ${it.description} scope : ${it.scope} \"\"\" break; case 'UsernamePasswordCredentialsImpl' : println \"\"\" type : ${it.class.simpleName} id : ${it.id} username : ${it.username} password : ${it.password} description : ${it.description} usernameSecret : ${it.usernameSecret ?: 'false'} \"\"\" break; case 'VaultUsernamePasswordCredentialImpl' : println \"\"\" type : ${it.class.simpleName} engineVersion : ${it.engineVersion} id : ${it.id} scope : ${it.scope} description : ${it.description} displayName : ${it.displayName} path : ${it.path} usernameKey : ${it.usernameKey} username : ${it.username} passwordKey : ${it.passwordKey} password : ${it.password} usernameSecret : ${it.usernameSecret ?: 'false'} \"\"\" break; case 'VaultAppRoleCredential': println \"\"\" type : ${it.class.simpleName} id : ${it.id} roleId : ${it.roleId} secretId : ${it.secretId} path : ${it.path} namespace : ${it.namespace} scope : ${it.scope} description : ${it.description} \"\"\" break; case 'VaultSSHUserPrivateKeyImpl': println \"\"\" type : ${it.class.simpleName} engineVersion : ${it.engineVersion} id : ${it.id} scope : ${it.scope} description : ${it.description} displayName : ${it.displayName} usernameSecret : ${it.usernameSecret ?: 'false'} usernameKey : ${it.usernameKey} username : ${it.username} privateKeyKey : ${it.privateKeyKey} privateKeys : ${it.privateKeys.join('\\n')} passphraseKey : ${it.passphraseKey} passphrase : ${ it.passphrase} \"\"\" break; case 'VaultStringCredentialImpl': println \"\"\" type : ${it.class.simpleName} engineVersion : ${it.engineVersion} id : ${it.id} displayName : ${it.displayName} description : ${it.description} prefixPath : ${it.prefixPath} path : ${it.path} secret : ${it.secret} valutKey : ${it.vaultKey} \"\"\" break; } } or import com.cloudbees.plugins.credentials.CredentialsProvider import com.cloudbees.plugins.credentials.Credentials import com.cloudbees.plugins.credentials.domains.Domain import jenkins.model.Jenkins def indent = { String text, int indentationCount -> def replacement = \"\\t\" * indentationCount text.replaceAll(\"(?m)^\", replacement) } Jenkins.get().allItems().collectMany{ CredentialsProvider.lookupStores(it).toList()}.unique().forEach { store -> Map> domainCreds = [:] store.domains.each { domainCreds.put(it, store.getCredentials(it))} if (domainCreds.collectMany{ it.value}.empty) { return } def shortenedClassName = store.getClass().name.substring(store.getClass().name.lastIndexOf(\".\") + 1) println \"Credentials for store context: ${store.contextDisplayName}, of type $shortenedClassName\" domainCreds.forEach { domain , creds -> println indent(\"Domain: ${domain.name}\", 1) creds.each { cred -> cred.properties.each { prop, val -> println indent(\"$prop = \\\"$val\\\"\", 2) } println indent(\"-----------------------\", 2) } } } StandardUsernamePasswordCredentials import com.cloudbees.plugins.credentials.common.StandardCredentials import com.cloudbees.plugins.credentials.common.StandardUsernamePasswordCredentials import com.cloudbees.plugins.credentials.CredentialsProvider List creds = CredentialsProvider.lookupCredentials( StandardUsernamePasswordCredentials.class, jenkins.model.Jenkins.instance ) creds.sort{it.id}.each { println \"\"\" id : ${it.id} username : ${it.username} password : ${it.password} description : ${it.description} usernameSecret : ${it.usernameSecret ?: 'false'} \"\"\" } \"DONE\" BasicSSHUserPrivateKey import com.cloudbees.plugins.credentials.common.StandardCredentials; import com.cloudbees.plugins.credentials.CredentialsProvider; import com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey import com.cloudbees.jenkins.plugins.sshcredentials.SSHUserPrivateKey; List creds = CredentialsProvider.lookupCredentials( SSHUserPrivateKey.class , // or BasicSSHUserPrivateKey.class jenkins.model.Jenkins.instance ).sort{ it.id } .each { println \"\"\" id : ${it.id} scope : ${it.scope} username : ${it.username} description : ${it.description} privateKeysLastModified : ${it.privateKeysLastModified} usernameSecret : ${it.usernameSecret ?: 'false'} privateKeys : ${it.privateKeys.join('\\n')} \"\"\" } CertificateCredentials import com.cloudbees.plugins.credentials.common.StandardCredentials import com.cloudbees.plugins.credentials.common.CertificateCredentials import com.cloudbees.plugins.credentials.CredentialsProvider import com.cloudbees.plugins.credentials.SecretBytes import com.cloudbees.plugins.credentials.impl.CertificateCredentialsImpl CredentialsProvider.lookupCredentials( CertificateCredentials.class, jenkins.model.Jenkins.instance ).sort{ it.id } .each { SecretBytes secretKey = it.properties.keyStoreSource.uploadedKeystoreBytes println \"\"\" id : ${it.id} password : ${it.password} description : ${it.description} scope : ${it.scope} keyStore.type : ${it.properties.keyStore.type} SecretBytes.decrypt : ${SecretBytes.decrypt(it.keyStoreSource.keyStoreBytes)} encryptedValue : ${hudson.util.Secret.fromString(secretKey.toString()).encryptedValue} plainData : ${new String(SecretBytes.fromString(secretKey.toString()).getPlainData(), \"ASCII\")} \"\"\" } \"DONE\" SystemCredentialsProvider import com.cloudbees.plugins.credentials.SystemCredentialsProvider SystemCredentialsProvider systemCredentialsProvider = jenkins.model.Jenkins.instance.getExtensionList( 'com.cloudbees.plugins.credentials.SystemCredentialsProvider' ).first() systemCredentialsProvider.credentials.each { println \"\"\" id : ${it.id} description : ${it.description} scope : ${it.scope} secret : ${it.secret} \"\"\" } VaultUsernamePasswordCredential import com.cloudbees.plugins.credentials.CredentialsProvider import com.datapipe.jenkins.vault.credentials.common.VaultUsernamePasswordCredential List creds = CredentialsProvider.lookupCredentials( VaultUsernamePasswordCredential.class , jenkins.model.Jenkins.instance ).sort{ it.id } creds.each { println \"\"\" type : ${it.class.simpleName} scope : ${it.scope} engineVersion : ${it.engineVersion} id : ${it.id} description : ${it.description} path : ${it.path} usernameKey : ${it.usernameKey} username : ${it.username} passwordKey : ${it.passwordKey} password : ${it.password} usernameSecret : ${it.usernameSecret ?: 'false'} \"\"\" } VaultAppRoleCredential import com.cloudbees.plugins.credentials.CredentialsProvider import com.datapipe.jenkins.vault.credentials.VaultAppRoleCredential List creds = CredentialsProvider.lookupCredentials( VaultAppRoleCredential.class , jenkins.model.Jenkins.instance ).sort{ it.id } creds.each { println \"\"\" type : ${it.class.simpleName} scope : ${it.scope} engineVersion : ${it.engineVersion} id : ${it.id} description : ${it.description} namespace : ${it.namespace} path : ${it.path} secretId : ${it.secretId} roleId : ${it.roleId} \"\"\" } VaultSSHUserPrivateKeyImpl import com.cloudbees.plugins.credentials.CredentialsProvider import com.datapipe.jenkins.vault.credentials.common.VaultSSHUserPrivateKeyImpl List creds = CredentialsProvider.lookupCredentials( VaultSSHUserPrivateKeyImpl.class, jenkins.model.Jenkins.instance ).sort{ it.id } creds.each { println \"\"\" type : ${it.class.simpleName} scope : ${it.scope} engineVersion : ${it.engineVersion} id : ${it.id} description : ${it.description} displayName : ${it.displayName} usernameSecret : ${it.usernameSecret ?: 'false'} usernameKey : ${it.usernameKey} username : ${it.username} privateKeyKey : ${it.privateKeyKey} privateKeys : ${it.privateKeys.collect{ it.trim() }} privateKey : ${it.privateKey} passphraseKey : ${it.passphraseKey} passphrase : ${ it.passphrase} \"\"\" } VaultStringCredentialImpl import com.cloudbees.plugins.credentials.CredentialsProvider import com.datapipe.jenkins.vault.credentials.common.VaultStringCredentialImpl List creds = CredentialsProvider.lookupCredentials( VaultStringCredentialImpl.class , jenkins.model.Jenkins.instance ).sort{ it.id } creds.each { println \"\"\" type : ${it.class.simpleName} engineVersion : ${it.engineVersion} scope : ${it.scope} id : ${it.id} description : ${it.description} displayName : ${it.displayName} prefixPath : ${it.prefixPath} path : ${it.path} valutKey : ${it.vaultKey} secret : ${it.secret} \"\"\" } VaultUsernamePasswordCredentialImpl import com.cloudbees.plugins.credentials.CredentialsProvider import com.datapipe.jenkins.vault.credentials.common.VaultUsernamePasswordCredentialImpl List creds = CredentialsProvider.lookupCredentials( VaultUsernamePasswordCredentialImpl.class , jenkins.model.Jenkins.instance ).sort{ it.id } creds.each { println \"\"\" type : ${it.class.simpleName} engineVersion : ${it.engineVersion} id : ${it.id} scope : ${it.scope} description : ${it.description} displayName : ${it.displayName} path : ${it.path} usernameKey : ${it.usernameKey} username : ${it.username} passwordKey : ${it.passwordKey} password : ${it.password} usernameSecret : ${it.usernameSecret ?: 'false'} \"\"\" } encrypt/decrypt password import hudson.util.Secret String original = 'marslo' Secret secret = Secret.fromString( original ) String encrypted = secret.getEncryptedValue() Secret decrypted = Secret.decrypt( encrypted ) println \"\"\" original : ${original} encrypted : ${encrypted} decrypted : ${decrypted} \"\"\" // original : marslo // encrypted : {AQAAABAAAAAQyF78QAdq9bWCAeUi1VdYO7cB0CfG29KrvwZUU506zig=} // decrypted : marslo or println hudson.util.Secret.fromString('marslo').getEncryptedValue() println hudson.util.Secret.decrypt( hudson.util.Secret.fromString('marslo').getEncryptedValue() // {AQAAABAAAAAQfwTdrtsFbS2MyOOA3kuO01p21CsVsSIpZg9FE1TMlMQ=} // marslo tricky Access granted with Overall/SystemRead This permission can be enabled by setting the system property jenkins.security.SystemReadPermission to true or installing the Extended Read Permission plugin. Access granted with Overall/Manage This permission can be enabled by setting the system property jenkins.security.ManagePermission to true or installing the Overall/Manage permission enabler plugin. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/script/exception.html":{"url":"jenkins/script/exception.html","title":"exception","keywords":"","body":" Aborted Exception shutdown physical agent shutdown pod references: Class java.lang.Throwable Class Throwable * Java Custom Exceptions and Best Practices Aborted Exception references: Class hudson.AbortException shutdown physical agent e.getClass() // class hudson.remoting.RequestAbortedException e.cause // java.io.IOException: Unexpected termination of the channel e.cause.getClass() // class java.io.IOException e.cause.dump() // detailMessage=Unexpected termination of the channel // cause=java.io.EOFException e.message // java.io.IOException: Unexpected termination of the channel shutdown pod references: Class hudson.remoting.RequestAbortedException Class java.nio.channels.ClosedChannelException before fully initialized references: Class org.jenkinsci.plugins.workflow.support.steps.AgentOfflineException How to retry a Jenkins Pipeline stage with an agent condition after fully initialized references: Java Suppressed Exceptions with Examples Example usage for java.lang InterruptedException getCause The hierarchy of ClosedChannelException e.getClass() // class hudson.remoting.RequestAbortedException e.cause // java.nio.channels.ClosedChannelException e.cause.getClass() // class java.nio.channels.ClosedChannelException e.message // java.nio.channels.ClosedChannelException e.suppressed.getClass() // class [Ljava.lang.Throwable e.suppressed.collect { it.getClass() }.join('\\n') // class hudson.remoting.Channel$CallSiteStackTrace e.suppressed.collect { it.message }.join('\\n') // Remote call to JNLP4-connect connection from 10.244.13.1/10.244.13.1:59576 sample in CI import hudson.remoting.RequestAbortedException try { ... } catch ( RequestAbortedException e ) { Throwable throwable = e.getCause() if ( throwable instanceof java.nio.channels.ClosedChannelException ) { String msg = \"FAILED : ${e.message} : ${e.suppressed.collect{ it.message }. join(' && ')}\" error ( msg ) } } catch ( Exception e ) { def sw = new StringWriter() e.printStackTrace( new PrintWriter(sw) ) echo sw.toString() throw e } more samples import static java.lang.System.err ; try { ... } catch( Exception ex ) { err.println( \"Exception encountered: \" + ex.toString() ); final Throwable[] suppressedExceptions = ex.getSuppressed(); final int numSuppressed = suppressedExceptions.length; if ( numSuppressed ) { err.println( \"There are ${numSuppressed} suppressed exceptions: \" ); for ( final Throwable exception : suppressedExceptions ) { err.println( exception.toString() ); } } } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/script/monitor.html":{"url":"jenkins/script/monitor.html","title":"monitor","keywords":"","body":" monitor monitor for controller monitor for agents [!TIP|label:get sizer dynamically] Closure sizer = { long size -> List units = [ 'bytes', 'KB', 'MB', 'GB', 'TB', 'PB' ] double bits = size String result = bits > 0 ? \"${bits.round(2)} bytes\" : '0' units.eachWithIndex { unit, index -> if ( bits monitor [!NOTE|label:references:] Jenkins : Monitoring Scripts Monitoring dashboard for Jenkins memory usage analysis. Documentation of JavaMelody Class index Class JavaInformations Class MemoryInformations monitor for controller memory import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* Closure sizer = { long size -> List units = [ 'bytes', 'KB', 'MB', 'GB', 'TB', 'PB' ] double bits = size String result = bits > 0 ? \"${bits.round(2)} bytes\" : '0' units.eachWithIndex { unit, index -> if ( bits http sessions import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* println SessionListener.getSessionCount() + \" sessions:\" sessions = SessionListener.getAllSessionsInformations() sessions.each { session -> println session } thread dumps import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* java = new JavaInformations(Parameters.getServletContext(), true) threads = java.getThreadInformationsList() println threads.size() + \" threads (\" + java.activeThreadCount + \" http threads active):\" threads.each { thread -> println \"\\n${thread}\" thread.getStackTrace().each { s -> println \" \" + s } } deadlock threads import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* java = new JavaInformations(Parameters.getServletContext(), true) threads = java.getThreadInformationsList() deadlocked = new java.util.ArrayList() for (thread in threads) { if (thread.deadlocked) deadlocked.add(thread) } println deadlocked.size() + \" deadlocked threads / \" + threads.size() + \" threads (\" + java.activeThreadCount + \" http threads active)\" deadlocked.each { thread -> println \"\\n${thread}\" thread.getStackTrace().each { s -> println \" \" + s } } JVM data import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* java = new JavaInformations( Parameters.getServletContext(), true ) println \"\"\" sessions count : ${java.sessionCount} active HTTP threads count : ${java.activeThreadCount} threads count : ${java.threadCount} system load average : ${java.systemLoadAverage} system cpu load : ${java.systemCpuLoad} available processors : ${java.availableProcessors} host : ${java.host} os : ${java.os} java version : ${java.javaVersion} jvm version : ${java.jvmVersion} pid : ${java.pid} server info : ${java.serverInfo} context path : ${java.contextPath} start date : ${java.startDate} free disk space in Jenkins directory : ${Math.round(java.freeDiskSpaceInTemp / 1024 / 1024)} Mb \"\"\" result sessions count : 10 active HTTP threads count : 1 threads count : 551 system load average : 0.23 system cpu load : 0.21985650348135538 available processors : 72 host : devops-jenkins-bf57ddfbc-26mjz@10.244.13.138 os : Linux, 4.19.12-1.el7.elrepo.x86_64 , amd64/64 java version : OpenJDK Runtime Environment, 11.0.18+10 jvm version : OpenJDK 64-Bit Server VM, 11.0.18+10, mixed mode pid : 7 server info : jetty/10.0.13 context path : start date : Wed May 10 23:45:43 PDT 2023 free disk space in Jenkins directory : 1709602 Mb heap histogram ( dangerous ) import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* classes = VirtualMachine.createHeapHistogram().getHeapHistogram() println \"class instances bytes source\" println \"=====================================\" classes.each { c -> println c.name + \" \" + c.instancesCount + \" \" + c.bytes + \" \" + c.source } heap dump ( dangerous ) import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* if (System.getProperty(\"java.vendor\").contains(\"IBM\")) { Action.HEAP_DUMP.ibmHeapDump() println I18N.getString(\"heap_dump_genere_ibm\") } else { heapDumpPath = Action.HEAP_DUMP.heapDump().getPath() println I18N.getFormattedString(\"heap_dump_genere\", heapDumpPath) } MBean attribute value import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* exampleAttribute = \"java.lang:type=OperatingSystem.ProcessCpuTime\" println exampleAttribute + \" = \" + MBeans.getConvertedAttributes(exampleAttribute) stats of builds and build steps having mean time greater than severe threshold [!NOTE|label:by default:] By default, severe threshold = 2 x stddev of all durations and warning threshold = 1 x stddev import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* buildCounter = CounterRunListener.getBuildCounter() aggreg = new CounterRequestAggregation(buildCounter) aggreg.getRequests().findAll{ request -> request.getMean() >= aggreg.getSevereThreshold() || request.getCpuTimeMean() >= aggreg.getSevereThreshold() }.each { request -> println \"\"\" ${request.getName()} : hits = ${request.getHits()} mean = ${request.getMean()} max = ${request.getMaximum()} stddev = ${request.getStandardDeviation()} cpuTimeMean = ${request.getCpuTimeMean()} systemErrorPercentage = ${request.getSystemErrorPercentage()} \"\"\" } GC import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* before = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory() System.gc() after = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory() println I18N.getFormattedString( \"ramasse_miette_execute\", Math.round((before - after) / 1024) ) alerts import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* Closure sizer = { long size -> List units = [ 'bytes', 'KB', 'MB', 'GB', 'TB', 'PB' ] double bits = size String result = bits > 0 ? \"${bits.round(2)} bytes\" : '0' units.eachWithIndex { unit, index -> if ( bits if ( thread.deadlocked ) deadlocked.add(thread) } println deadlocked.size() + \" deadlocked threads / \" + threads.size() + \" threads\" deadlocked.each { thread -> println \"\"\" ${thread} : ${thread.getStackTrace().collect { it }.join('\\n' + ' '*10)} \"\"\" } if (java.systemLoadAverage > 50 ) throw new Exception( \"Alert for Jenkins: systemLoadAverage is \" + java.systemLoadAverage ) if (java.activeThreadCount > 100 ) throw new Exception( \"Alert for Jenkins: activeThreadCount is \" + java.activeThreadCount ) if (deadlocked.size() > 0 ) throw new Exception( \"Alert for Jenkins: \" + deadlocked.size( ) + \" deadlocked threads\" ) if (java.freeDiskSpaceInTemp / 1024 / 1024 monitor for agents jvm data, memory data, deadlocked threads import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* Closure sizer = { long size -> List units = [ 'bytes', 'KB', 'MB', 'GB', 'TB', 'PB' ] String result = bits > 0 ? \"${bits.round(2)} bytes\" : '0' double bits = size units.eachWithIndex { unit, index -> if ( bits java = mapByNodeName.get(node) println \"\"\" Node : ${node} : sessions count : ${java.sessionCount} active HTTP threads count : ${java.activeThreadCount} threads count : ${java.threadCount} system load average : ${java.systemLoadAverage} system cpu load : ${java.systemCpuLoad} available processors : ${java.availableProcessors} host : ${java.host} os : ${java.os} java version : ${java.javaVersion} jvm version : ${java.jvmVersion} pid : ${java.pid} server info : ${java.serverInfo} context path : ${java.contextPath} start date : ${java.startDate} \"\"\" memory = java.memoryInformations println \"\"\" used memory : ${sizer(memory.usedMemory)} max memory : ${sizer(memory.maxMemory)} used perm gen : ${sizer(memory.usedPermGen)} max perm gen : ${sizer(memory.maxPermGen)} used non heap : ${sizer(memory.usedNonHeapMemory)} used physical memory : ${sizer(memory.usedPhysicalMemorySize)} used swap space : ${sizer(memory.usedSwapSpaceSize)} \"\"\" threads = java.getThreadInformationsList() List deadlocked = threads.findAll{ it.deadlocked } println \"\"\" thread : ${deadlocked.size()} deadlocked threads / ${threads.size()} threads ( ${java.activeThreadCount} threads active ) \"\"\" deadlocked.collectEntries { thread -> [ \"${thread}\" : ${thread.getStackTrace().collect{ t}} ] } .each { thread, s -> println \"\"\" ${thread} : ${s.join('\\n' + ' '*20)} \"\"\" } println ' '*10 + '*'*60 } aa import net.bull.javamelody.* import net.bull.javamelody.internal.model.* import net.bull.javamelody.internal.common.* String exampleAttributes = \"java.lang:type=OperatingSystem.ProcessCpuTime|java.lang:type=Memory.HeapMemoryUsage\" // null for all nodes, not null for a particular node String nodeName = null List values = new RemoteCallHelper(nodeName).collectJmxValues(exampleAttributes) values.each { value -> println exampleAttributes + \" = \" + value } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/script/tricky.html":{"url":"jenkins/script/tricky.html","title":"tricky","keywords":"","body":" DSL How do I access Pipeline DSLs from inside a Groovy class? jobs Create a Permanent Agent from Groovy Console agents Monitor and Restart Offline Agents others run shell scripts in a cluster-operation get all running thread Automate configuring via Jenkins Script Console Jenkins search results missing /ci/ URL component jenkins server info references: Jenkins Features Controlled with System Properties DSL How do I access Pipeline DSLs from inside a Groovy class? class C implements Serializable { def stuff(steps) { steps.node { steps.sh 'echo hello' } } } def c = new C() c.stuff(steps) orclass C implements Serializable { def stuff(script) { script.node { script.echo \"running in ${script.env.JENKINS_URL}\" } } } def c = new C() c.stuff(this) jobs Create a Permanent Agent from Groovy Console import hudson.model.* import jenkins.model.* import hudson.slaves.* import hudson.slaves.EnvironmentVariablesNodeProperty.Entry /** * INSERT \"Launch Method\" SNIPPET HERE */ // Define a \"Permanent Agent\" Slave agent = new DumbSlave( \"agent-node\", \"/home/jenkins\", launcher) agent.nodeDescription = \"Agent node description\" agent.numExecutors = 1 agent.labelString = \"agent-node-label\" agent.mode = Node.Mode.NORMAL agent.retentionStrategy = new RetentionStrategy.Always() List env = new ArrayList() env.add(new Entry(\"key1\",\"value1\")) env.add(new Entry(\"key2\",\"value2\")) EnvironmentVariablesNodeProperty envPro = new EnvironmentVariablesNodeProperty(env) agent.getNodeProperties().add(envPro) // Create a \"Permanent Agent\" Jenkins.instance.addNode(agent) return \"Node has been created successfully.\" or:CloudBees SSH Build Agents plugin 2.0 and newer import com.cloudbees.jenkins.plugins.sshslaves.verification.* import com.cloudbees.jenkins.plugins.sshslaves.SSHConnectionDetails // Pick one of the strategies from the comments below this line ServerKeyVerificationStrategy serverKeyVerificationStrategy = new TrustInitialConnectionVerificationStrategy(false) // = new TrustInitialConnectionVerificationStrategy(false /* \"Require manual verification of initial connection\" */) // \"Manually trusted key verification Strategy\" // = new ManuallyConnectionVerificationStrategy(\"\") // \"Manually provided key verification Strategy\" // = new KnownHostsConnectionVerificationStrategy() // \"~/.ssh/known_hosts file Verification Strategy\" // = new BlindTrustConnectionVerificationStrategy() // \"Non-verifying Verification Strategy\" // Define a \"Launch method\": \"Launch agents via SSH\" ComputerLauncher launcher = new com.cloudbees.jenkins.plugins.sshslaves.SSHLauncher( \"host\", // Host new SSHConnectionDetails( \"credentialsId\", // Credentials ID 22, // port (String)null, // JavaPath (String)null, // JVM Options (String)null, // Prefix Start Agent Command (String)null, // Suffix Start Agent Command (boolean)false, // Log environment on initial connect (ServerKeyVerificationStrategy) serverKeyVerificationStrategy // Host Key Verification Strategy ) ) agents Monitor and Restart Offline Agents import hudson.node_monitors.* import hudson.slaves.* import java.util.concurrent.* jenkins = Jenkins.instance import javax.mail.internet.* import javax.mail.* import javax.activation.* def sendMail (agent, cause) { message = agent + \" agent is down. Check http://JENKINS_HOSTNAME:JENKINS_PORT/computer/\" + agent + \"\\nBecause \" + cause subject = agent + \" agent is offline\" toAddress = \"JENKINS_ADMIN@YOUR_DOMAIN\" fromAddress = \"JENKINS@YOUR_DOMAIN\" host = \"SMTP_SERVER\" port = \"SMTP_PORT\" Properties mprops = new Properties() mprops.setProperty(\"mail.transport.protocol\",\"smtp\") mprops.setProperty(\"mail.host\",host) mprops.setProperty(\"mail.smtp.port\",port) Session lSession = Session.getDefaultInstance(mprops,null) MimeMessage msg = new MimeMessage(lSession) //tokenize out the recipients in case they came in as a list StringTokenizer tok = new StringTokenizer(toAddress,\";\") ArrayList emailTos = new ArrayList() while(tok.hasMoreElements()) { emailTos.add(new InternetAddress(tok.nextElement().toString())) } InternetAddress[] to = new InternetAddress[emailTos.size()] to = (InternetAddress[]) emailTos.toArray(to) msg.setRecipients(MimeMessage.RecipientType.TO,to) InternetAddress fromAddr = new InternetAddress(fromAddress) msg.setFrom(fromAddr) msg.setFrom(new InternetAddress(fromAddress)) msg.setSubject(subject) msg.setText(message) Transport transporter = lSession.getTransport(\"smtp\") transporter.connect() transporter.send(msg) } def getEnviron(computer) { def env def thread = Thread.start(\"Getting env from ${computer.name}\", { env = computer.environment }) thread.join(2000) if (thread.isAlive()) thread.interrupt() env } def agentAccessible(computer) { getEnviron(computer)?.get('PATH') != null } def numberOfflineNodes = 0 def numberNodes = 0 for (agent in jenkins.getNodes()) { def computer = agent.computer numberNodes ++ println \"\" println \"Checking computer ${computer.name}:\" def isOK = (agentAccessible(computer) && !computer.offline) if (isOK) { println \"\\t\\tOK, got PATH back from slave ${computer.name}.\" println('\\tcomputer.isOffline: ' + slave.getComputer().isOffline()) println('\\tcomputer.isTemporarilyOffline: ' + slave.getComputer().isTemporarilyOffline()) println('\\tcomputer.getOfflineCause: ' + slave.getComputer().getOfflineCause()) println('\\tcomputer.offline: ' + computer.offline) } else { numberOfflineNodes ++ println \" ERROR: can't get PATH from agent ${computer.name}.\" println('\\tcomputer.isOffline: ' + agent.getComputer().isOffline()) println('\\tcomputer.isTemporarilyOffline: ' + agent.getComputer().isTemporarilyOffline()) println('\\tcomputer.getOfflineCause: ' + agent.getComputer().getOfflineCause()) println('\\tcomputer.offline: ' + computer.offline) sendMail(computer.name, agent.getComputer().getOfflineCause().toString()) if (agent.getComputer().isTemporarilyOffline()) { if (!agent.getComputer().getOfflineCause().toString().contains(\"Disconnected by\")) { computer.setTemporarilyOffline(false, agent.getComputer().getOfflineCause()) } } else { computer.connect(true) } } } println (\"Number of Offline Nodes: \" + numberOfflineNodes) println (\"Number of Nodes: \" + numberNodes) others run shell scripts in a cluster-operation def exec(cmd) { println cmd def process = new ProcessBuilder([ \"sh\", \"-c\", cmd]) .directory(new File(\"/tmp\")) .redirectErrorStream(true) .start() process.outputStream.close() process.inputStream.eachLine {println it} process.waitFor() return process.exitValue() } [ \"echo hello world\", \"ls -al\" ].each { exec(it) } get all running thread Thread.getAllStackTraces().keySet().each() { println it.getName() } kill running thread or using t.stop() instead of t.interrupt() Thread.getAllStackTraces().keySet().each() { t -> if (t.getName()==\"YOUR THREAD NAME\" ) { t.interrupt(); } } Automate configuring via Jenkins Script Console import net.sf.json.JSONArray import net.sf.json.JSONObject import org.thoughtslive.jenkins.plugins.jira.JiraStepsConfig import org.thoughtslive.jenkins.plugins.jira.Site //global user-defined configuration JSONArray sitesConf = [ [ name: 'another', url: 'http://example.com', timeout: 10000, readTimeout: 10000, loginType: 'BASIC', userName: 'foo', password: 'some pass' ], [ name: 'moar jira', url: 'http://example.com', timeout: 10000, readTimeout: 10000, loginType: 'OAUTH', consumerKey: 'my consumer key', privateKey: 'my private key', secret: 'super secret', token: 'my token' ] ] as JSONArray //get global Jenkins configuration JiraStepsConfig.ConfigDescriptorImpl config = Jenkins.instance.getExtensionList(JiraStepsConfig.ConfigDescriptorImpl.class)[0] ArrayList sites = new ArrayList() //configure new sites from the above JSONArray sitesConf.each { s -> String loginType = s.optString('loginType', '').toUpperCase() if(loginType in ['BASIC', 'OAUTH']) { Site site = new Site(s.optString('name',''), new URL(s.optString('url', '')), s.optString('loginType', ''), s.optInt('timeout', 10000)) if(loginType == 'BASIC') { site.setUserName(s.optString('userName', '')) site.setPassword(s.optString('password', '')) site.setReadTimeout(s.optInt('readTimeout', 10000)) } else { //loginType is OAUTH site.setConsumerKey(s.optString('consumerKey', '')) site.setPrivateKey(s.optString('privateKey', '')) site.setSecret(s.optString('secret', '')) site.setToken(s.optString('token', '')) site.setReadTimeout(s.optInt('readTimeout', 10000)) } sites.add(site) } } //set our defined sites config.setSites(sites.toArray(new Site[0])) //persist configuration to disk as XML config.save() or via Configuration as Code plugin unclassified: jiraStepsConfig: sites: - name: 'another' url: 'http://example.com' timeout: 10000 readTimeout: 10000 loginType: 'BASIC' userName: 'foo' password: 'some pass' - name: 'moar jira' url: 'http://example.com' timeout: 10000 readTimeout: 10000 loginType: 'OAUTH' consumerKey: 'my consumer key' privateKey: 'my private key' secret: 'super secret' token: 'my token' install plugin for (plugin in [\"ant\", \"artifactdeployer\", \"build-failure-analyzer\", \"build-name-setter\", \"build-pipeline-plugin\", \"build-timeout\", \"claim\", \"clone-workspace-scm\", \"cobertura\", \"collapsing-console-sections\", \"conditional-buildstep\", \"configurationslicing\", \"copy-to-slave\", \"credentials\", \"cvs\", \"disk-usage\", \"ec2\", \"email-ext\", \"external-monitor-job\", \"git\", \"git-client\", \"global-build-stats\", \"gravatar\", \"groovy-postbuild\", \"javadoc\", \"jobConfigHistory\", \"ldap\", \"mailer\", \"mask-passwords\", \"maven-plugin\", \"openid\", \"pam-auth\", \"parameterized-trigger\", \"run-condition\", \"shelve-project-plugin\", \"ssh-credentials\", \"ssh-slaves\", \"subversion\", \"svn-release-mgr\", \"token-macro\", \"translation\", \"view-job-filters\", \"ws-cleanup\"]) { e = Hudson.instance.updateCenter.getPlugin(plugin).deploy().get().getError() if (e != null) println e.message } or import jenkins.model.* import java.util.logging.Logger def logger = Logger.getLogger(\"\") def installed = false def initialized = false def pluginParameter=\"gitlab-plugin hipchat swarm\" def plugins =pluginParameter.split() logger.info(\"\" + plugins) def instance =Jenkins.getInstance() def pm = instance.getPluginManager() def uc =instance.getUpdateCenter() uc.updateAllSites() plugins.each { logger.info(\"Checking \" + it) if (!pm.getPlugin(it)) { logger.info(\"Looking UpdateCenter for \" + it) if (!initialized) { uc.updateAllSites() initialized = true } def plugin = uc.getPlugin(it) if (plugin) { logger.info(\"Installing \" + it) plugin.deploy() installed = true } } } if (installed) { logger.info(\"Plugins installed, initializing a restart!\") instance.save() instance.doSafeRestart() } Jenkins search results missing /ci/ URL component new File(System.getProperty(\"user.home\"),'.nestedViewsSearch').createNewFile() jenkins server info println(\"Jenkins: ${Jenkins.instance.getVersion()}\") println(\"OS: ${System.getProperty('os.name')} - ${System.getProperty('os.version')}\") println(\"Java: ${System.getProperty('java.version')} - ${System.getProperty('java.vm.vendor')} (${System.getProperty('java.vm.name')})\") Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/api.html":{"url":"jenkins/api.html","title":"api","keywords":"","body":" safeRestart via API execute Groovy script with an API call stop build via api get builds information list plugins using api (curl) using cli builds get particular build parameters get all parameters via Json format reference: Example for Jenkins API CSRF Protection Explained Remote access API How to build a job using the REST API and cURL? 7 useful Jenkins Rest services to get crumb and sessoin : imarslo : crumb issuer imarslo : script console with sessoin (cookie)$ SERVER='https://localhost:443' $ COOKIEJAR=\"$(mktemp)\" $ CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"${COOKIEJAR}\" \\ 'https://${SERVER}/crumbIssuer/api/json' | jq -r '[.crumbRequestField, .crumb] | join(\":\")' ) safeRestart via API $ SERVER='https://localhost:443' $ COOKIEJAR=\"$(mktemp)\" $ CRUMB=$(curl --cookie-jar \"${COOKIEJAR}\" \\ \"https://${SERVER}/crumbIssuer/api/json\" | jq -r '.crumbRequestField + \":\" + .crumb' ) $ curl -v \\ -X POST \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ -H \"Content-Type: application/json\" \\ -H \"Accept: application/json\" https://${SERVER}/safeRestart execute Groovy script with an API call $ curl -v \\ --user username:ApiToken \\ -d \"script=$(cat /tmp/script.groovy)\" \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ http://JENKINS_URL/scriptText # or $ curl -v \\ --user username:ApiToken \\ -d \"script=println 'this script works'\" \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ http://JENKINS_URL/scriptText stop build via api api comments BUILD_URL/stop abort a build BUILD_URL/term forcibly terminate a build BUILD_URL/kill hard kill a pipeline get builds information [!TIP] reference: USING JENKINS / HUDSON REMOTE API TO CHECK JOBS STATUS justlaputa/jenkins-api.md via job api $ curl -sSLg \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ http://jenkins:8080/job/my-job/api/json?tree=builds[id,number,duration,timestamp,builtOn] get particular fields for all builds [!TIP] api format: api/json?tree=allBuilds[Bartifact,description,building,displayName,duration,estimatedDuration,fullDisplayName,id,number,queueId,result,timestamp,url] $ curl -s \\ --globoff \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ 'https:///job//api/json?tree=allBuilds[artifact,description,building,displayName,duration,estimatedDuration,fullDisplayName,id,number,queueId,result,timestamp,url]' | jq --raw-output . list plugins using api (curl) $ curl -s \\ -u: \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ https:///pluginManager/api/json?depth=1 | jq -r '.plugins[] | \"\\(.shortName):\\(.version)\"' | sort or$ curl -s \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ 'https:///pluginManager/api/json?pretty=1&tree=plugins\\[shortName,longName,version\\]' { \"_class\": \"hudson.LocalPluginManager\", \"plugins\": [ { \"longName\": \"SSH Credentials Plugin\", \"shortName\": \"ssh-credentials\", \"version\": \"1.18.1\" }, { \"longName\": \"Configuration as Code Plugin\", \"shortName\": \"configuration-as-code\", \"version\": \"1.47\" }, ... } using cli $ cat plugin.groovy def plugins = jenkins.model.Jenkins.instance.getPluginManager().getPlugins() plugins.each {println \"${it.getShortName()}: ${it.getVersion()}\"} by jar$ curl -fsSL -O https://JENKINS_URL/jnlpJars/jenkins-cli.jar $ java -jar jenkins-cli.jar \\ [-auth :] \\ -s https://JENKINS_URL groovy = or$ java -jar jenkins-cli.jar \\ [-auth :] \\ -s https://JENKINS_URL \\ list-plugins by ssh $ ssh [-i ] [-l ] -p JENKINS_URL groovy = or $ ssh [-i ] [-l ] -p JENKINS_URL list-plugins or $ ssh [-i ] [-l ] -p JENKINS_URL groovy builds get particular build parameters $ curl -s https:///job///api/xml?xpath=/workflowRun/action/parameter[name=\"\"]/value remove xml tag $ curl -s 'https:///job///api/xml?xpath=/workflowRun/action/parameter\\[name=\"tester\"\\]/value' | sed -re 's:]+>([^ i.e.: $ curl -s --globoff 'https:///job///api/xml?xpath=/*/action/parameter[name=%22id%22]' idmarslo $ curl -s --globoff 'https:///job///api/xml?xpath=/*/action/parameter[name=%22id%22]/value' marslo $ curl -s --globoff 'https:///job///api/xml?xpath=/*/action/parameter[name=%22id%22]/value' | sed -re 's:]+>([^ get all parameters via Json format [!TIP|label:api:] https:///job///api/json?tree=actions[parameters[*]] $ curl -s --globoff 'https:///job///api/json?tree=actions[parameters[*]]' | jq --raw-output '.actions[].parameters[]?' { \"_class\": \"hudson.model.StringParameterValue\", \"name\": \"id\", \"value\": \"marslo\" } { \"_class\": \"hudson.model.StringParameterValue\", \"name\": \"gender\", \"value\": \"female\" } additional format$ curl -s --globoff 'https:///job///api/json?tree=actions[parameters[*]]' | jq --raw-output '.actions[].parameters[]? | .name + \"\\t\" + .value' id marslo gender female [!TIP|label:jq tips:] remove empty line from output i.e.: original jq --raw-output .actions[].parameters remove empty line: jq --raw-output '[.actions[].parameters | select(length > 0) ]' $ curl -s --globoff 'https:///job///api/json?tree=actions[parameters[*]]' | jq --raw-output '[.actions[].parameters | select(length > 0)]' [ [ { \"_class\": \"hudson.model.StringParameterValue\", \"name\": \"id\", \"value\": \"marslo\" }, { \"_class\": \"hudson.model.StringParameterValue\", \"name\": \"gender\", \"value\": \"female\" } ] ] Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/cli.html":{"url":"jenkins/cli.html","title":"cli","keywords":"","body":" setup cli get port ssh jenkins-cli.jar execute groovy script via cli ERROR: This command is requesting the -remoting mode which is no longer supported solution execute groovysh execute the script via https execute cil via kubectl man cli references: Jenkins World 2017: Mastering the Jenkins Script Console Jenkins Area Meetup - Hacking on Jenkins Internals - Jenkins Script Console Write Groovy scripts for Jenkins with code completion Example Groovy scripts Jenkins Startup logs show builds migrated by the RunIdMigrator How to create a job using the REST API and cURL? Creating node with the REST API setup cli export JENKINS_DOMAIN= get port $ curl -Lv https://${JENKINS_DOMAIN}/login 2>&1 | grep -i 'x-ssh-endpoint' ssh Jenkins config ~/.ssh/config $ cat ~/.ssh/config Host my.jenkins.com User marslo IdentityFile ~/.ssh/marslo Port 32123 using cli $ ssh -q ${JENKINS_DOMAIN} help add-job-to-view Adds jobs to view. apply-configuration Apply YAML configuration to instance build Builds a job, and optionally waits until its completion. cancel-quiet-down Cancel the effect of the \"quiet-down\" command. channel-process Launch a new JVM on a slave and connect it with the master with remoting ... or $ ssh -l -i -p ${JENKINS_DOMAIN} # example $ ssh -l marslo -i ~/.ssh/marslo -p 32123 ${JENKINS_DOMAIN} help jenkins-cli.jar get client (jenkins-cli.jar) $ curl -fsSL -O [-u:] https://${JENKINS_DOMAIN}/jnlpJars/jenkins-cli.jar # or $ curl -fsSL -O --netrc-file ~/.marslo/.netrc' https://${JENKINS_DOMAIN}/jnlpJars/jenkins-cli.jar $ cat ~/.marslo/.netrc machine login myaccount password mypassword use cli $ java -jar jenkins-cli.jar -auth : -s https://${JENKINS_DOMAIN} # example $ java -jar jenkins-cli.jar -auth marslo: -s https://${JENKINS_DOMAIN} help add-job-to-view Adds jobs to view. apply-configuration Apply YAML configuration to instance build Builds a job, and optionally waits until its completion. cancel-quiet-down Cancel the effect of the \"quiet-down\" command. ... handle -auth using directly in command line $ java -jar jenkins-cli.jar -auth marslo: -s https://${JENKINS_DOMAIN} using file $ echo 'marslo: ~/.marslo/.jenkins-cli' $ java -jar jenkins-cli.jar -auth @/Users/marslo/.marslo/.jenkins-cli -s https://${JENKINS_DOMAIN} using environment $ export JENKINS_USER_ID=marslo $ export JENKINS_API_TOKEN= $ java -jar jenkins-cli.jar -s https://${JENKINS_DOMAIN} execute groovy script via cli ERROR: This command is requesting the -remoting mode which is no longer supported $ ssh -q groovy solution $ ssh -q groovy = i.e.: $ cat a.groovy println System.getProperties().sort().findAll{ it.key.contains('java') }.collect{ \"${it.key} ~> ${it.value}\" }.join('\\n') $ ssh jenkins.example.com groovy = sun.awt.X11GraphicsEnvironment java.awt.headless ~> true java.awt.printerjob ~> sun.print.PSPrinterJob java.class.path ~> /usr/share/jenkins/jenkins.war ... execute groovysh $ ssh groovysh groovy:000> println System.getProperties().sort().collect{ \"${it.key} ~> ${it.value}\" }.join('\\n') awt.toolkit ~> sun.awt.X11.XToolkit com.cloudbees.workflow.rest.external.ChangeSetExt.resolveCommitAuthors ~> true executable-war ~> /usr/share/jenkins/jenkins.war file.encoding ~> UTF-8 file.separator ~> / execute the script via https [!TIP|label:references:] Script Console imarslo : script console A Jenkins Admin can execute groovy scripts remotely by sending an HTTP POST request to /script/ url or /scriptText/. format $ curl -d \"script=\" https://jenkins/script # or to get output as a plain text result (no HTML) $ curl -d \"script=\" https://jenkins/scriptText example : curl submitting groovy file via bash $ curl --data-urlencode \"script=$( example : Python submitting groovy file providing username and api token with open('somescript.groovy', 'r') as fd: data = fd.read() r = requests.post('https://jenkins/scriptText', auth=('username', 'api-token'), data={'script': data}) execute cil via kubectl [!TIP|label:references:] Secrets handling in Kubernetes - A Jenkins story $ kubectl exec -it po/jenkins-0 -c jenkins -- bash -c 'echo \\'println(hudson.util.Secret.fromString(\"test\").getEncryptedValue())' | java -jar /var/jenkins_home/war/WEB-INF/lib/cli-2.303.1.jar s http://0.0.0.0:8080 auth Admin:$(cat /run/secrets/chart-admin-password) groovy = ' {AQAAABAAAAAQGiN0B2weIsYfpg0LqBbM7WSBn9+zSBcH4OXyYpaVVig=} $ man cli CMD DESCRIPTION add-job-to-view Adds jobs to view. apply-configuration Apply YAML configuration to instance build Builds a job, and optionally waits until its completion. cancel-quiet-down Cancel the effect of the \"quiet-down\" command. check-configuration Check YAML configuration to instance clear-queue Clears the build queue. connect-node Reconnect to a node(s) console Retrieves console output of a build. copy-job Copies a job. create-credentials-by-xml Create Credential by XML create-credentials-domain-by-xml Create Credentials Domain by XML create-job Creates a new job by reading stdin as a configuration XML file. create-node Creates a new node by reading stdin as a XML configuration. create-view Creates a new view by reading stdin as a XML configuration. declarative-linter Validate a Jenkinsfile containing a Declarative Pipeline delete-builds Deletes build record(s). delete-credentials Delete a Credential delete-credentials-domain Delete a Credentials Domain delete-job Deletes job(s). delete-node Deletes node(s) delete-view Deletes view(s). disable-job Disables a job. disable-plugin Disable one or more installed plugins. disconnect-node Disconnects from a node. enable-job Enables a job. enable-plugin Enables one or more installed plugins transitively. export-configuration Export jenkins configuration as YAML get-credentials-as-xml Get a Credentials as XML (secrets redacted) get-credentials-domain-as-xml Get a Credentials Domain as XML get-gradle List available gradle installations get-job Dumps the job definition XML to stdout. get-node Dumps the node definition XML to stdout. get-view Dumps the view definition XML to stdout. groovy Executes the specified Groovy script. groovysh Runs an interactive groovy shell. help Lists all the available commands or a detailed description of single command. import-credentials-as-xml Import credentials as XML. The output of \"list-credentials-as-xml\" can be used as input here as is, the only needed change is to set the actual Secrets which are redacted in the output. install-plugin Installs a plugin either from a file, an URL, or from update center. keep-build Mark the build to keep the build forever. list-changes Dumps the changelog for the specified build(s). list-credentials Lists the Credentials in a specific Store list-credentials-as-xml Export credentials as XML. The output of this command can be used as input for \"import-credentials-as-xml\" as is, the only needed change is to set the actual Secrets which are redacted in the output. list-credentials-context-resolvers List Credentials Context Resolvers list-credentials-providers List Credentials Providers list-jobs Lists all jobs in a specific view or item group. list-plugins Outputs a list of installed plugins. mail Reads stdin and sends that out as an e-mail. offline-node Stop using a node for performing builds temporarily, until the next \"online-node\" command. online-node Resume using a node for performing builds, to cancel out the earlier \"offline-node\" command. quiet-down Quiet down Jenkins, in preparation for a restart. Don’t start any builds. reload-configuration Discard all the loaded data in memory and reload everything from file system. Useful when you modified config files directly on disk. reload-jcasc-configuration Reload JCasC YAML configuration reload-job Reload job(s) remove-job-from-view Removes jobs from view. replay-pipeline Replay a Pipeline build with edited script taken from standard input restart Restart Jenkins. restart-from-stage Restart a completed Declarative Pipeline build from a given stage. safe-restart Safely restart Jenkins. safe-shutdown Puts Jenkins into the quiet mode, wait for existing builds to be completed, and then shut down Jenkins. session-id Outputs the session ID, which changes every time Jenkins restarts. set-build-description Sets the description of a build. set-build-display-name Sets the displayName of a build. set-external-build-result Set external monitor job result. shutdown Immediately shuts down Jenkins server. stop-builds Stop all running builds for job(s) update-credentials-by-xml Update Credentials by XML update-credentials-domain-by-xml Update Credentials Domain by XML update-job Updates the job definition XML from stdin. The opposite of the get-job command. update-node Updates the node definition XML from stdin. The opposite of the get-node command. update-view Updates the view definition XML from stdin. The opposite of the get-view command. version Outputs the current version. wait-node-offline Wait for a node to become offline. wait-node-online Wait for a node to become online. who-am-i Reports your credential and permissions. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/plugins.html":{"url":"jenkins/plugins/plugins.html","title":"plugins","keywords":"","body":" upload via api plugins recommended plugins optinal CloudBees reference: plugin index Pipeline Syntax Pipeline Best Practices jenkinsci/plugin-installation-manager-tool jenkinsci/docker/install-plugins.sh gitops-playground/scripts/jenkins/plugins/download-plugins.sh gitops-playground/scripts/jenkins/init-jenkins.sh jenkins/core/src/main/java/hudson/PluginManager.java * How to Install Jenkins Plugins From Command Line Using the Jenkins CLI hoesler/install_jenkins_plugin.sh upload via api $ curl -i -F file=@plugin.hpi http://${JENKINS_URL}/pluginManager/uploadPlugin # via CLI $ ssh ${JENKINS_URL} install-plugin https://artifactory.example.com/jenkins/plugins/pipeline-timeline.hpi Installing a plugin from https://artifactory.example.com/jenkins/plugins/pipeline-timeline.hpi # via [plugin-installation-manager-tool](https://github.com/jenkinsci/plugin-installation-manager-tool) $ java -jar jenkins-plugin-manager-$version.jar \\ --plugin-download-directory pluginsFolder \\ --plugin-file plugins.yml \\ --war jenkins.war other apis pluginManager/installNecessaryPlugins plugins recommended plugins Artifactory Git plugin Gerrit Code Review plugin Gerrit Trigger Kubernetes Docker Commons Plugin Pipeline Pipeline Utility Steps Step reference Pipeline Steps Reference Blue Ocean Copy Artifact JUnit Plugin Build Trigger Badge Plugin Groovy Postbuild Active Choices Plug-in AnsiColor Build Timestamp Plugin Docker Pipeline Email Extension Environment Injector Plugin Green Balls Job Configuration History Plugin Lockable Resources plugin Matrix Authorization Strategy Plugin Monitoring Rebuilder ThinBackup Sectioned View Parameterized Scheduler Metrics Validating String Parameter Klocwork Analysis Strict Crumb Issuer Plugin due to SECURITY-626 optinal JobFanIn Pipeline Aggregator Active Directory plugin Delivery Pipeline Plugin Log Parser Plugin CloudBees CloudBees Template plugin Folders Plus plugin Jenkins Health Advisor by CloudBees CloudBees Monitoring Plugin CloudBees Plugin Usage Analyzer plugin Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/kubernetes.html":{"url":"jenkins/plugins/kubernetes.html","title":"kubernetes","keywords":"","body":" namespace generate credentials for pfx full steps configure in jenkins using kubeconfig for remote cluster credential using ClusterRoleBinding pull with credentials Q&A references: podTempate Jenkins Kubernetes Plugin: Running Agents In Other Clusters Jenkins Kubernetes Plugin: Using the plugin in your pipelines Create Kubernetes Service Accounts and Kubeconfigs Setup Jenkins Pipeline and Blue Ocean in Kubernetes * How to Setup Jenkins Build Agents on Kubernetes Pods Pull an Image from a Private Registry 从私有仓库拉取镜像 How to access webSockets for Jenkins inbound agents? namespace namespace $ cat quota $ cat sa.yml jenkins.io --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: jenkins-admin rules: - apiGroups: [\"\"] resources: [\"*\"] verbs: [\"*\"] --- apiVersion: v1 kind: ServiceAccount metadata: name: jenkins-admin namespace: devops-tools --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: jenkins-admin roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: jenkins-admin subjects: - kind: ServiceAccount name: jenkins-admin namespace: devops-tools or apiVersion: v1 kind: ServiceAccount metadata: name: jenkins-admin namespace: devops-tools --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: jenkins namespace: devops-tools labels: \"app.kubernetes.io/name\": 'jenkins' rules: - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/exec\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/log\"] verbs: [\"get\",\"list\",\"watch\"] - apiGroups: [\"\"] resources: [\"secrets\"] verbs: [\"get\"] --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: jenkins-role-binding namespace: devops-tools roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: jenkins subjects: - kind: ServiceAccount name: jenkins-admin namespace: devops-tools grant more permissions via RoleBinding apiVersion: v1 kind: ServiceAccount metadata: name: jenkins namespace: devops --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1beta1 metadata: name: jenkins rules: - apiGroups: [\"extensions\", \"apps\"] resources: [\"deployments\"] verbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"] - apiGroups: [\"\"] resources: [\"services\"] verbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"] - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/exec\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/log\"] verbs: [\"get\",\"list\",\"watch\"] - apiGroups: [\"\"] resources: [\"secrets\"] verbs: [\"get\"] --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: jenkins namespace: devops roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: jenkins subjects: - kind: ServiceAccount name: jenkins namespace: devops generate credentials for pfx ca.crt $ grep certificate-authority-data ~/.kube/config | awkubectl -F': ' '{print $NF}' | base64 -d > ca.crt # OR $ sudo cat /etc/kubernetes/pki/ca.crt client.crt & client.key $ grep client-certificate-data ~/.kube/config | awkubectl -F': ' '{print $NF}' | base64 -d > client.crt $ grep client-key-data ~/.kube/config | awkubectl -F': ' '{print $NF}' | base64 -d > client.key cert.pfx $ openssl pkcs12 -export -out cert.pfx -inkey client.key -in client.crt -certfile ca.crt Enter Export Password: Verifying - Enter Export Password: $ ls ca.crt cert.pfx client.crt client.key # or # using password 'marslo' $ openssl pkcs12 -export -out cert.pfx -inkey client.key -in client.crt -certfile ca.crt -password pass:marslo full steps $ cat ~/.kube/config \\ | grep certificate-authority-data \\ | awkubectl '{print $2}' \\ | base64 -d > ca.crt $ cat ~/.kube/config \\ | grep client-certificate-data \\ | awkubectl '{print $2}' \\ | base64 -d > client.crt $ cat ~/.kube/config \\ | grep client-key-data \\ | awkubectl '{print $2}' \\ | base64 -d > client.key $ openssl pkcs12 -export \\ -out cert.pfx \\ -in client.crt \\ -inkey client.key \\ -certfile ca.crt \\ -password pass:devops configure in jenkins [!NOTE] url by default: http://..svc.cluster.local:8080 Manage Jenkins -> Configure System or Manage Jenkins -> Manage Nodes and Clouds -> Configure Clouds Add a new Cloud -> Kuberentes Name: Kubernetes URL: get from $ kubectl cluster-info using https://kubernetes.default.svc.cluster.local Kubernetes server certificate key: content of ca.crt. ($ cat ca.crt) Credentials: Add -> Jenkins Kind: Certificate setup in jenkins using kubeconfig for remote cluster credential reference: jenkinsci/kubernetes-cli-plugin Kubernetes Plugin: Authenticate with a ServiceAccount to a remote cluster Creating a kubeconfig file for a self-hosted Kubernetes cluster How to find your Jenkins admin password on Kubernetes get Kubernetes URL $ kubectl config view --minify | sed -n -re 's/^.*server: (https.*)$/\\1/p' or$ kubectl config view --minify --raw --output 'jsonpath={..cluster.server}' generate CA the content can be also found in kubernetes-master:/etc/kubernetes/pki/ca.crt $ kubectl -n jenkins get secret \\ $(kubectl -n jenkins get sa jenkins-admin -o jsonpath={.secrets[0].name}) \\ -o jsonpath={.data.'ca\\.crt'} \\ | base64 --decode or$ cat ~/.kube/config \\ | grep certificate-authority-data \\ | awkubectl '{print $2}' \\ | base64 -d > ca.crt Generate token in kubernetes $ namespace='devops' $ serviceAccount='jenkins-admin' $ alias k='kubectl' setup sa$ kubectl -n jenkins create sa jenkins-admin $ kubectl -n jenkins create rolebinding jenkins-admin-binding \\ --clusterrole=cluster-admin \\ --serviceaccount=devops:jenkins-admin get token $ kubectl -n jenkins \\ get sa jenkins-admin \\ -o go-template \\ --template='{{range .secrets}}{{.name}}{{\"\\n\"}}{{end}}' jenkins-admin-token-kshsh $ kubectl -n jenkins \\ get secrets jenkins-admin-token-kshsh \\ -o go-template \\ --template '{{index .data \"token\"}}' \\ | base64 -d eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.*** more info $ kubectl get secret -n jenkins NAME TYPE DATA AGE default-token-8k7vj kubernetes.io/service-account-token 3 27m jenkins-admin-token-9r8pt kubernetes.io/service-account-token 3 21m $ kubectl -n jenkins get rolebinding NAME AGE jenkins-admin-binding 15m $ kubectl -n jenkins describe rolebinding jenkins-admin-binding Name: jenkins-admin-binding Labels: Annotations: Role: Kind: ClusterRole Name: cluster-admin Subjects: Kind Name Namespace ---- ---- --------- ServiceAccount jenkins-admin jenkins $ kubectl describe clusterrolebindings jenkins-admin-cluster-binding Name: jenkins-admin-cluster-binding Labels: Annotations: Role: Kind: ClusterRole Name: cluster-admin Subjects: Kind Name Namespace ---- ---- --------- ServiceAccount jenkins-admin jenkins or $ kubectl -n jenkins \\ get secret \\ $(kubectl -n jenkins get sa jenkins-admin -o jsonpath={.secrets[0].name}) \\ -o jsonpath={.data.token} \\ | base64 --decode or $ kubectl -n jenkins \\ get sa jenkins-admin \\ --template='{{range .secrets}}{{ .name }} {{end}}' \\ | xargs -n 1 kubectl -n jenkins get secret \\ --template='{{ if .data.token }}{{ .data.token }}{{end}}' \\ | head -n 1 \\ | base64 -d - or# sa='jenkins-admin' $ kubectl -n jenkins \\ get secrets \\ $(kubectl -n jenkins get sa ${sa} -o=jsonpath='{.secrets[0].name}') \\ -o=jsonpath='{.data.token}' | base64 -d setup in Jenkins credential setup cloud setup using ClusterRoleBinding references: Configure Service Accounts for Pods RoleBinding and ClusterRoleBinding Role and ClusterRole Jenkins minimal installation on Kubernetes [!TIP] simplely it can be executed via commands: $ kubectl -n kube-system create sa $ kubectl create clusterrolebinding --clusterrole cluster-admin --serviceaccount=: [!NOTE]: can be the same as --- apiVersion: v1 kind: ServiceAccount metadata: labels: k8s-app: jenkins name: jenkins-admin namespace: jenkins --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: jenkins-admin labels: k8s-app: jenkins roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: jenkins-admin namespace: jenkins using RoleBinding --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: Role metadata: name: jenkins-admin namespace: jenkins rules: - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/exec\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/log\"] verbs: [\"get\",\"list\",\"watch\"] --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: RoleBinding metadata: name: jenkins-admin namespace: jenkins roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: jenkins-admin subjects: - kind: ServiceAccount name: jenkins-admin or grant more permissions via RoleBinding apiVersion: v1 kind: ServiceAccount metadata: name: jenkins namespace: devops --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1beta1 metadata: name: jenkins rules: - apiGroups: [\"extensions\", \"apps\"] resources: [\"deployments\"] verbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"] - apiGroups: [\"\"] resources: [\"services\"] verbs: [\"create\", \"delete\", \"get\", \"list\", \"watch\", \"patch\", \"update\"] - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/exec\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/log\"] verbs: [\"get\",\"list\",\"watch\"] - apiGroups: [\"\"] resources: [\"secrets\"] verbs: [\"get\"] --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: jenkins namespace: devops roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: jenkins subjects: - kind: ServiceAccount name: jenkins namespace: devops or get all permission via RoleBinding # spinnaker-role-and-rolebinding-target.yml --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: spinnaker-role namespace: target # Should be namespace you are granting access to rules: - apiGroups: [\"*\"] resources: [\"*\"] verbs: [\"*\"] --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: spinnaker-rolebinding namespace: target # Should be namespace you are granting access to roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: spinnaker-role # Should match name of Role subjects: - namespace: source # Should match namespace where SA lives kind: ServiceAccount name: spinnaker-service-account # Should match service account name, above or details rules in role binding apiVersion: v1 kind: ServiceAccount metadata: name: jenkins-admin namespace: devops-tools --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: jenkins namespace: devops-tools labels: \"app.kubernetes.io/name\": 'jenkins' rules: - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/exec\"] verbs: [\"create\",\"delete\",\"get\",\"list\",\"patch\",\"update\",\"watch\"] - apiGroups: [\"\"] resources: [\"pods/log\"] verbs: [\"get\",\"list\",\"watch\"] - apiGroups: [\"\"] resources: [\"secrets\"] verbs: [\"get\"] --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: jenkins-role-binding namespace: devops-tools roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: jenkins subjects: - kind: ServiceAccount name: jenkins-admin namespace: devops-tools pull with credentials [!NOTE|label:references:] Pull an Image from a Private Registry 从私有仓库拉取镜像 为特定名称空间创建 imagePullSecrets in kubernetes # create secrets in namespace ## via ~/.docker/config.json $ kubectl -n devfops create secret generic image-pull-secrets \\ --from-file=.dockerconfigjson=.docker/config.json \\ --type=kubernetes.io/dockerconfigjson ## via cmd $ kubectl -n devops create secret docker-registry image-pull-secrets \\ --docker-server=artifactory.example.com \\ --docker-username=devops \\ --docker-password=password \\ --docker-email=devops@example.com # check result $ kubectl -n devop get secret image-pull-secrets \\ -o jsonpath=\"{.data.\\.dockerconfigjson}\" | base64 -d copy secrets to all namespaces # copy $ kubectl get ns -o custom-columns=\":metadata.name\" --no-headers | xargs -t -i bash -c \"echo -e \\\"\\\\n-- {} --\\\"; kubectl -n devops get secrets image-pull-secrets -o yaml --export | kubectl apply -n {} -f -\" # check $ kubectl get secrets --all-namespaces | grep image-pull-secrets in podTemplate podTemplate( cloud: 'Staging Kubernetes', label: env.BUILD_TAG , name: env.BUILD_TAG, showRawYaml: true, namespace: 'devops', yaml: \"\"\" apiVersion: v1 kind: Pod spec: hostNetwork: true nodeSelector: kubernetes.io/hostname: \"staging-node-1\" imagePullSecrets: - name: \"image-pull-secrets\" # secrets name here containers: - name: jnlp image: 'artifactory.example.com/docker/sandbox:bionic' workingDir: '/home/devops' resources: limits: memory: \"1024Mi\" cpu: \"512m\" requests: memory: \"512Mi\" cpu: \"256m\" \"\"\" ) { node( env.BUILD_TAG ) { container('jnlp') { stage('show info') { sh \"\"\" id whoami echo ${WORKSPACE} realpath ${WORKSPACE} \"\"\" println POD_CONTAINER } }} } Q&A [!NOTE] Kubernetes agents are failing with SocketTimeoutException: connect timed out Message: pods is forbidden: User \"system:serviceaccount:jenkins:jenkins-admin\" cannot list resource \"pods\" in API group solution: lachie83/jenkins-service-account see also chukaofili/k8s-dashboard-admin-user.yaml $ kubectl -n create rolebinding -binding \\ --clusterrole=cluster-admin \\ --serviceaccount=: $ kubectl create clusterrolebinding jenkins-admin-cluster-binding \\ --clusterrole cluster-admin \\ --serviceaccount=:jenkins-admin thinking $ kubectl -n jenkins auth can-i list pods --as jenkins-admin no $ kubectl -n jenkins auth can-i list pods --as jenkins-admin-binding no $ kubectl -n jenkins auth can-i list pods --as jenkins-admin-cluster-binding no Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/docker.html":{"url":"jenkins/plugins/docker.html","title":"docker","keywords":"","body":" jenkinsfile docker registry artifactory references: * org.jenkinsci.plugins.docker.workflow.Docker Docker Pipeline plugin CloudBees Docker Traceability Docker plugin for Jenkins Building your first Docker image with Jenkins 2: Guide for developers jenkinsfile #!/usr/bin/env groovy import org.jenkinsci.plugins.docker.workflow.Docker Docker.Image image String filename = 'Dockerfile' String filepath = '.' String imageName = 'sandbox:v1' String buildArgs = ' --no-cache ' + \" -f ${filename}\" + \" ${filepath}/\" docker.withTool( 'devops-docker' ) { image = docker.build( imageName, buildArgs ) } // docker.withTool println image.imageName() println image.id docker registry artifactory How to clean up old Docker images def clean_docker(): import requests base_url = 'http://localhost:8081/artifactory/' headers = { 'content-type': 'text/plain', } data = 'items.find({\"name\":{\"$eq\":\"manifest.json\"},\"stat.downloaded\":{\"$before\":\"4w\"}})' myResp = requests.post(base_url+'api/search/aql', auth=('admin', 'password'), headers=headers, data=data) for result in eval(myResp.text)[\"results\"]: artifact_url = base_url+ result['repo'] + '/' + result['path'] requests.delete(artifact_url, auth=('admin', 'password')) How to Delete Old Docker Images [!TIP] Artifactory Clean Docker Images User Plugin Artifactory Artifact Cleanup User Plugin devopshq/artifactory-cleanup How can I completely remove artifacts from Artifactory? $ items.find({“name”:{“$eq”:”manifest.json”},”stat.downloaded”:{“$before”:”4w”}}) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/lockable-resource.html":{"url":"jenkins/plugins/lockable-resource.html","title":"lockable-resource","keywords":"","body":" get info get all Get resource by label if label validated Get free number of label Get all resource management remove by label (or name) create new item pickup qualified available resources randomly change label by certain condition reserve & unlock by cli by api examples functions isLabelExists isResourceExists get label by name set Label with Closure get resource status removeLabelByName reference: org.jenkins.plugins.lockableresources.LockableResource javadoc index-all configure-lockable-resources.groovy collect-resources-data-for-graphite.groovy LockableResourcesHelper.groovy lockable_resources_from_json.groovy list_lockable_resources.groovy JenkinsJobDslCleanupLockableResources.groovy JenkinsScriptedPipelineCleanupLockableResources.groovy jenkins-remove-lockable-resources.groovy get info get all all items information import org.jenkins.plugins.lockableresources.LockableResourcesManager LockableResourcesManager manager = new org.jenkins.plugins.lockableresources.LockableResourcesManager() // or LockableResourcesManager manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() manager.getResources().each{ r -> println \"\"\" ${r.name}: ${r.getClass()} locked? : ${r.locked} : ${r.isLocked()} reserved? : ${r.reserved} : ${r.isReserved()} label : ${r.labels} : ${r.getLabels()} description : ${r.description} : ${r.getDescription()} queue : ${r.queueItemProject ?: ''} reserved by : ${r.reservedBy ?: ''} build : ${r.build ?: ''} queuingStarted : ${r.queuingStarted ?: ''} queuedContexts : ${r.queuedContexts ?: ''} \"\"\" } labels import org.jenkins.plugins.lockableresources.LockableResourcesManager stage('all label') { println '~~> all labels:' println new LockableResourcesManager().getAllLabels() } resources import org.jenkins.plugins.lockableresources.LockableResourcesManager println new LockableResourcesManager().getResources() orprintln org.jenkins.plugins.lockableresources.LockableResourcesManager.get().getResources() Get resource by label import org.jenkins.plugins.lockableresources.LockableResourcesManager stage('get label') { String l = 'my-label' println \"~~> resources for ${l}:\" println new LockableResourcesManager().getResourcesWithLabel( l, null ) } orimport org.jenkins.plugins.lockableresources.LockableResourcesManager println new LockableResourcesManager().getResourcesWithLabel( l, [:] ) if label validated import org.jenkins.plugins.lockableresources.LockableResourcesManager stage('does label validated') { String l = 'my-label' println '~~> is ${l} valid:' println new LockableResourcesManager().isValidLabel(l) } Get free number of label import org.jenkins.plugins.lockableresources.LockableResourcesManager stage('number of free') { String l = 'my-label' println new LockableResourcesManager().getFreeResourceAmount(l) } Get all resource stage('get all resoruces') { def all_lockable_resources = GlobalConfiguration.all().get(org.jenkins.plugins.lockableresources.LockableResourcesManager.class).resources println \"~~> free resource for ${l}\" println all_lockable_resources // remove all_lockable_resources.removeAll { it.name.contains('somestr')} } management remove by label (or name) stage('remove') { def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() def resources = manager.getResources().findAll { // println it.locked ? \"${it} locked\" : \"${it.labels}\" ( !it.locked ) && ( it.name.equals('marslo') || it.labels.contains('marslo') || it.name.startsWith('marslo') ) } currentBuild.description = \"${resources.size()} locks\" resources.each { println \"Removing ${it.name} ~~> ${it.labels}\" manager.getResources().remove(it) } manager.save() } remove allString lockName = 'lock name' def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() manager.getResources().removeAll { r -> lockNames.contains(r.name) && !r.locked && !r.reserved } manager.save() create new item stage('create') { def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() def myr = manager.createResourceWithLabel('marslo', 'marslo-label') } or import org.jenkins.plugins.lockableresources.* stage('create') { LockableResourcesManager manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() String name = 'marslo' String label = 'marslo-label' manager.createResource( name ) manager.fromName(name).setLabels( label ) manager.fromName(name).setEphemeral( false ) manager.save() } pickup qualified available resources randomly [!TIP] reference: imarslo: a list contains a sublist or not setup test labels import org.jenkins.plugins.lockableresources.* LockableResourcesManager manager = org.jenkins .plugins .lockableresources .LockableResourcesManager .get() manager.createResourceWithLabel('marslo-test-1', 'windows,64bit,firefox') manager.createResourceWithLabel('marslo-test-2', 'CentOS,32bit,chrome') manager.createResourceWithLabel('marslo-test-3', 'RHEL,64bit,firefox') clean up environment import org.jenkins.plugins.lockableresources.* LockableResourcesManager manager = org.jenkins .plugins .lockableresources .LockableResourcesManager .get() (1..3).each { manager.resources.remove( manager.fromName(\"marslo-test-${it}\") ) } import org.jenkins.plugins.lockableresources.* LockableResourcesManager manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() List criteria = [ '64bit', 'firefox' ] List all = manager.resources.findAll { r -> !r.locked && !r.reserved && criteria.every{ c -> r.labels.split(',').collect{ it.toLowerCase() }.contains(c.toLowerCase()) } } Collections.shuffle(all) println (all?.first() ?: '') change label by certain condition Objective : add the keyword marslo_ as prefix of labels whose label isn't belongs to keyword list. prevent repeat to add : List keyword = [ 'project1', 'project2', 'keyword', 'marslo_' ] or r.setLabels( 'marslo_' + r.labels.split('marslo_').last() ) import org.jenkins.plugins.lockableresources.* LockableResourcesManager manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() List keyword = [ 'project1', 'project2', 'keyword' ] manager.getResources().findAll { r -> r.labels && ! keyword.any{ r.labels.toLowerCase().startsWith(it) } }.collect { r -> r.setLabels( 'marslo_' + r.labels.split('marslo_').last() ) } show resultprintln manager.resources.findAll { r -> r.labels && ! keyword.any{ r.labels.toLowerCase().startsWith(it) } } collect { [ (r.name), r.labels ] } reserve & unlock by cli $ resource='marslo' $ curl -XGET -uadmin:passwd https://my.jenkins.com/lockable-resources/reserve?resource=${resource} $ curl -XGET -uadmin:passwd https://my.jenkins.com/lockable-resources/unreserve?resource=${resource} by api stage('reserve & unlock') { def manager = org.jenkins.plugins.lockableresources.LockableResourcesManager.get() println manager.fromName('marslo')?.isReserved() println '~~> lock marslo:' manager.reserve([ manager.fromName('marslo') ], 'Marslo Jiao') println manager.fromName('marslo')?.isReserved() println '~~> unlock marslo:' manager.reset([ manager.fromName('marslo') ]) println manager.fromName('marslo')?.isReserved() } examples print \"START\\n\" def all_lockable_resources = org.jenkins.plugins.lockableresources.LockableResourcesManager.get().resources all_lockable_resources.each { r-> if ( r.isLocked() || r.isReserved() ) { println \"Lock \" + r + \" is locked or reserved by \" + r.getBuild() + \" BECARSE \" + r.getLockCause() b = r.getBuild() if ( b ) { if ( b.isBuilding() ) println ( \"build:\" + b + \" is building\" ) if ( b.getResult().equals(null) ) println ( \"build:\" + b + \" result is not in yet\" ) if ( ! b.isBuilding() && ! b.getResult().equals(null) ) { println \"build:\" + b + \" is not building and result is \" + b.getResult() + \" yet the lock \" + r + \" is locked.\" println \"ACTION RELEASE LOCK \" + r println \"getLockCause:\" + r.getLockCause() println \"getDescription:\" + r.getDescription() println \"getReservedBy:\" + r.getReservedBy() println \"isReserved:\" + r.isReserved() println \"isLocked:\" + r.isLocked() println \"isQueued:\" + r.isQueued() //release the lock r.reset() println \"getLockCause:\" + r.getLockCause() println \"getDescription:\" + r.getDescription() println \"getReservedBy:\" + r.getReservedBy() println \"isReserved:\" + r.isReserved() println \"isLocked:\" + r.isLocked() println \"isQueued:\" + r.isQueued() } } } } functions isLabelExists def isLabelExists( String label ) { org.jenkins.plugins .lockableresources .LockableResourcesManager .get() .getResources() .findAll{ it.labels == label } != [] } orwithManager{ manager -> manager .resources .findAll{ it.labels == label } != [] } isResourceExists def isResourceExists( String name ) { org.jenkins.plugins .lockableresources .LockableResourcesManager .get() .fromName(name) != null } ordef isResourceExists( String name ) { withManager{ manager -> manager.fromName(name) != null } } or using findAll for multiple finddef isResourceExists( String name ) { org.jenkins.plugins .lockableresources .LockableResourcesManager .get() .getResources() .findAll{ it.name == name } != [] } orwithManager{ manager -> manager.getResources() .findAll{ it.name == name } != [] } get label by name using fromName(String) def getLabelByName( String name ) { org.jenkins.plugins .lockableresources .LockableResourcesManager .get() .getResources() .fromName( name ) .getLabes() } ordef getLabelByName( String name ) { withManager{ manager -> manager.fromName( name )?.labels ?: '' } } using findAll multiple def getLabelByName( String name ) { org.jenkins.plugins .lockableresources .LockableResourcesManager .get() .getResources() .findAll{ it.name == name } .collect{ it.labels } .join(' ') } orwithManager{ manager -> manager.getResources() .findAll{ it.name == name } .collect{ it.labels } .join(' ') } set Label def setLabel( String name, String label, String trigger = '', Boolean force = false, String description = '' ) { LockableResourcesManager manager = LockableResourcesManager.get() description = ( description ? \"${description} | \" : '' ) + \"created automatically by @${trigger ?: 'jenkins'} via Jenkins job ${env.BUILD_URL}\" if ( isResourceExists(name) && !force ) { println( \"ERROR: resource ${name} has already tied to label: ${manager.fromName(name)?.labels}. Exit...\" ) } else { // manager.createResourceWithLabel( name, label ) // will ignore label re-add if resource exists if ( ! isResourceExists(name) ) manager.createResource( name ) manager.fromName(name).setLabels( label ) manager.fromName(name).setDescription( description ) manager.fromName(name).setEphemeral( false ) manager.save() if ( ! isResourceExists(name) ) println( \"ERROR: resource ${name} failed to be added in resource pool. Exit...\" ) } } with Closure import org.jenkins.plugins.lockableresources.LockableResourcesManager def withManager( Closure body ) { LockableResourcesManager manager = org.jenkins.plugins .lockableresources .LockableResourcesManager .get() body( manager ) } get resource status def getResourceLabelStatus( String name ) { Map status = [:] withManager { manager -> if ( isResourceExists(name) ) { LockableResource r = manager.fromName(name) status.'locked' = r.isLocked() status.'reserved' = r.isReserved() status.'lockedBy' = r.getBuild() ?: '' status.'reservedBy' = r.getReservedBy() ?: '' status.'lockedCause' = r.getLockCause() ?: '' } } return status } removeLabelByName /** * remove the label from resource pool if the label isn't reserved or locked * * @param name the agent name * @param force whether force remove the label or not * * @see org.jenkins.plugins.lockableresources.LockableResourcesManager * @see org.jenkins.plugins.lockableresources.LockableResource * @see {@link #withManager(Closure)} **/ def removeLabelByName( String name, Boolean force = false ) { withManager { manager -> if ( isResourceExists(name) ) { if ( force ) manager.fromName(name).reset() Map resource = getResourceLabelStatus( name ) if ( ! resource.getOrDefault('locked', true) && ! resource.getOrDefault('reserved', true) ) { if ( manager.resources.remove( manager.fromName(name) ) && !isResourceExists(name) ) { println ( \"INFO: resource ${name} has been successfully removed.\" ) } else { println ( \"WARN: resource ${name} failed to be removed. still tied to label: ${getLabelByName(name)}\" ) } } else { println ( \"WARN: resource ${name} ( label: ${getLabelByName(name)} ) cannot be removed due to \" + ( resource.locked ? \"locked by ${resource.lockedBy}\" : '' ) + ( resource.reserved ? \"reserved by ${resource.reservedBy}\" : '' ) } } else { println( \"WARN: resource ${name} doesn't exist in resrouce pool. Skip...\" ) println( \"Available resources are: ${manager.resources}\" ) } } // withManager } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/postbuild.html":{"url":"jenkins/plugins/postbuild.html","title":"postbuild","keywords":"","body":" setup badge setup badge from another plugins more on badges badge images icons and badges from url [!NOTE|label:references:] Groovy Postbuild Plugin badge-plugin setup badge setup badge from another plugins manager.addBadge( '/plugin/artifactory/images/artifactory-promote.png', 'promoted' ) how to find it more on badges [!NOTE] '/plugin/badge/images/completed.gif', '/plugin/badge/images/db_in.gif', '/plugin/badge/images/db_out.gif', '/plugin/badge/images/delete.gif', '/plugin/badge/images/error.gif', '/plugin/badge/images/folder.gif', '/plugin/badge/images/green.gif', '/plugin/badge/images/info.gif', '/plugin/badge/images/red.gif', '/plugin/badge/images/save.gif', '/plugin/badge/images/success.gif', '/plugin/badge/images/text.gif', '/plugin/badge/images/warning.gif', '/plugin/badge/images/yellow.gif' // same as 'completed.gif', 'db_in.gif', 'db_out.gif', 'delete.gif', 'error.gif', 'folder.gif', 'green.gif', 'info.gif', 'red.gif', 'save.gif', 'success.gif', 'text.gif', 'warning.gif', 'yellow.gif' showBadges( '/images/none.gif', '/images/progress-unknown-red.gif', '/images/progress-unknown.gif', '/images/spinner.gif', 'aborted.gif', 'aborted_anime.gif', 'blue.gif', 'blue_anime.gif', 'clock_anime.gif', 'dark-grey.gif', 'dark-grey_anime.gif', 'disabled.gif', 'disabled_anime.gif', 'document_add.gif', 'document_delete.gif', 'document_edit.gif', 'edit-select-all.gif', 'empty.gif', 'folder-open.gif', 'go-next.gif', 'green.gif', 'green_anime.gif', 'health-00to19.gif', 'health-20to39.gif', 'health-40to59.gif', 'health-60to79.gif', 'health-80plus.gif', 'health-80plus.gif', 'light-grey.gif', 'light-grey_anime.gif', 'nobuilt.gif', 'nobuilt_anime.gif', 'red.gif', 'red_anime.gif', 'yellow.gif', 'yellow_anime.gif' ) showBadges( '/images/material-icons/computer-24px.svg', '/images/material-icons/edit.svg', '/images/material-icons/feed.svg', '/images/material-icons/rss_feed-24px.svg', '/images/material-icons/svg-sprite-action-symbol.svg', '/images/material-icons/svg-sprite-content-symbol.svg', '/images/material-icons/svg-sprite-navigation-symbol.svg', '/images/material-icons/svg-sprite-social-symbol.svg', '/images/material-icons/view_headline-24px.svg', '/images/rage.svg', '/images/svgs/accept.svg', '/images/svgs/application-certificate.svg', '/images/svgs/attribute.svg', '/images/svgs/bookmark-new.svg', '/images/svgs/certificate.svg', '/images/svgs/clipboard-list-solid.svg', '/images/svgs/clipboard.svg', '/images/svgs/clock.svg', '/images/svgs/computer-user-offline.svg', '/images/svgs/computer-x.svg', '/images/svgs/computer.svg', '/images/svgs/delete-document.svg', '/images/svgs/document-properties.svg', '/images/svgs/document.svg', '/images/svgs/edit-delete.svg', '/images/svgs/emblem-urgent.svg', '/images/svgs/error.svg', '/images/svgs/fingerprint.svg', '/images/svgs/folder-delete.svg', '/images/svgs/folder.svg', '/images/svgs/gear.svg', '/images/svgs/gear2.svg', '/images/svgs/go-down.svg', '/images/svgs/go-up.svg', '/images/svgs/graph.svg', '/images/svgs/headshot.svg', '/images/svgs/help.svg', '/images/svgs/hourglass.svg', '/images/svgs/installer.svg', '/images/svgs/keys.svg', '/images/svgs/lock.svg', '/images/svgs/logo.svg', '/images/svgs/monitor.svg', '/images/svgs/network.svg', '/images/svgs/new-computer.svg', '/images/svgs/new-document.svg', '/images/svgs/new-package.svg', '/images/svgs/new-user.svg', '/images/svgs/next.svg', '/images/svgs/notepad.svg', '/images/svgs/orange-square.svg', '/images/svgs/package.svg', '/images/svgs/person.svg', '/images/svgs/plugin.svg', '/images/svgs/previous.svg', '/images/svgs/redo.svg', '/images/svgs/refresh.svg', '/images/svgs/save-new.svg', '/images/svgs/save.svg', '/images/svgs/search.svg', '/images/svgs/secure.svg', '/images/svgs/setting.svg', '/images/svgs/shield.svg', '/images/svgs/star-gold.svg', '/images/svgs/star-large-gold.svg', '/images/svgs/star-large.svg', '/images/svgs/star.svg', '/images/svgs/stop.svg', '/images/svgs/system-log-out.svg', '/images/svgs/terminal.svg', '/images/svgs/undo.svg', '/images/svgs/up.svg', '/images/svgs/user.svg', '/images/svgs/video.svg', '/images/svgs/warning.svg', '/images/title.svg' ) showBadges( '/images/48x48/copy.png', '/images/48x48/freestyleproject.png', '/images/headless.png', '/images/top-sticker-bottom-edge.png', 'aborted.png', 'blue.png', 'collapse.png', 'dark-grey.png', 'disabled.png', 'document_add.png', 'document_delete.png', 'document_edit.png', 'edit-select-all.png', 'empty.png', 'expand.png', 'folder-open.png', 'go-next.png', 'health-00to19.png', 'health-20to39.png', 'health-40to59.png', 'health-60to79.png', 'health-80plus.png', 'light-grey.png', 'nobuilt.png', 'red.png', 'yellow.png' ) showBadges( '/scripts/yui/container/assets/tip16_1.gif', '/scripts/yui/container/assets/hlp16_1.gif', '/scripts/yui/container/assets/warn16_1.gif', '/scripts/yui/container/assets/blck16_1.gif', '/scripts/yui/container/assets/close12_1.gif', '/scripts/yui/container/assets/info16_1.gif', '/scripts/yui/container/assets/alrt16_1.gif' ) showBadges( '/images/none.gif', '/images/progress-unknown-red.gif' ) showBadges( '/scripts/yui/assets/skins/sam/check2.gif', '/scripts/yui/assets/skins/sam/ajax-loader.gif', '/scripts/yui/assets/skins/sam/asc.gif', '/scripts/yui/assets/skins/sam/bg-h.gif', '/scripts/yui/assets/skins/sam/bg-v.gif', '/scripts/yui/assets/skins/sam/check0.gif', '/scripts/yui/assets/skins/sam/check1.gif', '/scripts/yui/assets/skins/sam/desc.gif', '/scripts/yui/assets/skins/sam/editor-knob.gif', '/scripts/yui/assets/skins/sam/editor-sprite-active.gif', '/scripts/yui/assets/skins/sam/editor-sprite.gif', '/scripts/yui/assets/skins/sam/loading.gif', '/scripts/yui/assets/skins/sam/treeview-loading.gif', '/scripts/yui/assets/skins/sam/treeview-sprite.gif', '/scripts/yui/assets/skins/sam/wait.gif', '/scripts/yui/editor/assets/skins/sam/editor-knob.gif', '/scripts/yui/editor/assets/skins/sam/editor-sprite-active.gif', '/scripts/yui/editor/assets/skins/sam/editor-sprite.gif', '/scripts/yui/tabview/assets/loading.gif', '/scripts/yui/treeview/assets/skins/sam/check0.gif', '/scripts/yui/treeview/assets/skins/sam/check1.gif', '/scripts/yui/treeview/assets/skins/sam/check2.gif', '/scripts/yui/treeview/assets/skins/sam/loading.gif', '/scripts/yui/treeview/assets/skins/sam/treeview-loading.gif', '/scripts/yui/treeview/assets/skins/sam/treeview-sprite.gif' ) showBadges( '/plugin/greenballs/16x16/green.gif', '/plugin/greenballs/16x16/green_anime.gif', '/plugin/greenballs/24x24/green.gif', '/plugin/greenballs/24x24/green_anime.gif', '/plugin/greenballs/32x32/green.gif', '/plugin/greenballs/32x32/green_anime.gif', '/plugin/greenballs/48x48/green.gif', '/plugin/greenballs/48x48/green_anime.gif', '/plugin/greenballs/colorblind/16x16/green.gif', '/plugin/greenballs/colorblind/16x16/green_anime.gif', '/plugin/greenballs/colorblind/16x16/red.gif', '/plugin/greenballs/colorblind/16x16/red_anime.gif', '/plugin/greenballs/colorblind/16x16/yellow.gif', '/plugin/greenballs/colorblind/16x16/yellow_anime.gif', '/plugin/greenballs/colorblind/24x24/green.gif', '/plugin/greenballs/colorblind/24x24/green_anime.gif', '/plugin/greenballs/colorblind/24x24/red.gif', '/plugin/greenballs/colorblind/24x24/red_anime.gif', '/plugin/greenballs/colorblind/24x24/yellow.gif', '/plugin/greenballs/colorblind/24x24/yellow_anime.gif', '/plugin/greenballs/colorblind/32x32/green.gif', '/plugin/greenballs/colorblind/32x32/green_anime.gif', '/plugin/greenballs/colorblind/32x32/red.gif', '/plugin/greenballs/colorblind/32x32/red_anime.gif', '/plugin/greenballs/colorblind/32x32/yellow.gif', '/plugin/greenballs/colorblind/32x32/yellow_anime.gif', '/plugin/greenballs/colorblind/48x48/green.gif', '/plugin/greenballs/colorblind/48x48/green_anime.gif', '/plugin/greenballs/colorblind/48x48/red.gif', '/plugin/greenballs/colorblind/48x48/red_anime.gif', '/plugin/greenballs/colorblind/48x48/yellow.gif', '/plugin/greenballs/colorblind/48x48/yellow_anime.gif' ) showBadges( '/plugin/badge/images/completed.gif', '/plugin/badge/images/db_in.gif', '/plugin/badge/images/db_out.gif', '/plugin/badge/images/delete.gif', '/plugin/badge/images/error.gif', '/plugin/badge/images/folder.gif', '/plugin/badge/images/green.gif', '/plugin/badge/images/info.gif', '/plugin/badge/images/red.gif', '/plugin/badge/images/save.gif', '/plugin/badge/images/success.gif', '/plugin/badge/images/text.gif', '/plugin/badge/images/warning.gif', '/plugin/badge/images/yellow.gif' ) showBadges( '/plugin/klocwork/images/logo.png', '/plugin/klocwork/images/menu_down_arrow.png', '/plugin/klocwork/images/menu_right_arrow.png', '/plugin/klocwork/images/menu_right_arrow_hover.png', '/plugin/klocwork/images/openInIde.png', '/plugin/docker-commons/images/32x32/docker.png', '/plugin/docker-commons/images/24x24/docker.png', '/plugin/docker-commons/images/48x48/docker.png', '/plugin/docker-commons/images/16x16/docker.png', '/plugin/docker-commons/images/24x24/docker.png', '/plugin/docker-commons/images/32x32/docker.png', '/plugin/docker-commons/images/48x48/docker.png', '/plugin/docker-commons/images/16x16/docker.png', '/plugin/kubernetes/images/32x32/kubernetes.png', '/plugin/kubernetes/images/48x48/kubernetes.png', '/plugin/kubernetes/images/24x24/kubernetes.png', '/plugin/kubernetes-credentials-provider/images/48x48/kubernetes-store.png', '/plugin/kubernetes-credentials-provider/images/24x24/kubernetes-store.png', '/plugin/kubernetes-credentials-provider/images/16x16/kubernetes-store.png', '/plugin/kubernetes-credentials-provider/images/32x32/kubernetes-store.png' ) showBadges( '/plugin/code-coverage-api/images/tab.png', '/plugin/configuration-as-code/img/logo.png' ) showBadges( '/plugin/gerrit-code-review/icons/gerrit-logo-16x16.png', '/plugin/gerrit-code-review/icons/gerrit-logo-24x24.png', '/plugin/gerrit-code-review/icons/gerrit-logo-32x32.png', '/plugin/gerrit-code-review/icons/gerrit-logo-48x48.png', '/plugin/gerrit-trigger/images/24x24/gear-error.png', '/plugin/gerrit-trigger/images/24x24/gear-warning.png', '/plugin/gerrit-trigger/images/icon.png', '/plugin/gerrit-trigger/images/icon16.png', '/plugin/gerrit-trigger/images/icon24.png', '/plugin/gerrit-trigger/images/icon_retrigger24.png', '/plugin/gerrit-trigger/js/yui/datatable/assets/skins/sam/dt-arrow-dn.png', '/plugin/gerrit-trigger/js/yui/datatable/assets/skins/sam/dt-arrow-up.png' ) showBadges( '/plugin/rebuild/images/clock-48x48.png' ) showBadges( '/plugin/warnings-ng/icons/android-lint-24x24.png', '/plugin/warnings-ng/icons/android-lint-48x48.png', '/plugin/warnings-ng/icons/axivion-24x24.png', '/plugin/warnings-ng/icons/axivion-48x48.png', '/plugin/warnings-ng/icons/brakeman-24x24.png', '/plugin/warnings-ng/icons/brakeman-48x48.png', '/plugin/warnings-ng/icons/findbugs-24x24.png', '/plugin/warnings-ng/icons/findbugs-48x48.png', '/plugin/warnings-ng/icons/golint-24x24.png', '/plugin/warnings-ng/icons/golint-48x48.png', '/plugin/warnings-ng/icons/hadolint-24x24.png', '/plugin/warnings-ng/icons/hadolint-48x48.png', '/plugin/warnings-ng/icons/idea-24x24.png', '/plugin/warnings-ng/icons/idea-48x48.png', '/plugin/warnings-ng/icons/junit-24x24.png', '/plugin/warnings-ng/icons/junit-48x48.png', '/plugin/warnings-ng/icons/kotlin-24x24.png', '/plugin/warnings-ng/icons/kotlin-48x48.png', '/plugin/warnings-ng/icons/ktlint-24x24.png', '/plugin/warnings-ng/icons/ktlint-48x48.png', '/plugin/warnings-ng/icons/ot-docker-linter-24x24.png', '/plugin/warnings-ng/icons/ot-docker-linter-48x48.png', '/plugin/warnings-ng/icons/phpstan-24x24.png', '/plugin/warnings-ng/icons/phpstan-48x48.png', '/plugin/warnings-ng/icons/pit-24x24.png', '/plugin/warnings-ng/icons/pit-48x48.png', '/plugin/warnings-ng/icons/pmd-24x24.png', '/plugin/warnings-ng/icons/pmd-48x48.png', '/plugin/warnings-ng/icons/pvs-24x24.png', '/plugin/warnings-ng/icons/pvs-48x48.png', '/plugin/warnings-ng/icons/pylint-24x24.png', '/plugin/warnings-ng/icons/pylint-48x48.png', '/plugin/warnings-ng/icons/qt-24x24.png', '/plugin/warnings-ng/icons/qt-48x48.png', '/plugin/warnings-ng/icons/resharper-24x24.png', '/plugin/warnings-ng/icons/resharper-48x48.png', '/plugin/warnings-ng/icons/robot-framework-24x24.png', '/plugin/warnings-ng/icons/robot-framework-48x48.png', '/plugin/warnings-ng/icons/rubocop-24x24.png', '/plugin/warnings-ng/icons/rubocop-48x48.png', '/plugin/warnings-ng/icons/scala-24x24.png', '/plugin/warnings-ng/icons/scala-48x48.png', '/plugin/warnings-ng/icons/sonar-24x24.png', '/plugin/warnings-ng/icons/sonar-48x48.png', '/plugin/warnings-ng/icons/trivy-24x24.png', '/plugin/warnings-ng/icons/trivy-48x48.png', '/plugin/warnings-ng/icons/veracode-24x24.png', '/plugin/warnings-ng/icons/veracode-48x48.png' ) showBadges( '/plugin/pipeline-timeline/favicon.png', '/plugin/pipeline-timeline/jenkins_assets/logo_sidepanel.png', '/plugin/scm-api/test-avatar.png', '/plugin/shelve-project-plugin/icons/shelve-project-icon.png' ) showBadges( '/plugin/pipeline-model-definition/images/24x24/restart-stage.png', '/plugin/pipeline-model-definition/images/48x48/restart-stage.png', '/plugin/pipeline-multibranch-defaults/images/48x48/pipelinemultibranchdefaultsproject.png' ) showBadges( '/plugin/cloudbees-folder/images/16x16/folder-disabled.png', '/plugin/cloudbees-folder/images/16x16/folder.png', '/plugin/cloudbees-folder/images/16x16/move.png', '/plugin/cloudbees-folder/images/24x24/folder-disabled.png', '/plugin/cloudbees-folder/images/24x24/folder.png', '/plugin/cloudbees-folder/images/24x24/move.png', '/plugin/cloudbees-folder/images/32x32/folder-disabled.png', '/plugin/cloudbees-folder/images/32x32/folder.png', '/plugin/cloudbees-folder/images/32x32/move.png', '/plugin/cloudbees-folder/images/48x48/folder-disabled.png', '/plugin/cloudbees-folder/images/48x48/folder.png', '/plugin/cloudbees-folder/images/48x48/move.png' ) showBadges( '/plugin/gerrit-trigger/images/x.gif', '/plugin/gerrit-trigger/images/expanded.gif', '/plugin/gerrit-trigger/images/collapsed.gif', '/plugin/gerrit-trigger/images/v.gif' ) showBadges( '/plugin/klocwork/icons/klocwork-16.gif', '/plugin/klocwork/icons/klocwork-24.gif', '/plugin/klocwork/icons/klocwork-48.gif' ) showBadges( '/plugin/credentials/images/credentials.svg', '/plugin/credentials/images/new-credential.svg', '/plugin/credentials/images/userpass.svg', '/plugin/credentials/images/new-domain.svg', '/plugin/credentials/images/domain.svg', '/plugin/credentials/images/system-store.svg', '/plugin/credentials/images/move.svg', '/plugin/credentials/images/credential.svg', '/plugin/credentials/images/user-store.svg' ) showBadges( '/plugin/jobConfigHistory/img/confighistory.svg', '/plugin/jobConfigHistory/img/restore.svg', '/plugin/jobConfigHistory/img/buildbadge.svg', '/plugin/jobConfigHistory/img/info.svg', '/plugin/jobConfigHistory/img/filter.svg' ) showBadges( '/plugin/role-strategy/images/pencil.svg', '/plugin/workflow-job/images/pipelinejob.svg', '/plugin/workflow-multibranch/images/pipelinemultibranchproject.svg', '/plugin/git/icons/git-icon.svg', '/plugin/git/icons/git-logo.svg' ) showBadges( '/plugin/promoted-builds/icons/star-red-e.svg', '/plugin/promoted-builds/icons/star-green.svg', '/plugin/promoted-builds/icons/star-silver-e.svg', '/plugin/promoted-builds/icons/star-gold.svg', '/plugin/promoted-builds/icons/star-blue-w.svg', '/plugin/promoted-builds/icons/star-orange-w.svg', '/plugin/promoted-builds/icons/star-purple.svg', '/plugin/promoted-builds/icons/star-green-w.svg', '/plugin/promoted-builds/icons/star-red-w.svg', '/plugin/promoted-builds/icons/star-silver-w.svg', '/plugin/promoted-builds/icons/star-purple-e.svg', '/plugin/promoted-builds/icons/star-purple-w.svg', '/plugin/promoted-builds/icons/star-green-e.svg', '/plugin/promoted-builds/icons/star-orange.svg', '/plugin/promoted-builds/icons/star-gold-e.svg', '/plugin/promoted-builds/icons/star-gold-w.svg', '/plugin/promoted-builds/icons/star-blue-e.svg', '/plugin/promoted-builds/icons/star-blue.svg', '/plugin/promoted-builds/icons/star-silver.svg', '/plugin/promoted-builds/icons/star-red.svg', '/plugin/promoted-builds/icons/star-orange-e.svg' ) showBadges( '/plugin/warnings-ng/icons/java.svg', '/plugin/warnings-ng/icons/spotbugs.svg', '/plugin/warnings-ng/icons/eslint.svg', '/plugin/warnings-ng/icons/stylelint.svg', '/plugin/warnings-ng/icons/checkstyle.svg' ) showBadges( '/plugin/job-dsl/images/directory.svg', '/plugin/javadoc/icons/javadoc.svg', '/plugin/configuration-as-code/img/logo-head.svg', '/plugin/matrix-auth/images/select-all.svg', '/plugin/matrix-auth/images/unselect-all.svg', '/plugin/matrix-project/images/matrixproject.svg', '/plugin/maven-plugin/images/mavenmoduleset.svg' ) showBadges( '/plugin/pipeline-stage-view/fonts/glyphicons-halflings-regular.svg', '/plugin/gradle/images/svgs/gradle-build-scan.svg', '/plugin/github-branch-source/images/svgs/github-logo.svg', '/plugin/github-branch-source/images/svgs/github-scmnavigator.svg', '/plugin/github-branch-source/images/svgs/sprite-github.svg' ) showBadges( '/plugin/cloudbees-folder/images/svgs/folder-disabled.svg', '/plugin/cloudbees-folder/images/svgs/move.svg', '/plugin/cloudbees-folder/images/svgs/folder.svg', '/plugin/cloudbees-folder/images/svgs/folder-store.svg' ) showBadges( '/plugin/branch-api/images/organization-folder.svg' ) showBadges( '/plugin/cloudbees-bitbucket-branch-source/images/bitbucket-scmnavigator.svg', '/plugin/cloudbees-bitbucket-branch-source/images/bitbucket-repository-git.svg', '/plugin/cloudbees-bitbucket-branch-source/images/bitbucket-repository.svg', '/plugin/cloudbees-bitbucket-branch-source/images/bitbucket-logo.svg', '/plugin/cloudbees-bitbucket-branch-source/images/bitbucket-branch.svg' ) showBadges( '/plugin/pipeline-stage-view/jsmodules/glyphicons-halflings-regular.e72c5eba.svg','/plugin/email-ext/images/template-debugger.svg', '/plugin/email-ext/images/add-watch.svg', '/plugin/extended-choice-parameter/fonts/glyphicons-halflings-regular.svg', '/plugin/extended-choice-parameter/fonts/foundation-icons.svg', '/plugin/greenballs/green.svg', '/plugin/job-dsl/api-viewer/glyphicons-halflings-regular.060b2710bdbbe3dfe48b.svg' ) def showBadges( String... badges ) { // (0..30).each { manager.addBadge( 'empty.png', 'empty.png' ) } badges.each { manager.addBadge( it, it ) } } badge images to generate the images String png = 'aborted accept attribute blue clipboard computer-x computer copy dark-grey disabled document empty error fingerprint folder-delete folder freestyleproject gear2 graph grey health-00to19 health-20to39 health-40to59 health-60to79 health-80plus help installer light-grey lock monitor network nobuilt notepad orange-square package plugin red redo refresh search secure setting star-gold star system-log-out terminal user warning yellow' png.split().each { manager.createSummary(\"${it}.png\").appendText(\"${it}.png\") } dark theme jenkins material theme icons and badges from url [!NOTE] icon-icons pngwing svg repo Carbon Design Line Icons Collection Doodle Icons Collection Universal 05 Collection Universal 08 Collection Universal 12 Collection Pixelated Interface Icons Collection Essential Basic Icons Collection Statistics Icons Collection Virtual Pet 8bit Vectors Collection Kids Interface Collection image editor String url = 'https://artifactory.domain.com/artifactory/tools/jenkins/icon/' manager.createSummary( \"${url}/jira.png\" ).appendText ( 'jira' ) manager.createSummary( \"${url}/confluence.png\" ).appendText ( 'confluence' ) manager.createSummary( \"${url}/git-1.png\" ).appendText ( 'git-1' ) manager.createSummary( \"${url}/git-2.png\" ).appendText ( 'git-2' ) manager.createSummary( \"${url}/git-3.png\" ).appendText ( 'git-3' ) manager.createSummary( \"${url}/pipe.png\" ).appendText ( 'pipeline' ) manager.addBadge( \"${url}/jira.png\", 'jira' ) manager.addBadge( \"${url}/confluence.png\", 'confluence' ) manager.addBadge( \"${url}/git-1.png\", 'git-1' ) manager.addBadge( \"${url}/git-2.png\", 'git-2' ) manager.addBadge( \"${url}/git-3.png\", 'git-3' ) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/artifactory.html":{"url":"jenkins/plugins/artifactory.html","title":"artifactory","keywords":"","body":" allow interactive promotion promotion allow interactive promotion /** * add interactive promotion options * * @param sourceRepo the copy-from repo name * @param targetRepo the copy-to repo name * @param server Artifactory.server 'server-id' * @param buildInfo the buildInfo of {@code server} **/ def addInteractivePromotion( String sourceRepo, String targetRepo, def server, def buildInfo ) { def promotionSpec = [ //Mandatory parameters 'buildName' : buildInfo.name, 'buildNumber' : buildInfo.number, 'targetRepo' : targetRepo, //Optional parameters 'sourceRepo' : sourceRepo, 'comment' : 'promotion with interactive mode', 'status' : 'Released', 'includeDependencies': true, 'failFast' : true, 'copy' : true ] Artifactory.addInteractivePromotion server: server, promotionConfig: promotionSpec, displayName: 'promote me' } example def publish( String promoteRepo ) { server = Artifactory.server SERVER_ID uploadSpec = readFile 'jenkins-examples/pipeline-examples/resources/props-upload.json' buildInfo = server.upload spec: uploadSpec server.publishBuildInfo buildInfo if( promoteRepo ) addInteractivePromotion( \"${promoteRepo}-local\", promoteRepo, server, buildInfo ) } or for downloaddef download( String promoteRepo ) { server = Artifactory.server SERVER_ID downloadSpec = readFile 'jenkins-examples/pipeline-examples/resources/props-download.json' server.download spec: downloadSpec, buildInfo: buildInfo server.publishBuildInfo buildInfo if( promoteRepo ) addInteractivePromotion( \"${promoteRepo}-local\", promoteRepo, server, buildInfo ) } promotion Delete jenkins builds during Promote / promotion step /*** BEGIN META { \"name\" : \"Bulk Delete Builds except the given build number\", \"comment\" : \"For a given job and a given build numnber, delete all builds of a given release version (M.m.interim) only and except the user provided one. Sometimes a Jenkins job use Build Name setter plugin and same job generates 2.75.0.1 and 2.76.0.43\", \"parameters\" : [ 'jobName', 'releaseVersion', 'buildNumber' ], \"core\": \"1.409\", \"authors\" : [ { name : \"Arun Sangal - Maddys Version\" } ] } END META **/ import groovy.json.* import jenkins.model.*; import hudson.model.Fingerprint.RangeSet; import hudson.model.Job; import hudson.model.Fingerprint; //these should be passed in as arguments to the script if(!artifactoryURL) throw new Exception(\"artifactoryURL not provided\") if(!artifactoryUser) throw new Exception(\"artifactoryUser not provided\") if(!artifactoryPassword) throw new Exception(\"artifactoryPassword not provided\") def authString = \"${artifactoryUser}:${artifactoryPassword}\".getBytes().encodeBase64().toString() def artifactorySettings = [artifactoryURL: artifactoryURL, authString: authString] if(!jobName) throw new Exception(\"jobName not provided\") if(!buildNumber) throw new Exception(\"buildNumber not provided\") def lastBuildNumber = buildNumber.toInteger() - 1; def nextBuildNumber = buildNumber.toInteger() + 1; def jij = jenkins.model.Jenkins.instance.getItem(jobName); def promotedBuildRange = new Fingerprint.RangeSet() promotedBuildRange.add(buildNumber.toInteger()) def promoteBuildsList = jij.getBuilds(promotedBuildRange) assert promoteBuildsList.size() == 1 def promotedBuild = promoteBuildsList[0] // The release / version of a Jenkins job - i.e. in case you use \"Build name\" setter plugin in Jenkins for getting builds like 2.75.0.1, 2.75.0.2, .. , 2.75.0.15 etc. // and over the time, change the release/version value (2.75.0) to a newer value i.e. 2.75.1 or 2.76.0 and start builds of this new release/version from #1 onwards. def releaseVersion = promotedBuild.getDisplayName().split(\"\\\\.\")[0..2].join(\".\") println \"\" println(\"- Jenkins Job_Name: ${jobName} -- Version: ${releaseVersion} -- Keep Build Number: ${buildNumber}\"); println \"\" /** delete the indicated build and its artifacts from artifactory */ def deleteBuildFromArtifactory(String jobName, int deleteBuildNumber, Map artifactorySettings){ println \" ## Deleting >>>>>>>>>: - ${jobName}:${deleteBuildNumber} from artifactory\" def artifactSearchUri = \"api/build/${jobName}?buildNumbers=${deleteBuildNumber}&artifacts=1\" def conn = \"${artifactorySettings['artifactoryURL']}/${artifactSearchUri}\".toURL().openConnection() conn.setRequestProperty(\"Authorization\", \"Basic \" + artifactorySettings['authString']); conn.setRequestMethod(\"DELETE\") if( conn.responseCode != 200 ) { println \"Failed to delete the build artifacts from artifactory for ${jobName}/${deleteBuildNumber}: ${conn.responseCode} - ${conn.responseMessage}\" } } /** delete all builds in the indicated range that match the releaseVersion */ def deleteBuildsInRange(String buildRange, String releaseVersion, Job theJob, Map artifactorySettings){ def range = RangeSet.fromString(buildRange, true); theJob.getBuilds(range).each { if ( it.getDisplayName().find(/${releaseVersion}.*/)) { println \" ## Deleting >>>>>>>>>: \" + it.getDisplayName(); deleteBuildFromArtifactory(theJob.name, it.number, artifactorySettings) it.delete(); } } } //delete all the matching builds before the promoted build number deleteBuildsInRange(\"1-${lastBuildNumber}\", releaseVersion, jij, artifactorySettings) //delete all the matching builds after the promoted build number deleteBuildsInRange(\"${nextBuildNumber}-${jij.nextBuildNumber}\", releaseVersion, jij, artifactorySettings) println \"\" println(\"- Builds have been successfully deleted for the above mentioned release: ${releaseVersion}\") println \"\" Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/jira-steps.html":{"url":"jenkins/plugins/jira-steps.html","title":"jira-steps","keywords":"","body":" get field get issue get field import static groovy.json.JsonOutput.* def fields = jiraGetFields idOrKey: 'MYJIRA-1', site: 'jira' println prettyPrint( toJson( fields.data )) get issue def issue = jiraGetIssue idOrKey: 'MYJIRA-1', site: 'jira' println issue.data Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/ansicolor.html":{"url":"jenkins/plugins/ansicolor.html","title":"ansicolor","keywords":"","body":" println 256 colors color matrix libs customized colors xterm println 256 colors ansiColor('xterm') { node('controller') { List matrix = [] List line = [] [38, 48].collect { fgbg -> (1..255).collect { color -> \"\"\"\\033[${fgbg};5;${color}m ${String.format(\"%03d\", color)} \\033[0m\"\"\" } }.flatten().eachWithIndex{ c, idx -> line += [c] if ( 4 == (idx+1)%12 ) { matrix.add( line ) line = [] } } println matrix.collect{ it.join(' ') }.join('\\n') }} or ansiColor('xterm') { node('controller') { List matrix = [] List line = [] (0..7).collect{ attr -> [38, 48].collect { fgbg -> (0..255).collect { color -> \"\\033[${attr};${fgbg};5;${color}m\" + \"\"\" \\\\033[${attr};${fgbg};${String.format(\"%03d\", color)}m \"\"\" + \"\\033[0m\" } } }.flatten().eachWithIndex{ c, idx -> line += [c] if ( 4 == (idx+1)%6 ) { matrix.add( line ) line = [] } } println matrix.collect{ it.join(' ') }.join('\\n') }} color matrix libs import groovy.transform.Field /** * regular color * bold bold color * br high intensity (bright color) * it italic * on as background **/ @Field final Map COLOR_MATRIX = [ black : '\\033[0;38;5;0m' , red : '\\033[0;38;5;1m' , green : '\\033[0;38;5;2m' , darkGreen : '\\033[0;38;5;022m' , yellow : '\\033[0;38;5;3m' , blue : '\\033[0;38;5;4m' , magenta : '\\033[0;38;5;5m' , cyan : '\\033[0;38;5;6m' , white : '\\033[0;38;5;7m' , gray : '\\033[0;38;5;8m' , lightGray : '\\033[0;38;5;244m' , orange : '\\033[0;38;5;208m' , orchid : '\\033[0;38;5;207m' , gold : '\\033[0;38;5;178m' , greenYellow : '\\033[0;38;5;154m' , appleGreen : '\\033[0;38;5;190m' , brRed : '\\033[0;38;5;9m' , boldGreen : '\\033[1;38;5;10m' , boldDarkGreen : '\\033[1;38;5;022m' , brGreen : '\\033[0;38;5;10m' , brYellow : '\\033[0;38;5;11m' , brBlue : '\\033[0;38;5;12m' , brMagenta : '\\033[0;38;5;13m' , brCyan : '\\033[0;38;5;14m' , brWhite : '\\033[0;38;5;15m' , onBlack : '\\033[0;48;5;0m' , onRed : '\\033[0;48;5;1m' , onGreen : '\\033[0;48;5;2m' , onDarkGreen : '\\033[0;48;5;022m' , onYellow : '\\033[0;48;5;3m' , onBlue : '\\033[0;48;5;4m' , onMagenta : '\\033[0;48;5;5m' , onCyan : '\\033[0;48;5;6m' , onWhite : '\\033[0;48;5;7m' , onGray : '\\033[0;48;5;8m' , onLightGray : '\\033[0;48;5;244m' , onOrange : '\\033[0;48;5;208m' , onOrchid : '\\033[0;48;5;207m' , boldBlack : '\\033[1;38;5;0m' , boldRed : '\\033[1;38;5;1m' , boldGreen : '\\033[1;38;5;2m' , boldDarkGreen : '\\033[1;38;5;022m' , boldYellow : '\\033[1;38;5;3m' , boldBlue : '\\033[1;38;5;4m' , boldMagenta : '\\033[1;38;5;5m' , boldCyan : '\\033[1;38;5;6m' , boldWhite : '\\033[1;38;5;7m' , boldGray : '\\033[1;38;5;8m' , itBlack : '\\033[3;38;5;0m' , itRed : '\\033[3;38;5;1m' , itGreen : '\\033[3;38;5;2m' , itDarkGreen : '\\033[3;38;5;022m' , itYellow : '\\033[3;38;5;3m' , itBlue : '\\033[3;38;5;4m' , itMagenta : '\\033[3;38;5;5m' , itCyan : '\\033[3;38;5;6m' , itWhite : '\\033[3;38;5;7m' , itGray : '\\033[3;38;5;8m' , itLightGray : '\\033[3;38;5;244m' , itOrange : '\\033[3;38;5;208m' , itOrchid : '\\033[3;38;5;207m' , ESC : '\\033[0m' ] def show( String color, String str ) { if ( COLOR_MATRIX.containsKey(color) ) { println COLOR_MATRIX.get('red') + \"WARN: the color name: ${color} cannot be found in matrix\" + COLOR_MATRIX.get('ESC') } return COLOR_MATRIX.getOrDefault( color, 'black' ) + str + COLOR_MATRIX.get('ESC') } othersimport groovy.transform.Field @Field final Map COLOR_MATRIX = [ black : '\\033[0;38;5;0m' , red : '\\033[0;38;5;1m' , green : '\\033[0;38;5;2m' , darkGreen : '\\033[0;38;5;022m' , yellow : '\\033[0;38;5;3m' , blue : '\\033[0;38;5;4m' , magenta : '\\033[0;38;5;5m' , cyan : '\\033[0;38;5;6m' , white : '\\033[0;38;5;7m' , gray : '\\033[0;38;5;8m' , lightGray : '\\033[0;38;5;244m' , orange : '\\033[0;38;5;208m' , orchid : '\\033[0;38;5;207m' , gold : '\\033[0;38;5;178m' , greenYellow : '\\033[0;38;5;154m' , appleGreen : '\\033[0;38;5;190m' , brRed : '\\033[0;38;5;9m' , boldGreen : '\\033[1;38;5;10m' , boldDarkGreen : '\\033[1;38;5;022m' , brGreen : '\\033[0;38;5;10m' , brYellow : '\\033[0;38;5;11m' , brBlue : '\\033[0;38;5;12m' , brMagenta : '\\033[0;38;5;13m' , brCyan : '\\033[0;38;5;14m' , brWhite : '\\033[0;38;5;15m' , onBlack : '\\033[0;48;5;0m' , onRed : '\\033[0;48;5;1m' , onGreen : '\\033[0;48;5;2m' , onDarkGreen : '\\033[0;48;5;022m' , onYellow : '\\033[0;48;5;3m' , onBlue : '\\033[0;48;5;4m' , onMagenta : '\\033[0;48;5;5m' , onCyan : '\\033[0;48;5;6m' , onWhite : '\\033[0;48;5;7m' , onGray : '\\033[0;48;5;8m' , onLightGray : '\\033[0;48;5;244m' , onOrange : '\\033[0;48;5;208m' , onOrchid : '\\033[0;48;5;207m' , boldBlack : '\\033[1;38;5;0m' , boldRed : '\\033[1;38;5;1m' , boldGreen : '\\033[1;38;5;2m' , boldDarkGreen : '\\033[1;38;5;022m' , boldYellow : '\\033[1;38;5;3m' , boldBlue : '\\033[1;38;5;4m' , boldMagenta : '\\033[1;38;5;5m' , boldCyan : '\\033[1;38;5;6m' , boldWhite : '\\033[1;38;5;7m' , boldGray : '\\033[1;38;5;8m' , itBlack : '\\033[3;38;5;0m' , itRed : '\\033[3;38;5;1m' , itGreen : '\\033[3;38;5;2m' , itDarkGreen : '\\033[3;38;5;022m' , itYellow : '\\033[3;38;5;3m' , itBlue : '\\033[3;38;5;4m' , itMagenta : '\\033[3;38;5;5m' , itCyan : '\\033[3;38;5;6m' , itWhite : '\\033[3;38;5;7m' , itGray : '\\033[3;38;5;8m' , itLightGray : '\\033[3;38;5;244m' , itOrange : '\\033[3;38;5;208m' , itOrchid : '\\033[3;38;5;207m' , ESC : '\\033[0m' ] customized colors xterm NAME COLOR BRIGHT black #000000 #4C4C4C red #CD0000 #FF0000 green #4C8045 #84A729 yellow #F1BD3F #F2C867 blue #1E90FF #4682B4 megenta #CD00CD #FF00FF cyan #5a9196 #6CB2B9 white #E5E5E5 #FFFFFF [!TIP] references: AnsiColorMap.java original settings: NAME COLOR BRIGHT black #000000 #4C4C4C red #CD0000 #FF0000 green #00CD00 #00FF00 yellow #CDCD00 #FFFF00 blue #1E90FF #4682B4 megenta #CD00CD #FF00FF cyan #00CDCD #00FFFF white #E5E5E5 #FFFFFF Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/shared-libs.html":{"url":"jenkins/plugins/shared-libs.html","title":"shared-libs","keywords":"","body":" usage load implicitly load dynamically gerrit refspecs gerrit git [!TIP] references: * jenkins-pipeline-library/src/cloudflare/Caching.groovy usage load implicitly @Library( 'library-name' ) _ @Library( 'library-name@library-version' ) _ // or load multiple @Library([ 'library-name', 'library-name' ]) _ load dynamically library identifier: 'library-name@library-version', retriever: modernSCM([ $class : 'GitSCMSource', remote : 'library-git-url', credentialsId : 'git-credentials' ]) gerrit refspecs references: * Dependencies and Class Loading * GERRIT_REFSPEC not recognized during scm git checkout - Jenkinsfile declarative How to dynamically add all methods of a class into another class Verifying Gerrit CRs to Your Jenkins’ Pipeline’s Shared Libraries git plugin 3.6.4 regression with shared libraries Cannot load a pipeline shared library from Bitbucket PR with cloudbees-bitbucket-branch-source 2.2.7 multibranch: Add refspecs trait to bitbucket scm Import library from specific branch via variable in Jenkinsfile Private Jenkins Shared Libraries Pipeline: Shared Groovy Libraries something else: Extension methods do not work in Pipeline * GerritForge/gerrit-ci-library * releng/pipelines * Jenkins Pipeline DSL Cheat Sheet refs/changes mandatory: +refs/heads/*:refs/remotes/@{remote}/* +refs/changes/*:refs/changes/* optional: +refs/changes/*:refs/remotes/@{remote}/* pull-request +refs/pull-requests/*/from:refs/remotes/@{remote}/pr/* +refs/pull/*:refs/remotes/@{remote}/pr/* +refs/heads/*:refs/remotes/@{remote}/* gerrit library ( identifier : \"mylibs@\" + GERRIT_REFSPEC, retriever : modernSCM ( gerrit( traits: [[ $class: 'RefSpecsSCMSourceTrait', templates: [ [ value: '+refs/heads/*:refs/remotes/@{remote}/*' ] , [ value: '+refs/changes/*:refs/changes/*' ] , [ value: '+refs/changes/*:refs/remotes/@{remote}/*' ] ] ]], credentialsId: 'SSH_CREDENTIAL', remote: 'ssh://account@my.gerrit.com:29418/jenkins/libs' ) ) ) _ git library ( identifier : 'devops-libs', retriever : modernSCM ([ $class : 'GitSCMSource', credentialsId : 'SSH_CREDENTIAL', remote : 'ssh://account@my.gerrit.com:29418/jenkins/libs', traits : [ gitBranchDiscovery(), [ $class : 'RefSpecsSCMSourceTrait', templates : [ [ value : '+refs/heads/*:refs/remotes/@{remote}/*' ] , [ value : '+refs/changes/*:refs/remotes/@{remote}/*' ] , [ value : '+refs/changes/*:refs/changes/*' ] ] ] ] ]) ) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/dsl.html":{"url":"jenkins/plugins/dsl.html","title":"job-dsl","keywords":"","body":" dsl in jenkinsfile create folder references: * jenkinsci/job-dsl-plugin User Power Moves Run a DSL Script locally Job DSL Commands Talks and Blog Posts Real World Examples Testing DSL Scripts * jenkins-pipeline-library/jobs/devops/seed.groovy * Jenkins DSL seed job Jenkins Tutorial * Jenkins Tutorial: Implementing a Seed Job * Jenkins Tutorial: Creating Jobs with the Jenkins Job DSL * User Power Moves Use Job DSL in Pipeline scripts * Getting Started With Jenkins Job DSL Plugin for Standardising Your Pipelines jamietanna/job-dsl-example Configuring a Jenkins Multibranch Pipeline to Specify the Trust Permissions with Job DSL Building a Multibranch Pipeline on a Schedule Ensuring Consistent Code Style with Job DSL Repos Configuring a Jenkins Multibranch Pipeline to Use an External Script with Job DSL * Jenkins DSL seed job Jenkins: 使用groovy + job-dsl 创建并触发job Jenkins Job DSL API Groovy DSL is not working job-dsl-plugin/src/test/groovy/javaposse/jobdsl/plugin/ExecuteDslScriptsSpec.groovy Using Jenkins Job DSL plugin to automatically create and configure projects with Perforce Jenkins-as-code Jenkins-as-code: job-dsl-plugin Jenkins-as-code: comparing job-dsl and Pipelines Jenkins-as-code: registering jobs for automatic seed job creation How To Automate Jenkins Setup with Docker and Jenkins Configuration as Code dsl in jenkinsfile timestamps { ansiColor('xterm') { node('built-in') { jobDsl ( sandbox: true, scriptText: ''' pipelineJob(\\'github-demo\\') { definition { cpsScm { scm { git { remote { github(\\'jenkinsci/pipeline-examples\\') } } } scriptPath(\\'declarative-examples/simple-examples/environmentInStage.groovy\\') } } } ''' ) // jobDsl } // node }} // ansiColor | timestamps or via ExecuteDslScriptsstep ([ $class: 'ExecuteDslScripts' , scriptText: \"\"\" pipelineJob('dsl/guardian/demo') { definition { cpsScm { scm { git { remote { github('jenkinsci/pipeline-examples') } } } scriptPath( 'declarative-examples/simple-examples/environmentInStage.groovy' ) } } } \"\"\".stripIndent() , sandbox: true ]) // steps create folder timestamps { ansiColor('xterm') { node('built-in') { jobDsl ( ignoreExisting: true, sandbox: true, scriptText: '''folder(\\'dsl\\') { displayName(\\'dsl\\') description(\\'for dsl demo\\') }''' ) } // node }} // ansiColor | timestamps or via ExecuteDslScriptsstep([ $class: 'ExecuteDslScripts', scriptText: \"\"\" folder('dsl/guardian') { displayName('guardian') description('for dsl guardian demo') } \"\"\" , lookupStrategy: 'JENKINS_ROOT', removedJobAction: 'DELETE', removedViewAction: 'DELETE', sandbox: true ]) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/simple-theme.html":{"url":"jenkins/plugins/simple-theme.html","title":"simple-theme","keywords":"","body":" configure file Q&A workaround for in-progress image float layer out page-header background color configure file JENKINS_HOME/org.codefirst.SimpleThemeDecorator.xml Q&A workaround for in-progress image float layer out svg[class*=anime] { visibility: collapse } page-header background color a.page-header__brand-link { background: #43a047 !important; color: white !important; font-size: large !important; } .page-header__brand-image { height: 3rem !important; width: 3rem !important; } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/build-timeline.html":{"url":"jenkins/plugins/build-timeline.html","title":"build-timeline","keywords":"","body":" build build environment $ sudo dnf install npm maven downlaod code $ git clone git@github.com:tophat/jenkins-timeline-plugin.git $ cd jenkins-timeline-plugin build $ make build # verify $ ls target/*.hpi target/pipeline-timeline.hpi $ md5sum target/pipeline-timeline.hpi c5a0777425216fce644b5b374f878044 target/pipeline-timeline.hpi $ make build mvn install -e dependency:resolve-plugins dependency:go-offline [INFO] Error stacktraces are turned on. [INFO] Scanning for projects... [WARNING] The POM for org.jenkins-ci.tools:maven-hpi-plugin:jar:2.2 is missing, no dependency information available [WARNING] Failed to build parent project for io.jenkins.plugins:pipeline-timeline:hpi:1.0.1-SNAPSHOT [INFO] [INFO] -------------------------------- [INFO] Building Pipeline timeline 1.0.1-SNAPSHOT [INFO] --------------------------------[ hpi ]--------------------------------- [INFO] [INFO] --- maven-hpi-plugin:2.2:validate (default-validate) @ pipeline-timeline --- [INFO] [INFO] --- maven-enforcer-plugin:3.0.0-M1:display-info (display-info) @ pipeline-timeline --- [INFO] Maven Version: 3.5.4 [INFO] JDK Version: 1.8.0_242 normalized as: 1.8.0-242 [INFO] OS Info: Arch: amd64 Family: unix Name: linux Version: 4.18.0-147.8.1.el8_1.x86_64 [INFO] [INFO] --- maven-enforcer-plugin:3.0.0-M1:enforce (display-info) @ pipeline-timeline --- [INFO] Ignoring requireUpperBoundDeps in com.google.guava:guava [INFO] Ignoring requireUpperBoundDeps in com.google.code.findbugs:jsr305 [INFO] [INFO] --- frontend-maven-plugin:1.6:install-node-and-npm (install node and npm) @ pipeline-timeline --- [INFO] Installing node version v8.0.0 [INFO] Unpacking /home/marslo/.m2/repository/com/github/eirslett/node/8.0.0/node-8.0.0-linux-x64.tar.gz into /home/marslo/jenkins-timeline-plugin/mvn_node/node/tmp [INFO] Copying node binary from /home/marslo/jenkins-timeline-plugin/mvn_node/node/tmp/node-v8.0.0-linux-x64/bin/node to /home/marslo/jenkins-timeline-plugin/mvn_node/node/node [INFO] Installed node locally. [INFO] Installing npm version 6.5.0 [INFO] Unpacking /home/marslo/.m2/repository/com/github/eirslett/npm/6.5.0/npm-6.5.0.tar.gz into /home/marslo/jenkins-timeline-plugin/mvn_node/node/node_modules [INFO] Installed npm locally. [INFO] [INFO] --- frontend-maven-plugin:1.6:npm (npm install) @ pipeline-timeline --- [INFO] Running 'npm install' in /home/marslo/jenkins-timeline-plugin/webapp_src [INFO] [INFO] > styled-components@4.1.1 postinstall /home/marslo/jenkins-timeline-plugin/webapp_src/node_modules/styled-components [INFO] > node ./scripts/postinstall.js || exit 0 [INFO] [INFO] Use styled-components at work? Consider supporting our development efforts at https://opencollective.com/styled-components [WARNING] npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.4 (node_modules/fsevents): [WARNING] npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.4: wanted {\"os\":\"darwin\",\"arch\":\"any\"} (current: {\"os\":\"linux\",\"arch\":\"x64\"}) [ERROR] [INFO] added 2370 packages from 1444 contributors and audited 2439 packages in 29.174s [INFO] found 865 vulnerabilities (36 low, 319 moderate, 402 high, 108 critical) [INFO] run `npm audit fix` to fix them, or `npm audit` for details [INFO] [INFO] --- maven-localizer-plugin:1.24:generate (default) @ pipeline-timeline --- [INFO] [INFO] >>> maven-javadoc-plugin:2.10.4:javadoc (default) > generate-sources @ pipeline-timeline >>> [INFO] [INFO] --- maven-hpi-plugin:2.2:validate (default-validate) @ pipeline-timeline --- [INFO] [INFO] --- maven-enforcer-plugin:3.0.0-M1:display-info (display-info) @ pipeline-timeline --- [INFO] Maven Version: 3.5.4 [INFO] JDK Version: 1.8.0_242 normalized as: 1.8.0-242 [INFO] OS Info: Arch: amd64 Family: unix Name: linux Version: 4.18.0-147.8.1.el8_1.x86_64 [INFO] [INFO] --- maven-enforcer-plugin:3.0.0-M1:enforce (display-info) @ pipeline-timeline --- [INFO] Ignoring requireUpperBoundDeps in com.google.guava:guava [INFO] Ignoring requireUpperBoundDeps in com.google.code.findbugs:jsr305 [INFO] [INFO] --- frontend-maven-plugin:1.6:install-node-and-npm (install node and npm) @ pipeline-timeline --- [INFO] Node v8.0.0 is already installed. [INFO] NPM 6.5.0 is already installed. [INFO] [INFO] --- frontend-maven-plugin:1.6:npm (npm install) @ pipeline-timeline --- [INFO] Running 'npm install' in /home/marslo/jenkins-timeline-plugin/webapp_src [WARNING] npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.4 (node_modules/fsevents): [WARNING] npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.4: wanted {\"os\":\"darwin\",\"arch\":\"any\"} (current: {\"os\":\"linux\",\"arch\":\"x64\"}) [ERROR] [INFO] audited 2439 packages in 15.975s [INFO] found 865 vulnerabilities (36 low, 319 moderate, 402 high, 108 critical) [INFO] run `npm audit fix` to fix them, or `npm audit` for details [INFO] [INFO] --- maven-localizer-plugin:1.24:generate (default) @ pipeline-timeline --- [INFO] [INFO] jenkinstl@0.1.0 build-to-plugin /home/marslo/jenkins-timeline-plugin/webapp_src [INFO] > PUBLIC_URL=/plugin/pipeline-timeline npm run build && cp -r build/* ../src/main/webapp [INFO] [INFO] [INFO] > jenkinstl@0.1.0 build /home/marslo/jenkins-timeline-plugin/webapp_src [INFO] > react-scripts build [INFO] [INFO] Creating an optimized production build... [INFO] Compiled successfully. [INFO] [INFO] File sizes after gzip: [INFO] [INFO] 75.21 KB build/static/js/1.eec3780e.chunk.js [INFO] 6.64 KB build/static/js/main.467140c3.chunk.js [INFO] 775 B build/static/js/runtime~main.f0028a2f.js [INFO] [INFO] The project was built assuming it is hosted at /plugin/pipeline-timeline/. [INFO] You can control this with the homepage field in your package.json. [INFO] [INFO] The build folder is ready to be deployed. [INFO] [INFO] Find out more about deployment here: [INFO] [INFO] http://bit.ly/CRA-deploy [INFO] [INFO] [INFO] --- access-modifier-checker:1.8:enforce (default-enforce) @ pipeline-timeline --- [INFO] [INFO] --- animal-sniffer-maven-plugin:1.15:check (check) @ pipeline-timeline --- [INFO] Resolved signature org.codehaus.mojo.signature:java17 version as 1.0 from dependencyManagement [INFO] Checking unresolved references to org.codehaus.mojo.signature:java17:1.0 [INFO] [INFO] --- maven-hpi-plugin:2.2:insert-test (default-insert-test) @ pipeline-timeline --- [INFO] [INFO] --- gmaven-plugin:1.5-jenkins-3:generateTestStubs (test-in-groovy) @ pipeline-timeline --- [INFO] No sources found for Java stub generation [INFO] [INFO] --- maven-resources-plugin:3.0.2:testResources (default-testResources) @ pipeline-timeline --- [INFO] Using 'UTF-8' encoding to copy filtered resources. [INFO] skip non existing resourceDirectory /home/marslo/jenkins-timeline-plugin/src/test/resources [INFO] [INFO] --- maven-compiler-plugin:3.6.1:testCompile (default-testCompile) @ pipeline-timeline --- [INFO] Changes detected - recompiling the module! [INFO] Compiling 3 source files to /home/marslo/jenkins-timeline-plugin/target/test-classes [INFO] [INFO] --- maven-hpi-plugin:2.2:test-hpl (default-test-hpl) @ pipeline-timeline --- [INFO] Generating /home/marslo/jenkins-timeline-plugin/target/test-classes/the.hpl [INFO] [INFO] --- maven-hpi-plugin:2.2:resolve-test-dependencies (default-resolve-test-dependencies) @ pipeline-timeline --- [INFO] [INFO] --- gmaven-plugin:1.5-jenkins-3:testCompile (test-in-groovy) @ pipeline-timeline --- [INFO] No sources found to compile [INFO] [INFO] --- maven-surefire-plugin:2.20:test (default-test) @ pipeline-timeline --- [INFO] Surefire report directory: /home/marslo/jenkins-timeline-plugin/target/surefire-reports [INFO] [INFO] ------------------------------------------------------- [INFO] T E S T S [INFO] ------------------------------------------------------- [INFO] Running InjectedTest [INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 5.14 s - in InjectedTest [INFO] Running io.jenkins.plugins.jenkinstl.MenuItemFactoryTest [INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.467 s - in io.jenkins.plugins.jenkinstl.MenuItemFactoryTest [INFO] Running io.jenkins.plugins.jenkinstl.MenuItemTest [INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 s - in io.jenkins.plugins.jenkinstl.MenuItemTest [INFO] [INFO] Results: [INFO] [INFO] Tests run: 7, Failures: 0, Errors: 0, Skipped: 0 [INFO] [INFO] [INFO] --- maven-license-plugin:1.7:process (default) @ pipeline-timeline --- [INFO] Generated /home/marslo/jenkins-timeline-plugin/target/pipeline-timeline/WEB-INF/licenses.xml [INFO] [INFO] --- maven-hpi-plugin:2.2:hpi (default-hpi) @ pipeline-timeline --- [INFO] Generating /home/marslo/jenkins-timeline-plugin/target/pipeline-timeline/META-INF/MANIFEST.MF [INFO] Checking for attached .jar artifact ... [INFO] Generating jar /home/marslo/jenkins-timeline-plugin/target/pipeline-timeline.jar [INFO] Building jar: /home/marslo/jenkins-timeline-plugin/target/pipeline-timeline.jar [INFO] Exploding webapp... [INFO] Copy webapp webResources to /home/marslo/jenkins-timeline-plugin/target/pipeline-timeline [INFO] Assembling webapp pipeline-timeline in /home/marslo/jenkins-timeline-plugin/target/pipeline-timeline [INFO] Generating hpi /home/marslo/jenkins-timeline-plugin/target/pipeline-timeline.hpi [INFO] Building jar: /home/marslo/jenkins-timeline-plugin/target/pipeline-timeline.hpi [INFO] [INFO] --- maven-jar-plugin:3.0.2:test-jar (maybe-test-jar) @ pipeline-timeline --- [INFO] Skipping packaging of the test-jar [INFO] [INFO] >>> findbugs-maven-plugin:3.0.5:check (findbugs) > :findbugs @ pipeline-timeline >>> [INFO] [INFO] --- findbugs-maven-plugin:3.0.5:findbugs (findbugs) @ pipeline-timeline --- [INFO] Fork Value is true [INFO] Done FindBugs Analysis.... [INFO] [INFO] >> maven-dependency-plugin:3.0.0:go-offline (default-cli) > :resolve-plugins @ pipeline-timeline >>> [INFO] [INFO] --- maven-dependency-plugin:3.0.0:resolve-plugins (resolve-plugins) @ pipeline-timeline --- [INFO] Plugin Resolved: maven-jar-plugin-3.0.2.jar [INFO] Plugin Dependency Resolved: maven-shared-utils-3.0.1.jar [INFO] Plugin Dependency Resolved: commons-compress-1.11.jar [INFO] Plugin Dependency Resolved: commons-io-2.5.jar [INFO] Plugin Dependency Resolved: maven-aether-provider-3.0.jar [INFO] Plugin Dependency Resolved: maven-settings-3.0.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-3.0.jar [INFO] Plugin Dependency Resolved: maven-settings-builder-3.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-bean-1.4.2.jar [INFO] Plugin Dependency Resolved: aether-util-1.7.jar [INFO] Plugin Dependency Resolved: maven-core-3.0.jar [INFO] Plugin Dependency Resolved: maven-model-3.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-plexus-1.4.2.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.14.jar [INFO] Plugin Dependency Resolved: maven-artifact-3.0.jar [INFO] Plugin Dependency Resolved: maven-archiver-3.1.1.jar [INFO] Plugin Dependency Resolved: plexus-io-2.7.1.jar [INFO] Plugin Dependency Resolved: plexus-classworlds-2.2.3.jar [INFO] Plugin Dependency Resolved: maven-model-builder-3.0.jar [INFO] Plugin Dependency Resolved: xz-1.5.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-3.0.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.6.jar [INFO] Plugin Dependency Resolved: aether-spi-1.7.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: maven-jar-plugin-3.0.2.jar [INFO] Plugin Dependency Resolved: aether-api-1.7.jar [INFO] Plugin Dependency Resolved: plexus-archiver-3.4.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.24.jar [INFO] Plugin Dependency Resolved: sisu-guice-2.1.7-noaop.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: aether-impl-1.7.jar [INFO] Plugin Dependency Resolved: snappy-0.4.jar [INFO] Plugin Resolved: maven-stapler-plugin-1.17.jar [INFO] Plugin Dependency Resolved: jsch-0.1.23.jar [INFO] Plugin Dependency Resolved: txw2-20090102.jar [INFO] Plugin Dependency Resolved: json-lib-2.1-jdk15.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.0.1.jar [INFO] Plugin Dependency Resolved: xml-apis-1.0.b2.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.0.1.jar [INFO] Plugin Dependency Resolved: commons-cli-1.0.jar [INFO] Plugin Dependency Resolved: maven-reporting-impl-2.0.1.jar [INFO] Plugin Dependency Resolved: commons-lang-2.3.jar [INFO] Plugin Dependency Resolved: maven-plugin-parameter-documenter-2.0.1.jar [INFO] Plugin Dependency Resolved: commons-validator-1.1.4.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-2.0.1.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9.jar [INFO] Plugin Dependency Resolved: xercesImpl-2.8.1.jar [INFO] Plugin Dependency Resolved: velocity-1.4.jar [INFO] Plugin Dependency Resolved: metainf-services-1.2.jar [INFO] Plugin Dependency Resolved: taglib-xml-writer-1.5.jar [INFO] Plugin Dependency Resolved: commons-fileupload-1.2.1.jar [INFO] Plugin Dependency Resolved: maven-project-2.0.1.jar [INFO] Plugin Dependency Resolved: maven-core-2.0.1.jar [INFO] Plugin Dependency Resolved: maven-model-2.0.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.0.1.jar [INFO] Plugin Dependency Resolved: commons-io-1.3.1.jar [INFO] Plugin Dependency Resolved: plexus-utils-1.0.5.jar [INFO] Plugin Dependency Resolved: plexus-velocity-1.1.2.jar [INFO] Plugin Dependency Resolved: wagon-ssh-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: maven-profile-2.0.1.jar [INFO] Plugin Dependency Resolved: jellydoc-annotations-1.5.jar [INFO] Plugin Dependency Resolved: dom4j-1.6.1.jar [INFO] Plugin Dependency Resolved: plexus-i18n-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: commons-discovery-0.4.jar [INFO] Plugin Dependency Resolved: doxia-sink-api-1.0-alpha-6.jar [INFO] Plugin Dependency Resolved: maven-plugin-descriptor-2.0.1.jar [INFO] Plugin Dependency Resolved: commons-collections-3.2.jar [INFO] Plugin Dependency Resolved: tiger-types-1.1.jar [INFO] Plugin Dependency Resolved: commons-logging-api-1.0.4.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.0.1.jar [INFO] Plugin Dependency Resolved: maven-error-diagnostics-2.0.1.jar [INFO] Plugin Dependency Resolved: ant-1.6.5.jar [INFO] Plugin Dependency Resolved: jaxen-1.1.4.jar [INFO] Plugin Dependency Resolved: commons-beanutils-1.7.0.jar [INFO] Plugin Dependency Resolved: maven-settings-2.0.1.jar [INFO] Plugin Dependency Resolved: commons-logging-1.0.4.jar [INFO] Plugin Dependency Resolved: classworlds-1.1-alpha-2.jar [INFO] Plugin Dependency Resolved: nekohtml-1.9.6.2.jar [INFO] Plugin Dependency Resolved: plexus-interactivity-api-1.0-alpha-4.jar [INFO] Plugin Dependency Resolved: maven-monitor-2.0.1.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: localizer-1.7.jar [INFO] Plugin Dependency Resolved: guava-r06.jar [INFO] Plugin Dependency Resolved: maven-stapler-plugin-1.17.jar [INFO] Plugin Dependency Resolved: ezmorph-1.0.3.jar [INFO] Plugin Dependency Resolved: oro-2.0.7.jar [INFO] Plugin Dependency Resolved: doxia-site-renderer-1.0-alpha-6.jar [INFO] Plugin Dependency Resolved: stapler-1.100.jar [INFO] Plugin Dependency Resolved: junit-4.5.jar [INFO] Plugin Dependency Resolved: plexus-utils-1.0.2.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.0.1.jar [INFO] Plugin Dependency Resolved: velocity-dep-1.4.jar [INFO] Plugin Dependency Resolved: wagon-file-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: doxia-core-1.0-alpha-6.jar [INFO] Plugin Dependency Resolved: textile-j-2.2.864.jar [INFO] Plugin Dependency Resolved: wagon-http-lightweight-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: maven-jellydoc-plugin-1.5.jar [INFO] Plugin Resolved: maven-site-plugin-3.6.jar [INFO] Plugin Dependency Resolved: commons-lang3-3.4.jar [INFO] Plugin Dependency Resolved: parboiled-java-1.1.4.jar [INFO] Plugin Dependency Resolved: pegdown-1.2.1.jar [INFO] Plugin Dependency Resolved: maven-site-plugin-3.6.jar [INFO] Plugin Dependency Resolved: maven-settings-builder-3.0.jar [INFO] Plugin Dependency Resolved: asm-analysis-4.1.jar [INFO] Plugin Dependency Resolved: jetty-util-6.1.25.jar [INFO] Plugin Dependency Resolved: aether-util-1.7.jar [INFO] Plugin Dependency Resolved: maven-core-3.0.jar [INFO] Plugin Dependency Resolved: maven-model-3.0.jar [INFO] Plugin Dependency Resolved: struts-taglib-1.3.8.jar [INFO] Plugin Dependency Resolved: maven-artifact-3.0.jar [INFO] Plugin Dependency Resolved: asm-util-4.1.jar [INFO] Plugin Dependency Resolved: commons-lang-2.4.jar [INFO] Plugin Dependency Resolved: maven-archiver-3.1.1.jar [INFO] Plugin Dependency Resolved: doxia-site-renderer-1.7.4.jar [INFO] Plugin Dependency Resolved: velocity-tools-2.0.jar [INFO] Plugin Dependency Resolved: struts-tiles-1.3.8.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-3.0.jar [INFO] Plugin Dependency Resolved: maven-model-builder-3.0.jar [INFO] Plugin Dependency Resolved: sslext-1.2-0.jar [INFO] Plugin Dependency Resolved: xz-1.5.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-3.0.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.6.jar [INFO] Plugin Dependency Resolved: aether-api-1.7.jar [INFO] Plugin Dependency Resolved: plexus-archiver-3.4.jar [INFO] Plugin Dependency Resolved: doxia-core-1.7.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.24.jar [INFO] Plugin Dependency Resolved: xmlunit-1.5.jar [INFO] Plugin Dependency Resolved: sisu-guice-2.1.7-noaop.jar [INFO] Plugin Dependency Resolved: plexus-velocity-1.2.jar [INFO] Plugin Dependency Resolved: aether-util-0.9.0.M2.jar [INFO] Plugin Dependency Resolved: dom4j-1.1.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: doxia-integration-tools-1.7.4.jar [INFO] Plugin Dependency Resolved: doxia-module-markdown-1.7.jar [INFO] Plugin Dependency Resolved: snappy-0.4.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0.jar [INFO] Plugin Dependency Resolved: maven-reporting-exec-1.3.jar [INFO] Plugin Dependency Resolved: maven-shared-utils-3.1.0.jar [INFO] Plugin Dependency Resolved: commons-compress-1.11.jar [INFO] Plugin Dependency Resolved: commons-io-2.5.jar [INFO] Plugin Dependency Resolved: doxia-skin-model-1.7.4.jar [INFO] Plugin Dependency Resolved: maven-aether-provider-3.0.jar [INFO] Plugin Dependency Resolved: parboiled-core-1.1.4.jar [INFO] Plugin Dependency Resolved: maven-settings-3.0.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-3.0.jar [INFO] Plugin Dependency Resolved: commons-digester-1.8.jar [INFO] Plugin Dependency Resolved: sisu-inject-bean-1.4.2.jar [INFO] Plugin Dependency Resolved: sisu-inject-plexus-1.4.2.jar [INFO] Plugin Dependency Resolved: commons-beanutils-1.7.0.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.14.jar [INFO] Plugin Dependency Resolved: doxia-module-xdoc-1.7.jar [INFO] Plugin Dependency Resolved: jetty-6.1.25.jar [INFO] Plugin Dependency Resolved: commons-codec-1.3.jar [INFO] Plugin Dependency Resolved: commons-collections-3.2.1.jar [INFO] Plugin Dependency Resolved: plexus-io-2.7.1.jar [INFO] Plugin Dependency Resolved: struts-core-1.3.8.jar [INFO] Plugin Dependency Resolved: junit-3.8.1.jar [INFO] Plugin Dependency Resolved: antlr-2.7.2.jar [INFO] Plugin Dependency Resolved: commons-logging-1.1.jar [INFO] Plugin Dependency Resolved: plexus-classworlds-2.5.2.jar [INFO] Plugin Dependency Resolved: commons-chain-1.1.jar [INFO] Plugin Dependency Resolved: asm-4.1.jar [INFO] Plugin Dependency Resolved: httpclient-4.0.2.jar [INFO] Plugin Dependency Resolved: doxia-module-fml-1.7.jar [INFO] Plugin Dependency Resolved: doxia-logging-api-1.7.jar [INFO] Plugin Dependency Resolved: doxia-module-apt-1.7.jar [INFO] Plugin Dependency Resolved: aether-spi-1.7.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: asm-tree-4.1.jar [INFO] Plugin Dependency Resolved: servlet-api-2.5-20081211.jar [INFO] Plugin Dependency Resolved: plexus-i18n-1.0-beta-10.jar [INFO] Plugin Dependency Resolved: doxia-module-xhtml-1.7.jar [INFO] Plugin Dependency Resolved: httpcore-4.0.1.jar [INFO] Plugin Dependency Resolved: servlet-api-2.5.jar [INFO] Plugin Dependency Resolved: commons-validator-1.3.1.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-30.jar [INFO] Plugin Dependency Resolved: oro-2.0.8.jar [INFO] Plugin Dependency Resolved: aether-impl-1.7.jar [INFO] Plugin Dependency Resolved: doxia-decoration-model-1.7.4.jar [INFO] Plugin Dependency Resolved: doxia-sink-api-1.7.jar [INFO] Plugin Dependency Resolved: velocity-1.7.jar [INFO] Plugin Resolved: maven-release-plugin-2.5.3.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-integrity-1.9.4.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-error-diagnostics-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-scm-providers-standard-1.9.4.pom [INFO] Plugin Dependency Resolved: maven-settings-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-tfs-1.9.4.jar [INFO] Plugin Dependency Resolved: mksapi-jar-4.10.9049.jar [INFO] Plugin Dependency Resolved: slf4j-api-1.5.6.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-bazaar-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.2.1.jar [INFO] Plugin Dependency Resolved: jackrabbit-webdav-1.5.0.jar [INFO] Plugin Dependency Resolved: commons-lang-2.4.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-clearcase-1.9.4.jar [INFO] Plugin Dependency Resolved: wagon-ssh-external-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-project-2.2.1.jar [INFO] Plugin Dependency Resolved: commons-codec-1.2.jar [INFO] Plugin Dependency Resolved: jcl-over-slf4j-1.5.6.jar [INFO] Plugin Dependency Resolved: plexus-interactivity-api-1.0-alpha-6.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.5.5.jar [INFO] Plugin Dependency Resolved: doxia-sink-api-1.1.jar [INFO] Plugin Dependency Resolved: maven-monitor-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-http-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9.jar [INFO] Plugin Dependency Resolved: wagon-file-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: xercesMinimal-1.9.6.2.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-vss-1.9.4.jar [INFO] Plugin Dependency Resolved: aether-api-1.0.0.v20140518.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-accurev-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-gitexe-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-hg-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-jazz-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-starteam-1.9.4.jar [INFO] Plugin Dependency Resolved: jdom-1.1.jar [INFO] Plugin Dependency Resolved: wagon-http-lightweight-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: maven-scm-api-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-svn-commons-1.9.4.jar [INFO] Plugin Dependency Resolved: cvsclient-20060125.jar [INFO] Plugin Dependency Resolved: jdom-1.0.jar [INFO] Plugin Dependency Resolved: maven-scm-manager-plexus-1.8.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.14.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-cvsjava-1.9.4.jar [INFO] Plugin Dependency Resolved: jsch-0.1.38.jar [INFO] Plugin Dependency Resolved: jackrabbit-jcr-commons-1.5.0.jar [INFO] Plugin Dependency Resolved: classworlds-1.1.jar [INFO] Plugin Dependency Resolved: nekohtml-1.9.6.2.jar [INFO] Plugin Dependency Resolved: wagon-ssh-common-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: junit-3.8.1.jar [INFO] Plugin Dependency Resolved: maven-core-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-perforce-1.9.4.jar [INFO] Plugin Dependency Resolved: groovy-all-1.7.6.jar [INFO] Plugin Dependency Resolved: ganymed-ssh2-build210.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-webdav-jackrabbit-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: commons-httpclient-3.0.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.2.1.jar [INFO] Plugin Dependency Resolved: commons-cli-1.2.jar [INFO] Plugin Dependency Resolved: maven-plugin-descriptor-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-release-plugin-2.5.3.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-synergy-1.9.4.jar [INFO] Plugin Dependency Resolved: slf4j-nop-1.5.3.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: maven-invoker-2.2.jar [INFO] Plugin Dependency Resolved: maven-profile-2.2.1.jar [INFO] Plugin Dependency Resolved: aether-util-1.0.0.v20140518.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-parameter-documenter-2.2.1.jar [INFO] Plugin Dependency Resolved: jaxen-1.1-beta-8.jar [INFO] Plugin Dependency Resolved: commons-io-2.2.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-cvs-commons-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-git-commons-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-release-api-2.5.3.jar [INFO] Plugin Dependency Resolved: maven-model-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-svnexe-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-release-manager-2.5.3.jar [INFO] Plugin Dependency Resolved: wagon-ssh-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.15.jar [INFO] Plugin Dependency Resolved: doxia-logging-api-1.1.jar [INFO] Plugin Dependency Resolved: maven-scm-provider-cvsexe-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.2.1.jar [INFO] Plugin Dependency Resolved: backport-util-concurrent-3.1.jar [INFO] Plugin Dependency Resolved: slf4j-jdk14-1.5.6.jar [INFO] Plugin Dependency Resolved: wagon-http-shared-1.0-beta-6.jar [INFO] Plugin Resolved: maven-javadoc-plugin-2.10.4.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-error-diagnostics-2.2.1.jar [INFO] Plugin Dependency Resolved: doxia-decoration-model-1.4.jar [INFO] Plugin Dependency Resolved: maven-settings-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-velocity-1.1.7.jar [INFO] Plugin Dependency Resolved: slf4j-api-1.5.6.jar [INFO] Plugin Dependency Resolved: doxia-sink-api-1.4.jar [INFO] Plugin Dependency Resolved: struts-taglib-1.3.8.jar [INFO] Plugin Dependency Resolved: jackrabbit-webdav-1.5.0.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.2.1.jar [INFO] Plugin Dependency Resolved: commons-lang-2.4.jar [INFO] Plugin Dependency Resolved: velocity-tools-2.0.jar [INFO] Plugin Dependency Resolved: struts-tiles-1.3.8.jar [INFO] Plugin Dependency Resolved: maven-toolchain-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-ssh-external-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-project-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-3.0.jar [INFO] Plugin Dependency Resolved: jcl-over-slf4j-1.5.6.jar [INFO] Plugin Dependency Resolved: sslext-1.2-0.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.5.5.jar [INFO] Plugin Dependency Resolved: xz-1.5.jar [INFO] Plugin Dependency Resolved: maven-monitor-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-http-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: wagon-file-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9.jar [INFO] Plugin Dependency Resolved: velocity-1.5.jar [INFO] Plugin Dependency Resolved: commons-logging-1.1.1.jar [INFO] Plugin Dependency Resolved: doxia-module-fml-1.4.jar [INFO] Plugin Dependency Resolved: xercesMinimal-1.9.6.2.jar [INFO] Plugin Dependency Resolved: log4j-1.2.14.jar [INFO] Plugin Dependency Resolved: httpclient-4.2.3.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.24.jar [INFO] Plugin Dependency Resolved: xml-apis-1.3.04.jar [INFO] Plugin Dependency Resolved: maven-archiver-2.5.jar [INFO] Plugin Dependency Resolved: dom4j-1.1.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.11.jar [INFO] Plugin Dependency Resolved: wagon-http-lightweight-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: commons-codec-1.6.jar [INFO] Plugin Dependency Resolved: snappy-0.4.jar [INFO] Plugin Dependency Resolved: doxia-core-1.4.jar [INFO] Plugin Dependency Resolved: commons-compress-1.11.jar [INFO] Plugin Dependency Resolved: commons-io-2.5.jar [INFO] Plugin Dependency Resolved: doxia-module-xhtml-1.4.jar [INFO] Plugin Dependency Resolved: commons-digester-1.8.jar [INFO] Plugin Dependency Resolved: commons-beanutils-1.7.0.jar [INFO] Plugin Dependency Resolved: httpcore-4.2.2.jar [INFO] Plugin Dependency Resolved: jsch-0.1.38.jar [INFO] Plugin Dependency Resolved: jackrabbit-jcr-commons-1.5.0.jar [INFO] Plugin Dependency Resolved: classworlds-1.1.jar [INFO] Plugin Dependency Resolved: doxia-logging-api-1.4.jar [INFO] Plugin Dependency Resolved: commons-collections-3.2.1.jar [INFO] Plugin Dependency Resolved: struts-core-1.3.8.jar [INFO] Plugin Dependency Resolved: plexus-io-2.7.1.jar [INFO] Plugin Dependency Resolved: nekohtml-1.9.6.2.jar [INFO] Plugin Dependency Resolved: wagon-ssh-common-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-core-2.2.1.jar [INFO] Plugin Dependency Resolved: junit-3.8.1.jar [INFO] Plugin Dependency Resolved: antlr-2.7.2.jar [INFO] Plugin Dependency Resolved: plexus-archiver-3.3.jar [INFO] Plugin Dependency Resolved: commons-chain-1.1.jar [INFO] Plugin Dependency Resolved: plexus-interactivity-api-1.0-alpha-4.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-webdav-jackrabbit-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: commons-httpclient-3.0.jar [INFO] Plugin Dependency Resolved: maven-common-artifact-filters-1.3.jar [INFO] Plugin Dependency Resolved: commons-cli-1.2.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.2.1.jar [INFO] Plugin Dependency Resolved: xercesImpl-2.9.1.jar [INFO] Plugin Dependency Resolved: plexus-i18n-1.0-beta-7.jar [INFO] Plugin Dependency Resolved: maven-plugin-descriptor-2.2.1.jar [INFO] Plugin Dependency Resolved: slf4j-nop-1.5.3.jar [INFO] Plugin Dependency Resolved: maven-profile-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: maven-invoker-2.2.jar [INFO] Plugin Dependency Resolved: maven-javadoc-plugin-2.10.4.jar [INFO] Plugin Dependency Resolved: maven-plugin-parameter-documenter-2.2.1.jar [INFO] Plugin Dependency Resolved: doxia-site-renderer-1.4.jar [INFO] Plugin Dependency Resolved: maven-model-2.2.1.jar [INFO] Plugin Dependency Resolved: qdox-1.12.1.jar [INFO] Plugin Dependency Resolved: wagon-ssh-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: commons-validator-1.3.1.jar [INFO] Plugin Dependency Resolved: oro-2.0.8.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.2.1.jar [INFO] Plugin Dependency Resolved: backport-util-concurrent-3.1.jar [INFO] Plugin Dependency Resolved: slf4j-jdk14-1.5.6.jar [INFO] Plugin Dependency Resolved: wagon-http-shared-1.0-beta-6.jar [INFO] Plugin Resolved: maven-clean-plugin-3.0.0.jar [INFO] Plugin Dependency Resolved: jsr305-2.0.1.jar [INFO] Plugin Dependency Resolved: maven-shared-utils-3.0.0.jar [INFO] Plugin Dependency Resolved: plexus-utils-2.0.4.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-3.0.jar [INFO] Plugin Dependency Resolved: commons-io-2.4.jar [INFO] Plugin Dependency Resolved: sisu-inject-bean-1.4.2.jar [INFO] Plugin Dependency Resolved: maven-model-3.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-plexus-1.4.2.jar [INFO] Plugin Dependency Resolved: maven-artifact-3.0.jar [INFO] Plugin Dependency Resolved: sisu-guice-2.1.7-noaop.jar [INFO] Plugin Dependency Resolved: maven-clean-plugin-3.0.0.jar [INFO] Plugin Dependency Resolved: plexus-classworlds-2.2.3.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.5.5.jar [INFO] Plugin Resolved: maven-surefire-plugin-2.20.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-error-diagnostics-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-settings-2.2.1.jar [INFO] Plugin Dependency Resolved: surefire-booter-2.20.jar [INFO] Plugin Dependency Resolved: slf4j-api-1.5.6.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.2.1.jar [INFO] Plugin Dependency Resolved: jackrabbit-webdav-1.5.0.jar [INFO] Plugin Dependency Resolved: jackrabbit-jcr-commons-1.5.0.jar [INFO] Plugin Dependency Resolved: classworlds-1.1.jar [INFO] Plugin Dependency Resolved: surefire-api-2.20.jar [INFO] Plugin Dependency Resolved: nekohtml-1.9.6.2.jar [INFO] Plugin Dependency Resolved: maven-plugin-annotations-3.3.jar [INFO] Plugin Dependency Resolved: maven-core-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-toolchain-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-project-2.2.1.jar [INFO] Plugin Dependency Resolved: commons-codec-1.2.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-3.0.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-webdav-jackrabbit-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: jcl-over-slf4j-1.5.6.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-surefire-common-2.20.jar [INFO] Plugin Dependency Resolved: surefire-logger-api-2.20.jar [INFO] Plugin Dependency Resolved: maven-plugin-descriptor-2.2.1.jar [INFO] Plugin Dependency Resolved: slf4j-nop-1.5.3.jar [INFO] Plugin Dependency Resolved: maven-monitor-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-http-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-profile-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: hamcrest-core-1.3.jar [INFO] Plugin Dependency Resolved: maven-plugin-parameter-documenter-2.2.1.jar [INFO] Plugin Dependency Resolved: xercesMinimal-1.9.6.2.jar [INFO] Plugin Dependency Resolved: junit-4.12.jar [INFO] Plugin Dependency Resolved: maven-model-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-utils-1.5.15.jar [INFO] Plugin Dependency Resolved: maven-surefire-plugin-2.20.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.11.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9-stable-1.jar [INFO] Plugin Dependency Resolved: backport-util-concurrent-3.1.jar [INFO] Plugin Dependency Resolved: slf4j-jdk14-1.5.6.jar [INFO] Plugin Dependency Resolved: wagon-http-shared-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: commons-httpclient-3.1.jar [INFO] Plugin Dependency Resolved: commons-lang3-3.1.jar [INFO] Plugin Resolved: maven-compiler-plugin-3.6.1.jar [INFO] Plugin Dependency Resolved: maven-shared-utils-3.1.0.jar [INFO] Plugin Dependency Resolved: commons-io-2.5.jar [INFO] Plugin Dependency Resolved: qdox-2.0-M5.jar [INFO] Plugin Dependency Resolved: maven-aether-provider-3.0.jar [INFO] Plugin Dependency Resolved: maven-settings-3.0.jar [INFO] Plugin Dependency Resolved: asm-6.0_ALPHA.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-3.0.jar [INFO] Plugin Dependency Resolved: maven-settings-builder-3.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-bean-1.4.2.jar [INFO] Plugin Dependency Resolved: aether-util-1.7.jar [INFO] Plugin Dependency Resolved: maven-core-3.0.jar [INFO] Plugin Dependency Resolved: maven-model-3.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-plexus-1.4.2.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.14.jar [INFO] Plugin Dependency Resolved: maven-artifact-3.0.jar [INFO] Plugin Dependency Resolved: plexus-compiler-manager-2.8.1.jar [INFO] Plugin Dependency Resolved: plexus-classworlds-2.2.3.jar [INFO] Plugin Dependency Resolved: maven-model-builder-3.0.jar [INFO] Plugin Dependency Resolved: plexus-compiler-javac-2.8.1.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-3.0.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.6.jar [INFO] Plugin Dependency Resolved: maven-shared-incremental-1.1.jar [INFO] Plugin Dependency Resolved: plexus-utils-2.0.4.jar [INFO] Plugin Dependency Resolved: aether-spi-1.7.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: aether-api-1.7.jar [INFO] Plugin Dependency Resolved: sisu-guice-2.1.7-noaop.jar [INFO] Plugin Dependency Resolved: maven-compiler-plugin-3.6.1.jar [INFO] Plugin Dependency Resolved: plexus-compiler-api-2.8.1.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: aether-impl-1.7.jar [INFO] Plugin Resolved: maven-resources-plugin-3.0.2.jar [INFO] Plugin Dependency Resolved: jsr305-2.0.1.jar [INFO] Plugin Dependency Resolved: commons-io-2.5.jar [INFO] Plugin Dependency Resolved: maven-aether-provider-3.0.jar [INFO] Plugin Dependency Resolved: plexus-build-api-0.0.7.jar [INFO] Plugin Dependency Resolved: maven-settings-3.0.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.24.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-3.0.jar [INFO] Plugin Dependency Resolved: maven-settings-builder-3.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-bean-1.4.2.jar [INFO] Plugin Dependency Resolved: aether-util-1.7.jar [INFO] Plugin Dependency Resolved: maven-core-3.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-plexus-1.4.2.jar [INFO] Plugin Dependency Resolved: maven-model-3.0.jar [INFO] Plugin Dependency Resolved: maven-artifact-3.0.jar [INFO] Plugin Dependency Resolved: plexus-classworlds-2.2.3.jar [INFO] Plugin Dependency Resolved: maven-resources-plugin-3.0.2.jar [INFO] Plugin Dependency Resolved: maven-model-builder-3.0.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-3.0.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.6.jar [INFO] Plugin Dependency Resolved: maven-shared-utils-3.0.0.jar [INFO] Plugin Dependency Resolved: aether-spi-1.7.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: aether-api-1.7.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.24.jar [INFO] Plugin Dependency Resolved: maven-filtering-3.1.1.jar [INFO] Plugin Dependency Resolved: sisu-guice-2.1.7-noaop.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: aether-impl-1.7.jar [INFO] Plugin Resolved: maven-localizer-plugin-1.24.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.0.1.jar [INFO] Plugin Dependency Resolved: ant-launcher-1.7.0.jar [INFO] Plugin Dependency Resolved: plexus-utils-1.0.4.jar [INFO] Plugin Dependency Resolved: localizer-1.24.jar [INFO] Plugin Dependency Resolved: maven-project-2.0.1.jar [INFO] Plugin Dependency Resolved: ant-1.7.0.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.0.1.jar [INFO] Plugin Dependency Resolved: annotation-indexer-1.4.jar [INFO] Plugin Dependency Resolved: maven-model-2.0.1.jar [INFO] Plugin Dependency Resolved: maven-archiver-2.0.1.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.0.1.jar [INFO] Plugin Dependency Resolved: classworlds-1.1-alpha-2.jar [INFO] Plugin Dependency Resolved: junit-3.8.1.jar [INFO] Plugin Dependency Resolved: plexus-archiver-1.0-alpha-4.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.0.1.jar [INFO] Plugin Dependency Resolved: access-modifier-annotation-1.4.jar [INFO] Plugin Dependency Resolved: maven-profile-2.0.1.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: maven-localizer-plugin-1.24.jar [INFO] Plugin Dependency Resolved: codemodel-2.6.jar [INFO] Plugin Dependency Resolved: commons-lang3-3.1.jar [INFO] Plugin Resolved: maven-deploy-plugin-2.8.2.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-profile-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-settings-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.2.1.jar [INFO] Plugin Dependency Resolved: classworlds-1.1-alpha-2.jar [INFO] Plugin Dependency Resolved: junit-3.8.1.jar [INFO] Plugin Dependency Resolved: maven-model-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-project-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.15.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.11.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.2.1.jar [INFO] Plugin Dependency Resolved: backport-util-concurrent-3.1.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9-stable-1.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-deploy-plugin-2.8.2.jar [INFO] Plugin Resolved: gmaven-plugin-1.5-jenkins-3.jar [INFO] Plugin Dependency Resolved: xbean-reflect-3.4.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.1.jar [INFO] Plugin Dependency Resolved: plexus-velocity-1.1.7.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.jar [INFO] Plugin Dependency Resolved: file-management-1.2.1.jar [INFO] Plugin Dependency Resolved: google-collections-1.0.jar [INFO] Plugin Dependency Resolved: xml-apis-1.0.b2.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.0.10.jar [INFO] Plugin Dependency Resolved: gmaven-runtime-loader-1.5-jenkins-3.jar [INFO] Plugin Dependency Resolved: velocity-1.5.jar [INFO] Plugin Dependency Resolved: slf4j-api-1.5.10.jar [INFO] Plugin Dependency Resolved: maven-reporting-impl-2.0.4.1.jar [INFO] Plugin Dependency Resolved: doxia-site-renderer-1.0-alpha-10.jar [INFO] Plugin Dependency Resolved: gshell-io-2.4.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-2.0.4.jar [INFO] Plugin Dependency Resolved: gmaven-feature-support-1.5-jenkins-3.jar [INFO] Plugin Dependency Resolved: maven-settings-2.0.10.jar [INFO] Plugin Dependency Resolved: commons-collections-3.2.jar [INFO] Plugin Dependency Resolved: doxia-module-xhtml-1.0-alpha-10.jar [INFO] Plugin Dependency Resolved: gmaven-plugin-1.5-jenkins-3.jar [INFO] Plugin Dependency Resolved: commons-beanutils-1.7.0.jar [INFO] Plugin Dependency Resolved: commons-logging-1.0.4.jar [INFO] Plugin Dependency Resolved: commons-lang-2.6.jar [INFO] Plugin Dependency Resolved: plexus-classworlds-2.4.jar [INFO] Plugin Dependency Resolved: qdox-1.12.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.0.10.jar [INFO] Plugin Dependency Resolved: maven-project-2.0.10.jar [INFO] Plugin Dependency Resolved: plexus-i18n-1.0-beta-7.jar [INFO] Plugin Dependency Resolved: log4j-1.2.12.jar [INFO] Plugin Dependency Resolved: doxia-core-1.0-alpha-10.jar [INFO] Plugin Dependency Resolved: maven-plugin-descriptor-2.0.10.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.5.5.jar [INFO] Plugin Dependency Resolved: maven-profile-2.0.10.jar [INFO] Plugin Dependency Resolved: gmaven-runtime-api-1.5-jenkins-3.jar [INFO] Plugin Dependency Resolved: maven-shared-io-1.1.jar [INFO] Plugin Dependency Resolved: doxia-sink-api-1.0-alpha-10.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.0.2.jar [INFO] Plugin Dependency Resolved: commons-logging-api-1.1.jar [INFO] Plugin Dependency Resolved: gmaven-runtime-support-1.5-jenkins-3.jar [INFO] Plugin Dependency Resolved: doxia-module-fml-1.0-alpha-10.jar [INFO] Plugin Dependency Resolved: gmaven-feature-api-1.5-jenkins-3.jar [INFO] Plugin Dependency Resolved: maven-model-2.0.10.jar [INFO] Plugin Dependency Resolved: commons-validator-1.2.0.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.0.2.jar [INFO] Plugin Dependency Resolved: gossip-1.2.jar [INFO] Plugin Dependency Resolved: oro-2.0.8.jar [INFO] Plugin Dependency Resolved: doxia-decoration-model-1.0-alpha-10.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.0.10.jar [INFO] Plugin Dependency Resolved: doxia-module-apt-1.0-alpha-10.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-alpha-6.jar [INFO] Plugin Dependency Resolved: commons-digester-1.6.jar [INFO] Plugin Dependency Resolved: doxia-module-xdoc-1.0-alpha-10.jar [INFO] Plugin Resolved: frontend-maven-plugin-1.6.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-3.1.0.jar [INFO] Plugin Dependency Resolved: plexus-build-api-0.0.7.jar [INFO] Plugin Dependency Resolved: jsr305-1.3.9.jar [INFO] Plugin Dependency Resolved: aopalliance-1.0.jar [INFO] Plugin Dependency Resolved: xz-1.2.jar [INFO] Plugin Dependency Resolved: sisu-guice-3.1.0-no_aop.jar [INFO] Plugin Dependency Resolved: frontend-maven-plugin-1.6.jar [INFO] Plugin Dependency Resolved: plexus-classworlds-2.4.jar [INFO] Plugin Dependency Resolved: guava-10.0.1.jar [INFO] Plugin Dependency Resolved: org.eclipse.sisu.inject-0.0.0.M2a.jar [INFO] Plugin Dependency Resolved: commons-exec-1.3.jar [INFO] Plugin Dependency Resolved: httpcore-4.4.3.jar [INFO] Plugin Dependency Resolved: cdi-api-1.0.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.5.5.jar [INFO] Plugin Dependency Resolved: maven-model-3.1.0.jar [INFO] Plugin Dependency Resolved: frontend-plugin-core-1.6.jar [INFO] Plugin Dependency Resolved: javax.inject-1.jar [INFO] Plugin Dependency Resolved: jsr250-api-1.0.jar [INFO] Plugin Dependency Resolved: asm-3.3.1.jar [INFO] Plugin Dependency Resolved: jackson-mapper-asl-1.9.13.jar [INFO] Plugin Dependency Resolved: commons-codec-1.9.jar [INFO] Plugin Dependency Resolved: slf4j-api-1.7.5.jar [INFO] Plugin Dependency Resolved: commons-logging-1.2.jar [INFO] Plugin Dependency Resolved: maven-artifact-3.1.0.jar [INFO] Plugin Dependency Resolved: commons-io-1.3.2.jar [INFO] Plugin Dependency Resolved: jackson-core-asl-1.9.13.jar [INFO] Plugin Dependency Resolved: maven-plugin-annotations-3.2.jar [INFO] Plugin Dependency Resolved: httpclient-4.5.1.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.22.jar [INFO] Plugin Dependency Resolved: commons-compress-1.5.jar [INFO] Plugin Dependency Resolved: org.eclipse.sisu.plexus-0.0.0.M2a.jar [INFO] Plugin Resolved: animal-sniffer-maven-plugin-1.15.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-error-diagnostics-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-settings-2.2.1.jar [INFO] Plugin Dependency Resolved: slf4j-api-1.5.6.jar [INFO] Plugin Dependency Resolved: jackrabbit-webdav-1.5.0.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-toolchain-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-ssh-external-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-project-2.2.1.jar [INFO] Plugin Dependency Resolved: commons-codec-1.2.jar [INFO] Plugin Dependency Resolved: plexus-utils-1.5.6.jar [INFO] Plugin Dependency Resolved: jcl-over-slf4j-1.5.6.jar [INFO] Plugin Dependency Resolved: doxia-sink-api-1.1.jar [INFO] Plugin Dependency Resolved: maven-monitor-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-http-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: wagon-file-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: hamcrest-core-1.3.jar [INFO] Plugin Dependency Resolved: xercesMinimal-1.9.6.2.jar [INFO] Plugin Dependency Resolved: java-boot-classpath-detector-1.15.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.11.jar [INFO] Plugin Dependency Resolved: wagon-http-lightweight-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9-stable-1.jar [INFO] Plugin Dependency Resolved: animal-sniffer-1.15.jar [INFO] Plugin Dependency Resolved: asm-all-5.0.3.jar [INFO] Plugin Dependency Resolved: jsch-0.1.38.jar [INFO] Plugin Dependency Resolved: jackrabbit-jcr-commons-1.5.0.jar [INFO] Plugin Dependency Resolved: classworlds-1.1.jar [INFO] Plugin Dependency Resolved: junit-4.11.jar [INFO] Plugin Dependency Resolved: nekohtml-1.9.6.2.jar [INFO] Plugin Dependency Resolved: wagon-ssh-common-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-core-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-interactivity-api-1.0-alpha-4.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-webdav-jackrabbit-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: commons-httpclient-3.0.jar [INFO] Plugin Dependency Resolved: commons-cli-1.2.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-descriptor-2.2.1.jar [INFO] Plugin Dependency Resolved: slf4j-nop-1.5.3.jar [INFO] Plugin Dependency Resolved: maven-profile-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-parameter-documenter-2.2.1.jar [INFO] Plugin Dependency Resolved: animal-sniffer-maven-plugin-1.15.jar [INFO] Plugin Dependency Resolved: maven-model-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-common-artifact-filters-1.4.jar [INFO] Plugin Dependency Resolved: wagon-ssh-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: doxia-logging-api-1.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.2.1.jar [INFO] Plugin Dependency Resolved: backport-util-concurrent-3.1.jar [INFO] Plugin Dependency Resolved: slf4j-jdk14-1.5.6.jar [INFO] Plugin Dependency Resolved: wagon-http-shared-1.0-beta-6.jar [INFO] Plugin Resolved: maven-license-plugin-1.7.jar [INFO] Plugin Dependency Resolved: jsch-0.1.23.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-8.jar [INFO] Plugin Dependency Resolved: maven-profile-2.0.jar [INFO] Plugin Dependency Resolved: maven-plugin-descriptor-2.0.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.0.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.0.jar [INFO] Plugin Dependency Resolved: jline-0.9.94.jar [INFO] Plugin Dependency Resolved: plexus-utils-1.0.4.jar [INFO] Plugin Dependency Resolved: asm-tree-2.2.3.jar [INFO] Plugin Dependency Resolved: asm-analysis-2.2.3.jar [INFO] Plugin Dependency Resolved: maven-monitor-2.0.jar [INFO] Plugin Dependency Resolved: classworlds-1.1-alpha-2.jar [INFO] Plugin Dependency Resolved: maven-model-2.0.jar [INFO] Plugin Dependency Resolved: commons-cli-1.0.jar [INFO] Plugin Dependency Resolved: plexus-interactivity-api-1.0-alpha-4.jar [INFO] Plugin Dependency Resolved: antlr-2.7.7.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: doxia-sink-api-1.0-alpha-4.jar [INFO] Plugin Dependency Resolved: maven-error-diagnostics-2.0.jar [INFO] Plugin Dependency Resolved: maven-settings-2.0.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.0.jar [INFO] Plugin Dependency Resolved: asm-2.2.3.jar [INFO] Plugin Dependency Resolved: ant-1.7.1.jar [INFO] Plugin Dependency Resolved: wagon-file-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: ant-launcher-1.7.1.jar [INFO] Plugin Dependency Resolved: junit-3.8.2.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.0.jar [INFO] Plugin Dependency Resolved: maven-core-2.0.jar [INFO] Plugin Dependency Resolved: wagon-http-lightweight-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: wagon-ssh-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: asm-util-2.2.3.jar [INFO] Plugin Dependency Resolved: maven-license-plugin-1.7.jar [INFO] Plugin Dependency Resolved: maven-project-2.0.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.0.jar [INFO] Plugin Dependency Resolved: groovy-1.6.5.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-2.0.jar [INFO] Plugin Dependency Resolved: maven-plugin-parameter-documenter-2.0.jar [INFO] Plugin Resolved: findbugs-maven-plugin-3.0.5.jar [INFO] Plugin Dependency Resolved: jcip-annotations-1.0.jar [INFO] Plugin Dependency Resolved: groovy-2.4.12.jar [INFO] Plugin Dependency Resolved: groovy-xml-2.4.12.jar [INFO] Plugin Dependency Resolved: org.eclipse.sisu.inject-0.3.3.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.2.1.jar [INFO] Plugin Dependency Resolved: doxia-skin-model-1.7.jar [INFO] Plugin Dependency Resolved: velocity-tools-2.0.jar [INFO] Plugin Dependency Resolved: struts-tiles-1.3.8.jar [INFO] Plugin Dependency Resolved: ant-junit-1.9.4.jar [INFO] Plugin Dependency Resolved: maven-reporting-impl-3.0.0.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-3.0.jar [INFO] Plugin Dependency Resolved: cdi-api-1.0.jar [INFO] Plugin Dependency Resolved: sslext-1.2-0.jar [INFO] Plugin Dependency Resolved: asm-5.0.2.jar [INFO] Plugin Dependency Resolved: maven-resolver-spi-1.0.3.jar [INFO] Plugin Dependency Resolved: maven-artifact-3.5.0.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-3.0.jar [INFO] Plugin Dependency Resolved: maven-compat-3.5.0.jar [INFO] Plugin Dependency Resolved: jsr250-api-1.0.jar [INFO] Plugin Dependency Resolved: commons-logging-1.1.1.jar [INFO] Plugin Dependency Resolved: aether-api-1.7.jar [INFO] Plugin Dependency Resolved: commons-lang3-3.5.jar [INFO] Plugin Dependency Resolved: maven-resolver-util-1.0.3.jar [INFO] Plugin Dependency Resolved: guava-20.0.jar [INFO] Plugin Dependency Resolved: sisu-guice-2.1.7-noaop.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.1.0.jar [INFO] Plugin Dependency Resolved: asm-commons-5.0.2.jar [INFO] Plugin Dependency Resolved: asm-tree-5.0.2.jar [INFO] Plugin Dependency Resolved: groovy-ant-2.4.12.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: maven-resolver-impl-1.0.3.jar [INFO] Plugin Dependency Resolved: dom4j-1.6.1.jar [INFO] Plugin Dependency Resolved: plexus-classworlds-2.5.1.jar [INFO] Plugin Dependency Resolved: maven-aether-provider-3.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-bean-1.4.2.jar [INFO] Plugin Dependency Resolved: commons-codec-1.3.jar [INFO] Plugin Dependency Resolved: struts-core-1.3.8.jar [INFO] Plugin Dependency Resolved: commons-lang-2.6.jar [INFO] Plugin Dependency Resolved: antlr-2.7.2.jar [INFO] Plugin Dependency Resolved: commons-chain-1.1.jar [INFO] Plugin Dependency Resolved: doxia-module-fml-1.7.jar [INFO] Plugin Dependency Resolved: ant-1.9.9.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.7.1.jar [INFO] Plugin Dependency Resolved: javax.inject-1.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-2.12.jar [INFO] Plugin Dependency Resolved: asm-debug-all-5.0.2.jar [INFO] Plugin Dependency Resolved: maven-settings-3.5.0.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-3.5.0.jar [INFO] Plugin Dependency Resolved: groovy-groovydoc-2.4.12.jar [INFO] Plugin Dependency Resolved: doxia-decoration-model-1.7.jar [INFO] Plugin Dependency Resolved: maven-resolver-provider-3.5.0.jar [INFO] Plugin Dependency Resolved: oro-2.0.8.jar [INFO] Plugin Dependency Resolved: aether-impl-1.7.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.2.1.jar [INFO] Plugin Dependency Resolved: jaxen-1.1.6.jar [INFO] Plugin Dependency Resolved: jsr305-2.0.1.jar [INFO] Plugin Dependency Resolved: findbugs-maven-plugin-3.0.5.jar [INFO] Plugin Dependency Resolved: maven-builder-support-3.5.0.jar [INFO] Plugin Dependency Resolved: maven-settings-builder-3.0.jar [INFO] Plugin Dependency Resolved: findbugs-3.0.1.jar [INFO] Plugin Dependency Resolved: aether-util-1.7.jar [INFO] Plugin Dependency Resolved: maven-core-3.0.jar [INFO] Plugin Dependency Resolved: plexus-velocity-1.1.7.jar [INFO] Plugin Dependency Resolved: struts-taglib-1.3.8.jar [INFO] Plugin Dependency Resolved: google-collections-1.0.jar [INFO] Plugin Dependency Resolved: xml-apis-1.0.b2.jar [INFO] Plugin Dependency Resolved: plexus-resources-1.1.0.jar [INFO] Plugin Dependency Resolved: maven-project-2.2.1.jar [INFO] Plugin Dependency Resolved: jFormatString-2.0.1.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.7.1.jar [INFO] Plugin Dependency Resolved: maven-model-builder-3.5.0.jar [INFO] Plugin Dependency Resolved: doxia-core-1.7.jar [INFO] Plugin Dependency Resolved: xmlunit-1.5.jar [INFO] Plugin Dependency Resolved: xbean-reflect-3.7.jar [INFO] Plugin Dependency Resolved: AppleJavaExtensions-1.4.jar [INFO] Plugin Dependency Resolved: maven-model-3.5.0.jar [INFO] Plugin Dependency Resolved: bcel-findbugs-6.0.jar [INFO] Plugin Dependency Resolved: plexus-build-api-0.0.7.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.24.jar [INFO] Plugin Dependency Resolved: commons-digester-1.8.jar [INFO] Plugin Dependency Resolved: commons-io-1.4.jar [INFO] Plugin Dependency Resolved: sisu-inject-plexus-1.4.2.jar [INFO] Plugin Dependency Resolved: commons-beanutils-1.7.0.jar [INFO] Plugin Dependency Resolved: commons-collections-3.2.1.jar [INFO] Plugin Dependency Resolved: groovy-templates-2.4.12.jar [INFO] Plugin Dependency Resolved: httpclient-4.0.2.jar [INFO] Plugin Dependency Resolved: doxia-site-renderer-1.7.jar [INFO] Plugin Dependency Resolved: org.eclipse.sisu.plexus-0.3.3.jar [INFO] Plugin Dependency Resolved: maven-resolver-api-1.0.3.jar [INFO] Plugin Dependency Resolved: ant-launcher-1.9.9.jar [INFO] Plugin Dependency Resolved: plexus-i18n-1.0-beta-7.jar [INFO] Plugin Dependency Resolved: maven-shared-utils-3.2.0.jar [INFO] Plugin Dependency Resolved: doxia-logging-api-1.7.jar [INFO] Plugin Dependency Resolved: ant-antlr-1.9.4.jar [INFO] Plugin Dependency Resolved: aether-spi-1.7.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: maven-profile-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-doxia-tools-1.4.jar [INFO] Plugin Dependency Resolved: doxia-module-xhtml-1.7.jar [INFO] Plugin Dependency Resolved: httpcore-4.0.1.jar [INFO] Plugin Dependency Resolved: commons-validator-1.3.1.jar [INFO] Plugin Dependency Resolved: backport-util-concurrent-3.1.jar [INFO] Plugin Dependency Resolved: doxia-sink-api-1.7.jar [INFO] Plugin Dependency Resolved: velocity-1.7.jar [INFO] Plugin Resolved: maven-enforcer-plugin-3.0.0-M1.jar [INFO] Plugin Dependency Resolved: maven-shared-utils-3.1.0.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: commons-io-2.5.jar [INFO] Plugin Dependency Resolved: maven-compat-3.0.jar [INFO] Plugin Dependency Resolved: maven-aether-provider-3.0.jar [INFO] Plugin Dependency Resolved: maven-settings-3.0.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-3.0.jar [INFO] Plugin Dependency Resolved: maven-settings-builder-3.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-bean-1.4.2.jar [INFO] Plugin Dependency Resolved: aether-util-1.7.jar [INFO] Plugin Dependency Resolved: maven-core-3.0.jar [INFO] Plugin Dependency Resolved: maven-model-3.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-plexus-1.4.2.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.14.jar [INFO] Plugin Dependency Resolved: bsh-2.0b4.jar [INFO] Plugin Dependency Resolved: maven-artifact-3.0.jar [INFO] Plugin Dependency Resolved: junit-4.11.jar [INFO] Plugin Dependency Resolved: classworlds-1.1-alpha-2.jar [INFO] Plugin Dependency Resolved: maven-dependency-tree-2.2.jar [INFO] Plugin Dependency Resolved: plexus-classworlds-2.2.3.jar [INFO] Plugin Dependency Resolved: maven-model-builder-3.0.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-3.0.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.6.jar [INFO] Plugin Dependency Resolved: maven-enforcer-plugin-3.0.0-M1.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9.jar [INFO] Plugin Dependency Resolved: aether-spi-1.7.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: hamcrest-core-1.3.jar [INFO] Plugin Dependency Resolved: aether-api-1.7.jar [INFO] Plugin Dependency Resolved: commons-lang3-3.5.jar [INFO] Plugin Dependency Resolved: maven-common-artifact-filters-3.0.1.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.24.jar [INFO] Plugin Dependency Resolved: enforcer-rules-3.0.0-M1.jar [INFO] Plugin Dependency Resolved: sisu-guice-2.1.7-noaop.jar [INFO] Plugin Dependency Resolved: aether-util-0.9.0.M2.jar [INFO] Plugin Dependency Resolved: enforcer-api-3.0.0-M1.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: aether-impl-1.7.jar [INFO] Plugin Dependency Resolved: commons-codec-1.6.jar [INFO] Plugin Resolved: maven-eclipse-plugin-2.10.jar [INFO] Plugin Dependency Resolved: maven-error-diagnostics-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-settings-2.2.1.jar [INFO] Plugin Dependency Resolved: slf4j-api-1.5.6.jar [INFO] Plugin Dependency Resolved: commons-compress-1.8.1.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.2.1.jar [INFO] Plugin Dependency Resolved: jackrabbit-webdav-1.5.0.jar [INFO] Plugin Dependency Resolved: maven-project-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-ssh-external-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: commons-codec-1.2.jar [INFO] Plugin Dependency Resolved: jcl-over-slf4j-1.5.6.jar [INFO] Plugin Dependency Resolved: doxia-sink-api-1.1.jar [INFO] Plugin Dependency Resolved: maven-monitor-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-http-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-2.1.jar [INFO] Plugin Dependency Resolved: wagon-file-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: xercesMinimal-1.9.6.2.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.20.jar [INFO] Plugin Dependency Resolved: maven-archiver-2.5.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.11.jar [INFO] Plugin Dependency Resolved: wagon-http-lightweight-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9-stable-1.jar [INFO] Plugin Dependency Resolved: plexus-resources-1.0-alpha-7.jar [INFO] Plugin Dependency Resolved: jsch-0.1.38.jar [INFO] Plugin Dependency Resolved: jackrabbit-jcr-commons-1.5.0.jar [INFO] Plugin Dependency Resolved: classworlds-1.1.jar [INFO] Plugin Dependency Resolved: plexus-interactivity-jline-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: nekohtml-1.9.6.2.jar [INFO] Plugin Dependency Resolved: wagon-ssh-common-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: junit-3.8.1.jar [INFO] Plugin Dependency Resolved: maven-core-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-interactivity-api-1.0-alpha-4.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.2.1.jar [INFO] Plugin Dependency Resolved: wagon-webdav-jackrabbit-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: commons-httpclient-3.0.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.2.1.jar [INFO] Plugin Dependency Resolved: commons-cli-1.2.jar [INFO] Plugin Dependency Resolved: maven-plugin-descriptor-2.2.1.jar [INFO] Plugin Dependency Resolved: slf4j-nop-1.5.3.jar [INFO] Plugin Dependency Resolved: plexus-io-2.1.3.jar [INFO] Plugin Dependency Resolved: maven-profile-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-parameter-documenter-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-archiver-2.6.3.jar [INFO] Plugin Dependency Resolved: commons-io-2.2.jar [INFO] Plugin Dependency Resolved: resources-3.3.0-v20070604.jar [INFO] Plugin Dependency Resolved: maven-model-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-eclipse-plugin-2.10.jar [INFO] Plugin Dependency Resolved: jline-0.9.1.jar [INFO] Plugin Dependency Resolved: wagon-ssh-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-osgi-0.2.0.jar [INFO] Plugin Dependency Resolved: doxia-logging-api-1.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.2.1.jar [INFO] Plugin Dependency Resolved: backport-util-concurrent-3.1.jar [INFO] Plugin Dependency Resolved: slf4j-jdk14-1.5.6.jar [INFO] Plugin Dependency Resolved: bndlib-0.0.145.jar [INFO] Plugin Dependency Resolved: wagon-http-shared-1.0-beta-6.jar [INFO] Plugin Resolved: maven-hpi-plugin-2.2.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: aether-util-1.11.jar [INFO] Plugin Dependency Resolved: maven-profile-2.2.0.jar [INFO] Plugin Dependency Resolved: sisu-inject-plexus-2.1.1.jar [INFO] Plugin Dependency Resolved: maven-dependency-plugin-2.8.jar [INFO] Plugin Dependency Resolved: json-lib-2.1-jdk15.jar [INFO] Plugin Dependency Resolved: maven-doxia-tools-1.0.2.jar [INFO] Plugin Dependency Resolved: ecj-4.4.2.jar [INFO] Plugin Dependency Resolved: maven-model-2.2.0.jar [INFO] Plugin Dependency Resolved: maven-reporting-api-3.0.jar [INFO] Plugin Dependency Resolved: websocket-api-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: stapler-groovy-1.237.jar [INFO] Plugin Dependency Resolved: jetty-jaas-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: maven-plugin-tools-api-3.4.jar [INFO] Plugin Dependency Resolved: asm-3.3.1.jar [INFO] Plugin Dependency Resolved: jetty-webapp-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: commons-fileupload-1.2.1.jar [INFO] Plugin Dependency Resolved: maven-settings-builder-3.0.3.jar [INFO] Plugin Dependency Resolved: websocket-client-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: javax.websocket-api-1.0.jar [INFO] Plugin Dependency Resolved: commons-io-1.3.1.jar [INFO] Plugin Dependency Resolved: maven-core-3.0.3.jar [INFO] Plugin Dependency Resolved: maven-reporting-impl-2.0.5.jar [INFO] Plugin Dependency Resolved: aether-util-0.9.0.M2.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.11.jar [INFO] Plugin Dependency Resolved: apache-el-8.5.9.1.jar [INFO] Plugin Dependency Resolved: jaxen-1.1.1.jar [INFO] Plugin Dependency Resolved: xom-1.0.jar [INFO] Plugin Dependency Resolved: plexus-cipher-1.4.jar [INFO] Plugin Dependency Resolved: jellydoc-annotations-1.5.jar [INFO] Plugin Dependency Resolved: dom4j-1.6.1.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9-stable-1.jar [INFO] Plugin Dependency Resolved: asm-tree-5.1.jar [INFO] Plugin Dependency Resolved: doxia-module-fml-1.0.jar [INFO] Plugin Dependency Resolved: javax-websocket-server-impl-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: doxia-module-xdoc-1.0.jar [INFO] Plugin Dependency Resolved: ant-1.6.5.jar [INFO] Plugin Dependency Resolved: xercesImpl-2.6.2.jar [INFO] Plugin Dependency Resolved: jetty-jndi-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: websocket-server-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: classworlds-1.1.jar [INFO] Plugin Dependency Resolved: commons-lang-2.6.jar [INFO] Plugin Dependency Resolved: junit-3.8.1.jar [INFO] Plugin Dependency Resolved: jetty-plus-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: groovy-all-1.8.3.jar [INFO] Plugin Dependency Resolved: localizer-1.7.jar [INFO] Plugin Dependency Resolved: guava-r06.jar [INFO] Plugin Dependency Resolved: ezmorph-1.0.3.jar [INFO] Plugin Dependency Resolved: maven-plugin-descriptor-2.2.1.jar [INFO] Plugin Dependency Resolved: aether-impl-1.11.jar [INFO] Plugin Dependency Resolved: stapler-1.100.jar [INFO] Plugin Dependency Resolved: maven-compiler-plugin-2.0.2.jar [INFO] Plugin Dependency Resolved: xalan-2.6.0.jar [INFO] Plugin Dependency Resolved: plexus-utils-1.0.2.jar [INFO] Plugin Dependency Resolved: javax.servlet-api-3.1.0.jar [INFO] Plugin Dependency Resolved: maven-shared-io-1.1.jar [INFO] Plugin Dependency Resolved: plexus-io-2.0.6.jar [INFO] Plugin Dependency Resolved: xmlParserAPIs-2.6.2.jar [INFO] Plugin Dependency Resolved: jetty-security-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: textile-j-2.2.864.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.1.jar [INFO] Plugin Dependency Resolved: maven-archiver-2.0.1.jar [INFO] Plugin Dependency Resolved: maven-aether-provider-3.0.3.jar [INFO] Plugin Dependency Resolved: plexus-compiler-api-1.5.3.jar [INFO] Plugin Dependency Resolved: plexus-compiler-manager-1.5.3.jar [INFO] Plugin Dependency Resolved: websocket-servlet-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: doxia-decoration-model-1.0.jar [INFO] Plugin Dependency Resolved: doxia-module-apt-1.0.jar [INFO] Plugin Dependency Resolved: taglibs-standard-impl-1.2.5.jar [INFO] Plugin Dependency Resolved: maven-stapler-plugin-1.16.jar [INFO] Plugin Dependency Resolved: oro-2.0.8.jar [INFO] Plugin Dependency Resolved: commons-jexl-1.1-jenkins-20111212.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.2.0.jar [INFO] Plugin Dependency Resolved: jetty-servlet-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: commons-digester-1.6.jar [INFO] Plugin Dependency Resolved: maven-jellydoc-plugin-1.5.jar [INFO] Plugin Dependency Resolved: txw2-20090102.jar [INFO] Plugin Dependency Resolved: apache-jsp-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: taglibs-standard-spec-1.2.5.jar [INFO] Plugin Dependency Resolved: jetty-quickstart-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: plexus-velocity-1.1.7.jar [INFO] Plugin Dependency Resolved: stapler-jelly-1.237.jar [INFO] Plugin Dependency Resolved: jetty-server-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: file-management-1.2.1.jar [INFO] Plugin Dependency Resolved: sisu-inject-bean-2.1.1.jar [INFO] Plugin Dependency Resolved: doxia-core-1.0.jar [INFO] Plugin Dependency Resolved: sezpoz-1.9.jar [INFO] Plugin Dependency Resolved: xml-apis-1.0.b2.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.2.0.jar [INFO] Plugin Dependency Resolved: jetty-http-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: maven-model-builder-3.0.3.jar [INFO] Plugin Dependency Resolved: plexus-component-annotations-1.6.jar [INFO] Plugin Dependency Resolved: apache-jsp-8.5.9.1.jar [INFO] Plugin Dependency Resolved: maven-invoker-2.0.11.jar [INFO] Plugin Dependency Resolved: asm-commons-5.1.jar [INFO] Plugin Dependency Resolved: metainf-services-1.2.jar [INFO] Plugin Dependency Resolved: icu4j-52.1.jar [INFO] Plugin Dependency Resolved: velocity-1.5.jar [INFO] Plugin Dependency Resolved: taglib-xml-writer-1.5.jar [INFO] Plugin Dependency Resolved: jetty-io-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: maven-hpi-plugin-2.2.jar [INFO] Plugin Dependency Resolved: commons-jelly-1.1-jenkins-20120928.jar [INFO] Plugin Dependency Resolved: jetty-xml-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: aether-api-1.11.jar [INFO] Plugin Dependency Resolved: maven-dependency-tree-2.1.jar [INFO] Plugin Dependency Resolved: websocket-common-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: commons-discovery-0.4.jar [INFO] Plugin Dependency Resolved: dom4j-1.6.1-jenkins-4.jar [INFO] Plugin Dependency Resolved: jdom-1.0.jar [INFO] Plugin Dependency Resolved: tiger-types-1.1.jar [INFO] Plugin Dependency Resolved: commons-beanutils-1.7.0.jar [INFO] Plugin Dependency Resolved: jetty-client-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.2.0.jar [INFO] Plugin Dependency Resolved: commons-logging-1.0.4.jar [INFO] Plugin Dependency Resolved: commons-collections-3.2.1.jar [INFO] Plugin Dependency Resolved: javax-websocket-client-impl-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: nekohtml-1.9.6.2.jar [INFO] Plugin Dependency Resolved: plexus-archiver-1.0-alpha-4.jar [INFO] Plugin Dependency Resolved: plexus-classworlds-2.4.jar [INFO] Plugin Dependency Resolved: jetty-util-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: jetty-annotations-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: jetty-schemas-3.1.jar [INFO] Plugin Dependency Resolved: plexus-interactivity-api-1.0-alpha-4.jar [INFO] Plugin Dependency Resolved: sisu-guice-2.9.4-no_aop.jar [INFO] Plugin Dependency Resolved: doxia-site-renderer-1.0.jar [INFO] Plugin Dependency Resolved: plexus-i18n-1.0-beta-7.jar [INFO] Plugin Dependency Resolved: javax.annotation-api-1.2.jar [INFO] Plugin Dependency Resolved: aether-spi-1.11.jar [INFO] Plugin Dependency Resolved: jetty-maven-plugin-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: plexus-sec-dispatcher-1.3.jar [INFO] Plugin Dependency Resolved: maven-settings-2.2.0.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.2.0.jar [INFO] Plugin Dependency Resolved: apache-jstl-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: qdox-1.6.1.jar [INFO] Plugin Dependency Resolved: javax.transaction-api-1.2.jar [INFO] Plugin Dependency Resolved: maven-project-2.2.0.jar [INFO] Plugin Dependency Resolved: jetty-jmx-9.4.5.v20170502.jar [INFO] Plugin Dependency Resolved: commons-validator-1.2.0.jar [INFO] Plugin Dependency Resolved: plexus-compiler-javac-1.5.3.jar [INFO] Plugin Dependency Resolved: maven-common-artifact-filters-1.4.jar [INFO] Plugin Dependency Resolved: doxia-sink-api-1.0.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.0.9.jar [INFO] Plugin Dependency Resolved: backport-util-concurrent-3.1.jar [INFO] Plugin Dependency Resolved: asm-5.1.jar [INFO] Plugin Dependency Resolved: codemodel-2.6.jar [INFO] Plugin Dependency Resolved: doxia-module-xhtml-1.0.jar [INFO] Plugin Dependency Resolved: maven-dependency-analyzer-1.4.jar [INFO] Plugin Resolved: maven-install-plugin-2.5.2.jar [INFO] Plugin Dependency Resolved: jsr305-2.0.1.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-beta-6.jar [INFO] Plugin Dependency Resolved: maven-shared-utils-0.4.jar [INFO] Plugin Dependency Resolved: maven-profile-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-settings-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-install-plugin-2.5.2.jar [INFO] Plugin Dependency Resolved: classworlds-1.1-alpha-2.jar [INFO] Plugin Dependency Resolved: junit-3.8.1.jar [INFO] Plugin Dependency Resolved: maven-model-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-project-2.2.1.jar [INFO] Plugin Dependency Resolved: plexus-utils-3.0.15.jar [INFO] Plugin Dependency Resolved: plexus-interpolation-1.11.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.2.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-registry-2.2.1.jar [INFO] Plugin Dependency Resolved: commons-codec-1.6.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9-stable-1.jar [INFO] Plugin Dependency Resolved: backport-util-concurrent-3.1.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.2.1.jar [INFO] Plugin Resolved: access-modifier-checker-1.8.jar [INFO] Plugin Dependency Resolved: plexus-container-default-1.0-alpha-9.jar [INFO] Plugin Dependency Resolved: maven-artifact-manager-2.0.1.jar [INFO] Plugin Dependency Resolved: access-modifier-checker-1.8.jar [INFO] Plugin Dependency Resolved: maven-project-2.0.1.jar [INFO] Plugin Dependency Resolved: maven-plugin-api-2.0.1.jar [INFO] Plugin Dependency Resolved: metainf-services-1.1.jar [INFO] Plugin Dependency Resolved: annotation-indexer-1.4.jar [INFO] Plugin Dependency Resolved: maven-model-2.0.1.jar [INFO] Plugin Dependency Resolved: maven-repository-metadata-2.0.1.jar [INFO] Plugin Dependency Resolved: classworlds-1.1-alpha-2.jar [INFO] Plugin Dependency Resolved: junit-3.8.1.jar [INFO] Plugin Dependency Resolved: plexus-utils-1.0.5.jar [INFO] Plugin Dependency Resolved: maven-artifact-2.0.1.jar [INFO] Plugin Dependency Resolved: asm-debug-all-5.0.3.jar [INFO] Plugin Dependency Resolved: maven-profile-2.0.1.jar [INFO] Plugin Dependency Resolved: wagon-provider-api-1.0-alpha-5.jar [INFO] Plugin Dependency Resolved: access-modifier-annotation-1.8.jar [INFO] [INFO] Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/crumbIssuer.html":{"url":"jenkins/plugins/crumbIssuer.html","title":"crumbIssuer","keywords":"","body":" enables proxy compatibility on startup Improved CSRF protection working with session after 2.176.2 since SECURITY-626 enables proxy compatibility on startup -Djenkins.model.Jenkins.crumbIssuerProxyCompatibility=true temporary settings in Script:System.setProperty('jenkins.model.Jenkins.crumbIssuerProxyCompatibility', 'true') System.getProperty('jenkins.model.Jenkins.crumbIssuerProxyCompatibility') change in Configure Global Security Improved CSRF protection Upgrading to Jenkins 2.176.2 SECURITY-626 CSRF / tokens (crumbs) are now only valid for the web session they were created in to limit the impact of attackers obtaining them. Scripts that obtain a crumb using the /crumbIssuer/api URL will now fail to perform actions protected from CSRF unless the scripts retain the web session ID in subsequent requests. CSRF Protection Explained Scripts could instead use an API token, which has not required a CSRF token (crumb) since Jenkins 2.96. working with session after 2.176.2 since SECURITY-626 references: via curl via wget via curl [!TIP] check cookie $ cat ${COOKIEJAR} # Netscape HTTP Cookie File # https://curl.se/docs/http-cookies.html # This file was generated by libcurl! Edit at your own risk. #HttpOnly_jenkins.marslo.com.com FALSE / TRUE 0 JSESSIONID.a054fd7a node015xsx4fybmo2k1oxpjg5f2dzw4265.node0 SERVER=\"http://localhost:8080\" # File where web session cookie is saved COOKIEJAR=\"$(mktemp)\" CRUMB=$(curl -u \"admin:admin\" \\ --cookie-jar \"$COOKIEJAR\" \\ \"$SERVER/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,%22:%22,//crumb)\" \\ ) curl -X POST \\ -u \"admin:admin\" \\ --cookie \"$COOKIEJAR\" \\ -H \"$CRUMB\" \\ \"$SERVER\"/job/someJob/build via wget SERVER=\"http://localhost:8080\" # File where web session cookie is saved COOKIEJAR=\"$(mktemp)\" CRUMB=\"$(wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ --save-cookies \"$COOKIEJAR\" \\ --keep-session-cookies \\ -q \\ --output-document \\ - \\ \"$SERVER/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,%22:%22,//crumb)\" )\" wget --user=admin \\ --password=admin \\ --auth-no-challenge \\ --load-cookies \"$COOKIEJAR\" \\ --header=\"$CRUMB\" \\ --post-data=\"\" \\ -q \\ \"$SERVER\"/job/someJob/build example with crumb only will get issue 403: No valid crumb was included in the request $ curl -H ${crumb} \\ -X POST \\ https://jenkins.marslo.com/safeRestart Error 403 No valid crumb was included in the request HTTP ERROR 403 No valid crumb was included in the request URI:/safeRestart STATUS:403 MESSAGE:No valid crumb was included in the request SERVLET:Stapler Powered by Jetty:// 9.4.39.v20210325 with crumb and cookie $ COOKIEJAR=\"$(mktemp)\" $ CRUMB=\"$(curl -s \\ --cookie-jar \"${COOKIEJAR}\" \\ \"https://jenkins.marslo.com/crumbIssuer/api/json\" | jq -r '.crumbRequestField + \":\" + .crumb' )\" $ curl -v \\ -X POST \\ --cookie \"${COOKIEJAR}\" \\ -H \"${CRUMB}\" \\ https://jenkins.marslo.com/safeRestart ... * Connection state changed (MAX_CONCURRENT_STREAMS == 250)! To disable this improvement you can set the system property via JAVA_OPTS -Dhudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID=true temporary settings in Script: example for SECURITY-626 System.setProperty('hudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID', 'true') System.getProperty('hudson.security.csrf.DefaultCrumbIssuer.EXCLUDE_SESSION_ID') via plugin Strict Crumb Issuer get crumberIssuer with script import org.jenkinsci.plugins.strictcrumbissuer.StrictCrumbIssuer StrictCrumbIssuer issuer = jenkins.model.Jenkins.instance.crumbIssuer String jenkinsCrumb = \"${issuer.crumbRequestField}:${issuer.crumb}\" println jenkinsCrumb Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:23 "},"jenkins/plugins/tricky.html":{"url":"jenkins/plugins/tricky.html","title":"tricky","keywords":"","body":" downgrade jsch downgrade jsch [!NOTE] JENKINS-71273: Gerrit Trigger fails to connect Gerrit 2.14 - com.jcraft.jsch.JSchException: verify: false Nicola Beghin Public key authentication fails with JSch but work with OpenSSH with the same key api org.jenkinsci.plugins.jsch.JSchConnector Package com.jcraft.jsch com.jcraft.jsch.Session com.jcraft.jsch.KeyExchange com.jcraft.jsch.OpenSSHConfig references: Java JSch Example to run Shell Commands on SSH Unix Server Best Java code snippets using com.jcraft.jsch.JSch Java SSH connect with key using JSch - Auth Failed JSCH: SFTP. Hangs at session.connect() using the port 21 Creating JSch HostKey instance from a public key in .pub format $ curl -O https://repo1.maven.org/maven2/com/github/mwiede/jsch/0.2.7/jsch-0.2.7.jar $ docker cp jsch-0.2.7.jar e6cd5d7516cd:/var/jenkins_home/plugins/jsch/WEB-INF/lib/jsch-0.1.55.jar # ^ # Docker Container ID import org.jenkinsci.plugins.jsch.JSchConnector import java.io.InputStream import com.jcraft.jsch.JSch import com.jcraft.jsch.Session import com.jcraft.jsch.LocalIdentityRepository import com.jcraft.jsch.Channel import com.jcraft.jsch.ChannelExec String user = 'srv-ssd-fw-devops' String host = 'sample.gerrit.com' int port = 29418 String path = System.getProperty( 'user.home' ) + '/.ssh/ed25519/devops@ssdfw' // Byte[] privateKey = ''.getBytes() JSch jsch = new JSchConnector( user, host, port ).getJSch() jsch.addIdentity( path ) Session session = jsch.getSession( user, host, port ) session.setConfig( 'StrictHostKeyChecking', 'no' ) session.setConfig( 'HostkeyAlgorithms', '+ssh-rsa' ) session.setConfig( 'PreferredAuthentications', 'publickey' ) println \"\"\" ${session.getClass()}: session client version : ${session.getClientVersion()} : ${session.clientVersion} session host : ${session.getHost()} : ${session.host} session port : ${session.getPort()} : ${session.port} session hostkey : ${session.getHostKey()} : ${session.hostKey} session hostkey alias : ${session.getHostKeyAlias()} : ${session.hostKeyAlias} session isConnected : ${session.isConnected()} \"\"\" def knowHosts = session.getHostKeyRepository() println \"\"\" ${knowHosts.getClass()}: knownHosts host key : ${knowHosts.getHostKey( host, 'ssh-rsa' )} knowHosts repository id : ${knowHosts.getKnownHostsRepositoryID()} \"\"\" def idRepo = jsch.getIdentityRepository() println \"\"\" ${idRepo.getClass()} : identityRepository name : ${idRepo.getName()} : ${idRepo.name} identityRepository status : ${idRepo.getStatus()} : ${idRepo.status} identityRepository identities : ${idRepo.getIdentities()} : ${idRepo.identities} \"\"\" session.connect() revert sudo cp -rp /jenkins/DEVOPS-JENKINS/plugins/jsch* . sudo cp -rp /jenkins/DEVOPS-JENKINS/plugins/gerrit* . sudo cp -rp /jenkins/DEVOPS-JENKINS/plugins/maven-plugin* . sudo cp -rp /jenkins/DEVOPS-JENKINS/plugins/mercuri* . sudo cp -rp /jenkins/DEVOPS-JENKINS/plugins/ivy* . sudo cp -rp /jenkins/DEVOPS-JENKINS/plugins/artifactory* . sudo cp -rp /jenkins/DEVOPS-JENKINS/plugins/bitbucket* Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:10:10 "},"virtualization/virtualization.html":{"url":"virtualization/virtualization.html","title":"virtualization","keywords":"","body":" SSL Certificate Adding trusted root certificates to the server references: Checking Kubernetes pod CPU and memory Bulk deletion of Kubernetes resources SSL Certificate Adding trusted root certificates to the server MacOS add $ sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/new-root-certificate.crt remove $ sudo security delete-certificate -c \"\" Ubuntu add $ cp ca.crt /usr/local/share/ca-certificates/ $ sudo cp foo.crt /usr/local/share/ca-certificates/foo.crt $ sudo update-ca-certificates remove $ sudo rm -rf /usr/local/share/ca-certificates/ca.crt $ sudo rm -rf /usr/local/share/ca-certificates/foo.crt $ sudo update-ca-certificates --fresh CentOS 6 add$ sudo yum install -y ca-certificates $ sudo update-ca-trust force-enable $ sudo cp foo.crt /etc/pki/ca-trust/source/anchors/ $ update-ca-trust extract CentOS 5 add$ cat foo.crt >>/etc/pki/tls/certs/ca-bundle.crt Windows add $ certutil -addstore -f \"ROOT\" new-root-certificate.crt remove $ certutil -delstore \"ROOT\" serial-number-hex Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"virtualization/kubernetes/kubernetes.html":{"url":"virtualization/kubernetes/kubernetes.html","title":"kubernetes","keywords":"","body":" Core design principles Constants and well-known values and paths /etc/kubernetes/manifests /etc/kubernetes names of certificates and key files API server static Pod manifest other api server flags controller manager static Pod manifest other flags ports and protocols contol plane worker node(s) architecture control pannel kube-apiserver etcd kube-scheduler controller manager ccm : cloud controller manager work node kubelet kube proxy cri-o : container runtime jsonpath options explain kubectl alias __start_kubectl _complete_alias token check token generate token tear down [!TIP] kubernetes.io add /_print as suffix in the url, it will show pages into one page i.e.: https://kubernetes.io/docs/setup/best-practices/ https://kubernetes.io/docs/setup/best-practices/_print/ reference * Play with Kubernetes * Glossary * Install Kubernetes Cluster on Centos 8 With Kubeadm and CRI-O * 在 CentOS 上部署 Kubernetes 集群 * Kubernetes 中文指南/云原生应用架构实战手册 * Create static Pods * Implementation details * Scheduling, Preemption and Eviction * Resource Management for Pods and Containers * Administer a Cluster * Kubernetes概念辨析 * Step by step installation of 3-nodes Kubernetes Cluster on CentOS 8 * KUBERNETES INSTALLATION ON CENTOS 8 * Reference > Configuration APIs KUBERNETES: AN OVERVIEW What Is Kubernetes: A Container Orchestration Platform KUBERNETES, OPEN-SOURCE CONTAINER ORCHESTRATION TECHNOLOGY Boosting your kubectl productivity 23 Advanced kubectl commands 8 Kubernetes Tips and Tricks Linux namespace简介 Well-Known Labels, Annotations and Taints * best practices 12 Kubernetes Configuration Best Practices Best Kubernetes Certifications for 2023 [Ranked] Important Kubernetes Cluster Configurations Kubernetes Architecture Kubernetes Architecture Explained [Comprehensive Guide] * How to Access Kubernetes API Server Kubernetes（k8s）基础概念介绍 Migrating a cluster from flannel to Calico resources: Free Kubernetes Ebook: Kubernetes up and running How to Learn Kubernetes (Complete Roadmap & Resources) kelseyhightower/kubernetes-the-hard-way * Kubernetes Tutorials For Beginners: 43 Comprehensive Guides * How to Setup Jenkins Build Agents on Kubernetes Pods Kubernetes Learning Resources Kubernetes Documentation/Tasks Core design principles Constants and well-known values and paths /etc/kubernetes/manifests [!TIP] /etc/kubernetes/manifests as the path where kubelet should look for static Pod manifests. Names of static Pod manifests are: etcd.yaml kube-apiserver.yaml kube-controller-manager.yaml kube-scheduler.yaml /etc/kubernetes [!TIP] Important Kubernetes Cluster Configurations /etc/kubernetes/ as the path where kubeconfig files with identities for control plane components are stored. Names of kubeconfig files are: kubelet.conf (bootstrap-kubelet.conf during TLS bootstrap) controller-manager.conf scheduler.conf admin.conf for the cluster admin and kubeadm itself names of certificates and key files [!TIP] ca.crt, ca.key for the Kubernetes certificate authority apiserver.crt, apiserver.key for the API server certificate apiserver-kubelet-client.crt, apiserver-kubelet-client.key for the client certificate used by the API server to connect to the kubelets securely sa.pub, sa.key for the key used by the controller manager when signing ServiceAccount front-proxy-ca.crt, front-proxy-ca.key for the front proxy certificate authority front-proxy-client.crt, front-proxy-client.key for the front proxy client API server static Pod manifest [!TIP] apiserver-advertise-address and apiserver-bind-port to bind to; if not provided, those value defaults to the IP address of the default network interface on the machine and port 6443 service-cluster-ip-range to use for services If an external etcd server is specified, the etcd-servers address and related TLS settings (etcd-cafile, etcd-certfile, etcd-keyfile); if an external etcd server is not be provided, a local etcd will be used ( via host network ) If a cloud provider is specified, the corresponding --cloud-provider is configured, together with the --cloud-config path if such file exists (this is experimental, alpha and will be removed in a future version) other api server flags --insecure-port=0 to avoid insecure connections to the api server --enable-bootstrap-token-auth=true to enable the BootstrapTokenAuthenticator authentication module. See TLS Bootstrapping for more details --allow-privileged to true (required e.g. by kube proxy) --requestheader-client-ca-file to front-proxy-ca.crt --enable-admission-plugins to: NamespaceLifecycle e.g. to avoid deletion of system reserved namespaces LimitRanger and ResourceQuota to enforce limits on namespaces ServiceAccount to enforce service account automation PersistentVolumeLabel attaches region or zone labels to PersistentVolumes as defined by the cloud provider (This admission controller is deprecated and will be removed in a future version. It is not deployed by kubeadm by default with v1.9 onwards when not explicitly opting into using gce or aws as cloud providers) DefaultStorageClass to enforce default storage class on PersistentVolumeClaim objects DefaultTolerationSeconds NodeRestriction to limit what a kubelet can modify (e.g. only pods on this node) --kubelet-preferred-address-types to InternalIP,ExternalIP,Hostname; this makes kubectl logs and other API server-kubelet communication work in environments where the hostnames of the nodes aren't resolvable Flags for using certificates generated in previous steps: --client-ca-file to ca.crt --tls-cert-file to apiserver.crt --tls-private-key-file to apiserver.key --kubelet-client-certificate to apiserver-kubelet-client.crt --kubelet-client-key to apiserver-kubelet-client.key --service-account-key-file to sa.pub --requestheader-client-ca-file to front-proxy-ca.crt --proxy-client-cert-file to front-proxy-client.crt --proxy-client-key-file to front-proxy-client.key Other flags for securing the front proxy (API Aggregation) communications: --requestheader-username-headers=X-Remote-User --requestheader-group-headers=X-Remote-Group --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-allowed-names=front-proxy-client controller manager static Pod manifest [!TIP] If kubeadm is invoked specifying a --pod-network-cidr, the subnet manager feature required for some CNI network plugins is enabled by setting: --allocate-node-cidrs=true --cluster-cidr and --node-cidr-mask-size flags according to the given CIDR If a cloud provider is specified, the corresponding --cloud-provider is specified, together with the --cloud-config path if such configuration file exists (this is experimental, alpha and will be removed in a future version) other flags --controllers enabling all the default controllers plus BootstrapSigner and TokenCleaner controllers for TLS bootstrap. See TLS Bootstrapping for more details --use-service-account-credentials to true Flags for using certificates generated in previous steps: --root-ca-file to ca.crt --cluster-signing-cert-file to ca.crt, if External CA mode is disabled, otherwise to \"\" --cluster-signing-key-file to ca.key, if External CA mode is disabled, otherwise to \"\" --service-account-private-key-file to sa.key ports and protocols contol plane PROTOCOL DIRECTION PORT RANGE PURPOSE USED BY TCP Inbound 6443 Kubernetes API server All TCP Inbound 2379-2380 etcd server client API kube-apiserver, etcd TCP Inbound 10250 Kubelet API Self, Control plane TCP Inbound 10259 kube-scheduler Self TCP Inbound 10257 kube-controller-manager Self worker node(s) PROTOCOL DIRECTION PORT RANGE PURPOSE USED BY TCP Inbound 10250 Kubelet API Self, Control plane TCP Inbound 30000-32767 NodePort Services All architecture control pannel kube-apiserver etcd kube-scheduler controller manager ccm : cloud controller manager work node [!NOTE] supported endpoints linux RUNTIME PATH TO UNIX DOMAIN SOCKET containerd unix:///var/run/containerd/containerd.sock CRI-O unix:///var/run/crio/crio.sock Docker Engine (using cri-dockerd) unix:///var/run/cri-dockerd.sock windows RUNTIME PATH TO UNIX DOMAIN SOCKET containerd npipe:////./pipe/containerd-containerd Docker Engine (using cri-dockerd) npipe:////./pipe/cri-dockerd kubelet kube proxy cri-o : container runtime jsonpath [!NOTE] references: JSONPath Support how to make kubectl jsonpath output on separate lines JSONPath Reference options explain $ kubectl explain hpa KIND: HorizontalPodAutoscaler VERSION: autoscaling/v1 DESCRIPTION: configuration of a horizontal pod autoscaler. FIELDS: apiVersion ... or $ kubectl explain configmap KIND: ConfigMap VERSION: v1 DESCRIPTION: ConfigMap holds configuration data for pods to consume. FIELDS: apiVersion APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#resources ... kubectl alias __start_kubectl $ echo 'source > ~/.bashrc $ cat >> ~/.bashrc _complete_alias download bash_completion.sh for kubectl $ curl -fsSL https://raw.githubusercontent.com/cykerway/complete-alias/master/bash_completion.sh > ~/.bash_completion.sh $ chmod +x !$ $ cat >> ~/.bashrc token check token $ sudo kubeadm token list TOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPS bop765.brol9nsrw820gmbi authentication,signing system:bootstrappers:kubeadm:default-node-token khhfwa.jvkvrpiknx4o6ffy 19h 2018-07-13T11:37:43+08:00 authentication,signing system:bootstrappers:kubeadm:default-node-token generate token $ sudo kubeadm token create --print-join-command kubeadm join 192.168.1.100:6443 --token lhb1ln.oj0fqwgd1yl7l9xp --discovery-token-ca-cert-hash sha256:cba8df87dcb70c83c19af72c02e4886fcc7b0cf05319084751e6ece688443bde $ sudo kubeadm token create --print-join-command --ttl=0 kubeadm join 192.168.1.100:6443 --token bop765.brol9nsrw820gmbi --discovery-token-ca-cert-hash sha256:c8650c56faf72b8bf71c576f0d13f44c93bea2d21d4329c64bb97cba439af5c3 tear down [!TIP] How to completely uninstall kubernetes ubuntu $ kubectl drain --delete-local-data --force --ignore-daemonsets $ kubectl delete node $ sudo kubeadm reset [preflight] Running pre-flight checks. [reset] Stopping the kubelet service. [reset] Unmounting mounted directories in \"/var/lib/kubelet\" [reset] Removing kubernetes-managed containers. [reset] Deleting contents of stateful directories: [/var/lib/kubelet /etc/cni/net.d /var/lib/dockershim /var/run/kubernetes /var/lib/etcd] [reset] Deleting contents of config directories: [/etc/kubernetes/manifests /etc/kubernetes/pki] [reset] Deleting files: [/etc/kubernetes/admin.conf /etc/kubernetes/kubelet.conf /etc/kubernetes/bootstrap-kubelet.conf /etc/kubernetes/controller-manager.conf /etc/kubernetes/scheduler.conf] $ systemctl stop kubelet $ docker system prune -a -f $ systemctl stop docker $ sudo rm -rf /etc/kubernetes/ $ sudo rm -rf /var/lib/cni/ $ sudo rm -rf /var/lib/kubelet/* $ sudo rm -rf /etc/cni/ $ sudo ifconfig cni0 down $ sudo ifconfig flannel.1 down $ rm -rf ~/.kube/ $ sudo apt purge kubeadm kubectl kubelet kubernetes-cni kube* $ sudo apt autoremove CentOS/RHEL $ kubectl drain --delete-local-data --force --ignore-daemonsets $ kubectl delete node $ sudo kubeadm reset $ docker system prune -a -f $ systemctl stop kubelet $ systemctl disable kubelet $ systemctl stop docker $ systemctl disable docker $ sudo ifconfig cni0 down $ sudo ifconfig flannel.1 down $ sudo ifconfig docker0 down $ sudo yum versionlock delete docker-ce $ sudo yum versionlock delete docker-ce-cli $ sudo yum versionlock delete kubeadm $ sudo yum versionlock delete kubelet $ sudo yum versionlock delete kubectl $ sudo yum versionlock delete kubernetes-cni $ sudo yum remove -y docker-ce docker-ce-cli containerd.io kubectl kubeadm kubelet kubernetes-cni $ sudo yum autormeove $ rm -rf /home/devops/.kube/ $ sudo rm -rf /etc/cni $ sudo rm -rf /etc/kubernetes/ $ sudo rm -rf /etc/docker/ $ sudo rm -rf /etc/systemd/system/multi-user.target.wants/kubelet.service $ sudo rm -rf /etc/systemd/system/multi-user.target.wants/docker.service $ sudo rm -rf /usr/lib/systemd/system/docker.service $ sudo rm -rf /usr/lib/systemd/system/kubelet.service.d/ $ sudo rm -rf /usr/libexec/docker/ $ sudo rm -rf /usr/libexec/kubernetes/ $ sudo rm -rf /var/lib/etcd/ # optional $ sudo rm -rf /var/lib/kubelet/ $ sudo rm -rf /var/lib/dockershim/ $ sudo rm -rf /var/lib/yum/repos/x86_64/7/kubernetes/ $ sudo rm -rf /var/log/pods/ $ sudo rm -rf /var/log/containers/ $ sudo rm -rf /var/run/docker.sock $ sudo rm -rf /var/cache/yum/x86_64/7/kubernetes $ sudo yum clean all $ sudo rm -rf /var/cache/yum $ sudo yum makecache $ sudo yum check-update Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/kubeadm/kubeadm.html":{"url":"virtualization/kubernetes/kubeadm/kubeadm.html","title":"kubeadm","keywords":"","body":" basic environment Ubuntu CentOS/RHEL tricky list images get or modify kubeadm-cfg.yml show default KubeletConfiguration show endpoint show default kubeadm config kubeadm join CNI troubleshooting scripts: mritd/shell_scripts init_ubuntu.sh installation: * install tools * Bootstrapping clusters with kubeadm * 使用 kubeadm 创建集群 * kubeadm 搭建 HA kubernetes 集群 Implementation details * kubeadm Configuration (v1beta3) * Implementation details * How To Setup A Three Node Kubernetes Cluster Step By Step cURLing the Kubernetes API server Troubleshooting kubeadm * codefarm Kubernetes Recovery from Master Failure with Kubeadm 1 - Kubernetes Objects 2 - Kubernetes Pods 3 - Kubernetes Services and Ingress 4 - Kubernetes Storage 5 - Kubernetes StatefulSet 6 - Kubernetes Monitoring authenticating with bootstrap token kubernetes/design-proposals-archive design-proposals-archive/cluster-lifecycle/cluster-deployment.md How to Upgrade Kubernetes Cluster Using Kubeadm? 在 Kubernetes 上最小化安装 KubeSphere management: Administering Kubernetes upgrade: Upgrading kubeadm clusters kubeadm 集群升级$ kubeadm upgrade plan --config /etc/kubernetes/kubeadm.yaml network Migrating a cluster from flannel to Calico v3.9 Migrating a cluster from flannel to Calico #1817: kube-flannel dial tcp 10.96.0.1:443: i/o timeout Quickstart for Calico on Kubernetes [!NOTE|label:references:] * Generate Certificates Manually easyrsa openssl cfssl Manage TLS Certificates in a Cluster * Manual Rotation of CA Certificates basic environment Ubuntu basic $ sudo apt install -y apt-transport-https ca-certificates curl software-properties-common $ sudo usermod -a -G root \"$(whoami)\" $ sudo usermod -a -G adm \"$(whoami)\" $ sudo usermod -a -G sudo \"$(whoami)\" $ [ -f /etc/sysctl.conf ] && sudo mv /etc/sysctl.conf{,.bak.${TIMESTAMPE}} $ sudo bash -c \"cat >> /etc/sysctl.conf\" or network setup SYSCTLDIRECTIVES='net.bridge.bridge-nf-call-iptables net.ipv4.conf.all.forwarding net.ipv4.conf.default.forwarding net.ipv4.ip_forward' for directive in ${SYSCTLDIRECTIVES}; do if cat /etc/sysctl.d/99-sysctl.conf | grep -q \"${directive}\"; then echo \"Directive ${directive} is loaded\" else echo \"${directive}=1\" >> /etc/sysctl.d/99-sysctl.conf fi done sysctl -p /etc/sysctl.d/99-sysctl.conf repo sources $ cat /etc/apt/sources.list deb http://sample.artifactory.com/artifactory/debian-remote-ubuntu artful main restricted deb http://sample.artifactory.com/artifactory/debian-remote-ubuntu artful-updates main restricted deb http://sample.artifactory.com/artifactory/debian-remote-ubuntu artful universe deb http://sample.artifactory.com/artifactory/debian-remote-ubuntu artful-updates universe deb http://sample.artifactory.com/artifactory/debian-remote-ubuntu artful multiverse deb http://sample.artifactory.com/artifactory/debian-remote-ubuntu artful-updates multiverse deb http://sample.artifactory.com/artifactory/debian-remote-ubuntu artful-backports main restricted universe multiverse deb http://sample.artifactory.com/artifactory/debian-remote-canonical artful partner deb http://sample.artifactory.com/artifactory/debian-remote-ubuntu-security artful-security main restricted deb http://sample.artifactory.com/artifactory/debian-remote-ubuntu-security artful-security universe deb http://sample.artifactory.com/artifactory/debian-remote-ubuntu-security artful-security multiverse $ cat sources.list.d/kubernetes.list deb http://sample.artifactory.com/artifactory/debian-remote-google kubernetes-xenial main $ cat sources.list.d/docker.list deb [arch=amd64] http://sample.artifactory.com/artifactory/debian-remote-docker artful edge # deb [arch=amd64] https://download.docker.com/linux/ubuntu artful edge package Search $ apt-cache search kub ... kubeadm - Kubernetes Cluster Bootstrapping Tool kubectl - Kubernetes Command Line Tool kubelet - Kubernetes Node Agent kubernetes-cni - Kubernetes CNI installation $ sudo apt install kubeadm=1.10.0-00 -y # or $ sudo apt install kubeadm=1.10.0-00 kubectl=1.10.0-00 kubelet=1.10.0-00 -y # or $ sudo apt install kubeadm -y Reading package lists... Done Building dependency tree Reading state information... Done The following additional packages will be installed: ebtables ethtool kubectl kubelet kubernetes-cni socat The following NEW packages will be installed: ebtables ethtool kubeadm kubectl kubelet kubernetes-cni socat 0 upgraded, 7 newly installed, 0 to remove and 0 not upgraded. Need to get 57.1 MB of archives. After this operation, 411 MB of additional disk space will be used. Get:1 http://sample.artifactory.com/artifactory/debian-remote-ubuntu artful/main amd64 ebtables amd64 2.0.10.4-3.5ubuntu2 [80.0 kB] Get:2 http://sample.artifactory.com/artifactory/debian-remote-ubuntu artful/main amd64 ethtool amd64 1:4.8-1 [109 kB] Get:3 http://sample.artifactory.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubernetes-cni amd64 0.6.0-00 [5,910 kB] Get:4 http://sample.artifactory.com/artifactory/debian-remote-ubuntu artful/universe amd64 socat amd64 1.7.3.2-1 [342 kB] Get:5 http://sample.artifactory.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubelet amd64 1.10.0-00 [21.1 MB] Get:6 http://sample.artifactory.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubectl amd64 1.10.0-00 [8,905 kB] Get:7 http://sample.artifactory.com/artifactory/debian-remote-google kubernetes-xenial/main amd64 kubeadm amd64 1.10.0-00 [20.7 MB] Fetched 57.1 MB in 1min 22s (697 kB/s) Selecting previously unselected package ebtables. (Reading database ... 195476 files and directories currently installed.) Preparing to unpack .../0-ebtables_2.0.10.4-3.5ubuntu2_amd64.deb ... Unpacking ebtables (2.0.10.4-3.5ubuntu2) ... Selecting previously unselected package ethtool. Preparing to unpack .../1-ethtool_1%3a4.8-1_amd64.deb ... Unpacking ethtool (1:4.8-1) ... Selecting previously unselected package kubernetes-cni. Preparing to unpack .../2-kubernetes-cni_0.6.0-00_amd64.deb ... Unpacking kubernetes-cni (0.6.0-00) ... Selecting previously unselected package socat. Preparing to unpack .../3-socat_1.7.3.2-1_amd64.deb ... Unpacking socat (1.7.3.2-1) ... Selecting previously unselected package kubelet. Preparing to unpack .../4-kubelet_1.10.0-00_amd64.deb ... Unpacking kubelet (1.10.0-00) ... Selecting previously unselected package kubectl. Preparing to unpack .../5-kubectl_1.10.0-00_amd64.deb ... Unpacking kubectl (1.10.0-00) ... Selecting previously unselected package kubeadm. Preparing to unpack .../6-kubeadm_1.10.0-00_amd64.deb ... Unpacking kubeadm (1.10.0-00) ... Setting up kubernetes-cni (0.6.0-00) ... Processing triggers for ureadahead (0.100.0-20) ... Setting up socat (1.7.3.2-1) ... Processing triggers for doc-base (0.10.7) ... Processing 1 added doc-base file... Processing triggers for systemd (234-2ubuntu12.3) ... Setting up ebtables (2.0.10.4-3.5ubuntu2) ... Created symlink /etc/systemd/system/multi-user.target.wants/ebtables.service → /lib/systemd/system/ebtables.service. update-rc.d: warning: start and stop actions are no longer supported; falling back to defaults Setting up kubectl (1.10.0-00) ... Processing triggers for man-db (2.7.6.1-2) ... Setting up ethtool (1:4.8-1) ... Setting up kubelet (1.10.0-00) ... Created symlink /etc/systemd/system/multi-user.target.wants/kubelet.service → /lib/systemd/system/kubelet.service. Setting up kubeadm (1.10.0-00) ... Processing triggers for systemd (234-2ubuntu12.3) ... Processing triggers for ureadahead (0.100.0-20) ... hold the automatic upgrade $ sudo apt-mark hold kubeadm $ sudo apt-mark hold kubelet $ sudo apt-mark hold kubectl # check $ dpkg -l | grep ^h # or $ apt-mark showhold CentOS/RHEL basic environment [!NOTE] How to install Kubernetes cluster on CentOS 8 open necessary ports used by kubernetes$ firewall-cmd --zone=public --permanent --add-port={6443,2379,2380,10250,10251,10252}/tcp $ firewall-cmd --zone=public --permanent --add-port={10250,30000-32767}/tcp allow docker access from another node$ firewall-cmd --zone=public --permanent --add-rich-rule 'rule family=ipv4 source address=worker-IP-address/32 accept' allow access to the host’s localhost from the docker container$ firewall-cmd --zone=public --permanent --add-rich-rule 'rule family=ipv4 source address=172.17.0.0/16 accept' make the changes permanent$ firewall-cmd --reload $ sudo systemctl stop firewalld $ sudo systemctl disable firewalld $ sudo systemctl mask firewalld $ sudo systemctl is-enabled firewalld $ sudo systemctl is-active firewalld $ sudo firewall-cmd --state $ sudo swapoff -a $ sudo setenforce 0 $ sudo bash -c \"sed 's/^SELINUX=enforcing$/SELINUX=permissive/' -i /etc/selinux/config\" $ sudo bash -c \"sed -e 's:^\\\\(.*swap.*\\\\)$:# \\\\1:' -i /etc/fstab\" $ sudo modprobe br_netfilter $ sudo sysctl -w net.ipv4.ip_forward=1 $ sudo sysctl net.bridge.bridge-nf-call-iptables=1 $ sudo sysctl net.bridge.bridge-nf-call-ip6tables=1 #or $ sudo bash -c \"cat > /etc/sysctl.d/k8s.conf\" installation $ sudo bash -c 'cat > /etc/yum.repos.d/kubernetes.repo' > /etc/bashrc\" $ sudo usermod -a -G root,adm,wheel,docker $(whoami) $ sudo systemctl enable --now docker $ sudo systemctl enable --now kubelet version lock $ sudo yum versionlock docker-ce $ sudo yum versionlock docker-ce-cli $ sudo yum versionlock kubeadm $ sudo yum versionlock kubelet $ sudo yum versionlock kubectl $ sudo yum versionlock kubernetes-cni $ sudo yum versionlock list # or $ grep exclude /etc/yum.repos.d/kubernetes.repo exclude=kubelet kubeadm kubectl kubernetes-cni cri-tools full repo files$ cat /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-$basearch enabled=1 gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl kubernetes-cni cri-tools pre-pull $ kubeadm config images pull I0508 20:24:29.967938 317181 version.go:236] remote version is much newer: v1.27.1; falling back to: stable-1.12 [config/images] Pulled k8s.gcr.io/kube-apiserver:v1.12.10 [config/images] Pulled k8s.gcr.io/kube-controller-manager:v1.12.10 [config/images] Pulled k8s.gcr.io/kube-scheduler:v1.12.10 [config/images] Pulled k8s.gcr.io/kube-proxy:v1.12.10 [config/images] Pulled k8s.gcr.io/pause:3.1 [config/images] Pulled k8s.gcr.io/etcd:3.2.24 [config/images] Pulled k8s.gcr.io/coredns:1.2.2 tricky references: kubeadm config kubeadm config print [flags] kubeadm config print init-defaults [flags] kubeadm config print join-defaults [flags] kubeadm config migrate [flags] kubeadm config images list [flags] kubeadm config images pull [flags] list images $ kubeadm config images list I0629 03:32:46.532520 66831 version.go:236] remote version is much newer: v1.24.2; falling back to: stable-1.12 k8s.gcr.io/kube-apiserver:v1.12.10 k8s.gcr.io/kube-controller-manager:v1.12.10 k8s.gcr.io/kube-scheduler:v1.12.10 k8s.gcr.io/kube-proxy:v1.12.10 k8s.gcr.io/pause:3.1 k8s.gcr.io/etcd:3.2.24 k8s.gcr.io/coredns:1.2.2 # or $ kubeadm config images list --config=kubeadm.yml # to pull images $ kubeadm config images pull [--config=kubeadm.yml] get or modify kubeadm-cfg.yml [!TIP] kubeadm saves the configuration passed to kubeadm init in a ConfigMap named kubeadm-config under kube-system namespace. This will ensure that kubeadm actions executed in future (e.g kubeadm upgrade) will be able to determine the actual/current cluster state and make new decisions based on that data. Please note that: Before saving the ClusterConfiguration, sensitive information like the token is stripped from the configuration Upload of control plane node configuration can be invoked individually with the kubeadm init phase upload-config command get kubeadm-cfg.yml$ kubectl get cm kubeadm-config -n kube-system -o=jsonpath=\"{.data.ClusterConfiguration}\" $ kubectl get cm kubeadm-config -n kube-system -o=jsonpath=\"{.data.ClusterConfiguration}\" show default KubeletConfiguration $ sudo kubeadm config print init-defaults --component-configs KubeletConfiguration $ sudo kubeadm config print init-defaults --component-configs KubeProxyConfiguration # v1.12.3 $ sudo kubeadm config print-default $ sudo kubeadm config print-defaults $ sudo kubeadm config print-defaults --api-objects [apis] [apis] Available values: [ InitConfiguration ClusterConfiguration JoinConfiguration KubeProxyConfiguration KubeletConfiguration MasterConfiguration ] show endpoint $ kubectl get endpoints kubernetes NAME ENDPOINTS AGE kubernetes 192.168.1.55:6443,192.168.1.73:6443,192.168.1.87:6443 4y347d show default kubeadm config * imarslo : get or modify kubeadm-cfg.yml$ kubectl get cm kubeadm-config -n kube-system -o yaml $ sudo kubeadm config view # or $ kubectl -n kube-system get cm kubeadm-config -o yaml # or $ kubectl get cm kubeadm-config -n kube-system -o=jsonpath=\"{.data.ClusterConfiguration}\" kubeadm join [!TIP] reference: kubeadm join openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //' Using init phases with kubeadm sudo kubeadm init phase control-plane controller-manager --help sudo kubeadm init phase control-plane --help Uploading control-plane certificates to the cluster kubeadm join install docker-ce install kubelet in node $ sudo bash -c 'cat > /etc/yum.repos.d/kubernetes.repo' verify $ sudo dnf list --installed | grep kube cri-tools.x86_64 1.26.0-0 @kubernetes kubeadm.x86_64 1.12.3-0 @kubernetes kubectl.x86_64 1.12.3-0 @kubernetes kubelet.x86_64 1.12.3-0 @kubernetes kubernetes-cni.x86_64 0.6.0-0 @kubernetes $ journalctl -u kubelet -f normal commands $ sudo kubeadm token create --print-join-command # or $ sudo kubeadm token create --print-join-command --ttl=0 # list $ sudo kubeadm token list token-based discovery with CA pinning $ openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //' for worker nodes$ kubeadm join --discovery-token abcdef.1234567890abcdef --discovery-token-ca-cert-hash sha256:1234..cdef 1.2.3.4:6443 for control-plane nodes$ kubeadm join --discovery-token abcdef.1234567890abcdef --discovery-token-ca-cert-hash sha256:1234..cdef --control-plane 1.2.3.4:6443 CNI [!NOTE|label:references:] #2695 dial tcp 10.96.0.1:443 timeout k8s安装插件出现dial tcp 10.96.0.1:443: i/o timeout问题解析 kube-flannel.yml Kubernetes / Flannel – Failed to list *v1.Service $ cat /run/flannel/subnet.env $ kubectl get nodes k8s-node-01 -o jsonpath='{.spec.podCIDR}' modify $ kubectl edit cm -n kube-system kube-flannel-cfg net-conf.json: | { \"Network\": \"10.244.0.0/16\", \"Backend\": { \"Type\": \"vxlan\" } } check $ kubectl get nodes -o jsonpath='{.items[*].spec.podCIDR}' # e.g.: flannel $ kubectl get nodes -o jsonpath='{.items[*].spec.podCIDR}' 10.244.21.0/24 10.244.4.0/24 10.244.1.0/24 10.244.10.0/24 10.244.20.0/24 10.244.7.0/24 10.244.5.0/24 10.244.17.0/24 10.244.3.0/24 10.244.0.0/24 10.244.6.0/24 10.244.12.0/24 10.244.13.0/24 10.244.16.0/24 10.244.15.0/24 troubleshooting error: open /var/lib/kubelet/config.yaml: no such file or directory Nov 17 19:25:19 kube-node-01 systemd[1]: Started kubelet: The Kubernetes Node Agent. Nov 17 19:25:19 kube-node-01 kubelet[28335]: F1117 19:25:19.391266 28335 server.go:190] failed to load Kubelet config file /var/lib/kubelet/config.yaml, error failed to read kubelet config file \"/var/lib/kubelet/config.yaml\", error: open /var/lib/kubelet/config.yaml: no such file or directory Nov 17 19:25:19 kube-node-01 systemd[1]: kubelet.service: Main process exited, code=exited, status=255/n/a Nov 17 19:25:19 kube-node-01 systemd[1]: kubelet.service: Failed with result 'exit-code'. solution: controller: kubeadm init phase kubelet-start $ kubeadm init phase kubelet-start $ swapoff -a $ sudo bash -c \"sed -e 's:^\\\\(.*swap.*\\\\)$:# \\\\1:' -i /etc/fstab\" node: $ kubeadm join api.kubernetes.com:6443 \\ --token 8*****.***************a \\ --discovery-token-ca-cert-hash sha256:e**************************************************************5 \\ --ignore-preflight-errors=all Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:38:04 "},"virtualization/kubernetes/kubeadm/init.html":{"url":"virtualization/kubernetes/kubeadm/init.html","title":"init","keywords":"","body":" kubeadm init synopsis options init workflow ha cluster step by step basic environment cfssl etcd keepalive extend etcd configuration ca and client certs peer enable etcd service HAProxy kubeadm init kubeadm-conf.yaml init controller sync PKI sample set up a high availability etcd cluster with kubeadm tips kubeadm init tear down references: * Install Kubernetes Cluster on Centos 8 With Kubeadm and CRI-O * imarslo : belloHAKubeCluster.sh 手动档搭建 Kubernetes HA 集群 kube-up.sh Set up a High Availability etcd Cluster with kubeadm Configuring each kubelet in your cluster using kubeadm Creating a cluster with kubeadm v1.21 使用 kubeadm 创建集群 * 一步步打造基于Kubeadm的高可用Kubernetes集群-第一部分 * 一步步打造基于Kubeadm的高可用Kubernetes集群-第二部分 * 以Kubeadm方式安装的Kubernetes集群的探索 * 使用Kubeadm搭建Kubernetes HA（1.10.1） * 使用Kubeadm + HAProxy + Keepalived部署高可用Kubernetes集群 * 在 CentOS 上部署 Kubernetes 集群 Bootstrapping clusters with kubeadm Customizing components with the kubeadm API Set up a High Availability etcd Cluster with kubeadm Considerations for large clusters PKI certificates and requirements * kubeadm init creating a cluster with kubeadm setup on-prem kubernetes part 1 part 2 part 3 part 4 part 5 certificate * etcd集群TLS设置 * Setting up Etcd Cluster with TLS Authentication Enabled Generate self-signed certificates * 创建 TLS 证书和秘钥 * kubernetes学习记录（9）—— 集群基于CA签名的安全设置 CRI-O : How To Setup Kubernetes Cluster Using Kubeadm configuration Important Kubernetes Cluster Configurations kubeadm init synopsis preflight Run pre-flight checks certs Certificate generation /ca Generate the self-signed Kubernetes CA to provision identities for other Kubernetes components /apiserver Generate the certificate for serving the Kubernetes API /apiserver-kubelet-client Generate the certificate for the API server to connect to kubelet /front-proxy-ca Generate the self-signed CA to provision identities for front proxy /front-proxy-client Generate the certificate for the front proxy client /etcd-ca Generate the self-signed CA to provision identities for etcd /etcd-server Generate the certificate for serving etcd /etcd-peer Generate the certificate for etcd nodes to communicate with each other /etcd-healthcheck-client Generate the certificate for liveness probes to healthcheck etcd /apiserver-etcd-client Generate the certificate the apiserver uses to access etcd /sa Generate a private key for signing service account tokens along with its public key kubeconfig Generate all kubeconfig files necessary to establish the control plane and the admin kubeconfig file /admin Generate a kubeconfig file for the admin to use and for kubeadm itself /kubelet Generate a kubeconfig file for the kubelet to use *only* for cluster bootstrapping purposes /controller-manager Generate a kubeconfig file for the controller manager to use /scheduler Generate a kubeconfig file for the scheduler to use kubelet-start Write kubelet settings and (re)start the kubelet control-plane Generate all static Pod manifest files necessary to establish the control plane /apiserver Generates the kube-apiserver static Pod manifest /controller-manager Generates the kube-controller-manager static Pod manifest /scheduler Generates the kube-scheduler static Pod manifest etcd Generate static Pod manifest file for local etcd /local Generate the static Pod manifest file for a local, single-node local etcd instance upload-config Upload the kubeadm and kubelet configuration to a ConfigMap /kubeadm Upload the kubeadm ClusterConfiguration to a ConfigMap /kubelet Upload the kubelet component config to a ConfigMap upload-certs Upload certificates to kubeadm-certs mark-control-plane Mark a node as a control-plane bootstrap-token Generates bootstrap tokens used to join a node to a cluster kubelet-finalize Updates settings relevant to the kubelet after TLS bootstrap /experimental-cert-rotation Enable kubelet client certificate rotation addon Install required addons for passing conformance tests /coredns Install the CoreDNS addon to a Kubernetes cluster /kube-proxy Install the kube-proxy addon to a Kubernetes cluster options --apiserver-advertise-address string --apiserver-bind-port int32 Default: 6443 --apiserver-cert-extra-sans strings --cert-dir string Default: \"/etc/kubernetes/pki\" --certificate-key string --config string --control-plane-endpoint string --cri-socket string --dry-run --feature-gates string : A set of key=value pairs that describe feature gates for various features PublicKeysECDSA=true|false (ALPHA - default=false) RootlessControlPlane=true|false (ALPHA - default=false) UnversionedKubeletConfigMap=true|false (BETA - default=true) -h, --help --ignore-preflight-errors strings --image-repository string Default: \"k8s.gcr.io\" --kubernetes-version string Default: \"stable-1\" --node-name string --patches string --pod-network-cidr string --service-cidr string Default: \"10.96.0.0/12\" --service-dns-domain string Default: \"cluster.local\" --skip-certificate-key-print --skip-phases strings --skip-token-print --token string --token-ttl duration Default: 24h0m0s --upload-certs --rootfs string init workflow preflight checks generate the necessary certificates generate kubeconfig files for control plane components generate static pod manifests for control plane components api server controller-manager scheduler [!TIP] kubeadm writes static Pod manifest files for control plane components to /etc/kubernetes/manifests static pod manifest generation for control plane components can be invoked individually with the kubeadm init phase control-plane all command references: using custom images generate static pod manifest for local etcd wait for the control plane to come up [!TIP] kubeadm waits (upto 4m0s) until localhost:6443/healthz (kube-apiserver liveness) returns ok. However in order to detect deadlock conditions, kubeadm fails fast if localhost:10255/healthz (kubelet liveness) or localhost:10255/healthz/syncloop (kubelet readiness) don't return ok within 40s and 60s respectively. save the kubeadm clusterconfiguration in a configmap for later reference mark the node as control-plane [!TIP] Please note that: The node-role.kubernetes.io/master taint is deprecated and will be removed in kubeadm version 1.25 Mark control-plane phase phase can be invoked individually with the kubeadm init phase mark-control-plane command configure tls-bootstrapping for node joining create a bootstrap token allow joining nodes to call csr api Setup auto approval for new bootstrap tokens setup nodes certificate rotation with auto approval create the public cluster-info configmap install addons proxy dns ha cluster step by step [!TIP] # hostname controller01Name='controller01' controller02Name='controller02' controller03Name='controller03' # ipaddress controller01IP='192.168.100.200' controller01IP='192.168.100.201' controller01IP='192.168.100.202' virtualIP='192.168.100.250' leadIP=\"${controller01IP}\" leadName=\"${controller01Name}\" k8sVer='v1.15.3' cfsslDownloadUrl='https://pkg.cfssl.org/R1.2' etcdVer='v3.3.15' etcdDownloadUrl='https://github.com/etcd-io/etcd/releases/download' etcdSSLPath='/etc/etcd/ssl' etcdInitialCluster=\"${controller01Name}=https://${controller01IP}:2380,${controller02Name}=https://${controller02IP}:2380,${controller03Name}=https://${controller03IP}:2380\" keepaliveVer='2.0.18' haproxyVer='2.0.6' helmVer='v2.14.3' interface=$(netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}') ipAddr=$(ip a s \"${interface}\" | sed -rn 's|\\W*inet[^6]\\W*([0-9\\.]{7,15}).*$|\\1|p') peerName=$(hostname) basic environment cfssl $ sudo bash -c \"curl -o /usr/local/bin/cfssl ${cfsslDownloadUrl}/cfssl_linux-amd64\" $ sudo bash -c \"curl -o /usr/local/bin/cfssljson ${cfsslDownloadUrl}/cfssljson_linux-amd64\" $ sudo chmod +x /usr/local/bin/cfssl* cfssl in osx [!NOTE|label:references:] go: Download and install cfssl SettingGOPATH GOBIN not set: cannot run go install GOPATH : $ go env -w GOPATH=/path/to GOBIN : $ go env -w GOBIN=/path/to/bin $ git clone git@github.com:cloudflare/cfssl.git && cd cfssl $ make go build -ldflags \"-s -w -X github.com/cloudflare/cfssl/cli/version.version=1.6.4\" -o bin/cfssl ./cmd/cfssl go build -ldflags \"-s -w -X github.com/cloudflare/cfssl/cli/version.version=1.6.4\" -o bin/cfssl-bundle ./cmd/cfssl-bundle go build -ldflags \"-s -w -X github.com/cloudflare/cfssl/cli/version.version=1.6.4\" -o bin/cfssl-certinfo ./cmd/cfssl-certinfo go build -ldflags \"-s -w -X github.com/cloudflare/cfssl/cli/version.version=1.6.4\" -o bin/cfssl-newkey ./cmd/cfssl-newkey go build -ldflags \"-s -w -X github.com/cloudflare/cfssl/cli/version.version=1.6.4\" -o bin/cfssl-scan ./cmd/cfssl-scan go build -ldflags \"-s -w -X github.com/cloudflare/cfssl/cli/version.version=1.6.4\" -o bin/cfssljson ./cmd/cfssljson go build -ldflags \"-s -w -X github.com/cloudflare/cfssl/cli/version.version=1.6.4\" -o bin/mkbundle ./cmd/mkbundle go build -ldflags \"-s -w -X github.com/cloudflare/cfssl/cli/version.version=1.6.4\" -o bin/multirootca ./cmd/multirootca $ ls bin/ cfssl cfssl-bundle cfssl-certinfo cfssl-newkey cfssl-scan cfssljson mkbundle multirootca # using `~/go/bin` by default $ go env -w GOPATH=/usr/local $ make install go install ./cmd/cfssl go install ./cmd/cfssl-bundle go install ./cmd/cfssl-certinfo go install ./cmd/cfssl-newkey go install ./cmd/cfssl-scan go install ./cmd/cfssljson go install ./cmd/mkbundle go install ./cmd/multirootca $ ls -altrh /usr/local/bin -rwxr-xr-x 1 marslo staff 21M Apr 13 22:36 cfssl -rwxr-xr-x 1 marslo staff 14M Apr 13 22:36 cfssl-bundle -rwxr-xr-x 1 marslo staff 18M Apr 13 22:36 cfssl-certinfo -rwxr-xr-x 1 marslo staff 14M Apr 13 22:36 cfssl-newkey -rwxr-xr-x 1 marslo staff 14M Apr 13 22:36 cfssl-scan -rwxr-xr-x 1 marslo staff 11M Apr 13 22:36 cfssljson -rwxr-xr-x 1 marslo staff 6.9M Apr 13 22:36 mkbundle -rwxr-xr-x 1 marslo staff 21M Apr 13 22:36 multirootca $ go env GO111MODULE=\"\" GOARCH=\"amd64\" GOBIN=\"\" GOCACHE=\"/Users/marslo/Library/Caches/go-build\" GOENV=\"/Users/marslo/Library/Application Support/go/env\" GOEXE=\"\" GOEXPERIMENT=\"\" GOFLAGS=\"\" GOHOSTARCH=\"amd64\" GOHOSTOS=\"darwin\" GOINSECURE=\"\" GOMODCACHE=\"/usr/local/pkg/mod\" GONOPROXY=\"\" GONOSUMDB=\"\" GOOS=\"darwin\" GOPATH=\"/usr/local\" GOPRIVATE=\"\" GOPROXY=\"https://proxy.golang.org,direct\" GOROOT=\"/usr/local/Cellar/go/1.19.4/libexec\" GOSUMDB=\"sum.golang.org\" GOTMPDIR=\"\" GOTOOLDIR=\"/usr/local/Cellar/go/1.19.4/libexec/pkg/tool/darwin_amd64\" GOVCS=\"\" GOVERSION=\"go1.19.4\" GCCGO=\"gccgo\" GOAMD64=\"v1\" AR=\"ar\" CC=\"clang\" CXX=\"clang++\" CGO_ENABLED=\"1\" GOMOD=\"/Users/marslo/iMarslo/tools/git/utils/kubernetes/cfssl/go.mod\" GOWORK=\"\" CGO_CFLAGS=\"-g -O2\" CGO_CPPFLAGS=\"\" CGO_CXXFLAGS=\"-g -O2\" CGO_FFLAGS=\"-g -O2\" CGO_LDFLAGS=\"-g -O2\" PKG_CONFIG=\"pkg-config\" GOGCCFLAGS=\"-fPIC -arch x86_64 -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/go-build3539971251=/tmp/go-build -gno-record-gcc-switches -fno-common\" etcd $ curl -sSL ${etcdDownloadUrl}/${etcdVer}/etcd-${etcdVer}-linux-amd64.tar.gz | sudo tar -xzv --strip-components=1 -C /usr/local/bin/ keepalive references: Step 26 - KeepAliveD $ mkdir -p ~/temp $ sudo mkdir -p /etc/keepalived/ $ curl -fsSL ${keepaliveDownloadUrl}/keepalived-${keepaliveVer}.tar.gz | tar xzf - -C ~/temp $ cd ~/temp/keepalived-${keepaliveVer} $ ./configure && make $ sudo make install $ sudo cp keepalived/keepalived.service /etc/systemd/system/ $ sudo bash -c 'cat > /etc/keepalived/keepalived.conf' /etc/keepalived/check_apiserver.sh' &2 exit 1 } curl --silent --max-time 2 --insecure https://localhost:6443/ -o /dev/null || errorExit \"Error GET https://localhost:6443/\" if ip addr | grep -q ${virtualIpAddr}; then curl --silent --max-time 2 --insecure https://${virtualIpAddr}:6443/ -o /dev/null || errorExit \"Error GET https://${virtualIpAddr}:6443/\" fi EOF $ sudo systemctl enable keepalived.service $ sudo systemctl start keepalived.service extend etcd prepare$ sudo mkdir -p ${etcdSSLPath} $ cd ${etcdSSLPath} [!TIP] setup certificate in primary control plane node FILE DESCRIPTION ca.csr The signing request that the Root will sign ca.pem The unsigned intermediate so it’s useless, you can discard this one ca-key.pem The private key for your CA, do not lose this or share it configuration generate the default json file: $ cfssl print-defaults config > ca-config.json $ cfssl print-defaults csr > ca-csr.json ca-config.json controller01 $ sudo bash -c 'cat > ${etcdSSLPath}/ca-config.json' CA controller01 $ sudo bash -c 'cat > ${etcdSSLPath}/ca-csr.json' client controller01 $ sudo bash -c 'cat > ${etcdSSLPath}/client.json' ca and client certs $ cd ${etcdSSLPath} # ca $ sudo /usr/local/bin/cfssl gencert \\ -initca ca-csr.json | sudo /usr/local/bin/cfssljson -bare ca - # client $ sudo /usr/local/bin/cfssl gencert \\ -ca=ca.pem \\ -ca-key=ca-key.pem \\ -config=ca-config.json \\ -profile=client client.json | sudo /usr/local/bin/cfssljson -bare client result controller01 $ ls ca-config.json ca.csr ca-csr.json ca-key.pem ca.pem ... controller01 $ ls ca-config.json ca.csr ca-csr.json ca-key.pem ca.pem client.csr client.json client-key.pem client.pem check expired time $ openssl x509 -in ca.pem -text -noout | grep -w Not Not Before: Sep 10 10:44:00 2019 GMT Not After : Sep 8 10:44:00 2024 GMT verify$ ls /etc/etcd/ssl/*.pem | grep -Ev 'key.pem$' | xargs -L 1 -t -i bash -c 'openssl verify -CAfile ca.pem {}' bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/ca.pem /etc/etcd/ssl/ca.pem: OK bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/client.pem /etc/etcd/ssl/client.pem: OK bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/peer.pem /etc/etcd/ssl/peer.pem: OK bash -c openssl verify -CAfile ca.pem /etc/etcd/ssl/server.pem /etc/etcd/ssl/server.pem: OK copy certs [!TIP] copy ected certificates to peer control nodes # running in primary control plane node $ for i in {2..3}; do ssh master0${i} 'sudo mkdir -p ${etcdSSLPath}' for pkg in ca-config.json ca-key.pem ca.pem client-key.pem client.pem; do rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ ${etcdSSLPath}/${pkg} \\ master0${i}:${etcdSSLPath}/ done done # or running in peer control nodes one by one $ for pkg in ca-config.json ca-key.pem ca.pem client-key.pem client.pem; do sudo rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ root@${leadHost}:${etcdSSLPath}/${pkg} \\ ${etcdSSLPath}/ done peer [!TIP] running in all masters $ sudo bash -c \"/usr/local/bin/cfssl print-defaults csr > ${etcdSSLPath}/config.json\" $ sudo sed -i '0,/CN/{s/example\\.net/'\"${peerName}\"'/}' ${etcdSSLPath}/config.json $ sudo sed -i 's/www\\.example\\.net/'\"${ipAddr}\"'/' ${etcdSSLPath}/config.json $ sudo sed -i 's/example\\.net/'\"${peerName}\"'/' ${etcdSSLPath}/config.json $ cd ${etcdSSLPath}/ $ ls ca-config.json ca-csr.json ca.pem client.json client.pem ca.csr ca-key.pem client.csr client-key.pem config.json $ sudo /usr/local/bin/cfssl gencert \\ -ca=ca.pem \\ -ca-key=ca-key.pem \\ -config=ca-config.json \\ -profile=server config.json | sudo /usr/local/bin/cfssljson -bare server $ sudo /usr/local/bin/cfssl gencert \\ -ca=ca.pem \\ -ca-key=ca-key.pem \\ -config=ca-config.json \\ -profile=peer config.json | sudo /usr/local/bin/cfssljson -bare peer # in peer control nodes $ ls ca-config.json ca.pem client.pem peer.csr peer.pem server-key.pem ca-key.pem client-key.pem config.json peer-key.pem server.csr server.pem or ( just example )$ cat enable etcd service [!TIP] running in all masters $ sudo bash -c 'cat >/etc/systemd/system/etcd.service' /etc/etcd/etcd.conf' HAProxy [!TIP] for HA-Proxy version 2.0.6 $ sudo bash -c 'cat > /etc/haproxy/haproxy.cfg' : maxconn 50 stats refresh 10s stats realm HAProxy\\ Statistics stats uri /healthy $ sudo systemctl enable haproxy.service $ sudo systemctl start haproxy.service $ sudo ss -lnt | grep -E \"16443|8080\" kubeadm init kubeadm-conf.yaml [!TIP] create kubeconfig in all masters $ cat > kubeadm-conf.yaml init controller [!TIP] init controller in primary control plane node ONLY $ sudo modprobe br_netfilter $ sudo sysctl net.bridge.bridge-nf-call-iptables=1 $ sudo sysctl net.bridge.bridge-nf-call-ip6tables=1 $ sudo swapoff -a $ sudo bash -c \"sed -e 's:^\\\\(.*swap.*\\\\)$:# \\\\1:' -i /etc/fstab\" $ setenforce 0 $ sudo bash -c \"sed 's/^SELINUX=enforcing$/SELINUX=permissive/' -i /etc/selinux/config\" $ sudo kubeadm init --config kubeadm-conf.yaml --ignore-preflight-errors=all $ mkdir -p \"$HOME/.kube\" $ sudo cp -i /etc/kubernetes/admin.conf \"$HOME/.kube/config\" $ sudo chown \"$(id -u)\":\"$(id -g)\" \"$HOME/.kube/config\" sync PKI [!TIP] sync PKI in peer controller nodes ONLY $ find /etc/kubernetes/pki -type f -regextype posix-extended -regex '^.+/pki/[^/]+\\.(key|crt|pub)$' -print xargs -L1 -t -i bash -c 'sudo rsync -avzrlpgoDP -e \"ssh -q -i $HOME/.ssh/id_ed25519\" --rsync-path='sudo rsync' devops@:{} {}' # or $ find /etc/kubernetes/pki/ -type f -regex '^.*\\.\\(key\\|crt\\|pub\\)$' -print | xargs -L1 -t -i bash -c 'sudo rsync -avzrlpgoDP -e \"ssh -q -i $HOME/.ssh/id_ed25519\" --rsync-path='sudo rsync' devops@:{} {}' # or $ for pkg in '*.key' '*.crt' '*.pub'; do sudo rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ root@${leadIP}:\"/etc/kubernetes/pki/${pkg}\" \\ /etc/kubernetes/pki/ done $ sudo rm -rf /etc/kubernetes/pki/apiserver* $ sudo cp -r /root/etcd* /etc/kubernetes/pki/ sample set up a high availability etcd cluster with kubeadm # Update HOST0, HOST1 and HOST2 with the IPs of your hosts export HOST0=10.0.0.6 export HOST1=10.0.0.7 export HOST2=10.0.0.8 # Update NAME0, NAME1 and NAME2 with the hostnames of your hosts export NAME0=\"infra0\" export NAME1=\"infra1\" export NAME2=\"infra2\" # Create temp directories to store files that will end up on other hosts. mkdir -p /tmp/${HOST0}/ /tmp/${HOST1}/ /tmp/${HOST2}/ HOSTS=(${HOST0} ${HOST1} ${HOST2}) NAMES=(${NAME0} ${NAME1} ${NAME2}) for i in \"${!HOSTS[@]}\"; do HOST=${HOSTS[$i]} NAME=${NAMES[$i]} cat /tmp/${HOST}/kubeadmcfg.yaml --- apiVersion: \"kubeadm.k8s.io/v1beta3\" kind: InitConfiguration nodeRegistration: name: ${NAME} localAPIEndpoint: advertiseAddress: ${HOST} --- apiVersion: \"kubeadm.k8s.io/v1beta3\" kind: ClusterConfiguration etcd: local: serverCertSANs: - \"${HOST}\" peerCertSANs: - \"${HOST}\" extraArgs: initial-cluster: ${NAMES[0]}=https://${HOSTS[0]}:2380,${NAMES[1]}=https://${HOSTS[1]}:2380,${NAMES[2]}=https://${HOSTS[2]}:2380 initial-cluster-state: new name: ${NAME} listen-peer-urls: https://${HOST}:2380 listen-client-urls: https://${HOST}:2379 advertise-client-urls: https://${HOST}:2379 initial-advertise-peer-urls: https://${HOST}:2380 EOF done Generate the certificate authority [!TIP] to generate: /etc/kubernetes/pki/etcd/ca.crt /etc/kubernetes/pki/etcd/ca.key $ kubeadm init phase certs etcd-ca Create certificates for each member kubeadm init phase certs etcd-server --config=/tmp/${HOST2}/kubeadmcfg.yaml kubeadm init phase certs etcd-peer --config=/tmp/${HOST2}/kubeadmcfg.yaml kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST2}/kubeadmcfg.yaml kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST2}/kubeadmcfg.yaml cp -R /etc/kubernetes/pki /tmp/${HOST2}/ # cleanup non-reusable certificates find /etc/kubernetes/pki -not -name ca.crt -not -name ca.key -type f -delete kubeadm init phase certs etcd-server --config=/tmp/${HOST1}/kubeadmcfg.yaml kubeadm init phase certs etcd-peer --config=/tmp/${HOST1}/kubeadmcfg.yaml kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST1}/kubeadmcfg.yaml kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST1}/kubeadmcfg.yaml cp -R /etc/kubernetes/pki /tmp/${HOST1}/ find /etc/kubernetes/pki -not -name ca.crt -not -name ca.key -type f -delete kubeadm init phase certs etcd-server --config=/tmp/${HOST0}/kubeadmcfg.yaml kubeadm init phase certs etcd-peer --config=/tmp/${HOST0}/kubeadmcfg.yaml kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST0}/kubeadmcfg.yaml kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST0}/kubeadmcfg.yaml # No need to move the certs because they are for HOST0 # clean up certs that should not be copied off this host find /tmp/${HOST2} -name ca.key -type f -delete find /tmp/${HOST1} -name ca.key -type f -delete copy certificates and kubeadm configs USER=ubuntu HOST=${HOST1} scp -r /tmp/${HOST}/* ${USER}@${HOST}: ssh ${USER}@${HOST} USER@HOST $ sudo -Es root@HOST $ chown -R root:root pki root@HOST $ mv pki /etc/kubernetes/ create the static pod manifests root@HOST0 $ kubeadm init phase etcd local --config=/tmp/${HOST0}/kubeadmcfg.yaml root@HOST1 $ kubeadm init phase etcd local --config=$HOME/kubeadmcfg.yaml root@HOST2 $ kubeadm init phase etcd local --config=$HOME/kubeadmcfg.yaml [optional]: check the cluster healthdocker run --rm -it \\ --net host \\ -v /etc/kubernetes:/etc/kubernetes k8s.gcr.io/etcd:${ETCD_TAG} etcdctl \\ --cert /etc/kubernetes/pki/etcd/peer.crt \\ --key /etc/kubernetes/pki/etcd/peer.key \\ --cacert /etc/kubernetes/pki/etcd/ca.crt \\ --endpoints https://${HOST0}:2379 \\ endpoint health \\ --cluster ... https://[HOST0 IP]:2379 is healthy: successfully committed proposal: took = 16.283339ms https://[HOST1 IP]:2379 is healthy: successfully committed proposal: took = 19.44402ms https://[HOST2 IP]:2379 is healthy: successfully committed proposal: took = 35.926451ms tips kubeadm init [!TIP] kubeadm init also exposes a flag called --skip-phases that can be used to skip certain phases. The flag accepts a list of phase names and the names can be taken from the above ordered list. $ sudo kubeadm init phase control-plane all --config=configfile.yaml $ sudo kubeadm init phase etcd local --config=configfile.yaml # you can now modify the control plane and etcd manifest files $ sudo kubeadm init --skip-phases=control-plane,etcd --config=configfile.yaml kubeadm init phase control-plane control plane$ kubeadm init phase control-plane [flags] all$ kubeadm init phase control-plane all [flags] [--config config.yaml] apiserver $ kubeadm init phase control-plane apiserver [flags] [!TIP] options: -h, --help --apiserver-advertise-address --apiserver-bind-port Default: 6443 --apiserver-extra-args --cert-dir Default: \"/etc/kubernetes/pki\" --config --control-plane-endpoint --dry-run --feature-gates --image-repository Default: \"k8s.gcr.io\" --kubernetes-version Default: \"stable-1\" --patches --service-cidr Default: \"10.96.0.0/12\" --rootfs controller-manager $ kubeadm init phase control-plane controller-manager [flags] [!TIP] options: -h, --help --cert-dir Default: \"/etc/kubernetes/pki\" --config --apiserver-extra-args --dry-run --image-repository Default: \"k8s.gcr.io\" --kubernetes-version Default: \"stable-1\" --patches --pod-network-cidr --rootfs scheduler $ kubeadm init phase control-plane scheduler [flags] [!TIP] options: -h, --help --cert-dir Default: \"/etc/kubernetes/pki\" --config --dry-run --image-repository Default: \"k8s.gcr.io\" --kubernetes-version Default: \"stable-1\" --patches --scheduler-extra-args --rootfs kubeadm init phase etcd etcd$ kubeadm init phase etcd [flags] local $ kubeadm init phase etcd local [flags] [!TIP] options: -h, --help --cert-dir Default: \"/etc/kubernetes/pki\" --config --image-repository Default: \"k8s.gcr.io\" --patches --rootfs kubeadm init phase upload-config $ kubeadm init phase upload-certs [flags] [!TIP] options: -h, --help --certificate-key --config --kubeconfig Default: \"/etc/kubernetes/admin.conf\" --skip-certificate-key-print --upload-certs --rootfs kubeadm init phase mark-control-plane $ kubeadm init phase mark-control-plane [flags] [--config config.yaml] [--node-name myNode] kubeadm init phase bootstrap-token $ kubeadm init phase bootstrap-token [flags] [--kubeconfig ] [--config ] [--skip-token-print] kubeadm init phase kubelet-finalize kubelet-finalize$ kubeadm init phase kubelet-finalize [flags] kubelet-finalize-all$ kubeadm init phase kubelet-finalize all [flags] [--cert-dir /etc/kubernetes/pki] [--config ] kubelet-finalize-cert-rotation$ kubeadm init phase kubelet-finalize experimental-cert-rotation [flags] [--cert-dir /etc/kubernetes/pki] [--config ] tear down $ kubectl drain --delete-local-data --force --ignore-daemonsets $ kubectl delete node $ sudo kubeadm reset [preflight] Running pre-flight checks. [reset] Stopping the kubelet service. [reset] Unmounting mounted directories in \"/var/lib/kubelet\" [reset] Removing kubernetes-managed containers. [reset] Deleting contents of stateful directories: [/var/lib/kubelet /etc/cni/net.d /var/lib/dockershim /var/run/kubernetes /var/lib/etcd] [reset] Deleting contents of config directories: [/etc/kubernetes/manifests /etc/kubernetes/pki] [reset] Deleting files: [/etc/kubernetes/admin.conf /etc/kubernetes/kubelet.conf /etc/kubernetes/bootstrap-kubelet.conf /etc/kubernetes/controller-manager.conf /etc/kubernetes/scheduler.conf] $ sudo systemctl stop kubelet $ sudo systemctl stop docker $ sudo systemctl stop containerd $ sudo systemctl disable --now kubelet $ sudo systemctl disable --now docker $ sudo systemctl disable --now containerd $ docker system prune -a -f $ sudo ifconfig cni0 down $ sudo ifconfig flannel.1 down $ sudo rm -rf /etc/kubernetes /var/lib/cni /var/lib/kubelet/* /etc/cni/net.d /etc/cni/ ~/.kube/ $ sudo rm -rf /var/log/pods # or $ sudo rm -rf /etc/kubernetes $ sudo rm -rf /var/lib/cni $ sudo rm -rf /var/lib/kubelet/* $ sudo rm -rf /etc/cni/net.d $ sudo rm -rf /etc/cni/ $ rm -rf ~/.kube/ $ sudo apt-get purge kubeadm kubectl kubelet kubernetes-cni kube* $ sudo apt-get autoremove # or $ sudo dnf clean all $ sudo iptables -P INPUT ACCEPT $ sudo iptables -P FORWARD ACCEPT $ sudo iptables -P OUTPUT ACCEPT # or $ sudo iptables -P INPUT ACCEPT && sudo iptables -P FORWARD ACCEPT && sudo iptables -P OUTPUT ACCEPT $ sudo iptables -t nat -F $ sudo iptables -t mangle -F $ sudo iptables -F $ sudo iptables -X # or $ sudo iptables -F && sudo iptables -t nat -F && sudo iptables -t mangle -F && sudo iptables -X Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/kubeadm/etcd.html":{"url":"virtualization/kubernetes/kubeadm/etcd.html","title":"etcd","keywords":"","body":" extenal etcd certificates certificate signing request configuration enable service verify stacked etcd configuration operate debug into stacked etcd cluster replacing a failed etcd member references: clustering guide clustering.md setting up etcd cluster with tls authentication enabled configuring etcd rbac deploy a secure etcd cluster set up a high availability etcd cluster with kubeadm creating highly available clusters with kubeadm etcd backup and restore in kubernetes: step by step operating etcd clusters for kubernetes operating etcd clusters for kubernetes understand how the etcd cluster is configured tutorial: set up a secure and highly available etcd cluster runtime reconfiguration * configuration flags etcd.conf.yml.sample extenal etcd topology certificates located in : /etc/etcd/ssl [!TIP] You need: Three or more machines that meet kubeadm's minimum requirements for the control-plane nodes. Having an odd number of control plane nodes can help with leader selection in the case of machine or zone failure. including a container runtime, already set up and working Three or more machines that meet kubeadm's minimum requirements for the workers including a container runtime, already set up and working Full network connectivity between all machines in the cluster (public or private network) Superuser privileges on all machines using sudo You can use a different tool; this guide uses sudo in the examples. SSH access from one device to all nodes in the system kubeadm and kubelet already installed on all machines. And you also need: Three or more additional machines, that will become etcd cluster members. Having an odd number of members in the etcd cluster is a requirement for achieving optimal voting quorum. These machines again need to have kubeadm and kubelet installed. These machines also require a container runtime, that is already set up and working. See External etcd topology for context. stacked etcd topology certificates located in : /etc/kubernetes/pki/etcd [!TIP] You need: Three or more machines that meet kubeadm's minimum requirements for the control-plane nodes. Having an odd number of control plane nodes can help with leader selection in the case of machine or zone failure. including a container runtime, already set up and working Three or more machines that meet kubeadm's minimum requirements for the workers including a container runtime, already set up and working Full network connectivity between all machines in the cluster (public or private network) Superuser privileges on all machines using sudo You can use a different tool; this guide uses sudo in the examples. SSH access from one device to all nodes in the system kubeadm and kubelet already installed on all machines. See Stacked etcd topology for context. extenal etcd certificates $ sudo mkdir -p /etc/etcd/ssl certificate signing request generate the etcd certificates in major kubernetes master. and sync to the others following kuberentes masters. $ sudo bash -c 'cat > /etc/etcd/ssl/ca-config.json' ca $ sudo bash -c 'cat > /etc/etcd/ssl/ca-csr.json' client $ sudo bash -c 'cat > /etc/etcd/ssl/client.json' result $ ls ca-config.json ca.csr ca-csr.json ca-key.pem ca.pem client.csr client.json client-key.pem client.pem sync to the others masters $ for _host in master02 master03; do ssh ${_host} 'sudo mkdir -p /etc/etcd/ssl' rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ /etc/etcd/ssl/*.pem \\ ${_host}:/etc/etcd/ssl/ rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ /etc/etcd/ssl/ca-config.json \\ ${_host}:/etc/etcd/ssl/ done configuration etcd.service $ sudo bash -c 'cat >/etc/systemd/system/etcd.service' etcd.conf $ etcdInitialCluster=\"master01=https://192.168.100.200:2380\" etcdInitialCluster+=\",master02=https://192.168.100.201:2380\" etcdInitialCluster+=\",master03=https://192.168.100.202:2380\" $ interface=$(netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}') $ ipAddr=$(ip a s \"${interface}\" | sed -rn 's|\\W*inet[^6]\\W*([0-9\\.]{7,15}).*$|\\1|p') $ sudo bash -c 'cat > /etc/etcd/etcd.conf' enable service $ sudo systemctl daemon-reload $ sudo systemctl enable --now etcd $ sudo systemctl start etcd.service verify $ sudo systemctl status etcd $ sudo /usr/local/bin/etcdctl --ca-file /etc/etcd/ssl/ca.pem \\ --cert-file /etc/etcd/ssl/client.pem \\ --key-file /etc/etcd/ssl/client-key.pem \\ --endpoints https://192.168.100.200:2379,https://192.168.100.201:2379,https://192.168.100.202:2379 \\ cluster-health tips$ alias etcdctl=\"sudo /usr/local/bin/etcdctl --ca-file /etc/etcd/ssl/ca.pem --cert-file /etc/etcd/ssl/client.pem --key-file /etc/etcd/ssl/client-key.pem --endpoints https://192.168.100.200:2379,https://192.168.100.201:2379,https://192.168.100.202:2379\" $ etcdctl cluster-health member ae76391b129**** is healthy: got healthy result from https://192.168.100.200:2379 member cda996b3ea5a*** is healthy: got healthy result from https://192.168.100.201:2379 member e295a3c1654e*** is healthy: got healthy result from https://192.168.100.202:2379 cluster is healthy stacked etcd configuration $ sudo cat /etc/kubernetes/manifests/etcd.yaml operate debug into stacked etcd cluster references: replacing a failed etcd member It is recommended to back up this directory to an off-cluster location before removing the contents. You can remove this backup after a successful restore ```bash $ sudo rm -rf /var/lib/etcd/* or $ sudo mv /var/lib/etcd/member{,.backup} ``` $ docker run -it \\ -v /var/lib/etcd:/var/lib/etcd \\ -v /etc/kubernetes/pki/etcd:/etc/kubernetes/pki/etcd \\ -p 2380:2380 \\ -p 2379:2379 \\ --network=host \\ k8s.gcr.io/etcd:3.2.24 $ etcdctl --ca-file /etc/kubernetes/pki/etcd/ca.crt \\ --cert-file /etc/kubernetes/pki/etcd/peer.crt \\ --key-file /etc/kubernetes/pki/etcd/peer.key \\ -endpoints=https://10.0.0.1:2379,https://10.0.0.2:2379,https://10.0.0.3:2379 \\ member list more $ etcdctl member list $ etcdctl member remove # peerURL using port 2380 by default. clientURL using 2379 by default $ etcdctl member add $ etcdctl member update add tag --initial-cluster-state=existing in /etc/kubernetes/manifests/etcd.yaml $ sudo cat /etc/kubernetes/manifests/etcd.yaml apiVersion: v1 kind: Pod metadata: ... spec: containers: - command: - etcd - --advertise-client-urls=https://10.0.0.2:2379 - --initial-advertise-peer-urls=https://10.0.0.2:2380 - --initial-cluster=member1=https://10.0.0.1:2380,member3=https://10.0.0.3:2380,member2=https://10.0.0.2:2380 - --listen-client-urls=https://10.0.0.2:2379 - --listen-peer-urls=https://10.0.0.2:2380 - --name=member2 - --cert-file=/etc/kubernetes/pki/etcd/server.crt - --client-cert-auth=true - --data-dir=/var/lib/etcd - --key-file=/etc/kubernetes/pki/etcd/server.key - --peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt - --peer-client-cert-auth=true - --peer-key-file=/etc/kubernetes/pki/etcd/peer.key - --peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt - --snapshot-count=10000 - --trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt - --initial-cluster-state=existing image: k8s.gcr.io/etcd:3.2.24 imagePullPolicy: IfNotPresent livenessProbe: exec: command: - /bin/sh - -ec - ETCDCTL_API=3 etcdctl --endpoints=https://10.0.0.1:2379,https://10.0.0.2:2379,https://10.0.0.3:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/healthcheck-client.crt --key=/etc/kubernetes/pki/etcd/healthcheck-client.key get foo ... replacing a failed etcd member [!TIP] consider a three-member etcd cluster. Let the URLs be: member1=http://10.0.0.1 member2=http://10.0.0.2 member3=http://10.0.0.3 When member1 fails, replace it with member4=http://10.0.0.4. get member id of failed member $ etcdctl --endpoints=http://10.0.0.2,http://10.0.0.3 member list 8211f1d0f64f3269, started, member1, http://10.0.0.1:2380, http://10.0.0.1:2379 91bc3c398fb3c146, started, member2, http://10.0.0.2:2380, http://10.0.0.2:2379 fd422379fda50e48, started, member3, http://10.0.0.3:2380, http://10.0.0.3:2379 remove failed member $ etcdctl member remove 8211f1d0f64f3269 Removed member 8211f1d0f64f3269 from cluster add new members $ etcdctl member add member4 --peer-urls=http://10.0.0.4:2380 Member 2be1eb8f84b7f63e added to cluster ef37ad9dc622a7c4 start new member with IP $ export ETCD_NAME=\"member4\" $ export ETCD_INITIAL_CLUSTER=\"member2=http://10.0.0.2:2380,member3=http://10.0.0.3:2380,member4=http://10.0.0.4:2380\" $ export ETCD_INITIAL_CLUSTER_STATE=existing $ etcd [flags] additional options [!TIP] Update the --etcd-servers flag for the Kubernetes API servers to make Kubernetes aware of the configuration changes, then restart the Kubernetes API servers. Update the load balancer configuration if a load balancer is used in the deployment. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/kubeadm/ha.html":{"url":"virtualization/kubernetes/kubeadm/ha.html","title":"ha","keywords":"","body":" tools cfssl & cfssljson etcd keepalived haproxy helm external etcd [!TIP|label:references] extenal etcd topology certificates located in : /etc/etcd/ssl stacked etcd topology certificates located in : /etc/kubernetes/pki/etcd Proposal for a highly available control plane configuration for ‘kubeadm’ deployments Proposal for kubeadm self-hosted HA deployment kubeadm upgrades / self-hosting / HA v1.8 implementation working group Ansible Tutorial: Setup HAProxy and HTTPS from Let’s Encrypt with Ansible * Kubernetes High Availability tools cfssl & cfssljson $ sudo bash -c \"curl -o /usr/local/bin/cfssl https://pkg.cfssl.org/R1.2/cfssl_linux-amd64\" $ sudo bash -c \"curl -o /usr/local/bin/cfssljson https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\" $ sudo chmod +x /usr/local/bin/cfssl* etcd $ curl -fsSL https://github.com/etcd-io/etcd/releases/download/v3.3.15/etcd-v3.3.15-linux-amd64.tar.gz | sudo tar -xzv --strip-components=1 -C /usr/local/bin/ keepalived references: Step 26 - KeepAliveD $ mkdir -p ~/temp $ sudo mkdir -p /etc/keepalived/ $ curl -fsSL ${keepaliveDownloadUrl}/keepalived-2.0.18.tar.gz | tar xzf - -C ~/temp $ pushd . $ cd ~/temp/keepalived-2.0.18 $ ./configure && make $ sudo make install $ sudo cp keepalived/keepalived.service /etc/systemd/system/ $ popd $ rm -rf ~/temp haproxy $ curl -fsSL http://www.haproxy.org/download/2.0/src/haproxy-2.0.6.tar.gz | tar xzf - -C ~ $ pushd . $ cd ~/haproxy-2.0.6 $ make TARGET=linux-glibc \\ USE_LINUX_TPROXY=1 \\ USE_ZLIB=1 \\ USE_REGPARM=1 \\ USE_PCRE=1 \\ USE_PCRE_JIT=1 \\ USE_OPENSSL=1 \\ SSL_INC=/usr/include \\ SSL_LIB=/usr/lib \\ ADDLIB=-ldl \\ USE_SYSTEMD=1 $ sudo make install $ sudo cp haproxy /usr/sbin/ $ sudo cp examples/haproxy.init /etc/init.d/haproxy && sudo chmod +x $_ $ popd $ rm -rf ~/haproxy-2.0.6 helm $ curl -fsSL \\ https://get.helm.sh/helm-v2.14.3-linux-amd64.tar.gz | sudo tar -xzv --strip-components=1 -C /usr/local/bin/ $ while read -r _i; do sudo chmod +x \"/usr/local/bin/${_i}\" done configuration $ helm init $ helm init --client-only $ kubectl -n kube-system create serviceaccount tiller $ kubectl create clusterrolebinding tiller-cluster-rule \\ --clusterrole=cluster-admin \\ --serviceaccount=kube-system:tiller $ kubectl -n kube-system patch deploy \\ tiller-deploy -p '{\"spec\":{\"template\":{\"spec\":{\"serviceAccount\":\"tiller\"}}}}' $ helm repo add jetstack https://charts.jetstack.io external etcd Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/kubectl.html":{"url":"virtualization/kubernetes/kubectl.html","title":"kubectl","keywords":"","body":" what is kubectl install osx linux windows get get all get cluster status get po get all images list list image from a single deploy list Container images by Pod list all Container images in all namespaces list Container images filtering by Pod namespace list Container images using a go-template instead of jsonpath list all quota check api server healthy get apiservers get apiresources check etcd output format apply rollback what is kubectl kubectl reference: * Cheatsheet - Kubectl * kubectl cheatsheet 23 Advanced kubectl commands 使用 kubectl 管理 Secret JSONPath Support Command line tool (kubectl) * Custom columns install [!NOTE] references: install and set up kubectl install and set up kubectl on macos install and set up kubectl on linux install and set up kubectl on windows Amazon EKS.pdf installing or updating kubectl info: $ uname | awk '{print tolower($0)}' darwin $ curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt v1.26.2 $ curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/$(uname | awk '{print tolower($0)}')/amd64/kubectl $ chmod +x ./kubectl $ sudo mv ./kubectl /usr/local/bin/kubectl # verify $ kubectl version --client --short Flag --short has been deprecated, and will be removed in the future. The --short output will become the default. Client Version: v1.25.3 Kustomize Version: v4.5. kubectl-convert [!NOTE] A plugin for Kubernetes command-line tool kubectl, which allows you to convert manifests between different API versions. This can be particularly helpful to migrate manifests to a non-deprecated api version with newer Kubernetes release. # intel $ curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/darwin/amd64/kubectl-convert\" # apple silicon $ curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/darwin/arm64/kubectl-convert\" $ chmod +x ./kubectl-convert $ sudo mv ./kubectl-convert /usr/local/bin/kubectl-convert $ sudo chown root: /usr/local/bin/kubectl-convert sha256 check $ curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/$(uname | awk '{print tolower($0)}')/amd64/kubectl $ curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/$(uname | awk '{print tolower($0)}')/amd64/kubectl.sha256 $ echo \"$(cat kubectl.sha256) kubectl\" | shasum -a 256 --check osx # intel $ curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/darwin/amd64/kubectl\" # apple silicon $ curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/darwin/arm64/kubectl\" # or via brew $ brew install kubectl completion [!NOTE] The Homebrew installation of bash-completion v2 sources all the files in the BASH_COMPLETION_COMPAT_DIR directory, that's why the latter two methods work $ brew install bash-completion # Bash 3.2 $ brew install bash-completion@2 # Bash 4.1+ $ kubectl completion bash > $(brew --prefix)/etc/bash_completion.d/kubectl linux $ curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/$(uname | awk '{print tolower($0)}')/amd64/kubectl $ chmod +x ./kubectl $ sudo mv ./kubectl /usr/local/bin/kubectl completion $ echo 'source > ~/.bash_profile $ kubectl completion bash > /usr/local/etc/bash_completion.d/kubectl $ echo 'alias k=kubectl' >> ~/.bash_profile $ echo 'complete -o default -F __start_kubectl k' >> ~/.bash_profile windows > choco install kubernetes-cli > cd %USERPROFILE% > mkdir .kube > touch .kube/config get reference: output options:-o custom-columns=:[,:]... get all $ kubectl get all -A get cluster status $ kubectl get cs NAME STATUS MESSAGE ERROR controller-manager Healthy ok scheduler Healthy ok etcd-1 Healthy {\"health\":\"true\"} etcd-2 Healthy {\"health\":\"true\"} etcd-0 Healthy {\"health\":\"true\"} get po name$ kubectl -n devops get po -o custom-columns='NAME:metadata.name' or $ kubectl -n devops get deploy jenkins -o custom-columns=\"NAME:metadata.name, IMAGES:..image\" NAME IMAGES jenkins jenkins/jenkins:2.187 get where pods are running $ kubectl get pod -o=custom-columns=NAME:.metadata.name,STATUS:.status.phase,NODE:.spec.nodeName \\ --all-namespaces sort pods by nodeName $ kubectl get pods -o wide --sort-by=\"{.spec.nodeName}\" sort by restart count $ kubectl get pods --sort-by=\"{.status.containerStatuses[:1].restartCount}\" sort by age $ kubectl get replicasets -o wide --sort-by=.metadata.creationTimestamp or$ kubectl get pods --sort-by=.status.startTime or$ kubectl get pods --field-selector=status.phase=Pending \\ --sort-by=.metadata.creationTimestamp | awk 'match($5,/^[1-5]d/) {print $0}' get all images $ kubectl get pods --all-namespaces \\ -o jsonpath=\"{..image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq -c list list image from a single deploy $ kubectl -n devops get deployment jenkins -o=jsonpath='{.spec.template.spec.containers[:1].image}' jenkins/jenkins:2.187 or$ kubectl -n devops get deploy jenkins -o jsonpath=\"{..image}\" jenkins/jenkins:2.187 list Container images by Pod $ kubectl get pods --all-namespaces -o=jsonpath=\"{..image}\" -l app=nginx or $ kubectl -n get po \\ -o custom-columns='NAME:metadata.name,IMAGES:spec.containers[*].image' or $ kubectl -n get po -o jsonpath=\"{..containerID}\" # or $ kubectl -n get po \\ -o go-template \\ --template=\"{{ range .status.containerStatuses }}{{ .containerID }}{{end}}\" list all Container images in all namespaces $ kubectl get pods --all-namespaces -o jsonpath=\"{.items[*].spec.containers[*].image}\" or$ kubectl get pods --all-namespaces -o jsonpath=\"{..image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq -c list Container images filtering by Pod namespace $ kubectl -n kube-system get pods -o jsonpath=\"{..image}\" list Container images using a go-template instead of jsonpath $ kubectl get po --all-namespaces \\ -o go-template \\ --template=\"{{range .items}}{{range .spec.containers}}{{.image}} {{end}}{{end}}\" or$ kubectl get deploy \\ -o=jsonpath=\"{range .items[*]}{'\\n'}{.metadata.name}{':\\t'}{range .spec.template.spec.containers[*]}{.image}{', '}{end}{end}\" list all quota $ for _i in $(kubectl get ns --no-headers | awk -F' ' '{print $1}'); do echo ------------- ${_i} ------------ kubectl -n ${_i} describe quota done check api server healthy $ kubectl get apiservice delete apiservers$ kubectl delete apiservice v1beta1.metrics.k8s.io get apiservers $ kubectl get --raw=/apis get apiresources check available $ kubectl api-resources $ kubectl api-versions check apiservices registered $ kubectl get apiservices.apiregistration.k8s.io $ kubectl get apiservices.apiregistration.k8s.io v1beta1.metrics.k8s.io -o yaml $ kubectl get apiservices.apiregistration.k8s.io NAME SERVICE AVAILABLE AGE v1. Local True 4y v1.apps Local True 4y v1.authentication.k8s.io Local True 4y v1.authorization.k8s.io Local True 4y v1.autoscaling Local True 4y v1.batch Local True 4y v1.monitoring.coreos.com Local True 168d v1.networking.k8s.io Local True 4y v1.rbac.authorization.k8s.io Local True 4y v1.storage.k8s.io Local True 4y v1beta1.admissionregistration.k8s.io Local True 4y v1beta1.apiextensions.k8s.io Local True 4y v1beta1.apps Local True 4y v1beta1.authentication.k8s.io Local True 4y v1beta1.authorization.k8s.io Local True 4y v1beta1.batch Local True 4y v1beta1.certificates.k8s.io Local True 4y v1beta1.coordination.k8s.io Local True 4y v1beta1.events.k8s.io Local True 4y v1beta1.extensions Local True 4y v1beta1.metrics.k8s.io kube-system/metrics-server False (ServiceNotFound) 188d v1beta1.policy Local True 4y v1beta1.rbac.authorization.k8s.io Local True 4y v1beta1.scheduling.k8s.io Local True 4y v1beta1.storage.k8s.io Local True 4y v1beta2.apps Local True 4y v2beta1.autoscaling Local True 4y v2beta2.autoscaling Local True 4y0 $ kubectl get apiservices.apiregistration.k8s.io v1beta1.metrics.k8s.io -o yaml --export apiVersion: apiregistration.k8s.io/v1 kind: APIService metadata: name: v1beta1.metrics.k8s.io spec: group: metrics.k8s.io groupPriorityMinimum: 100 insecureSkipTLSVerify: true service: name: prometheus-adapter namespace: monitoring version: v1beta1 versionPriority: 100 status: conditions: - lastTransitionTime: 2022-08-15T14:10:39Z message: all checks passed reason: Passed status: \"True\" type: Available troubleshooting [!NOTE|label:references:] $ kubectl api-resources error: unable to retrieve the complete list of server APIs: metrics.k8s.io/v1beta1: the server is currently unable to handle the request references: #1223: \"couldn't get resource list\" error #11772: Couldn't get resource list for metrics error #157: couldn't get resource list for metrics.k8s.io/v1beta1: the server is currently unable to handle the request Configure Service Accounts for Pods $ kubectl get apiservices.apiregistration.k8s.io NAME SERVICE AVAILABLE AGE v1beta1.metrics.k8s.io kube-system/metrics-server False (ServiceNotFound) 188d # remove metrics.k8s.io $ kubectl delete apiservices.apiregistration.k8s.io v1beta1.metrics.k8s.io # debug $ kubectl get secrets $(kubectl -n kube-system get sa metrics-server -o 'jsonpath={.secrets[].name}') Error from server (NotFound): secrets \"metrics-server-token-mr49q\" not found $ kubectl get secrets $(kubectl -n kube-system get sa metrics-server -o 'jsonpath={.secrets[].name}') \\ -o \"jsonpath={.data.ca\\.crt}\" | base64 -d | openssl x509 -text -noout | grep Not # get token $ kubectl get secrets $(kubectl -n kube-system get sa metrics-server -o 'jsonpath={.secrets[].name}') \\ -o \"jsonpath={.data.token}\" | base64 -d -w0 # get namespace $ kubectl get secrets $(kubectl -n kube-system get sa metrics-server -o 'jsonpath={.secrets[].name}') \\ -o \"jsonpath={.data.namespace}\" | base64 -d -w0 check etcd $ kubectl get --raw=/healthz/etcd ok output format [!NOTE|label:references:] Kubectl output options Getting Custom Output From Kubectl With Examples apply [!NOTE|label:referenecs] kube apply Declarative Management of Kubernetes Objects Using Configuration Files Understanding the Kubectl Apply Command How kubectl apply command works? oneline cmd $ cat edit-last-applied # Edit the last-applied-configuration annotations by type/name in YAML kubectl apply edit-last-applied deployment/nginx # Edit the last-applied-configuration annotations by file in JSON kubectl apply edit-last-applied -f deploy.yaml -o json rollback [!NOTE|label:references:] -** How do you rollback deployments in Kubernetes? Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/pod.html":{"url":"virtualization/kubernetes/pod.html","title":"pod","keywords":"","body":" filter via --field-selector list all Failed pods filter via Node Name filter via json list pod details for failure pods sort via --sort-by sorting pods by nodeName sort pods by restartCount sort by restart count sort via start time get the oldest pod sort via created time run & create pod deploy svc list watch pods with timestamp list pod status with timestamp list pod with nodename list all ready pods list error status pods list all pods statuses only list running images list running pods list pods on nodes output jsonpath management execute in pod restart po resource managemenet resource management for pods and containers assign cpu resources to containers and pods managing kubernetes resource limits troubleshooting debug svc references: * Create static Pods * Pod Lifecycle Pods Field Selectors Kubernetes Daemonset: A Comprehensive Guide Kubernetes Pod Priority, PriorityClass, and Preemption Explained [!NOTE|label:pod phase] VALUE DESCRIPTION Pending The Pod has been accepted by the Kubernetes cluster, but one or more of the containers has not been set up and made ready to run Running The Pod has been bound to a node, and all of the containers have been created Succeeded All containers in the Pod have terminated in success, and will not be restarted. Failed All containers in the Pod have terminated, and at least one container has terminated in failure Unknown For some reason the state of the Pod could not be obtained filter via --field-selector list all Failed pods $ kubectl -n get po \\ --field-selector status.phase=Failed filter via Node Name $ kubectl -n get po \\ [-o wide] \\ --field-selector spec.nodeName=master-node01 NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES devops-jenkins-659f4c6d44-d2w76 1/1 Running 0 2d22h **.***.*.** master-node01 filter all pods running in particular node $ kubectl --all-namespaces get po \\ [-o wide] \\ --field-selector spec.nodeName= filter all pods running in particular node via --template $ kubectl -n get po \\ --template '{{range .items}}{{if eq .spec.nodeName \"\"}}{{.metadata.name}}{{\"\\n\"}}{{end}}}{{end}}' via api$ curl --cacert ca.crt \\ --cert apiserver.crt \\ --key apiserver.key \\ https://:/api/v1/namespaces//pods?fieldSelector=spec.nodeName%3Dsomenodename filter via json $ kubectl get po -o json | jq -r '.items | sort_by(.spec.nodeName)[] | [.spec.nodeName,.metadata.name] | @tsv' list pod details for failure pods $ ns='my-namespace' $ keyword='tester' $ for p in $(kubectl -n ${ns} get po --field-selector status.phase=Failed -o=name | /bin/grep ${keyword}); do echo \"--- ${p} --- \"; kubectl -n ${ns} describe ${p} | grep -E 'Annotations|Status|Reason|Message'; done sort via --sort-by sorting pods by nodeName $ kubectl -n get po \\ -o wide \\ --sort-by=\"{.spec.nodeName}\" sort pods by restartCount $ kubectl -n get po --sort-by=\"{.status.containerStatuses[:1].restartCount}\" sort by restart count $ kubectl -n get pods --sort-by=.status.containerStatuses[0].restartCount sort via start time $ kubectl -n get po \\ --sort-by=.status.startTime get the oldest pod -1: means the last in the list $ kubectl -n get pods \\ --sort-by=.metadata.creationTimestamp \\ -o jsonpath='{.items[-1:].metadata.name}' sort via created time $ kubectl -n get pods \\ --sort-by=.metadata.creationTimestamp run & create pod # create and login $ kubectl run debug --image=busybox -it --rm # create and sleep $ kubectl run debug --image=busybox -- sleep infinity pod/debug created # created with specific nodeSelector $ kubectl run debug \\ --image=busybox \\ --overrides='{\"spec\": { \"nodeSelector\": {\"kubernetes.io/hostname\": \"k8s-node-01\"} }}' $ kubectl get pod NAME READY STATUS RESTARTS AGE debug 1/1 Running 0 6s # delete $ kubectl delete pod/debug pod \"debug\" deleted # attach $ kubectl attach -c -it # i.e.: $ kubectl attach debug -c debug -it deploy # format $ kubectl create deployment --image= [--replicas=n] # i.e.: $ kubectl create deployment nginx --image=nginx --replicas=2 deployment.apps/nginx created # optional $ kubectl scale deployment nginx --replicas=3 $ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-6799fc88d8-6clhp 1/1 Running 0 9s nginx-6799fc88d8-cjz56 1/1 Running 0 9s # delete $ kubectl delete deployment nginx deployment.apps \"nginx\" deleted svc $ kubectl expose deployment --port=80 --target-port=9376 list watch pods with timestamp [!NOTE|label:references:] Append timestamp to kubernetes --watch-only command $ kubectl get pods --watch-only | while read line ; do echo -e \"$(date +\"%Y-%m-%d %H:%M:%S.%3N\")\\t pods\\t $line\" ; done list pod status with timestamp [!NOTE|label:references:] Can kubectl describe show timestamp of pod events? via evnets$ kubectl get events -o custom-columns=FirstSeen:.firstTimestamp,LastSeen:.lastTimestamp,Count:.count,From:.source.component,Type:.type,Reason:.reason,Message:.message \\ --field-selector involvedObject.kind=Pod,involvedObject.name= via pod json$ kubectl get po -o json | jq -r '.status.conditions' [ { \"lastProbeTime\": null, \"lastTransitionTime\": \"2023-09-28T08:15:33Z\", \"status\": \"True\", \"type\": \"Initialized\" }, { \"lastProbeTime\": null, \"lastTransitionTime\": \"2023-11-23T02:33:09Z\", \"message\": \"containers with unready status: [config-reload]\", \"reason\": \"ContainersNotReady\", \"status\": \"False\", \"type\": \"Ready\" }, { \"lastProbeTime\": null, \"lastTransitionTime\": \"2023-11-23T02:33:09Z\", \"message\": \"containers with unready status: [config-reload]\", \"reason\": \"ContainersNotReady\", \"status\": \"False\", \"type\": \"ContainersReady\" }, { \"lastProbeTime\": null, \"lastTransitionTime\": \"2023-09-28T08:15:16Z\", \"status\": \"True\", \"type\": \"PodScheduled\" } ] list pod with nodename filter$ kubectl get po --all-namespaces -o wide --field-selector spec.nodeName= list$ kubectl get pods \\ --all-namespaces \\ --output 'jsonpath={range .items[*]}{.spec.nodeName}{\"\\t\"}{.metadata.namespace}{\"\\t\"}{.metadata.name}{\"\\n\"}{end} or list with custom-columns $ kubectl get pod \\ --all-namespaces -o=custom-columns=NAME:.metadata.name,STATUS:.status.phase,NODE:.spec.nodeName \\ list nodeName with podIP $ kubectl get pod \\ --all-namespaces \\ -o json | jq '.items[] | .spec.nodeName + \" \" + .status.podIP' list all ready pods [!NOTE|label:references] * imarslo : list all ready nodes $ kubectl get pods --all-namespaces -o json | jq -r '.items[] | select(.status.phase = \"Ready\" or ([ .status.conditions[] | select(.type == \"Ready\") ] | length ) == 1 ) | .metadata.namespace + \"\\t\" + .metadata.name' list all ImagePullBackOff pods [!NOTE|label:references] How can I view pods with kubectl and filter based on having a status of ImagePullBackOff? $ kubectl get pod --all-namespaces \\ -o=json | jq '.items[]|select(any( .status.containerStatuses[]; .state.waiting.reason==\"ImagePullBackOff\"))|.metadata.name' # or $ kubectl get pod --all-namespaces \\ -o jsonpath='{.items[?(@.status.containerStatuses[*].state.waiting.reason==\"ImagePullBackOff\")].metadata.name}' list error status pods reference: Viewing, finding resources kubectl get should have a way to filter for advanced pods status $ kubectl -n get po \\ --field-selector status.phase=Failed list and delete all error status pods $ for i in $(kubectl get po --no-headers --all-namespaces --field-selector status.phase=Failed -o=custom-columns=NAMESPACE:.metadata.namespace | sort -u); do kubectl -n $i delete po --field-selector status.phase=Failed --force --grace-period=0 done or $ kubectl -n delete po \\ --field-selector status.phase=Failed or $ kubectl -n get po \\ --field-selector=status.phase!=Running or $ kubectl --all-namespaces get po \\ --field-selector=status.phase!=Running,status.phase!=Succeeded or $ kubectl get po --all-namespaces -o json \\ | jq -r '.items[] \\ | select(.status.phase != \"Running\" \\ or ([ .status.conditions[] | select(.type == \"Ready\" and .status == \"False\") ] | length ) == 1 \\ ) \\ | .metadata.namespace + \"/\" + .metadata.name' list all pods statuses only $ kubectl -n get po \\ -o=jsonpath='{.items[*].status.phase}' Running Running Running Running Running Running Running Running Running list running images $ k4 -n get po -o jsonpath=\"{..image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq -c 2 gcr.io/kubernetes-helm/tiller:v2.14.3 6 k8s.gcr.io/coredns:1.2.2 6 k8s.gcr.io/etcd:3.2.24 6 k8s.gcr.io/kube-apiserver:v1.12.3 6 k8s.gcr.io/kube-controller-manager:v1.12.3 30 k8s.gcr.io/kube-proxy:v1.12.3 6 k8s.gcr.io/kube-scheduler:v1.12.3 4 k8s.gcr.io/metrics-server-amd64:v0.3.6 30 k8s.gcr.io/node-problem-detector:v0.8.1 2 kubernetesui/dashboard:v2.0.0-beta1 4 kubernetesui/metrics-scraper:v1.0.1 60 quay.io/coreos/flannel:v0.10.0-amd64 list running pods $ kubectl -n get po \\ -o=custom-columns=NAME:.metadata.name,STATUS:.status.phase,NODE:.spec.nodeName NAME STATUS NODE coredns-59dd98b545-7t25l Running k8s-node01 coredns-59dd98b545-lnklx Running k8s-node02 coredns-59dd98b545-ltj5p Running k8s-node03 ... list pods on nodes specific nodes $ kubectl get pods --all-namespaces \\ -o wide \\ --field-selector spec.nodeName= all nodes $ kubectl get pods -o wide \\ --sort-by=\"{.spec.nodeName}\" via label filter $ for n in $(kubectl get nodes -l your_label_key=your_label_value --no-headers | cut -d \" \" -f1); do kubectl get pods --all-namespaces --no-headers --field-selector spec.nodeName=${n} done via API $ curl --cacert ca.crt \\ --cert apiserver.crt \\ --key apiserver.key \\ https://:/api/v1/namespaces//pods?fieldSelector=spec.nodeName%3Dsomenodename output references: Inspired from here Kubectl - Introduce \"custom-columns\" variant to add additional columns to output -o name $ kubectl -n kube-system get pods -o name | head pod/coredns-c7ddbcccb-5cj5z pod/coredns-c7ddbcccb-lxsw6 pod/coredns-c7ddbcccb-prjfk pod/etcd-node03 pod/etcd-node04 pod/etcd-node01 pod/kube-apiserver-node03 pod/kube-apiserver-node04 pod/kube-apiserver-node01 pod/kube-controller-manager-node03 --template $ kubectl -n kube-system get pods \\ -o go-template \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' | head coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 kube-controller-manager-node03 or $ kubectl -n kube-system get pods \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' | head coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 kube-controller-manager-node03 custom-columns Name:.metadata.name$ kubectl get po --all-namespaces \\ -o=custom-columns=NAMESPACE:.metadata.namespace NODE:.spec.nodeName IPS:status.podIPs PHASE:.status.phase RESTARTS:RESTART:.status.containerStatuses[0].restartCount IMAGE:.spec.containers[0].image CREATED:.metadata.creationTimestamp LABELS:.metadata.labels QOS-CLASS:.status.qosClass list all images running in particular namespace $ kubectl -n get po \\ --output=custom-columns=\"NAME:.metadata.name,IMAGE:.spec.containers[*].image\" list all images exclude 'k8s.gcr.io/coredns:1.6.2'$ kubectl --all-namespaces get pods \\ -o=custom-columns='DATA:spec.containers[?(@.image!=\"k8s.gcr.io/coredns:1.6.2\")].image' list via -o custom-columns=\":metadata.name\" $ kubectl -n kube-system get pods -o custom-columns=\":metadata.name\" | head coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 QOS $ kubectl -n kube-system get po \\ -o custom-columns=NAME:.metadata.name,NAMESPACE:.metadata.namespace,QOS-CLASS:.status.qosClass NAME NAMESPACE QOS-CLASS coredns-59dd98b545-7t25l kube-system Burstable coredns-59dd98b545-lnklx kube-system Burstable coredns-59dd98b545-ltj5p kube-system Burstable etcd-k8s-node01 kube-system BestEffort etcd-k8s-node02 kube-system BestEffort etcd-k8s-node03 kube-system BestEffort kube-apiserver-k8s-node01 kube-system Burstable kube-apiserver-k8s-node02 kube-system Burstable kube-apiserver-k8s-node03 kube-system Burstable kube-controller-manager-k8s-node01 kube-system Burstable kube-controller-manager-k8s-node02 kube-system Burstable kube-controller-manager-k8s-node03 kube-system Burstable kube-flannel-ds-amd64-627bn kube-system Guaranteed kube-flannel-ds-amd64-7hdqd kube-system Guaranteed kube-flannel-ds-amd64-b4th7 kube-system Guaranteed ... jsonpath get port enabled in pod $ kubectl get po jenkins-0 -o jsonpath='{.spec.containers[*].ports[*]}' {\"containerPort\":8080,\"name\":\"http\",\"protocol\":\"TCP\"} {\"containerPort\":50000,\"name\":\"agent-listener\",\"protocol\":\"TCP\"} {\"containerPort\":50017,\"name\":\"sshd-listener\",\"protocol\":\"TCP\"} # or $ k get po jenkins-0 -o jsonpath=\"{range .spec.containers[*].ports[*]}{@.*}{'\\n'}{end}\" | column -t http 8080 TCP agent-listener 50000 TCP sshd-listener 50017 TCP get podIP $ kubectl get po -o go-template='{{range .items}}{{.status.podIP}}{{\"\\n\"}}{{end}}' 10.244.140.106 get the first deploy name in namespace $ kubectl -n get deploy -o=jsonpath={.items[0].metadata.name} get all deploy names $ kubectl -n get deploy -o=jsonpath='{.items[*].metadata.name}' item.metadata.name list via jsonpath={.items..metadata.name}$ kubectl -n kube-system get po --output=jsonpath={.items..metadata.name} coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk ... or$ kubectl -n kube-system get po -o jsonpath=\"{range .items[*]}{@.metadata.name}{'\\n'}{end}\" | head -10 coredns-c7ddbcccb-5cj5z coredns-c7ddbcccb-lxsw6 coredns-c7ddbcccb-prjfk etcd-node03 etcd-node04 etcd-node01 kube-apiserver-node03 kube-apiserver-node04 kube-apiserver-node01 kube-controller-manager-node03 list all container images in all namespaces $ kubectl get pods \\ --all-namespaces \\ -o jsonpath=\"{.items[*].spec.containers[*].image}\" | tr -s '[[:space:]]' '\\n' | sort | uniq -c or$ kubectl get pods \\ --all-namespaces \\ -o jsonpath=\"{.items[*].spec.containers[*].image}\" list container images by pod $ kubectl get pods \\ --all-namespaces \\ -o=jsonpath='{range .items[*]}{\"\\n\"}{.metadata.name}{\":\\t\"}{range .spec.containers[*]}{.image}{\", \"}{end}{end}' | sort management execute in pod $ kubectl -n devops exec -it devops-jenkins-659f4c6d44-d2w76 -- /bin/bash jenkins@devops-jenkins-659f4c6d44-d2w76:/$ echo $HOME /var/jenkins_home jenkins@devops-jenkins-659f4c6d44-d2w76:/$ hostname devops-jenkins-659f4c6d44-d2w76 restart po reference: Restarting Kubernetes Pods How to Restarting Kubernetes Pods How to gracefully remove a node from Kubernetes? for kubernetes version 1.15+ kubectl -n rollout restart deployment $ kubectl -n get po -o yaml | kubectl replace --force -f - result$ kubectl -n get po -w NAME READY STATUS RESTARTS AGE mypo-659f4c6d44-72hb5 1/1 Running 0 47h mypo-659f4c6d44-72hb5 1/1 Terminating 0 47h mypo-659f4c6d44-d2w76 0/1 Pending 0 0s mypo-659f4c6d44-d2w76 0/1 Pending 0 0s mypo-659f4c6d44-d2w76 0/1 ContainerCreating 0 0s mypo-659f4c6d44-d2w76 1/1 Running 0 2s mypo-659f4c6d44-72hb5 0/1 Terminating 0 47h mypo-659f4c6d44-72hb5 0/1 Terminating 0 47h mypo-659f4c6d44-72hb5 0/1 Terminating 0 47h mypo-659f4c6d44-72hb5 0/1 Pending 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 0s mypo-659f4c6d44-72hb5 0/1 Terminating 0 1s mypo-659f4c6d44-72hb5 0/1 Terminating 0 1s or$ kubectl -n scale deployment --replicas=0 resource managemenet resource management for pods and containers assign cpu resources to containers and pods managing kubernetes resource limits troubleshooting [!NOTE|label:references:] How To Troubleshoot Kubernetes Pods: Beginners Guide simple pods # run-nginx.yml apiVersion: extensions/v1beta1 kind: Deploy metadata: name: my-nginx spec: replicas: 2 template: metadata: labels: run: my-ngxin spec: containers: - name: my-nginx image: nginx:1.10.1 ports: - containerPort: 80 kubectl run $ kubectl run ubuntu-marslo \\ --image=ubuntu:18.04 \\ --overrides='{\"spec\": { \"nodeSelector\": {\"kubernetes.io/hostname\": \"k8s-node-01\"}}}' \\ -- sleep infinity # or $ kubectl run ubuntu-marslo \\ --image=ubuntu:18.04 \\ --overrides='{\"spec\": { \"nodeSelector\": {\"kubernetes.io/hostname\": \"k8s-node-01\"}}}' \\ -it \\ --rm debug svc [!NOTE|labels:referencds:] DNS for Services and Pods svc in cluster can be visit via CLUSTER-IP ..svc.cluster.local # current svc $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE jenkins ClusterIP 10.111.230.13 8080/TCP,30338/TCP 18h # create new pod $ kubectl run ubuntu-marslo \\ --image=ubuntu:18.04 \\ --overrides='{\"spec\": { \"nodeSelector\": {\"kubernetes.io/hostname\": \"k8s-node-01\"}}}' \\ -it \\ --rm # check DNS $ cat /etc/resolv.conf nameserver 10.96.0.10 search devops.svc.cluster.local svc.cluster.local cluster.local company.com options ndots:5 # debug $ nc -zv jenkins.devops.svc.cluster.local 30338 $ nc -zv 10.111.230.13 30338 $ ssh -l marslo -p 30338 -i ~/.ssh/id_rsa jenkins.devops.svc.cluster.local list-plugins $ ssh -l marslo -p 30338 -i ~/.ssh/id_rsa 10.111.230.13 list-plugins Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"virtualization/kubernetes/deploy.html":{"url":"virtualization/kubernetes/deploy.html","title":"deploy","keywords":"","body":" get get image set update image setup limits for deploy via command line replicas get check origial$ k -n devops get deploy devops-jenkins -o wide NAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTOR devops-jenkins 1/1 1 1 408d devops-jenkins jenkins/jenkins:2.199 app=devops-jenkins get image $ k -n jenkins get deploy jenkins -o jsonpath=\"{..image}\" jenkins/jenkins:2.346.2-lts set reference: Updating a Deployment Rolling Back a Deployment format $ kubectl -n \\ set image \\ deploy \\ = \\ [--record=true] \\ [kubernetes.io/change-cause=\"update cause\"] # check history $ kubectl -n \\ rollout history \\ deploy # revert $ kubectl -n \\ rollout undo \\ deploy \\ --to-revision= update image $ k -n devops set image deployments/devops-jenkins devops-jenkins=jenkins/jenkins:2.200 deployment.extensions/devops-jenkins image updated # or $ k -n devops set image deploy devops-jenkins devops-jenkins=jenkins/jenkins:2.200 result $ k -n devops get pods -w NAME READY STATUS RESTARTS AGE devops-jenkins-54d6db68ff-bz5b6 1/1 Running 0 6d17h devops-jenkins-6bdd4fc6dd-l9spp 0/1 Pending 0 0s devops-jenkins-6bdd4fc6dd-l9spp 0/1 Pending 0 0s devops-jenkins-6bdd4fc6dd-l9spp 0/1 ContainerCreating 0 0s devops-jenkins-6bdd4fc6dd-l9spp 1/1 Running 0 8s devops-jenkins-54d6db68ff-bz5b6 1/1 Terminating 0 6d17h devops-jenkins-54d6db68ff-bz5b6 0/1 Terminating 0 6d17h devops-jenkins-54d6db68ff-bz5b6 0/1 Terminating 0 6d17h devops-jenkins-54d6db68ff-bz5b6 0/1 Terminating 0 6d17h $ k -n devops get deploy -w NAME READY UP-TO-DATE AVAILABLE AGE devops-jenkins 1/1 1 1 22d devops-jenkins 1/1 1 1 22d devops-jenkins 1/1 1 1 22d devops-jenkins 1/1 0 1 22d devops-jenkins 1/1 1 1 22d devops-jenkins 2/1 1 2 22d devops-jenkins 1/1 1 1 22d $ k -n devops get deploy devops-jenkins -o yaml --export | grep image\\: Flag --export has been deprecated, This flag is deprecated and will be removed in future. image: jenkins/jenkins:2.200 $ k -n devops get po -o custom-columns='NAME:metadata.name,IMAGES:spec.containers[*].image' NAME IMAGES devops-jenkins-6bdd4fc6dd-l9spp jenkins/jenkins:2.2000 setup limits for deploy via command line $ k run \\ --image=jenkins/jenkins:2.274 \\ -i \\ --tty \\ --limits='cpu=50m,memory=128Mi' \\ --requests='cpu=50m,memory=128Mi' replicas $ kubectl scale deploy Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/replicaset.html":{"url":"virtualization/kubernetes/replicaset.html","title":"replicasets","keywords":"","body":" list list redundant rs remove useless replicasets list list redundant rs $ kubectl -n get rs | awk '{if ($2 + $3 + $4 == 0) print $1}' remove useless replicasets $ kubectl -n delete rs $(kubectl -n get rs | awk '{if ($2 + $3 + $4 == 0) print $1}') Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"virtualization/kubernetes/namespace.html":{"url":"virtualization/kubernetes/namespace.html","title":"namespace","keywords":"","body":" create namespace remove stuck namespace check which item occupied the resource remove all pods in namespace backup namespaces remove challenge.certmanager list list all namespaces with name only list all quota in cluster reference: deleting namespace stuck at \"Terminating\" state A namespace is stuck in the Terminating state How to fix Kubernetes namespaces stuck in the terminating state create namespace $ cat labels: name: EOF or$ kaubectl create namespace $ kubectl label namespace name= --overwrite remove stuck namespace check which item occupied the resource [!NOTE] references: Unable to Delete a Project or Namespace in OCP Kubernetes Namespaces stuck in Terminating status Namespace \"stuck\" as Terminating, How I removed it How to fix Kubernetes namespaces stuck in the terminating state $ ns='marslo-test' $ for _r in $(kubectl api-resources --verbs=list --namespaced -o name); do if [[ 'No resources found.' != \"$(kubectl get -n ${ns} ${_r} 2>&1 >/dev/null)\" ]]; then echo \"---- ${_r} ----\" kubectl get -n ${ns} ${_r} fi done ---- resourcequotas ---- NAME CREATED AT builder-resource-quota 2019-11-15T17:12:52Z ---- secrets ---- NAME TYPE DATA AGE default-token-l4s96 kubernetes.io/service-account-token 3 2y351d ---- serviceaccounts ---- NAME SECRETS AGE default 1 2y351d or modify spec.finalizers [!NOTE|label:references] There is no way to force delete Namespaces with invalid finalizers # to modify `\"finalizers\": [ \"kubernet\" ]` to `\"finalizers\": []` $ export NAMESPACE=\"monitoring\" $ kubectl get namespace $NAMESPACE -o json | tr -d \"\\n\" | sed \"s/\\\"finalizers\\\": \\[[^]]\\+\\]/\\\"finalizers\\\": []/\" | kubectl replace --raw /api/v1/namespaces/$NAMESPACE/finalize -f - or $ myns='marslo-test' $ for _i in $(kubectl api-resources --verbs=list --namespaced -o name); do echo ----- ${_i} ------ kubectl get -n ${myns} ${_i} done ----- configmaps ------ No resources found. ----- endpoints ------ No resources found. ----- events ------ No resources found. ----- limitranges ------ No resources found. ----- persistentvolumeclaims ------ No resources found. ----- pods ------ No resources found. ----- podtemplates ------ No resources found. ----- replicationcontrollers ------ No resources found. ----- resourcequotas ------ No resources found. ----- secrets ------ No resources found. ----- serviceaccounts ------ No resources found. ----- services ------ No resources found. ----- controllerrevisions.apps ------ No resources found. ----- daemonsets.apps ------ No resources found. ----- deployments.apps ------ No resources found. ----- replicasets.apps ------ No resources found. ----- statefulsets.apps ------ No resources found. ----- horizontalpodautoscalers.autoscaling ------ No resources found. ----- cronjobs.batch ------ No resources found. ----- jobs.batch ------ No resources found. ----- certificaterequests.certmanager.k8s.io ------ No resources found. ----- certificates.certmanager.k8s.io ------ No resources found. ----- challenges.certmanager.k8s.io ------ NAME STATE DOMAIN AGE marslo-dashboard-2318568841-0 pending marslo-dashboard.mycompany.com 72m ----- issuers.certmanager.k8s.io ------ No resources found. ----- orders.certmanager.k8s.io ------ No resources found. ----- leases.coordination.k8s.io ------ No resources found. ----- events.events.k8s.io ------ No resources found. ----- daemonsets.extensions ------ No resources found. ----- deployments.extensions ------ No resources found. ----- ingresses.extensions ------ No resources found. ----- networkpolicies.extensions ------ No resources found. ----- replicasets.extensions ------ No resources found. ----- pods.metrics.k8s.io ------ No resources found. ----- ingresses.networking.k8s.io ------ No resources found. ----- networkpolicies.networking.k8s.io ------ No resources found. ----- poddisruptionbudgets.policy ------ No resources found. ----- rolebindings.rbac.authorization.k8s.io ------ No resources found. ----- roles.rbac.authorization.k8s.io ------ No resources found. or list only available resources #!/usr/bin/env bash myns='marslo-test' for _i in $(kubectl api-resources --verbs=list --namespaced -o name); do if [[ \"$(kubectl -n ${myns} get ${_i} 2>&1)\" = No* ]]; then : else echo ----- ${_i} ------ kubectl -n ${myns} get ${_i} fi done oneline $ kubectl api-resources --namespaced=true -o name | xargs -n 1 -I {} bash -c \"echo \\\"----- {} -----\\\"; kubectl get -n ${myns} {};\" # --ignore-not-found # -t, --verbose # Print the command line on the standard error output before executing it $ kubectl api-resources --namespaced=true -o name | xargs -t -n 1 kubectl get --show-kind --ignore-not-found -n ${myns} remove all pods in namespace $ kubectl delete pods -n --all or $ kubectl delete po $(kubectl -n get po -o jsonpath='{range .items[*]}{.metadata.name} ') \\ --force --grace-period=0 \\ -n or $ kubectl get pods --all-namespaces | grep Evicted | awk '{print $2 \" --namespace=\" $1}' | xargs kubectl delete pod or $ kubectl get pods --all-namespaces | grep -E OutOfcpu\\|Evicted\\|Completed\\|OOMKilled\\|Error\\|ContainerStatusUnknown | awk '{print \"kubectl delete po \" $2 \" -n \" $1 }' | bash delete in all namespaces $ kubectl get ns -o=custom-columns=Namespace:.metadata.name --no-headers | xargs -n1 kubectl delete pods --all -n backup namespaces #!/usr/bin/env bash # credit belongs to https://raw.githubusercontent.com/ppo/bash-colors/master/bash-colors.sh # shellcheck disable=SC2015,SC2059 c() { [ $# == 0 ] && printf \"\\e[0m\" || printf \"$1\" | sed 's/\\(.\\)/\\1;/g;s/\\([SDIUFNHT]\\)/2\\1/g;s/\\([KRGYBMCW]\\)/3\\1/g;s/\\([krgybmcw]\\)/4\\1/g;y/SDIUFNHTsdiufnhtKRGYBMCWkrgybmcw/12345789123457890123456701234567/;s/^\\(.*\\);$/\\\\e[\\1m/g'; } exitOnError() { if [ $? -ne 0 ]; then echo -e \"$(c R)ERROR$(c) : $*\" >&2; exit 1; fi; } showHelp() { echo -e \"${usage}\"; exit 0; } usage=\"\"\" \\t $(c R)nsb$(c) - $(c iR)n$(c)ame$(c iR)s$(c)pace $(c iR)b$(c)ackup: to backup all available api-resources in given namespace \\nSYNOPSIS: \\n\\t$(c sY)\\$ nsb [ [ [..]]]$(c) \\nEXAMPLE: \\n\\tshow help \\t\\t$(c G)\\$ nsb$(c) \\n\\tbackup namespace(s) \\t\\t$(c G)\\$ nsb ...$(c) \"\"\" [[ 0 -eq $# ]] && showHelp path=\"./backups-$(date +%Y%m%d)/namespace\" while read -r -d' ' ns; do echo -e \"\\n\\n\\n================================ $(c iY)${ns}$(c) ================================\" for _ar in $(kubectl api-resources --verbs=list --namespaced -o name); do if [[ \"$(kubectl -n ${ns} get ${_ar} 2>&1)\" = No* ]]; then : else target=\"${path}/${ns}/${_ar}\" mkdir -p \"${target}\" echo -e \"\\n----- $(c iY)${ns}$(c) : $(c iB)${_ar}$(c) ------\" kubectl -n ${ns} get ${_ar} | tee \"${target}/status.log\" kubectl -n ${ns} describe ${_ar} > \"${target}/${_ar}.describe.log\" echo -e \"\\n... backup $(c iB)${_ar}$(c) all to ${target}/${_ar}.yml\" kubectl -n ${ns} get ${_ar} -o yaml --export > \"${target}/${_ar}.yml\" while read -r name; do echo -e \"\\t... backup $(c iB)${_ar}$(c) $(c iG)${name}$(c) to ${target}/${name}.yml\" if [[ \"${name}\" =~ .*-token-.* ]]; then kubectl -n ${ns} get ${_ar} ${name} -o yaml > ${target}/${name}.yml else kubectl -n ${ns} get ${_ar} ${name} -o yaml --export > ${target}/${name}.yml fi done remove challenge.certmanager $ kubectl -n marslo-test delete challenges.certmanager.k8s.io marslo-dashboard-2318568841-0 \\ --force --grace-period=0 warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely. challenge.certmanager.k8s.io \"marslo-dashboard-2318568841-0\" force deleted #### stuck #### $ kubectl get ns NAME STATUS AGE cert-manager Active 103d ... marslo-test Terminating 103d ... $ kubectl delete namespace cert-manager $ kubectl -n marslo-test describe challenges.certmanager.k8s.io Name: marslo-dashboard-2318568841-0 Namespace: marslo-test Labels: acme.cert-manager.io/order-name=marslo-dashboard-2318568841 Annotations: API Version: certmanager.k8s.io/v1alpha1 Kind: Challenge Metadata: Creation Timestamp: 2020-01-02T13:24:46Z Deletion Grace Period Seconds: 0 Deletion Timestamp: 2020-01-02T13:26:37Z Finalizers: finalizer.acme.cert-manager.io # Please edit the object below. Lines beginning with a '#' will be ignored, Generation: 5 Owner References: API Version: certmanager.k8s.io/v1alpha1 Block Owner Deletion: true Controller: true Kind: Order Name: marslo-dashboard-2318568841 UID: 06c2cc11-fd96-473d-b672-9e7495dee3bf Resource Version: 28236617 Self Link: /apis/certmanager.k8s.io/v1alpha1/namespaces/marslo-test/challenges/marslo-dashboard-2318568841-0 UID: cc6f18e3-1035-4f9f-aa25-9fdcf2340d36 Spec: Authz URL: https://acme-v02.api.letsencrypt.org/acme/authz-v3/2065855459 Config: http01: Ingress Class: nginx Dns Name: marslo-dashboard.mycompany.com Issuer Ref: Kind: ClusterIssuer Name: marslo-cert Key: cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY.TjEqvfuHdQXjDvwPm1FMc5pU4scT3qTDs5j4qc8XAqM Token: cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY Type: http-01 URL: https://acme-v02.api.letsencrypt.org/acme/chall-v3/2065855459/raQniA Wildcard: false Status: Presented: true Processing: true Reason: Waiting for http-01 challenge propagation: failed to perform self checkubectl get request 'http://marslo-dashboard.mycompany.com/.well-known/acme-challenge/cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY': Get http://marslo-dashboard.mycompany.com/.well-known/acme-challenge/cq9ofBV9ugv0zdf6ZMoPtFJjhuNrg17hVbAzQK1t2HY: dial tcp: lookup marslo-dashboard.mycompany.com on 10.96.0.10:53: no such host State: pending Events: ## inspired from https://github.com/jetstack/cert-manager/issues/1582#issuecomment-515354712 $ kubectl -n marslo-test edit challenges.certmanager.k8s.io marslo-dashboard-2318568841-0 challenge.certmanager.k8s.io/marslo-dashboard-2318568841-0 edited ## manual remove the finalizer list list all namespaces with name only $ kubectl get ns -o custom-columns=\":metadata.name\" --no-headers or$ kubectl get ns -o name or$ kubectl get ns --no-headers -o name list all quota in cluster $ while read ns; do echo \"~~~~~~~~~~~~ ${ns} ~~~~~~~~~~~~~\" kubectl -n ${ns} describe quota done or$ while IFS= read -rd ' ' ns; do echo \"~~~> ${ns}\" kubectl -n ${ns} describe quota done Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"virtualization/kubernetes/secrets.html":{"url":"virtualization/kubernetes/secrets.html","title":"secrets","keywords":"","body":" create secret use raw data from a file from file with base64 decode the secret referecens: Managing Secrets using kubectl Managing Secrets using Configuration File Managing Secrets using Kustomize create secret use raw data $ kubectl create secret generic db-user-pass \\ --from-literal=username=admin \\ --from-literal=password='marslo' from a file $ echo -n 'admin' > ./username.txt $ echo -n 'marslo' > ./password.txt $ kubectl create secret generic db-user-pass \\ --from-file=./username.txt \\ --from-file=./password.txt # or `--from-file=[key=]source` $ kubectl create secret generic db-user-pass \\ --from-file=username=./username.txt \\ --from-file=password=./password.txt from file with base64 $ echo -n 'admin' | base64 YWRtaW4= $ echo -n '1f2d1e2e67df' | base64 MWYyZDFlMmU2N2Rm # create manifest $ cat secret.yaml apiVersion: v1 kind: Secret metadata: name: mysecret type: Opaque data: username: YWRtaW4= password: MWYyZDFlMmU2N2Rm # create $ kubectl apply -f ./secret.yaml decode the secret $ kubectl get secret db-user-pass -o jsonpath='{.data}' { \"password\": \"bWFyc2xvCg==\", \"username\": \"YWRtaW4=\" } $ echo 'bWFyc2xvCg==' | base64 -d marslo oneline$ kubectl get secret db-user-pass -o jsonpath='{.data.password}' | base64 --decode Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"virtualization/kubernetes/node.html":{"url":"virtualization/kubernetes/node.html","title":"node","keywords":"","body":" list node names list docker images running in node list all Ready nodes list nodes metrcs with status list node with label list node with multiple labels update label of node show show with labels show particular labels show with particular columns show only scheduled nodes show common/diff images between nodes delete node cleanup label sort sort via kubelet version references: Labels and Selectors list node names $ kubectl get no --no-headers -o=custom-columns=NAME:.metadata.name # or $ kubectl get nodes -o 'jsonpath={.items[*].metadata.name} | fmt -1 list docker images running in node [!NOTE|label:references:] List container images in Kubernetes cluster with SIZE (like docker image ls) $ kubectl get node -o json | jq -re '.status.images[] | select(.names[1]) | .names[1]' list all Ready nodes [!NOTE|label:references:] * JSONPath to list all nodes in ready state except the ones which are tainted? * list node status with jq Kubectl Get Nodes: Why and How to Use It Checking Kubernetes node status Viewing and finding resources # Check which nodes are ready $ JSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}' \\ && kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=True\" see also * imarslo : list all ready pods $ kubectl get nodes -o json | jq -r '.items[] | select(.spec.taints|not) | select(.status.conditions[].reason==\"KubeletReady\" and .status.conditions[].status==\"True\") | .metadata.name' node-vm1 node1 node10 node11 node15 node4 node6 node8 node9 list status $ kubectl get nodes -o jsonpath='{range .items[*]} {.metadata.name} {\"\\t\"} {.status.conditions[?(@.type==\"Ready\")].status} {\"\\t\"} {.spec.taints[].effect} {\"\\n\"} {end}' | awk '$2==\"True\"' | awk '$3 != \"NoSchedule\"' node-vm1 True node1 True node10 True node11 True node15 True node4 True node6 True node8 True node9 True $ kubectl get nodes -o jsonpath='{range .items[*]} {.metadata.name} {\"\\t\"} {.status.conditions[?(@.type==\"Ready\")].status} {\"\\t\"} {.spec.taints[].effect} {\"\\n\"} {end}' | awk '$2==\"True\"' node-vm1 True node1 True node10 True node11 True node15 True node2 True NoSchedule node3 True NoSchedule node4 True node5 True NoSchedule node6 True node8 True node9 True list nodes metrcs [!NOTE] references: Need simple kubectl command to see cluster resource usage $ kubectl get no --no-headers -o=custom-columns=NAME:.metadata.name | xargs -I {} sh -c 'echo {} ; kubectl describe node {} | grep Allocated -A 5 | grep -ve Event -ve Allocated -ve percent -ve -- ; echo ' # alias $ alias util='kubectl get no --no-headers -o=custom-columns=NAME:.metadata.name | fmt -1 | xargs -I {} sh -c '\\''echo {} ; kubectl describe node {} | grep Allocated -A 5 | grep -ve Event -ve Allocated -ve percent -ve -- ; echo '\\''' # simple way $ kubectl describe nodes | grep 'Name:\\| cpu\\| memory' # or $ kubectl describe nodes | grep 'Name:\\|Allocated' -A 5 | grep 'Name\\|memory' # or $ kubectl describe nodes | awk '/Allocated resources/,/Events/' | grep -v \"^Events:\" # or with node name $ kubectl describe nodes | sed -n '/^Allocated /,/^Events:/ { /^ [^(]/ p; } ; /^Name: / p' others $ alias util='kubectl get nodes --no-headers | awk '\\''{print $1}'\\'' | xargs -I {} sh -c '\\''echo {} ; kubectl describe node {} | grep Allocated -A 5 | grep -ve Event -ve Allocated -ve percent -ve -- ; echo '\\''' # Get CPU request total (we x20 because because each m3.large has 2 vcpus (2000m) ) alias cpualloc='util | grep % | awk '\\''{print $1}'\\'' | awk '\\''{ sum += $1 } END { if (NR > 0) { print sum/(NR*20), \"%\\n\" } }'\\''' # Get mem request total (we x75 because because each m3.large has 7.5G ram ) alias memalloc='util | grep % | awk '\\''{print $5}'\\'' | awk '\\''{ sum += $1 } END { if (NR > 0) { print sum/(NR*75), \"%\\n\" } }'\\''' cluster-wide allocation $ kubectl get po --all-namespaces -o=jsonpath=\"{range .items[*]}{.metadata.namespace}:{.metadata.name}{'\\n'}{range .spec.containers[*]} {.name}:{.resources.requests.cpu}{'\\n'}{end}{'\\n'}{end}\" script #!/bin/bash set -e KUBECTL=\"kubectl\" NODES=$($KUBECTL get nodes --no-headers -o custom-columns=NAME:.metadata.name) function usage() { local node_count=0 local total_percent_cpu=0 local total_percent_mem=0 local readonly nodes=$@ for n in $nodes; do local requests=$($KUBECTL describe node $n | grep -A2 -E \"^\\\\s*CPU Requests\" | tail -n1) local percent_cpu=$(echo $requests | awk -F \"[()%]\" '{print $2}') local percent_mem=$(echo $requests | awk -F \"[()%]\" '{print $8}') echo \"$n: ${percent_cpu}% CPU, ${percent_mem}% memory\" node_count=$((node_count + 1)) total_percent_cpu=$((total_percent_cpu + percent_cpu)) total_percent_mem=$((total_percent_mem + percent_mem)) done local readonly avg_percent_cpu=$((total_percent_cpu / node_count)) local readonly avg_percent_mem=$((total_percent_mem / node_count)) echo \"Average usage: ${avg_percent_cpu}% CPU, ${avg_percent_mem}% memory.\" } usage $NODES script function kusage() { # Function returning resources usage on current kubernetes cluster local node_count=0 local total_percent_cpu=0 local total_percent_mem=0 echo \"NODE\\t\\t CPU_allocatable\\t Memory_allocatable\\t CPU_requests%\\t Memory_requests%\\t CPU_limits%\\t Memory_limits%\\t\" for n in $(kubectl get nodes --no-headers -o custom-columns=NAME:.metadata.name); do local requests=$(kubectl describe node $n | grep -A2 -E \"Resource\" | tail -n1 | tr -d '(%)') local abs_cpu=$(echo $requests | awk '{print $2}') local percent_cpu=$(echo $requests | awk '{print $3}') local node_cpu=$(echo $abs_cpu $percent_cpu | tr -d 'mKi' | awk '{print int($1/$2*100)}') local allocatable_cpu=$(echo $node_cpu $abs_cpu | tr -d 'mKi' | awk '{print int($1 - $2)}') local percent_cpu_lim=$(echo $requests | awk '{print $5}') local requests=$(kubectl describe node $n | grep -A3 -E \"Resource\" | tail -n1 | tr -d '(%)') local abs_mem=$(echo $requests | awk '{print $2}') local percent_mem=$(echo $requests | awk '{print $3}') local node_mem=$(echo $abs_mem $percent_mem | tr -d 'mKi' | awk '{print int($1/$2*100)}') local allocatable_mem=$(echo $node_mem $abs_mem | tr -d 'mKi' | awk '{print int($1 - $2)}') local percent_mem_lim=$(echo $requests | awk '{print $5}') echo \"$n\\t ${allocatable_cpu}m\\t\\t\\t ${allocatable_mem}Ki\\t\\t ${percent_cpu}%\\t\\t ${percent_mem}%\\t\\t\\t ${percent_cpu_lim}%\\t\\t ${percent_mem_lim}%\\t\" node_count=$((node_count + 1)) total_percent_cpu=$((total_percent_cpu + percent_cpu)) total_percent_mem=$((total_percent_mem + percent_mem)) done local avg_percent_cpu=$((total_percent_cpu / node_count)) local avg_percent_mem=$((total_percent_mem / node_count)) echo \"Average usage (requests) : ${avg_percent_cpu}% CPU, ${avg_percent_mem}% memory.\" } with status $ kubectl get nodes -o jsonpath='{range .items[*]} {.metadata.name} {\"\\t\"} {.status.conditions[?(@.type==\"Ready\")].status} {\"\\t\"} {.spec.taints[].effect} {\"\\n\"} {end}' node-vm1 True node1 True node10 True node11 True node12 Unknown NoSchedule node13 Unknown NoSchedule node14 Unknown NoSchedule node15 True node16 Unknown NoSchedule node17 Unknown NoSchedule node2 True NoSchedule node3 True NoSchedule node4 True node5 True NoSchedule node6 True node7 Unknown NoSchedule node8 True node9 True list all status $ kubectl get nodes -o jsonpath=\"{range .items[*]} {\\\"\\n\\\"} {@.metadata.name} :{\\\"\\n\\\"} {\\\"\\t\\\"}{range @.status.conditions[*]}{@.type}={@.status} {\\\"\\n\\t\\\"} {end}{end}\" node1 : ReadonlyFilesystem=False KernelDeadlock=False OutOfDisk=False MemoryPressure=False DiskPressure=False PIDPressure=False Ready=True node2 : ReadonlyFilesystem=False KernelDeadlock=False OutOfDisk=Unknown MemoryPressure=Unknown DiskPressure=Unknown PIDPressure=False Ready=Unknown node4 : OutOfDisk=Unknown MemoryPressure=Unknown DiskPressure=Unknown PIDPressure=False Ready=Unknown node-vm1 : OutOfDisk=False MemoryPressure=False DiskPressure=False PIDPressure=False Ready=True list node with label $ kubectl get node -l = list node with multiple labels [!TIP|label:tips:] * LIST and WATCH filtering $ kubectl get node --selector =,= # or $ kubectl get node -l ' in (), in ()' # or for same label, different values $ kubectl get node -l ' in (, )' # i.e.: $ kubectl get pods -l 'environment in (production, qa)' # or `notin` $ kubectl get node -l ' notin ()' update label of node $ kubectl label node = [--overwrite] show show with labels $ kubectl get node --show-labels show particular labels --label-columns$ kubectl get node --label-columns e.g.:$ kubectl get nodes --label-columns jenkins NAME STATUS ROLES AGE VERSION JENKINS k8s-node01 Ready worker 545d v1.12.3 k8s-node02 Ready worker 597d v1.12.3 k8s-node03 Ready worker 217d v1.12.3 k8s-node04 Ready worker 52d v1.12.3 k8s-node05 Ready worker 589d v1.12.3 k8s-node06 Ready master 2y33d v1.12.3 master k8s-node07 Ready master 589d v1.12.3 k8s-node08 Ready worker 535d v1.12.3 -l$ kubectl get node --show-labels -l node -role.kubernetes.io/master show with particular columns $ kubectl get node -o custom-columns=NAME:.metadata.name,VER:.status.nodeInfo.kubeletVersion NAME VER k8s-node01 v1.12.3 k8s-node02 v1.12.3 k8s-node03 v1.12.3 ... show only scheduled nodes $ kubectl get node \\ --output 'jsonpath={range $.items[*]}{.metadata.name} {.spec.taints[*].effect}{\"\\n\"}{end}' | awk '!/NoSchedule/{print $1}' show common/diff images between nodes common $ comm -1 -2 \\ diff [!NOTE|label:references:] iMarslo: directory diff $ diff --suppress-common-lines \\ --side-by-side \\ delete node [!NOTE|label:references:] How to gracefully remove a node from Kubernetes? kubectl_drain.svg # get info $ kubectl get nodes $ kubectl cordon $ kubectl drain # or $ kubectl drain --ignore-daemonsets --delete-local-data $ kubectl delete node cleanup label $ kubectl label node - example$ kubectl get node -l jenkins.master k8s-node01 Ready worker 1d v1.12.3 k8s-node02 Ready worker 1d v1.12.3 k8s-node03 Ready worker 1d v1.12.3 $ kubectl label node master-01 jenkins.master- $ kubectl get node -l jenkins.master k8s-node02 Ready worker 1d v1.12.3 k8s-node03 Ready worker 1d v1.12.3 sort sort via kubelet version $ kubectl get node --sort-by={.status.nodeInfo.kubeletVersion} or$ kubectl get nodes --sort-by={.metadata.labels.\"kubernetes\\.io\\/role\"} Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"virtualization/kubernetes/certificates.html":{"url":"virtualization/kubernetes/certificates.html","title":"certificates","keywords":"","body":" generic samples etcd kube-apiserver show secrets tls.crt create secrets duplicate secrets to the other ns show server.crt show all tls show ca.crt renew both certificates and kubeconfig check info crt pem for external etcd backup clean environment restore backup v1.12.3 renew certificates renew kubeconfig sync to peer controllers restart kubelet v1.15.3 renew certificates sync to peer controllers renew kubeconfig restart the controller components restart kubelet service verify extend X509v3 Subject Alternative Name in apiserver.crt using new certificate for apiserver renew work node backup restart kubelet certificates generation pfx renew kubeconfig only basic environment renew kubeconfig generate new certificate (csr) signing the certificate via ca.crt renew via kubeadm alpha renew via kubectl config renew via base64 manually vaildate more details tricky modify default certificate to 10 years reference required certificates Certificate paths Configure certificates for user accounts files are used as follows [!TIP] extenal etcd topology certificates located in : /etc/etcd/ssl stacked etcd topology certificates located in : /etc/kubernetes/pki/etcd references: * 创建 TLS 证书和秘钥 * Generate Certificates Manually * Manual Rotation of CA Certificates * Certificate Management with kubeadm stacked CA mode can found from Certificate Management with kubeadm * PKI certificates and requirements Manage TLS Certificates in a Cluster Renew a Kubernetes certificate with a 10-year expiration date Configure Access to Multiple Clusters Dashboard使用自定义证书 Custom certificates on Kubernetes How to Generate a Self-Signed Certificate for Kubernetes Certificates in a Kubernetes environment Creating Self Signed Certificates on Kubernetes How To Configure Ingress TLS/SSL Certificates in Kubernetes 一文带你彻底厘清 Kubernetes 中的证书工作机制 * 管理集群中的 TLS 认证 * set up a high availability etcd cluster with kubeadm regenerate the kubeadm.yml$ sudo kubeadm config view generic certificates for CA ca-key.pem ca.pem kubernetes-key.pem kubernetes.pem kube-proxy.pem kube-proxy-key.pem admin.pem admin-key.pem certificate component SERVICES CERTIFICATES etcd ca.pem, kubernetes-key.pem, kubernetes.pem kube-apiserver ca.pem, kubernetes-key.pem, kubernetes.pem kubelet ca.pem kube-proxy ca.pem, kube-proxy-key.pem, kube-proxy.pem kubectl ca.pem, admin-key.pem, admin.pem kube-controller-manager ca-key.pem, ca.pem samples etcd /usr/local/bin/etcd \\\\ --cert-file=/etc/etcd/kube-etcd.pem \\\\ # 对外提供服务的服务器证书 --key-file=/etc/etcd/kube-etcd-key.pem \\\\ # 服务器证书对应的私钥 --peer-cert-file=/etc/etcd/kube-etcd-peer.pem \\\\ # peer 证书，用于 etcd 节点之间的相互访问 --peer-key-file=/etc/etcd/kube-etcd-peer-key.pem \\\\ # peer 证书对应的私钥 --trusted-ca-file=/etc/etcd/cluster-root-ca.pem \\\\ # 用于验证访问 etcd 服务器的客户端证书的 CA 根证书 --peer-trusted-ca-file=/etc/etcd/cluster-root-ca.pem\\\\ # 用于验证 peer 证书的 CA 根证书 ... kube-apiserver /usr/local/bin/kube-apiserver \\\\ --tls-cert-file=/var/lib/kubernetes/kube-apiserver.pem \\\\ # 用于对外提供服务的服务器证书 --tls-private-key-file=/var/lib/kubernetes/kube-apiserver-key.pem \\\\ # 服务器证书对应的私钥 --etcd-certfile=/var/lib/kubernetes/kube-apiserver-etcd-client.pem \\\\ # 用于访问 etcd 的客户端证书 --etcd-keyfile=/var/lib/kubernetes/kube-apiserver-etcd-client-key.pem \\\\ # 用于访问 etcd 的客户端证书的私钥 --kubelet-client-certificate=/var/lib/kubernetes/kube-apiserver-kubelet-client.pem \\\\ # 用于访问 kubelet 的客户端证书 --kubelet-client-key=/var/lib/kubernetes/kube-apiserver-kubelet-client-key.pem \\\\ # 用于访问 kubelet 的客户端证书的私钥 --client-ca-file=/var/lib/kubernetes/cluster-root-ca.pem \\\\ # 用于验证访问 kube-apiserver 的客户端的证书的 CA 根证书 --etcd-cafile=/var/lib/kubernetes/cluster-root-ca.pem \\\\ # 用于验证 etcd 服务器证书的 CA 根证书 --kubelet-certificate-authority=/var/lib/kubernetes/cluster-root-ca.pem \\\\ # 用于验证 kubelet 服务器证书的 CA 根证书 --service-account-key-file=/var/lib/kubernetes/service-account.pem \\\\ # 用于验证 service account token 的公钥 ... show secrets tls.crt [!TIP|label:references:] Quick Tip: SSL Cert Expiry from Kubernetes Secrets create secrets by command $ kubectl create secret tls my-certs \\ --key .devops/certs/server.key \\ --cert .devops/certs/server.crt \\ -n ingress-nginx by yaml $ echo \"apiVersion: v1 kind: Secret type: kubernetes.io/tls metadata: name: mytest-cert namespace: ingress-nginx data: tls.crt: $(cat $HOME/.devops/certs/server.csr | base64 -w0) tls.key: $(cat $HOME/.devops/certs/server.key | base64 -w0)\" | kubectl apply -f - duplicate secrets to the other ns reference: others Pro-Tip – Copying Kubernetes Secrets Between Namespaces $ kubectl -n ingress-nginx get secrets my-certs -o yaml --export | kubectl apply -n devops -f - show server.crt $ kubectl -n kube-system \\ get secrets sample-tls \\ -o yaml \\ -o \"jsonpath={.data['tls\\.crt']}\" | base64 -d -w0 | sed '/-----END CERTIFICATE-----/q' | openssl x509 -text -noout | grep 'Not' Not Before: Sep 14 00:00:00 2021 GMT Not After : Aug 18 23:59:59 2022 GM show all tls $ kubectl get ingress --all-namespaces --no-headers | awk '{print $1}' | sort -u | while read -r ns; do echo \"-- ${ns} --\"; kubectl -n ${ns} get secret sample-tls -o yaml -o \"jsonpath={.data['tls\\.crt']}\" | base64 -d -w0 | sed '/-----END CERTIFICATE-----/q' | openssl x509 -text -noout | grep 'Not' done show ca.crt $ kubectl -n kube-system \\ get secrets sample-tls \\ -o yaml \\ -o \"jsonpath={.data['tls\\.crt']}\" | base64 -d -w0 | awk '/-BEGIN CERTIFICATE-/ && c++, /-END CERTIFICATE-/' | openssl x509 -text -noout | grep 'Not' Not Before: Apr 14 00:00:00 2021 GMT Not After : Apr 13 23:59:59 2031 GMT renew both certificates and kubeconfig check info crt $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | egrep -v 'ca.crt$' | xargs -L 1 -t -i bash -c 'openssl x509 -noout -text -in {} | grep After' bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-kubelet-client.crt | grep After Not After : Sep 16 07:51:58 2020 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver.crt | grep After Not After : Sep 16 07:51:59 2020 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/front-proxy-client.crt | grep After Not After : Sep 16 07:52:00 2020 GMT or $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | egrep -v 'ca.crt$' | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' or $ ls -1 /etc/kubernetes/pki/*.crt | grep -Ev 'ca.crt$' | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' pem for external etcd $ for i in ca client server peer; do echo /etc/etcd/ssl/$i.pem openssl x509 -enddate -noout -in /etc/etcd/ssl/$i.pem done /etc/etcd/ssl/ca.pem notAfter=Sep 8 10:44:00 2024 GMT /etc/etcd/ssl/client.pem notAfter=Sep 8 10:49:00 2024 GMT /etc/etcd/ssl/server.pem notAfter=Sep 8 11:03:00 2024 GMT /etc/etcd/ssl/peer.pem notAfter=Sep 8 11:03:00 2024 GMT or $ find /etc/etcd/ssl/ -type f -name '*.pem' | egrep -v '*-key.pem$' | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/ca.pem notAfter=Sep 8 10:44:00 2024 GMT bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/client.pem notAfter=Sep 8 10:49:00 2024 GMT bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/server.pem notAfter=Sep 8 11:03:00 2024 GMT bash -c openssl x509 -enddate -noout -in /etc/etcd/ssl/peer.pem notAfter=Sep 8 11:03:00 2024 GMT or $ ls -1 /etc/etcd/ssl/*.pem | grep -Ev '\\-key.pem$' | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' backup # timestampe=$(date +\"%Y%m%d%H%M%S\") $ timestampe=$(date +\"%Y%m%d\") $ backupFolder=\"$HOME/k8s-cert-expired-${timestampe}\" $ mkdir \"${backupFolder}\" $ sudo cp -rp --parents /etc/kubernetes/pki \"${backupFolder}\" # for external etcd # sudo cp -rp --parents /etc/etcd/ssl \"${backupFolder}\" # for kubelet $ sudo cp -rp /var/lib/kubelet/config.yaml{,.backup.${timestampe}} $ sudo cp -rp --parents /var/lib/kubelet/pki \"${backupFolder}\" $ sudo cp -r /var/lib/kubelet/pki{,.backup.${timestampe}} $ sudo cp -rp --parents /var/lib/kubelet/config.yaml \"${backupFolder}\" # for kubeconfig $ sudo cp -rp --parents /etc/kubernetes/*.conf \"${backupFolder}\" $ sudo cp -rp ~/.kube/config{,.backup.${timestampe}} clean environment # for `/etc/kubernetes/pki` # or $ echo {apiserver,apiserver-kubelet-client,apiserver-etcd-client,front-proxy-client} | fmt -1 | xargs -I{} bash -c \"sudo cp -rp /etc/kubernetes/pki/{}.crt{,.backup.${timestampe}}; sudo mv /etc/kubernetes/pki/{}.key{,.backup.${timestampe}}\" # for kubeconfig $ echo {admin,kubelet,controller-manager,scheduler} | fmt -1 | xargs -I{} bash -c \"sudo mv /etc/kubernetes/{}.conf{,.backup.${timestampe}}\" $ echo {peer,healthcheck-client,server}.{crt,key} | fmt -1 | xargs -I{} bash -c \"sudo mv /etc/kubernets/pki/etcd/${}{,.backup.${timestampe}}\" restore backup TBD v1.12.3 [!TIP] where I can find kubeadm-config.yaml on my kubernetes cluster Kubernetes by kubeadm config yamls kubeadm – How to “upgrade” (update) your configuration for stacked etcd topology $ kubectl version --short Client Version: v1.12.3 Server Version: v1.12.3 references: Renewing Kubernetes cluster certificates 1.0.2 Renewing Kubernetes cluster certificates 1.1.0 Renewing Kubernetes 1.10.x cluster certificates renew certificates # get target cluster kubeadm-cfg.yml $ kubectl get cm kubeadm-config -n kube-system -o=jsonpath=\"{.data.ClusterConfiguration}\" $ sudo kubeadm [--config kubeadm.yml] alpha phase certs renew [commands] Available Commands: commands comments all renew all available certificates apiserver Generates the certificate for serving the kubernetes API apiserver-etcd-client Generates the client apiserver uses to access etcd apiserver-kubelet-client Generates the Client certificate for the API server to connect to kubelet front-proxy-client Generates the client for the front proxy etcd-healthcheck-client Generates the client certificate for liveness probes to healtcheck etcd etcd-peer Generates the credentials for etcd nodes to communicate with each other etcd-server Generates the certificate for serving etcd i.e. # get target cluster kubeadm-cfg.yml $ kubectl get cm kubeadm-config -n kube-system -o=jsonpath=\"{.data.ClusterConfiguration}\" $ sudo kubeadm --config ~/kubeadm.yml alpha phase certs renew all # or $ sudo kubeadm --config ~/kubeadm.yml alpha phase certs renew etcd-server $ sudo kubeadm --config ~/kubeadm.yml alpha phase certs renew apiserver-kubelet-client $ sudo kubeadm --config ~/kubeadm.yml alpha phase certs renew front-proxy-client # for /etc/kubernetes/pki/*.crt $ echo {apiserver,apiserver-kubelet-client,front-proxy-client} | fmt -1 | xargs -I{} bash -c \"sudo kubeadm --config ~/kubeadm.yml alpha phase certs renew {}\" # for /etc/kubernetes/pki/etcd/*.crt $ echo {etcd-server,etcd-peer,etcd-healthcheck-client} | fmt -1 | xargs -I{} bash -c \"sudo kubeadm --config ~/kubeadm.yml alpha phase certs renew {}\" generate new certificates $ sudo kubeadm [--config kubeadm.yml] alpha phase certs [commands] commands comments all Generates all PKI assets necessary to establish the control plane apiserver Generates the certificate for serving the kubernetes API apiserver-etcd-client Generates the client apiserver uses to access etcd apiserver-kubelet-client Generates the Client certificate for the API server to connect to kubelet ca Generates the self-signed kubernetes CA to provision identities for other kuberenets components etcd-ca Generates the self-signed CA to provision identities for etcd etcd-healthcheck-client Generates the client certificate for liveness probes to healtcheck etcd etcd-peer Generates the credentials for etcd nodes to communicate with each other etcd-server Generates the certificate for serving etcd front-proxy-ca Generates the self-signed CA to provision identities for front proxy front-proxy-client Generates the client for the front proxy sa Generates a private key for signing service account tokens along with its public key renew Renews certificates for a Kubernetes cluster re-generate /etc/kubernetes/pki/etcd/*.crt for modify X509 Subject Alternative Name: $ sudo kubeadm --config ~/kubeadm.yml alpha phase certs etcd-server $ sudo kubeadm --config ~/kubeadm.yml alpha phase certs etcd-peer $ sudo kubeadm --config ~/kubeadm.yml alpha phase certs etcd-healthcheck-client # or $ echo {etcd-server,etcd-peer,etcd-healthcheck-client} | fmt -1 | xargs -I{} bash -c \"sudo kubeadm --config ~/kubeadm.yml alpha phase certs {}\" check X509 Subject Alternative Name $ openssl x509 -noout -text -in /path/to/NAME.crt check expire date $ openssl x509 -noout -enddate -in /path/to/NAME.crt renew kubeconfig # clean all config in /etc/kubenernets/*.conf, i.e.: # echo {admin,controller-manager,kubelet,scheduler} | fmt -1 | xargs -I{} bash -c \"sudo rm -rf {}.conf\" $ sudo kubeadm [--config ~/kubeadm.yml] alpha phase kubeconfig [commands] renew all kubeconfig $ sudo kubeadm --config ~/kubeadm.yml alpha phase kubeconfig all [endpoint] WARNING: port specified in controlPlaneEndpoint overrides bindPort in the controlplane address [kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/admin.conf\" [kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/kubelet.conf\" [kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/controller-manager.conf\" [kubeconfig] Wrote KubeConfig file to disk: \"/etc/kubernetes/scheduler.conf\" # or $ echo {admin,controller-manager,kubelet,scheduler} | fmt -1 | xargs -I{} bash -c \"sudo kubeadm --config ~/kubeadm.yml alpha phase kubeconfig {}\" Available Commands: commands comments all Generates all kubeconfig files necessary to establish the control plane and the admin kubeconfig file admin Generates a kubeconfig file for the admin to use and for kubeadm itself controller_manager Generates a kubeconfig file for the controller manager to use kubelet Generates a kubeconfig file for the kubelet to use. Please note that this should be used *only* for bootstrapping purposes scheduler Generates a kubeconfig file for the scheduler to use user Outputs a kubeconfig file for an additional user update ~/.kube/config $ sudo rm -rf ~/.kube/config $ sudo cp /etc/kubernetes/admin.conf ~/.kube/config $ sudo chown devops:devops ~/.kube/config $ sudo chmod 644 ~/.kube/config sync to peer controllers [!NOTE|label:login to peer controller first] $ ssh devops@ # for k8s certs $ find /etc/kubernetes/pki -type f -regextype posix-extended -regex '^.+/pki/[^/]+\\.(key|crt|pub)$' -print xargs -L1 -t -i bash -c 'sudo rsync -avzrlpgoDP -e \"ssh -q -i $HOME/.ssh/id_ed25519\" --rsync-path='sudo rsync' devops@:{} {}' # or $ find /etc/kubernetes/pki/ -type f -regex '^.*\\.\\(key\\|crt\\|pub\\)$' -print | xargs -L1 -t -i bash -c 'sudo rsync -avzrlpgoDP -e \"ssh -q -i $HOME/.ssh/id_ed25519\" --rsync-path='sudo rsync' devops@:{} {}' # or $ for pkg in '*.key' '*.crt' '*.pub'; do sudo rsync -avzrlpgoDP \\ -e \"ssh -i $HOME/.ssh/id_ed25519\" \\ --rsync-path='sudo rsync' \\ devops@:\"/etc/kubernetes/pki/${pkg}\" /etc/kubernetes/pki/ done # for stacked etcd $ find /etc/kubernetes/pki/etcd -type f -regextype posix-extended -regex '^.*(server|healthcheck-client|peer)\\.(crt|key)$' | xargs -L1 -t -i bash -c 'sudo rsync -avzrlpgoDP -e \"ssh -q -i $HOME/.ssh/id_ed25519\" --rsync-path='sudo rsync' devops@:{} {}' # or $ find /etc/kubernetes/pki/etcd -type f -regex '^.*\\(server\\|healthcheck-client\\|peer\\)\\.\\(crt\\|key\\)$' | xargs -L1 -t -i bash -c 'sudo rsync -avzrlpgoDP -e \"ssh -q -i $HOME/.ssh/id_ed25519\" --rsync-path='sudo rsync' devops@:{} {}' # or $ for _i in server healthcheck-client peer; do sudo rsync -avzrlpgoDP \\ -e \"ssh -i $HOME/.ssh/id_ed25519\" \\ --rsync-path='sudo rsync' \\ devops@\"/etc/kubernetes/pki/etcd/${_i}.{crt,key}\" /etc/kubernetes/pki/etcd/ done # for kubeconfig $ find /etc/kubernetes -type f -regextype posix-extended -regex '^/etc/kubernetes/(admin|kubelet|controller-manager|scheduler)\\.conf$' -print | xargs -L1 -t -i bash -c 'sudo rsync -avzrlpgoDP -e \"ssh -q -i $HOME/.ssh/id_ed25519\" --rsync-path='sudo rsync' devops@:{} {}' # or $ find /etc/kubernetes -type f -regex '^\\/etc\\/kubernetes\\/\\(admin\\|kubelet\\|controller-manager\\|scheduler\\)\\.conf$' -print | xargs -L1 -t -i bash -c 'sudo rsync -avzrlpgoDP -e \"ssh -q -i $HOME/.ssh/id_ed25519\" --rsync-path='sudo rsync' devops@:{} {}' # or $ for _i in admin kubelet controller-manager scheduler; do sudo rsync -avzrlpgoDP \\ -e \"ssh -i $HOME/.ssh/id_ed25519\" \\ --rsync-path='sudo rsync' \\ devops@:\"/etc/kubernetes/${_i}.conf\" /etc/kubernetes/ done restart kubelet kill all services $ sudo kill -s SIGHUP $(pidof kube-apiserver) $ sudo kill -s SIGHUP $(pidof kube-controller-manager) $ sudo kill -s SIGHUP $(pidof kube-scheduler) restart service $ sudo rm -rf /var/lib/kubelet/pki/* $ sudo systemctl status kubelet $ sudo systemctl restart kubelet $ sudo systemctl --no-pager -l status kubelet v1.15.3 reference: Renewing Kubernetes 1.14.x cluster certificates Renew cluster certificates Certificate Management with kubeadm kubeadm alpha kubeadm alpha Kubernetes v1.15 - Administration with kubeadm [!TIP] for external etcd topology $ kubectl version --short Client Version: v1.15.3 Server Version: v1.15.3 renew certificates [!NOTE|label:in major controller] NOTE: major controller is the controller node bind with load balance ip. the key controller node picked by keepalived. check it by using: $ ip a s \"${interface}\" | sed -rn 's|\\W*inet[^6]\\W*([0-9\\.]{7,15}).*$|\\1|p' references: kubeadm-conf.yaml CERTIFICATE FILES PATH apiserver.crt apiserver.key apiserver-kubelet-client.crt apiserver-kubelet-client.key front-proxy-client.crt front-proxy-client.key /etc/kubernetes/pki $ echo 'apiserver apiserver-kubelet-client front-proxy-client' | xargs -t -n1 sudo kubeadm alpha certs renew # or $ for i in apiserver apiserver-kubelet-client front-proxy-client; do sudo kubeadm alpha certs renew ${i} done certificate for serving the Kubernetes API renewed certificate for the API server to connect to kubelet renewed certificate for the front proxy client renewed or $ echo 'apiserver apiserver-kubelet-client front-proxy-client' | xargs -t -n1 sudo kubeadm --config kubeadm.yml alpha certs renew # or $ for i in apiserver apiserver-kubelet-client front-proxy-client; do sudo kubeadm --config kubeadm-conf.yaml alpha certs renew ${i} done certificate for serving the Kubernetes API renewed certificate for the API server to connect to kubelet renewed certificate for the front proxy client renewed sync to peer controllers [!NOTE] sync renewed certificates to peer controllers $ leadIP= $ find /etc/kubernetes/pki -type f -regextype posix-extended -regex '^.+/pki/[^/]+\\.(key|crt|pub)$' -print xargs -L1 -t -i bash -c 'sudo rsync -avzrlpgoDP -e \"ssh -q -i $HOME/.ssh/id_ed25519\" --rsync-path='sudo rsync' devops@:{} {}' # or $ find /etc/kubernetes/pki/ -type f -regex '^.*\\.\\(key\\|crt\\|pub\\)$' -print | xargs -L1 -t -i bash -c 'sudo rsync -avzrlpgoDP -e \"ssh -q -i $HOME/.ssh/id_ed25519\" --rsync-path='sudo rsync' devops@:{} {}' # or $ for pkg in '*.key' '*.crt' '*.pub'; do sudo rsync -avzrlpgoDP \\ --rsync-path='sudo rsync' \\ root@${leadIP}:\"/etc/kubernetes/pki/${pkg}\" \\ /etc/kubernetes/pki/ done verify $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | egrep -v 'ca.crt$' | xargs -L 1 -t -i bash -c 'openssl x509 -enddate -noout -in {}' bash -c openssl x509 -enddate -noout -in /etc/kubernetes/pki/apiserver.crt notAfter=Sep 18 12:10:31 2021 GMT bash -c openssl x509 -enddate -noout -in /etc/kubernetes/pki/apiserver-kubelet-client.crt notAfter=Sep 18 12:10:31 2021 GMT bash -c openssl x509 -enddate -noout -in /etc/kubernetes/pki/front-proxy-client.crt notAfter=Sep 18 12:10:31 2021 GMT or$ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | xargs -L 1 -t -i bash -c 'openssl x509 -in {} -noout -text |grep \"Not \"' bash -c openssl x509 -in /etc/kubernetes/pki/ca.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 14 07:51:58 2029 GMT bash -c openssl x509 -in /etc/kubernetes/pki/front-proxy-ca.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:52:00 2019 GMT Not After : Sep 14 07:52:00 2029 GMT bash -c openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 18 12:10:31 2021 GMT bash -c openssl x509 -in /etc/kubernetes/pki/apiserver-kubelet-client.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 18 12:10:31 2021 GMT bash -c openssl x509 -in /etc/kubernetes/pki/front-proxy-client.crt -noout -text |grep \"Not \" Not Before: Sep 17 07:52:00 2019 GMT Not After : Sep 18 12:10:31 2021 GMT renew kubeconfig CONFIG FILES PATH admin.conf kubelet.conf controller-manager.conf scheduler.conf /etc/kubernetes/ # to get kubeadm-cfg.yml $ kubectl get cm kubeadm-config -n kube-system -o=jsonpath=\"{.data.ClusterConfiguration}\" $ sudo kubeadm --config kubeadm-cfg.yml init phase kubeconfig all [kubeconfig] Using kubeconfig folder \"/etc/kubernetes\" [kubeconfig] Writing \"admin.conf\" kubeconfig file [kubeconfig] Writing \"kubelet.conf\" kubeconfig file [kubeconfig] Writing \"controller-manager.conf\" kubeconfig file [kubeconfig] Writing \"scheduler.conf\" kubeconfig file setup ~/.kube/config $ sudo cp /etc/kubernetes/admin.conf ~/.kube/config $ sudo chown $(id -u):$(id -g) $HOME/.kube/config $ sudo chmod 644 $HOME/.kube/config configuration file path config ~/.kube restart the controller components $ sudo kill -s SIGHUP $(pidof kube-apiserver) $ sudo kill -s SIGHUP $(pidof kube-controller-manager) $ sudo kill -s SIGHUP $(pidof kube-scheduler) or$ echo {kube-apiserver,kube-controller-manager,kube-scheduler} | fmt -1 | xargs -I{} bash -c \"sudo kill -s SIGHUP $(pidof {}) \" restart kubelet service $ sudo rm -rf /var/lib/kubelet/pki/* $ sudo systemctl restart kubelet verify $ sudo systemctl status kubelet ● kubelet.service - kubelet: The Kubernetes Node Agent Loaded: loaded (/usr/lib/systemd/system/kubelet.service; enabled; vendor preset: disabled) Drop-In: /usr/lib/systemd/system/kubelet.service.d └─10-kubeadm.conf Active: active (running) since Mon 2020-09-21 04:25:33 PDT; 55s ago Docs: https://kubernetes.io/docs/ Main PID: 11891 (kubelet) Tasks: 19 Memory: 126.5M CGroup: /system.slice/kubelet.service └─11891 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/... ... verify via kubernetes api (load.balance.ip.address:6443) $ echo -n | openssl s_client -connect x.x.x.:6443 2>&1 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | openssl x509 -text -noout | grep Not Not Before: Sep 17 07:51:58 2019 GMT Not After : Sep 21 09:09:00 2021 GMT extend X509v3 Subject Alternative Name in apiserver.crt $ ssh controller02 # 生成2048位的密钥对 $ openssl genrsa -out apiserver-controller02.key 2048 # 生成证书签署请求文件 $ sudo openssl req -new \\ -key apiserver-controller02.key \\ -subj \"/CN=kube-apiserver,\" \\ -out apiserver-controller02.csr # 编辑apiserver-controller02.ext文件，内容如下： $ cat apiserver-controller02.ext subjectAltName = DNS:controller02,DNS:kubernetes,DNS:kubernetes.default,DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, IP:10.96.0.1, IP:10.24.138.208 # 使用ca.key和ca.crt签署上述请求 $ sudo openssl x509 -req \\ -in apiserver-controller02.csr \\ -CA /etc/kubernetes/pki/ca.crt \\ -CAkey /etc/kubernetes/pki/ca.key \\ -CAcreateserial \\ -out apiserver-controller02.crt \\ -days 365 \\ -extfile apiserver-controller02.ext Signature ok subject=/CN=10.24.138.208 Getting CA Private Key # 查看新生成的证书： $ sudo openssl x509 -noout -text -in apiserver-controller02.crt Certificate: Data: Version: 3 (0x2) Serial Number: 16019625340257831745 (0xde51245f10ea0b41) Signature Algorithm: sha256WithRSAEncryption Issuer: CN=kubernetes Validity Not Before: May 12 08:40:40 2017 GMT Not After : May 12 08:40:40 2018 GMT Subject: CN=kube-apiserver, Subject Public Key Info: ... ... X509v3 extensions: X509v3 Subject Alternative Name: DNS:controller02, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, IP Address:10.96.0.1, IP Address:10.24.138.208 using new certificate for apiserver $ sudo cat /etc/kubernetes/manifests/kube-apiserver.yaml .. - --tls-cert-file=/etc/kubernetes/pki/apiserver-controller02.crt - --tls-private-key-file=/etc/kubernetes/pki/apiserver-controller02.key .. renew work node backup $ mkdir k8s-cert-expired $ sudo cp -rp /var/lib/kubelet/pki k8s-cert-expired/ $ sudo cp -r /var/lib/kubelet/pki{,.orig} restart kubelet $ sudo rm -rf /var/lib/kubelet/pki/* $ sudo systemctl restart kubelet $ sudo systemctl status kubelet.service certificates generation pfx $ grep certificate-authority-data ~/.kube/config | awk '{print $2}' | base64 -d > ca.crt $ grep client-certificate-data ~/.kube/config | awk '{print $2}' | base64 -d > client.crt $ grep client-key-data ~/.kube/config | awk '{print $2}' | base64 -d > client.key $ openssl pkcs12 -export -out cert.pfx -inkey client.key -in client.crt -certfile ca.crt Enter Export Password: marslo Verifying - Enter Export Password: marslo $ ls ca.crt cert.pfx client.crt client.key renew kubeconfig only basic environment [!TIP] $ kubectl version --short Client Version: v1.12.3 Server Version: v1.12.3 certs $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | egrep -v 'ca.crt$' | xargs -L 1 -t -i bash -c 'openssl x509 -noout -text -in {} | grep After' bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/front-proxy-client.crt | grep Not Not After : May 28 11:48:39 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/server.crt | grep Not Not After : May 28 11:48:40 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/peer.crt | grep Not Not After : May 28 11:48:41 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/healthcheck-client.crt | grep Not Not After : May 28 11:48:40 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver.crt | grep Not Not After : May 28 11:48:37 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-kubelet-client.crt | grep Not Not After : May 28 11:48:38 2022 GMT bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-etcd-client.crt | grep Not Not After : May 28 11:48:42 2022 GMT kubectl config view $ kubectl config get-contexts CURRENT NAME CLUSTER AUTHINFO NAMESPACE * kubernetes-admin@kubernetes kubernetes kubernetes-admin $ kubectl config current-context kubernetes-admin@kubernetes $ kubectl config view -o jsonpath={.contexts}; echo [map[name:kubernetes-admin@kubernetes context:map[user:kubernetes-admin cluster:kubernetes]]] $ kubectl config view -o jsonpath={.users}; echo [map[name:kubernetes-admin user:map[client-certificate-data:REDACTED client-key-data:REDACTED]]] $ kubectl config view apiVersion: v1 clusters: - cluster: certificate-authority-data: DATA+OMITTED server: https://1.2.3.4:1234 name: kubernetes contexts: - context: cluster: kubernetes user: kubernetes-admin name: kubernetes-admin@kubernetes current-context: kubernetes-admin@kubernetes kind: Config preferences: {} users: - name: kubernetes-admin user: client-certificate-data: REDACTED client-key-data: REDACTED kubeconfig $ kubectl --kubeconfig=config get namespace error: the server doesn't have a resource type \"namespace\" $ sudo grep 'client-certificate-data' $HOME/.kube/config | awk '{print $2}' | base64 -d | openssl x509 -text -noout | grep -E 'Not|Subject:' Not Before: Dec 8 05:43:01 2020 GMT Not After : Dec 8 05:43:01 2021 GMT Subject: O=system:masters, CN=kubernetes-admin renew kubeconfig references: Configure certificates for user accounts kubernetes > about the cluster-admin cluster role binding Subjects: configuration files config subject controller-manager.conf Subject: CN=system:kube-contdoller-manager admin.conf Subject: O=system:masters, CN=kubernetes-admin scheduler.conf Subject: O=system:masters, CN=system:kube-scheduler kubelet.conf Subject: O=system:nodes, CN=system:node:kubernetes-master01 ( CN=system:node: ) configuration files certs subject front-proxy-client.crt Subject: CN=front-proxy-client server.crt Subject: CN=kubernetes-master01 ( CN=HOSTNAME ) peer.crt Subject: CN=kubernetes-master01 ( CN=HOSTNAME ) healthcheck-client.crt Subject: O=system:masters, CN=kube-etcd-healthcheck-client apiserver.crt Subject: CN=kube-apiserver apiserver-kubelet-client.crt Subject: O=system:masters, CN=kube-apiserver-kubelet-client apiserver-etcd-client.crt Subject: O=system:masters, CN=kube-apiserver-etcd-client generate new certificate (csr) $ openssl req -subj \"/O=system:masters/CN=kubernetes-admin\" \\ -new \\ -newkey rsa:2048 \\ -nodes \\ -out marslo.csr \\ -keyout marslo.key \\ -out marslo.csr or$ openssl genrsa -out marslo.key 2048 $ openssl req -new -key marslo.key -out marslo.csr -subj \"/O=system:masters/CN=kubernetes-admin\" signing the certificate via ca.crt $ sudo openssl x509 -req \\ -in marslo.csr \\ -CA /etc/kubernetes/pki/ca.crt \\ -CAkey /etc/kubernetes/pki/ca.key \\ -CAcreateserial \\ -out marslo.crt \\ -days 365 \\ -sha256 result $ ls -Altrh . /etc/kubernetes/pki/ca* -rw------- 1 root root 1.7K Dec 6 2018 ca.key -rw-r--r-- 1 root root 1.1K Dec 6 2018 ca.crt -rw-r--r-- 1 root root 17 Dec 15 01:31 ca.srl $ ls -Altrh ./ -rw-rw-r-- 1 devops devops 1.7K Dec 15 01:31 marslo.key -rw-rw-r-- 1 devops devops 936 Dec 15 01:31 marslo.csr -rw-r--r-- 1 root root 1021 Dec 15 01:31 marslo.crt $ sudo openssl x509 -in marslo.crt -text -noout | grep -E 'Subject:|Not' Not Before: Dec 15 09:31:55 2021 GMT Not After : Dec 15 09:31:55 2022 GMT Subject: O=system:masters, CN=kubernetes-admin [!TIP] $ cp ~/.kube/config config $ kubectl --kubeconfig=config get ns error: You must be logged in to the server (Unauthorized) renew via kubeadm alpha 1.15- $ sudo kubeadm [--config ~/kubeadm.yml] alpha phase kubeconfig all renew all certs$ sudo kubeadm [--config ~/kubeadm.yml] alpha phase certs renew all re-generate all certs$ sudo kubeadm [--config ~/kubeadm.yml] alpha phase certs all v1.15+ $ sudo kubeadm [--config ~/kubeadm.yml] alpha certs renew all renew all certs$ sudo kubeadm [--config ~/kubeadm.yml] alpha certs renew all renew via kubectl config reference: kubectlp-command#config $ kubectl config set-credentials kubernetes-admin \\ --embed-certs=true \\ --certificate-authority=/etc/kubernetes/pki/ca.crt \\ --client-certificate=./marslo.crt \\ --client-key=./marslo.key \\ --kubeconfig=config $ kubectl config set-context kubernetes-admin@kubernetes \\ --cluster=kubernetes \\ --user=kubernetes-admin renew via base64 manually $ sed -re \"s/(.*client-certificate-data:)(.*)$/\\1 $(cat marslo.crt | base64 -w0)/g\" -i config $ sed -re \"s/(.*client-key-data:)(.*)$/\\1 $(cat marslo.key| base64 -w0)/g\" -i config vaildate $ kubectl --kubeconfig=config get ns | grep kube kube-public Active 3y10d kube-system Active 3y10d more details reference: Get user and group from current-context conf: # current kubeconfig context $ kubectl config view --raw -o json | jq \".users[] | select(.name==\\\"$(kubectl config view -o jsonpath='{.users[].name}')\\\")\" | jq -r '.user[\"client-certificate-data\"]' | base64 -d | openssl x509 -text | grep \"Subject:\" Subject: O=system:masters, CN=kubernetes-admin # for all confs $ find /etc/kubernetes/ -type f -name \"*.conf\" -print | grep -Ev 'kubelet.conf$' | xargs -L1 -t -i bash -c \"sudo grep 'client-certificate-data' {} \\ | awk '{print \\$2}' \\ | base64 -d \\ | openssl x509 -noout -text \\ | grep --color=always Subject\\: \\ \" bash -c sudo grep 'client-certificate-data' /etc/kubernetes/controller-manager.conf | awk '{print $2}' | base64 -d | openssl x509 -noout -text | grep --color=always Subject\\: Subject: CN=system:kube-controller-manager bash -c sudo grep 'client-certificate-data' /etc/kubernetes/admin.conf | awk '{print $2}' | base64 -d | openssl x509 -noout -text | grep --color=always Subject\\: Subject: O=system:masters, CN=kubernetes-admin bash -c sudo grep 'client-certificate-data' /etc/kubernetes/scheduler.conf | awk '{print $2}' | base64 -d | openssl x509 -noout -text | grep --color=always Subject\\: Subject: O=system:masters, CN=system:kube-scheduler $ sudo openssl x509 -in $(sudo grep 'client-certificate' /etc/kubernetes/kubelet.conf | awk '{print $2}') -text -noout | grep --color=always Subject\\: Subject: O=system:nodes, CN=system:node:kubernetes-master01 certs $ find /etc/kubernetes/pki/ -type f -name \"*.crt\" -print | grep -Ev 'ca.crt$' | xargs -L1 -t -i bash -c 'openssl x509 -noout -text -in {} | grep --color=always Subject\\:' bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/front-proxy-client.crt | grep --color=always Subject\\: Subject: CN=front-proxy-client bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/server.crt | grep --color=always Subject\\: Subject: CN=kubernetes-master01 bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/peer.crt | grep --color=always Subject\\: Subject: CN=kubernetes-master01 bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/etcd/healthcheck-client.crt | grep --color=always Subject\\: ubject: O=system:masters, CN=kube-apiserver-etcd-client bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver.crt | grep --color=always Subject\\: Subject: CN=kube-apiserver bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-kubelet-client.crt | grep --color=always Subject\\: Subject: O=system:masters, CN=kube-apiserver-kubelet-client bash -c openssl x509 -noout -text -in /etc/kubernetes/pki/apiserver-etcd-client.crt | grep --color=always Subject\\: Subject: O=system:masters, CN=kube-apiserver-etcd-client about system:masters $ kubectl get clusterrolebinding cluster-admin -o yaml $ kubectl get clusterrolebinding cluster-admin -o json | jq -r .subjects[0].name system:masters $ kubectl get clusterrolebindings -o json | jq -r '.items[] | select(.subjects[0].kind==\"Group\") | select(.subjects[0].name==\"system:masters\") | .metadata.name' cluster-admin tricky modify default certificate to 10 years [!NOTE|label:references:] kubeadm 证书期限调整 Certificate Management with kubeadm Certificates and Certificate Signing Requests kubernetes 双向 TLS 配置 CertificateValidity $ git clone git@github.com:kubernetes/kubernetes.git && cd Kubernetes $ grep CertificateValidity cmd/kubeadm/app/constants/constants.go // CertificateValidity defines the validity for all the signed certificates generated by kubeadm CertificateValidity = time.Hour * 24 * 365 * 10 $ make cross manifests/kube-controller-manager.yaml $ sudo cat /etc/kubernetes/manifests/kube-controller-manager.yaml controllerManager: extraArgs: v: \"4\" node-cidr-mask-size: \"19\" deployment-controller-sync-period: \"10s\" # 在 kubeadm 配置文件中设置证书有效期为 10 年 experimental-cluster-signing-duration: \"86700h\" node-monitor-grace-period: \"20s\" pod-eviction-timeout: \"2m\" terminated-pod-gc-threshold: \"30\" # renew $ kubeadm alpha certs renew all --use-api # approve $ kubectl -n kube-system get csr NAME AGE REQUESTORE CONDITION kubeadm-cert-kubernetes-admin-648w4 47s kubernetes-admin pending $ kubectl certificate approve kubeadm-cert-kubernetes-admin-648w4 certificatesigningrequest.certificates.k8s.io/kubeadm-cert-kubernetes-admin-648w4 approved $ kubectl -n kube-system get csr NAME AGE REQUESTORE CONDITION kubeadm-cert-kube-apiserver-bgmcs 2s kubernetes-admin pending kubeadm-cert-kubernetes-admin-648w4 47s kubernetes-admin Approved,Issued $ kubectl certificate approve kubeadm-cert-kube-apiserver-bgmcs certificatesigningrequest.certificates.k8s.io/kubeadm-cert-kube-apiserver-bgmcs approved $ kubectl -n kube-system get csr NAME AGE REQUESTORE CONDITION kubeadm-cert-kube-apiserver-bgmcs 2s kubernetes-admin Approved,Issued kubeadm-cert-kubernetes-admin-648w4 47s kubernetes-admin Approved,Issued $ kubectl certificate approve kubeadm-cert-kube-apiserver-kubelet-client-r9lmh $ kubectl certificate approve kubeadm-cert-system:kube-contrller-manager-kzx49 $ kubectl certificate approve kubeadm-cert-font-proxy-client-9kxgj $ kubectl certificate approve kubeadm-cert-system:kube-scheduler-8jbb9 $ kubectl -n kube-system get csr NAME AGE REQUESTORE CONDITION kubeadm-cert-font-proxy-client-9kxgj 57s kubernetes-admin Approved,Issued kubeadm-cert-kube-apiserver-bgmcs 3m9s kubernetes-admin Approved,Issued kubeadm-cert-kube-apiserver-kubelet-client-r9lmh 2m57s kubernetes-admin Approved,Issued kubeadm-cert-kubernetes-admin-648w4 4m19s kubernetes-admin Approved,Issued kubeadm-cert-system:kube-contrller-manager-kzx49 70s kubernetes-admin Approved,Issued kubeadm-cert-system:kube-scheduler-8jbb9 49s kubernetes-admin Approved,Issued older version : v1.15 $ cat /etc/kubernetes/manifests/kube-controller-manager.yaml apiVersion: v1 kind: Pod metadata: creationTimestamp: null labels: component: kube-controller-manager tier: control-plane name: kube-controller-manager namespace: kube-system spec: containers: - command: - kube-controller-manager ... - --experimental-cluster-signing-duration=87600h ... ... $ kubeadm alpha certs renew all --config /etc/kubernetes/kubeadm-config.yaml --use-api $ kubectl certificate approve ... # upgrade kubeconfg $ kubeadm init phase kubeconfig all --config /etc/kubernetes/kubeadm-config.yaml $ cp -i /etc/kubernetes/admin.conf $HOME/.kube/config $ chown $(id -u):$(id -g) $HOME/.kube/config # restart components $ docker restart $(docker ps | grep etcd | awk '{ print $1 }') $ docker restart $(docker ps | grep kube-apiserver | awk '{ print $1 }') $ docker restart $(docker ps | grep kube-scheduler | awk '{ print $1 }) $ docker restart $(docker ps | grep kube-controller | awk '{ print $1 }') $ systemctl daemon-reload && systemctl restart kubelet # check $ echo | openssl s_client -showcerts -connect 127.0.0.1:6443 -servername api 2>/dev/null | openssl x509 -noout -enddate reference [!TIP] reference: * Kubernetes中的证书工作机制 证书 手动档搭建 Kubernetes HA 集群 Certificates PKI certificates and requirements Generate self-signed certificates Certification authority root certificate expiry and renewal Certificates CUSTOM CERTIFICATE AUTHORITY Certificate Authority with CFSSL K8S Cluster tls Certificate Management Access Kubernetes API with Client Certificates Public-key cryptography and X.509 Bootstrapping Kubernetes Clusters with kubeadm how to renew the certificate when apiserver cert expired? Can not access my kubernetes cluster even if all my server certificates are valid The Cluster API Book K8S 集群中的认证、授权与 kubeconfig Certificate Signing Requests Authenticating Kubernetes – KUBECONFIG and Context The connection to the server x.x.x.:6443 was refused - did you specify the right host or port? Kubernetes Troubleshooting kubectl Error: The connection to the server x.x.x.x:6443 was refused – did you specify the right host or port? required certificates DEFAULT CN PARENT CA O (IN SUBJECT) KIND HOSTS (SAN) kube-etcd etcd-ca - server, client hostname Host_IP localhost 127.0.0.1 kube-etcd-peer etcd-ca - server, client hostname Host_IP localhost 127.0.0.1 kube-etcd-healthcheck-client etcd-ca - client - kube-apiserver-etcd-client etcd-ca system:masters client - kube-apiserver kubernetes-ca - server hostname, Host_IP, advertise_IP, [1] kube-apiserver-kubelet-client kubernetes-ca system:masters client - front-proxy-client kubernetes-front-proxy-ca - client - Certificate paths DEFAULT CN RECOMMENDED KEY PATH RECOMMENDED CERT PATH COMMAND KEY ARGUMENT CERT ARGUMENT etcd-ca etcd/ca.key etcd/ca.crt kube-apiserver - --etcd-cafile kube-apiserver-etcd-client apiserver-etcd-client.key apiserver-etcd-client.crt kube-apiserver --etcd-keyfile --etcd-certfile kubernetes-ca ca.key ca.crt kube-apiserver - --client-ca-file kubernetes-ca ca.key ca.crt kube-controller-manager --cluster-signing-key-file --client-ca-file --root-ca-file --cluster-signing-cert-file kube-apiserver apiserver.key apiserver.crt kube-apiserver --tls-private-key-file --tls-cert-file kube-apiserver-kubelet-client apiserver-kubelet-client.key apiserver-kubelet-client.crt kube-apiserver --kubelet-client-key --kubelet-client-certificate front-proxy-ca front-proxy-ca.key front-proxy-ca.crt kube-apiserver - --requestheader-client-ca-file front-proxy-ca front-proxy-ca.key front-proxy-ca.crt kube-controller-manager - --requestheader-client-ca-file front-proxy-client front-proxy-client.key front-proxy-client.crt kube-apiserver --proxy-client-key-file --proxy-client-cert-file etcd-ca etcd/ca.key etcd/ca.crt etcd - --trusted-ca-file --peer-trusted-ca-file kube-etcd etcd/server.key etcd/server.crt etcd --key-file --cert-file kube-etcd-peer etcd/peer.key etcd/peer.crt etcd --peer-key-file --peer-cert-file etcd-ca - etcd/ca.crt etcdctl - --cacert kube-etcd-healthcheck-client etcd/healthcheck-client.key etcd/healthcheck-client.crt etcdctl --key --cert Configure certificates for user accounts FILENAME CREDENTIAL NAME DEFAULT CN O (IN SUBJECT) admin.conf default-admin kubernetes-admin system:masters kubelet.conf default-auth system:node: (see note) system:nodes controller-manager.conf default-controller-manager system:kube-controller-manager - scheduler.conf default-scheduler system:kube-scheduler - files are used as follows FILENAME COMMAND COMMENT admin.conf kubectl Configures administrator user for the cluster kubelet.conf kubelet One required for each node in the cluster. controller-manager.conf kube-controller-manager Must be added to manifest in manifests/kube-controller-manager.yaml scheduler.conf kube-scheduler Must be added to manifest in manifests/kube-scheduler.yaml Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/events.html":{"url":"virtualization/kubernetes/events.html","title":"events","keywords":"","body":" get info list all warning events list particular events get info list all warning events $ kubectl get events --field-selector type=Warning --all-namespaces --sort-by='{.lastTimestamp}' list particular events $ kubectl get event --field-selector=involvedObject.name =foo -w Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/kubeconfig.html":{"url":"virtualization/kubernetes/kubeconfig.html","title":"kubeconfig","keywords":"","body":" step by step defining clusters defining users defining contexts setup default namespace use contexts OpenID Connect ( OIDC ) Configure Access to Multiple Clusters Create a second configuration file Clean up with Proxy get info basic view server IP get user get password get key kubeadm-cfg.yml have fun references: * 创建 kubeconfig 文件 创建k8s context Configure Access to Multiple Clusters Organizing Cluster Access Using kubeconfig Files kubectl config Kubectl Config Set-Context | Tutorial and Best Practices Checklist: pros and cons of using multiple Kubernetes clusters, and how to distribute workloads between them kubectl config view others: Introducing kubectl more usage: imarslo : kubectl config view step by step defining clusters $ kubectl config set-cluster my-cluster --server=127.0.0.1:8087 modify server $ kubectl config set-cluster NAME --server=https://10.69.114.92:6443 # or $ kubectl config set-cluster $(kubectl config current-context) --server=https://10.69.114.92:6443 defining users using token$ kubectl config set-credentials my-user --token=Py93bt12mT using basic authentication $ kubectl config set-credentials my-user --username=redhat-username --password=redhat-password using certificates $ kubectl config set-credentials my-user --client-certificate=redhat-certificate.crt --client-key=redhat-key.key defining contexts $ kubectl config set-context --cluster=my-cluster --user=my-user by namespace$ kubectl config set-context my-context --cluster=my-cluster --user=my-user --namespace=redhat-dev setup default namespace $ kubectl config set-context --current --namespace= use contexts $ kubectl config use-context my-context verify $ kubectl config get-contexts CURRENT NAME CLUSTER AUTHINFO NAMESPACE * my-context 172.0.7.2:6443 my-user redhat-dev my-context-2 172.1.8.0:6443 my-user-2 $ kubectl config current-context my-context OpenID Connect ( OIDC ) [!NOTE|label:references:] Option 1 - OIDC Authenticator$ kubectl config set-credentials USER_NAME \\ --auth-provider=oidc \\ --auth-provider-arg=idp-issuer-url=( issuer url ) \\ --auth-provider-arg=client-id=( your client id ) \\ --auth-provider-arg=client-secret=( your client secret ) \\ --auth-provider-arg=refresh-token=( your refresh token ) \\ --auth-provider-arg=idp-certificate-authority=( path to your ca certificate ) \\ --auth-provider-arg=id-token=( your id_token ) echo \"-----BEGIN CERTIFICATE----- .... -----END CERTIFICATE----- \" \\ > ca-kubernetes-staging.pem ## set cluster kubectl config set-cluster kubernetes-staging \\ --server=https://127.0.7.2:6443 \\ --certificate-authority=ca-kubernetes-staging.pem \\ --embed-certs ## set credential kubectl config set-credentials marslo@kubernetes-staging \\ --auth-provider=oidc \\ --auth-provider-arg='idp-issuer-url=https://dex-k8s.domain.com/' \\ --auth-provider-arg='client-id=dex-k8s-authenticator' \\ --auth-provider-arg='client-secret=Z**********************0' \\ --auth-provider-arg='refresh-token=C**********************************************************************n' \\ --auth-provider-arg='id-token=e**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************A' ## set context kubectl config set-context kubernetes-staging --cluster=kubernetes-staging --user=marslo@kubernetes-staging ## use context kubectl config use-context kubernetes-staging verify # get id-token $ kubectl config view -o jsonpath='{.users[?(@.name == \"marslo@kubernetes-staging\")].user.auth-provider.config.id-token}' # get the password for the `e2e` user $ kubectl config view -o jsonpath='{.users[?(@.name == \"e2e\")].user.password}' Configure Access to Multiple Clusters [!TIP] a configuration file describes clusters, users, and contexts set clusters # cluster development $ kubectl config --kubeconfig=config-demo \\ set-cluster development \\ --server=https://1.2.3.4 \\ --certificate-authority=fake-ca-file # cluster test $ kubectl config --kubeconfig=config-demo \\ set-cluster test \\ --server=https://5.6.7.8 \\ --insecure-skip-tls-verify set user [!NOTE] To delete a user you can run kubectl --kubeconfig=config-demo config unset users. To remove a cluster, you can run kubectl --kubeconfig=config-demo config unset clusters. To remove a context, you can run kubectl --kubeconfig=config-demo config unset contexts. # with CA $ kubectl config --kubeconfig=config-demo \\ set-credentials developer \\ --client-certificate=fake-cert-file \\ --client-key=fake-key-seefile # with basic authentication $ kubectl config --kubeconfig=config-demo \\ set-credentials experimenter \\ --username=exp \\ --password=some-password add context # user developer namespace frontend $ kubectl config --kubeconfig=config-demo \\ set-context dev-frontend \\ --cluster=development \\ --namespace=frontend \\ --user=developer # user developer namespace storage $ kubectl config --kubeconfig=config-demo \\ set-context dev-storage \\ --cluster=development \\ --namespace=storage \\ --user=developer # user experimenter $ kubectl config --kubeconfig=config-demo \\ set-context exp-test \\ --cluster=test \\ --namespace=default \\ --user=experimenter result $ kubectl config --kubeconfig=config-demo get-contexts CURRENT NAME CLUSTER AUTHINFO NAMESPACE dev-frontend development developer frontend dev-storage development developer storage exp-test test experimenter default $ kubectl config --kubeconfig=config-demo view apiVersion: v1 clusters: - cluster: certificate-authority: fake-ca-file server: https://1.2.3.4 name: development - cluster: insecure-skip-tls-verify: true server: https://5.6.7.8 name: test contexts: - context: cluster: development namespace: frontend user: developer name: dev-frontend - context: cluster: development namespace: storage user: developer name: dev-storage - context: cluster: test namespace: default user: experimenter name: exp-test current-context: \"\" kind: Config preferences: {} users: - name: developer user: client-certificate: fake-cert-file client-key: fake-key-seefile - name: experimenter user: password: some-password username: exp use context $ kubectl config --kubeconfig=config-demo use-context dev-frontend Switched to context \"dev-frontend\". $ kubectl config --kubeconfig=config-demo get-contexts CURRENT NAME CLUSTER AUTHINFO NAMESPACE * dev-frontend development developer frontend dev-storage development developer storage exp-test test experimenter default $ kubectl config --kubeconfig=config-demo view --minify apiVersion: v1 clusters: - cluster: certificate-authority: fake-ca-file server: https://1.2.3.4 name: development contexts: - context: cluster: development namespace: frontend user: developer name: dev-frontend current-context: dev-frontend kind: Config preferences: {} users: - name: developer user: client-certificate: fake-cert-file client-key: fake-key-seefile Create a second configuration file KUBECONFIG environment variable linux$ export KUBECONFIG_SAVED=\"$KUBECONFIG\" windows> $Env:KUBECONFIG_SAVED=$ENV:KUBECONFIG temporarily append two paths to your kubeconfig environment variable linux$ export KUBECONFIG=\"${KUBECONFIG}:config-demo:config-demo-2\" windows> $Env:KUBECONFIG=(\"config-demo;config-demo-2\") Append $HOME/.kube/config to your KUBECONFIG environment variable linux$ export KUBECONFIG=\"${KUBECONFIG}:${HOME}/.kube/config\" windows> $Env:KUBECONFIG=\"$Env:KUBECONFIG;$HOME\\.kube\\config\" Clean up linux$ export KUBECONFIG=\"$KUBECONFIG_SAVED\" windows> $Env:KUBECONFIG=$ENV:KUBECONFIG_SAVED with Proxy [!NOTE] references: cheatsheet : Kubectl context and configuration $ kubectl config set-cluster --proxy-url= # i.e. $ kubectl config set-cluster development --proxy-url=http://sample.proxy.com:3128 result apiVersion: v1 kind: Config clusters: - cluster: proxy-url: http://proxy.example.org:3128 server: https://k8s.example.org/k8s/clusters/c-xxyyzz name: development users: - name: developer contexts: - context: name: development get info [!INFO|label:references:] * imarslo : jsonpath jsonpath support JSONPath 支持 basic view get contexts list$ kubectl config --kubeconfig=config-demo get-contexts CURRENT NAME CLUSTER AUTHINFO NAMESPACE * dev-frontend development developer frontend dev-storage development developer storage exp-test test experimenter default get current context $ kubectl config --kubeconfig=config-demo current-context dev-frontend get clusters $ kubectl config --kubeconfig=config-demo get-clusters NAME development test get users $ kubectl config --kubeconfig=config-demo get-users NAME developer experimenter server IP by cluster name # get all cluster name $ kubectl config --kubeconfig=config-demo view -o jsonpath=\"{.clusters[*].name}\" development test $ kubectl config --kubeconfig=config-demo view \\ -o jsonpath='{.clusters[?(@.name == \"development\")].cluster.server}' https://1.2.3.4 current in-use via --minify [!NOTE] --minify=false: Remove all information not used by current-context from the output $ kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}' https://1.2.3.4 # or $ kubectl config view --minify -o jsonpath=\"{.clusters[].cluster.server}\" https://1.2.3.4 # more info $ kubectl config view --minify -o jsonpath=\"{.clusters[*].name}\" development # or $ kubectl config view --minify -o jsonpath=\"{.clusters[].name}\" development current in-use via current-context # or get current cluster IP $ kubectl config --kubeconfig=config-demo current-context development $ kubectl config --kubeconfig=config-demo view \\ -o jsonpath=\"{.clusters[?(@.name == \\\"$(kubectl config --kubeconfig=config-demo current-context)\\\")].cluster.server}\" get user $ kubectl config --kubeconfig=config-demo view -o jsonpath='{.users[*].name}' developer experimenter get password $ kubectl config --kubeconfig=config-demo view -o jsonpath='{.users[?(@.name == \"experimenter\")]}' {\"name\":\"experimenter\",\"user\":{\"password\":\"some-password\",\"username\":\"exp\"}} $ kubectl config --kubeconfig=config-demo view -o jsonpath='{.users[?(@.name == \"experimenter\")].user.password}' some-password get key $ kubectl config --kubeconfig=config-demo view -o jsonpath='{.users[?(@.name == \"developer\")]}' {\"name\":\"developer\",\"user\":{\"client-certificate\":\"fake-cert-file\",\"client-key\":\"fake-key-seefile\"}} # or via base64 decoding $ kubectl config --kubeconfig=config-demo view -o jsonpath='{.users[?(@.name == \"developer\")]}' | base64 -d --minify=false: Remove all information not used by current-context from the output $ kubectl config --kubeconfig=config-demo view -o jsonpath='{.users[?(@.name == \"developer\")].user.client-key}' fake-key-seefile # or via base64 decoding $ kubectl config --kubeconfig=config-demo view -o jsonpath='{.users[?(@.name == \"developer\")].user.client-key}' | base64 -d kubeadm-cfg.yml [!NOTE|label:references:] Certificate Management with kubeadm $ kubectl get cm kubeadm-config -n kube-system -o=jsonpath=\"{.data.ClusterConfiguration}\" have fun view config details exec >/tmp/output && CONTEXT_NAME=kubernetes-admin@kubernetes \\ CONTEXT_CLUSTER=$(kubectl config view -o=jsonpath=\"{.contexts[?(@.name==\\\"${CONTEXT_NAME}\\\")].context.cluster}\") \\ CONTEXT_USER=$(kubectl config view -o=jsonpath=\"{.contexts[?(@.name==\\\"${CONTEXT_NAME}\\\")].context.user}\") && \\ echo \"[\" && \\ kubectl config view -o=json | jq -j --arg CONTEXT_NAME \"$CONTEXT_NAME\" '.contexts[] | select(.name==$CONTEXT_NAME)' && \\ echo \",\" && \\ kubectl config view -o=json | jq -j --arg CONTEXT_CLUSTER \"$CONTEXT_CLUSTER\" '.clusters[] | select(.name==$CONTEXT_CLUSTER)' && \\ echo \",\" && \\ kubectl config view -o=json | jq -j --arg CONTEXT_USER \"$CONTEXT_USER\" '.users[] | select(.name==$CONTEXT_USER)' && \\ echo -e \"\\n]\\n\" && \\ exec >/dev/tty && \\ cat /tmp/output | jq && \\ rm -rf /tmp/output or$ kubectl config view -o json | jq '. as $o | .\"current-context\" as $current_context_name | $o.contexts[] | select(.name == $current_context_name) as $context | $o.clusters[] | select(.name == $context.context.cluster) as $cluster | $o.users[] | select(.name == $context.context.user) as $user | {\"current-context-name\": $current_context_name, context: $context, cluster: $cluster, user: $user}' Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:03:48 "},"virtualization/kubernetes/kubelet.html":{"url":"virtualization/kubernetes/kubelet.html","title":"kubelet","keywords":"","body":" configuration files systemd kubelet modfiy /var/lib/kubelet kuabelet configration change kubelet root dir config files /etc/systemd/system/kubelet.service.d/10-kubeadm.conf references: The kubelet drop-in file for systemd Kubelet Configuration (v1beta1) * Install and Set Up kubectl on Linux how to change kubelet working dir to somewhere else Reconfiguring Kubelet in a live cluster configuration files systemd service configure : v1.12.3: /etc/systemd/system/kubelet.service.d/10-kubeadm.conf v1.9.16: /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf check via:$ sudo systemctl status kubelet.service ● kubelet.service - kubelet: The Kubernetes Node Agent Loaded: loaded (/usr/local/lib/systemd/system/kubelet.service; enabled; vendor preset: disabled) Drop-In: /usr/lib/systemd/system/kubelet.service.d └─10-kubeadm.conf Active: active (running) since Fri 2023-06-23 17:04:07 PDT; 7min ago environment file : /etc/sysconfig/kubelet kubelet kubeconfig, kubelet configuration file : /etc/kubernetes/kubelet.conf kubeConfig file to use for the TLS Bootstrap, (it is only used if /etc/kubernetes/kubelet.conf does not exist): /etc/kubernetes/bootstrap-kubelet.conf file containing the kubelet's ComponentConfig, workflow in kubelet init : /var/lib/kubelet/config.yaml dynamic environment file that contains KUBELET_KUBEADM_ARGS : /var/lib/kubelet/kubeadm-flags.env user-specified flag overrides with KUBELET_EXTRA_ARGS : /etc/default/kubelet (for DEBs) /etc/sysconfig/kubelet (for RPMs) modfiy /var/lib/kubelet KUBELET_EXTRA_ARGS$ sudo systemctl stop kubelet $ sudo echo 'KUBELET_EXTRA_ARGS=--root-dir=/mnt/kubelet' > /etc/sysconfig/kubelet $ sudo systemctl daemon-reload $ sudo systemctl start kubelet kuabelet configration [!TIP] references: kubelet flag --root-dir string Default: /var/lib/kubelet change kubelet root dir $ cat /etc/sysconfig/kubelet KUBELET_EXTRA_ARGS=--root-dir=/path/to/extra/folder $ grep EnvironmentFile /etc/systemd/system/kubelet.service.d/10-kubeadm.conf EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env EnvironmentFile=-/etc/sysconfig/kubelet $ systemctl daemon-reload $ systemctl enable kubelet --now $ systemctl start kubelet because of $ grep '/etc/sysconfig/kubelet' /etc/systemd/system/kubelet.service.d/10-kubeadm.conf EnvironmentFile=-/etc/sysconfig/kubele $ ps auxfww | grep kubelet root 2262 2.5 0.0 6830176 143332 ? Ssl 13:01 2:26 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --cgroup-driver=cgroupfs --network-plugin=cni --root-dir=/home/kubelet or symolic link $ sudo systemctl stop kubelet $ mkdir -p /mnt/kubelet $ sudo cp -r /var/lib/kubelet/* /mnt/kubelet/ $ sudo mv /var/lib/kubelet{,.backup} $ sudo ln -sf /mnt/kueblet /var/lib/kubelet $ sudo systemctl daemon-reload $ sudo systemctl start kubelet or add KUBELET_EXTRA_ARGS : $ cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf ... Environment=\"KUBELET_EXTRA_ARGS=$KUBELET_EXTRA_ARGS --root-dir=/path/to/extra/folder\" ... config files /etc/systemd/system/kubelet.service.d/10-kubeadm.conf [!TIP] This file specifies the default locations for all of the files managed by kubeadm for the kubelet. The KubeConfig file to use for the TLS Bootstrap is /etc/kubernetes/bootstrap-kubelet.conf, but it is only used if /etc/kubernetes/kubelet.conf does not exist. The KubeConfig file with the unique kubelet identity is /etc/kubernetes/kubelet.conf. The file containing the kubelet's ComponentConfig is /var/lib/kubelet/config.yaml. The dynamic environment file that contains KUBELET_KUBEADM_ARGS is sourced from /var/lib/kubelet/kubeadm-flags.env. The file that can contain user-specified flag overrides with KUBELET_EXTRA_ARGS is sourced from /etc/default/kubelet (for DEBs), or /etc/sysconfig/kubelet (for RPMs). KUBELET_EXTRA_ARGS is last in the flag chain and has the highest priority in the event of conflicting settings. $ cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf # Note: This dropin only works with kubeadm and kubelet v1.11+ [Service] Environment=\"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf\" Environment=\"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml\" # This is a file that \"kubeadm init\" and \"kubeadm join\" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env # This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use # the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file. EnvironmentFile=-/etc/sysconfig/kubelet ExecStart= ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/troubleshooting.html":{"url":"virtualization/kubernetes/troubleshooting.html","title":"troubleshooting","keywords":"","body":" error code debug services get podIp check log system logs pod logs [!TIP] Troubleshooting Applications Debug Pods Debug Service Debug a StatefulSet Determine the Reason for Pod Failure Debug Init Containers Debug Running Pods Get a Shell to a Running Container Troubleshooting Clusters Resource metrics pipeline Tools for Monitoring Resources Monitor Node Health Debugging Kubernetes nodes with crictl Debugging Kubernetes Nodes With Kubectl Developing and debugging services locally using telepresence Auditing Windows debugging tips Communicate Between Containers in the Same Pod Using a Shared Volume Translate a Docker Compose File to Kubernetes Resources pod资源限制和QoS探索 【K8S系列】Pod重启策略及重启可能原因 POD的内存限制 和 OOM Killer 记一次k8s pod频繁重启的优化之旅 error code ERROR CODE COMMENTS OOMKilled pod运行过程内存需求持续增加超过为pod设置的内存大小 Pending 调度不成功 or 资源不足 or HostPort 已被占用 Waiting/ContainerCreating 镜像拉取失败 or CNI网络错误 or 容器无法启动 or 磁盘坏道input/output error CrashLoopBackOff 容器曾经启动了但又异常退出 ImagePullBackOff 镜像名称配置错误或者私有镜像的密钥配置错误导致 CrashLoopBackOff 容器退出kubelet正在将它重启 InvalidImageName 无法解析镜像名称 ImageInspectError 无法校验镜像 ErrImageNeverPull 策略禁止拉取镜像 ImagePullBackOff 正在重试拉取 RegistryUnavailable 连接不到镜像中心 ErrImagePull 通用的拉取镜像出错 CreateContainerConfigError 不能创建kubelet使用的容器配置 CreateContainerError 创建容器失败 m.internalLifecycle.PreStartContainer 执行hook报错 RunContainerError 启动容器失败 PostStartHookError 执行hook报错 ContainersNotInitialized 容器没有初始化完毕 ContainersNotReady 容器没有准备完毕 ContainerCreating 容器创建中 PodInitializingpod 初始化中 DockerDaemonNotReady docker还没有完全启动 NetworkPluginNotReady 网络插件还没有完全启动 Evicte pod被驱赶 debug services [!NOTE|label:reference:] How to Debug a Kubernetes Service Effectively Debug Services Access Services Running on Clusters DNS for Services and Pods svc in cluster can be visit via CLUSTER-IP ..svc.cluster.local create pod from cmd svc status$ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE jenkins ClusterIP 10.111.230.13 8080/TCP,50017/TCP 17h # create new pod $ kubectl run ubuntu-marslo \\ --image=ubuntu:18.04 \\ --overrides='{\"spec\": { \"nodeSelector\": {\"kubernetes.io/hostname\": \"k8s-node-01\"}}}' \\ -it \\ --rm # check DNS $ cat /etc/resolv.conf nameserver 10.96.0.10 search devops.svc.cluster.local svc.cluster.local cluster.local company.com options ndots:5 # debug $ nc -zv jenkins.devops.svc.cluster.local 30338 $ nc -zv 10.111.230.13 30338 $ ssh -l marslo -p 30338 -i ~/.ssh/id_rsa jenkins.devops.svc.cluster.local list-plugins $ ssh -l marslo -p 30338 -i ~/.ssh/id_rsa 10.111.230.13 list-plugins get podIp $ kubectl get pods \\ -l app=hostnames \\ -o go-template='{{range .items}}{{.status.podIP}}{{\"\\n\"}}{{end}}' check log [!NOTE|label:references:] Kubernetes Logging Tutorial For Beginners system logs $ journalctl -u -f # or $ journalctl -u kubelet -o cat # or $ sudo systemctl status -l --no-pager pod logs references: Kubernetes / kubectl - \"A container name must be specified\" but seems like it is? $ kubectl logs pod --all-containers Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"virtualization/kubernetes/cheatsheet.html":{"url":"virtualization/kubernetes/cheatsheet.html","title":"cheatsheet","keywords":"","body":" - [oneline cmds](#oneline-cmds) Create a secret with several keys disable daemonset Using set commands to modify objects before creation Using --edit to modify objects before creation secrets auth kubecolor [!NOTE|label:references:] * kubectl Cheat Sheet * Cheatsheet - Kubectl * kubectl cheatsheet * Configure Pods and Containers * user-guide/kubectl-cheatsheet.md Assign Memory Resources to Containers and Pods Imperative Commands How to create objects run: Create a new Pod to run a Container. expose: Create a new Service object to load balance traffic across Pods. autoscale: Create a new Autoscaler object to automatically horizontally scale a controller, such as a Deployment. create: create [] i.e.: kubectl create service nodeport How to update objects scale : Horizontally scale a controller to add or remove Pods by updating the replica count of the controller. annotate : Add or remove an annotation from an object. label : Add or remove a label from an object. set : Set an aspect of an object. edit : Directly edit the raw configuration of a live object by opening its configuration in an editor. patch : Directly modify specific fields of a live object by using a patch string. For more details on patch strings, see the patch section in API Conventions. How to view an object get describe logs oneline cmds create [!NOTE|label:references:] Authorization Overview $ kubectl create -f - -o yaml or $ kubectl apply -f - or ```bash $ cat name: busybox image: busybox args: sleep \"1000000\" apiVersion: v1 kind: Pod metadata: name: busybox-sleep-less spec: containers: name: busybox image: busybox args: sleep \"1000\" EOF Create a secret with several keys $ cat ### [pods and containers](https://kubernetes.io/docs/tasks/configure-pod-container/) - [windwos pod](https://kubernetes.io/docs/tasks/configure-pod-container/configure-runasusername/) ```yaml apiVersion: v1 kind: Pod metadata: name: run-as-username-pod-demo spec: securityContext: windowsOptions: runAsUserName: \"ContainerUser\" containers: - name: run-as-username-demo image: mcr.microsoft.com/windows/servercore:ltsc2019 command: [\"ping\", \"-t\", \"localhost\"] nodeSelector: kubernetes.io/os: windows nodeAffinity apiVersion: v1 kind: Pod metadata: name: nginx spec: affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: disktype operator: In values: - ssd containers: - name: nginx image: nginx imagePullPolicy: IfNotPresent pod with termination message apiVersion: v1 kind: Pod metadata: name: termination-demo spec: containers: - name: termination-demo-container image: debian command: [\"/bin/sh\"] args: [\"-c\", \"sleep 10 && echo Sleep expired > /dev/termination-log\"] pod with quota apiVersion: apps/v1 kind: Deployment metadata: name: nginx-deployment spec: selector: matchLabels: app: nginx replicas: 2 template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx resources: limits: memory: \"128Mi\" cpu: \"500m\" ports: - containerPort: 80 initContainers apiVersion: v1 kind: Pod metadata: name: init-demo spec: containers: - name: nginx image: nginx ports: - containerPort: 80 volumeMounts: - name: workdir mountPath: /usr/share/nginx/html # These containers are run during pod initialization initContainers: - name: install image: busybox:1.28 command: - wget - \"-O\" - \"/work-dir/index.html\" - http://info.cern.ch volumeMounts: - name: workdir mountPath: \"/work-dir\" dnsPolicy: Default volumes: - name: workdir emptyDir: {} two container pod apiVersion: v1 kind: Pod metadata: name: two-containers spec: restartPolicy: Never volumes: - name: shared-data emptyDir: {} containers: - name: nginx-container image: nginx volumeMounts: - name: shared-data mountPath: /usr/share/nginx/html - name: debian-container image: debian volumeMounts: - name: shared-data mountPath: /pod-data command: [\"/bin/sh\"] args: [\"-c\", \"echo Hello from the debian container > /pod-data/index.html\"] share process namespace apiVersion: v1 kind: Pod metadata: name: nginx spec: shareProcessNamespace: true containers: - name: nginx image: nginx - name: shell image: busybox:1.28 securityContext: capabilities: add: - SYS_PTRACE stdin: true tty: true static pod $ mkdir -p /etc/kubernetes/manifests/ $ cat /etc/kubernetes/manifests/static-web.yaml apiVersion: v1 kind: Pod metadata: name: static-web labels: role: myrole spec: containers: - name: web image: nginx ports: - name: web containerPort: 80 protocol: TCP EOF deploy apiVersion: apps/v1 kind: Deployment metadata: name: nginx-deployment spec: selector: matchLabels: app: nginx minReadySeconds: 5 template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.14.2 ports: - containerPort: 80 memory-request-list apiVersion: v1 kind: Pod metadata: name: memory-demo namespace: mem-example spec: containers: - name: memory-demo-ctr image: polinux/stress resources: requests: memory: \"100Mi\" limits: memory: \"200Mi\" command: [\"stress\"] args: [\"--vm\", \"1\", \"--vm-bytes\", \"150M\", \"--vm-hang\", \"1\"] problem detector ds apiVersion: apps/v1 kind: DaemonSet metadata: name: node-problem-detector-v0.1 namespace: kube-system labels: k8s-app: node-problem-detector version: v0.1 kubernetes.io/cluster-service: \"true\" spec: selector: matchLabels: k8s-app: node-problem-detector version: v0.1 kubernetes.io/cluster-service: \"true\" template: metadata: labels: k8s-app: node-problem-detector version: v0.1 kubernetes.io/cluster-service: \"true\" spec: hostNetwork: true containers: - name: node-problem-detector image: registry.k8s.io/node-problem-detector:v0.1 securityContext: privileged: true resources: limits: cpu: \"200m\" memory: \"100Mi\" requests: cpu: \"20m\" memory: \"20Mi\" volumeMounts: - name: log mountPath: /log readOnly: true volumes: - name: log hostPath: path: /var/log/ cm apiVersion: apps/v1 kind: DaemonSet metadata: name: node-problem-detector-v0.1 namespace: kube-system labels: k8s-app: node-problem-detector version: v0.1 kubernetes.io/cluster-service: \"true\" spec: selector: matchLabels: k8s-app: node-problem-detector version: v0.1 kubernetes.io/cluster-service: \"true\" template: metadata: labels: k8s-app: node-problem-detector version: v0.1 kubernetes.io/cluster-service: \"true\" spec: hostNetwork: true containers: - name: node-problem-detector image: registry.k8s.io/node-problem-detector:v0.1 securityContext: privileged: true resources: limits: cpu: \"200m\" memory: \"100Mi\" requests: cpu: \"20m\" memory: \"20Mi\" volumeMounts: - name: log mountPath: /log readOnly: true - name: config # Overwrite the config/ directory with ConfigMap volume mountPath: /config readOnly: true volumes: - name: log hostPath: path: /var/log/ - name: config # Define ConfigMap volume configMap: name: node-problem-detector-config quota pods apiVersion: v1 kind: ResourceQuota metadata: name: pod-demo spec: hard: pods: \"2\" Pod Security Standards with Namespace Labels apiVersion: v1 kind: Namespace metadata: name: my-baseline-namespace labels: pod-security.kubernetes.io/enforce: baseline pod-security.kubernetes.io/enforce-version: v1.27 # We are setting these to our _desired_ `enforce` level. pod-security.kubernetes.io/audit: restricted pod-security.kubernetes.io/audit-version: v1.27 pod-security.kubernetes.io/warn: restricted pod-security.kubernetes.io/warn-version: v1.27 secretRef: env with secrets in pod single secret $ kubectl create secret generic backend-user --from-literal=backend-username='backend-admin' $ cat multiple secrets $ kubectl create secret generic backend-user --from-literal=backend-username='backend-admin' $ kubectl create secret generic db-user --from-literal=db-username='db-admin' $ cat from secret $ kubectl create secret generic test-secret \\ --from-literal=username='my-app' \\ --from-literal=password='39528$vdg7Jb' $ cat envvars apiVersion: v1 kind: Pod metadata: name: dependent-envars-demo spec: containers: - name: dependent-envars-demo args: - while true; do echo -en '\\n'; printf UNCHANGED_REFERENCE=$UNCHANGED_REFERENCE'\\n'; printf SERVICE_ADDRESS=$SERVICE_ADDRESS'\\n';printf ESCAPED_REFERENCE=$ESCAPED_REFERENCE'\\n'; sleep 30; done; command: - sh - -c image: busybox:1.28 env: - name: SERVICE_PORT value: \"80\" - name: SERVICE_IP value: \"172.17.0.1\" - name: UNCHANGED_REFERENCE value: \"$(PROTOCOL)://$(SERVICE_IP):$(SERVICE_PORT)\" - name: PROTOCOL value: \"https\" - name: SERVICE_ADDRESS value: \"$(PROTOCOL)://$(SERVICE_IP):$(SERVICE_PORT)\" - name: ESCAPED_REFERENCE value: \"$$(PROTOCOL)://$(SERVICE_IP):$(SERVICE_PORT)\" AdmissionConfiguration [!NOET] Migrate from PodSecurityPolicy to the Built-In PodSecurity Admission Controller apiVersion: apiserver.config.k8s.io/v1 # see compatibility note kind: AdmissionConfiguration plugins: - name: PodSecurity configuration: apiVersion: pod-security.admission.config.k8s.io/v1 kind: PodSecurityConfiguration # Defaults applied when a mode label is not set. # # Level label values must be one of: # - \"privileged\" (default) # - \"baseline\" # - \"restricted\" # # Version label values must be one of: # - \"latest\" (default) # - specific version like \"v1.27\" defaults: enforce: \"privileged\" enforce-version: \"latest\" audit: \"privileged\" audit-version: \"latest\" warn: \"privileged\" warn-version: \"latest\" exemptions: # Array of authenticated usernames to exempt. usernames: [] # Array of runtime class names to exempt. runtimeClasses: [] # Array of namespaces to exempt. namespaces: [] pv apiVersion: v1 kind: PersistentVolume metadata: name: task-pv-volume labels: type: local spec: storageClassName: manual capacity: storage: 10Gi accessModes: - ReadWriteOnce hostPath: path: \"/mnt/data\" pv pod apiVersion: v1 kind: Pod metadata: name: task-pv-pod spec: volumes: - name: task-pv-storage persistentVolumeClaim: claimName: task-pv-claim containers: - name: task-pv-container image: nginx ports: - containerPort: 80 name: \"http-server\" volumeMounts: - mountPath: \"/usr/share/nginx/html\" name: task-pv-storage pvc apiVersion: v1 kind: PersistentVolumeClaim metadata: name: task-pv-claim spec: storageClassName: manual accessModes: - ReadWriteOnce resources: requests: storage: 3Gi cm # Download the sample files into `configure-pod-container/configmap/` directory wget https://kubernetes.io/examples/configmap/game.properties -O configure-pod-container/configmap/game.properties wget https://kubernetes.io/examples/configmap/ui.properties -O configure-pod-container/configmap/ui.properties # Create the ConfigMap kubectl create configmap game-config --from-file=configure-pod-container/configmap/ probe apiVersion: v1 kind: Pod metadata: labels: test: liveness name: liveness-exec spec: containers: - name: liveness image: registry.k8s.io/busybox args: - /bin/sh - -c - touch /tmp/healthy; sleep 30; rm -f /tmp/healthy; sleep 600 livenessProbe: exec: command: - cat - /tmp/healthy initialDelaySeconds: 5 periodSeconds: 5 ClusterRole apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: impersonator rules: - apiGroups: [\"\"] resources: [\"users\", \"groups\", \"serviceaccounts\"] verbs: [\"impersonate\"] # or apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: scopes-and-uid-impersonator rules: # Can set \"Impersonate-Extra-scopes\" header and the \"Impersonate-Uid\" header. - apiGroups: [\"authentication.k8s.io\"] resources: [\"userextras/scopes\", \"uids\"] verbs: [\"impersonate\"] # or apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: limited-impersonator rules: # Can impersonate the user \"jane.doe@example.com\" - apiGroups: [\"\"] resources: [\"users\"] verbs: [\"impersonate\"] resourceNames: [\"jane.doe@example.com\"] # Can impersonate the groups \"developers\" and \"admins\" - apiGroups: [\"\"] resources: [\"groups\"] verbs: [\"impersonate\"] resourceNames: [\"developers\",\"admins\"] # Can impersonate the extras field \"scopes\" with the values \"view\" and \"development\" - apiGroups: [\"authentication.k8s.io\"] resources: [\"userextras/scopes\"] verbs: [\"impersonate\"] resourceNames: [\"view\", \"development\"] # Can impersonate the uid \"06f6ce97-e2c5-4ab8-7ba5-7654dd08d52b\" - apiGroups: [\"authentication.k8s.io\"] resources: [\"uids\"] verbs: [\"impersonate\"] resourceNames: [\"06f6ce97-e2c5-4ab8-7ba5-7654dd08d52b\"] disable daemonset [!NOTE|label:referfences:] how to scale kubernetes daemonset to 0? $ kubectl patch daemonset \\ -n \\ -p '{\"spec\": {\"template\": {\"spec\": {\"nodeSelector\": {\"non-existing\": \"true\"}}}}}' Using set commands to modify objects before creation $ kubectl create service clusterip my-svc --clusterip=\"None\" -o yaml --dry-run=client | kubectl set selector --local -f - 'environment=qa' -o yaml | kubectl create -f - Using --edit to modify objects before creation $ kubectl create service clusterip my-svc --clusterip=\"None\" -o yaml --dry-run=client > /tmp/srv.yaml $ kubectl create --edit -f /tmp/srv.yaml secrets [!NOTE|label:referencs:] Managing Secrets using kubectl Managing Secrets using Configuration File via kubectl # with raw data $ kubectl create secret generic db-user-pass \\ --from-literal=username=admin \\ --from-literal=password='S!B\\*d$zDsb=' # with source file $ echo -n 'admin' > ./username.txt $ echo -n 'S!B\\*d$zDsb=' > ./password.txt $ kubectl create secret generic db-user-pass \\ --from-file=./username.txt \\ --from-file=./password.txt # or $ kubectl create secret generic db-user-pass \\ --from-file=username=./username.txt \\ --from-file=password=./password.txt via config file $ echo -n 'admin' | base64 # YWRtaW4= $ echo -n '1f2d1e2e67df' | base64 # MWYyZDFlMmU2N2Rm $ cat via cmd $ kubectl create secret generic test-secret \\ --from-literal='username=my-app' \\ --from-literal='password=39528$vdg7Jb' auth [!NOTE|label:references:] Adding permission to exec commands in containers inside pods in a certain namespace auth can-i [!NOTE|label:references:] kubectl-auth-can-i - Man Page $ namespace='test' $ kubectl auth can-i get pods -n \"${namespace}\" yes $ kubectl auth can-i list pods -n \"${namespace}\" yes $ kubectl auth can-i create pods -n \"${namespace}\" yes $ kubectl auth can-i create pods/exec -n \"${namespace}\" yes $ kubectl auth can-i get pods/exec -n \"${namespace}\" yes $ kubectl auth can-i create pods --subresource=exec -n \"${namespace}\" no $ kubectl auth can-i get pods --subresource=exec -n \"${namespace}\" no more$ while read -r namespace; do echo -e \"\\n>> ${namespace}\"; echo \"pod :\"; echo \".. pod list: $(kubectl auth can-i list pods -n ${namespace})\"; echo \".. pod create: $(kubectl auth can-i create pods -n ${namespace})\"; echo \".. pod create exec: $(kubectl auth can-i create pods --subresource=exec -n ${namespace})\"; echo \".. pod get exec : $(kubectl auth can-i get pods --subresource=exec -n ${namespace})\"; echo \"statefulset :\"; echo \".. sts get : $(kubectl auth can-i get statefulset -n ${namespace})\"; echo \".. sts list : $(kubectl auth can-i list statefulset -n ${namespace})\"; echo \".. sts create : $(kubectl auth can-i create statefulset -n ${namespace})\"; echo \"ingressroute :\"; echo \".. ingressroute : $(kubectl auth can-i get ingressroute -n ${namespace})\"; echo \".. ingressroutetcp : $(kubectl auth can-i get ingressroutetcp -n ${namespace})\"; done kubecolor [!NOTE|label:references:] hidetatz/kubecolor go [!NOTE|label:references:] Download and install Managing Go installations $ mkdir -p /opt/go $ curl -fsSL https://dl.google.com/go/go1.21.4.linux-amd64.tar.gz | tar xzf - -C /opt/go $ cat >> ~/.bashrc kubecolor # install via go $ go install github.com/hidetatz/kubecolor/cmd/kubecolor@latest # or $ go get -u github.com/hidetatz/kubecolor/cmd/kubecolor # brew $ brew install hidetatz/tap/kubecolor config # autocomplete $ cat >> ~/.bashrc Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/api.html":{"url":"virtualization/kubernetes/api.html","title":"api","keywords":"","body":" acess cluster access cluster with cacert references: * Kubernetes API * Access Clusters Using the Kubernetes API The Kubernetes API The OAuth 2.0 Authorization Framework: Bearer Token Usage * How to Access Kubernetes API Server * Access Kubernetes API with Client Certificates * Interacting directly with the API * Kubernetes API Basics - Resources, Kinds, and Objects Accessing Clusters * one-page api reference for kubernetes v1.24 * API Access Control using api customizing components with the kubeadm api workload resources Pod PodTemplate ReplicationController ReplicaSet Deployment StatefulSet ControllerRevision DaemonSet Job CronJob HorizontalPodAutoscaler PriorityClass service resources Service Endpoints EndpointSlice Ingress IngressClass config and storage resources authentication resources authorization resources policy resources cluster resources Node Namespace Event APIService Lease RuntimeClass FlowSchema v1beta2 PriorityLevelConfiguration v1beta2 Binding ComponentStatus common definitions [!NOTE] There are several different proxies you may encounter when using Kubernetes: The kubectl proxy: runs on a user's desktop or in a pod proxies from a localhost address to the Kubernetes apiserver client to proxy uses HTTP proxy to apiserver uses HTTPS locates apiserver adds authentication headers The apiserver proxy: is a bastion built into the apiserver connects a user outside of the cluster to cluster IPs which otherwise might not be reachable runs in the apiserver processes client to proxy uses HTTPS (or http if apiserver so configured) proxy to target may use HTTP or HTTPS as chosen by proxy using available information can be used to reach a Node, Pod, or Service does load balancing when used to reach a Service The kube proxy: runs on each node proxies UDP and TCP does not understand HTTP provides load balancing is only used to reach services A Proxy/Load-balancer in front of apiserver(s): existence and implementation varies from cluster to cluster (e.g. nginx) sits between all clients and one or more apiservers acts as load balancer if there are several apiservers. Cloud Load Balancers on external services: are provided by some cloud providers (e.g. AWS ELB, Google Cloud Load Balancer) are created automatically when the Kubernetes service has type LoadBalancer use UDP/TCP only implementation varies by cloud provider. [!NOTE|label:tips:] get server$ server=$(kubectl config view -ojsonpath=\"{.clusters[*].cluster.server}\") get default sa name $ name=$(kubectl get sa -n default default -ojsonpath=\"{.secrets[].name}\") get token $ token=$(kubectl get secrets -n default $(kubectl get sa -n default default -ojsonpath=\"{.secrets[].name}\") -o jsonpath=\"{.data.token}\" | base64 -d) get cacert$ cacert=$(kubectl config view --raw -ojsonpath=\"{.clusters[].cluster.certificate-authority-data}\" | base64 -d) curl HEAD -H \"Authorization: Bearer $token\" API path $ ${server}/api/ acess cluster $ APISERVER=$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}') # or get via cluster name of `kubernetes-staging` $ APISERVER=$(kubectl config view -o jsonpath='{.clusters[?(@.name == \"kubernetes-staging\")].cluster.server}') $ TOKEN=$(kubectl get secret default-token -o jsonpath='{.data.token}' | base64 --decode) $ curl ${APISERVER}/api --header \"Authorization: Bearer ${TOKEN}\" --insecure or $ APISERVER=$(kubectl config view --minify | grep server | cut -f 2- -d \":\" | tr -d \" \") # or via jsonpath $ APISERVER=$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}') # or get via cluster name of `kubernetes-staging` $ APISERVER=$(kubectl config view -o jsonpath='{.clusters[?(@.name == \"kubernetes-staging\")].cluster.server}') $ TOKEN=$(kubectl describe secret default-token | grep -E '^token' | cut -f2 -d':' | tr -d \" \") $ curl ${APISERVER}/api --header \"Authorization: Bearer ${TOKEN}\" --insecure { \"kind\": \"APIVersions\", \"versions\": [ \"v1\" ], \"serverAddressByClientCIDRs\": [ { \"clientCIDR\": \"0.0.0.0/0\", \"serverAddress\": \":6443\" } ] } access cluster with cacert $ curl --include \\ --cacert Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/tools.html":{"url":"virtualization/kubernetes/tools.html","title":"tools","keywords":"","body":" etcd check healthy re-add etcd network ingress jobs valut eks others How To Create Kubernetes YAML Manifests Quickly etcd references: Operating etcd clusters for Kubernetes Set up a High Availability etcd Cluster with kubeadm check healthy $ kubectl get --raw=/healthz/etcd re-add etcd $ ssh devops@kubernets.master $ docker run -it \\ -v /var/lib/etcd:/var/lib/etcd \\ -v /etc/kubernetes/pki/etcd:/etc/kubernetes/pki/etcd \\ -p 2380:2380 \\ -p 2379:2379 \\ --network=host \\ k8s.gcr.io/etcd:3.2.24 # running inside docker $ etcdctl --ca-file /etc/kubernetes/pki/etcd/ca.crt \\ --cert-file /etc/kubernetes/pki/etcd/peer.crt \\ --key-file /etc/kubernetes/pki/etcd/peer.key \\ -endpoints=https://:2379,https://:2379,https://:2379 \\ member list >> a874c87fd42044f: name= peerURLs=https://:2380 clientURLs=https://:2379 isLeader=true >> 3be12ef2ee5f92e7(unstarted): name= peerURLs=https://:2380 >> da3e2155721a00f6: name= peerURLs=https://:2380 clientURLs=https://:2379 isLeader=false # remove \"unstarted\" node $ etcdctl --ca-file /etc/kubernetes/pki/etcd/ca.crt \\ --cert-file /etc/kubernetes/pki/etcd/peer.crt \\ --key-file /etc/kubernetes/pki/etcd/peer.key \\ -endpoints=https://:2379,https://:2379,https://:2379 \\ member remove 3be12ef2ee5f92e7 # re-add again $ etcdctl --ca-file /etc/kubernetes/pki/etcd/ca.crt \\ --cert-file /etc/kubernetes/pki/etcd/peer.crt \\ --key-file /etc/kubernetes/pki/etcd/peer.key \\ -endpoints=https://:2379,https://:2379,https://:2379 \\ member add https://:2380 network ingress traffic flow [!NOTE|label:references:] Kubernetes Ingress Tutorial For Beginners jobs [!NOTE|label:references:] How To Create Kubernetes Jobs and Cronjobs – Getting Started Guide valut [!NOTE|label:references:] How to Setup Vault in Kubernetes- Beginners Tutorial eks [!NOTE|label:references:] How to Create AWS EKS Cluster Using eksctl others How To Create Kubernetes YAML Manifests Quickly Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"virtualization/kubernetes/monitor.html":{"url":"virtualization/kubernetes/monitor.html","title":"monitor","keywords":"","body":" prometheus prometheus architecture grafana environment setup dashboard grafana settings api add-ons metric server sample yaml q&a kube-state-metrics installation scripts node resources [!NOTE|label:references] MONITORING LINUX HOST METRICS WITH THE NODE EXPORTER Kubernetes Resources(四) - Metrics Server 安裝 Prometheus 5 - Node Exporter & Kube State Metrics kube-state-metrics | Tutorial, Setup, and Examples Installing Kubernetes Metric Server Part-1: Setup Prometheus, Kube State metrics and Integrate Grafana with Kubernetes K8s资源限制设置limit未设置request会导致request默认等于limit造成资源浪费 * How to Setup Prometheus Monitoring On Kubernetes Cluster code pool kubeless/manifests/monitoring kube-prometheus/manifests kubernetes-handbook/manifests/prometheus prometheus prometheus architecture grafana references: * Setting Up Kubernetes Dashboard * Deploy Grafana Enterprise on Kubernetes * Deploy Grafana on Kubernetes * Kubernetes Integration * Install plugin from dockerfile * grafana/grafana-docker Scaling out Grafana with Kubernetes and AWS Monitoring Kubernetes Clusters with Grafana Configure a Grafana Docker image Configure Grafana Grafana 6.2 documentation : Installing using Docker Restart Grafana Grafana Loki Concise Tutorial Grafana CLI * Prometheus data source * GRAFANA SUPPORT FOR PROMETHEUS * Create Grafana Dashboards with Prometheus Metrics how to: How To Setup Grafana On Kubernetes How To Setup Kube State Metrics on Kubernetes environment [!TIP] reference Do not use environment variables to add new configuration settings. Instead, use environmental variables to override existing options. To override an option:GF__ If you need to specify the version of a plugin, then you can add it to the GF_INSTALL_PLUGINS environment variable. Otherwise, the latest is used. For example:-e \"GF_INSTALL_PLUGINS=grafana-clock-panel 1.0.1,grafana-simple-json-datasource 1.3.5\" # for pvc kubems-01 ~ $ mkdir -p /opt/grafana/plugins kubems-01 ~ $ sudo chown -R 472:472 $_ # https://grafana.com/docs/grafana/latest/installation/docker/#migration-from-a-previous-version-of-the-docker-container-to-5-1-or-later # 104:104 for version user id changes Version User User ID grafana 104 >= 5.1 grafana 472 path SETTING DEFAULT VALUE GF_PATHS_CONFIG /etc/grafana/grafana.ini GF_PATHS_DATA /var/lib/grafana GF_PATHS_HOME /usr/share/grafana GF_PATHS_LOGS /var/log/grafana GF_PATHS_PLUGINS /var/lib/grafana/plugins GF_PATHS_PROVISIONING /etc/grafana/provisioning environment ENVIRONMENT VARIABLE EXAMPLE GF_INSTALL_PLUGINS grafana-kubernetes-app,grafana-piechart-panel,http://my.com/plugin.zip GF_PATHS_PLUGINS /data/grafana/plugins GF_SERVER_ROOT_URL https://my.grafana.com GF_SECURITY_ADMIN_PASSWORD admin GF_DEFAULT_INSTANCE_NAME - GF_SECURITY_ADMIN_USER - GF_DATABASE_TYPE mysql GF_DATABASE_HOST - setup ns $ cat sa $ cat pv & pvc $ cat deploy $ cat svc $ cat ingress $ cat dashboard kubernetes cluster monitoring devopsprodigy-kubegraf-app install via grafana-cli $ grafana-cli plugins install devopsprodigy-kubegraf-app setup sa and cluster role $ kubectl create ns kubegraf $ kubectl apply -f https://raw.githubusercontent.com/devopsprodigy/kubegraf/master/kubernetes/serviceaccount.yaml $ kubectl apply -f https://raw.githubusercontent.com/devopsprodigy/kubegraf/master/kubernetes/clusterrole.yaml $ kubectl apply -f https://raw.githubusercontent.com/devopsprodigy/kubegraf/master/kubernetes/clusterrolebinding.yaml $ kubectl apply -f https://raw.githubusercontent.com/devopsprodigy/kubegraf/master/kubernetes/secret.yaml create private certificate copy `/etc/kubernetes/pki/grafana-kubegraf.crt` to all masters $ openssl genrsa -out ~/grafana-kubegraf.key 2048 $ openssl req -new -key ~/grafana-kubegraf.key -out ~/grafana-kubegraf.csr -subj \"/CN=grafana-kubegraf/O=monitoring\" $ openssl x509 -req -in ~/grafana-kubegraf.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -out /etc/kubernetes/pki/grafana-kubegraf.crt -CAcreateserial get token$ kubectl get secret grafana-kubegraf-secret -o jsonpath={.data.token} -n kubegraf | base64 -d grafana-kubernetes-app @deprecated install via grafana-cli$ grafana-cli plugins install kubernetes-app setup$ cat ~/.kube/config | grep certificate-authority-data | awk '{print $2}' | base64 -d $ cat ~/.kube/config | grep client-certificate-data | awk '{print $2}' | base64 -d $ cat ~/.kube/config | grep client-key-data | awk '{print $2}' | base64 -d references: Dashboards Monitor Kubernetes easily with Grafana Export and import Create Grafana Dashboards with Prometheus Metrics cluster *315 - Kubernetes cluster monitoring (via Prometheus) *8588 - Kubernetes Deployment Statefulset Daemonset metrics 6417 - Kubernetes Cluster (Prometheus) 3662 - Prometheus 2.0 Overview node *1860 - Node Exporter Full *6287 - Host Overview *10242 - Node Exporter Full with Node Name namespace *9809 - Kubernetes Namespace Resources pod *747 - Kubernetes Pod Metrics *6336 - Kubernetes Pods jenkins 9524 - a Jenkins performance and health overview for jenkinsci/prometheus-plugin 9964 - Jenkins: Performance and Health Overview grafana settings clusterlabel_values(kube_pod_info, cluster) orlabel_values(node_cpu_seconds_total, cluster) instance label_values(apiserver_request_total{job=\"apiserver\"}, instance) node label_values(kube_node_info{cluster=\"$cluster\"}, node) orlabel_values(kubernetes_io_hostname) namespace label_values(kube_pod_info{cluster=\"$cluster\"}, namespace) pod label_values(kube_pod_info{cluster=\"$cluster\", namespace=\"$namespace\"}, pod) api references: Grafana Docker and data persistence reset password $ curl -X PUT -H \"Content-Type: application/json\" -d '{ \"oldPassword\": \"admin\", \"newPassword\": \"newpass\", \"confirmNew\": \"newpass\" }' http://admin:admin@:3000/api/user/password set grafana admin password $ docker exec -t grafana \\ bash -c 'grafana-cli --homepath /usr/share/grafana admin reset-admin-password \"{{ grafana_passwd }}\"' check if grafana can be accessed $ curl -s http://localhost:3000/api/org \\ -u {{ grafana_user }}:{{ grafana_passwd }} create datasoure in grafana $ curl -L \\ --header 'Content-Type: application/json' \\ --header 'Accept: application/json' \\ -d@//docker_data/grafana_conf/grafanacfg.output http://localhost:3000/api/datasources \\ -u {{ grafana_user }}:{{ grafana_passwd }} create TelegrafHost dashboard in grafana using jsonfile $ curl -L \\ --header 'Content-Type: application/json' \\ --header 'Accept: application/json' \\ -d@/home/Configfiles/dashboards/TelegrafHostMetrics.json http://localhost:3000/api/dashboards/db \\ -u {{ grafana_user }}:{{ grafana_passwd }} create DockerMetrics dashboard in grafana using jsonfile $ curl --header 'Content-Type: application/json' \\ --header 'Accept: application/json' \\ -d@/home/Configfiles/dashboards/DockerMetricsperContainer.json http://localhost:3000/api/dashboards/db \\ -u {{ grafana_user }}:{{ grafana_passwd }} create JVM dashboard in grafana using jsonfile $ curl --header 'Content-Type: application/json' \\ --header 'Accept: application/json' \\ -d@/home/Configfiles/dashboards/jvm-metrics-jolokia-2_rev1.json http://localhost:3000/api/dashboards/db \\ -u {{ grafana_user }}:{{ grafana_passwd }} add-ons kube-state-metrics node_exporter alertmanager kube-resource-explorer metric server [!NOTE|label:references:] kubernetes-sigs/metrics-server metrics-server-deployment.yaml Kubernetes metrics | Error from server (ServiceUnavailable) | Quick 2 fixes sample yaml apiVersion: v1 kind: ServiceAccount metadata: labels: k8s-app: metrics-server name: metrics-server namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: labels: k8s-app: metrics-server rbac.authorization.k8s.io/aggregate-to-admin: \"true\" rbac.authorization.k8s.io/aggregate-to-edit: \"true\" rbac.authorization.k8s.io/aggregate-to-view: \"true\" name: system:aggregated-metrics-reader rules: - apiGroups: - metrics.k8s.io resources: - pods - nodes verbs: - get - list - watch --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: labels: k8s-app: metrics-server name: system:metrics-server rules: - apiGroups: - \"\" resources: - nodes/metrics verbs: - get - apiGroups: - \"\" resources: - pods - nodes verbs: - get - list - watch --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: labels: k8s-app: metrics-server name: metrics-server-auth-reader namespace: kube-system roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: extension-apiserver-authentication-reader subjects: - kind: ServiceAccount name: metrics-server namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: labels: k8s-app: metrics-server name: metrics-server:system:auth-delegator roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:auth-delegator subjects: - kind: ServiceAccount name: metrics-server namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: labels: k8s-app: metrics-server name: system:metrics-server roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:metrics-server subjects: - kind: ServiceAccount name: metrics-server namespace: kube-system --- apiVersion: v1 kind: Service metadata: labels: k8s-app: metrics-server name: metrics-server namespace: kube-system spec: ports: - name: https port: 443 protocol: TCP targetPort: https selector: k8s-app: metrics-server --- apiVersion: apps/v1 kind: Deployment metadata: labels: k8s-app: metrics-server name: metrics-server namespace: kube-system spec: selector: matchLabels: k8s-app: metrics-server strategy: rollingUpdate: maxUnavailable: 0 template: metadata: labels: k8s-app: metrics-server spec: containers: - args: - --cert-dir=/tmp - --secure-port=4443 - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname - --kubelet-use-node-status-port - --kubelet-insecure-tls - --metric-resolution=15s image: registry.k8s.io/metrics-server/metrics-server:v0.6.3 imagePullPolicy: IfNotPresent livenessProbe: failureThreshold: 3 httpGet: path: /livez port: https scheme: HTTPS periodSeconds: 10 name: metrics-server ports: - containerPort: 4443 name: https protocol: TCP readinessProbe: failureThreshold: 3 httpGet: path: /readyz port: https scheme: HTTPS initialDelaySeconds: 20 periodSeconds: 10 resources: requests: cpu: 100m memory: 200Mi securityContext: allowPrivilegeEscalation: false readOnlyRootFilesystem: true runAsNonRoot: true runAsUser: 1000 volumeMounts: - mountPath: /tmp name: tmp-dir nodeSelector: kubernetes.io/os: linux priorityClassName: system-cluster-critical serviceAccountName: metrics-server volumes: - emptyDir: {} name: tmp-dir --- apiVersion: apiregistration.k8s.io/v1 kind: APIService metadata: labels: k8s-app: metrics-server name: v1beta1.metrics.k8s.io spec: group: metrics.k8s.io groupPriorityMinimum: 100 insecureSkipTLSVerify: true service: name: metrics-server namespace: kube-system version: v1beta1 versionPriority: 100 q&a $ curl -k https://api.server.com:6443/api/v1/model/metrics/ { \"kind\": \"Status\", \"apiVersion\": \"v1\", \"metadata\": { }, \"status\": \"Failure\", \"message\": \"model \\\"metrics\\\" is forbidden: User \\\"system:anonymous\\\" cannot get resource \\\"model\\\" in API group \\\"\\\" at the cluster scope\", \"reason\": \"Forbidden\", \"details\": { \"name\": \"metrics\", \"kind\": \"model\" }, \"code\": 403 } $ kubectl get --raw \"/apis/metrics.k8s.io/v1beta1/pods\" Error from server (ServiceUnavailable): the server is currently unable to handle the request $ kubectl top node Error from server (ServiceUnavailable): the server is currently unable to handle the request (get nodes.metrics.k8s.io) $ kubectl describe apiservice v1beta1.metrics.k8s.io Name: v1beta1.metrics.k8s.io Namespace: Labels: k8s-app=metrics-server Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"apiregistration.k8s.io/v1\",\"kind\":\"APIService\",\"metadata\":{\"annotations\":{},\"labels\":{\"k8s-app\":\"metrics-server\"},\"name\":\"v... API Version: apiregistration.k8s.io/v1 Kind: APIService Metadata: Creation Timestamp: 2023-05-10T03:35:06Z Resource Version: 404029923 Self Link: /apis/apiregistration.k8s.io/v1/apiservices/v1beta1.metrics.k8s.io UID: a7f6a96d-eee3-11ed-9c0f-b883034b82d0 Spec: Group: metrics.k8s.io Group Priority Minimum: 100 Insecure Skip TLS Verify: true Service: Name: metrics-server Namespace: kube-system Version: v1beta1 Version Priority: 100 Status: Conditions: Last Transition Time: 2023-05-10T03:35:06Z Message: endpoints for service/metrics-server in \"kube-system\" have no addresses Reason: MissingEndpoints Status: False Type: Available Events: kube-state-metrics [!INFO|label:references:] kube-state-metrics | Tutorial, Setup, and Examples kube-state-metrics Helm Chart How To Setup Kube State Metrics on Kubernetes installation $ helm repo add prometheus-community https://prometheus-community.github.io/helm-charts $ helm repo update $ helm install kube-state-metrics prometheus-community/kube-state-metrics # others $ helm show values prometheus-community/kube-state-metrics $ helm install -f config.yaml kube-state-metrics prometheus-community/kube-state-metrics $ kubectl port-forward svc/kube-state-metrics 8080:8080 $ curl 127.0.0.1:8080/metrics | grep kube_node_status_capacity # cost considerations # values.yaml metricAllowlist: - kube_node_info - kube_job_status_active scripts node resources $ cat bin/node-resources.sh #!/bin/bash set -euo pipefail echo -e \"Iterating...\\n\" nodes=$(kubectl get node --no-headers -o custom-columns=NAME:.metadata.name) for node in $nodes; do echo \"Node: $node\" kubectl describe node \"$node\" | sed '1,/Non-terminated Pods/d' echo done one-line $ kubectl get nodes | awk '{print $1}' | xargs -I {} sh -c 'echo {} ; kubectl describe node {} | grep Allocated -A 5 | grep -ve Event -ve Allocated -ve percent -ve -- ; echo ' # alias $ alias util='kubectl get nodes | awk '\\''{print $1}'\\'' | xargs -I {} sh -c '\\''echo {} ; kubectl describe node {} | grep Allocated -A 5 | grep -ve Event -ve Allocated -ve percent -ve -- ; echo '\\''' # or $ alias util='kubectl get nodes -o 'jsonpath={.items[*].metadata.name} | fmt -1 | xargs -I {} sh -c '\\''echo {} ; kubectl describe node {} | grep Allocated -A 5 | grep -ve Event -ve Allocated -ve percent -ve -- ; echo '\\''' # or $ alias util='kubectl get no --no-headers -o=custom-columns=NAME:.metadata.name | xargs -I {} sh -c '\\''echo {} ; kubectl describe node {} | grep Allocated -A 5 | grep -ve Event -ve Allocated -ve percent -ve -- ; echo '\\''' Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"virtualization/kubernetes/helm.html":{"url":"virtualization/kubernetes/helm.html","title":"helm","keywords":"","body":" install helm3 helm2 install plugin install apps configuration init add repo default credential usage install Jenkins search troubleshooting check helm show history status get get all others helm is compatible references: * How To Install Helm 3 For Kubernetes * How to Create a Helm Chart [Comprehensive Beginners Guide] install [!NOTE|label:references:] 安装Helm helm3 $ curl -kL https://git.io/get_helm.sh | bash # or $ bash $ helm version version.BuildInfo{Version:\"v3.12.0\", GitCommit:\"c9f554d75773799f72ceef38c51210f1842a1dea\", GitTreeState:\"clean\", GoVersion:\"go1.20.3\"} $ helm --help The Kubernetes package manager Common actions for Helm: - helm search: search for charts - helm pull: download a chart to your local directory to view - helm install: upload the chart to Kubernetes - helm list: list releases of charts Environment variables: | Name | Description | |------------------------------------|---------------------------------------------------------------------------------------------------| | $HELM_CACHE_HOME | set an alternative location for storing cached files. | | $HELM_CONFIG_HOME | set an alternative location for storing Helm configuration. | | $HELM_DATA_HOME | set an alternative location for storing Helm data. | | $HELM_DEBUG | indicate whether or not Helm is running in Debug mode | | $HELM_DRIVER | set the backend storage driver. Values are: configmap, secret, memory, sql. | | $HELM_DRIVER_SQL_CONNECTION_STRING | set the connection string the SQL storage driver should use. | | $HELM_MAX_HISTORY | set the maximum number of helm release history. | | $HELM_NAMESPACE | set the namespace used for the helm operations. | | $HELM_NO_PLUGINS | disable plugins. Set HELM_NO_PLUGINS=1 to disable plugins. | | $HELM_PLUGINS | set the path to the plugins directory | | $HELM_REGISTRY_CONFIG | set the path to the registry config file. | | $HELM_REPOSITORY_CACHE | set the path to the repository cache directory | | $HELM_REPOSITORY_CONFIG | set the path to the repositories file. | | $KUBECONFIG | set an alternative Kubernetes configuration file (default \"~/.kube/config\") | | $HELM_KUBEAPISERVER | set the Kubernetes API Server Endpoint for authentication | | $HELM_KUBECAFILE | set the Kubernetes certificate authority file. | | $HELM_KUBEASGROUPS | set the Groups to use for impersonation using a comma-separated list. | | $HELM_KUBEASUSER | set the Username to impersonate for the operation. | | $HELM_KUBECONTEXT | set the name of the kubeconfig context. | | $HELM_KUBETOKEN | set the Bearer KubeToken used for authentication. | | $HELM_KUBEINSECURE_SKIP_TLS_VERIFY | indicate if the Kubernetes API server's certificate validation should be skipped (insecure) | | $HELM_KUBETLS_SERVER_NAME | set the server name used to validate the Kubernetes API server certificate | | $HELM_BURST_LIMIT | set the default burst limit in the case the server contains many CRDs (default 100, -1 to disable)| Helm stores cache, configuration, and data based on the following configuration order: $ curl -fsSL \\ https://get.helm.sh/helm-v2.14.3-linux-amd64.tar.gz \\ | sudo tar -xzv --strip-components=1 -C /usr/local/bin/ $ while read -r _i; do sudo chmod +x \"/usr/local/bin/${_i}\" done helm2 $ curl -fsSL \\ https://get.helm.sh/helm-v2.14.3-linux-amd64.tar.gz | sudo tar -xzv --strip-components=1 -C /usr/local/bin/ $ while read -r _i; do sudo chmod +x \"/usr/local/bin/${_i}\" done install plugin $ echo '-k' >> ~/.curlrc $ helm plugin install https://github.com/databus23/helm-diff install apps [!NOTE|label:references:] minikube helm 安装 jenkins configuration init [!TIP|label:NOT suitable for helm3] $ helm init $ helm init --client-only $ kubectl create serviceaccount -n kube-system tiller $ kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller $ kubectl patch deploy -n kube-system tiller-deploy -p '{\"spec\":{\"template\":{\"spec\":{\"serviceAccount\":\"tiller\"}}}}' add repo $ helm repo add jenkins https://charts.jenkins.io $ helm repo update search$ helm repo update $ helm search repo jenkins default credential $ kubectl get secrets \\ --namespace \\ -o jsonpath=\"{.data.jenkins-admin-password}\" | base64 --decode $ kubectl get secrets \\ --namespace \\ -o jsonpath=\"{.data.jenkins-admin-user}\" | base64 --decode usage [!NOTE|label:references:] * Helm3 快速入门 * Helm 文件 * Helm Chart 模板 * Secrets handling in Kubernetes - A Jenkins story Configuration with Kubernetes and Jenkins Part 1: Secrets 使用Helm Helm插件指南 在Helm和Tiller间使用SSL helm 命令 jenkins/value.yaml [stable/jenkins] Better support for Configuration as Code Plugin (JCasC) install Jenkins $ helm repo add jenkins https://charts.jenkins.io \"jenkins\" has been added to your repositories $ helm repo update Hang tight while we grab the latest from your chart repositories... ...Successfully got an update from the \"jenkins\" chart repository Update Complete. ⎈Happy Helming!⎈ $ helm repo list NAME URL jenkins https://charts.jenkins.io $ helm search repo jenkins NAME CHART VERSION APP VERSION DESCRIPTION jenkins/jenkins 4.3.24 2.401.1 Jenkins - Build great things at any scale! The ... $ helm show values jenkins/jenkins $ helm show chart jenkins/jenkins $ helm show readme jenkins/jenkins # or $ helm show all jenkins/jenkins $ helm --version=4.4.1 upgrade -i --reset-values -f=/path/to/value.yml staging-jenkins jenkins/jenkins search $ helm repo update $ helm search repo -l jenkins NAME CHART VERSION APP VERSION DESCRIPTION jenkins/jenkins 4.6.4 2.414.1 Jenkins - Build great things at any scale! The ... jenkins/jenkins 4.6.3 2.414.1 Jenkins - Build great things at any scale! The ... jenkins/jenkins 4.6.2 2.414.1 Jenkins - Build great things at any scale! The ... jenkins/jenkins 4.6.1 2.414.1 Jenkins - Build great things at any scale! The ... jenkins/jenkins 4.6.0 2.414.1 Jenkins - Build great things at any scale! The ... jenkins/jenkins 4.5.1 2.414.1 Jenkins - Build great things at any scale! The ... jenkins/jenkins 4.5.0 2.401.3 Jenkins - Build great things at any scale! The ... ... troubleshooting Error: UPGRADE FAILED: \"staging-jenkins\" has no deployed releases $ /usr/local/bin/helm --version=4.5.0 upgrade -i --reset-values -f=/tmp/tmpqxn6qkck.yml staging-jenkins jenkins/jenkins Error: UPGRADE FAILED: \"staging-jenkins\" has no deployed releases solution $ helm uninstall staging-jenkins release \"staging-jenkins\" uninstalled $ /usr/local/bin/helm --version=4.5.0 upgrade -i --reset-values -f=/tmp/tmpqxn6qkck.yml staging-jenkins jenkins/jenkins Release \"staging-jenkins\" does not exist. Installing it now. NAME: staging-jenkins LAST DEPLOYED: Tue Sep 19 23:05:30 2023 NAMESPACE: devops STATUS: deployed REVISION: 1 NOTES: 1. Get your 'admin' user password by running: kubectl exec --namespace devops -it svc/staging-jenkins -c jenkins -- /bin/cat /run/secrets/additional/chart-admin-password && echo 2. Get the Jenkins URL to visit by running these commands in the same shell: echo http://127.0.0.1:8080 kubectl --namespace devops port-forward svc/staging-jenkins 8080:8080 3. Login with the password from step 1 and the username: admin 4. Configure security realm and authorization strategy 5. Use Jenkins Configuration as Code by specifying configScripts in your values.yaml file, see documentation: http://127.0.0.1:8080/configuration-as-code and examples: https://github.com/jenkinsci/configuration-as-code-plugin/tree/master/demos For more information on running Jenkins on Kubernetes, visit: https://cloud.google.com/solutions/jenkins-on-container-engine For more information about Jenkins Configuration as Code, visit: https://jenkins.io/projects/jcasc/ NOTE: Consider using a custom image with pre-installed plugins tls: failed to verify certificate: x509 [!NOTE|label:references:] helm: x509: certificate signed by unknown authority $ helm repo add grafana https://grafana.github.io/helm-charts Error: looks like \"https://grafana.github.io/helm-charts\" is not a valid chart repository or cannot be reached: Get \"https://grafana.github.io/helm-charts/index.yaml\": tls: failed to verify certificate: x509: certificate signed by unknown authority solution:$ helm repo add grafana --insecure-skip-tls-verify https://grafana.github.io/helm-charts \"grafana\" has been added to your repositories check $ kubectl get po staging-jenkins-0 -o 'jsonpath={.spec.containers[*].name}' jenkins config-reload $ kubectl get po staging-jenkins-0 -o 'jsonpath={.spec.containers[?(@.name==\"jenkins\")].image}' jenkins/jenkins:2.401.2-lts-jdk11 $ kubectl get po staging-jenkins-0 -o 'jsonpath={.spec.containers[*].image}' jenkins/jenkins:2.401.2-lts-jdk11 kiwigrid/k8s-sidecar:1.24.4 # format: # --as=system:serviceaccount:: $ kubectl --as=system:serviceaccount:devops:staging-jenkins auth can-i get configmap/staging-jenkins-jcasc yes STDOUT: Release \"staging-jenkins\" has been upgraded. Happy Helming! NAME: staging-jenkins LAST DEPLOYED: Tue Jul 18 19:21:46 2023 NAMESPACE: devops STATUS: deployed REVISION: 21 NOTES: 1. Get your 'admin' user password by running: kubectl exec --namespace devops -it svc/staging-jenkins -c jenkins -- /bin/cat /run/secrets/additional/chart-admin-password && echo 2. Get the Jenkins URL to visit by running these commands in the same shell: echo http://127.0.0.1:8080 kubectl --namespace devops port-forward svc/staging-jenkins 8080:8080 3. Login with the password from step 1 and the username: admin 4. Configure security realm and authorization strategy 5. Use Jenkins Configuration as Code by specifying configScripts in your values.yaml file, see documentation: http://127.0.0.1:8080/configuration-as-code and examples: https://github.com/jenkinsci/configuration-as-code-plugin/tree/master/demos For more information on running Jenkins on Kubernetes, visit: https://cloud.google.com/solutions/jenkins-on-container-engine For more information about Jenkins Configuration as Code, visit: https://jenkins.io/projects/jcasc/ NOTE: Consider using a custom image with pre-installed plugins $ helm show values jenkins/jenkins # Default values for jenkins. # This is a YAML-formatted file. # Declare name/value pairs to be passed into your templates. # name: value ## Overrides for generated resource names # See templates/_helpers.tpl # nameOverride: # fullnameOverride: # namespaceOverride: # For FQDN resolving of the controller service. Change this value to match your existing configuration. # ref: https://github.com/kubernetes/dns/blob/master/docs/specification.md clusterZone: \"cluster.local\" renderHelmLabels: true controller: # Used for label app.kubernetes.io/component componentName: \"jenkins-controller\" image: \"jenkins/jenkins\" # tag: \"2.401.1-jdk11\" tagLabel: jdk11 imagePullPolicy: \"Always\" imagePullSecretName: # Optionally configure lifetime for controller-container lifecycle: # postStart: # exec: # command: # - \"uname\" # - \"-a\" disableRememberMe: false numExecutors: 0 # configures the executor mode of the Jenkins node. Possible values are: NORMAL or EXCLUSIVE executorMode: \"NORMAL\" # This is ignored if enableRawHtmlMarkupFormatter is true markupFormatter: plainText customJenkinsLabels: [] # The default configuration uses this secret to configure an admin user # If you don't need that user or use a different security realm then you can disable it adminSecret: true hostNetworking: false # When enabling LDAP or another non-Jenkins identity source, the built-in admin account will no longer exist. # If you disable the non-Jenkins identity store and instead use the Jenkins internal one, # you should revert controller.adminUser to your preferred admin user: adminUser: \"admin\" # adminPassword: admin: existingSecret: \"\" userKey: jenkins-admin-user passwordKey: jenkins-admin-password # This values should not be changed unless you use your custom image of jenkins or any devired from. If you want to use # Cloudbees Jenkins Distribution docker, you should set jenkinsHome: \"/var/cloudbees-jenkins-distribution\" jenkinsHome: \"/var/jenkins_home\" # This values should not be changed unless you use your custom image of jenkins or any devired from. If you want to use # Cloudbees Jenkins Distribution docker, you should set jenkinsRef: \"/usr/share/cloudbees-jenkins-distribution/ref\" jenkinsRef: \"/usr/share/jenkins/ref\" # Path to the jenkins war file which is used by jenkins-plugin-cli. jenkinsWar: \"/usr/share/jenkins/jenkins.war\" # Overrides the default arguments passed to the war # overrideArgs: # - --httpPort=8080 resources: requests: cpu: \"50m\" memory: \"256Mi\" limits: cpu: \"2000m\" memory: \"4096Mi\" # Share process namespace to allow sidecar containers to interact with processes in other containers in the same pod shareProcessNamespace: false # Overrides the init container default values # initContainerResources: # requests: # cpu: \"50m\" # memory: \"256Mi\" # limits: # cpu: \"2000m\" # memory: \"4096Mi\" # Environment variables that get added to the init container (useful for e.g. http_proxy) # initContainerEnv: # - name: http_proxy # value: \"http://192.168.64.1:3128\" # containerEnv: # - name: http_proxy # value: \"http://192.168.64.1:3128\" # Set min/max heap here if needed with: # javaOpts: \"-Xms512m -Xmx512m\" # jenkinsOpts: \"\" # If you are using the ingress definitions provided by this chart via the `controller.ingress` block the configured hostname will be the ingress hostname starting with `https://` or `http://` depending on the `tls` configuration. # The Protocol can be overwritten by specifying `controller.jenkinsUrlProtocol`. # jenkinsUrlProtocol: \"https\" # If you are not using the provided ingress you can specify `controller.jenkinsUrl` to change the url definition. # jenkinsUrl: \"\" # If you set this prefix and use ingress controller then you might want to set the ingress path below # jenkinsUriPrefix: \"/jenkins\" # Enable pod security context (must be `true` if podSecurityContextOverride, runAsUser or fsGroup are set) usePodSecurityContext: true # Note that `runAsUser`, `fsGroup`, and `securityContextCapabilities` are # being deprecated and replaced by `podSecurityContextOverride`. # Set runAsUser to 1000 to let Jenkins run as non-root user 'jenkins' which exists in 'jenkins/jenkins' docker image. # When setting runAsUser to a different value than 0 also set fsGroup to the same value: runAsUser: 1000 fsGroup: 1000 # If you have PodSecurityPolicies that require dropping of capabilities as suggested by CIS K8s benchmark, put them here securityContextCapabilities: {} # drop: # - NET_RAW # Completely overwrites the contents of the `securityContext`, ignoring the # values provided for the deprecated fields: `runAsUser`, `fsGroup`, and # `securityContextCapabilities`. In the case of mounting an ext4 filesystem, # it might be desirable to use `supplementalGroups` instead of `fsGroup` in # the `securityContext` block: https://github.com/kubernetes/kubernetes/issues/67014#issuecomment-589915496 # podSecurityContextOverride: # runAsUser: 1000 # runAsNonRoot: true # supplementalGroups: [1000] # # capabilities: {} # Container securityContext containerSecurityContext: runAsUser: 1000 runAsGroup: 1000 readOnlyRootFilesystem: true allowPrivilegeEscalation: false servicePort: 8080 targetPort: 8080 # For minikube, set this to NodePort, elsewhere use LoadBalancer # Use ClusterIP if your setup includes ingress controller serviceType: ClusterIP # Use Local to preserve the client source IP and avoids a second hop for LoadBalancer and Nodeport type services, # but risks potentially imbalanced traffic spreading. serviceExternalTrafficPolicy: # Jenkins controller service annotations serviceAnnotations: {} # Jenkins controller custom labels statefulSetLabels: {} # foo: bar # bar: foo # Jenkins controller service labels serviceLabels: {} # service.beta.kubernetes.io/aws-load-balancer-backend-protocol: https # Put labels on Jenkins controller pod podLabels: {} # Used to create Ingress record (should be used with ServiceType: ClusterIP) # nodePort: # -Dcom.sun.management.jmxremote.port=4000 # -Dcom.sun.management.jmxremote.authenticate=false # -Dcom.sun.management.jmxremote.ssl=false # jmxPort: 4000 # Optionally configure other ports to expose in the controller container extraPorts: [] # - name: BuildInfoProxy # port: 9000 # targetPort: 9010 (Optional: Use to explicitly set targetPort if different from port) # List of plugins to be install during Jenkins controller start installPlugins: - kubernetes:3900.va_dce992317b_4 - workflow-aggregator:596.v8c21c963d92d - git:5.0.0 - configuration-as-code:1625.v27444588cc3d # Set to false to download the minimum required version of all dependencies. installLatestPlugins: true # Set to true to download latest dependencies of any plugin that is requested to have the latest version. installLatestSpecifiedPlugins: false # List of plugins to install in addition to those listed in controller.installPlugins additionalPlugins: [] # Enable to initialize the Jenkins controller only once on initial installation. # Without this, whenever the controller gets restarted (Evicted, etc.) it will fetch plugin updates which has the potential to cause breakage. # Note that for this to work, `persistence.enabled` needs to be set to `true` initializeOnce: false # Enable to always override the installed plugins with the values of 'controller.installPlugins' on upgrade or redeployment. # overwritePlugins: true # Configures if plugins bundled with `controller.image` should be overwritten with the values of 'controller.installPlugins' on upgrade or redeployment. overwritePluginsFromImage: true # Configures the restrictions for naming projects. Set this key to null or empty to skip it in the default config. projectNamingStrategy: standard # Enable HTML parsing using OWASP Markup Formatter Plugin (antisamy-markup-formatter), useful with ghprb plugin. # The plugin is not installed by default, please update controller.installPlugins. enableRawHtmlMarkupFormatter: false # Used to approve a list of groovy functions in pipelines used the script-security plugin. Can be viewed under /scriptApproval scriptApproval: [] # - \"method groovy.json.JsonSlurperClassic parseText java.lang.String\" # - \"new groovy.json.JsonSlurperClassic\" # List of groovy init scripts to be executed during Jenkins controller start initScripts: [] # - | # print 'adding global pipeline libraries, register properties, bootstrap jobs...' # 'name' is a name of an existing secret in same namespace as jenkins, # 'keyName' is the name of one of the keys inside current secret. # the 'name' and 'keyName' are concatenated with a '-' in between, so for example: # an existing secret \"secret-credentials\" and a key inside it named \"github-password\" should be used in Jcasc as ${secret-credentials-github-password} # 'name' and 'keyName' must be lowercase RFC 1123 label must consist of lower case alphanumeric characters or '-', # and must start and end with an alphanumeric character (e.g. 'my-name', or '123-abc') # existingSecret existing secret \"secret-credentials\" and a key inside it named \"github-username\" should be used in Jcasc as ${github-username} # When using existingSecret no need to specify the keyName under additionalExistingSecrets. existingSecret: additionalExistingSecrets: [] # - name: secret-name-1 # keyName: username # - name: secret-name-1 # keyName: password additionalSecrets: [] # - name: nameOfSecret # value: secretText # Generate SecretClaim resources in order to create Kubernetes secrets from HashiCorp Vault using kube-vault-controller. # 'name' is name of the secret that will be created in Kubernetes. The Jenkins fullname is prepended to this value. # 'path' is the fully qualified path to the secret in Vault # 'type' is an optional Kubernetes secret type. Defaults to 'Opaque' # 'renew' is an optional secret renewal time in seconds secretClaims: [] # - name: secretName # required # path: testPath # required # type: kubernetes.io/tls # optional # renew: 60 # optional # Name of default cloud configuration. cloudName: \"kubernetes\" # Below is the implementation of Jenkins Configuration as Code. Add a key under configScripts for each configuration area, # where each corresponds to a plugin or section of the UI. Each key (prior to | character) is just a label, and can be any value. # Keys are only used to give the section a meaningful name. The only restriction is they may only contain RFC 1123 \\ DNS label # characters: lowercase letters, numbers, and hyphens. The keys become the name of a configuration yaml file on the controller in # /var/jenkins_home/casc_configs (by default) and will be processed by the Configuration as Code Plugin. The lines after each | # become the content of the configuration yaml file. The first line after this is a JCasC root element, eg jenkins, credentials, # etc. Best reference is https:///configuration-as-code/reference. The example below creates a welcome message: JCasC: defaultConfig: true configUrls: [] # - https://acme.org/jenkins.yaml # Remote URL:s for configuration files. configScripts: {} # welcome-message: | # jenkins: # systemMessage: Welcome to our CI\\CD server. This Jenkins is configured and managed 'as code'. # Allows adding to the top-level security JCasC section. For legacy, default the chart includes apiToken configurations security: apiToken: creationOfLegacyTokenEnabled: false tokenGenerationOnCreationEnabled: false usageStatisticsEnabled: true # Ignored if securityRealm is defined in controller.JCasC.configScripts securityRealm: |- local: allowsSignup: false enableCaptcha: false users: - id: \"${chart-admin-username}\" name: \"Jenkins Admin\" password: \"${chart-admin-password}\" # Ignored if authorizationStrategy is defined in controller.JCasC.configScripts authorizationStrategy: |- loggedInUsersCanDoAnything: allowAnonymousRead: false # Optionally specify additional init-containers customInitContainers: [] # - name: custom-init # image: \"alpine:3.7\" # imagePullPolicy: Always # command: [ \"uname\", \"-a\" ] sidecars: configAutoReload: # If enabled: true, Jenkins Configuration as Code will be reloaded on-the-fly without a reboot. If false or not-specified, # jcasc changes will cause a reboot and will only be applied at the subsequent start-up. Auto-reload uses the # http:///reload-configuration-as-code endpoint to reapply config when changes to the configScripts are detected. enabled: true image: kiwigrid/k8s-sidecar:1.23.1 imagePullPolicy: IfNotPresent resources: {} # limits: # cpu: 100m # memory: 100Mi # requests: # cpu: 50m # memory: 50Mi # How many connection-related errors to retry on reqRetryConnect: 10 # env: # - name: REQ_TIMEOUT # value: \"30\" # SSH port value can be set to any unused TCP port. The default, 1044, is a non-standard SSH port that has been chosen at random. # Is only used to reload jcasc config from the sidecar container running in the Jenkins controller pod. # This TCP port will not be open in the pod (unless you specifically configure this), so Jenkins will not be # accessible via SSH from outside of the pod. Note if you use non-root pod privileges (runAsUser & fsGroup), # this must be > 1024: sshTcpPort: 1044 # folder in the pod that should hold the collected dashboards: folder: \"/var/jenkins_home/casc_configs\" # If specified, the sidecar will search for JCasC config-maps inside this namespace. # Otherwise the namespace in which the sidecar is running will be used. # It's also possible to specify ALL to search in all namespaces: # searchNamespace: containerSecurityContext: readOnlyRootFilesystem: true allowPrivilegeEscalation: false # Allows you to inject additional/other sidecars other: [] ## The example below runs the client for https://smee.io as sidecar container next to Jenkins, ## that allows to trigger build behind a secure firewall. ## https://jenkins.io/blog/2019/01/07/webhook-firewalls/#triggering-builds-with-webhooks-behind-a-secure-firewall ## ## Note: To use it you should go to https://smee.io/new and update the url to the generete one. # - name: smee # image: docker.io/twalter/smee-client:1.0.2 # args: [\"--port\", \"{{ .Values.controller.servicePort }}\", \"--path\", \"/github-webhook/\", \"--url\", \"https://smee.io/new\"] # resources: # limits: # cpu: 50m # memory: 128Mi # requests: # cpu: 10m # memory: 32Mi # Name of the Kubernetes scheduler to use schedulerName: \"\" # Node labels and tolerations for pod assignment # ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector # ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#taints-and-tolerations-beta-feature nodeSelector: {} terminationGracePeriodSeconds: terminationMessagePath: terminationMessagePolicy: tolerations: [] affinity: {} # Leverage a priorityClass to ensure your pods survive resource shortages # ref: https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/ priorityClassName: podAnnotations: {} # Add StatefulSet annotations statefulSetAnnotations: {} # StatefulSet updateStrategy # ref: https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#update-strategies updateStrategy: {} ingress: enabled: false # Override for the default paths that map requests to the backend paths: [] # - backend: # serviceName: ssl-redirect # servicePort: use-annotation # - backend: # serviceName: >- # {{ template \"jenkins.fullname\" . }} # # Don't use string here, use only integer value! # servicePort: 8080 # For Kubernetes v1.14+, use 'networking.k8s.io/v1beta1' # For Kubernetes v1.19+, use 'networking.k8s.io/v1' apiVersion: \"extensions/v1beta1\" labels: {} annotations: {} # kubernetes.io/ingress.class: nginx # kubernetes.io/tls-acme: \"true\" # For Kubernetes >= 1.18 you should specify the ingress-controller via the field ingressClassName # See https://kubernetes.io/blog/2020/04/02/improvements-to-the-ingress-api-in-kubernetes-1.18/#specifying-the-class-of-an-ingress # ingressClassName: nginx # Set this path to jenkinsUriPrefix above or use annotations to rewrite path # path: \"/jenkins\" # configures the hostname e.g. jenkins.example.com hostName: tls: # - secretName: jenkins.cluster.local # hosts: # - jenkins.cluster.local # often you want to have your controller all locked down and private # but you still want to get webhooks from your SCM # A secondary ingress will let you expose different urls # with a differnt configuration secondaryingress: enabled: false # paths you want forwarded to the backend # ex /github-webhook paths: [] # For Kubernetes v1.14+, use 'networking.k8s.io/v1beta1' # For Kubernetes v1.19+, use 'networking.k8s.io/v1' apiVersion: \"extensions/v1beta1\" labels: {} annotations: {} # kubernetes.io/ingress.class: nginx # kubernetes.io/tls-acme: \"true\" # For Kubernetes >= 1.18 you should specify the ingress-controller via the field ingressClassName # See https://kubernetes.io/blog/2020/04/02/improvements-to-the-ingress-api-in-kubernetes-1.18/#specifying-the-class-of-an-ingress # ingressClassName: nginx # configures the hostname e.g. jenkins-external.example.com hostName: tls: # - secretName: jenkins-external.example.com # hosts: # - jenkins-external.example.com # If you're running on GKE and need to configure a backendconfig # to finish ingress setup, use the following values. # Docs: https://cloud.google.com/kubernetes-engine/docs/concepts/backendconfig backendconfig: enabled: false apiVersion: \"extensions/v1beta1\" name: labels: {} annotations: {} spec: {} # Openshift route route: enabled: false labels: {} annotations: {} # path: \"/jenkins\" # controller.hostAliases allows for adding entries to Pod /etc/hosts: # https://kubernetes.io/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/ hostAliases: [] # - ip: 192.168.50.50 # hostnames: # - something.local # - ip: 10.0.50.50 # hostnames: # - other.local # Expose Prometheus metrics prometheus: # If enabled, add the prometheus plugin to the list of plugins to install # https://plugins.jenkins.io/prometheus enabled: false # Additional labels to add to the ServiceMonitor object serviceMonitorAdditionalLabels: {} # Set a custom namespace where to deploy ServiceMonitor resource # serviceMonitorNamespace: monitoring scrapeInterval: 60s # This is the default endpoint used by the prometheus plugin scrapeEndpoint: /prometheus # Additional labels to add to the PrometheusRule object alertingRulesAdditionalLabels: {} # An array of prometheus alerting rules # See here: https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/ # The `groups` root object is added by default, simply add the rule entries alertingrules: [] # Set a custom namespace where to deploy PrometheusRule resource prometheusRuleNamespace: \"\" # RelabelConfigs to apply to samples before scraping. Prometheus Operator automatically adds # relabelings for a few standard Kubernetes fields. The original scrape job’s name # is available via the __tmp_prometheus_job_name label. # More info: https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config relabelings: [] # MetricRelabelConfigs to apply to samples before ingestion. metricRelabelings: [] googlePodMonitor: # If enabled, It creates Google Managed Prometheus scraping config enabled: false # Set a custom namespace where to deploy PodMonitoring resource # serviceMonitorNamespace: \"\" scrapeInterval: 60s # This is the default endpoint used by the prometheus plugin scrapeEndpoint: /prometheus # Can be used to disable rendering controller test resources when using helm template testEnabled: true httpsKeyStore: jenkinsHttpsJksSecretName: '' enable: false disableSecretMount: false httpPort: 8081 path: \"/var/jenkins_keystore\" fileName: \"keystore.jks\" password: \"password\" # Convert keystore.jks files content to base64 ( cat keystore.jks | base64 ) and put the output here jenkinsKeyStoreBase64Encoded: | /u3+7QAAAAIAAAABAAAAAQANamVua2luc2NpLmNvbQAAAW2r/b1ZAAAFATCCBP0wDgYKKwYBBAEq AhEBAQUABIIE6QbCqasvoHS0pSwYqSvdydMCB9t+VNfwhFIiiuAelJfO5sSe2SebJbtwHgLcRz1Z gMtWgOSFdl3bWSzA7vrW2LED52h+jXLYSWvZzuDuh8hYO85m10ikF6QR+dTi4jra0whIFDvq3pxe TnESxEsN+DvbZM3jA3qsjQJSeISNpDjO099dqQvHpnCn18lyk7J4TWJ8sOQQb1EM2zDAfAOSqA/x QuPEFl74DlY+5DIk6EBvpmWhaMSvXzWZACGA0sYqa157dq7O0AqmuLG/EI5EkHETO4CrtBW+yLcy 2dUCXOMA+j+NjM1BjrQkYE5vtSfNO6lFZcISyKo5pTFlcA7ut0Fx2nZ8GhHTn32CpeWwNcZBn1gR pZVt6DxVVkhTAkMLhR4rL2wGIi/1WRs23ZOLGKtyDNvDHnQyDiQEoJGy9nAthA8aNHa3cfdF10vB Drb19vtpFHmpvKEEhpk2EBRF4fTi644Fuhu2Ied6118AlaPvEea+n6G4vBz+8RWuVCmZjLU+7h8l Hy3/WdUPoIL5eW7Kz+hS+sRTFzfu9C48dMkQH3a6f3wSY+mufizNF9U298r98TnYy+PfDJK0bstG Ph6yPWx8DGXKQBwrhWJWXI6JwZDeC5Ny+l8p1SypTmAjpIaSW3ge+KgcL6Wtt1R5hUV1ajVwVSUi HF/FachKqPqyLJFZTGjNrxnmNYpt8P1d5JTvJfmfr55Su/P9n7kcyWp7zMcb2Q5nlXt4tWogOHLI OzEWKCacbFfVHE+PpdrcvCVZMDzFogIq5EqGTOZe2poPpBVE+1y9mf5+TXBegy5HToLWvmfmJNTO NCDuBjgLs2tdw2yMPm4YEr57PnMX5gGTC3f2ZihXCIJDCRCdQ9sVBOjIQbOCzxFXkVITo0BAZhCi Yz61wt3Ud8e//zhXWCkCsSV+IZCxxPzhEFd+RFVjW0Nm9hsb2FgAhkXCjsGROgoleYgaZJWvQaAg UyBzMmKDPKTllBHyE3Gy1ehBNGPgEBChf17/9M+j8pcm1OmlM434ctWQ4qW7RU56//yq1soFY0Te fu2ei03a6m68fYuW6s7XEEK58QisJWRAvEbpwu/eyqfs7PsQ+zSgJHyk2rO95IxdMtEESb2GRuoi Bs+AHNdYFTAi+GBWw9dvEgqQ0Mpv0//6bBE/Fb4d7b7f56uUNnnE7mFnjGmGQN+MvC62pfwfvJTT EkT1iZ9kjM9FprTFWXT4UmO3XTvesGeE50sV9YPm71X4DCQwc4KE8vyuwj0s6oMNAUACW2ClU9QQ y0tRpaF1tzs4N42Q5zl0TzWxbCCjAtC3u6xf+c8MCGrr7DzNhm42LOQiHTa4MwX4x96q7235oiAU iQqSI/hyF5yLpWw4etyUvsx2/0/0wkuTU1FozbLoCWJEWcPS7QadMrRRISxHf0YobIeQyz34regl t1qSQ3dCU9D6AHLgX6kqllx4X0fnFq7LtfN7fA2itW26v+kAT2QFZ3qZhINGfofCja/pITC1uNAZ gsJaTMcQ600krj/ynoxnjT+n1gmeqThac6/Mi3YlVeRtaxI2InL82ZuD+w/dfY9OpPssQjy3xiQa jPuaMWXRxz/sS9syOoGVH7XBwKrWpQcpchozWJt40QV5DslJkclcr8aC2AGlzuJMTdEgz1eqV0+H bAXG9HRHN/0eJTn1/QAAAAEABVguNTA5AAADjzCCA4swggJzAhRGqVxH4HTLYPGO4rzHcCPeGDKn xTANBgkqhkiG9w0BAQsFADCBgTELMAkGA1UEBhMCY2ExEDAOBgNVBAgMB29udGFyaW8xEDAOBgNV BAcMB3Rvcm9udG8xFDASBgNVBAoMC2plbmtpbnN0ZXN0MRkwFwYDVQQDDBBqZW5raW5zdGVzdC5p bmZvMR0wGwYJKoZIhvcNAQkBFg50ZXN0QHRlc3QuaW5mbzAeFw0xOTEwMDgxNTI5NTVaFw0xOTEx MDcxNTI5NTVaMIGBMQswCQYDVQQGEwJjYTEQMA4GA1UECAwHb250YXJpbzEQMA4GA1UEBwwHdG9y b250bzEUMBIGA1UECgwLamVua2luc3Rlc3QxGTAXBgNVBAMMEGplbmtpbnN0ZXN0LmluZm8xHTAb BgkqhkiG9w0BCQEWDnRlc3RAdGVzdC5pbmZvMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC AQEA02q352JTHGvROMBhSHvSv+vnoOTDKSTz2aLQn0tYrIRqRo+8bfmMjXuhkwZPSnCpvUGNAJ+w Jrt/dqMoYUjCBkjylD/qHmnXN5EwS1cMg1Djh65gi5JJLFJ7eNcoSsr/0AJ+TweIal1jJSP3t3PF 9Uv21gm6xdm7HnNK66WpUUXLDTKaIs/jtagVY1bLOo9oEVeLN4nT2CYWztpMvdCyEDUzgEdDbmrP F5nKUPK5hrFqo1Dc5rUI4ZshL3Lpv398aMxv6n2adQvuL++URMEbXXBhxOrT6rCtYzbcR5fkwS9i d3Br45CoWOQro02JAepoU0MQKY5+xQ4Bq9Q7tB9BAwIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQAe 4xc+mSvKkrKBHg9/zpkWgZUiOp4ENJCi8H4tea/PCM439v6y/kfjT/okOokFvX8N5aa1OSz2Vsrl m8kjIc6hiA7bKzT6lb0EyjUShFFZ5jmGVP4S7/hviDvgB5yEQxOPpumkdRP513YnEGj/o9Pazi5h /MwpRxxazoda9r45kqQpyG+XoM4pB+Fd3JzMc4FUGxfVPxJU4jLawnJJiZ3vqiSyaB0YyUL+Er1Q 6NnqtR4gEBF0ZVlQmkycFvD4EC2boP943dLqNUvop+4R3SM1QMM6P5u8iTXtHd/VN4MwMyy1wtog hYAzODo1Jt59pcqqKJEas0C/lFJEB3frw4ImNx5fNlJYOpx+ijfQs9m39CevDq0= agent: enabled: true defaultsProviderTemplate: \"\" # URL for connecting to the Jenkins controller jenkinsUrl: # connect to the specified host and port, instead of connecting directly to the Jenkins controller jenkinsTunnel: kubernetesConnectTimeout: 5 kubernetesReadTimeout: 15 maxRequestsPerHostStr: \"32\" namespace: image: \"jenkins/inbound-agent\" tag: \"3107.v665000b_51092-5\" workingDir: \"/home/jenkins/agent\" nodeUsageMode: \"NORMAL\" customJenkinsLabels: [] # name of the secret to be used for image pulling imagePullSecretName: componentName: \"jenkins-agent\" websocket: false directConnection: false privileged: false runAsUser: runAsGroup: hostNetworking: false resources: requests: cpu: \"512m\" memory: \"512Mi\" limits: cpu: \"512m\" memory: \"512Mi\" # You may want to change this to true while testing a new image alwaysPullImage: false # Controls how agent pods are retained after the Jenkins build completes # Possible values: Always, Never, OnFailure podRetention: \"Never\" # Disable if you do not want the Yaml the agent pod template to show up # in the job Console Output. This can be helpful for either security reasons # or simply to clean up the output to make it easier to read. showRawYaml: true # You can define the volumes that you want to mount for this container # Allowed types are: ConfigMap, EmptyDir, HostPath, Nfs, PVC, Secret # Configure the attributes as they appear in the corresponding Java class for that type # https://github.com/jenkinsci/kubernetes-plugin/tree/master/src/main/java/org/csanchez/jenkins/plugins/kubernetes/volumes volumes: [] # - type: ConfigMap # configMapName: myconfigmap # mountPath: /var/myapp/myconfigmap # - type: EmptyDir # mountPath: /var/myapp/myemptydir # memory: false # - type: HostPath # hostPath: /var/lib/containers # mountPath: /var/myapp/myhostpath # - type: Nfs # mountPath: /var/myapp/mynfs # readOnly: false # serverAddress: \"192.0.2.0\" # serverPath: /var/lib/containers # - type: PVC # claimName: mypvc # mountPath: /var/myapp/mypvc # readOnly: false # - type: Secret # defaultMode: \"600\" # mountPath: /var/myapp/mysecret # secretName: mysecret # Pod-wide environment, these vars are visible to any container in the agent pod # You can define the workspaceVolume that you want to mount for this container # Allowed types are: DynamicPVC, EmptyDir, HostPath, Nfs, PVC # Configure the attributes as they appear in the corresponding Java class for that type # https://github.com/jenkinsci/kubernetes-plugin/tree/master/src/main/java/org/csanchez/jenkins/plugins/kubernetes/volumes/workspace workspaceVolume: {} ## DynamicPVC example # type: DynamicPVC # configMapName: myconfigmap ## EmptyDir example # type: EmptyDir # memory: false ## HostPath example # type: HostPath # hostPath: /var/lib/containers ## NFS example # type: Nfs # readOnly: false # serverAddress: \"192.0.2.0\" # serverPath: /var/lib/containers ## PVC example # type: PVC # claimName: mypvc # readOnly: false # # Pod-wide environment, these vars are visible to any container in the agent pod envVars: [] # - name: PATH # value: /usr/local/bin # Mount a secret as environment variable secretEnvVars: [] # - key: PATH # optional: false # default: false # secretKey: MY-K8S-PATH # secretName: my-k8s-secret nodeSelector: {} # Key Value selectors. Ex: # jenkins-agent: v1 # Executed command when side container gets started command: args: \"${computer.jnlpmac} ${computer.name}\" # Side container name sideContainerName: \"jnlp\" # Doesn't allocate pseudo TTY by default TTYEnabled: false # Max number of spawned agent containerCap: 10 # Pod name podName: \"default\" # Allows the Pod to remain active for reuse until the configured number of # minutes has passed since the last step was executed on it. idleMinutes: 0 # Raw yaml template for the Pod. For example this allows usage of toleration for agent pods. # https://github.com/jenkinsci/kubernetes-plugin#using-yaml-to-define-pod-templates # https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/ yamlTemplate: \"\" # yamlTemplate: |- # apiVersion: v1 # kind: Pod # spec: # tolerations: # - key: \"key\" # operator: \"Equal\" # value: \"value\" # Defines how the raw yaml field gets merged with yaml definitions from inherited pod templates: merge or override yamlMergeStrategy: \"override\" # Timeout in seconds for an agent to be online connectTimeout: 100 # Annotations to apply to the pod. annotations: {} # Add additional containers to the agents. # Containers specified here are added to all agents. Set key empty to remove container from additional agents. additionalContainers: [] # - sideContainerName: dind # image: docker # tag: dind # command: dockerd-entrypoint.sh # args: \"\" # privileged: true # resources: # requests: # cpu: 500m # memory: 1Gi # limits: # cpu: 1 # memory: 2Gi # Disable the default Jenkins Agent configuration. # Useful when configuring agents only with the podTemplates value, since the default podTemplate populated by values mentioned above will be excluded in the rendered template. disableDefaultAgent: false # Below is the implementation of custom pod templates for the default configured kubernetes cloud. # Add a key under podTemplates for each pod template. Each key (prior to | character) is just a label, and can be any value. # Keys are only used to give the pod template a meaningful name. The only restriction is they may only contain RFC 1123 \\ DNS label # characters: lowercase letters, numbers, and hyphens. Each pod template can contain multiple containers. # For this pod templates configuration to be loaded the following values must be set: # controller.JCasC.defaultConfig: true # Best reference is https:///configuration-as-code/reference#Cloud-kubernetes. The example below creates a python pod template. podTemplates: {} # python: | # - name: python # label: jenkins-python # serviceAccount: jenkins # containers: # - name: python # image: python:3 # command: \"/bin/sh -c\" # args: \"cat\" # ttyEnabled: true # privileged: true # resourceRequestCpu: \"400m\" # resourceRequestMemory: \"512Mi\" # resourceLimitCpu: \"1\" # resourceLimitMemory: \"1024Mi\" # Here you can add additional agents # They inherit all values from `agent` so you only need to specify values which differ additionalAgents: {} # maven: # podName: maven # customJenkinsLabels: maven # # An example of overriding the jnlp container # # sideContainerName: jnlp # image: jenkins/jnlp-agent-maven # tag: latest # python: # podName: python # customJenkinsLabels: python # sideContainerName: python # image: python # tag: \"3\" # command: \"/bin/sh -c\" # args: \"cat\" # TTYEnabled: true persistence: enabled: true ## A manually managed Persistent Volume and Claim ## Requires persistence.enabled: true ## If defined, PVC must be created manually before volume will be bound existingClaim: ## jenkins data Persistent Volume Storage Class ## If defined, storageClassName: ## If set to \"-\", storageClassName: \"\", which disables dynamic provisioning ## If undefined (the default) or set to null, no storageClassName spec is ## set, choosing the default provisioner. (gp2 on AWS, standard on ## GKE, AWS & OpenStack) ## storageClass: annotations: {} labels: {} accessMode: \"ReadWriteOnce\" size: \"8Gi\" volumes: # - name: nothing # emptyDir: {} mounts: # - mountPath: /var/nothing # name: nothing # readOnly: true networkPolicy: # Enable creation of NetworkPolicy resources. enabled: false # For Kubernetes v1.4, v1.5 and v1.6, use 'extensions/v1beta1' # For Kubernetes v1.7, use 'networking.k8s.io/v1' apiVersion: networking.k8s.io/v1 # You can allow agents to connect from both within the cluster (from within specific/all namespaces) AND/OR from a given external IP range internalAgents: allowed: true podLabels: {} namespaceLabels: {} # project: myproject externalAgents: {} # ipCIDR: 172.17.0.0/16 # except: # - 172.17.1.0/24 ## Install Default RBAC roles and bindings rbac: create: true readSecrets: false serviceAccount: create: true # The name of the service account is autogenerated by default name: annotations: {} extraLabels: {} imagePullSecretName: serviceAccountAgent: # Specifies whether a ServiceAccount should be created create: false # The name of the ServiceAccount to use. # If not set and create is true, a name is generated using the fullname template name: annotations: {} extraLabels: {} imagePullSecretName: ## Backup cronjob configuration ## Ref: https://github.com/maorfr/kube-tasks backup: # Backup must use RBAC # So by enabling backup you are enabling RBAC specific for backup enabled: false # Used for label app.kubernetes.io/component componentName: \"backup\" # Schedule to run jobs. Must be in cron time format # Ref: https://crontab.guru/ schedule: \"0 2 * * *\" labels: {} serviceAccount: create: true name: annotations: {} # Example for authorization to AWS S3 using kube2iam or IRSA # Can also be done using environment variables # iam.amazonaws.com/role: \"jenkins\" # \"eks.amazonaws.com/role-arn\": \"arn:aws:iam::123456789012:role/jenkins-backup\" # Set this to terminate the job that is running/failing continously and set the job status to \"Failed\" activeDeadlineSeconds: \"\" image: repository: \"maorfr/kube-tasks\" tag: \"0.2.0\" imagePullSecretName: # Additional arguments for kube-tasks # Ref: https://github.com/maorfr/kube-tasks#simple-backup extraArgs: [] # Add existingSecret for AWS credentials existingSecret: {} ## Example for using an existing secret # jenkinsaws: ## Use this key for AWS access key ID # awsaccesskey: jenkins_aws_access_key ## Use this key for AWS secret access key # awssecretkey: jenkins_aws_secret_key # Add additional environment variables # jenkinsgcp: ## Use this key for GCP credentials # gcpcredentials: credentials.json env: [] # Example environment variable required for AWS credentials chain # - name: \"AWS_REGION\" # value: \"us-east-1\" resources: requests: memory: 1Gi cpu: 1 limits: memory: 1Gi cpu: 1 # Destination to store the backup artifacts # Supported cloud storage services: AWS S3, Minio S3, Azure Blob Storage, Google Cloud Storage # Additional support can added. Visit this repository for details # Ref: https://github.com/maorfr/skbn destination: \"s3://jenkins-data/backup\" # By enabling only the jenkins_home/jobs folder gets backed up, not the whole jenkins instance onlyJobs: false # Enable backup pod security context (must be `true` if runAsUser or fsGroup are set) usePodSecurityContext: true # When setting runAsUser to a different value than 0 also set fsGroup to the same value: runAsUser: 1000 fsGroup: 1000 securityContextCapabilities: {} # drop: # - NET_RAW cronJob: apiVersion: batch/v1 checkDeprecation: true awsSecurityGroupPolicies: enabled: false policies: - name: \"\" securityGroupIds: [] podSelector: {} # Here you can configure unit tests values when executing the helm unittest in the CONTRIBUTING.md helmtest: # A testing framework for bash bats: # Bash Automated Testing System (BATS) image: \"bats/bats\" tag: \"1.9.0\" helm show chart $ helm show chart jenkins/jenkins annotations: artifacthub.io/category: integration-delivery artifacthub.io/images: | - name: jenkins image: jenkins/jenkins:2.401.2-jdk11 - name: k8s-sidecar image: kiwigrid/k8s-sidecar:1.24.4 - name: inbound-agent image: jenkins/inbound-agent:3107.v665000b_51092-15 - name: backup image: maorfr/kube-tasks:0.2.0 artifacthub.io/license: Apache-2.0 artifacthub.io/links: | - name: Chart Source url: https://github.com/jenkinsci/helm-charts/tree/main/charts/jenkins - name: Jenkins url: https://www.jenkins.io/ - name: support url: https://github.com/jenkinsci/helm-charts/issues apiVersion: v2 appVersion: 2.401.2 description: Jenkins - Build great things at any scale! The leading open source automation server, Jenkins provides hundreds of plugins to support building, deploying and automating any project. home: https://jenkins.io/ icon: https://get.jenkins.io/art/jenkins-logo/logo.svg keywords: - jenkins - ci - devops maintainers: - email: maor.friedman@redhat.com name: maorfr - email: mail@torstenwalter.de name: torstenwalter - email: garridomota@gmail.com name: mogaal - email: wmcdona89@gmail.com name: wmcdona89 - email: timjacomb1@gmail.com name: timja name: jenkins sources: - https://github.com/jenkinsci/jenkins - https://github.com/jenkinsci/docker-inbound-agent - https://github.com/maorfr/kube-tasks - https://github.com/jenkinsci/configuration-as-code-plugin version: 4.4.1 values $ helm show values jenkins/jenkins history # get RELEASE_NAME $ helm list NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION staging-jenkins devops 11 2023-09-27 23:39:38.982931215 -0700 PDT deployed jenkins-4.5.0 2.401.3 # get history $ helm history staging-jenkins REVISION UPDATED STATUS CHART APP VERSION DESCRIPTION 2 Wed Sep 27 19:20:35 2023 superseded jenkins-4.5.0 2.401.3 Upgrade complete 3 Wed Sep 27 20:18:10 2023 superseded jenkins-4.5.0 2.401.3 Upgrade complete 4 Wed Sep 27 21:16:24 2023 superseded jenkins-4.5.0 2.401.3 Upgrade complete 5 Wed Sep 27 21:18:01 2023 superseded jenkins-4.5.0 2.401.3 Upgrade complete 6 Wed Sep 27 21:22:02 2023 superseded jenkins-4.5.0 2.401.3 Upgrade complete 7 Wed Sep 27 21:31:07 2023 superseded jenkins-4.5.0 2.401.3 Upgrade complete 8 Wed Sep 27 21:32:55 2023 superseded jenkins-4.5.0 2.401.3 Upgrade complete 9 Wed Sep 27 21:35:42 2023 superseded jenkins-4.5.0 2.401.3 Upgrade complete 10 Wed Sep 27 23:02:57 2023 superseded jenkins-4.5.0 2.401.3 Upgrade complete 11 Wed Sep 27 23:39:38 2023 deployed jenkins-4.5.0 2.401.3 Upgrade complete status # get RELEASE_NAME $ helm list NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION staging-jenkins devops 11 2023-09-27 23:39:38.982931215 -0700 PDT deployed jenkins-4.5.0 2.401.3 # get status $ helm status staging-jenkins NAME: staging-jenkins LAST DEPLOYED: Wed Sep 27 23:39:38 2023 NAMESPACE: devops STATUS: deployed REVISION: 11 NOTES: 1. Get your 'admin' user password by running: kubectl exec --namespace devops -it svc/staging-jenkins -c jenkins -- /bin/cat /run/secrets/additional/chart-admin-password && echo 2. Get the Jenkins URL to visit by running these commands in the same shell: echo http://127.0.0.1:8080 kubectl --namespace devops port-forward svc/staging-jenkins 8080:8080 3. Login with the password from step 1 and the username: admin 4. Configure security realm and authorization strategy 5. Use Jenkins Configuration as Code by specifying configScripts in your values.yaml file, see documentation: http://127.0.0.1:8080/configuration-as-code and examples: https://github.com/jenkinsci/configuration-as-code-plugin/tree/master/demos For more information on running Jenkins on Kubernetes, visit: https://cloud.google.com/solutions/jenkins-on-container-engine For more information about Jenkins Configuration as Code, visit: https://jenkins.io/projects/jcasc/ NOTE: Consider using a custom image with pre-installed plugins get get all # get RELEASE_NAME $ helm list NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION staging-jenkins devops 11 2023-09-27 23:39:38.982931215 -0700 PDT deployed jenkins-4.5.0 2.401.3 # get all including yaml $ helm get all staging-jenkins others helm is compatible HELM VERSION SUPPORTED KUBERNETES VERSIONS 3.11.x 1.26.x - 1.23.x 3.10.x 1.25.x - 1.22.x 3.9.x 1.24.x - 1.21.x 3.8.x 1.23.x - 1.20.x 3.7.x 1.22.x - 1.19.x 3.6.x 1.21.x - 1.18.x 3.5.x 1.20.x - 1.17.x 3.4.x 1.19.x - 1.16.x 3.3.x 1.18.x - 1.15.x 3.2.x 1.18.x - 1.15.x 3.1.x 1.17.x - 1.14.x 3.0.x 1.16.x - 1.13.x 2.16.x 1.16.x - 1.15.x 2.15.x 1.15.x - 1.14.x 2.14.x 1.14.x - 1.13.x 2.13.x 1.13.x - 1.12.x 2.12.x 1.12.x - 1.11.x 2.11.x 1.11.x - 1.10.x 2.10.x 1.10.x - 1.9.x 2.9.x 1.10.x - 1.9.x 2.8.x 1.9.x - 1.8.x 2.7.x 1.8.x - 1.7.x 2.6.x 1.7.x - 1.6.x 2.5.x 1.6.x - 1.5.x 2.4.x 1.6.x - 1.5.x 2.3.x 1.5.x - 1.4.x 2.2.x 1.5.x - 1.4.x 2.1.x 1.5.x - 1.4.x 2.0.x 1.4.x - 1.3.x Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/kubernetes/network.html":{"url":"virtualization/kubernetes/network.html","title":"network","keywords":"","body":" devops-kubernetes-controller devops-kubernetes-02 /etc/network/interface network info Route Details devops-kubernetes-03 references: Traefik 另类的服务暴露方式 devops-kubernetes-controller devops-kubernetes-02 /etc/network/interface $ cat /etc/network/interfaces auto lo iface lo inet loopback auto eno1 iface eno1 inet static address 130.147.180.86 netmask 255.255.255.192 gateway 130.147.180.65 dns-nameservers 130.147.236.5 161.92.35.78 dns-search cn-132.lan.mycompany.com > /etc/network/interfaces\" data-id=\"section0\" data-show=true data-collapse=true ces--> $ cat /etc/network/interfaces # interfaces(5) file used by ifup(8) and ifdown(8) auto lo iface lo inet loopback auto eno1 iface eno1 inet static address 130.147.180.86 netmask 255.255.255.192 gateway 130.147.180.65 dns-nameservers 130.147.236.5 161.92.35.78 dns-search cn-132.lan.mycompany.com broadcast 130.147.219.127 network 130.147.219.0 auto eno3 # iface eno3 inet dhcp # auto eno3 # iface eno3 inet static # address 192.168.11.121 # netmask 255.255.254.0 # gateway 192.168.10.1 # dns-nameservers 61.139.2.69 218.6.200.139 network info $ nmcli [-p] d[evice] show > Click here to check details\" data-id=\"section1\" data-show=true data-collapse=true ces--> $ nmcli -p d show eno1 =============================================================================== Device details (eno1) =============================================================================== GENERAL.DEVICE: eno1 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8C ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 130.147.180.86/26 IP4.GATEWAY: -- IP4.ROUTE[1]: dst = 161.92.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[2]: dst = 130.145.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[3]: dst = 180.166.223.190/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[4]: dst = 185.46.212.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[5]: dst = 130.140.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[6]: dst = 130.147.236.5/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[7]: dst = 130.147.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[8]: dst = 161.91.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[9]: dst = 161.84.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[10]: dst = 169.254.0.0/16, nh = 0.0.0.0, mt = 1000 IP4.ROUTE[11]: dst = 185.166.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[12]: dst = 130.146.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[13]: dst = 137.55.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[14]: dst = 161.83.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[15]: dst = 42.99.164.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[16]: dst = 161.85.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[17]: dst = 161.92.35.78/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[18]: dst = 140.207.91.234/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[19]: dst = 161.88.0.0/16, nh = 0.0.0.0, mt = 0 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318c/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- $ nmcli -p device show eno3 =============================================================================== Device details (eno3) =============================================================================== GENERAL.DEVICE: eno3 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8E ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 192.168.11.121/23 IP4.GATEWAY: 192.168.10.1 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318e/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- $ nmcli -p device show =============================================================================== Device details (eno2) =============================================================================== GENERAL.DEVICE: eno2 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8D ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 20 (unavailable) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: off ------------------------------------------------------------------------------- =============================================================================== Device details (eno4) =============================================================================== GENERAL.DEVICE: eno4 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8F ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 20 (unavailable) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: off ------------------------------------------------------------------------------- =============================================================================== Device details (eno1) =============================================================================== GENERAL.DEVICE: eno1 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8C ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 130.147.180.86/26 IP4.GATEWAY: -- IP4.ROUTE[1]: dst = 161.92.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[2]: dst = 130.145.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[3]: dst = 180.166.223.190/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[4]: dst = 185.46.212.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[5]: dst = 130.140.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[6]: dst = 130.147.236.5/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[7]: dst = 130.147.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[8]: dst = 161.91.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[9]: dst = 161.84.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[10]: dst = 169.254.0.0/16, nh = 0.0.0.0, mt = 1000 IP4.ROUTE[11]: dst = 185.166.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[12]: dst = 130.146.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[13]: dst = 137.55.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[14]: dst = 161.83.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[15]: dst = 42.99.164.34/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[16]: dst = 161.85.0.0/16, nh = 0.0.0.0, mt = 0 IP4.ROUTE[17]: dst = 161.92.35.78/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[18]: dst = 140.207.91.234/32, nh = 130.147.180.65, mt = 0 IP4.ROUTE[19]: dst = 161.88.0.0/16, nh = 0.0.0.0, mt = 0 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318c/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- =============================================================================== Device details (eno3) =============================================================================== GENERAL.DEVICE: eno3 ------------------------------------------------------------------------------- GENERAL.TYPE: ethernet ------------------------------------------------------------------------------- GENERAL.HWADDR: C4:34:6B:BA:31:8E ------------------------------------------------------------------------------- GENERAL.MTU: 1500 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- WIRED-PROPERTIES.CARRIER: on ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 192.168.11.121/23 IP4.GATEWAY: 192.168.10.1 ------------------------------------------------------------------------------- IP6.ADDRESS[1]: fe80::c634:6bff:feba:318e/64 IP6.GATEWAY: -- ------------------------------------------------------------------------------- =============================================================================== Device details (lo) =============================================================================== GENERAL.DEVICE: lo ------------------------------------------------------------------------------- GENERAL.TYPE: loopback ------------------------------------------------------------------------------- GENERAL.HWADDR: 00:00:00:00:00:00 ------------------------------------------------------------------------------- GENERAL.MTU: 65536 ------------------------------------------------------------------------------- GENERAL.STATE: 10 (unmanaged) ------------------------------------------------------------------------------- GENERAL.CONNECTION: -- ------------------------------------------------------------------------------- GENERAL.CON-PATH: -- ------------------------------------------------------------------------------- IP4.ADDRESS[1]: 127.0.0.1/8 IP4.GATEWAY: -- ------------------------------------------------------------------------------- IP6.ADDRESS[1]: ::1/128 IP6.GATEWAY: -- ------------------------------------------------------------------------------- Route Details $ route -n Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface 0.0.0.0 192.168.10.1 0.0.0.0 UG 100 0 0 eno3 42.99.164.34 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 130.140.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.145.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.146.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.147.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 130.147.180.64 0.0.0.0 255.255.255.192 U 0 0 0 eno1 130.147.236.5 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 137.55.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 140.207.91.234 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 161.83.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.84.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.85.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.88.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.91.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.92.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 161.92.35.78 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 169.254.0.0 0.0.0.0 255.255.0.0 U 1000 0 0 eno1 180.166.223.190 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 185.46.212.34 130.147.180.65 255.255.255.255 UGH 0 0 0 eno1 185.166.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eno1 192.168.10.0 0.0.0.0 255.255.254.0 U 100 0 0 eno3 devops-kubernetes-03 $ ifconfig en1 en1: flags=8863 mtu 1500 ether 6c:96:cf:f2:01:0a inet6 fe80::81d:93a6:a4d4:32c2%en1 prefixlen 64 secured scopeid 0x6 inet 192.168.10.124 netmask 0xfffffe00 broadcast 192.168.11.255 nd6 options=201 media: autoselect status: active $ ifconfig en0 en0: flags=8863 mtu 1500 options=10b ether 78:7b:8a:bc:c2:3c inet6 fe80::1843:dfe3:4c35:c38%en0 prefixlen 64 secured scopeid 0x5 inet 130.147.182.248 netmask 0xfffffe00 broadcast 130.147.183.255 nd6 options=201 media: autoselect (100baseTX ) status: active ifconfig $ ifconfig lo0: flags=8049 mtu 16384 options=1203 inet 127.0.0.1 netmask 0xff000000 inet6 ::1 prefixlen 128 inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 nd6 options=201 gif0: flags=8010 mtu 1280 stf0: flags=0<> mtu 1280 XHC20: flags=0<> mtu 0 en0: flags=8863 mtu 1500 options=10b ether 78:7b:8a:bc:c2:3c inet6 fe80::1843:dfe3:4c35:c38%en0 prefixlen 64 secured scopeid 0x5 inet 130.147.182.248 netmask 0xfffffe00 broadcast 130.147.183.255 nd6 options=201 media: autoselect (100baseTX ) status: active en1: flags=8863 mtu 1500 ether 6c:96:cf:f2:01:0a inet6 fe80::81d:93a6:a4d4:32c2%en1 prefixlen 64 secured scopeid 0x6 inet 192.168.10.124 netmask 0xfffffe00 broadcast 192.168.11.255 nd6 options=201 media: autoselect status: active en2: flags=8963 mtu 1500 options=60 ether 2a:00:02:31:1e:a0 media: autoselect status: inactive en3: flags=8963 mtu 1500 options=60 ether 2a:00:02:31:1e:a1 media: autoselect status: inactive bridge0: flags=8863 mtu 1500 options=63 ether 2a:00:02:31:1e:a0 Configuration: id 0:0:0:0:0:0 priority 0 hellotime 0 fwddelay 0 maxage 0 holdcnt 0 proto stp maxaddr 100 timeout 1200 root id 0:0:0:0:0:0 priority 0 ifcost 0 port 0 ipfilter disabled flags 0x2 member: en2 flags=3 ifmaxaddr 0 port 7 priority 0 path cost 0 member: en3 flags=3 ifmaxaddr 0 port 8 priority 0 path cost 0 nd6 options=201 media: status: inactive p2p0: flags=8843 mtu 2304 ether 0e:96:cf:f2:01:0a media: autoselect status: inactive awdl0: flags=8943 mtu 1484 ether 6e:66:62:10:bb:fa inet6 fe80::6c66:62ff:fe10:bbfa%awdl0 prefixlen 64 scopeid 0xb nd6 options=201 media: autoselect status: active utun0: flags=8051 mtu 2000 inet6 fe80::2c33:8275:3276:346f%utun0 prefixlen 64 scopeid 0xc nd6 options=201 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"virtualization/kubernetes/minikube.html":{"url":"virtualization/kubernetes/minikube.html","title":"minikube","keywords":"","body":" install start stop [!NOTE|label:references:] Handbook kubernetes/minikube install osx $ curl -sL -O https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64 $ sudo install minikube-darwin-amd64 /usr/local/bin/minikube linux $ curl -sL -O https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 $ sudo install minikube-linux-amd64 /usr/local/bin/minikube windows > New-Item -Path 'c:\\' -Name 'minikube' -ItemType Directory -Force > Invoke-WebRequest -OutFile 'c:\\minikube\\minikube.exe' -Uri 'https://github.com/kubernetes/minikube/releases/latest/download/minikube-windows-amd64.exe' -UseBasicParsing > $oldPath = [Environment]::GetEnvironmentVariable('Path', [EnvironmentVariableTarget]::Machine) if ($oldPath.Split(';') -inotcontains 'C:\\minikube'){ [Environment]::SetEnvironmentVariable('Path', $('{0};C:\\minikube' -f $oldPath), [EnvironmentVariableTarget]::Machine) } start $ minikube start 😄 minikube v1.32.0 on Darwin 14.1.1 ✨ Automatically selected the docker driver 📌 Using Docker Desktop driver with root privileges 👍 Starting control plane node minikube in cluster minikube 🚜 Pulling base image ... 💾 Downloading Kubernetes v1.28.3 preload ... > preloaded-images-k8s-v18-v1...: 403.35 MiB / 403.35 MiB 100.00% 24.17 M > gcr.io/k8s-minikube/kicbase...: 453.90 MiB / 453.90 MiB 100.00% 13.76 M 🔥 Creating docker container (CPUs=2, Memory=7906MB) ... 🐳 Preparing Kubernetes v1.28.3 on Docker 24.0.7 ... ▪ Generating certificates and keys ... ▪ Booting up control plane ... ▪ Configuring RBAC rules ... 🔗 Configuring bridge CNI (Container Networking Interface) ... 🔎 Verifying Kubernetes components... ▪ Using image gcr.io/k8s-minikube/storage-provisioner:v5 🌟 Enabled addons: storage-provisioner, default-storageclass 🏄 Done! kubectl is now configured to use \"minikube\" cluster and \"default\" namespace by default stop $ minikube stop ✋ Stopping node \"minikube\" ... 🛑 Powering off \"minikube\" via SSH ... 🛑 1 node stopped. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/docker/docker.html":{"url":"virtualization/docker/docker.html","title":"docker","keywords":"","body":" docker internals cgoups namespace docker daemon init install troubleshooting enable tcp port 2375 for external connection to docker docker completion complete alias Linux OSX docker build docker ps list without wrap filter ps format docker stats docker inspect docker proxy check docker layer media type manifest.v2+json sample json reference: cheatsheet Docker 学习笔记 什么是 Docker Understanding the Docker Internals Ideas for a cgroups UI Configure Liveness, Readiness and Startup Probes Docker for Windows: Deploying a docker-compose app to local Kubernetes Windows for Linux Nerds Running Docker on WSL2 without Docker Desktop Copy Docker repositories Docker storage drivers About storage drivers Docker In Docker * ContainerSSH/ContainerSSH WebAssembly: Docker without containers! docker internals cgoups namespace docker daemon [!TIP|label:references:] Protect the Docker daemon socket Configure and troubleshoot the Docker daemon Set Up Docker with TLS How to Configure Docker daemon with a configuration file? init [!NOTE|label:references:] Install Docker Engine on CentOS Linux post-installation steps for Docker Engine install environment cleanup$ sudo dnf remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine repo setup $ sudo dnf install -y yum-utils $ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo $ sudo dnf makecache install $ sudo dnf install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin # or $ sudo dnf install -y docker-ce docker-ce-cli containerd.io # or $ sudo dnf install -y docker-ce-19.03.15-3.el8 docker-ce-cli-19.03.15-3.el8 containerd.io # or $ sudo dnf install -y docker-ce-19.03.15-3.el8 \\ docker-ce-cli-19.03.15-3.el8 \\ containerd.io \\ docker-compose-plugin-2.16.0-1.el8 \\ docker-scan-plugin-0.23.0-3.el8 \\ docker-buildx-plugin-0.10.2-1.el8 to get available version:$ sudo dnf list docker-ce --showduplicates | grep 19\\.03 docker-ce.x86_64 3:19.03.15-3.el8 @docker-ce-stable docker-ce.x86_64 3:19.03.13-3.el8 docker-ce-stable docker-ce.x86_64 3:19.03.14-3.el8 docker-ce-stable docker-ce.x86_64 3:19.03.15-3.el8 docker-ce-stable enable service $ sudo systemctl enable --now docker Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /usr/local/lib/systemd/system/docker.service. account settings $ sudo usermod -aG docker $(whoami) teardown $ sudo dnf remove -y docker-ce docker-ce-cli containerd.io docker-compose-plugin docker-scan-plugin docker-buildx-plugin troubleshooting problem with installed package podman issue $ sudo yum install docker-ce-19.03.15-3.el8 \\ docker-ce-cli-19.03.15-3.el8 \\ containerd.io \\ docker-buildx-plugin \\ docker-compose-plugin Docker CE Stable - x86_64 272 kB/s | 43 kB 00:00 Error: Problem 1: problem with installed package podman-1.6.4-10.module_el8.2.0+305+5e198a41.x86_64 - package podman-1.6.4-10.module_el8.2.0+305+5e198a41.x86_64 requires runc >= 1.0.0-57, but none of the providers can be installed - package podman-3.3.1-9.module_el8.5.0+988+b1f0b741.x86_64 requires runc >= 1.0.0-57, but none of the providers can be installed - package containerd.io-1.6.21-3.1.el8.x86_64 conflicts with runc provided by runc-1.0.0-65.rc10.module_el8.2.0+305+5e198a41.x86_64 - package containerd.io-1.6.21-3.1.el8.x86_64 obsoletes runc provided by runc-1.0.0-65.rc10.module_el8.2.0+305+5e198a41.x86_64 - package containerd.io-1.6.21-3.1.el8.x86_64 conflicts with runc provided by runc-1.0.2-1.module_el8.5.0+911+f19012f9.x86_64 - package containerd.io-1.6.21-3.1.el8.x86_64 obsoletes runc provided by runc-1.0.2-1.module_el8.5.0+911+f19012f9.x86_64 - cannot install the best candidate for the job - package runc-1.0.0-66.rc10.module_el8.5.0+1004+c00a74f5.x86_64 is filtered out by modular filtering - package runc-1.0.0-72.rc92.module_el8.5.0+1006+8d0e68a2.x86_64 is filtered out by modular filtering Problem 2: problem with installed package buildah-1.11.6-7.module_el8.2.0+305+5e198a41.x86_64 - package buildah-1.11.6-7.module_el8.2.0+305+5e198a41.x86_64 requires runc >= 1.0.0-26, but none of the providers can be installed ... - package buildah-1.11.6-7.module_el8.2.0+305+5e198a41.x86_64 requires runc >= 1.0.0-26, but none of the providers can be installed - package buildah-1.22.3-2.module_el8.5.0+911+f19012f9.x86_64 requires runc >= 1.0.0-26, but none of the providers can be installed - package containerd.io-1.3.7-3.1.el8.x86_64 conflicts with runc provided by runc-1.0.0-65.rc10.module_el8.2.0+305+5e198a41.x86_64 ... solution : remove podman $ sudo dnf remove buildah skopeo podman containers-common atomic-registries docker container-tools $ sudo rm -rf /etc/containers/* /var/lib/containers/* /etc/docker /etc/subuid* /etc/subgid* $ cd ~ && rm -rf /.local/share/containers/ Error: Transaction test error issue $ sudo dnf install -y docker-ce-19.03.15-3.el8 docker-ce-cli-19.03.15-3.el8 containerd.io docker-compose-plugin-2.16.0-1.el8 docker-scan-plugin-0.23.0-3.el8 docker-buildx-plugin-0.10.2-1.el8 Error: Transaction test error: file /usr/libexec/docker/cli-plugins/docker-buildx from install of docker-buildx-plugin-0:0.10.2-1.el8.x86_64 conflicts with file from package docker-ce-cli-1:19.03.15-3.el8.x86_64 solution: using latest docker-ce-cli $ sudo dnf install -y docker-ce-19.03.15-3.el8 docker-ce-cli containerd.io docker-compose-plugin docker-scan-plugin docker-buildx-plugin CentOS Stream 8 - AppStream 14 MB/s | 34 MB 00:02 CentOS Stream 8 - BaseOS 6.4 MB/s | 53 MB 00:08 CentOS Stream 8 - Extras 31 kB/s | 18 kB 00:00 CentOS Stream 8 - Extras common packages 9.6 kB/s | 6.9 kB 00:00 Docker CE Stable - x86_64 289 kB/s | 51 kB 00:00 Dependencies resolved. ======================================================================================================== Package Arch Version Repository Size ======================================================================================================== Installing: containerd.io x86_64 1.6.24-3.1.el8 docker-ce-stable 34 M docker-buildx-plugin x86_64 0.11.2-1.el8 docker-ce-stable 13 M docker-ce x86_64 3:19.03.15-3.el8 docker-ce-stable 24 M docker-ce-cli x86_64 1:24.0.7-1.el8 docker-ce-stable 7.2 M docker-compose-plugin x86_64 2.21.0-1.el8 docker-ce-stable 13 M docker-scan-plugin x86_64 0.23.0-3.el8 docker-ce-stable 3.8 M Installing dependencies: container-selinux noarch 2:2.224.0-1.module_el8+712+4cd1bd69 appstream 70 k libcgroup x86_64 0.41-19.el8 baseos 70 k Transaction Summary ======================================================================================================== Install 8 Packages Total download size: 95 M Installed size: 376 M Downloading Packages: (1/8): containerd.io-1.6.24-3.1.el8.x86_64.rpm 24 MB/s | 34 MB 00:01 (2/8): container-selinux-2.224.0-1.module_el8+712+4cd1bd69.noarch.rpm 49 kB/s | 70 kB 00:01 (3/8): libcgroup-0.41-19.el8.x86_64.rpm 48 kB/s | 70 kB 00:01 (4/8): docker-buildx-plugin-0.11.2-1.el8.x86_64.rpm 30 MB/s | 13 MB 00:00 (5/8): docker-compose-plugin-2.21.0-1.el8.x86_64.rpm 31 MB/s | 13 MB 00:00 (6/8): docker-ce-cli-24.0.7-1.el8.x86_64.rpm 7.2 MB/s | 7.2 MB 00:00 (7/8): docker-scan-plugin-0.23.0-3.el8.x86_64.rpm 12 MB/s | 3.8 MB 00:00 (8/8): docker-ce-19.03.15-3.el8.x86_64.rpm 14 MB/s | 24 MB 00:01 -------------------------------------------------------------------------------------------------------- Total 26 MB/s | 95 MB 00:03 Running transaction check Transaction check succeeded. Running transaction test Transaction test succeeded. Running transaction Preparing : 1/1 Installing : docker-compose-plugin-2.21.0-1.el8.x86_64 1/8 Running scriptlet: docker-compose-plugin-2.21.0-1.el8.x86_64 1/8 Running scriptlet: container-selinux-2:2.224.0-1.module_el8+712+4cd1bd69.noarch 2/8 Installing : container-selinux-2:2.224.0-1.module_el8+712+4cd1bd69.noarch 2/8 Running scriptlet: container-selinux-2:2.224.0-1.module_el8+712+4cd1bd69.noarch 2/8 Installing : containerd.io-1.6.24-3.1.el8.x86_64 3/8 Running scriptlet: containerd.io-1.6.24-3.1.el8.x86_64 3/8 Installing : docker-scan-plugin-0.23.0-3.el8.x86_64 4/8 Running scriptlet: docker-scan-plugin-0.23.0-3.el8.x86_64 4/8 Installing : docker-buildx-plugin-0.11.2-1.el8.x86_64 5/8 Running scriptlet: docker-buildx-plugin-0.11.2-1.el8.x86_64 5/8 Installing : docker-ce-cli-1:24.0.7-1.el8.x86_64 6/8 Running scriptlet: docker-ce-cli-1:24.0.7-1.el8.x86_64 6/8 Running scriptlet: libcgroup-0.41-19.el8.x86_64 7/8 Installing : libcgroup-0.41-19.el8.x86_64 7/8 Running scriptlet: libcgroup-0.41-19.el8.x86_64 7/8 /sbin/ldconfig: /usr/lib64/llvm15/lib/libclang.so.15 is not a symbolic link Installing : docker-ce-3:19.03.15-3.el8.x86_64 8/8 Running scriptlet: docker-ce-3:19.03.15-3.el8.x86_64 8/8 Running scriptlet: container-selinux-2:2.224.0-1.module_el8+712+4cd1bd69.noarch 8/8 Running scriptlet: docker-ce-3:19.03.15-3.el8.x86_64 8/8 /sbin/ldconfig: /usr/lib64/llvm15/lib/libclang.so.15 is not a symbolic link Verifying : container-selinux-2:2.224.0-1.module_el8+712+4cd1bd69.noarch 1/8 Verifying : libcgroup-0.41-19.el8.x86_64 2/8 Verifying : containerd.io-1.6.24-3.1.el8.x86_64 3/8 Verifying : docker-buildx-plugin-0.11.2-1.el8.x86_64 4/8 Verifying : docker-ce-3:19.03.15-3.el8.x86_64 5/8 Verifying : docker-ce-cli-1:24.0.7-1.el8.x86_64 6/8 Verifying : docker-compose-plugin-2.21.0-1.el8.x86_64 7/8 Verifying : docker-scan-plugin-0.23.0-3.el8.x86_64 8/8 Installed: container-selinux-2:2.224.0-1.module_el8+712+4cd1bd69.noarch containerd.io-1.6.24-3.1.el8.x86_64 docker-buildx-plugin-0.11.2-1.el8.x86_64 docker-ce-3:19.03.15-3.el8.x86_64 docker-ce-cli-1:24.0.7-1.el8.x86_64 docker-compose-plugin-2.21.0-1.el8.x86_64 docker-scan-plugin-0.23.0-3.el8.x86_64 libcgroup-0.41-19.el8.x86_64 Complete! $ sudo dnf list --installed | grep -E 'docker|container' container-selinux.noarch 2:2.224.0-1.module_el8+712+4cd1bd69 @appstream containerd.io.x86_64 1.6.24-3.1.el8 @docker-ce-stable containernetworking-plugins.x86_64 1:1.3.0-2.module_el8+461+0c6b54ea @AppStream docker-buildx-plugin.x86_64 0.11.2-1.el8 @docker-ce-stable docker-ce.x86_64 3:19.03.15-3.el8 @docker-ce-stable docker-ce-cli.x86_64 1:24.0.7-1.el8 @docker-ce-stable docker-compose-plugin.x86_64 2.21.0-1.el8 @docker-ce-stable docker-scan-plugin.x86_64 0.23.0-3.el8 @docker-ce-stable systemd-container.x86_64 239-76.el8 @anaconda enable tcp port 2375 for external connection to docker references: * Configure where the Docker daemon listens for connections * styblope/docker-api-port.md * Configure the daemon Configure remote access for Docker daemon Protect the Docker daemon socket Configure and troubleshoot the Docker daemon Control Docker with systemd Configure the daemon for IPv6 Docker and iptables Install Docker Engine on Debian Install Docker Engine on CentOS Docker security : Docker daemon attack surface [!TIP] to check service$ sudo systemd-analyze verify enable service if necessary$ sudo systemctl enable containerd.service Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service → /usr/lib/systemd/system/containerd.service # prepare $ sudo systemctl stop docker.service $ sudo systemctl stop docker.socket via daemon.json $ cat /etc/docker/daemon.json { \"hosts\": [\"unix:///var/run/docker.sock\", \"tcp://127.0.0.1:2375\"] } # or $ cat /etc/docker/daemon.json { \"hosts\": [\"unix:///var/run/docker.sock\", \"fd://\", \"tcp://127.0.0.1:2375\"] } $ sudo systemctl edit docker.service via override.conf $ cat /etc/systemd/system/docker.service.d/override.conf [Service] ExecStart= ExecStart=/usr/bin/dockerd -H fd:// -H tcp://127.0.0.1:2375 [--containerd=/run/containerd/containerd.sock] [--config-file /etc/docker/daemon.json] $ sudo systemctl daemon-reload $ sudo systemctl restart docker.service # result $ sudo netstat -lntp | grep dockerd tcp6 0 0 :::2375 :::* LISTEN 5649/dockerd result $ sudo cat /etc/docker/daemon.json { \"hosts\": [\"unix:///var/run/docker.sock\", \"fd://\", \"tcp://0.0.0.0:2375\"] } $ sudo cat /etc/systemd/system/docker.service.d/docker.conf [Service] ExecStart= ExecStart=/usr/bin/dockerd $ docker -H tcp://0.0.0.0:2376 pull ubuntu:18.04 18.04: Pulling from library/ubuntu a404e5416296: Pull complete Digest: sha256:ca70a834041dd1bf16cc38dfcd24f0888ec4fa431e09f3344f354cf8d1724499 Status: Downloaded newer image for ubuntu:18.04 verify $ ip -4 a s en1 5: en1: mtu 1500 qdisc mq state UP group default qlen 1000 inet x.x.x.x/24 brd x.x.x.255 scope global noprefixroute en1 valid_lft forever preferred_lft forever $ nc -zv 2375 Connection to target.ip.address 2375 port [tcp/*] succeeded! $ docker -H tcp://:2375 images REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu 18.04 71eaf13299f4 2 weeks ago 63.1MB or modify in /lib/systemd/system/docker.service # Replacing this line: ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock # | | # ------ # remove `-H fd://` # With this line: ExecStart=/usr/bin/dockerd --containerd=/run/containerd/containerd.sock [--tls=false] or via socat exec socat -d TCP-LISTEN:2375,fork UNIX-CONNECT:/var/run/docker.sock $ sudo cat /usr/lib/systemd/system/docker.service [Unit] Description=Docker Application Container Engine Documentation=https://docs.docker.com After=network-online.target docker.socket firewalld.service containerd.service time-set.target Wants=network-online.target containerd.service Requires=docker.socket [Service] Type=notify # the default is not to use systemd for cgroups because the delegate issues still # exists and systemd currently does not support the cgroup feature set required # for containers run by docker # remove if enable remote access in /etc/docker/daemon.json # ---+-- # | | ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock ExecReload=/bin/kill -s HUP $MAINPID TimeoutStartSec=0 RestartSec=2 Restart=always # Note that StartLimit* options were moved from \"Service\" to \"Unit\" in systemd 229. # Both the old, and new location are accepted by systemd 229 and up, so using the old location # to make them work for either version of systemd. StartLimitBurst=3 # Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230. # Both the old, and new name are accepted by systemd 230 and up, so using the old name to make # this option work for either version of systemd. StartLimitInterval=60s # Having non-zero Limit*s causes performance problems due to accounting overhead # in the kernel. We recommend using cgroups to do container-local accounting. LimitNOFILE=infinity LimitNPROC=infinity LimitCORE=infinity # Comment TasksMax if your systemd version does not support it. # Only systemd 226 and above support this option. TasksMax=infinity # set delegate yes so that systemd does not reset the cgroups of docker containers Delegate=yes # kill only the docker process, not all processes in the cgroup KillMode=process OOMScoreAdjust=-500 [Install] WantedBy=multi-user.target docker completion references: command-line completion complete alias docker/tricky Linux $ curl -fsSL https://raw.githubusercontent.com/docker/cli/master/contrib/completion/bash/docker \\ -o /etc/bash_completion.d/docker load completion $ grep 'bash_completion' /etc/bashrc if [ -f /usr/share/bash-completion/bash_completion ]; then source /usr/share/bash-completion/bash_completion fi $ cat /usr/share/bash-completion/bash_completion ... 2070 # source compat completion directory definitions 2071 compat_dir=${BASH_COMPLETION_COMPAT_DIR:-/etc/bash_completion.d} 2072 if [[ -d $compat_dir && -r $compat_dir && -x $compat_dir ]]; then 2073 for i in \"$compat_dir\"/*; do 2074 [[ ${i##*/} != @($_backup_glob|Makefile*|$_blacklist_glob) \\ 2075 && -f $i && -r $i ]] && . \"$i\" 2076 done 2077 fi 2078 unset compat_dir i _blacklist_glob 2079 2080 # source user completion file 2081 user_completion=${BASH_COMPLETION_USER_FILE:-~/.bash_completion} 2082 [[ ${BASH_SOURCE[0]} != $user_completion && -r $user_completion ]] \\ 2083 && . $user_completion 2084 unset user_completion ... OSX bashComp=\"$(brew --prefix)/etc/bash_completion.d\" bashComp2=\"$(brew --prefix)/etc/profile.d/bash_completion.sh\" dApp=\"/Applications/Docker.app\" dmver='0.16.2' gitcontent='https://raw.githubusercontent.com' dm=\"${gitcontent}/docker/machine/v${dmver}/contrib/completion/bash/docker-machine.bash\" curlOpt='-x 127.0.0.1:1087 -fsSL' brew install bash-completion@2 sudo curl ${curlOpt} ${dm} --output ${bashComp}/docker-machine.bash for _i in docker.bash-completion docker-compose.bash-completion; do ln -s ${dApp}/Contents/Resources/etc/${_i} ${bashComp}/${_i} done cat > ~/.bash_profile /dev/null; then # bash-completion [ -f \"${bashComp}\" ] && export BASH_COMPLETION_COMPAT_DIR=\"${bashComp}\" && source \"${bashComp}\"; # bash-completion@2 [ -f \"${bashComp2}\" ] && source \"${bashComp2}\"; fi EOF result $ complete -p d complete -F _complete_alias d $ complete -p dls complete -F _complete_alias dls # others: $ complete -p k complete -F _complete_alias k $ complete -p git complete -o bashdefault -o default -o nospace -F __git_wrap__git_main git docker build Best practices for writing Dockerfiles Create a base image Dockerfile reference $ docker build \\ --no-cache \\ --build-arg REPO= \\ --build-arg TAG=1.4-bionic \\ -t /devops/jnlp.bionic \\ -f devops-jnlp . docker ps references: docker ps list without wrap $ docker ps -a --no-trunc or $ curl --unix-socket /var/run/docker.sock 'http://localhost/containers/json' i.e.: $ docker ps -a --no-trunc --filter name=marslo* list full container id $ docker ps -aq --no-trunc or $ docker inspect --format=\"{{.Id}}\" d40df87b2f87 d40df87b2f87261152d2541b870c6b801c031f8df969e4bd3e9b3c607e6c1698 filter [!NOTE|label:references:] Filtering FILTER DESCRIPTION id Container's ID name Container's name label An arbitrary string representing either a key or a key-value pair. Expressed as or = exited An integer representing the container's exit code. Only useful with --all. status One of created, restarting, running, removing, paused, exited, or dead ancestor Filters containers which share a given image as an ancestor. Expressed as [:], , or image@digest before or since Filters containers created before or after a given container ID or name volume Filters running containers which have mounted a given volume or bind mount. network Filters running containers connected to a given network. publish or expose Filters containers which publish or expose a given port. Expressed as [/] or /[] health Filters containers based on their healthcheck status. One of starting, healthy, unhealthy or none. isolation Windows daemon only. One of default, process, or hyperv. is-task Filters containers that are a \"task\" for a service. Boolean option (true or false) via name$ docker ps -aqf \"name=mycontainer\" 77745046363d filter with image $ docker ps -a --no-trunc --filter ancestor='busybox:latest' # for jenkins/jenkins $ docker ps -a --filter ancestor=jenkins/jenkins:2.401.2-lts-jdk11 --format \"{{.ID}}\" filter with exit code$ docker ps -a --filter 'exited=0' filter with status$ docker ps --filter status=running filter with tag$ docker images --filter \"reference=*/*/*/*:1.4-bionic-dind\" ps format see iMarslo : docker/show docker stats see docker/show docker inspect see docker/show docker proxy see docker/tricky check docker layer references: docker history $ docker history [--no-trunc=true] : IMAGE CREATED CREATED BY SIZE COMMENT af73a9899a8f 6 months ago /bin/sh -c #(nop) WORKDIR /home/devops 0B e96534e326ed 6 months ago /bin/sh -c #(nop) VOLUME [/home/devops/.ssh] 0B 4d3392929105 6 months ago |5 VERSION=1.6 gid=1000 group=devops uid=100… 884B 8abbc25a66a4 6 months ago |5 VERSION=1.6 gid=1000 group=devops uid=100… 812B 4cf413ae805e 6 months ago /bin/sh -c #(nop) USER devops 0B d1d88d88e61b 6 months ago |5 VERSION=1.6 gid=1000 group=devops uid=100… 1.45GB 4b305ec8942c 6 months ago /bin/sh -c #(nop) COPY file:c19a45386e5be7e4… 411B a36e97b18597 6 months ago |5 VERSION=1.6 gid=1000 group=devops uid=100… 398kB 7abf758ac126 6 months ago /bin/sh -c #(nop) USER root 0B b7cc7e6545cf 6 months ago /bin/sh -c #(nop) ENV DEBIAN_FRONTEND=nonin… 0B 4aa2bff1261d 6 months ago /bin/sh -c #(nop) ENV HOME=/home/devops 0B 97c1260a833a 6 months ago /bin/sh -c #(nop) ARG gid=1000 0B 1641eb4e6b1a 6 months ago /bin/sh -c #(nop) ARG uid=1000 0B f550761577d3 6 months ago /bin/sh -c #(nop) ARG group=devops 0B 25f225d7fdaa 6 months ago /bin/sh -c #(nop) ARG user=devops 0B ea3b83e6ee69 6 months ago /bin/sh -c #(nop) ARG VERSION=1.6 0B cf8ee6149a83 6 months ago /bin/sh -c #(nop) LABEL description=specifi… 0B 3c8433a403ad 6 months ago /bin/sh -c #(nop) LABEL maintainer=marslo@x… 0B e7d65936ff5d 6 months ago /bin/sh -c #(nop) LABEL version=1.6 0B ac9cd6bdb0cf 6 months ago /bin/sh -c #(nop) MAINTAINER marslo 7 months ago /bin/sh -c #(nop) ADD file:40290d9a94ae76c35… 63.1MB media type [!TIP] references: image manifest version 2, schema 1 image manifest version 2, schema 2 update deprecated schema image manifest version 2, v1 images docker engine 19.03 release notes what is a docker image manifest? manifest.v2+json [!NOTE] mediaType in manifest should be 'application/vnd.docker.distribution.manifest.v2+json' not 'application/vnd.oci.image.manifest.v1+json' docker version$ docker -v Docker version 19.03.2, build 6a30dfc solution [!TIP] One way to upgrade an image from image manifest version 2, schema 1 to schema 2 is to docker pull the image and then docker push the image with a current version of Docker. Doing so will automatically convert the image to use the latest image manifest specification. Converting an image to image manifest version 2, schema 2 converts the manifest format, but does not update the contents within the image. Images using manifest version 2, schema 1 may contain unpatched vulnerabilities. We recommend looking for an alternative image or rebuilding it. sample json $ docker manifest inspect artifactory.domain.com/docker/devops/jenkins:2.387.1-lts WARN[0000] Conmon at /usr/libexec/podman/conmon invalid: outdated conmon version WARN[0000] Warning! The manifest type application/vnd.docker.distribution.manifest.v2+json is not a manifest list but a single image. { \"schemaVersion\": 2, \"mediaType\": \"application/vnd.docker.distribution.manifest.v2+json\", \"config\": { \"mediaType\": \"application/vnd.docker.container.image.v1+json\", \"size\": 13129, \"digest\": \"sha256:d5ed2ceef0ec08e9044ebb39812f211d64dbcdfce775cc6b0460ca289193416f\" }, \"layers\": [ { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 55045922, \"digest\": \"sha256:32fb02163b6bb519a30f909008e852354dae10bdfd6b34190dbdfe8f15403ea0\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 51628196, \"digest\": \"sha256:c09d5e9e1188f3fff7a4f8c3c7c330fde5184cba1c6f0c92526b8b7bd0ac7c26\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 8929986, \"digest\": \"sha256:a56533012712c1db623da3e5e9c2d0276301c82db0a2e7a82debfb57e5d916f2\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 1244, \"digest\": \"sha256:7936e107ffe73b406a0d02edf9bb02b983534d803bb06fd03dc38dac4b6cfe2a\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 189, \"digest\": \"sha256:3ca683058265b99b65bbc69b9e8fa4c46e830db35aad614706200e6cf0c30d8a\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 98119982, \"digest\": \"sha256:c2ecd304b4b84ef6154bd85e13360f0b015e39057a329698617ce0a53ed6cf32\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 202, \"digest\": \"sha256:be3512d810d65f00f28af0885e2f30833263ee061528e20c7fee21664f1572b8\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 5841675, \"digest\": \"sha256:56b37d7c2a7a3c93fd013cb1ad5652f8cea3910ecc0274d73064bba27ab57864\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 76925753, \"digest\": \"sha256:99ed1e723e52507ce2d615e1682d673c3ffcec5f5b68c266db70d829ef4be208\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 1932, \"digest\": \"sha256:256db5485b1399ecbd58c2558388fc9a4ff1caaaeacbdfe23127c7f13b1ee98b\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 1170, \"digest\": \"sha256:ee8c7eaf5e6bd8c45e503756da48e80137def6765017148ce9f2af66ce97244b\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 374, \"digest\": \"sha256:509f66c2f3174642f0eb3e3b2e8a70da698f613042ec65f525c476afe0b6b7d5\" }, { \"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 271, \"digest\": \"sha256:820296a845d636be13276fdf3bdae7fdf2ac00d401182632d1ab450e26353674\" } ] } $ docker manifest inspect docker.io/jenkins/jenkins:2.387.1-lts WARN[0000] Conmon at /usr/libexec/podman/conmon invalid: outdated conmon version { \"schemaVersion\": 2, \"mediaType\": \"application/vnd.docker.distribution.manifest.list.v2+json\", \"manifests\": [ { \"mediaType\": \"application/vnd.oci.image.manifest.v1+json\", \"size\": 2765, \"digest\": \"sha256:005fcb5c3017ef120d0d9d8d8925e9248ff6e2cf2b5e18b527b01459c7b2b3f4\", \"platform\": { \"architecture\": \"amd64\", \"os\": \"linux\" } }, { \"mediaType\": \"application/vnd.oci.image.manifest.v1+json\", \"size\": 2765, \"digest\": \"sha256:023fd7da56df685064940ff19c03c835e5fc3643ced00cc2bd792e2379cad2c3\", \"platform\": { \"architecture\": \"arm64\", \"os\": \"linux\" } }, { \"mediaType\": \"application/vnd.oci.image.manifest.v1+json\", \"size\": 2765, \"digest\": \"sha256:4b5c14cabb880c1080ac6d07bcefb379fbf31f821556073205ac28f14ed55cf2\", \"platform\": { \"architecture\": \"s390x\", \"os\": \"linux\" } }, { \"mediaType\": \"application/vnd.oci.image.manifest.v1+json\", \"size\": 566, \"digest\": \"sha256:797e205c02212b0ee424969f3441dd23fca9a1157add0211e5f63eab440254ea\", \"platform\": { \"architecture\": \"unknown\", \"os\": \"unknown\" } }, { \"mediaType\": \"application/vnd.oci.image.manifest.v1+json\", \"size\": 566, \"digest\": \"sha256:150e17c6e040dcb86dbb29144a330a4c48be97949bc74ba270796b8bda419b49\", \"platform\": { \"architecture\": \"unknown\", \"os\": \"unknown\" } }, { \"mediaType\": \"application/vnd.oci.image.manifest.v1+json\", \"size\": 566, \"digest\": \"sha256:d4dcd45f608ade71e0c6d4ac68ff8aa4f34826f8181d2e18797101c55eb6ea77\", \"platform\": { \"architecture\": \"unknown\", \"os\": \"unknown\" } } ] } Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/docker/run.exec.html":{"url":"virtualization/docker/run.exec.html","title":"run & exec","keywords":"","body":" docker exec login docker container as root docker run run into dind run to override entrypoint run commands to override entrypoint runtime options with memory, cpus, and gpus run with always restart docker exec login docker container as root $ docker run -d : $ docker exec --privileged -u root -it /bin/bash docker run run into dind $ docker run \\ --name \"marslo\" \\ --entrypoint /bin/bash \\ --privileged \\ --rm \\ -it \\ -v /var/run/docker.sock:/var/run/docker.sock \\ docker:dind $ ubuntu@01acbffd94ec:~$ docker --version Docker version 18.06.1-ce, build e68fc7a run to override entrypoint $ docker run \\ --name marslo \\ -it \\ --entrypoint /bin/bash \\ docker:dind run commands to override entrypoint $ docker run \\ -it \\ --rm \\ --entrypoint /bin/bash \\ docker:dind \\ -c 'cat /etc/*-release' runtime options with memory, cpus, and gpus reference: Docker容器CPU、memory资源限制 Memory Resource Controller CPU Accounting Controller CFS Bandwidth Control RedHat: 3.3. CPUACCT RedHat: 3.4. CPUSET Brief summary of control files /sys/fs/cgroup/memory/docker/ID/memory.usage_in_bytes : show current usage for memory /sys/fs/cgroup/memory/docker/ID/memory.limit_in_bytes : set/show limit of memory usage /sys/fs/cgroup/cpuacct/docker/ID/cpuacct.usage : show the total CPU time (in nanoseconds) consumed by all tasks in this cgroup /sys/fs/cgroup/cpuacct/docker/ID/cpuacct.stat : show the user and system CPU time consumed by all tasks in this cgroup /sys/fs/cgroup/cpuacct/docker/ID/cpuacct.usage_percpu: show the CPU time (in nanoseconds) consumed on each CPU by all tasks in this cgroup memory $ docker run \\ --name marslo \\ -it \\ --entrypoint /bin/bash \\ --memory=4G \\ --oom-kill-disable \\ // optional docker:dind cpu $ docker run \\ --name marslo \\ -it \\ --entrypoint /bin/bash \\ --cpus=\"4\" \\ docker:dind run with always restart docker: Conflicting options: --restart and --rm. $ docker run \\ -d \\ --name ss-libev \\ --restart=always \\ -p 8443:8443 \\ -p 8443:8443/udp \\ -v /etc/shadowsocks-libev:/etc/shadowsocks-libev \\ teddysun/shadowsocks-libev visit via$ docker exec -it ss-libev /bin/sh Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/docker/volume.html":{"url":"virtualization/docker/volume.html","title":"voume","keywords":"","body":" check data killed container stopped container mount mount exists volume to new container references: gdiepen/docker-convenience-scripts check data killed container $ docker volume ls | grep ssd-fw-SC- | head -1 local 5b2e5ca2d4563199cc3a982e74c3f4613a7a1b4a1d91bb948561d5a6a1cf4cfa $ docker inspect 5b2e5ca2d4563199cc3a982e74c3f4613a7a1b4a1d91bb948561d5a6a1cf4cfa | jq -r .[].Mountpoint /var/lib/docker/volumes/5b2e5ca2d4563199cc3a982e74c3f4613a7a1b4a1d91bb948561d5a6a1cf4cfa/_data stopped container $ docker ps -a --format '{{.ID}}' 77745046363d $ docker inspect $(docker ps -a --format '{{.ID}}' | head -1) | jq -r '.[].Mounts[] | select(.Mode == \"rw\") | .Source' /var/lib/docker/volumes/ssd-fw-DESKTOP-KUUJPNF-LAB-p0-18558e0fe2640d50617587518acfe1fc5a10d3e2077a62d26509b679832f3fd1/_data $ sudo ls -Altrh $(docker inspect $(docker ps -a --format '{{.ID}}' | head -1) | jq -r '.[].Mounts[] | select(.Mode == \"rw\") | .Source') mount mount exists volume to new container # $1: exists volume need to be visit # $2: new volume for new container $ docker volume create --name $2 $ docker run --rm \\ -i \\ -t \\ -v $1:/from \\ -v $2:/to \\ alpine ash -c \"cd /from ; cp -av . /to\" Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/docker/remove.html":{"url":"virtualization/docker/remove.html","title":"remove","keywords":"","body":" prune docker rmi docker rmi for keywords docker rm prune $ docker system prune --all WARNING! This will remove: - all stopped containers - all networks not used by at least one container - all dangling images - all build cache Are you sure you want to continue? [y/N] y # prune volume only $ docker system prune --volumes show info [!NOTE|label:see also:] iMarslo: show info $ docker system df docker rmi remove via docker image $ docker rmi -f $(docker images \"*/*/*/myimage\" --format \"{{.ID}}\") or $ docker images \"*/*/*/myimage\" --format \"{{.ID}}\" | xargs docker rmi -f remove tag images $ docker images -q -f \"dangling=true\" | xargs docker rmi -f --no-trunc or $ docker rmi -f $(docker images --filter dangling=true -q) or $ docker image prune --filter=\"dangling=true\" docker rmi for keywords $ name='jenkins' $ tag='2.361.3-lts' $ if docker images ${name}:${tag} --format \\\"{{.Tag}}\\\" >/dev/null ; then for imageId in $(docker images ${name} --format \\\"{{.Tag}}\\\\t{{.ID}}\\\" | grep --color=none --fixed-strings ${tag} | awk '{print \\$NF}' | uniq); do docker rmi ${name}:${tag} ; docker rmi -f ${imageId} ; done ; fi cleanup all image path with my.artifactory.com/docker/marslo/$ docker rmi -f $(docker images my.artifactory.com/docker/marslo/* -q) or$ docker rmi -f $(docker images my.artifactory.com/docker/*/* -q) docker rm remove all stopped container $ docker ps --filter \"status=exited\" --format '{{.ID}}' | xargs docker rm -f or$ docker rm $(docker ps -aq --filter \"status=exited\") Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/docker/show.html":{"url":"virtualization/docker/show.html","title":"show info","keywords":"","body":" docker ps docker list docker inspect show docker image show entrypoint list environment check mounts log path get full container ID check repo tag docker stats docker system df events prune ps format [!TIP|label:references:] Format command and log output Format the output (--format) docker ps PLACEHOLDER DESCRIPTION .ID Container ID .Image Image ID .Command Quoted command .CreatedAt Time when the container was created. .RunningFor Elapsed time since the container was started. .Ports Exposed ports. .State Container status (for example; \"created\", \"running\", \"exited\"). .Status Container status with details about duration and health-status. .Size Container disk size. .Names Container names. .Labels All labels assigned to the container. .Label Value of a specific label for this container. For example '{{.Label \"com.docker.swarm.cpu\"}}' .Mounts Names of the volumes mounted in this container. .Networks Names of the networks attached to this container. original $ docker ps -a --filter 'status=exited' | head -2 CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 5e5f59e3aff3 3129a2ca29d7 \"/configmap-reload -…\" 2 months ago Exited (137) 2 months ago k8s_rules-configmap-reloader_prometheus-k8s-0_monitoring_aeba5164-dda4-11ec-b785-0cc47aff0b92_1 via foramt $ docker ps -f 'status=exited' --format 'table {{.ID}}\\t{{.Image}}\\t{{.Command}}\\t{{.RunningFor}}\\t{{.Status}}\\t{{.Ports}}\\t{{.Names}}' | head -2 CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 5e5f59e3aff3 3129a2ca29d7 \"/configmap-reload -…\" 2 months ago Exited (137) 2 months ago k8s_rules-configmap-reloader_prometheus-k8s-0_monitoring_aeba5164-dda4-11ec-b785-0cc47aff0b92_1 docker list sort by image size $ docker images --format \"{{.ID}}\\t{{.Size}}\\t{{.Repository}}:{{.Tag}}\" | sort -k 2 -hr docker inspect reference: docker inspect See full command of running/stopped container in Docker Docker remove TAG images Return container settings in JSON format show docker image $ docker inspect 5b4299c238e5 -f '{{ .Config.Image }}' show entrypoint $ docker inspect -f \"{{.Path}} {{.Args}} ({{.Id}})\" $(docker ps -a -q) or list only $ docker inspect -f \"{{.Path}} {{.Args}} ({{.Id}})\" i.e.: $ docker inspect -f \"{{.Path}} {{.Args}} ({{.Id}})\" bf6f6d166b88 /usr/bin/tini [-- /usr/local/bin/jenkins.sh] (bf6f6d166b88ed9695b89d859ddc1feb7d2deaf07c64352ad479645b707e0157) list environment $ docker inspect \\ --format='{{ .Name }}{{ printf \"\\n\" }}{{ range .Config.Env }}{{ printf \"\\n\\t\" }}{{ printf . }}{{ end }}' \\ check mounts $ docker inspect \\ --format='{{ .Name }}{{ printf \"\\n\" }}{{ range .HostConfig.Binds }}{{ printf \"\\n\\t\" }}{{ printf . }}{{ end }}' \\ i.e.: $ docker inspect \\ --format='{{ .Name }}{{ printf \":\\n\" }}{{ range .HostConfig.Binds }}{{ printf \"\\n\\t\" }}{{ printf . }}{{ end }}' \\ /k8s_jnlp-s31sk-1rvd0_060d5260-8b42-11ed-9c0f-b883034b82d0_0: /var/lib/kubelet/pods/060d5260-8b42-11ed-9c0f-b883034b82d0/volumes/kubernetes.io~empty-dir/workspace-volume:/home/marslo /var/lib/kubelet/pods/060d5260-8b42-11ed-9c0f-b883034b82d0/volumes/kubernetes.io~secret/default-token-m6bqf:/var/run/secrets/kubernetes.io/serviceaccount:ro /var/lib/kubelet/pods/060d5260-8b42-11ed-9c0f-b883034b82d0/etc-hosts:/etc/hosts /var/lib/kubelet/pods/060d5260-8b42-11ed-9c0f-b883034b82d0/containers/jnlp/1d0c9319:/dev/termination-log or $ docker inspect \\ -f '{{ .Name }}{{ printf \":\\n\" }}{{ range .Mounts }}{{ printf \"\\n\\t\" }}{{ .Type }}{{ printf \"\\t\" }}{{ if eq .Type \"bind\" }}{{ .Source }}{{ end }}{{ .Name }} => {{ .Destination }}{{ end }}{{ printf \"\\n\" }}' \\ 8e59c4dd2f65 /k8s_jnlp-s31sk-1rvd0_060d5260-8b42-11ed-9c0f-b883034b82d0_0: bind /var/lib/kubelet/pods/060d5260-8b42-11ed-9c0f-b883034b82d0/volumes/kubernetes.io~secret/default-token-m6bqf => /var/run/secrets/kubernetes.io/serviceaccount volume 6c18dbf9b131a9fb245fe896a56b4f4db33f3f32eb1f2b3fcc10c5e50baf7e4f => /home/devops/.jenkins bind /var/lib/kubelet/pods/060d5260-8b42-11ed-9c0f-b883034b82d0/volumes/kubernetes.io~empty-dir/workspace-volume => /home/devops bind /var/lib/kubelet/pods/060d5260-8b42-11ed-9c0f-b883034b82d0/etc-hosts => /etc/hosts bind /var/lib/kubelet/pods/060d5260-8b42-11ed-9c0f-b883034b82d0/containers/jnlp/1d0c9319 => /dev/termination-log volume 69c10d1602dc0af1ad305f21ec74f5c568a735c18c64b7b0cb5e04120159e2bd => /home/devops/.ssh volume 02668c553b25d1b3f5ba51c85885fab6abf74296a4c0393d35006737d543a174 => /home/devops/agent or $ docker container inspect \\ -f '{{ range .Mounts }}{{ .Type }} : {{ .Source }}:{{ .Destination }}{{ println }}{{ end }}' \\ log path [!TIP] how to redirect docker logs to a single file $ docker inspect --format='{{.LogPath}}' containername get full container ID $ docker inspect --format=\"{{.Id}}\" d40df87b2f87 d40df87b2f87261152d2541b870c6b801c031f8df969e4bd3e9b3c607e6c1698 check repo tag $ docker images -q -a | xargs docker inspect --format='{{.Id}}{{range $rt := .RepoTags}} {{$rt}} {{end}}' docker stats reference: Monitor the Resource Usage of Docker Containers See Memory and CPU Usage for All Your Docker Containers How to See Memory and CPU Usage for All Your Docker Containers (on CentOS 6) How to Monitor the Resource Usage of Docker Containers $ docker stats --format \"table {{.Name}}\\t{{.CPUPerc}}\\t{{.MemUsage}}\" # or show all $ docker ps -q | xargs docker stats --no-stream docker system df $ docker system df TYPE TOTAL ACTIVE SIZE RECLAIMABLE Images 5 1 9.81GB 8.384GB (85%) Containers 1 0 0B 0B Local Volumes 4449 4 172.2GB 156.7GB (90%) Build Cache 0 0 0B 0B events $ docker system events --since '24h' prune $ docker system prune --all WARNING! This will remove: - all stopped containers - all networks not used by at least one container - all dangling images - all build cache Are you sure you want to continue? [y/N] y # prune volume only $ docker system prune --volumes ps format $ docker ps -a --format 'CONTAINER ID : {{.ID}} | Name: {{.Names}} | Image: {{.Image}} | Ports: {{.Ports}}' id and command $ docker ps --no-trunc --format \"{{.ID}}: {{.Command}}\" id, image and commands $ docker ps --no-trunc --format \"{{.ID}}: {{.Command}}: {{.Image}}\" log path [!NOTE] how to redirect docker logs to a single file $ docker inspect --format='{{.LogPath}}' containername with table $ docker ps --format \"table {{.Image}}\\t{{.Names}}\\t{{.Ports}}\\t{{.Status}}\" Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/docker/dockerfile.html":{"url":"virtualization/docker/dockerfile.html","title":"dockerfile","keywords":"","body":" dockerfile build from cmd references: best practices for writing dockerfiles dockerfile references: JDK Script Friendly URLs ENV JAVA_PKG=https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.tar.gz \\ JAVA_HOME=/usr/java/jdk-17 RUN set -eux; \\ JAVA_SHA256=$(curl \"$JAVA_PKG\".sha256) ; \\ curl --output /tmp/jdk.tgz \"$JAVA_PKG\" && \\ echo \"$JAVA_SHA256 */tmp/jdk.tgz\" | sha256sum -c; \\ mkdir -p \"$JAVA_HOME\"; \\ tar --extract --file /tmp/jdk.tgz --directory \"$JAVA_HOME\" --strip-components 1 build from cmd $ docker build -t myimage:latest - Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/docker/tricky.html":{"url":"virtualization/docker/tricky.html","title":"tricky","keywords":"","body":" docker with proxy docker pull docker build docker build with GPG key proxy docker for osx docker: command cannot be found command-line auto completion Linux osx others complete alias get tags from artifactory from docker hub run inside windows docker image add contents get contents list item execute docker with proxy docker pull $ sudo mkdir -p /etc/systemd/system/docker.service.d $ cat /etc/systemd/system/docker.service.d/http-proxy.conf [Service] Environment=\"HTTPS_PROXY=http://sample.proxy.com:80\" Environment=\"HTTP_PROXY=http://sample.proxy.com:80\" Environment=\"ALL_PROXY=http://sample.proxy.com:80\" systemctl daemon-reload;systemctl start docker $ sudo systemctl daemon-reload $ sudo systemctl restart docker # verify $ systemctl show docker --property Environment Environment=HTTPS_PROXY=http://sample.proxy.com:80 HTTP_PROXY=http://sample.proxy.com:80 ALL_PROXY=http://sample.proxy.com:80 for socks5 $ [ ! -d /etc/systemd/system/docker.service.d ] && sudo mkdir -p /etc/systemd/system/docker.service.d $ sudo bash -c \"cat > /etc/systemd/system/docker.service.d/socks5-proxy.conf\" or # for rootless mode $ mkdir -p ~/.config/systemd/user/docker.service.d/ # or regular mode $ sudo mkdir -p /etc/systemd/system/docker.service.d $ sudo bash -c \"cat > /etc/systemd/system/docker.service.d\" docker build $ mkdir -p ~/.docker $ cat > ~/.docker/config.json or via --build-arg: $ docker build \\ --build-arg http_proxy=http://sample.proxy.com:80 \\ --build-arg https_proxy=http://sample.proxy.com:443 \\ . details | VARIABLE | DOCKERFILE EXAMPLE | DOCKER RUN EXAMPLE | |:-----------:|:-------------------------------------------------|----------------------------------------------------------------| | HTTP_PROXY | ENV HTTP_PROXY=\"http://sample.proxy.com:80\" | --env HTTP_PROXY=\"http://sample.proxy.com:80\" | | HTTPS_PROXY | ENV HTTPS_PROXY=\"https://sample.proxy.com:80\" | --env HTTPS_PROXY=\"https://sample.proxy.com:80\" | | FTP_PROXY | ENV FTP_PROXY=\"ftp://sample.proxy.com:80\" | --env FTP_PROXY=\"ftp://sample.proxy.com:80\" | | NO_PROXY | ENV NO_PROXY=\".sample.domain1.com,.domain2.com\" | --env NO_PROXY=\".sample.domain1.com,.domain2.com,127.0.0.0/8\" | docker build with GPG key proxy without proxy ... gpg --batch \\ --keyserver https://keyserver.ubuntu.com:80 \\ --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831E ... # result gpg: keyserver receive failed: Connection timed out GPG with proxy ... apt-key adv --keyserver-options http-proxy=http://sample.proxy.com:80 \\ --keyserver hkp://keyserver.ubuntu.com:80 \\ --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF \\ ... # result Executing: /tmp/apt-key-gpghome.uegAG54mKu/gpg.1.sh --keyserver-options http-proxy=http://sample.proxy.com:80 --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF gpg: key A6A19B38D3D831EF: 2 signatures not checked due to missing keys gpg: key A6A19B38D3D831EF: public key \"Xamarin Public Jenkins (auto-signing) \" imported gpg: Total number processed: 1 gpg: imported: 1 gpg: keybox '/tmp/tmp.jad0qVCQ6v/pubring.kbx' created gpg: WARNING: nothing exported Warning: apt-key output should not be parsed (stdout is not a terminal) docker for osx [!TIP|label:references:] #6793: Docker not found when freshly installed on Mac Installing symlinks docker: command cannot be found using user $ export $HOME/.docker/bin:$PATH using system $ ln -sf $HOME/.docker/bin/docker /usr/local/bin/docker # or $ ln -s /Applications/Docker.app/Contents/Resources/bin/docker /usr/local/bin/docker $ sudo ln -s -f $HOME/.docker/run/docker.sock /var/run/docker.sock modify ~/.docker/config.json if necessary{ \"auths\": {}, - \"credsStore\": \"desktop\", + \"credStore\": \"desktop\", \"currentContext\": \"desktop-linux\" } command-line auto completion [!TIP] reference: Enable Docker command-line auto completion in bash on Centos/Ubuntu completion/bash/docker Perform tab-completion for aliases in Bash Linux $ dpkg -L docker-ce-cli | grep completion /usr/share/bash-completion /usr/share/bash-completion/completions /usr/share/bash-completion/completions/docker /usr/share/fish/vendor_completions.d /usr/share/fish/vendor_completions.d/docker.fish /usr/share/zsh/vendor-completions /usr/share/zsh/vendor-completions/_docker rpm$ rpm -ql docker-ce | grep completion /usr/share/bash-completion/completions/docker /usr/share/fish/vendor_completions.d/docker.fish /usr/share/zsh/vendor-completions/_docker setup in bashrc source /usr/share/bash-completion/completions/docker alias d='docker' alias dp='docker ps' while read -r _i; do complete -F _docker \"${_i}\" done more info$ source /usr/share/bash-completion/completions/docker $ type _docker | head _docker is a function _docker () { local previous_extglob_setting=$(shopt -p extglob); shopt -s extglob; } osx $ la '/Applications/Docker.app/Contents/Resources/etc' total 332K -rwxr-xr-x 1 marslo admin 124K Nov 9 21:50 docker.zsh-completion -rwxr-xr-x 1 marslo admin 51K Nov 9 21:50 docker.fish-completion -rwxr-xr-x 1 marslo admin 114K Nov 9 21:50 docker.bash-completion -rw-r--r-- 1 marslo admin 18K Nov 9 21:50 docker-compose.zsh-completion -rw-r--r-- 1 marslo admin 1.7K Nov 9 21:50 docker-compose.fish-completion -rwxr-xr-x 1 marslo admin 13K Nov 9 21:50 docker-compose.bash-completion $ ln -sf '/Applications/Docker.app/Contents/Resources/etc/docker.bash-completion' $(brew --prefix)/etc/bash_completion.d/docker $ ln -sf '/Applications/Docker.app/Contents/Resources/etc/docker-compose.bash-completion' $(brew --prefix)/etc/bash_completion.d/docker-compose setup in bashrc dockerComp=\"$(brew --prefix)/etc/bash_completion.d/docker\" dockerComposeComp=\"$(brew --prefix)/etc/bash_completion.d/docker-compose\" [ -f \"${dockerComp}\" ] && source \"${dockerComp}\" [ -f \"${dockerComposeComp}\" ] && source \"${dockerComposeComp}\" alias d='docker' alias dp='docker ps' alias dls='docker ps -l -q' alias dps='docker ps -l -a' alias di='docker images' alias dip=\"docker inspect --format '{{ .NetworkSettings.IPAddress }}'\" while read -r _i; do complete -F _docker \"${_i}\" done others _completion_loader_completion_loader() { . \"/etc/bash_completion.d/$1.sh\" >/dev/null 2>&1 && return 124 } complete -D -F _completion_loader complete alias # for Linux $ sudo curl -sSLg https://raw.githubusercontent.com/cykerway/complete-alias/master/complete_alias \\ -o /etc/bash_completion.d/complete_alias # for osx $ sudo curl -sSLg https://raw.githubusercontent.com/cykerway/complete-alias/master/complete_alias \\ -o $(brew --prefix)/etc/bash_completion.d/complete_alias setup in bash source /etc/bash_completion.d/complete_alias # source $(brew --prefix)/etc/bash_completion.d/complete_alias while read -r _i; do complete -F _complete_alias \"${_i}\" done get tags from artifactory list repos example: the docker registry in artifactory named docker $ curl -sS https://my.artifactory.com/v2/docker/_catalog | jq -r .repositories[] or $ curl -sS -X GET https://my.artifactory.com/artifactory/api/docker/docker/v2/_catalog | jq -r .repositories[] list tags example: get tags from repo devops/ubuntu $ curl -sS https://my.artifactory.com/artifactory/v2/docker/devops/ubuntu/tags/list [ | jq -r .tags[] ] or$ curl -sS -X GET https://my.artifactory.com/artifactory/api/docker/docker/v2/devops/ubuntu/tags/list from docker hub $ curl -sS 'https://hub.docker.com/v2/repositories/jenkins/jenkins/tags' | jq --raw-output .results[].name jdk8-openj9-windowsservercore-1809 jdk11-hotspot-windowsservercore-1809 jdk11-openj9-windowsservercore-1809 windowsservercore-1809 jdk8-hotspot-windowsservercore-1809 2.249.3-lts-centos7 lts-centos7 centos7 2.249.3-lts-centos lts-centos get more$ curl -sS 'https://hub.docker.com/v2/repositories/jenkins/jenkins/tags?page_size=100&ordering=last_updated' | jq --raw-output .results[].name | sort or$ curl -sS https://hub.docker.com/v2/repositories/jenkins/jenkins/tags?page=2 | jq '.\"results\"[][\"name\"]' | sort simple script for get tags #!/bin/sh # # Simple script that will display docker repository tags. # # Usage: # $ docker-show-repo-tags.sh ubuntu centos for _r in $* ; do curl -sS \"https://registry.hub.docker.com/v2/repositories/library/$_r/tags/\" | sed -e 's/,/,\\n/g' -e 's/\\[/\\[\\n/g' | grep '\"name\"' | awk -F\\\" '{print $4;}' | sort -fu | sed -e \"s/^/${_r}:/\" done get current container ID $ basename $(cat /proc/self/cpuset) ab8c1732f1a3fdb46b9f9a477f0fbcc1d23c6787d7532648242a76d6eb1e8b84 or$ hostname ab8c1732f1a3 get volume from container ID $ docker inspect -f '{{ .Mounts }}' or $ docker inspect | grep volume or get all $ docker ps -a --no-trunc --format \"{{.ID}}\\t{{.Names}}\\t{{.Mounts}}\" or$ docker inspect | jq --raw-output .[].Mounts or $ docker ps -q | xargs docker container inspect -f '{{ .Name }} {{ .HostConfig.Binds }}' mount volume in DinD reference: Mounting Volumes in Sibling Containers with Gitlab CI Mount volumes from container (--volumes-from) Kubernetes emptyDir is not the same as Docker's volumes-from $ cid=$(basename $(cat /proc/self/cpuset)) $ VOLUME_OPTION=\"--volumes-from ${cid}:rw\" $ docker run ${VOLUME_OPTION} run inside windows docker image add contents > docker exec [-w 'C:\\workspace'] powershell \"Set-Content -Path '_cmd.ps1' -Value 'python --version'\" for multiple line contents> docker exec [-w 'C:\\workspace'] ' powershell \"Set-Content -Path .\\test.py -Value '# content of test_sample.py >> def func(x): >> return x + 1 >> >> >> def test_answer(): >> assert func(4) == 5'\" get contents > docker exec [-w 'C:\\workspace'] powershell \"Get-Content '_cmd.ps1'\" equivalent tail -f > docker exec [-w 'C:\\workspace'] powershell \"Get-Content '_cmd.ps1' -Wait\" equivalent tail -10 > docker exec [-w 'C:\\workspace'] powershell \"Get-Content '_cmd.ps1' -Tail 10\" list item > docker exec [-w 'C:\\workspace'] powershell Get-ChildItem . > docker exec [-w 'C:\\workspace'] powershell Get-ChildItem ..\\ execute > docker exec [-w 'C:\\workspace'] powershell .\\_cmd.ps1 # or > docker exec [-w 'C:\\workspace'] powershell \"Invoke-Expression '.\\_cmd.ps1' > log.txt\" # or redirect via `Out-File` > docker exec [-w 'C:\\workspace'] powershell \"Invoke-Expression '.\\_cmd.ps1' | Out-File -FilePath log.txt\" Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:07:27 "},"virtualization/docker/windows.html":{"url":"virtualization/docker/windows.html","title":"windows","keywords":"","body":" docker-ee install upgrade uninstall remote access exec commands tricky running linux container in windows server FIPS 140-2 cryptographic module support manual install docker-ee DockerMsftIndex.json dockerfile Hyper-V install Windows Docker Container Hyper-V Isolation create a virtual machine with powershell by Hyper-V troubleshooting could not read CA certificate references: Support policy for Windows Server containers in on-premises scenarios Windows container requirements Install Docker in Windows Server 2019 Docker PowerShell Scripts for Local Development * docker-restart-attempt.ps1 docker-cloud-config-start.ps1 run-prep.ps1 docker-mysql-start.ps1 docker-rabbitmq-start.ps1 docker-redis-start.ps1 eureka-start.ps1 eureka-wait.ps1 zz_docker_install.ps1 * Remote Management of a Windows Docker Host * slonopotamus/stevedore docker-ee [!WARNING] OneGet/MicrosoftDockerProvider #65: [PROXY] Cannot find path 'C:[..]\\DockerMsftProvider\\DockerDefault_DockerSearchIndex.json' because it does not exist. Important Update – Deprecation of Docker Virtual Machine Images Extended to 30 April 2023 IMPORTANT - THIS PROVIDER IS NOW DEPRECATED As of May 23rd 2023 the backing service for this provider has been shutdown. You can find alternative options at Windows Container Documentation - Setup Environment. For more information on the deprecation please see the following blog posts: Updates to the Windows Container Runtime support Reminder - Updates to Windows Container Runtime Support install [!NOTE] references: * Install Docker Engine - Enterprise on Windows Servers Docker-EE installtion in windows server Get started: Prep Windows for containers Install Docker Enterprise Edition for Windows Server basic settings: Docker Linux Container running on Windows Server 2019 Use a script to install docker-ee Remote Management of a Windows Docker Host * Windows Server 2019 - Docker Daemon Downloading Docker Manually * iMarslo : powershell modules Index of win/static/stable/x86_64/ microsoft/Windows-Containers install-docker-ce.ps1 * package/DockerMsftProvider Difference between Docker from DockerProvider and DockerMsftProvider DockerProvider DockerMsftProvider * Docker Engine on Windows Docker Enterprise Documentation * How to install Docker on Windows 10 without Hyper-V # optioinal: https://github.com/OneGet/MicrosoftDockerProvider/issues/65#issuecomment-734284852 > [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 > Install-PackageProvider -Name NuGet > Install-Module DockerMsftProvider -Force > Install-Package Docker -ProviderName DockerMsftProvider -Force # or > Install-Module -Name DockerMsftProvider -Repository PSGallery -Force > Install-Package -Name docker -ProviderName DockerMsftProvider > Restart-Computer -Force # or > Install-Module DockerMsftProvider -Force > Install-Package Docker -ProviderName DockerMsftProvider -Force > Restart-Computer install specific docker version > Install-Package -Name docker -ProviderName DockerMsftProvider -Force -RequiredVersion 17.06.2-ee-5 check > Get-Package -Name Docker -ProviderName DockerMsftProvider Name Version Source ProviderName ---- ------- ------ ------------ docker 19.03.5 DockerDefault DockerMsftProvider > Find-Package -Name Docker -ProviderName DockerMsftProvider Name Version Source Summary ---- ------- ------ ------- Docker 20.10.9 DockerDefault Contains docker-ee for use with Windows Server. find package vis proxy > Find-Package -Name docker -ProviderName DockerMsftProvider -Proxy http://squid.tls.renault.fr:911 -Verbose VERBOSE: Using the provider 'DockerMsftProvider' for searching packages. VERBOSE: Download size: 0.02MB VERBOSE: Free space on the drive: 199788.78MB VERBOSE: Downloading https://dockermsft.blob.core.windows.net/dockercontainer/DockerMsftIndex.json to C:\\Users\\Administrator\\AppData\\Local\\Temp\\DockerMsftProvider\\DockerDefault_DockerSearchIndex.json VERBOSE: About to download VERBOSE: Finished downloading VERBOSE: Downloaded in 0 hours, 0 minutes, 0 seconds. Name Version Source Summary ---- ------- ------ ------- Docker 19.03.1 DockerDefault Contains Docker EE for use with Windows Server. check module and resource > Get-PackageSource -ProviderName DockerMsftProvider Name ProviderName IsTrusted Location ---- ------------ --------- -------- DockerDefault DockerMsftPro... False https://go.microsoft.com/fwlink/?LinkID=825636&clcid=0x409 > Get-Package -Name Docker -ProviderName DockerMsftProvider Name Version Source ProviderName ---- ------- ------ ------------ docker 20.10.9 DockerDefault DockerMsftProvider # info: C:\\Program Files\\WindowsPowerShell\\Modules\\DockerMsftProvider\\1.0.0.8 > Get-InstalledModule -Name \"DockerMsftProvider\" Version Name Repository Description ------- ---- ---------- ----------- 1.0.0.8 DockerMsftProvider PSGallery PowerShell module with commands fo... update DockerMsftProvider > Update-Module DockerMsftProvider upgrade to latest version > Install-Package -Name Docker -ProviderName DockerMsftProvider -Update -Force Name Version Source Summary ---- ------- ------ ------- Docker 20.10.9 DockerDefault Contains Docker EE for use with Windows Server. > Get-Package -Name Docker -ProviderName DockerMsftProvider Name Version Source ProviderName ---- ------- ------ ------------ docker 20.10.9 DockerDefault DockerMsftProvider > docker --version Docker version 20.10.9, build 591094d > Start-Service Docker or to particular version > Install-Package -Name docker -ProviderName DockerMsftProvider -RequiredVersion 18.09 -Update -Force uninstall # clean docker images and processes > docker swarm leave --force > docker rm -f $(docker ps --all --quiet) > docker system prune --all --volumes # uninstall > Uninstall-Package -Name docker -ProviderName DockerMsftProvider > Uninstall-Module -Name DockerMsftProvider # clean up the network and filesystem > Get-HNSNetwork | Remove-HNSNetwork > Remove-Item -Path \"C:\\ProgramData\\Docker\" -Recurse -Force # get package via > Get-PackageProvider -Name *Docker* Clean up Docker data and system components > Get-HNSNetwork | Remove-HNSNetwork > Get-ContainerNetwork | Remove-ContainerNetwork > Remove-Item \"C:\\ProgramData\\Docker\" -Recurse # close Hyper-V > Remove-WindowsFeature Containers > Remove-WindowsFeature Hyper-V # reboot > Restart-Computer -Force download docker manually [!NOTE] OneGet/MicrosoftDockerProvider Install Package Docker - Windows Server 2022 error Using a script to install Docker EE configure-docker-daemon.md # On an online machine, download the zip file. > Invoke-WebRequest -UseBasicParsing -OutFile docker-19.03.3.zip https://download.docker.com/components/engine/windows-server/19.03/docker-19.03.3.zip # Stop Docker service if eralier version of Docker is already installed > Stop-Service docker # Extract the archive. > Expand-Archive docker-19.03.3.zip -DestinationPath $Env:ProgramFiles -Force # Clean up the zip file. > Remove-Item -Force docker-19.03.3.zip # Install Docker. This requires rebooting. > $null = Install-WindowsFeature containers > Restart-Computer -Force # Add Docker to the path for the current session. > $env:path += ';$env:ProgramFiles\\docker' # Optionally, modify PATH to persist across sessions. > $newPath = '$env:ProgramFiles\\docker;' + [Environment]::GetEnvironmentVariable('PATH', [EnvironmentVariableTarget]::Machine) [Environment]::SetEnvironmentVariable('PATH', $newPath, [EnvironmentVariableTarget]::Machine) # Register the Docker daemon as a service. > dockerd --register-service # Start the Docker service. > Start-Service docker # verify > docker pull hello-world:nanoserver > docker images > docker container run hello-world:nanoserver pull and run windows image > docker pull mcr.microsoft.com/dotnet/samples:dotnetapp-nanoserver-2009 > docker run mcr.microsoft.com/dotnet/samples:dotnetapp-nanoserver-2009 # or > docker pull mcr.microsoft.com/windows/servercore:ltsc2019 # inspired from http://man.hubwiz.com/docset/Docker.docset/Contents/Resources/Documents/docs.docker.com/install/windows/docker-ee.html # On an online machine, download the zip file. Invoke-WebRequest -UseBasicParsing -OutFile docker-18.09.5.zip https://download.docker.com/components/engine/windows-server/18.09/docker-18.09.5.zip # Stop Docker service Stop-Service docker # Extract the archive. Expand-Archive docker-18.09.5.zip -DestinationPath $Env:ProgramFiles -Force # Clean up the zip file. Remove-Item -Force docker-18.09.5.zip # Install Docker. This requires rebooting. $null = Install-WindowsFeature containers # Add Docker to the path for the current session. $env:path += \";$env:ProgramFiles\\docker\" # Optionally, modify PATH to persist across sessions. $newPath = \"$env:ProgramFiles\\docker;\" + [Environment]::GetEnvironmentVariable(\"PATH\", [EnvironmentVariableTarget]::Machine) [Environment]::SetEnvironmentVariable(\"PATH\", $newPath, [EnvironmentVariableTarget]::Machine) # Register the Docker daemon as a service. dockerd --register-service # Start the Docker service. Start-Service docker check [!NOTE] imarslo: stop service & process via powershell powershell : Get-Service > Get-Process dockerd Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName ------- ------ ----- ----- ------ -- -- ----------- 449 28 138348 45356 4.31 16192 0 dockerd > Get-NetTCPConnection -LocalPort 2376 LocalAddress LocalPort RemoteAddress RemotePort State AppliedSetting ------------ --------- ------------- ---------- ----- -------------- :: 2376 :: 0 Listen # or > Get-NetTCPConnection -LocalPort 2376 -State Listen -ErrorVariable $err -ErrorAction SilentlyContinue > Get-Service Docker Status Name DisplayName ------ ---- ----------- Running Docker Docker Engine install a specific version > Install-Package -Name docker -ProviderName DockerMsftProvider -Force -RequiredVersion 18.09 ... Name Version Source Summary ---- ------- ------ ------- Docker 18.09 Docker Contains Docker Engine - Enterprise for use with Windows Server... upgrade > Install-Package -Name docker -ProviderName DockerMsftProvider -RequiredVersion 18.09 -Update -Force # update module > Update-Module DockerMsftProvider uninstall # Leave any active Docker Swarm > docker swarm leave --force # Remove all running and stopped containers > docker rm -f $(docker ps --all --quiet) # Prune container data > docker system prune --all --volumes # Uninstall Docker PowerShell Package and Module > Uninstall-Package -Name docker -ProviderName DockerMsftProvider > Uninstall-Module -Name DockerMsftProvider # Clean up Windows Networking and file system > Get-HNSNetwork | Remove-HNSNetwork > Remove-Item -Path \"C:\\ProgramData\\Docker\" -Recurse -Force remote access via daemon.json > $configfile = @\" { \"tls\": false, \"hosts\": [\"tcp://0.0.0.0:2376\", \"npipe://\"], \"debug\": true, \"data-root\": \"E:\\\\docker_home\", \"storage-opts\": [] } \"@ > $configfile | Out-File -FilePath C:\\ProgramData\\docker\\config\\daemon.json -Encoding ascii -Force > Start-Service Docker # or > Restart-Service Docker verify > docker info ... Docker Root Dir: E:\\docker_home ... WARNING: API is accessible on http://0.0.0.0:2376 without encryption. Access to the remote API is equivalent to root access on the host. Refer to the 'Docker daemon attack surface' section in the documentation for more information: https://docs.docker.com/go/attack-surface/ > docker -H tcp://localhost:2376 images REPOSITORY TAG IMAGE ID CREATED SIZE hello-world nanoserver e33d37034c87 33 hours ago 258MB via SSL allow inbound connections > New-NetFirewallRule -DisplayName 'Docker SSL Inbound' -Profile @('Domain', 'Public', 'Private') -Direction Inbound -Action Allow -Protocol TCP -LocalPort 2376 copy the files ca.pem, cert.pem and key.pem from your user's docker folder on your machine e.g. c:\\users\\chris\\.docker to you local machine. confirm connection > docker -D -H tcp://wsdockerhost.southcentralus.cloudapp.azure.com:2376 \\ --tlsverify --tlscacert=c:\\users\\foo\\.docker\\client\\ca.pem \\ --tlscert=c:\\users\\foo\\.docker\\client\\cert.pem \\ --tlskey=c:\\users\\foo\\.docker\\client\\key.pem \\ ps tips disable tls in c\\programdata\\docker\\config\\daemon.json{ \"tlsverify\": false, } connect via> docker -H tcp://wsdockerhost.southcentralus.cloudapp.azure.com:2376 \\ --tlsverify=0 \\ version exec commands [!NOTE|label:references:] container on windows Container Base Images windows server windows nano server windows server core > docker exec a8 powershell -c \"Get-CimInstance Win32_Process | Select-Object ProcessId, CommandLine\" image discovery > docker pull mcr.microsoft.com/windows/servercore:ltsc2022 Base images for Windows Insiders mcr.microsoft.com/windows/servercore/insider mcr.microsoft.com/windows/nanoserver/insider mcr.microsoft.com/windows/server/insider:10.0.20344.1 mcr.microsoft.com/windows/insider [!TIP] Windows Server Core vs Nanoserver Windows Server Core and Nanoserver are the most common base images to target. The key difference between these images is that Nanoserver has a significantly smaller API surface. PowerShell, WMI, and the Windows servicing stack are absent from the Nanoserver image. .NET Core Nano Server Dockerfile tricky running linux container in windows server [!NOTE] Linux containers on Windows 10 by enable experimental features in docker daemon.conf Set LCOW_SUPPORTED Variable to 1 for enabled > [Environment]::SetEnvironmentVariable(“LCOW_SUPPORTED”, “1”, “Machine”) enable experimental features in docker daemon.conf > $configfile = @\" { \"experimental\": true } \"@ > $configfile | Out-File -FilePath C:\\ProgramData\\docker\\config\\daemon.json -Encoding ascii -Force deploy LCOW for it to run > Invoke-WebRequest -Uri “https://github.com/linuxkit/lcow/releases/download/v4.14.35-v0.3.9/release.zip&#8221; -UseBasicParsing -OutFile release.zip > Expand-Archive release.zip -DestinationPath “$Env:ProgramFiles\\Linux Containers\\.” make Linux containers the Default > [Environment]::SetEnvironmentVariable(“LCOW_API_PLATFORM_IF_OMITTED”, “linux”, “Machine”) by pre build docker-ee uninstall current docker-ee > Uninstall-Package -Name docker -ProviderName DockerMSFTProvider enable Nested Virtualization by using Linux Virtual Machine running on Hyper-V. > Get-VM WinContainerHost | Set-VMProcessor -ExposeVirtualizationExtensions $true install pre build docker-ee > Install-Module DockerProvider > Install-Package Docker -ProviderName DockerProvider -RequiredVersion preview Enable LinuxKit system for running Linux containers > [Environment]::SetEnvironmentVariable(\"LCOW_SUPPORTED\", \"1\", \"Machine\") to Switch back to running Windows containers> [Environment]::SetEnvironmentVariable(\"LCOW_SUPPORTED\", \"$null\", \"Machine\") restart docker service > Restart-Service docker check > docker run -it --rm ubuntu /bin/bash FIPS 140-2 cryptographic module support > [System.Environment]::SetEnvironmentVariable(\"DOCKER_FIPS\", \"1\", \"Machine\") # regedit > Set-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\Lsa\\FipsAlgorithmPolicy\\\" -Name \"Enabled\" -Value \"1\" > net stop docker > net start docker # check > docker info ... Labels: com.docker.security.fips=enabled ... manual install docker-ee [!NOTE] manual install docker-ee #2496: Documentation on how to install Docker engine offline How to Install Docker EE on Windows Server 2016 | Offline Getting Started with Windows Containers Windows Server 2019 - Docker Daemon download links index.json docker-17.06.2-ee-7.zip docker-17-06-2-ee-13.zip docker-17.03.0-ee.zip docker-18.09.5.zip docker-19.03.3.zip docker-19.03.5.zip choco: Docker Engine 20.10.9 docker-1-12-2-cs2-ws-beta.zip * choco: docker engine version history install_docker_msft.ps1 install_docker_windows_server.ps1 Install Docker Engine - Enterprise on Windows Servers download archive # On an online machine, download the zip file. Invoke-WebRequest -UseBasicParsing -OutFile docker-19.03.3.zip https://download.docker.com/components/engine/windows-server/19.03/docker-19.03.3.zip install # Stop Docker service if eralier version of Docker is already installed > Stop-Service docker # Extract the archive. > Expand-Archive docker-19.03.3.zip -DestinationPath $Env:ProgramFiles -Force # Clean up the zip file. > Remove-Item -Force docker-19.03.3.zip # Install Docker. This requires rebooting. > $null = Install-WindowsFeature containers > Restart-Computer -Force # Add Docker to the path for the current session. > $env:path += ';$env:ProgramFiles\\docker' # Optionally, modify PATH to persist across sessions. > $newPath = '$env:ProgramFiles\\docker;' + [Environment]::GetEnvironmentVariable('PATH', [EnvironmentVariableTarget]::Machine) [Environment]::SetEnvironmentVariable('PATH', $newPath, [EnvironmentVariableTarget]::Machine) # Register the Docker daemon as a service. > dockerd --register-service # Start the Docker service. > Start-Service docker another # download > Start-BitsTransfer -Source https://dockermsft.blob.core.windows.net/dockercontainer/docker-1-12-2-cs2-ws-beta.zip -Destination /docker.zip # get sha256 > Get-FileHash -Path /docker.zip -Algorithm SHA256 # install > cp .\\docker.zip C:\\Users\\Administrator\\AppData\\Local\\Temp\\DockerMsftProvider\\Docker-1-12-2-cs2-ws-beta.zip > cd C:\\Users\\Administrator\\AppData\\Local\\Temp\\DockerMsftProvider\\ > Install-Package -Name docker -ProviderName DockerMsftProvider -Verbose # restart > Restart-Computer -Force or > $downloadURL = 'https://dockermsft.blob.core.windows.net/dockercontainer/docker-17-06-2-ee-13.zip' > $destination = 'C:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\2\\DockerMsftProvider\\Docker-17-06-2-ee-13.zip' > Invoke-WebRequest -Uri $downloadURL -OutFile $destination > Install-Package Docker -ProviderName DockerMsftProvider -RequiredVersion $RequiredVersion -Verbose install from private DockerMsftProvider $paths = $env:psmodulePath.Split(';') $modulePath = Join-Path $paths[0] \"DockerMsftProvider\" if (!(Test-Path $modulePath)) { New-Item -Path $modulePath -ItemType Directory } $outfile = Join-Path $modulePath 'DockerMsftProvider.psm1' Invoke-WebRequest -UseBasicParsing -OutFile $outfile -Uri https://raw.githubusercontent.com/ajkauffmann/MicrosoftDockerProvider/master/DockerMsftProvider.psm1 $outfile = Join-Path $modulePath 'DockerMsftProvider.psd1' Invoke-WebRequest -UseBasicParsing -OutFile $outfile https://raw.githubusercontent.com/ajkauffmann/MicrosoftDockerProvider/master/DockerMsftProvider.psd1 Install-Package Docker -ProviderName DockerMsftProvider -Force DockerMsftIndex.json [!NOTE] Server 2016 Docker Install SHA256 verify failed. Deleting file > Invoke-WebRequest -Uri \"https://dockermsft.azureedge.net/dockercontainer/DockerMsftIndex.json\" ` -OutFile $env:USERPROFILE\\AppData\\Local\\Temp\\DockerMsftProvider\\DockerDefault_DockerSearchIndex.json # mark to read-only (Get-Item $env:USERPROFILE\\AppData\\Local\\Temp\\DockerMsftProvider\\DockerDefault_DockerSearchIndex.json).Attributes = [IO.FileAttributes]::ReadOnly dockerfile [!NOTE|label:references:] How to get docker inside docker working in Windows Base Image MicrosoftDocs/Virtualization-Documentation Docker Engine on Windows Dockerfile on Windows Optimize Windows Dockerfiles * Dockerfile on Windows Optimize Windows Dockerfiles Use containers with the Windows Insider program Manage Container images on Windows Admin Center sample # Sample Dockerfile # Indicates that the windowsservercore image will be used as the base image. FROM mcr.microsoft.com/windows/servercore:ltsc2019 # Metadata indicating an image maintainer. LABEL maintainer=\"jshelton@contoso.com\" # Uses dism.exe to install the IIS role. RUN dism.exe /online /enable-feature /all /featurename:iis-webserver /NoRestart # Creates an HTML file and adds content to this file. RUN echo \"Hello World - Dockerfile\" > c:\\inetpub\\wwwroot\\index.html # Sets a command or process that will run each time a container is run from the new image. CMD [ \"cmd\" ] sample FROM mcr.microsoft.com/dotnet/framework/sdk:4.8-windowsservercore-ltsc2019 RUN Install-PackageProvider NuGet -Force RUN Install-Module -Name DockerMsftProvider -Repository PSGallery -Force RUN Import-Packageprovider -Name DockerMsftProvider -Force RUN Find-Package -ProviderName DockerMsftProvider | Install-Package -Verbose -Force; exit 0 RUN Find-Package -ProviderName DockerMsftProvider | Install-Package -Verbose -Force or FROM mcr.microsoft.com/windows/servercore:ltsc2019 USER ContainerAdministrator SHELL [\"powershell\", \"-command\"] RUN Set-ExecutionPolicy -ExecutionPolicy RemoteSigned RUN [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12 RUN Install-PackageProvider -Name NuGet -Force RUN Install-Module -Name DockerMsftProvider -Force RUN Import-Module -Name DockerMsftProvider -Force RUN Import-Packageprovider -Name DockerMsftProvider -Force RUN Install-Package -Name docker -ProviderName DockerMsftProvider -Verbose -Update -Force Hyper-V [!TIP] * Hyper-V Technology Overview * Install the Hyper-V role on Windows Server * Docker Linux Container running on Windows Server 2019 System requirements for Hyper-V on Windows Server * Create Virtual Machine with Hyper-V on Windows 10 install in windows servers [!TIP] If you're connected locally to the server, run the command without -ComputerName . via commands> Install-WindowsFeature -Name Hyper-V [-ComputerName ] -IncludeManagementTools -Restart check> Get-WindowsFeature -ComputerName manually In Server Manager, on the Manage menu, click Add Roles and Features. On the Before you begin page, verify that your destination server and network environment are prepared for the role and feature you want to install. Click Next. On the Select installation type page, select Role-based or feature-based installation and then click Next. On the Select destination server page, select a server from the server pool and then click Next. On the Select server roles page, select Hyper-V. To add the tools that you use to create and manage virtual machines, click Add Features. On the Features page, click Next. On the Create Virtual Switches page, Virtual Machine Migration page, and Default Stores page, select the appropriate options. On the Confirm installation selections page, select Restart the destination server automatically if required, and then click Install. When installation is finished, verify that Hyper-V installed correctly. Open the All Servers page in Server Manager and select a server on which you installed Hyper-V. Check the Roles and Features tile on the page for the selected server. in windows 10 [!NOTE] references: Enable-WindowsOptionalFeature Hyper-V on Windows 10 Install Hyper-V on Windows 10 Create Virtual Machine with Hyper-V on Windows 10 Create a Virtual Machine with Hyper-V on Windows 10 Creators Update Remotely manage Hyper-V) DISM Technical Reference via powershell > Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All check> Get-WindowsOptionalFeature -Online [| Where-Object {$_.State -eq \"Enabled\"}] [| format-table] via cmd and dism > DISM /Online /Enable-Feature /All /FeatureName:Microsoft-Hyper-V via manually win -> Apps and Features select Programs and Features select Turn Windows Features on or off Select Hyper-V and click OK others shortcut located in : shell:Common Administrative Tools ( C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Administrative Tools ) Hyper-V Quick Create : %ProgramFiles%\\Hyper-V\\VMCreate.exe Hyper-V Manager : %windir%\\System32\\mmc.exe \"%windir%\\System32\\virtmgmt.msc\" Windows Docker Container Hyper-V Isolation > docker run -it --isolation=hyperv mcr.microsoft.com/windows/servercore:ltsc2019 # check > get-process -Name vmwp create a virtual machine with powershell by Hyper-V # Set VM Name, Switch Name, and Installation Media Path. $VMName = 'TESTVM' $Switch = 'External VM Switch' $InstallMedia = 'C:\\Users\\Administrator\\Desktop\\en_windows_10_enterprise_x64_dvd_6851151.iso' # Create New Virtual Machine New-VM -Name $VMName -MemoryStartupBytes 2147483648 -Generation 2 -NewVHDPath \"D:\\Virtual Machines\\$VMName\\$VMName.vhdx\" -NewVHDSizeBytes 53687091200 -Path \"D:\\Virtual Machines\\$VMName\" -SwitchName $Switch # Add DVD Drive to Virtual Machine Add-VMScsiController -VMName $VMName Add-VMDvdDrive -VMName $VMName -ControllerNumber 1 -ControllerLocation 0 -Path $InstallMedia # Mount Installation Media $DVDDrive = Get-VMDvdDrive -VMName $VMName # Configure Virtual Machine to Boot from DVD Set-VMFirmware -VMName $VMName -FirstBootDevice $DVDDrive troubleshooting [!NOTE] Troubleshoot Visual Studio development with Docker Docker users group Container Tools error messages microsoft/DockerTools Overview of Docker remote development on Windows could not read CA certificate solution [Environment]::SetEnvironmentVariable(\"DOCKER_CERT_PATH\", $null, \"User\") [Environment]::SetEnvironmentVariable(\"DOCKER_HOST\", $null, \"User\") [Environment]::SetEnvironmentVariable(\"DOCKER_MACHINE_NAME\", $null, \"User\") [Environment]::SetEnvironmentVariable(\"DOCKER_TLS_VERIFY\", $null, \"User\") [Environment]::SetEnvironmentVariable(\"DOCKER_TOOLBOX_INSTALL_PATH\", $null, \"User\") or SET DOCKER_CERT_PATH= $null, \"User\" SET DOCKER_HOST= $null, \"User\" SET DOCKER_MACHINE_NAME= $null, \"User\" SET DOCKER_TLS_VERIFY= $null, \"User\" SET DOCKER_TOOLBOX_INSTALL_PATH= $null, \"User\" Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"virtualization/podman/podman.html":{"url":"virtualization/podman/podman.html","title":"podman","keywords":"","body":" configure files rootless mode enable rootless_storage_path enable kernel.unprivileged_userns_clone setup subuid and subgid propagate changes to subuid and subgid Q&A error creating tmpdir: mkdir /run/user/1001: permission denied add pause to process references: podman Podman Kubernetes 切换到 Containerd configure files ENVIRONMENT VARIABLES FILE NAME ROOTFUL ROOTLESS CONTAINERS_CONF mounts.conf /etc/containers/mounts.conf $HOME/.config/containers/mounts.conf - policy.json /etc/containers/policy.json - CONTAINERS_REGISTRIES_CONF registries.conf /etc/containers/registries.conf $HOME/.config/containers/registries.conf CONTAINERS_STORAGE_CONF storage.conf /etc/containers/storage.conf $HOME/.config/containers/storage.conf - containers.conf /usr/share/containers/containers.conf $HOME/.config/containers/containers.conf short-name-aliases.conf $ cat $HOME/.cache/containers/short-name-aliases.conf [aliases] \"jenkins/jenkins\" = \"docker.io/jenkins/jenkins\" storage.conf # original version $ cat /etc/containers/storage.conf | sed -e '/^#/ d' -e '/^$/ d' [storage] driver = \"overlay\" runroot = \"/run/containers/storage\" graphroot = \"/var/lib/containers/storage\" [storage.options] additionalimagestores = [ ] [storage.options.overlay] mountopt = \"nodev,metacopy=on\" [storage.options.thinpool] registries.conf $ cat /etc/containers/registries.conf | sed -e '/^#/ d' -e '/^$/ d' unqualified-search-registries = [\"registry.fedoraproject.org\", \"registry.access.redhat.com\", \"registry.centos.org\", \"docker.io\"] short-name-mode = \"permissive\" policy.json $ cat /etc/containers/policy.json { \"default\": [ { \"type\": \"insecureAcceptAnything\" } ], \"transports\": { \"docker\": { \"registry.access.redhat.com\": [ { \"type\": \"signedBy\", \"keyType\": \"GPGKeys\", \"keyPath\": \"/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release\" } ], \"registry.redhat.io\": [ { \"type\": \"signedBy\", \"keyType\": \"GPGKeys\", \"keyPath\": \"/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release\" } ] }, \"docker-daemon\": { \"\": [ { \"type\": \"insecureAcceptAnything\" } ] } } } rootless mode enable rootless_storage_path $ grep rootless_storage_path /etc/containers/storage.conf rootless_storage_path = \"$HOME/.local/share/containers/storage\" $ /usr/bin/podman system migrate or $ cat -n /etc/subgid 1 marslo:336370:65536 $ cat -n /etc/subuid 1 marslo:336370:65536 $ /usr/bin/podman system migrate enable kernel.unprivileged_userns_clone $ sysctl kernel.unprivileged_userns_clone setup subuid and subgid [!NOTE] Rootless mode Podman can also be used as non-root user. When podman runs in rootless mode, a user namespace is automatically created for the user, defined in /etc/subuid and /etc/subgid references: set subuid and subgid $ sudo usermod --add-subuids 10000-75535 USERNAME $ sudo usermod --add-subgids 10000-75535 USERNAME # or $ sudo usermod --add-subuids 100000-165535 --add-subgids 100000-165535 username # or $ echo USERNAME:10000:65536 >> /etc/subuid $ echo USERNAME:10000:65536 >> /etc/subgid propagate changes to subuid and subgid $ podman system migrate Q&A [!TIP] reference: podman : troubleshooting error creating tmpdir: mkdir /run/user/1001: permission denied issue $ podman info WARN[0000] Conmon at /usr/libexec/podman/conmon invalid: outdated conmon version Error: error creating tmpdir: mkdir /run/user/1001: permission denied solution [!INFO|label:references:] podman info, error creating tmpdir: mkdir /run/user/1007: permission denied loginctl enable-linger my_ci_user containers terminate on shell logout $ sudo loginctl enable-linger $(whoami) infomation check $ loginctl SESSION UID USER SEAT TTY 2 33637 marslo c1 42 gdm seat0 tty1 $ podman unshare cat /proc/self/uid_map WARN[0000] Conmon at /usr/libexec/podman/conmon invalid: outdated conmon version Error: error creating tmpdir: mkdir /run/user/1001: permission denie add pause to process $ sudo echo +cpu +cpuset +io +memory +pids > /sys/fs/cgroup/cgroup.subtree_control Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:26 "},"osx/osx.html":{"url":"osx/osx.html","title":"osx","keywords":"","body":" system info system setup hostname disable guest user enable root user system integrity protection disable/enable gatekeeper apps java xcode downlaod xcode by wget developer tools appendix accpet license from cmd commandline tools and compoents enable dev mode security backup security references: Mac keyboard shortcuts system info production version [!NOTE] issue in fetchScreen $ sw_vers ProductName : macOS ProductVersion : 11.1 BuildVersion : 20C69 or$ /usr/libexec/PlistBuddy -c \"Print:ProductName\" \\ -> -c \"Print:ProductVersion\" \\ -> -c \"Print:ProductBuildVersion\" /System/Library/CoreServices/SystemVersion.plist macOS 11.0.1 20B29 hardware $ /usr/sbin/system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Name: MacBook Pro Model Identifier: MacBookPro15,1 Processor Name: 6-Core Intel Core i7 Processor Speed: 2.2 GHz Number of Processors: 1 Total Number of Cores: 6 L2 Cache (per Core): 256 KB L3 Cache: 9 MB Hyper-Threading Technology: Enabled Memory: 16 GB Boot ROM Version: 1037.0.78.0.0 (iBridge: 17.16.10572.0.0,0) Serial Number (system): C02XFGWEJG5H Hardware UUID: 4EA008BF-9B36-5F1D-9151-AD4F64808AAB Activation Lock Status: Enabled $ system_profiler SPCameraDataType Camera: FaceTime HD Camera (Built-in): Model ID: UVC Camera VendorID_1452 ProductID_34068 Unique ID: 0x8020000005ac8514 grahics & display $ system_profiler SPDisplaysDataType Graphics/Displays: Intel UHD Graphics 630: Chipset Model: Intel UHD Graphics 630 Type: GPU Bus: Built-In VRAM (Dynamic, Max): 1536 MB Vendor: Intel Device ID: 0x3e** Revision ID: 0x00** Automatic Graphics Switching: Supported gMux Version: 5.0.0 Metal Family: Supported, Metal GPUFamily macOS 2 Displays: Color LCD: Display Type: Built-In Retina LCD Resolution: 3072 x 1920 Retina Framebuffer Depth: 24-Bit Color (ARGB8888) Main Display: Yes Mirror: Off Online: Yes Automatically Adjust Brightness: Yes Connection Type: Internal AMD Radeon Pro 5500M: Chipset Model: AMD Radeon Pro 5500M Type: GPU Bus: PCIe PCIe Lane Width: x8 VRAM (Total): 8 GB Vendor: AMD (0x1002) Device ID: 0x73** Revision ID: 0x00** ROM Revision: 113-******-*** VBIOS Version: 113-********-*** Option ROM Version: 113-********-*** EFI Driver Version: 01.A1.190 Automatic Graphics Switching: Supported gMux Version: 5.0.0 Metal Family: Supported, Metal GPUFamily macOS 2 cpu $ sysctl -n machdep.cpu.brand_string Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz or$ sysctl machdep.cpu machdep.cpu.max_basic: 22 machdep.cpu.max_ext: 2147483656 machdep.cpu.vendor: GenuineIntel machdep.cpu.brand_string: Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz machdep.cpu.family: 6 machdep.cpu.model: 158 machdep.cpu.extmodel: 9 ... system setup hostname $ HNAME='iMarsloPro' $ sudo scutil --set HostName \"${HNAME}\" $ sudo scutil --set LocalHostName \"${HNAME}\" # Optional $ sudo scutil --set ComputerName \"${HNAME}\" # Flush the DNS Cache $ dscacheutil -flushcache $ sudo shutdown -r now disable guest user $ sudo dscl . delete /Users/Guest $ sudo defaults write /Library/Preferences/com.apple.AppleFileServer guestAccess -bool NO $ sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server AllowGuestAccess -bool NO $ sudo defaults write /Library/Preferences/com.apple.loginwindow GuestEnabled -bool FALSE # remove Other $ sudo defaults write /Library/Preferences/com.apple.loginwindow SHOWOTHERUSERS_MANAGED -bool FALSE or $ sudo /usr/sbin/sysadminctl -deleteUse Guest check status $ sysadminctl -guestAccount status 2020-12-30 20:27:59.524 sysadminctl[45327:844298] Guest account disabled. $ sudo sysadminctl -guestAccount off 2020-12-30 20:28:39.645 sysadminctl[45479:846930] Guest account is already disabled list all accounts [!TIP] location of plists: /var/db/dslocal/nodes/Default/users $ dscl . list /Users # or $ dscl . -list /Users GeneratedUID or$ dscacheutil -q user create Guest and enable [!NOTE] scripts: https://github.com/sheagcraig/guestAccount/blob/master/guest_account $ dscl . -create /Users/Guest # keychain $ keychain='/Users/Guest/Library/Keychains/login.keychain' $ security create-keychain -p '' $keychain $ security login-keychain -s $keychain enable root user system integrity protection $ csrutil disable Successfully disabled System Integrity Protection. Please restart the machine for the changes to take effect. $ csrutil clear Successfully cleared System Integrity Proteciton. Please restart the machine for the changes to take effect. $ sudo chflags restricted /usr/local turn off the Rootless System Integrity Protection $ csrutil status System Integrity Protection status: enabled. $ sudo csrutil disable csrutil: failed to modify system integrity configuration. This tool needs to be executed from the Recovery OS reboot and command + r go to Utilities -> Terminal disable -bash-3.2# csrutil status System Integrity Protection status: enabled -bash-3.2# csrutil disable Successfully disabled System Integrity Protection. Please restart the machine for the changes to take effect. remove file lock (uchg) flag $ chflags -R nouchg * # or $ chflags -R nouchg example $ find /usr -flags +sunlnk -print /usr/libexec/cups find: /usr/sbin/authserver: Permission denied /usr/local /usr/share/man /usr/share/snmp $ /bin/ls -lO /usr total 0 drwxr-xr-x 976 root wheel restricted 31232 Oct 28 19:17 bin/ drwxr-xr-x 292 root wheel restricted 9344 Oct 28 10:04 lib/ drwxr-xr-x 234 root wheel restricted 7488 Oct 28 19:17 libexec/ drwxr-xr-x 16 root wheel sunlnk 512 Oct 28 19:26 local/ drwxr-xr-x 246 root wheel restricted 7872 Oct 28 09:55 sbin/ drwxr-xr-x 46 root wheel restricted 1472 Oct 28 09:55 share/ drwxr-xr-x 5 root wheel restricted 160 Oct 3 13:48 standalone/ $ csrutil status System Integrity Protection status: enabled. $ sudo csrutil disable csrutil: failed to modify system integrity configuration. This tool needs to be executed from the Recovery OS $ cat /System/Library/Sandbox/rootless.conf $ /bin/ls -lO /Applications | grep firefox 22:drwxr-xr-x 3 marslo staff - 96 Dec 7 03:14 Firefox.app $ sudo chflags restricted Firefox.app $ /bin/ls -lO /Applications | grep firefox drwxr-xr-x 3 marslo staff restricted 96 Dec 7 03:14 Firefox.app disable/enable gatekeeper disable $ sudo spctl --master-disable enable $ sudo spctl --master-enable check status $ spctl --status assessments disabled apps java setup java home$ /usr/libexec/java_home -v 1.8.0.162 -exec javac -versioin xcode downlaod xcode by wget get cookies.txt install google chrome extension from official website login developer.apple.com select cookies.txt and download get xcode download url and right click and select Copy Link Address: download xcode (inspired from here and here) $ wget --cookies=on \\ --load-cookies=cookies.txt \\ --keep-session-cookies \\ --save-cookies=cookies.txt \\ https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip exmaple $ wget --cookies=on \\ > --load-cookies=cookies.txt \\ > --keep-session-cookies \\ > --save-cookies=cookies.txt \\ > https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip --2019-10-15 07:55:18-- https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip Resolving download.developer.apple.com (download.developer.apple.com)... 17.253.17.207, 17.253.17.211 Connecting to download.developer.apple.com (download.developer.apple.com)|17.253.17.207|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 7805079698 (7.3G) [application/octet-stream] Saving to: ‘Xcode_11.2_beta_2.xip’ 100%[===========================================================================================================>] 7,805,079,698 112MB/s in 70s 2019-10-15 07:53:07 (106 MB/s) - ‘Xcode_11.2_beta_2.xip’ saved [7805079698/7805079698] $ ls -altrh Xcode_11.2_beta_2.xip -rw-rw-r-- 1 devops devops 7.3G Oct 9 13:27 Xcode_11.2_beta_2.xip developer tools [!NOTE] Install Ansible on Mac OSX $ pkgutil --pkg-info=com.apple.pkg.CLTools_Executables already installed$ pkgutil --pkg-info=com.apple.pkg.CLTools_Executables package-id: com.apple.pkg.CLTools_Executables version: 14.3.1.0.1.1683849156 volume: / location: / install-time: 1688011857 not been installed$ pkgutil --pkg-info=com.apple.pkg.CLTools_Executables No receipt for 'com.apple.pkg.CLTools_Executables' found at '/'. appendix xcode XCODE URL 12.3 beta https://download.developer.apple.com/Developer_Tools/Xcode_12.3_beta/Xcode_12.3_beta.xip 12.2 https://download.developer.apple.com/Developer_Tools/Xcode_12.2/Xcode_12.2.xip 12.2beta2 https://download.developer.apple.com/Developer_Tools/Xcode_12.2_beta_2/Xcode_12.2_beta_2.xip 12.0.1 https://download.developer.apple.com/Developer_Tools/Xcode_12.0.1/Xcode_12.0.1.xip 12 beta 5 https://download.developer.apple.com/Developer_Tools/Xcode_12_beta_5/Xcode_12_beta_5.xip 11.6 https://download.developer.apple.com/Developer_Tools/Xcode_11.6/Xcode_11.6.xip 11.5 beta 2 https://download.developer.apple.com/Developer_Tools/Xcode_11.5_beta_2/Xcode_11.5_beta_2.xip 11.5 beta https://download.developer.apple.com/Developer_Tools/Xcode_11.5_beta/Xcode_11.5_beta.xip 11.4.1 https://download.developer.apple.com/Developer_Tools/Xcode_11.4.1/Xcode_11.4.1.xip 11.4 https://download.developer.apple.com/Developer_Tools/Xcode_11.4/Xcode_11.4.xip 11.4 beta 3 https://download.developer.apple.com/Developer_Tools/Xcode_11.4_beta_3/Xcode_11.4_beta_3.xip 11.4 beta 2 https://download.developer.apple.com/Developer_Tools/Xcode_11.4_beta_2/Xcode_11.4_beta_2.xip 11.4 beta https://download.developer.apple.com/Developer_Tools/Xcode_11.4_beta/Xcode_11.4_beta.xip 11.3.1 https://download.developer.apple.com/Developer_Tools/Xcode_11.3.1/Xcode_11.3.1.xip 11.2 beta 2 https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta_2/Xcode_11.2_beta_2.xip 11.1 https://download.developer.apple.com/Developer_Tools/Xcode_11.1/Xcode_11.1.xip 11.2 beta https://download.developer.apple.com/Developer_Tools/Xcode_11.2_beta/Xcode_11.2_beta.xip 11 https://download.developer.apple.com/Developer_Tools/Xcode_11/Xcode_11.xip 10.3 https://download.developer.apple.com/Developer_Tools/Xcode_10.3/Xcode_10.3.xip 10.2.1 https://download.developer.apple.com/Developer_Tools/Xcode_10.2.1/Xcode_10.2.1.xip 10.2 https://download.developer.apple.com/Developer_Tools/Xcode_10.2/Xcode_10.2.xip 10.1 https://download.developer.apple.com/Developer_Tools/Xcode_10.1/Xcode_10.1.xip command line tool COMMAND LINE TOOL URL 12.3 beta https://download.developer.apple.com/Developer_Tools/Xcode_12.3_beta/Xcode_12.3_beta.xip 12.2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_12.2/Command_Line_Tools_for_Xcode_12.2.dmg 12.0 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_12/Command_Line_Tools_for_Xcode_12.dmg 11.4.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4.1/Command_Line_Tools_for_Xcode_11.4.1.dmg 11.4 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4/Command_Line_Tools_for_Xcode_11.4.dmg 11.4 beta 3 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4_beta_3/Command_Line_Tools_for_Xcode_11.4_beta_3.dmg 11.4 beta 2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.4_beta_2/Command_Line_Tools_for_Xcode_11.4_beta_2.dmg 11.3.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.3.1/Command_Line_Tools_for_Xcode_11.3.1.dmg 11.2 beta 2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.2_beta_2/Command_Line_Tools_for_Xcode_11.2_beta_2.dmg 11.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11.2_beta/Command_Line_Tools_for_Xcode_11.2_beta.dmg 11 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_for_Xcode_11/Command_Line_Tools_for_Xcode_11.dmg 10.3 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.3/Command_Line_Tools_macOS_10.14_for_Xcode_10.3.dmg 10.2.1 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.2.1.dmg/Command_Line_Tools_macOS_10.14_for_Xcode_10.2.1.dmg 10.2 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.2/Command_Line_Tools_macOS_10.14_for_Xcode_10.2.dmg 10.1 for macOS 10.14 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.14_for_Xcode_10.1/Command_Line_Tools_macOS_10.14_for_Xcode_10.1.dmg 10.1 for macOS 10.13 https://download.developer.apple.com/Developer_Tools/Command_Line_Tools_macOS_10.13_for_Xcode_10.1/Command_Line_Tools_macOS_10.13_for_Xcode_10.1.dmg additional tools ADDITIONAL TOOL URL 11.4 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_11.4/Additional_Tools_for_Xcode_11.4.dmg 11.4 beta 2 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_11.4_beta_2/Additional_Tools_for_Xcode_11.4_beta_2.dmg 11 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_11/Additional_Tools_for_Xcode_11.dmg 10.1 https://download.developer.apple.com/Developer_Tools/Additional_Tools_for_Xcode_10.1/Additional_Tools_for_Xcode_10.1.dmg additional info accpet license from cmd $ sudo xcodebuild -license accept commandline tools and compoents installation $ xcode-select -p $ for pkg in /Applications/Xcode.app/Contents/Resources/Packages/*.pkg; do sudo installer -pkg \"$pkg\" -target /; done upgrade $ softwareupdate --all --install --force # or $ sudo rm -rf /Library/Developer/CommandLineTools $ sudo xcode-select --install more details $ defaults read /Library/Preferences/com.apple.SoftwareUpdate { AutomaticallyInstallMacOSUpdates = 1; LastAttemptBuildVersion = \"10.15.7 (19H2)\"; LastAttemptSystemVersion = \"10.15.7 (19H2)\"; LastBackgroundSuccessfulDate = \"2020-10-10 06:15:40 +0000\"; LastCatalogChangeDate = \"2020-10-10 14:13:29 +0000\"; LastFullSuccessfulDate = \"2020-10-10 14:14:38 +0000\"; LastRecommendedMajorOSBundleIdentifier = \"\"; LastRecommendedUpdatesAvailable = 0; LastResultCode = 2; LastSessionSuccessful = 1; LastSuccessfulDate = \"2020-10-10 14:14:38 +0000\"; LastUpdatesAvailable = 0; PrimaryLanguages = ( \"en-CN\", en ); RecommendedUpdates = ( ); SkipLocalCDN = 0; } enable dev mode $ DevToolsSecurity -enable security backup security [!NOTE|label:references:] How to make Python use CA certificates from Mac OS TrustStore? export $ security export -t certs -f pemseq -k /System/Library/Keychains/SystemRootCertificates.keychain -o bundleCA.pem $ security export -t certs -f pemseq -k /Library/Keychains/System.keychain -o selfSignedCAbundle.pem merge $ cat bundleCA.pem selfSignedCAbundle.pem >> allCAbundle.pem $ export REQUESTS_CA_BUNDLE=/path/to/allCAbundle.pem Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"osx/defaults.html":{"url":"osx/defaults.html","title":"defaults","keywords":"","body":" usage commands usage basic usage list all domains defaults programming xCode iTerm2 terminal utilities screenshot finder quit via ⌘ + Q default location extension view icon bars panel hidden file others desktop menu bar trackpad dock show icon animation autohide others mission control keyboard & trackpad battery browser chrome safari system others backup & restore Moon vscode reference: * defaults-write.com 10 terminal commands to speed up macOS High Sierra on your Mac * macOS defaults list macOS defaults How To Change Preferences From The Command Line On MacOS? mac defaults uson1x/hack.sh Maya/mac settings.sh dotfiles/mac/mac_settings.sh osx-for-hackers.sh brandonb927/osx-for-hackers.sh mathiasbynens/dotfiles .macos akachrislee/osx usage commands commands comments read prints the user’s settings to standard output read-type prints the plist type for a given key write write a value for the given key rename rename a key import import a plist to a given domain export export a domain and all the keys as a plist delete delete a given key or a domain / all keys for a given domain domains prints the name of all domains find search all domains, keys, and values for a given word usage basic usage # gets all $ defaults read DOMAIN # gets $ defaults read DOMAIN PROPERTY_NAME # find $ defaults find # get type $ defaults read-type # rename $ defaults rename # sets $ defaults write DOMAIN PROPERTY_NAME VALUE # resets a property $ defaults delete DOMAIN PROPERTY_NAME # resets preferences $ defaults delete DOMAIN list all domains $ defaults domains i.e.$ defaults domains | tr ',' '\\n' | head ContextStoreAgent MobileMeAccounts com.100hps.captin com.ScooterSoftware.BeyondCompare com.app77.pwsafemac com.apple.AMPLibraryAgent com.apple.ATS com.apple.Accessibility com.apple.AdLib com.apple.AddressBook defaults programming xCode add additional Counterpart Suffixes # `\"ViewModel\" \"View\"` $ defaults write com.apple.dt.Xcode IDEAdditionalCounterpartSuffixes -array-add \"ViewModel\" \"View\" && killall Xcode # `\"Router\" \"Interactor\" \"Builder\"` $ defaults write com.apple.dt.Xcode IDEAdditionalCounterpartSuffixes -array-add \"Router\" \"Interactor\" \"Builder\" && killall Xcode show build durations $ defaults write com.apple.dt.Xcode ShowBuildOperationDuration -bool true && killall Xcode add additional counterpart suffixes # add \"ViewModel\" and \"View\" $ defaults write com.apple.dt.Xcode \"IDEAdditionalCounterpartSuffixes\" -array-add \"ViewModel\" \"View\" && killall Xcode # add \"Router\", \"Interactor\" and \"Builder\" $ defaults write com.apple.dt.Xcode \"IDEAdditionalCounterpartSuffixes\" -array-add \"Router\" \"Interactor\" \"Builder\" && killall Xcode show build durations $ defaults write com.apple.dt.Xcode \"ShowBuildOperationDuration\" -bool \"true\" && killall Xcode iTerm2 profile # reset $ cd ~/Library/Preferences/com.googlecode.iterm2.plist $ defaults delete com.googlecode.iterm2 prompt when quitting # disable $ defaults write com.googlecode.iterm2 PromptOnQuit -bool false terminal # UTF-8 encoding $ defaults write com.apple.terminal StringEncodings -array 4 # theme $ defaults write com.apple.Terminal \"Default Window Settings\" -string \"gruvbox-dark\" $ defaults write com.apple.Terminal \"Startup Window Settings\" -string \"gruvbox-dark\" # more $ defaults read com.apple.Terminal modify theme $ osascript enable security keyboard [!NOTE|label:references:] How secure is \"Secure Keyboard Entry\" in Mac OS X's Terminal? $ defaults write com.apple.terminal SecureKeyboardEntry -bool true line marks # disable $ defaults write com.apple.Terminal ShowLineMarks -int 0 utilities startup sounds # disable $ sudo nvram StartupMute=%01 # or $ sudo nvram SystemAudioVolume=\" \" # enable $ sudo nvram StartupMute=%00 forbidden spell automatic correction $ defaults write -g NSAutomaticQuoteSubstitutionEnabled -bool false $ defaults write -g NSAutomaticDashSubstitutionEnabled -bool false $ defaults write -g NSAutomaticSpellingCorrectionEnabled -bool false disable notification centers $ launchctl unload -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist && killall NotificationCenter are you sure you want to open this application? $ defaults write com.apple.LaunchServices LSQuarantine -bool false # or $ sudo spctl --master-disable avoid install resource validation references: How to fix: This is an application downloaded from the Internet. Are you sure you want to open it? disable application quarantine message $ sudo spctl --master-disable $ defaults write com.apple.LaunchServices LSQuarantine -bool false none warning for unknown resource open $ defaults write com.apple.LaunchServices LSQuarantine -bool false enable the hidden file $ defaults write com.apple.finder AppleShowAllFiles TRUE && killall Finder # or $ defaults write com.apple.finder AppleShowAllFiles YES screenshot set screenshot location # `~/Picture/Screenshots` $ defaults write com.apple.iphonesimulator ScreenShotSaveLocation -string ~/Pictures/Screenshots # `~/Picture/Simulator Screenshots` $ defaults write com.apple.iphonesimulator ScreenShotSaveLocation -string ~/Pictures/Simulator Screenshots shadow # show $ defaults write com.apple.screencapture disable-shadow -bool false && killall SystemUIServer # disable $ defaults write com.apple.screencapture disable-shadow -bool true && killall SystemUIServer include date # include $ defaults write com.apple.screencapture include-date -bool true && killall SystemUIServer # disable $ defaults write com.apple.screencapture include-date -bool false && killall SystemUIServer save location # `~/Desktop` $ defaults write com.apple.screencapture location -string ~/Desktop && killall SystemUIServer # `~/Pictures` $ defaults write com.apple.screencapture location -string ~/Pictures && killall SystemUIServer thumbnail # display $ defaults write com.apple.screencapture show-thumbnail -bool true # disable thumbnail $ defaults write com.apple.screencapture show-thumbnail -bool false screenshot format # `png` $ defaults write com.apple.screencapture type -string png # `jpg` $ defaults write com.apple.screencapture type -string jpg finder quit via ⌘ + Q # hidden quite $ defaults write com.apple.finder QuitMenuItem -bool false && killall Finder # enable quite $ defaults write com.apple.finder QuitMenuItem -bool true && killall Finder default location $ defaults write com.apple.finder NewWindowTarget -string \"PfDe\" $ defaults write com.apple.finder NewWindowTargetPath -string \"file://${HOME}/\" extension # show $ defaults write NSGlobalDomain AppleShowAllExtensions -bool true && killall Finder # disable $ defaults write NSGlobalDomain AppleShowAllExtensions -bool false && killall Finder # show warning when change file extension warning $ defaults write com.apple.finder FXEnableExtensionChangeWarning -bool true && killall Finder # silent when change file extension warning $ defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false && killall Finder view full POSIX path in toolbar title $ defaults write com.apple.finder _FXShowPosixPathInTitle -bool true column view [!TIP] view modes Default view style icnv : Icon View clmv : Column View Flwv : Cover Flow View Nlsv : List View $ defaults write com.apple.finder FXPreferredViewStyle clmv && killall Finder keep folder on top $ defaults write com.apple.finder \"_FXSortFoldersFirst\" -bool \"true\" && killall Finder # for desktop $ defaults write com.apple.finder \"_FXSortFoldersFirstOnDesktop\" -bool \"true\" && killall Finder icon set sidebar icon size # small: 1 $ defaults write NSGlobalDomain NSTableViewDefaultSizeMode -int 1 && killall Finder # medium: 2 $ defaults write NSGlobalDomain NSTableViewDefaultSizeMode -int 2 && killall Finder # large: 3 $ defaults write NSGlobalDomain NSTableViewDefaultSizeMode -int 3 && killall Finder show item info near icons $ /usr/libexec/PlistBuddy -c \"Set :DesktopViewSettings:IconViewSettings:showItemInfo true\" ~/Library/Preferences/com.apple.finder.plist $ /usr/libexec/PlistBuddy -c \"Set :FK_StandardViewSettings:IconViewSettings:showItemInfo true\" ~/Library/Preferences/com.apple.finder.plist $ /usr/libexec/PlistBuddy -c \"Set :StandardViewSettings:IconViewSettings:showItemInfo true\" ~/Library/Preferences/com.apple.finder.plist show item info to right of icons $ /usr/libexec/PlistBuddy -c \"Set DesktopViewSettings:IconViewSettings:labelOnBottom false\" ~/Library/Preferences/com.apple.finder.plist snap-to-grid for icons $ /usr/libexec/PlistBuddy -c \"Set :DesktopViewSettings:IconViewSettings:arrangeBy grid\" ~/Library/Preferences/com.apple.finder.plist $ /usr/libexec/PlistBuddy -c \"Set :FK_StandardViewSettings:IconViewSettings:arrangeBy grid\" ~/Library/Preferences/com.apple.finder.plist $ /usr/libexec/PlistBuddy -c \"Set :StandardViewSettings:IconViewSettings:arrangeBy grid\" ~/Library/Preferences/com.apple.finder.plist increase grid spacing for icons $ /usr/libexec/PlistBuddy -c \"Set :DesktopViewSettings:IconViewSettings:gridSpacing 100\" ~/Library/Preferences/com.apple.finder.plist $ /usr/libexec/PlistBuddy -c \"Set :FK_StandardViewSettings:IconViewSettings:gridSpacing 100\" ~/Library/Preferences/com.apple.finder.plist $ /usr/libexec/PlistBuddy -c \"Set :StandardViewSettings:IconViewSettings:gridSpacing 100\" ~/Library/Preferences/com.apple.finder.plist increase the size of icons $ /usr/libexec/PlistBuddy -c \"Set :DesktopViewSettings:IconViewSettings:iconSize 80\" ~/Library/Preferences/com.apple.finder.plist $ /usr/libexec/PlistBuddy -c \"Set :FK_StandardViewSettings:IconViewSettings:iconSize 80\" ~/Library/Preferences/com.apple.finder.plist $ /usr/libexec/PlistBuddy -c \"Set :StandardViewSettings:IconViewSettings:iconSize 80\" ~/Library/Preferences/com.apple.finder.plist bars show path bar $ defaults write com.apple.finder ShowPathbar -bool true show status bar $ defaults write com.apple.finder ShowStatusBar -bool true show icon in the title bar $ defaults write com.apple.universalaccess \"showWindowTitlebarIcons\" -bool \"true\" && killall Finder adjust toolbar title rollover delay # `0.5` $ defaults write NSGlobalDomain NSToolbarTitleViewRolloverDelay -float 0.5 && killall Finder # `0` $ defaults write NSGlobalDomain NSToolbarTitleViewRolloverDelay -float 0 && killall Finder # `1` $ defaults write NSGlobalDomain NSToolbarTitleViewRolloverDelay -float 1 && killall Finder panel # expand save panel by default $ defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode -bool true $ defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode2 -bool true # expand print panel by default $ defaults write NSGlobalDomain PMPrintingExpandedStateForPrint -bool true $ defaults write NSGlobalDomain PMPrintingExpandedStateForPrint2 -bool true hidden file show hidden files # show $ defaults write com.apple.Finder AppleShowAllFiles -bool true && killall Finder # disable $ defaults write com.apple.Finder AppleShowAllFiles -bool false && killall Finder disable the .DS_Store and ._* [!NOTE|label:references:] Junk files created by macOS (or Finder)... You can disable MDS on a specific volume, but you need to create a hidden file to do it$ sudo touch /Volumes/{drive name}/.metadata_never_index more details .DS_Store – The name of a file in the Apple OS X operating system for storing custom attributes of a folder such as the position of icons or the choice of a background image (Read more) .Spotlight-V100 – This file holds information to speed up the 'Spotlight Search' feature. Deleting would simply force this information to be re-indexed if you performed another Spotlight Search for an item in this folder. .apDisk – This file holds information about shared folders and can be safely removed as it will be automatically re-created if Apple needs it. .VolumeIcon.icns – This file is used to store the icon of the volume (USB device) if the volume uses a custom icon and not the default icon. If you want the device to continue using this default icon, or if the folder/device you want to clean contains an application, you might want to keep this file in your system. As a side note, if you wanted to create a custom icon for your device you could create/download an .icns file and rename it .VolumeIcon.icns and place in your folder/device. .fseventsd – This file is used as a buffer for the File System Events daemon. If you are using a program that is monitoring this folder/device, this file might be used to store temporary data. .Trash & .Trashes – These folders are used to hold deleted items the same way that the 'Trash' icon from the dock works. If you don't need this feature on your folder/device, you can clean this folder to save space. .TemporaryItems – This file is used by the OS to hold temporary data when files are being copied/moved/appended. If you are running any programs that are accessing the folder/device you want to clean, and you aren't copying or moving any files, then this file can simply hold old data for caching. # Network drives $ defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true # USB drives $ defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true enable $ defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool false $ defaults write com.apple.desktopservices DSDontWriteUSBStores -bool false result $ defaults read com.apple.desktopservices { DSDontWriteNetworkStores = 1; DSDontWriteUSBStores = 1; } others search scope [!TIP] default search scope SCcf : Search the current folder SCsp : Use the previous search scope SCev : Search this Mac # use current directory as default search scope $ defaults write com.apple.finder FXDefaultSearchScope -string \"SCcf\" empty trashcan after 30 days $ defaults write com.apple.finder \"FXRemoveOldTrashItems\" -bool \"true\" && killall Finder disk image verification # disable $ defaults write com.apple.frameworks.diskimages skip-verify -bool true $ defaults write com.apple.frameworks.diskimages skip-verify-locked -bool true $ defaults write com.apple.frameworks.diskimages skip-verify-remote -bool true silent quiet # quit printer app once the print jobs complete $ defaults write com.apple.print.PrintingPrefs \"Quit When Finished\" -bool true save to disk or iCloud # yes: save to iCloud $ defaults write NSGlobalDomain NSDocumentSaveNewDocumentsToCloud -bool true # no: save to disk by default $ defaults write NSGlobalDomain NSDocumentSaveNewDocumentsToCloud -bool false select && copy from quicklook $ defaults write com.apple.finder QLEnableTextSelection -bool TRUE; killall Finder spring loading # enable spring loading $ defaults write NSGlobalDomain com.apple.springing.enabled -bool true # disable spring loading delay defaults write NSGlobalDomain com.apple.springing.delay -float 0 volume mounted # open finder automatically $ defaults write com.apple.frameworks.diskimages auto-open-ro-root -bool true $ defaults write com.apple.frameworks.diskimages auto-open-rw-root -bool true $ defaults write com.apple.finder OpenWindowForNewRemovableDisk -bool true desktop keep folders on top $ defaults write com.apple.finder \"_FXSortFoldersFirstOnDesktop\" -bool \"true\" && killall Finder quick hidden desktop icons $ defaults write com.apple.finder CreateDesktop -bool FALSE && killall Finder # revert back $ defaults write com.apple.finder CreateDesktop TRUE && killall Finder icons show external disk $ defaults write com.apple.finder ShowExternalHardDrivesOnDesktop -bool true show hard drive $ defaults write com.apple.finder ShowHardDrivesOnDesktop -bool false show connected servers $ defaults write com.apple.finder ShowMountedServersOnDesktop -bool true show removeable media ( CDs, DVDs and iPods ) $ defaults write com.apple.finder ShowRemovableMediaOnDesktop -bool true menu bar transparency # disable transparency $ defaults write com.apple.universalaccess reduceTransparency -bool true highlight color # green $ defaults write NSGlobalDomain AppleHighlightColor -string \"0.764700 0.976500 0.568600\" # black $ defaults write NSGlobalDomain AppleHighlightColor -string \"0.500000 0.500000 0.500000\" flash clock time separators # stay solid $ defaults write com.apple.menuextra.clock FlashDateSeparators -bool false && killall SystemUIServer # separator flashes $ defaults write com.apple.menuextra.clock FlashDateSeparators -bool true && killall SystemUIServer set menu bar digital clock format [!NOTE|label:region settings:] ss for seconds. HH for 24-hour clock. EEE for 3-letter day of the week. d MMM for day of the month and 3-letter month. # `EEE d MMM HH:mm:ss` $ defaults write com.apple.menuextra.clock DateFormat -string \"EEE d MMM HH:mm:ss\" # `EEE h:mm:ss` $ defaults write com.apple.menuextra.clock DateFormat -string \"EEE h:mm:ss\" # `EEE HH:mm:ss` $ defaults write com.apple.menuextra.clock DateFormat -string \"EEE HH:mm:ss\" menu bar transparency # disable transparency $ defaults write NSGlobalDomain AppleEnableMenuBarTransparency -bool false trackpad [!TIP] * Access Trackpad settings from macOS UI click weight # light: 0 $ defaults write com.apple.AppleMultitouchTrackpad \"FirstClickThreshold\" -int \"0\" # medium: 1 $ defaults write com.apple.AppleMultitouchTrackpad \"FirstClickThreshold\" -int \"1\" # firm: 2 $ defaults write com.apple.AppleMultitouchTrackpad \"FirstClickThreshold\" -int \"2\" enable dragging with drag lock $ defaults write com.apple.AppleMultitouchTrackpad \"DragLock\" -bool \"true\" Enable dragging without drag lock $ defaults write com.apple.AppleMultitouchTrackpad \"Dragging\" -bool \"true\" enable dragging with three finger drag $ defaults write com.apple.AppleMultitouchTrackpad \"TrackpadThreeFingerDrag\" -bool \"true\" dock [!NOTE|label:references:] Dock performance setup revert dock to default$ defaults delete com.apple.dock && killall Dock show add a blank space $ defaults write com.apple.dock persistent-apps -array-add '{tile-data={}; tile-type=\"spacer-tile\";}' && killall Dock group window by app $ defaults write com.apple.dock \"expose-group-apps\" -bool \"true\" && killall Dock position [!TIP] * Access Dock settings from macOS UI # `left` $ defaults write com.apple.dock orientation -string left && killall Dock # `right` $ defaults write com.apple.dock orientation -string right && killall Dock # `bottom` $ defaults write com.apple.dock orientation -string bottom && killall Dock disable delay of dock displaying $ defaults write com.apple.Dock autohide-delay -float 0 && killall Dock show recently # show $ defaults write com.apple.dock show-recents -bool true && killall Dock # disable show $ defaults write com.apple.dock show-recents -bool false && killall Dock recent use rearrange space # disable $ defaults write com.apple.dock mru-spaces -bool false && killall Dock icon highlight icon $ defaults write com.apple.dock mouse-over-hilite-stack -bool TRUE && killall Dock # revert $ defaults delete com.apple.dock mouse-over-hilite-stack && killall Dock icon size tilesize # `48` $ defaults write com.apple.dock tilesize -int 48 && killall Dock # read current value $ defaults read com.apple.dock tilesize 46 largesize # 72 $ defaults write com.apple.dock largesize -float 72 && killall Dock remove none-opened apps $ defaults write com.apple.dock static-only -boolean true && killall Dock # revert $ defaults delete com.apple.dock static-only && killall Dock hidden icon $ defaults write com.apple.dock showhidden -bool true && killall Dock # revert $ defaults delete com.apple.Dock showhidden && killall Dock animation opening applications animation # enable $ defaults write com.apple.dock launchanim -bool true # disable $ defaults write com.apple.dock launchanim -bool false animation of minimize windows # * `suck` $ defaults write com.apple.dock mineffect suck && killall Dock # `genie` $ defaults write com.apple.dock mineffect genie && killall Dock # `scale` $ defaults write com.apple.dock mineffect -string scale && killall Dock autohide # auto hide $ defaults write com.apple.dock autohide -bool true && killall Dock # always show $ defaults write com.apple.dock autohide -bool false && killall Dock autohide animation delay [!NOTE|label:precondition] setup autohide to true # `0.5` $ defaults write com.apple.dock autohide-time-modifier -float 0.5 && killall dock # `2` $ defaults write com.apple.dock autohide-time-modifier -float 2 && killall dock # `0` $ defaults write com.apple.dock autohide-time-modifier -float 0 && killall dock # read current value $ defaults read com.apple.dock autohide-time-modifier 1 autohide delay [!NOTE|label:precondition] setup autohide to true # `0.5` $ defaults write com.apple.dock autohide-delay -float 0.5 && killall Dock # `0` $ defaults write com.apple.dock autohide-delay -float 0 && killall Dock # read current value $ defaults read com.apple.dock autohide-delay 0 others 2D Dock $ defaults write com.apple.dock no-glass -bool true enable iTunes track notifications in the dock $ defaults write com.apple.dock itunes-notifications -bool true highlight hover effect # enable highlight $ defaults write com.apple.dock mouse-over-hilte-stack -bool true speeding up mission control animations $ defaults write com.apple.dock expose-animation-duration -float 0.1 $ defaults write com.apple.dock \"expose-group-by-app\" -bool true spring loading for all Dock items $ defaults write com.apple.dock enable-spring-load-actions-on-all-items -bool true indicator lights for open apps # show indicators lights $ defaults write com.apple.dock show-process-indicators -bool true mission control rearrange automatically # base on most of recent use $ defaults write com.apple.dock mru-spaces -bool true && killall Dock # keep space arrangement $ defaults write com.apple.dock mru-spaces -bool false && killall Dock switch to space with open windows $ defaults write NSGlobalDomain \"AppleSpacesSwitchOnActivate\" -bool \"true\" && killall Dock displays have separate spaces $ defaults write com.apple.spaces \"spans-displays\" -bool \"true\" && killall SystemUIServer keyboard & trackpad [!NOTE|label:references:] Key repeat in GitHub Codespaces How can I disable ApplePressAndHoldEnabled for a specific application #31919: Characters don't repeat when ApplePressAndHoldEnabled is disabled for VSCode key repeat $ defaults write NSGlobalDomain ApplePressAndHoldEnabled -boolean false # or $ defaults write -g ApplePressAndHoldEnabled -bool false restore $ defaults delete -g ApplePressAndHoldEnabled key repeat for in specific apps # chrome $ defaults delete -g ApplePressAndHoldEnabled $ defaults write \"com.google.Chrome\" ApplePressAndHoldEnabled 0 # vscode $ defaults delete com.microsoft.VSCode ApplePressAndHoldEnabled $ defaults write com.microsoft.VSCode ApplePressAndHoldEnabled -bool false fast keyboard response $ defaults write NSGlobalDomain KeyRepeat -int 0.02 reduce key repeat delay $ defaults write NSGlobalDomain InitialKeyRepeat -int 12 enable full keyboard access [!TIP] Enable full keyboard access for all controls (e.g. enable Tab in modal dialogs) $ defaults write NSGlobalDomain AppleKeyboardUIMode -int 3 auto-correct # disable $ defaults write NSGlobalDomain NSAutomaticSpellingCorrectionEnabled -bool false keyboard illumination # turn off keyboard illumination when computer is not used for 5 minutes $ defaults write com.apple.BezelServices kDimTime -int 300 increasing sound quality for bluetooth $ defaults write com.apple.BluetoothAudioAgent \"Apple Bitpool Min (editable)\" -int 40 enable tap to click $ defaults write com.apple.AppleMultitouchTrackpad Clicking -int 1 $ defaults -currentHost write NSGlobalDomain com.apple.mouse.tapBehavior -int 1 $ defaults write NSGlobalDomain com.apple.mouse.tapBehavior -int 1 enable three finger to drag $ defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerDrag -bool true $ defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerDrag -bool true trackpad & mouse speed $ defaults write -g com.apple.trackpad.scaling 2 $ defaults write -g com.apple.mouse.scaling 2.5 battery # get display off timer $ pmset -g | grep displaysleep displaysleep 180 # set display off timer $ pmset -a displaysleep 30 battery percent # show battery percent $ defaults write com.apple.menuextra.battery ShowPercent -string \"YES\" remaining battery time $ defaults write com.apple.menuextra.battery ShowTime -string \"YES\" browser chrome sensitive backswipe # disable on trackpads $ defaults write com.google.Chrome AppleEnableSwipeNavigateWithScrolls -bool false $ defaults write com.google.Chrome.canary AppleEnableSwipeNavigateWithScrolls -bool false # disable on magic mouse $ defaults write com.google.Chrome AppleEnableMouseSwipeNavigateWithScrolls -bool false $ defaults write com.google.Chrome.canary AppleEnableMouseSwipeNavigateWithScrolls -bool false system-native print preview $ defaults write com.google.Chrome DisablePrintPreview -bool true $ defaults write com.google.Chrome.canary DisablePrintPreview -bool true expand the print dialog $ defaults write com.google.Chrome PMPrintingExpandedStateForPrint2 -bool true $ defaults write com.google.Chrome.canary PMPrintingExpandedStateForPrint2 -bool true safari show full url $ defaults write com.apple.Safari \"ShowFullURLInSmartSearchField\" -bool \"true\" && killall Safari dns prefetching # disable $ defaults write com.apple.safari WebKitDNSPrefetchingEnabled -boolean false # enable $ defaults write com.apple.safari WebKitDNSPrefetchingEnabled -boolean true bookmarks # hidden bookmark $ defaults write com.apple.Safari ShowFavoritesBar -bool false # removing useless icons from bookmark bar defaults write com.apple.Safari ProxiesInBookmarksBar \"()\" sidebar # hidden $ defaults write com.apple.Safari ShowSidebarInTopSites -bool false thumbnail cache # disable $ defaults write com.apple.Safari DebugSnapshotsUpdatePolicy -int 2 debug mode # enable debug menu $ defaults write com.apple.Safari IncludeInternalDebugMenu -bool true # or $ defaults write com.apple.Safari IncludeInternalDebugMenu 1 standard deply # disable $ defaults write com.apple.Safari WebKitInitialTimedLayoutDelay 0.25 develop menu and the web inspector # develop menu and the web inspector $ defaults write com.apple.Safari IncludeDevelopMenu -bool true $ defaults write com.apple.Safari WebKitDeveloperExtrasEnabledPreferenceKey -bool true $ defaults write com.apple.Safari \"com.apple.Safari.ContentPageGroupIdentifier.WebKit2DeveloperExtrasEnabled\" -bool true # context menu for web inspector $ defaults write NSGlobalDomain WebKitDeveloperExtras -bool true search banners # search banners default to Contains instead of Starts With $ defaults write com.apple.Safari FindOnPageMatchesWordStartsOnly -bool false backspace key to previous page # disable $ defaults write com.apple.Safari com.apple.Safari.ContentPageGroupIdentifier.WebKit2BackspaceKeyNavigationEnabled -bool true safari font size $ defaults write com.apple.Safari com.apple.Safari.ContentPageGroupIdentifier.WebKit2MinimumFontSize -int 14 system reset dns cache [!NOTE|label:references:] How to Flush DNS Cache on a Mac How to Flush DNS on Mac – MacOS Clear DNS Cache How to reset the DNS cache in OS X $ sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder MACOS VERSION COMMAND macOS 12 (Monterey) sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder macOS 11 (Big Sur) sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder macOS 10.15 (Catalina) sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder macOS 10.14 (Mojave) sudo killall -HUP mDNSResponder macOS 10.13 (High Sierra) sudo killall -HUP mDNSResponder macOS 10.12 (Sierra) sudo killall -HUP mDNSResponder OS X 10.11 (El Capitan) sudo killall -HUP mDNSResponder OS X 10.10 (Yosemite) sudo discoveryutil udnsflushcaches OS X 10.9 (Mavericks) sudo killall -HUP mDNSResponder OS X 10.8 (Mountain Lion) sudo killall -HUP mDNSResponder Mac OS X 10.7 (Lion) sudo killall -HUP mDNSResponder Mac OS X 10.6 (Snow Leopard) sudo dscacheutil -flushcache Mac OS X 10.5 (Leopard) sudo lookupd -flushcache Mac OS X 10.4 (Tiger) lookupd -flushcache cursor blink rate # 1000 = 1 sec $ defaults write -g NSTextInsertionPointBlinkPeriodOn -float 200 $ defaults write -g NSTextInsertionPointBlinkPeriodOff -float 200 # revert $ defaults delete -g NSTextInsertionPointBlinkPeriodOn $ defaults delete -g NSTextInsertionPointBlinkPeriodOff set standby # to 24 hours $ sudo pmset -a standbydelay 86400 active dark mode $ defaults write -g NSRequiresAquaSystemAppearance -bool true # logout and login # revert $ defaults write -g NSRequiresAquaSystemAppearance -bool false reset launchpad $ defaults write com.apple.dock ResetLaunchPad -bool TRUE && killall Dock # or $ [ -e ~/Library/Application\\ Support/Dock/*.db ] && rm ~/Library/Application\\ Support/Dock/*.db # revert back $ defaults delete com.apple.dock springboard-rows $ defaults delete com.apple.dock springboard-columns $ defaults write com.apple.dock ResetLaunchPad -bool TRUE && killall Dock automatic terminate inactive apps # disable $ defaults write NSGlobalDomain NSDisableAutomaticTermination -bool true # enable $ defaults write NSGlobalDomain NSDisableAutomaticTermination -bool false viewer windows mode # non-floating mode $ defaults write com.apple.helpviewer DevMode -bool true # floating mode $ defaults write com.apple.helpviewer DevMode -bool false textEdit # plain text mode $ defaults write com.apple.TextEdit RichText -int 0 # revert $ defaults delete com.apple.TextEdit RichText # UTF-8 in TextEdit $ defaults write com.apple.TextEdit PlainTextEncoding -int 4 $ defaults write com.apple.TextEdit PlainTextEncodingForWrite -int 4 disk utility # enable debug menu $ defaults write com.apple.DiskUtility DUDebugMenuEnabled -bool true $ defaults write com.apple.DiskUtility advanced-image-options -bool true QuickTime # auto-play when open video $ defaults write com.apple.QuickTimePlayerX MGPlayMovieOnOpen -bool true App Store # enable the webkit developer tools $ defaults write com.apple.appstore WebKitDeveloperExtras -bool true # enable debug menu $ defaults write com.apple.appstore ShowDebugMenu -bool true # enable the automatic update check $ defaults write com.apple.SoftwareUpdate AutomaticCheckEnabled -bool true # check for software updates daily instead of weekly $ defaults write com.apple.SoftwareUpdate ScheduleFrequency -int 1 # download newly available updates in background $ defaults write com.apple.SoftwareUpdate AutomaticDownload -int 1 # install system data files & security updates $ defaults write com.apple.SoftwareUpdate CriticalUpdateInstall -int 1 # automatically download apps purchased on other macs $ defaults write com.apple.SoftwareUpdate ConfigDataInstall -int 1 # turn on app auto-update $ defaults write com.apple.commerce AutoUpdate -bool true # allow the app store to reboot machine on macos updates $ defaults write com.apple.commerce AutoUpdateRestartRequired -bool true activity monitor # show main window $ defaults write com.apple.ActivityMonitor OpenMainWindow -bool true # visualize cpu usage $ defaults write com.apple.ActivityMonitor IconType -int 5 # show all processes $ defaults write com.apple.ActivityMonitor ShowCategory -int 0 # sort via cpu usage $ defaults write com.apple.ActivityMonitor SortColumn -string \"CPUUsage\" $ defaults write com.apple.ActivityMonitor SortDirection -int 0 # update frequency $ defaults write com.apple.ActivityMonitor \"UpdatePeriod\" -int \"1\" && killall Activity\\ Monitor # dock icon type ## 1: regular icon $ defaults write com.apple.ActivityMonitor \"IconType\" -int \"0\" && killall Activity\\ Monitor ## 2: show network usage over time $ defaults write com.apple.ActivityMonitor \"IconType\" -int \"2\" && killall Activity\\ Monitor ## 3: show disk usage over time, as two mirrored line graphs $ defaults write com.apple.ActivityMonitor \"IconType\" -int \"3\" && killall Activity\\ Monitor ## 5: show the current cpu usages, as a verticle meter. $ defaults write com.apple.ActivityMonitor \"IconType\" -int \"5\" && killall Activity\\ Monitor ## 6: show cpu usage history, graphed over time $ defaults write com.apple.ActivityMonitor \"IconType\" -int \"6\" && killall Activity\\ Monitor over-the-top focus ring animation # disable $ defaults write NSGlobalDomain NSUseAnimatedFocusRing -bool false spotlight # disable $ sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist # enable $ sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist # [not recommended] hide icon $ sudo chmod 600 /System/Library/CoreServices/Search.bundle/Contents/MacOS/Search # stop indexing in a specific volume $ sudo mdutil -i off \"/Volumes/\" # stop mdutil in a specific volume $ sudo defaults write /.Spotlight-V100/VolumeConfiguration Exclusions -array \"/Volumes/\" change indexing order defaults write com.apple.spotlight orderedItems -array \\ '{\"enabled\" = 1;\"name\" = \"APPLICATIONS\";}' \\ '{\"enabled\" = 1;\"name\" = \"SYSTEM_PREFS\";}' \\ '{\"enabled\" = 1;\"name\" = \"DIRECTORIES\";}' \\ '{\"enabled\" = 1;\"name\" = \"PDF\";}' \\ '{\"enabled\" = 1;\"name\" = \"FONTS\";}' \\ '{\"enabled\" = 0;\"name\" = \"DOCUMENTS\";}' \\ '{\"enabled\" = 0;\"name\" = \"MESSAGES\";}' \\ '{\"enabled\" = 0;\"name\" = \"CONTACT\";}' \\ '{\"enabled\" = 0;\"name\" = \"EVENT_TODO\";}' \\ '{\"enabled\" = 0;\"name\" = \"IMAGES\";}' \\ '{\"enabled\" = 0;\"name\" = \"BOOKMARKS\";}' \\ '{\"enabled\" = 0;\"name\" = \"MUSIC\";}' \\ '{\"enabled\" = 0;\"name\" = \"MOVIES\";}' \\ '{\"enabled\" = 0;\"name\" = \"PRESENTATIONS\";}' \\ '{\"enabled\" = 0;\"name\" = \"SPREADSHEETS\";}' \\ '{\"enabled\" = 0;\"name\" = \"SOURCE\";}' \\ '{\"enabled\" = 0;\"name\" = \"MENU_DEFINITION\";}' \\ '{\"enabled\" = 0;\"name\" = \"MENU_OTHER\";}' \\ '{\"enabled\" = 0;\"name\" = \"MENU_CONVERSION\";}' \\ '{\"enabled\" = 0;\"name\" = \"MENU_EXPRESSION\";}' \\ '{\"enabled\" = 0;\"name\" = \"MENU_WEBSEARCH\";}' \\ '{\"enabled\" = 0;\"name\" = \"MENU_SPOTLIGHT_SUGGESTIONS\";}' # Load new settings before rebuilding the index killall mds > /dev/null 2>&1 # Make sure indexing is enabled for the main volume sudo mdutil -i on / > /dev/null # Rebuild the index from scratch sudo mdutil -E / > /dev/null notification center # disable $ launchctl unload -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist && killall NotificationCenter # enable $ launchctl load -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist && killall NotificationCenter dashboard # disable $ defaults write com.apple.dashboard mcx-disabled -boolean YES && killall Dock # enable $ defaults write com.apple.dashboard mcx-disabled -boolean NO && killall Dock time machine # disable dialog $ defaults write com.apple.TimeMachine DoNotOfferNewDisksForBackup -bool true # or disable local backup $ hash tmutil &> /dev/null && sudo tmutil disablelocal scrollbars # always show $ defaults write NSGlobalDomain AppleShowScrollBars -string \"Auto\" ASCII control characters using caret notation in standard text views [!NOTE|label:references:] #465 : NSTextShowsControlCharacters setting causes Mail to freeze Mail App Freezes/Hangs OS X 10.10.2 $ defaults write NSGlobalDomain NSTextShowsControlCharacters -bool true system-wide resume # disable $ defaults write NSGlobalDomain NSQuitAlwaysKeepsWindows -bool false loginwindow # reveal ip address, hostname, os version, etc. when clicking the clock in the login window $ sudo defaults write /Library/Preferences/com.apple.loginwindow AdminHostInfo HostName # revert $ sudo defaults delete /Library/Preferences/com.apple.loginwindow AdminHostInfo sleep mode # never go to sleep mode $ systemsetup -setcomputersleep Off > /dev/null # disable computer sleep and stop the display from shutting off $ sudo pmset -a sleep 0 $ sudo pmset -a displaysleep 0 # disable hibernatemode to speeds up entering sleep mode $ sudo pmset -a hibernatemode 0 power button in stand-by mode # disable $ defaults write com.apple.loginwindow PowerButtonSleepsSystem -bool no # revert to original $ defaults write com.apple.loginwindow PowerButtonSleepsSystem -bool yes remove sleep image file $ sudo rm /Private/var/vm/sleepimage # creating a zero-byte file instead of $ sudo touch /Private/var/vm/sleepimage # make sure be rewritten $ sudo chflags uchg /Private/var/vm/sleepimage download apps security # disable $ defaults write com.apple.LaunchServices LSQuarantine -bool NO # enable $ defaults write com.apple.LaunchServices LSQuarantine -bool YES un-useful sudden motion sensor for SSDs # disable $ sudo pmset -a sms 0 smart quotes and smart dashes # disable $ defaults write NSGlobalDomain NSAutomaticQuoteSubstitutionEnabled -bool false $ defaults write NSGlobalDomain NSAutomaticDashSubstitutionEnabled -bool false requiring password immediately $ defaults write com.apple.screensaver askForPassword -int 1 $ defaults write com.apple.screensaver askForPasswordDelay -int 0 subpixel font rendering # enable subpixel font rendering on non-Apple LCDs $ defaults write NSGlobalDomain AppleFontSmoothing -int 2 HiDPI display modes $ sudo defaults write /Library/Preferences/com.apple.windowserver DisplayResolutionEnabled -bool true $ sudo reboot others feedback assistant auto gather # allow large $ defaults write com.apple.appleseed.FeedbackAssistant Autogather -bool true # not allow $ defaults write com.apple.appleseed.FeedbackAssistant Autogather -bool false sidecar on incompatible macs $ defaults write com.apple.sidecar.display AllowAllDevices -bool true; defaults write com.apple.sidecar.display hasShownPref -bool true; open /System/Library/PreferencePanes/Sidecar.prefPane open photos automatically # disable $ defaults -currentHost write com.apple.ImageCapture disableHotPlug -bool true # revert back $ defaults -currentHost delete com.apple.ImageCapture disableHotPlug show one application at a time $ defaults write com.apple.dock single-app -bool true && killall Dock # revert to orignial $ defaults write com.apple.dock single-app -bool no && killall Dock gatekeeper # disable $ defaults write /Library/Preferences/com.apple.security GKAutoRearm -bool false # revert to original $ defaults delete /Library/Preferences/com.apple.security GKAutoRearm music song notifications # show $ defaults write com.apple.Music \"userWantsPlaybackNotifications\" -bool \"false\" && killall Music confirm changes popup # disable $ defaults write NSGlobalDomain \"NSCloseAlwaysConfirmsChanges\" -bool \"true\" function keys behavior # default $ defaults write NSGlobalDomain com.apple.keyboard.fnState -bool false # setup $ defaults write NSGlobalDomain com.apple.keyboard.fnState -bool true backup & restore Moon backup$ defaults export com.manytricks.Moom ~/Desktop/Moom.plist restore$ defaults import com.manytricks.Moom ~/Desktop/Moom.plist vscode extension backup$ code --list-extensions >> vs_code_extensions_list.txt restore$ cat vs_code_extensions_list.txt | xargs -n 1 code --install-extension settings $HOME/Library/Application Support/Code/User/settings.json Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-27 16:45:50 "},"osx/apps.html":{"url":"osx/apps.html","title":"apps","keywords":"","body":" homebrew homebrew installation alternative sources homebrew caskroom installation install reinstall/downgrade tricky check homebrew env install dmg install pkg inside dmg system settings list formula list all list all packages with dependencies list all formula size list all formula descriptions apt-file list whatprovides tools java accessory Alfred iTerm2 powerline backgroundmusic mac cli others trouble shooting failed to connect to raw.githubusercontent.com port 443: connection refused failure in brew search for cask formula A fatal error has been detected by the Java Runtime Environment : SIGILL (0x4) homebrew [!TIP|label:references:] Mac 下 brew 切换为国内源 homebrew for additional source homebrew installation $ /usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\" default source $ git -C \"$(brew --repo)\" remote -v origin git@github.com:Homebrew/brew (fetch) origin git@github.com:Homebrew/brew (push) $ git -C \"$(brew --repo homebrew/core)\" remote -v origin git@github.com:Homebrew/homebrew-core (fetch) origin git@github.com:Homebrew/homebrew-core (push) alternative sources homebrewCN $ /bin/zsh -c \"$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)\" official [!NOTE|label:revert back] $ brew doctor Please note that these warnings are just used to help the Homebrew maintainers with debugging if you file an issue. If everything you use Homebrew for is working fine: please don't worry or file an issue; just ignore this. Thanks! Warning: Suspicious https://github.com/Homebrew/brew git origin remote found. The current git origin is: https://mirrors.ustc.edu.cn/brew.git With a non-standard origin, Homebrew won't update properly. You can solve this by setting the origin remote: git -C \"/usr/local/Homebrew\" remote set-url origin https://github.com/Homebrew/brew Warning: Suspicious https://github.com/Homebrew/homebrew-core git origin remote found. The current git origin is: https://mirrors.ustc.edu.cn/homebrew-core.git With a non-standard origin, Homebrew won't update properly. You can solve this by setting the origin remote: git -C \"/usr/local/Homebrew/Library/Taps/homebrew/homebrew-core\" remote set-url origin https://github.com/Homebrew/homebrew-core $ brew_source='https://github.com/Homebrew' # brew 程序本身 $ git -C \"$(brew --repo)\" remote set-url origin ${brew_source}/brew.git $ git -C \"$(brew --repo homebrew/core)\" remote set-url origin ${brew_source}/homebrew-core.git $ git -C \"$(brew --repo homebrew/cask)\" remote set-url origin ${brew_source}/homebrew-cask.git $ git -C \"$(brew --repo homebrew/cask-fonts)\" remote set-url origin ${brew_source}/homebrew-cask-fonts.git $ git -C \"$(brew --repo homebrew/cask-drivers)\" remote set-url origin ${brew_source}/homebrew-cask-drivers.git $ brew update tsinghua (清华) $ brew_source='https://mirrors.tuna.tsinghua.edu.cn/git/homebrew' # brew 程序本身 $ git -C \"$(brew --repo)\" remote set-url origin ${brew_source}/brew.git $ git -C \"$(brew --repo homebrew/core)\" remote set-url origin ${brew_source}/homebrew-core.git $ git -C \"$(brew --repo homebrew/cask)\" remote set-url origin ${brew_source}/homebrew-cask.git $ git -C \"$(brew --repo homebrew/cask-fonts)\" remote set-url origin ${brew_source}/homebrew-cask-fonts.git $ git -C \"$(brew --repo homebrew/cask-drivers)\" remote set-url origin ${brew_source}/homebrew-cask-drivers.git $ brew update ustc (中科大) $ brew_source='https://mirrors.ustc.edu.cn' # brew 程序本身 $ git -C \"$(brew --repo)\" remote set-url origin ${brew_source}/brew.git $ git -C \"$(brew --repo homebrew/core)\" remote set-url origin ${brew_source}/homebrew-core.git $ git -C \"$(brew --repo homebrew/cask)\" remote set-url origin ${brew_source}/homebrew-cask.git $ brew update ali (阿里) $ brew_source='https://mirrors.aliyun.com/homebrew' # brew 程序本身 $ git -C \"$(brew --repo)\" remote set-url origin ${brew_source}/brew.git $ git -C \"$(brew --repo homebrew/core)\" remote set-url origin ${brew_source}/homebrew-core.git $ brew update tencent $ brew_source='https://mirrors.cloud.tencent.com/homebrew' # brew 程序本身 $ git -C \"$(brew --repo)\" remote set-url origin ${brew_source}/brew.git $ git -C \"$(brew --repo homebrew/core)\" remote set-url origin ${brew_source}/homebrew-core.git $ git -C \"$(brew --repo homebrew/cask)\" remote set-url origin ${brew_source}/homebrew-cask.git $ git -C \"$(brew --repo homebrew/cask-fonts)\" remote set-url origin ${brew_source}/homebrew-cask-fonts.git $ git -C \"$(brew --repo homebrew/cask-drivers)\" remote set-url origin ${brew_source}/homebrew-cask-drivers.git $ brwe update homebrew bottles [!NOTE|label:address:] https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles https://mirrors.ustc.edu.cn/homebrew-bottles https://mirrors.aliyun.com/homebrew/homebrew-bottles https://mirrors.cloud.tencent.com/homebrew-bottles $ export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.cloud.tencent.com/homebrew-bottles homebrew caskroom installation $ brew tap caskroom/versions $ brew cask outdated $ brew tap buo/cask-upgrade $ brew update $ brew cu --all home brew cask upgrade $ brew cu -a -y -f ==> Options Include auto-update (-a): true Include latest (-f): true ==> Updating Homebrew Already up-to-date. ==> Finding outdated apps Cask Current Latest A/U Result 1/10 alfred 3.5.1_883 3.5.1_883 Y [ OK ] 2/10 android-sdk 3859397,26.0.2 3859397,26.0.2 [ OK ] 3/10 dash 4.1.1 4.1.1 Y [ OK ] 4/10 etcher 1.2.1 1.2.1 [ OK ] 5/10 firefox 57.0.2 57.0.2 Y [ OK ] 6/10 imageoptim 1.7.3 1.7.3 Y [ OK ] 7/10 iterm2-beta 3.1.5.beta.1 3.1.5.beta.2 Y [ FORCED ] 8/10 java8 1.8.0_152-b16,aa0333dd3019491ca4f6ddbe78cdb6d0 1.8.0_152-b16,aa0333dd3019491ca4f6ddbe78cdb6d0 [ OK ] 9/10 little-snitch 4.0.4 4.0.4 Y [ OK ] 10/10 mounty latest latest [ OK ] ==> Found outdated apps Cask Current Latest A/U Result 1/1 iterm2-beta 3.1.5.beta.1 3.1.5.beta.2 Y [ FORCED ] ==> Upgrading iterm2-beta to 3.1.5.beta.2 ==> Satisfying dependencies ==> Downloading https://iterm2.com/downloads/beta/iTerm2-3_1_5_beta_2.zip ######################################################################## 100.0% ==> Verifying checksum for Cask iterm2-beta ==> Installing Cask iterm2-beta Warning: It seems there is already an App at '/Applications/iTerm.app'; overwriting. ==> Removing App '/Applications/iTerm.app'. ==> Moving App 'iTerm.app' to '/Applications/iTerm.app'. 🍺 iterm2-beta was successfully installed! or$ brew upgrade --cask --greedy install [!NOTE] reference: Homebrew Formulae - macvim MacVim more on mytools/osx/belloMyOSX systemlist=\"imagemagick coreutils bash proctools pstree vnstat ncdu ipcalc htop ack lsof trash\" regularlist=\"wget tmux corkscrew tig ifstat binutils diffutils gawk gnutls gzip less file-formula stow telnet iproute2mac ctags jshon colordiff tree vifm p7zip git mas htop watch jfrog-cli-go youtube-dl etcd mas figlet screenfetch glances bash-completion@2 dos2unix nmap rename renameutils pipenv inetutils hadolint\" regularheadlist=\"shellcheck bats jq gradle-completion git-flow\" gnulist=\"gnu-sed gnu-tar gnu-which grep ed findutils gnu-indent\" # utils $ brew install imagemagick coreutils moreutils bash proctools pstree vnstat ncdu ipcalc htop ack lsof trash $ brew install wget tmux corkscrew telnet figlet $ brew install gnu-sed --with-default-names $ brew install stow iproute2mac pandoc $ brew install macvim $ brew install wdiff --with-gettext $ brew install less --with-pcre deprecated (macvim) $ brew install macvim --with-override-system-vim --HEAD # OR $ brew tap macvim-dev/macvim $ brew install --HEAD macvim-dev/macvim/macvim $ brew linkapps macvim # OR $ brew linkapps # OR $ HOME_APPS = File.expand_path(\"/Applications\") # OR (Using none-link Info.plist and PkgInfo in *.app/Contents/) $ mkdir -p /Applications/gVim.app/Contents $ ln -sf /usr/local/Cellar/macvim/HEAD-a5e0355/gVim.app/Contents/* /Applications/gVim.app/Contents/ $ mv /Applications/gVim.app/Contents/Info.plist{,.link} $ mv /Applications/gVim.app/Contents/PkgInfo{,.link} $ cp /Applications/gVim.app/Contents/Info.plist{.link,} $ cp /Applications/gVim.app/Contents/PkgInfo{.link,} brew upgrade ignore specific formulas [!NOTE] Ignore formula on brew upgrade $ brew pin macvim $ brew list --pinned macvim $ brew upgrade Updating Homebrew... Error: Not upgrading 1 pinned package: macvim HEAD-caf7642_1 ==> Upgrading 6 outdated packages: ghostscript 9.53.2 -> 9.53.3 groovy 3.0.5 -> 3.0.6 node 14.12.0 -> 14.13.1 unbound 1.11.0 -> 1.12.0 nmap 7.80_1 -> 7.90 imagemagick 7.0.10-31 -> 7.0.10-34 ... unpin $ brew unpin macvim $ brew list --pinned batch install [!NOTE|label:references:] List of all packages installed using Homebrew $ xargs brew install make backup$ brew leaves > list.txt reinstall/downgrade [!NOTE|label:references] Install icu4c version 63 with Homebrew Finding the right version of the formula Homebrew install specific version of formula? homebrew - how to install older versions error log in node@12.22 after icu4c upgraded from 71.1 to 72.1: dyld[43773]: Library not loaded: /usr/local/opt/icu4c/lib/libicui18n.71.dylib Referenced from: /usr/local/Cellar/node@12/12.22.12_1/bin/node Reason: tried: '/usr/local/opt/icu4c/lib/libicui18n.71.dylib' (no such file), '/System/Volumes/Preboot/Cryptexes/OS/usr/local/opt/icu4c/lib/libicui18n.71.dylib' (no such file), '/usr/local/opt/icu4c/lib/libicui18n.71.dylib' (no such file), '/usr/local/lib/libicui18n.71.dylib' (no such file), '/usr/lib/libicui18n.71.dylib' (no such file, not in dyld cache), '/usr/local/Cellar/icu4c/72.1/lib/libicui18n.71.dylib' (no such file), '/System/Volumes/Preboot/Cryptexes/OS/usr/local/Cellar/icu4c/72.1/lib/libicui18n.71.dylib' (no such file), '/usr/local/Cellar/icu4c/72.1/lib/libicui18n.71.dylib' (no such file), '/usr/local/lib/libicui18n.71.dylib' (no such file), '/usr/lib/libicui18n.71.dylib' (no such file, not in dyld cache) get formula folder $ cd $(brew --repo homebrew/core) # or $ cd $(brew --prefix)/Homebrew/Library/Taps/homebrew/homebrew-core/Formula # intel $ cd $(brew --prefix)/Library/Taps/homebrew/homebrew-core/Formula # m1 # or $ hcore=\"$(brew --repo homebrew/core)\" $ alias git=\"git -C ${hcore}\" get proper revision from git history $ git log --oneline -5 --follow icu4c.rb 11249c583b5 icu4c: update 72.1 bottle. 025d9d1deaf icu4c 72.1 e3317b86c11 (icu4c-71.1) icu4c: update 71.1 bottle. # proper version 54fb3277728 icu4c: update 71.1 bottle. c013b416f31 icu4c: update homepage url $ git rev-parse e3317b86c11 e3317b86c11c644e88c762e03eb7b310c3337587 via brew extract $ brew extract --force --version=71.1 icu4c homebrew/cask ==> Searching repository history ==> Writing formula for icu4c from revision e3317b8 to: # `e3317b8` is the revision /usr/local/Homebrew/Library/Taps/homebrew/homebrew-cask/Formula/icu4c@71.1.rb $ git -C $(brew --repo homebrew/core) rev-parse e3317b8 e3317b86c11c644e88c762e03eb7b310c3337587 reinstall [!NOTE] without auto update : HOMEBREW_NO_AUTO_UPDATE=1 without install dependents : HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK=1 $ brew install --help Unless `HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK` is set, `brew upgrade` or `brew reinstall` will be run for outdated dependents and dependents with broken linkage, respectively. Unless `HOMEBREW_NO_INSTALL_CLEANUP` is set, `brew cleanup` will then be run for the installed formulae or, every 30 days, for all formulae. Unless `HOMEBREW_NO_INSTALL_UPGRADE` is set, `brew install` formula will upgrade formula if it is already installed but outdated. via fully-qualified name $ brew --cache --force-bottle icu4c@71.1 Error: Formulae found in multiple taps: * homebrew/cask/icu4c@71.1 * marslo/icu4c-71-1/icu4c@71.1 Please use the fully-qualified name (e.g. homebrew/cask/icu4c@71.1) to refer to the formula. # will be installed in /usr/local/Cellar/icu4c@71.1 $ HOMEBREW_NO_AUTO_UPDATE=1 brew install homebrew/cask/icu4c@71.1 ==> Fetching homebrew/cask/icu4c@71.1 ==> Downloading https://github.com/unicode-org/icu/releases/download/release-71-1/icu4c-71_1-src.tgz Already downloaded: /Users/marslo/Library/Caches/Homebrew/downloads/ff9ece63f455ff1d6aa066340111e22abfc72c249a7f3d1e492ffef111cb0752--icu4c-71_1-src.tgz ==> Installing icu4c@71.1 from homebrew/cask ... # mapping libs $ ln -sf /usr/local/Cellar/icu4c@71.1/71.1/lib/*.dylib /usr/local/lib/ $ HOMEBREW_NO_AUTO_UPDATE=1 brew install homebrew/cask/icu4c@71.1 ==> Fetching homebrew/cask/icu4c@71.1 ==> Downloading https://github.com/unicode-org/icu/releases/download/release-71-1/icu4c-71_1-src.tgz Already downloaded: /Users/marslo/Library/Caches/Homebrew/downloads/ff9ece63f455ff1d6aa066340111e22abfc72c249a7f3d1e492ffef111cb0752--icu4c-71_1-src.tgz ==> Installing icu4c@71.1 from homebrew/cask ==> ./configure --prefix=/usr/local/Cellar/icu4c@71.1/71.1 --disable-samples --disable-tests --enable-static --with-library-bits=64 ==> make ==> make install ==> Caveats icu4c@71.1 is keg-only, which means it was not symlinked into /usr/local, because macOS provides libicucore.dylib (but nothing else). If you need to have icu4c@71.1 first in your PATH, run: echo 'export PATH=\"/usr/local/opt/icu4c@71.1/bin:$PATH\"' >> /Users/marslo/.bash_profile echo 'export PATH=\"/usr/local/opt/icu4c@71.1/sbin:$PATH\"' >> /Users/marslo/.bash_profile For compilers to find icu4c@71.1 you may need to set: export LDFLAGS=\"-L/usr/local/opt/icu4c@71.1/lib\" export CPPFLAGS=\"-I/usr/local/opt/icu4c@71.1/include\" For pkg-config to find icu4c@71.1 you may need to set: export PKG_CONFIG_PATH=\"/usr/local/opt/icu4c@71.1/lib/pkgconfig\" ==> Summary ☕️ 🐸 /usr/local/Cellar/icu4c@71.1/71.1: 262 files, 76.2MB, built in 2 minutes 44 seconds ==> Running `brew cleanup icu4c@71.1`... Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP. Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`). via url [!INFO] url should be : https://raw.githubusercontent.com/Homebrew/homebrew-core//Formula/.rb $ HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK=1 \\ HOMEBREW_NO_AUTO_UPDATE=1 \\ brew reinstall https://raw.githubusercontent.com/Homebrew/homebrew-core/e3317b86c11c644e88c762e03eb7b310c3337587/Formula/icu4c.rb via local cache $ git log -p -G url.*icu4c -- Formula/icu4c.rb | grep -e ^commit -e https://github.com - url \"https://github.com/unicode-org/icu/releases/download/release-71-1/icu4c-71_1-src.tgz\" + url \"https://github.com/unicode-org/icu/releases/download/release-72-1/icu4c-72_1-src.tgz\" - url \"https://github.com/unicode-org/icu/releases/download/release-70-1/icu4c-70_1-src.tgz\" + url \"https://github.com/unicode-org/icu/releases/download/release-71-1/icu4c-71_1-src.tgz\" - url \"https://github.com/unicode-org/icu/releases/download/release-69-1/icu4c-69_1-src.tgz\" + url \"https://github.com/unicode-org/icu/releases/download/release-70-1/icu4c-70_1-src.tgz\" ... $ curl -O \"https://github.com/unicode-org/icu/releases/download/release-71-1/icu4c-71_1-src.tgz\" $ mv icu4c-71_1-src.tgz $(brew --cache -s icu4c) $ HOMEBREW_NO_AUTO_UPDATE=1 brew install -f $(brew --cache -s icu4c) via new tap [!TIP|label:references:] Install specific git version on MacOS using brew setup environment (tap) $ brew tap-new marslo/icu4c-71-1 Initialized empty Git repository in /usr/local/Homebrew/Library/Taps/marslo/homebrew-icu4c-71-1/.git/ .git/hooks/post-commit: line 8: git-stats: command not found [main (root-commit) ed01d30] Create marslo/icu4c-71-1 tap 3 files changed, 90 insertions(+) create mode 100644 .github/workflows/publish.yml create mode 100644 .github/workflows/tests.yml create mode 100644 README.md ==> Created marslo/icu4c-71-1 /usr/local/Homebrew/Library/Taps/marslo/homebrew-icu4c-71-1 # extract $ brew extract --version=71.1 icu4c marslo/icu4c-71-1 ==> Searching repository history ==> Writing formula for icu4c from revision e3317b8 to: /usr/local/Homebrew/Library/Taps/marslo/homebrew-icu4c-71-1/Formula/icu4c@71.1.rb install $ brew search /icu4c/ ==> Formulae homebrew/cask/icu4c@71.1 icu4c ✔ marslo/icu4c-71-1/icu4c@71.1 # will be installed in /usr/local/Cellar/icu4c@71.1 $ HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK=1 HOMEBREW_NO_AUTO_UPDATE=1 brew install marslo/icu4c-71-1/icu4c@71.1 # mapping libs : https://stackoverflow.com/a/55024755/2940319 $ ln -sf /usr/local/Cellar/icu4c@71.1/71.1/lib/*.dylib /usr/local/lib/ # verify $ ls -Altrh /usr/local/lib | grep icu4c lrwxr-xr-x 1 marslo admin 59 Jun 26 15:34 libicudata.71.1.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicudata.71.1.dylib lrwxr-xr-x 1 marslo admin 57 Jun 26 15:34 libicudata.71.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicudata.71.dylib lrwxr-xr-x 1 marslo admin 54 Jun 26 15:34 libicudata.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicudata.dylib lrwxr-xr-x 1 marslo admin 59 Jun 26 15:34 libicui18n.71.1.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicui18n.71.1.dylib lrwxr-xr-x 1 marslo admin 57 Jun 26 15:34 libicui18n.71.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicui18n.71.dylib lrwxr-xr-x 1 marslo admin 54 Jun 26 15:34 libicui18n.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicui18n.dylib lrwxr-xr-x 1 marslo admin 57 Jun 26 15:34 libicuio.71.1.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicuio.71.1.dylib lrwxr-xr-x 1 marslo admin 55 Jun 26 15:34 libicuio.71.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicuio.71.dylib lrwxr-xr-x 1 marslo admin 52 Jun 26 15:34 libicuio.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicuio.dylib lrwxr-xr-x 1 marslo admin 59 Jun 26 15:34 libicutest.71.1.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicutest.71.1.dylib lrwxr-xr-x 1 marslo admin 57 Jun 26 15:34 libicutest.71.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicutest.71.dylib lrwxr-xr-x 1 marslo admin 54 Jun 26 15:34 libicutest.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicutest.dylib lrwxr-xr-x 1 marslo admin 57 Jun 26 15:34 libicutu.71.1.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicutu.71.1.dylib lrwxr-xr-x 1 marslo admin 55 Jun 26 15:34 libicutu.71.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicutu.71.dylib lrwxr-xr-x 1 marslo admin 52 Jun 26 15:34 libicutu.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicutu.dylib lrwxr-xr-x 1 marslo admin 57 Jun 26 15:34 libicuuc.71.1.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicuuc.71.1.dylib lrwxr-xr-x 1 marslo admin 55 Jun 26 15:34 libicuuc.71.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicuuc.71.dylib lrwxr-xr-x 1 marslo admin 52 Jun 26 15:34 libicuuc.dylib -> /usr/local/Cellar/icu4c@71.1/71.1/lib/libicuuc.dylib ==> Fetching marslo/icu4c-71-1/icu4c@71.1 ==> Downloading https://github.com/unicode-org/icu/releases/download/release-71-1/icu4c-71_1-src.tgz ==> Downloading from https://objects.githubusercontent.com/github-production-release-asset-2e65be/49244766/6a045371-02a9-431c-81b8-be6721ce #################################################################################################################################### 100.0% ==> Reinstalling marslo/icu4c-71-1/icu4c@71.1 Warning: Your Xcode (14.1) is outdated. Please update to Xcode 14.3 (or delete it). Xcode can be updated from the App Store. ==> ./configure --prefix=/usr/local/Cellar/icu4c@71.1/71.1 --disable-samples --disable-tests --enable-static --with-library-bits=64 ==> make ==> make install ==> Caveats icu4c@71.1 is keg-only, which means it was not symlinked into /usr/local, because macOS provides libicucore.dylib (but nothing else). If you need to have icu4c@71.1 first in your PATH, run: echo 'export PATH=\"/usr/local/opt/icu4c@71.1/bin:$PATH\"' >> /Users/marslo/.bash_profile echo 'export PATH=\"/usr/local/opt/icu4c@71.1/sbin:$PATH\"' >> /Users/marslo/.bash_profile For compilers to find icu4c@71.1 you may need to set: export LDFLAGS=\"-L/usr/local/opt/icu4c@71.1/lib\" export CPPFLAGS=\"-I/usr/local/opt/icu4c@71.1/include\" For pkg-config to find icu4c@71.1 you may need to set: export PKG_CONFIG_PATH=\"/usr/local/opt/icu4c@71.1/lib/pkgconfig\" ==> Summary ☕️ 🐸 /usr/local/Cellar/icu4c@71.1/71.1: 262 files, 76.2MB, built in 2 minutes 55 seconds ==> Running `brew cleanup icu4c@71.1`... Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP. Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`). Warning: HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK is set: not checking for outdated dependents or dependents with broken linkage! via formula file (.rb) $ git checkout -b icu4c-71.1 e3317b86c11 $ HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK=1 HOMEBREW_NO_AUTO_UPDATE=1 brew reinstall ./icu4c.rb Error: Failed to load cask: ./icu4c.rb Cask 'icu4c' is unreadable: wrong constant name # Warning: Treating ./icu4c.rb as a formula. ==> Fetching icu4c ==> Downloading https://ghcr.io/v2/homebrew/core/icu4c/manifests/71.1 Already downloaded: /Users/marslo/Library/Caches/Homebrew/downloads/afc80f921cbba7963984e5d24567fbff5b3ba72dfc409cbf7c7f02ccaf0bebab--icu4c-71.1.bottle_manifest.json ==> Downloading https://ghcr.io/v2/homebrew/core/icu4c/raws/sha256:012f882f239863200f0f87150541ea695d609aa14c14a390909d249352ae51f9 Already downloaded: /Users/marslo/Library/Caches/Homebrew/downloads/f0134d8542652b3e26e7a482164caededc27b5ff5925270efdb6f268467f51ae--icu4c--71.1.ventura.bottle.tar.gz ==> Reinstalling icu4c Warning: icu4c 72.1 is available and more recent than version 71.1. ==> Pouring icu4c--71.1.ventura.bottle.tar.gz ☕️ 🐸 /usr/local/Cellar/icu4c/71.1: 262 files, 76.2MB ==> Running `brew cleanup icu4c`... Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP. Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`). Removing: /Users/marslo/Library/Caches/Homebrew/icu4c--71.1... (28.2MB) Warning: HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK is set: not checking for outdated dependents or dependents with broken linkage! # revert formula branch $ git checkout master pin formula $ brew pin icu4c $ brew list --pinned icu4c spotlight error $ xattr -dr com.apple.quarantine MacVim.app $ osascript -e 'tell application \"Finder\" to make alias file to POSIX file \"/usr/local/opt/macvim/MacVim.app\" at POSIX file \"/Applications\"' warning $ brew linkapps macvim Warning: `brew linkapps` has been deprecated and will eventually be removed! Unfortunately `brew linkapps` cannot behave nicely with e.g. Spotlight using either aliases or symlinks and Homebrew formulae do not build \"proper\" `.app` bundles that can be relocated. Instead, please consider using `brew cask` and migrate formulae using `.app`s to casks. Linking: /usr/local/opt/macvim/MacVim.app Linked 1 app to /Applications $ brew install --HEAD macvim-dev/macvim/macvim ==> Installing macvim from macvim-dev/macvim ==> Installing dependencies for macvim-dev/macvim/macvim: python3, lua ==> Installing macvim-dev/macvim/macvim dependency: python3 ==> Downloading https://homebrew.bintray.com/bottles/python3-3.6.3.high_sierra.bottle.tar.gz ==> Pouring python3-3.6.3.high_sierra.bottle.tar.gz You can try again using `brew postinstall python3` ==> Caveats Pip, setuptools, and wheel have been installed. To update them pip3 install --upgrade pip setuptools wheel You can install Python packages with pip3 install They will install into the site-package directory /usr/local/lib/python3.6/site-packages See: https://docs.brew.sh/Homebrew-and-Python.html ==> Summary 🍺 /usr/local/Cellar/python3/3.6.3: 3,009 files, 48MB ==> Installing macvim-dev/macvim/macvim dependency: lua ==> Downloading https://homebrew.bintray.com/bottles/lua-5.3.4_2.high_sierra.bottle.tar.gz ==> Pouring lua-5.3.4_2.high_sierra.bottle.tar.gz ==> Caveats Please be aware due to the way Luarocks is designed any binaries installed via Luarocks-5.3 AND 5.1 will overwrite each other in /usr/local/bin. This is, for now, unavoidable. If this is troublesome for you, you can build rocks with the `--tree=` command to a special, non-conflicting location and then add that to your `$PATH`. ==> Summary 🍺 /usr/local/Cellar/lua/5.3.4_2: 147 files, 752.9KB ==> Installing macvim-dev/macvim/macvim --HEAD ==> Cloning https://github.com/macvim-dev/macvim.git Updating /Users/marslo/Library/Caches/Homebrew/macvim--git ==> Checking out branch master ==> ./configure --prefix=/usr/local/Cellar/macvim/HEAD-4bf1de8 --with-features=huge --enable-multibyte --enable-terminal --enable-netbeans --with-tlib=ncurses --enable-cscope --enable-termtruecolor --enable-perlinterp=dynamic --enable-pythoninterp=dynamic --enable-python3interp=dynamic --enable-rubyinterp=dynamic --enable-luainterp=dynamic --with-lua-prefix=/usr/local ==> make ==> PATH=/usr/local/Cellar/gettext/0.19.8.1/bin:$PATH MSGFMT=/usr/local/Cellar/gettext/0.19.8.1/bin/msgfmt INSTALL_DATA=install FILEMOD=644 LOCALEDIR=../../src/MacVim/build/Release/MacVim.app/Contents/Resources/vim/runtime/lang make -C src/po install 🍺 /usr/local/Cellar/macvim/HEAD-4bf1de8: 2,183 files, 39.7MB, built in 1 minute 13 seconds tricky [!NOTE|label:references] Tips and Tricks check formula config files $ brew -v edit macvim Editing /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/macvim.rb vim /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/macvim.rb ... system \"./configure\", \"--with-features=huge\", \"--enable-multibyte\", \"--enable-perlinterp\", \"--enable-rubyinterp\", \"--enable-tclinterp\", \"--enable-terminal\", \"--with-tlib=ncurses\", \"--with-compiledby=Homebrew\", \"--with-local-dir=#{HOMEBREW_PREFIX}\", \"--enable-cscope\", \"--enable-luainterp\", \"--with-lua-prefix=#{Formula[\"lua\"].opt_prefix}\", \"--enable-luainterp\", \"--enable-python3interp\", \"--disable-sparkle\" ... # or $ brew -v edit macvim-dev/macvim/macvim manual install formula How to prevent homebrew from upgrading a package? $ brew -v edit macvim $ brew -v fetch --deps macvim $ brew -v install --build-from-source macvim $ brew pin macvim brew debug info$ brew info --analytics doctor $ brew doctor info $ brew config HOMEBREW_VERSION: 2.6.0-211-g2c77a54 ORIGIN: ${brew_source}/brew HEAD: 2c77a540b522c2eee74af0745851167412adb83b Last commit: 68 minutes ago Core tap ORIGIN: ${brew_source}/homebrew-core Core tap HEAD: 4fb418f9d1b35c372d82d0b49b0f1df9143be236 Core tap last commit: 20 minutes ago Core tap branch: master HOMEBREW_PREFIX: /usr/local HOMEBREW_CASK_OPTS: [] HOMEBREW_EDITOR: vim HOMEBREW_INSTALL_BADGE: ☕️ 🐸 HOMEBREW_MAKE_JOBS: 12 Homebrew Ruby: 2.6.3 => /System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/bin/ruby CPU: dodeca-core 64-bit kabylake Clang: 12.0 build 1200 Git: 2.29.2 => /usr/local/bin/git Curl: 7.64.1 => /usr/bin/curl Java: 1.8.271.09, 1.8.0_211 macOS: 11.0.1-x86_64 CLT: 12.2.0.0.1.1604076827 Xcode: 12.2 pathes $ brew --repository /usr/local/Homebrew $ brew --prefix python@3 /usr/local/opt/python@3.9 $ brew --cache /Users/marslo/Library/Caches/Homebre $ brew --repo homebrew/core /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core cleanup # Remove all cache files older than specified days $ brew cleanup --prune=1 # remove all caches $ brew cleanup -s check formula $ git -C \"$(brew --repo homebrew/core)\" show a2f05fb0b2^:Formula/rmtrash.rb class Rmtrash list the packages installed from taps $ brew tap-info --installed # or $ brew info $(brew list) | grep '^From:' | sort # or $ brew leaves | xargs brew info | grep '^From:' to get formula name $ brew tap-info macvim-dev/macvim --json | jq -r '.[]|(.formula_names[])' macvim-dev/macvim/macvim # or $ brew tap # get tap name $ TAP='homebrew/cask' $ brew tap-info $TAP --json | jq -r '.[]|(.cask_tokens[])' $ brew tap-info $TAP --json | jq -r '.[]|(.cask_tokens[])' | grep whatsapp homebrew/cask/chatmate-for-whatsapp homebrew/cask/whatsapp manual download and install from local # download manually due to proxy issue $ curl -O https://downloads.sourceforge.net/gptfdisk/gdisk-1.0.9.pkg $ mv gdisk-1.0.9.pkg $(brew --cache -s gdisk) check local cache path$ brew --cache -s check homebrew env $ brew shellenv export HOMEBREW_PREFIX=\"/usr/local\"; export HOMEBREW_CELLAR=\"/usr/local/Cellar\"; export HOMEBREW_REPOSITORY=\"/usr/local/Homebrew\"; export PATH=\"/usr/local/bin:/usr/local/sbin${PATH+:$PATH}\"; export MANPATH=\"/usr/local/share/man${MANPATH+:$MANPATH}:\"; export INFOPATH=\"/usr/local/share/info:${INFOPATH:-}\"; install dmg [!NOTE|label:referenees:] install docker desktop on mac MacOS/hdiutil hdiutil Can a Mac mount a Debian install CD? $ curl -O https://desktop.docker.com/mac/main/amd64/Docker.dmg $ sudo hdiutil attach Docker.dmg $ sudo /Volumes/Docker/Docker.app/Contents/MacOS/install $ sudo hdiutil detach /Volumes/Docker install pkg inside dmg $ curl -fsSL -O https://download.oracle.com/java/21/latest/jdk-21_macos-x64_bin.dmg $ hdiutil attach jdk-21_macos-x64_bin.dmg $ sudo installer -pkg /Volumes/JDK\\ 21.0.1/JDK\\ 21.0.1.pkg -target / $ sudo hdiutil detach /Volumes/JDK\\ 21.0.1/ system settings GNU Coreutils $ brew install coreutils GNU Command Line Tools$ cat /etc/bashrc export PATH=\"$(brew --prefix coreutils)/libexec/gnubin:/usr/local/bin:$PATH\" bash $ brew install bash $ which -a bash /usr/local/bin/bash /bin/bash $ /usr/local/bin/bash --version GNU bash, version 4.4.12(1)-release (x86_64-apple-darwin17.0.0) Copyright (C) 2016 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later This is free software; you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. $ /bin/bash --version GNU bash, version 3.2.57(1)-release (x86_64-apple-darwin17) Copyright (C) 2007 Free Software Foundation, Inc. development tools $ brew install binutils diffutils gawk ctags jshon colordiff tree p7zip gnutls gzip watch $ brew install jq --devel --HEAD $ brew install cmake --with-completion --HEAD $ brew install ed --with-default-names $ brew install findutils --with-default-names $ brew install gnu-tar --with-default-names $ brew install gnu-which --with-default-names $ brew install grep --with-default-names $ brew install gnu-indent --with-default-names $ brew install file-formula applications(brew, cask and mas) [!NOTE|label:youtube-dl example:] devynspencer/cute_commands.sh # save youtube videos from all chrome tabs $ chrome-cli list links | awk '{ print $2}' | sort -u | grep viewkey >> movies.db # download youtube videos from all chrome tabs $ chrome-cli list links | awk '{ print $2}' | grep viewkey | youtube-dl --external-downloader=aria2c --batch-file - # may cause wtf-mode on networking $ chrome-cli list links | awk '{ print $2}' | grep viewkey | youtube-dl --batch-file - $ brew tap homebrew/dupes # optional $ brew tap macvim-dev/macvim $ brew install vim --override-system-vi $ brew install macvim --with-override-system-vim --HEAD # OR $ brew install --HEAD macvim-dev/macvim/macvim $ brew install jfrog-cli-go # JFrog CLI OR $ CURL -FL HTTPS://XRAY.JFROG.IO | SH $ brew install mas # app tools like appstore $ brew install youtube-dl $ brew cask install firefox $ brew cask install google-chrome # or $ brew cask install google-chrome-dev $ brew cask install moom # instead of mas install 419330170 $ brew cask install dash $ brew cask install little-snitch $ brew cask install vlc $ mas install 1256503523 # System Indicators $ mas install 836500024 # WeChat $ mas install 1233593954 # MailMaster $ mas install 467939042 # Growl $ mas install 497799835 # Xcode $ mas install 736473980 # Paint $ mas install 520993579 # pwSafe $ mas install 944848654 # NeteaseMusic $ mas install 419330170 # Moom $ mas list 1256503523 System Indicators (1.0.6) 836500024 WeChat (2.3.5) 1233593954 MailMaster (2.2.2) 467939042 Growl (2.1.3) 497799835 Xcode (9.2) 736473980 Paint 2 (5.6.5) 520993579 pwSafe (4.11) 944848654 NeteaseMusic (1.5.7) 419330170 Moom (3.2.10) alternative list $ find /Applications/*.app/Contents/_MASReceipt/receipt -maxdepth 4 -print | sed 's#.app/Contents/_MASReceipt/receipt#.app#g; s#/Applications/##' Alfred.app Growl.app MailMaster.app Moom.app NeteaseMusic.app Paint S.app System Indicators.app WeChat.app Xcode.app pwSafe.app list formula [!NOTE|references:] brew leaves shows you all top-level packages; packages that are not dependencies List of all packages installed using Homebrew eguven/brew-list.sh list all $ brew leaves # or $ brew leaves --installed-on-request list all packages with dependencies $ brew deps --tree --installed --full-name # or $ brew deps --tree --installed ack adns aften aom ├── jpeg-xl │ ├── brotli │ ├── giflib │ ├── highway │ ├── imath │ ├── jpeg-turbo │ ├── libpng │ ├── little-cms2 │ │ ├── jpeg-turbo │ │ └── libtiff │ │ ├── jpeg-turbo │ │ └── zstd │ │ ├── lz4 │ │ └── xz ... list all formula size $ brew list --formula | xargs -n1 -P8 -I {} \\ sh -c \" brew info {} | \\ grep -E '[0-9]* files, ' | \\ sed 's/^.*[0-9]* files, \\(.*\\)).*$/{} \\1/' \" | sort -h -r -k2 - | column -t ghc 1.8GB ghc@8.6 1.3GB go 629.9MB openjdk 322.6MB binutils 165.0MB ghostscript 151.9MB ... list all formula descriptions $ brew leaves | xargs -n1 brew desc --eval-all ack: Search tool like grep, but optimized for programmers adns: C/C++ resolver library and DNS resolver utilities autoconf-archive: Collection of over 500 reusable autoconf macros automake: Tool for generating GNU Standards-compliant Makefiles bash-completion: Programmable completion for Bash 3.2 bash-completion@2: Programmable completion for Bash 4.2+ ... apt-file list [!NOTE|label:references:] How to find package for installed file in Brew? $ brew list git [--verbose] # or $ brew ls git [--verbose] /usr/local/Cellar/git/2.43.0/.bottle/etc/gitconfig /usr/local/Cellar/git/2.43.0/bin/git /usr/local/Cellar/git/2.43.0/bin/git-cvsserver /usr/local/Cellar/git/2.43.0/bin/git-receive-pack /usr/local/Cellar/git/2.43.0/bin/git-shell /usr/local/Cellar/git/2.43.0/bin/git-upload-archive /usr/local/Cellar/git/2.43.0/bin/git-upload-pack /usr/local/Cellar/git/2.43.0/bin/scalar /usr/local/Cellar/git/2.43.0/etc/bash_completion.d/ (2 files) /usr/local/Cellar/git/2.43.0/libexec/git-core/ (195 files) /usr/local/Cellar/git/2.43.0/share/doc/ (1025 files) /usr/local/Cellar/git/2.43.0/share/git-core/ (163 files) /usr/local/Cellar/git/2.43.0/share/gitweb/ (5 files) /usr/local/Cellar/git/2.43.0/share/locale/ (19 files) /usr/local/Cellar/git/2.43.0/share/man/ (195 files) /usr/local/Cellar/git/2.43.0/share/perl5/ (20 files) /usr/local/Cellar/git/2.43.0/share/zsh/ (2 files) whatprovides brew which-formula [!NOTE|label:references:] Homebrew/homebrew-command-not-found $ brew tap homebrew/command-not-found $ brew which-formula ts moreutils task-spooler brew-whatprovides $ cat >> ~/.bash_profile > searching in ${pkg} ...\" if brew list --verbose \"${pkg}\" 2>/dev/null | grep \"${_realp}\" >/dev/null 2>&1; then echo -ne \"\\r$(tput el)>> \\033[0;32m${_p}\\033[0m ( \\033[0;37m${_realp}\\033[0m ) provided by \\033[0;33m${pkg}\\033[0m\"; break; fi; done or $ touch /usr/local/bin/brew-whatprovides $ cat > /usr/local/bin/brew-whatprovides > searching in ${pkg} ...\" if brew list --verbose \"${pkg}\" 2>/dev/null | grep \"${_realp}\" >/dev/null 2>&1; then echo -ne \"\\r$(tput el)>> \\033[0;32m${_p}\\033[0m ( \\033[0;37m${_realp}\\033[0m ) provided by \\033[0;33m${pkg}\\033[0m\"; break; fi; done result # in progress $ brew-whatprovides $(which -a ts | head -1) >> searching in ffmpeg ... # this line is update timely # result $ brew-whatprovides $(which -a ts | head -1) >> /usr/local/bin/ts ( /usr/local/Cellar/moreutils/0.67/bin/ts ) provided by moreutils oneline cmd $ path='/path/to/file' $ brew list --formula | xargs -P8 -i bash -c \" if brew list --verbose {} 2>/dev/null | grep \\\"$(realpath ${path})\\\" >/dev/null 2>&1; then echo \\\">> ${path} is provided by {}\\\"; fi \" tools java [!NOTE|label:references:] Installing the JDK on macOS Uninstalling the JDK on macOS Java Platform, Standard Edition - JDK Installation Guide.pdf JDK Development Kit 21.0.1 downloads jdk-21_macos-x64_bin.dmg jdk-21_macos-x64_bin.tar.gz jdk-21_macos-aarch64_bin.dmg jdk-21_macos-aarch64_bin.tar.gz JDK Development Kit 17.0.9 downloads jdk-17_macos-x64_bin.dmg jdk-17_macos-x64_bin.tar.gz jdk-17_macos-aarch64_bin.dmg jdk-17_macos-aarch64_bin.tar.gz Java SE Development Kit 11.0.21 Java SE Development Kit 8u391 others wavezhang/java_download.sh How to install Java 21 and setup JAVA_HOME Path in macOS 🍏 (Apple Silicon M1 & M2) Why should I uninstall older versions of Java from my system? How do I uninstall Java on my Mac? How do I uninstall Java for Linux ? various versions /Library/Java/JavaVirtualMachines $ ls -Altrh /Library/Java/JavaVirtualMachines total 0 drwxr-xr-x 3 root wheel 96 Dec 14 2020 jdk1.8.0_271.jdk drwxr-xr-x 3 root wheel 96 Jul 19 2022 jdk-11.0.15.1.jdk drwxr-xr-x 3 root wheel 96 Oct 31 20:52 jdk-21.jdk drwxr-xr-x 3 root wheel 96 Oct 31 21:06 jdk-17.jdk default JAVA_HOME $ export JAVA_HOME=$(/usr/libexec/java_home) # or $ export JAVA_HOME=$(/usr/libexec/java_home -v 21) $ /usr/libexec/java_home /Library/Java/JavaVirtualMachines/jdk-21.jdk/Contents/Home java 17 $ export JAVA_HOME=$(/usr/libexec/java_home -v 17) # details $ /usr/libexec/java_home -v 17 /Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Home $ /usr/libexec/java_home -v 17 --exec java -version java version \"17.0.9\" 2023-10-17 LTS Java(TM) SE Runtime Environment (build 17.0.9+11-LTS-201) Java HotSpot(TM) 64-Bit Server VM (build 17.0.9+11-LTS-201, mixed mode, sharing java 11 $ export JAVA_HOME=$(/usr/libexec/java_home -v 11) # details $ /usr/libexec/java_home -v 11 /Library/Java/JavaVirtualMachines/jdk-11.0.15.1.jdk/Contents/Home java 8 $ export JAVA_HOME=$(/usr/libexec/java_home -v 1.8) $ /usr/libexec/java_home -v 1.8 /Library/Java/JavaVirtualMachines/jdk1.8.0_271.jdk/Contents/Home openjdk # jdk 21 $ brew install openjdk # jdk 17 $ brew install openjdk@17 # jdk 11 $ brew install openjdk@11 JAVA_HOME # java 21 $ export JAVA_HOME=\"$(brew --prefix java) # java 17 $ export JAVA_HOME=$(brew --prefix openjdk@17) # java 11 $ export JAVA_HOME=$(brew --prefix openjdk@11) remove old version Java [!NOTE|label:references:] 10 Installation of the JDK on macOS OpenJDK JDK 21.0.1 General-Availability Release How to uninstall Java on Mac sudo rm -fr /Library/Internet\\ Plug-Ins/JavaAppletPlugin.plugin sudo rm -fr /Library/PreferencePanes/JavaControlPanel.prefPane sudo rm -fr ~/Library/Application\\ Support/Oracle/Java accessory Alfred [!NOTE] workflow | Alfred Gallery units convertor deanishe/alfred-convert units Unit converter | wolph/alfred-converter | Advanced calculator with fast off-line unit converter calculate Calculate Anything system Backup Preferences pw: Pass | pass: the standard unix password manager HEIC to JPEG Flush DNS IP Address dev tools DevToys Hacker News Search gohoyer/Alfred-Cheat.sh iTerm2 Install Shell Integration$ curl -L https://iterm2.com/shell_integration/install_shell_integration_and_utilities.sh | bash more settings powerline [!NOTE|label:references] powerline/powerline * sbt: customize Shell Prompt with git branch (round 2) patmandenver/global.sbt romkatv/powerlevel10k install [!NOTE|label:references:] How to install Powerline to pimp your BASH prompt (For Mac) itzderr/install-powerline How to Jazz Up Your Bash Terminal — A Step By Step Guide With Pictures settings: * ryanoasis/powerline-extra-symbols works with fonts AurulentSansMono.tar.xz in ryanoasis/nerd-fonts/releases tvieira/ansible-powerline-fonts agemooij/sbt-prompt csivanich/dotfiles LeoJhonSong/power-python-prompt $ pip install --user powerline-status $ cat >> ~/.bash_profile settings in iTerm2: Use a different font for non-ASCII text font [!TIP] * iMarlso : fonts * iMarslo : fonts : powerline fonts backgroundmusic $ (set -eo pipefail; URL='https://github.com/kyleneideck/BackgroundMusic/archive/master.tar.gz'; \\ cd $(mktemp -d); echo Downloading $URL to $(pwd); curl -qfL# $URL | gzcat - | tar x && \\ /bin/bash BackgroundMusic-master/build_and_install.sh -w && rm -rf BackgroundMusic-master) logs $ (set -eo pipefail; URL='https://github.com/kyleneideck/BackgroundMusic/archive/master.tar.gz'; \\ -> cd $(mktemp -d); echo Downloading $URL to $(pwd); curl -qfL# $URL | gzcat - | tar x && \\ -> /bin/bash BackgroundMusic-master/build_and_install.sh -w && rm -rf BackgroundMusic-master) Downloading https://github.com/kyleneideck/BackgroundMusic/archive/master.tar.gz to /var/folders/dm/dblpttpn3c5cdvg_g2rthhvh0000gn/T/tmp.mixzjjg1 ######################################################################## 100.0% About to install Background Music. Please pause all audio, if you can. This script will install: - /Applications/Background Music.app - /Library/Audio/Plug-Ins/HAL/Background Music Device.driver - /Library/Application Support/Background Music/BGMXPCHelper.xpc - /Library/LaunchDaemons/com.bearisdriving.BGM.XPCHelper.plist Continue (y/N)? y Password: [1/3] Installing the virtual audio device Background Music Device.driver to /Library/Audio/Plug-Ins/HAL [2/3] Installing BGMXPCHelper.xpc to /Library/Application Support/Background Music [3/3] Installing Background Music.app to /Applications Restarting coreaudiod to load the virtual audio device. Launching Background Music. Done. mac cli $ sh -c \"$(curl -fsSL https://raw.githubusercontent.com/marslo/mac-cli/master/mac-cli/tools/install)\" example $ mac bluetooth:status Bluetooth: ON $ mac speedtest Testing internet connection speed... 4.2 Mbps ↓ others markdown-toc $ npm i -g --save markdown-toc --verbose doctoc $ npm install -g doctoc usage$ doctoc --gitlab my_osx.md $ doctoc --github --maxlevel 3 */*.md gitbook $ npm install gitbook-cli -g usage$ gitbook init $ gitbook serve $ gitbook build gitbook-summary $ npm install -g gitbook-summary usage:$ book sm -d -t 'life is hard, make it easier' npm-completion $ npm i -g npm-completion usage$ PATH_TO_NPM_COMPLETION=\"/usr/local/lib/node_modules/npm-completion\" $ source $PATH_TO_NPM_COMPLETION/npm-completion.sh reveal.js $ git clone git@github.com:hakimel/reveal.js.git $ cd reveal.js $ npm i -g usage$ npm start -- --port=8081 (http://localhost:8081) gnomon $ npm i -g gnomon usage$ ping 127.0.0.1 | gnomon 0.0066s PING 127.0.0.1 (127.0.0.1): 56 data bytes 0.8694s 18:13:43.219648 64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.048 ms 0.9999s 18:13:44.221333 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.116 ms 1.0004s 18:13:45.221475 64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.088 ms 1.0047s 18:13:46.222231 64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.059 ms 1.0001s 18:13:47.226847 64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.101 ms 1.0049s 18:13:48.227248 64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.100 ms 1.0049s 18:13:49.232354 64 bytes from 127.0.0.1: icmp_seq=6 ttl=64 time=0.093 ms 0.5038s 18:13:50.237433 64 bytes from 127.0.0.1: icmp_seq=7 ttl=64 time=0.091 ms iStats $ sudo gem install iStats -n /usr/local/bin usage $ istats all --- CPU Stats --- CPU temp: 57.19°C ▁▂▃▅▆▇ --- Fan Stats --- Total fans in system: 2 Fan 0 speed: 2146 RPM ▁▂▃▅▆▇ Fan 1 speed: 1985 RPM ▁▂▃▅▆▇ --- Battery Stats --- Battery health: unknown Cycle count: 34 ▁▂▃▅▆▇ 3.4% Max cycles: 1000 Current charge: 6073 mAh ▁▂▃▅▆▇ 100% Maximum charge: 6236 mAh ▁▂▃▅▆▇ 85.0% Design capacity: 7336 mAh Battery temp: 35.8°C For more stats run `istats extra` and follow the instructions. trouble shooting failed to connect to raw.githubusercontent.com port 443: connection refused issuefailed to connect to raw.githubusercontent.com port 443: connection refused solution $ sudo bash -c \" echo '199.232.28.133 raw.githubusercontent.com' >> /etc/hosts\" checking host IP address via https://www.ipaddress.com/ additional reference: DNS查询 iP或域名查询 flush DNS via sudo killall -HUP mDNSResponder sudo bash -c cat >> /etc/hosts failure in brew search for cask formula issue $ brew install --cask firefox-developer-edition Error: Cask 'firefox-developer-edition' is unavailable: No Cask with this name exists. $ brew search firefox ==> Casks firefox multifirefox solution $ git -C $(brew --repo homebrew/cask-versions) st On branch master Your branch is up to date with 'origin/master'. Changes not staged for commit: (use \"git add/rm ...\" to update what will be committed) (use \"git restore ...\" to discard changes in working directory) deleted: Casks/firefox-beta.rb deleted: Casks/firefox-developer-edition.rb deleted: Casks/firefox-esr.rb deleted: Casks/firefox-nightly.rb no changes added to commit (use \"git add\" and/or \"git commit -a\") $ git -C $(brew --repo homebrew/cask-versions) reset --hard HEAD is now at 67d487bd6 Update dotnet-preview from 6.0.0-preview.4.21253.7,bab80210-ac54-44fa-bf41-7474c6371cf2:eadcd657b93e347d08bc33c59bd60835 to 6.0.0-preview.5.21301.5,c326f2e1-10ee-482e-9871-5fb8de7f7777:dda8203d3b58e56efeca4a7248cdea67 (#11293) A fatal error has been detected by the Java Runtime Environment : SIGILL (0x4) error message $ groovyConsole 2023-11-01 18:49:18.068 java[17232:171223] WARNING: Secure coding is automatically enabled for restorable state! However, not on all supported macOS versions of this application. Opt-in to secure coding explicitly by implementing NSApplicationDelegate.applicationSupportsSecureRestorableState:. # # A fatal error has been detected by the Java Runtime Environment: # # SIGILL (0x4) at pc=0x00007ff8144c2bc5, pid=17232, tid=259 # # JRE version: OpenJDK Runtime Environment Homebrew (17.0.9) (build 17.0.9+0) # Java VM: OpenJDK 64-Bit Server VM Homebrew (17.0.9+0, mixed mode, sharing, tiered, compressed oops, compressed class ptrs, g1 gc, bsd-amd64) # Problematic frame: # C [AppKit+0xc92bc5] _NSCarbonMenuCrashIfNeeded+0x258 # # No core dump will be written. Core dumps have been disabled. To enable core dumping, try \"ulimit -c unlimited\" before starting Java again # # An error report file with more information is saved as: # /Users/marslo/hs_err_pid17232.log # # If you would like to submit a bug report, please visit: # https://github.com/Homebrew/homebrew-core/issues # The crash happened outside the Java Virtual Machine in native code. # See problematic frame for where to report the bug. # Abort trap: 6 # A fatal error has been detected by the Java Runtime Environment: # # SIGILL (0x4) at pc=0x00007ff804d60b73, pid=35543, tid=259 # # JRE version: OpenJDK Runtime Environment Homebrew (21.0.1) (build 21.0.1) # Java VM: OpenJDK 64-Bit Server VM Homebrew (21.0.1, mixed mode, sharing, tiered, compressed oops, compressed class ptrs, g1 gc, bsd-amd64) # Problematic frame: # C [AppKit+0xc8fb73] _NSCarbonMenuCrashIfNeeded+0x258 # # No core dump will be written. Core dumps have been disabled. To enable core dumping, try \"ulimit -c unlimited\" before starting Java again # # If you would like to submit a bug report, please visit: # https://github.com/Homebrew/homebrew-core/issues # The crash happened outside the Java Virtual Machine in native code. # See problematic frame for where to report the bug. # --------------- S U M M A R Y ------------ Command Line: -Dsun.awt.keepWorkingSetOnMinimize=true -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole -Dprogram.name=groovyConsole -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf -Dgroovy.home=/usr/local/opt/groovy/libexec -Dtools.jar=/usr/local/opt/openjdk/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter --main groovy.console.ui.Console --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf --classpath .:/usr/local/opt/openjdk/lib/tools.jar:/usr/local/opt/openjdk/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. Host: \"MacBookPro15,1\" x86_64 2200 MHz, 12 cores, 16G, Darwin 23.0.0, macOS 14.0 (23A344) Time: Tue Oct 31 20:37:27 2023 PDT elapsed time: 6.043659 seconds (0d 0h 0m 6s) --------------- T H R E A D --------------- Current thread (0x00007f7c35a9e600): JavaThread \"AppKit Thread\" daemon [_thread_in_native, id=259, stack(0x00007ff7b0184000,0x00007ff7b0984000) (8192K)] Stack: [0x00007ff7b0184000,0x00007ff7b0984000], sp=0x00007ff7b097c360, free space=8160k Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code) C [AppKit+0xc8fb73] _NSCarbonMenuCrashIfNeeded+0x258 C [AppKit+0xc8f898] _NSGetCarbonMenu+0xf C [JavaRuntimeSupport+0x307b] -[JRSMenu installCarbonEventHandlers:]+0xcc C [CoreFoundation+0x717b0] __CFNOTIFICATIONCENTER_IS_CALLING_OUT_TO_AN_OBSERVER__+0x89 C [CoreFoundation+0x102436] ___CFXRegistrationPost_block_invoke+0x58 C [CoreFoundation+0x102380] _CFXRegistrationPost+0x214 C [CoreFoundation+0x416bb] _CFXNotificationPost+0x2aa C [Foundation+0x87a7] -[NSNotificationCenter postNotificationName:object:userInfo:]+0x52 C [AppKit+0x3361c] -[NSMenu insertItem:atIndex:]+0x2e0 C [Foundation+0x7c2d5] __NSThreadPerformPerform+0xb2 C [CoreFoundation+0x7c337] __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__+0x11 C [CoreFoundation+0x7c2d9] __CFRunLoopDoSource0+0x9d C [CoreFoundation+0x7c0a4] __CFRunLoopDoSources0+0xd7 C [CoreFoundation+0x7ad21] __CFRunLoopRun+0x397 C [CoreFoundation+0x7a372] CFRunLoopRunSpecific+0x22d C [HIToolbox+0x309d9] RunCurrentEventLoopInMode+0x124 C [HIToolbox+0x307e6] ReceiveNextEventCommon+0x299 C [HIToolbox+0x30531] _BlockUntilNextEventMatchingListInModeWithFilter+0x42 C [AppKit+0x3f0c5] _DPSNextEvent+0x370 C [AppKit+0x930150] -[NSApplication(NSEventRouting) _nextEventMatchingEventMask:untilDate:inMode:dequeue:]+0x518 C [libosxapp.dylib+0x86aa] -[NSApplicationAWT nextEventMatchingMask:untilDate:inMode:dequeue:]+0x79 C [AppKit+0x3063a] -[NSApplication run]+0x25b C [libosxapp.dylib+0x8491] +[NSApplicationAWT runAWTLoopWithApp:]+0xa5 C [libawt_lwawt.dylib+0x719af] +[AWTStarter starter:headless:]+0x1fc C [libosxapp.dylib+0x9fa1] +[ThreadUtilities invokeBlockCopy:]+0xf C [Foundation+0x7c2d5] __NSThreadPerformPerform+0xb2 C [CoreFoundation+0x7c337] __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__+0x11 C [CoreFoundation+0x7c2d9] __CFRunLoopDoSource0+0x9d C [CoreFoundation+0x7c0a4] __CFRunLoopDoSources0+0xd7 C [CoreFoundation+0x7ad21] __CFRunLoopRun+0x397 C [CoreFoundation+0x7a372] CFRunLoopRunSpecific+0x22d C [libjli.dylib+0xb7ee] CreateExecutionEnvironment+0x17d C [libjli.dylib+0x78b5] JLI_Launch+0x4d5 C [java+0x3c11] main+0x163 C [dyld+0x63a6] start+0x796 siginfo: si_signo: 4 (SIGILL), si_code: 1 (ILL_ILLOPC), si_addr: 0x00007ff804d60b73 Registers: RAX=0x0000000000000000, RBX=0x000060000292ae60, RCX=0x0000000000000000, RDX=0x0000000000000000 RSP=0x00007ff7b097c360, RBP=0x00007ff7b097c470, RSI=0x000000001f08000c, RDI=0x0000000000000000 R8 =0x0000000000000000, R9 =0x0000000000000000, R10=0x0000000000000032, R11=0x0000000000000202 R12=0x0000000000000005, R13=0x00007ff800664900, R14=0x0000000000000000, R15=0x00007ff820780f15 RIP=0x00007ff804d60b73, EFLAGS=0x0000000000010206, ERR=0x0000000000000000 TRAPNO=0x0000000000000006 Register to memory mapping: RAX=0x0 is null RBX=0x000060000292ae60 points into unknown readable memory: 0x011dfff84401b391 | 91 b3 01 44 f8 ff 1d 01 RCX=0x0 is null RDX=0x0 is null RSP=0x00007ff7b097c360 is pointing into the stack for thread: 0x00007f7c35a9e600 RBP=0x00007ff7b097c470 is pointing into the stack for thread: 0x00007f7c35a9e600 RSI=0x000000001f08000c is an unknown value RDI=0x0 is null R8 =0x0 is null R9 =0x0 is null R10=0x0000000000000032 is an unknown value R11=0x0000000000000202 is an unknown value R12=0x0000000000000005 is an unknown value R13=0x00007ff800664900: objc_msgSend+0 in /usr/lib/libobjc.A.dylib at 0x00007ff80065e000 R14=0x0 is null R15=0x00007ff820780f15 points into unknown readable memory: 63 6f 6e Top of Stack: (sp=0x00007ff7b097c360) 0x00007ff7b097c360: 0000000000000010 00007ff7b097c3c0 0x00007ff7b097c370: 00007ff7b097c378 0000000000000023 0x00007ff7b097c380: 0000000000000000 0000000000000000 0x00007ff7b097c390: 0000000000000000 0000000000000000 0x00007ff7b097c3a0: 0000000000000023 0000000000000010 0x00007ff7b097c3b0: 0000600000e94060 0000000000000010 0x00007ff7b097c3c0: 000060000292ad80 000060000292adf0 0x00007ff7b097c3d0: 0000600002e8e300 000060000336d560 0x00007ff7b097c3e0: 0000600002e8e180 000060000292ae60 0x00007ff7b097c3f0: 000060000292aed0 000060000336e130 0x00007ff7b097c400: 000060000292af40 000060000292afb0 0x00007ff7b097c410: 000060000336e1c0 000060000292b020 0x00007ff7b097c420: 000060000292b090 000060000292b100 0x00007ff7b097c430: 000060000292b170 000060000292b1e0 0x00007ff7b097c440: 7a953567d9950019 0000600002117340 0x00007ff7b097c450: 00007ff800664900 0000000000041c00 0x00007ff7b097c460: 0000600002117340 00007ff820775786 0x00007ff7b097c470: 00007ff7b097c490 00007ff804d60898 0x00007ff7b097c480: 0000600002117340 0000600002117340 0x00007ff7b097c490: 00007ff7b097c500 00007ffb032b507b 0x00007ff7b097c4a0: 0000000000000000 0000000000000000 0x00007ff7b097c4b0: 0000000000000000 0000000000000000 0x00007ff7b097c4c0: 0000000000000000 0000000000000000 0x00007ff7b097c4d0: 3fe7f7f820000000 7a953567d9950019 0x00007ff7b097c4e0: 00007ff822b87d48 0000600000025080 0x00007ff7b097c4f0: 0000600002117340 0000000000000000 0x00007ff7b097c500: 00007ff7b097c540 00007ff800aff7b0 0x00007ff7b097c510: 7a953567d9950019 00007ff7b097c5b0 0x00007ff7b097c520: 0000600002117300 0000000000041c00 0x00007ff7b097c530: 00007ff7b097c6b8 0000000000000000 0x00007ff7b097c540: 00007ff7b097c570 00007ff800b90436 0x00007ff7b097c550: 00007ff822b87d48 0000000000000000 Instructions: (pc=0x00007ff804d60b73) 0x00007ff804d60a73: 89 c7 41 ff d5 48 89 85 48 ff ff ff 48 85 c0 0f 0x00007ff804d60a83: 84 df 00 00 00 48 8d 85 f0 fe ff ff 48 8b 40 10 0x00007ff804d60a93: 48 8b 00 48 89 85 30 ff ff ff 45 31 f6 4c 8b 3d 0x00007ff804d60aa3: 19 5e a0 3e 48 8b 85 48 ff ff ff 4c 01 f0 48 89 0x00007ff804d60ab3: 85 38 ff ff ff 45 31 e4 48 8b 85 00 ff ff ff 48 0x00007ff804d60ac3: 8b 8d 30 ff ff ff 48 39 08 74 0c 48 8b bd 40 ff 0x00007ff804d60ad3: ff ff e8 10 01 36 00 48 8b 85 f8 fe ff ff 4a 8b 0x00007ff804d60ae3: 1c e0 48 89 df 4c 89 fe 48 8d 15 b6 1b 84 3e 41 0x00007ff804d60af3: ff d5 84 c0 0f 85 0a ff ff ff 48 89 df 4c 89 fe 0x00007ff804d60b03: 48 8d 15 be 1b 84 3e 41 ff d5 84 c0 0f 85 f2 fe 0x00007ff804d60b13: ff ff 4b 8d 04 26 48 83 f8 04 7f 48 49 ff c4 4c 0x00007ff804d60b23: 39 a5 48 ff ff ff 75 90 41 b8 10 00 00 00 48 8b 0x00007ff804d60b33: bd 40 ff ff ff 48 8b 35 a9 68 a0 3e 48 8d 95 f0 0x00007ff804d60b43: fe ff ff 48 8d 8d 50 ff ff ff 41 ff d5 4c 8b b5 0x00007ff804d60b53: 38 ff ff ff 48 89 85 48 ff ff ff 48 85 c0 0f 85 0x00007ff804d60b63: 39 ff ff ff 48 8d 3d 9d 88 4a 00 e8 7d fa 35 00 0x00007ff804d60b73: 0f 0b e8 c2 f9 35 00 55 48 89 e5 41 56 53 41 89 0x00007ff804d60b83: f6 48 89 fb e8 8f fd ff ff 45 84 f6 74 35 48 8b 0x00007ff804d60b93: 35 68 f4 9e 3e 48 89 df ff 15 3f 76 7a 3e 48 89 0x00007ff804d60ba3: c3 48 8b 3d 5d d7 63 3d e8 be 00 36 00 48 89 df 0x00007ff804d60bb3: 48 89 c6 e8 a1 00 36 00 84 c0 74 13 31 c0 5b 41 0x00007ff804d60bc3: 5e 5d c3 48 89 df 5b 41 5e 5d e9 b7 fc ff ff 48 0x00007ff804d60bd3: 8b 35 9f f7 9e 3e 48 8d 15 08 1a 84 3e 48 89 df 0x00007ff804d60be3: ff 15 f7 75 7a 3e 84 c0 74 27 48 8b 35 dc 18 9f 0x00007ff804d60bf3: 3e 4c 8b 35 e5 75 7a 3e 48 89 df 41 ff d6 48 8b 0x00007ff804d60c03: 35 c8 22 9f 3e 48 89 df 4c 89 f0 5b 41 5e 5d ff 0x00007ff804d60c13: e0 48 8b 35 d5 3e 9e 3e 48 8d 15 c6 19 84 3e 48 0x00007ff804d60c23: 89 df b9 01 00 00 00 41 b8 01 00 00 00 5b 41 5e 0x00007ff804d60c33: 5d ff 25 a6 75 7a 3e 55 48 89 e5 e8 61 46 aa ff 0x00007ff804d60c43: 84 c0 74 15 48 8b 3d 82 cc 63 3d 48 8b 35 9b 37 0x00007ff804d60c53: 9e 3e 5d ff 25 84 75 7a 3e 5d e9 02 f5 35 00 55 0x00007ff804d60c63: 48 89 e5 41 56 53 48 83 ec 20 48 8b 05 8c 4f 7a Stack slot to memory mapping: stack at sp + 0 slots: 0x0000000000000010 is an unknown value stack at sp + 1 slots: 0x00007ff7b097c3c0 is pointing into the stack for thread: 0x00007f7c35a9e600 stack at sp + 2 slots: 0x00007ff7b097c378 is pointing into the stack for thread: 0x00007f7c35a9e600 stack at sp + 3 slots: 0x0000000000000023 is an unknown value stack at sp + 4 slots: 0x0 is null stack at sp + 5 slots: 0x0 is null stack at sp + 6 slots: 0x0 is null stack at sp + 7 slots: 0x0 is null --------------- P R O C E S S --------------- Threads class SMR info: _java_thread_list=0x00006000000d6740, length=21, elements={ 0x00007f7c36008200, 0x00007f7c34811a00, 0x00007f7c328a3200, 0x00007f7c34009200, 0x00007f7c34009a00, 0x00007f7c3400e600, 0x00007f7c328a3a00, 0x00007f7c3400ee00, 0x00007f7c38008800, 0x00007f7c3580be00, 0x00007f7c341d5a00, 0x00007f7c3385da00, 0x00007f7c34a90800, 0x00007f7c35a9e600, 0x00007f7c32c0a800, 0x00007f7c32b41000, 0x00007f7c343d3e00, 0x00007f7c358ee200, 0x00007f7c35e0a000, 0x00007f7c3668f400, 0x00007f7c33a12800 } Java Threads: ( => current thread ) 0x00007f7c36008200 JavaThread \"main\" [_thread_in_native, id=8451, stack(0x000070000ad10000,0x000070000ae10000) (1024K)] 0x00007f7c34811a00 JavaThread \"Reference Handler\" daemon [_thread_blocked, id=23299, stack(0x000070000b62e000,0x000070000b72e000) (1024K)] 0x00007f7c328a3200 JavaThread \"Finalizer\" daemon [_thread_blocked, id=32003, stack(0x000070000b731000,0x000070000b831000) (1024K)] 0x00007f7c34009200 JavaThread \"Signal Dispatcher\" daemon [_thread_blocked, id=23811, stack(0x000070000b834000,0x000070000b934000) (1024K)] 0x00007f7c34009a00 JavaThread \"Service Thread\" daemon [_thread_blocked, id=24323, stack(0x000070000b937000,0x000070000ba37000) (1024K)] 0x00007f7c3400e600 JavaThread \"Monitor Deflation Thread\" daemon [_thread_blocked, id=31747, stack(0x000070000ba3a000,0x000070000bb3a000) (1024K)] 0x00007f7c328a3a00 JavaThread \"C2 CompilerThread0\" daemon [_thread_blocked, id=24835, stack(0x000070000bb3d000,0x000070000bc3d000) (1024K)] 0x00007f7c3400ee00 JavaThread \"C1 CompilerThread0\" daemon [_thread_blocked, id=30979, stack(0x000070000bc40000,0x000070000bd40000) (1024K)] 0x00007f7c38008800 JavaThread \"Notification Thread\" daemon [_thread_blocked, id=25091, stack(0x000070000bd43000,0x000070000be43000) (1024K)] 0x00007f7c3580be00 JavaThread \"Common-Cleaner\" daemon [_thread_blocked, id=25603, stack(0x000070000be46000,0x000070000bf46000) (1024K)] 0x00007f7c341d5a00 JavaThread \"Timer-0\" daemon [_thread_blocked, id=27907, stack(0x000070000c55b000,0x000070000c65b000) (1024K)] 0x00007f7c3385da00 JavaThread \"ForkJoinPool.commonPool-worker-1\" daemon [_thread_blocked, id=28931, stack(0x000070000c65e000,0x000070000c75e000) (1024K)] 0x00007f7c34a90800 JavaThread \"ForkJoinPool.commonPool-worker-2\" daemon [_thread_blocked, id=28675, stack(0x000070000c761000,0x000070000c861000) (1024K)] =>0x00007f7c35a9e600 JavaThread \"AppKit Thread\" daemon [_thread_in_native, id=259, stack(0x00007ff7b0184000,0x00007ff7b0984000) (8192K)] 0x00007f7c32c0a800 JavaThread \"Image Fetcher 0\" daemon [_thread_blocked, id=75011, stack(0x000070000d38e000,0x000070000d48e000) (1024K)] 0x00007f7c32b41000 JavaThread \"Java2D Queue Flusher\" daemon [_thread_blocked, id=129803, stack(0x000070000d491000,0x000070000d591000) (1024K)] 0x00007f7c343d3e00 JavaThread \"Java2D Disposer\" daemon [_thread_blocked, id=128771, stack(0x000070000d594000,0x000070000d694000) (1024K)] 0x00007f7c358ee200 JavaThread \"AWT-Shutdown\" [_thread_blocked, id=128531, stack(0x000070000bf49000,0x000070000c049000) (1024K)] 0x00007f7c35e0a000 JavaThread \"AWT-EventQueue-0\" [_thread_blocked, id=44299, stack(0x000070000c967000,0x000070000ca67000) (1024K)] 0x00007f7c3668f400 JavaThread \"Event Dispatch Thread\" daemon [_thread_blocked, id=81683, stack(0x000070000cd7c000,0x000070000ce7c000) (1024K)] 0x00007f7c33a12800 JavaThread \"C2 CompilerThread1\" daemon [_thread_blocked, id=80147, stack(0x000070000d697000,0x000070000d797000) (1024K)] Total: 21 Other Threads: 0x00007f7c33206470 VMThread \"VM Thread\" [id=18435, stack(0x000070000b425000,0x000070000b525000) (1024K)] 0x00007f7c32709da0 WatcherThread \"VM Periodic Task Thread\" [id=20995, stack(0x000070000b322000,0x000070000b422000) (1024K)] 0x00007f7c33107da0 WorkerThread \"GC Thread#0\" [id=13827, stack(0x000070000ae13000,0x000070000af13000) (1024K)] 0x00007f7c33110530 WorkerThread \"GC Thread#1\" [id=26115, stack(0x000070000c04c000,0x000070000c14c000) (1024K)] 0x00007f7c33110aa0 WorkerThread \"GC Thread#2\" [id=26627, stack(0x000070000c14f000,0x000070000c24f000) (1024K)] 0x00007f7c33111010 WorkerThread \"GC Thread#3\" [id=29955, stack(0x000070000c252000,0x000070000c352000) (1024K)] 0x00007f7c33111580 WorkerThread \"GC Thread#4\" [id=27139, stack(0x000070000c355000,0x000070000c455000) (1024K)] 0x00007f7c33510830 WorkerThread \"GC Thread#5\" [id=27395, stack(0x000070000c458000,0x000070000c558000) (1024K)] 0x00007f7c3322dd40 WorkerThread \"GC Thread#6\" [id=32771, stack(0x000070000c864000,0x000070000c964000) (1024K)] 0x00007f7c32754290 WorkerThread \"GC Thread#7\" [id=76551, stack(0x000070000ce7f000,0x000070000cf7f000) (1024K)] 0x00007f7c32754800 WorkerThread \"GC Thread#8\" [id=74247, stack(0x000070000cf82000,0x000070000d082000) (1024K)] 0x00007f7c3343a040 WorkerThread \"GC Thread#9\" [id=76299, stack(0x000070000d085000,0x000070000d185000) (1024K)] 0x00007f7c327044c0 ConcurrentGCThread \"G1 Main Marker\" [id=13571, stack(0x000070000af16000,0x000070000b016000) (1024K)] 0x00007f7c32704e30 WorkerThread \"G1 Conc#0\" [id=12803, stack(0x000070000b019000,0x000070000b119000) (1024K)] 0x00007f7c32755440 WorkerThread \"G1 Conc#1\" [id=76035, stack(0x000070000d188000,0x000070000d288000) (1024K)] 0x00007f7c327557e0 WorkerThread \"G1 Conc#2\" [id=75523, stack(0x000070000d28b000,0x000070000d38b000) (1024K)] 0x00007f7c32892a00 ConcurrentGCThread \"G1 Refine#0\" [id=16387, stack(0x000070000b11c000,0x000070000b21c000) (1024K)] 0x00007f7c32708550 ConcurrentGCThread \"G1 Service\" [id=16643, stack(0x000070000b21f000,0x000070000b31f000) (1024K)] Total: 18 Threads with active compile tasks: Total: 0 VM state: not at safepoint (normal execution) VM Mutex/Monitor currently owned by a thread: None Heap address: 0x0000000700000000, size: 4096 MB, Compressed Oops mode: Zero based, Oop shift amount: 3 CDS archive(s) mapped at: [0x0000000130000000-0x0000000130ca1000-0x0000000130ca1000), size 13242368, SharedBaseAddress: 0x0000000130000000, ArchiveRelocationMode: 1. Compressed class space mapped at: 0x0000000131000000-0x0000000171000000, reserved size: 1073741824 Narrow klass base: 0x0000000130000000, Narrow klass shift: 0, Narrow klass range: 0x100000000 GC Precious Log: CardTable entry size: 512 Card Set container configuration: InlinePtr #cards 4 size 8 Array Of Cards #cards 16 size 48 Howl #buckets 8 coarsen threshold 3686 Howl Bitmap #cards 512 size 80 coarsen threshold 460 Card regions per heap region 1 cards per card region 4096 CPUs: 12 total, 12 available Memory: 16384M Large Page Support: Disabled NUMA Support: Disabled Compressed Oops: Enabled (Zero based) Heap Region Size: 2M Heap Min Capacity: 8M Heap Initial Capacity: 256M Heap Max Capacity: 4G Pre-touch: Disabled Parallel Workers: 10 Concurrent Workers: 3 Concurrent Refinement Workers: 10 Periodic GC: Disabled Heap: garbage-first heap total 102400K, used 68456K [0x0000000700000000, 0x0000000800000000) region size 2048K, 22 young (45056K), 4 survivors (8192K) Metaspace used 34673K, committed 35712K, reserved 1114112K class space used 4388K, committed 4864K, reserved 1048576K Heap Regions: E=young(eden), S=young(survivor), O=old, HS=humongous(starts), HC=humongous(continues), CS=collection set, F=free, TAMS=top-at-mark-start, PB=parsable bottom | 0|0x0000000700000000, 0x0000000700200000, 0x0000000700200000|100%| O| |TAMS 0x0000000700000000| PB 0x0000000700000000| Untracked | 1|0x0000000700200000, 0x0000000700400000, 0x0000000700400000|100%| O| |TAMS 0x0000000700200000| PB 0x0000000700200000| Untracked | 2|0x0000000700400000, 0x0000000700600000, 0x0000000700600000|100%| O| |TAMS 0x0000000700400000| PB 0x0000000700400000| Untracked | 3|0x0000000700600000, 0x0000000700800000, 0x0000000700800000|100%| O| |TAMS 0x0000000700600000| PB 0x0000000700600000| Untracked | 4|0x0000000700800000, 0x0000000700a00000, 0x0000000700a00000|100%| O| |TAMS 0x0000000700800000| PB 0x0000000700800000| Untracked | 5|0x0000000700a00000, 0x0000000700c00000, 0x0000000700c00000|100%| O| |TAMS 0x0000000700a00000| PB 0x0000000700a00000| Untracked | 6|0x0000000700c00000, 0x0000000700e00000, 0x0000000700e00000|100%| O| |TAMS 0x0000000700c00000| PB 0x0000000700c00000| Untracked | 7|0x0000000700e00000, 0x0000000700e443a0, 0x0000000701000000| 13%| O|Cm|TAMS 0x0000000700e00000| PB 0x0000000700e00000| Complete | 8|0x0000000701000000, 0x0000000701200000, 0x0000000701200000|100%| O| |TAMS 0x0000000701000000| PB 0x0000000701000000| Untracked | 9|0x0000000701200000, 0x0000000701400000, 0x0000000701400000|100%| O| |TAMS 0x0000000701200000| PB 0x0000000701200000| Untracked | 10|0x0000000701400000, 0x0000000701600000, 0x0000000701600000|100%| O| |TAMS 0x0000000701400000| PB 0x0000000701400000| Untracked | 11|0x0000000701600000, 0x0000000701800000, 0x0000000701800000|100%| O| |TAMS 0x0000000701600000| PB 0x0000000701600000| Untracked | 12|0x0000000701800000, 0x0000000701992c00, 0x0000000701a00000| 78%| O| |TAMS 0x0000000701800000| PB 0x0000000701800000| Untracked | 13|0x0000000701a00000, 0x0000000701a00000, 0x0000000701c00000| 0%| F| |TAMS 0x0000000701a00000| PB 0x0000000701a00000| Untracked | 14|0x0000000701c00000, 0x0000000701c00000, 0x0000000701e00000| 0%| F| |TAMS 0x0000000701c00000| PB 0x0000000701c00000| Untracked | 15|0x0000000701e00000, 0x0000000702000000, 0x0000000702000000|100%| S|CS|TAMS 0x0000000701e00000| PB 0x0000000701e00000| Complete | 16|0x0000000702000000, 0x0000000702200000, 0x0000000702200000|100%| S|CS|TAMS 0x0000000702000000| PB 0x0000000702000000| Complete | 17|0x0000000702200000, 0x0000000702400000, 0x0000000702400000|100%| S|CS|TAMS 0x0000000702200000| PB 0x0000000702200000| Complete | 18|0x0000000702400000, 0x0000000702600000, 0x0000000702600000|100%| S|CS|TAMS 0x0000000702400000| PB 0x0000000702400000| Complete | 19|0x0000000702600000, 0x0000000702600000, 0x0000000702800000| 0%| F| |TAMS 0x0000000702600000| PB 0x0000000702600000| Untracked | 20|0x0000000702800000, 0x0000000702800000, 0x0000000702a00000| 0%| F| |TAMS 0x0000000702800000| PB 0x0000000702800000| Untracked | 21|0x0000000702a00000, 0x0000000702a00000, 0x0000000702c00000| 0%| F| |TAMS 0x0000000702a00000| PB 0x0000000702a00000| Untracked | 22|0x0000000702c00000, 0x0000000702c00000, 0x0000000702e00000| 0%| F| |TAMS 0x0000000702c00000| PB 0x0000000702c00000| Untracked | 23|0x0000000702e00000, 0x0000000702e00000, 0x0000000703000000| 0%| F| |TAMS 0x0000000702e00000| PB 0x0000000702e00000| Untracked | 24|0x0000000703000000, 0x0000000703000000, 0x0000000703200000| 0%| F| |TAMS 0x0000000703000000| PB 0x0000000703000000| Untracked | 25|0x0000000703200000, 0x0000000703200000, 0x0000000703400000| 0%| F| |TAMS 0x0000000703200000| PB 0x0000000703200000| Untracked | 26|0x0000000703400000, 0x0000000703400000, 0x0000000703600000| 0%| F| |TAMS 0x0000000703400000| PB 0x0000000703400000| Untracked | 27|0x0000000703600000, 0x0000000703600000, 0x0000000703800000| 0%| F| |TAMS 0x0000000703600000| PB 0x0000000703600000| Untracked | 28|0x0000000703800000, 0x0000000703800000, 0x0000000703a00000| 0%| F| |TAMS 0x0000000703800000| PB 0x0000000703800000| Untracked | 29|0x0000000703a00000, 0x0000000703a00000, 0x0000000703c00000| 0%| F| |TAMS 0x0000000703a00000| PB 0x0000000703a00000| Untracked | 30|0x0000000703c00000, 0x0000000703c00000, 0x0000000703e00000| 0%| F| |TAMS 0x0000000703c00000| PB 0x0000000703c00000| Untracked | 31|0x0000000703e00000, 0x0000000703f30e08, 0x0000000704000000| 59%| E| |TAMS 0x0000000703e00000| PB 0x0000000703e00000| Complete | 32|0x0000000704000000, 0x0000000704200000, 0x0000000704200000|100%| E|CS|TAMS 0x0000000704000000| PB 0x0000000704000000| Complete | 33|0x0000000704200000, 0x0000000704400000, 0x0000000704400000|100%| E|CS|TAMS 0x0000000704200000| PB 0x0000000704200000| Complete | 34|0x0000000704400000, 0x0000000704600000, 0x0000000704600000|100%| E|CS|TAMS 0x0000000704400000| PB 0x0000000704400000| Complete | 35|0x0000000704600000, 0x0000000704800000, 0x0000000704800000|100%| E|CS|TAMS 0x0000000704600000| PB 0x0000000704600000| Complete | 36|0x0000000704800000, 0x0000000704a00000, 0x0000000704a00000|100%| E|CS|TAMS 0x0000000704800000| PB 0x0000000704800000| Complete | 37|0x0000000704a00000, 0x0000000704c00000, 0x0000000704c00000|100%| E|CS|TAMS 0x0000000704a00000| PB 0x0000000704a00000| Complete | 38|0x0000000704c00000, 0x0000000704e00000, 0x0000000704e00000|100%| E|CS|TAMS 0x0000000704c00000| PB 0x0000000704c00000| Complete | 39|0x0000000704e00000, 0x0000000705000000, 0x0000000705000000|100%| E|CS|TAMS 0x0000000704e00000| PB 0x0000000704e00000| Complete | 40|0x0000000705000000, 0x0000000705200000, 0x0000000705200000|100%| E|CS|TAMS 0x0000000705000000| PB 0x0000000705000000| Complete | 41|0x0000000705200000, 0x0000000705400000, 0x0000000705400000|100%| E|CS|TAMS 0x0000000705200000| PB 0x0000000705200000| Complete | 42|0x0000000705400000, 0x0000000705600000, 0x0000000705600000|100%| E|CS|TAMS 0x0000000705400000| PB 0x0000000705400000| Complete | 120|0x000000070f000000, 0x000000070f200000, 0x000000070f200000|100%| E|CS|TAMS 0x000000070f000000| PB 0x000000070f000000| Complete | 121|0x000000070f200000, 0x000000070f400000, 0x000000070f400000|100%| E|CS|TAMS 0x000000070f200000| PB 0x000000070f200000| Complete | 122|0x000000070f400000, 0x000000070f600000, 0x000000070f600000|100%| E|CS|TAMS 0x000000070f400000| PB 0x000000070f400000| Complete | 123|0x000000070f600000, 0x000000070f800000, 0x000000070f800000|100%| E|CS|TAMS 0x000000070f600000| PB 0x000000070f600000| Complete | 124|0x000000070f800000, 0x000000070fa00000, 0x000000070fa00000|100%| E|CS|TAMS 0x000000070f800000| PB 0x000000070f800000| Complete | 127|0x000000070fe00000, 0x0000000710000000, 0x0000000710000000|100%| E|CS|TAMS 0x000000070fe00000| PB 0x000000070fe00000| Complete |2047|0x00000007ffe00000, 0x00000007fff030b8, 0x0000000800000000| 50%| O| |TAMS 0x00000007ffe00000| PB 0x00000007ffe00000| Untracked Card table byte_map: [0x00000001290db000,0x00000001298db000] _byte_map_base: 0x00000001258db000 Marking Bits: (CMBitMap*) 0x00007f7c3280a210 Bits: [0x00000001298db000, 0x000000012d8db000) Polling page: 0x000000010f5a4000 Metaspace: Usage: Non-class: 29.58 MB used. Class: 4.29 MB used. Both: 33.86 MB used. Virtual space: Non-class space: 64.00 MB reserved, 30.12 MB ( 47%) committed, 1 nodes. Class space: 1.00 GB reserved, 4.75 MB ( (12 bytes) Event: 6.033 Thread 0x00007f7c3400ee00 nmethod 5488 0x000000011abb2790 code [0x000000011abb2940, 0x000000011abb2a78] Event: 6.033 Thread 0x00007f7c3400ee00 5491 3 java.lang.invoke.LambdaForm$NamedFunction:: (7 bytes) Event: 6.033 Thread 0x00007f7c3400ee00 nmethod 5491 0x000000011abb2b10 code [0x000000011abb2cc0, 0x000000011abb2f18] GC Heap History (10 events): Event: 0.632 GC heap before {Heap before GC invocations=0 (full 0): garbage-first heap total 264192K, used 21516K [0x0000000700000000, 0x0000000800000000) region size 2048K, 11 young (22528K), 0 survivors (0K) Metaspace used 7251K, committed 7424K, reserved 1114112K class space used 736K, committed 832K, reserved 1048576K } Event: 0.637 GC heap after {Heap after GC invocations=1 (full 0): garbage-first heap total 264192K, used 6251K [0x0000000700000000, 0x0000000800000000) region size 2048K, 2 young (4096K), 2 survivors (4096K) Metaspace used 7251K, committed 7424K, reserved 1114112K class space used 736K, committed 832K, reserved 1048576K } Event: 0.966 GC heap before {Heap before GC invocations=1 (full 0): garbage-first heap total 264192K, used 30827K [0x0000000700000000, 0x0000000800000000) region size 2048K, 14 young (28672K), 2 survivors (4096K) Metaspace used 10490K, committed 10880K, reserved 1114112K class space used 1142K, committed 1344K, reserved 1048576K } Event: 0.972 GC heap after {Heap after GC invocations=2 (full 0): garbage-first heap total 264192K, used 10759K [0x0000000700000000, 0x0000000800000000) region size 2048K, 2 young (4096K), 2 survivors (4096K) Metaspace used 10490K, committed 10880K, reserved 1114112K class space used 1142K, committed 1344K, reserved 1048576K } Event: 2.687 GC heap before {Heap before GC invocations=2 (full 0): garbage-first heap total 264192K, used 72199K [0x0000000700000000, 0x0000000800000000) region size 2048K, 32 young (65536K), 2 survivors (4096K) Metaspace used 20480K, committed 21120K, reserved 1114112K class space used 2419K, committed 2688K, reserved 1048576K } Event: 2.703 GC heap after {Heap after GC invocations=3 (full 0): garbage-first heap total 264192K, used 23837K [0x0000000700000000, 0x0000000800000000) region size 2048K, 4 young (8192K), 4 survivors (8192K) Metaspace used 20480K, committed 21120K, reserved 1114112K class space used 2419K, committed 2688K, reserved 1048576K } Event: 2.804 GC heap before {Heap before GC invocations=3 (full 0): garbage-first heap total 264192K, used 27933K [0x0000000700000000, 0x0000000800000000) region size 2048K, 7 young (14336K), 4 survivors (8192K) Metaspace used 20806K, committed 21504K, reserved 1114112K class space used 2469K, committed 2816K, reserved 1048576K } Event: 2.812 GC heap after {Heap after GC invocations=4 (full 0): garbage-first heap total 264192K, used 25885K [0x0000000700000000, 0x0000000800000000) region size 2048K, 5 young (10240K), 5 survivors (10240K) Metaspace used 20806K, committed 21504K, reserved 1114112K class space used 2469K, committed 2816K, reserved 1048576K } Event: 3.900 GC heap before {Heap before GC invocations=5 (full 0): garbage-first heap total 102400K, used 77085K [0x0000000700000000, 0x0000000800000000) region size 2048K, 30 young (61440K), 5 survivors (10240K) Metaspace used 28344K, committed 29184K, reserved 1114112K class space used 3543K, committed 3904K, reserved 1048576K } Event: 3.916 GC heap after {Heap after GC invocations=6 (full 0): garbage-first heap total 102400K, used 33640K [0x0000000700000000, 0x0000000800000000) region size 2048K, 4 young (8192K), 4 survivors (8192K) Metaspace used 28344K, committed 29184K, reserved 1114112K class space used 3543K, committed 3904K, reserved 1048576K } Dll operation events (11 events): Event: 0.006 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libjava.dylib Event: 0.046 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libnio.dylib Event: 0.061 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libzip.dylib Event: 0.253 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libjimage.dylib Event: 0.757 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libprefs.dylib Event: 0.897 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libnet.dylib Event: 1.057 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libverify.dylib Event: 1.408 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libawt.dylib Event: 1.436 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libawt_lwawt.dylib Event: 1.470 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libfontmanager.dylib Event: 1.954 Loaded shared library /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libosxui.dylib Deoptimization events (20 events): Event: 5.929 Thread 0x00007f7c36008200 Uncommon trap: trap_request=0xffffffde fr.pc=0x0000000121debcac relative=0x0000000000000dac Event: 5.929 Thread 0x00007f7c36008200 Uncommon trap: reason=class_check action=maybe_recompile pc=0x0000000121debcac method=java.util.concurrent.ConcurrentHashMap.putVal(Ljava/lang/Object;Ljava/lang/Object;Z)Ljava/lang/Object; @ 159 c2 Event: 5.929 Thread 0x00007f7c36008200 DEOPT PACKING pc=0x0000000121debcac sp=0x000070000ae0c300 Event: 5.929 Thread 0x00007f7c36008200 DEOPT UNPACKING pc=0x0000000121665f99 sp=0x000070000ae0c280 mode 2 Event: 5.932 Thread 0x00007f7c36008200 Uncommon trap: trap_request=0xffffffde fr.pc=0x0000000121debcac relative=0x0000000000000dac Event: 5.932 Thread 0x00007f7c36008200 Uncommon trap: reason=class_check action=maybe_recompile pc=0x0000000121debcac method=java.util.concurrent.ConcurrentHashMap.putVal(Ljava/lang/Object;Ljava/lang/Object;Z)Ljava/lang/Object; @ 159 c2 Event: 5.932 Thread 0x00007f7c36008200 DEOPT PACKING pc=0x0000000121debcac sp=0x000070000ae0c300 Event: 5.932 Thread 0x00007f7c36008200 DEOPT UNPACKING pc=0x0000000121665f99 sp=0x000070000ae0c280 mode 2 Event: 5.943 Thread 0x00007f7c36008200 Uncommon trap: trap_request=0xffffffde fr.pc=0x0000000121c57908 relative=0x00000000000004e8 Event: 5.943 Thread 0x00007f7c36008200 Uncommon trap: reason=class_check action=maybe_recompile pc=0x0000000121c57908 method=java.util.stream.ReferencePipeline.forEachWithCancel(Ljava/util/Spliterator;Ljava/util/stream/Sink;)Z @ 1 c2 Event: 5.943 Thread 0x00007f7c36008200 DEOPT PACKING pc=0x0000000121c57908 sp=0x000070000ae0bfe0 Event: 5.943 Thread 0x00007f7c36008200 DEOPT UNPACKING pc=0x0000000121665f99 sp=0x000070000ae0bfa0 mode 2 Event: 5.943 Thread 0x00007f7c36008200 Uncommon trap: trap_request=0xffffffde fr.pc=0x0000000121c57908 relative=0x00000000000004e8 Event: 5.943 Thread 0x00007f7c36008200 Uncommon trap: reason=class_check action=maybe_recompile pc=0x0000000121c57908 method=java.util.stream.ReferencePipeline.forEachWithCancel(Ljava/util/Spliterator;Ljava/util/stream/Sink;)Z @ 1 c2 Event: 5.943 Thread 0x00007f7c36008200 DEOPT PACKING pc=0x0000000121c57908 sp=0x000070000ae0c0a0 Event: 5.943 Thread 0x00007f7c36008200 DEOPT UNPACKING pc=0x0000000121665f99 sp=0x000070000ae0c060 mode 2 Event: 6.016 Thread 0x00007f7c35a9e600 Uncommon trap: trap_request=0xffffff45 fr.pc=0x0000000121e5f1ec relative=0x000000000000012c Event: 6.016 Thread 0x00007f7c35a9e600 Uncommon trap: reason=unstable_if action=reinterpret pc=0x0000000121e5f1ec method=java.lang.StrictMath.floorOrCeil(DDDD)D @ 115 c2 Event: 6.016 Thread 0x00007f7c35a9e600 DEOPT PACKING pc=0x0000000121e5f1ec sp=0x00007ff7b097b5c0 Event: 6.016 Thread 0x00007f7c35a9e600 DEOPT UNPACKING pc=0x0000000121665f99 sp=0x00007ff7b097b508 mode 2 Classes loaded (20 events): Event: 6.029 Loading class java/awt/MenuItem$1 Event: 6.029 Loading class sun/awt/AWTAccessor$MenuItemAccessor Event: 6.029 Loading class sun/awt/AWTAccessor$MenuItemAccessor done Event: 6.029 Loading class java/awt/MenuItem$1 done Event: 6.029 Loading class java/awt/Menu$1 Event: 6.029 Loading class sun/awt/AWTAccessor$MenuAccessor Event: 6.029 Loading class sun/awt/AWTAccessor$MenuAccessor done Event: 6.029 Loading class java/awt/Menu$1 done Event: 6.029 Loading class com/apple/laf/ScreenMenu$1 Event: 6.029 Loading class com/apple/laf/ScreenMenu$1 done Event: 6.029 Loading class com/apple/laf/ScreenMenuItem Event: 6.029 Loading class com/apple/laf/ScreenMenuItem done Event: 6.029 Loading class com/apple/laf/ScreenMenuItemUI Event: 6.029 Loading class com/apple/laf/ScreenMenuItemUI done Event: 6.030 Loading class sun/lwawt/macosx/CMenu Event: 6.030 Loading class sun/lwawt/macosx/CMenuItem Event: 6.030 Loading class sun/lwawt/macosx/CMenuItem done Event: 6.030 Loading class sun/lwawt/macosx/CMenu done Event: 6.030 Loading class sun/lwawt/macosx/CFRetainedResource$CFNativeActionGet Event: 6.030 Loading class sun/lwawt/macosx/CFRetainedResource$CFNativeActionGet done Classes unloaded (0 events): No events Classes redefined (0 events): No events Internal exceptions (20 events): Event: 5.912 Thread 0x00007f7c36008200 Exception (0x0000000704218608) thrown [src/hotspot/share/classfile/systemDictionary.cpp, line 312] Event: 5.913 Thread 0x00007f7c36008200 Exception (0x00000007042211c0) thrown [src/hotspot/share/classfile/systemDictionary.cpp, line 312] Event: 5.916 Thread 0x00007f7c36008200 Exception (0x0000000704280528) thrown [src/hotspot/share/classfile/systemDictionary.cpp, line 312] Event: 5.916 Thread 0x00007f7c36008200 Exception (0x0000000704284838) thrown [src/hotspot/share/classfile/systemDictionary.cpp, line 312] Event: 5.916 Thread 0x00007f7c36008200 Exception (0x0000000704288b38) thrown [src/hotspot/share/classfile/systemDictionary.cpp, line 312] Event: 5.916 Thread 0x00007f7c36008200 Exception (0x0000000704296dd8) thrown [src/hotspot/share/classfile/systemDictionary.cpp, line 312] Event: 5.917 Thread 0x00007f7c36008200 Exception (0x000000070429ffa8) thrown [src/hotspot/share/interpreter/linkResolver.cpp, line 773] Event: 5.920 Thread 0x00007f7c36008200 Exception (0x00000007042dcec8) thrown [src/hotspot/share/classfile/systemDictionary.cpp, line 312] Event: 5.920 Thread 0x00007f7c36008200 Exception (0x00000007042e10f0) thrown [src/hotspot/share/classfile/systemDictionary.cpp, line 312] Event: 5.951 Thread 0x00007f7c36008200 Exception (0x0000000703e47270) thrown [src/hotspot/share/classfile/systemDictionary.cpp, line 312] Event: 5.951 Thread 0x00007f7c36008200 Exception (0x0000000703e4c750) thrown [src/hotspot/share/classfile/systemDictionary.cpp, line 312] Event: 5.951 Thread 0x00007f7c36008200 Exception (0x0000000703e53630) thrown [src/hotspot/share/interpreter/linkResolver.cpp, line 311] Event: 5.962 Thread 0x00007f7c36008200 Exception (0x0000000703e67d88) thrown [src/hotspot/share/interpreter/linkResolver.cpp, line 773] Event: 5.962 Thread 0x00007f7c36008200 Exception (0x0000000703e6b818) thrown [src/hotspot/share/interpreter/linkResolver.cpp, line 773] Event: 6.005 Thread 0x00007f7c36008200 Exception (0x0000000703e6f350) thrown [src/hotspot/share/interpreter/linkResolver.cpp, line 773] Event: 6.007 Thread 0x00007f7c35e0a000 Exception (0x0000000705403de0) thrown [src/hotspot/share/interpreter/linkResolver.cpp, line 773] Event: 6.007 Thread 0x00007f7c36008200 Exception (0x0000000703e7ff80) thrown [src/hotspot/share/interpreter/linkResolver.cpp, line 773] Event: 6.016 Thread 0x00007f7c35a9e600 Exception (0x0000000703f01b00) thrown [src/hotspot/share/interpreter/linkResolver.cpp, line 773] Event: 6.032 Thread 0x00007f7c36008200 Exception (0x0000000703e955b0) thrown [src/hotspot/share/interpreter/linkResolver.cpp, line 773] Event: 6.032 Thread 0x00007f7c36008200 Exception (0x0000000703ea19f8) thrown [src/hotspot/share/interpreter/linkResolver.cpp, line 773] ZGC Phase Switch (0 events): No events VM Operations (20 events): Event: 4.107 Executing VM operation: HandshakeAllThreads (Deoptimize) Event: 4.107 Executing VM operation: HandshakeAllThreads (Deoptimize) done Event: 4.178 Executing VM operation: HandshakeAllThreads (Deoptimize) Event: 4.178 Executing VM operation: HandshakeAllThreads (Deoptimize) done Event: 4.194 Executing VM operation: ICBufferFull Event: 4.194 Executing VM operation: ICBufferFull done Event: 5.202 Executing VM operation: Cleanup Event: 5.203 Executing VM operation: Cleanup done Event: 5.692 Executing VM operation: HandshakeAllThreads (Deoptimize) Event: 5.692 Executing VM operation: HandshakeAllThreads (Deoptimize) done Event: 5.696 Executing VM operation: HandshakeAllThreads (Deoptimize) Event: 5.696 Executing VM operation: HandshakeAllThreads (Deoptimize) done Event: 5.701 Executing VM operation: HandshakeAllThreads (Deoptimize) Event: 5.701 Executing VM operation: HandshakeAllThreads (Deoptimize) done Event: 5.770 Executing VM operation: HandshakeAllThreads (Deoptimize) Event: 5.770 Executing VM operation: HandshakeAllThreads (Deoptimize) done Event: 5.793 Executing VM operation: HandshakeAllThreads (Deoptimize) Event: 5.793 Executing VM operation: HandshakeAllThreads (Deoptimize) done Event: 5.855 Executing VM operation: ICBufferFull Event: 5.855 Executing VM operation: ICBufferFull done Events (20 events): Event: 3.317 Thread 0x00007f7c343d3e00 Thread added: 0x00007f7c343d3e00 Event: 3.317 Protecting memory [0x000070000d594000,0x000070000d598000] with protection modes 0 Event: 4.068 Thread 0x00007f7c34484e00 Thread added: 0x00007f7c34484e00 Event: 4.068 Protecting memory [0x000070000d697000,0x000070000d69b000] with protection modes 0 Event: 4.860 Protecting memory [0x000070000cd7c000,0x000070000cd80000] with protection modes 3 Event: 4.860 Thread 0x00007f7c34b8b600 Thread exited: 0x00007f7c34b8b600 Event: 4.943 Protecting memory [0x000070000bf49000,0x000070000bf4d000] with protection modes 3 Event: 4.943 Thread 0x00007f7c36304000 Thread exited: 0x00007f7c36304000 Event: 5.209 Protecting memory [0x000070000c967000,0x000070000c96b000] with protection modes 3 Event: 5.209 Thread 0x00007f7c342bbc00 Thread exited: 0x00007f7c342bbc00 Event: 5.209 Protecting memory [0x000070000d697000,0x000070000d69b000] with protection modes 3 Event: 5.209 Thread 0x00007f7c34484e00 Thread exited: 0x00007f7c34484e00 Event: 5.644 Thread 0x00007f7c358ee200 Thread added: 0x00007f7c358ee200 Event: 5.644 Protecting memory [0x000070000bf49000,0x000070000bf4d000] with protection modes 0 Event: 5.644 Thread 0x00007f7c35e0a000 Thread added: 0x00007f7c35e0a000 Event: 5.644 Protecting memory [0x000070000c967000,0x000070000c96b000] with protection modes 0 Event: 5.653 Thread 0x00007f7c3668f400 Thread added: 0x00007f7c3668f400 Event: 5.653 Protecting memory [0x000070000cd7c000,0x000070000cd80000] with protection modes 0 Event: 5.665 Thread 0x00007f7c33a12800 Thread added: 0x00007f7c33a12800 Event: 5.665 Protecting memory [0x000070000d697000,0x000070000d69b000] with protection modes 0 Dynamic libraries: 0x000000010f5a9000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libjli.dylib 0x00007ff80d770000 /usr/lib/libz.1.dylib 0x00007ff80d85b000 /usr/lib/libSystem.B.dylib 0x00007ff80d855000 /usr/lib/system/libcache.dylib 0x00007ff80d810000 /usr/lib/system/libcommonCrypto.dylib 0x00007ff80d839000 /usr/lib/system/libcompiler_rt.dylib 0x00007ff80d82f000 /usr/lib/system/libcopyfile.dylib 0x00007ff80079f000 /usr/lib/system/libcorecrypto.dylib 0x00007ff800884000 /usr/lib/system/libdispatch.dylib 0x00007ff800a35000 /usr/lib/system/libdyld.dylib 0x00007ff80d84b000 /usr/lib/system/libkeymgr.dylib 0x00007ff80d7ec000 /usr/lib/system/libmacho.dylib 0x00007ff80cc87000 /usr/lib/system/libquarantine.dylib 0x00007ff80d849000 /usr/lib/system/libremovefile.dylib 0x00007ff80602b000 /usr/lib/system/libsystem_asl.dylib 0x00007ff80073d000 /usr/lib/system/libsystem_blocks.dylib 0x00007ff8008ce000 /usr/lib/system/libsystem_c.dylib 0x00007ff80d841000 /usr/lib/system/libsystem_collections.dylib 0x00007ff80bda7000 /usr/lib/system/libsystem_configuration.dylib 0x00007ff80ae24000 /usr/lib/system/libsystem_containermanager.dylib 0x00007ff80d44c000 /usr/lib/system/libsystem_coreservices.dylib 0x00007ff803c24000 /usr/lib/system/libsystem_darwin.dylib 0x00007ffc15437000 /usr/lib/system/libsystem_darwindirectory.dylib 0x00007ff80d84c000 /usr/lib/system/libsystem_dnssd.dylib 0x00007ff8008cb000 /usr/lib/system/libsystem_featureflags.dylib 0x00007ff800a63000 /usr/lib/system/libsystem_info.dylib 0x00007ff80d784000 /usr/lib/system/libsystem_m.dylib 0x00007ff80084b000 /usr/lib/system/libsystem_malloc.dylib 0x00007ff805fa1000 /usr/lib/system/libsystem_networkextension.dylib 0x00007ff80406d000 /usr/lib/system/libsystem_notify.dylib 0x00007ff80bdab000 /usr/lib/system/libsystem_sandbox.dylib 0x00007ff80d846000 /usr/lib/system/libsystem_secinit.dylib 0x00007ff8009ee000 /usr/lib/system/libsystem_kernel.dylib 0x00007ff800a59000 /usr/lib/system/libsystem_platform.dylib 0x00007ff800a29000 /usr/lib/system/libsystem_pthread.dylib 0x00007ff807b9e000 /usr/lib/system/libsystem_symptoms.dylib 0x00007ff800785000 /usr/lib/system/libsystem_trace.dylib 0x00007ff80d81c000 /usr/lib/system/libunwind.dylib 0x00007ff800741000 /usr/lib/system/libxpc.dylib 0x00007ff8009d5000 /usr/lib/libc++abi.dylib 0x00007ff80065e000 /usr/lib/libobjc.A.dylib 0x00007ff80d827000 /usr/lib/liboah.dylib 0x00007ff800956000 /usr/lib/libc++.1.dylib 0x00007ff81b392000 /System/Library/Frameworks/Cocoa.framework/Versions/A/Cocoa 0x00007ff8040d1000 /System/Library/Frameworks/AppKit.framework/Versions/C/AppKit 0x00007ff807324000 /System/Library/Frameworks/CoreData.framework/Versions/A/CoreData 0x00007ff801a44000 /System/Library/Frameworks/Foundation.framework/Versions/C/Foundation 0x00007ff8054d3000 /System/Library/PrivateFrameworks/UIFoundation.framework/Versions/A/UIFoundation 0x00007ffb0b980000 /System/Library/PrivateFrameworks/CollectionViewCore.framework/Versions/A/CollectionViewCore 0x00007ff814cfd000 /System/Library/PrivateFrameworks/RemoteViewServices.framework/Versions/A/RemoteViewServices 0x00007ff80b5f4000 /System/Library/PrivateFrameworks/XCTTargetBootstrap.framework/Versions/A/XCTTargetBootstrap 0x00007ff8101ea000 /System/Library/PrivateFrameworks/InternationalSupport.framework/Versions/A/InternationalSupport 0x00007ff810273000 /System/Library/PrivateFrameworks/UserActivity.framework/Versions/A/UserActivity 0x00007ffc0ca7a000 /System/Library/PrivateFrameworks/WindowManagement.framework/Versions/A/WindowManagement 0x00007ff8016fd000 /System/Library/Frameworks/SystemConfiguration.framework/Versions/A/SystemConfiguration 0x00007ff80f5a6000 /usr/lib/libspindump.dylib 0x00007ff8056af000 /System/Library/Frameworks/UniformTypeIdentifiers.framework/Versions/A/UniformTypeIdentifiers 0x00007ff80963f000 /usr/lib/libapp_launch_measurement.dylib 0x00007ff8087c1000 /System/Library/PrivateFrameworks/CoreAnalytics.framework/Versions/A/CoreAnalytics 0x00007ff809642000 /System/Library/PrivateFrameworks/CoreAutoLayout.framework/Versions/A/CoreAutoLayout 0x00007ff80ae6c000 /System/Library/Frameworks/Metal.framework/Versions/A/Metal 0x00007ff80bdb7000 /usr/lib/liblangid.dylib 0x00007ff80b5f9000 /System/Library/PrivateFrameworks/CoreSVG.framework/Versions/A/CoreSVG 0x00007ff806060000 /System/Library/PrivateFrameworks/SkyLight.framework/Versions/A/SkyLight 0x00007ff8064b3000 /System/Library/Frameworks/CoreGraphics.framework/Versions/A/CoreGraphics 0x00007ff815451000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Accelerate 0x00007ff80f40a000 /System/Library/PrivateFrameworks/IconServices.framework/Versions/A/IconServices 0x00007ff80ae4d000 /System/Library/Frameworks/IOSurface.framework/Versions/A/IOSurface 0x00007ff8087ed000 /usr/lib/libDiagnosticMessagesClient.dylib 0x00007ff818dbf000 /System/Library/Frameworks/ApplicationServices.framework/Versions/A/ApplicationServices 0x00007ff80b5e0000 /System/Library/PrivateFrameworks/DFRFoundation.framework/Versions/A/DFRFoundation 0x00007ff80398f000 /usr/lib/libicucore.A.dylib 0x00007ff8111af000 /System/Library/Frameworks/AudioToolbox.framework/Versions/A/AudioToolbox 0x00007ff8101f6000 /System/Library/PrivateFrameworks/DataDetectorsCore.framework/Versions/A/DataDetectorsCore 0x00007ff909a94000 /System/Library/PrivateFrameworks/TextInput.framework/Versions/A/TextInput 0x00007ff805fba000 /usr/lib/libMobileGestalt.dylib 0x00007ff80b344000 /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/HIToolbox.framework/Versions/A/HIToolbox 0x00007ff808f84000 /System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzCore 0x00007ff8035f3000 /System/Library/Frameworks/Security.framework/Versions/A/Security 0x00007ff814d35000 /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/SpeechRecognition.framework/Versions/A/SpeechRecognition 0x00007ff809374000 /System/Library/PrivateFrameworks/CoreUI.framework/Versions/A/CoreUI 0x00007ff802ee7000 /System/Library/Frameworks/CoreAudio.framework/Versions/A/CoreAudio 0x00007ff8088cd000 /System/Library/Frameworks/DiskArbitration.framework/Versions/A/DiskArbitration 0x00007ff80f9d8000 /System/Library/PrivateFrameworks/MultitouchSupport.framework/Versions/A/MultitouchSupport 0x00007ff805fb9000 /usr/lib/libenergytrace.dylib 0x00007ff81f65f000 /System/Library/PrivateFrameworks/RenderBox.framework/Versions/A/RenderBox 0x00007ff803faa000 /System/Library/Frameworks/IOKit.framework/Versions/A/IOKit 0x00007ff81514d000 /System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices 0x00007ff8095d7000 /System/Library/PrivateFrameworks/PerformanceAnalysis.framework/Versions/A/PerformanceAnalysis 0x00007ffa1be78000 /System/Library/Frameworks/OpenGL.framework/Versions/A/OpenGL 0x00007ff80968b000 /usr/lib/libxml2.2.dylib 0x00007ff80cbad000 /System/Library/PrivateFrameworks/MobileKeyBag.framework/Versions/A/MobileKeyBag 0x00007ff8150c4000 /System/Library/Frameworks/Accessibility.framework/Versions/A/Accessibility 0x00007ff806c6c000 /System/Library/Frameworks/ColorSync.framework/Versions/A/ColorSync 0x00007ff800a8e000 /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation 0x00007ff80b95c000 /System/Library/Frameworks/CoreImage.framework/Versions/A/CoreImage 0x00007ff802ce2000 /System/Library/Frameworks/CoreText.framework/Versions/A/CoreText 0x00007ffb022ed000 /System/Library/Frameworks/CoreTransferable.framework/Versions/A/CoreTransferable 0x00007ffb02736000 /System/Library/Frameworks/DeveloperToolsSupport.framework/Versions/A/DeveloperToolsSupport 0x00007ff80b630000 /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO 0x00007ffb069bb000 /System/Library/Frameworks/Symbols.framework/Versions/A/Symbols 0x00007ff80d861000 /System/Library/PrivateFrameworks/SoftLinking.framework/Versions/A/SoftLinking 0x00007ff810c27000 /usr/lib/swift/libswiftCore.dylib 0x00007ff90678c000 /usr/lib/swift/libswiftCoreFoundation.dylib 0x00007ff9046d6000 /usr/lib/swift/libswiftCoreGraphics.dylib 0x00007ff9067c9000 /usr/lib/swift/libswiftCoreImage.dylib 0x00007ff9046dd000 /usr/lib/swift/libswiftDarwin.dylib 0x00007ff816aba000 /usr/lib/swift/libswiftDispatch.dylib 0x00007ff9067ca000 /usr/lib/swift/libswiftIOKit.dylib 0x00007ff9126b6000 /usr/lib/swift/libswiftMetal.dylib 0x00007ff91f08d000 /usr/lib/swift/libswiftOSLog.dylib 0x00007ff819222000 /usr/lib/swift/libswiftObjectiveC.dylib 0x00007ff9162a0000 /usr/lib/swift/libswiftQuartzCore.dylib 0x00007ff91a2f2000 /usr/lib/swift/libswiftUniformTypeIdentifiers.dylib 0x00007ff90679c000 /usr/lib/swift/libswiftXPC.dylib 0x00007ffc1511b000 /usr/lib/swift/libswift_Concurrency.dylib 0x00007ff819226000 /usr/lib/swift/libswiftos.dylib 0x00007ff9099f6000 /usr/lib/swift/libswiftsimd.dylib 0x00007ff80d9f9000 /usr/lib/libcompression.dylib 0x00007ff81012a000 /System/Library/PrivateFrameworks/TextureIO.framework/Versions/A/TextureIO 0x00007ff80f0b0000 /usr/lib/libate.dylib 0x00007ff80ee5f000 /usr/lib/liblzma.5.dylib 0x00007ff80d85d000 /usr/lib/libfakelink.dylib 0x00007ff805bf4000 /System/Library/Frameworks/CFNetwork.framework/Versions/A/CFNetwork 0x00007ff80d8af000 /usr/lib/libarchive.2.dylib 0x00007ff812faf000 /System/Library/Frameworks/Combine.framework/Versions/A/Combine 0x00007ffb0b995000 /System/Library/PrivateFrameworks/CollectionsInternal.framework/Versions/A/CollectionsInternal 0x00007ffc00ada000 /System/Library/PrivateFrameworks/ReflectionInternal.framework/Versions/A/ReflectionInternal 0x00007ffc010bd000 /System/Library/PrivateFrameworks/RuntimeInternal.framework/Versions/A/RuntimeInternal 0x00007ffc15256000 /usr/lib/swift/libswift_StringProcessing.dylib 0x00007ff803f29000 /System/Library/PrivateFrameworks/CoreServicesInternal.framework/Versions/A/CoreServicesInternal 0x00007ff80ccae000 /usr/lib/libbsm.0.dylib 0x00007ff80d7f4000 /usr/lib/system/libkxld.dylib 0x00007ff80960b000 /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/FSEvents.framework/Versions/A/FSEvents 0x00007ff803c2f000 /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/CarbonCore.framework/Versions/A/CarbonCore 0x00007ff808835000 /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/Metadata.framework/Versions/A/Metadata 0x00007ff80d452000 /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/OSServices.framework/Versions/A/OSServices 0x00007ff80d938000 /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/SearchKit.framework/Versions/A/SearchKit 0x00007ff807b24000 /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/AE.framework/Versions/A/AE 0x00007ff800f28000 /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/LaunchServices 0x00007ff80ee10000 /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/DictionaryServices.framework/Versions/A/DictionaryServices 0x00007ff809618000 /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/SharedFileList.framework/Versions/A/SharedFileList 0x00007ff80d9c2000 /usr/lib/libapple_nghttp2.dylib 0x00007ff8077b5000 /usr/lib/libsqlite3.dylib 0x00007ff807ba6000 /System/Library/Frameworks/Network.framework/Versions/A/Network 0x00007ffc13adb000 /usr/lib/libCoreEntitlements.dylib 0x00007ffb1c6cc000 /System/Library/PrivateFrameworks/MessageSecurity.framework/Versions/A/MessageSecurity 0x00007ff80779c000 /System/Library/PrivateFrameworks/ProtocolBuffer.framework/Versions/A/ProtocolBuffer 0x00007ff80d36f000 /System/Library/PrivateFrameworks/AppleFSCompression.framework/Versions/A/AppleFSCompression 0x00007ff80cc96000 /usr/lib/libcoretls.dylib 0x00007ff80ee78000 /usr/lib/libcoretls_cfhelpers.dylib 0x00007ff80d9f3000 /usr/lib/libpam.2.dylib 0x00007ff80eef0000 /usr/lib/libxar.1.dylib 0x00007ff80f3e3000 /usr/lib/libheimdal-asn1.dylib 0x00007ff805bf3000 /usr/lib/libnetwork.dylib 0x00007ff80d862000 /usr/lib/libpcap.A.dylib 0x00007ff807b94000 /usr/lib/libdns_services.dylib 0x00007ffc151a2000 /usr/lib/swift/libswift_RegexParser.dylib 0x00007ff80bdb2000 /System/Library/PrivateFrameworks/AppleSystemInfo.framework/Versions/A/AppleSystemInfo 0x00007ff80c9b2000 /System/Library/PrivateFrameworks/IOMobileFramebuffer.framework/Versions/A/IOMobileFramebuffer 0x00007ff80d43d000 /usr/lib/libbz2.1.0.dylib 0x00007ff80cc8a000 /usr/lib/libCheckFix.dylib 0x00007ff806042000 /System/Library/PrivateFrameworks/TCC.framework/Versions/A/TCC 0x00007ff80bdb9000 /System/Library/PrivateFrameworks/CoreNLP.framework/Versions/A/CoreNLP 0x00007ff8087ef000 /System/Library/PrivateFrameworks/MetadataUtilities.framework/Versions/A/MetadataUtilities 0x00007ff80ccbe000 /usr/lib/libmecab.dylib 0x00007ff801784000 /usr/lib/libCRFSuite.dylib 0x00007ff80cd17000 /usr/lib/libgermantok.dylib 0x00007ff80d99e000 /usr/lib/libThaiTokenizer.dylib 0x00007ff8088d5000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vImage.framework/Versions/A/vImage 0x00007ff815120000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/vecLib 0x00007ff80ef32000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libvMisc.dylib 0x00007ff80c7a2000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libvDSP.dylib 0x00007ff80132d000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib 0x00007ff80dad9000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib 0x00007ff80cd1a000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLinearAlgebra.dylib 0x00007ff80d9dd000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libSparseBLAS.dylib 0x00007ff80dad3000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libQuadrature.dylib 0x00007ff80bec8000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBNNS.dylib 0x00007ff801685000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libSparse.dylib 0x00007ffb1b025000 /System/Library/PrivateFrameworks/MIL.framework/Versions/A/MIL 0x00007ff80d897000 /usr/lib/libiconv.2.dylib 0x00007ff80d7e8000 /usr/lib/libcharset.1.dylib 0x00007ff8095ef000 /System/Library/Frameworks/OpenDirectory.framework/Versions/A/Frameworks/CFOpenDirectory.framework/Versions/A/CFOpenDirectory 0x00007ff8095e3000 /System/Library/Frameworks/OpenDirectory.framework/Versions/A/OpenDirectory 0x00007ff80ee7a000 /System/Library/PrivateFrameworks/APFS.framework/Versions/A/APFS 0x00007ff80cbd0000 /System/Library/Frameworks/SecurityFoundation.framework/Versions/A/SecurityFoundation 0x00007ff80eefe000 /usr/lib/libutil.dylib 0x00007ffb19522000 /System/Library/PrivateFrameworks/InstalledContentLibrary.framework/Versions/A/InstalledContentLibrary 0x00007ff803f6a000 /System/Library/PrivateFrameworks/CoreServicesStore.framework/Versions/A/CoreServicesStore 0x00007ffb098e9000 /System/Library/PrivateFrameworks/AppleMobileFileIntegrity.framework/Versions/A/AppleMobileFileIntegrity 0x00007ff90676c000 /usr/lib/libmis.dylib 0x00007ff916765000 /System/Library/PrivateFrameworks/MobileSystemServices.framework/Versions/A/MobileSystemServices 0x00007ffa14150000 /System/Library/PrivateFrameworks/ConfigProfileHelper.framework/Versions/A/ConfigProfileHelper 0x00007ff80d9a0000 /System/Library/PrivateFrameworks/AppleSauce.framework/Versions/A/AppleSauce 0x00007ff802682000 /System/Library/PrivateFrameworks/LanguageModeling.framework/Versions/A/LanguageModeling 0x00007ff80ef02000 /usr/lib/libxslt.1.dylib 0x00007ff80d89e000 /usr/lib/libcmph.dylib 0x00007ff80c981000 /System/Library/PrivateFrameworks/CoreEmoji.framework/Versions/A/CoreEmoji 0x00007ff80bec3000 /System/Library/PrivateFrameworks/LinguisticData.framework/Versions/A/LinguisticData 0x00007ff8015a2000 /System/Library/PrivateFrameworks/Lexicon.framework/Versions/A/Lexicon 0x00007ff80cc59000 /System/Library/PrivateFrameworks/BackgroundTaskManagement.framework/Versions/A/BackgroundTaskManagement 0x00007ffc13c56000 /usr/lib/libTLE.dylib 0x00007ff80f89a000 /System/Library/PrivateFrameworks/AppleJPEG.framework/Versions/A/AppleJPEG 0x00007ff80f3c8000 /usr/lib/libexpat.1.dylib 0x00007ff80ff81000 /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libPng.dylib 0x00007ff80ffae000 /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libTIFF.dylib 0x00007ff8100a3000 /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libGIF.dylib 0x00007ff80f8e6000 /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libJP2.dylib 0x00007ff810042000 /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libJPEG.dylib 0x00007ff810039000 /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libRadiance.dylib 0x00007ff80b1e4000 /System/Library/PrivateFrameworks/FontServices.framework/libFontParser.dylib 0x00007ff807ac6000 /System/Library/PrivateFrameworks/RunningBoardServices.framework/Versions/A/RunningBoardServices 0x00007ff81ba8a000 /System/Library/PrivateFrameworks/IOSurfaceAccelerator.framework/Versions/A/IOSurfaceAccelerator 0x00007ff80f9d4000 /System/Library/PrivateFrameworks/WatchdogClient.framework/Versions/A/WatchdogClient 0x00007ff802849000 /System/Library/Frameworks/CoreDisplay.framework/Versions/A/CoreDisplay 0x00007ff80b0b8000 /System/Library/Frameworks/CoreMedia.framework/Versions/A/CoreMedia 0x00007ff80ae63000 /System/Library/PrivateFrameworks/IOAccelerator.framework/Versions/A/IOAccelerator 0x00007ff80976a000 /System/Library/Frameworks/CoreVideo.framework/Versions/A/CoreVideo 0x00007ff80d9f1000 /System/Library/Frameworks/MetalPerformanceShaders.framework/Versions/A/MetalPerformanceShaders 0x00007ff80fa15000 /System/Library/Frameworks/VideoToolbox.framework/Versions/A/VideoToolbox 0x00007ff8097f6000 /System/Library/PrivateFrameworks/UserManagement.framework/Versions/A/UserManagement 0x00007ff8079f8000 /System/Library/PrivateFrameworks/BaseBoard.framework/Versions/A/BaseBoard 0x00007ff80bdb1000 /System/Library/PrivateFrameworks/AggregateDictionary.framework/Versions/A/AggregateDictionary 0x00007ffb09871000 /System/Library/PrivateFrameworks/AppleKeyStore.framework/Versions/A/AppleKeyStore 0x00007ff810032000 /System/Library/PrivateFrameworks/GPUWrangler.framework/Versions/A/GPUWrangler 0x00007ff810016000 /System/Library/PrivateFrameworks/IOPresentment.framework/Versions/A/IOPresentment 0x00007ff81003c000 /System/Library/PrivateFrameworks/DSExternalDisplay.framework/Versions/A/DSExternalDisplay 0x00007ffb15535000 /System/Library/PrivateFrameworks/GPUCompiler.framework/Versions/32023/Libraries/libllvm-flatbuffers.dylib 0x00007ffa1be6c000 /System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libCoreFSCache.dylib 0x00007ffb120d5000 /System/Library/PrivateFrameworks/GPUCompiler.framework/Versions/32023/Libraries/libGPUCompilerUtils.dylib 0x00007ff8100a9000 /System/Library/PrivateFrameworks/CMCaptureCore.framework/Versions/A/CMCaptureCore 0x00007ffb02819000 /System/Library/Frameworks/ExtensionFoundation.framework/Versions/A/ExtensionFoundation 0x00007ff8172dd000 /System/Library/PrivateFrameworks/CoreTime.framework/Versions/A/CoreTime 0x00007ff80f590000 /System/Library/PrivateFrameworks/AppServerSupport.framework/Versions/A/AppServerSupport 0x00007ff811afa000 /System/Library/PrivateFrameworks/perfdata.framework/Versions/A/perfdata 0x00007ff802975000 /System/Library/PrivateFrameworks/AudioToolboxCore.framework/Versions/A/AudioToolboxCore 0x00007ff80b092000 /System/Library/PrivateFrameworks/caulk.framework/Versions/A/caulk 0x00007ff81139d000 /usr/lib/libAudioStatistics.dylib 0x00007ff905b6d000 /System/Library/PrivateFrameworks/SystemPolicy.framework/Versions/A/SystemPolicy 0x00007ff811664000 /usr/lib/libSMC.dylib 0x00007ff81b1f6000 /System/Library/Frameworks/CoreMIDI.framework/Versions/A/CoreMIDI 0x00007ff80ff48000 /usr/lib/libAudioToolboxUtility.dylib 0x00007ff90167b000 /System/Library/PrivateFrameworks/OSAServicesClient.framework/Versions/A/OSAServicesClient 0x00007ff811b07000 /usr/lib/libperfcheck.dylib 0x00007ff80f2a9000 /System/Library/PrivateFrameworks/PlugInKit.framework/Versions/A/PlugInKit 0x00007ff80cbc3000 /System/Library/PrivateFrameworks/AssertionServices.framework/Versions/A/AssertionServices 0x00007ffa03349000 /System/Library/PrivateFrameworks/Symbolication.framework/Versions/A/Symbolication 0x00007ffb1fbce000 /System/Library/PrivateFrameworks/PhotosensitivityProcessing.framework/Versions/A/PhotosensitivityProcessing 0x00007ffa1d478000 /System/Library/Frameworks/OpenCL.framework/Versions/A/OpenCL 0x00007ff80f53b000 /System/Library/PrivateFrameworks/GraphVisualizer.framework/Versions/A/GraphVisualizer 0x00007ffa1bec9000 /System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGLU.dylib 0x00007ffa1be8b000 /System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGFXShared.dylib 0x00007ffa1c088000 /System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGL.dylib 0x00007ffa1be93000 /System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libGLImage.dylib 0x00007ffa1be88000 /System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libCVMSPluginSupport.dylib 0x00007ffc13c10000 /usr/lib/libRosetta.dylib 0x00007ffa1be73000 /System/Library/Frameworks/OpenGL.framework/Versions/A/Libraries/libCoreVMClient.dylib 0x00007ffb10214000 /System/Library/PrivateFrameworks/FontServices.framework/Versions/A/FontServices 0x00007ff80f54a000 /System/Library/PrivateFrameworks/OTSVG.framework/Versions/A/OTSVG 0x00007ff809328000 /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ATS.framework/Versions/A/Resources/libFontRegistry.dylib 0x00007ff80f59a000 /System/Library/PrivateFrameworks/FontServices.framework/libhvf.dylib 0x00007ffb10215000 /System/Library/PrivateFrameworks/FontServices.framework/libXTFontStaticRegistryData.dylib 0x00007ff80bd26000 /System/Library/Frameworks/MetalPerformanceShaders.framework/Versions/A/Frameworks/MPSCore.framework/Versions/A/MPSCore 0x00007ff80d2d5000 /System/Library/Frameworks/MetalPerformanceShaders.framework/Versions/A/Frameworks/MPSImage.framework/Versions/A/MPSImage 0x00007ff80cd30000 /System/Library/Frameworks/MetalPerformanceShaders.framework/Versions/A/Frameworks/MPSNeuralNetwork.framework/Versions/A/MPSNeuralNetwork 0x00007ff80d1a9000 /System/Library/Frameworks/MetalPerformanceShaders.framework/Versions/A/Frameworks/MPSMatrix.framework/Versions/A/MPSMatrix 0x00007ff80cf5c000 /System/Library/Frameworks/MetalPerformanceShaders.framework/Versions/A/Frameworks/MPSRayIntersector.framework/Versions/A/MPSRayIntersector 0x00007ff80d1e4000 /System/Library/Frameworks/MetalPerformanceShaders.framework/Versions/A/Frameworks/MPSNDArray.framework/Versions/A/MPSNDArray 0x00007ffb041bb000 /System/Library/Frameworks/MetalPerformanceShaders.framework/Versions/A/Frameworks/MPSFunctions.framework/Versions/A/MPSFunctions 0x00007ffb0419d000 /System/Library/Frameworks/MetalPerformanceShaders.framework/Versions/A/Frameworks/MPSBenchmarkLoop.framework/Versions/A/MPSBenchmarkLoop 0x00007ff8011dd000 /System/Library/PrivateFrameworks/MetalTools.framework/Versions/A/MetalTools 0x00007ff90ad47000 /System/Library/PrivateFrameworks/IOAccelMemoryInfo.framework/Versions/A/IOAccelMemoryInfo 0x00007ff916677000 /System/Library/PrivateFrameworks/kperf.framework/Versions/A/kperf 0x00007ff90677f000 /System/Library/PrivateFrameworks/GPURawCounter.framework/Versions/A/GPURawCounter 0x00007ff8171d1000 /System/Library/PrivateFrameworks/CoreSymbolication.framework/Versions/A/CoreSymbolication 0x00007ff90673d000 /System/Library/PrivateFrameworks/MallocStackLogging.framework/Versions/A/MallocStackLogging 0x00007ff80f150000 /System/Library/PrivateFrameworks/CrashReporterSupport.framework/Versions/A/CrashReporterSupport 0x00007ff817192000 /System/Library/PrivateFrameworks/DebugSymbols.framework/Versions/A/DebugSymbols 0x00007ff9159b6000 /System/Library/PrivateFrameworks/OSAnalytics.framework/Versions/A/OSAnalytics 0x00007ffc0b1ec000 /System/Library/PrivateFrameworks/VideoToolboxParavirtualizationSupport.framework/Versions/A/VideoToolboxParavirtualizationSupport 0x00007ff80f378000 /System/Library/PrivateFrameworks/AppleVA.framework/Versions/A/AppleVA 0x00007ff8113e1000 /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ATS.framework/Versions/A/ATS 0x00007ff806e19000 /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/HIServices.framework/Versions/A/HIServices 0x00007ff8100b6000 /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/PrintCore.framework/Versions/A/PrintCore 0x00007ff8117ba000 /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/QD.framework/Versions/A/QD 0x00007ff8117b2000 /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ColorSyncLegacy.framework/Versions/A/ColorSyncLegacy 0x00007ff8113b5000 /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/SpeechSynthesis.framework/Versions/A/SpeechSynthesis 0x00007ff810073000 /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ATSUI.framework/Versions/A/ATSUI 0x00007ff811744000 /usr/lib/libcups.2.dylib 0x00007ff811b16000 /System/Library/Frameworks/Kerberos.framework/Versions/A/Kerberos 0x00007ff811b25000 /System/Library/Frameworks/GSS.framework/Versions/A/GSS 0x00007ff81145a000 /usr/lib/libresolv.9.dylib 0x00007ff80f5ac000 /System/Library/PrivateFrameworks/Heimdal.framework/Versions/A/Heimdal 0x00007ff819190000 /System/Library/Frameworks/Kerberos.framework/Versions/A/Libraries/libHeimdalProxy.dylib 0x00007ff811b72000 /System/Library/PrivateFrameworks/CommonAuth.framework/Versions/A/CommonAuth 0x00007ffb016de000 /System/Library/Frameworks/AVFAudio.framework/Versions/A/AVFAudio 0x00007ff9016c4000 /System/Library/PrivateFrameworks/AXCoreUtilities.framework/Versions/A/AXCoreUtilities 0x00007ff811325000 /System/Library/PrivateFrameworks/AudioSession.framework/Versions/A/AudioSession 0x00007ff812d77000 /System/Library/Frameworks/IOBluetooth.framework/Versions/A/IOBluetooth 0x00007ff80f487000 /System/Library/PrivateFrameworks/MediaExperience.framework/Versions/A/MediaExperience 0x00007ff81117a000 /System/Library/PrivateFrameworks/AudioSession.framework/libSessionUtility.dylib 0x00007ff8117c6000 /System/Library/PrivateFrameworks/AudioResourceArbitration.framework/Versions/A/AudioResourceArbitration 0x00007ff815e56000 /System/Library/PrivateFrameworks/PowerLog.framework/Versions/A/PowerLog 0x00007ff815d74000 /System/Library/Frameworks/CoreBluetooth.framework/Versions/A/CoreBluetooth 0x00007ff819191000 /System/Library/Frameworks/AudioUnit.framework/Versions/A/AudioUnit 0x00007ff80ca39000 /System/Library/PrivateFrameworks/CoreUtils.framework/Versions/A/CoreUtils 0x00007ffb0ea5f000 /System/Library/PrivateFrameworks/CoreUtilsExtras.framework/Versions/A/CoreUtilsExtras 0x00007ffb193af000 /System/Library/PrivateFrameworks/IO80211.framework/Versions/A/IO80211 0x00007ff816cf4000 /System/Library/PrivateFrameworks/FrontBoardServices.framework/Versions/A/FrontBoardServices 0x00007ff818787000 /System/Library/PrivateFrameworks/BackBoardServices.framework/Versions/A/BackBoardServices 0x00007ff816dae000 /System/Library/PrivateFrameworks/BoardServices.framework/Versions/A/BoardServices 0x00007ff80f3ec000 /System/Library/PrivateFrameworks/IconFoundation.framework/Versions/A/IconFoundation 0x00007ff814d25000 /System/Library/PrivateFrameworks/SpeechRecognitionCore.framework/Versions/A/SpeechRecognitionCore 0x00007ff9016db000 /usr/lib/libAccessibility.dylib 0x00007ff815499000 /System/Library/Frameworks/MediaAccessibility.framework/Versions/A/MediaAccessibility 0x00007ffa06a9a000 /System/Library/Frameworks/OSLog.framework/Versions/A/OSLog 0x00007ff9066ca000 /System/Library/PrivateFrameworks/LoggingSupport.framework/Versions/A/LoggingSupport 0x0000000110afa000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/server/libjvm.dylib 0x000000010f5f5000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libjimage.dylib 0x000000010f62f000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libjava.dylib 0x000000010f8d2000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libnio.dylib 0x000000010f8b6000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libnet.dylib 0x000000010f8ee000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libzip.dylib 0x000000010f902000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libprefs.dylib 0x000000010f912000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libverify.dylib 0x000000010fa41000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libawt.dylib 0x000000010f992000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libmlib_image.dylib 0x00007ffb032b2000 /System/Library/Frameworks/JavaRuntimeSupport.framework/Versions/A/JavaRuntimeSupport 0x00007ff90552b000 /System/Library/Frameworks/Carbon.framework/Versions/A/Carbon 0x00007ff81d1b5000 /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/CommonPanels.framework/Versions/A/CommonPanels 0x00007ff818ab7000 /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/Help.framework/Versions/A/Help 0x00007ff81d1b9000 /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/ImageCapture.framework/Versions/A/ImageCapture 0x00007ff81d191000 /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/OpenScripting.framework/Versions/A/OpenScripting 0x00007ff81d1b1000 /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/Ink.framework/Versions/A/Ink 0x00007ff81d1ad000 /System/Library/Frameworks/Carbon.framework/Versions/A/Frameworks/SecurityHI.framework/Versions/A/SecurityHI 0x000000011046d000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libawt_lwawt.dylib 0x000000010f953000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libosxapp.dylib 0x00007ff90474c000 /System/Library/Frameworks/ExceptionHandling.framework/Versions/A/ExceptionHandling 0x000000010f926000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libfontmanager.dylib 0x000000011059d000 /usr/local/Cellar/harfbuzz/8.2.2/lib/libharfbuzz.0.dylib 0x00000001103c7000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libfreetype.dylib 0x0000000110755000 /usr/local/Cellar/freetype/2.13.2/lib/libfreetype.6.dylib 0x000000011090f000 /usr/local/Cellar/glib/2.78.1/lib/libglib-2.0.0.dylib 0x0000000110364000 /usr/local/Cellar/gettext/0.22.3/lib/libintl.8.dylib 0x0000000110341000 /usr/local/Cellar/graphite2/1.3.14/lib/libgraphite2.3.2.1.dylib 0x00000001106b5000 /usr/local/Cellar/libpng/1.6.40/lib/libpng16.16.dylib 0x0000000110a2b000 /usr/local/Cellar/pcre2/10.42/lib/libpcre2-8.0.dylib 0x00007ff81643d000 /System/Library/Frameworks/FileProvider.framework/Versions/A/FileProvider 0x00007ff807960000 /System/Library/Frameworks/Accounts.framework/Versions/A/Accounts 0x00007ff8165e5000 /System/Library/PrivateFrameworks/GenerationalStorage.framework/Versions/A/GenerationalStorage 0x00007ff815e4b000 /System/Library/PrivateFrameworks/SymptomDiagnosticReporter.framework/Versions/A/SymptomDiagnosticReporter 0x00007ff8056c5000 /System/Library/PrivateFrameworks/DesktopServicesPriv.framework/Versions/A/DesktopServicesPriv 0x00007ff80407d000 /usr/lib/libsandbox.1.dylib 0x00007ff8117a7000 /System/Library/PrivateFrameworks/NetAuth.framework/Versions/A/NetAuth 0x00007ff812a58000 /System/Library/PrivateFrameworks/Sharing.framework/Versions/A/Sharing 0x00007ff8097bb000 /System/Library/PrivateFrameworks/login.framework/Versions/A/Frameworks/loginsupport.framework/Versions/A/loginsupport 0x00007ff8185ca000 /System/Library/PrivateFrameworks/Apple80211.framework/Versions/A/Apple80211 0x00007ff80d47f000 /System/Library/PrivateFrameworks/AuthKit.framework/Versions/A/AuthKit 0x00007ff80c9c1000 /System/Library/Frameworks/CoreWLAN.framework/Versions/A/CoreWLAN 0x00007ff906783000 /usr/lib/swift/libswiftCoreAudio.dylib 0x00007ff90ba55000 /usr/lib/swift/libswiftCoreLocation.dylib 0x00007ff80f147000 /usr/lib/libIOReport.dylib 0x00007ff8185ce000 /System/Library/PrivateFrameworks/CoreWiFi.framework/Versions/A/CoreWiFi 0x00007ffa0d5fa000 /System/Library/PrivateFrameworks/WiFiPeerToPeer.framework/Versions/A/WiFiPeerToPeer 0x00007ff80d621000 /System/Library/Frameworks/UserNotifications.framework/Versions/A/UserNotifications 0x00007ff811ca0000 /System/Library/PrivateFrameworks/CorePhoneNumbers.framework/Versions/A/CorePhoneNumbers 0x00007ff811487000 /System/Library/PrivateFrameworks/MultiverseSupport.framework/Versions/A/MultiverseSupport 0x00007ff818a06000 /System/Library/PrivateFrameworks/RemoteServiceDiscovery.framework/Versions/A/RemoteServiceDiscovery 0x00007ff815f66000 /System/Library/PrivateFrameworks/DiskManagement.framework/Versions/A/DiskManagement 0x00007ff815e7e000 /System/Library/PrivateFrameworks/AppleIDAuthSupport.framework/Versions/A/AppleIDAuthSupport 0x00007ffb07980000 /System/Library/PrivateFrameworks/AAAFoundation.framework/Versions/A/AAAFoundation 0x00007ff811c79000 /System/Library/PrivateFrameworks/KeychainCircle.framework/Versions/A/KeychainCircle 0x00007ff818a1a000 /System/Library/PrivateFrameworks/RemoteXPC.framework/Versions/A/RemoteXPC 0x00007ff818abf000 /usr/lib/libcsfde.dylib 0x00007ff80f2f0000 /usr/lib/libCoreStorage.dylib 0x00007ff815f32000 /System/Library/PrivateFrameworks/MediaKit.framework/Versions/A/MediaKit 0x00007ff815e8a000 /System/Library/Frameworks/DiscRecording.framework/Versions/A/DiscRecording 0x00007ff812e4e000 /System/Library/PrivateFrameworks/ProtectedCloudStorage.framework/Versions/A/ProtectedCloudStorage 0x00007ff818abb000 /System/Library/PrivateFrameworks/EFILogin.framework/Versions/A/EFILogin 0x00007ff81660d000 /System/Library/PrivateFrameworks/OctagonTrust.framework/Versions/A/OctagonTrust 0x00007ff80ad18000 /System/Library/Frameworks/CoreLocation.framework/Versions/A/CoreLocation 0x00007ff8130a6000 /System/Library/PrivateFrameworks/GeoServices.framework/Versions/A/GeoServices 0x00007ff811146000 /System/Library/PrivateFrameworks/LocationSupport.framework/Versions/A/LocationSupport 0x00007ffb161f3000 /System/Library/PrivateFrameworks/GeoServicesCore.framework/Versions/A/GeoServicesCore 0x00007ff9016bb000 /System/Library/PrivateFrameworks/PhoneNumbers.framework/Versions/A/PhoneNumbers 0x00007ff80f2e8000 /usr/lib/libMatch.1.dylib 0x00007ff90f2be000 /System/Library/CoreServices/RawCamera.bundle/Contents/MacOS/RawCamera 0x00007ff811b82000 /System/Library/PrivateFrameworks/MobileAsset.framework/Versions/A/MobileAsset 0x00007ffb095e5000 /System/Library/PrivateFrameworks/AppleJPEGXL.framework/Versions/A/AppleJPEGXL 0x00007ff90c3d7000 /System/Library/PrivateFrameworks/SoftwareUpdateCoreSupport.framework/Versions/A/SoftwareUpdateCoreSupport 0x00007ff913a9f000 /System/Library/PrivateFrameworks/SoftwareUpdateCoreConnect.framework/Versions/A/SoftwareUpdateCoreConnect 0x00007ff8191b5000 /System/Library/PrivateFrameworks/StreamingZip.framework/Versions/A/StreamingZip 0x00007ff90c06d000 /System/Library/PrivateFrameworks/MSUDataAccessor.framework/Versions/A/MSUDataAccessor 0x00007ff908252000 /usr/lib/libbootpolicy.dylib 0x00007ff91a4d0000 /usr/lib/libpartition2_dynamic.dylib 0x00007ffb0ab32000 /System/Library/PrivateFrameworks/CMPhoto.framework/Versions/A/CMPhoto 0x00007ff817064000 /System/Library/PrivateFrameworks/AppleVPA.framework/Versions/A/AppleVPA 0x00007ff8102df000 /System/Library/Frameworks/MediaToolbox.framework/Versions/A/MediaToolbox 0x00007ff81640d000 /System/Library/PrivateFrameworks/CoreAVCHD.framework/Versions/A/CoreAVCHD 0x00007ff816409000 /System/Library/PrivateFrameworks/Mangrove.framework/Versions/A/Mangrove 0x00007ff81699d000 /System/Library/Frameworks/CoreTelephony.framework/Versions/A/CoreTelephony 0x00007ff81604e000 /System/Library/PrivateFrameworks/CoreAUC.framework/Versions/A/CoreAUC 0x00007ff811ca9000 /usr/lib/libTelephonyUtilDynamic.dylib 0x00007ff90ba36000 /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vImage.framework/Versions/A/Libraries/libCGInterfaces.dylib 0x0000000110727000 /usr/lib/libobjc-trampolines.dylib 0x00007ffc1399c000 /usr/lib/libAccessibilityBaseImplementations.dylib 0x00007ff80f662000 /System/Library/PrivateFrameworks/login.framework/Versions/A/login 0x00007ff816ebf000 /System/Library/Frameworks/LocalAuthentication.framework/Versions/A/LocalAuthentication 0x00007ff816f00000 /System/Library/Frameworks/LocalAuthentication.framework/Support/SharedUtils.framework/Versions/A/SharedUtils 0x00007ff816e5e000 /System/Library/Frameworks/CryptoTokenKit.framework/Versions/A/CryptoTokenKit 0x00007ff8094d3000 /System/Library/PrivateFrameworks/ViewBridge.framework/Versions/A/ViewBridge 0x000000012ffe7000 /usr/local/Cellar/openjdk/21.0.1/libexec/openjdk.jdk/Contents/Home/lib/libosxui.dylib 0x00007ff810bc4000 /usr/lib/libusrtcp.dylib 0x00007ff805b1f000 /usr/lib/libboringssl.dylib 0x00007ffb082da000 /System/Library/PrivateFrameworks/AccessibilityBundles.framework/Versions/A/AccessibilityBundles 0x00007ffa15007000 /System/Library/Extensions/AppleIntelKBLGraphicsMTLDriver.bundle/Contents/MacOS/AppleIntelKBLGraphicsMTLDriver 0x00007ffb0065e000 /System/Library/Extensions/AMDMTLBronzeDriver.bundle/Contents/MacOS/AMDMTLBronzeDriver VM Arguments: jvm_args: -Dsun.awt.keepWorkingSetOnMinimize=true -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole -Dprogram.name=groovyConsole -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf -Dgroovy.home=/usr/local/opt/groovy/libexec -Dtools.jar=/usr/local/opt/openjdk/lib/tools.jar java_command: org.codehaus.groovy.tools.GroovyStarter --main groovy.console.ui.Console --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf --classpath .:/usr/local/opt/openjdk/lib/tools.jar:/usr/local/opt/openjdk/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. java_class_path (initial): /usr/local/opt/groovy/libexec/lib/groovy-4.0.15.jar Launcher Type: SUN_STANDARD [Global flags] intx CICompilerCount = 4 {product} {ergonomic} uint ConcGCThreads = 3 {product} {ergonomic} uint G1ConcRefinementThreads = 10 {product} {ergonomic} size_t G1HeapRegionSize = 2097152 {product} {ergonomic} uintx GCDrainStackTargetSize = 64 {product} {ergonomic} size_t InitialHeapSize = 268435456 {product} {ergonomic} size_t MarkStackSize = 4194304 {product} {ergonomic} size_t MaxHeapSize = 4294967296 {product} {ergonomic} size_t MaxNewSize = 2575302656 {product} {ergonomic} size_t MinHeapDeltaBytes = 2097152 {product} {ergonomic} size_t MinHeapSize = 8388608 {product} {ergonomic} uintx NonNMethodCodeHeapSize = 5839372 {pd product} {ergonomic} uintx NonProfiledCodeHeapSize = 122909434 {pd product} {ergonomic} uintx ProfiledCodeHeapSize = 122909434 {pd product} {ergonomic} uintx ReservedCodeCacheSize = 251658240 {pd product} {ergonomic} bool SegmentedCodeCache = true {product} {ergonomic} size_t SoftMaxHeapSize = 4294967296 {manageable} {ergonomic} bool UseCompressedOops = true {product lp64_product} {ergonomic} bool UseG1GC = true {product} {ergonomic} bool UseNUMA = false {product} {ergonomic} bool UseNUMAInterleaving = false {product} {ergonomic} Logging: Log output configuration: #0: stdout all=warning uptime,level,tags foldmultilines=false #1: stderr all=off uptime,level,tags foldmultilines=false Environment Variables: JAVA_HOME=/usr/local/opt/openjdk CLASSPATH=.:/usr/local/opt/openjdk/lib/tools.jar:/usr/local/opt/openjdk/lib/dt.jar:/usr/local/opt/groovy/libexec/lib PATH=/Users/marslo/.marslo/bin:/Users/marslo/.local/bin:/usr/local/Cellar/icu4c@71.1/71.1/bin:/usr/local/Cellar/icu4c@71.1/71.1/sbin:/opt/kwbuildtools/bin:/usr/local/vim/bin:/Applications/MacVim.app/Contents/bin:/usr/local/opt/llvm/bin:/usr/local/sbin:/usr/local/opt/coreutils/libexec/gnubin:/usr/local/opt/gnu-which/libexec/gnubin:/usr/local/opt/gnu-getopt/bin:/usr/local/opt/grep/libexec/gnubin:/usr/local/opt/gnu-tar/libexec/gnubin:/usr/local/opt/findutils/libexec/gnubin:/usr/local/opt/gnu-indent/libexec/gnubin:/usr/local/opt/gnu-sed/libexec/gnubin:/usr/local/opt/binutils/bin:/usr/local/opt/tcl-tk/bin:/usr/local/opt/python@3.11/libexec/bin:/Users/marslo/Library/Python/3.11/bin:/usr/local/Cellar/node/20.8.0/bin:/usr/local/opt/openjdk/bin:/usr/local/opt/groovy/libexec/bin:/usr/local/opt/ruby/bin:/usr/local/opt/ed/libexec/gnubin:/usr/local/opt/ed/bin:/Users/marslo/.gem/ruby/2.6.0/bin:/usr/local/opt/git-extras/bin:/usr/local/opt/sqlite/bin:/usr/local/opt/openldap/bin:/usr/local/opt/openldap/sbin:/usr/local/opt/curl/bin:/usr/local/opt/openssl@1.1/bin:/usr/local/opt/inetutils/libexec/gnubin:/usr/local/opt/file-formula/bin:/usr/local/opt/gettext/bin:/Users/marslo/.iterm2:/Users/marslo/.docker/bin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Library/Apple/usr/bin:/Applications/iTerm.app/Contents/Resources/utilities SHELL=/usr/local/bin/bash LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8 LC_CTYPE=en_US.UTF-8 LC_NUMERIC=en_US.UTF-8 LC_TIME=en_US.UTF-8 TERM=xterm-256color TMPDIR=/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/ Active Locale: LC_ALL=en_US.UTF-8 LC_COLLATE=en_US.UTF-8 LC_CTYPE=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 LC_MONETARY=en_US.UTF-8 LC_NUMERIC=en_US.UTF-8 LC_TIME=en_US.UTF-8 Signal Handlers: SIGSEGV: crash_handler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_ONSTACK|SA_RESTART|SA_SIGINFO, unblocked SIGBUS: crash_handler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_RESTART|SA_SIGINFO, unblocked SIGFPE: crash_handler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_RESTART|SA_SIGINFO, unblocked SIGPIPE: javaSignalHandler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_RESTART|SA_SIGINFO, blocked SIGXFSZ: javaSignalHandler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_RESTART|SA_SIGINFO, blocked SIGILL: crash_handler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_RESTART|SA_SIGINFO, unblocked SIGUSR2: SR_handler in libjvm.dylib, mask=00000000000000000000000000000000, flags=SA_RESTART|SA_SIGINFO, blocked SIGHUP: UserHandler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_RESTART|SA_SIGINFO, blocked SIGINT: UserHandler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_RESTART|SA_SIGINFO, blocked SIGTERM: UserHandler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_RESTART|SA_SIGINFO, blocked SIGQUIT: UserHandler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_RESTART|SA_SIGINFO, blocked SIGTRAP: crash_handler in libjvm.dylib, mask=11100110000111110111111111111111, flags=SA_RESTART|SA_SIGINFO, unblocked Periodic native trim disabled --------------- S Y S T E M --------------- OS: uname: Darwin 23.0.0 Darwin Kernel Version 23.0.0: Fri Sep 15 14:42:42 PDT 2023; root:xnu-10002.1.13~1/RELEASE_X86_64 x86_64 OS uptime: 0 days 2:45 hours rlimit (soft/hard): STACK 8192k/65532k , CORE 0k/infinity , NPROC 2784/2784 , NOFILE 12544/infinity , AS infinity/infinity , CPU infinity/infinity , DATA infinity/infinity , FSIZE infinity/infinity , MEMLOCK infinity/infinity , RSS infinity/infinity load average: 6.53 6.00 5.66 CPU: total 12 (initial active 12) (6 cores per cpu, 2 threads per core) family 6 model 158 stepping 10 microcode 0xf4, cx8, cmov, fxsr, ht, mmx, 3dnowpref, sse, sse2, sse3, ssse3, sse4.1, sse4.2, popcnt, lzcnt, tsc, tscinvbit, avx, avx2, aes, erms, clmul, bmi1, bmi2, adx, fma, vzeroupper, clflush, clflushopt, rdtscp, f16c machdep.cpu.brand_string:Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz hw.cpufrequency:2200000000 hw.cpufrequency_min:2200000000 hw.cpufrequency_max:2200000000 hw.cachelinesize:64 hw.l1icachesize:32768 hw.l1dcachesize:32768 hw.l2cachesize:262144 hw.l3cachesize:9437184 Memory: 4k page, physical 16777216k(446736k free), swap 0k(0k free) vm_info: OpenJDK 64-Bit Server VM (21.0.1) for bsd-amd64 JRE (21.0.1), built on 2023-10-05T13:08:46Z by \"brew\" with clang Apple LLVM 15.0.0 (clang-1500.0.40.1) END. analysis issue is due to java 8u391 ( version 8 Update 391 (build 1.8.0_391-b13) ) details info $ '/Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java' -version java version \"1.8.0_391\" Java(TM) SE Runtime Environment (build 1.8.0_391-b13) Java HotSpot(TM) 64-Bit Server VM (build 25.391-b13, mixed mode) solution remove old version java [!NOTE|label:see also:] * iMarslo : remove old version java manual cmd $ sudo rm -fr /Library/Internet\\ Plug-Ins/JavaAppletPlugin.plugin $ sudo rm -fr /Library/PreferencePanes/JavaControlPanel.prefPane $ sudo rm -fr ~/Library/Application\\ Support/Oracle/Java using java instead of openjdk [!NOTE|label:see also:] * iMarlso : java remove openjdk $ brew list --formula | grep openjdk openjdk openjdk@17 $ brew remove openjdk Error: Refusing to uninstall /usr/local/Cellar/openjdk/21.0.1 because it is required by gradle, groovy and jdtls, which are currently installed. You can override this and force removal with: brew uninstall --ignore-dependencies openjdk $ brew uninstall --ignore-dependencies openjdk Uninstalling /usr/local/Cellar/openjdk/21.0.1... (600 files, 331.4MB) $ brew uninstall openjdk@17 Uninstalling /usr/local/Cellar/openjdk@17/17.0.9... (635 files, 304.8MB) install java [!NOTE|label:references:] * iMarlso : install dmg Install dmg file on mac via terminal Is there a command to install a dmg # java 21 $ curl -fsSL -O https://download.oracle.com/java/21/latest/jdk-21_macos-x64_bin.dmg $ hdiutil attach jdk-21_macos-x64_bin.dmg $ sudo installer -pkg /Volumes/JDK\\ 21.0.1/JDK\\ 21.0.1.pkg -target / $ sudo hdiutil detach /Volumes/JDK\\ 21.0.1/ # java 17 $ curl -fsSL -O https://download.oracle.com/java/17/latest/jdk-17_macos-x64_bin.dmg $ hdiutil attach jdk-17_macos-x64_bin.dmg $ sudo installer -pkg /Volumes/JDK\\ 17.0.9/JDK\\ 17.0.9.pkg -target / $ sudo hdiutil detach /Volumes/JDK\\ 17.0.9/ $ java -version java version \"21.0.1\" 2023-10-17 LTS Java(TM) SE Runtime Environment (build 21.0.1+12-LTS-29) Java HotSpot(TM) 64-Bit Server VM (build 21.0.1+12-LTS-29, mixed mode, sharing) $ /usr/libexec/java_home -v 17 --exec java -version java version \"17.0.9\" 2023-10-17 LTS Java(TM) SE Runtime Environment (build 17.0.9+11-LTS-201) Java HotSpot(TM) 64-Bit Server VM (build 17.0.9+11-LTS-201, mixed mode, sharing) $ export JAVA_HOME=$(/usr/libexec/java_home -v 21) more$ /usr/libexec/java_home --verbose Matching Java Virtual Machines (3): 21.0.1 (x86_64) \"Oracle Corporation\" - \"Java SE 21.0.1\" /Library/Java/JavaVirtualMachines/jdk-21.jdk/Contents/Home 17.0.9 (x86_64) \"Oracle Corporation\" - \"Java SE 17.0.9\" /Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Home 1.8.0_271 (x86_64) \"Oracle Corporation\" - \"Java SE 8\" /Library/Java/JavaVirtualMachines/jdk1.8.0_271.jdk/Contents/Home /Library/Java/JavaVirtualMachines/jdk-21.jdk/Contents/Home $ hdiutil attach jdk-21_macos-x64_bin.dmg Checksumming Protective Master Boot Record (MBR : 0)… Protective Master Boot Record (MBR :: verified CRC32 $A63E199D Checksumming GPT Header (Primary GPT Header : 1)… GPT Header (Primary GPT Header : 1): verified CRC32 $9E905196 Checksumming GPT Partition Data (Primary GPT Table : 2)… GPT Partition Data (Primary GPT Tabl: verified CRC32 $29140A79 Checksumming (Apple_Free : 3)… (Apple_Free : 3): verified CRC32 $00000000 Checksumming disk image (Apple_HFS : 4)… ....................................................................................................... disk image (Apple_HFS : 4): verified CRC32 $1BBB6538 Checksumming (Apple_Free : 5)… (Apple_Free : 5): verified CRC32 $00000000 Checksumming GPT Partition Data (Backup GPT Table : 6)… GPT Partition Data (Backup GPT Table: verified CRC32 $29140A79 Checksumming GPT Header (Backup GPT Header : 7)… GPT Header (Backup GPT Header : 7): verified CRC32 $015D0E38 verified CRC32 $F5652D51 /dev/disk3 GUID_partition_scheme /dev/disk3s1 Apple_HFS /Volumes/JDK 21.0.1 $ sudo installer -pkg /Volumes/JDK\\ 21.0.1/JDK\\ 21.0.1.pkg -target / installer: Package name is JDK 21.0.1 installer: Installing at base path / installer: The install was successful. $ sudo hdiutil detach /Volumes/JDK\\ 21.0.1/ \"disk3\" ejected. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-06 21:20:42 "},"osx/util.html":{"url":"osx/util.html","title":"util","keywords":"","body":" brew force the link and overwrite everything rerurn postinstall check brew configure file whatprovide alternatives tricky brew command network show network information change order of networks list hardware IP DNS proxy setup wifi firewall reference Mac OS X Server Command-Line Administration brew force the link and overwrite everything $ brew link --overwrite example $ brew link --overwrite --dry-run python@3.8 Would remove: /usr/local/bin/python3 -> /usr/local/Cellar/python@3.9/3.9.0/bin/python3.9 If you need to have this software first in your PATH instead consider running: echo 'export PATH=\"/usr/local/opt/python@3.8/bin:$PATH\"' >> /Users/marslo/.bash_profile rerurn postinstall $ brew postinstall i.e.: $ sudo chown marslo:admin -R /usr/local/lib/python3.8/site-packages $ brew postinstall python@3.8 ==> Postinstalling python@3.8 ==> /usr/local/Cellar/python@3.8/3.8.6_1/bin/python3 -s setup.py --no-user-cfg install --force --verbose --install-scripts=/usr/local/Cellar/python@3.8 ==> /usr/local/Cellar/python@3.8/3.8.6_1/bin/python3 -s setup.py --no-user-cfg install --force --verbose --install-scripts=/usr/local/Cellar/python@3.8 ==> /usr/local/Cellar/python@3.8/3.8.6_1/bin/python3 -s setup.py --no-user-cfg install --force --verbose --install-scripts=/usr/local/Cellar/python@3.8 update homebrew-cask $ git -C \"/usr/local/Homebrew/Library/Taps/homebrew/homebrew-cask\" fetch --unshallow check brew configure file $ brew -v edit i.e.: $ brew -v edit openjdk manual install formula $ brew -v edit macvim $ brew -v fetch --deps macvim $ brew -v install --build-from-source macvim $ brew pin macvim whatprovide alternatives $ pkgutil --file-info /usr/bin/qlmanage volume: / path: /usr/bin/qlmanage pkgid: com.apple.pkg.Core pkg-version: 10.15.0.1.1.1569789135 install-time: 1570542610 uid: 0 gid: 0 mode: 755 for brew formula$ while read formula; do brew list --formula \"${formula}\" | grep -w magick; done tricky reference: Tips and Tricks interactive homebrew shell $ brew irb ==> Interactive Homebrew Shell Example commands available with: brew irb --examples WARNING: This version of ruby is included in macOS for compatibility with legacy software. In future versions of macOS the ruby runtime will not be available by default, and may require you to install an additional package. irb(main):001:0> list dependencies $ brew deps macvim Warning: Treating macvim as a formula. For the cask, use homebrew/cask/macvim cscope gdbm gettext libyaml lua openssl@1.1 python@3.9 readline ruby sqlite xz list who depends on $ brew uses --installed cscope macvim list all formula dpendencies $ brew list | while read cask; do echo -e -n \"\\e[1;34m$cask ->\\e[0m\"; brew deps $cask | awk '{printf(\" %s \", $0)}'; echo \"\"; done e.g.: $ brew list | while read cask; do echo -e -n \"\\e[1;34m$cask ->\\e[0m\"; brew deps $cask | awk '{printf(\" %s \", $0)}'; echo \"\"; done Warning: Calling `brew list` to only list formulae is deprecated! Use `brew list --formula` instead. ack -> adns -> aom -> autoconf -> autoconf-archive -> autoconf automake -> autoconf bash -> bash-completion -> bash-completion@2 -> bash bats -> bdw-gc -> berkeley-db -> openssl@1.1 binutils -> cabal-install -> ghc cairo -> fontconfig freetype gdbm gettext glib libffi libpng lzo openssl@1.1 pcre pixman python@3.8 readline sqlite xz ... brew command command description brew --cache Print path to Homebrew’s download cache (usually ~/Library/Caches/Homebrew) brew --cellar Print path to Homebrew’s Cellar (usually /usr/local/Cellar) brew --config Print system configuration info brew --env Print Homebrew’s environment brew --prefix Print path to Homebrew’s prefix (usually /usr/local) brew --prefix [formula] Print where formula is installed brew audit Audit all formulae for common code and style issues brew cleanup [formula] Remove older versions from the Cellar for all (or specific) formulae1 brew create [url] Generate formula for downloadable file at url and open it in $HOMEBREW_EDITOR or $EDITOR2 brew create [tarball-url] --cache Generate formula (including MD5), then download the tarball brew create --fink [formula] Open Fink’s search page in your browser, so you can see how they do formula brew create --macports [formula] Open MacPorts’ search page in your browser, so you can see how they do formula brew deps [formula] List dependencies for formula brew doctor Check your Homebrew installation for common issues brew edit Open all of Homebrew for editing in TextMate brew edit [formula] Open [formula] in $HOMEBREW_EDITOR or $EDITOR brew fetch --force -v --HEAD [formula] Download source package for formula; for tarballs, also prints MD5, SHA1, and SHA256 checksums brew home Open Homebrew’s homepage in your browser brew home [formula] Opens formula ’s homepage in your browser brew info Print summary of installed packages brew info [formula] Print info for formula (regardless of whether formula is installed) brew info --github [formula] Open Github’s History page for formula in your browser brew install [formula] Install formula brew install --HEAD [formula] Install the HEAD version of formula (if its formula defines HEAD) brew install --force --HEAD [formula] Install a newer HEAD version of formula (if its formula defines HEAD) brew link [formula] Symlink all installed files for formula into the Homebrew prefix3 brew list [formula] List all installed files for formula (or all installed formulae with no arguments ) brew options [formula] Display install options specific to formula brew outdated List formulae that have an updated version available (brew install formula will install the newer version) brew prune Remove dead symlinks from Homebrew’s prefix4 brew remove [formula] Uninstall formula brew search List all available formula brew search [formula] Search for formula in all available formulae brew search /[formula]/ Search for /formula/ (as regex) in all available formulae brew test [formula] If formula defines a test, run it brew unlink [formula] Unsymlink formula from Homebrew’s prefix brew update Update formulae and Homebrew itself brew upgrade Install newer versions of outdated packages brew upgrade [formula] Install newer version of formula brew versions [formula] List previous versions of formulae, along with a command to checkout each version brew analytics [state] Display the current state of Homebrew's analytics brew analytics # turn on/off $ export HOMEBREW_NO_ANALYTICS=1/0 $ brew analytics off/on # check status $ brew analytics InfluxDB analytics are enabled. Google Analytics were destroyed. network show network information $ networksetup -listnetworkserviceorder An asterisk (*) denotes that a network service is disabled. (1) USB 10/100/1000 LAN (Hardware Port: USB 10/100/1000 LAN, Device: en7) (2) Wi-Fi (Hardware Port: Wi-Fi, Device: en0) ... or$ networksetup -listallnetworkservices An asterisk (*) denotes that a network service is disabled. USB 10/100/1000 LAN Wi-Fi Bluetooth PAN Thunderbolt Bridge change order of networks $ networksetup -ordernetworkservices \"Wi-Fi\" \"Ethernet\" \"USB Ethernet\" list hardware $ networksetup -listallhardwareports list detail of hardware$ networksetup -getinfo 'USB 10/100/1000 LAN' DHCP Configuration IP address: 192.168.1.10 Subnet mask: 255.255.255.0 Router: 192.168.1.1 Client ID: IPv6: Automatic IPv6 IP address: none IPv6 Router: none Ethernet Address: **:**:**:**:**:** IP find local device ip address$ arp -a DNS Get Info $ scutil --dns DNS configuration resolver #1 ... resolver #7 DNS configuration (for scoped queries) resolver #1 search domain[0] : ... nameserver[0] : ... nameserver[1] : ... nameserver[2] : ... if_index : ... flags : ... reach : ... setup DNS $ networksetup -getdnsservers Wi-Fi There aren't any DNS Servers set on Wi-Fi. $ networksetup -setdnsservers Wi-Fi 192.168.236.5 192.168.35.78 192.168.2.69 192.168.200.139 $ networksetup -getdnsservers Wi-Fi 192.168.236.5 192.168.35.78 192.168.2.69 192.168.200.139 $ cat /etc/resolv.conf nameserver 192.168.236.5 nameserver 192.168.35.78 nameserver 192.168.2.69 nameserver 192.168.200.139 proxy setup $ networksetup -getwebproxy Wi-Fi Enabled: No Server: Port: 0 Authenticated Proxy Enabled: 0 $ networksetup -getwebproxy Ethernet Enabled: No Server: Port: 0 Authenticated Proxy Enabled: 0 $ networksetup -getproxybypassdomains Ethernet *.local 169.254/16 $ scutil --proxy { HTTPEnable : 0 HTTPSEnable : 0 ProxyAutoConfigEnable : 1 ProxyAutoConfigURLString : http://my.pac.com/global-pac.pac SOCKSEnable : 0 } wifi get wifi name connection currently$ networksetup -getairportnetwork en0 Current Wi-Fi Network: WLAN-PUB connect to another $ networksetup -setairportnetwork en0 WLAN-PUB $ networksetup -getairportnetwork en0 Current Wi-Fi Network: WLAN-PUB $ networksetup -setairportnetwork en0 Automation-4G $ networksetup -getairportnetwork en0 Current Wi-Fi Network: Automation-4G turn on/off wifi $ networksetup -setairportpower en0 on $ networksetup -getairportpower en0 Wi-Fi Power (en0): On $ networksetup -setairportpower en0 off $ networksetup -getairportpower en0 Wi-Fi Power (en0): Off scan available wifi network $ networksetup -setairportpower en0 on $ sudo /System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -s SSID BSSID RSSI CHANNEL HT CC SECURITY (auth/unicast/group) Customer **:**:**:**:**:** -75 11 N CN WEP CorpWLAN **:**:**:**:**:** -72 1 Y CN WPA2(802.1x,Unrecognized(0)/AES/AES) Guest **:**:**:**:**:** -71 1 Y CN NONE disable ipv6 $ networksetup -listallnetworkservices An asterisk (*) denotes that a network service is disabled. USB 10/100/1000 LAN Wi-Fi Bluetooth PAN Thunderbolt Bridge $ networksetup -setv6off 'USB 10/100/1000 LAN' $ networksetup -setv6off Wi-fi undo$ networksetup -setv6automatic 'USB 10/100/1000 LAN' $ networksetup -setv6automatic Wi-Fi show network connection history$ defaults read /Library/Preferences/SystemConfiguration/com.apple.airport.preferences \\ | grep LastConnected -A 7 get wifi password list all Wifi $ defaults read /Library/Preferences/SystemConfiguration/com.apple.airport.preferences | \\grep SSIDString ... SSIDString = \"Apple Network Guest\"; ... get password $ sudo security find-generic-password -ga \"Apple Network Guest\" | grep password\\: password: \"guest@3742\" firewall show status$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate Firewall is disabled. (State = 0) enable firewall$ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-25 20:09:57 "},"osx/system.html":{"url":"osx/system.html","title":"system","keywords":"","body":" system tools hostinfo get human-readable vm_stat show system info show memory show Mach virtual memory statistics check process without interactive mode show system Serial Number hardware memory swap usage show kernel version list printer status osx installation download older version create osx installer usb boot with macOS USB installer Convert a MacOS Installer to ISO flushed disk cache flush DNS clean OSX native dot file launchctl create new plist Q&A SUPreferenceManager: Failed to set object of class: __NSCFString system tools hostinfo $ hostinfo Mach kernel version: Darwin Kernel Version 19.6.0: Mon Aug 31 22:12:52 PDT 2020; root:xnu-6153.141.2~1/RELEASE_X86_64 Kernel configured for up to 12 processors. 6 processors are physically available. 12 processors are logically available. Processor type: x86_64h (Intel x86-64h Haswell) Processors active: 0 1 2 3 4 5 6 7 8 9 10 11 Primary memory available: 16.00 gigabytes Default processor set: 463 tasks, 2557 threads, 12 processors Load average: 2.72, Mach factor: 9.26 get human-readable vm_stat $ paste 1' | grep -o \".*:\") 1' | tr -d '.' | awk '{print $NF}'); do perl -e \"print $i/1024\" | awk '{printf \"%0.2f\", $0}'; echo; done) | column -s: -t Pages free 328.70 Pages active 910.00 Pages inactive 973.38 Pages speculative 39.51 Pages throttled 0.00 Pages wired down 852.52 Pages purgeable 389.65 \"Translation faults\" 174323.38 Pages copy-on-write 7828.62 Pages zero filled 127404.04 Pages reactivated 3420.56 Pages purged 6392.20 File-backed pages 656.69 Anonymous pages 1266.20 Pages stored in compressor 2536.76 Pages occupied by compressor 991.23 Decompressions 1555.85 Compressions 8494.54 Pageins 7799.75 Pageouts 11.98 Swapins 43.15 Swapouts 48.46 show system info $ glances show memory $ top -o MEM iStat $ istats --- CPU Stats --- CPU temp: 53.19°C ▁▂▃▅▆▇ --- Fan Stats --- Total fans in system: 2 Fan 0 speed: 2157 RPM ▁▂▃▅▆▇ Fan 1 speed: 1995 RPM ▁▂▃▅▆▇ --- Battery Stats --- Battery health: unknown Cycle count: 34 ▁▂▃▅▆▇ 3.4% Max cycles: 1000 Current charge: 6093 mAh ▁▂▃▅▆▇ 100% Maximum charge: 6237 mAh ▁▂▃▅▆▇ 85.0% Design capacity: 7336 mAh Battery temp: 36.5°C For more stats run `istats extra` and follow the instructions. show Mach virtual memory statistics $ vm_stat check process without interactive mode $ top -l 1 -n 0 example $ top -l 1 -n 0 Processes: 472 total, 3 running, 469 sleeping, 2589 threads 2020/11/02 16:10:28 Load Avg: 2.67, 2.88, 3.12 CPU usage: 33.4% user, 20.46% sys, 46.49% idle SharedLibs: 268M resident, 69M data, 44M linkedit. MemRegions: 112888 total, 3016M resident, 90M private, 2802M shared. PhysMem: 16G used (3742M wired), 420M unused. VM: 3201G vsize, 1993M framework vsize, 44188(0) swapins, 49627(0) swapouts. Networks: packets: 1575080/1561M in, 1302980/954M out. Disks: 1368885/28G read, 648911/13G written. or$ top -l 1 -s 0 show system Serial Number $ /usr/sbin/system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Name: MacBook Pro Model Identifier: MacBookPro15,1 Processor Name: 6-Core Intel Core i7 Processor Speed: 2.2 GHz Number of Processors: 1 Total Number of Cores: 6 L2 Cache (per Core): 256 KB L3 Cache: 9 MB Hyper-Threading Technology: Enabled Memory: 16 GB Boot ROM Version: 10**.***.*.*.* (iBridge: 17.**.*****.*.*,*) Serial Number (system): ************ Hardware UUID: ********-****-****-****-************ Activation Lock Status: Enabled hardware cpu manufacture$ sysctl -n machdep.cpu.brand_string Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz or$ sysctl machdep.cpu machdep.cpu.max_basic: 22 machdep.cpu.max_ext: 2147483656 machdep.cpu.vendor: GenuineIntel machdep.cpu.brand_string: Intel(R) Core(TM) i7-8750H CPU @ 2.20GHz machdep.cpu.family: 6 ... memory $ system_profiler SPHardwareDataType | grep \"Memory:\\|Cores:\\|Processors:\" Number of Processors: 1 Total Number of Cores: 6 Memory: 16 GB or $ sysctl hw.memsize hw.memsize: 17179869184 $ sysctl hw.ncpu hw.ncpu: 12 memory slot $ system_profiler SPMemoryDataType Memory: Memory Slots: ECC: Disabled Upgradeable Memory: No BANK 0/ChannelA-DIMM0: Size: 8 GB Type: DDR4 Speed: 2400 MHz Status: OK Manufacturer: Micron Part Number: **********-***** Serial Number: - BANK 2/ChannelB-DIMM0: Size: 8 GB Type: DDR4 Speed: 2400 MHz Status: OK Manufacturer: Micron Part Number: **********-***** Serial Number: swap usage $ sysctl vm.swapusage vm.swapusage: total = 1024.00M used = 34.00M free = 990.00M (encrypted) show kernel version $ sysctl kern.version kern.version: Darwin Kernel Version 20.1.0: Sat Oct 31 00:07:11 PDT 2020; root:xnu-7195.50.7~2/RELEASE_X86_64 $ sysctl kern.ostype kern.ostype: Darwin $ sysctl kern.osrelease kern.osrelease: 20.1.0 $ sysctl kern.osrevision kern.osrevision: 199506 or$ uname -a Darwin iMarslo 20.1.0 Darwin Kernel Version 20.1.0: Sat Oct 31 00:07:11 PDT 2020; root:xnu-7195.50.7~2/RELEASE_X86_64 x86_64 i386 MacBookPro15,1 Darwin list printer status $ lpstat -a printer-01 accepting requests since Wed Feb 3 16:40:50 2021 osx installation download older version How to Download Full MacOS Installers from Command Line $ softwareupdate --fetch-full-installer or $ softwareupdate --fetch-full-installer --full-installer-version **.**.* # i.e.: $ softwareupdate --fetch-full-installer --full-installer-version 10.15 MacOS Mojave 10.14.6 Installer $ softwareupdate --fetch-full-installer --full-installer-version 10.14.6 MacOS Catalina 10.15.3 Installer$ softwareupdate --fetch-full-installer --full-installer-version 10.15.3 MacOS High Sierra 10.13.6 Installer$ softwareupdate --fetch-full-installer --full-installer-version 10.13.6 create osx installer usb for Catalina FINAL version$ sudo /Applications/Install\\ macOS\\ Catalina.app/Contents/Resources/createinstallmedia --volume /Volumes/UNTITLED && echo Catalina Boot Drive Created for Catalina BETA version$ sudo /Applications/Install\\ macOS\\ Catalina\\ Beta.app/Contents/Resources/createinstallmedia --volume /Volumes/UNTITLED && echo Catalina Boot Drive Created boot with macOS USB installer connect the macOS Catalina 10.15 beta install drive to to the Mac you want to install Catalina onto reboot the Mac immediately hold down the OPTION key upon boot, keep holding Option until you see the boot menu choose the macOS Catalina 10.15 beta installer volume to boot from Convert a MacOS Installer to ISO download MacOS Mojave installer, or the MacOS Catalina installer (or the installer you wish to turn into an ISO) from the Mac App Store, untill the “Install MacOS Mojave.app” or “Install MacOS Catalina.app” application is fully downloaded and within the /Applications folder, proceed open the Terminal application, create a disk image DMG file via: $ hdiutil create -o /tmp/Mojave -size 8500m -volname Mojave -layout SPUD -fs HFS+J mount the created DMG disk image via: $ hdiutil attach /tmp/Mojave.dmg -noverify -mountpoint /Volumes/Mojave use createinstallmedia to create the macOS installer application on the mounted volume: $ sudo /Applications/Install\\ macOS\\ Mojave.app/Contents/Resources/createinstallmedia --volume /Volumes/Mojave --nointeraction unmount the volume just created: $ hdiutil detach /volumes/Install\\ macOS\\ Mojave convert the DMG disk image file to an ISO disk image file (technically a CDR file but it’s the same as an iso) $ hdiutil convert /tmp/Mojave.dmg -format UDTO -o ~/Desktop/Mojave.cdr rename the CDR file extension to ISO to convert the CDR to ISO: $ mv ~/Desktop/Mojave.cdr ~/Desktop/Mojave.iso more info: Convert ISO to VDI Virtual Box Image flushed [!NOTE|label:references:] How to safely clear cache on Mac disk cache $ sudo purge flush DNS [!NOTE|label:references:] How to safely clear cache on Mac How to Flush DNS $ sudo killall -HUP mDNSResponder # or $ sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder; say cache flushed ventura & monterey $ sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder lion, mountain lion, mavericks, el capitan, sierra, high sierra, mojave $ sudo killall -HUP mDNSResponder yosemite $ sudo discoveryutil mdnsflushcache tiger $ lookupd -flushcache clean OSX native dot file $ dot_clean -mvp i.e.: $ sudo dot_clean -mvp / or $ /usr/local/bin/rg --hidden --smart-case --color=never --files \"$HOME\" -g '*\\.DS_*' | xargs -r rm # or $ /usr/local/bin/fd -Iu --glob '*\\.DS_*' $HOME | xargs -r rm $ find $HOME -name '.DS_Store' -type f -delete # or $ find / -name '._*' -type f -delete # or $ find / -name '._*' -type f -size -4k -delete or disable indexing $ sudo mdutil -i off /Volumes/ or all-in-all actions [!NOTE|label:references:] iMarslo: defaults: disable the .DS_Store and `._` $ sudo defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true $ sudo mdutil -i off /Volumes/ $ sudo rm -rf .{DS_Store,fseventsd,Spotlight-V*,Trashes} for windows > cd c:\\path\\to\\folder > del /s /q /f /a .DS_STORE > del /s /q /f /a:h ._* flush DNS $ ipconfig /flushdns launchctl create new plist cat > ~/Library/LaunchAgents/i.marslo.updatedb.plist Label i.marslo.updatedb ProgramArguments sudo /usr/local/bin/gupdatedb RunAtLoad StandardErrorPath /Users/marslo/.marslo/log/i.marslo.updatedb.log StandardOutPath /Users/marslo/.marslo/log/i.marslo.updatedb.error.log StartInterval 300 KeepAlive EOF check$ plutil ~/Library/LaunchAgents/i.marslo.updatedb.plist /Users/marslo/Library/LaunchAgents/i.marslo.updatedb.plist: OK enable$ launchctl load ~/Library/LaunchAgents/i.marslo.updatedb.plist $ launchctl list | grep updatedb - 1 i.marslo.updatedb disable$ launchctl remove i.marslo.updatedb Q&A SUPreferenceManager: Failed to set object of class: __NSCFString issue:$ softwareupdate --fetch-full-installer Downloading and installing com.apple.InstallAssistant.macOSBigSur installer SUPreferenceManager: Failed to set object of class: __NSCFString for key: LastRecommendedMajorOSBundleIdentifier with error: Error Domain=SUPreferenceManagerErrorDomain Code=1 \"(null)\" SUPreferenceManager: Failed to set object of class: __NSCFString for key: LastRecommendedMajorOSBundleIdentifier with error: Error Domain=SUPreferenceManagerErrorDomain Code=1 \"(null)\" SUPreferenceManager: Failed to set object of class: __NSCFString for key: LastRecommendedMajorOSBundleIdentifier with error: Error Domain=SUPreferenceManagerErrorDomain Code=1 \"(null)\" Installing: 90.0%SUPreferenceManager: Failed to set object of class: __NSCFString for key: LastRecommendedMajorOSBundleIdentifier with error: Error Domain=SUPreferenceManagerErrorDomain Code=1 \"(null)\" Install failed with error: 0 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"osx/network.html":{"url":"osx/network.html","title":"network","keywords":"","body":" check information get interface get ip address get mac address get interface information route check route add a static route item delete a static route vpn check information [!NOTE|label:references:] * imarslo : linux/network $ scutil --nwi Network information IPv4 network interface information en8 : flags : 0x5 (IPv4,DNS) address : 10.1.1.1 reach : 0x00000002 (Reachable) en0 : flags : 0x5 (IPv4,DNS) address : 192.168.6.55 reach : 0x00000002 (Reachable) REACH : flags 0x00000002 (Reachable) IPv6 network interface information No IPv6 states found REACH : flags 0x00000000 (Not Reachable) Network interfaces: en8 en0 get interface # default route $ ip route get $(dig +short github.com | head -1) | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') # or $ ip route get $(nslookup \"${githubIp}\" | grep Server | awk -F' ' '{print $NF}') | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p' en8 # all active interface $ netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}' en0 en8 list all interfaces $ /sbin/ifconfig | grep --color=none flags=8863 | grep -v bridge en5: flags=8863 mtu 1500 en0: flags=8863 mtu 1500 llw0: flags=8863 mtu 1500 en8: flags=8863 mtu 1500 # or $ scutil --nwi | awk -F': ' '/Network interfaces/ {print $2;exit;}' en8 en0 get ip address $ ipAddr=$(/usr/local/bin/ip a s \"${interface}\" | sed -rn 's|\\W*inet[^6]\\W*([0-9\\.]{7,15}).*$|\\1|p') # or via `/sbin/ifconfig` $ ipAddr=$(/sbin/ifconfig \"${interface}\" | sed -rn 's|^\\s+inet\\s+([0-9\\.]+)) get mac address $ ip link show ${interface} | sed -rn 's|.*ether ([0-9a-fA-F:]{17}).*$|\\1|p' | sed 's|:||g' | tr [a-z] [A-Z] get interface information #!/bin/bash while read -r line; do sname=$(echo \"$line\" | awk -F \"(, )|(: )|[)]\" '{print $2}') sdev=$(echo \"$line\" | awk -F \"(, )|(: )|[)]\" '{print $4}') # echo \"Current service: $sname, $sdev, $currentservice\" if [ -n \"$sdev\" ]; then ifout=\"$(/sbin/ifconfig \"$sdev\" 2>/dev/null)\" echo \"$ifout\" | grep 'status: active' > /dev/null 2>&1 rc=\"$?\" if [ \"$rc\" -eq 0 ]; then currentservice=\"$sname\" currentdevice=\"$sdev\" currentip=$(echo \"${ifout}\" | sed -rn 's|^\\s+inet\\s+([0-9\\.]+).*$|\\1|p') currentmac=$(echo \"$ifout\" | awk '/ether/{print $2}') # may have multiple active devices, so echo it here echo \"$currentservice, $currentdevice, $currentmac, ${currentip}\" fi fi done route [!NOTE|label:references:] * imarslo : route * imarslo : ubuntu 17.10 bootup settings Adding a Static Route to macOS How to get routing table in terminal [duplicate] can we change default gateway and interface in mac through commandline Viewing the routing table from the command-line interface Routing table flags * Chapter 4 Administering TCP/IP (Task) route flags FLAG DESCRIPTION U Up—Route is valid G Gateway—Route is to a gateway router H Host name—Route is to a host rather than to a network R Reject—Set by ARP when an entry expires D Dynamic—Route added by a route redirect or RIP M Modified—Route modified by a route redirect C Cloning—A new route is cloned from this entry when it is used L Link—Link-level information, such as the Ethernet MAC address, is present S Static—Route added with the route command check route show all # linux-like route -n $ netstat -nr # or $ netstat -nr -f inet # via `ip route` $ ip route show show particular ip $ route get route to: ec2-1-1-1-1.compute-1.amazonaws.com destination: ec2-1-1-1-1.compute-1.amazonaws.com gateway: 192.168.0.1 interface: en0 flags: recvpipe sendpipe ssthresh rtt,msec rttvar hopcount mtu expire 0 0 0 77 11 0 1500 0 # or via `ip route` $ ip route get 1.1.1.1 1.1.1.1 via 192.168.0.1 dev en0 src 192.168.6.55 display network interface status $ netstat -i log network problems $ /usr/sbin/in.routed /var/logfilename add a static route item $ sudo route -nv add -host # or $ sudo route add -host -iface en1 delete a static route $ sudo route delete vpn [!NOTE|label:references:] * use networksetup or scutil * determining if the system is connected to a vpn from the command line under os x Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"osx/script.html":{"url":"osx/script.html","title":"script","keywords":"","body":" reference: How to automate your keyboard in Mac OS X with AppleScript Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2021-12-15 02:27:29 "},"osx/tricky.html":{"url":"osx/tricky.html","title":"tricky","keywords":"","body":" copy path copy STDOUT into clipboard Copy path from finder create app groovyConsole python IDLE create dmg add snippets for input enable Technical Symbols and snippets finally others install font via command shutdown mac via commands turn off the screen without sleeping launch apps extra pkg create image disk disable startup music 3D lock screen take screenshot after 3 sec setup welcome text in login screen show message on desktop modify font in plist show process details launch iOS simulator copy path copy STDOUT into clipboard [!NOTE] pbcopy for macOS xclip for Linux $ | pbcopy example$ cat file | pbcopy $ pwd | pbcopy Copy path from finder right-click(control + left-click) -> option Automator -> Quick Action Automator -> Apple Script on run {input, parameters} try tell application \"Finder\" to set the clipboard to POSIX path of (target of window 1 as alias) on error beep end try return input end run create app [!NOTE|label:references:] * splaisan/appify.sh advorak/appify.sh pypi: mac-appify 9 Automator Apps You Can Create in Under 5 Minutes How to create an OSX Application to wrap a call to a shell script? CREATE YOUR OWN CUSTOM ICONS IN OS X 10.7.5 OR LATER [UPDATED] groovyConsole [!NOTE|label:expection] case: run groovyConsole from Spolite or Alfred reference: Install groovy console on Mac and make it runnable from dock via Automator.app [!NOTE|label:tips] Automator.app will create whole bunch of necessary files for app. only need to replace the CFBundleExecutable filename Open Automator.app » New » Application Select Run Shell Script » save to .app with empty shell script via script [!NOTE|label:tips:] get standalone commands for the script $ ps aux | grep groovyConsole | grep -v grep marslo 63030 0.0 1.9 42636292 310724 s008 S+ 2:06PM 0:12.48 /usr/local/opt/openjdk/bin/java -Dsun.awt.keepWorkingSetOnMinimize=true -Xdock:name=GroovyConsole -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns -classpath /usr/local/opt/groovy/libexec/lib/groovy-4.0.13.jar -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole -Dprogram.name=groovyConsole -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf -Dgroovy.home=/usr/local/opt/groovy/libexec -Dtools.jar=/usr/local/opt/openjdk/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter --main groovy.console.ui.Console --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf --classpath .:/usr/local/opt/openjdk/lib/tools.jar:/usr/local/opt/openjdk/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. ==> which would be: /usr/local/opt/openjdk/bin/java \\ -Dsun.awt.keepWorkingSetOnMinimize=true \\ -Xdock:name=GroovyConsole \\ -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns \\ -classpath /usr/local/opt/groovy/libexec/lib/groovy-4.0.13.jar \\ -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole \\ -Dprogram.name=groovyConsole \\ -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\ -Dgroovy.home=/usr/local/opt/groovy/libexec \\ -Dtools.jar=/usr/local/opt/openjdk/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter \\ --main groovy.console.ui.Console \\ --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\ --classpath .:/usr/local/opt/openjdk/lib/tools.jar:/usr/local/opt/openjdk/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. $ ps aux | grep groovyConsole | grep -v grep marslo 50495 0.0 3.4 11683536 577828 ?? S 5:50PM 0:15.85 /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/bin/java -Xdock:name=GroovyConsole -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns -Dgroovy.jaxb=jaxb -classpath /usr/local/opt/groovy/libexec/lib/groovy-3.0.6.jar -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole -Dprogram.name=groovyConsole -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf -Dgroovy.home=/usr/local/opt/groovy/libexec -Dtools.jar=/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter --main groovy.console.ui.Console --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf --classpath .:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. ==> which would be: /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/bin/java \\ -Xdock:name=GroovyConsole \\ -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns \\ -Dgroovy.jaxb=jaxb \\ -classpath /usr/local/opt/groovy/libexec/lib/groovy-3.0.6.jar \\ -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole \\ -Dprogram.name=groovyConsole \\ -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\ -Dgroovy.home=/usr/local/opt/groovy/libexec \\ -Dtools.jar=/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter \\ --main groovy.console.ui.Console \\ --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\ --classpath .:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. $ cp /usr/local/opt/groovy/libexec/lib/groovy.icns groovyConsole.app/Contents/Resources $ cat > groovyConsole.app/Contents/MacOS/groovyConsole #!/usr/bin/env bash -> -> JAVA_HOME=\"$(/usr/libexec/java_home -v 21)\" -> GROOVY_HOME=\"$(/usr/local/bin/brew --prefix groovy)/libexec\" -> GROOVY_VERSION=\"$(/usr/bin/sed -rn 's/^[^:]+:[[:blank:]]?([[:digit:].]+)[[:blank:]]?.+$/\\1/p' -> \"${JAVA_HOME}\"/bin/java \\ -> -Dsun.awt.keepWorkingSetOnMinimize=true \\ -> -Xdock:name=GroovyConsole \\ -> -Xdock:icon=\"${GROOVY_HOME}\"/lib/groovy.icns \\ -> -classpath \"${GROOVY_HOME}\"/lib/groovy-\"${GROOVY_VERSION}\".jar \\ -> -Dscript.name=\"${GROOVY_HOME}\"/bin/groovyConsole \\ -> -Dprogram.name=groovyConsole \\ -> -Dgroovy.starter.conf=\"${GROOVY_HOME}\"/conf/groovy-starter.conf \\ -> -Dgroovy.home=\"${GROOVY_HOME}\" \\ -> -Dtools.jar=\"${JAVA_HOME}\"/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter \\ -> --main groovy.console.ui.Console \\ -> --conf \"${GROOVY_HOME}\"/conf/groovy-starter.conf \\ -> --classpath .:\"${JAVA_HOME}\"/lib/tools.jar:\"${JAVA_HOME}\"/lib/dt.jar:\"${GROOVY_HOME}\"/lib -> EOF $ chmod +x groovyConsole.app/Contents/MacOS/groovyConsole $ ls -1 groovyConsole.app/Contents/MacOS/ Automator Application Stub # ignore it groovyConsole # ╮ CFBundleExecutable # ╯ groovyConsole $ mv groovyConsole.app/ /Applications/ $ touch groovyConsole.app/Contents/MacOS/groovyConsole $ cat > groovyConsole.app/Contents/MacOS/groovyConsole #!/usr/bin/env bash -> -> JAVA_HOME=\"$(/usr/local/bin/brew --prefix java)\" -> # JAVA_HOME=\"$(/usr/local/bin/brew --prefix openjdk@17)\" -> GROOVY_VERSION=\"$(/usr/local/bin/groovy --version | /usr/local/opt/gnu-sed/libexec/gnubin/sed -rn 's/^[^:]+:\\s*([0-9\\.]+).*$/\\1/p')\" -> GROOVY_HOME=\"$(/usr/local/bin/brew --prefix groovy)/libexec\" -> -> \"${JAVA_HOME}\"/bin/java \\ -> -Dsun.awt.keepWorkingSetOnMinimize=true \\ -> -Xdock:name=GroovyConsole \\ -> -Xdock:icon=\"${GROOVY_HOME}\"/lib/groovy.icns \\ -> -classpath \"${GROOVY_HOME}\"/lib/groovy-\"${GROOVY_VERSION}\".jar \\ -> -Dscript.name=\"${GROOVY_HOME}\"/bin/groovyConsole \\ -> -Dprogram.name=groovyConsole \\ -> -Dgroovy.starter.conf=\"${GROOVY_HOME}\"/conf/groovy-starter.conf \\ -> -Dgroovy.home=\"${GROOVY_HOME}\" \\ -> -Dtools.jar=\"${JAVA_HOME}\"/lib/tools.jar \\ -> org.codehaus.groovy.tools.GroovyStarter \\ -> --main groovy.console.ui.Console \\ -> --conf \"${GROOVY_HOME}\"/conf/groovy-starter.conf \\ -> --classpath .:\"${JAVA_HOME}\"/lib/tools.jar:\"${JAVA_HOME}\"/lib/dt.jar:\"${GROOVY_HOME}\"/lib:. -> EOF # or $ cat > groovyConsole.app/Contents/MacOS/groovyConsole #!/bin/bash -> /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/bin/java \\\\ -> -Xdock:name=GroovyConsole \\\\ -> -Xdock:icon=/usr/local/opt/groovy/libexec/lib/groovy.icns \\\\ -> -Dgroovy.jaxb=jaxb \\\\ -> -classpath /usr/local/opt/groovy/libexec/lib/groovy-3.0.6.jar \\\\ -> -Dscript.name=/usr/local/opt/groovy/libexec/bin/groovyConsole \\\\ -> -Dprogram.name=groovyConsole \\\\ -> -Dgroovy.starter.conf=/usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\\\ -> -Dgroovy.home=/usr/local/opt/groovy/libexec \\\\ -> -Dtools.jar=/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar org.codehaus.groovy.tools.GroovyStarter \\\\ -> --main groovy.console.ui.Console \\\\ -> --conf /usr/local/opt/groovy/libexec/conf/groovy-starter.conf \\\\ -> --classpath .:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home/lib/dt.jar:/usr/local/opt/groovy/libexec/lib:. -> EOF $ chmod +x groovyConsole.app/Contents/MacOS/groovyConsole try validate via execute groovyConsole.app/Contents/MacOS/groovyConsole directly. to see whether if the groovyConsole will be opened. modify Info.plist $ vim groovyConsole.app/Contents/Info.plist ... CFBundleExecutable groovyConsole « the script name to MacOS/groovyConsole CFBundleIconFile groovy « for icon in Resources/groovy.icns CFBundleIdentifier com.apple.groovyConsole ... originalCFBundleExecutable Application Stub CFBundleIconFile AutomatorApplet CFBundleIdentifier com.apple.automator.groovyConsole additional set the icon for new app optional $ cp /usr/local/opt/groovy/libexec/lib/groovy.icns groovyConsole.app/Contents/Resources or$ ln -sf /usr/local/opt/groovy/libexec/lib/groovy.icns groovyConsole.app/Contents/Resources/groovy.icns python IDLE via automator.app script #/usr/bin/env bash PYTHON_SHORT_VERSION=$(/usr/local/opt/gnu-sed/libexec/gnubin/sed -rn 's/^([^[0-9]+)([0-9]+\\.[0-9]+).*$/\\2/p' icon $ PYTHON_SHORT_VERSION=$(/usr/local/opt/gnu-sed/libexec/gnubin/sed -rn 's/^([^[0-9]+)([0-9]+\\.[0-9]+).*$/\\2/p' CFBundleIconFile IDLE.icns ## original CFBundleIconFile ApplicationStub others$ cat IDLE.app/Contents/Info.plist CFBundleGetInfoString 3.11.6, © 2001-2023 Python Software Foundation CFBundleIconFile IDLE.icns CFBundleIdentifier org.python.IDLE via appify [!NOTE|label:references:] * splaisan/appify.sh advorak/appify.sh shell script $ cat > ~/IDLE create app via appify $ icon=$(brew --prefix python@3.12)/IDLE\\ 3.app/Contents/Resources/IDLE.icns $ ./appify.sh -i ${icon} -s IDLE -n IDLE $ mv IDLE.app /Applications more: Info.plist CFBundleExecutable IDLE CFBundleGetInfoString IDLE CFBundleIconFile IDLE CFBundleName IDLE CFBundlePackageType APPL CFBundleIdentifier org.python.IDLE create dmg $ hdiutil create -volname IDLE -srcfolder ~/Desktop/IDLE.app -ov IDLE.dmg .... created: /Users/marslo/Desktop/IDLE.dmg change default python3 $ ln -sf /usr/local/bin/python3.12 /usr/local/bin/python3 $ ln -sf /usr/local/bin/python3.12-config /usr/local/bin/python3-config # or $ brew unlink python@3.11 $ brew unlink python@3.12 $ brew link --force python@3.12 # or $ brew link --force --overwrite python@3.12 create dmg add snippets for input enable Technical Symbols Input Method ⇢ Show emoji and symbols Open Customized List ⇢ Technical Symbols and snippets go to System Preferences ⇢ Keyboard ⇢ Test add snippets as below finally others install font via command $ curl --create-dirs \\ -O \\ --output-dir ~/.fonts \\ https://dtinth.github.io/comic-mono-font/ComicMono.ttf && \\ curl --create-dirs \\ -O \\ --output-dir ~/.fonts \\ https://dtinth.github.io/comic-mono-font/ComicMono-Bold.ttf && fc-cache -f -v shutdown mac via commands $ osascript -e 'tell app 'loginwindow' to «event aevtrsdn»' turn off the screen without sleeping $ pmset displaysleepnow sleep $ pmset sleepnow lock $ pmset lock launch apps $ launchctl list extra pkg $ xar -xvf foo.pkg create image create dmg image $ hdiutil create -volname \"Volume Name\" \\ -srcfolder /path/to/folder \\ -ov diskimage.dmg i.e.:$ hdiutil create -volname 'groovyConsole' \\ -srcfolder ~/Desktop/groovyConsole.app \\ -ov groovyConsole.dmg ....................... created: /Users/marslo/Desktop/groovyConsole.dmg create encrypted image $ hdiutil create -encryption \\ -stdinpass \\ -volname \"Volume Name\" \\ -srcfolder /path/to/folder \\ -ov encrypted.dmg create dvd (for .iso, .img, .dmg) $ hdiutil burn /path/to/image_file create disk image from volume $ sudo hdiutil create ~/Desktop/.dmg -srcdevice /dev/ i.e.:$ sudo hdiutil create ~/Desktop/Lion.dmg -srcdevice /dev/disk2s4 create disk image from a folder $ hdiutil create .dmg -volname \"\" -srcfolder /path/to/folder' i.e.: $ hdiutil create ~/Desktop/marsloTest.dmg -volname 'marslo test' -srcfolder ~/Desktop/marsloTest/ created: /Users/marslo/Desktop/marsloTest.dmg setup read & write dmg $ hdiutil create ~/Desktop/mTest.dmg \\ -volname \"Marslo Test\" \\ -srcfolder ~/Desktop/mTest \\ -size 1g \\ -format UDRW create encrypted disk image $ hdiutil create mEncrypted.dmg \\ -encryption \\ -size 1g \\ -volname \"mEncrypted Disk Image\" \\ -fs JHFS+ \\ -srcfolder /path/to/folder \\ Enter a new password to secure \"mEncrypted.dmg\": Re-enter new password: .... created: /Users/marslo/Desktop/mEncrypted.dmg resize the disk image $ hdiutil resize -size .dmg i.e.:$ hdiutil resize -size 2g mEncrypted.dmg restore disk images $ sudo asr restore --source .dmg --target /Volumes/ disk reference: Disk Management From the Command-Line, Part 1 Disk Management From the Command-Line, Part 2 Disk Management From the Command-Line, Part 3 check volumn info $ diskutil info i.e.: $ diskutil info /Volumes/iMarsloOSX/ Device Identifier: disk1s5 Device Node: /dev/disk1s5 Whole: No Part of Whole: disk1 Volume Name: iMarsloOSX Mounted: Yes Mount Point: / list disks and volumns $ diskutil list or $ diskutil list disk1 or lsblk $ docker run cmd.cat/lsblk lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT vda 254:0 0 16G 0 disk └─vda1 254:1 0 16G 0 part /etc/hosts or lshw $ docker run cmd.cat/lshw lshw -class disk *-virtio1 description: Virtual I/O device physical id: 0 bus info: virtio@1 logical name: vda configuration: driver=virtio_blk list the apfs info $ diskutil apfs list APFS Container (1 found) | +-- Container disk1 ********-****-****-****-************ ==================================================== APFS Container Reference: disk1 Size (Capacity Ceiling): 250685575168 B (250.7 GB) Capacity In Use By Volumes: 176258826240 B (176.3 GB) (70.3% used) Capacity Not Allocated: 74426748928 B (74.4 GB) (29.7% free) | +- | +-> ... check detail diskage usage $ sudo fs_usage 21:03:47 ioctl 0.000003 iTerm2 21:03:47 ioctl 0.000003 iTerm2 21:03:47 close 0.000031 privoxy 21:03:47 select 0.000004 privoxy ... erase disk File System Abbreviation Mac OS Extended (Journaled) JHFS+ Mac OS Extended HFS+ MS-DOS fat32 FAT32 ExFAT ExFAT $ diskutil listFilesystems ... ------------------------------------------------------------------------------- PERSONALITY USER VISIBLE NAME ------------------------------------------------------------------------------- Case-sensitive APFS APFS (Case-sensitive) (or) APFSX APFS APFS (or) APFSI ExFAT ExFAT Free Space Free Space (or) FREE MS-DOS MS-DOS (FAT) MS-DOS FAT12 MS-DOS (FAT12) MS-DOS FAT16 MS-DOS (FAT16) MS-DOS FAT32 MS-DOS (FAT32) (or) FAT32 HFS+ Mac OS Extended Case-sensitive HFS+ Mac OS Extended (Case-sensitive) (or) HFSX Case-sensitive Journaled HFS+ Mac OS Extended (Case-sensitive, Journaled) (or) JHFSX Journaled HFS+ Mac OS Extended (Journaled) (or) JHFS+ UFSD_NTFS Microsoft NTFS ExFAT $ diskutil eraseDisk ExFAT iMarsloUSB /dev/disk2 Started erase on disk2 Unmounting disk Creating the partition map Waiting for partitions to activate Formatting disk2s2 as ExFAT with name iMarsloUSB Volume name : iMarsloUSB Partition offset : 411648 sectors (210763776 bytes) Volume size : 246534144 sectors (126225481728 bytes) Bytes per sector : 512 Bytes per cluster: 131072 FAT offset : 2048 sectors (1048576 bytes) # FAT sectors : 8192 Number of FATs : 1 Cluster offset : 10240 sectors (5242880 bytes) # Clusters : 962984 Volume Serial # : 5ff81490 Bitmap start : 2 Bitmap file size : 120373 Upcase start : 3 Upcase file size : 5836 Root start : 4 Mounting disk Finished erase on disk2 check $ diskutil info disk2s1 Device Identifier: disk2s1 Device Node: /dev/disk2s1 Whole: No Part of Whole: disk2 Volume Name: EFI Mounted: No Partition Type: EFI File System Personality: MS-DOS FAT32 Type (Bundle): msdos Name (User Visible): MS-DOS (FAT32) ... ... $ diskutil info disk2s2 Device Identifier: disk2s2 Device Node: /dev/disk2s2 Whole: No Part of Whole: disk2 Volume Name: iMarsloUSB Mounted: Yes Mount Point: /Volumes/iMarsloUSB Partition Type: Microsoft Basic Data File System Personality: ExFAT Type (Bundle): exfat Name (User Visible): ExFAT ... ... Verifying and Repairing Volumes $ diskutil verifyVolume /Volumes/ $ diskutil repairVolume /Volumes/ rename volume $ diskutil rename \"\" \"\" Partitioning a Disk reference: GPT: GUID Partition Table APM: Apple Partition Map MBR: Master Boot Records $ diskutil partitionDisk /dev/disk2 GPT JHFS+ New 0b multiple partitions$ diskutil partitionDisk /dev/disk2 GPT \\ JHFS+ First 10g \\ JHFS+ Second 10g \\ JHFS+ Third 10g \\ JHFS+ Fourth 10g \\ JHFS+ Fifth 0b Splitting Partitions $ diskutil splitPartition /dev/disk2s6 \\ JHFS+ Test 10GB \\ JHFS+ Test2 0b Merging Partitions $ diskutil mergePartitions \\ JHFS+ \\ NewName \\ \\ i.e.: $ diskutil mergePartitions JHFS+ NewName disk2s4 disk2s6 check usb $ system_profiler SPUSBDataType or get xml format$ system_profiler -xml SPUSBDataType or$ ioreg -p IOUSB or$ ioreg -p IOUSB -w0 -l or get device name $ ioreg -p IOUSB -w0 | sed 's/[^o]*o //; s/@.*$//' | grep -v '^Root.*' disable startup music $ sudo nvram SystemAudioVolume=\" \" 3D lock screen $ /System/Library/CoreServices/Menu\\ Extras/User.menu/Contents/Resources/CGSession -suspend take screenshot after 3 sec $ screencapture -T 3 -t jpg -P delayedpic.jpg setup welcome text in login screen $ sudo defaults write /Library/Preferences/com.apple.loginwindow LoginwindowText 'Awesome Marslo!!' show message on desktop $ sudo jamf displayMessage -message \"Hello World!\" modify font in plist original $ defaults read ~/Library/Preferences/groovy.console.ui.plist { \"/groovy/console/ui/\" = { autoClearOutput = true; compilerPhase = 4; currentFileChooserDir = \"/Users/marslo/Desktop\"; decompiledFontSize = 12; fontSize = 18; frameHeight = 600; frameWidth = 800; frameX = 198; frameY = 201; horizontalSplitterLocation = 100; inputAreaHeight = 576; inputAreaWidth = 1622; outputAreaHeight = 354; outputAreaWidth = 1676; showClosureClasses = false; showIndyBytecode = false; showScriptClass = true; showScriptFreeForm = false; showScriptInOutput = false; showTreeView = true; threadInterrupt = true; verticalSplitterLocation = 100; }; } or$ /usr/libexec/PlistBuddy -c 'print \":/groovy/console/ui/:fontSize\"' ~/Library/Preferences/groovy.console.ui.plist 18 change$ /usr/libexec/PlistBuddy -c 'Set \":/groovy/console/ui/:fontSize\" 24' ~/Library/Preferences/groovy.console.ui.plist $ /usr/libexec/PlistBuddy -c 'Print \":/groovy/console/ui/:fontSize\"' ~/Library/Preferences/groovy.console.ui.plist 24 show process details launch iOS simulator $ xcrun simctl list $ open -a Simulator --args -CurrentDeviceUDID install the application on the device$ xcrun simctl install $ xcrun simctl launch or$ open -a Simulator.app or$ open /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-27 04:32:57 "},"linux/basic.html":{"url":"linux/basic.html","title":"linux","keywords":"","body":" prompt character metacharacter process substitution example: run script without download example: merge lines of file nstalling tools via running random scripts from unknown sites strace basic commands du sort sort result via human-readable format others you have new mail crontab tricky unicode useful functions search manual page reference The Bash Shell Startup Files Advanced Bash-Scripting Guide download pdf from here or here Perform tab-completion for aliases in Bash dot_file: .bash_aliases killbutmakeitlooklikeanaccident.sh prompt reference: * imarslo: color Bash/Prompt customization Colors using tput What color codes can I use in my PS1 prompt? joseluisq/terminal-git-branch-name.md How to show git branch in terminal and change terminal colours PS1=\"\\[$(tput setaf 0) \\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 1) \\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 2) \\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 3) \\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 4) \\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 5) \\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 6) \\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 7) \\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 8) \\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 9) \\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 10)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 11)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 12)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 13)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 14)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 15)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 16)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 17)\\]my prompt\\[$(tput sgr0)\\]> \" PS1=\"\\[$(tput setaf 18)\\]my prompt\\[$(tput sgr0)\\]> \" or $ DEFAULT=\"\\[$(tput setaf 3)\\]\" # or '\\[\\033[1;38;5;3m\\]' or '\\[\\e[1;33m\\]' $ ifDEFAULT='\\[\\e[1\\;33m\\]' # or '\\[\\033[1\\;38\\;5\\;3m\\]' $ ifRED='\\[\\e[1\\;31m\\]' # or '\\[\\033[1\\;38\\;5\\;1m\\]' $ PS1=\"${DEFAULT}my prompt${RESET} \\$( if [ \\$? != 0 ]; then echo -e ${ifRED}\\\\$; else echo -e ${ifDEFAULT}\\\\$; fi) ${RESET}\" right prompt rightprompt() { printf \"%*s\" $COLUMNS \"right prompt\" } PS1='\\[$(tput sc; rightprompt; tput rc)\\]left prompt > ' character metacharacter Character Where Meaning csh, sh Execute command # csh, sh, ASCII files Start a comment csh, sh Argument separator ` csh, sh Command substitution \" csh, sh Weak Quotes ' csh, sh Strong Quotes \\ csh, sh Single Character Quote variable sh, csh Variable variable csh, sh Same as variable \\ csh, sh Pipe character ^ sh Pipe Character & csh, sh Run program in background ? csh, sh Match one character * csh, sh Match any number of characters ; csh, sh Command separator ;; sh End of Case statement ~ csh Home Directory ~user csh User's Home Directory ! csh History of Commands - Programs Start of optional argument $# csh, sh Number of arguments to script $* csh, sh Arguments to script $@ sh Original arguments to script $- sh Flags passed to shell $? sh Status of previous command $$ sh Process identification number $! sh PID of last background job && sh Short-circuit AND ` ` sh Short-circuit OR . csh, sh Typ. filename extension . sh Source a file and execute as command : sh Nothing command : sh Separates Values in environment variables : csh Variable modifier Character Where Meaning [ ] csh, sh Match range of characters [ ] sh Test %job csh Identifies job Number (cmd;cmd) csh. sh Runs cmd;cmd as a sub-shell { } csh In-line expansions {cmd;cmd } sh Like (cmd;cmd ) without a subshell >ofile csh, sh Standard output >>ofile csh, sh Append to standard output csh, sh Standard Input csh, sh Read until word, substitute variables csh, sh Read until word, no substitution sh Read until word, ignoring TABS >>!file csh Append to file, ignore error if not there >!file csh Output to new file, ignore error if not there >&file csh Send standard & error output to file sh Switch Standard Input to file sh Close Standard Input >&digit sh Switch Standard Output to file >&- sh Close Standard Output digit1 sh Connect digit2 to digit1 digit sh Close file digit digit2>&digit1 sh Connect digit2 to digit1 digit>&- sh Close file digit process substitution [!TIP] Process substitution is a form of redirection where the input or output of a process (some sequence of commands) appear as a temporary file. reference: chapter 23. process substitution Command list enclosed within parentheses>(command_list) Process substitution uses /dev/fd/ files to send the results of the process(es) within parentheses to another process. [1] $ while read branch; do git fetch --all --force; done $ echo >(true) /dev/fd/63 $ echo (true) named pipe similar $ wc get diff in two folders $ diff _book > book.json 3a5 > node_modules $ diff Tue Dec 15 22:48:32 CST 2020 example: run script without download $ bash via curl $ python or$ curl -so - https://raw.githubusercontent.com/giampaolo/psutil/master/scripts/meminfo.py | python via wget $ python or$ wget -qO - https://raw.githubusercontent.com/giampaolo/psutil/master/scripts/meminfo.py | python or $ python or $ python example: merge lines of file inspired by here and here $ cat a t1 t2 t3 t4 $ cat b 11 22 33 44 $ paste additional usage $ cat a | paste -d'\\t' - - - - a b c d e f or $ cat a | paste -d, - - a,b c,d e,f /dev/fd/63 is not a regular file $ more nstalling tools via running random scripts from unknown sites $ ( wget -O - pi.dk/3 || lynx -source pi.dk/3 || curl pi.dk/3/ || \\ fetch -o - http://pi.dk/3 ) > install.sh strace [!NOTE|label:reference] What's the difference between basic commands du top biggest directories under [path]$ du -a [path] | sort -n -r | head -n 5 display the largest files according to human-readable format$ du -hs * | sort -rh | head -5 display the largest folders/files including the sub-directories$ du -Sh | sort -rh | head -5 biggest file sizes $ find -type f -exec du -Sh {} + | sort -rh | head -n 5 # or $ find [PATH] -type f -printf \"%s %p\\n\" | sort -rn | head -n 5 sort sort result via human-readable format $ sudo du -ahx --max-depth=1 | sort -k1 -rh or $ du -sk * | sort -g | awk '{ numBytes = $1 * 1024; numUnits = split(\"B K M G T P\", unit); num = numBytes; iUnit = 0; while(num >= 1024 && iUnit + 1 = 1024 && iUnit + 1 or #! /usr/bin/env bash ducks () { du -cks -x | sort -n | while read size fname; do for unit in k M G T P E Z Y; do if [ $size -lt 1024 ]; then echo -e \"${size}${unit}\\t${fname}\" break fi size=$((size/1024)) done done } ducks > .ducks && tail .ducks or $ du -k ./* | sort -nr | awk '{ split(\"KB,MB,GB\",size,\",\"); } { x = 1;while ($1 >= 1024) {$1 = $1 / 1024;x = x + 1} $1 = sprintf(\"%-4.2f%s\", $1, size[x]); print $0; }' others you have new mail remove $ mail ? delete * No applicable messages. ? q or$ mail -N ? d * ? quit crontab [!NOTE|label:references:] Linux / UNIX Crontab File Location * cron.help Cron Examples Cron Jobs: The Complete Guide for 2023 format * * * * * /home/user/bin/somecommand.sh | | | | | | | | | | | Command or Script to execute | | | | | | | | | Day of week(0-6 | Sun-Sat) | | | | | | | Month(1-12) | | | | | Day of Month(1-31) | | | Hour(0-23) | Min(0-59) tips every odd hours0 1-23/2 * * * every even hours0 */2 * * * sample delete .DS_ 15 */2 * * 1-5 /usr/local/bin/fd --type f --hidden --follow --unrestricted --color=never --exclude .Trash --glob '*\\.DS_*' $HOME | xargs -r rm # or 30 */2 * * 1-5 /usr/local/bin/fd -Iu --glob '*\\.DS_*' $HOME | xargs -r rm # or 30 */2 * * 1-5 /usr/local/bin/rg --hidden --smart-case --color=never --files \"$HOME\" -g '*\\.DS_*' | xargs -r rm flush disk cache 0 * * * * /usr/sbin/purge flush DNS 0 1-23/6 * * * /usr/bin/killall -HUP mDNSResponder localtion macos $ sudo ls -Altrh /usr/lib/cron/tabs/ freebsd/openbsd/netbsd $ sudo ls -Altrh /var/cron/tabs/ centos/rhel/fedora/scientific/rocky/alma linux $ sudo ls -Altrh /var/spool/cron/ debian/ubuntu/mint linux $ sudo ls -Altrh /var/spool/cron/crontabs/ p-ux unix $ sudo ls -Altrh /var/spool/cron/crontabs/ ibm aix unix $ sudo ls -Altrh /var/spool/cron/ tricky references: Searching the manual pages How To Readline Commandline Howto Advanced Commandline Howto unicode references: How do you echo a 4-digit Unicode character in Bash? centos locale utf-8 How can I make iconv replace the input file with the converted output? Your description is vague. Either your terminal does not support Unicode, or you're editing a file that's in latin1 (= iso-8859-1). On a bash or zsh shell, with LC_CTYPE=en_US.UTF-8, run echo $'\\xc3a9'. If you see é, your terminal supports UTF-8. If you see Ã©, your terminal is showing latin1. $ echo $'\\xc3a9' a9 $ echo $'\\xe2\\x98\\xa0' ☠ $ echo $'(U+2620) \\U02620' | xxd 00000000: 2855 2b32 3632 3029 20e2 98a0 0a (U+2620) .... # test for (( i=0x2500; i unicode to utf8 UnicodePointToUtf8() { local x=\"$1\" # ok if '0x2620' x=${x/\\\\u/0x} # '\\u2620' -> '0x2620' x=${x/U+/0x}; x=${x/u+/0x} # 'U-2620' -> '0x2620' x=$((x)) # from hex to decimal local y=$x n=0 [ $x -ge 0 ] || return 1 while [ $y -gt 0 ]; do y=$((y>>1)); n=$((n+1)); done if [ $n -le 7 ]; then # 7 y=$x elif [ $n -le 11 ]; then # 5+6 y=\" $(( ((x>> 6)&0x1F)+0xC0 )) \\ $(( (x&0x3F)+0x80 ))\" elif [ $n -le 16 ]; then # 4+6+6 y=\" $(( ((x>>12)&0x0F)+0xE0 )) \\ $(( ((x>> 6)&0x3F)+0x80 )) \\ $(( (x&0x3F)+0x80 ))\" else # 3+6+6+6 y=\" $(( ((x>>18)&0x07)+0xF0 )) \\ $(( ((x>>12)&0x3F)+0x80 )) \\ $(( ((x>> 6)&0x3F)+0x80 )) \\ $(( (x&0x3F)+0x80 ))\" fi printf -v y '\\\\x%x' $y echo -n -e $y } unichr fast_chr() { local __octal local __char printf -v __octal '%03o' $1 printf -v __char \\\\$__octal REPLY=$__char } function unichr { local c=$1 # Ordinal of char local l=0 # Byte ctr local o=63 # Ceiling local p=128 # Accum. bits local s='' # Output string (( c o )); do fast_chr $(( t = 0x80 | c & 0x3f )) s=\"$REPLY$s\" (( c >>= 6, l++, p += o+1, o>>=1 )) done fast_chr $(( t = p | c )) echo -n \"$REPLY$s\" } useful functions universal extractfunction extract () { case $1 in *.tar.bz2) tar xjf \"$1\" ;; *.tar.gz) tar xzf \"$1\" ;; *.tar.xz) tar Jxvf \"$1\" ;; *.tar.Z) tar xzf \"$1\" ;; *.tar) tar xf \"$1\" ;; *.taz) tar xzf \"$1\" ;; *.tb2) tar xjf \"$1\" ;; *.tbz) tar xjf \"$1\" ;; *.tbz2) tar xjf \"$1\" ;; *.tgz) tar xzf \"$1\" ;; *.txz) tar Jxvf \"$1\" ;; *.zip) unzip \"$1\" ;; *.gz) gunzip \"$1\" ;; *) echo \"'$1' cannot be extracted\" ;; esac } search manual page whatis -r apropos -r Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:25:00 "},"linux/devenv.html":{"url":"linux/devenv.html","title":"devenv","keywords":"","body":" application python vim java groovy gcc glibc troubleshooting lua ruby mono mysql built from source code install from apt repo mysql-connector (jdbc) vncserver application python vim osx linux windows java download jdk 1.8.0_121 $ mkdir -p /opt/java && cd /opt/java $ wget --no-check-certificate \\ -c \\ --header \"Cookie: oraclelicense=accept-securebackup-cookie\" \\ http://download.oracle.com/otn-pub/java/jdk/8u121-b13/e9e7ea248e2c4826b92b3f075a80e441/jdk-8u121-linux-x64.tar.gz # or $ curl -L -C - -b \"oraclelicense=accept-securebackup-cookie\" \\ -O http://download.oracle.com/otn-pub/java/jdk/8u121-b13/e9e7ea248e2c4826b92b3f075a80e441/jdk-8u121-linux-x64.tar.gz $ tar xf jdk-8u121-linux-x64.tar.gz # or $ curl -L -C - -b \"oraclelicense=accept-securebackup-cookie\" \\ -fsS http://download.oracle.com/otn-pub/java/jdk/8u121-b13/e9e7ea248e2c4826b92b3f075a80e441/jdk-8u121-linux-x64.tar.gz | tar xzf - -C /opt/java setup java environment $ sudo bash -c 'cat >> /etc/bash.bashrc' setup default jdk $ sudo update-alternatives --install /usr/bin/java java /opt/java/jdk1.8.0_121/bin/java 999 $ sudo update-alternatives --auto java $ sudo update-alternatives --install /usr/bin/javac javac /opt/java/jdk1.8.0_121/bin/javac 999 $ sudo update-alternatives --auto javac groovy download groovy binary pakcage $ mkdir -p /opt/groovy && cd /opt/groovy $ wget --no-check-certificate -c https://akamai.bintray.com/1c/1c4dff3b6edf9a8ced3bca658ee1857cee90cfed1ee3474a2790045033c317a9?__gda__=exp=1490346679~hmac=6d64a1c3596da50e470fb6a46b182ba2cacab553c66843c8ea292e1e70e4e243&response-content-disposition=attachment%3Bfilename%3D%22apache-groovy-binary-2.4.10.zip%22&response-content-type=application%2Foctet-stream&requestInfo=U2FsdGVkX19cWhR3RJcR6SCy74HUcDg470ifD-nH2EiE5uxtdI5EbUiW_jGoHgZZTVR3qgks9tiU5441axygT9z3ykqpL45d_-9oyTlOp8Gild5Z7iGRzCiwf0kba9uza8iWDxnIxgnUIg5tDe6N8ZQ3R0yFCY4c4w7czwBGyK0 $ unzip apache-groovy-binary-2.4.10.zip setup groovy environment $ sudo bash -c 'cat >> /etc/bash.bashrc' set default groovy $ sudo update-alternatives --install /usr/bin/groovy groovy /opt/groovy/groovy-2.4.10/bin/groovy 999999999 $ sudo update-alternatives --auto groovy # or $ sudo alternatives --config groovy gcc [!NOTE] Index of /sites/sourceware.org/pub/gcc/releases/ gcc.gnu.org Installing GCC How To Install GCC on CentOS 7 Host/Target specific installation notes for GCC install $ mdir -p /opt/gcc $ curl -fsSL https://ftp.mirrorservice.org/sites/sourceware.org/pub/gcc/releases/gcc-13.2.0/gcc-13.2.0.tar.gz | tar xzf - -C /opt/gcc $ cd /opt/gcc/gcc-13.2.0 # prerequisites gcc-13.2.0 $ grep base_url= contrib/download_prerequisites base_url='http://gcc.gnu.org/pub/gcc/infrastructure/' gcc-13.2.0 $ ./contrib/download_prerequisites # config gcc-13.2.0 $ mkdir ../objdir && cd $_ objdir $ ../gcc-13.2.0/configure --disable-multilib # make objdir $ NPROC=\"$(nproc)\" objdir $ tmux # it will take very long time to build, better using tmux to avoid interrupt by ssh session down objdir $ make -j${NPROC} [ | tee make.log ] # install objdir $ sudo make install configure $ sudo mv /usr/bin/g++{,.8.5.0} $ sudo mv /usr/bin/gcc{,.8.5.0} $ sudo mv /usr/bin/c++{,.8.5.0} $ sudo alternatives --install /usr/bin/g++ g++ /usr/local/bin/g++ 50 $ sudo alternatives --install /usr/bin/gcc gcc /usr/local/bin/gcc 50 $ sudo alternatives --install /usr/bin/c++ c++ /usr/local/bin/c++ 50 verify $ gcc --version gcc (GCC) 13.2.0 Copyright (C) 2023 Free Software Foundation, Inc. This is free software; see the source for copying conditions. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. $ g++ --version g++ (GCC) 13.2.0 Copyright (C) 2023 Free Software Foundation, Inc. This is free software; see the source for copying conditions. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. $ c++ --version c++ (GCC) 13.2.0 Copyright (C) 2023 Free Software Foundation, Inc. This is free software; see the source for copying conditions. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. glibc [!NOTE|label:references:] Reverting installation of glibc to CentOS libraries# crash build $ ../configure --prefix=/usr --disable-profile --enable-add-ons --with-headers=/usr/include --with-binutils=/usr/bin Index of /gnu/glibc upgrade glibc due to/lib64/libc.so.6: version `GLIBC_2.18’ not found` glibc-2.28-246.el8.aarch64.rpm safely upgrade glibc on CentOS 7 How to upgrade glibc from version 2.12 to 2.14 on CentOS? * Glibc installation * 谨慎操作. libc.so.6: version `GLIBC_2.14’ not found. harv/glibc-2.17_centos6.sh $ mkdir -p /opt/glibc $ curl -fsSL https://ftp.gnu.org/gnu/glibc/glibc-2.38.tar.xz | tar -xJf - -C /opt/glibc $ mkdir -p /opt/glibc/glibc-2.38/build && cd $_ build $ ../configure --prefix=/opt/glibc/2.38 # or build $ ../configure --prefix `pwd`/../install build $ make -j $(nproc) build $ sudo make install # highly recommended build $ make install DESTDIR=/root/glibc-2.14/staging troubleshooting No rule to make target glibc-build/Versions.all, needed by glibc-build/abi-versions.h. Stop. $ sudo dnf install gawk texinfo make[2]: * [/mnt/lfs/sources/glibc-build/misc/syslog.o] Error 1 $ make clean $ make -j2 CFLAGS=\"-U_FORTIFY_SOURCE -O2 -fno-stack-protector\" ldconfig: Can't open configuration /opt/glibc-2.14/etc $ sudo sh -c \"echo '/usr/local/lib' >> ld.so.conf\" /opt/glibc-2.14/etc $ sudo sh -c \"echo '/opt/lib' >> ld.so.conf\" lua [!NOTE] lua download LuaBinaries Files How to compile Lua 5.4.0 for Linux as a shared library Compiling Lua - create .so files? dcarrith/Makefile.patch dcarrith/src.Makefile.patch * iMarslo : patch for build lua v5.4.6 as a shared library (liblua.so) $ mkdir -p /opt/lua $ curl -fsSL https://www.lua.org/ftp/lua-5.4.6.tar.gz | tar xzf - -C /opt/lua $ cd /opt/lua/lua-5.4.6 $ make all test $ sudo make install build with .so file $ patch --ignore-whitespace ruby [!NOTE|label:references:] How to Install Ruby 3.2 on CentOS & RHEL using RVM rbenv/rbenv rbenv/rbenv-installer * ftp:pub/ruby rbenv $ curl -fsSL https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer | bash # or $ wget -q https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer -O- | bash $ ~/.rbenv/bin/rbenv init $ echo 'export PATH=\"$PATH:$HOME/.rbenv/bin\"' >> ~/.bashrc $ echo 'eval \"$(/home/marslo/.rbenv/bin/rbenv init - bash)\"' >> ~/.bashrc # list latest available versions $ rbenv install -l 3.0.6 3.1.4 3.2.2 3.3.0 jruby-9.4.5.0 mruby-3.2.0 picoruby-3.0.0 truffleruby-23.1.1 truffleruby+graalvm-23.1.1 # install $ rbenv install 3.3.0 ==> Downloading ruby-3.3.0.tar.gz... -> curl -q -fL -o ruby-3.3.0.tar.gz https://cache.ruby-lang.org/pub/ruby/3.3/ruby-3.3.0.tar.gz % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 21.0M 100 21.0M 0 0 27.6M 0 --:--:-- --:--:-- --:--:-- 27.5M ==> Installing ruby-3.3.0... -> ./configure \"--prefix=$HOME/.rbenv/versions/3.3.0\" --enable-shared --with-ext=openssl,psych,+ -> make -j 32 -> make install ==> Installed ruby-3.3.0 to /home/marslo/.rbenv/versions/3.3.0 $ rbenv global 3.3.0 install offline package [!TIP] #2184 Installing Ruby 3.2.2 on FreeBSD fails due to missing libyaml even when it is installed # online machine $ curl -q -fL -o ruby-3.3.0.tar.gz https://cache.ruby-lang.org/pub/ruby/3.3/ruby-3.3.0.tar.gz $ scp ruby-3.3.0.tar.gz account@server.com:~/.rbenv/cache # offline machine $ sudo apt install libyaml-dev libyaml-doc $ export CPPFLAGS=-I/usr/local/include $ export LDFLAGS=-L/usr/local/lib $ rbenv install 3.3.0 ==> Installing ruby-3.3.0... -> ./configure \"--prefix=$HOME/.rbenv/versions/3.3.0\" --enable-shared --with-ext=openssl,psych,+ -> make -j 128 -> make install ==> Installed ruby-3.3.0 to /home/marslo/.rbenv/versions/3.3.0 $ rbenv global 3.3.0 result $ ruby --version ruby 3.3.0 (2023-12-25 revision 5124f9ac75) [x86_64-linux] $ bundler --version Bundler version 2.5.3 rvm $ sudo yum update -y $ sudo yum install curl gpg gcc gcc-c++ make libyaml-devel openssl-devel readline-devel zlib-devel -y $ command curl -sSL https://rvm.io/mpapis.asc | gpg2 --import - $ command curl -sSL https://rvm.io/pkuczynski.asc | gpg2 --import - $ curl -sSL https://get.rvm.io | bash -s stable $ echo \"export PATH=\\\"$PATH:$HOME/.rvm/bin\\\"\" >> ~/.bashrc # verify $ rvm --version rvm 1.29.12 (latest) by Michal Papis, Piotr Kuczynski, Wayne E. Seguin [https://rvm.io] # install ruby $ rvm install 3.3 $ rvm use 3.3 --default mono [!NOTE] mono download mono repo # centos 7 $ sudo su -c 'curl https://download.mono-project.com/repo/centos7-stable.repo |tee /etc/yum.repos.d/mono-centos7-stable.repo' # centos 8 $ sudo rpm --import 'http://pool.sks-keyservers.net/pks/lookup?op=get&search=0x3fa7e0328081bff6a14da29aa6a19b38d3d831ef' $ sudo dnf config-manager --add-repo https://download.mono-project.com/repo/centos8-stable.repo $ sudo yum install mono-devel $ mono --version Mono JIT compiler version 6.12.0.107 (tarball Wed Dec 9 21:44:58 UTC 2020) Copyright (C) 2002-2014 Novell, Inc, Xamarin Inc and Contributors. www.mono-project.com TLS: __thread SIGSEGV: altstack Notifications: epoll Architecture: amd64 Disabled: none Misc: softdebug Interpreter: yes LLVM: yes(610) Suspend: hybrid GC: sgen (concurrent by default) # optional $ sudo yum install mono-complete repo files $ cat -pp mono-centos7-stable.repo [mono-centos7-stable] name=mono-centos7-stable baseurl=https://download.mono-project.com/repo/centos7-stable/ enabled=1 gpgcheck=1 gpgkey=https://download.mono-project.com/repo/xamarin.gpg $ cat -pp mono-centos8-stable.repo [mono-centos8-stable] name=mono-centos8-stable baseurl=https://download.mono-project.com/repo/centos8-stable/ enabled=1 gpgcheck=1 gpgkey=https://download.mono-project.com/repo/xamarin.gpg mysql built from source code build $ sudo groupadd mysql $ sudo useradd -g mysql mysql $ wget http://cdn.mysql.com/archives/mysql-5.5/mysql-5.5.41.tar.gz $ apt install ncurses-dev $ cd myaql-5.5.41 $ cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\ -DDEFAULT_CHARSET=utf8 \\ -DDEFAULT_COLLATION=utf8_general_ci \\ -DENABLED_LOCAL_INFILE=ON \\ -DWITH_INNOBASE_STORAGE_ENGINE=1 \\ -DWITH_FEDERATED_STORAGE_ENGINE=1 \\ -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\ -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \\ -DWITH_DEBUG=0 \\ -DMYSQL_TCP_PORT=3306 $ make $ sudo make install $ sudo systemctl enable mysqld # or $ sysv-rc-conf mysqld on configure $ sudo chown -R mysql:mysql /usr/local/mysql $ /usr/local/mysql/scripts/mysql_install_db --user=mysql $ sudo cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld $ sudo chown -R root /usr/local/mysql/ $ sudo chown -R mysql /usr/local/mysql/data $ /usr/local/mysql/bin/mysqld_safe --user=mysql & $ /usr/local/mysql/bin/mysqladmin -u root password '' # or $ /usr/local/mysql/bin/mysql_secure_installtion install from apt repo $ sudo apt install mysql-server install old version $ sudo add-apt-repository 'deb http://archive.ubuntu.com/ubuntu trusty universe' $ sudo apt update $ sudo apt install mysql-server-5.6 mysql-client-5.6 -y $ sudo mysql_secure_installation reconfiguration $ sudo service mysql start $ sudo mysql_secure_installation mysql-connector (jdbc) download mysql-connector-java-*.tar.gz in mysql official website -> Platform Independent$ wget http://cdn.mysql.com//Downloads/Connector-J/mysql-connector-java-5.1.40.tar.gz vncserver $ sudo apt install vnc4server $ sudo apt install gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:21:46 "},"linux/util/util.html":{"url":"linux/util/util.html","title":"util","keywords":"","body":" system command use parameter in xargs find commands belongs to and come from find alias come from get command from PATH get all google website perm backup restore check perm gpg encrypt bash file install apt keys inode get inode of a file get inodes in a folder check inode status extend inode check linux window size readline & bind get info [!NOTE|label:references:] Hidden features of Bash system command use parameter in xargs $ find . -type f | xargs -n 1 -I FILE bash -c 'echo $(file --mime-type -b FILE)' text/plain text/plain text/plain inode/x-empty text/plain text/plain text/plain text/plain text/plain text/plain find commands belongs to and come from belongs to $ type which which is aliased to `alias | which -a --tty-only --read-alias --show-dot --show-tilde' $ type bello bello is a function bello () { source \"${iRCHOME}/.imac\" } come from $ shopt -s extdebug $ declare -F _completion_loader _completion_loader 2219 /usr/local/Cellar/bash-completion@2/2.11/share/bash-completion/bash_completion $ declare -F _docker _docker 5463 /usr/local/etc/bash_completion.d/docker $ declare -F __git_ps1 __git_ps1 340 /usr/local/etc/bash_completion.d/git-prompt.sh $ declare -F bello bello 79 /Users/marslo/.marslo/.marslorc linux$ bash --debugger $ declare -F _docker _docker 5011 /usr/share/bash-completion/completions/docker find alias come from [!NOTE|label:references:] Is it possible to check where an alias was defined? $ bash -ixlc : 2>&1 | grep ... $ zsh -ixc : 2>&1 | grep ... i.e.:$ bash -ixlc : 2>&1 | grep 'clr=' /Users/marslo/.marslo/.alias/docker::16: alias 'dclr=docker system prune -a -f' /Users/marslo/.marslo/.alias/utils::22: alias clr=clear get command from PATH [!NOTE|label:references:] How to use which on an aliased command? $ type -a kubectl kubectl is aliased to `kubecolor' kubectl is /Users/marslo/.docker/bin/kubectl type -P $ type -P kubectl /Users/marslo/.docker/bin/kubectl /usr/bin/which $ /usr/bin/which kubectl /Users/marslo/.docker/bin/kubectl which --skip-alias $ which --skip-alias kubectl ~/.docker/bin/kubectl shopt -u expand_aliases $ type -a kubectl kubectl is aliased to `kubecolor' kubectl is /Users/marslo/.docker/bin/kubectl $ shopt -u expand_aliases $ type -a kubectl kubectl is /Users/marslo/.docker/bin/kubectl $ shopt -s expand_aliases check alias only $ echo ${BASH_ALIASES[kubectl]} kubecolor get all google website $ whois www.google.com Whois Server Version 2.0 Domain names in the .com and .net domains can now be registered with many different competing registrars. Go to http://www.internic.net for detailed information. Server Name: WWW.GOOGLE.COM.VN Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.TW Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.TR Registrar: TUCOWS DOMAINS INC. Whois Server: whois.tucows.com Referral URL: http://domainhelp.opensrs.net Server Name: WWW.GOOGLE.COM.SA Registrar: OMNIS NETWORK, LLC Whois Server: whois.omnis.com Referral URL: http://domains.omnis.com Server Name: WWW.GOOGLE.COM.PK Registrar: INTERNET.BS CORP. Whois Server: whois.internet.bs Referral URL: http://www.internet.bs Server Name: WWW.GOOGLE.COM.PE Registrar: HOSTOPIA.COM INC. D/B/A APLUS.NET Whois Server: whois.names4ever.com Referral URL: http://www.aplus.net Server Name: WWW.GOOGLE.COM.MX Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.HK Registrar: GKG.NET, INC. Whois Server: whois.gkg.net Referral URL: http://www.gkg.net Server Name: WWW.GOOGLE.COM.DO Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.CO Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.BR Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com Server Name: WWW.GOOGLE.COM.AU Registrar: MELBOURNE IT, LTD. D/B/A INTERNET NAMES WORLDWIDE Whois Server: whois.melbourneit.com Referral URL: http://www.melbourneit.com Server Name: WWW.GOOGLE.COM.AR Registrar: ENOM, INC. Whois Server: whois.enom.com Referral URL: http://www.enom.com >>> Last update of whois database: Mon, 24 Feb 2014 17:24:05 UTC perm [!NOTE|label:references:] backup and restore filer & folder permission backup $ find . -printf '%m\\t%u\\t%g\\t%p\\0' > file.perm restore while read -rd $'\\0' perms user group file; do if [ -e \"$file\" ]; then chown \"$user:$group\" \"$file\" chmod \"$perms\" \"$file\" else echo \"warning: $file not found\" fi done check perm find & printf $ find $PWD -printf '%m\\t%u\\t%g\\t%p\\n' | head 755 marslo staff /Users/marslo 755 marslo staff /Users/marslo/.eclipse 755 marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo 644 marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo/defaults.properties 644 marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo/infos.txt $ find $PWD -printf '%M %u %g %p\\n' | head drwxr-xr-x marslo staff /Users/marslo drwxr-xr-x marslo staff /Users/marslo/.eclipse drwxr-xr-x marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo -rw-r--r-- marslo staff /Users/marslo/.eclipse/org.eclipse.oomph.jreinfo/defaults.properties stat $ stat -c '%A %a %n' * drwx------ 700 Applications drwx------ 700 Desktop drwx------ 700 Documents drwx------ 700 Downloads drwx------ 700 Library drwx------ 700 Movies drwx------ 700 Music drwx------ 700 Pictures drwxr-xr-x 755 Public drwxr-xr-x 755 mywork drwxr-xr-x 755 test namei $ namei -l $PWD /Users/marslo / = drwxr-xr-x l=22 u=root/0 g=admin/80 s=704 m=07-16-2020@13:40:21 Users = drwxr-xr-x l=6 u=root/0 g=admin/80 s=192 m=09-30-2019@04:22:36 marslo = drwxr-xr-x l=72 u=marslo/501 g=staff/20 s=2304 m=07-16-2020@17:37:27 gpg encrypt bash file $ echo \"ls\" > script.bash; gpg -c script.bash; cat script.bash.gpg | gpg -d --no-mdc-warning | bash install apt keys [!TIP] * iMarslo : keyring step by step by apt-key add Hockeypuck OpenPGP keyserver via gpg $ gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF more options$ gpg --ignore-time-conflict \\ --no-options \\ --no-default-keyring \\ --homedir /tmp/tmp.Hrb5ETPac2 \\ --no-auto-check-trustdb \\ --trust-model always \\ --keyring /etc/apt/trusted.gpg \\ --primary-keyring /etc/apt/trusted.gpg \\ --keyserver keyserver.ubuntu.com \\ --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF via apt-key adv $ apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF via apt-key add $ curl -sL \"http://keyserver.ubuntu.com/pks/lookup?op=get&search=0xA6A19B38D3D831EF\" | sudo apt-key add Ghostbird/add-repository $ ./add-repository \"https://keyserver.ubuntu.com/pks/lookup?search=0x3fa7e0328081bff6a14da29aa6a19b38d3d831ef&op=get\" \"deb https://download.mono-project.com/repo/debian stable-buster main\" mono-official-stable.list others # dockerfile RUN apt install -y gnupg ca-certificates RUN gpg --keyserver keyserver.ubuntu.com --recv 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF RUN gpg --export 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF | tee /usr/share/keyrings/mono.gpg >/dev/null RUN gpg --batch --yes --delete-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF RUN echo \"deb [signed-by=/usr/share/keyrings/mono.gpg] https://download.mono-project.com/repo/debian stable-buster main\" | tee /etc/apt/sources.list.d/mono-official-stable.list RUN apt update RUN apt install -y mono-devel inode get inode of a file $ l -i a_b 10224132 -rw-r--r-- 1 marslo marslo 10 Feb 21 00:43 a_b get inodes in a folder stat $ stat -c '%i' ~ 686476 equivalent to $ ls -id ~ 686476 /Users/marslo example $ ls -id /local_storage/docker 2818591238 /local_storage/docker ls $ ls /local_storage/docker -AiR1U | sed -rn '/^[./]/{h;n;};G; s|^ *([0-9][0-9]*)[^0-9][^/]*([~./].*):|\\1:\\2|p' | sort -t : -uk1.1,1n | cut -d: -f2 | sort -V | uniq -c | sort -rn | head -n10 46 /Users/marslo/test/keepalived-2.0.18/lib 29 /Users/marslo/test 28 /Users/marslo/test/keepalived-2.0.18/doc/samples 27 /Users/marslo/test/jenkins/vars 23 /Users/marslo/test/keepalived-2.0.18 22 /Users/marslo/test/keepalived-2.0.18/doc/source 17 /Users/marslo/test/jenkins/jenkinsfile 16 /Users/marslo/test/autosquash/.git/objects 14 /Users/marslo/test/keepalived-2.0.18/keepalived/vrrp 14 /Users/marslo/test/jenkins/configs/etc/yum.repos.d df $ df -i Filesystem Type Inodes IUsed IFree IUse% Mounted on /dev/disk1s5s1 apfs 2.3G 555K 2.3G 1% / /dev/disk1s4 apfs 2.3G 2 2.3G 1% /System/Volumes/VM /dev/disk1s2 apfs 2.3G 1.2K 2.3G 1% /System/Volumes/Preboot /dev/disk1s6 apfs 2.3G 16 2.3G 1% /System/Volumes/Update /Library/Input Methods/SogouInput.app nullfs 2.3G 1.8M 2.3G 1% /private/var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/AppTranslocation/1E49F6C4-251F-443B-8D8A-86DA8F531F09 du$ sudo du --inodes -S ~ \\ | sort -rh \\ | sed -n '1,50{/^.\\{71\\}/s/^\\(.\\{30\\}\\).*\\(.\\{37\\}\\)$/\\1...\\2/;p}' \\ | head -10 14994 /Users/marslo/Library/Co...icrosoft User Data/OneNote/15.0/cache 13453 /Users/marslo/Library/Gr...s/Main Profile/Files/S0/1/Attachments 4667 /Users/marslo/Library/Caches/Google/Chrome Canary/Default/Cache 4086 /Users/marslo/Library/Gro...ofiles/Marvell/Files/S0/1/Attachments 3912 /Users/marslo/Library/Con...476b0cb6d7b78ea9f492c743c1bdfa/Avatar 3359 /Users/marslo/Library/Con...6d7b78ea9f492c743c1bdfa/Stickers/File 3174 /Users/marslo/Library/App...versions/3.8.6/openssl/share/man/man3 3174 /Users/marslo/Library/App...6/openssl/share/doc/openssl/html/man3 3174 /Users/marslo/Library/App...versions/3.7.9/openssl/share/man/man3 3174 /Users/marslo/Library/App...9/openssl/share/doc/openssl/html/man3 check inode status $ sudo tune2fs -l /dev/sdb1 | grep inode Filesystem features: has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize Free inodes: 234152632 First inode: 11 Journal inode: 8 First orphan inode: 44171696 Journal backup: inode blocks extend inode reference: Modifying the inode count for an ext2/ext3/ext4 file system RHEL: Extending the maximum inode count on a ext2/ext3/ext4 filesystem check linux window size check$ shopt | grep checkwinsize checkwinsize on enable$ shopt -s checkwinsize readline & bind [!NOTE] 8.4.6 Letting Readline Type For You get info get current keymap $ bind -v | awk '/keymap/ {print $NF}' vi-insert tricky for switch keymap set keymap emacs \"\\ee\": vi-editing-mode set keymap vi-insert \"\\e\": vi-movement-mode set keymap vi-command \"\\ee\": emacs-editing-mode Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:52:48 "},"linux/util/date.html":{"url":"linux/util/date.html","title":"time & date","keywords":"","body":" timezone timezone setup tzdata installation with noninteractive date epoch timestamps format IOS 8601 rfc-3339 utc timezone common formats convert timestamps to epoch epoch to timestamps convert in different timezone calculate time different transfer date format references: * imarslo: groovy time https://en.wikipedia.org/wiki/Unix_time: timezone timezone setup $ sudo dpkg-reconfigure tzdata tzdata installation with noninteractive [!NOTE|label:references:] apt-get install tzdata noninteractive # in bash $ DEBIAN_FRONTEND=noninteractive sudo apt-get install -y tzdata # or $ export DEBIAN_FRONTEND=noninteractive $ sudo apt install -y tzdata # or $ echo 'tzdata tzdata/Areas select Europe' | debconf-set-selections $ echo 'tzdata tzdata/Zones/Europe select Paris' | debconf-set-selections $ DEBIAN_FRONTEND=\"noninteractive\" sudo apt install -y tzdata # or $ sudo ln -fs /usr/share/zoneinfo/America/New_York /etc/localtime $ export DEBIAN_FRONTEND=noninteractive $ sudo apt-get install -y tzdata $ sudo dpkg-reconfigure --frontend noninteractive tzdata or [!NOTE|label:references:] Cingulata/Dockerfile.bfv $ sudo ln -snf /usr/share/zoneinfo/$(curl https://ipapi.co/timezone) /etc/localtime $ sudo apt install -y tzdata or in dockerfile RUN apt-get update \\ && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends tzdata or ENV in dockerfile [!NOTE|label:references:] setting it via ENV should be actively discouraged ENV DEBIAN_FRONTEND noninteractive RUN apt-get update \\ && apt-get install -y --no-install-recommends tzdata or ARG in dockerfile [!NOTE|label:references:] apt-get install tzdata noninteractive from ubuntu:bionic ARG DEBIAN_FRONTEND=noninteractive RUN apt-get update && apt-get install -y tzdata RUN unlink /etc/localtime RUN ln -s /usr/share/zoneinfo/America/New_York /etc/localtime date epoch references: It is the number of seconds that have elapsed since the Unix epoch, minus leap seconds; the Unix epoch is 00:00:00 UTC on 1 January 1970 What is epoch time? $ date -u -d '1970-01-01 00:00:00' '+Normal: %F %T %:z%nUnix: %s' Normal: 1970-01-01 00:00:00 +00:00 Unix: 0 $ date -d '1970-01-01 00:00:00' '+Normal: %F %T %:z%nUnix: %s' Normal: 1970-01-01 00:00:00 +08:00 Unix: -28800 $ date -u -d '1970-01-01 00:00:00 UTC +1 day' '+Normal: %F %T %:z%nUnix: %s' Normal: 1970-01-02 00:00:00 +00:00 Unix: 86400 $ date '+%s%3N' 1602231334983 $ date '+%s' 1602231334 timestamps format [!TIP] yyyy-MM-dd'T'HH:mm:ss.SSSZ yyyy-MM-dd'T'HH:mm:ss DATE FORMAT OPTION MEANING EXAMPLE OUTPUT date +%c locale’s date time Sat May 9 11:49:47 2020 date +%x locale’s date 05/09/20 date +%X locale’s time 11:49:47 date +%A locale’s full weekday name Saturday date +%B locale’s full month name May date +%m-%d-%Y MM-DD-YYYY date format 05-09-2020 date +%D MM/DD/YY date format 05/09/20 date +%F YYYY-MM-DD date format 2020-05-09 date +%T HH:MM:SS time format 11:44:15 date +%u Day of Week 6 date +%U Week of Year with Sunday as first day of week 18 date +%V ISO Week of Year with Monday as first day of week 19 date +%j Day of Year 130 date +%Z Timezone PDT date +%m Month of year (MM) 05 date +%d Day of Month (DD) 09 date +%Y Year (YY) 2020 date +%H Hour (HH) 11 date +%H Hour (HH) in 24-hour clock format 11 date +%I Hour in 12-hour clock format 11 date +%p locale’s equivalent of AM or PM AM date +%P same as %p but in lower case am classical date format $ secs=259200 $ date -u -d @${secs} +\"%F\" 1970-01-04 $ date -u -d @${secs} +\"%T\" 00:00:00 $ date -u -d @${secs} +\"%F %T\" 1970-01-04 00:00:00 $ date -u -d @${secs} -Is 1970-01-04T00:00:00+00:00 date format with timezone $ date -u +\"%Y-%m-%dT%H:%M:%SZ\" 2020-10-09T08:14:47Z $ date +%FT%T.%3N%:z 2020-10-09T17:27:18.491+08:00 $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" 2020-10-09T08:14:47.167Z $ date +%Y-%m-%d-T%H:%M:%S.%3N%z 2020-10-09-T17:27:18.491+0800 details $ date -u -d \"2019-01-19T05:00:00 - 2 hours\" +%Y-%m-%d_%H:%M:%S%Z --debug date: parsed datetime part: (Y-M-D) 2019-01-19 05:00:00 UTC-02 date: parsed relative part: +1 hour(s) date: input timezone: parsed date/time string (-02) date: using specified time as starting value: '05:00:00' date: starting date/time: '(Y-M-D) 2019-01-19 05:00:00 TZ=-02' date: '(Y-M-D) 2019-01-19 05:00:00 TZ=-02' = 1547881200 epoch-seconds date: after time adjustment (+1 hours, +0 minutes, +0 seconds, +0 ns), date: new time = 1547884800 epoch-seconds date: timezone: Universal Time date: final: 1547884800.000000000 (epoch-seconds) date: final: (Y-M-D) 2019-01-19 08:00:00 (UTC) date: final: (Y-M-D) 2019-01-19 08:00:00 (UTC+00) 2019-01-19_08:00:00UTC IOS 8601 FORMAT EXAMPLE YYYY 2015 YYYY-MM 2015-12 YYYY-MM-DD 2015-12-11 YYYY-MM-DD'T'hh:mmTZD 2015-12-11T20:28+01:00 or 2015-12-11T19:28Z YYYY-MM-DD'T'hh:mm:ssTZD 2015-12-11T20:28:30+01:00 or 2015-12-11T19:28:30Z YYYY-MM-DD'T'hh:mm:ss.sTZD 2015-12-11T20:28:30.45+01:00 or 2015-12-11T19:28:30.45Z where: YYYY = four-digit year MM = two-digit month (01=January, etc.) DD = two-digit day of month (01 through 31) hh = two digits of hour (00 through 23) (am/pm NOT allowed) mm = two digits of minute (00 through 59) ss = two digits of second (00 through 59) s = one or more digits representing a decimal fraction of a second (i.e. milliseconds) TZD = time zone designator (Z or +hh:mm or -hh:mm) $ date -I 2020-10-09 $ date -Is && date -Isecond 2020-10-09T16:31:47+08:00 2020-10-09T16:31:47+08:00 $ date -Ih 2020-10-09T16+08:00 $ date -Im 2020-10-09T16:31+08:00 rfc-3339 $ date --rfc-3339=date 2020-10-09 $ date --rfc-3339=ns 2020-10-09 17:32:14.158684000+08:00 $ date --rfc-3339=seconds 2020-10-09 17:32:14+08:00 utc $ date Fri Oct 9 17:09:34 CST 2020 $ date -u Fri Oct 9 09:09:34 UTC 2020 timezone [!NOTE|label:references:] list all timezone: $ timedatectl list-timezones | more # or $ tree /usr/share/zoneinfo/ $ date '+%Z' CST $ date '+%z' +0800 $ date '+%:z' +08:00 $ date '+%::z' +08:00:00 $ date '+%:::z' +08 $ echo $TZ Asia/Beijing $ timedatectl Local time: Tue 2023-08-22 05:58:45 CST Universal time: Mon 2023-08-21 21:58:45 UTC RTC time: Mon 2023-08-21 21:53:46 Time zone: Asia/Beijing (CST, +0800) NTP enabled: yes NTP synchronized: yes RTC in local TZ: no DST active: n/a common formats [!NOTE|label:references:] Shell command: date Most common Bash date commands for timestamping FORMAT/RESULT COMMAND OUTPUT YYYY-MM-DD date -I 2020-10-09 YYYY-MM-DD_hh:mm:ss date +%F_%T 2020-10-09_16:48:45 YYYYMMDD_hhmmss date +%Y%m%d_%H%M%S 20201009_164845 YYYYMMDD_hhmmss (UTC version) date --utc +%Y%m%d_%H%M%SZ 20201009_084845Z YYYYMMDD_hhmmss (with local TZ) date +%Y%m%d_%H%M%S%Z 20201009_164845CST YYYYMMSShhmmss date +%Y%m%d%H%M%S 20201009164845 YYYYMMSShhmmssnnnnnnnnn date +%Y%m%d%H%M%S%N 20201009164845495302000 YYMMDD_hhmmss date +%y%m%d_%H%M%S 201009_164845 Seconds since UNIX epoch: date +%s 1602233325 Nanoseconds only: date +%N 505337000 Nanoseconds since UNIX epoch: date +%s%N 1602233325508581000 Nanoseconds since UNIX epoch: date +%s%3N 1602233325508 ISO8601 UTC timestamp date --utc +%FT%TZ 2020-10-09T08:48:45Z ISO8601 UTC timestamp date --utc +%FT%T%Z 2020-10-09T08:48:45UTC ISO8601 UTC timestamp + ms date --utc +%FT%T.%3NZ 2020-10-09T08:48:45.517Z ISO8601 UTC timestamp + ms date --utc +%FT%T.%3N%Z 2020-10-09T08:48:45.520UTC ISO8601 Local TZ timestamp date +%FT%T%Z 2020-10-09T16:48:45CST YYYY-MM-DD (Short day) date +%F\\(%a\\) 2020-10-09(Fri) YYYY-MM-DD (Long day) date +%F\\(%A\\) 2020-10-09(Friday) convert $ date +\"%Y-%m-%dT%H:%M:%SZ\" 2020-10-09T17:16:37Z $ date -u +\"%Y-%m-%dT%H:%M:%SZ\" 2020-10-09T09:16:37Z $ date -d $(date -u +\"%Y-%m-%dT%H:%M:%SZ\") Fri Oct 9 17:16:37 CST 2020 HUMAN-READABLE TIME SECONDS 1 hour 3600 seconds 1 day 86400 seconds 1 week 604800 seconds 1 month (30.44 days) 2629743 seconds 1 year (365.24 days) 31556926 seconds timestamps to epoch $ echo $EPOCHSECONDS 1602235097 $ date -d $(date -u +\"%Y-%m-%dT%H:%M:%SZ\") +%s 1602235097 $ date --date=$(date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\") +%s%3N 1602235097801 epoch to timestamps $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" 2020-10-09T09:18:17.795Z $ date -d @1602235097 +%c Fri Oct 9 17:18:17 2020 $ date -d @1602235097 Fri Oct 9 17:18:17 CST 2020 $ date -d @1602235097 -u Fri Oct 9 09:18:17 UTC 2020 convert epoch with milliseconds Convert unix timestamp to hh:mm:ss:SSS (where SSS is milliseconds) d=$(date +%s%3N) s=${d%???} ms=${d#\"$s\"} date -d \"@$s\" +\"%F %T.$ms %z\" result 2020-10-09 18:28:34.534 +0800 d: 1602239314534 s: 1602239314 ms: 534 convert in different timezone [!NOTE|label:references:] CST to UTC conversion timezone can be found via: $ cat /usr/share/zoneinfo # or $ timedatectl list-timezones | more $ TZ=\"Asia/Shanghai\" date -d @$(date -d \"2023-01-01 00:00:00 GMT\" +\"%s\") Sun Jan 1 08:00:00 CST 2023 $ TZ=\"America/Los_Angeles\" date -d @$(date -d \"2023-01-01 00:00:00 GMT\" +\"%s\") Sat Dec 31 16:00:00 PST 2022 convert to another timezone $ date --date='TZ=\"GTM\" 15:00 tomorrow' Tue Aug 22 08:00:00 PDT 2023 $ echo $TZ America/Los_Angeles $ date --date='TZ=\"Asia/Shanghai\" 16:00 tomorrow' Wed Aug 23 01:00:00 PDT 2023 $ echo $TZ America/Los_Angeles $ TZ=\"Asia/Shanghai\" date -d 'TZ=\"America/Los_Angeles\" 0:00 tomorrow' Tue Aug 22 15:00:00 CST 2023 calculate time different $ date -d 'now + 3 weeks' Fri Oct 30 20:32:04 CST 2020 $ date -d 'now + 3 weeks' +%s 1604061130 $ date -d 'Jan 1 + 11 weeks' Wed Mar 18 00:00:00 CST 2020 $ date -d 'Jan 1 2021 + 11 weeks' Fri Mar 19 00:00:00 CST 2021 time described by STRING $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" -d '90 day ago' 2020-07-11T08:14:03.145Z $ date -u +\"%Y-%m-%dT%H:%M:%S.%3NZ\" -d '3 months ago' 2020-07-09T08:14:47.164Z $ date -u -d \"2019-01-19T05:00:00Z - 2 hours\" +%Y-%m-%d_%H:%M:%S 2019-01-19_03:00:00 $ date -d \"$(date -Iseconds -d \"2018-12-10 00:00:00\") - 5 hours - 20 minutes - 5 seconds\" Sun Dec 9 18:39:55 CST 2018 $ date -d \"2018-12-10 00:00:00 5 hours ago 20 minutes ago 5 seconds ago\" Sun Dec 9 18:39:55 CST 2018 two times different $ seconds=$(date +%s) $ printf \"%d days %(%H hours %M minutes %S seconds)T\\n\" $((seconds/86400)) $seconds 18544 days 18 hours 35 minutes 48 seconds simple one-liner $ secs=259200 $ printf '%dh:%dm:%ds\\n' $(($secs/3600)) $(($secs%3600/60)) $(($secs%60)) 72h:0m:0s with leading zero $ printf '%02dh:%02dm:%02ds\\n' $(($secs/3600)) $(($secs%3600/60)) $(($secs%60)) 72h:00m:00s with days $ printf '%dd:%dh:%dm:%ds\\n' $(($secs/86400)) $(($secs%86400/3600)) $(($secs%3600/60)) $(($secs%60)) 3d:0h:0m:0s with nanoseconds $ printf '%02dh:%02dm:%02fs\\n' $(echo -e \"$secs/3600\\n$secs%3600/60\\n$secs%60\"| bc | xargs echo) 72h:00m:0.000000s datediff (ddiff) $ datediff -f \"%d days, %H hours, %M mins, %S secs\" \"$(date +'%Y-%m-%d %H:%M:%S')\" \"$(date +'%Y-%m-%d %H:%M:%S' -d '3 days ago')\" -3 days, 0 hours, 0 mins, 0 secs or with specific format $ ddiff -i '%Y%m%d%H%M%S' 20190817040001 20200312000101 17956860s $ ddiff -f \"%d days, %H hours, %M mins, %S secs\" -i '%Y%m%d%H%M%S' 20190817040001 20200312000101 207 days, 20 hours, 1 mins, 0 secs calculate with epoch $ awk -v t=$(( $(date -d $(date +\"%Y-%m-%dT%H:%M:%SZ\") +%s) - $(date -d $(date +\"%Y-%m-%dT%H:%M:%SZ\" -d '3 days ago') +%s) )) 'BEGIN{ printf \"%d:%02d:%06.3f\\n\", t/3600, (t/60)%60, t%60}' 72:00:00.000 transfer date format [!TIP] $ date +'%Y%m%d%H%M%S' 20201009184852 $ d1=$(date +'%Y%m%d%H%M%S') $ date --date \"$(echo $d1 | sed -nr 's/(....)(..)(..)(..)(..)(..)/\\1-\\2-\\3 \\4:\\5:\\6/p')\" Fri Oct 9 18:48:52 CST 2020 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:16:56 "},"linux/util/chars.html":{"url":"linux/util/chars.html","title":"output formatting","keywords":"","body":" formatting padding solution padRight .join() alike in shell show all line numbers in a file get the common part revert a string format a file to a table convert multiple line into one others file ending crlf or lf insert into the first line find and replace find and copy get the count of a word in a file print 50th char show last n lines in a file shell parameter expansion formatting padding [!NOTE|label:references:] Padding characters in printf solution printf $ printf \"%-50s%s\\n\" '123456' '[STATUS]' 123456 [STATUS] $ printf \"%-50s%s\\n\" '1234567890' '[STATUS]' 1234567890 [STATUS] $ printf \"%-50s%s\\n\" '123456~' '~[STATUS]' | tr ' ~' '. ' 123456 ........................................... [STATUS] $ printf \"%-50s%s\\n\" '1234567980~' '~[STATUS]' | tr ' ~' '. ' 1234567980 ....................................... [STATUS] ${var:length} $ str1='123456' $ str2='1234567890' $ line=$(printf '%0.1s' \".\"{1..40}) # or $ line='----------------------------------------' # check length via ${#} $ echo ${#str1} # 6 ( length ) $ echo ${#str2} # 10 ( length ) $ echo ${#line} # 40 ( length ) # echo line with line-length - string-length via ${var:length} $ echo ${line} # ---------------------------------------- $ echo ${line:6} # ---------------------------------- $ echo -e \"${str1} [up] \\n${str2} [down]\" | while read str status; do printf \"%s %s %s\\n\" \"${str}\" \"${line:${#str}}\" \"${status}\"; done 123456 ---------------------------------- [up] 1234567890 ------------------------------ [down] padRight [!NOTE] references: ascii ASCII CHARACTER \\x2b + \\x2c , \\x2d - \\x2e . \\x3d = \\x5e ^ \\x5f _ function padRight() { IFS=':' read -r param value length padlength=${length:-40} pad=$(printf '\\x2e%.0s' $(seq \"${padlength}\")) printf \"%s %s %s\\n\" \"${param}\" \"${pad:${#param}}\" \"${value}\" } echo '1234 : abc' | padRight echo '1234567890 : efg' | padRight echo '1234567890 : [bar] : 30' | padRight echo '123 : [foo] : 30' | padRight # result : # 1234 ................................... abc # 1234567890 ............................. efg # 1234567890 ................... [bar] # 123 .......................... [foo] or pad=$(printf '%0.1s' \"-\"{1..60}) padlength=40 string2='bbbbbbb' for string1 in a aa aaaa aaaaaaaa; do printf '%s' \"$string1\" printf '%*.*s' 0 $((padlength - ${#string1} - ${#string2} )) \"$pad\" printf '%s\\n' \"$string2\" string2=${string2:1} done # result # a--------------------------------bbbbbbb # aa--------------------------------bbbbbb # aaaa-------------------------------bbbbb # aaaaaaaa----------------------------bbbb or while read PROC_NAME STATUS; do printf \"%-50s%s\\n\" \"$PROC_NAME~\" \"~[$STATUS]\" | tr ' ~' '- ' done .join() alike in shell paste $ seq 1 100 | paste -sd ':' - 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53:54:55:56:57:58:59:60:61:62:63:64:65:66:67:68:69:70:71:72:73:74:75:76:77:78:79:80:81:82:83:84:85:86:87:88:89:90:91:92:93:94:95:96:97:98:99:100 # others $ seq 1 100 | paste -sd \"\\0\" 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100 sed $ seq 1 100 | sed ':a; N; $!ba; s/\\n/:/g' 1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16:17:18:19:20:21:22:23:24:25:26:27:28:29:30:31:32:33:34:35:36:37:38:39:40:41:42:43:44:45:46:47:48:49:50:51:52:53:54:55:56:57:58:59:60:61:62:63:64:65:66:67:68:69:70:71:72:73:74:75:76:77:78:79:80:81:82:83:84:85:86:87:88:89:90:91:92:93:94:95:96:97:98:99:100 awk (ORS) $ seq 1 100 | awk 'ORS=\",\"' 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100, ls -m $ ls -m Applications, Desktop, Documents, Downloads, Library, Movies, Music, Pictures, Public, show all line numbers in a file cat $ sudo cat /etc/passwd | wc -l 36 awk $ awk 'END {print NR}' /etc/passwd 36 get the common part [!NOTE|label:see also:] iMarslo: comm $ cat a.txt 1 2 3 $ cat b.txt 3 4 5 9 $ comm -12 a.txt b.txt > common $ cat common 3 revert a string $ echo linux | rev xunil format a file to a table [!NOTE|label:see also:] iMarslo: column $ cat a_b 1:1 2:2 3:3 $ column -tns: a_b 1 1 2 2 3 3 convert multiple line into one [!NOTE|label:see also:] iMarslo: single line to multiple lines iMarlso: combine every 2 lines $ cat a 1 2 3 4 5 $ echo $(cat a) 1 2 3 4 5 $ cat a | xargs 1 2 3 4 5 others file ending crlf or lf cat -e $ cat -e # e.g. $ cat -e windows.txt test^M$ windows^M$ format $ cat -e linux.txt test$ windows$ format file $ file windows.txt windows.txt: ASCII text, with CRLF line terminators $ file windows.txt windows.txt: ASCII text insert into the first line $ cat demo.file abc efg $ echo \"first line\" | cat - demo.file first line abc efg find and replace $ find . -type f -name '*.md' -exec sed -i 's///g' {} + find and copy source=\"/Users/marslo/test/logs\" target=\"/Users/marslo/test/logs/targetet\" while IFS= read -r -d '' logFile; do cp \"${logFile}\" \"${target}\" done get the count of a word in a file $ cat /etc/passwd | grep marslo -o | wc -l 3 # or $ find . -name file.txt | xargs -e grep \"token\" -o | wc -l print 50th char $ awk 'BEGIN{while (a++ show last n lines in a file $ tail /etc/passwd -n 3 saned:x:115:123::/home/saned:/bin/false marslo:x:1000:1000:Marslo,,,:/home/marslo:/bin/bash mysql:x:1001:1001::/home/mysql:/bin/sh $ tail /etc/passwd -n 2 marslo:x:1000:1000:Marslo,,,:/home/marslo:/bin/bash mysql:x:1001:1001::/home/mysql:/bin/sh shell parameter expansion $ x='aabbcc' $ echo ${x#a*b} bcc $ echo ${x#a} abbcc $ echo ${x##a} abbcc $ echo ${x%b*c} aab $ echo ${x%%b*c} aa $ echo ${x%c} aabbc $ echo ${x%%c} aabbc shell parameter expansion for string replace for bash only usage: ${parameter/pattern/string} replace the first occurrence of a pattern with a given string ${parameter//pattern/string} replace all occurrences reference: the Bash Reference Manual, §3.5.3 \"Shell Parameter Expansion\" not supported in all Unix Shells: the Shell & Utilities volume, §2.6.2 \"Parameter Expansion\" $ message='The secret code is 12345' # first occurrence replacement $ echo \"${message/[0-9]/X}\" The secret code is X2345 # all occurrences replacement $ echo \"${message//[0-9]/X}\" The secret code is XXXXX Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:34:27 "},"linux/util/params.html":{"url":"linux/util/params.html","title":"params","keywords":"","body":" pass parameters to another script getopts with long option additional params on -- shift shift with uncertain params [!TIP|label:see also:] * iMarslo: parameter substitution pass parameters to another script [!NOTE] objective:$ ./b.sh 1 2 3 4 5` -> $ ./a.sh 2 3 4 5 b.sh #!/bin/bash echo \"\"\" b.sh: \\$1 : \"$1\" \\$# : \"$#\" \\$@ : \"$@\" \\${@: -1} : ${@: -1} \\${@: -2} : ${@: -2} \\${@: -3} : ${@: -2} \\${@: -\\$(( \\$#-1 ))} : ${@: -$(( $#-1 ))} \\$(echo '\\${@: -\\$(( \\$#-1 ))}' | cut -d' ' -f1-) : $(echo \"${@: -$(( $#-1 ))}\" | cut -d' ' -f1-) \"\"\" echo -e \"\\n'~~> ./a.sh \\\"\\${@: -1}\\\"': ~~~> ./a.sh ${@: -1}:\" ./a.sh \"${@: -1}\" echo -e \"\\n'~~> ./a.sh \\$(echo '\\${@: -1}' | cut -d' ' -f1-)': ~~~> ./a.sh $(echo \"${@: -1}\" | cut -d' ' -f1-):\" ./a.sh $(echo \"${@: -1}\" | cut -d' ' -f1-) echo -e \"\\n'~~> ./a.sh \\\"\\${@: -4}\\\"': ~~~> ./a.sh ${@: -4}:\" ./a.sh \"${@: -4}\" echo -e \"\\n'~~> ./a.sh \\$(echo '\\${@: -\\$(( \\$#-1 ))}' | cut -d' ' -f1-)': ~~~> ./a.sh $(echo \"${@: -$(( $#-1 ))}\" | cut -d' ' -f1-)\" ./a.sh $(echo \"${@: -$(( $#-1 ))}\" | cut -d' ' -f1-) a.sh echo \"\"\" a.sh: \\$1: \"$1\" \\$#: \"$#\" \\$@: \"$@\" \\${@: -$(( $#-2 ))}: ${@: -$(( $#-2 ))} \"\"\" result $ ./b.sh 1 2 3 4 5 b.sh: $1 : 1 $# : 5 $@ : 1 2 3 4 5 ${@: -1} : 5 ${@: -2} : 4 5 ${@: -3} : 4 5 ${@: -$(( $#-1 ))} : 2 3 4 5 $(echo '${@: -$(( $#-1 ))}' | cut -d' ' -f1-) : 2 3 4 5 '~~> ./a.sh \"${@: -1}\"': ~~~> ./a.sh e: a.sh: $1: 5 $#: 1 $@: 5 ${@: --1}: 5 '~~> ./a.sh $(echo '${@: -1}' | cut -d' ' -f1-)': ~~~> ./a.sh 5: a.sh: $1: 5 $#: 1 $@: 5 ${@: --1}: 5 '~~> ./a.sh \"${@: -4}\"': ~~~> ./a.sh 2 3 4 5: a.sh: $1: b $#: 4 $@: 2 3 4 5 ${@: -2}: 4 5 '~~> ./a.sh $(echo '${@: -$(( $#-1 ))}' | cut -d' ' -f1-)': ~~~> ./a.sh 2 3 4 5 a.sh: $1: 2 $#: 4 $@: 2 3 4 5 ${@: -2}: 4 5 getopts with long option #!/usr/bin/env bash # shellcheck disable=SC1079,SC1078 usage=\"\"\"USAGE \\t$0\\t[-h|--help] [-c|--clean] [-t|--tag ] [-i|--image ] \\t\\t\\t[-v|--ver ] [-n|--name ] \\t\\t\\t[-p|--prop ] \"\"\" while test -n \"$1\"; do case \"$1\" in -c | --clean ) clean=true ; shift ;; -t | --tag ) tag=$2 ; shift 2 ;; -i | --image ) image=$2 ; shift 2 ;; -v | --ver ) ver=$2 ; shift 2 ;; -n | --name ) name=$2 ; shift 2 ;; -p | --prop ) prop=$2 ; shift 2 ;; -h | --help | * ) echo -e \"${usage}\"; exit 0 ;; esac done echo \"\"\" clean : ${clean} tag : ${tag} image : ${image} ver : ${ver} name : ${name} prop : ${prop} \"\"\" result $ ./longopts.sh -h USAGE ./longopts.sh [-h|--help] [-c|--clean] [-t|--tag ] [-i|--image ] [-v|--ver ] [-n|--name ] [-p|--prop ] $ ./longopts.sh -c clean : true tag : image : ver : name : prop : $ ./longopts.sh -c -t 'ttt' -i 'iii' --ver '1.1.1' --name 'name' clean : true tag : ttt image : iii ver : 1.1.1 name : name prop : additional params on -- #!/usr/bin/env bash # shellcheck disable=SC2051,SC2086 VERBOSE=false DEBUG=false MEMORY= AOPT= while true; do case \"$1\" in -v | --verbose ) VERBOSE=true ; shift ;; -d | --debug ) DEBUG=true ; shift ;; -m | --memory ) MEMORY=\"$2\" ; shift 2 ;; -- ) shift ; AOPT=$@ ; break ;; * ) break ;; esac done echo \"\"\" VERBOSE : ${VERBOSE} DEBUG : ${DEBUG} MEMORY : ${MEMORY} AOPT : ${AOPT} \"\"\" # example $ ./param.sh -v -m '256Gi' -- --author 'marslo' VERBOSE : true DEBUG : false MEMORY : 256Gi AOPT : --author marslo $ ./param.sh -v -- -m '256Gi' --author 'marslo' VERBOSE : true DEBUG : false MEMORY : AOPT : -m 256Gi --author marslo shift until [ -z \"$1\" ]; do # Until all parameters used up echo \"\\$@ : $@ \"; shift ; done # result $ ./shift.sh 1 2 3 4 5 $@ : 1 2 3 4 5 $@ : 2 3 4 5 $@ : 3 4 5 $@ : 4 5 $@ : 5 shift with uncertain params echo '---------------- before shift -------------------' echo \".. \\$# : $#\" echo \".. \\$@ : $@\" echo \".. \\$* : $*\" echo '---------------- after shift -------------------' opt='' while [[ $# -gt 0 ]]; do case \"$1\" in -*) opt+=\"$1 \"; shift;; *) break ;; esac done echo \".. \\$# : $#\" echo \".. \\$@ : $@\" echo \".. \\$* : $*\" echo \".. \\$opt : $opt\" if [[ 0 = \"$#\" ]]; then echo -e \"\\033[0;33mERROR: must provide at least one non-opt param\\033[0m\" exit 2 elif [[ 1 = \"$#\" ]]; then path='' params=\"$1\" else path=${*: -1} params=${*: 1:$#-1} fi echo '---------------- result -------------------' echo \">> opt : ${opt}\" echo \">> params : ${params}\" echo \">> path : ${path}\" Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 17:52:36 "},"linux/util/tricky.html":{"url":"linux/util/tricky.html","title":"tricky","keywords":"","body":" process bar with dot . with ▉ ▎ ▌ ▊ with [###----] with |\\|/ save & restore screen tput echo terminfo escape sequences tput reset terminal clear screen show term show terminal width customized colorful output process bar reference: How to add a progress bar to a shell script? with dot . reference: colorful output : c() c() can be also found in .marslorc while true; do (( i++ == 0 )) && printf $(c sY)%-6s$(c) 'waiting ...' || printf $(c sY)%s$(c) '.' sleep 1 done with ▉ ▎ ▌ ▊ another: A progress bar for the shell # main function designed for quickly copying to another program progressBar() { Bar=\"\" # Progress Bar / Volume level Len=25 # Length of Progress Bar / Volume level Div=4 # Divisor into Volume for # of blocks Fill=\"▒\" # Fill up to $Len Arr=( \"▉\" \"▎\" \"▌\" \"▊\" ) # UTF-8 left blocks: 7/8, 1/4, 1/2, 3/4 FullBlock=$((${1} / Div)) # Number of full blocks PartBlock=$((${1} % Div)) # Size of partial block (array index) while [[ $FullBlock -gt 0 ]]; do Bar=\"$Bar${Arr[0]}\" # Add 1 full block into Progress Bar (( FullBlock-- )) # Decrement full blocks counter done # if remainder zero no partial block, else append character from array if [[ $PartBlock -gt 0 ]]; then Bar=\"$Bar${Arr[$PartBlock]}\"; fi # Pad Progress Bar with fill character while [[ \"${#Bar}\" -lt \"$Len\" ]]; do Bar=\"$Bar$Fill\"; done echo progress : \"$1 $Bar\" exit 0 # Remove this line when copying into program } # progressBar Main () { tput civis # Turn off cursor for ((i=0; i with [###----] another solution: fearside/ProgressBar BAR='##############################' FILL='------------------------------' totalLines=100 barLen=30 count=0 while [ ${count} -lt ${totalLines} ]; do # update progress bar count=$(( ${count}+ 1 )) percent=$(( (${count} * 100 / ${totalLines} * 100)/ 100 )) i=$(( ${percent} * ${barLen} / 100 )) echo -ne \"\\r[${BAR:0:$i}${FILL:$i:barLen}] ${count}/${totalLines} (${percent}%)\" sleep .1 done with |\\|/ while :; do for s in / - \\\\ \\| do printf \"\\r$s\" sleep .1 done done save & restore screen reference Terminal codes (ANSI/VT100) introduction tput clear$ tput smcup restore$ tput rmcup echo save$ echo -e '\\033[?47h' restore$ echo -e '\\033[?47l' terminfo escape sequences $ infocmp ... colors#256, cols#80, it#8, lines#24, pairs#32767, bel=^G, blink=\\E[5m, bold=\\E[1m, cbt=\\E[Z, civis=\\E[?25l, clear=\\E[H\\E[2J, cnorm=\\E[?12l\\E[?25h, cr=^M, ... tput reset terminal [!NOTE] Shell does not show typed-in commands, what do I do to fix it? $ reset # or $ stty sane clear screen $ tput home # or $ tput cup %py %px # or $ tput cup %py %px >/dev/null show term $ tput color show terminal width $ tput cols customized colorful output references: imarslo: highlight output $ export GREP_COLORS=\"sl=0;33;49:ms=1;34;49\" $ find /etc/ -type f | head | grep --color=always '^\\|[^/]*$' Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-27 09:35:54 "},"linux/nutshell.html":{"url":"linux/nutshell.html","title":"nutshell","keywords":"","body":" terminal terminal info reset terminal tput stty tty ( teletypewriter ) tabs terminal [!NOTE] bash-hackers.org terminfo Directory man terminfo man infocmp man term man tset/reset stty tty ttys terminal info references: How To Install rxvt-unicode-terminfo on CentOS 8 list info$ terminfo -f $ terminfo -W reset terminal [!NOTE] Shell does not show typed-in commands, what do I do to fix it? $ stty sane # or $ stty echo # or $ reset # or $ tset tput [!NOTE] tput * tput: Portable Terminal Control controlling CAPNAME DESCRIPTION sc Save the cursor position rc Restore the cursor position home Move the cursor to upper left corner (0,0) cup Move the cursor to position row, col cud1 Move the cursor down 1 line cuu1 Move the cursor up 1 line civis Set to cursor to be invisible cnorm Set the cursor to its normal state text effects CAPNAME DESCRIPTION bold Start bold text smul Start underlined text rmul End underlined text rev Start reverse video blink Start blinking text invis Start invisible text smso Start “standout” mode rmso End “standout” mode sgr0 Turn off all attributes setaf Set foreground color setab Set background color Text Color VALUE COLOR 0 Black 1 Red 2 Green 3 Yellow 4 Blue 5 Magenta 6 Cyan 7 White 8 Not used 9 Reset to default color Clearing the Screen CAPNAME DESCRIPTION smcup Save screen contents rmcup Restore screen contents el Clear from the cursor to the end of the line el1 Clear from the cursor to the beginning of the line ed Clear from the cursor to the end of the screen clear Clear the entire screen and home the cursor cursor action: Name Termcap Equiv. Description civis vi Make cursor invisible cvvis vs Make cursor very visible cnorm ve Make cursor normal (undo cvvis' &civis)' cuf RI Move cursor right #1 spaces (P*) cuf1 nd Move cursor right one space cub LE Move cursor left #1 spaces (P) cub1 le Move cursor left one space cuu UP Move cursor up #1 lines (P*) cuu1 up Move cursor up one line cud DO Move cursor down #1 lines (P*) cud1 do Move cursor down one line cup cm Move cursor to row #1, column #2 of screen (P) mrcup CM Move cursor to row #1, column #2 of memory (P) vpa cv Move cursor to row #1 (P) hpa ch Move cursor to column #1 (P) home ho Home cursor (if no `cup') hd hd Move cursor down one-half line hu hu Move cursor up one-half line sc sc Save cursor position rc rc Restore cursor to position of last `sc' sgr0 me Turn off all attributes ll ll Go to last line, first column (if no cup) samples AdaRoseCannon/todo-repl slumos/xtctl zhgqthomas/ssr-install.sh izabera/mappings move sequence to top $ tput home # or $ tput cup 0 0 # or $ tput cup %py %px >/dev/tty show info $ tput -T screen longname VT 100/ANSI X3.64 virtual terminal $ tput longname xterm with 256 colors $ echo \"Rows=$(tput lines) Cols=$(tput cols)\" Rows=30 Cols=104 set cursor # invisible $ tput civis # normal $ tput cnorm text color for fg_color in {0..255}; do set_foreground=$(tput setaf $fg_color) for bg_color in {0..7}; do set_background=$(tput setab $bg_color) echo -n $set_background$set_foreground printf ' F:%s B:%s ' $fg_color $bg_color done echo $(tput sgr0) done PS1 [!NOTE|label:references:] How can I print text in various colors? red=$(tput setaf 1) green=$(tput setaf 2) blue=$(tput setaf 4) reset=$(tput sgr0) PS1='\\[$red\\]\\u\\[$reset\\]@\\[$green\\]\\h\\[$reset\\]:\\[$blue\\]\\w\\[$reset\\]\\$ ' shows tput processing in one invocation $ tput -S print in center of line COLUMNS=`tput cols` export COLUMNS # Get screen width. echo \"$@\" | awk ' { spaces = ('$COLUMNS' - length) / 2 while (spaces-- > 0) printf (\" \") print }' print in center of terminal COLUMNS=`tput cols` LINES=`tput lines` line=`expr $LINES / 2` column=`expr \\( $COLUMNS - 6 \\) / 2` tput sc tput cup $line $column tput rev echo 'Hello, World' tput sgr0 tput rc tput_menu : script for clean screen BG_BLUE=\"$(tput setab 4)\" BG_BLACK=\"$(tput setab 0)\" FG_GREEN=\"$(tput setaf 2)\" FG_WHITE=\"$(tput setaf 7)\" # save screen tput smcup # display menu until selection == 0 while [[ $REPLY != 0 ]]; do echo -n ${BG_BLUE}${FG_WHITE} clear cat \" selection # clear area beneath menu tput cup 10 0 echo -n ${BG_BLACK}${FG_GREEN} tput ed tput cup 11 0 # act on selection case $selection in 1) echo \"Hostname: $HOSTNAME\" uptime ;; 2) df -h ;; 3) if [[ $(id -u) -eq 0 ]]; then echo \"Home Space Utilization (All Users)\" du -sh /home/* 2> /dev/null else echo \"Home Space Utilization ($USER)\" du -s $HOME/* 2> /dev/null | sort -nr fi ;; 0) break ;; *) echo \"Invalid entry.\" ;; esac printf \"\\n\\npress any key to continue.\" read -n 1 done # restore screen tput rmcup echo \"Program terminated.\" now [!NOTE] now bash script now bash script #!/usr/bin/env bash dataColumn=1 timeColumn=27 tput sc # save cursor position. #--------- DATE ------------------------------------------------------------- tput rc # restore saved cursor position. cal | tr -cd '\\11\\12\\15\\40\\60-\\136\\140-\\176' > /tmp/terminal calLineCnt=1 Today=$(date +\"%e\") printf \"\\033[32m\" # color green -- see list above. while IFS= read -r Cal; do printf \"%s\" \"$Cal\" if [[ $calLineCnt -gt 2 ]] ; then tput cub 22 # see if today is on current line & invert background for (( j=0 ; j /dev/null; then # if has toilet date +\"%I:%M %P\" | toilet -f future > /tmp/terminal elif hash figlet 2>/dev/null; then # if has figlet date +\"%I:%M %P\" | figlet > /tmp/terminal else date +\"%I:%M %P\" > /tmp/terminal fi while IFS= read -r Time; do printf \"\\033[01;36m\" # color cyan printf \"%s\" \"$Time\" tput cud1 # Up one line tput cuf $timeColumn # Move 49 columns right done stty [!NOTE|label:references:] 19.2 stty: Print or change terminal characteristics Shell does not show typed-in commands, what do I do to fix it? stty : set or display terminal options Linux in a Nutshell.pdf man pages section 1: User Commands: stty (1g) Local Modes OPTION COMMENTS echo Echoes every character typed. -echo Does not echo characters. echoctl Echoes control characters as ^X (Ctrl-X), where X is the character given by adding 100 octal to the code of the control character. -echoctl Does not echo control characters as ^X (Ctrl-X). echoe Echoes the ERASE character as the \"backspace space backspace\" string. -echoe Does not echo the ERASE character, just backspace. echok Echoes a NL character after a KILL character. -echok Does not echo a NL character after a KILL character. echoke Echoes the KILL character by erasing each character on the output line. -echoke Just echoes the KILL character. echonl Echoes the NL character. -echonl Does not echo the NL character. echoprt Echoes erased characters backwards with / (slash) and \\ (backslash). -echoprt Does not echo erased characters backwards with / (slash) and \\ (backslash). icanon Enables canonical input (canonical input allows input-line editing with the ERASE and KILL characters). See the discussion about canonical mode input in Line Discipline Module (ldterm) AIX Version 4.3 Communications Programming Concepts. -icanon Disables canonical input. iexten Specifies that implementation-defined functions shall be recognized from the input data. Recognition of the following control characters requires iexten to be set: eol2, dsusp, reprint, discard, werase, lnext. The functions associated with these modes also require iexten to be set: imaxbel, echoke, echoprt, and echoctl. -iexten Specifies that implementation-defined functions shall not be recognized from the input data. isig Enables the checking of characters against the special control characters INTR, SUSP and QUIT special control characters. -isig Disables the checking of characters against the special control characters INTR, SUSP and QUIT special control characters. noflsh Does not clear buffers after INTR, SUSP, or QUIT control characters. -noflsh Clears buffers after INTR, SUSP, or QUIT control characters. pending Causes any input that is pending after a switch from raw to canonical mode to be re-input the next time a read operation becomes pending or the next time input arrives. Pending is an internal state bit. -pending No text is pending. tostop Signals SIGTOU for background output. -tostop Does not signal SIGTOU for background output. xcase Echoes uppercase characters on input, and displays uppercase characters on output with a preceding \\ (backslash). -xcase Does not echo uppercase characters on input. show all $ stty -a speed 38400 baud; rows 30; columns 104; intr = ^C; quit = ^\\; erase = ^?; kill = ^U; eof = ^D; eol = ; eol2 = ; start = ^Q; stop = ^S; susp = ^Z; dsusp = ^Y; rprnt = ^R; werase = ^W; lnext = ^V; discard = ^O; status = ^T; min = 1; time = 0; -parenb -parodd cs8 hupcl -cstopb cread -clocal -crtscts -ignbrk brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl -ixon ixoff ixany imaxbel iutf8 opost -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0 isig icanon iexten echo echoe echok -echonl -noflsh -tostop -echoprt echoctl echoke -flusho -extproc show size $ stty size 30 104 enable/disable echo $ stty echo # or stty sane $ stty -echo tty ( teletypewriter ) [!NOTE|label:references:] 19.4 tty: Print file name of terminal on standard input What are pseudo terminals (pty/tty)? The TTY demystified | 解密tty 终端、Shell、tty 和控制台（console）有什么区别？ Linux终端和Line discipline图解 彻底理解Linux的各种终端类型以及概念 printf的归宿-数据打印到哪儿了 tabs [!NOTE|label:references] tabs: Setting Terminal Tabs Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-27 11:28:54 "},"linux/disk.html":{"url":"linux/disk.html","title":"disk","keywords":"","body":" check status mount mount ios mount smb mount nfs remount disconnect the mount LVM check current status add new pv ( Physical Volume ) moving home with lvm remove LVM example performance check NFS performance iostat sar hdparm dd samba setup configure firewall is necessary enable services check status $ lsblk $ ncdu $ pvs $ lvs $ vgs $ pvscan $ lvscan $ pvdisplay $ vgdisplay $ lvdisplay $ fdisk -l $ sfdisk -l -uM $ lshw -class disk $ hwinfo --block --short $ cat /proc/partitions $ sudo blkid mount mount ios $ [[ -z $(findmnt /mnt/tmp) ]] || umount -f /mnt/tmp $ mkdir /mnt/tmp $ mount -t iso9660 -o loop /vol/builds/os/linux/RHEL-6.6-20140926.0-Server-x86_64-dvd1.iso /mnt/tmp/ mount smb [!NOTE] references: Mounting a Samba share 如何在 macOS 中停用 SMB 1 或 NetBIOS Performance issues with SMB 2 and 3 connections Linux系统运维: Samba 应用 macos via GUI : Go -> Connect toServer -> smb:///secured via cmd osascript$ /usr/bin/osascript -e \"try\" -e \"mount volume \\\"smb://guest@${host}\\\"\" -e \"end try\" mount $ mkdir -p /Volumes/mount $ sudo mkdir -p $(whoami):staff /Volumes/mount # mount $ mount -t smbfs //user1:@/secured /Volumes/mount # mount_smbfs $ mount_smbfs //user1@/secured /Volumes/mount Password for : # umount $ umount /Volumes/mount check $ mount ... //user1@/secured on /Volumes/mount (smbfs, nodev, nosuid, mounted by user1) linux $ smbclient --user=user1 -L // # or $ smbclient ///secured -U user1 mount nfs # example nfs server: 1.2.3.4 sub-folder: /a/b mount to local: /mnt/mynfs $ sudo mkdir -p /mnt/mynfs $ sudo mount -t nfs 1.2.3.4:/a/b /mnt/mynfs # or force using nfsversion 4 $ sudo mount -t nfs -o nfsvers=4 1.2.3.4:/a/b /mnt/mynfs -vvv test if sub-folder exists in remote nfs server $ showmount -e 1.2.3.4 | grep '/a/b' environment setup # centos $ yum install nfs-utils nfs-utils-lib $ yum install portmap (not required with NFSv4) # for nfs4 # ubuntu $ apt-get install nfs-utils nfs-utils-lib check mount $ cat /etc/mtab | grep /folder_name /dev/sdb1 /folder_name ext4 rw,seclabel,relatime,stripe=64 0 0 Check if folder is a mounted remote filesystem $ df -P -T /folder_name Filesystem Type 1024-blocks Used Available Capacity Mounted on /dev/sdb1 ext4 744******* 658***** 699******* 1% /folder_name df $ df /local_storage Filesystem 1K-blocks Used Available Use% Mounted on /dev/sdb1 744******* 658***** 699******* 1% /folder_name /etc/fstab [!NOTE|label:references:] iMarslo : character#column $ cat /etc/fstab $ sed 's/#.*//' /etc/fstab | column --table --table-columns SOURCE,TARGET,TYPE,OPTIONS,PASS,FREQ --table-right PASS,FREQ findmnt $ findmnt --fstab /local_storage TARGET SOURCE FSTYPE OPTIONS /local_storage /dev/sdb1 ext4 defaults check nfs mount points $ df -h -F nfs [ | column -t ] $ mount | column -t | grep -E 'type.*nfs $ findmnt /mnt/mynfs check mount version nfsstat -c will show you the NFS version actually being used nfsstat -m will show statistics on mounted NFS filesystems grep nfs /proc/mounts equals nfsstat -m local $ rpcinfo -p localhost program vers proto port service 100000 4 tcp 111 portmapper 100000 3 tcp 111 portmapper 100000 2 tcp 111 portmapper 100000 4 udp 111 portmapper 100000 3 udp 111 portmapper 100000 2 udp 111 portmapper 100024 1 udp 38978 status 100024 1 tcp 36415 status 100021 1 udp 51669 nlockmgr 100021 3 udp 51669 nlockmgr 100021 4 udp 51669 nlockmgr 100021 1 tcp 42699 nlockmgr 100021 3 tcp 42699 nlockmgr 100021 4 tcp 42699 nlockmgr remote $ rpcinfo 1.2.3.4 | egrep \"service|nfs\" program version netid address service owner 100003 3 udp 1.2.3.4.8.1 nfs 100003 3 tcp 1.2.3.4.8.1 nfs setup nfs mount by default server boot $ sudo bash -c \"cat > /etc/fstab\" related configure /etc/fstab /etc/nsswitch.conf /etc/nfsmount.conf /etc/nfs.conf /proc/mounts remount $ sudo mount -oremount,rw / # or $ sudo mount -oremount,ro / disconnect the mount $ sudo umount /mnt/mynfs device is busy [!NOTE|label:references:] umount: device is busy. Why? # check who is occupy the device $ fuser -vm /path/to/mount $ sudo fuser -vm /jenkins USER PID ACCESS COMMAND /path/to/mount: root kernel mount /path/to/mount devops 1369210 ..c.. bash marslo 1377303 ..c.. bash # or $ lsof +f -- /path/to/mount # or interactively kill only processes with files open for writing $ sudo fuser -vmMkiv /path/to/mount # or force kill directly without asking $ sudo fuser -vmMk /path/to/mount # logout $ sudo pkill -KILL -u marslo $ sudo pkill -KILL -u devops # umount again $ sudo umount -f /path/to/mount LVM [!NOTE|label:reference:] CONFIGURING AND MANAGING LOGICAL VOLUMES CHAPTER 5. MODIFYING THE SIZE OF A LOGICAL VOLUME LVM HOWTO * Logical Volume Manager Administration * LVM in Linux — Create and Extend a Logical Volume COMMAND NAME vg Volume Group pv Physical Volume lv Logical Volume check current status lvm $ sudo vgs VG #PV #LV #SN Attr VSize VFree vgubuntu 1 2 0 wz--n- disk status $ sudo lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS sda 8:0 0 1.8T 0 disk ├─sda1 8:1 0 600M 0 part ├─sda2 8:2 0 1G 0 part /media/devops/99dad889-9bcc-4edb-baa9-3433c2502f18 └─sda3 8:3 0 1.8T 0 part sdb 8:16 1 0B 0 disk sr0 11:0 1 1024M 0 rom nvme1n1 259:0 0 931.5G 0 disk ├─nvme1n1p1 259:2 0 512M 0 part └─nvme1n1p2 259:3 0 931G 0 part /media/devops/f99da1e7-9555-4cdc-9781-6dbc9e6153ca nvme0n1 259:1 0 931.5G 0 disk ├─nvme0n1p1 259:4 0 512M 0 part /boot/efi └─nvme0n1p2 259:5 0 931G 0 part ├─vgubuntu-root 253:0 0 929.1G 0 lvm /var/snap/firefox/common/host-hunspell │ / └─vgubuntu-swap_1 253:1 0 1.9G 0 lvm [SWAP] add new pv ( Physical Volume ) $ sudo pvcreate /dev/nvme1n1p2 Can't open /dev/nvme1n1p2 exclusively. Mounted filesystem? Can't open /dev/nvme1n1p2 exclusively. Mounted filesystem? $ sudo mount | grep f99da1e7-9555-4cdc-9781-6dbc9e6153ca /dev/nvme1n1p2 on /media/devops/f99da1e7-9555-4cdc-9781-6dbc9e6153ca type ext4 (rw,nosuid,nodev,relatime,errors=remount-ro,uhelper=udisks2) $ sudo umount /dev/nvme1n1p2 $ sudo mount | grep f99da1e7-9555-4cdc-9781-6dbc9e6153ca $ sudo lsblk /dev/nvme1n1 NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS nvme1n1 259:0 0 931.5G 0 disk ├─nvme1n1p1 259:2 0 512M 0 part └─nvme1n1p2 259:3 0 931G 0 part $ sudo pvcreate /dev/nvme1n1p2 WARNING: ext4 signature detected on /dev/nvme1n1p2 at offset 1080. Wipe it? [y/n]: y Wiping ext4 signature on /dev/nvme1n1p2. Physical volume \"/dev/nvme1n1p2\" successfully created. $ sudo pvs PV VG Fmt Attr PSize PFree /dev/nvme0n1p2 vgubuntu lvm2 a-- moving home with lvm [!NOTE|label:references] Moving /home with LVM remove LVM [!TIP] remove order: lv pv vg 15.2.2. Removing an LVM2 Logical Volume for Swap 5.3.10. Removing Volume Groups Linux Quick Tip: How to Delete or Remove LVM volumes Removing an existing LVM volume $ sudo lvremove /dev/cl/home # for swap $ sudo swapoff -v /dev/cl/swap $ sudo lvremove /dev/cl/swap # and remove swap from `/etc/fstab` $ sudo awk '!/\\/dev\\/cl\\/swap/' /etc/fstab $ sudo pvremove $ sudo vgremove example extends the logical volume /dev/myvg/homevol to 12 gigabytes$ sudo lvextend -L12G /dev/myvg/homevol lvextend -- extending logical volume \"/dev/myvg/homevol\" to 12 GB lvextend -- doing automatic backup of volume group \"myvg\" lvextend -- logical volume \"/dev/myvg/homevol\" successfully extended adds another gigabyte to the logical volume /dev/myvg/homevol$ sudo lvextend -L+1G /dev/myvg/homevol lvextend -- extending logical volume \"/dev/myvg/homevol\" to 13 GB lvextend -- doing automatic backup of volume group \"myvg\" lvextend -- logical volume \"/dev/myvg/homevol\" successfully extended performance check NFS performance references: Using nfsstat and nfsiostat to troubleshoot NFS performance issues on Linux NFS poor write performance Analyzing Linux NFS server performance nfsstat nfsiostat collectl collectl -sjmf -oT collectl -sn --verbose -oT collectl -sJ -oTm tshark -R nfs -i eth0 nfswatch netstat -plaute | grep nfs watch -d \"netstat -plaute | grep nfs | sort -k 4,5\" iostat -mx sudo fio --randrepeat=1 --ioengine=libaio --direct=0 --gtod_reduce=1 --name=test1 --filename=/media/ramdisk/test --bs=4k --iodepth=64 --size=4G --readwrite=randrw --rwmixread=75 time dd if=/dev/zero of=/mnt/nfs/testfile bs=16k count=128k iozone -aRcU /mnt/nfs/ -f /mnt/nfs/testfile > logfile iostat $ iostat -x -d 1 Linux 3.10.0-957.27.2.el7.x86_64 (dc5-ssdfwtst3) 01/15/2021 _x86_64_ (4 CPU) Device: rrqm/s wrqm/s r/s w/s rkB/s wkB/s avgrq-sz avgqu-sz await r_await w_await svctm %util sda 0.00 0.09 0.07 13.91 6.83 81.26 12.61 0.01 0.93 11.40 0.88 0.38 0.53 dm-0 0.00 0.00 0.07 14.00 6.83 81.26 12.53 0.01 0.95 11.60 0.90 0.38 0.53 dm-1 0.00 0.00 0.00 0.00 0.00 0.00 52.91 0.00 0.64 0.64 0.00 0.48 0.00 sar $ sar -bdp 1 Linux 3.10.0-957.27.2.el7.x86_64 (dc5-ssdfwtst3) 01/15/2021 _x86_64_ (4 CPU) 05:44:20 AM tps rtps wtps bread/s bwrtn/s 05:44:21 AM 863.00 863.00 0.00 47048.00 0.00 05:44:20 AM DEV tps rd_sec/s wr_sec/s avgrq-sz avgqu-sz await svctm %util 05:44:21 AM sda 863.00 47048.00 0.00 54.52 2.86 3.33 0.16 14.20 05:44:21 AM centos-root 863.00 47048.00 0.00 54.52 2.88 3.33 0.16 14.20 05:44:21 AM centos-swap 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 hdparm [!NOTE] hdparm - get/set SATA/IDE device parameters references: Linux and Unix Test Disk I/O Performance With dd Command hdparm Command Examples in Linux hdparm command in Linux with Examples $ sudo hdparm -Tt /dev/sda3 /dev/sda3: Timing cached reads: 15900 MB in 1.99 seconds = 7978.64 MB/sec Timing buffered disk reads: 1796 MB in 3.00 seconds = 598.17 MB/sec $ sudo hdparm -Tt /dev/sda3 /dev/sda3: Timing cached reads: 18924 MB in 1.98 seconds = 9539.84 MB/sec Timing buffered disk reads: 102 MB in 12.88 seconds = 7.92 MB/sec dd [!NOTE] references: Linux and Unix Test Disk I/O Performance With dd Command $ flush $ echo 3 | sudo tee /proc/sys/vm/drop_caches $ time dd if=/path/to/bigfile of=/dev/null bs=8k write speed$ dd if=/dev/zero of=/tmp/test1.img bs=1G count=1 oflag=dsync server latency time$ dd if=/dev/zero of=/tmp/test2.img bs=512 count=1000 oflag=dsync samba [!NOTE] references: Instructions for setting up a secure Samba share on CentOS 8 Linux How to Install and Configure Samba on CentOS 8 setup # install $ sudo dnf install samba samba-common samba-client $ sudo mv /etc/samba/smb.conf /etc/samba/smb.con.bak # setup user $ sudo groupadd secure_group $ sudo useradd -g secure_group user1 $ sudo useradd -g secure_group user2 # create folder $ sudo mkdir -p /srv/samba/shared $ sudo mkdir -p /srv/samba/secure_shared $ sudo smbpasswd -a user1 password_1 $ sudo smbpasswd -a user2 password_2 configure $ cat /etc/samba/smb.conf [global] workgroup = WORKGROUP server string = Samba Server %v netbios name = centos-8 security = user map to guest = bad user dns proxy = no ntlm auth = yes // for windows for anonymous $ sudo chmod -R 0755 /srv/samba/shared $ sudo chown -R nobody:nobody /srv/samba/shared $ sudo chcon -t samba_share_t /srv/samba/shared # or $ sudo chcon -R system_u:object_r:samba_share_t:s0 /srv/samba/shared $ cat /etc/samba/smb.conf [anonymous] path = /srv/samba/shared browsable =yes writable = yes guest ok = yes read only = no force user = nobody $ testparm for secured $ sudo chmod -R 0770 /srv/samba/secure_shared $ sudo chcon -t samba_share -p /srv/samba/secure_shared $ sudo chown -R root:secure_group /srv/samba/secure_shared $ cat /etc/samba/smb.conf [secured] path = /srv/samba/secure_shared valid users = @secure_group guest ok = no writable = yes browsable = yes # verify the configuration is sound $ testparm firewall is necessary # centos $ sudo firewall-cmd --add-service=samba --zone=public --permanent $ sudo firewall-cmd --reload # ubuntu: https://help.ubuntu.com/lts/serverguide/firewall.html $ sudo ufw app list $ sudo ufw allow Samba $ sudo ufw allow from 192.168.0.0/24 to any app Samba $ sudo ufw app info Samba enable services # enable service $ sudo systemctl start smb $ sudo systemctl enable smb $ sudo systemctl status smb $ sudo systemctl start nmb $ sudo systemctl enable nmb $ sudo systemctl status nmb config [!TIP] FILES : /etc/nsmb.conf The global configuration file. ~/Library/Preferences/nsmb.conf The user's configuration file, conflicts will be overwritten by the global file. $ cat /etc/nsmb.conf [default] signing_required=no file_ids_off=yes Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-07 01:57:54 "},"linux/network.html":{"url":"linux/network.html","title":"network","keywords":"","body":" get into get interface by command get ipv4 address get ip address by hostname get active interface get active IP address get active Mac address get network speed check remote server dns show hardware spec change interface name nmap host discovery scan 80 or 22 in particular setment OS detection with verbosity find printer list hostname with mac address get all server up ip address scan ip/host route iptables port forwarding port redirection nslookup traceroute traceroute for port No route to host DNS add new DNS permanently wifi iwconfig nmcli nmtui netmask conversion basic concept example netmask quick reference ipcalc reference: ARCH NetWork Configuration How do I add a DNS server via resolv.conf? How to Configure and Manage Network Connections Using ‘nmcli’ Tool 9 张动图让明白网络性能的四大指标：带宽、时延、抖动、丢包 get into [!NOTE|label:references:] * imarslo : osx/network get interface by command interface=$(netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}') # or get the route to github interface=$(ip route get $(nslookup github.com | grep Server | awk -F' ' '{print $NF}') | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') get ipv4 address ipAddr=$(ip a s \"${interface}\" | sed -rn 's|.*inet ([0-9\\.]{7,15})/[0-9]{2} brd.*$|\\1|p') get ip address by hostname ping & sed $ ping -q -c 1 -t 1 github.com | sed -n -re 's:^PING.*\\(([0-9\\.]{7,15})\\).*$:\\1:p' dig $ dig +short github.com # or $ dig github.com | awk '/^;; ANSWER SECTION:$/ { getline ; print $5 }' nslookup $ nslookup github.com | awk '/Name:/{getline; print $2;}' get active interface $ interface=$(netstat -nr | grep -E 'UG|UGSc' | grep -E '^0.0.0|default' | grep -E '[0-9.]{7,15}' | awk -F' ' '{print $NF}') # or get the route to github $ interface=$(ip route get $(nslookup github.com | grep Server | awk -F' ' '{print $NF}') | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') get active IP address $ githubIP=$(dig +short github.com | head -1) $ interface=$(ip route get ${githubIP} | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') $ ipaddr=$(ip a s ${interface} | sed -rn 's|\\W*inet[^6]([0-9\\.]{7,15}).*$|\\1|p') get active Mac address $ githubIP=$(dig +short github.com | head -1) $ interface=$(ip route get ${githubIP} | sed -rn 's|.*dev\\s+(\\S+)\\s+src.*$|\\1|p') $ macaddr=$(ip link show ${interface} | sed -rn 's|.*ether ([0-9a-fA-F:]{17}).*$|\\1|p' | sed 's|:||g' | tr [a-z] [A-Z]) dig $ dig +noall +answer get network speed $ ifstat -n -i en7 en7 KB/s in KB/s out 7.35 1.15 4.91 1.02 6.05 0.80 8.36 1.78 check remote server dns $ for _i in {1..10}; do echo -e \"\\n\\n ~~~> myserver_${i}\" ssh -q marslo@myserver_${_i} \"cat /etc/resolv.conf | sed -nre 's:^nameserver\\s([0-9.]+):\\1:p' | xargs -L1 /usr/bin/ping -c 1\" done show hardware spec ethtool $ sudo ethtool eth0 Settings for eth0: Supported ports: [ TP ] Supported link modes: 10baseT/Half 10baseT/Full 100baseT/Half 100baseT/Full 1000baseT/Full Supported pause frame use: No Supports auto-negotiation: Yes Supported FEC modes: Not reported Advertised link modes: 10baseT/Half 10baseT/Full 100baseT/Half 100baseT/Full 1000baseT/Full Advertised pause frame use: No Advertised auto-negotiation: Yes Advertised FEC modes: Not reported Speed: 100Mb/s Duplex: Full Port: Twisted Pair PHYAD: 1 Transceiver: internal Auto-negotiation: on MDI-X: on (auto) Supports Wake-on: pumbg Wake-on: g Current message level: 0x00000007 (7) drv probe link Link detected: yes list hardware $ sudo lshw -class network *-network description: Wireless interface product: Wireless 8260 vendor: Intel Corporation physical id: 0 bus info: pci@0000:02:00.0 logical name: wlan0 version: 3a serial: 34:f3:9a:52:75:65 width: 64 bits clock: 33MHz capabilities: pm msi pciexpress bus_master cap_list ethernet physical wireless configuration: broadcast=yes driver=iwlwifi driverversion=4.15.0-23-generic firmware=34.0.1 ip=192.168.10.235 latency=0 link=yes multicast=yes wireless=IEEE 802.11 resources: irq:129 memory:e4100000-e4101fff *-network description: Ethernet interface product: Ethernet Connection (2) I219-LM vendor: Intel Corporation physical id: 1f.6 bus info: pci@0000:00:1f.6 logical name: eth0 version: 31 serial: 30:e1:71:95:19:bc size: 100Mbit/s capacity: 1Gbit/s width: 32 bits clock: 33MHz capabilities: pm msi bus_master cap_list ethernet physical tp 10bt 10bt-fd 100bt 100bt-fd 1000bt-fd autonegotiation configuration: autonegotiation=on broadcast=yes driver=e1000e driverversion=3.2.6-k duplex=full firmware=0.8-4 ip=130.147.182.57 latency=0 link=yes multicast=yes port=twisted pair speed=100Mbit/s resources: irq:127 memory:e4300000-e431ffff *-network:0 description: Ethernet interface physical id: 2 logical name: veth680e7b1b serial: 86:86:ae:b1:3f:c3 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s *-network:1 description: Ethernet interface physical id: 3 logical name: vethdd057c06 serial: ae:b1:42:e3:30:d0 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s *-network:2 description: Ethernet interface physical id: 4 logical name: vethfe693595 serial: 16:ec:cd:4e:c3:d8 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s *-network:3 description: Ethernet interface physical id: 5 logical name: flannel.1 serial: 2a:2b:77:a7:35:8f capabilities: ethernet physical configuration: broadcast=yes driver=vxlan driverversion=0.1 ip=10.244.0.0 link=yes multicast=yes *-network:4 description: Ethernet interface physical id: 6 logical name: cni0 serial: 0a:58:0a:f4:00:01 capabilities: ethernet physical configuration: broadcast=yes driver=bridge driverversion=2.3 firmware=N/A ip=10.244.0.1 link=yes multicast=yes *-network:5 description: Ethernet interface physical id: 7 logical name: docker0 serial: 02:42:99:41:e5:02 capabilities: ethernet physical configuration: broadcast=yes driver=bridge driverversion=2.3 firmware=N/A ip=172.17.0.1 link=no multicast=yes *-network:6 description: Ethernet interface physical id: 8 logical name: vethc1b38134 serial: 76:6a:6c:0f:e8:a1 size: 10Gbit/s capabilities: ethernet physical configuration: autonegotiation=off broadcast=yes driver=veth driverversion=1.0 duplex=full link=yes multicast=yes port=twisted pair speed=10Gbit/s change interface name Permanent Solution $ sudo touch /etc/udev/rules.d/10-network.rules $ sudo bash -c \"cat > /etc/udev/rules.d/10-network.rules\" \", KERNEL==\"\", NAME=\"\" EOF e.g.: $ nmcli connection NAME UUID TYPE DEVICE WLAN-PUB 2cde1f25-8c28-4318-9781-b9fcdabd985d wifi wlp2s0 Wired connection 1 f72d569d-065b-3bc8-98ae-e07f8bf46945 ethernet enp0s31f6 cni0 dcfc10c6-5421-4405-9d56-b3bb595780f5 bridge cni0 docker0 29822e8f-772f-4e67-8052-55b9e6c9e298 bridge docker0 $ sudo bash -c \"cat > /etc/udev/rules.d/10-network.rules\" temporary Solution $ sudo ifconfig down $ sudo ip link set name $ sudo ifconfig e.g.: $ nmcli dev DEVICE TYPE STATE CONNECTION wlp2s0 wifi connected WLAN-PUB cni0 bridge connected cni0 enp0s31f6 ethernet connected Wired connection 1 docker0 bridge connected docker0 flannel.1 vxlan disconnected -- veth1890b284 ethernet unmanaged -- veth5145289b ethernet unmanaged -- vetha9ee773c ethernet unmanaged -- vethf5a48bb2 ethernet unmanaged -- lo loopback unmanaged -- $ nmcli connection NAME UUID TYPE DEVICE WLAN-PUB 2cde1f25-8c28-4318-9781-b9fcdabd985d wifi wlp2s0 Wired connection 1 f72d569d-065b-3bc8-98ae-e07f8bf46945 ethernet enp0s31f6 cni0 dcfc10c6-5421-4405-9d56-b3bb595780f5 bridge cni0 docker0 29822e8f-772f-4e67-8052-55b9e6c9e298 bridge docker0 $ sudo ifconfig enp0s31f6 down; sudo ip link set enp0s31f6 name eth0; sudo ifconfig eth0 up $ nmcli dev DEVICE TYPE STATE CONNECTION wlp2s0 wifi connected WLAN-PUB cni0 bridge connected cni0 docker0 bridge connected docker0 eth0 ethernet connected Wired connection 1 flannel.1 vxlan disconnected -- veth1890b284 ethernet unmanaged -- veth5145289b ethernet unmanaged -- vetha9ee773c ethernet unmanaged -- vethf5a48bb2 ethernet unmanaged -- lo loopback unmanaged -- $ nmcli connection NAME UUID TYPE DEVICE WLAN-PUB 2cde1f25-8c28-4318-9781-b9fcdabd985d wifi wlp2s0 Wired connection 1 f72d569d-065b-3bc8-98ae-e07f8bf46945 ethernet eth0 cni0 e557e9bc-754e-4dc9-b9db-4519a7b15c33 bridge cni0 docker0 47c195b8-4867-40d3-acec-c28223e2b013 bridge docker0 nmap reference: SOLUTION: Scan a Large Network for a Certain Open TCP Port Nmap Network Scanning host discovery PARAMETER COMMENTS -iL Input from list of hosts/networks -iR Choose random targets -sL List Scan - simply list targets to scan -sP Ping Scan - go no further than determining if host is online -P0 Treat all hosts as online -- skip host discovery -PS/PA/PU [portlist] TCP SYN/ACK or UDP discovery probes to given ports -PE/PP/PM ICMP echo, timestamp, and netmask request discovery probes -n/-R Never do DNS resolution/Always resolve [default ⎮ sometimes resolve] -sS/sT/sA/sW/sM TCP SYN/Connect()/ACK/Window/Maimon scans -sN/sF/sX TCP Null, FIN, and Xmas scans -sO IP protocol scan -sI Idlescan -O Enable OS detection scan 80 or 22 in particular setment $ nmap -sT -p 80 -oG - 10 - 1.2.3.* [| grep open] $ nmap -sT -p 22 -oG - 10 - 1.2.3.* [| grep open] OS detection with verbosity $ sudo nmap -O -v 192.168.1.0/23 Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 15:51 CST Initiating ARP Ping Scan at 15:51 Scanning 511 hosts [1 port/host] Completed ARP Ping Scan at 15:51, 2.02s elapsed (511 total hosts) Initiating Parallel DNS resolution of 118 hosts. at 15:51 Completed Parallel DNS resolution of 118 hosts. at 15:51, 0.18s elapsed Nmap scan report for 192.168.1.0 [host down] Nmap scan report for 192.168.1.2 [host down] ... Nmap scan report for 192.168.1.1 Host is up (0.0016s latency). Not shown: 998 closed ports PORT STATE SERVICE 22/tcp open ssh 23/tcp open telnet MAC Address: C0:**:**:**:**:C8 (Cisco Systems) OS details: Cisco 2950, 2960, 3550, 3560, 3750, or 4500 switch or 6500 router (IOS 12.1 - 15.0); or Adaptive Security Appliance firewall Network Distance: 1 hop TCP Sequence Prediction: Difficulty=264 (Good luck!) IP ID Sequence Generation: Randomized ... find printer $ sudo nmap -p 9100,515,631 192.168.1.0/23 [-oX printers.xml] ... Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 16:09 CST Nmap scan report for 192.168.1.191 Host is up (0.0029s latency). PORT STATE SERVICE 515/tcp closed printer 631/tcp closed ipp 9100/tcp open jetdirect MAC Address: 08:00:27:96:17:9E (Oracle VirtualBox virtual NIC) Nmap done: 1 IP address (1 host up) scanned in 0.29 second ... or$ sudo nmap [-sT] -p 9100,515,631 -oG - 192.168.1.0/23 # Nmap 7.91 scan initiated Wed Feb 3 16:44:20 2021 as: nmap -p 9100,515,631 -oG - 192.168.1.0/23 Host: 192.168.1.1 () Status: Up Host: 192.168.1.1 () Ports: 515/closed/tcp//printer///, 631/closed/tcp//ipp///, 9100/closed/tcp//jetdirect/// Host: 192.168.1.13 () Status: Up Host: 192.168.1.13 () Ports: 515/open/tcp//printer///, 631/open/tcp//ipp///, 9100/open/tcp//jetdirect/// Host: 192.168.1.1 () Status: Up Host: 192.168.1.1 () Ports: 515/closed/tcp//printer///, 631/closed/tcp//ipp///, 9100/closed/tcp//jetdirect/// Host: 192.168.1.254 () Status: Up Host: 192.168.1.254 () Ports: 515/filtered/tcp//printer///, 631/filtered/tcp//ipp///, 9100/filtered/tcp//jetdirect/// # Nmap done at Wed Feb 3 16:44:28 2021 -- 512 IP addresses (4 hosts up) scanned in 8.37 seconds list hostname with mac address $ sudo nmap -sP 172.31.201.0/24 | awk '/Nmap scan report for/{printf $5;}/MAC Address:/{print \" => \"$3;}' | sort 192.168.1.1 => C0:**:**:**:**:C8 192.168.1.108 => 08:**:**:**:**:6B 192.168.1.109 => 08:**:**:**:**:96 ... get hostname, macaddress, OS$ sudo nmap -sn 192.168.1.0/23 | awk '/Nmap scan report for/{printf $5;}/MAC Address:/{print \" => \"substr($0, index($0,$3)) }' | sort 192.168.1.1 => C0:**:**:**:**:C8 (Cisco Systems) 192.168.1.108 => 08:**:**:**:**:6B (Oracle VirtualBox virtual NIC) 192.168.1.109 => 08:**:**:**:**:96 (Oracle VirtualBox virtual NIC) ... get all server up ip address $ sudo nmap -v -sn -n 192.168.1.0/24 -oG - | awk '/Status: Up/{print $2}' get down$ sudo nmap -v -sn -n 192.168.1.0/24 -oG - | awk '/Status: Down/{print $2}' scan ip/host $ sudo nmap -sS 1.2.3.4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-14 22:52 PDT Nmap scan report for host.example.com (1.2.3.4) Host is up (0.00077s latency). Not shown: 991 filtered tcp ports (no-response), 6 filtered tcp ports (admin-prohibited) PORT STATE SERVICE 22/tcp open ssh 3389/tcp open ms-wbt-server 9090/tcp open zeus-admin Nmap done: 1 IP address (1 host up) scanned in 4.98 seconds # or $ sudo nmap -Pn -sS --reason 1.2.3.4 Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-14 23:02 PDT Nmap scan report for host.example.com (1.2.3.4) Host is up, received user-set (0.018s latency). Not shown: 997 closed tcp ports (reset) PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 61 111/tcp open rpcbind syn-ack ttl 61 2049/tcp open nfs syn-ack ttl 61 trace with port$ nmap --reason -p 16000 192.168.0.104 route iptables [!NOTE|label:references:] Linux系统运维: Iptables 应用 How to save/backup existing iptables rules to a file – Iptables commands How to Backup Iptables Configuration What's the difference between PREROUTING and FORWARD in iptables?$ iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080 $ iptables -A FORWARD -i eth0 -p tcp --dport 80 -d 192.168.0.4 -j ACCEPT How to list all iptables rules with line numbers on Linux How To Forward Ports through a Linux Gateway with Iptables show status $ sudo iptables -L -nv --line-number backup $ sudo iptables-save > iptables-backup-$(date +%F) # or $ sudo iptables-save > /etc/iptables/rules.v4 $ sudo ip6tables-save > /etc/iptables/rules.v6 # for ipv6 # automatic backup $ crontab -L 0 0 * * * root iptables-save > /backup/iptables-backup-$(date +%F) restore $ sudo iptables-restore flush $ sudo iptables -F port forwarding [!NOTE|label:references:] How can I port forward with iptables? Basic iptables NAT port forwarding How to formulate IP forwarding rule using iptables # enable forwarding is allowed $ echo '1' | sudo tee /proc/sys/net/ipv4/conf/ppp0/forwarding $ echo '1' | sudo tee /proc/sys/net/ipv4/conf/eth0/forwarding # or $ sudo sysctl net.ipv4.conf.eth0.forwarding=1 $ sudo sysctl net.ipv6.conf.eth0.forwarding=1 # or $ cat /etc/sysctl.d/99-forwarding.conf sysctl net.ipv4.conf.eth0.forwarding=1 sysctl net.ipv6.conf.eth0.forwarding=1 EOF # port forward $ sudo iptables -t nat -A PREROUTING -p tcp -i ppp0 --dport 8001 -j DNAT --to-destination 192.168.1.200:8080 $ sudo iptables -A FORWARD -p tcp -d 192.168.1.200 --dport 8080 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT # or https://serverfault.com/a/140624/129815 $ sudo iptables -A FORWARD -m state -p tcp -d 192.168.1.200 --dport 8080 --state NEW,ESTABLISHED,RELATED -j ACCEPT $ sudo iptables -t nat -A PREROUTING -p tcp --dport 8001 -j DNAT --to-destination 192.168.1.200:8080 more details # PC ----- Ubuntu 10 Server ----- Slashdot # (1.2.3.4) (5.6.7.8) (216.34.181.45) # enable ip forwarding $ sudo echo 1 > /proc/sys/net/ipv4/ip_forward # add rule $ iptables -t nat -A PREROUTING -i eth0 -p tcp -m tcp --dport 8080 -j DNAT --to-destination 216.34.181.45:80 $ iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source 5.6.7.8 # use MASQUERADE if the Ubuntu has a dynamic IP $ iptables -t nat -A POSTROUTING -j MASQUERADE # jumper server $ ssh -L 5.6.7.8:8080:216.34.181.45:80 -N user@216.34.181.45 # more config $ cat /etc/rinetd.conf 5.6.7.8 8080 216.34.181.45 80 $ /etc/init.d/rinetd start # iptable-save *nat -A PREROUTING -p tcp -m tcp -i eth0 --dport 8080 -j DNAT --to-destination 216.34.181.45:80 -A POSTROUTING -o eth0 -j SNAT --to-source 5.6.7.8 COMMIT script #!/bin/bash # decide which action to use action=\"add\" if [[ \"-r\" == \"$1\" ]]; then action=\"remove\" shift fi # break out components dest_addr_lan=\"$1\" dest_port_wan=\"$2\" dest_port_lan=\"$3\" # figure out our WAN ip wan_addr=`curl -4 -s icanhazip.com` # auto fill our dest lan port if we need to if [ -z $dest_port_lan ]; then dest_port_lan=\"$dest_port_wan\" fi # print info for review echo \"Destination LAN Address: $dest_addr_lan\" echo \"Destination Port WAN: $dest_port_wan\" echo \"Destination Port LAN: $dest_port_lan\" echo \"WAN Address: $wan_addr\" # confirm with user read -p \"Does everything look correct? \" -n 1 -r echo # (optional) move to a new line if [[ $REPLY =~ ^[Yy]$ ]]; then if [[ \"remove\" == \"$action\" ]]; then iptables -t nat -D PREROUTING -p tcp -m tcp -d $wan_addr --dport $dest_port_wan -j DNAT --to-destination $dest_addr_lan:$dest_port_lan iptables -D FORWARD -m state -p tcp -d $dest_addr_lan --dport $dest_port_lan --state NEW,ESTABLISHED,RELATED -j ACCEPT iptables -t nat -D POSTROUTING -p tcp -m tcp -s $dest_addr_lan --sport $dest_port_lan -j SNAT --to-source $wan_addr echo \"Forwarding rule removed\" else iptables -t nat -A PREROUTING -p tcp -m tcp -d $wan_addr --dport $dest_port_wan -j DNAT --to-destination $dest_addr_lan:$dest_port_lan iptables -A FORWARD -m state -p tcp -d $dest_addr_lan --dport $dest_port_lan --state NEW,ESTABLISHED,RELATED -j ACCEPT iptables -t nat -A POSTROUTING -p tcp -m tcp -s $dest_addr_lan --sport $dest_port_lan -j SNAT --to-source $wan_addr echo \"Forwarding rule added\" fi else echo \"Info not confirmed, exiting...\" fi port redirection $ sudo iptables -L -n Chain INPUT (policy ACCEPT) target prot opt source destination Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination $ sudo iptables -I INPUT 1 -p tcp --dport 8080 -j ACCEPT $ sudo iptables -I INPUT 1 -p tcp --dport 80 -j ACCEPT $ sudo iptables -A PREROUTING -t nat -i ens32 -p tcp --dport 80 -j REDIRECT --to-port 8080 $ sudo iptables -t nat -I OUTPUT -p tcp -d 127.0.0.1 --dport 80 -j REDIRECT --to-ports 8080 $ sudo iptables -t nat -I OUTPUT -p tcp -o lo --dport 80 -j REDIRECT --to-ports 8080 $ sudo iptables -L -n Chain INPUT (policy ACCEPT) target prot opt source destination ACCEPT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:80 ACCEPT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:8080 Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination $ sudo netfilter-persistent save run-parts: executing /usr/share/netfilter-persistent/plugins.d/15-ip4tables save run-parts: executing /usr/share/netfilter-persistent/plugins.d/25-ip6tables save $ sudo iptables-save > /etc/iptables/rules.v4 nslookup $ nslookup sample.gitlab.com Server: 130.147.236.5 Address: 130.147.236.5#53 Non-authoritative answer: Name: sample.gitlab.com Address: 130.147.219.15 $ ip route get 130.147.219.15 130.147.219.15 dev eno1 src 130.147.182.240 uid 1000 cache $ nslookup github.com Server: 130.147.236.5 Address: 130.147.236.5#53 Non-authoritative answer: Name: github.com Address: 192.30.253.112 Name: github.com Address: 192.30.253.113 $ ip route get 192.30.253.113 192.30.253.113 via 192.168.10.1 dev wlan0 src 192.168.11.166 uid 1000 cache or $ ip route show default via 192.168.10.1 dev wlan0 proto dhcp metric 600 10.244.0.0/24 dev cni0 proto kernel scope link src 10.244.0.1 130.140.0.0/16 dev eth0 scope link 130.145.0.0/16 dev eth0 scope link 130.146.0.0/16 dev eth0 scope link 130.147.0.0/16 dev eth0 scope link 130.147.182.0/23 dev eth0 proto kernel scope link src 130.147.182.57 metric 100 137.55.0.0/16 dev eth0 scope link 161.83.0.0/16 dev eth0 scope link 161.84.0.0/16 dev eth0 scope link 161.85.0.0/16 dev eth0 scope link 161.88.0.0/16 dev eth0 scope link 161.91.0.0/16 dev eth0 scope link 161.92.0.0/16 dev eth0 scope link 169.254.0.0/16 dev eth0 scope link metric 1000 172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown 185.166.0.0/16 dev eth0 scope link 192.168.10.0/23 dev wlan0 proto kernel scope link src 192.168.10.235 metric 600 or $ route -n Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface 0.0.0.0 192.168.10.1 0.0.0.0 UG 600 0 0 wlan0 10.244.0.0 0.0.0.0 255.255.255.0 U 0 0 0 cni0 130.140.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.145.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.146.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.147.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 130.147.182.0 0.0.0.0 255.255.254.0 U 100 0 0 eth0 137.55.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.83.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.84.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.85.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.88.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.91.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 161.92.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 169.254.0.0 0.0.0.0 255.255.0.0 U 1000 0 0 eth0 172.17.0.0 0.0.0.0 255.255.0.0 U 0 0 0 docker0 185.166.0.0 0.0.0.0 255.255.0.0 U 0 0 0 eth0 192.168.10.0 0.0.0.0 255.255.254.0 U 600 0 0 wlan0 traceroute [!NOTE|label:references:] How does traceroute -T -p work? What does \"!Z\" and \"!X\" mean in a traceroute? !X means \"communication administratively prohibited\"` !Z means \"communication with destination host administratively prohibited\"Since Linux uses UDP for trace-routes, this can originate from a `--reject-with icmp-host-prohibited` To fix this you need to reply with `--reject-with icmp-port-unreachable` on UDP ports 33434 through 33534 How to open and close ports on RHEL 8 / CentOS 8 Linux How To Set Up a Firewall Using firewalld on CentOS 8 How to stop/start firewall on RHEL 8 / CentOS 8 How To Fix “No Route To Host” In Linux traceroute for port [!NOTE|label:references:] [] ## before firewall open the port 2376 $ sudo traceroute -T -p 2376 1.2.3.4 traceroute to 1.2.3.4 (1.2.3.4), 30 hops max, 60 byte packets 1 _gateway (127.0.0.1) 0.624 ms 0.603 ms 0.594 ms 6 host.example.com (1.2.3.4) 14.750 ms !X 14.682 ms !X 23.138 ms !X ## after firewall open the port 2376 $ sudo traceroute -T -p 2376 1.2.3.4 traceroute to 1.2.3.4 (1.2.3.4), 30 hops max, 60 byte packets 1 _gateway (127.0.0.1) 0.346 ms 0.316 ms 0.310 ms 6 host.example.com (1.2.3.4) 23.093 ms 14.725 ms 14.625 ms No route to host [!NOTE|label:references:] Linux系统运维: 防火墙 - Firewalld $ nc -zv 1.2.3.4 2376 nc: connect to 1.2.3.4 port 2376 (tcp) failed: No route to host $ traceroute 1.2.3.4 traceroute to 1.2.3.4 (1.2.3.4), 30 hops max, 60 byte packets 1 _gateway (127.0.0.1) 0.569 ms 0.539 ms 2.512 ms 2 host.example.com (1.2.3.4) 23.582 ms !X 23.486 ms !X 15.065 ms !X # ^ ^ ^ # communication administratively prohibited check firewall status $ ssh 1.2.3.4 $ sudo firewall-cmd --state running $ sudo firewall-cmd --list-all public (active) target: default icmp-block-inversion: no interfaces: enp74s0 sources: services: cockpit dhcpv6-client ssh ports: 3389/tcp protocols: forward: no masquerade: no forward-ports: source-ports: icmp-blocks: rich rules: $ sudo firewall-cmd --zone=public --list-ports 3389/tcp enable port $ sudo firewall-cmd --zone=public --permanent --add-port 2376/tcp success $ sudo firewall-cmd --zone=public --list-ports 3389/tcp $ sudo firewall-cmd --reload success $ sudo firewall-cmd --zone=public --list-ports 2376/tcp 3389/tcp verify $ nc -zv 1.2.3.4 2376 Connection to 1.2.3.4 2376 port [tcp/docker-s] succeeded! $ docker -H tcp://1.2.3.4:2376 images REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu 18.04 71cb16d32be4 10 months ago 63.1MB other usage # get $ firewall-cmd --list-all $ firewall-cmd --get-default-zone $ firewall-cmd --get-active-zones $ sudo firewall-cmd --list-all-zones | less $ sudo firewall-cmd --zone=public --list-all $ sudo firewall-cmd --zone=public --list-services $ sudo firewall-cmd --zone=public --change-interface=eth0 $ firewall-cmd --get-zones $ firewall-cmd --get-services $ sudo firewall-cmd --runtime-to-permanent # add $ sudo firewall-cmd --zone=public --add-service=http $ sudo firewall-cmd --zone=public --add-service=http --permanent $ sudo firewall-cmd --zone=public --add-port 8080/tcp --permanent # remove $ sudo firewall-cmd --zone=public --permanent --remove-port 2376/tcp $ sudo firewall-cmd --reload add ip range [!NOTE|label:references:] How to open port for a specific IP address with firewall-cmd on CentOS? [duplicate] How to open port for a specific IP address with firewall-cmd on CentOS? [duplicate] open all ports to specific IP with firewalld # all ports for ip range $ sudo firewall-cmd --zone=trusted --add-source=64.39.96.0/20 # limited ports for ip range $ firewall-cmd --new-zone=special --permanent $ firewall-cmd --reload $ firewall-cmd --zone=special --add-source=192.0.2.4/32 $ firewall-cmd --zone=special --add-port=4567/tcp # or rich rule $ firewall-cmd --permanent --zone=public --add-rich-rule=' rule family=\"ipv4\" source address=\"1.2.3.4/32\" port protocol=\"tcp\" port=\"4567\" accept' possibly impacted $ echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward $ sudo sysctl -w net.ipv4.conf.all.route_localnet=1 DNS add new DNS permanently $ sudo apt install resolvconf $ sudo cp /etc/resolvconf/resolv.conf.d/head{,.org} $ sudo bash -c \"cat > /etc/resolvconf/resolv.conf.d/head\" wifi iwconfig installation $ sudo apt install wireless-tools get wireless card $ WIRELESSCARD=\"$(iwconfig 2>/dev/null | /bin/grep ESSID | awk -F' ' '{print $1}')\" $ iwconfig 2>/dev/null | \\grep ESSID wlx24050f15c19b IEEE 802.11 ESSID:\"MERCURY_07FA\" wireless network details $ sudo iwlist scan docker0 Interface doesn't support scanning. eno1 Interface doesn't support scanning. lo Interface doesn't support scanning. cni0 Interface doesn't support scanning. flannel.1 Interface doesnt support scanning. wlx24050f15c19b Scan completed : Cell 01 - Address: 50:3A:A0:CB:07:FA Channel:1 Frequency:2.412 GHz (Channel 1) Quality=55/70 Signal level=-55 dBm Encryption key:on ESSID:\"MERCURY_07FA\" Bit Rates:1 Mb/s; 2 Mb/s; 5.5 Mb/s; 11 Mb/s; 9 Mb/s 18 Mb/s; 36 Mb/s; 54 Mb/s Bit Rates:6 Mb/s; 12 Mb/s; 24 Mb/s; 48 Mb/s Mode:Master ... or $ nmcli --show-secrets connection show 'MERCURY_07FA' connection.id: MERCURY_07FA connection.uuid: 8e362f4a-d3a3-4147-b31e-4519954b55ef connection.stable-id: -- connection.type: 802-11-wireless connection.interface-name: -- connection.autoconnect: yes connection.autoconnect-priority: 0 connection.autoconnect-retries: -1 (default) connection.auth-retries: -1 connection.timestamp: 1530689982 connection.read-only: no ... nmcli show available wifi$ sudo nmcli device wifi rescan $ nmcli dev wifi list IN-USE SSID MODE CHAN RATE SIGNAL BARS SECURITY CDI_TP-LINK Infra 11 405 Mbit/s 100 ▂▄▆█ WPA1 WPA2 TP-LINK_CDI Infra 1 270 Mbit/s 82 ▂▄▆█ WPA1 WPA2 WLAN-PUB Infra 4 54 Mbit/s 82 ▂▄▆█ WPA1 WPA2 HiWiFi_Pins Infra 7 270 Mbit/s 82 ▂▄▆█ WPA1 WPA2 -- Infra 1 54 Mbit/s 59 ▂▄▆_ -- * MERCURY_07FA Infra 1 270 Mbit/s 55 ▂▄__ WPA1 WPA2 Automation-Local Infra 9 195 Mbit/s 55 ▂▄__ WPA2 ChinaUnicom Infra 1 54 Mbit/s 42 ▂▄__ -- 61-PUB Infra 1 270 Mbit/s 29 ▂___ WPA2 HC_Guest Infra 6 405 Mbit/s 29 ▂___ WPA1 WPA2 HuaCloud_AP Infra 6 405 Mbit/s 29 ▂___ WPA1 WPA2 56qq-guest Infra 6 195 Mbit/s 25 ▂___ WPA2 56qq-sec Infra 1 195 Mbit/s 22 ▂___ WPA2 802.1X 56qq-guest Infra 1 195 Mbit/s 22 ▂___ WPA2 HCB Infra 1 195 Mbit/s 19 ▂___ WPA2 802.1X show saved wifi list$ nmcli c ( = $ nmcli connection) NAME UUID TYPE DEVICE WLAN-PUB 545d5d95-723f-4e1b-b764-8e9bd2fe6a9f wifi wlp2s0 Wired connection 1 a2a10a61-4519-3380-9301-c6e2a592eaa7 ethernet enp0s31f6 CDI_TP-LINK_5G cb00cf00-58ca-4668-9b4c-e1fb3b18c932 wifi -- nmtui netmask [!NOTE|label:references:] ipcalc online ipcalc brew install conversion [!NOTE|label:references:] * iMarslo : math : binary <> decimal <> hexadecimal obase : [o]utput base ibase : [i]utput base # bin -> dec $ bc hex $ bc bin $ bc hex $ bc bin $ bc dec $ bc basic concept [!TIP|label:what is netmask] A netmask is a 32-bit binary mask used to divide an IP address into subnets and specify the network's available hosts. full 32-bit : 11111111 11111111 11111111 11111111 # |------| |------| |------| |------| # 8 + 8 + 8 + 8 == total 32-bit sample data: ip address: 10.0.0.0 24-bit = 1x8x3 + 0x8 bit = 11111111 11111111 11111111 00000000 wildcard = 00000000 00000000 00000000 11111111 = 0x8x3 + 1x8 bit = 2^8 - 1 = 255 = support 255 IPs maximum including boardcast = support 255-1 regular IPs ==> network : 10.0.0.0/24 hostMin : 10.0.0.1 hostMax : 10.0.0.254 boardcast : 10.0.0.254 host/net : 254 example if netmask using n-bit, then supported hosts/nets = 2^(32-) - 1 - 1. i.e.: netmask : 27 supported IPs : 2^(32-27) - 1 - 1 = 2^5 - 1 - 1 = 32 - 2 = 30 IP ranges : 10.0.0.1 ~ 10.0.0.30 boardcast : 10.0.0.31 if netmask using 255.255.x.x convert netmask decimal to binary, and get bit and then get wildcard. i.e.: netmask : 255.255.255.192 decimal to binary : [!TIP] $ bc -l 192 = 128 + 64 = 2^7 + 2^6 = 10000000 + 01000000 netmask : 255 . 255 . 255 . 192 11111111 11111111 11111111 11000000|---------------------------| 26-bit = 1x3x8 + 1x2 + 0x6 = 26 wildcard : 0 . 0 . 0 . 63 00000000 00000000 00000000 00111111 |----| 6-bit = 0x3x8 + 0x2 + 1x6 = 6 === 32 - 26 = 6 IPs : 2^6 - 1 - 1 = 64 - 2 = 62 = 10.0.0.1 ~ 10.0.0.62 boardcast : 10.0.0.63 255.255.255.255 - , and then convert decimal to binary netmask : 255.255.240.0 wildcard : [!TIP] $ bc -l 255.255.255.255 - 255.255.240.0 = 0.0.15.255 = 0 . 0 . 15 . 255 00000000 00000000 00001111 11111111 |-----------| 12-bit IPs : 2^12 - 1 - 1 = 4094 =10.0.0.1 ~ 10.0.0.15.254 -- 0.0.15.255 # 255.255.255.255 - 255.255.240.0 = 0.0.15.255 boardcast : 10.0.15.255 netmask quick reference # BITS # HOSTS NETMASK CLASS /4 268435456 240.0.0.0 A /5 134217728 248.0.0.0 A /6 67108864 252.0.0.0 A /7 33554432 254.0.0.0 A /8 16777216 255.0.0.0 A /9 8388608 255.128.0.0 B /10 4194304 255.192.0.0 B /11 2097152 255.224.0.0 B /12 1048576 255.240.0.0 B /13 524288 255.248.0.0 B /14 262144 255.252.0.0 B /15 131072 255.254.0.0 B /16 65536 255.255.0.0 B /17 32768 255.255.128.0 C /18 16384 255.255.192.0 C /19 8192 255.255.224.0 C /20 4096 255.255.240.0 C /21 2048 255.255.248.0 C /22 1024 255.255.252.0 C /23 512 255.255.254.0 C /24 256 255.255.255.0 C /25 128 255.255.255.128 - /26 64 255.255.255.192 - /27 32 255.255.255.224 - /28 16 255.255.255.240 - /29 8 255.255.255.248 - /30 4 255.255.255.252 - /31 - - - /32 1 255.255.255.255 - ipcalc [!NOTE|label:references:] How to Calculate Network Addresses with ipcalc basic usage split network to subnets deaggregate address range Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:36:57 "},"linux/troubleshooting.html":{"url":"linux/troubleshooting.html","title":"troubleshooting","keywords":"","body":" ssl.h curl.h expat.h tclsh asciidoc docbook2x-texi hunspell ao ncurses bash_completion ssl.h issues: git-compat-util.h:213:25: fatal error: openssl/ssl.h: No such file or directory #include \\ Solution: Ubuntu/Debian: $ sudo apt-get install libssl-dev RHEL/CentOS $ sudo yum install openssl-devel curl.h issues: http.h:6:23: fatal error: curl/curl.h: No such file or directory #include \\ Solution: For OpenSuse: $ sudo apt-get install libcurl4-openssl For Ubuntu/Debian: $ sudo apt-get install libcurl4-openssl-dev For RHEL/CentOS: $ sudo yum install libcurl libcurl-devel Reason: libcurl-dev should be installed, but Package libcurl-dev is a virtual package provided by: libcurl4-openssl-dev 7.35.0-1ubuntu2 libcurl4-nss-dev 7.35.0-1ubuntu2 libcurl4-gnutls-dev 7.35.0-1ubuntu2 You should explicitly select one to install. expat.h issues: http-push.c:17:19: fatal error: expat.h: No such file or directory #include \\ Solution: For Ubuntu/Debain: $ apt-cache search expat | grep dev libexpat1-dev - XML parsing C library - development kit lib64expat1-dev - XML parsing C library - development kit (64bit) libexpat-ocaml-dev - OCaml expat bindings lua-expat-dev - libexpat development files for the Lua language tdom-dev - fast XML/DOM/XPath/XSLT extension for Tcl written in C (development files) $ sudo apt-get install libexpat1-dev For RHEL/CentOS:$ sudo yum install expat-devel tclsh issues: tclsh failed; using unoptimized loading MSGFMT po/de.msg make[1]: *** [po/de.msg] Error 127 make: *** [all] Error 2 Solution: For Ubuntu/Debain:$ sudo apt-get install gettext asciidoc issues ASCIIDOC git-add.html /bin/sh: 2: asciidoc: not found make[1]: *** [git-add.html] Error 127 make[1]: Leaving directory `/home/marslo/Tools/Software/Programming/Git/git-master/Documentation' make: *** [doc] Error 2 solution For Ubuntu/Debain: $ apt-cache search asciidoc $ sudo apt-get install asciidoc For RHEL/CentOS: $ yum install docbook-style-xsl $ rpm -ivh http://pkgs.repoforge.org/asciidoc/asciidoc-8.6.9-1.el6.rfx.noarch.rpm docbook2x-texi issues db2texi user-manual.texi /bin/sh: 2: docbook2x-texi: not found make[1]: *** [user-manual.texi] error 127 make[1]: leaving directory `/home/marslo/tools/software/programming/git/git-master/documentation' make: *** [info] error 2 solution For Ubuntu/Debain:$ sudo apt-get install docbook2x For RHEL/CentOS (Inspired from Git for human beings google group):$ sudo yum -y --enablerepo=*epel* install docbook2X $ sudo ln -s /usr/bin/db2x_docbook2texi /usr/bin/docbook2x-texi hunspell issues $ qmake-qt4 Project MESSAGE: Install Prefix is: /usr/local Project ERROR: Package hunspell not found solution For Ubuntu/Debain:$ sudo apt-get install hunspell $ sudo apt-get install libhunspell-dev ao issues $ qmake-qt4 Project MESSAGE: Install Prefix is: /usr/local Project ERROR: Package ao not found solution For Ubuntu/Debain: $ apt-cache search ao | grep dev libao-dev - Cross Platform Audio Output Library Development ... $ sudo apt-get install libao-dev ncurses issues no terminal library found checking for tgetent()... configure: error: NOT FOUND! You need to install a terminal library; for example ncurses. Or specify the name of the library with --with-tlib. solution For RHEL/CentOS:$ yum install ncurses-devel bash_completion bash: _filedir: command not found [!NOTE|label:references:] #1305: bash:_filedir: command not found # modify BASH_COMPLETION=\"$(brew --prefix)/etc/profile.d/bash_completion.sh\" # to BASH_COMPLETION=\"$(brew --prefix bash-completion)/etc/bash_completion\" # and then test -f \"${BASH_COMPLETION}\" && source \"${BASH_COMPLETION}\" result $ type _filedir _filedir is a function _filedir () { local i IFS=' ' xspec; _tilde \"$cur\" || return 0; local -a toks; local quoted tmp; _quote_readline_by_ref \"$cur\" quoted; toks=(${toks[@]-} $(compgen -d -- \"$cur\" | { while read -r tmp; do printf '%s\\n' $tmp; done; })); if [[ \"$1\" != -d ]]; then [[ ${BASH_VERSINFO[0]} -ge 4 ]] && xspec=${1:+\"!*.@($1|${1^^})\"} || xspec=${1:+\"!*.@($1|$(printf %s $1 | tr '[:lower:]' '[:upper:]'))\"}; toks=(${toks[@]-} $(compgen -f -X \"$xspec\" -- $quoted)); fi; [ ${#toks[@]} -ne 0 ] && _compopt_o_filenames; COMPREPLY=(\"${COMPREPLY[@]}\" \"${toks[@]}\") } $ fcf _filedir _filedir 632 /usr/local/opt/bash-completion/etc/bash_completion Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"linux/system.html":{"url":"linux/system.html","title":"system","keywords":"","body":" hardware spec os hardware cpu memory bios disk network environment variables get system info top ps set system info clear duplicated PATH LS_COLORS set dns for ubuntu disable firewall change net.bridge off swap disable selinux confined and unconfined users process find the zombie process about whatis user management sssd to use LDAP local user subuid & subgid local group get gid logout others service enable/disable service start/stop service check log system encoding setup via environment setup via locale command locales langpacks applications disable lock screen in CentOS 8 sogou Pinyin input method specified terminal size burn bootable usb stick remove system Q&A yum issue after python upgrade to 3.x none of the providers can be installed in dnf upgrade ls: Argument list too long others motd motd references: Environment Variables 16 Commands to Check Hardware Information on Linux Using Commands to Display System Information 30 Useful Linux Commands for System Administrators 90 Linux Commands frequently used by Linux Sysadmins 50 UNIX / Linux Sysadmin Tutorials 50 Most Frequently Used UNIX / Linux Commands (With Examples) Top 25 Best Linux Performance Monitoring and Debugging Tools dmidecode – A Best Tool to Get System Hardware Information on Linux 17 Ways to check size of physical memory (RAM) in Linux Top 15 tools to monitor disk IO performance with examples How To Find Linux System Details Using inxi Tutorial: Beginners guide on linux memory management Buffers vs Page cache Understanding Dirty Page Understanding Active and Inactive Memory Different types of swapping scenarios and risks drop caches $ sudo bash -c \"echo 3 > /proc/sys/vm/drop_caches\" hardware spec [!TIP] list info glances hwinfo lshw lscpu lsmem lspci lsscsi lsusb inxi ( inxi --recommends, inxi -F|--full ) lsblk lsof ncdu - a disk utility for Unix systems fdisk blkid - command-line utility to locate/print block device attributes mount free dmidecode hdparm lstopo-no-graphics hwloc-ls /proc /proc/cpuinfo /proc/meminfo /proc/version /proc/scsi/scsi /proc/partitions performance & analysis * imarslo : adminTools vmstat - shows system memory, processes, interrupts, paging, block I/O, and CPU info iostat - for storage I/O statistics. iotop - interactive I/O viewer. Get an overview of storage r/w activity netstat – for network statistics iftop - network traffic viewer nload - a super simple, command-line network interface monitoring tool mtr - network diagnostic tool dig - DNS lookup utility tool nethogs - network traffic analyzer apropos - search man page names and descriptions fsck - tool for checking the consistency of a file system vnstat dstat mpstat ss - socket statistics sar nethogs - network traffic analyzer lshw Classes address bridge bus communication disk display generic input memory multimedia network power printer processor storage system tape volume os $ lsb_release -a LSB Version : :core-4.1-amd64:core-4.1-noarch Distributor ID : CentOS Description : CentOS Linux release 7.9.2009 (Core) Release : 7.9.2009 Codename : Core $ uname -a Linux my-computer 3.10.0-1160.42.2.el7.x86_64 #1 SMP Tue Sep 7 14:49:57 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux $ cat /etc/centos-release CentOS Linux release 7.9.2009 (Core) hardware $ sudo dmidecode -s portable hardware locality [!TIP] lstopo command in Linux $ sudo yum install -y hwloc $ lstopo-no-graphics $ hwloc-ls $ hwloc-info $ lstopo-no-graphics -p system information $ sudo dmidecode | grep -A5 '^System Information' System Information Manufacturer: HPE Product Name: ProLiant DL380 Gen10 Version: Not Specified Serial Number: S*************0 UUID: 0******0-0**0-0**0-0**0-3**********e # or display system [m]anufacture $ inxi -M Machine: Type: Server Mobo: HPE model: ProLiant DL380 Gen10 serial: UEFI: HPE v: U30 date: 06/15/2018 # or $ sudo inxi --dmidecode -Mxxx Machine: Type: Rack Mount Chassis Mobo: HPE model: ProLiant DL380 Gen10 serial: PFARA%%LMAZ6XB BIOS: HPE v: U30 rev: 1.40 date: 06/15/2018 rom size: 16384 kB manufacturer $ sudo dmidecode -s system-manufacturer HPE # or $ sudo dmidecode -s baseboard-manufacturer HPE # or $ cat /sys/devices/virtual/dmi/id/sys_vendor HPE product name and version product name only $ sudo dmidecode -s system-product-name ProLiant DL380 Gen10 # or $ sudo dmidecode -s baseboard-product-name ProLiant DL380 Gen10 # or $ cat /sys/devices/virtual/dmi/id/product_name ProLiant DL380 Gen10 # or $ sudo dmidecode | grep -i prod Product Name: Vostro 5560 Product Name: 04YDT0 uuid $ sudo dmidecode | grep -i uuid | awk '{print $2}' | tr '[:upper:]' '[:lower:]' cpu references: How to know number of cores of a system in Linux? How to find out the number of CPU & Cores of your Linux machine cpu cores $ cat /proc/cpuinfo | egrep \"core id|physical id\" | tr -d \"\\n\" | sed s/physical/\\\\nphysical/g | grep -v ^$ | sort | uniq | wc -l 36 # or $ grep -c processor /proc/cpuinfo 32 # or $ nproc --all 32 # or $ getconf _NPROCESSORS_ONLN 32 # or $ cat /sys/devices/system/cpu/present 0-31 # or CPUs = Threads per core X cores per socket X socket $ lscpu | grep -E '^Thread|^Core|^Socket|^CPU\\(' CPU(s): 32 Thread(s) per core: 2 Core(s) per socket: 8 Socket(s): 2 $ lscpu | grep --color=none -E '^(Thread|Core|Socket|CPU\\(|NUMA|Model\\ name)' CPU(s): 128 Thread(s) per core: 2 Core(s) per socket: 64 Socket(s): 1 NUMA node(s): 1 Model name: AMD EPYC 7742 64-Core Processor NUMA node0 CPU(s): 0-127 # or $ sudo dmidecode -t 4 | grep -E 'Socket Designation|Count' Socket Designation: CPU1 Core Count: 8 Thread Count: 16 Socket Designation: CPU2 Core Count: 8 Thread Count: 16 others$ lscpu --all --extended $ lscpu --all --parse=CPU,SOCKET,CORE | grep -v '^#' check CPU support 64 bit or not $ sudo dmidecode --type=processor | grep -i -A 1 Characteristics Characteristics: 64-bit capable cat /proc/cpuinfo $ lscpu Architecture: i686 CPU op-mode(s): 32-bit, 64-bit Byte Order: Little Endian CPU(s): 4 On-line CPU(s) list: 0-3 .... cpu info $ sudo dmidecode -t processor # or $ sudo lshw -C cpu # or $ sudo dmidecode -t 4 | egrep -i \"Designation|Intel|core|thread\" # or $ inxi -C CPU: Info: 2x 8-core model: Intel Xeon E5-2667 v4 bits: 64 type: MT MCP SMP cache: L2: 2x 2 MiB (4 MiB) Speed (MHz): avg: 1324 min/max: 1200/3600 cores: 1: 1202 2: 1202 3: 1251 4: 1200 5: 1201 6: 1376 7: 1260 8: 1205 9: 1203 10: 1202 11: 1201 12: 1201 13: 1201 14: 1202 15: 1201 16: 1202 17: 1200 18: 1200 19: 1600 20: 1199 21: 1201 22: 1287 23: 1892 24: 1201 25: 1200 26: 1201 27: 3200 28: 1200 29: 1200 30: 1701 31: 1201 32: 1200 memory references: Find Out the Total Physical Memory (RAM) on Linux 17 Ways to check size of physical memory (RAM) in Linux free – A standard command to check memory usage statistics in Linux nmon – A Nifty Tool To Monitor System Resources On Linux RAM: Random Access Memory is a temporary memory. This information will go away when the computer is turned off. ROM: Read Only Memory is permanent memory, that holds the data even if the system is switched off. list total memory $ hwinfo --memory | grep 'Memory Size' Memory Size: 128 GB $ sudo lshw -short | grep 'System Memory' /0/2c memory 128GiB System Memor $ vmstat -s -S M | egrep -ie 'total memory' 128817 M total memory $ vmstat -s | grep \"total memory\" 131909608 K total memory $ vmstat -s | awk '{print $1 / 1024 / 1024}' | head -1 125.799 $ inxi -F | grep \"Memory\" Processes: 414 Uptime: 87d 17h 40m Memory: 125.8 GiB used: 27.21 GiB (21.6%) Init: systemd $ sudo dmidecode -t memory | grep Size: | grep -v \"No Module Installed\" | awk '{sum+=$2}END{print sum}' 131072 $ egrep 'MemTotal|MemFree|MemAvailable' /proc/meminfo MemTotal: 131909608 kB MemFree: 95760488 kB MemAvailable: 104355708 kB $ vmstat -s list only installed RAM modules $ sudo dmidecode -t memory | grep Size: | grep -v \"No Module Installed\" memory information $ sudo dmidecode -t memory # or $ sudo lshw -C memory $ sudo lshw -short -class memory # Physical Memory Array $ sudo dmidecode --type 16 # get Memory Device $ sudo dmidecode --type 17 # Memory Array Mapped Address $ sudo dmidecode --type 19 print memory only $ ps -o comm,%mem,args -u marslo | more COMMAND %MEM COMMAND gnome-keyring-d 0.0 /usr/bin/gnome-keyring-daemon --daemonize --login init 0.0 init --user ssh-agent 0.0 ssh-agent dbus-daemon 0.0 dbus-daemon --fork --session --address=unix:abstract=/tmp/dbus-i5FUVjzADG upstart-event-b 0.0 upstart-event-bridge window-stack-br 0.0 /usr/lib/i386-linux-gnu/hud/window-stack-bridge upstart-dbus-br 0.0 upstart-dbus-bridge --daemon --session --user --bus-name session upstart-dbus-br 0.0 upstart-dbus-bridge --daemon --system --user --bus-name system upstart-file-br 0.0 upstart-file-bridge --daemon --user ibus-daemon 0.1 /usr/bin/ibus-daemon --daemonize --xim .... check memory in time $ free -h -s 5 # or $ vmstat -w # or $ dmesg | grep \"Memory\" [ 0.995127] Memory: 131882904K/134101416K available (12300K kernel code, 2504K rwdata, 3684K rodata, 2340K init, 3240K bss, 2218512K reserved, 0K cma-reserved) [ 1.139890] x86/mm: Memory block size: 2048MB bios $ sudo dmidecode -t bios disk hwinfo$ hwinfo --disk --only /dev/sda 192: SCSI 20.0: 10600 Disk [Created at block.245] Unique ID: R7kM.qzo5k6MLsu5 Parent ID: svHJ.VbV94345RfA SysFS ID: /class/block/sda SysFS BusID: 0:2:0:0 SysFS Device Link: /devices/pci0000:00/0000:00:02.0/0000:03:00.0/host0/target0:2:0/0:2:0:0 Hardware Class: disk Model: \"AVAGO SMC3108\" Vendor: \"AVAGO\" Device: \"SMC3108\" Revision: \"4.68\" Driver: \"megaraid_sas\", \"sd\" Driver Modules: \"megaraid_sas\" Device File: /dev/sda (/dev/sg1) Device Files: /dev/sda, /dev/disk/by-id/scsi-360030480243a18012424538006708dc9, /dev/disk/by-id/wwn-0x60030480243a18012424538006708dc9, /dev/disk/by-path/pci-0000:03:00.0-scsi-0:2:0:0 Device Number: block 8:0-8:15 (char 21:1) BIOS id: 0x80 Drive status: no medium Config Status: cfg=new, avail=yes, need=no, active=unknown Attached to: #37 (RAID bus controller) disk type [!INFO] Check disk interface types Advanced technology attachment (ATA) Integrated Drive Electronics (IDE) Serial ATA (SATA) Small Computer system interface (SCSI) Serial attached SCSI (SAS) Fibre Channel lsblk $ lsblk -do name,tran NAME TRAN sdb sas sdc sas lshw $ sudo lshw -c storage -c disk ... *-sas description: Serial Attached SCSI controller product: Smart Storage PQI 12G SAS/PCIe 3 vendor: Adaptec physical id: 0 bus info: pci@0000:5c:00.0 logical name: scsi1 version: 01 width: 64 bits clock: 33MHz capabilities: sas pm msix pciexpress bus_master cap_list configuration: driver=smartpqi latency=0 resources: irq:32 memory:e9100000-e9107fff ioport:8000(size=256) *-disk:0 description: SCSI Disk # SCSC product: LOGICAL VOLUME vendor: HPE physical id: 1.0.0 bus info: scsi@1:1.0.0 logical name: /dev/sdb version: 1.99 serial: P************C size: 1788GiB (1920GB) capabilities: 15000rpm gpt-1.00 partitioned partitioned:gpt configuration: ansiversion=5 guid=eda10475-9cdb-44cd-8dbd-28bf482b0e25 logicalsectorsize=512 sectorsize=4096 hdparm $ sudo hdparm -I /dev/sdb /dev/sdb: SG_IO: bad/missing sense data, sb[]: 7*** ATA device, with non-removable media Standards: Likely used: 1 Configuration: Logical max current cylinders 0 0 heads 0 0 sectors/track 0 0 -- Logical/Physical Sector size: 512 bytes device size with M = 1024*1024: 0 MBytes device size with M = 1000*1000: 0 MBytes cache/buffer size = unknown Capabilities: IORDY not likely Cannot perform double-word IO R/W multiple sector transfer: not supported DMA: not supported PIO: pio0 SSD or HHD [!INFO] 0: SSD 1: HHD references: 7 easy methods to check disk type (HDD or SSD) in Linux How To Find If The Disk Is SSD Or HDD In Linux check rotational # HHD $ cat /sys/block/sd*/queue/rotational 1 1 # SSD $ lsscsi [0:0:0:0] disk Generic- SD/MMC CRW 1.00 /dev/sda [1:0:0:0] enclosu HPE Smart Adapter 1.99 - [1:1:0:0] disk HPE LOGICAL VOLUME 1.99 /dev/sdb [1:1:0:1] disk HPE LOGICAL VOLUME 1.99 /dev/sdc [1:2:0:0] storage HPE P408i-a SR Gen10 1.99 - [devops@dc5-ssdfw11 ~]$ cat /sys/block/sd*/queue/rotational 1 0 0 lsblk ## SSD $ lsblk -d -o name,rota NAME ROTA sdb 0 sdc 0 # or ## SSD $ lsblk -d -e 7 -o NAME,ROTA,DISC-MAX,MODEL NAME ROTA DISC-MAX MODEL sdb 0 0B LOGICAL VOLUME sdc 0 0B LOGICAL VOLUME ## HHD $ lsblk -d -e 7 -o NAME,ROTA,DISC-MAX,MODEL NAME ROTA DISC-MAX MODEL sdb 1 0B SMC3108 sda 1 0B SMC3108 smartctl ( $ yum install smartmontools ) $ sudo smartctl -a /dev/sdb1 smartctl 7.0 2018-12-30 r4883 [x86_64-linux-4.19.12-1.el7.elrepo.x86_64] (local build) Copyright (C) 2002-18, Bruce Allen, Christian Franke, www.smartmontools.org === START OF INFORMATION SECTION === Vendor: AVAGO Product: SMC3108 Revision: 4.68 Compliance: SPC-3 User Capacity: 7,679,267,307,520 bytes [7.67 TB] Logical block size: 512 bytes Physical block size: 4096 bytes Logical Unit id: 0x60030480243a7b0124d58c0646f9617d Serial number: 007d61f946068cd524017b3a24800403 Device type: disk Local Time is: Thu Mar 30 10:51:52 2023 PDT SMART support is: Unavailable - device lacks SMART capability. === START OF READ SMART DATA SECTION === Current Drive Temperature: 0 C Drive Trip Temperature: 0 C ## SSD $ sudo smartctl -a /dev/sdc smartctl 6.6 2017-11-05 r4594 [x86_64-linux-4.18.0-193.28.1.el8_2.x86_64] (local build) Copyright (C) 2002-17, Bruce Allen, Christian Franke, www.smartmontools.org === START OF INFORMATION SECTION === Vendor: HPE Product: LOGICAL VOLUME Revision: 1.99 User Capacity: 1,920,349,855,744 bytes [1.92 TB] Logical block size: 512 bytes Rotation Rate: Solid State Device # SSD Logical Unit id: 0x600508b1001c5be1882c0a4afb83c8ec Serial number: P************C Device type: disk Local Time is: Thu Mar 30 10:53:12 2023 PDT SMART support is: Available - device has SMART capability. SMART support is: Enabled Temperature Warning: Disabled or Not Supported === START OF READ SMART DATA SECTION === SMART Health Status: OK Current Drive Temperature: 0 C Drive Trip Temperature: 0 C /proc/scsi/scsi ## SSD $ cat /proc/scsi/scsi Attached devices: Host: scsi0 Channel: 00 Id: 00 Lun: 00 Vendor: Generic- Model: SD/MMC CRW Rev: 1.00 Type: Direct-Access ANSI SCSI revision: 06 Host: scsi1 Channel: 00 Id: 00 Lun: 00 Vendor: HPE Model: Smart Adapter Rev: 1.99 Type: Enclosure ANSI SCSI revision: 05 Host: scsi1 Channel: 01 Id: 00 Lun: 00 Vendor: HPE Model: LOGICAL VOLUME Rev: 1.99 Type: Direct-Access ANSI SCSI revision: 05 Host: scsi1 Channel: 01 Id: 00 Lun: 01 Vendor: HPE Model: LOGICAL VOLUME Rev: 1.99 Type: Direct-Access ANSI SCSI revision: 05 Host: scsi1 Channel: 02 Id: 00 Lun: 00 Vendor: HPE Model: P408i-a SR Gen10 Rev: 1.99 Type: RAID ANSI SCSI revision: 05 check status $ lsblk $ pvs $ lvs $ vgs $ pvscan $ lvscan $ pvdisplay $ vgdisplay $ lvdisplay $ fdisk -l $ sfdisk -l -uM $ lshw -class disk $ hwinfo --block --short $ cat /proc/partitions $ sudo hdparm -I /dev/sda network get network cards $ sudo lshw -short -class network H/W path Device Class Description ============================================================ /0/100/1/0 enp1s0f0 network I350 Gigabit Network Connection /0/100/1/0.1 enp1s0f1 network I350 Gigabit Network Connection /0/100/1.1/0 enp2s0f0 network Ethernet Controller X710 for 10GbE SFP+ /0/100/1.1/0.1 enp2s0f1 network Ethernet Controller X710 for 10GbE SFP+ /0/2/0 enp131s0f0 network Ethernet Controller 10-Gigabit X540-AT2 /0/2/0.1 enp131s0f1 network Ethernet Controller 10-Gigabit X540-AT2 /3 veth8c9c4570 network Ethernet interface /4 flannel.1 network Ethernet interface /5 veth8d141a78 network Ethernet interface /6 veth3cc4bf19 network Ethernet interface /7 cni0 network Ethernet interface /8 docker0 network Ethernet interface /9 veth179b5dab network Ethernet interface network speed $ ifstat -n -i en7 en7 KB/s in KB/s out 7.35 1.15 4.91 1.02 6.05 0.80 8.36 1.78 get the public ip address $ curl ifconfig.me environment variables show PATH $ echo src::${PATH} | awk 'BEGIN{pwd=ENVIRON[\"PWD\"];RS=\":\";FS=\"\\n\"}!$1{$1=pwd}$1!~/^\\//{$1=pwd\"/\"$1}{print $1}' /home/marslo/src /home/marslo /home/marslo/.vim/tools/bin /usr/local/mysql/bin /usr/local/bcompare/bin /usr/lib/lightdm/lightdm /usr/local/sbin /usr/local/bin /usr/sbin /usr/bin /sbin /bin /usr/games /usr/local/games OR $ echo \"${PATH//:/$'\\n'}\" get system info references: Shell script to check top memory & cpu consuming process in Linux top batch mode [!TIP] references: top -n1 d2 How to Save Top Command Output to a File $ top -bn1 # or $ top -n 1 d 2 get only summary of top command $ top -bn1 | sed -n '/^top.*/,/^\\s*$/p' ## or $ top -bn1 | sed -e '/^$/Q' ps [!TIP] references: Command to check top CPU consuming process cpu $ ps -eocomm,pcpu | egrep -v '(0.0)|(%CPU)' systemd 0.2 rcu_sched 0.2 sshd 0.5 java 8.2 java 0.6 dockerd 16.1 docker-containe 0.6 ... memory $ ps -eocomm,pmem | egrep -v '(0.0)|(%MEM)' java 0.1 java 0.1 java 0.8 gvfs-udisks2-vo 0.1 kube-apiserver 0.1 set system info clear duplicated PATH $ export PATH=`echo -n $PATH | awk -v RS=\":\" '{ if (!x[$0]++) {printf s $0; s=\":\"} }'` LS_COLORS [!NOTE|label:references:] benoit-pierre/ls_colors.py pattern name comments bd device block device ca - cap cd device char device cl - clear end of line di directory directory do - Solaris door ec - end color, unused ex executable executable fi file file fl - file, default lc - left, unused ln link symlink mh - multi hardlink mi - missing file no - normal or orphan orphaned symlink ow - other-writable pi fifo pipe rc - right, unused rs - reset sg - setgid so socket socket st - sticky su - setuid tw - ow with sticky sharkdp/vivid How can I list LS_COLORS in colour? What causes this green background in ls output? Configuring LS_COLORS trapd00r/LS_COLORS show database $ dircolors --print-database $ which -a dircolors /usr/local/opt/coreutils/libexec/gnubin/dircolors $ echo $COLORTERM truecolor $ echo $TERM xterm-256color show current settings ( # Run in a subshell so it won't crash current color settings dircolors -b >/dev/null IFS=: for ls_color in ${LS_COLORS[@]}; do # For all colors color=${ls_color##*=} ext=${ls_color%%=*} echo -en \"\\E[${color}m${ext}\\E[0m \" # echo color and extension done echo ) or Script to show colors declare -A descriptions=( [bd]=\"block device\" [ca]=\"file with capability\" [cd]=\"character device\" [di]=\"directory\" [do]=\"door\" [ex]=\"executable file\" [fi]=\"regular file\" [ln]=\"symbolic link\" [mh]=\"multi-hardlink\" [mi]=\"missing file\" [no]=\"normal non-filename text\" [or]=\"orphan symlink\" [ow]=\"other-writable directory\" [pi]=\"named pipe, AKA FIFO\" [rs]=\"reset to no color\" [sg]=\"set-group-ID\" [so]=\"socket\" [st]=\"sticky directory\" [su]=\"set-user-ID\" [tw]=\"sticky and other-writable directory\" ) IFS=: for ls_color in $LS_COLORS; do color=\"${ls_color#*=}\" type=\"${ls_color%=*}\" # Add description for named types. desc=\"${descriptions[$type]}\" # Separate each color with a newline. if [[ $color_prev ]] && [[ $color != \"$color_prev\" ]]; then echo fi printf \"\\e[%sm%s%s\\e[m \" \"$color\" \"$type\" \"${desc:+ ($desc)}\" # For next loop color_prev=\"$color\" done echo settings $ cat ~/.bashrc LS_COLORS='bd=38;5;68:ca=38;5;17:cd=38;5;113;1:di=38;5;108:do=38;5;127:ex=38;5;31;1:pi=38;5;126:fi=0:ln=target:mh=38;5;222;1:no=0:or=48;5;196;38;5;232;1:ow=38;5;220;1:sg=48;5;3;38;5;0:su=38;5;220;1;3;100;1:so=38;5;197:st=38;5;86;48;5;234:tw=48;5;235;38;5;139;3:' LS_COLORS+='*.7z=38;5;64:*.WARC=38;5;64:*.a=38;5;64:*.arj=38;5;64:*.br=38;5;64:*.bz2=38;5;64:*.cpio=38;5;64:*.gz=38;5;64:*.lrz=38;5;64:*.lz=38;5;64:*.lzma=38;5;64:*.lzo=38;5;64:*.rar=38;5;64:*.s7z=38;5;64:*.sz=38;5;64:*.tar=38;5;64:*.tbz=38;5;64:*.tgz=38;5;64:*.warc=38;5;64:*.xz=38;5;64:*.z=38;5;64:*.zip=38;5;64:*.zipx=38;5;64:*.zoo=38;5;64:*.zpaq=38;5;64:*.zst=38;5;64:*.zstd=38;5;64:*.zz=38;5;64:*@.service=38;5;45:' LS_COLORS+='*.pub=1;3:*.1p=38;5;7:*.32x=38;5;213:*.3g2=38;5;115:*.3ga=38;5;137;1:*.3gp=38;5;115:*.3p=38;5;7:*.82p=38;5;121:*.83p=38;5;121:*.8eu=38;5;121:*.8xe=38;5;121:*.8xp=38;5;121:*.A64=38;5;213:*.BUP=38;5;241:*.CFUserTextEncoding=38;5;239:*.F=38;5;81:*.F03=38;5;81:*.F08=38;5;81:*.F90=38;5;81:*.F95=38;5;81:*.IFO=38;5;114:*.M=38;5;110:*.PDF=38;5;141:*.PFA=38;5;66:*.PL=38;5;160:*.RData=38;5;178:*.Rproj=38;5;11:*.S=38;5;110:*.S3M=38;5;137;1:*.SKIP=38;5;244:*.TIFF=38;5;97:*.VOB=38;5;115;1:*.a00=38;5;213:*.a52=38;5;213:*.a64=38;5;213:*.a78=38;5;213:*.aac=38;5;137;1:*.accdb=38;5;60:*.accde=38;5;60:*.accdr=38;5;60:*.accdt=38;5;60:*.adf=38;5;213:*.adoc=38;5;184:*.afm=38;5;66:*.agda=38;5;81:*.agdai=38;5;110:*.ai=38;5;99:*.aiff=38;5;136;1:*.alac=38;5;136;1:*.allow=38;5;112:*.am=38;5;242:*.amr=38;5;137;1:*.application=38;5;116:*.aria2=38;5;241:*.asciidoc=38;5;184:*.asf=38;5;115:*.asm=38;5;81:*.ass=38;5;117:*.astro=38;5;135;1:*.atr=38;5;213:*.au=38;5;137;1:*.automount=38;5;45:*.bib=38;5;178:*.bsp=38;5;215:*.cab=38;5;215:*.caf=38;5;137;1:*.cap=38;5;29:*.car=38;5;57:*.cbr=38;5;141:*.cbz=38;5;141:*.cda=38;5;136;1:*.cdi=38;5;213:*.cdr=38;5;97:*.chm=38;5;141:*.cjs=38;5;074;1:*.cl=38;5;81:*.clj=38;5;41:*.cljc=38;5;41:*.cljs=38;5;41:*.cljw=38;5;41:*.cnc=38;5;7:*.coffee=38;5;079;1:*.comp=38;5;136:*.containerignore=38;5;264:*.cp=38;5;75:*.cr=38;5;81:*.crx=38;5;215:*.cs=38;5;81:*.csv=38;5;78:*.ctp=38;5;81:*.cue=38;5;116:*.dart=38;5;51:*.dat=38;5;137;1:*.db=38;5;60:*.def=38;5;7:*.deny=38;5;196:*.description=38;5;116:*.device=38;5;45:*.dhall=38;5;178:*.dicom=38;5;97:*.diff=48;5;197;38;5;232:*.directory=38;5;116:*.divx=38;5;114:*.djvu=38;5;141:*.dmp=38;5;29:*.doc=38;5;111:*.dockerignore=38;5;264:*.docm=38;5;111;4:*.docx=38;5;111:*.drw=38;5;99:*.dtd=38;5;178:*.dts=38;5;137;1:*.dwg=38;5;216:*.dylib=38;5;241:*.ear=38;5;215:*.ejs=38;5;135;1:*.el=38;5;81:*.elc=38;5;241:*.eln=38;5;241:*.eml=38;5;90;1:*.entitlements=1:*.epf=1:*.eps=38;5;99:*.epsf=38;5;99:*.epub=38;5;141:*.err=38;5;160;1:*.error=38;5;160;1:*.etx=38;5;184:*.ex=38;5;7:*.example=38;5;7:*.f=38;5;81:*.f03=38;5;81:*.f08=38;5;81:*.f4v=38;5;115:*.f90=38;5;81:*.f95=38;5;81:*.fcm=38;5;137;1:*.feature=38;5;7:*.flac=38;5;136;1:*.flif=38;5;97:*.flv=38;5;115:*.fm2=38;5;213:*.fmp12=38;5;60:*.fnt=38;5;66:*.fon=38;5;66:*.for=38;5;81:*.fp7=38;5;60:*.frag=38;5;136:*.ftn=38;5;81:*.fvd=38;5;124:*.fxml=38;5;178:*.gb=38;5;213:*.gba=38;5;213:*.gbc=38;5;213:*.gbr=38;5;7:*.gel=38;5;213:*.gemspec=38;5;41:*.ger=38;5;7:*.gg=38;5;213:*.ggl=38;5;213:*.gp3=38;5;115:*.gp4=38;5;115:*.gs=38;5;81:*.hi=38;5;110:*.hidden-color-scheme=1:*.hidden-tmTheme=1:*.hin=38;5;242:*.hjson=38;5;178:*.hpp=38;5;110:*.hs=38;5;81:*.htm=38;5;125;1:*.http=38;5;90;1:*.hxx=38;5;110:*.ii=38;5;110:*.iml=38;5;166:*.in=38;5;242:*.info=38;5;184:*.ini=1:*.ipa=38;5;215:*.ipk=38;5;213:*.ipynb=38;5;41:*.j64=38;5;213:*.jad=38;5;215:*.jhtm=38;5;125;1:*.jsm=38;5;079;1:*.jsonc=38;5;178:*.jsonl=38;5;178:*.jsonnet=38;5;178:*.jsp=38;5;079;1:*.jsx=38;5;074;1:*.jxl=38;5;97:*.kak=38;5;172:*.key=38;5;166:*.lagda=38;5;81:*.lagda.rst=38;5;81:*.lagda.tex=38;5;81:*.last-run=1:*.lhs=38;5;81:*.libsonnet=38;5;142:*.lisp=38;5;81:*.lnk=38;5;97:*.localized=38;5;239:*.localstorage=38;5;60:*.m=38;5;110:*.m2v=38;5;114:*.m3u=38;5;116:*.m3u8=38;5;116:*.m4=38;5;242:*.m4a=38;5;137;1:*.m4v=38;5;114:*.map=38;5;7:*.md5=38;5;116:*.mdb=38;5;60:*.mde=38;5;60:*.mdump=38;5;241:*.mdx=38;5;184:*.merged-ca-bundle=1:*.mf=38;5;7:*.mfasl=38;5;7:*.mht=38;5;125;1:*.mi=38;5;7:*.mid=38;5;136;1:*.midi=38;5;136;1:*.mjs=38;5;074;1:*.mkd=38;5;184:*.mkv=38;5;114:*.ml=38;5;81:*.mm=38;5;7:*.mobi=38;5;141:*.mod=38;5;137;1:*.moon=38;5;81:*.mount=38;5;45:*.mpg=38;5;114:*.msg=38;5;178:*.mtx=38;5;7:*.mustache=38;5;135;1:*.mysql=38;5;222:*.nc=38;5;60:*.ndjson=38;5;178:*.nds=38;5;213:*.nes=38;5;213:*.nfo=38;5;184:*.nib=38;5;57:*.nim=38;5;81:*.nimble=38;5;81:*.nix=38;5;155:*.norg=38;5;184:*.nrg=38;5;124:*.nth=38;5;97:*.numbers=38;5;112:*.o=38;5;241:*.odb=38;5;111:*.odp=38;5;166:*.ods=38;5;112:*.odt=38;5;111:*.oga=38;5;137;1:*.ogg=38;5;137;1:*.ogm=38;5;114:*.ogv=38;5;115:*.opus=38;5;137;1:*.otf=38;5;66:*.pacnew=38;5;33:*.pages=38;5;111:*.pak=38;5;215:*.part=38;5;239:*.patch=48;5;197;38;5;232;1:*.path=38;5;45:*.pbxproj=1:*.pc=38;5;7:*.pcap=38;5;29:*.pcb=38;5;7:*.pcf=1:*.pcm=38;5;136;1:*.pdf=38;5;141:*.pfa=38;5;66:*.pfb=38;5;66:*.pfm=38;5;66:*.pgn=38;5;178:*.pgsql=38;5;222:*.pi=38;5;7:*.pid=38;5;248:*.pk3=38;5;215:*.pl=38;5;208:*.plist=1:*.plt=38;5;7:*.ply=38;5;216:*.pm=38;5;203:*.png=38;5;97:*.pod=38;5;184:*.pot=38;5;7:*.pps=38;5;166:*.ppt=38;5;166:*.ppts=38;5;166:*.pptsm=38;5;166;4:*.pptx=38;5;166:*.pptxm=38;5;166;4:*.prisma=38;5;222:*.properties=38;5;116:*.prql=38;5;222:*.ps=38;5;99:*.psd=38;5;97:*.psf=1:*.pug=38;5;135;1:*.pxd=38;5;97:*.pxm=38;5;97:*.qcow=38;5;124:*.rdata=38;5;178:*.rdf=38;5;7:*.rkt=38;5;81:*.rlib=38;5;241:*.rmvb=38;5;114:*.rnc=38;5;178:*.rng=38;5;178:*.rom=38;5;213:*.rss=38;5;178:*.rst=38;5;184:*.rstheme=1:*.rtf=38;5;111:*.s3m=38;5;137;1:*.sample=38;5;114:*.sc=38;5;41:*.scan=38;5;242:*.sch=38;5;7:*.scm=38;5;7:*.scpt=38;5;219:*.scss=38;5;105;1:*.sed=38;5;172:*.service=38;5;45:*.sfv=38;5;116:*.sgml=38;5;178:*.sid=38;5;137;1:*.sis=38;5;7:*.sms=38;5;213:*.socket=38;5;45:*.sparseimage=38;5;124:*.spl=38;5;7:*.spv=38;5;217:*.srt=38;5;117:*.ssa=38;5;117:*.st=38;5;213:*.stackdump=38;5;241:*.state=38;5;248:*.stderr=38;5;160;1:*.stl=38;5;216:*.storyboard=38;5;196:*.strings=1:*.sty=38;5;7:*.sub=38;5;117:*.sublime-*=1:*.sug=38;5;7:*.sup=38;5;117:*.svelte=38;5;135;1:*.svg=38;5;99:*.swo=38;5;244:*.sx=38;5;81:*.target=38;5;45:*.tdy=38;5;7:*.tfnt=38;5;7:*.tfstate=38;5;168:*.tfvars=38;5;168:*.tg=38;5;7:*.theme=38;5;116:*.tif=38;5;97:*.tiff=38;5;97:*.timer=38;5;45:*.tmTheme=1:*.toast=38;5;124:*.tsv=38;5;78:*.tsx=38;5;074;1:*.ttf=38;5;66:*.twig=38;5;81:*.typelib=38;5;60:*.urlview=38;5;116:*.user-ca-bundle=1:*.v=38;5;81:*.vala=38;5;81:*.vapi=38;5;81:*.vcard=38;5;7:*.vcd=38;5;124:*.vcf=38;5;7:*.vdf=38;5;215:*.vdi=38;5;124:*.vert=38;5;136:*.vfd=38;5;124:*.vhd=38;5;124:*.vhdx=38;5;124:*.vmdk=38;5;124:*.vob=38;5;115;1:*.vpk=38;5;215:*.vtt=38;5;117:*.vue=38;5;135;1:*.wav=38;5;136;1:*.webloc=38;5;116:*.webm=38;5;115:*.webp=38;5;97:*.wgsl=38;5;97:*.woff=38;5;66:*.woff2=38;5;66:*.wrl=38;5;216:*.wv=38;5;136;1:*.wvc=38;5;136;1:*.xcf=38;5;7:*.xcsettings=1:*.xcuserstate=1:*.xcworkspacedata=1:*.xib=38;5;208:*.xla=38;5;76:*.xln=38;5;7:*.xls=38;5;112:*.xlsx=38;5;112:*.xlsxm=38;5;112;4:*.xltm=38;5;73;4:*.xltx=38;5;73:*.xpi=38;5;215:*.xpm=38;5;97:*.xsd=38;5;178:*.xsh=38;5;41:*.z[0-9]{0,2}=38;5;239:*.zcompdump=38;5;241:*.zig=38;5;81:*.zwc=38;5;241:*.zx[0-9]{0,2}=38;5;239:' # encrypted files LS_COLORS+='*.enc=38;5;69;3:*.gpg=38;5;69;3:*.p12=38;5;69;3:*.p7s=38;5;69;3:*.pem=38;5;69;3:*.pgp=38;5;69;3:*.sig=38;5;69;3:*.signature=38;5;69;3:*.asc=38;5;69;3:*.bfe=38;5;69;3:*.current=38;5;69;3:' # packages LS_COLORS+='*.apk=38;5;215:*.deb=38;5;215:*.dll=38;5;241:*.dmg=38;5;215:*.rpm=38;5;215:*.war=38;5;215:*.bin=38;5;124:*.iso=38;5;124:*.jar=38;5;215:*.out=38;5;242:' # dump/log LS_COLORS+='*.bak=38;5;241:*.dump=38;5;241:*.snapshot=38;5;45:*.swap=38;5;45:*.swp=38;5;244:*.tmp=38;5;244:*.viminfo=1;3:*.DS_Store=38;5;239:*.old=38;5;242:*.org=38;5;184:*.orig=38;5;241:*.sav=38;5;213:*.log=38;5;190:*.un~=38;5;241:' # audio/video LS_COLORS+='*.wma=38;5;137;1:*.wmv=38;5;114:*.JPG=38;5;97:*.MOV=38;5;114:*.ape=38;5;136;1:*.avi=38;5;114:*.bmp=38;5;97:*.gif=38;5;97:*.icns=38;5;97:*.ico=38;5;97:*.ics=38;5;7:*.img=38;5;124:*.jpeg=38;5;97:*.jpg=38;5;97:*.mov=38;5;114:*.mp3=38;5;137;1:*.mp4=38;5;114:*.mp4a=38;5;137;1:*.mpeg=38;5;114:*.torrent=38;5;116:*.ts=38;5;074;1:' # docs LS_COLORS+='*AUTHORS=38;5;172;1:*CHANGELOG=38;5;172;1:*CHANGES=38;5;172;1:*CODEOWNERS=38;5;172;1:*CONTRIBUTING=38;5;172;1:*CONTRIBUTORS=38;5;172;1:*COPYING=38;5;172;1:*COPYRIGHT=38;5;172;1:*CodeResources=38;5;239:*Containerfile=38;5;143:*INSTALL=38;5;220;1:*LICENSE=38;5;220;1:*LS_COLORS=48;5;89;38;5;197;1;3;4;7:*MANIFEST=38;5;243:*[Mm]akefile=38;5;143:*NOTICE=38;5;220;1:*PATENTS=38;5;220;1:*PkgInfo=38;5;239:*README.rst=38;5;172;1:*VERSION=38;5;172;1:*authorized_keys=1;3:*core=38;5;241:*config=1;3:*lock=38;5;248:*lockfile=38;5;248:*pm_to_blib=38;5;264:' # git LS_COLORS+='*.git=38;5;133;3:*.gitattributes=38;5;133;3:*.gitignore_global=38;5;133;3:*.gitignore=38;5;133;3:*.github=38;5;133:*.gitmodules=38;5;198;3:' # system rc LS_COLORS+='*history=1;3:*rc=38;5;66;3:*.profile=1;3:*.bash_login=1;3:*.bash_logout=1;3:*.bash_profile=1;3:*.zlogin=1;3:*.zlogout=1;3:*.zprofile=1;3:*.zshenv=1;3:*id_dsa=38;5;192;3:*id_ecdsa=38;5;192;3:*id_ed25519=38;5;192;3:*id_rsa=38;5;192;3:*known_hosts=1;3:*known_hosts.old*=1;3:*cfg=1;3:*conf=1;3:*.fdignore=38;5;133;3:*.rgignore=38;5;133;3:' # program/script LS_COLORS+='*.bat=38;5;134:*.BAT=38;5;134:*.sh=38;5;134:*.bash=38;5;134:*.fish=38;5;134:*.zsh=38;5;134:*.py=38;5;99:*.pyc=38;5;105:*.go=38;5;81:*.h=38;5;110:*.h++=38;5;110:*.c=38;5;75:*.cc=38;5;75:*.c++=38;5;75:*.cpp=38;5;75:*.cxx=38;5;81:*.tcc=38;5;110:*.r=38;5;49:*.r[0-9]{0,2}=38;5;239:*.rake=38;5;155:*.rb=38;5;41:*.ahk=38;5;41:*.awk=38;5;134:*.less=38;5;105;1:*.css=38;5;105;1:*.html=38;5;125;1:*.java=38;5;079;1:*.json=38;5;178:*.json5=38;5;178:*.markdown=38;5;134:*.md=38;5;134:*.msql=38;5;222:*.php=38;5;81:*.sass=38;5;105;1:*.sassc=38;5;244:*.swift=38;5;219:*.tcl=38;5;64;1:*.txt=38;5;253:*.vim=38;5;134:*.xml=38;5;178:*.yaml=38;5;178:*.yml=38;5;178:*.vb=38;5;81:*.vba=38;5;81:*.vbs=38;5;81:*.R=38;5;49:*.js=38;5;074;1:*.lua=38;5;81:*.rs=38;5;81:*.ru=38;5;7:*.s=38;5;110:*.scala=38;5;41:*.sql=38;5;222:*.sqlite=38;5;60:*.t=38;5;114:*.tex=38;5;184:*.textile=38;5;184:*.tf=38;5;168:*.tfm=38;5;7:*.toml=38;5;178:*[Dd]ockerfile=38;5;143:' export LS_COLORS way to verify # i.e.: LS_COLORS='bd=38;5;68:ca=38;5;17:cd=38;5;113;1:di=38;5;108:do=38;5;127:ex=38;5;31;1:pi=38;5;126:fi=0:ln=target:mh=38;5;222;1:no=0:or=48;5;196;38;5;232;1:ow=38;5;220;1:sg=48;5;3;38;5;0:su=38;5;220;1;3;100;1:so=38;5;197:st=38;5;86;48;5;234:tw=48;5;235;38;5;139;3:' # check via $ echo -e \"\"\" \\033[38;5;68m bd= \\033[0m \\033[38;5;17m ca= \\033[0m \\033[38;5;113;1m cd= \\033[0m \\033[38;5;108m di= \\033[0m \\033[38;5;127m do= \\033[0m \\033[38;5;31;1m ex= \\033[0m \\033[38;5;126m pi= \\033[0m \\033[38;5;222;1m mh= \\033[0m \\033[48;5;196;38;5;232;1m or= \\033[0m \\033[38;5;220;1m ow= \\033[0m \\033[48;5;3;38;5;0m sg= \\033[0m \\033[38;5;220;1;3;100;1m su= \\033[0m \\033[38;5;197m so= \\033[0m \\033[38;5;86;48;5;234m st= \\033[0m \\033[48;5;235;38;5;139;3m tw= \\033[0m \"\"\" set dns for ubuntu $ cat /etc/resolv.conf # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8) # DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN nameserver 8.8.8.8 nameserver 8.8.4.4 nameserver 127.0.1.1 $ cat /etc/resolvconf/resolv.conf.d/head # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8) # DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN nameserver 8.8.8.8 nameserver 8.8.4.4 $ sudo resolvconf -u # or $ cat /etc/dhcp/dhclient.conf | grep \"prepend domain-name-servers\" prepend domain-name-servers 8.8.8.8, 8.8.4.4; # or $ cat /etc/network/interfaces | grep dns dns-nameservers 8.8.8.8 8.8.4.4 disable firewall $ sudo systemctl stop firewalld $ sudo systemctl disable firewalld $ sudo systemctl mask firewalld check result$ sudo systemctl is-enabled firewalld $ sudo systemctl is-active firewalld $ sudo firewall-cmd --state change net.bridge $ sudo modprobe br_netfilter $ sudo sysctl net.bridge.bridge-nf-call-iptables=1 $ sudo sysctl net.bridge.bridge-nf-call-ip6tables=1 # or $ sudo bash -c \"cat > /etc/sysctl.d/k8s.conf\" check status$ sudo sysctl --system off swap $ sudo swapoff -a $ sudo bash -c \"/usr/bin/sed -e 's:^\\\\(.*swap.*\\\\)$:# \\\\1:' -i /etc/fstab\" disable selinux $ setenforce 0 $ sudo bash -c \"/usr/bin/sed 's/^SELINUX=enforcing$/SELINUX=permissive/' -i /etc/selinux/config\" confined and unconfined users references: SELinux笔记 SELinux/Users and logins installation $ yum -y install setools-console setup for exiting account $ semanage login -a -s staff_u # or $ semanage login -a -s staff_u -r s0-s0:c0.c100 Modifying an existing mapping $ semanage login -m -s sysadm_u delete a mapping $ semanage login -d list mappings $ semanage user -l process find the zombie process $ ps aux | awk '{ print $8 \" \" $2 \" \" $11}' | grep -w Z sort process by PID $ ps -axww check the group PID $ ps -xj about whatis $ whatis whois whois (1) - client for the whois directory service $ whatis which which (1) - locate a command $ whatis whereis whereis (1) - locate the binary, source, and manual page files for a command user management sssd to use LDAP references: sssd understanding sssd and its benefits sssd client-side view Configuring an LDAP Client to use SSSD /etc/sssd/sssd.conf sample Troubleshooting SSSD Linux user authentication with SSSD / LDAP man sss_override Setting Password Expiry How To Clear The SSSD Cache In Linux rhel Chapter 7. Configuring SSSD 7.5. Configuring System Services for SSSD 7.5.2. Configuring Services: PAM 7.6. SSSD Client-side Views 13.2. Using and Caching Credentials with SSSD 13.2.2. Setting up the sssd.conf File 13.2.23. Creating Domains: Primary Server and Backup Servers 13.2.22. Creating Domains: Access Control 13.2.28. Managing the SSSD Cache pam Quickstart: Joining a Linux VM to a domain additional configuration for identity and authentication providers Editing the /etc/pam.d files on Red Hat Enterprise Linux Server 2.2. PAM Configuration Files check user $ sudo sssctl user-checks user: marslo action: acct service: system-auth SSSD nss user lookup result: - user name: marslo - user id: 33637 - group id: 40048 - gecos: Marslo Jiao (Marslo Jiao) - home directory: /home/marslo - shell: /bin/bash InfoPipe operation failed. Check that SSSD is running and the InfoPipe responder is enabled. Make sure 'ifp' is listed in the 'services' option in sssd.conf.InfoPipe User lookup with [marslo] failed. testing pam_acct_mgmt pam_acct_mgmt: Success PAM Environment: - no env - # or $ getent passwd -s sss marslo add user name $ sudo /usr/sbin/sss_override user-add -n secondary-username # verification $ id secondary-username # display the override $ sudo /usr/sbin/sss_override user-show user-name override the uid # check current uid $ id -u # overwride $ sudo /usr/sbin/sss_override user-add -u $ sudo /usr/sbin/sss_cache --users # or $ sudo /usr/sbin/sss_cache --user $ sudo systemctl restart sssd override the gid # check current gid $ id -g # or $ id -nG # or $ sudo lid -g # override $ sudo /usr/sbin/sss_override user-add -g $ sudo /usr/sbin/sss_cache --users $ sudo /usr/sbin/sss_cache --user $ sudo systemctl restart sssd override the home directory # check current home directory $ getent passwd # override $ sudo /usr/sbin/sss_override user-add -h /new/home/directory $ sudo systemctl restart sssd override the shell attribute # check current $ getent passwd # override $ sudo /usr/sbin/sss_override user-add -s /new/shell $ sudo systemctl restart sssd managing the sssd cache # clear the cache and update all records $ sudo /usr/sbin/sss_cache [-E|--everything] # clear invalidates cache entries for all user records $ sudo /usr/sbin/sss_cache [-U|--users] # clear all cached entries for a particular domain $ sudo /usr/sbin/sss_cache [-E|--everything] [-d|--domain] # purge the records for that specific account and leave the rest of the cache intact $ sudo /usr/sbin/sss_cache [-u|--user] # invalidates the cache entry for the specified group $ sudo /usr/sbin/sss_cache [-g|--group] remove account references: How do you cleanup after deleting an LDAP user on RHEL 7? $ sudo sss_override user-del [--debug 1..9] $ sudo /usr/sbin/sss_cache --everything $ sudo systemctl restart sssd or # get info $ loginctl # logout $ loginctl kill-user $ sudo /usr/sbin/sss_cache -u $ loginctl terminate-user $ sudo pkill -u $ systemctl restart sssd $ systemctl restart accounts-daemon backup and restore # export $ /usr/sbin/sss_override user-export user-export.bak $ /usr/sbin/sss_override group-export group-export.bak # restore $ /usr/sbin/sss_override user-import user-import.bak $ /usr/sbin/sss_override group-import group-import.bak list all override $ /usr/sbin/sss_override user-find create sssd config After this in /etc/sssd/sssd.conf file Specify ldap_default_bind_dn and ldap_default_authtok as default bind dn and password respectively, this depends upon your ldap setup. references: Chapter 13. Configuring Authentication # optional $ yum install -y sssd \\ realmd \\ oddjob \\ oddjob-mkhomedir \\ adcli \\ samba-common \\ samba-common-tools \\ krb5-workstation \\ openldap-clients \\ policycoreutils-python \\ authselect-compat \\ ntpdate \\ ntp $ authselect select sssd $ authselect select sssd with-mkhomedir $ systemctl enable oddjobd.service $ systemctl start oddjobd.service $ authconfig --enablesssd \\ --enablesssdauth \\ --enablelocauthorize \\ --enableldap \\ --enableldapauth \\ --ldapserver=ldap://ipaserver.example.com:389 \\ --disableldaptls \\ --ldapbasedn=dc=example,dc=com \\ --enablerfc2307bis \\ --enablemkhomedir \\ --enablecachecreds \\ --update others references: 2.2. PAM Configuration Files Chapter 4. Hardening Your System with Tools and Services 21.2.2. Mounting NFS File Systems using autofs 13.2.28. Managing the SSSD Cache config files file comments /etc/krb5.keytab host keytab file /etc/nsswitch.conf Name Service Switch (NSS) configuration file /etc/sssd/sssd.conf sssd configure file /etc/auto.master mount NFS /etc/auto.misc automount utility can mount and unmount NFS /etc/pam.d/password-auth PAM module /etc/pam.d/system-auth PAM module /var/lib/sss/db/* sssd cache /etc/security/access.conf local login access control table discovery domain $ realm discover my.com [--server-software=active-directory] my.com type: kerberos realm-name: MY.COM domain-name: my.com configured: no server-software: active-directory client-software: sssd required-package: oddjob required-package: oddjob-mkhomedir required-package: sssd required-package: adcli required-package: samba-common-tools join the system $ realm join -U [--membership-software=samba] [--verbose] [--install] local user subuid & subgid [!NOTE] references: Podman # rootless mode $ sudo usermod --add-subuids 10000-75535 USERNAME $ sudo usermod --add-subgids 10000-75535 USERNAME # or $ echo USERNAME:10000:65536 >> /etc/subuid $ echo USERNAME:10000:65536 >> /etc/subgid references: how to list users and groups on linux How to Create Groups in Linux (groupadd Command) understanding /etc/shadow file format on linux understanding the /etc/shadow file linux: instructions on using commands about user and group on linux find users /etc/passwd /etc/shadow /etc/pam.d/passwd more on users /etc/login.defs useradd create user devops $ useradd -c \"comments here\" \\ -m \\ -d \"/home/devops\" \\ -u 1000 \\ -g 1000 \\ -s /bin/bash \\ devops or $ useradd --comment \"comments here\" \\ --create-home \\ --home-dir /home/devops \\ --shell /bin/bash \\ --uid 1000 \\ --gid 1000 \\ --user-group devops devops full steps $ uid='1000' $ gid='1000' $ user='devops' $ mkdir -p /home/${user} $ chown -R ${uid}:${gid} /home/${user} $ groupadd -g ${gid} ${user} $ useradd -c \"create user ${user}\" \\ -d \"/home/${user}\" \\ -u ${uid} \\ -g ${gid} \\ -m \\ -s /bin/bash \\ ${user} deluser for ubunut deluser, delgroup - remove a user or group from the system SYNOPSIS deluser [options] [--force] [--remove-home] [--remove-all-files] [--backup] [--backup-to DIR] user deluser --group [options] group delgroup [options] [--only-if-empty] group deluser [options] user group $ deluser local group /etc/group /etc/passwd /etc/shadow references: Linux groupadd command list all groups $ getent group get gid $ sudo lid -g create group with random gid $ sudo groupadd get available gid for error: groupadd: GID 'xxxx' already exists $ gname='mytestgroup' $ sudo groupadd ${gname} $ getent group ${gname} | cut -d: -f3 # or $ sed -nr \"s/^${gname}:x:([0-9]+):.*/\\1/p\" /etc/group # or $ grep \"^${gname}\" /etc/group | cut -d: -f3 # and finally remove the group $ sudo groupdel ${gname} create group with particular gid $ sudo groupadd -g create group with existing gid [!TIP] -o (--non-unique) option the groupadd command allows you to create a group with non-unique GID troubleshooting issue:/usr/bin/id: cannot find name for group ID xxxx solution$ groupadd --gid $ sudo groupadd -o -g create group with password $ groupadd -p secretpassword writers add system group [!NOTE|label:-r or --system] $ groupadd -r hardwareteam $ groupadd --system hardwareteam modify gid $ sudo groupmod -o -g add user into group $ sudo usermod -a -G adm,root,docker,wheel devops $ sudo usermod -a -G sudo devops remove user from group How to Add or Remove a User from a Group in Linux $ gpasswd -d logout $ pkill -KILL -u ${useranme} or $ who -uH NAME LINE TIME IDLE PID COMMENT devops pts/0 2022-06-14 05:44 00:17 41455 (192.168.1.1) marslo pts/1 2022-06-14 05:58 . 50162 (192.168.1.1) $ sudo kill 41455 $ who -uH NAME LINE TIME IDLE PID COMMENT marslo pts/1 2022-06-14 05:58 . 50162 (192.168.1.1) or : loginctl # get login details $ loginctl # logout $ loginctl kill-user others view users password properties in linux $ chage -l marslo Last password change : Mar 09, 2022 Password expires : never Password inactive : never Account expires : never Minimum number of days between password change : 0 Maximum number of days between password change : 99999 Number of days of warning before password expires : 7 hash_algorithm Code Algorithm $1 MD5 hashing algorithm $2 Blowfish Algorithm $3 Eksblowfish Algorithm $4 NT hashing algorithm $5 SHA-256 Algorithm $6 SHA-512 Algorithm service enable/disable service $ sudo systemctl enable --now kubelet Created symlink /etc/systemd/system/multi-user.target.wants/kubelet.service → /etc/systemd/system/kubelet.service $ sudo systemctl disable --now docker check service enable or not $ sudo systemctl is-enabled firewalld $ sudo systemctl is-active firewalld or$ sudo firewall-cmd --state not running start/stop service $ sudo system start $ sudo system stop check log $ journalctl -u docker -f system encoding references: Locale setting variables How to Change or Set System Locales in Linux /etc/default/locale – on Ubuntu/Debian /etc/locale.conf – on CentOS/RHEL Unicode characters in console logs do not print correctly in Workflow builds Locale How to set up a clean UTF-8 environment in Linux \"Locale\" issue on Linux CentOS & RHEL Chapter 43. Using langpacks How to add additional language support in CentOS/RHEL important files: /etc/default/locale /etc/locale.gen /etc/environment /usr/share/locales /var/lib/locales/supported.d/local /usr/local/share/i18n/SUPPORTED /usr/share/i18n/SUPPORTED setup via environment $ sudo bash -c 'cat >> /etc/bash.bashrc' check locale for account $ sudo su -l -c locale # i.e.: $ sudo su -l -c locale marslo LANG=en_US.UTF-8 LC_CTYPE=\"en_US.UTF-8\" LC_NUMERIC=\"en_US.UTF-8\" LC_TIME=\"en_US.UTF-8\" LC_COLLATE=\"en_US.UTF-8\" LC_MONETARY=\"en_US.UTF-8\" LC_MESSAGES=\"en_US.UTF-8\" LC_PAPER=\"en_US.UTF-8\" LC_NAME=\"en_US.UTF-8\" LC_ADDRESS=\"en_US.UTF-8\" LC_TELEPHONE=\"en_US.UTF-8\" LC_MEASUREMENT=\"en_US.UTF-8\" LC_IDENTIFICATION=\"en_US.UTF-8\" LC_ALL=en_US.UTF-8 setup via locale command $ apt-get install -y locales $ sudo locale-gen en_US.UTF-8 $ sudo update-locale LANG=en_US.UTF-8 $ source /etc/default/locale # or $ sudo dpkg-reconfigure locales # or $ sudo localectl set-locale LANG=en_US.UTF-8,LC_ALL=en_US.UTF-8 setup environment files$ sudo bash -c 'cat >> /etc/environment' locales CentOS8 installation references: * Locale How to Fix “Failed to set locale, defaulting to C.UTF-8” in CentOS 8 How do I change my locale to UTF-8 in CentOS? Set System Locale How to Change or Set System Locales in Linux? How To Install rxvt-unicode-terminfo on CentOS 8 locale.conf files support the following environment variables. LANG LANGUAGE LC_ADDRESS LC_COLLATE LC_CTYPE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE LC_TIME $ sudo dnf install -y langpacks-en glibc-all-langpacks glibc-langpack-en glibc-langpack-zh $ sudo localectl set-locale LANG=en_US.UTF-8 # or $ sudo localectl set-locale LANG=en_US.UTF-8 LANGUAGE=en_US:en:C:es_E # option $ sudo localedef -c -f UTF-8 -i en_US en_US.UTF-8 check $ locale LANG=en_US.UTF-8 LC_CTYPE=\"en_US.UTF-8\" LC_NUMERIC=\"en_US.UTF-8\" LC_TIME=\"en_US.UTF-8\" LC_COLLATE=\"en_US.UTF-8\" LC_MONETARY=\"en_US.UTF-8\" LC_MESSAGES=\"en_US.UTF-8\" LC_PAPER=\"en_US.UTF-8\" LC_NAME=\"en_US.UTF-8\" LC_ADDRESS=\"en_US.UTF-8\" LC_TELEPHONE=\"en_US.UTF-8\" LC_MEASUREMENT=\"en_US.UTF-8\" LC_IDENTIFICATION=\"en_US.UTF-8\" LC_ALL=en_US.UTF-8 $ localectl status System Locale: LANG=en_US.UTF-8 LANGUAGE=en_US:en:C:es_ES VC Keymap: us X11 Layout: us $ localectl [--no-pager] list-locales more options $ yum list available | grep glibc-langpack get infomation $ locale -k LC_TIME $ locale -k LC_TELEPHONE $ locale -k LC_PAPER # list all $ locale -a # or $ localedef --list-archive print out terminfo descriptions references: Why do I see the unicode character è when I type Alt-h in my xterm on CentOS? $ infocmp $ tput rmm $ sudo yum install *terminfo langpacks references: Language families, language family groups, subgroups of languages How to add additional language support in CentOS/RHEL Chapter 43. Using langpacks \"Locale\" issue on Linux CentOS & RHEL How to Fix “Failed to set locale, defaulting to C.UTF-8” in CentOS 8 The LANGUAGE priority list list $ sudo yum list langpacks-* $ sudo yum list installed langpacks* $ sudo yum list available langpacks* $ sudo yum repoquery --whatsupplements langpacks- install $ sudo yum install langpacks- # i.e.: $ sudo yum install -y langpacks-en langpacks-en_GB langpacks-zh_CN # or saving disk space by using glibc-langpack- $ sudo yum install -y glibc-common glibc-all-langpacks # or $ sudo yum install -y *langpacks # or $ sudo yum install -y glibc-minimal-langpack # or $ sudo yum install -y glibc-langpack-en chinese$ sudo yum groupinstall \"Chinese Support\" applications disable lock screen in CentOS 8 manually Applications -> Settings -> Poswer Manager -> Display Applications -> Settings -> Screensaver -> Lock Screen cmd $ xset s off $ xset s noblank # disable the power management using dpms to power monitor down $ xset -dpms via script #!/bin/sh export DISPLAY=:0.0 xset s off xset s noblank xset -dpms automatically lock the screen when idle [!NOTE|label:references:] How can I automatically lock the screen when idle in CentOS? (3 Solutions!!) Disabling the GNOME automatic screen locking $ gconftool-2 --type int --set /desktop/gnome/session/idle_delay 1 $ gconftool-2 --type bool --set /desktop/gnome/lockdown/disable_lock_screen false sogou Pinyin input method $ sudo add-apt-repository ppa:fcitx-team/nightly $ sudo apt-get update $ sudo apt-get install fcitx-sogoupinyin $ # sudo apt-get remove ibus specified terminal size $ gnome-terminal --geometry=123x42+0+0 burn bootable usb stick [!NOTE|label:references:] Create a bootable USB stick on macOS download etcher ETCHER FOR MACOS get ubuntu Disk Utility -> Erase format: MS-DOS (FAT) scheme: GUID Partition Map download and install etcher remove system [!NOTE|label:references:] Uninstalling CentOS [OS-Uninstaller] Safely remove Windows, Ubuntu... in 1 clic ! OS-Uninstaller NEW PROJECT : Ubuntu_uninstaller and Boot_repair Q&A yum issue after python upgrade to 3.x [!NOTE|label:references:] CentOS 7升级Python到3.6.6后yum出错问题解决总结 yum upgrading error issue SyntaxError: invalid syntax File \"/usr/libexec/urlgrabber-ext-down\", line 28 except OSError, e: ^ solution $ sed -r '1s/^(.*python)$/\\12/g' -i /usr/libexec/urlgrabber-ext-down or change shebang from #! /usr/bin/python to #! /usr/bin/python2$ vim /usr/libexec/urlgrabber-ext-down ... change '#! /usr/bin/python' to '#! /usr/bin/python2' none of the providers can be installed in dnf upgrade issue $ sudo dnf update ... Last metadata expiration check: 0:01:44 ago on Tue 08 Aug 2023 08:43:40 PM PDT. Error: Problem 1: package authselect-compat-1.1-2.el8.x86_64 requires authselect(x86-64) = 1.1-2.el8, but none of the providers can be installed - cannot install both authselect-1.2.2-3.el8.x86_64 and authselect-1.1-2.el8.x86_64 - cannot install both authselect-1.1-2.el8.x86_64 and authselect-1.2.2-3.el8.x86_64 - cannot install the best update candidate for package authselect-compat-1.1-2.el8.x86_64 - cannot install the best update candidate for package authselect-1.1-2.el8.x86_64 Problem 2: package dbus-x11-1:1.12.8-9.el8.x86_64 requires dbus-daemon = 1:1.12.8-9.el8, but none of the providers can be installed - cannot install both dbus-daemon-1:1.12.8-14.el8.x86_64 and dbus-daemon-1:1.12.8-9.el8.x86_64 - cannot install both dbus-daemon-1:1.12.8-9.el8.x86_64 and dbus-daemon-1:1.12.8-14.el8.x86_64 - cannot install the best update candidate for package dbus-x11-1:1.12.8-9.el8.x86_64 - cannot install the best update candidate for package dbus-daemon-1:1.12.8-9.el8.x86_64 Problem 3: package libstdc++-devel-8.3.1-4.5.el8.x86_64 requires libstdc++(x86-64) = 8.3.1-4.5.el8, but none of the providers can be installed ... upgrade bypass issue [!NOTE] issue stills exists, but upgrade will be executed successfully $ sudo yum upgrade --allowerasing --nobest Last metadata expiration check: 0:02:43 ago on Tue 08 Aug 2023 08:43:40 PM PDT. Dependencies resolved. Problem 1: cannot install the best update candidate for package cups-client-1:2.2.6-28.el8.x86_64 ... Problem 2: cannot install the best update candidate for package gcc-8.3.1-4.5.el8.x86_64 ... Problem 3: package rpm-libs-4.14.3-19.el8.x86_64 requires liblua-5.3.so()(64bit), but none of the providers can be installed ... Problem 4: cannot install the best update candidate for package python3-gobject-3.28.3-1.el8.x86_64 ... ======================================================================================================================= Package Arch Version Repository Size ======================================================================================================================= Upgrading: NetworkManager x86_64 1:1.32.10-4.el8 centos-baseos 2.6 M NetworkManager-libnm x86_64 1:1.32.10-4.el8 centos-baseos 1.8 M NetworkManager-team x86_64 1:1.32.10-4.el8 centos-baseos 148 k NetworkManager-tui x86_64 1:1.32.10-4.el8 centos-baseos 336 k ... fix with erase conflict packges permanently $ sudo dnf repolist repo id repo name baseos CentOS Linux 8 - BaseOS epel Extra Packages for Enterprise Linux 8 - x86_64 extras CentOS Linux 8 - Extras jfrog-cli jfrog-cli mono-centos8-stable mono-centos8-stable $ sudo dnf update --refresh --allowerasing $ sudo dnf distro-sync -y ls: Argument list too long references: * \"Argument list too long\": Beyond Arguments and Limitations * ARG_MAX, maximum length of arguments for a new process How to avoid the limit in a shell * Configuring HugePages for Oracle on Linux (x86-64) * Chapter 36. Configuring huge pages 14.7. Configuring Huge Pages in Red Hat Enterprise Linux 4 or 5 \"Argument list too long\": How do I deal with it, without changing my command? Argument list too long for ls setup ulimit How to avoid the limit in a shell Increasing number of huge pages exhausted memory 3 easy steps to configure hugepages in RHEL/CentOS 7/8 Bug 1364332 - systemd --user does not load limits from /etc/security/limits.d/ How to Increase Number of Open Files Limit in Linux [!NOTE] config files /etc/sysctl.conf /etc/system /etc/security/limits.conf#Each line describes a limit for a user in the form: # # # #Where: # can be: # - a user name # - a group name, with @group syntax # - the wildcard *, for default entry # - the wildcard %, can be also used with %group syntax, # for maxlogin limit /etc/limits.conf /etc/security/limits.d/*.conf /etc/security/limits.d/99-nproc-devops.conf all modifications requires logout and login again $ sudo pkill -u check the limit $ getconf ARG_MAX 2097152 # or $ echo $(( $(ulimit -s)*1024 / 4 )) 2097152 # check all $ ulimit -a core file size (blocks, -c) unlimited data seg size (kbytes, -d) unlimited scheduling priority (-e) 0 file size (blocks, -f) unlimited pending signals (-i) 320869 max locked memory (kbytes, -l) 16384 max memory size (kbytes, -m) unlimited open files (-n) 1024 pipe size (512 bytes, -p) 8 POSIX message queues (bytes, -q) 819200 real-time priority (-r) 0 stack size (kbytes, -s) 8192 cpu time (seconds, -t) unlimited max user processes (-u) 320869 virtual memory (kbytes, -v) unlimited file locks (-x) unlimited # or $ grep Huge /proc/meminfo AnonHugePages: 43008 kB ShmemHugePages: 0 kB HugePages_Total: 0 HugePages_Free: 0 HugePages_Rsvd: 0 HugePages_Surp: 0 Hugepagesize: 2048 kB Hugetlb: 0 kB check page size $ cat /proc/sys/vm/nr_hugepages 0 # modify $ echo 17290 > /proc/sys/vm/nr_hugepages # or $ grep Hugepagesize /proc/meminfo Hugepagesize: 2048 kB grub ## centos7 $ grep GRUB_CMDLINE_LINUX /etc/default/grub GRUB_CMDLINE_LINUX=\"crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet\" # append `default_hugepagesz=1G` to GRUB_CMDLINE_LINUX GRUB_CMDLINE_LINUX=\"crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet default_hugepagesz=1G\" ## centos8 $ grep kernelopts /boot/grub2/grubenv kernelopts=root=/dev/mapper/rhel-root ro crashkernel=auto resume=/dev/mapper/rhel-swap rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet # append default_hugepagesz=1G to kernelopts kernelopts=root=/dev/mapper/rhel-root ro crashkernel=auto resume=/dev/mapper/rhel-swap rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet default_hugepagesz=1G rebuid bios & efi# for bios booting $ sudo grub2-mkconfig -o /boot/grub/grub.cfg # for efi booting $ sudo grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg setup ulimit $ ulimit -s 8192 $ ulimit -s 65536 $ ulimit -s 65536 via limits.d$ cat /etc/security/limits.d/99-nproc-devops.conf devops soft nproc 32768 devops soft nofile 65535 modify open file # via sysctl $ sudo sysctl -w fs.file-max=500000 fs.file-max = 500000 $ cat /proc/sys/fs/file-max 500000 # or via sysctl.conf $ echo 'fs.file-max = 500000' >> /etc/sysctl.conf # or via ulimit $ ulimit -Sn 5000 # | # v # soft open file $ ulimit -Hn 50000 # | # v # hard open file # or $ cat /etc/security/limits.conf * hard nofile 50000 * soft nofile 5000 setup for particular group # setup for group `marslo` and `docker` $ cat /etc/security/limits.conf ... @marslo - nofile 65535 @docker - nofile 65535 others motd motd $ sudo chmod -x /etc/update-motd.d/00-header \\ /etc/update-motd.d/10-help-text \\ /etc/update-motd.d/50-motd-news $ cat /etc/landscape/client.conf [sysinfo] exclude_sysinfo_plugins = Temperature, LandscapeLink EOF motd upgrade disable$ sudo mv /etc/update-motd.d/90-updates-available /etc/update-motd.d/org.90-updates-available.org cockpit $ sudo systemctl enable --now cockpit.socket Created symlink /etc/systemd/system/sockets.target.wants/cockpit.socket → /usr/lib/systemd/system/cockpit.socket. # visit via http://:9090 disable $ sudo systemctl stop cockpit.socket $ sudo systemctl disable cockpit.socket motd disable via cockpit-ws$ sudo yum remove -y cockpit-ws disable in hard way $ sudo ln -sfn /dev/null /etc/motd.d/cockpit # details # https://serverok.in/centos-8-disable-activate-the-web-console#comment-35367 $ cat /etc/issue.d/cockpit.issue // issue shows before login $ cat /etc/motd.d/cockpit // moted shows after login $ la /etc/motd.d/cockpit lrwxrwxrwx. 1 root root 17 Mar 15 2021 /etc/motd.d/cockpit -> /run/cockpit/motd $ la /etc/issue.d/cockpit.issue lrwxrwxrwx. 1 root root 17 Mar 15 2021 /etc/issue.d/cockpit.issue -> /run/cockpit/motd $ la /run/cockpit/motd lrwxrwxrwx. 1 root root 11 Jan 6 03:11 /run/cockpit/motd -> active.motd $ la /run/cockpit/active.motd -rw-r-----. 1 root wheel 80 Jan 6 03:11 /run/cockpit/active.motd package info $ sudo yum search cockpit cockpit.x86_64 : Web Console for Linux servers $ sudo yum list installed | grep cockpit cockpit.x86_64 251.1-1.el8 @baseos cockpit-bridge.x86_64 251.1-1.el8 @baseos cockpit-packagekit.noarch 251.1-1.el8 @appstream cockpit-podman.noarch 33-1.module_el8.5.0+890+6b136101 @appstream cockpit-storaged.noarch 251.1-1.el8 @appstream cockpit-system.noarch 251.1-1.el8 @baseos cockpit-ws.x86_64 251.1-1.el8 @baseos $ rpm -ql cockpit-ws.x86_64 /etc/cockpit /etc/cockpit/ws-certs.d /etc/issue.d/cockpit.issue /etc/motd.d/cockpit // for moted /etc/pam.d/cockpit ... Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:25:00 "},"linux/apt-yum.html":{"url":"linux/apt-yum.html","title":"apt/yum/snap","keywords":"","body":" rpm & dpkg & brew apt apt.conf necessary packages and dependencies disable package auto-upgrade disable disable server auto upgrade revert hold settings show all hold complete remove an app keyring apt-key curl gpg keys gpg Ghostbird/add-repository openmediavault-keyring others apt-cache get package name by command search package name for apt-get yum/dnf repo check configure check variable enable or disable repo cache cleanup no-required packages yum group tools installation resolve conflict File \"/usr/libexec/urlgrabber-ext-down\", line 28 CentOS 8 -> CentOS 9 snap rpm & dpkg & brew RPM DPKG BREW rpm -qa dpkg -l brew list rpm -ql sofrwareanme dpkg -L name dpkg --listfiles name dpkg-qurery -L name brew list name brew ls --verbose name rpm -qf /path/to/file yum whatprovides /path/to/file dpkg -S /path/to/file brew which-formula name rpm -qip pkgfile.rpm rpm -qlp pkgfile.rpm dpkg -l pkgfile.deb dpkg -c pkgfile.deb rpm -q name rpm -qi name dpkg -l name dpkg -s name dpkg -p name brew info name rpm -e name dpkg -r name dpkg -P name brew uninstall name [!NOTE|label:references:] Google Linux Software Repositories How To Build a Debian Packages Official Archive Mirrors for Ubuntu apt [!TIP|label:download deb only] Is there an apt command to download a deb file from the repositories to the current directory?# get package name $ sudo apt list --installed | grep $ apt-get install --reinstall --print-uris -qq | cut -d\"'\" -f2 apt.conf $ cat /etc/apt/apt.conf Acquire::http::Proxy \"http://161.91.27.236:8080\"; Acquire::https::Proxy \"http://161.91.27.236:8080\"; Acquire::ftp::Proxy \"http://161.91.27.236:8080\"; $ cat /etc/apt/apt.conf.d/99ignoresave Dir::Ignore-Files-Silently:: \"(.save|.distupgrade)$\"; Dir::Ignore-Files-Silently:: \"\\.gz$\"; Dir::Ignore-Files-Silently:: \"\\.save$\"; Dir::Ignore-Files-Silently:: \"\\.distUpgrade$\"; Dir::Ignore-Files-Silently:: \"\\.list_$\"; necessary packages and dependencies $ sudo apt --list upgradable $ sudo apt upgrade $ sudo apt install sysv-rc-conf tree dos2unix iptables-persistent mailutils policycoreutils build-essential landscape-common gcc g++ make cmake disable package auto-upgrade disable $ sudo sed -i 's/Prompt=.*/Prompt=never/' /etc/update-manager/release-upgrades $ sudo sed -i 's/\"1\"/\"0\"/' /etc/apt/apt.conf.d/10periodic $ sudo sed -i 's/\"1\"/\"0\"/' /etc/apt/apt.conf.d/20auto-upgrades disable server auto upgrade # dpkg --list | grep jenkins ii jenkins 2.19.4 all Jenkins monitors executions of repeated jobs, such as building a software # echo \"jenkins hold\" | dpkg --set-selections OR # apt-mark hold jenkins # dpkg --list | grep jenkins hi jenkins 2.19.4 all Jenkins monitors executions of repeated jobs, such as building a software revert hold settings $ sudo echo \"jenkins install\" | dpkg --set-selections # OR $ sudo apt-mark unhold jenkins show all hold $ sudo apt-mark showhold complete remove an app $ sudo systemctl stop mysql $ sudo apt-get --purge autoremove mysql* $ sudo apt-get autoclean $ sudo apt --purge autoremove mysql* $ sudo apt autoclean $ sudo apt list --installed | grep mysql $ sudo rm -rf /var/lib/mysql/debian-*.flag $ sudo rm -rf /var/lib/mysql $ sudo rm -rf /etc/mysql keyring [!NOTE] * iMarslo : gpg step by step by apt-key add Hockeypuck OpenPGP keyserver forThe following signatures couldn't be verified because the public key is not available: NO_PUBKEY 112696A0E562B32A NO_PUBKEY 54404762BBB6E853 apt-key $ apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 54404762BBB6E853 # or $ apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 54404762BBB6E853 curl [!NOTE|label:references:] #3286: Ubuntu 18.04 gpg dirmngr IPC connect call failed # 0x # v $ curl -sL \"http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x112696A0E562B32A\" | sudo apt-key add $ curl -sL \"http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x54404762BBB6E853\" | sudo apt-key add or manually download $ cat armored-keys.asc | sudo apt-key add gpg keys [!NOTE|label:references:] Omv and Apt broken: Pending configuration changes $ sudo dpkg -l | grep openmediavault $ sudo ls -alh /etc/apt/trusted.gpg.d/ apt-get update errors missing public keys The following signatures couldn't be verified because the public key is not available gpg $ gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF more options $ gpg --ignore-time-conflict \\ --no-options \\ --no-default-keyring \\ --homedir /tmp/tmp.Hrb5ETPac2 \\ --no-auto-check-trustdb \\ --trust-model always \\ --keyring /etc/apt/trusted.gpg \\ --primary-keyring /etc/apt/trusted.gpg \\ --keyserver keyserver.ubuntu.com \\ --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF or install keyring via apt-key $ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 112695A0E562B32A Ghostbird/add-repository $ ./add-repository \"https://keyserver.ubuntu.com/pks/lookup?search=0x3fa7e0328081bff6a14da29aa6a19b38d3d831ef&op=get\" \"deb https://download.mono-project.com/repo/debian stable-buster main\" mono-official-stable.list openmediavault-keyring $ cd /tmp $ sudo wget https://packages.openmediavault.org/public/pool/main/o/openmediavault-keyring/openmediavault-keyring_1.0.2-2_all.deb $ sudo dpkg -i openmediavault-keyring $ sudo apt-get update others # dockerfile RUN apt install -y gnupg ca-certificates RUN gpg --keyserver keyserver.ubuntu.com --recv 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF RUN gpg --export 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF | tee /usr/share/keyrings/mono.gpg >/dev/null RUN gpg --batch --yes --delete-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF RUN echo \"deb [signed-by=/usr/share/keyrings/mono.gpg] https://download.mono-project.com/repo/debian stable-buster main\" | tee /etc/apt/sources.list.d/mono-official-stable.list RUN apt update RUN apt install -y mono-devel apt-cache get package name by command $ apt-cache search mkpasswd whois - intelligent WHOIS client libstring-mkpasswd-perl - Perl module implementing a random password generator search package name for apt-get $ sudo apt-cache search chrome browser chromium-browser - Chromium browser chromium-chromedriver - WebDriver driver for the Chromium Browser cloudprint - Server for Google Cloud Print collabtive - Web-based project management software epiphany-browser - Intuitive GNOME web browser jsxgraph - Interactive Geometry with JavaScript kpartsplugin - Netscape-compatible plugin to embed KDE file-viewers into browser libjs-excanvas - HTML5 Canvas for Internet Explorer libjs-jquery-jplayer - HTML5 Audio & Video for jQuery with a Flash fallback libjs-jquery-jush - jQuery Syntax Highlighter google-chrome-beta - The web browser from Google google-chrome-stable - The web browser from Google google-chrome-unstable - The web browser from Google yum/dnf [!NOTE|label:references:] Yum install error file \"/usr/bin/yum\", line 30 failed at yum update and how to fix it Upgraded Python, and now I can't run “yum upgrade” How to Find Out Top Directories and Files (Disk Space) in Linux 8.4. Configuring Yum and Yum Repositories 8.4.2. Setting [repository] Options repo vars$ cd /etc/dnf/vars; grep -H --color=none . * contentdir:centos infra:stock # or $ tail -f /var/log/dnf.log moving from CentOS 8 to CentOS Stream 8$ sudo sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-* $ sudo sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-* $ sudo dnf install centos-release-stream -y --allowerasing $ sudo dnf swap centos-{linux,stream}-repos $ sudo dnf distro-sync --best --allowerasing $ sudo reboot DNF Command Reference repo [!NOTE] CentOS Repositories CentOS Stream Mirror 8.4. Configuring Yum and Yum Repositories variables in repo files # centos 8 $ /usr/libexec/platform-python -c 'import dnf, json; db = dnf.dnf.Base(); print(json.dumps(db.conf.substitutions, indent=2))' { \"arch\": \"x86_64\", \"basearch\": \"x86_64\", \"releasever\": \"8\" } # centos 7 $ python -c 'import yum, json; yb = yum.YumBase(); print json.dumps(yb.conf.yumvar, indent=2)' Loaded plugins: fastestmirror, langpacks, versionlock { \"uuid\": \"512cdde3-4de7-47af-a2fd-6b4e6d711b12\", \"contentdir\": \"centos\", \"basearch\": \"x86_64\", \"infra\": \"stock\", \"releasever\": \"7\", \"arch\": \"ia32e\" } # or $ dnf config-manager --dump-variables arch = x86_64 basearch = x86_64 stream = 9-stream releasever = 8 $ sudo dnf install -y https://mirror.stream.centos.org/9-stream/BaseOS/aarch64/os/Packages/centos-gpg-keys-9.0-23.el9.noarch.rpm \\ https://mirror.stream.centos.org/9-stream/BaseOS/x86_64/os/Packages/centos-stream-repos-9.0-23.el9.noarch.rpm i.e.: $ sudo cat /etc/yum.repos.d/centos.repo [baseos] name=CentOS Stream $releasever - BaseOS metalink=https://mirrors.centos.org/metalink?repo=centos-baseos-$stream&arch=$basearch&protocol=https,http gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial gpgcheck=1 repo_gpgcheck=0 metadata_expire=6h countme=1 enabled=1 EOF $ dnf --disablerepo=* --enablerepo=baseos reinstall centos-stream-repos check configure $ dnf config-manager --dump check variable [!NOTE] man yum.conf Yum: How can I view variables like $releasever, $basearch & $YUM0? $ dnf config-manager --dump-variables arch = x86_64 basearch = x86_64 contentdir = centos infra = stock stream = 8-stream releasever = 8 # or $ /usr/libexec/platform-python -c 'import dnf, json; db = dnf.dnf.Base(); print(json.dumps(db.conf.substitutions, indent=2))' { \"arch\": \"x86_64\", \"basearch\": \"x86_64\", \"releasever\": \"8\" } # or $ cat /etc/yum/vars/* File: /etc/yum/vars/contentdir 1 centos ────────────────────────────────────────────────────────────────────────────────────────────────── File: /etc/yum/vars/infra 1 stock ────────────────────────────────────────────────────────────────────────────────────────────────── File: /etc/yum/vars/stream 1 8-stream install via different releasever $ dnf -y --releasever=9 --allowerasing --setopt=deltarpm=false swap python39-setuptools python3-setuptools enable or disable repo # enable $ sudo yum config-manager --set-enabled PowerTools # disable $ sudo yum config-manager --set-disabled PowerTools cache # clean $ sudo dnf clean all [ --refresh ] # makecache $ sudo dnf makecache cleanup no-required packages $ sudo package-cleanup --leaves $ sudo package-cleanup --orphans yum group references: 2.5 Yum Groups How to install a group of packages with yum on Red Hat Enterprise Linux? $ yum grouplist $ yum group hidden $ yum groupinfo $ yum groupinstall $ yum groupupdate $ yum groupremove tools installation [!TIP|label:convert CentOS repo file in RHEL] $ sudo sed -i 's/\\$contentdir/centos/' /etc/yum.repo.d/*.repo CentOS through a VM - no URLs in mirrorlist [closed]$ sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-Linux-* $ sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-Linux-* $ $ sudo dnf install centos-release-stream -y $ sudo dnf swap centos-{linux,stream}-repos -y $ sudo dnf distro-sync -y epel [!TIP|label:references:] How To enable the EPEL Repository on RHEL 8 / CentOS 8 Linux * Extra Packages for Enterprise Linux (EPEL) 404 error trying to install EPEL Index of /epel/8/Everything # install from url # centos 7 $ sudo dnf [re]install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm # centos 8 $ sudo dnf [re]install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm # centos 9 $ sudo dnf [re]install https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm # install via cmd $ sudo yum [re]install -y epel-release yum-utils # or $ sudo dnf config-manager --set-enabled powertools $ sudo dnf install -y epel-release epel-next-release info $ cat /etc/yum.repos.d/epel.repo [epel] name=Extra Packages for Enterprise Linux 8 - $basearch # It is much more secure to use the metalink, but if you wish to use a local mirror # place its address here. #baseurl=https://download.example/pub/epel/8/Everything/$basearch metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-8&arch=$basearch&infra=$infra&content=centos enabled=1 gpgcheck=1 countme=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-8 $ dnf repoinfo epel Repo-id : epel Repo-name : Extra Packages for Enterprise Linux 8 - x86_64 Repo-status : enabled Repo-revision : 1697078836 Repo-updated : Wed 11 Oct 2023 07:48:01 PM PDT Repo-pkgs : 9,872 Repo-available-pkgs: 9,870 Repo-size : 17 G Repo-metalink : https://mirrors.fedoraproject.org/metalink?repo=epel-8&arch=x86_64&infra=$infra&content=centos Updated : Thu 12 Oct 2023 05:16:56 PM PDT Repo-baseurl : https://mirrors.iu13.net/epel/8/Everything/x86_64/ (153 more) Repo-expire : 172,800 second(s) (last: Thu 12 Oct 2023 05:16:56 PM PDT) Repo-filename : /etc/yum.repos.d/epel.repo Total packages: 9,872 $ dnf repoinfo epel-next Last metadata expiration check: 0:10:35 ago on Wed 13 Dec 2023 03:48:24 PM PST. Repo-id : epel-next Repo-name : Extra Packages for Enterprise Linux 8 - Next - x86_64 Repo-status : enabled Repo-revision : 1693098199 Repo-updated : Sat 26 Aug 2023 06:03:39 PM PDT Repo-pkgs : 40 Repo-available-pkgs: 40 Repo-size : 87 M Repo-metalink : https://mirrors.fedoraproject.org/metalink?repo=epel-next-8&arch=x86_64&infra=$infra&content=$contentdir Updated : Wed 13 Dec 2023 03:48:22 PM PST Repo-baseurl : http://mirrors.wcupa.edu/epel/next/8/Everything/x86_64/ (126 more) Repo-expire : 172,800 second(s) (last: Wed 13 Dec 2023 03:48:22 PM PST) Repo-filename : /etc/yum.repos.d/epel-next.repo Total packages: 40 $ dnf repoinfo epel-modular Last metadata expiration check: 0:11:06 ago on Wed 13 Dec 2023 03:48:24 PM PST. Repo-id : epel-modular Repo-name : Extra Packages for Enterprise Linux Modular 8 - x86_64 - RETIRED Repo-status : enabled Repo-revision : 1663033591 Repo-updated : Mon 12 Sep 2022 06:46:46 PM PDT Repo-pkgs : 290 Repo-available-pkgs: 0 Repo-size : 835 M Repo-metalink : https://mirrors.fedoraproject.org/metalink?repo=epel-modular-8&arch=x86_64&infra=$infra&content=centos Updated : Wed 13 Dec 2023 03:48:21 PM PST Repo-baseurl : http://opencolo.mm.fcix.net/epel/8/Modular/x86_64/ (189 more) Repo-expire : 172,800 second(s) (last: Wed 13 Dec 2023 03:48:21 PM PST) Repo-filename : /etc/yum.repos.d/epel-modular.repo Total packages: 290 We can workaround this by replacing the $releasever variable with 8 $ sudo sed -i 's/$releasever/8/g' /etc/yum.repos.d/epel*.repo # Same problem, RHEL 8.2 on Azure. $ sed -i.bak 's/\\$releasever/8/g' /etc/yum.repos.d/epel*.repo list only epel supported $ dnf --disablerepo=\"*\" --enablerepo=\"epel\" list available moreutils [!NOTE|label:references:] 1820925 - moreutils from epel8 not installable Has anyone figured out how to install moreutils on Centos8? RPM resource perl-IPC-Run or$ dnf config-manager --enable powertools $ dnf install epel-release -y $ dnf --enablerepo=powertools install moreutils -y check what's package repo can provide $ dnf repository-packages epel list resolve conflict [!NOTE|label:references:] How do I resolve a conflict reported by dnf? issue $ sudo dnf update --refresh CentOS Linux 8 - BaseOS 15 kB/s | 3.9 kB 00:00 CentOS Linux 8 - Extras 14 kB/s | 1.5 kB 00:00 Extra Packages for Enterprise Linux 8 - x86_64 50 kB/s | 22 kB 00:00 jfrog-cli 3.9 kB/s | 1.4 kB 00:00 mono-centos8-stable 20 kB/s | 2.9 kB 00:00 Error: Problem 1: cannot install both authselect-1.2.2-3.el8.x86_64 and authselect-1.1-2.el8.x86_64 - package authselect-compat-1.1-2.el8.x86_64 requires authselect(x86-64) = 1.1-2.el8, but none of the providers can be installed - cannot install the best update candidate for package authselect-1.1-2.el8.x86_64 - problem with installed package authselect-compat-1.1-2.el8.x86_64 Problem 2: cannot install both cups-libs-1:2.2.6-40.el8.x86_64 and cups-libs-1:2.2.6-28.el8.x86_64 - package cups-client-1:2.2.6-28.el8.x86_64 requires cups-libs(x86-64) = 1:2.2.6-28.el8, but none of the providers can be installed - cannot install the best update candidate for package cups-libs-1:2.2.6-28.el8.x86_64 - problem with installed package cups-client-1:2.2.6-28.el8.x86_64 Problem 3: cannot install both dbus-daemon-1:1.12.8-14.el8.x86_64 and dbus-daemon-1:1.12.8-9.el8.x86_64 - package dbus-x11-1:1.12.8-9.el8.x86_64 requires dbus-daemon = 1:1.12.8-9.el8, but none of the providers can be installed - cannot install the best update candidate for package dbus-daemon-1:1.12.8-9.el8.x86_64 - problem with installed package dbus-x11-1:1.12.8-9.el8.x86_64 Problem 4: cannot install both libgomp-8.5.0-4.el8_5.x86_64 and libgomp-8.3.1-4.5.el8.x86_64 - package gcc-8.3.1-4.5.el8.x86_64 requires libgomp = 8.3.1-4.5.el8, but none of the providers can be installed - cannot install the best update candidate for package libgomp-8.3.1-4.5.el8.x86_64 - problem with installed package gcc-8.3.1-4.5.el8.x86_64 Problem 5: package libsolv-0.7.19-1.el8.x86_64 conflicts with rpm(x86-64) = 1.5.11, but none of the providers can be installed - cannot install the best update candidate for package dbus-common-1:1.12.8-9.el8.noarch - problem with installed package ibus-libpinyin-1.10.0-1.el8.x86_64 Problem 18: package dbus-x11-1:1.12.8-9.el8.x86_64 requires dbus-daemon = 1:1.12.8-9.el8, but none of the providers can be installed - package dbus-daemon-1:1.12.8-9.el8.x86_64 requires dbus-libs(x86-64) = 1:1.12.8-9.el8, but none of the providers can be installed - package ibus-1.5.19-4.el8.x86_64 requires dbus-x11, but none of the providers can be installed - cannot install both dbus-libs-1:1.12.8-14.el8.x86_64 and dbus-libs-1:1.12.8-9.el8.x86_64 - package ibus-setup-1.5.19-4.el8.noarch requires ibus = 1.5.19-4.el8, but none of the providers can be installed - cannot install the best update candidate for package dbus-libs-1:1.12.8-9.el8.x86_64 - problem with installed package ibus-setup-1.5.19-4.el8.noarch (try to add '--allowerasing' to command line to replace conflicting packages or '--skip-broken' to skip uninstallable packages or '--nobest' to use not only best candidate packages) solution $ sudo dnf repolist repo id repo name baseos CentOS Linux 8 - BaseOS epel Extra Packages for Enterprise Linux 8 - x86_64 extras CentOS Linux 8 - Extras jfrog-cli jfrog-cli mono-centos8-stable mono-centos8-stable $ sudo dnf update --refresh --allowerasing $ sudo dnf distro-sync -y # or $ sudo dnf remove $(dnf repoquery --duplicated --latest-limit -1 -q) # show duplicate packages $ dnf repoquery --duplicated File \"/usr/libexec/urlgrabber-ext-down\", line 28 error File \"/usr/libexec/urlgrabber-ext-down\", line 28 except OSError, e: ^ solution $ sudo update-alternatives --remove python /usr/bin/python3 $ realpath /usr/bin/python /usr/bin/python2.7 or $ sudo update-alternatives --config python There are 3 programs which provide 'python'. Selection Command ----------------------------------------------- *+ 1 /usr/bin/python3 2 /usr/bin/python2.7 3 /usr/bin/python2 Enter to keep the current selection[+], or type selection number: 3 reason $ ls -l /usr/bin/python* lrwxrwxrwx 1 root root 24 Jul 10 02:29 /usr/bin/python -> /etc/alternatives/python lrwxrwxrwx 1 root root 9 Dec 6 2018 /usr/bin/python2 -> python2.7 -rwxr-xr-x 1 root root 7216 Oct 30 2018 /usr/bin/python2.7 lrwxrwxrwx 1 root root 9 Mar 7 2019 /usr/bin/python3 -> python3.4 -rwxr-xr-x 2 root root 11392 Feb 5 2019 /usr/bin/python3.4 -rwxr-xr-x 2 root root 11392 Feb 5 2019 /usr/bin/python3.4m $ ls -altrh /etc/alternatives/python lrwxrwxrwx 1 root root 16 Jul 10 02:29 /etc/alternatives/python -> /usr/bin/python3 CentOS 8 -> CentOS 9 [!NOTE|label:references:] yodermk/centos8-9.sh Conflicting requests after update to CentOS 9 Stream from 8 $ sudo yum upgrade $ sudo reboot $ sudo dnf install epel-release $ sudo dnf install rpmconf $ sudo dnf install yum-utils $ sudo rpmconf -a # answer \"n\" to both things $ sudo package-cleanup --leaves $ sudo package-cleanup --orphans $ dnf install http://mirror.stream.centos.org/9-stream/BaseOS/x86_64/os/Packages/centos-stream-repos-9.0-9.el9.noarch.rpm \\ http://mirror.stream.centos.org/9-stream/BaseOS/x86_64/os/Packages/centos-stream-release-9.0-9.el9.noarch.rpm \\ http://mirror.stream.centos.org/9-stream/BaseOS/x86_64/os/Packages/centos-gpg-keys-9.0-9.el9.noarch.rpm $ sudo curl -O https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm $ sudo curl -O https://dl.fedoraproject.org/pub/epel/epel-next-release-latest-9.noarch.rpm $ sudo rpm -Uvh *.rpm $ sudo yum update $ sudo dnf clean all $ sudo rpm -e `rpm -q kernel` $ sudo dnf -y --releasever=9 --allowerasing --setopt=deltarpm=false distro-sync $ sudo dnf clean all $ sudo reboot $ sudo rm -f /var/lib/rpm/__db* $ sudo rpm --rebuilddb $ sudo dnf -y groupupdate \"Core\" \"Minimal Install\" snap [!NOTE|label:references:] Is it possible to install the .snap application in an offline computer? # online machine $ snap download curl Fetching snap \"curl\" 2024/01/05 21:58:46.632267 store_download.go:142: no host system xdelta3 available to use deltas Fetching assertions for \"curl\" Install the snap with: snap ack curl_1754.assert snap install curl_1754.snap $ scp curl_1754* account@offline.server.com:~/snap # offline machine $ sudo snap ack curl_1754.assert $ sudo snap install curl_1754.snap curl 8.1.2 from Wouter van Bommel (woutervb) installed $ curl --version curl 8.1.2 (x86_64-pc-linux-gnu) libcurl/8.1.2 OpenSSL/1.1.1f zlib/1.2.11 brotli/1.0.7 zstd/1.4.4 libidn2/2.2.0 libpsl/0.21.0 (+libidn2/2.2.0) libssh/0.9.3/openssl/zlib nghttp2/1.40.0 librtmp/2.3 libgsasl/1.8.1 Release-Date: 2023-05-30 Protocols: dict file ftp ftps gopher gophers http https imap imaps ldap ldaps mqtt pop3 pop3s rtmp rtsp scp sftp smb smbs smtp smtps telnet tftp Features: alt-svc AsynchDNS brotli gsasl GSS-API HSTS HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM NTLM_WB PSL SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:25:00 "},"linux/app.html":{"url":"linux/app.html","title":"apps","keywords":"","body":" pre-config dependencies installation account proxy service shadowsocks shadowsocks-libev squid docker client add insecure-regiestry docker login & logout docker pull docker push X Windows get screen solution desktop sharing [!NOTE|label:references:] 使用ssl模块配置同时支持http和https并存 How To Create an SSL Certificate on Nginx for Ubuntu 14.04 How To Create a Self-Signed SSL Certificate for Nginx in Ubuntu 16.04 Enabling Https with Nginx Enable SSL for HTTPS Configuration on nginx Nginx+Https配置 Test an insecure registry Protect the Docker daemon socket [!TIP|label:download deb only] Is there an apt command to download a deb file from the repositories to the current directory?# get package name $ sudo apt list --installed | grep $ apt-get install --reinstall --print-uris -qq | cut -d\"'\" -f2 pre-config dependencies installation $ sudo apt install -y apt-file \\ autoconf \\ automake \\ bash-completion* \\ binutils \\ binutils-doc \\ bison \\ build-essential \\ cmake \\ cpp \\ cpp-5 \\ cpp-doc \\ curl \\ debian-keyring \\ dlocate \\ dos2unix \\ dpkg-dev \\ dstat \\ fakeroot \\ flex \\ g++ \\ g++-5 \\ g++-5-multilib \\ g++-multilib \\ gcc \\ gcc-5 \\ gcc-5-doc \\ gcc-5-locales \\ gcc-5-multilib \\ gcc-doc \\ gcc-multilib \\ gdb \\ git \\ htop \\ ifstat \\ iftop \\ iptables-persistent \\ jq \\ landscape-common \\ libasan2 \\ libasan2-dbg \\ libatomic1 \\ libatomic1-dbg \\ libbz2-dev \\ libc-dev-bin \\ libc6-dev \\ libcc1-0 \\ libcilkrts5 \\ libcilkrts5-dbg \\ libexpat-dev \\ libexpat1-dev \\ libfakeroot \\ libgcc1-dbg \\ libgomp1-dbg \\ libisl15 \\ libitm1 \\ libitm1-dbg \\ liblsan0 \\ liblsan0-dbg \\ liblxc1 \\ libmpc3 \\ libmpx0 \\ libmpx0-dbg \\ libncurses-dev \\ libncurses5-dev \\ libncursesw5-dev \\ libpython-all-dev \\ libpython2.7 \\ libquadmath0 \\ libquadmath0-dbg \\ libsensors4 \\ libssl-dev \\ libstdc++-5-dev \\ libstdc++-5-doc \\ libstdc++6-5-dbg \\ libtool \\ libtsan0 \\ libtsan0-dbg \\ libubsan0 \\ libubsan0-dbg \\ linux-libc-dev \\ lxc-common \\ lxcfs \\ m4 \\ mailutils \\ make \\ manpages-dev \\ ncurses-doc \\ net-tools \\ netfilter-persistent \\ policycoreutils \\ python-docutils \\ python-pip \\ python-setuptools-doc \\ ruby \\ sysstat \\ texinfo \\ traceroute \\ tree \\ update-motd \\ update-notifier-common \\ zlib1g-dev account $ sudo usermod -a -G sudo,adm,root,docker devops proxy service shadowsocks server # ubuntu $ sudo apt install m2crypto git python-pip # centos $ sudo yum install m2crypto git python3-pip $ pip install --upgrade pip # or $ pip3 install --upgrade pip # or $ sudo /usr/bin/python3 -m pip install --upgrade pip $ pip install git+https://github.com/shadowsocks/shadowsocks.git@master $ sudo ln -sf /home/marslo/.local/bin/ssserver /usr/local/bin/ssserver start$ sudo bash -c 'cat > /etc/rc.local' client ubuntu $ sudo add-apt-repository ppa:hzwhuang/ss-qt5 Shadowsocks-Qt5 is a cross-platform Shadowsocks GUI client. Shadowsocks is a lightweight tool that helps you bypass firewall(s). This PPA mainly includes packages for Shadowsocks-Qt5, which means it also includes libQtShadowsocks packages. More info: https://launchpad.net/~hzwhuang/+archive/ubuntu/ss-qt5 Press [ENTER] to continue or Ctrl-c to cancel adding it. gpg: keybox '/tmp/tmpaegs6_x4/pubring.gpg' created gpg: /tmp/tmpaegs6_x4/trustdb.gpg: trustdb created gpg: key 6DA746A05F00FA99: public key \"Launchpad PPA for Symeon Huang\" imported gpg: Total number processed: 1 gpg: imported: 1 OK $ sudo apt update $ sudo apt install shadowsocks-qt5 others $ sudo apt install python-pip $ sudo pip install genpac shadowsocks-libev service started by docker image teddysun/shadowsocks-libev $ mkdir -p /etc/shadowsocks-libev $ sudo bash -c \"cat > /etc/shadowsocks-libev/config.json\" started by /etc/init.d/shadowsocks-libev $ wget --no-check-certificate \\ -O shadowsocks-all.sh \\ https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh $ chmod +x shadowsocks-all.sh $ ./shadowsocks-all.sh 2>&1 | tee shadowsocks-all.log ... Which Shadowsocks server you'd select: 1) Shadowsocks-Python 2) ShadowsocksR 3) Shadowsocks-Go 4) Shadowsocks-libev Please enter a number (Default Shadowsocks-Python): 4 You choose = Shadowsocks-libev ... [Info] Starting install package autoconf Do you want install simple-obfs for Shadowsocks-libev? [y/n] (default: n): y You choose = y Please select obfs for simple-obfs: 1) http 2) tls Which obfs you'd select(Default: http): 1 obfs = http ... service$ sudo /etc/init.d/shadowsocks-libev start $ sudo /etc/init.d/shadowsocks-libev stop $ sudo /etc/init.d/shadowsocks-libev restart $ sudo /etc/init.d/shadowsocks-libev status Shadowsocks-libev (pid 903) is running... config$ /etc/shadowsocks-libev/config.json { \"server\":\"0.0.0.0\", \"server_port\": 1111, \"password\":\"mypassword\", \"timeout\":300, \"user\":\"nobody\", // optinal \"method\":\"aes-256-cfb\", \"fast_open\":false, \"nameserver\":\"1.0.0.1\", // be careful for dns resolve in private network \"mode\":\"tcp_and_udp\", \"plugin\":\"obfs-server\", \"plugin_opts\":\"obfs=http\" } check status $ sudo lsof -i:1111 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME ss-server 903 nobody 8u IPv4 20522 0t0 UDP *:1111 obfs-serv 909 root 7u IPv4 20649 0t0 TCP *:1111 (LISTEN) $ sudo netstatus -tunpla | grep 1111 tcp 0 0 0.0.0.0:1111 0.0.0.0:* LISTEN 909/obfs-server udp 0 0 0.0.0.0:1111 0.0.0.0:* 903/ss-server client PLUGIN PLUGIN OPTS simple-obfs obfs=http;obfs-host=www.google.com squid [!NOTE|label:references:] About Squid proxy servers Squid installation and configuration in Ubuntu SquidGuard in ubuntu How to configure an SSH proxy server with Squid Use Squid as HTTP / HTTPS / SSH Proxy Tunnelling SSH/SFTP over Squid proxy How to Set Up a Proxy Server on Your Mac Using SquidMan brew install squid on macOS but can't run squid docker client add insecure-regiestry $ cat ~/.docker/daemon.json { \"debug\" : true, \"experimental\" : true, \"insecure-registries\" : [\"sample.artifactory.com\", \"sample.artifactory.com:2500\", \"sample.artifactory.com:2501\", \"docker-1.artifactory\", \"docker-1.artifactory:443\"] } $ sudo systemctl daemon-reload $ sudo systemctl restart docker docker login & logout $ docker --debug -l debug login --username admin https://docker-1.artifactory Password: Login Succeeded $ docker --debug -l debug logout docker-1.artifactory Removing login credentials for docker-1.artifactory docker pull $ docker pull docker-1.artifactory/nginx:latest latest: Pulling from nginx e7bb522d92ff: Pull complete 0f4d7753723e: Pulling fs layer 91470a14d63f: Download complete 0f4d7753723e: Pull complete 91470a14d63f: Pull complete Digest: sha256:3eff18554e47c4177a09cea5d460526cbb4d3aff9fd1917d7b1372da1539694a Status: Downloaded newer image for docker-1.artifactory/nginx:latest docker push $ docker pull hello-world $ docker tag hello-world docker-1.artifactory/bello-marslo:2.0 $ docker login --username admin docker-1.artifactory $ docker push docker-1.artifactory/bello-marslo:2.0 X Windows get screen solution $ xrandr --verbose Screen 0: minimum 320 x 200, current 1920 x 1080, maximum 8192 x 8192 XWAYLAND0 connected 1920x1080+0+0 (0x22) normal (normal left inverted right x axis y axis) 480mm x 270mm Identifier: 0x21 Timestamp: 3807 Subpixel: unknown Gamma: 1.0:1.0:1.0 Brightness: 0.0 Clones: CRTC: 0 CRTCs: 0 Transform: 1.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 1.000000 filter: 1920x1080 (0x22) 173.000MHz -HSync +VSync *current +preferred h: width 1920 start 2048 end 2248 total 2576 skew 0 clock 67.16KHz v: height 1080 start 1083 end 1088 total 1120 clock 59.96Hz desktop sharing enable remote access ##!/bin/bash export DISPLAY=:0 read -e -p \"VNC Password: \" -i \"ubuntu\" password dconf write /org/gnome/desktop/remote-access/enabled true dconf write /org/gnome/desktop/remote-access/prompt-enabled false dconf write /org/gnome/desktop/remote-access/authentication-methods \"['vnc']\" dconf write /org/gnome/desktop/remote-access/require-encryption false08/03/2018 dconf write /org/gnome/desktop/remote-access/vnc-password \\\"\\'$(echo -n $password | base64)\\'\\\" dconf dump /org/gnome/desktop/remote-access/ ## sudo service lightdm restart or$ vino-preference $ dconf-editor start x server $ export DISPLAY=:0 $ /usr/lib/vino/vino-server --display=:0 & reset vnc password $ echo -n 'awesome' | base64 $ gconftool-2 -s -t string /desktop/gnome/remote_access/vnc_password $(echo -n \"\" | base64) $ gconftool-2 --type string --set /desktop/gnome/remote_acess/vnc_password '123456' wayland known error cat check using wayland or xorg $ echo $XDG_SESSION_TYPE Ubuntu: Wayland (Wayland) Ubuntu on Xorg: Xorg (X11) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:47:14 "},"linux/x11.html":{"url":"linux/x11.html","title":"x11","keywords":"","body":" xrdp xrdp [!NOTE|label:references:] How to Install XRDP on CentOS and RedHat Linux 8/7 How to Install Xrdp Server (Remote Desktop) on CentOS 8 How to Install Xrdp Server on CentOS 8 How to Enable Remote Desktop on CentOS 8/RHEL8.x install $ sudo yum clean all $ sudo yum makecache fast # optinal $ sudo yum -y update $ sudo yum install epel-release $ sudo yum groupinstall -y \"Server with GUI\" $ sudo yum groupinstall -y \"Xfce\" $ sudo sudo yum install -y xrdp tigervnc-server service $ sudo systemctl enable xrdp --now $ sudo systemctl start xrdp.service $ sudo firewall-cmd --add-port=3389/tcp --permanent $ sudo firewall-cmd --reload $ sudo reboot $ echo \"xfce4-session\" > ~/.Xclients $ chmod a+x ~/.Xclients xrdp.ini $ cat /etc/xrdp/xrdp.ini | sed -r '/(^[;#].*)|(^\\s*)$/d' # or $ cat /etc/xrdp/xrdp.ini | sed -e '/^[;#]/ d' -e '/^$/ d' # or $ cat /etc/xrdp/xrdp.ini | sed -e '/^[;#]/ d' | sed '/^$/ d' [Globals] ini_version=1 fork=true port=3389 use_vsock=false tcp_nodelay=true tcp_keepalive=true security_layer=negotiate crypt_level=high certificate= key_file= ssl_protocols=TLSv1.2, TLSv1.3 autorun= allow_channels=true allow_multimon=true bitmap_cache=true bitmap_compression=true bulk_compression=true max_bpp=32 new_cursors=true use_fastpath=both blue=009cb5 grey=dedede ls_top_window_bg_color=009cb5 ls_width=350 ls_height=430 ls_bg_color=dedede ls_logo_filename= ls_logo_x_pos=55 ls_logo_y_pos=50 ls_label_x_pos=30 ls_label_width=65 ls_input_x_pos=110 ls_input_width=210 ls_input_y_pos=220 ls_btn_ok_x_pos=142 ls_btn_ok_y_pos=370 ls_btn_ok_width=85 ls_btn_ok_height=30 ls_btn_cancel_x_pos=237 ls_btn_cancel_y_pos=370 ls_btn_cancel_width=85 ls_btn_cancel_height=30 [Logging] LogFile=xrdp.log LogLevel=INFO EnableSyslog=true [LoggingPerLogger] [Channels] rdpdr=true rdpsnd=true drdynvc=true cliprdr=true rail=true xrdpvr=true tcutils=true [Xvnc] name=Xvnc lib=libvnc.so username=ask password=ask ip=127.0.0.1 port=-1 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"linux/ubuntu/ubuntu.html":{"url":"linux/ubuntu/ubuntu.html","title":"ubuntu","keywords":"","body":" set service auto-startup gnome terminal install ubuntu theme open font viewer and install font show launcher icon show the softer renderer specified context menu disable ubuntu desktop notification recode activity as a gif file goldendict installation shadowsocks server client shadowsocks-libev service client [!NOTE|label:references:] * iMarslo: ubuntu provisioning 使用ssl模块配置同时支持http和https并存 How To Create an SSL Certificate on Nginx for Ubuntu 14.04 How To Create a Self-Signed SSL Certificate for Nginx in Ubuntu 16.04 Enabling Https with Nginx Enable SSL for HTTPS Configuration on nginx Nginx+Https配置 Test an insecure registry Protect the Docker daemon socket apt-get install tzdata noninteractive set service auto-startup $ sudo sysv-rc-config jenkins on $ sudo sysv-rc-conf --list | grep jenkins jenkins 0:off 1:off 2:on 3:on 4:on 5:on 6:off $ sudo update-rc.d jenkins enable update-rc.d: warning: start runlevel arguments (none) do not match jenkins Default-Start values (2 3 4 5) update-rc.d: warning: stop runlevel arguments (none) do not match jenkins Default-Stop values (0 1 6) Enabling system startup links for /etc/init.d/jenkins ... Removing any system startup links for /etc/init.d/jenkins ... /etc/rc0.d/K20jenkins /etc/rc1.d/K20jenkins /etc/rc2.d/S20jenkins /etc/rc3.d/S20jenkins /etc/rc4.d/S20jenkins /etc/rc5.d/S20jenkins /etc/rc6.d/K20jenkins Adding system startup for /etc/init.d/jenkins ... /etc/rc0.d/K20jenkins -> ../init.d/jenkins /etc/rc1.d/K20jenkins -> ../init.d/jenkins /etc/rc6.d/K20jenkins -> ../init.d/jenkins /etc/rc2.d/S20jenkins -> ../init.d/jenkins /etc/rc3.d/S20jenkins -> ../init.d/jenkins /etc/rc4.d/S20jenkins -> ../init.d/jenkins /etc/rc5.d/S20jenkins -> ../init.d/jenkins gnome terminal backup $ dconf dump /org/gnome/terminal/ > ubuntu1710_terminal_backup.bak restore $ dconf load /org/gnome/terminal/ reset $ dconf reset -f /org/gnome/terminal list $ gsettings list-recursively | grep -i org.gnome.Terminal click to check details ... $ gsettings list-recursively | grep -i org.gnome.Terminal org.gnome.Terminal.ProfilesList list ['b1dcc9dd-5262-4d8d-a863-c897e6d979b9'] org.gnome.Terminal.ProfilesList default 'b1dcc9dd-5262-4d8d-a863-c897e6d979b9' org.gnome.shell favorite-apps ['firefox.desktop', 'org.gnome.Nautilus.desktop', 'org.gnome.Terminal.desktop'] org.gnome.Terminal.Legacy.Settings new-terminal-mode 'window' org.gnome.Terminal.Legacy.Settings menu-accelerator-enabled true org.gnome.Terminal.Legacy.Settings tab-position 'top' org.gnome.Terminal.Legacy.Settings confirm-close true org.gnome.Terminal.Legacy.Settings shell-integration-enabled true org.gnome.Terminal.Legacy.Settings theme-variant 'dark' org.gnome.Terminal.Legacy.Settings default-show-menubar true org.gnome.Terminal.Legacy.Settings mnemonics-enabled false org.gnome.Terminal.Legacy.Settings schema-version uint32 3 org.gnome.Terminal.Legacy.Settings encodings ['UTF-8'] org.gnome.Terminal.Legacy.Settings shortcuts-enabled true org.gnome.Terminal.Legacy.Settings tab-policy 'automatic' org.gnome.Terminal.Legacy.Keybindings toggle-menubar 'disabled' org.gnome.Terminal.Legacy.Keybindings reset-and-clear 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-14 'disabled' org.gnome.Terminal.Legacy.Keybindings zoom-normal '0' org.gnome.Terminal.Legacy.Keybindings read-only 'disabled' org.gnome.Terminal.Legacy.Keybindings new-profile 'disabled' org.gnome.Terminal.Legacy.Keybindings zoom-out 'minus' org.gnome.Terminal.Legacy.Keybindings move-tab-left 'Page_Up' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-20 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-21 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-22 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-23 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-24 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-25 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-26 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-27 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-28 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-29 'disabled' org.gnome.Terminal.Legacy.Keybindings zoom-in 'plus' org.gnome.Terminal.Legacy.Keybindings detach-tab 'disabled' org.gnome.Terminal.Legacy.Keybindings move-tab-right 'Page_Down' org.gnome.Terminal.Legacy.Keybindings close-tab 'w' org.gnome.Terminal.Legacy.Keybindings paste 'v' org.gnome.Terminal.Legacy.Keybindings reset 'disabled' org.gnome.Terminal.Legacy.Keybindings new-tab 't' org.gnome.Terminal.Legacy.Keybindings find-previous 'H' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-30 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-31 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-32 'disabled' org.gnome.Terminal.Legacy.Keybindings select-all 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-34 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-35 'disabled' org.gnome.Terminal.Legacy.Keybindings preferences 'disabled' org.gnome.Terminal.Legacy.Keybindings prev-tab 'Page_Up' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-33 'disabled' org.gnome.Terminal.Legacy.Keybindings find-next 'G' org.gnome.Terminal.Legacy.Keybindings find 'F' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-1 '1' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-2 '2' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-3 '3' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-4 '4' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-5 '5' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-6 '6' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-7 '7' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-8 '8' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-9 '9' org.gnome.Terminal.Legacy.Keybindings help 'F1' org.gnome.Terminal.Legacy.Keybindings copy 'c' org.gnome.Terminal.Legacy.Keybindings close-window 'q' org.gnome.Terminal.Legacy.Keybindings new-window 'n' org.gnome.Terminal.Legacy.Keybindings save-contents 'disabled' org.gnome.Terminal.Legacy.Keybindings find-clear 'J' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-10 '0' org.gnome.Terminal.Legacy.Keybindings full-screen 'F11' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-12 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-13 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-11 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-15 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-16 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-17 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-18 'disabled' org.gnome.Terminal.Legacy.Keybindings switch-to-tab-19 'disabled' org.gnome.Terminal.Legacy.Keybindings profile-preferences 'disabled' org.gnome.Terminal.Legacy.Keybindings next-tab 'Page_Down' install ubuntu theme $ sudo add-apt-repository ppa:noobslab/themes $ sudo apt-get update $ sudo apt-get install nokto-theme open font viewer and install font $ sudo gnome-font-viewer ~/Tools/Monaco/Monaco_Linux.TTF show launcher icon $ gsettings get com.canonical.Unity.Launcher favorites ['application://nautilus.desktop', 'application://gnome-terminal.desktop', 'application://firefox.desktop', 'unity://running-apps', 'application://gvim.desktop', 'unity://desktop-icon', 'unity://expo-icon', 'unity://devices'] show the softer renderer $ /usr/lib/nux/unity_support_test -p OpenGL vendor string: VMware, Inc. OpenGL renderer string: Gallium 0.4 on SVGA3D; build: RELEASE; OpenGL version string: 2.1 Mesa 10.1.0 Not software rendered: yes Not blacklisted: yes GLX fbconfig: yes GLX texture from pixmap: yes GL npot or rect textures: yes GL vertex program: yes GL fragment program: yes GL vertex buffer object: yes GL framebuffer object: yes GL version is 1.4+: yes Unity 3D supported: yes specified context menu $ sudo apt-get install nautilus-actions $ nautilus -q $ utilus-actions-config-tool disable ubuntu desktop notification $ sudo chmod -x /usr/lib/notify-osd/notify-osd recode activity as a gif file [!NOTE|label:references:] inspired from here and here $ sudo add-apt-repository ppa:fossfreedom/byzanz $ sudo apt-get update && sudo apt-get install byzanz goldendict installation $ git clone git@github.com:goldendict/goldendict.git $ sudo apt-get install liblzma-dev qt4-qmake hunspell-dev hunspell build-essential libvorbis-dev zlib1g-dev libhunspell-dev x11proto-record-dev libqt4-dev libqtwebkit-dev libxtst-dev liblzo2-dev libbz2-dev libao-dev libavutil-dev libavformat-dev libtiff5-dev $ cd goldendict/ $ qmake-qt4 $ qmake \"CONFIG+=no_epwing_support\" $ make && sudo make install shadowsocks server $ sudo apt install m2crypto git python-pip $ pip install --upgrade pip $ pip install git+https://github.com/shadowsocks/shadowsocks.git@master $ sudo ln -sf /home/marslo/.local/bin/ssserver /usr/local/bin/ssserver start $ sudo bash -c 'cat > /etc/rc.local' client ubuntu $ sudo add-apt-repository ppa:hzwhuang/ss-qt5 Shadowsocks-Qt5 is a cross-platform Shadowsocks GUI client. Shadowsocks is a lightweight tool that helps you bypass firewall(s). This PPA mainly includes packages for Shadowsocks-Qt5, which means it also includes libQtShadowsocks packages. More info: https://launchpad.net/~hzwhuang/+archive/ubuntu/ss-qt5 Press [ENTER] to continue or Ctrl-c to cancel adding it. gpg: keybox '/tmp/tmpaegs6_x4/pubring.gpg' created gpg: /tmp/tmpaegs6_x4/trustdb.gpg: trustdb created gpg: key 6DA746A05F00FA99: public key \"Launchpad PPA for Symeon Huang\" imported gpg: Total number processed: 1 gpg: imported: 1 OK $ sudo apt update $ sudo apt install shadowsocks-qt5 others $ sudo apt install python-pip $ sudo pip install genpac shadowsocks-libev service started by docker image teddysun/shadowsocks-libev $ mkdir -p /etc/shadowsocks-libev $ sudo bash -c \"cat > /etc/shadowsocks-libev/config.json\" started by /etc/init.d/shadowsocks-libev $ wget --no-check-certificate \\ -O shadowsocks-all.sh \\ https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh $ chmod +x shadowsocks-all.sh $ ./shadowsocks-all.sh 2>&1 | tee shadowsocks-all.log ... Which Shadowsocks server you'd select: 1) Shadowsocks-Python 2) ShadowsocksR 3) Shadowsocks-Go 4) Shadowsocks-libev Please enter a number (Default Shadowsocks-Python): 4 You choose = Shadowsocks-libev ... [Info] Starting install package autoconf Do you want install simple-obfs for Shadowsocks-libev? [y/n] (default: n): y You choose = y Please select obfs for simple-obfs: 1) http 2) tls Which obfs you'd select(Default: http): 1 obfs = http ... service$ sudo /etc/init.d/shadowsocks-libev start $ sudo /etc/init.d/shadowsocks-libev stop $ sudo /etc/init.d/shadowsocks-libev restart $ sudo /etc/init.d/shadowsocks-libev status config$ /etc/shadowsocks-libev/config.json { \"server\":\"0.0.0.0\", \"server_port\": 1111, \"password\":\"mypassword\", \"timeout\":300, \"user\":\"nobody\", // optinal \"method\":\"aes-256-cfb\", \"fast_open\":false, \"nameserver\":\"1.0.0.1\", // be careful for dns resolve in private network \"mode\":\"tcp_and_udp\", \"plugin\":\"obfs-server\", \"plugin_opts\":\"obfs=http\" } check status $ sudo lsof -i:1111 $ sudo netstatus -tunpla | grep 1111 client plugin plugin opts simple-obfs obfs=http;obfs-host=www.google.com Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:20:58 "},"linux/ubuntu/systemctl.html":{"url":"linux/ubuntu/systemctl.html","title":"systemctl","keywords":"","body":" ubuntu 17.10 bootup settings [!NOTE|label:references:] How to automatically execute shell script at startup boot on systemd Linux Using systemd to control the Docker daemon systemd_service.5.manual Linux route命令详解：查看和操作IP路由表 ubuntu配置静态路由及重启生效 Systemd的Unit文件; systemctl增加服务详细介绍 SystemdForUpstartUsers ubuntu 17.10 bootup settings create script $ cat /usr/local/bin/do_route.sh #!/usr/bin/env bash # Destination Gateway Genmask Flags Metric Ref Use Iface # 0.0.0.0 192.168.10.1 0.0.0.0 UG 0 0 0 eno2 /sbin/route -n | grep \"0\\.0\\.0\\.0.*192\\.168\\.10\\.1.*eno2\" > /dev/null 2>&1 if [ $? != 0 ]; then sudo route add default gw 192.168.10.1 fi ## Destination Gateway Genmask Flags Metric Ref Use Iface ## 0.0.0.0 130.147.180.65 0.0.0.0 UG 0 0 0 eno1 /sbin/route -n | grep \"0\\.0\\.0\\.0.*130\\.147\\.180\\.65.*eno1\" > /dev/null 2>&1 if [ $? == 0 ]; then sudo route delete -net 0.0.0.0 gw 130.147.180.65 netmask 0.0.0.0 fi host=\"161.92.35.78 130.147.236.5 180.166.223.190 140.207.91.234 42.99.164.34 185.46.212.34\" for _h in ${host}; do sudo route add -host ${_h} gw 130.147.180.65 done route=\"130.147.0.0 130.140.0.0 130.146.0.0 137.55.0.0 161.83.0.0 161.84.0.0 161.85.0.0 161.88.0.0 161.91.0.0 161.92.0.0 185.166.0.0\" for _r in ${route}; do sudo route add -net ${_r} netmask 255.255.0.0 eno1 done touch /home/devops/hi-marslo create service $ ls -altrh /lib/systemd/system/do_route.service -rwxr-xr-x 1 root root 140 Jan 15 22:08 /lib/systemd/system/do_route.service $ cat /lib/systemd/system/do_route.service [Unit] Description=Add static route for two interface [Service] ExecStart=/usr/local/bin/do_route.sh [Install] WantedBy=multi-user.target Alias=myroute.service enable the service $ sudo systemctl enable do_route.service Created symlink /etc/systemd/system/multi-user.target.wants/do_route.service → /lib/systemd/system/do_route.service. Created symlink /etc/systemd/system/myroute.service → /lib/systemd/system/do_route.service. $ sudo systemctl start do_route.service disable the service $ sudo systemctl disable do_route.service Removed /etc/systemd/system/myroute.service. Removed /etc/systemd/system/multi-user.target.wants/do_route.service. re-enable the service $ sudo systemctl enable add_route.service Created symlink /etc/systemd/system/marslo_route.service → /lib/systemd/system/add_route.service. Created symlink /etc/systemd/system/multi-user.target.wants/add_route.service → /lib/systemd/system/add_route.service. route FLags U: Up: 表示此路由当前为启动状态 H: Host: 表示此网关为一主机 G: Gateway: 表示此网关为一路有 R: Reinstate Route: 使用动态路由重新初始化的路由 D: Dynamically: 此路由是动态性的写入 M: Modifed: 此路由是有路由守护程序或导向器动态修改 !: 关闭状态 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 17:11:34 "},"linux/ubuntu/x.html":{"url":"linux/ubuntu/x.html","title":"x","keywords":"","body":" get screen solution screen sharing setup screen sharing start x server backup and restore config read all conf reset vnc password check using wayland or xorg start application remotely gdm gnome-shell autologin login session default session process and subprocesses pstree ps Wayland wayland known error [!NOTE|label:references:] GDM Reference Manual GNOME How to configure Vino for remote desktop access using command line Vino Vino. The Remote Desktop Project VND/Servers get screen solution $ xrandr --verbose Screen 0: minimum 320 x 200, current 1920 x 1080, maximum 8192 x 8192 XWAYLAND0 connected 1920x1080+0+0 (0x22) normal (normal left inverted right x axis y axis) 480mm x 270mm Identifier: 0x21 Timestamp: 3807 Subpixel: unknown Gamma: 1.0:1.0:1.0 Brightness: 0.0 Clones: CRTC: 0 CRTCs: 0 Transform: 1.000000 0.000000 0.000000 0.000000 1.000000 0.000000 0.000000 0.000000 1.000000 filter: 1920x1080 (0x22) 173.000MHz -HSync +VSync *current +preferred h: width 1920 start 2048 end 2248 total 2576 skew 0 clock 67.16KHz v: height 1080 start 1083 end 1088 total 1120 clock 59.96Hz screen sharing setup screen sharing #!/usr/bin/env bash export DISPLAY=:0 read -e -p \"VNC Password: \" -i \"ubuntu\" password dconf write /org/gnome/desktop/remote-access/enabled true dconf write /org/gnome/desktop/remote-access/prompt-enabled false dconf write /org/gnome/desktop/remote-access/authentication-methods \"['vnc']\" dconf write /org/gnome/desktop/remote-access/require-encryption false08/03/2018 dconf write /org/gnome/desktop/remote-access/vnc-password \\\"\\'$(echo -n $password | base64)\\'\\\" dconf dump /org/gnome/desktop/remote-access/ ## sudo service lightdm restart or $ read -e -p \"VNC Password: \" -i \"ubuntu\" VNCPASSWORD $ dconf write /org/gnome/desktop/remote-access/enabled true $ dconf write /org/gnome/desktop/remote-access/authentication-methods \"['vnc']\" $ dconf write /org/gnome/desktop/remote-access/prompt-enabled false $ dconf write /org/gnome/desktop/remote-access/require-encryption false $ dconf write /org/gnome/desktop/remote-access/vnc-password \\\"\\'$(echo -n $VNCPASSWORD | base64)\\'\\\" $ sudo service lightdm restart or $ vino-preference $ dconf-editor start x server $ export DISPLAY=:0 $ /usr/lib/vino/vino-server --display=:0 & backup and restore config $ dconf dump /org/gnome/desktop/remote-access/ > ubuntu1804_remoteaccess $ cat ubuntu1804_remoteaccess [/] require-encryption=false vnc-password='bWFyc2xv' authentication-methods=['vnc'] prompt-enabled=false $ dconf load /org/gnome/desktop/remote-access/ read all conf $ for i in $(gsettings list-keys org.gnome.Vino); do echo -e \"$i:\\t --> \"$(dconf read /org/gnome/desktop/remote-access/$i); done notify-on-connect: --> alternative-port: --> disable-background: --> use-alternative-port: --> icon-visibility: --> use-upnp: --> view-only: --> prompt-enabled: --> false disable-xdamage: --> authentication-methods: --> ['vnc'] network-interface: --> require-encryption: --> false mailto: --> lock-screen-on-disconnect: --> vnc-password: --> 'bWFyc2xv' reset vnc password $ echo -n 'awesome' | base64 $ gconftool-2 -s -t string /desktop/gnome/remote_access/vnc_password $(echo -n \"\" | base64) $ gconftool-2 --type string --set /desktop/gnome/remote_acess/vnc_password '123456' or$ echo -n \"marslo\" | base64 bWFyc2xv check using wayland or xorg $ echo $XDG_SESSION_TYPE Ubuntu: Wayland (Wayland) Ubuntu on Xorg: Xorg (X11) start application remotely $ export DISPLAY=:0 $ gnome-terminal gdm $ cat /lib/systemd/system/gdm.service [Unit] Description=GNOME Display Manager ## replaces the getty Conflicts=getty@tty1.service After=getty@tty1.service ## replaces plymouth-quit since it quits plymouth on its own Conflicts=plymouth-quit.service After=plymouth-quit.service ## Needs all the dependencies of the services it's replacing ## pulled from getty@.service and plymouth-quit.service ## (except for plymouth-quit-wait.service since it waits until ## plymouth is quit, which we do) After=rc-local.service plymouth-start.service systemd-user-sessions.service ## GDM takes responsibility for stopping plymouth, so if it fails ## for any reason, make sure plymouth still stops OnFailure=plymouth-quit.service [Service] ExecStartPre=/usr/share/gdm/generate-config ExecStart=/usr/sbin/gdm3 KillMode=mixed Restart=always RestartSec=1s IgnoreSIGPIPE=no BusName=org.gnome.DisplayManager StandardOutput=syslog StandardError=inherit EnvironmentFile=-/etc/default/locale ExecReload=/usr/share/gdm/generate-config ExecReload=/bin/kill -SIGHUP $MAINPID gnome-shell autologin login with desired session $ cat /var/lib/AccountsService/users/devops [User] FormatsLocale=en_US.UTF-8 XSession=gnome-xorg SystemAccount=false [InputSource0] xkb=us auto login with gdm $ grep -i auto /etc/gdm3/custom.conf [daemon] ## Enabling automatic login AutomaticLoginEnable = true AutomaticLogin = devops auto login with delay $ grep -i time /etc/gdm3/custom.conf [daemon] ## Enabling timed login ## TimedLoginEnable = true ## TimedLogin = user1 ## TimedLoginDelay = 10 login session default session $ cat /etc/X11/default-display-manager /usr/sbin/gdm3 process and subprocesses pstree $ pstree 1391 gdm3─┬─gdm-session-wor─┬─gdm-x-session─┬─Xorg───{Xorg} │ │ ├─gnome-session-b─┬─deja-dup-monito───4*[{deja-dup-monito}] │ │ │ ├─gnome-software───3*[{gnome-software}] │ │ │ ├─gsd-a11y-settin───3*[{gsd-a11y-settin}] │ │ │ ├─gsd-clipboard───2*[{gsd-clipboard}] │ │ │ ├─gsd-color───3*[{gsd-color}] │ │ │ ├─gsd-datetime───3*[{gsd-datetime}] │ │ │ ├─gsd-disk-utilit───2*[{gsd-disk-utilit}] │ │ │ ├─gsd-housekeepin───3*[{gsd-housekeepin}] │ │ │ ├─gsd-keyboard───3*[{gsd-keyboard}] │ │ │ ├─gsd-media-keys───3*[{gsd-media-keys}] │ │ │ ├─gsd-mouse───3*[{gsd-mouse}] │ │ │ ├─gsd-power───3*[{gsd-power}] │ │ │ ├─gsd-print-notif───2*[{gsd-print-notif}] │ │ │ ├─gsd-rfkill───2*[{gsd-rfkill}] │ │ │ ├─gsd-screensaver───2*[{gsd-screensaver}] │ │ │ ├─gsd-sharing───3*[{gsd-sharing}] │ │ │ ├─gsd-smartcard───4*[{gsd-smartcard}] │ │ │ ├─gsd-sound───3*[{gsd-sound}] │ │ │ ├─gsd-wacom───2*[{gsd-wacom}] │ │ │ ├─gsd-xsettings───3*[{gsd-xsettings}] │ │ │ ├─nautilus-deskto───3*[{nautilus-deskto}] │ │ │ ├─ssh-agent │ │ │ ├─update-notifier───3*[{update-notifier}] │ │ │ └─3*[{gnome-session-b}] │ │ └─2*[{gdm-x-session}] │ └─2*[{gdm-session-wor}] └─2*[{gdm3}] ps $ ps auxwwf /usr/sbin/gdm3 \\_ gdm-session-worker [pam/gdm-autologin] \\_ /usr/lib/gdm3/gdm-x-session --run-script env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu \\_ /usr/lib/xorg/Xorg vt1 -displayfd 3 -auth /run/user/1000/gdm/Xauthority -background none -noreset -keeptty -verbose 3 \\_ /usr/lib/gnome-session/gnome-session-binary --session=ubuntu \\_ /usr/bin/ssh-agent /usr/bin/im-launch env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu \\_ /usr/lib/gnome-settings-daemon/gsd-power \\_ /usr/lib/gnome-settings-daemon/gsd-print-notifications \\_ /usr/lib/gnome-settings-daemon/gsd-rfkill \\_ /usr/lib/gnome-settings-daemon/gsd-screensaver-proxy \\_ /usr/lib/gnome-settings-daemon/gsd-sharing \\_ /usr/lib/gnome-settings-daemon/gsd-smartcard \\_ /usr/lib/gnome-settings-daemon/gsd-sound \\_ /usr/lib/gnome-settings-daemon/gsd-xsettings \\_ /usr/lib/gnome-settings-daemon/gsd-wacom \\_ /usr/lib/gnome-settings-daemon/gsd-clipboard \\_ /usr/lib/gnome-settings-daemon/gsd-a11y-settings \\_ /usr/lib/gnome-settings-daemon/gsd-datetime \\_ /usr/lib/gnome-settings-daemon/gsd-color \\_ /usr/lib/gnome-settings-daemon/gsd-keyboard \\_ /usr/lib/gnome-settings-daemon/gsd-housekeeping \\_ /usr/lib/gnome-settings-daemon/gsd-mouse \\_ /usr/lib/gnome-settings-daemon/gsd-media-keys \\_ /usr/lib/gnome-disk-utility/gsd-disk-utility-notify \\_ /usr/bin/gnome-software --gapplication-service \\_ nautilus-desktop \\_ update-notifier \\_ /usr/lib/deja-dup/deja-dup-monitor $ ps auxwwf root 1391 0.0 0.1 308176 8340 ? Ssl 16:58 0:00 /usr/sbin/gdm3 root 1456 0.0 0.1 271860 8720 ? Sl 16:58 0:00 \\_ gdm-session-worker [pam/gdm-autologin] devops 1497 0.0 0.0 212124 6000 tty1 Ssl+ 16:58 0:00 \\_ /usr/lib/gdm3/gdm-x-session --run-script env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu devops 1499 0.4 1.0 370392 81984 tty1 Sl+ 16:58 0:02 \\_ /usr/lib/xorg/Xorg vt1 -displayfd 3 -auth /run/user/1000/gdm/Xauthority -background none -noreset -keeptty -verbose 3 devops 1518 0.0 0.1 716920 15716 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-session/gnome-session-binary --session=ubuntu devops 1599 0.0 0.0 11304 320 ? Ss 16:58 0:00 \\_ /usr/bin/ssh-agent /usr/bin/im-launch env GNOME_SHELL_SESSION_MODE=ubuntu gnome-session --session=ubuntu devops 2471 0.0 0.2 527336 23468 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-power devops 2472 0.0 0.1 349316 10144 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-print-notifications devops 2475 0.0 0.0 423340 5728 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-rfkill devops 2481 0.0 0.0 275728 5048 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-screensaver-proxy devops 2485 0.0 0.1 471340 11980 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-sharing devops 2493 0.0 0.1 466472 10096 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-smartcard devops 2495 0.0 0.1 343116 9808 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-sound devops 2499 0.0 0.2 504824 23460 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-xsettings devops 2511 0.0 0.2 440656 22568 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-wacom devops 2530 0.0 0.2 355824 21572 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-clipboard devops 2531 0.0 0.1 296660 8348 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-a11y-settings devops 2532 0.0 0.1 476600 15176 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-datetime devops 2536 0.0 0.3 678216 24396 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-color devops 2537 0.0 0.2 508124 22096 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-keyboard devops 2539 0.0 0.1 374712 8804 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-housekeeping devops 2542 0.0 0.1 296672 8284 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-mouse devops 2545 0.0 0.3 1155368 24656 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-settings-daemon/gsd-media-keys devops 2589 0.0 0.0 271928 6216 tty1 Sl+ 16:58 0:00 \\_ /usr/lib/gnome-disk-utility/gsd-disk-utility-notify devops 2590 0.4 1.8 1318392 152212 tty1 SLl+ 16:58 0:02 \\_ /usr/bin/gnome-software --gapplication-service devops 2599 0.2 0.9 1197708 75864 tty1 Sl+ 16:58 0:01 \\_ nautilus-desktop devops 3686 0.0 0.3 605436 28680 tty1 Sl+ 16:59 0:00 \\_ update-notifier devops 4017 0.0 0.4 118225468 32448 tty1 Sl+ 17:00 0:00 \\_ /usr/lib/deja-dup/deja-dup-monitor Wayland wayland known error cat Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:11:08 "},"linux/rpi.html":{"url":"linux/rpi.html","title":"rpi","keywords":"","body":" Raspberry Pi repository jdk Raspberry Pi [!NOTE|label:references:] * debian/dists/bullseye How to install and use Java 11 and JavaFX 11 on Raspberry Pi boards with ARMv6 processor bellsoft: Liberica JDK Download Center bellsoft: Liberica JDK 11.0.2 Install Guide How to Install Java on Raspberry Pi raspbian.raspberrypi.org: openjdk-11 PiJava - Part 2 - Installing Java 11 on a Raspberry PI 3 Model B+ How to Update Java on Raspberry Pi Upgrading your Raspberry Pi to Bullseye Raspbian Mirrors How to change the Repository Mirror on Raspbian repository /etc/apt/source.list $ cat /etc/apt/sources.list deb http://raspbian.raspberrypi.org/raspbian/ bullseye main contrib non-free rpi # Uncomment line below then 'apt-get update' to enable 'apt-get source' # deb-src http://raspbian.raspberrypi.org/raspbian/ bullseye main contrib non-free rpi # or $ cat /etc/apt/sources.list deb http://raspbian.raspberrypi.org/raspbian/ bullseye main contrib non-free rpi deb http://deb.debian.org/debian bullseye main contrib non-free deb http://security.debian.org/debian-security bullseye-security main contrib non-free deb http://deb.debian.org/debian bullseye-updates main contrib non-free /etc/apt/sources.list.d/raspi.list $ cat /etc/apt/sources.list.d/raspi.list deb http://archive.raspberrypi.org/debian/ bullseye main # Uncomment line below then 'apt-get update' to enable 'apt-get source' # deb-src http://archive.raspberrypi.org/debian/ bullseye main jdk [!NOTE|label:references:] * iMarslo: jdk/bellsoft Liberica jdk : all versions Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 18:10:10 "},"programming/groovy/groovy.html":{"url":"programming/groovy/groovy.html","title":"programming","keywords":"","body":" basic Program structure Customizable Operators Special Operators method and class Named parameters elvis operator if/elseif{if}/else execute shell commands in groovy Get STDERR & STDERR Show output during the process with environment groovyConsole environment get console details font download apach software foundatin distribution directory groovy 2.4.21 2.5.19 3.0.13 4.0.6 reference: * Groovy Language Documentation * Groovy Scripting Reference groovy basics groovy tips and techniques * groovy cheatsheet * Groovy Cookbook * varargs in Groovy varargs : Variable Arguments (Varargs) in Java online compiler http://www.cheat-sheets.org/saved-copy/rc015-groovy_online.pdf Syntax Five Cool Things You Can Do With Groovy Scripts Java SE Specifications download The Java Language Specification, Java SE 19 Edition : pdf | html The Java Language Specification, Java SE 18 Edition : pdf | html The Java Language Specification, Java SE 17 Edition : pdf | html The Java Language Specification, Java SE 16 Edition : pdf | html The Java Language Specification, Java SE 15 Edition : pdf | html The Java Language Specification, Java SE 14 Edition : pdf | html The Java Language Specification, Java SE 13 Edition : pdf | html The Java Language Specification, Java SE 12 Edition : pdf | html The Java Language Specification, Java SE 11 Edition : pdf | html [!TIP] Java Tutorial : Java Exception Handling Java Tips, How-tos etc Java JSON Tutorial Java Logging Java Performance Java Regex - Java Regular Expressions Java Unit Testing basic Program structure Customizable Operators Operator Method a + b a.plus(b) a - b a.minus(b) a * b a.multiply(b) a / b a.div(b) a % b a.mod(b) a++ or ++a a.next() assert [ a: true, b: false ] + [ a: false ] == [ a: false, b: false ] assert [ a: true, b: false ] difference +(plus) and (left shift) : is to add into left hand map + it constructs a new Map based on the LHS` Special Operators Operator Meaning Name a ? b : c if(a) b else c ternary if a ?: b a ? a : b Elvis a.?b ( a==null ) ? a : a.b null safe a(*list) a(list[0], list[1], ...) spread list*.a() [list[0].a, list[1].a, ...] spread-out a.&b reference to method b in object a as closure method closure a.@field direct field access dot-at .& : Method pointer operator def str = 'example of method reference' def fun = str.&toUpperCase assert fun() == str.toUpperCase() println fun() // result EXAMPLE OF METHOD REFERENCE class Person { String name Integer age } def list = [ new Person( name: 'Bob' , age: 42 ) , new Person( name: 'Julia' , age: 35 ) ] String describe(Person p) { \"$p.name is $p.age\" } def action = this.&describe def transform( List elements, Closure action ) { elements.inject([]){ result, e -> result method and class [!NOTE] Class members Positional parameters Named parameters Varargs Named parameters def foo ( Map m ) { println \"${m.name} : ${m.age}\" } assert foo( name: 'marslo', age: '18' ) == 'marslo : 18' Mixing named and positional parameters def foo ( Map m, Integer i ) { println \"${m.name} : ${m.age} : ${i}\" } assert foo( name: 'marslo', age: '18', 123 ) == 'marslo : 18 : 123' elvis operator if/elseif{if}/else references: 5.3. Elvis operator Groovy Goodness: The Elvis Assignment Operator usage ?: ( existing Elvis operator )displayName = user.name ? user.name : 'Anonymous' displayName = user.name ?: 'Anonymous' ?= ( new elvis assignment shorthand )name = name ?: 'Hydrogen' // existing Elvis operator atomicNumber ?= 2 // new Elvis assignment shorthand condition: if fruits is 'apple' or 'orange', get pre-defined number 5 ( number = 5 ) if fruits is watermelon, get particular given numbers. number cannot be null // by using if/elseif{if}/else Map option = [:] if ( [ 'apple', 'orange' ].contains(fruits) ) { option = [ \"${fruits}\" : '5' ] } else if ( [ 'watermelon' ].contains(fruits) ) { if (number) { option = [ \"${fruits}\" : number ] } } else { println( 'ERROR: number CANNOT be empty while fruits is watermelon. Exit ...' ) } // by using elvis operator Map option = ( [ 'apple', 'orange' ].contains(fruits) ) ? [ \"${fruits}\" : '5' ] : ( [ 'watermelon' ].contains(fruits) ) ? ( number ) ? [ \"${fruits}\" : number ] : println( 'ERROR: number CANNOT be empty while fruits is watermelon. Exit ...' ) : [:] example Closure option = { String fruits, String number = '' -> ( [ 'apple', 'orange' ].contains(fruits) ) ? [ (fruits) : '5' ] : ( [ 'watermelon' ].contains(fruits) ) ? ( number ) ? [ (fruits) : number ] : println( 'ERROR: number CANNOT be empty while fruits is watermelon. Exit ...' ) : [:] } assert option('apple') == ['apple' : '5'] assert option('watermelon', '100') == [ 'watermelon' : '100' ] using [ \"${fruits}\" : '5' ], the class of key is class org.codehaus.groovy.runtime.GStringImpl using [ (fruits) : '5' ] , the class of key is class java.lang.String execute shell commands in groovy reference 101 groovy script - Execute commands Jenkins Groovy script to execute shell commands java.lang.Process gist: Run shell command in groovy Get STDERR & STDERR [!TIP] using new StringBuffer() or new StringBuilder() i.e.: def stdout = new StringBuffer(), stderr = new StringBuffer() def proc = \"cmd\".execute() proc.waitForProcessOutput( stdout, stderr ) int exitCode = proc.exitValue() println( (exitCode == 0) ? stdout : \"exit with ${exitCode}. error: ${stderr}\" ) def stdout = new StringBuilder(), stderr = new StringBuilder() def proc = \"ls /tmp/NoFile\".execute() proc.consumeProcessOutput( stdout, stderr ) proc.waitForOrKill( 1000 ) int exitCode = proc.exitValue() println( ( exitCode == 0 ) ? stdout : \"error with exit code ${exitCode}.\\nSTDERR: ${stderr}\" ) or def stdout = new StringBuilder(), stderr = new StringBuilder() def proc = 'ls /tmp/NoFile'.execute() proc.consumeProcesstdoutput( stdout, stderr ) proc.waitForOrKill(1000) println( stdout ? \"out> \\n${stdout}\" : '' + stderr ? \"err> \\n${stderr}\" : '' ) Show output during the process using System.out and System.err def proc = \"ls /tmp/NoFile\".execute() proc.waitForProcessOutput( System.out, System.err ) proc.waitForOrKill(1000) int exitCode = proc.exitValue() if ( exitCode != 0 ) { println \"error with exit code ${exitCode}.\" } with environment def envVars = [\"GROOVY_HOME=/fake/path/groovy-3.0.7\", \"CLASSPATH=.:/fake/path/groovy-3.0.7/lib\"] def proc = './run.sh'.execute( envVars, new File(\".\") ) proc.waitForProcessOutput( System.out, System.err ) int exitCode = proc.exitValue() println( (exitCode != 0) ? \"exit with ${exitCode}\" : '' ) run.sh env echo ${GROOVY_HOME} result with system environment List envVars = System.getenv().collect { k, v -> \"${k}=${v}\" } def proc = \"./run.sh\".execute( envVars, new File(\".\") ) proc.waitForProcessOutput( System.out, System.err ) int exitCode = proc.exitValue() println( (exitCode != 0) ? \"exit with ${exitCode}\" : '' ) with partular path reference: groovy execute shell with environment and working dir def command = \"git log -1\" def proc = command.execute( null, new File('/path/to/folder') ) proc.waitFor() println \"\"\" ${proc.err.text ?: ''} ${proc.in.text ?: ''} Process exit code: ${proc.exitValue()} \"\"\" groovyConsole environment [!NOTE] System.setProperty(\"file.encoding\",\"UTF-8\") font setup for groovyConsole Groovy console > setx JAVA_OPT '-Dfile.encoding=UTF-8 -Dsun.jnu.encoding=UTF-8' > setx GROOVY_OPT '-Dfile.encoding=UTF-8' > setx JAVA_TOOL_OPTIONS '-Dfile.encoding=UTF-8' get console details charset import java.nio.charset.Charset System.out.println( String.format(\"file.encoding: %s\", System.getProperty(\"file.encoding\")) ); System.out.println( String.format(\"defaultCharset: %s\", Charset.defaultCharset().name()) ); resultfile.encoding: UTF-8 defaultCharset: UTF-8 font [!NOTE|label:references:] GROOVY-6303: Add ability to use a different font for the input/output area of Groovy Console windows : add font/Name into HKEY_CURRENT_USER\\SOFTWARE\\JavaSoft\\Prefs\\groovy\\console\\ui> REG ADD \"HKCU\\SOFTWARE\\JavaSoft\\Prefs\\groovy\\console\\ui\" /v \"font/Name\" /t REG_SZ /d \"Monaco\" /f linux : add fontName into ~/.java/.userPrefs/groovy/ui/prefs.xml macox : add fontName into ~/Library/Preferences/com.apple.java.JavaPreferences.plist Groovy Goodness: Customize Groovy Console Visual Output check font javax.swing.UIManager.getLookAndFeelDefaults() // or javax.swing.UIManager.getLookAndFeelDefaults().each { println \"... ${it.key} : ${it.value}\" } or import java.awt.Font for (Map.Entry entry : javax.swing.UIManager.getDefaults().entrySet()) { Object key = entry.getKey(); Object value = javax.swing.UIManager.get(key); if (value != null && value instanceof javax.swing.plaf.FontUIResource) { println \".. ${key} : ${value}\" } } .. FormattedTextField.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. MenuItem.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. InternalFrame.titleFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. RadioButton.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. RadioButton.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. OptionPane.buttonFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ToolTip.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. FormattedTextField.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Panel.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. RadioButtonMenuItem.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. OptionPane.messageFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. PopupMenu.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. CheckBoxMenuItem.acceleratorFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. MenuItem.acceleratorFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. CheckBoxMenuItem.acceleratorFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. RadioButtonMenuItem.acceleratorFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. RadioButtonMenuItem.acceleratorFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TabbedPane.smallFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Panel.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. OptionPane.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. EditorPane.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Label.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ComboBox.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Button.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. MenuBar.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Tree.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Tree.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ToolBar.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Button.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ComboBox.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Label.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. EditorPane.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Menu.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TextArea.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TextField.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Spinner.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. CheckBoxMenuItem.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Spinner.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TextField.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. IconButton.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. InternalFrame.titleFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. OptionPane.messageFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Menu.acceleratorFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Menu.acceleratorFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ToolBar.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TitledBorder.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Menu.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. FileChooser.listFont : javax.swing.plaf.FontUIResource[family=Segoe UI,name=Segoe UI,style=plain,size=12] .. ToolTip.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TitledBorder.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. OptionPane.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. MenuBar.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TextArea.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. OptionPane.buttonFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. CheckBoxMenuItem.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. InternalFrame.optionDialogTitleFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. InternalFrame.paletteTitleFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Table.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. CheckBox.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. List.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ToggleButton.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ScrollPane.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ScrollPane.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ToggleButton.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. List.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ColorChooser.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. CheckBox.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ColorChooser.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Table.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. MenuItem.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TableHeader.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TextPane.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Viewport.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ProgressBar.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. PasswordField.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TabbedPane.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Slider.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Slider.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TabbedPane.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. RadioButtonMenuItem.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. PasswordField.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. ProgressBar.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TableHeader.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. TextPane.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. MenuItem.acceleratorFont : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. Viewport.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] .. PopupMenu.font : javax.swing.plaf.FontUIResource[family=Dialog,name=Monaco,style=plain,size=14] modify font import javax.swing.plaf.FontUIResource import javax.swing.UIManager import java.awt.Font UIManager.put(\"Panel.font\", new FontUIResource(new Font (\"Monaco\", Font.PLAIN, 16))); other options [!NOTE|label:references:] Swing UIManager Keys private void setFont(FontUIResource myFont) { UIManager.put(\"CheckBoxMenuItem.acceleratorFont\", myFont); UIManager.put(\"Button.font\", myFont); UIManager.put(\"ToggleButton.font\", myFont); UIManager.put(\"RadioButton.font\", myFont); UIManager.put(\"CheckBox.font\", myFont); UIManager.put(\"ColorChooser.font\", myFont); UIManager.put(\"ComboBox.font\", myFont); UIManager.put(\"Label.font\", myFont); UIManager.put(\"List.font\", myFont); UIManager.put(\"MenuBar.font\", myFont); UIManager.put(\"Menu.acceleratorFont\", myFont); UIManager.put(\"RadioButtonMenuItem.acceleratorFont\", myFont); UIManager.put(\"MenuItem.acceleratorFont\", myFont); UIManager.put(\"MenuItem.font\", myFont); UIManager.put(\"RadioButtonMenuItem.font\", myFont); UIManager.put(\"CheckBoxMenuItem.font\", myFont); UIManager.put(\"OptionPane.buttonFont\", myFont); UIManager.put(\"OptionPane.messageFont\", myFont); UIManager.put(\"Menu.font\", myFont); UIManager.put(\"PopupMenu.font\", myFont); UIManager.put(\"OptionPane.font\", myFont); UIManager.put(\"Panel.font\", myFont); UIManager.put(\"ProgressBar.font\", myFont); UIManager.put(\"ScrollPane.font\", myFont); UIManager.put(\"Viewport.font\", myFont); UIManager.put(\"TabbedPane.font\", myFont); UIManager.put(\"Slider.font\", myFont); UIManager.put(\"Table.font\", myFont); UIManager.put(\"TableHeader.font\", myFont); UIManager.put(\"TextField.font\", myFont); UIManager.put(\"Spinner.font\", myFont); UIManager.put(\"PasswordField.font\", myFont); UIManager.put(\"TextArea.font\", myFont); UIManager.put(\"TextPane.font\", myFont); UIManager.put(\"EditorPane.font\", myFont); UIManager.put(\"TabbedPane.smallFont\", myFont); UIManager.put(\"TitledBorder.font\", myFont); UIManager.put(\"ToolBar.font\", myFont); UIManager.put(\"ToolTip.font\", myFont); UIManager.put(\"Tree.font\", myFont); UIManager.put(\"FormattedTextField.font\", myFont); UIManager.put(\"IconButton.font\", myFont); UIManager.put(\"InternalFrame.optionDialogTitleFont\", myFont); UIManager.put(\"InternalFrame.paletteTitleFont\", myFont); UIManager.put(\"InternalFrame.titleFont\", myFont); } setFont(new FontUIResource(new Font(\"Monaco\", Font.PLAIN, 14))); Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/groovy/groovydoc.html":{"url":"programming/groovy/groovydoc.html","title":"groovydoc","keywords":"","body":" Generate Groovy API doc from command line Generate Groovy API doc from command line credit belongs to HOW-TO Documenting Groovy with Groovydoc references: Documentation Comment Specification for the Standard Doclet (JDK 17) references: javadoc - The Java API Documentation Generator How and When To Deprecate APIs How to Write Doc Comments for the Javadoc Tool Chapter 10. Documentation with Javadoc $ groovydoc -classpath /usr/local/Cellar/groovy/3.0.1/libexec/lib/ \\ -d output \\ -windowtitle \"Groovy Logging Example\" \\ -header \"Groovy 1.8 Logging (Inspired by Actual Events)\" \\ -footer \"Inspired by Actual Events: Logging in Groovy 1.8\" \\ -doctitle \"Logging in Groovy 1.8 Demonstrated\" \\ *.groovy *.java Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/groovy/map.html":{"url":"programming/groovy/map.html","title":"map","keywords":"","body":" change Map in condition filter filter via condition find a string in a nested Map by using recursive function find a string exists in a list of Map merge two maps for > for >> merge and sum map withDefault merge maps get key or value from nested Map find parent key via sub-key: find value belongs to which key findResult & findResults find deep in nested map inject collect & collectMany collectEntries collect grep with sort traverse refenrece: Groovy Cookbook Groovy Cookbook: How to merge two maps in Groovy? change Map in condition [ 'a': 1, 'b': 2, 'c': 3 ].collectEntries { ( it.value > 1 ) ? [ \"${it.key}\" : 4 ] : it } ===> [a:1, b:4, c:4] or [ it.key, 4 ][ 'a': 1, 'b': 2, 'c': 3 ].collectEntries { ( it.value > 1 ) ? [ it.key, 4 ] : it } or [ (it.key) : 4 ][ 'a': 1, 'b': 2, 'c': 3 ].collectEntries { ( it.value > 1 ) ? [ (it.key) : 4 ] : it } filter filter via condition [ 'a': 1, 'b': 2, 'c': 3 ].findAll{ it.value > 1 }.collectEntries { [ it.key, 4 ] } ===> [b:4, c:4] find a string in a nested Map by using recursive function def hasValue( Map m, String value ) { m.containsValue(value) || m.values().find { v -> v instanceof Map && hasValue(v, value) } } another version inspired by stackoverflow: How to search value by key from Map as well as Nested Map def hasValue( Map m, String value ) { if ( m.containsValue(value) ) return m.containsValue(value) m.findResult { k, v -> v instanceof Map ? hasValue(v, value) : null } } find a string exists in a list of Map def isTargetExists( Map m, String subKey, String value ) { def map = m.findAll { it.value instanceof Map }.collect { it.key } return m.subMap(map).any { k, v -> v.get(subKey, []).contains(value) } } Map> matrix = [ dev : [ user: ['dev1', 'dev2', 'dev3'] , passwd: '123456', customer: ['yahoo', 'bing'] ] , staging : [ user: ['stg1', 'stg2', 'stg3'] , passwd: 'abcdefg' , customer: ['google', 'huawei'] ] , prod : [ user: ['prod1', 'prod2', 'prod3'] , passwd: 'a1b2c3d4' ] ] assert isTargetExists( matrix, 'user', 'dev4' ) == false assert isTargetExists( matrix, 'customer', 'huawei' ) == true merge two maps for > Closure merger = { Map newMap, Map currentMap -> currentMap.inject(newMap.clone()) { merged, entry -> merged[entry.key] = merged.getOrDefault( entry.key, [] ) + entry.value merged } } for >> def m1 = [ k1: [ l1: ['s1', 's2']]] def m2 = [ k1: [ l1: ['s3', 's4']], k2: [ l2: ['x1', 'x2']] ] def accumulator = [:].withDefault{ [:].withDefault{ [] } } Closure merger merger = { Map trg, Map m -> m.each{ k, v -> switch( v instanceof java.util.LinkedHashMap ){ case true : merger trg[ k ], v ; break ; case false : trg[ k ].addAll v ; break ; } } } [ m1, m2 ].each merger.curry( accumulator ) assert accumulator == [k1:[l1:['s1', 's2', 's3', 's4']], k2:[l2:['x1', 'x2']]] merge and sum preconditions: Map m1 = [ a : 10, b : 2, c : 3 ] Map m2 = [ b : 3, c : 2, d : 5 ] List> maps = [ m1, m2 ] merge values into list maps.sum { it.keySet() }.collectEntries { key -> [key, maps.findResults { it[key] } ] } // result // [a:[10], b:[2, 3], c:[3, 2], d:[5]] sum lists def process( List maps ) { maps.sum { it.keySet() }.collectEntries { key -> [ key, maps.findResults { it[key] }.sum() ] } } or more elegant way via Clousre: > ```groovy > Closure getSum = { x -> x.sum() } > getSum( [1,2,3,4] ) == 10 > ``` def process( List maps ) { Closure getSum = { x -> x.sum() } maps.sum { it.keySet() }.collectEntries { key -> [ key, getSum(maps.findResults { it[key] }) ] } } which can be extended to: def process( List maps, Closure closure ) { maps.sum { it.keySet() }.collectEntries { key -> [ key, closure(maps.findResults { it[key] }) ] } } // merge maps and get sum process(maps){ x -> x.sum() } // [a:10, b:5, c:5, d:5] // merge maps and get product process(maps){ x -> x.inject(1) { sum, n -> sum * n } // [a:10, b:6, c:6, d:5] // merge maps and get the biggest item process(maps){ x -> x.inject(x[0]) { biggest, n -> biggest > n ? biggest : n } } // [a:10, b:3, c:3, d:5] map withDefault objective: [a:1,b:2,c:2] ⇣⇣ [1:['a'], 2:['b','c']] * iMarslo: groupBy def newMap = [:].withDefault { [] } [ a:1, b:2, c:2 ].each { key, val -> newMap[val] alternative [ a:1, b:2, c:2 ].inject([:].withDefault{[]}) { map, k, v -> map[v] result:[ 1:['a'], 2:['b', 'c'] ] alternatives [ a:1, b:2, c:2 ].groupBy{ it.value } .collectEntries{ k, v -> [ (k): v.collect{ it.key } ] } result:[ 1:['a'], 2:['b', 'c'] ] merge maps Map map1 = [x: 1, y: 2] Map map2 = [z: 3] Map merged = map1.withDefault(map2.&get) assert map1 == merged // quit interesting assert 3 == merged.get('z') result[ 'x':1, 'y':2 ] get key or value from nested Map insprired from : How to find a map key by value of nested map in Groovy objective: Map> map = [ k1 : [ k11 : 'v11' ] , k2 : [ k11 : 'v21' ] , k3 : [ k11 : 'v31' ] ] ⇣⇣ findKeyBelongsTo( 'k11' ) » 'k1' findValueBelongsTo( 'v31' ) » 'k3' find parent key via sub-key: try online def findKeyBelongsTo( Map map, String keyword ) { map.find { keyword in it.value.keySet() }?.key } find in nested map recursively :def findKeyBelongsTo( Map map, String keyword ) { map.findResult { k, v -> v instanceof Map ? v.containsKey(keyword) ? k : findKeyBelongsTo( v, keyword ) : null } } find value belongs to which key find parent key via sub-value: try online def findValueBelongsTo( Map map, String keyword ) { map.find { keyword in it.value.values() }?.key } find in nested map recursively (according to value): def findValueBelongsTo( Map map, String keyword ) { map.findResult { k, v -> v instanceof Map ? v.containsValue(keyword) ? k : findValueBelongsTo( v, keyword ) : null } } find in mixed map & list object recursively : [!TIP] Map LOGGER = [ info : [ 'info', 'i' ], warnning : [ 'warning' , 'warn', [ 'key' : 'value' ] , 'w' ] , error : [ 'error', 'err', 'e'] ] ⇣⇣ assert 'info' == findValueBelongsTo( LOGGER , 'i' ) assert 'warning' == findValueBelongsTo( LOGGER , 'value' ) assert 'error' == findValueBelongsTo( LOGGER , 'err' ) find in mixed map & list: try online def findValueBelongsTo = { Map map, String keyword -> map.find { k, v -> v instanceof Map ? v.containsKey( keyword ) ? k : findValueBelongsTo(v, keyword) : v.contains( keyword ) ?: v.any{ it instanceof Map } ? findValueBelongsTo( v.findAll{ it instanceof Map }.inject([:]) { i, m -> m find in mixed map & list object recursively with Closure: [!TIP] call() will be abnormal in recursive calls in Closure Closure findValueBelongsTo findValueBelongsTo = { Map map, String keyword -> map.find { k, v -> v instanceof Map ? v.containsKey( keyword ) ? k : findValueBelongsTo( v, keyword ) : v.contains( keyword ) ?: v.any{ it instanceof Map } ? findValueBelongsTo( v.findAll{ it instanceof Map }.inject([:]) { i, m -> m findResult & findResults reference: FindResults and FindResult Methods of Groovy find deep in nested map collect: return all result (with null)groovy:000> [a: 1, b: 2, c: 3, d: 4].collect{ k, v -> v>2 ? (k + '->' + v) : null } ===> [null, null, c->3, d->4] findResult: return the first eligible value (first non-null element) groovy:000> [a: 1, b: 2, c: 3, d: 4].findResult{ k, v -> v>2 ? (k + '->' + v) : null } ===> c->3 findResults: find all eligible values (all non-null elements) groovy:000> [a: 1, b: 2, c: 3, d: 4].findResults{ k, v -> v>2 ? (k + '->' + v) : null } ===> [c->3, d->4] find deep in nested map Example Map structure: Map map = [ 'a': [ 'b': [ 'c': [ 'd' : '1', 'e' : '2', 'f' : '3' ], // c 'g': '4', 'h': [ 'i': '5', 'j': '6', 'k': '7' ] // h ], // b 'l': [ 'm': '8', 'n': '9' ], // l 'o': '10' ] // a ] find value via key name recursively try online def findValues( Map map, String keyword ) { map.findResult { k, v -> v instanceof Map ? v.containsKey(keyword) ? v.getOrDefault(keyword, null) : findValues( v, keyword ) : null } } alternatives def findValues( Map map, String keyword ) { if( map.containsKey(keyword) ) return map.getOrDefault( keyword, null ) map.findResult { k, v -> v instanceof Map ? findValues(v, keyword) : null } } result println \"~~> findValues( map, 'f' ) : ${findValues( map, 'f' )} \" println \"~~> findValues( map, 'o' ) : ${findValues( map, 'o' )} \" println \"~~> findValues( map, 'aaaa' ) : ${findValues( map, 'aaaa' )} \" /** * console output * ~~> findValues( m, 'f' ) : 3 * ~~> findValues( m, 'o' ) : 10 * ~~> findValues( m, 'aaaa' ) : null **/ alternatives try online def hasValues(Map m, String key) { m.containsKey(key) || m.find { k, v -> v instanceof Map && hasValues(v, key) } } result println \"~~> hasValues( map, 'f' ) : ${hasValues( map, 'f' )} \" println \"~~> hasValues( map, 'o' ) : ${hasValues( map, 'o' )} \" println \"~~> hasValues( map, 'aaaa' ) : ${hasValues( map, 'aaaa' )} \" /** * console output * ~~> hasValues( m, 'f' ) : true * ~~> hasValues( m, 'o' ) : true * ~~> hasValues( m, 'aaaa' ) : false **/ inject Join Elements to a Stringdef map = [q: 'groovy', maxResult: 10, start: 0, format: 'xml'] def params = map.inject([]) { result, entry -> result collect & collectMany collectEntries List> to Map [!NOTE|label:references:] Groovy - Combining a list of Maps into a single Map [ [ name:'John' , age:35 ] , [ name:'Jim' , age:54 ] , [ name:'Smith' , age:'53' ] ].collectEntries {[ it.name, it.age ]} result[ 'John':35, 'Jim':54, 'Smith':'53' ] merge two List to single Map> List value =['a','b','c' ] List recId =['R1','R2' ] Map> map = recId.collectEntries{[ it, value ]} // or Map> map = recId.collectEntries{[ it, value.clone() ]} result[ 'R1':['a', 'b', 'c'] , 'R2':['a', 'b', 'c'] ] collect similar feature for to_entries[] in jq [!NOTE|label:to_entries[] in jq] $ echo '{ \"a\" : \"1\" }' | jq -r 'to_entries[]' { \"key\": \"a\", \"value\": \"1\" } [ 'a' : '1', 'b' : '2', 'c' : '3' ].collect {[ 'key' : it.key , 'value' : it.value ]} result[ [ 'key':'a', 'value':'1' ] , [ 'key':'b', 'value':'2' ] , [ 'key':'c', 'value':'3' ] ] grep references: Groovy Goodness: the Grep Method Is there any difference between Groovy's non-argument grep() and findAll() methods? ['test', 12, 20, true].grep(String) alternatives ['test', 12, 20, true].findAll { it.class.simpleName == 'String' } // or ['test', 12, 20, true].findAll { it instanceof String } with [!NOTE|label:references:] Groovy multiple assignment with a map Map map = [a: 1, b:2] map.with { (a, b) = [3, 4] } assert map.a == 3 assert map.b == 4 sort descending assert ['h3':'bb', 'h2':'cc', 'h1':'aa'] == [ 'h1' : 'aa', 'h3' : 'bb', 'h2' : 'cc' ].sort{ - it.key.split('h').last().toInteger() } # or assert ['h3':'bb', 'h2':'cc', 'h1':'aa'] == [ 'h1' : 'aa', 'h3' : 'bb', 'h2' : 'cc' ].sort{ it.key }.reversed() traverse references: public void traverse(Map, Closure)) Groovy Goodness: Traversing a Directory more complex traversal techniques via traverse method iterateMap && recursion def iterateMap(Map map, String prefix = \"\") { map.each { key, value -> if (value instanceof Map) { iterateMap(value, \"$prefix$key:\") } else { println \"a:$prefix$key=$value\" } } } def a = [ b: [ c: 1, d: 2, e: 3 ], r: [ p: 4 ], q: 5 ] iterateMap(a) results:a:b:c=1 a:b:d=2 a:b:e=3 a:r:p=4 a:q=5 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/groovy/list.html":{"url":"programming/groovy/list.html","title":"list","keywords":"","body":" init sublists a list contains a sublist or not grep intersect & disjoint filter findAll filter in list via additional conditions return result instead of original list via findResults pickup item in list random multilist multiply in list multiply in 2 lists multiply in multiple lists orders sort sort with descending order swap conversion or restruction toSpreadMap to Map collate to nested List zip 2 lists sum the content of 2 list in groovy remove empty item in a list replace item in list according reference Map 2D matrix conversions show print 2D matrix indexed references: Groovy List Processing Cheat Sheet init println( (1..10).collect() ) // [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] println( ('a'..'z').collect() ) // [a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z] sublists [!NOTE] references: java.util.List) Groovy Goodness: the Grep Method a list contains a sublist or not List parent = [ '1', '2', '3', 'a', 'b' ] List sub = [ 'a', '3' ] sub.every{ parent.contains(it) } or containsAll List parent = [ '1', '2', '3', 'a', 'b' ] List sub = [ 'a', '3' ] parent.containsAll(sub) ignore case sub.every{ parent.collect{ it.toLowerCase() }.contains( it.toLowerCase() ) } grep assert [ true ] == [ 'test', 12, 20, true ].grep( Boolean ) // Class isInstance assert [ 'Groovy' ] == [ 'test', 'Groovy', 'Java' ].grep( ~/^G.*/ ) // Pattern match assert [ 'b', 'c' ] == [ 'a', 'b', 'c', 'd' ].grep([ 'b', 'c' ]) // List contains assert [ 15, 16, 12 ] == [ 1, 15, 16, 30, 12 ].grep( 12..18 ) // Range contains assert [ 42.031 ] == [ 12.300, 109.20, 42.031, 42.032 ].grep( 42.031 ) // Object equals assert [ 100, 200 ] == [ 10, 20, 30, 50, 100, 200 ].grep({ it > 50 }) // Closure boolean assert [ 1, 'a', 'd' ] == [ [], 1, '', 'a', [:], 'b' ].grep() // No Null intersect & disjoint [!NOTE] references: Groovy Goodness: intersect collections List l1 = [ 'a', 'b', 'c' ] List l2 = [ 'b', 'c', 'd' ] List l3 = [ '1', '2', 'd' ] assert [ 'b', 'c' ] == l1.intersect(l2) assert ! l1.disjoint(l2) assert l1.disjoint(l3) filter findAll [ 'baz1', 'baz2', 'baz3', 'abz1', 'zba2', 'bza3' ].findAll { it.contains 'baz' } ===> [baz1, baz2, baz3] or[['r':3],['r':5],['r':6],['r':11],['r':10]].findAll { (1..10).contains(it.r) } ===> [[r:3], [r:5], [r:6], [r:10]] filter in list via additional conditions [ [ id : 1 , age : 1 , weight : 25 ] , [ id : 2 , age : 2 , weight : 20 ] , [ id : 3 , age : 3 , weight : 25 ] ].findAll { it.age in [ 2, 3 ] || it.weight in [ 20, 25 ] }.id ===> [1,2,3] return result instead of original list via findResults [1, 2, 3, 4].findResults { ( it % 2 == 0 ) ? it / 2 : null } ===> [1, 2] ~> [2/2, 4/2] // and [1, 2, 3, 4].findAll { ( it % 2 == 0 ) ? it / 2 : null } ===> [2, 4] pickup item in list random Collections.shuffle List list = [ '1', '2', '3', 'a', 'b' ] Collections.shuffle( list ) println list println parent.first() // result // [2, b, 3, 1, a] // 2 Random().nextInt List list = [ '1', '2', '3', 'a', 'b' ] Random random = new Random() println list.get(random.nextInt(list.size())) println list.get(random.nextInt(list.size())) // result // 1 // b multilist multiply in list references: Cartesian product Cartesian product of two or more lists multiply lists multiply in 2 lists def multiply( List a, List b ) { assert [a,b].every { it != null } def ( m,n ) = [ a.size(),b.size() ] ( 0.. prod or list.combinations()[ [ 'a', 'b' ], [ '1', '2' ] ].combinations() // [['a', '1'], ['b', '1'], ['a', '2'], ['b', '2']] multiply in multiple lists def listsMultiply( List... lists ) { lists = lists.findAll() List result = lists[0] ( 1..lists.size()-1 ).collect { List y = lists[it] def ( m, n ) = [ result.size(), y.size() ] result = ( 0.. prod output List a = [ 'a', 'b', 'c', 'd' ] List b = [ '1', '2' ] List c = [ 'x', 'y' ] List d = [ '9', '8' ] listsMultiply( a, b, c, d ).each { println \"\\t>> ${it},\" } >> [a, 1, x, 9] >> [a, 1, x, 8] >> [a, 1, y, 9] >> [a, 1, y, 8] >> [a, 2, x, 9] >> [a, 2, x, 8] >> [a, 2, y, 9] >> [a, 2, y, 8] >> [b, 1, x, 9] >> [b, 1, x, 8] >> [b, 1, y, 9] >> [b, 1, y, 8] >> [b, 2, x, 9] >> [b, 2, x, 8] >> [b, 2, y, 9] >> [b, 2, y, 8] >> [c, 1, x, 9] >> [c, 1, x, 8] >> [c, 1, y, 9] >> [c, 1, y, 8] >> [c, 2, x, 9] >> [c, 2, x, 8] >> [c, 2, y, 9] >> [c, 2, y, 8] >> [d, 1, x, 9] >> [d, 1, x, 8] >> [d, 1, y, 9] >> [d, 1, y, 8] >> [d, 2, x, 9] >> [d, 2, x, 8] >> [d, 2, y, 9] >> [d, 2, y, 8] or java.util.ArrayList.metaClass.multiply = { e -> def list = new ArrayList() delegate.each { aa -> e.each { list.add( aa + it ) } } list } result x = [\"k1\", \"k2\", \"k3\"] y = [\"v1\", \"v2\", \"v3\"] x * y [k1v1, k1v2, k1v3, k2v1, k2v2, k2v3, k3v1, k3v2, k3v3] or java.util.ArrayList.metaClass.multiply = { e -> def list = new ArrayList() delegate.collect { aa -> e.each { list result( d * b * c ).join('\\n') [9, 1, x] [9, 1, y] [9, 2, x] [9, 2, y] [8, 1, x] [8, 1, y] [8, 2, x] [8, 2, y] orders sort [ '3', '1', '2' ].sort() // [ '1', '2', '3' ] sort with descending order [!NOTE] references: sorting map values in descending order with groovy [ 'a', 'b', 'c' ].reverse().indexed(1).sort{ - it.key }.collect{ \"${it.key} : ${it.value}\" }.join('\\n') // 3 : a // 2 : b // 1 : c # or via comapreTo ( ) [ 'a', 'b', 'c' ].reverse().indexed(1).sort{ a, b -> b.key.compareTo(a.key) }.collect{ \"${it.key} : ${it.value}\" }.join('\\n') // 3 : a // 2 : b // 1 : c # or via getAt( -1..0 ) [ 'a', 'b', 'c' ].reverse().indexed(1).collect{ \"${it.key} : ${it.value}\" }.getAt( -1..0 ).join('\\n') // 3 : a // 2 : b // 1 : c # or via reverseEach [ 'a', 'b', 'c' ].reverseEach{ println it } swap List l = [ '1', '2', '3' ] assert [ '3', '1', '2' ] == l.swap(2, 1).swap(1, 0) conversion or restruction toSpreadMap to Map [ 'a', 'b', 'c', 'd' ].toSpreadMap() // ['a':'b', 'c':'d'] collate to nested List [ 'a', 'b', 'c', 'd' ].collate(2) // [['a', 'b'], ['c', 'd']] zip 2 lists [!NOTE] references: list.transpose()) List.transpose() works like zip // expectation : // [ 'a', 'b' ] - // |-> [ [ 'a', '1' ], [ 'b', '2' ] ] // [ '1', '2' ] - assert [ ['a', '1'], ['b', '2'] ] == [ [ 'a', 'b' ], [ '1', '2' ] ].transpose() sum the content of 2 list in groovy references: Sum the content of 2 list in Groovy List a = [ 'a', 'b', 'c', 'd' ] List b = [ '1', '2' ] [ a, b ].transpose() // Result: [[a, 1], [b, 2]] remove empty item in a list public Collection findAll() finds the items matching the IDENTITY Closure (i.e. matching Groovy truth) references: Remove null items from a list in Groovy findAll() groovy:000> [ null, 'a', 'b' ].findAll() ===> [a, b] groovy:000> [ [], [ 'a', 'b' ], [ '1' ] ].findAll() ===> [[a, b], [1]] findResults{} groovy:000> [ [], [ 'a', 'b' ], [ '1' ] ].findResults{it} ===> [[], [a, b], [1]] groovy:000> [ null, 'a', 'b' ].findResults{it} ===> [a, b] grep() groovy:000> [ [], [ 'a', 'b' ], [ '1' ] ].grep() ===> [[a, b], [1]] groovy:000> [ null, 'a', 'b' ].grep() ===> [a, b] replace item in list according reference Map Map reference = [ '1' : 'apple' , '2' : 'banana' , '3' : 'pears' , '4' : 'peach' ] 'I want 1 she wants 4'.tokenize(' ') .collect { references.get(it) ?: it } .join(' ') // result: I want apple she wants peach or keeping the String format reference for replaceAll(\"\", \"$0\") 'I like 1, she likes 3.' .replaceAll(\"[^\\\\w]\", \"_\\$0\") .split('_') .collect { String c = it.trim() reference.get(c) ? it.replace(c, reference.get(c)) : it } .join() // result: I like apple, she likes pears. remove all punctuation from a String : 'I like 1,_,--__,,___ she liks 2,,...' .replaceAll(\"[^\\\\w\\\\s]|_\", '') // .replaceAll(\"\\\\s+\", ' ') // structure space if necessary ===> I like 1 she liks 2 // ===> I like 1 she liks 2 or keep only comma (and merge more if mutiple comma)'I like 1,----,,|\\\\/, she liks 2,,...' .replaceAll(\"[^\\\\w\\\\s,]|_\", '') .replaceAll(',+', ',') ===> I like 1, she liks 2, 2D matrix conversions Objective : rows and columns conversion in 2D matrix Map> original matrix: [ 'foo' : [ 'a', 'b', 'c', 'd' ] , 'bar' : [ 'b', 'c', 'x', 'y' ] , 'baz' : [ 'd', 'x', 'y', 'z' ] ] after conversion: [ 'a' : [ 'foo' ] , 'b' : [ 'bar' , 'foo' ] , 'c' : [ 'bar' , 'foo' ] , 'd' : [ 'baz' , 'foo' ] , 'x' : [ 'bar' , 'baz' ] , 'y' : [ 'bar' , 'baz' ] , 'z' : [ 'baz' ] ] Inspired from sboardwell/matrix-based-auth.groovy Map> after = [:].withDefault { [].toSet() } Map> matrix = [ 'foo' : [ 'a', 'b', 'c', 'd' ] , 'bar' : [ 'b', 'c', 'x', 'y' ] , 'baz' : [ 'd', 'x', 'y', 'z' ] ] Closure converter = { Map result, Map original -> original.each { k, v -> result[k] += v } } matrix.collect{ k, v -> v.collect{ [ (it) : k ] } } .flatten() .each converter.curry(after) after show print 2D matrix (1..255).collect { color -> \" █${color}█ \" }.eachWithIndex{ c, idx -> print c if ( 4 == (idx+1)%6 ) { println '' } } indexed [!NOTE] references: Groovy Goodness: Combine Elements Iterable with Index summarize: list.withIndex() : List> list.indexed() : Map [ 'a', 'b', 'c', 'd' ].indexed() // [0:'a', 1:'b', 2:'c', 3:'d'] [ 'a', 'b', 'c', 'd' ].indexed(1) // [1:'a', 2:'b', 3:'c', 4:'d'] [3, 20, 10, 2, 1].withIndex() // [[3, 0], [20, 1], [10, 2], [2, 3], [1, 4]] ('a'..'d').withIndex(1) // [['a', 1], ['b', 2], ['c', 3], ['d', 4]] Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/groovy/string.html":{"url":"programming/groovy/string.html","title":"string","keywords":"","body":" convert capitalize uncapitalize toLowerCase toUpperCase substring string indexing minus take drop tr tricky comparation equalsIgnoreCase compareToIgnoreCase repalce reverse replaceAll replaceFirst replaceAll with case-insensitive Apply proper uppercase and lowercase on a String split split string by Capital Letters split via patten trim stripIndent() stripMargin() output format expand unexpand padRright center size count size random shuffled file StringTokenizer references: java.lang.Object: CharSequence stripMargin()) stripIndent()) String StringJoiner StringGroovyMethods Strip indent in Groovy multiline strings Is there an operator that can trim indentation in multi-line string? Class StringGroovyMethods Three Groovy String methods that will make your life Groovier! convert capitalize assert 'Groovy' == 'groovy'.capitalize() uncapitalize assert 'groovy' == 'Groovy'.uncapitalize() assert 'hello World' == 'Hello World'.uncapitalize() assert 'hello world' == 'Hello World'.tokenize().collect { it.uncapitalize() }.join(' ') toLowerCase assert 'groovy' == 'GRoOvy'.toLowerCase() toUpperCase assert 'GROOVY' == 'gRoovy'.toUpperCase() substring string indexing assert '123' == '1234567'[0..2] assert '67' == '1234567'[-2..-1] minus assert 'Hello ' == 'Hello World'.minus( 'World' ) assert ' World' == 'Hello World'.minus( 'Hello' ) orassert 'Hello ' == 'Hello World' - 'World' assert ' World' == 'Hello World' - 'Hello' take assert 'G' == 'Groovy'.take(1) assert 'Gr' == 'Groovy'.take(2) assert 'Gro' == 'Groovy'.take(3) takeRight [!TIP] returns the last num elements from this CharSequence. assert '' == 'Groovy'.takeRight( 0 ) assert 'y' == 'Groovy'.takeRight( 1 ) assert 'ovy' == 'Groovy'.takeRight( 3 ) takeAfter assert ' development. Groovy team' == 'Groovy development. Groovy team'.takeAfter( 'Groovy' ) assert 'team' == 'Groovy development. Groovy team'.takeAfter( ' Groovy ' ) takeBefore assert 'Groovy ' == 'Groovy development. Groovy team'.takeBefore( 'development' ) assert 'Groovy development' == 'Groovy development. Groovy team'.takeBefore( '. Groovy ' ) takeBetween assert ' development. ' == 'Groovy development. Groovy team'.takeBetween( 'Groovy' ) assert 'marslo' == 'name = \"marslo\"'.takeBetween( '\"' ) assert '10' == \"t1='10' ms, t2='100' ms\".takeBetween( \"'\" ) assert '10' == \"t1='10' ms, t2='100' ms\".takeBetween( \"'\", 0 ) assert '100' == \"t1='10' ms, t2='100' ms\".takeBetween( \"'\", 1 ) takeWhile [!TIP] returns the longest prefix of this CharSequence where each element passed to the given closure evaluates to true. assert '' == 'Groovy'.takeWhile{ it drop assert 'ovY' == 'GroovY'.drop(3) assert '' == 'GroovY'.drop(10) dropWhile [!TIP] create a suffix of the given CharSequence by dropping as many characters as possible from the front of the original CharSequence such that calling the given closure condition evaluates to true when passed each of the dropped characters. assert 'roovY' == 'GroovY'.dropWhile{ it tr assert 'hEllO' == 'hello'.tr('aeiou', 'AEIOU') assert 'HELLO' == 'hello'.tr('a-z', 'A-Z' ) // if replacementSet is smaller than sourceSet, then the last character from replacementSet is used as the replacement for all remaining source characters as shown here: assert 'HAAAA WAAAA!' == 'Hello World!'.tr('a-z', 'A') // if sourceSet contains repeated characters, the last specified replacement is used as shown here: assert 'He224 W4r2d!' == 'Hello World!'.tr('lloo', '1234') tricky remove the last x chars def removeSuffix( String str ) { removeSuffix( str, 1 ) } /** * remove the last char of {@code str} * @param str the string will be removal the last char * @param c remove last {@code c} numbers chars **/ def removeSuffix( String str, int c ) { str.reverse().drop(c).reverse() } add char(s) in the end of string str.concat('substr') comparation equalsIgnoreCase assert true == \"HELLO World\".equalsIgnoreCase( 'hello world' ) compareToIgnoreCase assert 0 == \"Hello World\".compareToIgnoreCase( 'hello world' ) repalce reverse assert '1234' == '4321'.reverse() replaceAll [!TIP] public String replaceAll(Pattern pattern, Closure closure) replaces all occurrences of a captured group by the result of a closure call on that text. assert 'hellO wOrld' == 'hello world'.replaceAll(~\"(o)\") { it[0].toUpperCase() } assert 'FOOBAR-FOOBAR-' == 'foobar-FooBar-'.replaceAll(~\"(([fF][oO]{2})[bB]ar)\", { it[0].toUpperCase() }) // Here, // it[0] is the global string of the matched group // it[1] is the first string in the matched group // it[2] is the second string in the matched group assert 'FOO-FOO-' == 'foobar-FooBar-'.replaceAll(\"(([fF][oO]{2})[bB]ar)\", { x, y, z -> z.toUpperCase() }) // Here, // x is the global string of the matched group // y is the first string in the matched group // z is the second string in the matched group replaceFirst [!TIP] public String replaceFirst(CharSequence regex, Closure closure)) Replaces the first occurrence of a captured group by the result of a closure call on that text. assert 'hellO world' == 'hello world'.replaceFirst(\"(o)\") { it[0].toUpperCase() } // first match assert 'hellO wOrld' == 'hello world'.replaceAll(\"(o)\") { it[0].toUpperCase() } // all matches assert '1-FISH, two fish' == 'one fish, two fish'.replaceFirst(/([a-z]{3})\\s([a-z]{4})/) { [one:1, two:2][it[1]] + '-' + it[2].toUpperCase() } assert '1-FISH, 2-FISH' == 'one fish, two fish'.replaceAll(/([a-z]{3})\\s([a-z]{4})/) { [one:1, two:2][it[1]] + '-' + it[2].toUpperCase() } replaceAll with case-insensitive [!TIP|label:references:] How to replace case-insensitive literal substrings in Java Use replaceAll() to ignore case when replacing one substring with another Case insensitive String split() method useful libs: Class java.util.regex.Matcher Class java.util.regex.Pattern Special constructs (non-capturing) : Constant Field Values (?i) : public static final int CASE_INSENSITIVE (?d) : public static final int UNIX_LINES (?m) : public static final int MULTILINE (?s) : public static final int DOTALL (?u) : public static final int UNICODE_CASE (?x) : public static final int COMMENTS tutorial: Methods of the Pattern Class RegexTestHarness.java tutorial: Methods of the Matcher Class EQUIVALENT EMBEDDED FLAG EXPRESSION CONSTANT None Pattern.CANON_EQ (?i) Pattern.CASE_INSENSITIVE (?x) Pattern.COMMENTS (?m) Pattern.MULTILINE (?s) Pattern.DOTALL None Pattern.LITERAL (?u) Pattern.UNICODE_CASE (?d) Pattern.UNIX_LINES String target = '++Apple@@Banana | aPPle##BanANa$$' Map p = [ 'banana' : '--', 'apple' : '==' ] assert '++==@@-- | ==##--$$' == p.inject('') { injected, k, v -> injected = ( injected ?: target ).replaceAll( \"(?i)${k}\", v ); injected } or import java.util.regex.Pattern String parentPath = 'D:\\\\ifs\\\\APP\\\\Checkout' String path = 'D:\\\\IFS\\\\APP\\\\Checkout\\\\trvexp\\\\client\\\\Ifs.App\\\\text.txt' assert '\\\\trvexp\\\\client\\\\Ifs.App\\\\text.txt' == path.replaceAll( \"(?i)\" + Pattern.quote(parentPath), '' ) or import java.util.regex.Pattern String label = 'table' String html = 'aaa' assert 'aaa' == Pattern.compile(label, Pattern.CASE_INSENSITIVE).matcher(html).replaceAll(\"WINDOWS\"); Apply proper uppercase and lowercase on a String import java.util.regex.Matcher import java.util.regex.Pattern String str = \"this is a test\" StringBuffer sb = new StringBuffer() Matcher m = Pattern.compile(\"([a-z])([a-z]*)\", Pattern.CASE_INSENSITIVE).matcher(str) while ( m.find() ) { m.appendReplacement( sb, m.group(1).toUpperCase() + m.group(2).toLowerCase() ) } assert 'This Is A Test' == m.appendTail(sb).toString() split split string by Capital Letters [!NOTE|label:references:] Java: Split string when an uppercase letter is found Split String by Capital letters in Java \\p{Lu} | \\p{Upper} : shorthand for \\p{Uppercase Letter} \\p{Ll} | \\p{Lower} : shorthand for \\p{Lowercase Letter} Lookahead and Lookbehind Zero-Length Assertions Java split is eating my characters Regex split string but keep separators Class java.util.regex.Pattern: POSIX character classes (US-ASCII only) \\p{Lower} : A lower-case alphabetic character: [a-z] \\p{Upper} : An upper-case alphabetic character: [A-Z] \\p{ASCII} : All ASCII: [\\x00-\\x7F] \\p{Alpha} : An alphabetic character: [\\p{Lower}\\p{Upper}] \\p{Digit} : A decimal digit: [0-9] \\p{Alnum} : An alphanumeric character: [\\p{Alpha}\\p{Digit}] \\p{Punct} : Punctuation: One of !\"#$%&'()*+,-./:;?@[\\]^_{|}~` \\p{Graph} : A visible character: [\\p{Alnum}\\p{Punct}] \\p{Print} : A printable character: [\\p{Graph}\\x20] \\p{Blank} : A space or a tab: [ \\t] \\p{Cntrl} : A control character: [\\x00-\\x1F\\x7F] \\p{XDigit} : A hexadecimal digit: [0-9a-fA-F] \\p{Space} : A whitespace character: [ \\t\\n\\x0B\\f\\r] // split by Uppercase 'IWantToSplitThisString'.split(\"(?=\\\\p{Lu})\") 'IWantToSplitThisString'.split(\"(?=\\\\p{Upper})\") // result: ['I', 'Want', 'To', 'Split', 'This', 'String'] // split by Lowercase 'iwANTtOsPLITtHISsTRING'.split(\"(?=\\\\p{Ll})\") 'iwANTtOsPLITtHISsTRING'.split(\"(?=\\\\p{Lower})\") // result: ['i', 'wANT', 'tO', 'sPLIT', 'tHIS', 'sTRING'] or via [A-Z] assert ['this', 'Is', 'My', 'String'] == \"thisIsMyString\".split(\"(?=[A-Z])\"); or via String.format String splitCamelCase(String s) { return s.replaceAll( String.format(\"%s|%s|%s\", \"(? System.out.println(\"${test.padRight(16)}: [\" + splitCamelCase(test) + \"]\"); } resultlowercase : [lowercase] Class : [Class] MyClass : [My Class] HTML : [HTML] PDFLoader : [PDF Loader] AString : [A String] SimpleXMLParser : [Simple XML Parser] GL11Version : [GL 11 Version] 99Bottles : [99 Bottles] May5 : [May 5] BFG9000 : [BFG 9000] split via patten [!NOTE|label:expect:] original:'h1:aaa:h2:bbb' expect:'aaabbb' via inject String title = 'h1:aaa:h2:bbb' String pattern = 'h\\\\d' title.trim().split(':') .inject([:]) { injected, str -> key = str.matches(pattern) ? str : key injected[key] = injected.getOrDefault(key, '') + ( ! str.matches(pattern) ? \":${str}\" : '') injected } .collectEntries {[ (it.key), it.value.tokenize(':').join(':') ]} .collect { \"${it.value}\" } .join() via split String title = 'h1:aaa:h2:bbb' title.trim() .split( \"(?=h\\\\d:)\" ) .collect{ it.tokenize(':') } .collectEntries{[ (it.first().trim()) : it.last().trim() ]} .collect{ \"${it.value}\" } .join() trim stripIndent() \"\"\" try{ do this } finally { do that } \"\"\".stripIndent() ==> output : try{ do this } finally { do that } stripMargin() \"\"\"try{ | do this |} finally { | do that |} \"\"\".stripMargin() ==> output : try{ do this } finally { do that } or\"\"\"try{ * do this *} finally { * do that *} \"\"\".stripMargin( '*' ) output format expand assert 'Groovy Grails Griffon' == 'Groovy\\tGrails\\tGriffon'.expand() assert 'Groovy Grails Griffon' == 'Groovy\\tGrails\\tGriffon'.expand(10) unexpand assert 'Groovy\\tGrails\\tGriffon' == 'Groovy Grails Griffon'.unexpand() assert 'Groovy\\tGrails\\tGriffon' == 'Groovy Grails Griffon'.unexpand(10) padRright println 'world******'.padRight(15) + 'hello' println 'world'.padRight(15) + 'hello' // result // world****** hello // world hello or println 'world******'.padRight(15, '.') + 'hello' println 'world'.padRight(15, '.') + 'hello' // result // world******....hello // world..........hello center println \" HEADER \".center(50, \"-\") println \"Number:\".padRight(20) + \"20\" println \"Name:\".padRight(20) + \"John Doe\" println \"Address:\".padRight(20) + \"34 Some Street, London\" println \"Subscriber:\".padRight(20) + \"YES\" println \"Expired:\".padRight(20) + \"NO\" // result // --------------------- HEADER --------------------- // Number: 20 // Name: John Doe // Address: 34 Some Street, London // Subscriber: YES // Expired: NO size count assert 2 == 'Hello world'.count('o') assert 2 == 'Hello worlld'.count('ll') size assert 11 == 'Hello world'.size() assert 11 == 'Hello world'.length() random [!TIP] check also in * imarslo : generate the random String references: How to generate a random password in Groovy? NOTE: shuffled() supports for Groovy 3+ shuffled ('0'..'z').shuffled().take(10).join() for number and chars only(('a'..'z')+('A'..'Z')+(0..9)).shuffled().take(10).join() file [!NOTE|label:references:] Class File Class FilenameUtils) FilenameUtils.getName(String) Package java.nio.file Class Paths VS. Interface Path)// https://stackoverflow.com/a/49019436/2940319 assert sun.nio.fs.UnixPath == java.nio.file.Paths.get( '/a/b/c/d.txt' ).getClass() java.nio.file.Path path = java.nio.file.Paths.get( '/a/b/c/d.txt' ) Path getFileName() method in Java with Examples Java Files - java.nio.file.Files Class IO NIO File file = new File( 'c:/data' )file.createNewFile() Path path = Paths.get( 'c:/data' )Files.createFile(path) File file = new File( 'c:/data' )file.mkdir() Path path = Paths.get( 'c:/data' )Files.createDirectory(path) File file = new File( 'c:/data' )file.mkdirs() Path path = Paths.get( 'c:/data' )Files.createDirectories(path) File file = new File( 'c:/data' )file.exists() Path path = Paths.get( 'c:/data' )Files.exists(path) dirname # via File assert '/a/b/c' == ( new File('/a/b/c/d.txt') ).getParentFile().toString() assert '/a/b/c' == ( new File('/a/b/c/d.txt') ).getParent() assert '/a/b/c' == ( new File('/a/b/c/d.txt') ).parent # via java.nio.file.Paths assert '/a/b/c' == java.nio.file.Paths.get( '/a/b/c/d.txt' ).getParent().toString() assert '/a/b/c' == jhava.nio.file.Paths.get( '/a/b/c/d.txt' ).parent.toString() basename # via File assert 'd.txt' == (new File('/a/b/c/d.txt')).getName() assert 'd.txt' == (new File('/a/b/c/d.txt')).name # via java.nio.file.Paths assert 'd.txt' == java.nio.file.Paths.get( '/a/b/c/d.txt' ).getFileName().toString() assert 'd.txt' == java.nio.file.Paths.get( '/a/b/c/d.txt' ).fileName.toString() isDirectory || isFile assert true == ( new File('/Users/marslo/.vimrc') ).isFile() assert false == ( new File('/Users/marslo/.vimrc') ).isDirectory() StringTokenizer [!NOTE|label:references:] Class java.util.StringTokenizer import java.util.StringTokenizer StringTokenizer st = new StringTokenizer(\"this is a test\"); while (st.hasMoreTokens()) { System.out.println(st.nextToken()); } output this is a test equals String[] result = \"this is a test\".split(\"\\\\s\"); for (int x=0; x Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/groovy/closure.html":{"url":"programming/groovy/closure.html","title":"closure","keywords":"","body":" Closure VS. Method break from closure curry Memoization composition Methods delegate tricky [!NOTE] references: Closures Closures in Groovy Groovy Goodness: Passing Closures to Methods Groovy Goodness: Closure Arguments Groovy Goodness: Identity Closure 实战 Groovy: 用 curry 过的闭包进行函数式编程 A closure definition follows this syntax: { [closureParameters -> ] statements } closure.call() Closure clos = { println \"Hello World\" } assert clos.call() == clos() | + implicit call + explicit call Closure VS. Method closures have benefits over regular methods and are a powerful feature of Groovy: We can pass a Closure as an argument to a method Unary closures can use the implicit it parameter We can assign a Closure to a variable and execute it later, either as a method or with call Groovy determines the return type of the closures at runtime We can declare and invoke closures inside a closure Closures always return a value method def formatToLowerCase( String name ) { name.toLowerCase() } closure def formatToLowerCaseClosure = { name -> name.toLowerCase() } break from closure tips: return means continue return true means break the loop def list = [1, 2, 3, 4, 5] list.any { element -> if (element == 2) return // continue println element if (element == 3) return true // break } curry left curry def multiply = { x, y -> return x * y } def triple = multiply.curry(3) // triple = { y -> return 3 * y } example def nCopies = { int n, String... str -> str.join('')*n } def twice = nCopies.curry(2) println twice('|', '\\\\', '|', '/' ) assert twice('|', '\\\\', '|', '/' ) == nCopies( 2, '|', '\\\\', '|', '/' ) result|\\|/|\\|/ others left curry def multiConcat = { int n, String... args -> args.join('')*n } multiConcat( 3, '*', '-', '=' ) result*-=*-=*-= right curry def nCopies = { int n, String str -> str*n } def twice = nCopies.rcurry( '*-=*=-*' ) println twice(2) assert twice(2) == nCopies( 2, '*-=*=-*' ) result*-=*=-**-=*=-* [!TIP] def nCopies = { int n, String str -> str*n } def twice = nCopies.rcurry( '*-=*=-*' ) def divider = nCopies.curry( 2 ) assert nCopies( 2, '*-=*=-*' ) == twice( 2 ) // right curry assert nCopies( 2, '-.-.-.-' ) == divider( '-.-.-.-' ) // left curry index with curry def volume = { int l, int w, int h -> \"l: ${l}\\nw: ${w}\\nh: ${h}\" } def fixedWidthVolume = volume.ncurry(1, 2) println fixedWidthVolume( 3, 4 ) resultl: 3 w: 2 h: 4 Memoization Fibonacci suite : fib(15) == fib(14) + fib(13) fib(14) == fib(13) + fib(12) slow def fib fib = { long n -> n fast tips: Closures.memoize() def fib fib = { long n -> n composition double composition def plus2 = { it + 2 } def times3 = { it * 3 } def times3plus2 = plus2 > times3 // | + execute last // + execute first // result assert plus2times3(3) == (3+2)*3 assert plus2times3(3) == times3(plus2(3)) assert ( plus2 > plus2 )(3) | + execute first | + execute last + execute last + execute first example for recursive in List def map1 = [a: 10, b:2, c:3] def map2 = [b:3, c:2, d:5] def maps = [map1, map2] def process(def maps, Closure myLambda) { maps.sum { it.keySet() }.collectEntries { key -> [ key, { x -> x.subList(1, x.size()).inject(x[0], myLambda) }(maps.findResults { it[key] }) ] } } def sumResult = process(maps) { a, b -> a + b } def prodResult = process(maps) { a, b -> a * b } def minResult = process(maps) { a, b -> a Resolutionassert [2,4,5].inject(1){ a, b -> a + b } == 12 assert [2,4,5].inject(1, { a, b -> a + b }) == 12 triple composition def multiply = { x, y -> return x * y } def triple = multiply.curry(3) def quadruple = multiply.curry(4) def composition = { f, g, x -> return f(g(x)) } def twelveTimes = composition.curry(triple, quadruple) // twelveTimes = { y -> composition { y -> 3*(4*y) } } def threeDozen = twelveTimes(3) Methods various method to call closure def work( String input, Closure cl ) { cl(input) } Closure assertJava = { it == 'Java' } println work( \"Java\", assertJava ) println work(\"Java\", { it == 'Java' }) // ==> work 'Java', { it == 'Java' } println work( 'Java' ){ it == 'Java' } frequent usage def on( String name, String dString = 'is' ) { [ skip: { -> println \"no params. skip\" }, foo: { String f, Map fmap -> foo( name, dString, f, fmap ) [ bar: { Map map -> bar( '', map ) } ] } , bar: { Map map -> bar( name, map ) } ] } def reset( Map m ) { m.collect{ k, v -> \"${k} : ${v}\" }.join('\\n') } def foo( String n, String ds, String f, Map m ) { println \"${n} ${ds} ${f} !\\ndetails :\\n\\t\\t${reset(m)}\" } def bar( String n = '', Map m ) { println \"${n ? \"${n}\\n\": ''}\\t\\t${reset(m)}\" } result on('marslo') .foo( 'awesome', [ 'age' : 34 ] ) .bar( ['gender' : 'female' ] ) // result marslo is awesome ! details : age : 34 gender : female or on('marslo') .skip() // result no params. skip delegate [!NOTE] references: Convert list to enumerated list in Groovy List.metaClass.collectWithIndex = { yield -> def collected = [] delegate.eachWithIndex { listItem, index -> collected \"${index + 1}. ${it}\" } .collect with an index List.metaClass.collectWithIndex = { body-> def i=0 delegate.collect { body(it, i++) } } // or even List.metaClass.collectWithIndex = { body-> [ delegate, 0.. tricky this class Enclosing { void run() { def whatIsThisObject = { getThisObject() } assert whatIsThisObject() == this def whatIsThis = { this } assert whatIsThis() == this } } Enclosing e = new Enclosing() e.run() Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/groovy/enum.html":{"url":"programming/groovy/enum.html","title":"enum","keywords":"","body":" check whether if enum contains a given string list all values in Enum Convert String type to Enum give Enums instance variables of their own type in Groovy precondition: enum Choices {a1, a2, b1, b2} check whether if enum contains a given string assert Arrays.asList(Choices.values()).toString().contains(\"a9\") == false assert Arrays.asList(Choices.values()).toString().contains(\"a1\") == true orassert Arrays.stream(Choices.values()).anyMatch((t) -> t.name().equals(\"a1\")) == true orassert Choices.values()*.name().contains('a1') == true assert Choices.values()*.name().contains('a9') == false or public enum Choices { a1, a2, b1, b2; public static boolean contains(String s) { try { Choices.valueOf(s); return true; } catch (Exception e) { return false; } } } Choices.contains('a1') or public enum Choices { a1, a2, b1, b2; public static boolean contains(String str) { return Arrays.asList(Choices.values()).toString().contains(str) } } assert Choices.contains('a1') == true list all values in Enum groovy:000> enum Choices {a1, a2, b1, b2} ===> true groovy:000> println Choices.values() [a1, a2, b1, b2] ===> null orList enumValues = Arrays.asList( Choices.values() ) Convert String type to Enum groovy:000> enum Choices {a1, a2, b1, b2} ===> true groovy:000> Choices.valueOf(\"a1\").getClass() ===> class Choices give Enums instance variables of their own type in Groovy enum Direction { North, South, East, West, Up, Down private Direction opposite Direction getOpposite() { opposite } static { def opposites = { d1, d2 -> d1.opposite = d2; d2.opposite = d1 } opposites(North, South) opposites(East, West) opposites(Up, Down) } } println Direction.South.getOpposite() println Direction.South.opposite Direction.values().each { println \"opposite of $it is $it.opposite\" } resultNorth North opposite of North is South opposite of South is North opposite of East is West opposite of West is East opposite of Up is Down opposite of Down is Up Result: [North, South, East, West, Up, Down] or using the direction indexes on the enum to find the opposites public enum Direction { North(1), South(0), East(3), West(2), Up(5), Down(4) private oppositeIndex Direction getOpposite() { values()[oppositeIndex] } Direction(oppositeIndex) { this.oppositeIndex = oppositeIndex } } println Direction.North.opposite or without the need of an extra field, just using the enum values' ordinal() enum Direction { North, South, East, West, Up, Down Direction getOpposite() { values()[ordinal() + ordinal() % 2 * -2 + 1] } } println Direction.North.getOpposite() Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/groovy/time.html":{"url":"programming/groovy/time.html","title":"time","keywords":"","body":" get time current timestamp data parse get available timezone get current time (timeInMillis) LocalDateTime current LocalDataTime particular localDateTime get detail info from localDateTime additional plus or minus for localDateTime isBefore(), isAfter() and isEqual() convert time convert the Date to simpleDateFormat or timeInMillis current time particular time convert Long to SimpleDateFormat convert timeInMillis (Long) to Date convert String to Date convert Date to timeInMillis (Long) formatting date references: Java Date Time Tutorial Java System.currentTimeMillis() Java Time Measurement Java's java.util.Date Java's java.sql.Date Java's java.util.Calendar and GregorianCalendar Java's java.util.TimeZone Parsing and Formatting Dates in Java Java LocalDate Java LocalTime Java LocalDateTime Java ZonedDateTime Java DateTimeFormatter get time [!TIP] references: Java SimpleDateFormat Class SimpleDateFormat Class Date Class TimeZone Class SimpleDateFormat Class DateFormat usage in jenkins * imarslo: get build time * imarslo: linux date current timestamp // 20220706171701 new Date().format( 'YYYYMMddHHmmss' ) // Tuesday 02 August 2022 20:33:11.967 +0800 new Date().format( 'EEEEE dd MMMMM yyyy HH:mm:ss.SSS Z' ) // Tuesday 02 August 2022 20:35:21.565 +0800, 214 days, week 32 new Date().format( 'EEEEE dd MMMMM yyyy HH:mm:ss.SSS Z, DD' ) + ' days, week ' + new Date().format( 'w' ) data parse String oldFormat = '04-DEC-2012' Date date = Date.parse( 'dd-MMM-yyyy', oldFormat ) assert date.format( 'M-d-yyyy' ) == '12-4-2012' // or Date date = Date.parse( 'HH:mm:ss dd-MMM-yyyy, Z', '00:00:00 04-DEC-2022, -0800') // Sunday 04 12-4-2022 00:00:00, PST date.format( 'EEEEE dd M-d-yyyy HH:mm:ss, z', timezone=TimeZone.getTimeZone('PST') ) // Sunday 04 12-4-2022 03:00:00, EST date.format( 'EEEEE dd M-d-yyyy HH:mm:ss, z', timezone=TimeZone.getTimeZone('EST') ) // Sunday 04 12-4-2022 08:00:00, UTC date.format( 'EEEEE dd M-d-yyyy HH:mm:ss, z', timezone=TimeZone.getTimeZone('UTC') ) // Sunday 04 12-4-2022 16:00:00, +0800 date.format( 'EEEEE dd M-d-yyyy HH:mm:ss, Z', timezone=TimeZone.getTimeZone('Asia/Shanghai') ) // Sunday 04 12-4-2022 16:00:00, CST date.format( 'EEEEE dd M-d-yyyy HH:mm:ss, z', timezone=TimeZone.getTimeZone('Asia/Shanghai') ) // oneline parse // Sun Dec 11 00:00:00 CST 2011 Date.parse('yyyy-MM-dd hh:MM:SS', '2012-12-11 00:00:00').format('E MMM dd HH:mm:ss z yyyy') get available timezone [!TIP] Java's java.util.TimeZone java.util.TimeZone.getAvailableIDs() // or java.util.TimeZone.getAvailableIDs().collect { it } println java.util.TimeZone.getDefault().getDisplayName(); println java.util.TimeZone.getDefault().getID(); println java.util.TimeZone.getDefault().getOffset( System.currentTimeMillis() ) -- result -- Pacific Standard Time America/Los_Angeles -28800000 get current time (timeInMillis) import java.util.Calendar import java.time.LocalDateTime import java.time.LocalDate long curerntTime = System.currentTimeMillis() long newDateTime = new Date().getTime() long calendarTime = Calendar.getInstance().getTimeInMillis() LocalDate dateTag = java.time.LocalDate.now() LocalDateTime dateTime = LocalDateTime.now() println \"\"\" curerntTime : ${curerntTime.toString().padRight(30)} : ${curerntTime.getClass()} newDateTime : ${newDateTime.toString().padRight(30)} : ${newDateTime.getClass()} calendarTime : ${calendarTime.toString().padRight(30)} : ${calendarTime.getClass()} dateTag : ${dateTag.toString().padRight(30)} : ${dateTag.getClass()} dateTime : ${dateTime.toString().padRight(30)} : ${dateTime.getClass()} \"\"\" result curerntTime : 1667810196418 : class java.lang.Long newDateTime : 1667810196418 : class java.lang.Long calendarTime : 1667810196418 : class java.lang.Long dateTag : 2022-11-07 : class java.time.LocalDate dateTime : 2022-11-07T00:36:36.418762 : class java.time.LocalDateTime LocalDateTime [!TIP] Java LocalDateTime with different format current LocalDataTime import java.time.LocalDateTime import java.time.format.DateTimeFormatter DateTimeFormatter format = DateTimeFormatter.ofPattern( \"yyyy-MM-dd HH:mm:ss a\" ) LocalDateTime currentDateTime = LocalDateTime.now() String currentNewFormat = currentDateTime.format( format ) println \"\"\" currentDateTime : ${currentDateTime} currentNewFormat : ${currentNewFormat} \"\"\" result currentDateTime : 2021-04-29T01:13:27.291 currentNewFormat : 2021-04-29 01:13:27 AM particular localDateTime import java.time.LocalDateTime import java.time.format.DateTimeFormatter DateTimeFormatter format = DateTimeFormatter.ofPattern( \"yyyy-MM-dd HH:mm:ss a\" ) LocalDateTime currentDateTime = LocalDateTime.now() LocalDateTime localDateTime = LocalDateTime.of( 2021, 04, 29, 00, 00, 00, 0000 ) String currentNewFormat = currentDateTime.format( format ) String localNewFormat = localDateTime.format( format ) println \"\"\" currentDateTime : ${currentDateTime} currentNewFormat : ${currentNewFormat} localDateTime : ${localDateTime} localNewFormat : ${localNewFormat} \"\"\" result currentDateTime : 2021-04-29T01:19:53.928 currentNewFormat : 2021-04-29 01:19:53 AM localDateTime : 2021-04-29T00:00 localNewFormat : 2021-04-29 00:00:00 AM get detail info from localDateTime reference: int getYear() – year int getDayOfYear() – day of year as integer value, from 1 to 365, or 366 in a leap year Month getMonth() – month. int getDayOfMonth() – day of the month as integer value, from1to31` DayOfWeek getDayOfWeek() – day of the week. int getHour() – hour of the day, from0to23` int getMinute() – minute of the hour, from 0 to 59 int getSecond() – second of the minute, from0to59` int getNano() – nanosecond, from 0 to 999,999,999 import java.time.LocalDateTime import java.time.format.DateTimeFormatter DateTimeFormatter format = DateTimeFormatter.ofPattern( \"yyyy-MM-dd HH:mm:ss a\" ) LocalDateTime localDateTime = LocalDateTime.of( 2021, 05, 01, 00, 00, 00, 0000 ) String localNewFormat = localDateTime.format( format ) println \"\"\" localDateTime : ${localDateTime} localNewFormat : ${localNewFormat} getYear : ${localDateTime.getYear()} getDayOfYear : ${localDateTime.getDayOfYear()} getDayOfWeek : ${localDateTime.getDayOfWeek()} getDayOfMonth : ${localDateTime.getDayOfMonth()} getNano : ${localDateTime.getNano()} \"\"\" result localDateTime : 2021-05-01T00:00 localNewFormat : 2021-05-01 00:00:00 AM getYear : 2021 getDayOfYear : 121 getDayOfWeek : SATURDAY getDayOfMonth : 1 getNano : 0 additional plus or minus for localDateTime plus: plusYears() – LocalDateTime with the specified years added plusMonths() – LocalDateTime with the specified months added plusDays() – LocalDateTime with the specified days added plusHours() – LocalDateTime with the specified hours added plusMinutes() – LocalDateTime with the specified minutes added plusSeconds() – LocalDateTime with the specified seconds added plusNanos() – LocalDateTime with the specified nanoseconds added minus: minusYears() – LocalDateTime with the specified years subtracted minusMonths() – LocalDateTime with the specified months subtracted minusDays() – LocalDateTime with the specified days subtracted minusHours() – LocalDateTime with the specified hours subtracted minusMinutes() – LocalDateTime with the specified minutes subtracted minusSeconds() – LocalDateTime with the specified seconds subtracted minusNanos() – LocalDateTime with the specified nanoseconds subtracted import java.time.LocalDateTime LocalDateTime currentDateTime = LocalDateTime.now() println \"\"\" currentDateTime : ${currentDateTime} plusYears(2) : ${currentDateTime.plusYears(2)} plusMinutes(15) : ${currentDateTime.plusMinutes(15)} plusHours(24) : ${currentDateTime.plusHours(24)} minusHours(24) : ${currentDateTime.minusHours(24)} plusDays(365) : ${currentDateTime.minusDays(365)} minusDays(365) : ${currentDateTime.minusDays(365)} plusMonths(12) : ${currentDateTime.plusMonths(12)} minusMonths(12) : ${currentDateTime.minusMonths(12)} result currentDateTime : 2021-04-29T01:41:40.026 plusYears(2) : 2023-04-29T01:41:40.026 plusMinutes(15) : 2021-04-29T01:56:40.026 plusHours(24) : 2021-04-30T01:41:40.026 minusHours(24) : 2021-04-28T01:41:40.026 plusDays(365) : 2020-04-29T01:41:40.026 minusDays(365) : 2020-04-29T01:41:40.026 plusMonths(12) : 2022-04-29T01:41:40.026 minusMonths(12) : 2020-04-29T01:41:40.026 isBefore(), isAfter() and isEqual() import java.time.LocalDateTime LocalDateTime currentDateTime = LocalDateTime.now() LocalDateTime localDataTime = currentDateTime.plusHours(24) println \"\"\" currentDateTime : ${currentDateTime} localDataTime : ${localDataTime} currentDataTime == localDataTime ? : ${currentDateTime.isEqual(localDataTime)} currentDataTime > localDataTime ? : ${currentDateTime.isAfter(localDataTime)} currentDataTime result currentDateTime : 2021-04-29T01:54:07.917 localDataTime : 2021-04-30T01:54:07.917 currentDataTime == localDataTime ? : false currentDataTime > localDataTime ? : false currentDataTime convert time convert the Date to simpleDateFormat or timeInMillis [!TIP] reference: Java – Get time in milliseconds using Date, Calendar and ZonedDateTime tools: currentDate / Time in Millisecondsmillis setup simpleDateFormat to UTC timezone simpleDateFormat.setTimeZone(TimeZone.getTimeZone(\"UTC\")) import java.util.Calendar import java.util.Date import java.time.ZonedDateTime Date date = new Date() long timeMilli_d = date.getTime() Calendar calendar = Calendar.getInstance() long timeMilli_c = calendar.getTimeInMillis() ZonedDateTime zdt = ZonedDateTime.now() Long timeMilli_z = zdt.toInstant().toEpochMilli() println \"\"\" date : ${date.toString().padRight(35)} : ${date.getClass()} timeMilli_d : ${timeMilli_d.toString().padRight(35)} : ${timeMilli_d.getClass()} calendar.time : ${calendar.time.toString().padRight(35)} : ${calendar.time.getClass()} timeMilli_c : ${timeMilli_c.toString().padRight(35)} : ${timeMilli_c.getClass()} zdt : ${zdt.toString().padRight(35)} : ${zdt.getClass()} timeMilli_z : ${timeMilli_z.toString().padRight(35)} : ${timeMilli_z.getClass()} \"\"\" result date : Mon Nov 07 00:45:32 PST 2022 : class java.util.Date timeMilli_d : 1667810732825 : class java.lang.Long calendar.time : Mon Nov 07 00:45:32 PST 2022 : class java.util.Date timeMilli_c : 1667810732826 : class java.lang.Long zdt : 2022-11-07T00:45:32.826394-08:00[America/Los_Angeles] : class java.time.ZonedDateTime timeMilli_z : 1667810732826 : class java.lang.Long current time import java.util.Calendar import java.util.Date import java.text.SimpleDateFormat import java.text.ParseException SimpleDateFormat simpleDateFormat = new SimpleDateFormat( \"yyyy-MM-dd HH:mm:ss\" ) Date date = new Date() Calendar calendar = Calendar.getInstance() def timeInMillis = date.getTime() def calendarMillis = calendar.getTimeInMillis() def simpleDate = simpleDateFormat.format( date ) println \"\"\" date : ${date.toString().padRight(30)} : ${date.getClass()} simepleDate : ${simpleDate.toString().padRight(30)} : ${simpleDate.getClass()} timeInMillis : ${timeInMillis.toString().padRight(30)} : ${timeInMillis.getClass()} calendarMillis : ${calendarMillis.toString().padRight(30)} : ${calendarMillis.getClass()} \"\"\" result // default timezone date : Thu Apr 29 00:57:03 PDT 2021 : class java.util.Date simepleDate : 2021-04-29 00:57:03 : class java.lang.String timeInMillis : 1619683023852 : class java.lang.Long calendarMillis : 1619683023853 : class java.lang.Long // utc timezone date : Thu Apr 29 00:57:27 PDT 2021 : class java.util.Date simepleDate : 2021-04-29 07:57:27 : class java.lang.String timeInMillis : 1619683047726 : class java.lang.Long calendarMillis : 1619683047726 : class java.lang.Long particular time [!TIP] i.e.: 2021-04-29 00:00:00 with SimpleDateFormat simpleDateFormat = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\") import java.util.Calendar import java.util.Date import java.text.SimpleDateFormat SimpleDateFormat simpleDateFormat = new SimpleDateFormat( \"yyyy-MM-dd HH:mm:ss\" ) String dateString = \"2021-04-29 00:00:00\" Date date = simpleDateFormat.parse( dateString ) Calendar calendar = Calendar.getInstance() calendar.setTime( date ) String timeInMillis = date.getTime() String calendarMillis = calendar.getTimeInMillis() def simpleDate = simpleDateFormat.format( date ) println \"\"\" date : ${date} simepleDate : ${simpleDate} timeInMillis : ${timeInMillis} calendarMillis : ${calendarMillis} \"\"\" result date : Thu Apr 29 00:00:00 PDT 2021 simepleDate : 2021-04-29 00:00:00 timeInMillis : 1619679600000 calendarMillis : 1619679600000 convert Long to SimpleDateFormat [!TIP] reference: Parsing and Formatting Dates in Java get Beijing Date time - Java java.util import java.util.Date import java.text.SimpleDateFormat Long x = 1086073200000 SimpleDateFormat simpleDateFormat = new SimpleDateFormat(\"HH:mm:ss dd/MM/yyyy\") simpleDateFormat.setTimeZone(TimeZone.getTimeZone(\"Asia/Shanghai\")) println \"\"\" x : ${x.toString().padRight(30)} : ${x.getClass()} Date(x) : ${(new Date(x)).toString().padRight(30)} : ${(new Date(x)).getClass()} simpleDateFormat.Date(x) : ${simpleDateFormat.format(new Date(x)).toString().padRight(30)} : ${simpleDateFormat.format( new Date(x) ).getClass()} simpleDateFormat.Date(0) : ${simpleDateFormat.format(new Date(0)).toString().padRight(30)} : ${simpleDateFormat.format( new Date(0) ).getClass()} \"\"\" resultx : 1086073200000 : class java.lang.Long Date(x) : Tue Jun 01 00:00:00 PDT 2004 : class java.util.Date simpleDateFormat.Date(x) : 15:00:00 01/06/2004 : class java.lang.String simpleDateFormat.Date(0) : 08:00:00 01/01/1970 : class java.lang.String convert timeInMillis (Long) to Date [!TIP] via java.util.Calendar import java.text.SimpleDateFormat import java.util.Calendar Long x = 1086073200000 SimpleDateFormat simpleDateFormat = new SimpleDateFormat(\"HH:mm:ss dd/MM/yyyy\") simpleDateFormat.setTimeZone(TimeZone.getTimeZone(\"Asia/Shanghai\")) Calendar calendar = Calendar.getInstance() calendar.setTimeInMillis(x) println \"\"\" x : ${x.toString().padRight(35)} : ${x.getClass()} calendar.getTime() : ${calendar.getTime().toString().padRight(35)} : ${calendar.getTime().getClass()} simpleDateFormat.format(calendar.getTime()) : ${simpleDateFormat.format(calendar.getTime()).toString().padRight(35)} : ${simpleDateFormat.format(calendar.getTime()).getClass()} \"\"\" result:x : 1086073200000 : class java.lang.Long calendar.getTime() : Tue Jun 01 00:00:00 PDT 2004 : class java.util.Date simpleDateFormat.format(calendar.getTime()) : 15:00:00 01/06/2004 : class java.lang.String convert String to Date import java.text.SimpleDateFormat String myDate = \"2014/10/29 18:10:45\"; SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy/MM/dd HH:mm:ss\"); Date date = sdf.parse(myDate) long millis = date.getTime() println \"\"\" myDate : ${myDate.toString().padRight(30)} : ${myDate.getClass()} date : ${date.toString().padRight(30)} : ${date.getClass()} \"\"\" resultmyDate : 2014/10/29 18:10:45 : class java.lang.String date : Wed Oct 29 18:10:45 PDT 2014 : class java.util.Date convert Date to timeInMillis (Long) import java.text.SimpleDateFormat String myDate = \"2014/10/29 18:10:45\"; SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy/MM/dd HH:mm:ss\"); Date date = sdf.parse(myDate) long millis = date.getTime() println \"\"\" myDate : ${myDate.toString().padRight(30)} : ${myDate.getClass()} date : ${date.toString().padRight(30)} : ${date.getClass()} millis : ${millis.toString().padRight(30)} : ${millis.getClass()} \"\"\" resultmyDate : 2014/10/29 18:10:45 : class java.lang.String date : Wed Oct 29 18:10:45 PDT 2014 : class java.util.Date millis : 1414631445000 : class java.lang.Long formatting date reference : Class DateTimeFormatter DateTimeFormatter : BASIC_ISO_DATE : '20110103' ISO_LOCAL_DATE : '2011-12-03' ISO_OFFSET_DATE : '2011-12-03+01:00' ISO_DATE : '2011-12-03+01:00'; '2011-12-03' ISO_LOCAL_TIME : '10:15:30' ISO_OFFSET_TIME : '10:15:30+01:00' ISO_TIME : '10:15:30+01:00'; '10:15:30' ISO_LOCAL_DATE_TIME : '2011-12-03T10:15:30' ISO_OFFSET_DATE_TIME : '2011-12-03T10:15:30+01:00' ISO_ZONED_DATE_TIME : '2011-12-03T10:15:30+01:00[Europe/Paris]' ISO_DATE_TIME : '2011-12-03T10:15:30+01:00[Europe/Paris]' ISO_ORDINAL_DATE : '2012-337' ISO_WEEK_DATE : '2012-W48-6 ISO_INSTANT : '2011-12-03T10:15:30Z' RFC_1123_DATE_TIME : 'Tue, 3 Jun 2008 11:05:30 GMT' Patterns for Formatting and Parsing : Symbol Meaning Presentation Examples G era text AD; Anno Domini; A u year year 2004; 04 y year-of-era year 2004; 04 D day-of-year number 189 M/L month-of-year number/text 7; 07; Jul; July; J d day-of-month number 10 Q/q quarter-of-year number/text 3; 03; Q3; 3rd quarter Y week-based-year year 1996; 96 w week-of-week-based-year number 27 W week-of-month number 4 E day-of-week text Tue; Tuesday; T e/c localized day-of-week number/text 2; 02; Tue; Tuesday; T F week-of-month number 3 a am-pm-of-day text PM h clock-hour-of-am-pm (1-12) number 12 K hour-of-am-pm (0-11) number 0 k clock-hour-of-am-pm (1-24) number 0 H hour-of-day (0-23) number 0 m minute-of-hour number 30 s second-of-minute number 55 S fraction-of-second fraction 978 A milli-of-day number 1234 n nano-of-second number 987654321 N nano-of-day number 1234000000 V time-zone ID zone-id America/Los_Angeles; Z; -08:30 z time-zone name zone-name Pacific Standard Time; PST O localized zone-offset offset-O GMT+8; GMT+08:00; UTC-08:00; X zone-offset 'Z' for zero offset-X Z; -08; -0830; -08:30; -083015; -08:30:15; x zone-offset offset-x +0000; -08; -0830; -08:30; -083015; -08:30:15; Z zone-offset offset-Z +0000; -0800; -08:00; p pad next pad modifier 1 ' escape for text delimiter '' single quote literal ' [ optional section start ] optional section end # reserved for future use { reserved for future use } reserved for future use . import java.time.LocalDateTime import java.time.format.DateTimeFormatter LocalDateTime currentDateTime = LocalDateTime.now() DateTimeFormatter basicISODate = DateTimeFormatter.BASIC_ISO_DATE DateTimeFormatter isoLocalDate = DateTimeFormatter.ISO_LOCAL_DATE DateTimeFormatter isoLocalTime = DateTimeFormatter.ISO_LOCAL_TIME DateTimeFormatter isoLocalDateTime = DateTimeFormatter.ISO_LOCAL_DATE_TIME println \"\"\" currentDateTime : ${currentDateTime} BASIC_ISO_DATE : ${basicISODate.format(currentDateTime)} ISO_LOCAL_DATE : ${isoLocalDate.format(currentDateTime)} ISO_LOCAL_TIME : ${isoLocalTime.format(currentDateTime)} ISO_LOCAL_DATE_TIME : ${isoLocalDateTime.format(currentDateTime)} \"\"\" result currentDateTime : 2021-04-29T02:45:37.501 BASIC_ISO_DATE : 20210429 ISO_LOCAL_DATE : 2021-04-29 ISO_LOCAL_TIME : 02:45:37.501 ISO_LOCAL_DATE_TIME : 2021-04-29T02:45:37.501 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/groovy/utility.html":{"url":"programming/groovy/utility.html","title":"utility","keywords":"","body":" regex Pattern and Matcher matches to regex (return Boolean) get all matches encoding & decoding recursively encoding recursively decoding unicode regex Pattern and Matcher references: java.util.regex matches to regex (return Boolean) String cpuset = '/kubepods/burstable/pod59899be8/b60bf42d334be0eff64f325bad5b0ca4750119fbf8a7e80afa4e559040208ab3' String pattern = '^/kubepods/([^/]+/){2}(\\\\w{64})$' assert (cpuset =~ pattern).find() == true assert (cpuset =~ pattern).lookingAt() == true assert (cpuset =~ pattern).matches() == true get all matches String text = \"\"\" This text contains some numbers like 1024 or 256. Some of them are odd (like 3) or even (like 2). \"\"\" String pattern = '\\\\d+' assert (text =~ pattern).findAll() == [ '1024', '256', '3', '2' ] safely capture the matches String k8sPattern = '^/kubepods/([^/]+/){2}(\\\\w{64})$' String dockerPattern = '^/docker/(\\\\w{64})$' String cpuset = '/kubepods/burstable/pod59899be8/b60bf42d334be0eff64f325bad5b0ca4750119fbf8a7e80afa4e559040208ab3' int groupIndex = 0 int index = 1 ( cpuset =~ k8sPattern ).findAll()?.getAt(groupIndex)?.getAt(index) ?: null ( cpuset =~ dockerPattern ).findAll()?.getAt(groupIndex)?.getAt(index) ?: null encoding & decoding reference: * URL encoding * URL decoding java.net.URLEncoder java.net.URLDecoder Groovy UrlEncode and UrlDecode a map mujahidk/base64coding.groovy Groovy Goodness: Base64 Encoding recursively encoding import java.net.URLEncoder import java.nio.charset.StandardCharsets String encoder ( String url, Integer counter = 1 ) { if ( counter == 0 ) return url if ( counter > 0 ) return encoder( URLEncoder.encode( url, StandardCharsets.UTF_8 ), counter - 1 ) } recursively decoding import java.net.URLDecoder import java.nio.charset.StandardCharsets String decoder ( String url, Integer counter = 1 ) { if ( counter == 0 ) return url if ( counter > 0 ) return decoder( URLDecoder.decode( url, StandardCharsets.UTF_8 ), counter - 1 ) } unicode println \"\"\" \\\\u22c5 : | \\u22c5 | \\\\u23d0 : | \\u23d0 | \\\\u2802 : | \\u2802 | \\\\u2812 : | \\u2812 | \\\\u00a8 : | \\u00a8 | \\\\u2810 : | \\u2810 | \\\\u22ef : | \\u22ef | \\\\u1801 : | \\u1801 | \\\\u1802 : | \\u1802 | \\\\u1803 : | \\u1803 | \\\\u20db : | \\u20db | \\\\u20dc : | \\u20dc | \\\\u20e8 : | \\u20e8 | \\\\u20db : | \\u20db | \\\\u20dc : | \\u20dc | \\\\u2236 : | \\u2236 | \\\\u22ee : | \\u22ee | \\\\u22ef : | \\u22ef | \\\\u2d48 : | \\u2d48 | \\\\u2d42 : | \\u2d42 | \\\\u2d57 : | \\u2d57 | \\\\u2d67 : | \\u2d67 | \\\\u2e31 : | \\u2e31 | \\\\u302f : | \\u302f | \\\\ua4fd : | \\ua4fd | \\\\ua537 : | \\ua537 | \\\\ua539 : | \\ua539 | \\\\ua789 : | \\ua789 | \\\\ufe19 : | \\ufe19 | \\\\ufe55 : | \\ufe55 | \\\\u2219 : | \\u2219 | \\\\u22c5 : | \\u22c5 | \\\\u22ef : | \\u22ef | \\\\u25b4 : | \\u25b4 | \\\\u25b8 : | \\u25b8 | \\\\u25be : | \\u25be | \\\\u25c2 : | \\u25c2 | \\\\u25cf : | \\u25cf | \\\\u25b9 : | \\u25b9 | \\\\u25bf : | \\u25bf | \\\\u2639 : | \\u2639 | \\\\u263a : | \\u263a | \\\\u263b : | \\u263b | \"\"\" result \\u22c5 : | ⋅ | \\u23d0 : | ⏐ | \\u2802 : | ⠂ | \\u2812 : | ⠒ | \\u00a8 : | ¨ | \\u2810 : | ⠐ | \\u22ef : | ⋯ | \\u1801 : | ᠁ | \\u1802 : | ᠂ | \\u1803 : | ᠃ | \\u20db : | | \\u20dc : | | \\u20e8 : | | \\u20db : | | \\u20dc : | | \\u2236 : | ∶ | \\u22ee : | ⋮ | \\u22ef : | ⋯ | \\u2d48 : | ⵈ | \\u2d42 : | ⵂ | \\u2d57 : | ⵗ | \\u2d67 : | ⵧ | \\u2e31 : | ⸱ | \\u302f : | | \\ua4fd : | ꓽ | \\ua537 : | ꔷ | \\ua539 : | ꔹ | \\ua789 : | ꞉ | \\ufe19 : | ︙ | \\ufe55 : | ﹕ | \\u2219 : | ∙ | \\u22c5 : | ⋅ | \\u22ef : | ⋯ | \\u25b4 : | ▴ | \\u25b8 : | ▸ | \\u25be : | ▾ | \\u25c2 : | ◂ | \\u25cf : | ● | \\u25b9 : | ▹ | \\u25bf : | ▿ | \\u2639 : | ☹ | \\u263a : | ☺ | \\u263b : | ☻ | Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/groovy/grape.html":{"url":"programming/groovy/grape.html","title":"grape","keywords":"","body":" basic usage specify additional repositories maven classifiers excluding transitive dependencies jdbc drivers using grape from the groovy shell settings proxy settings logging jenkins-core setup manually use jenkins-core Q&A references: Dependency management with Grape GROOVY-7833 releases/org/jenkins-ci/main/jenkins-core basic usage @Grab(group='org.springframework', module='spring-orm', version='5.2.8.RELEASE') import org.springframework.jdbc.core.JdbcTemplate or@Grab('org.springframework:spring-orm:5.2.8.RELEASE') import org.springframework.jdbc.core.JdbcTemplate specify additional repositories @GrabResolver(name='restlet', root='http://maven.restlet.org/') @Grab(group='org.restlet', module='org.restlet', version='1.1.6') maven classifiers @Grab(group='net.sf.json-lib', module='json-lib', version='2.2.3', classifier='jdk15') excluding transitive dependencies @Grab('net.sourceforge.htmlunit:htmlunit:2.8') @GrabExclude('xml-apis:xml-apis') jdbc drivers @GrabConfig(systemClassLoader=true) @Grab(group='mysql', module='mysql-connector-java', version='5.1.6') using grape from the groovy shell groovy.grape.Grape.grab(group:'org.springframework', module:'spring', version:'2.5.6') settings proxy settings [!TIP] reference: Java Networking and Proxies Networking Properties The JAVA_TOOL_OPTIONS Environment Variable Bypassing non proxy hosts in JAVA_OPTS Configure HTTP/HTTPS Proxy Settings Java Setting JVM Options for Application Servers java HotSpot VM Command-Line Options The java Command nonProxy -Dhttp.nonProxyHosts=\"localhost|127.0.0.1|10.*.*.*|*.example.com|etc\" useSystemProxy $ java -Djava.net.useSystemProxies=true # or https://stackoverflow.com/a/32511851/2940319 export JAVA_TOOL_OPTIONS+=\" -Djava.net.useSystemProxies=true\" # or System.setProperty(\"java.net.useSystemProxies\", \"true\"); socket proxy$ java -DsocksProxyHost=127.0.0.1 -DsocksProxyPort=8080 org.example.Main $ groovy -Dhttp.proxyHost=yourproxy -Dhttp.proxyPort=8080 yourscript.groovy # or JAVA_OPTS = -Dhttp.proxyHost=yourproxy -Dhttp.proxyPort=8080 logging show download process $ groovy -Dgroovy.grape.report.downloads=true sample.groovy Resolving dependency: org.springframework#spring-orm;5.2.8.RELEASE {default=[default]} Preparing to download artifact org.springframework#spring-orm;5.2.8.RELEASE!spring-orm.jar Preparing to download artifact org.springframework#spring-beans;5.2.8.RELEASE!spring-beans.jar Preparing to download artifact org.springframework#spring-core;5.2.8.RELEASE!spring-core.jar Preparing to download artifact org.springframework#spring-jdbc;5.2.8.RELEASE!spring-jdbc.jar Preparing to download artifact org.springframework#spring-tx;5.2.8.RELEASE!spring-tx.jar Preparing to download artifact org.springframework#spring-jcl;5.2.8.RELEASE!spring-jcl.jar Downloaded 3006 Kbytes in 893ms: [SUCCESSFUL ] org.springframework#spring-orm;5.2.8.RELEASE!spring-orm.jar (202ms) [SUCCESSFUL ] org.springframework#spring-beans;5.2.8.RELEASE!spring-beans.jar (154ms) [SUCCESSFUL ] org.springframework#spring-core;5.2.8.RELEASE!spring-core.jar (175ms) [SUCCESSFUL ] org.springframework#spring-jcl;5.2.8.RELEASE!spring-jcl.jar (112ms) [SUCCESSFUL ] org.springframework#spring-jdbc;5.2.8.RELEASE!spring-jdbc.jar (132ms) [SUCCESSFUL ] org.springframework#spring-tx;5.2.8.RELEASE!spring-tx.jar (111ms) log with even more verbosity $ groovy -Divy.message.logger.level=4 sample.groovy jenkins-core [!TIP] references: org.jenkins-ci.main/jenkins-core jenkinsci/java-client-api setup manually setup JAVA_OPTS ( if necessary ) echo \"JAVA_OPTS+='-Dhttp.proxyHost=my.proxy.com -Dhttp.proxyPort=80'\" >> ~/.bashrc source ~/.bashrc # result $ echo $JAVA_OPTS -Dhttp.proxyHost=my.proxy.com -Dhttp.proxyPort=80 download pom and jar to ~/.m2 $ version='2.377' $ path=\"~/.m2/repository/org/jenkins-ci/main/jenkins-core/${version}\" $ url=\"https://repo.jenkins-ci.org/artifactory/releases/org/jenkins-ci/main/jenkins-core/${version}\" $ mkdir -p \"${path}\" && cd $_ $ curl -fsSL -o \"${path}\"/jenkins-core-${version}.pom \"${url}\"/jenkins-core-${version}.pom $ curl -fsSL -o \"${path}\"/jenkins-core-${version}.jar \"${url}\"/jenkins-core-${version}.jar download dependencies $ cat jenkins-core.groovy @GrabResolver(name='jenkins', root='https://repo.jenkins-ci.org/releases') @Grab(group='org.jenkins-ci.main', module='jenkins-core', version='2.377') import jenkins.model.Jenkins $ groovy [-Divy.message.logger.level=4] -Dgroovy.grape.report.downloads=true jenkins-core.groovy use jenkins-core @GrabResolver(name='jenkins', root='https://repo.jenkins-ci.org/releases') @Grab(group='org.jenkins-ci.main', module='jenkins-core', version='2.377') import hudson.Util println Util.XS_DATETIME_FORMATTER.format( new Date() ) // => 2022-11-23T13:39:34Z Q&A org.connectbot.jbcrypt#jbcrypt;1.0.0 errors:: USE VERBOSE OR DEBUG MESSAGE LEVEL FOR MORE DETAILS org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed: General error during conversion: Error grabbing Grapes -- [unresolved dependency: org.connectbot.jbcrypt#jbcrypt;1.0.0: java.text.ParseException: project must be the root tag] solution [!TIP] solution: using org/connectbot/jbcrypt/1.0.2 instead of org/connectbot/jbcrypt/jbcrypt/1.0.0 $ grep -n jbcrypt ~/.groovy/grapes/org.jenkins-ci.main/jenkins-core/ivy-2.377.xml 89: compile(*),master(*);runtime->runtime(*)\"/> | v 89: compile(*),master(*);runtime->runtime(*)\"/> Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/groovy/sugar.html":{"url":"programming/groovy/sugar.html","title":"syntactic sugar","keywords":"","body":" common multiple assignment Boolean get the first item if exists or null if empty split and trim in string indices & indexed() elegant way to merge Map> structure by using groovy fuzzy search and merge Map>> groupBy get object id (python -c 'id('abc')) loop if not empty getField() generate the random String dynamic method names run groovy from docker MetaClass get supported methods A Bit of metaClass DSL get class name dynamically call methods others groovy cli (args) with options Get variable value for its name groovy.lang.Binding load groovy file GroovyShell() GroovyClassLoader() metaClass reference: Groovy Cookbook Three Groovy String methods that will make your life Groovier! Groovy: split string and avoid getting IndexOutOfBoundsException common multiple assignment [!TIP] references: Groovy: split string and avoid getting IndexOutOfBoundsException '''1;Joe Doe;joedoe@example.com 2;Mark Doe 3;Clark Doe;clarkdoe@example.com;2 '''.eachLine{ line -> def (id, name, email, sibling) = line.tokenize(';') println \"\"\" id : ${id} name : ${name} email : ${email} sibling : ${sibling} \"\"\" } result id : 1 name : Joe Doe email : joedoe@example.com sibling : null id : 2 name : Mark Doe email : null sibling : null id : 3 name : Clark Doe email : clarkdoe@example.com sibling : 2 Boolean usage scenarios: Boolean doMap( Map m ) { return true|false } if ( map ) { doMap( map ) } else { return true } ==> map ? doMap(map) : true ==> ! map || doMap(map) try online assert ( true ? foo() : true ) == ( ! true || foo() ) substring for integers String str = 'abc12' assert 'abc' == \"${str - ~/\\d+\\s*/}\" get the first item if exists or null if empty assert [:]?.find{true} == null assert []?.find{true} == null assert ['a']?.find{true} == 'a' ['a': '1'].find{ true }.each { println it.key + ' ~> ' + it.value } println (['a': '1'].find{ true }.getClass()) // result // a ~> 1 // class java.util.LinkedHashMap$Entry split and trim in string spread operator: *. groovy:000> 'a , b, ccc ,d'.split(',')*.trim() ===> [a, b, ccc, d] regular expression \\s*\\s* groovy:000> 'a , b, ccc ,d'.trim().split(\"\\\\s*,\\\\s*\") ===> [a, b, ccc, d] indices & indexed() def rows = ['foo', 'bar'] println rows.indices println rows.indexed() ===> result 0.. usage def userList = [ [name: 'user1', id:0, ip: '127.0.0.1'], [name: 'user2', id:1, ip: '127.0.0.2'], [name: 'user3', id:2, ip: '127.0.0.3'] ] def rows = ['foo', 'bar'] println rows.indices.collect { index -> // Using indices userList.find { it.id == index } } println rows.indexed().collect { index, item -> // Using indexed() userList.find { it.id == index } } ===> result [[name:user1, id:0, ip:127.0.0.1], [name:user2, id:1, ip:127.0.0.2]] [[name:user1, id:0, ip:127.0.0.1], [name:user2, id:1, ip:127.0.0.2]] elegant way to merge Map> structure by using groovy original Map structure wanted result Map> case_pool = [ dev : [ funcA : ['devA'] , funcB : ['devB'] , funcC : ['devC'] ], 'dev/funcA' : [ funcA : ['performanceA'] ], 'dev/funcA/feature' : [ funcA : ['performanceA', 'feature'] ], staging : [ funcB : ['stgB'] , funcC : ['stgC'] ] ] String branch = 'dev/funcA/feature-1.0' result: [ funcA: [ \"devA\", \"performanceA\", \"feature\" ], funcB: [ \"devB\" ], funcC: [ \"devC\" ] ] original map structure: Map> case_pool = [ dev : [ funcA : ['devA'] , funcB : ['devB'] , funcC : ['devC'] ], 'dev/funcA' : [ funcA : ['performanceA'] ], 'dev/funcA/feature' : [ funcA : ['performanceA', 'feature'] ], staging : [ funcB : ['stgB'] , funcC : ['stgC'] ] ] method 1st: by using loop String branch = 'dev/funcA/feature-1.0' def result = [:].withDefault { [] as Set } case_pool.keySet().each { if ( branch.contains(it) ) { case_pool.get(it).each { k, v -> result[k].addAll(v) } } } println 'result: ' + result method 2nd: by using closure String branch = 'dev/funcA/feature-1.0' def result = [:].withDefault { [] as Set } case_pool.findAll{ k, v -> branch.contains(k) } .collectMany{ k, v -> v.collect{ c, l -> result[c].addAll(l) } } println 'result: ' + result method 3rd: by using closure elegantly def result = case_pool.inject([:].withDefault { [] as Set }) { result, key, value -> if (branch.contains(key)) { value.each { k, v -> result[k] += v } }; result } println 'result: ' + result fuzzy search and merge Map>> /** * \"fuzzy\" search and merge the {@code Map>} according to keywords. * To replace the hardcode 'keyword' search {@code case_pool.get(stg).get(keyword).values()}. example: * * keyword = 'dev/funcA/feature1' * fuzzyFindAll( case_pool, keyword ) * => Result: [funcA:[devA, performanceA, feature], funcB:[devB], funcC:[devC]] * * * @param map the map structure for {@code Map>} * @param keyword use branch as keyword normally **/ def fuzzyFindAll( Map map, String keyword ) { Map result = [:] map.findAll{ k, v -> keyword.toLowerCase().contains(k.toLowerCase()) }.collect { k, v -> v.each { key, value -> result[key] = [ result.getOrDefault(key,[]) + value ].flatten().unique() } } return result } groupBy groupBy List> to Map requirements: [ [\"GX 470\",\"Model\"], [\"Lexus\",\"Make\"], [\"Jeep\",\"Make\"], [\"Red\",\"Color\"], [\"blue\",\"Color\"] ] ⇣⇣ [\"Model\":[\"GX 470\"],\"Make\":[\"Lexus\",\"Jeep\"],\"Color\":[\"Red\", \"blue\"]] solution def list = [ [\"GX-470\",\"Model\"], [\"Lexus\",\"Make\"], [\"Jeep\",\"Make\"], [\"Red\",\"Color\"], [\"blue\",\"Color\"] ] list.groupBy{ it[1] }.collectEntries{ k, v -> [(k): v.collect{it.get(0)}] } alternatives list.inject([:].withDefault{[]}) { map, elem -> map[elem[1]] groupBy List>> [!NOTE|label:references:] Groovy - Merge/Group By List of Maps List>> lstData = [ [ \"Year\":[\"FY19\"] , \"Period\":[\"Oct\"] , \"Account\":[\"A1000\" , \"A1001\"] ] , [ \"Year\":[\"FY19\"] , \"Period\":[\"Oct\"] , \"Account\":[\"A1001\" , \"A1002\"] ] , [ \"Year\":[\"FY19\"] , \"Period\":[\"Nov\"] , \"Account\":[\"A1000\" , \"A1001\" , \"A1002\"] ] , [ \"Year\":[\"FY19\"] , \"Period\":[\"Dec\"] , \"Account\":[\"A1000\" , \"A1002\"] ] , [ \"Year\":[\"FY20\"] , \"Period\":[\"Jan\"] , \"Account\":[\"A1000\" , \"A1003\"] ] ] lstData.groupBy { it.Year + it.Period }.collect { k, v -> v.tail().inject(v.head()) { r, c -> r.Account = (r.Account + c.Account).unique(); r } }.groupBy { it.Account }.collect { k, v -> v.tail().inject(v.head()) { r, c -> r.Year = (r.Year + c.Year).unique() r.Period = (r.Period + c.Period).unique() r } } result[ [ \"Year\": [ \"FY19\" ], \"Period\": [ \"Oct\", \"Nov\" ], \"Account\": [ \"A1000\", \"A1001\", \"A1002\" ] ], [ \"Year\": [ \"FY19\" ], \"Period\": [ \"Dec\" ], \"Account\": [ \"A1000\", \"A1002\" ] ], [ \"Year\": [ \"FY20\" ], \"Period\": [ \"Jan\" ], \"Account\": [ \"A1000\", \"A1003\" ] ] ] groupBy Map> [!NOTE|label:references:] How do I add multiple Groovy map entries without overwriting the current entries? Map> lineEdits = [ flag:[ [ id:10001 , mnemonic:'TRA' , action:'review' ] , [ id:10002 , mnemonic:'REB' , action:'deny' ] , [ id:10003 , mnemonic:'UNB' , action:'deny' ] , [ id:20001 , mnemonic:'REB' , action:'deny' ] , [ id:20002 , mnemonic:'ICD' , action:'review' ] , [ id:30001 , mnemonic:'REB' , action:'deny' ] , [ id:40001 , mnemonic:'ICD' , action:'review' ] , [ id:40002 , mnemonic:'MPR' , action:'review' ] , [ id:50001 , mnemonic:'CPT' , action:'deny' ] , [ id:60001 , mnemonic:'DTU' , action:'deny' ] , [ id:70001 , mnemonic:'ICD' , action:'review' ] , [ id:70002 , mnemonic:'MPR' , action:'review' ] ] ] def editsMap = lineEdits.flag .groupBy { it.id } // Group by id .collectEntries { k, v -> [ k, v[ 0 ] ] // Just grab the first one (flatten) } result[ \"10001\": [ \"id\": 10001, \"mnemonic\": \"TRA\", \"action\": \"review\" ] , \"10002\": [ \"id\": 10002, \"mnemonic\": \"REB\", \"action\": \"deny\" ] , \"10003\": [ \"id\": 10003, \"mnemonic\": \"UNB\", \"action\": \"deny\" ] , \"20001\": [ \"id\": 20001, \"mnemonic\": \"REB\", \"action\": \"deny\" ] , \"20002\": [ \"id\": 20002, \"mnemonic\": \"ICD\", \"action\": \"review\" ] , \"30001\": [ \"id\": 30001, \"mnemonic\": \"REB\", \"action\": \"deny\" ] , \"40001\": [ \"id\": 40001, \"mnemonic\": \"ICD\", \"action\": \"review\" ] , \"40002\": [ \"id\": 40002, \"mnemonic\": \"MPR\", \"action\": \"review\" ] , \"50001\": [ \"id\": 50001, \"mnemonic\": \"CPT\", \"action\": \"deny\" ] , \"60001\": [ \"id\": 60001, \"mnemonic\": \"DTU\", \"action\": \"deny\" ] , \"70001\": [ \"id\": 70001, \"mnemonic\": \"ICD\", \"action\": \"review\" ] , \"70002\": [ \"id\": 70002, \"mnemonic\": \"MPR\", \"action\": \"review\" ] ] get object id (python -c 'id('abc')) java.lang.System.identityHashCode( obj ) example String s = 'abc' String x = s println java.lang.System.identityHashCode(s) println java.lang.System.identityHashCode(x) x = s + 'aa' println java.lang.System.identityHashCode(x) ==> 51571311 51571311 733591550 example for identityHashCode() and hashCode() String a = new String(\"hhh\") String b = new String(\"hhh\") assert System.identityHashCode(a) != System.identityHashCode(b) assert a.hashCode() == b.hashCode() loop if not empty []?.each{ println it } ?: println( 'empty' ) [:]?.each{ k, v -> println \"${k} :: ${v}\" } ?: println( 'empty' ) detailsassert [:]?.each{ k, v -> println \"${k} :: ${v}\" } == true | | [:] false getField() groovy:000 > 'aaa'.getClass().getFields() ===> [public static final java.util.Comparator java.lang.String.CASE_INSENSITIVE_ORDER] generate the random String [!NOTE] check also in * imarslo : random String alphabet = (('a'..'z') + ('A'..'Z') + ('0'..'9')).join() println new Random().with { (1..8).collect { alphabet[ nextInt( alphabet.length() ) ] }.join() } orClosure generator = { String alphabet, int n -> new Random().with { (1..n).collect { alphabet[ nextInt( alphabet.length() ) ] }.join() } } String charset = (('A'..'Z')+('0'..'9')+('a'..'z')).join() randomValue = generator( charset, 15 ) dynamic method names def codecs = classes.findAll { it.name.endsWith('Codec') } codecs.each { codec -> Object.metaClass.\"encodeAs${codec.name-'Codec'}\" = { codec.newInstance().encode(delegate) } Object.metaClass.\"decodeFrom${codec.name-'Codec'}\" = { codec.newInstance().decode(delegate) } } def html = 'hello' assert 'hello' == html.encodeAsHTML() run groovy from docker $ docker run \\ --rm \\ -e hola=caracola \\ -it \\ groovy:latest groovy -e \"System.getenv().each{ println it }\" mount volume$ docker run \\ --rm \\ -v \"$PWD\":/home/marslo/scripts \\ -w /home/marslo/scripts \\ groovy:latest \\ groovy DockerBasico.groovy -a DockerBasico.groovyif ( options.a ) { println \"------------------------------------------------------------------\" System.getenv().each{ println it } println \"------------------------------------------------------------------\" } with Json $ docker run \\ --rm \\ -v \"$PWD\":/home/marslo/scripts \\ -w /home/marslo/scripts \\ groovy:latest groovy DockerBasico.groovy -d DockerBasico.groovy > how to download the image via json if( options.d ){ def json = new groovy.json.JsonSlurper().parse( new URL(\"https://dog.ceo/api/breed/hound/images/random\") ) if( json.status=='success' ){ new File('perrito.jpg').bytes = new URL(json.message).bytes } } MetaClass [!NOTE] references: GroovyObject Methods Overriding Static invokeMethod Extending Interfaces class Stuff { def invokeMe() { \"foo\" } } Stuff.metaClass.invokeMethod = { String name, args -> def metaMethod = Stuff.metaClass.getMetaMethod(name, args) def result if(metaMethod) result = metaMethod.invoke(delegate,args) else { result = \"bar\" } result } def stf = new Stuff() assert \"foo\" == stf.invokeMe() assert \"bar\" == stf.doStuff() get supported methods String s = 'aa' println s.metaClass.methods.name result [equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait, charAt, codePointAt, codePointBefore, codePointCount, compareTo, compareToIgnoreCase, concat, contains, contentEquals, contentEquals, copyValueOf, copyValueOf, endsWith, equals, equalsIgnoreCase, format, format, getBytes, getBytes, getBytes, getBytes, getChars, hashCode, indexOf, indexOf, indexOf, indexOf, intern, isEmpty, join, join, lastIndexOf, lastIndexOf, lastIndexOf, lastIndexOf, length, matches, offsetByCodePoints, regionMatches, regionMatches, replace, replace, replaceAll, replaceFirst, split, split, startsWith, startsWith, subSequence, substring, substring, toCharArray, toLowerCase, toLowerCase, toString, toUpperCase, toUpperCase, trim, valueOf, valueOf, valueOf, valueOf, valueOf, valueOf, valueOf, valueOf, valueOf] or print by sort println .metaClass.methods*.name.sort().unique() A Bit of metaClass DSL String.metaClass { or delegate.plus(' or ').plus(s) } or delegate.findAll(\"(${l.join('|')})\") } and { String s -> delegate.plus(' and ').plus(s) } 'static' { groovy { 'Yeah man!' } } } assert 'Groovy or Java?' == (\"Groovy\" | \"Java?\") assert ['o', 'o', 'y'] == (\"Groovy\" | ['o', 'y']) assert 'Groovy and Java!' == (\"Groovy\" & \"Java!\") assert 'Yeah man!' == String.groovy() metaClass with Closure List.metaClass.eachUntilGreaterThanFive = { closure -> for ( value in delegate ) { if ( value > 5 ) break closure(value) } } [1, 2, 3, 4, 5, 6, 7].eachUntilGreaterThanFive { println it } get class name Sting s = 'string' println s.metaClass.getTheClass() // Class println s.getClass() // Class println s.class.name // String outputclass java.lang.String class java.lang.String java.lang.String dynamically call methods references: Get variable dynamically def doPrint( String platform, String string ) { this.\"do${platform.toLowerCase().capitalize()}Print\"( string ) } def doLinuxPrint( String string ) { println \"from Linux: ${string}\" } def doWindowsPrint( String string ) { println \"from Windows: ${string}\" } def doDockerPrint( String string ) { println \"from Docker: ${string}\" } doPrint( 'LINUX', 'awesome marslo!' ) doPrint( 'dOCKER', 'awesome marslo!' ) resultfrom Linux: awesome marslo! from Docker: awesome marslo! others groovy cli (args) with options reference: groovy script 101 - Dockery Groovy (basic) def cli = new CliBuilder(usage: 'groovy DockerBasico.groovy]') cli.with { h(longOpt: 'help', 'Usage Information \\n', required: false) a(longOpt: 'Hello','Al seleccionar \"a\" te saludara ', required: false) d(longOpt: 'Dogs', 'Genera imagenes de perros', required:false) } def options = cli.parse(args) if ( !options || options.h ) { cli.usage return } //tag::hello[] if ( options.a ) { println \"------------------------------------------------------------------\" println \"Hello\" System.getenv().each{ println it } println \"------------------------------------------------------------------\" } //end::hello[] //tag::dogs[] if ( options.d ){ def json = new groovy.json.JsonSlurper().parse( new URL(\"https://dog.ceo/api/breed/hound/images/random\") ) if( json.status=='success' ){ new File('perrito.jpg').bytes = new URL(json.message).bytes } } //end::dogs[] Get variable value for its name import groovy.text.SimpleTemplateEngine def binding = [ VAL1:'foo', VAL2:'bar' ] def template = 'hello ${VAL1}, please have a ${VAL2}' // single quotes println new SimpleTemplateEngine().createTemplate( template ).make( binding ).toString() groovy.lang.Binding this.binding reference: Binding variables access in Groovy script's defined classes baz = [ 'a':'b' ] foo = \"abc\" bar = \"def\" println this.binding.hasVariable('baz') this.binding.variables.each{ println \"${it.key} : ${it.value}\" } resulttrue args : [] baz : [a:b] foo : abc bar : def new Binding() String beans = 'aabbcc-beans-ddeeff' Binding b = new Binding(); b.setVariable(\"beans\", beans); b.variables.each{ println \"${it.key} : ${it.value}\" } binding.setVariable() m = [ 'a' : '1', 'b' : '2' ] binding.setVariable(\"a\", m) this.binding.variables.each{ println \"${it.key} : ${it.value}\" } resultargs : [] m : [a:1, b:2] a : [a:1, b:2] load groovy file sample.groovy: #!/usr/bin/env groovy import groovy.transform.Field @Field final Map> SAMPLE = [ k1 : [ 'k11' : 'v11' ] , k2 : [ 'k21' : 'v21', 'k22' : 'v22' ] ] references: Integrating Groovy in a Java application GroovyShell GroovyClassLoader GroovyShell() new GroovyShell().parse(new File('/path/to/file')) Object sample = new GroovyShell().parse(new File('/path/to/sample.groovy')) println \"\"\" sample.getClass() : ${sample.getClass()} sample.SAMPLE.k1 : ${sample.SAMPLE.k1} \"\"\" result sample.getClass() : class sample sample.SAMPLE.k1 : [k11:v11] Object.with{} Object sample = new GroovyShell().parse(new File('/path/to/sample.groovy')) sample.with{ println SAMPLE println SAMPLE.k1 } result[k1:[k11:v11], k2:[k21:v21, k22:v22]] [k11:v11] GroovyClassLoader() new GroovyClassLoader().parseClass(\"/path/to/sample.groovy\" as File) Class clazz = new GroovyClassLoader().parseClass(\"/path/to/sample.groovy\" as File) println \"\"\" clazz.getClass() : ${clazz.getClass()} clazz.newInstance().SAMPLE : ${clazz.newInstance().SAMPLE} \"\"\" result clazz.getClass() : class java.lang.Class clazz.newInstance().SAMPLE : [k1:[k11:v11], k2:[k21:v21, k22:v22]] this.class.classLoader.parseClass(new File(\"/path/to/sample.groovy\")) Class myClazz = this.class.classLoader.parseClass(new File(\"/Users/marslo/Desktop/sample.groovy\")) println \"\"\" myClazz.getClass() : ${myClazz.getClass()} myClazz.newInstance().SAMPLE : ${myClazz.newInstance().SAMPLE} \"\"\" result myClazz.getClass() : class java.lang.Class myClazz.newInstance().SAMPLE : [k1:[k11:v11], k2:[k21:v21, k22:v22]] new GroovyClassLoader(getClass().getClassLoader()).parseClass(new File(\"/path/to/sample.groovy\")) Class gClass = new GroovyClassLoader(getClass().getClassLoader()).parseClass(new File(\"/path/to/sample.groovy\")); println \"\"\" gClass.getClass() : ${gClass.getClass()} gClass.newInstance().SAMPLE : ${gClass.newInstance().SAMPLE} \"\"\" result gClass.getClass() : class java.lang.Class gClass.newInstance().SAMPLE : [k1:[k11:v11], k2:[k21:v21, k22:v22]] metaClass Object sample = new GroovyShell().parse(new File('/path/to/sample.groovy')) println sample.metaClass.hasProperty(sample, 'SAMPLE').type println sample.metaClass.hasProperty(sample, 'SAMPLE').name resultinterface java.util.Map SAMPLE or Class clazz = new GroovyClassLoader().parseClass(\"/path/to/sample.groovy\" as File) println clazz.metaClass.hasProperty(clazz, 'SAMPLE').dump() result more def importScript(def scriptFile) { def script = new GroovyShell().parse(new File(scriptFile)) script.metaClass.methods.each { if (it.declaringClass.getTheClass() == script.class && ! it.name.contains('$') && it.name != 'main' && it.name != 'run') { this.metaClass.\"$it.name\" = script.&\"$it.name\" } } } importScript('File1.groovy') method() Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/python/python.html":{"url":"programming/python/python.html","title":"python","keywords":"","body":" Pythonic zip/unzip in dict & counter enumerate import local module args & kwargs itertools one-line python code slice chain compare boolean reverse join in list sum & max & min & time list comprehensions default dict if...else... ternary operator dict & zip hidden features numbers string args conditional assignment list & dics generator & iteration statement funcs class & module Others PEP8 -- Style Guide for Python Code Indentation Maximum Line Length Should a Line break before or after a binary operator? imports module Level dunder names whitespace in expressions and statements other recommendations documentation strings Programming Recommendations PEP8 Error/Warning Code Pythonic Inspired from what are same example of beautiful 'Pythonic' code? and 如何让你的Python代码更加pythonic? run python code online zip/unzip def unzip(tuples): if tuples: return [tuple(t[i] for t in tuples) for i, _ in enumerate(tuples[0])] else: return [] result:>>> unzip( ((1, 2), (3, 4), (5, 6)) ) [(1, 3, 5), (2, 4, 6)] in long_string = \"This is a very long string\" if \"long\" in long_string: print(\"Match found\") dict & counter >>> from collections import Counter >>> fruits = ['orange', 'banana', 'apple', 'orange', 'banana'] >>> Counter(fruits) Counter({'orange': 2, 'banana': 2, 'apple': 1}) enumerate x = ['a', 'b', 'c'] for index, item in enumerate(x): print(index, item) P: array = [1, 2, 3, 4, 5] for i, e in enumerate(array,0): print i, e #0 1 #1 2 #2 3 #3 4 #4 5 NP: for i in xrange(len(array)): print i, array[i] #0 1 #1 2 #2 3 #3 4 #4 5 import local module # A.py def filter_items(items): for i in items: if i args & kwargs def add(one, two): return one + two my_list = [1, 2] x = add(*my_list) # x = 3 my_dict = {\"one\": 1, \"two\": 2} y = add(**my_dict) #y = 3 itertools >>> from itertools import zip_longest >>> x = [1, 2, 3, 4] >>> y = ['a', 'b', 'c'] >>> for i, j in zip_longest(x, y): ... print(i, j) ... 1 a 2 b 3 c 4 None one-line python code >>> my_dict = {key: value for key, value in zip_longest(x,y)} >>> my_dict {1: 'a', 2: 'b', 3: 'c', 4: None} slice word = #some word is_palindrome = word.find(word[-1::-1]) chain compare P: a = 3 b = 1 1 NP: a = 3 b = 1 b >= 1 and b boolean P: name = 'Tim' langs = ['AS3', 'Lua', 'C'] info = {'name': 'Tim', 'sex': 'Male', 'age':23 } if name and langs and info: print('All True!') #All True! NP: if name != '' and len(langs) > 0 and info != {}: print('All True!') #All True! reverse P: def reverse_str( s ): return s[::-1] NP: def reverse_str( s ): t = '' for x in xrange(len(s)-1,-1,-1): t += s[x] return t join in list P: strList = [\"Python\", \"is\", \"good\"] res = ' '.join(strList) #Python is good NP: res = '' for s in strList: res += s + ' ' #Python is good #最后还有个多余空格 sum & max & min & time P: numList = [1,2,3,4,5] sum = sum(numList) #sum = 15 maxNum = max(numList) #maxNum = 5 minNum = min(numList) #minNum = 1 from operator import mul prod = reduce(mul, numList, 1) #prod = 120 默认值传1以防空列表报错 NP: sum = 0 maxNum = -float('inf') minNum = float('inf') prod = 1 for num in numList: if num > maxNum: maxNum = num if num list comprehensions P: l = [x*x for x in range(10) if x % 3 == 0] # l = [0, 9, 36, 81] NP: l = [] for x in range(10): if x % 3 == 0: l.append(x*x) # l = [0, 9, 36, 81] default dict P: dic = {'name':'Tim', 'age':23} dic['workage'] = dic.get('workage',0) + 1 # dic = {'age': 23, 'workage': 1, 'name': 'Tim'} NP: if 'workage' in dic: dic['workage'] += 1 else: dic['workage'] = 1 # dic = {'age': 23, 'workage': 1, 'name': 'Tim'} if...else... P: for x in xrange(1,5): if x == 5: print 'find 5' break else: print 'can not find 5!' # can not find 5! NP: find = False for x in xrange(1,5): if x == 5: find = True print 'find 5' break if not find: print 'can not find 5!' # can not find 5! ternary operator P: a = 3 b = 2 if a > 2 else 1 # b = 2 NP: if a > 2: b = 2 else: b = 1 # b = 2 dict & zip P: keys = ['Name', 'Sex', 'Age'] values = ['Tim', 'Male', 23] dic = dict(zip(keys, values)) # {'Age': 23, 'Name': 'Tim', 'Sex': 'Male'} NP: dic = {} for i,e in enumerate(keys): dic[e] = values[i] # {'Age': 23, 'Name': 'Tim', 'Sex': 'Male'} hidden features numbers round >>> str(round(1234.5678, -2)) '1200.0' >>> str(round(1234.5678, 2)) '1234.57' integer base >>> int('10', 0) 10 >>> int('0x10', 0) 16 >>> int('010', 0) # does not work on Python 3.x 8 >>> int('0o10', 0) # Python >=2.6 and Python 3.x 8 >>> int('0b10', 0) # Python >=2.6 and Python 3.x 2 in-place value swapping >>> a = 10 >>> b = 5 >>> a, b (10, 5) >>> a, b = b, a >>> a, b (5, 10) sum from operator import add print reduce(add, [1,2,3,4,5,6]) string multi-line strings >>> sql = \"select * from some_table \\ where id > 10\" >>> print sql select * from some_table where id > 10 or >>> sql = \"\"\"select * from some_table where id > 10\"\"\" >>> print sql select * from some_table where id > 10 or >>> sql = (\"select * from some_table \" # 10 \" \"order by name\") >>> print sql select * from some_table where id > 10 order by name in >>> 'str' in 'string' True >>> 'no' in 'yes' False >>> Join ''.join(list_of_strings) set >>> a = set([1,2,3,4]) >>> b = set([3,4,5,6]) >>> a | b # Union {1, 2, 3, 4, 5, 6} >>> a & b # Intersection {3, 4} >>> a >> a - b # Difference {1, 2} >>> a ^ b # Symmetric Difference {1, 2, 5, 6} slice operators a = [1,2,3,4,5] >>> a[::2] # iterate over the whole list in 2-increments [1,3,5] or >>> a[::-1] [5,4,3,2,1] or >>> a = range(10) >>> a [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> a[:5] = [42] >>> a [42, 5, 6, 7, 8, 9] >>> a[:1] = range(5) >>> a [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> del a[::2] >>> a [1, 3, 5, 7, 9] >>> a[::2] = a[::-2] >>> a [9, 3, 5, 7, 1] reversed for i in reversed([1, 2, 3]): print(i) backslashes >>> print repr(r\"aaa\\\"bbb\") 'aaa\\\\\"bbb' or>>> print repr(r\"C:\\\") SyntaxError: EOL while scanning string literal >>> print repr(r\"C:\\\"\") 'C:\\\\\"' args Use _ instead of last printed item >>> range(10) [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> _ [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> *args & **kwargs >>> g = lambda *args, **kwargs: args[0], kwargs['thing'] >>> g(1, 2, 3, thing='stuff') (1, 'stuff') or def foo(a, b, c): print a, b, c bar = (3, 14, 15) foo(*bar) function argument unpacking def draw_point(x, y): # do some magic point_foo = (3, 4) point_bar = {'y': 3, 'x': 2} draw_point(*point_foo) draw_point(**point_bar) conditional assignment ternary operator >>> 'ham' if True else 'spam' 'ham' >>> 'ham' if False else 'spam' 'spam' or >>> True and 'ham' or 'spam' 'ham' >>> False and 'ham' or 'spam' 'spam' or >>> [] if True else 'spam' [] >>> True and [] or 'spam' 'spam' or In [18]: a = True In [19]: a and 3 or 4 Out[19]: 3 In [20]: a = False In [21]: a and 3 or 4 Out[21]: 4 or >>> (1 and [foo()] or [bar()])[0] foo 0 or >>> foo() if True or bar() foo 0 conditional x = 3 if (y == 1) else 2 or x = 3 if (y == 1) else 2 if (y == -1) else 1 or (func1 if y == 1 else func2)(arg1, arg2) or x = (class1 if y == 1 else class2)(arg1, arg2) or [(x, y) for x in range(4) if x % 2 == 1 for y in range(4)] [(1, 0), (1, 1), (1, 2), (1, 3), (3, 0), (3, 1), (3, 2), (3, 3)] or x = 3 if (y == 1) else 2 is equvalent to x = y == 1 and 3 or 2 x = 0 if True else 1 is equvalent to x = True and 0 or 1 or foo = [x for x in xrange(10) if x % 2 == 0] equal tofoo = [] for x in xrange(10): if x % 2 == 0: foo.append(x) dict comprehensions, manual >>> {i: i**2 for i in range(5)} {0: 0, 1: 1, 2: 4, 3: 9, 4: 16} set comprehensions wiki manual >>> {i**2 for i in range(5)} set([0, 1, 4, 16, 9]) list & dics zip a = [(1,2), (3,4), (5,6)] zip(*a) # [(1, 3, 5), (2, 4, 6)] or >>> dict([ ('foo','bar'),('a',1),('b',2) ]) {'a': 1, 'b': 2, 'foo': 'bar'} >>> names = ['Bob', 'Marie', 'Alice'] >>> ages = [23, 27, 36] >>> dict(zip(names, ages)) {'Alice': 36, 'Bob': 23, 'Marie': 27} or >>> t1 = (0,1,2,3) >>> t2 = (7,6,5,4) >>> [t1,t2] == zip(*zip(t1,t2)) True or In [15]: t1 = (1, 2, 3) In [16]: t2 = (4, 5, 6) In [17]: dict (zip(t1,t2)) Out[17]: {1: 4, 2: 5, 3: 6} or >>> l=[(1,2),(3,4)] >>> [a+b for a,b in l ] [3,7] list & sum >>> l = [[1, 2, 3], [4, 5], [6], [7, 8, 9]] >>> sum(l, []) [1, 2, 3, 4, 5, 6, 7, 8, 9] nested list [(i,j) for i in range(3) for j in range(i) ] or((i,j) for i in range(4) for j in range(i) ) enumerate >>> a = ['a', 'b', 'c', 'd', 'e'] >>> for index, item in enumerate(a): print index, item ... 0 a 1 b 2 c 3 d 4 e or>>> l = [\"spam\", \"ham\", \"eggs\"] >>> list(enumerate(l)) >>> [(0, \"spam\"), (1, \"ham\"), (2, \"eggs\")] >>> list(enumerate(l, 1)) >>> [(1, \"spam\"), (2, \"ham\"), (3, \"eggs\")] generate list >>> from functools import partial >>> bound_func = partial(range, 0, 10) >>> bound_func() [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> bound_func(2) [0, 2, 4, 6, 8] dict's constructor >>> dict(foo=1, bar=2) {'foo': 1, 'bar': 2} or>>> a = {} >>> b = a.setdefault('foo', 'bar') >>> a {'foo': 'bar'} >>> b 'bar dict's get t = {1: 'a'} >>> test[2] Traceback (most recent call last): File \"\", line 1, in test[2] KeyError: 2 >>> test.get(2) >>> test.get(1) 'a' >>> test.get(2) == None True >>> test.get(2, 'some') == 'some' True copy list >>> x = [1,2,3] >>> y = x[:] >>> y.pop() 3 >>> y [1, 2] >>> x [1, 2, 3] replace list >>> x = [1,2,3] >>> y = x >>> y[:] = [4,5,6] >>> x [4, 5, 6] generators objects x = [n for n in foo if bar(n)] or >>> n = ((a,b) for a in range(0,2) for b in range(4,6)) >>> for i in n: ... print i (0, 4) (0, 5) (1, 4) (1, 5) generator & iteration iteration & constructor (yield) >>> def g(n): ... for i in range(n): ... yield i **2 >>> t = g(5) >>> t.next() 0 >>> t.next() 1 >>> t.next() 4 >>> t.next() 9 >>> t.next() 16 >>> t.next() Traceback (most recent call last): File \"\", line 1, in StopIteration or def fab(max): a,b = 0,1 while a >> for i in fab(20): ... print i,\",\", ... 0 , 1 , 1 , 2 , 3 , 5 , 8 , 13 , or >>> i = (1,2,3,4,5,6,7,8,9,10) # or any iterable object >>> iterators = [iter(i)] * 2 >>> iterators[0].next() 1 >>> iterators[1].next() 2 >>> iterators[0].next() 3 or def grouper(n, iterable, fillvalue=None): \"grouper(3, 'ABCDEFG', 'x') --> ABC DEF Gxx\" args = [iter(iterable)] * n return izip_longest(fillvalue=fillvalue, *args) or >>> from itertools import * >>> l = [[1, 2], [3, 4]] >>> list(chain(*l)) [1, 2, 3, 4] or def create_printers(n): for i in xrange(n): def printer(i=i): # Doesn't work without the i=i print i yield printer statement for...else... for i in foo: if i == 0: break else: print(\"i was never 0\") orfound = False for i in foo: if i == 0: found = True break if not found: print(\"i was never 0\") context managers and the \"with\" statement from __future__ import with_statement with open('foo.txt', 'w') as f: f.write('hello!') try...except...elese...finally try: put_4000000000_volts_through_it(parrot) except Voom: print \"'E's pining!\" else: print \"This parrot is no more!\" finally: end_sketch() funcs dir >>> dir(\"foo\") ['__add__', '__class__', '__contains__', (snipped a bunch), 'title', 'translate', 'upper', 'zfill'] help >>> help(\"foo\".upper) Help on built-in function upper: upper(...) S.upper() -> string Return a copy of the string S converted to uppercase. convenient web-browser controller >>> import webbrowser >>> webbrowser.open_new_tab('http://www.stackoverflow.com') built-in http server python -m SimpleHTTPServer 8000 an interpreter within the interpreter $ python Python 2.5.1 (r251:54863, Jan 17 2008, 19:35:17) [GCC 4.0.1 (Apple Inc. build 5465)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> shared_var = \"Set in main console\" >>> import code >>> ic = code.InteractiveConsole({ 'shared_var': shared_var }) >>> try: ... ic.interact(\"My custom console banner!\") ... except SystemExit, e: ... print \"Got SystemExit!\" ... My custom console banner! >>> shared_var 'Set in main console' >>> shared_var = \"Set in sub-console\" >>> import sys >>> sys.exit() Got SystemExit! >>> shared_var 'Set in main console' pretty print >>> import pprint >>> stuff = sys.path[:] >>> stuff.insert(0, stuff) >>> pprint.pprint(stuff) [, '', '/usr/local/lib/python1.5', '/usr/local/lib/python1.5/test', '/usr/local/lib/python1.5/sunos5', '/usr/local/lib/python1.5/sharedmodules', '/usr/local/lib/python1.5/tkinter'] or from __future__ import print_function mylist = ['foo', 'bar', 'some other value', 1,2,3,4] print(*mylist) class & module bash python -c\"import os; print(os.getcwd());\" assertion >>> try: ... assert [] ... except AssertionError: ... print \"This list should not be empty\" This list should not be empty import try: import json except ImportError: import simplejson as json create new types >>> NewType = type(\"NewType\", (object,), {\"x\": \"hello\"}) >>> n = NewType() >>> n.x \"hello\" or>>> class NewType(object): >>> x = \"hello\" >>> n = NewType() >>> n.x \"hello\" Manipulating sys.modules >>> import sys >>> import ham Traceback (most recent call last): File \"\", line 1, in ImportError: No module named ham # Make the 'ham' module available -- as a non-module object even! >>> sys.modules['ham'] = 'ham, eggs, saussages and spam.' >>> import ham >>> ham 'ham, eggs, saussages and spam.' # Now remove it again. >>> sys.modules['ham'] = None >>> import ham Traceback (most recent call last): or>>> import os # Stop future imports of 'os'. >>> sys.modules['os'] = None >>> import os Traceback (most recent call last): File \"\", line 1, in ImportError: No module named os # Our old imported module is still available. >>> os Others not hidden but still nice import os.path as op root_dir = op.abspath(op.join(op.dirname(__file__), \"..\")) be careful with mutable default arguments >>> def foo(x=[]): ... x.append(1) ... print x ... >>> foo() [1] >>> foo() [1, 1] >>> foo() [1, 1, 1] or>>> def foo(x=None): ... if x is None: ... x = [] ... x.append(1) ... print x >>> foo() [1] >>> foo() [1] PEP8 -- Style Guide for Python Code Indentation yes: # Aligned with opening delimiter. foo = long_function_name(var_one, var_two, var_three, var_four) # More indentation included to distinguish this from the rest. def long_function_name( var_one, var_two, var_three, var_four): print(var_one) # Hanging indents should add a level. foo = long_function_name( var_one, var_two, var_three, var_four) no: # Arguments on first line forbidden when not using vertical alignment. foo = long_function_name(var_one, var_two, var_three, var_four) # Further indentation required as indentation is not distinguishable. def long_function_name( var_one, var_two, var_three, var_four): print(var_one) optional # Hanging indents *may* be indented to other than 4 spaces. foo = long_function_name( var_one, var_two, var_three, var_four) if statemant # No extra indentation. if (this_is_one_thing and that_is_another_thing): do_something() # Add a comment, which will provide some distinction in editors # supporting syntax highlighting. if (this_is_one_thing and that_is_another_thing): # Since both conditions are true, we can frobnicate. do_something() # Add some extra indentation on the conditional continuation line. if (this_is_one_thing and that_is_another_thing): do_something()o list my_list = [ 1, 2, 3, 4, 5, 6, ] result = some_function_that_takes_arguments( 'a', 'b', 'c', 'd', 'e', 'f', ) ormy_list = [ 1, 2, 3, 4, 5, 6, ] result = some_function_that_takes_arguments( 'a', 'b', 'c', 'd', 'e', 'f', ) Maximum Line Length yes:with open('/path/to/some/file/you/want/to/read') as file_1, \\ open('/path/to/some/file/being/written', 'w') as file_2: file_2.write(file_1.read()) Should a Line break before or after a binary operator? no: operators sit far away from their operands income = (gross_wages + taxable_interest + (dividends - qualified_dividends) - ira_deduction - student_loan_interest) yes: easy to match operators with operands income = (gross_wages + taxable_interest + (dividends - qualified_dividends) - ira_deduction - student_loan_interest) imports no: import sys, os yes: import os import sys bad: import from * absolute imports are recommended import mypkg.sibling from mypkg import silbing from mypkg.sibling import example explicit relative imports are acceptable from . import sibling from .sibling import example import a class from a class-containing module from myclass import MyClass from foo.bar.yourclass import YourClass local name classes import myclass import foo.bar.yourclass # use \"myclass.MyClass\" or \"foo.bar.yourclass.YourClass\" module Level dunder names Module level \"dunder\" names with two leading and two trailing underscores, such as __all__, __author__, __version__, etc yes: \"\"\"This is the example module. This module does stuff. \"\"\" from __future__ import barry_as_FLUFL __all__ = ['a', 'b', 'c'] __version__ = '0.1' __author__ = 'Cardinal Biggles' import os import sys whitespace in expressions and statements no: spam( ham[ 1 ], { eggs: 2 } ) yes: spam(ham[1], {eggs: 2}) no: if x == 4 : print x , y ; x , y = y , x yes: if x == 4; print x, y; x, y = y, x no: ham[lower + offset:upper + offset] ham[1: 9], ham[1 :9], ham[1:9 :3] ham[lower : : upper] ham[ : upper ] yes: ham[1:9], ham[1:9:3], ham[:9:3], ham[1::3], ham[1:9:] ham[lower:upper], ham[lowser:pper:], ham[lower::step] ham[lower+offset : upper+offset] ham[: upper_fn(x) : setp_fn(x)], ham[:: setp_fn(x)] ham[lower + offset : upper + offset] no: spam (1) yes: spam(1) no: dct ['key'] = lst [index] yes: dct['key'] = lst[index] no: x = 1 y = 2 long_variable = 3 yes: x = 1 y = 2 long_variable = 3 other recommendations no: i=i+1 submitted +=1 x = x * 2 - 1 hypot2 = x * x + y * y c = (a + b) * (a - b) yes: i = i + 1 submitted += 1 x = x*2 - 1 hypot2 = x*x + y*y c = (a+b) * (a-b) no: def complex(real, imag = 0.0): return magic(r = real, i = imag) yes: def complex(real, imag=0.0): return magic(r=real, i=imag) no: def munge(input:AnyStr): ... def munge()->PosInt: ... yes: def munge(input: AnyStr): ... def munge() -> AnyStr: ... no: def munge(input: AnyStr=None): ... def munge(input: AnyStr, limit = 1000): ... yes: def munge(sep: AnyStr = None): ... def munge(input: AnyStr, sep: AnyStr = None, limit=1000): ... rather NO if foo == 'blah': do_blah_thing() do_one(); do_two(); do_three() yes:if foo == 'blah': do_blah_thing() do_one() do_two() do_three() DEFINITELY NO if foo == 'blah': do_blah_thing() else: do_non_blah_thing() try: something() finally: cleanup() do_one(); do_two(); do_three(long, argument, list, like, this) if foo == 'blah': one(); two(); three() yes:if foo == 'blah': do_blah_thing() for x in lst: total += x while t documentation strings yes: \"\"\"Return a foobang Optional plotz says to frobnicate the bizbaz first. \"\"\" Programming Recommendations no: if not foo is None: yes: if foo is not None: no: f = lambda x: 2*x yes: def f(x): return 2*x no: try: # Too broad! return handle_value(collection[key]) expect KeyError: # Will also catch KeyError raised by handle_value() return key_not_found(key) yes: try: value = collection[key] except KeyError: return key_not_found(key) else: return handle_value(value) no: with conn: do_stuff_in_transaction(conn) yes: with conn.begin_transaction(): do_stuff_in_transaction(conn) no: def foo(x): fi x >= 0: return math.sqrt(x) def bar(x): if x yes: def foo(x): if x >= 0: return math.sqrt(x) else: return None def bar(x): if x no: if foo[:3] == 'bar': yes: if foo.startwith('bar'): no: if type(obj) is type(1): yes: if isinstance(obj, int): no: if len(seq): if not len(seq): yes: if not seq: if seq: no: if greeting == True: yes: if greeting: worse: if greeting is True: PEP8 Error/Warning Code E1 Indentation E101 indentation contains mixed spaces and tabs E111 indentation is not a multiple of four E112 expected an indented block E113 unexpected indentation E114 indentation is not a multiple of four (comment) E115 expected an indented block (comment) E116 unexpected indentation (comment) E121 (*^) continuation line under-indented for hanging indent E122 (^) continuation line missing indentation or outdented E123 (*) closing bracket does not match indentation of opening bracket’s line E124 (^) closing bracket does not match visual indentation E125 (^) continuation line with same indent as next logical line E126 (*^) continuation line over-indented for hanging indent E127 (^) continuation line over-indented for visual indent E128 (^) continuation line under-indented for visual indent E129 (^) visually indented line with same indent as next logical line E131 (^) continuation line unaligned for hanging indent E133 (*) closing bracket is missing indentation E2 Whitespace E201 whitespace after ‘(‘ E202 whitespace before ‘)’ E203 whitespace before ‘:’ E211 whitespace before ‘(‘ E221 multiple spaces before operator E222 multiple spaces after operator E223 tab before operator E224 tab after operator E225 missing whitespace around operator E226 (*) missing whitespace around arithmetic operator E227 missing whitespace around bitwise or shift operator E228 missing whitespace around modulo operator E231 missing whitespace after ‘,’, ‘;’, or ‘:’ E241 (*) multiple spaces after ‘,’ E242 (*) tab after ‘,’ E251 unexpected spaces around keyword / parameter equals E261 at least two spaces before inline comment E262 inline comment should start with ‘# ‘ E265 block comment should start with ‘# ‘ E266 too many leading ‘#’ for block comment E271 multiple spaces after keyword E272 multiple spaces before keyword E273 tab after keyword E274 tab before keyword E3 Blank line E301 expected 1 blank line, found 0 E302 expected 2 blank lines, found 0 E303 too many blank lines (3) E304 blank lines found after function decorator E4 Import E401 multiple imports on one line E402 module level import not at top of file E5 Line length E501 (^) line too long (82 > 79 characters) E502 the backslash is redundant between brackets E7 Statement E701 multiple statements on one line (colon) E702 multiple statements on one line (semicolon) E703 statement ends with a semicolon E704 (*) multiple statements on one line (def) E711 (^) comparison to None should be ‘if cond is None:’ E712 (^) comparison to True should be ‘if cond is True:’ or ‘if cond:’ E713 test for membership should be ‘not in’ E714 test for object identity should be ‘is not’ E721 (^) do not compare types, use ‘isinstance()’ E731 do not assign a lambda expression, use a def E9 Runtime E901 SyntaxError or IndentationError E902 IOError W1 Indentation warning W191 indentation contains tabs W2 Whitespace warning W291 trailing whitespace W292 no newline at end of file W293 blank line contains whitespace W3 Blank line warning W391 blank line at end of file W5 Line break warning W503 line break occurred before a binary operator W6 Deprecation warning W601 .has_key() is deprecated, use ‘in’ W602 deprecated form of raising exception W603 ‘<>’ is deprecated, use ‘!=’ W604 backticks are deprecated, use ‘repr()’ Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/python/config.html":{"url":"programming/python/config.html","title":"config","keywords":"","body":" installation command completion install from source code environment in MacOS pip.conf pip config file list python path python libs multiple versions version change setup default python modules re-installation PYTHONPATH extension clear windows python IDLE in MacOS Big Sur IDLE quit unexpectedly Python may not be configured for Tk reference: homebrew and python Installing from local packages pip list installation command completion $ python -m pip completion --bash >> ~/.bashrc or$ python -m pip completion --bash >> ~/.profile or$ eval \"`pip completion --bash`\" install from source code basic environment prepare $ sudo dnf install gcc openssl-devel bzip2-devel libffi-devel or$ sudo dnf groupinstall 'development tools' $ sudo dnf install bzip2-devel expat-devel gdbm-devel \\ ncurses-devel openssl-devel readline-devel wget \\ sqlite-devel tk-devel xz-devel zlib-devel libffi-devel download source code $ curl -O https://www.python.org/ftp/python/3.8.3/Python-3.8.3.tgz $ tar xzf Python-3.8.3.tgz # or $ curl -fsSL https://dlcdn.apache.org/maven/maven-3/3.9.5/binaries/apache-maven-3.9.5-bin.tar.gz | tar xzf - -C /opt/python && cd /opt/python compile and install [!NOTE|label:references:] How to build your own Python version docker-library/python/Dockerfile# debian gnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" * 3. Configure Python 3.3.7. Linker options --enable-shared --without-static-libpython Shared libraries in macOS and Linux DYLD_LIBRARY_PATH in osx LD_LIBRARY_PATH in linux Search Path Used by Windows to Locate a DLL) $ nproc=\"$(nproc)\" $ ./configure --enable-optimizations \\ --enable-shared \\ # or export PYTHON_CONFIGURE_OPTS=\"--enable-shared\" --with-lto \\ --with-system-expat \\ --with-ensurepip $ sudo make -j ${nproc} $ sudo make install $ export PYTHON_HOME='/opt/python/Python-3.11.6' # for libpython3.11.so.1.0 $ export LD_LIBRARY_PATH=$PYTHON_HOME:$LD_LIBRARY_PATH # check $ which -a python3.11 /usr/local/bin/python3.11 $ python3 --version Python 3.11.6 # upgrade pip $ sudo -H /usr/local/bin/python3.11 -m pip install --upgrade pip $ cd Python-3.8.3 $ sudo ./configure --enable-optimizations $ sudo make -j 12 $ sudo make altinstall linker cache [!NOTE|label:references:] Python3.7: error while loading shared libraries: libpython3.7m.so.1.0$ sudo ldconfig -v $ sudo ldconfig /usr/local/lib $ sudo ldconfig -v | grep python libpython3.so -> libpython3.so libpython3.6m.so.1.0 -> libpython3.6m.so.1.0 $ sudo ldconfig -v /opt/python/Python-3.11.6 | grep python /opt/python/Python-3.11.6: (from :0) libpython3.so -> libpython3.so libpython3.11.so.1.0 -> libpython3.11.so.1.0 libpython3.so -> libpython3.so libpython3.6m.so.1.0 -> libpython3.6m.so.1.0 setup $ sudo update-alternatives --install /usr/bin/python3 python3 /usr/local/bin/python3.8 99 environment in MacOS pip.conf pip.conf load priority MacOS : /Library/Application Support/pip/pip.conf > ~/.config/pip/pip.conf > ~/.pip/pip.conf user: ~/.pip/pip.conf & ~/.config/pip/pip.conf global: /Library/Application Support/pip/pip.conf list config: $ pip config list [ -v ] global.index-url='https://repo.my.com/artifactory/api/pypi/tools/simple' details$ pip config list -v For variant 'global', will try loading '/Library/Application Support/pip/pip.conf' For variant 'user', will try loading '/Users/marslo/.pip/pip.conf' For variant 'user', will try loading '/Users/marslo/.config/pip/pip.conf' For variant 'site', will try loading '/usr/local/opt/python@3.10/Frameworks/Python.framework/Versions/3.10/pip.conf' global.extra-index-url='https://my.artifactory.com/artifactory/api/pypi/myPrivate' global.index-url='https://my.artifactory.com/artifactory/api/pypi/pypi/simple' PIP_CONF_FILE $ export PIP_CONFIG_FILE=/path/to/pip.conf upgrade all outdated modules $ pip install --upgrade --user $(pip list --outdated | sed 1,2d | awk '{print $1}' | xargs) with exclude$ pip3.9 install --upgrade --user $(pip3.9 list --outdated | sed 1,2d | awk '{print $1}' | grep -vw 'docker\\|rich') pip config file naming [global] timeout = 60 index-url = https://download.zope.org/ppix per-command section [global] timeout = 60 [freeze] timeout = 10 boolean options [install] ignore-installed = true no-dependencies = yes add [global] no-cache-dir = false [install] no-compile = no no-warn-script-location = false repeatable options [global] quiet = 0 verbose = 2 format: on multiple lines [global] find-links = http://download.example.com [install] find-links = http://mirror1.example.com http://mirror2.example.com trusted-host = mirror1.example.com mirror2.example.com list python path $ python -vv -c \"import sys; print sys.path\" $ python -vvE -c \"import sys; print sys.path\" $ python -vvEsS -c \"import sys; print sys.path\" python libs MacOS global $ ls -ld /usr/local/lib/python*/ drwxr-xr-x 3 marslo admin 96 May 17 2019 /usr/local/lib/python2.7/ drwxr-xr-x 3 marslo admin 96 May 17 2019 /usr/local/lib/python3.7/ drwxr-xr-x 3 marslo admin 96 Jan 13 2020 /usr/local/lib/python3.8/ drwxr-xr-x 3 marslo admin 96 Oct 10 17:06 /usr/local/lib/python3.9/ $ ls -ld /Library/Python/2.7/site-packages/ drwxr-xr-x 9 root wheel 288 Aug 6 18:16 /Library/Python/2.7/site-packages/ or $ ls $(brew --prefix)/lib/python* /usr/local/lib/python2.7: site-packages /usr/local/lib/python3.7: site-packages /usr/local/lib/python3.8: site-packages /usr/local/lib/python3.9: site-packages local $ ls -ld ~/Library/Python/*/ drwx------ 4 marslo staff 128 Aug 6 17:23 /Users/marslo/Library/Python/2.7/ drwx------ 5 marslo staff 160 Oct 12 21:17 /Users/marslo/Library/Python/3.7/ drwx------ 5 marslo staff 160 Oct 27 19:24 /Users/marslo/Library/Python/3.8/ drwx------ 5 marslo staff 160 Oct 27 19:24 /Users/marslo/Library/Python/3.9/ example: $ /usr/bin/python -c 'import site; print(site.USER_BASE)' /Users/marslo/Library/Python/2.7 $ /usr/local/bin/python3.9 -c 'import site; print(site.USER_BASE)' /Users/marslo/Library/Python/3.9 $ /usr/local/bin/python3.6 -c 'import sysconfig; print(sysconfig.get_paths()[\"purelib\"])' /usr/lib/python3.6/site-packages linux references: How do I find the location of my Python site-packages directory $ /usr/local/bin/python3.6 -m site --user-site /home/marslo/.local/lib/python3.6/site-packages $ /usr/local/bin/python3.6 -c 'import site; print(site.getsitepackages())' ['/usr/local/lib64/python3.6/site-packages', '/usr/local/lib/python3.6/site-packages', '/usr/lib64/python3.6/site-packages', '/usr/lib/python3.6/site-packages'] $ python3.6 -m site sys.path = [ '/home/marslo', '/usr/lib64/python36.zip', '/usr/lib64/python3.6', '/usr/lib64/python3.6/lib-dynload', '/usr/local/lib/python3.6/site-packages', '/usr/lib64/python3.6/site-packages', '/usr/lib/python3.6/site-packages', ] USER_BASE: '/home/marslo/.local' (exists) USER_SITE: '/home/marslo/.local/lib/python3.6/site-packages' (doesn't exist) ENABLE_USER_SITE: True check particular lib $ python -c \"import os as _; print(_.__file__)\" /usr/lib64/python3.6/os.py $ python -c \"import setuptools as _; print(_.__path__)\" ['/usr/lib/python3.6/site-packages/setuptools'] multiple versions get current working version $ CFLAGS=-I$(brew --prefix)/include LDFLAGS=-L$(brew --prefix)/lib pip --version pip 20.2.4 from /Users/marslo/Library/Python/3.8/lib/python/site-packages/pip (python 3.8) or$ $(brew --prefix)/opt/python/libexec/bin/python -V Python 3.8.6 upgrade particular modules $ sudo -H python3.9 -m pip install --upgrade pip Collecting pip Using cached pip-20.2.4-py2.py3-none-any.whl (1.5 MB) Installing collected packages: pip Attempting uninstall: pip Found existing installation: pip 20.2.3 Uninstalling pip-20.2.3: Successfully uninstalled pip-20.2.3 Successfully installed pip-20.2.4 upgrade to previous version$ pip install --upgrade --no-cache-dir --pre pip install all older version modules $ /usr/local/bin/python3.8 -m pip freeze > pip3.8-requirements.txt $ sudo -H /usr/local/bin/python3.9 -m pip install --pre -r pip3.8-requirements.txt reference: $ CFLAGS=-I$(brew --prefix)/include LDFLAGS=-L$(brew --prefix)/lib pip freeze beautifulsoup4==4.9.1 certifi==2020.6.20 cffi==1.14.1 chardet==3.0.4 click==7.1.2 click-config-file==0.6.0 colorama==0.4.3 ... or $ pip list --outdate --format=freeze docker==4.2.2 rich==3.0.5 $ pip list -o --format columns Package Version Latest Type ------- ------- ------ ----- docker 4.2.2 4.3.1 wheel rich 3.0.5 9.1.0 whee $ pip list --outdate --format=json [{\"name\": \"docker\", \"version\": \"4.2.2\", \"latest_version\": \"4.3.1\", \"latest_filetype\": \"wheel\"}, {\"name\": \"rich\", \"version\": \"3.0.5\", \"latest_version\": \"9.1.0\", \"latest_filetype\": \"wheel\"}] version change change default python from 3.9 to 3.10 setup default python via ln $ unlink /usr/local/opt/python $ ln -sf /usr/local/Cellar/python@3.10/3.10.4 /usr/local/opt/python $ unlink /usr/local/bin/python $ ln -sf /usr/local/Cellar/python@3.10/3.10.4/bin/python3.10 /usr/local/bin/python3 $ ln -sf /usr/local/Cellar/python@3.10/3.10.4/bin/python3.10 /usr/local/bin/python $ export PYTHONUSERBASE=\"$(/usr/local/opt/python/libexec/bin/python -c 'import site; print(site.USER_BASE)')\" $ export PYTHON3='/usr/local/opt/python/libexec/bin' $ export PATH=\"$PYTHONUSERBASE/bin:${PYTHON3}:$PATH\" via brew link $ brew link python3 python@3.10 --overwrite example $ python3 --version Python 3.9.13 $ brew link python3 python@3.10 --overwrite Warning: Already linked: /usr/local/Cellar/python@3.9/3.9.13_1 To relink, run: brew unlink python@3.9 && brew link python@3.9 Linking /usr/local/Cellar/python@3.10/3.10.4... 24 symlinks created. If you need to have this software first in your PATH instead consider running: echo 'export PATH=\"/usr/local/opt/python@3.10/bin:$PATH\"' >> /Users/marslo/.bash_profile $ python3 --version Python 3.10.4 via default $ defaults write com.apple.versioner.python Version 3.8 get default version$ defaults read com.apple.versioner.python Version example $ defaults read com.apple.versioner.python Version 3.9 $ defaults write com.apple.versioner.python Version 3.10 $ defaults read com.apple.versioner.python Version 3.10 modules re-installation $ /usr/local/bin/python3.9 -m pip freeze > pip3.9-requirements.txt $ sudo -H /usr/local/bin/python3.10 -m pip install --pre -r pip3.9-requirements.txt PYTHONPATH $ export PYTHONPATH=\"/usr/local/lib/python3.9/site-packages\" ⇣⇣ $ export PYTHONPATH=\"/usr/local/lib/python3.10/site-packages\" extension clear windows download$ curl -o /Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/idlelib/ClearWindow.py https://bugs.python.org/file14303/ClearWindow.py configure $ cat >> /Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/idlelib/config-extensions.def EOF python IDLE in MacOS Big Sur IDLE quit unexpectedly Process: Python [53851] Path: /usr/local/Cellar/python@3.9/3.9.1_5/IDLE 3.app/Contents/MacOS/Python Identifier: org.python.IDLE Version: 3.9.1 (3.9.1) Code Type: X86-64 (Native) Parent Process: ??? [1] Responsible: Python [53851] User ID: 501 Date/Time: 2021-01-10 15:20:06.574 +0800 OS Version: macOS 11.1 (20C69) Report Version: 12 Bridge OS Version: 5.1 (18P3030) Anonymous UUID: AB6EE819-0314-4161-9650-FFE340DF84C8 Application Specific Information: abort() called ... root cause $ python Python 3.9.1 (default, Jan 6 2021, 06:05:23) [Clang 12.0.0 (clang-1200.0.32.28)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> import tkinter as tk >>> print(tk.Tcl().eval('info patchlevel')) 8.5.9 >>> exit() using https://www.python.org/ftp/python/3.9.1/python-3.9.1-macosx10.9.pkg $ brew info tcl-tk | head -1 tcl-tk: stable 8.6.11 (bottled) [keg-only] $ python Python 3.9.1 (v3.9.1:1e5d33e9b9, Dec 7 2020, 12:10:52) [Clang 6.0 (clang-600.0.57)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license()\" for more information. >>> import tkinter as tk >>> print(tk.Tcl().eval('info patchlevel')) 8.6.8 more on tkinter >>> import tkinter >>> tkinter.TclVersion, tkinter.TkVersion (8.5, 8.5) >>> tkinter._tester() Traceback (most recent call last): File \"\", line 1, in AttributeError: module 'tkinter' has no attribute '_tester' >>> tkinter._test() macOS 11 or later required ! Abort trap: 6 Python may not be configured for Tk $ python Python 3.10.4 (main, Apr 26 2022, 19:42:59) [Clang 13.1.6 (clang-1316.0.21.2)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> import tkinter as tk Traceback (most recent call last): File \"\", line 1, in File \"/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python3.10/tkinter/__init__.py\", line 37, in import _tkinter # If this fails your Python may not be configured for Tk ModuleNotFoundError: No module named '_tkinter' solution $ brew info python@3.10 python@3.10: stable 3.10.4 (bottled) [keg-only] ... ... tkinter is no longer included with this formula, but it is available separately: brew install python-tk@3.10 ... ... $ brew install python-tk@3.10 ==> Downloading https://ghcr.io/v2/homebrew/core/python-tk/3.10/manifests/3.10.4 ######################################################################## 100.0% ==> Downloading https://ghcr.io/v2/homebrew/core/python-tk/3.10/blobs/sha256:6a937be1fd531589ef7f9b4d971cb91ee7549d99f7f1aaf97f0fc3c0911f1c5d ==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:6a937be1fd531589ef7f9b4d971cb91ee7549d99f7f1aaf97f0fc3c0911f1c5d?s ######################################################################## 100.0% ==> Pouring python-tk@3.10--3.10.4.monterey.bottle.tar.gz ==> Caveats python-tk@3.10 is keg-only, which means it was not symlinked into /usr/local, because this is an alternate version of another formula. ==> Summary ☕️ 🐸 /usr/local/Cellar/python-tk@3.10/3.10.4: 5 files, 132.6KB ==> Running `brew cleanup python-tk@3.10`... Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP. Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`). $ brew reinstall python@3.10 ... ... Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/python/basic.html":{"url":"programming/python/basic.html","title":"basic","keywords":"","body":" version capatibility environment list included modules list lib paths Positional notation to Binary to Octal to Decimal to Hexadecimal version capatibility Supported Ubuntu and Python Versions Ubuntu 18.04 (bionic) Python2.3 - Python 2.6, Python 3.1 - Python 3.5, Python3.7 - Python3.11 Ubuntu 20.04 (focal) Python3.5 - Python3.7, Python3.9 - Python3.11 Ubuntu 22.04 (jammy) Python3.7 - Python3.9, Python3.11 Note: Python2.7 (all), Python 3.6 (bionic), Python 3.8 (focal), Python 3.10 (jammy) are not provided by deadsnakes as upstream ubuntu provides those packages. environment list included modules $ python -c 'help(\"modules\")' Please wait a moment while I gather a list of all available modules... __future__ _warnings graphlib runpy _abc _weakref grp sched _aix_support _weakrefset gzip secrets ... list lib paths $ python -c 'import sys; print (sys.path)' ['', '/usr/lib/python39.zip', '/usr/lib/python3.8', '/usr/lib/python3.8/lib-dynload', '/usr/local/lib/python3.8/dist-packages', '/usr/lib/python3/dist-packages'] Positional notation to Binary Octal to Binary>>> bin( int('0o10', 8) ) '0b1000' >>> bin( int('0o17', 8) ) '0b1111' Decimal to Binary>>> bin(2) '0b10' >>> bin(10) '0b1010' or>>> format( 3, 'b' ) '11' >>> format( 15, 'b' ) '1111' Hexadecimal to Binary>>> bin( int('a', 16) ) '0b1010' >>> bin( int('f', 16) ) '0b1111' to Octal Binary to Octal>>> oct( int(str(111), 2) ) '0o7' >>> oct( int(str(1000), 2) ) '0o10' Decimal to Octal>>> oct(8) '0o10' or>>> format( 15, 'o' ) '17' >>> format( 8, 'o' ) '10' Hexadecimal to Octal>>> oct( 0xf ) '0o17' to Decimal Binary to Decimal>>> int( str(11), 2 ) 3 >>> int( str(1010), 2 ) 10 Octal to Decimal>>> 0o10 8 >>> int( 0o10 ) 8 >>> int ( str(10), 8 ) 8 Hexadecimal to Decimal>>> int( 0xf ) 15 to Hexadecimal Binary to Hexadecimal>>> hex( int(str(1010), 2) ) '0xa' >>> hex( int(str(1111), 2) ) '0xf' Octal to Hexadecimal>>> hex(0o10) '0x8' >>> hex( int('0o17', 8 )) '0xf' Decimal to Hexadecimal>>> hex(15) '0xf' >>> hex(66) '0x42' or>>> format( 15, 'x' ) 'f' or>>> '%x' % 15 'f' Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/python/list.html":{"url":"programming/python/list.html","title":"list","keywords":"","body":" list copy reverse list cast format (str -> int) zip two lists list mathematical list copy inspired by How to clone or copy a list? in stackoverflow clone_list = sample_list.copy() orclone_list = sample_list[:] orclone_list = list(sample_list) orimport copy clone_list = copy.copy(sample_list) or import copy clone_list = copy.deepcopy(sample_list) example: >>> id(x) 4505979072 >>> k = x >>> id(k) 4505979072 >>> k = x.copy() >>> id(k) 4445208000 >>> k = x[:] >>> id(k) 4505977632 >>> import copy >>> k = copy.copy(x) >>> id(k) 4505754352 >>> k = copy.deepcopy(x) >>> id(k) 4505978352 >>> k = x[:] >>> id(k) 4506260896 >>> k = copy.deepcopy(x) >>> id(k) 4506261136 reverse list sample_list[::-1] example:>>> ['1', '2', '3', '4', '5'][::-1] ['5', '4', '3', '2', '1'] cast format (str -> int) list( map(int, sample_list) ) example:>>> print( list( map(int, ['2', '8', '4', '127', 'HKD'][:3][::-1] ) ) ) [4, 8, 2] zip two lists >> from itertools import zip_longest >>> x = ['1', '2', '3', '4'] >>> y = ['one', 'two', 'three', 'four'] >>> for i, j in zip_longest( x, y ): print(i, j) 1 one 2 two 3 three 4 four or zip to a map>>> x = ['1', '2', '3', '4'] >>> y = ['one', 'two', 'three', 'four'] >>> print( {key: value for key, value in zip_longest(x, y)} ) {'1': 'one', '2': 'two', '3': 'three', '4': 'four'} list mathematical sum >>> n = ['1', '2', '3', '4'] >>> print( sum( list( map(int, n) ) ) ) 10 multiplication python Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/python/pip.html":{"url":"programming/python/pip.html","title":"pip","keywords":"","body":" installation install pip cache dir and clean caches for global user (or non user) re-install package in site.USER_BASE setup default python version index-url & extra-index-url list pip package with url installing from local packages config list all configs troubleshooting installation [!NOTE|label:references:] Python Management and Project Dependencies install pip from source code $ curl https://bootstrap.pypa.io/get-pip.py | python [--no-setuptools] [--no-wheel] # or $ curl https://bootstrap.pypa.io/get-pip.py | python3.2 # or $ curl https://bootstrap.pypa.io/get-pip.py | python - 'pip==8.0.0' python3.6 $ python3 example $ python get-pip.py --no-index --find-links=/local/copies $ python get-pip.py --user $ python get-pip.py --proxy=\"http://[user:passwd@]proxy.server:port\" $ python get-pip.py pip==9.0.2 wheel==0.30.0 setuptools==28.8.0 upgrade pip linux$ [sudo [-H]] pip install --upgrade pip windows> python -m pip install --upgrade pip from easy_install $ cd \\Scripts $ easy_install pip or$ curl -fsSL https://files.pythonhosted.org/packages/ba/2c/743df41bd6b3298706dfe91b0c7ecdc47f2dc1a3104abeb6e9aa4a45fa5d/ez_setup-0.9.tar.gz | tar xzf - -C . $ python ez_setup-0.9/ez_setup.py pip cache dir and clean caches clean cache ([pip cache](https://pip.pypa.io/en/stable/reference/pip_cache/))$ pip cache purge $ pip cache remove matplotlib set no cache ([pip config](https://pip.pypa.io/en/stable/reference/pip_config/)) $ pip install --no-cache-dir # or $ pip config set global.cache-dir false for global user (or non user) [!NOTE] export PYTHONPATH=\"/usr/local/lib/python3.9/site-packages:$PYTHONPATH\" # load the user's $HOME/.pip/pip.conf $ sudo python -m pip install # or # CANNOT load the user's $HOME/.pip/pip.conf $ sudo -H pip install re-install package in site.USER_BASE [!NOTE] $ python -c 'import site; print(site.USER_BASE)' /Users/marslo/Library/Python/3.9 reference: Can I force pip to reinstall the current version? $ export PYTHONUSERBASE=\"$(python -c 'import site; print(site.USER_BASE)')\" $ pip install --upgrade --force-reinstall --user setup default python version # temporary $ export VERSIONER_PYTHON_VERSION=3.9 $ defaults write com.apple.versioner.python Version 3.9 index-url & extra-index-url [!NOTE] reference: pip wheel pip error looking for private package in pypi $ pip config list global.extra-index-url='https://private.artifactory.com/artifactory/api/pypi/pypi-dev/simple' global.index-url='https://private.artifactory.com/artifactory/api/pypi/tools/simple' list pip package with url [!NOTE] $ sudo yum install util-linux -y $ pip list --format=freeze | cut -d= -f1 | xargs pip show | awk '/^Name/{printf $2} /^Home-page/{print \": \"$2}' | column -t beautifulsoup4: http://www.crummy.com/software/BeautifulSoup/bs4/ certifi: https://certifiio.readthedocs.io/en/latest/ cffi: http://cffi.readthedocs.org chardet: https://github.com/chardet/chardet click: https://palletsprojects.com/p/click/ click-config-file: http://github.com/phha/click_config_file colorama: https://github.com/tartley/colorama commonmark: https://github.com/rtfd/commonmark.py compressed-rtf: https://github.com/delimitry/compressed_rtf configobj: https://github.com/DiffSK/configobj docker: https://github.com/docker/docker-py extract-msg: https://github.com/mattgwwalker/msg-extractor git-review: http://docs.openstack.org/infra/git-review/ idna: https://github.com/kjd/idna IMAPClient: https://github.com/mjs/imapclient/ Markdown: https://Python-Markdown.github.io/ mdv: http://github.com/axiros/terminal_markdown_viewer meson: https://mesonbuild.com olefile: https://www.decalage.info/python/olefileio pip: https://pip.pypa.io/ pprintpp: https://github.com/wolever/pprintpp psutil: https://github.com/giampaolo/psutil pycparser: https://github.com/eliben/pycparser Pygments: https://pygments.org/ pytz: http://pythonhosted.org/pytz PyUserInput: https://github.com/SavinaRoja/PyUserInput requests: https://requests.readthedocs.io rich: https://github.com/willmcgugan/rich setuptools: https://github.com/pypa/setuptools six: https://github.com/benjaminp/six soupsieve: https://github.com/facelessuser/soupsieve ssdfw-scripts: https://my.gerrit.com/a/storage/ssdfw/devops/scripts/devkit tabulate: https://github.com/astanin/python-tabulate typing-extensions: https://github.com/python/typing/blob/master/typing_extensions/README.rst tzlocal: https://github.com/regebro/tzlocal urllib3: https://urllib3.readthedocs.io/ websocket-client: https://github.com/websocket-client/websocket-client.git wheel: https://github.com/pypa/wheel xattr: http://github.com/xattr/xattr installing from local packages osx/unix $ python -m pip download --destination-directory DIR -r requirements.txt # --no-index && --find-links $ python -m pip install --no-index --find-links=DIR -r requirements.txt windows $ py -m pip download --destination-directory DIR -r requirements.txt # --no-index && --find-links $ py -m pip install --no-index --find-links=DIR -r requirements.txt config list all configs [!NOTE] pip config # to check where config comes from $ python -m pip config debug env_var: env: global: /etc/xdg/pip/pip.conf, exists: False /etc/pip.conf, exists: True global.index-url: https://private.artifactory.com/artifactory/api/pypi/tools/simple site: /usr/pip.conf, exists: False user: /home/marslo/.pip/pip.conf, exists: False /home/marslo/.config/pip/pip.conf, exists: False or$ pip config -v list For variant 'global', will try loading '/Library/Application Support/pip/pip.conf' For variant 'user', will try loading '/Users/marslo/.pip/pip.conf' For variant 'user', will try loading '/Users/marslo/.config/pip/pip.conf' For variant 'site', will try loading '/usr/local/opt/python@3.11/Frameworks/Python.framework/Versions/3.11/pip.conf' troubleshooting error: externally-managed-environment [!NOTE|label:references:] pip(3) install，完美解决 externally-managed-environment Python教程：解决pip安装包时报错：error: externally-managed-environment This environment is externally managed How do I solve \"error: externally-managed-environment\" every time I use pip 3? How to Fix the pip \"externally-managed-environment\" Error on Linux issue $ pip install pipx error: externally-managed-environment × This environment is externally managed ╰─> To install Python packages system-wide, try brew install xyz, where xyz is the package you are trying to install. If you wish to install a non-brew-packaged Python package, create a virtual environment using python3 -m venv path/to/venv. Then use path/to/venv/bin/python and path/to/venv/bin/pip. If you wish to install a non-brew packaged Python application, it may be easiest to use pipx install xyz, which will manage a virtual environment for you. Make sure you have pipx installed. note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages. hint: See PEP 668 for the detailed specification. solution$ mv $(brew --prefix python@3.12)/Frameworks/Python.framework/Versions/3.12/lib/python3.12/EXTERNALLY-MANAGED{,.bak} Skipping ... due to invalid metadata entry 'name' [!NOTE|label:info] changelog : 23.2 (2023-07-15) Deprecate support for eggs for Python 3.11 or later, when the new importlib.metadata backend is used to load distribution metadata. This only affects the egg distribution format (with the .egg extension); distributions using the .egg-info metadata format (but are not actually eggs) are not affected. For more information about eggs, see relevant section in the setuptools documentation solution $ pip list WARNING: Skipping /usr/local/lib/python3.12/site-packages/six-1.16.0-py3.12.egg-info due to invalid metadata entry 'name' $ pip unisntall six $ rm -rf /usr/local/lib/python3.12/site-packages/six-1.16.0-py3.12.egg-info # if necessary $ rm -rf /usr/local/lib/python3.12/site-packages/six-1.16.0-py3.12.dist-info $ pip install six has inconsistent version [!NOTE|label:references:] pip has problems with metadata solution$ python -m pip install --upgrade --no-cache-dir --use-deprecated=legacy-resolver Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/python/qa.html":{"url":"programming/python/qa.html","title":"q&a","keywords":"","body":" Q&A pkg_resources.VersionConflict ImportError: No module named pkg_resources No module named pip python install with tcl-tk Q&A pkg_resources.VersionConflict issue $ sudo -H pip install --upgrade pip ... $ pip --version Traceback (most recent call last): File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 584, in _build_master ws.require(__requires__) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 901, in require needed = self.resolve(parse_requirements(requirements)) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 792, in resolve raise VersionConflict(dist, req).with_context(dependent_req) pkg_resources.VersionConflict: (pip 20.1.1 (/Users/marslo/Library/Python/3.7/lib/python/site-packages), Requirement.parse('pip==20.0.2')) During handling of the above exception, another exception occurred: Traceback (most recent call last): File \"/usr/local/opt/python/bin/pip3\", line 6, in from pkg_resources import load_entry_point File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 3254, in @_call_aside File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 3238, in _call_aside f(*args, **kwargs) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 3267, in _initialize_master_working_set working_set = WorkingSet._build_master() File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 586, in _build_master return cls._build_from_requirements(__requires__) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 599, in _build_from_requirements dists = ws.resolve(reqs, Environment()) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 787, in resolve raise DistributionNotFound(req, requirers) pkg_resources.DistributionNotFound: The 'pip==20.0.2' distribution was not found and is required by the application $ which -a pip /usr/local/opt/python/libexec/bin/pip /usr/local/bin/pip $ la /usr/local/opt/python/libexec/bin/pip lrwxr-xr-x 1 marslo staff 14 Jul 6 18:23 /usr/local/opt/python/libexec/bin/pip -> ../../bin/pip3 $ /usr/local/opt/python/bin/pip3 --version Traceback (most recent call last): File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 584, in _build_master ws.require(__requires__) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 901, in require needed = self.resolve(parse_requirements(requirements)) File \"/usr/local/lib/python3.7/site-packages/pkg_resources/__init__.py\", line 792, in resolve raise VersionConflict(dist, req).with_context(dependent_req) pkg_resources.VersionConflict: (pip 20.1.1 (/Users/marslo/Library/Python/3.7/lib/python/site-packages), Requirement.parse('pip==20.0.2')) .... solution $ which -a pip /usr/local/opt/python/libexec/bin/pip /usr/local/bin/pip $ la /usr/local/opt/python/libexec/bin/pip lrwxr-xr-x 1 marslo staff 14 Jul 6 18:23 /usr/local/opt/python/libexec/bin/pip -> ../../bin/pip3 $ which -a pip3 /usr/local/bin/pip3 /usr/bin/pip3 ln -sf $ mv /usr/local/opt/python/bin/pip3{,.bak} $ ln -sf /usr/local/bin/pip3 /usr/local/opt/python/bin/pip3 re-install $ brew reinstall python $ sudo rm -rf /usr/local/lib/python3.7/site-packages/pip/ $ brew postinstall python $ pip --version pip 20.0.2 from /usr/local/lib/python3.7/site-packages/pip (python 3.7) $ sudo -H python3 -m pip install --force-reinstall pip $ pip --version pip 20.1.1 from /usr/local/lib/python3.7/site-packages/pip (python 3.7) ImportError: No module named pkg_resources precondition: $ which -a python /usr/local/opt/python/libexec/bin/python /usr/bin/python $ realpath /usr/bin/python /System/Library/Frameworks/Python.framework/Versions/2.7/bin/python2.7 issue $ /usr/bin/xattr Traceback (most recent call last): File \"/usr/bin/xattr\", line 8, in from pkg_resources import load_entry_point ImportError: No module named pkg_resources solution restore ~/Library/Python/2.7 $ mkdir -p ~/Library/Python/2.7/lib/python $ cp -r /usr/local/lib/python2.7/site-packages ~/Library/Python/2.7/lib/python/ $ sudo chown -R $(whoami):staff ~/Library/Python/2.7 # or $ sudo chown -R $USER:$(id -g) /Users/$USER/Library/Python result: $ /usr/bin/python -m pip list DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Package Version ---------------------------- --------- backports.ssl-match-hostname 3.7.0.1 certifi 2019.6.16 chardet 3.0.4 Click 7.0 click-config-file 0.5.0 colorama 0.4.1 configobj 5.0.6 docker 4.0.2 idna 2.8 ipaddress 1.0.22 Markdown 3.1.1 mdv 1.7.4 pip 19.1.1 Pygments 2.4.2 requests 2.22.0 setuptools 41.0.1 six 1.12.0 tabulate 0.8.3 urllib3 1.25.3 websocket-client 0.56.0 wheel 0.33.4 $ /usr/bin/xattr Traceback (most recent call last): File \"/usr/bin/xattr\", line 8, in from pkg_resources import load_entry_point File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 3241, in @_call_aside File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 3225, in _call_aside f(*args, **kwargs) File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 3254, in _initialize_master_working_set working_set = WorkingSet._build_master() File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 583, in _build_master ws.require(__requires__) File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 900, in require needed = self.resolve(parse_requirements(requirements)) File \"/Users/marslo/Library/Python/2.7/lib/python/site-packages/pkg_resources/__init__.py\", line 786, in resolve raise DistributionNotFound(req, requirers) pkg_resources.DistributionNotFound: The 'xattr==0.6.4' distribution was not found and is required by the application install setuptools==39.1.0 and xattr==0.6.4 $ sudo -H python -m pip install --upgrade pip setuptools wheel $ sudo -H /usr/bin/python -m pip uninstall -y setuptools $ /usr/bin/python -m pip install --user setuptools==39.1.0 DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Collecting setuptools==39.1.0 Installing collected packages: setuptools Found existing installation: setuptools 41.0.1 Uninstalling setuptools-41.0.1: Successfully uninstalled setuptools-41.0.1 Successfully installed setuptools-39.1.0 $ curl -fsSL https://raw.githubusercontent.com/marslo/ibook/master/programming/python/xattr-0.6.4.tar.gz -o xattr-0.6.4.tar.gz $ /usr/bin/python -m pip install --user xattr-0.6.4.tar.gz DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Processing ./xattr-0.6.4.tar.gz Building wheels for collected packages: xattr Building wheel for xattr (setup.py) ... done Stored in directory: /Users/marslo/Library/Caches/pip/wheels/63/db/04/be8c6e423b8158e30b1d63992368c899811286844edf41ce32 Successfully built xattr Installing collected packages: xattr WARNING: The script xattr is installed in '/Users/marslo/Library/Python/2.7/bin' which is not on PATH. Consider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location. Successfully installed xattr-0.6.4 result: $ /usr/bin/xattr -h usage: xattr [-lz] file [file ...] xattr -p [-lz] attr_name file [file ...] xattr -w [-z] attr_name attr_value file [file ...] xattr -d attr_name file [file ...] The first form lists the names of all xattrs on the given file(s). The second form (-p) prints the value of the xattr attr_name. The third form (-w) sets the value of the xattr attr_name to attr_value. The fourth form (-d) deletes the xattr attr_name. options: -h: print this help -l: print long format (attr_name: attr_value) -z: compress or decompress (if compressed) attribute value in zip format $ /usr/bin/python -m pip list DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Package Version ---------------------------- --------- backports.ssl-match-hostname 3.7.0.1 certifi 2019.6.16 chardet 3.0.4 Click 7.0 click-config-file 0.5.0 colorama 0.4.1 configobj 5.0.6 docker 4.0.2 idna 2.8 ipaddress 1.0.22 Markdown 3.1.1 mdv 1.7.4 pip 19.1.1 Pygments 2.4.2 requests 2.22.0 setuptools 39.1.0 six 1.12.0 tabulate 0.8.3 urllib3 1.25.3 websocket-client 0.56.0 wheel 0.33.4 xattr 0.6.4 reinstall xattr==0.6.4 for global [if necessary] $ sudo -H /usr/bin/python -m pip install xattr-0.6.4.tar.gz DEPRECATION: Python 2.7 will reach the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 won't be maintained after that date. A future version of pip will drop support for Python 2.7. Processing /Users/marslo/Desktop/xattr-0.6.4.tar.gz Building wheels for collected packages: xattr Building wheel for xattr (setup.py) ... error ERROR: Complete output from command /System/Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python -u -c 'import setuptools, tokenize;__file__='\"'\"'/private/tmp/pip-req-build-dVgPOl/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' bdist_wheel -d /private/tmp/pip-wheel-ZV80PW --python-tag cp27: ERROR: usage: -c [global_opts] cmd1 [cmd1_opts] [cmd2 [cmd2_opts] ...] or: -c --help [cmd1 cmd2 ...] or: -c --help-commands or: -c cmd --help error: invalid command 'bdist_wheel' ---------------------------------------- ERROR: Failed building wheel for xattr Running setup.py clean for xattr Failed to build xattr Installing collected packages: xattr Found existing installation: xattr 0.6.4 Uninstalling xattr-0.6.4: Successfully uninstalled xattr-0.6.4 Running setup.py install for xattr ... done Successfully installed xattr-0.6.4 No module named pip issue $ sudo -H /usr/bin/python -m pip install --upgrade pip setuptools wheel /System/Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python: No module named pip solution $ sudo -H /usr/bin/python -m ensurepip --default-pip Looking in links: /tmp/tmpkmqQV6 Requirement already satisfied: setuptools in /Library/Python/2.7/site-packages (39.1.0) Collecting pip Installing collected packages: pip Successfully installed pip-18.1 verify $ sudo /usr/bin/python -m pip install --upgrade pip setuptools wheel DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality. WARNING: The directory '/Users/marslo/Library/Caches/pip' or its parent directory is not owned or is not writable by the current user. The cache has been disabled. Check the permissions and owner of that directory. If executing pip with sudo, you may want sudo's -H flag. Looking in indexes: https://my.artifactory.dev.com/artifactory/api/pypi/tools/simple Requirement already up-to-date: pip in /Users/marslo/Library/Python/2.7/lib/python/site-packages (20.2.4) Requirement already up-to-date: setuptools in /Users/marslo/Library/Python/2.7/lib/python/site-packages (44.1.1) Requirement already up-to-date: wheel in /Users/marslo/Library/Python/2.7/lib/python/site-packages (0.35.1) $ ls -Altrh /System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python alternatives get-pip.py $ curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py $ /usr/bin/python get-pip.py python install with tcl-tk $ export PATH=\"/usr/local/opt/tcl-tk/bin:$PATH\" $ export LDFLAGS=\"-L/usr/local/opt/tcl-tk/lib\" $ export CPPFLAGS=\"-I/usr/local/opt/tcl-tk/include\" $ export PKG_CONFIG_PATH=\"/usr/local/opt/tcl-tk/lib/pkgconfig\" $ brew reinstall python Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/others.html":{"url":"programming/others.html","title":"others","keywords":"","body":" others import data to sql and print process get the cnf file location for mysql get the git change from .git/objects unicode simple arrows arrows with modifications arrows with bent tips keyboard symbols and circle arrows harpoons PAIRED ARROWS AND HARPOONS DOUBLE ARROWS miscellaneous arrows and keyboard symbols white arrows and keyboard symbols miscellaneous arrows others import data to sql and print process $ (pv -n ~/database.sql | mysql -u root -pPASSWORD -D database_name) 2>&1 | zenity --width 550 --progress --auto-close --auto-kill --title \"Im get the cnf file location for mysql $ mysql - ? | grep \".cnf\" -C 1 Default options are read from the following files in the given order: /etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/etc/my.cnf ~/.my.cnf The following groups are read: mysql client get the git change from .git/objects $ find .git/objects -type f -printf \"%P\\n\" | sed s,/,, | while read object; do echo \"=== $obj $(git cat-file -t $object) ===\" git cat-file -p $object done unicode reference arrow Arrows amp-what simple arrows CODE SYMBOLS EXPLANATION 2190 ← LEFTWARDS ARROW 20EA ◌⃪ combining leftwards arrow overlay 2191 ↑ UPWARDS ARROW 2192 → RIGHTWARDS ARROW 2193 ↓ DOWNWARDS ARROW 2194 ↔ LEFT RIGHT ARROW 2195 ↕ UP DOWN ARROW 2196 ↖ NORTH WEST ARROW 2197 ↗ NORTH EAST ARROW 2198 ↘ SOUTH EAST ARROW 2199 ↙ SOUTH WEST ARROW arrows with modifications CODE SYMBOLS EXPLANATION 219A ↚ LEFTWARDS ARROW WITH STROKE 219B ↛ RIGHTWARDS ARROW WITH STROKE 219C ↜ LEFTWARDS WAVE ARROW 2B3F ⬿ wave arrow pointing directly left 219D ↝ RIGHTWARDS WAVE ARROW 219E ↞ LEFTWARDS TWO HEADED ARROW 219F ↟ UPWARDS TWO HEADED ARROW 21A0 ↠ RIGHTWARDS TWO HEADED ARROW 21A1 ↡ DOWNWARDS TWO HEADED ARROW 21A2 ↢ LEFTWARDS ARROW WITH TAIL 21A3 ↣ RIGHTWARDS ARROW WITH TAIL 21A4 ↤ LEFTWARDS ARROW FROM BAR 21A5 ↥ UPWARDS ARROW FROM BAR 21A6 ↦ RIGHTWARDS ARROW FROM BAR 21A7 ↧ DOWNWARDS ARROW FROM BAR 21A8 ↨ UP DOWN ARROW WITH BASE 21A9 ↩ LEFTWARDS ARROW WITH HOOK 21AA ↪ RIGHTWARDS ARROW WITH HOOK 21AB ↫ LEFTWARDS ARROW WITH LOOP 21AC ↬ RIGHTWARDS ARROW WITH LOOP 21AD ↭ LEFT RIGHT WAVE ARROW 21AE ↮ LEFT RIGHT ARROW WITH STROKE 21AF ↯ DOWNWARDS ZIGZAG ARROW arrows with bent tips [!TIP] Other arrows with bent tips to complete this set can be found in the Miscellaneous Symbols and Arrows block. CODE SYMBOLS EXPLANATION 21B0 ↰ UPWARDS ARROW WITH TIP LEFTWARDS 21B1 ↱ UPWARDS ARROW WITH TIP RIGHTWARDS 21B2 ↲ DOWNWARDS ARROW WITH TIP LEFTWARDS 21B3 ↳ DOWNWARDS ARROW WITH TIP RIGHTWARDS keyboard symbols and circle arrows CODE SYMBOLS EXPLANATION 21B4 ↴ RIGHTWARDS ARROW WITH CORNER DOWNWARDS 21B5 ↵ DOWNWARDS ARROW WITH CORNER LEFTWARDS 23CE ⏎ return symbol 21B6 ↶ ANTICLOCKWISE TOP SEMICIRCLE ARROW 21B7 ↷ CLOCKWISE TOP SEMICIRCLE ARROW 21B8 ↸ NORTH WEST ARROW TO LONG BAR 21B9 ↹ LEFTWARDS ARROW TO BAR OVER RIGHTWARDS ARROW TO BAR 21BA ↺ ANTICLOCKWISE OPEN CIRCLE ARROW 21BB ↻ CLOCKWISE OPEN CIRCLE ARROW harpoons CODE SYMBOLS EXPLANATION 21BC ↼ LEFTWARDS HARPOON WITH BARB UPWARDS 21BD ↽ LEFTWARDS HARPOON WITH BARB DOWNWARDS 21BE ↾ UPWARDS HARPOON WITH BARB RIGHTWARDS 21BF ↿ UPWARDS HARPOON WITH BARB LEFTWARDS 21C0 ⇀ RIGHTWARDS HARPOON WITH BARB UPWARDS 21C1 ⇁ RIGHTWARDS HARPOON WITH BARB DOWNWARDS 21C2 ⇂ DOWNWARDS HARPOON WITH BARB RIGHTWARDS 21C3 ⇃ DOWNWARDS HARPOON WITH BARB LEFTWARDS PAIRED ARROWS AND HARPOONS CODE SYMBOLS EXPLANATION 21C4 ⇄ RIGHTWARDS ARROW OVER LEFTWARDS ARROW 21C5 ⇅ UPWARDS ARROW LEFTWARDS OF DOWNWARDS ARROW 21C6 ⇆ LEFTWARDS ARROW OVER RIGHTWARDS ARROW 21C7 ⇇ LEFTWARDS PAIRED ARROWS 21C8 ⇈ UPWARDS PAIRED ARROWS 21C9 ⇉ RIGHTWARDS PAIRED ARROWS 21CA ⇊ DOWNWARDS PAIRED ARROWS 21CB ⇋ LEFTWARDS HARPOON OVER RIGHTWARDS HARPOON 21CC ⇌ RIGHTWARDS HARPOON OVER LEFTWARDS HARPOON DOUBLE ARROWS CODE SYMBOLS EXPLANATION 21CD ⇍ LEFTWARDS DOUBLE ARROW WITH STROKE 21CE ⇎ LEFT RIGHT DOUBLE ARROW WITH STROKE 21CF ⇏ RIGHTWARDS DOUBLE ARROW WITH STROKE 21D0 ⇐ LEFTWARDS DOUBLE ARROW 21D1 ⇑ UPWARDS DOUBLE ARROW 21D2 ⇒ RIGHTWARDS DOUBLE ARROW 21D3 ⇓ DOWNWARDS DOUBLE ARROW 21D4 ⇔ LEFT RIGHT DOUBLE ARROW 21D5 ⇕ UP DOWN DOUBLE ARROW 21D6 ⇖ NORTH WEST DOUBLE ARROW 21D7 ⇗ NORTH EAST DOUBLE ARROW 21D8 ⇘ SOUTH EAST DOUBLE ARROW 21D9 ⇙ SOUTH WEST DOUBLE ARROW miscellaneous arrows and keyboard symbols CODE SYMBOLS EXPLANATION 21DA ⇚ LEFTWARDS TRIPLE ARROW 21DB ⇛ RIGHTWARDS TRIPLE ARROW 21DC ⇜ LEFTWARDS SQUIGGLE ARROW 2B33 ⬳ LONG LEFTWARDS SQUIGGLE ARROW 21DD ⇝ RIGHTWARDS SQUIGGLE ARROW 21DE ⇞ UPWARDS ARROW WITH DOUBLE STROKE 21DF ⇟ DOWNWARDS ARROW WITH DOUBLE STROKE 21E0 ⇠ LEFTWARDS DASHED ARROW 21E1 ⇡ UPWARDS DASHED ARROW 21E2 ⇢ RIGHTWARDS DASHED ARROW 21E3 ⇣ DOWNWARDS DASHED ARROW 21E4 ⇤ LEFTWARDS ARROW TO BAR 21E5 ⇥ RIGHTWARDS ARROW TO BAR white arrows and keyboard symbols CODE SYMBOLS EXPLANATION 21E6 ⇦ LEFTWARDS WHITE ARROW 2B00 ⬀ NORTH EAST WHITE ARROW 21E7 ⇧ UPWARDS WHITE ARROW 21E8 ⇨ RIGHTWARDS WHITE ARROW 21E9 ⇩ DOWNWARDS WHITE ARROW 21EA ⇪ UPWARDS WHITE ARROW FROM BAR 21EB ⇫ UPWARDS WHITE ARROW ON PEDESTAL 21EC ⇬ UPWARDS WHITE ARROW ON PEDESTAL WITH HORIZONTAL BAR 21ED ⇭ UPWARDS WHITE ARROW ON PEDESTAL WITH VERTICAL BAR 21EE ⇮ UPWARDS WHITE DOUBLE ARROW 21EF ⇯ UPWARDS WHITE DOUBLE ARROW ON PEDESTAL 21F0 ⇰ RIGHTWARDS WHITE ARROW FROM WALL 21F1 ⇱ NORTH WEST ARROW TO CORNER 21F2 ⇲ SOUTH EAST ARROW TO CORNER 21F3 ⇳ UP DOWN WHITE ARROW 2B04 ⬄ LEFT RIGHT WHITE ARROW miscellaneous arrows CODE SYMBOLS EXPLANATION 21F4 ⇴ RIGHT ARROW WITH SMALL CIRCLE 2B30 ⬰ LEFT ARROW WITH SMALL CIRCLE 21F5 ⇵ DOWNWARDS ARROW LEFTWARDS OF UPWARDS ARROW 21F6 ⇶ THREE RIGHTWARDS ARROWS 2B31 ⬱ THREE LEFTWARDS ARROWS 21F7 ⇷ LEFTWARDS ARROW WITH VERTICAL STROKE 21F8 ⇸ RIGHTWARDS ARROW WITH VERTICAL STROKE 21F9 ⇹ LEFT RIGHT ARROW WITH VERTICAL STROKE 21FA ⇺ LEFTWARDS ARROW WITH DOUBLE VERTICAL STROKE 21FB ⇻ RIGHTWARDS ARROW WITH DOUBLE VERTICAL STROKE 21FC ⇼ LEFT RIGHT ARROW WITH DOUBLE VERTICAL STROKE 21FD ⇽ LEFTWARDS OPEN-HEADED ARROW 21FE ⇾ RIGHTWARDS OPEN-HEADED ARROW 21FF ⇿ LEFT RIGHT OPEN-HEADED ARROW Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/archive/archive.html":{"url":"programming/archive/archive.html","title":"archive","keywords":"","body":"Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2020-12-26 11:34:51 "},"programming/archive/angular/config.html":{"url":"programming/archive/angular/config.html","title":"angular","keywords":"","body":" download nodejs install yo install compass by gem install angular startup server download nodejs for 64bit $ wget http://nodejs.org/dist/v0.10.29/node-v0.10.29-linux-x64.tar.gz for 32bit $ wget http://nodejs.org/dist/v0.10.29/node-v0.10.29-linux-x86.tar.gz install yo $ sudo npm install -g yo install compass by gem The solution for kernel_require.rb:55:inrequire': libyaml-0.so.2: cannot open shared object file: No such file or directory - /../../psych.so (LoadError)` $ sudo gem install compass install angular $ npm install generator-angular $ yo angular $ bower install startup server $ grunt serve Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/archive/maven/maven.html":{"url":"programming/archive/maven/maven.html","title":"maven","keywords":"","body":" compile and execute java file by manual compile execute compile and execute by maven compile test package install verification scaffold in maven maven 3.x maven 2.x compile and execute java file by manual compile [16:59:13.56 C:\\hello-world\\src\\main\\java] $ javac com\\juvenxu\\mvnbook\\helloworld\\HelloWorld.java execute [16:59:20.89 C:\\hello-world\\src\\main\\java] $ java com.juvenxu.mvnbook.helloworld.HelloWorld Hello Maven compile and execute by maven compile [16:55:49.04 C:\\hello-world] $ mvn clean compile [INFO] Scanning for projects... [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 1.916 s [INFO] Finished at: 2014-11-28T17:02:36+08:00 [INFO] Final Memory: 12M/150M [INFO] ------------------------------------------------------------------------ test [17:02:39.17 C:\\hello-world] $ mvn clean test [INFO] Scanning for projects... [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\test\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world --- [INFO] Surefire report directory: C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.juvenxu.mvnbook.helloworld.HelloWorldTest Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.06 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 4.639 s [INFO] Finished at: 2014-11-28T17:03:42+08:00 [INFO] Final Memory: 13M/159M [INFO] ------------------------------------------------------------------------ package [18:36:28.23 C:\\hello-world] $ mvn clean package [INFO] Scanning for projects... [WARNING] [WARNING] Some problems were encountered while building the effective model for com.juvenxu.mvnbook:hello-world:jar:1.0-SNAPSHOT [WARNING] 'build.plugins.plugin.version' for org.apache.maven.plugins:maven-compiler-plugin is missing. @ line 21, column 15 [WARNING] [WARNING] It is highly recommended to fix these problems because they threaten the stability of your build. [WARNING] [WARNING] For this reason, future Maven versions might no longer support building such malformed projects. [WARNING] [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\test\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world --- [INFO] Surefire report directory: C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.juvenxu.mvnbook.helloworld.HelloWorldTest Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.06 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] [INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ hello-world --- [INFO] Building jar: C:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 5.571 s [INFO] Finished at: 2014-11-28T18:36:41+08:00 [INFO] Final Memory: 15M/201M [INFO] ------------------------------------------------------------------------ install [19:02:40.49 c:\\hello-world] $ mvn clean install [INFO] Scanning for projects... [WARNING] [WARNING] Some problems were encountered while building the effective model for com.juvenxu.mvnbook:hello-world:jar:1.0-SNAPSHOT [WARNING] 'build.plugins.plugin.version' for org.apache.maven.plugins:maven-compiler-plugin is missing. @ line 21, column 15 [WARNING] [WARNING] It is highly recommended to fix these problems because they threaten the stability of your build. [WARNING] [WARNING] For this reason, future Maven versions might no longer support building such malformed projects. [WARNING] [INFO] [INFO] ------------------------------------------------------------------------ [INFO] Building Maven Hello World Project 1.0-SNAPSHOT [INFO] ------------------------------------------------------------------------ [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ hello-world --- [INFO] Deleting c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\main\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\classes [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ hello-world --- [WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] skip non existing resourceDirectory c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\src\\test\\resources [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ hello-world --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding Cp1252, i.e. build is platform dependent! [INFO] Compiling 1 source file to c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ hello-world --- [INFO] Surefire report directory: c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.juvenxu.mvnbook.helloworld.HelloWorldTest Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.05 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] [INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ hello-world --- [INFO] Building jar: c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar [INFO] [INFO] --- maven-shade-plugin:1.2.1:shade (default) @ hello-world --- [INFO] Replacing original artifact with shaded artifact. [INFO] Replacing c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar with c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT-shaded.jar [INFO] [INFO] --- maven-install-plugin:2.4:install (default-install) @ hello-world --- [INFO] Installing c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\target\\hello-world-1.0-SNAPSHOT.jar to C:\\Users\\marslo_jiao\\.m2\\repository\\com\\juvenxu\\mvnbook\\hello-world\\1.0-SNAPSHOT\\hello-world-1.0-SNAPSHOT.jar [INFO] Installing c:\\Marslo\\Study\\Codes\\Maven\\hello-world\\pom.xml to C:\\Users\\marslo_jiao\\.m2\\repository\\com\\juvenxu\\mvnbook\\hello-world\\1.0-SNAPSHOT\\hello-world-1.0-SNAPSHOT.pom [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 5.429 s [INFO] Finished at: 2014-11-28T19:03:44+08:00 [INFO] Final Memory: 16M/201M [INFO] ------------------------------------------------------------------------ verification [19:09:52.90 c:\\hello-world\\target] $ java -jar hello-world-1.0-SNAPSHOT.jar Hello Maven [19:09:57.52 c:\\hello-world\\target] $ jar xf hello-world-1.0-SNAPSHOT.jar [19:10:46.36 c:\\hello-world\\target] $ cat META-INF\\MANIFEST.MF Manifest-Version: 1.0 Archiver-Version: Plexus Archiver Built-By: Marslo_Jiao Created-By: Apache Maven 3.2.3 Build-Jdk: 1.8.0_25 Main-Class: com.juvenxu.mvnbook.helloworld.HelloWorld scaffold in maven maven 3.x [13:05:17.08 C:\\archetype] $ mvn archetype:generate ... Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): 502: Choose org.apache.maven.archetypes:maven-archetype-quickstart version: 1: 1.0-alpha-1 2: 1.0-alpha-2 3: 1.0-alpha-3 4: 1.0-alpha-4 5: 1.0 6: 1.1 Choose a number: 6: Define value for property 'package': com.juvenxu.mvnbook: : com.juvenxu.mvnbook.helloworld Confirm properties configuration: groupId: com.juvenxu.mvnbook artifactId: hello-world version: 1.0-SNAPSHOT package: com.juvenxu.mvnbook.helloworld Y: : Y ... maven 2.x $ mvn org.apache.maven.plugins:maven-archetype-plugin:2.0-alpha-5:generate Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/archive/mysql/installation/installDB.html":{"url":"programming/archive/mysql/installation/installDB.html","title":"mysql","keywords":"","body":" The log of scripts/mysql_install_db --user=mysql The log of scripts/mysql_install_db --user=mysql Installing MySQL system tables...OK Filling help tables...OK To start mysqld at boot time you have to copy support-files/mysql.server to the right place for your system PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER ! To do so, start the server, then issue the following commands: ./bin/mysqladmin -u root password 'new-password' ./bin/mysqladmin -u root -h MJ password 'new-password' Alternatively you can run: ./bin/mysql_secure_installation which will also give you the option of removing the test databases and anonymous user created by default. This is strongly recommended for production servers. See the manual for more instructions. You can start the MySQL daemon with: cd . ; ./bin/mysqld_safe & You can test the MySQL daemon with mysql-test-run.pl cd mysql-test ; perl mysql-test-run.pl Please report any problems with the ./bin/mysqlbug script! The latest information about MySQL is available on the web at http://www.mysql.com Support MySQL by buying support/licenses at http://shop.mysql.com New default config file was created as ./my.cnf and will be used by default by the server when you start it. You may edit this file to change server settings Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/archive/mysql/installation/installFromSourceCode.html":{"url":"programming/archive/mysql/installation/installFromSourceCode.html","title":"installFromSourceCode","keywords":"","body":" Install MySQL from Source code Usefull Links Compile and Install Configuration and Initial Set Environment Check the mysql port Check variables Make mysql as boot start Install MySQL from Source code Usefull Links Community Server 5.7 MySQL Community Server 5.6 MySQL Community Server MySQL source code mysql-5.7.3-m13.tar.gz mysql-5.6.16.tar.gz Documents MySQL Document MySQL Online manual 2.8.2. Installing MySQL Using a Standard Source Distribution 2.8.4. MySQL Source-Configuration Options Compile and Install Preconfiguration Setup Create user and group $ sudo groupadd mysql $ sudo useradd -r -g mysql mysql Extract tar.gz $ tar xf mysql-5.7.3-m13.tar.gz $ cd mysql-5.7.3-m13 Compile and Install $ cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\ > -DDEFAULT_CHARSET=gbk \\ > -DDEFAULT_COLLATION=gbk_chinese_ci \\ > -DENABLED_LOCAL_INFILE=ON \\ > -DWITH_INNOBASE_STORAGE_ENGINE=1 \\ > -DWITH_FEDERATED_STORAGE_ENGINE=1 \\ > -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\ > -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \\ > -DWITH_DEBUG=0 \\ > -DMYSQL_TCP_PORT=3306 $ make $ sudo make install cmake logs Configuration and Initial Permission Manager $ sudo chown -R mysql:mysql /usr/local/mysql Initial MySQL $ scripts/mysql_install_db --user=mysql $ cp support-files/mysql.server /etc/init.d/mysqld Log of mysql_install_db --user=mysql Change Permission again $ sudo chown -R root . $ sudo chown -R mysql data Start mysqld_safe $ sudo bin/mysqld_safe --user=mysql & Setup root password $ sudo ./bin/mysqladmin -u root password '' # Or $ sudo ./bin/mysql_secure_installation Log of mysql_secure_installatioin Set Environment $ sudo bash -c 'cat >> /etc/bash.bashrc' export PATH=/usr/local/mysql/bin:$PATH > EOF Check the mysql port $ sudo netstat -tunlp | grep 3306 tcp6 0 0 :::3306 :::* LISTEN 21712/mysqld Check variables $ mysqladmin variables -p Enter password: Make mysql as boot start $ sudo chkconfig --add mysqld $ sudo chkconfig --level 345 mysqld on Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/archive/mysql/installation/secureInstation.html":{"url":"programming/archive/mysql/installation/secureInstation.html","title":"secureInstation","keywords":"","body":" Log for ./bin/mysql_secure_installation Log for ./bin/mysql_secure_installation $ sudo ./bin/mysql_secure_installation NOTE: RUNNING ALL THE STEPS FOLLOWING THIS IS RECOMMENDED FOR ALL MySQL SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY! In order to log into MySQL to secure it, we'll need the current password for the root user. If you've just installed MySQL, and you haven't set the root password yet, the password will be blank, so you should just press enter here. Enter password: OK, successfully used password, moving on... validate_password plugin is installed on the server. The subsequent steps will run with the existing configuration of the plugin. Setting the root password ensures that nobody can log into the MySQL root user without the proper authorisation. You already have a root password set. Strength of the password: 25 Change the root password? (Press y|Y for Yes, any other key for No) : n ... skipping. By default, a MySQL installation has an anonymous user, allowing anyone to log into MySQL without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment. Remove anonymous users? (Press y|Y for Yes, any other key for No) : y Success.. Moving on.. Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network. Disallow root login remotely? (Press y|Y for Yes, any other key for No) : n ... skipping. By default, MySQL comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment. Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y - Dropping test database... ... Success! - Removing privileges on test database... ... Success! Reloading the privilege tables will ensure that all changes made so far will take effect immediately. Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y ... Success! All done! If you've completed all of the above steps, your MySQL installation should now be secure. Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/archive/mysql/logs/cmakeLogs.html":{"url":"programming/archive/mysql/logs/cmakeLogs.html","title":"logs","keywords":"","body":" cmake logs: cmake logs: $ cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DDEFAULT_CHARSET=gbk -DDEFAULT_COLLATION=gbk_chinese_ci -DENABLED_LOCAL_INFILE=ON -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_FEDERATED_STORAGE_ENGINE=1 -DWITH_BLACKHOLE_STORAGE_ENGINE=1 -DWITH_COMMENT=\"Marslo edition\" -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock -DWITH_DEBUG=0 -DMYSQL_TCP_PORT=3306 # or $ cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \\ -DDEFAULT_CHARSET=gbk \\ -DDEFAULT_COLLATION=gbk_chinese_ci \\ -DENABLED_LOCAL_INFILE=ON \\ -DWITH_INNOBASE_STORAGE_ENGINE=1 \\ -DWITH_FEDERATED_STORAGE_ENGINE=1 \\ -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\ -DWITH_COMMENT=\"Marslo edition\" \\ -DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \\ -DWITH_DEBUG=0 \\ -DMYSQL_TCP_PORT=3306 -- Running cmake version 2.8.11.2 -- Configuring with MAX_INDEXES = 64U -- Looking for SHM_HUGETLB -- Looking for SHM_HUGETLB - found -- Looking for sys/types.h -- Looking for sys/types.h - found -- Looking for stdint.h -- Looking for stdint.h - found -- Looking for stddef.h -- Looking for stddef.h - found -- Check size of void * -- Check size of void * - done -- MySQL 5.7.3-m13 -- Packaging as: mysql-5.7.3-m13-Linux-i686 -- Looking for floor -- Looking for floor - not found -- Looking for floor in m -- Looking for floor in m - found -- Looking for gethostbyname_r -- Looking for gethostbyname_r - found -- Looking for bind -- Looking for bind - found -- Looking for crypt -- Looking for crypt - not found -- Looking for crypt in crypt -- Looking for crypt in crypt - found -- Looking for setsockopt -- Looking for setsockopt - found -- Looking for dlopen -- Looking for dlopen - not found -- Looking for dlopen in dl -- Looking for dlopen in dl - found -- Looking for sched_yield -- Looking for sched_yield - found -- Looking for clock_gettime -- Looking for clock_gettime - found -- Looking for include file pthread.h -- Looking for include file pthread.h - found -- Looking for pthread_create -- Looking for pthread_create - not found -- Looking for pthread_create in pthreads -- Looking for pthread_create in pthreads - not found -- Looking for pthread_create in pthread -- Looking for pthread_create in pthread - found -- Found Threads: TRUE -- Looking for include file alloca.h -- Looking for include file alloca.h - found -- Looking for include file arpa/inet.h -- Looking for include file arpa/inet.h - found -- Looking for include file crypt.h -- Looking for include file crypt.h - found -- Looking for include file cxxabi.h -- Looking for include file cxxabi.h - not found -- Looking for include file dirent.h -- Looking for include file dirent.h - found -- Looking for include file dlfcn.h -- Looking for include file dlfcn.h - found -- Looking for include file execinfo.h -- Looking for include file execinfo.h - found -- Looking for include file fcntl.h -- Looking for include file fcntl.h - found -- Looking for include file fenv.h -- Looking for include file fenv.h - found -- Looking for include file fpu_control.h -- Looking for include file fpu_control.h - found -- Looking for include file grp.h -- Looking for include file grp.h - found -- Looking for include file ieeefp.h -- Looking for include file ieeefp.h - not found -- Looking for include file inttypes.h -- Looking for include file inttypes.h - found -- Looking for include file langinfo.h -- Looking for include file langinfo.h - found -- Looking for include file malloc.h -- Looking for include file malloc.h - found -- Looking for include file ndir.h -- Looking for include file ndir.h - not found -- Looking for include file netinet/in.h -- Looking for include file netinet/in.h - found -- Looking for include file paths.h -- Looking for include file paths.h - found -- Looking for include file poll.h -- Looking for include file poll.h - found -- Looking for include file pwd.h -- Looking for include file pwd.h - found -- Looking for include file sched.h -- Looking for include file sched.h - found -- Looking for include file select.h -- Looking for include file select.h - not found -- Looking for include files sys/types.h, sys/dir.h -- Looking for include files sys/types.h, sys/dir.h - found -- Looking for include file sys/ndir.h -- Looking for include file sys/ndir.h - not found -- Looking for include file strings.h -- Looking for include file strings.h - found -- Looking for include file synch.h -- Looking for include file synch.h - not found -- Looking for include file sysent.h -- Looking for include file sysent.h - not found -- Looking for include file sys/cdefs.h -- Looking for include file sys/cdefs.h - found -- Looking for include file sys/ioctl.h -- Looking for include file sys/ioctl.h - found -- Looking for include file sys/ipc.h -- Looking for include file sys/ipc.h - found -- Looking for include file sys/malloc.h -- Looking for include file sys/malloc.h - not found -- Looking for include file sys/mman.h -- Looking for include file sys/mman.h - found -- Looking for include file sys/prctl.h -- Looking for include file sys/prctl.h - found -- Looking for include file sys/resource.h -- Looking for include file sys/resource.h - found -- Looking for include file sys/select.h -- Looking for include file sys/select.h - found -- Looking for include file sys/shm.h -- Looking for include file sys/shm.h - found -- Looking for include file sys/socket.h -- Looking for include file sys/socket.h - found -- Looking for include file sys/stat.h -- Looking for include file sys/stat.h - found -- Looking for include files curses.h, term.h -- Looking for include files curses.h, term.h - found -- Looking for include file asm/termbits.h -- Looking for include file asm/termbits.h - found -- Looking for include file termbits.h -- Looking for include file termbits.h - not found -- Looking for include file termios.h -- Looking for include file termios.h - found -- Looking for include file termio.h -- Looking for include file termio.h - found -- Looking for include file termcap.h -- Looking for include file termcap.h - found -- Looking for include file unistd.h -- Looking for include file unistd.h - found -- Looking for include file utime.h -- Looking for include file utime.h - found -- Looking for include file sys/time.h -- Looking for include file sys/time.h - found -- Looking for include file sys/utime.h -- Looking for include file sys/utime.h - not found -- Looking for include file sys/wait.h -- Looking for include file sys/wait.h - found -- Looking for include file sys/param.h -- Looking for include file sys/param.h - found -- Looking for include file sys/vadvise.h -- Looking for include file sys/vadvise.h - not found -- Looking for include file fnmatch.h -- Looking for include file fnmatch.h - found -- Looking for include files stdlib.h, sys/un.h -- Looking for include files stdlib.h, sys/un.h - found -- Looking for include file vis.h -- Looking for include file vis.h - not found -- Looking for include file sasl/sasl.h -- Looking for include file sasl/sasl.h - not found -- Looking for include file sys/devpoll.h -- Looking for include file sys/devpoll.h - not found -- Looking for include file sys/epoll.h -- Looking for include file sys/epoll.h - found -- Looking for TAILQ_FOREACH -- Looking for TAILQ_FOREACH - found -- Performing Test HAVE_WERROR_FLAG -- Performing Test HAVE_WERROR_FLAG - Success -- Performing Test HAVE_PTHREAD_ONCE_INIT -- Performing Test HAVE_PTHREAD_ONCE_INIT - Success -- Looking for _aligned_malloc -- Looking for _aligned_malloc - not found -- Looking for alarm -- Looking for alarm - found -- Looking for backtrace -- Looking for backtrace - found -- Looking for backtrace_symbols -- Looking for backtrace_symbols - found -- Looking for backtrace_symbols_fd -- Looking for backtrace_symbols_fd - found -- Looking for printstack -- Looking for printstack - not found -- Looking for index -- Looking for index - found -- Looking for clock_gettime -- Looking for clock_gettime - found -- Looking for cuserid -- Looking for cuserid - found -- Looking for directio -- Looking for directio - not found -- Looking for ftruncate -- Looking for ftruncate - found -- Looking for compress -- Looking for compress - not found -- Looking for crypt -- Looking for crypt - found -- Looking for dlerror -- Looking for dlerror - found -- Looking for dlopen -- Looking for dlopen - found -- Looking for fchmod -- Looking for fchmod - found -- Looking for fcntl -- Looking for fcntl - found -- Looking for fdatasync -- Looking for fdatasync - found -- Looking for fdatasync -- Looking for fdatasync - found -- Looking for fedisableexcept -- Looking for fedisableexcept - found -- Looking for fseeko -- Looking for fseeko - found -- Looking for fsync -- Looking for fsync - found -- Looking for gethostbyaddr_r -- Looking for gethostbyaddr_r - found -- Looking for gethrtime -- Looking for gethrtime - not found -- Looking for getnameinfo -- Looking for getnameinfo - found -- Looking for getpass -- Looking for getpass - found -- Looking for getpassphrase -- Looking for getpassphrase - not found -- Looking for getpwnam -- Looking for getpwnam - found -- Looking for getpwuid -- Looking for getpwuid - found -- Looking for getrlimit -- Looking for getrlimit - found -- Looking for getrusage -- Looking for getrusage - found -- Looking for initgroups -- Looking for initgroups - found -- Looking for issetugid -- Looking for issetugid - not found -- Looking for getuid -- Looking for getuid - found -- Looking for geteuid -- Looking for geteuid - found -- Looking for getgid -- Looking for getgid - found -- Looking for getegid -- Looking for getegid - found -- Looking for lstat -- Looking for lstat - found -- Looking for madvise -- Looking for madvise - found -- Looking for malloc_info -- Looking for malloc_info - found -- Looking for mlock -- Looking for mlock - found -- Looking for mlockall -- Looking for mlockall - found -- Looking for mmap -- Looking for mmap - found -- Looking for mmap64 -- Looking for mmap64 - found -- Looking for poll -- Looking for poll - found -- Looking for posix_fallocate -- Looking for posix_fallocate - found -- Looking for posix_memalign -- Looking for posix_memalign - found -- Looking for pread -- Looking for pread - found -- Looking for pthread_attr_getguardsize -- Looking for pthread_attr_getguardsize - found -- Looking for pthread_condattr_setclock -- Looking for pthread_condattr_setclock - found -- Looking for pthread_sigmask -- Looking for pthread_sigmask - found -- Looking for pthread_yield_np -- Looking for pthread_yield_np - not found -- Looking for readdir_r -- Looking for readdir_r - found -- Looking for readlink -- Looking for readlink - found -- Looking for realpath -- Looking for realpath - found -- Looking for sched_yield -- Looking for sched_yield - found -- Looking for setenv -- Looking for setenv - found -- Looking for setfd -- Looking for setfd - not found -- Looking for sigaction -- Looking for sigaction - found -- Looking for sigset -- Looking for sigset - found -- Looking for sleep -- Looking for sleep - found -- Looking for stpcpy -- Looking for stpcpy - found -- Looking for stpncpy -- Looking for stpncpy - found -- Looking for strlcpy -- Looking for strlcpy - not found -- Looking for strnlen -- Looking for strnlen - found -- Looking for strlcat -- Looking for strlcat - not found -- Looking for strsignal -- Looking for strsignal - found -- Looking for fgetln -- Looking for fgetln - not found -- Looking for strsep -- Looking for strsep - found -- Looking for tell -- Looking for tell - not found -- Looking for thr_yield -- Looking for thr_yield - not found -- Looking for vasprintf -- Looking for vasprintf - found -- Looking for memalign -- Looking for memalign - found -- Looking for nl_langinfo -- Looking for nl_langinfo - found -- Looking for ntohll -- Looking for ntohll - not found -- Looking for clock_gettime -- Looking for clock_gettime - found -- Looking for epoll_create -- Looking for epoll_create - found -- Looking for inet_ntop -- Looking for inet_ntop - found -- Looking for kqueue -- Looking for kqueue - not found -- Looking for timeradd -- Looking for timeradd - found -- Looking for timerclear -- Looking for timerclear - found -- Looking for timercmp -- Looking for timercmp - found -- Looking for timerisset -- Looking for timerisset - found -- Looking for include file sys/times.h -- Looking for include file sys/times.h - found -- Looking for include file asm/msr.h -- Looking for include file asm/msr.h - found -- Looking for times -- Looking for times - found -- Looking for gettimeofday -- Looking for gettimeofday - found -- Looking for rdtscll -- Looking for rdtscll - not found -- Looking for madvise -- Looking for madvise - found -- Looking for lrand48 -- Looking for lrand48 - found -- Looking for getpagesize -- Looking for getpagesize - found -- Looking for TIOCGWINSZ -- Looking for TIOCGWINSZ - found -- Looking for FIONREAD -- Looking for FIONREAD - found -- Looking for FIONREAD -- Looking for FIONREAD - not found -- Looking for finite -- Looking for finite - found -- Looking for log2 -- Looking for log2 - found -- Looking for rint -- Looking for rint - found -- Performing Test HAVE_ISINF -- Performing Test HAVE_ISINF - Success -- Performing Test HAVE_FESETROUND -- Performing Test HAVE_FESETROUND - Success -- Check if the system is big endian -- Searching 16 bit integer -- Check size of unsigned short -- Check size of unsigned short - done -- Using unsigned short -- Check if the system is big endian - little endian -- Check size of sigset_t -- Check size of sigset_t - done -- Check size of mode_t -- Check size of mode_t - done -- Check size of char * -- Check size of char * - done -- Check size of long -- Check size of long - done -- Check size of char -- Check size of char - done -- Check size of short -- Check size of short - done -- Check size of int -- Check size of int - done -- Check size of long long -- Check size of long long - done -- Check size of off_t -- Check size of off_t - done -- Check size of uint -- Check size of uint - done -- Check size of ulong -- Check size of ulong - done -- Check size of u_int32_t -- Check size of u_int32_t - done -- Check size of time_t -- Check size of time_t - done -- Performing Test TIME_T_UNSIGNED -- Performing Test TIME_T_UNSIGNED - Failed -- Performing Test HAVE_GETADDRINFO -- Performing Test HAVE_GETADDRINFO - Success -- Performing Test HAVE_SELECT -- Performing Test HAVE_SELECT - Success -- Performing Test QSORT_TYPE_IS_VOID -- Performing Test QSORT_TYPE_IS_VOID - Success -- Performing Test HAVE_SOCKET_SIZE_T_AS_socklen_t -- Performing Test HAVE_SOCKET_SIZE_T_AS_socklen_t - Success -- Performing Test HAVE_PTHREAD_YIELD_ZERO_ARG -- Performing Test HAVE_PTHREAD_YIELD_ZERO_ARG - Success -- Checking stack direction : -1 -- Performing Test SIGNAL_RETURN_TYPE_IS_VOID -- Performing Test SIGNAL_RETURN_TYPE_IS_VOID - Success -- Looking for include files time.h, sys/time.h -- Looking for include files time.h, sys/time.h - found -- Looking for O_NONBLOCK -- Looking for O_NONBLOCK - found -- Performing Test C_HAS_inline -- Performing Test C_HAS_inline - Success -- Performing Test HAVE_PAUSE_INSTRUCTION -- Performing Test HAVE_PAUSE_INSTRUCTION - Success -- Performing Test HAVE_POSIX_SIGNALS -- Performing Test HAVE_POSIX_SIGNALS - Success -- Performing Test HAVE_BSS_START -- Performing Test HAVE_BSS_START - Success -- Performing Test HAVE_WEAK_SYMBOL -- Performing Test HAVE_WEAK_SYMBOL - Success -- Performing Test HAVE_SOLARIS_STYLE_GETHOST -- Performing Test HAVE_SOLARIS_STYLE_GETHOST - Failed -- Performing Test HAVE_GCC_ATOMIC_BUILTINS -- Performing Test HAVE_GCC_ATOMIC_BUILTINS - Success -- Looking for netinet/in6.h -- Looking for netinet/in6.h - not found -- Check size of struct sockaddr_in6 -- Check size of struct sockaddr_in6 - done -- Check size of struct in6_addr -- Check size of struct in6_addr - done -- Performing Test HAVE_SOCKADDR_STORAGE_SS_FAMILY -- Performing Test HAVE_SOCKADDR_STORAGE_SS_FAMILY - Success -- Performing Test HAVE_SOCKADDR_IN_SIN_LEN -- Performing Test HAVE_SOCKADDR_IN_SIN_LEN - Failed -- Performing Test HAVE_SOCKADDR_IN6_SIN6_LEN -- Performing Test HAVE_SOCKADDR_IN6_SIN6_LEN - Failed -- Performing Test HAVE_VISIBILITY_HIDDEN -- Performing Test HAVE_VISIBILITY_HIDDEN - Success -- HAVE_VISIBILITY_HIDDEN -- HAVE_VISIBILITY_HIDDEN -- HAVE_VISIBILITY_HIDDEN -- Check size of mbstate_t -- Check size of mbstate_t - done -- Performing Test HAVE_LANGINFO_CODESET -- Performing Test HAVE_LANGINFO_CODESET - Success -- Looking for wcsdup -- Looking for wcsdup - found -- Check size of wchar_t -- Check size of wchar_t - done -- Check size of wint_t -- Check size of wint_t - done -- Found Curses: /usr/lib/i386-linux-gnu/libcurses.so -- Looking for tputs in /usr/lib/i386-linux-gnu/libcurses.so -- Looking for tputs in /usr/lib/i386-linux-gnu/libcurses.so - found -- Performing Test HAVE_DECL_TGOTO -- Performing Test HAVE_DECL_TGOTO - Success -- Looking for strvis -- Looking for strvis - not found -- Looking for strunvis -- Looking for strunvis - not found -- Using cmake version 2.8.11.2 -- Performing Test flag_supported -- Performing Test flag_supported - Success -- Disabling -Wunused-but-set-variable warning -- Performing Test flag_supported -- Performing Test flag_supported - Success -- Disabling -Wstrict-aliasing warning -- Not building NDB -- Looking for include file libaio.h -- Looking for include file libaio.h - not found -- Looking for io_queue_init in aio -- Looking for io_queue_init in aio - not found -- Looking for sched_getcpu -- Looking for sched_getcpu - found -- Looking for nanosleep -- Looking for nanosleep - found -- Performing Test HAVE_IB_GCC_ATOMIC_BUILTINS -- Performing Test HAVE_IB_GCC_ATOMIC_BUILTINS - Success -- Performing Test HAVE_IB_GCC_ATOMIC_BUILTINS_64 -- Performing Test HAVE_IB_GCC_ATOMIC_BUILTINS_64 - Success -- Performing Test HAVE_IB_ATOMIC_PTHREAD_T_GCC -- Performing Test HAVE_IB_ATOMIC_PTHREAD_T_GCC - Success -- Performing Test HAVE_IB_LINUX_FUTEX -- Performing Test HAVE_IB_LINUX_FUTEX - Success -- Looking for asprintf -- Looking for asprintf - found -- Check size of pthread_t -- Check size of pthread_t - done -- Performing Test HAVE_PEERCRED -- Performing Test HAVE_PEERCRED - Success -- Library mysqlclient depends on OSLIBS -lpthread;m;dl -- Googlemock was not found. gtest-based unit tests will be disabled. You can run cmake . -DENABLE_DOWNLOADS=1 to automatically download and build required components from source. -- If you are inside a firewall, you may need to use an http proxy: export http_proxy=http://foo.bar.com:80 Warning: Bison executable not found in PATH -- Library mysqlserver depends on OSLIBS -lpthread;m;crypt;dl -- Configuring done -- Generating done -- Build files have been written to: /home/marslo/Tools/Software/MySql/mysql-5.7.3-m13 Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/archive/ruby/rubyInstallationBySourceCode.html":{"url":"programming/archive/ruby/rubyInstallationBySourceCode.html","title":"ruby","keywords":"","body":" Yaml ruby Thanks Yaml download yaml lib installation download by wget $ wget http://pyyaml.org/download/libyaml/yaml-0.1.6.tar.gz $ tar xf yaml-0.1.6.tar.gz && cd yaml-0.1.6 compile and installation $ ./configure --prefix=/usr/local $ make && sudo make install ruby download official webiste current stable ruby 2.1.2 previous stable ruby 2.0.0-p481 old stable ruby 1.9.3-p547 ruby installation download by wget $ wget http://cache.ruby-lang.org/pub/ruby/2.1/ruby-2.1.2.tar.gz $ tar xf ruby-2.1.2.tar.gz && cd ruby-2.1.2 compile and install $ ./configure --prefix=/usr/local/ruby --enable-shared --with-opt-dir=/usr/local/lib $ make && sudo make install libs installation openssl$ cd ext/openssl $ ruby extconf.rb $ make && sudo make install Thanks collectiveidea.com Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"programming/archive/ruby/rubyInstallationQ&A.html":{"url":"programming/archive/ruby/rubyInstallationQ&A.html","title":"rubyInstallationQ&A","keywords":"","body":" openssl.h thread_native.h sqlite3.h libyaml-0.so.2 & psych.so openssl.h error description $ ruby extconf.rb ... checking for openssl/ssl.h... no ... solution [!TIP] Install openssl lib $ sudo apt-get intall libssl-dev $ dpkg -l | grep openssl ii libcurl3:amd64 7.35.0-1ubuntu2 amd64 easy-to-use client-side URL transfer library (OpenSSL flavour) ii libcurl4-openssl-dev:amd64 7.35.0-1ubuntu2 amd64 development files and documentation for libcurl (OpenSSL flavour) ii libgnutls-openssl27:amd64 2.12.23-12ubuntu2.1 amd64 GNU TLS library - OpenSSL wrapper ii openssl 1.0.1f-1ubuntu2.4 amd64 Secure Sockets Layer toolkit - cryptographic utility ii python-openssl 0.13-2ubuntu6 amd64 Python 2 wrapper around the OpenSSL library thread_native.h error description $ make make: *** No rule to make target `/thread_native.h`, needed by `ossl.o`. Stop. solution [!TIP] add top_srcdir=../.. into Makefile (the 63th line as below) $ grep top_srcdir Makefile -n 63: top_srcdir=../.. 279: ossl.o: $(top_srcdir)/thread_native.h $(top_srcdir)/thread_$(THREAD_MODEL).h sqlite3.h error description $ gem install vmail ... Fetching: sqlite3-1.3.9.gem Building native extensions. This could take a while... ERROR: Error installing vmail: ERROR: Failed to build gem native extension. /usr/local/ruby/bin/ruby extconf.rb checking for sqlite3.h... no sqlite3.h is missing. Try 'port install sqlite3 +universal', 'yum install sqlite-devel' or 'apt-get install libsqlite3-dev' and check your shared library search path (the location where you sqlite3 shared library is located). *** extconf.rb failed *** ... solution [!TIP] install libsqlite3-dev in Ubuntu as the error logged $ sudo apt-get install libsqlite3-dev libyaml-0.so.2 & psych.so error description $ gem install compass /usr/local/ruby/lib/ruby/2.1.0/yaml.rb:4:in `': It seems your ruby installation is missing psych (for YAML output). To eliminate this warning, please install libyaml and reinstall your ruby. /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require': libyaml-0.so.2: cannot open shared object file: No such file or directory - /usr/local/ruby/lib/ruby/2.1.0/x86_64-linux/psych.so (LoadError) from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/psych.rb:1:in `' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/yaml.rb:5:in `' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require' from /usr/local/ruby/lib/ruby/2.1.0/rubygems.rb:616:in `load_yaml' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/config_file.rb:328:in `load_file' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/config_file.rb:197:in `initialize' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/gem_runner.rb:74:in `new' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/gem_runner.rb:74:in `do_configuration' from /usr/local/ruby/lib/ruby/2.1.0/rubygems/gem_runner.rb:39:in `run' from /usr/local/ruby/bin/gem:21:in `' solution $ sudo apt-get install libyaml-dev Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"tools/node/gitbook.html":{"url":"tools/node/gitbook.html","title":"tools","keywords":"gitbook","body":" gitbook-cli installation initial book.json gitbook format hint tab code emoji plugins Flexible Alerts Q&A if (cb) cb.apply(this, arguments) TypeError [ERR_INVALID_ARG_TYPE] in git init unexpected token: . failed to install plugin \"codegroup\" reference: gitbook 简明教程 gitbook 入门教程 Gitbook 打造的 Gitbook 说明文档 基础命令 第一本电子书 book.json emoji gitbook howto gitbook 安装配置 GitBook插件整理 - book.json Gitbook常用插件简介 gitbook使用及book.json详细配置 GitBookによるドキュメント作成 useful plugins gitbook-plugin-fbqx alert: gitbook-plugin-alerts gitbook-plugin-flexible-alerts Anchors: gitbook-plugin-anchors gitbook-plugin-anchor-navigation-ex gitbook-plugin-back-to-top-button toggle-chapters: gitbook-plugin-chapter-fold gitbook-plugin-expandable-chapters code: gitbook-plugin-code gitbook-plugin-copy-code-button fold gitbook-plugin-expandable-chapters-small favicon gitbook-plugin-favicon github: gitbook-plugin-github gitbook-plugin-github-buttons Tbfed-pagefooter: gitbook-plugin-tbfed-pagefooter Prism: gitbook-plugin-prism search: gitbook-plugin-search-plus gitbook-plugin-search-pro Sectionx: gitbook-plugin-sectionx sharing: gitbook-plugin-sharing-plus Splitter: gitbook-plugin-splitter toc : gitbook-plugin-atoc gitbook-plugin-simple-page-toc versions-select: gitbook-plugin-versions-select others resources: FontAwesome Google Font Google Icon gitbook-cli installation install # mac $ brew install node # RHEL8 (https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-centos-8) $ sudo dnf module list nodejs $ sudo dnf module enable nodejs:12 $ sudo dnf install nodejs $ sudo npm i -g gitbook-cli [--save-dev] verify $ gitbook --version CLI version: 2.3.2 GitBook version: 3.2.3 check packages $ npm root -g /usr/local/lib/node_modules initial book.json gitbook install $ gitbook install info: installing 29 plugins using npm@3.9.2 info: info: installing plugin \"search-plus\" info: install plugin \"search-plus\" (^0.0.11) from NPM with version 0.0.11 /Users/marslo/mywork/tools/git/marslo/mbook └─┬ gitbook-plugin-search-plus@0.0.11 └── html-entities@1.2.0 .... gitbook install in fresh environment\" $ gitbook install --log=debug --debug Installing GitBook 3.2.3 SOLINK_MODULE(target) Release/.node CXX(target) Release/obj.target/fse/fsevents.o SOLINK_MODULE(target) Release/fse.node SOLINK_MODULE(target) Release/.node CXX(target) Release/obj.target/fse/fsevents.o SOLINK_MODULE(target) Release/fse.node gitbook@3.2.3 ../../var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/tmp-10600Rn1q3aFhRWiI/node_modules/gitbook ├── escape-html@1.0.3 ├── escape-string-regexp@1.0.5 ├── destroy@1.0.4 ├── ignore@3.1.2 ├── bash-color@0.0.4 ├── gitbook-plugin-livereload@0.0.1 ├── cp@0.2.0 ... alternatively $ gitbook serve Live reload server started on port: 35729 Press CTRL+C to quit ... info: 7 plugins are installed info: 31 explicitly listed Error: Couldn't locate plugins \"search-plus, simple-page-toc, github, github-buttons, prism, prism-themes, advanced-emoji, anchors, include-codeblock, ace, emphasize, katex, splitter, mermaid-gb3, tbfed-pagefooter, sectionx, local-video, anchor-navigation-ex, favicon, todo, alerts, include-csv, puml, sharing-plus, image-captions, donate, toggle-chapters, navigator, downloadpdf\", Run 'gitbook install' to install plugins from registry. gitbook install with proxy references: tbook install is not working when via proxy #33 Gitbook uses npmi, which requires npm-global, and npm-global further requires the currently installed npm on your machine. $ npm config set strict-ssl false $ npm config set proxy $http_proxy -g $ npm config set https-proxy $https_proxy -g gitbook format hint [!TIP] references: Alerts hints gitbook-plugin-flexible-alerts Simran-B/gitbook-plugin-callouts Hints and Callouts STYLES CODE GITBOOK-PLUGIN-FLEXIBLE-ALERTS info {% hint style='info' %} {% endhint %} > [!NOTE] tip {% hint style='tip' %} {% endhint %} > [!TIP] danger {% hint style='danger' %} {% endhint %} - warning {% hint style='warning' %} {% endhint %} > [!WARNING] success {% hint style='success' %} {% endhint %} - attention - > [!DANGER] success {% hint style='success' %} success {% endhint %} or via [!NOTE] [!NOTE] > [!NOTE] > tip > tip // or > [!NOTE|style:flat|label:title|iconVisibility:hidden|icon:fa fa-bullhorn] tip {% hint style='tip' %} info {% endhint %} or via [!TIP] [!TIP] > [!TIP] > tip > tip // or > [!TIP|style:flat|label:title|iconVisibility:hidden|icon:fa fa-bullhorn] danger {% hint style='danger' %} danger {% endhint %} or [!ATTENTION] [!ATTENTION] > [!ATTENTION] // or > [!ATTENTION|style:flat|label:title|iconVisibility:hidden|icon:fa fa-bullhorn] warning {% hint style='warning' %} warning {% endhint %} or [!WARNING] [!WARNING] > [!WARNING] // or > [!WARNING|style:flat|label:title|iconVisibility:hidden|icon:fa fa-bullhorn] quote Important info: this note needs to be highlighted {% hint style='info' %} **Important info**: this *note* needs to be highlighted {% endhint %} or [!COMMENT] [!COMMENT] > [!COMMENT] // or > [!COMMENT|style:flat|label:title|iconVisibility:hidden|icon:fa fa-bullhorn] tab [!TIP|style:flat|icon:fa fa-bullhorn] this function only for native gitbook.io example: imarslo: kubernetes certicates reference: -Templating code gitbook.io {% tabs %} {% tab title=\"bash\" %} {% code title=\"filename: bash.sh\" %} # bash {% endcode %} {% endtab %} {% tab title=\"python\" %} python {% endtab %} {% endtabs %} gitbook-plugin-codetabs {% codetabs name=\"this is bash\", type=\"bash\" -%} # type=\"bash\" {%- language name=\"this is python\", type=\"python\" -%} # type=\"python\" {%- endcodetabs %} emoji reference: gist Emoji broken & new emojis Emojis list from https://api.github.com/emojis emoji-cheat-sheet.com emoji code :joy: :u7981: :u7121: :white_check_mark: :four_leaf_clover: plugins Flexible Alerts [!TIP|label:references:] npm: docsify-plugin-flexible-alerts fzankl/docsify-plugin-flexible-alerts Gitbook book.json 配置文件 setup [!NOTE|style:callout|label:book.json|icon:fa fa-bullhorn] book.json: { \"plugins\": [ \"flexible-alerts\" ], \"pluginsConfig\": { \"flexible-alerts\": { \"style\": \"callout\", \"comment\": { \"label\": \"Comment\", \"icon\": \"fa fa-comments\", \"className\": \"info\" } } } } And then installed via $ gitbook install # or package.json: { \"scripts\": { \"built\": \"gitbook build --log=debug --debug\" } } $ npm run built usage > [!TIP|style:flat|label:My own heading|iconVisibility:hidden] > An alert of type 'tip' using alert specific style 'flat' which overrides global style 'callout'. > In addition, this alert uses an own heading and hides specific icon. Q&A if (cb) cb.apply(this, arguments) [!NOTE|style:callout] reference: How I fixed a \"cb.apply is not a function\" error while using Gitbook issue $ gitbook serve Live reload server started on port: 35729 Press CTRL+C to quit ... /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287 if (cb) cb.apply(this, arguments) ^ TypeError: cb.apply is not a function at /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287:18 solution: raw polyfills.js 62 fs.stat = statFix(fs.stat) 63 fs.fstat = statFix(fs.fstat) 64 fs.lstat = statFix(fs.lstat) fix polyfills.js 62 // fs.stat = statFix(fs.stat) 63 // fs.fstat = statFix(fs.fstat) 64 // fs.lstat = statFix(fs.lstat) TypeError [ERR_INVALID_ARG_TYPE] in git init issue $ gitbook init warn: no summary file in this book info: create README.md info: create SUMMARY.md TypeError [ERR_INVALID_ARG_TYPE]: The \"data\" argument must be of type string or an instance of Buffer, TypedArray, or DataView. Received an instance of Promise solution: downgrade the nodejs to 12.x.x purge nodejs$ brew uninstall node $ brew doctor $ brew cleanup --prune-prefix re-install node@12$ brew install node@12 $ brew link node@12 $ cat >> ~/.bash_profile unexpected token: . issue $ git serve ... unexpected token: . solution raw code '''bash $ k -n kube-system get pods \\ -o go-template \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' \\ | head ''' fixed code {% raw %} '''bash $ k -n kube-system get pods \\ -o go-template \\ --template '{{range .items}}{{.metadata.name}}{{\"\\n\"}}{{end}}' \\ | head ''' {% endraw %} failed to install plugin \"codegroup\" issue $ gitbook install info: installing plugin \"codegroup\" runTopLevelLifecycles → 3 ▄ ╢█████████████████████████████████████████████████████████████████████████████████████████████░░░╟ fetchMetadata → request ▀ ╢█████████████████████████████████████████████████████████████████████████████████████████░░░░░░░╟ /Users/marslo/.gitbook/versions/3.2.3/node_modules/npm/node_modules/aproba/index.js:25 if (args[ii] == null) throw missingRequiredArg(ii) solution $ gitbook install # expecting failure $ npm i gitbook-plugin-codegroup@2.3.5 npm WARN old lockfile npm WARN old lockfile The package-lock.json file was created with an old version of npm, npm WARN old lockfile so supplemental metadata must be fetched from the registry. npm WARN old lockfile npm WARN old lockfile This is a one-time fix-up, please be patient... npm WARN old lockfile added 41 packages, and audited 168 packages in 3s 3 packages are looking for funding run `npm fund` for details 20 vulnerabilities (6 moderate, 8 high, 6 critical) To address all issues possible (including breaking changes), run: npm audit fix --force Some issues need review, and may require choosing a different dependency. Run `npm audit` for details. $ gitbook install Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 20:35:42 "},"tools/fonts.html":{"url":"tools/fonts.html","title":"fonts","keywords":"","body":" highly recommended Monaco RecMonoCasual Comic Mono Gohu nerd-fonts pixel hand-writing symbole others powerline fonts [!TIP] * 142 Programming Fonts * arrowtype/recursive Patch Fonts with Cursive Italic Styles sainnhe/icursive-nerd-font | sainnhe/mono-nerd-font INPUT™ fonts Consolas font family ryanoasis/nerd-fonts ryanoasis/powerline-extra-symbols ArrowType highly recommended Monaco [!NOTE] THE BEST ALWAYS ! Monaco MonacoNF RecMonoCasual $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/arrowtype/recursive/raw/main/fonts/ArrowType-Recursive-1.085/Recursive_Code/RecMonoCasual/RecMonoCasual-Regular-1.085.ttf && $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/arrowtype/recursive/raw/main/fonts/ArrowType-Recursive-1.085/Recursive_Code/RecMonoDuotone/RecMonoDuotone-Regular-1.085.ttf && $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/arrowtype/recursive/raw/main/fonts/ArrowType-Recursive-1.085/Recursive_Code/RecMonoLinear/RecMonoLinear-Regular-1.085.ttf && $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/arrowtype/recursive/blob/main/fonts/ArrowType-Recursive-1.085/Recursive_Code/RecMonoSemicasual/RecMonoSemicasual-Regular-1.085.ttf && fc-cache -f -v # or $ version=1.085 $ url='https://github.com/arrowtype/recursive/blob/main/fonts/ArrowType-Recursive-1.085/Recursive_Code/' $ while read -r _t; do curl --create-dirs -O --output-dir \"${fontsPath}\" \\ \"${url}\"/\"RecMono${_t}/RecMono${_t}-Regular-1.085.ttf\" done Comic Mono [!NOTE|label:references:] knolljo/comic-mono-nerd Comic Mono Comic Mono for NF or here Gohu $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/Gohu/uni-14/GohuFontuni14NerdFontMono-Regular.ttf && $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/Gohu/uni-11/GohuFontuni11NerdFontMono-Regular.ttf && $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/Gohu/14/GohuFont14NerdFontMono-Regular.ttf && $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/Gohu/11/GohuFont11NerdFontMono-Regular.ttf && fc-cache -f -v nerd-fonts [!NOTE|label:refereces:] download Karmenzind/monaco-nerd-fonts xtevenx/ComicMonoNF AgaveNerdFontMono $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/Agave/AgaveNerdFontMono-Regular.ttf && fc-cache -f -v CodeNewRoman another Monaco $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/CodeNewRoman/Regular/CodeNewRomanNerdFontMono-Regular.otf && fc-cache -f -v DejaVuSansMono another Monaco $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/DejaVuSansMono/Regular/DejaVuSansMNerdFontMono-Regular.ttf && fc-cache -f -v pixel BigBlueTerminal$ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/BigBlueTerminal/BigBlueTerm437NerdFontMono-Regular.ttf && fc-cache -f -v hand-writing Monofur $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/Monofur/Regular/MonofurNerdFontMono-Regular.ttf && fc-cache -f -v ComicShannsMono $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/ComicShannsMono/ComicShannsMonoNerdFontMono-Regular.otf && fc-cache -f -v DaddyTimeMono $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/DaddyTimeMono/DaddyTimeMonoNerdFontMono-Regular.ttf && fc-cache -f -v FantasqueSansMono $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/FantasqueSansMono/Regular/FantasqueSansMNerdFontMono-Regular.ttf && fc-cache -f -v Hermit $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/Hermit/Regular/HurmitNerdFontMono-Regular.otf && fc-cache -f -v symbole NerdFontsSymbolsOnly$ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/NerdFontsSymbolsOnly/SymbolsNerdFontMono-Regular.ttf && fc-cache -f -v others CascadiaCode EnvyCodeR IBMPlexMono powerline fonts [!NOTE|label:references:] Comic Mono font Showing special Unicode characters on MacOS GNU Unifont Glyphs * lujiacn/Monaco for Powerline.md Monaco for Powerline.ttf * supermarin/powerline-fonts Monaco for Powerline.otf Menlo Regular for Powerline.otf DejaVu Sans Mono for Powerline.otf * powerline/fonts ~ AnwarShah/fonts Monofur for Powerline.ttf * Twixes/SF-Mono-Powerline * benbusby/anomaly-mono yumitsu/font-menlo-extra ithewei/powerline-fonts JayXon/powerline-web-fonts github topic: powerline-fonts ryanoasis/nerd-fonts Powerline Fonts windows Change font for non-legacy command prompt in Windows 10 with non-ASCII charset - Properties vs default values? gdetrez/powerline-test.sh install via package tool # debian $ sudo apt-get install fonts-powerline # centos/rhel $ sudo dnf install powerline-fonts install via cmd [!TIP|label:fonts path in different system:] linux: $HOME/.local/share/fonts osx : $HOME/Library/Fonts$ fontPath=$HOME/Library/Fonts $ fontPath=$HOME/.local/share/fonts via powershell > Invoke-WebRequest -Uri \"https://dtinth.github.io/comic-mono-font/ComicMono.ttf\" -OutFile \"ComicMono.ttf\"; Invoke-WebRequest -Uri \"https://dtinth.github.io/comic-mono-font/ComicMono-Bold.ttf\" -OutFile \"ComicMono-Bold.ttf\"; $fonts = (New-Object -ComObject Shell.Application).Namespace(0x14); Get-ChildItem -include ComicMono* | % { $fonts.CopyHere($_.fullname) } cominc mono && comic mono for powerline # regular $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://dtinth.github.io/comic-mono-font/ComicMono.ttf && curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://dtinth.github.io/comic-mono-font/ComicMono-Bold.ttf && fc-cache -f -v # for powerline/vim-airline $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/marslo/mytools/raw/master/others/fonts/monospace/Comic-Mono-for-Powerline.ttf && fc-cache -f -v monaco for powerline osx version && monaco for powerline windows version $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/marslo/mytools/raw/master/others/fonts/monospace/Monaco-for-Powerline.otf && fc-cache -f -v menlo for powerline $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/marslo/mytools/raw/master/others/fonts/monospace/Menlo-Regular.ttf && fc-cache -f -v monofur for powerline $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/powerline/fonts/raw/master/Monofur/Monofur%20for%20Powerline.ttf && curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/powerline/fonts/raw/master/Monofur/Monofur%20Italic%20for%20Powerline.ttf && curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/powerline/fonts/raw/master/Monofur/Monofur%20Bold%20for%20Powerline.ttf && fc-cache -f -v sf-mono for powerline $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/Twixes/SF-Mono-Powerline/raw/master/SF-Mono-Powerline-Regular.otf && curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/Twixes/SF-Mono-Powerline/raw/master/SF-Mono-Powerline-RegularItalic.otf && curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/Twixes/SF-Mono-Powerline/raw/master/SF-Mono-Powerline-Bold.otf && curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/Twixes/SF-Mono-Powerline/raw/master/SF-Mono-Powerline-BoldItalic.otf && fc-cache -f -v anomaly mono for powerline $ curl --create-dirs -O --output-dir \"${fontsPath}\" \\ https://github.com/benbusby/anomaly-mono/raw/master/AnomalyMono-Powerline.otf && fc-cache -f -v Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-08 17:16:58 "},"tools/css.html":{"url":"tools/css.html","title":"html & css","keywords":"","body":" stylus tricky bootstrap using boostrap sytles alert bootstrap alert callout kbd border padding border-style font selector attribute selectors references [!NOTE|label:references:] Buttons hover me stylus [!TIP|label:references:] * marslo/global-fonts | * global fonts ( marslo ) | click to install * marslo/google-gruvbox | * gruvbox google ( marslo ) | click to install * userstyle.org: marslo Google - Clean Dark (marslo) Kubernetes.io Dark theme (marslo) New Dev's Dark StackOverflow (marslo) GitHub Ice Dark (marslo) touhidulshawan/gruvbox-google Factral/GoogleTranslateDarkTheme Google Translate Dark Theme But better google-gruvbox | google gruvbox font-ubuntu | marslo ( ubuntu ) gerrit comments: tricky :not(a[class*=\"btn\"]) == :is(a:not([class*=\"btn\"]) i.e.:h2 > :not(a[class*=\"btn\"]), h2 > :is(a:not([class*=\"btn\"]), bootstrap references: CSS: Cascading Style Sheets bootstrap.min.css 4.x bootstrap.min.css 5.x Bootstrap Alerts docs.min.css bootstrap components bootstrap utilities bootstrap colors The Curious Case of the Slow Jenkins Job Jekyll Doc Theme 6.0: Alert using boostrap sytles [!NOTE|style:callout] bootstrap 4.x bootstap 5.x 4.x Hello, world! Hello, world! 5.x original bootstrap 5.x alert Hello, world! alert references: The Curious Case of the Slow Jenkins Job Jekyll Doc Theme 6.0: Alert bootstrap alert bootstrap alert 4.x bootstrap alert 5.x .alert{ --bs-alert-bg:transparent;--bs-alert-padding-x:1rem;--bs-alert-padding-y:1rem;--bs-alert-margin-bottom:1rem;--bs-alert-color:inherit;--bs-alert-border-color:transparent;--bs-alert-border:1px solid var(--bs-alert-border-color);--bs-alert-border-radius:0.375rem;position:relative;padding:var(--bs-alert-padding-y) var(--bs-alert-padding-x);margin-bottom:var(--bs-alert-margin-bottom);color:var(--bs-alert-color);background-color:var(--bs-alert-bg);border:var(--bs-alert-border);border-radius:var(--bs-alert-border-radius) } .alert-heading{ color:inherit } .alert-link{ font-weight:700 } .fade{ transition:opacity .15s linear } .fade:not(.show){ opacity:0 } .btn-close{ box-sizing:content-box;width:1em;height:1em;padding:.25em .25em;color:#000;background:transparent url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 0 1 1.414 0L8 6.586 14.293.293a1 1 0 1 1 1.414 1.414L9.414 8l6.293 6.293a1 1 0 0 1-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L6.586 8 .293 1.707a1 1 0 0 1 0-1.414z'/%3e%3c/svg%3e\") center/1em auto no-repeat;border:0;border-radius:.375rem;opacity:.5 } .btn-close:hover{ color:#000;text-decoration:none;opacity:.75 } .btn-close:focus{ outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25);opacity:1 } .btn-close.disabled,.btn-close:disabled{ pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;opacity:.25 } .btn-close-white{ filter:invert(1) grayscale(100%) brightness(200%) } .alert-dismissible{ padding-right:3rem } .alert-dismissible .btn-close{ position:absolute;top:0;right:0;z-index:2;padding:1.25rem 1rem } .alert-primary{ --bs-alert-color:#084298;--bs-alert-bg:#cfe2ff;--bs-alert-border-color:#b6d4fe } .alert-primary .alert-link{ color:#06357a } .alert-secondary{ --bs-alert-color:#41464b;--bs-alert-bg:#e2e3e5;--bs-alert-border-color:#d3d6d8 } .alert-secondary .alert-link{ color:#34383c } .alert-success{ --bs-alert-color:#0f5132;--bs-alert-bg:#d1e7dd;--bs-alert-border-color:#badbcc } .alert-success .alert-link{ color:#0c4128 } .alert-info{ --bs-alert-color:#055160;--bs-alert-bg:#cff4fc;--bs-alert-border-color:#b6effb } .alert-info .alert-link{ color:#04414d } .alert-warning{ --bs-alert-color:#664d03;--bs-alert-bg:#fff3cd;--bs-alert-border-color:#ffecb5 } .alert-warning .alert-link{ color:#523e02 } .alert-danger{ --bs-alert-color:#842029;--bs-alert-bg:#f8d7da;--bs-alert-border-color:#f5c2c7 } .alert-danger .alert-link{ color:#6a1a21 } .alert-light{ --bs-alert-color:#636464;--bs-alert-bg:#fefefe;--bs-alert-border-color:#fdfdfe } .alert-light .alert-link{ color:#4f5050 } .alert-dark{ --bs-alert-color:#141619;--bs-alert-bg:#d3d3d4;--bs-alert-border-color:#bcbebf } .alert-dark .alert-link{ color:#101214 } template X Alert ! This is a x alert with an example link. Give it a click if you like. :root{ --bs-blue:#0d6efd; --bs-indigo:#6610f2; --bs-purple:#6f42c1; --bs-pink:#d63384; --bs-red:#dc3545; --bs-orange:#fd7e14; --bs-yellow:#ffc107; --bs-green:#198754; --bs-teal:#20c997; --bs-cyan:#0dcaf0; --bs-black:#000; --bs-white:#fff; --bs-gray:#6c757d; --bs-gray-dark:#343a40; --bs-gray-100:#f8f9fa; --bs-gray-200:#e9ecef; --bs-gray-300:#dee2e6; --bs-gray-400:#ced4da; --bs-gray-500:#adb5bd; --bs-gray-600:#6c757d; --bs-gray-700:#495057; --bs-gray-800:#343a40; --bs-gray-900:#212529; --bs-primary:#0d6efd; --bs-secondary:#6c757d; --bs-success:#198754; --bs-info:#0dcaf0; --bs-warning:#ffc107; --bs-danger:#dc3545; --bs-light:#f8f9fa; --bs-dark:#212529; --bs-primary-rgb:13,110,253; --bs-secondary-rgb:108,117,125; --bs-success-rgb:25,135,84; --bs-info-rgb:13,202,240; --bs-warning-rgb:255,193,7; --bs-danger-rgb:220,53,69; --bs-light-rgb:248,249,250; --bs-dark-rgb:33,37,41; --bs-white-rgb:255,255,255; --bs-black-rgb:0,0,0; --bs-body-color-rgb:33,37,41; --bs-body-bg-rgb:255,255,255; --bs-font-sans-serif:system-ui,-apple-system,\"Segoe UI\",Roboto,\"Helvetica Neue\",\"Noto Sans\",\"Liberation Sans\",Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\",\"Noto Color Emoji\"; --bs-font-monospace:SFMono-Regular,Menlo,Monaco,Consolas,\"Liberation Mono\",\"Courier New\",monospace; --bs-gradient:linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0)); --bs-body-font-family:var(--bs-font-sans-serif); --bs-body-font-size:1rem; --bs-body-font-weight:400; --bs-body-line-height:1.5; --bs-body-color:#212529; --bs-body-bg:#fff; --bs-border-width:1px; --bs-border-style:solid; --bs-border-color:#dee2e6; --bs-border-color-translucent:rgba(0, 0, 0, 0.175); --bs-border-radius:0.375rem; --bs-border-radius-sm:0.25rem; --bs-border-radius-lg:0.5rem; --bs-border-radius-xl:1rem; --bs-border-radius-2xl:2rem; --bs-border-radius-pill:50rem; --bs-link-color:#0d6efd; --bs-link-hover-color:#0a58ca; --bs-code-color:#d63384; --bs-highlight-bg:#fff3cd } .alert{ position:relative; padding:.75rem 1.25rem; margin-bottom:1rem; border:1px solid transparent; border-radius:.25rem } .alert-heading{ color:inherit } .alert-link{ font-weight:700 } .alert-dismissible{ padding-right:4rem } .alert-dismissible .close{ position:absolute; top:0; right:0; padding:.75rem 1.25rem; color:inherit } .alert-primary{ color:#004085; background-color:#cce5ff; border-color:#b8daff } .alert-primary hr{ border-top-color:#9fcdff } .alert-primary .alert-link{ color:#002752 } .alert-secondary{ color:#383d41; background-color:#e2e3e5; border-color:#d6d8db } .alert-secondary hr{ border-top-color:#c8cbcf } .alert-secondary .alert-link{ color:#202326 } .alert-success{ color:#155724; background-color:#d4edda; border-color:#c3e6cb } .alert-success hr{ border-top-color:#b1dfbb } .alert-success .alert-link{ color:#0b2e13 } .alert-info{ color:#0c5460; background-color:#d1ecf1; border-color:#bee5eb } .alert-info hr{ border-top-color:#abdde5 } .alert-info .alert-link{ color:#062c33 } .alert-warning{ color:#856404; background-color:#fff3cd; border-color:#ffeeba } .alert-warning hr{ border-top-color:#ffe8a1 } .alert-warning .alert-link{ color:#533f03 } .alert-danger{ color:#721c24; background-color:#f8d7da; border-color:#f5c6cb } .alert-danger hr{ border-top-color:#f1b0b7 } .alert-danger .alert-link{ color:#491217 } .alert-light{ color:#818182; background-color:#fefefe; border-color:#fdfdfe } .alert-light hr{ border-top-color:#ececf6 } .alert-light .alert-link{ color:#686868 } .alert-dark{ color:#1b1e21; background-color:#d6d8d9; border-color:#c6c8ca } .alert-dark hr{ border-top-color:#b9bbbe } .alert-dark .alert-link{ color:#040505 } template X Alter ! This is a x alert with an example link. Give it a click if you like. warning 5.x Warning Alert ! This is a warning alert with an example link. Give it a click if you like. original Warning Alert ! This is a warning alert with an example link. Give it a click if you like. 4.x Warning Alert ! This is a warning alert with an example link. Give it a click if you like. Warning Alert ! This is a warning alert with an example link. Give it a click if you like. original Warning Alert ! This is a warning alert with an example link. Give it a click if you like. success 5.x Success Alert ! This is a success alert with an example link. Give it a click if you like. original Success Alert ! This is a success alert with an example link. Give it a click if you like. 4.x Success Alert ! This is a success alert with an example link. Give it a click if you like. Success Alert ! This is a success alert with an example link. Give it a click if you like. original Success Alert ! This is a success alert with an example link. Give it a click if you like. danger 5.x Danger Alert ! This is a danger alert with an example link. Give it a click if you like. original Danger Alert ! This is a danger alert with an example link. Give it a click if you like. 4.x Danger Alter ! This is a danger alert with an example link. Give it a click if you like. Danger Alert ! This is a danger alert with an example link. Give it a click if you like. original Danger Alert ! This is a danger alert with an example link. Give it a click if you like. primary 5.x Primary Alert ! This is a primary alert with an example link. Give it a click if you like. original Primary Alert ! This is a primary alert with an example link. Give it a click if you like. 4.x Primary Alert ! This is a primary alert with an example link. Give it a click if you like. Primary Alert ! This is a primary alert with an example link. Give it a click if you like. original Primary Alert ! This is a primary alert with an example link. Give it a click if you like. info 5.x Info Alert ! This is a info alert with an example link. Give it a click if you like. original Info Alert ! This is a info alert with an example link. Give it a click if you like. 4.x Info Alter ! This is a info alert with an example link. Give it a click if you like. Info Alert ! This is a info alert with an example link. Give it a click if you like. original Info Alert ! This is a info alert with an example link. Give it a click if you like. callout references: \"Bootstrap Calllouts\" Bootstrap Callouts mikeblum/callout.css docs.min.css Callouts How TO - Callout Message callout .bd-callout { padding: 1.25rem; margin-top: 1.25rem; margin-bottom: 1.25rem; border: 1px solid #eee; border-left-width: .25rem; border-radius: .25rem } .bd-callout h4 { margin-top: 0; margin-bottom: .25rem } .bd-callout p:last-child { margin-bottom: 0 } .bd-callout code { border-radius: .25rem } .bd-callout+.bd-callout { margin-top: -.25rem } .bd-callout-info { border-left-color: #5bc0de } .bd-callout-info h4 { color: #5bc0de } .bd-callout-warning { border-left-color: #f0ad4e } .bd-callout-warning h4 { color: #f0ad4e } .bd-callout-danger { border-left-color: #d9534f } .bd-callout-danger h4 { color: #d9534f } .bd-callout-primary{ border-left-color: #007bff } .bd-callout-primary h4 { color: #007bff } .bd-callout-success{ border-left-color: #28a745 } .bd-callout-success h4 { color: #28a745 } .bd-callout-default{ border-left-color: #6c757d } .bd-callout-default h4 { color: #6c757d } default Default Callout This is a default callout. original Default Callout This is a default callout. primary Primary Callout This is a primary callout. original Primary Callout This is a primary callout. warning Warning Callout This is a warning callout. original Warning Callout This is a warning callout. danger Danger Callout This is a danger callout. original Danger Callout This is a danger callout. succeed Succeed Callout This is a succeed callout. original Success Callout This is a success callout. info Info Callout This is info callout. original Info Callout This is an info callout. kbd references: Nice effect with the KBD tag keyscss/keys.css Styling the kbd element kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; border-radius: 3px; border: 1px solid #ccc; color: #333; line-height: 1.4; font-size: 12px; display: inline-block; box-shadow: 0px 1px 0px rgba(0,0,0,0.2), inset 0px 0px 0px 2px #ffffff; background-color: rgb(247, 247, 247); text-shadow: 0 1px 0 #fff; -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2), 0 0 0 2px #ffffff inset; -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2), 0 0 0 2px #ffffff inset; -moz-border-radius: 3px; -webkit-border-radius: 3px; } bootstrap kbd kbd { font-family:SFMono-Regular,Menlo,Monaco,Consolas,\"Liberation Mono\",\"Courier New\",monospace; font-size:1em; padding:.2rem .4rem; font-size:87.5%; color:#fff; background-color:#212529; border-radius:.2rem } kbd kbd { padding:0; font-size:100%; font-weight:700; } or kbd { padding: 2px 4px; font-size: 90%; color: #fff; background-color: #333; border-radius: 3px; -webkit-box-shadow: inset 0 -1px 0 rgb(0 0 0 / 25%); box-shadow: inset 0 -1px 0 rgb(0 0 0 / 25%); } or for html button click me border [!NOTE|label:references:] padding border-* border-style CSS Borders padding /* + top, right, bottom, left */ padding: 1px; /* + top, bottom */ /* | + right, left */ padding: 1px 2px; /* + top */ /* | + right, left */ /* | | + bottom */ padding: 1px 2px 3px; /* + top */ /* | + right */ /* | | + bottom */ /* | | | + left */ padding: 1px 2px 3px 4px; border-style /* + top, right, bottom, left */ border-style: dotted; /* + top, bottom */ /* | + right, left */ border-style: dotted dashed; /* + top */ /* | + right, left */ /* | | + bottom */ border-style: dotted dashed solid; /* + top */ /* | + right */ /* | | + bottom */ /* | | | + left */ border-style: dotted dashed solid groove; font references: best fonts for developer Monaco Comic Mono Comic Shanns Cascadia Code monofur Andale Mono Menlo Ubuntu Mono Consolas find fonts via image WhatTheFont Font font matcherator Identify Fonts font finder selector [!TIP|references:references] references: CSS 属性选择器详解 Attribute selectors CSS Selector Reference CSS selectors Basic selectors Class selector : .name ID selectors : #name Attribute selector : [attr], [attr=value], [attr~=value], [attr|=value], [attr^=value], [attr$=value], [attr*=value] Grouping selectors Combinators Child combinator: ul > li General sibling combinator: p ~ span Adjacent sibling combinator: h2 + p Column combinator: col || td Pseudo elements: p::first-line Pseudo-classes and pseudo-elements Structure of a selector [Pseudo-classes] (https://developer.mozilla.org/en-US/docs/Web/CSS/Pseudo-classes) Tree-structural pseudo-classes :root :first-child :last-child User action pseudo-classes :hover :active Functional pseudo-classes :is() :not() :where() :has() attribute selectors [attr] : Represents elements with an attribute name of attr. [attr=value] : Represents elements with an attribute name of attr whose value is exactly value. [attr~=value] : Represents elements with an attribute name of attr whose value is a whitespace-separated list of words, one of which is exactly value. [attr|=value] : Represents elements with an attribute name of attr whose value can be exactly value or can begin with value immediately followed by a hyphen, - (U+002D). It is often used for language subcode matches. [attr^=value] : Represents elements with an attribute name of attr whose value is prefixed (preceded) by value. [attr$=value] : Represents elements with an attribute name of attr whose value is suffixed (followed) by value. [attr*=value] : Represents elements with an attribute name of attr whose value contains at least one occurrence of value within the string. example Internal link Example link Insensitive internal link Example org link Example https org link a { color: blue; } /* Internal links, beginning with \"#\" */ a[href^=\"#\"] { background-color: gold; } /* Links with \"example\" anywhere in the URL */ a[href*=\"example\"] { background-color: silver; } /* Links with \"insensitive\" anywhere in the URL, regardless of capitalization */ a[href*=\"insensitive\" i] { color: cyan; } /* Links with \"cAsE\" anywhere in the URL, with matching capitalization */ a[href*=\"cAsE\" s] { color: pink; } /* Links that end in \".org\" */ a[href$=\".org\"] { color: red; } /* Links that start with \"https\" and end in \".org\" */ a[href^=\"https\"][href$=\".org\"] { color: green; } another example sample code.dh-tl-tl {} .dh-tl-tr {} .dh-tl-br {} .dh-tl-bl {} .dh-tr-tl {} ... .dh-br-tl {} ... .dh-bl-tl {} ... elegant way[class^=\"dh-\"][class$=\"-tl\"] { color: red; } [class^=\"dh\"][class$=\"-tr\"] { color: orange; } [class^=\"dh\"][class$=\"-bl\"] { color: green; } [class^=\"dh\"][class$=\"-br\"] { color: blue; } references SELECTOR EXAMPLE EXAMPLE DESCRIPTION .class .intro Selects all elements with class=\"intro\" .class1.class2 .name1.name2 Selects all elements with both name1 and name2 set within its class attribute .class1 .class2 .name1 .name2 Selects all elements with name2 that is a descendant of an element with name1 #id #firstname Selects the element with id=\"firstname\" * * Selects all elements element p Selects all elements element.class p.intro Selects all elements with class=\"intro\" element,element div, p Selects all elements and all elements element element div p Selects all elements inside elements element>element div > p Selects all elements where the parent is a element element+element div + p Selects the first element that is placed immediately after elements element1~element2 p ~ ul Selects every element that is preceded by a element [attribute] [target] Selects all elements with a target attribute [attribute=value] [target=_blank] Selects all elements with target=\"_blank\" [attribute~=value] [title~=flower] Selects all elements with a title attribute containing the word \"flower\" [attribute∣=value] [lang∣=en] Selects all elements with a lang attribute value equal to \"en\" or starting with \"en-\" [attribute^=value] a[href^=\"https\"] Selects every element whose href attribute value begins with \"https\" [attribute$=value] a[href$=\".pdf\"] Selects every element whose href attribute value ends with \".pdf\" [attribute*=value] a[href*=\"w3schools\"] Selects every element whose href attribute value contains the substring \"w3schools\" :active a:active Selects the active link ::after p::after Insert something after the content of each element ::before p::before Insert something before the content of each element :checked input:checked Selects every checked element :default input:default Selects the default element :disabled input:disabled Selects every disabled element :empty p:empty Selects every element that has no children (including text nodes) :enabled input:enabled Selects every enabled element :first-child p:first-child Selects every element that is the first child of its parent ::first-letter p::first-letter Selects the first letter of every element ::first-line p::first-line Selects the first line of every element :first-of-type p:first-of-type Selects every element that is the first element of its parent :focus input:focus Selects the input element which has focus :fullscreen :fullscreen Selects the element that is in full-screen mode :hover a:hover Selects links on mouse over :in-range input:in-range Selects input elements with a value within a specified range :indeterminate input:indeterminate Selects input elements that are in an indeterminate state :invalid input:invalid Selects all input elements with an invalid value :lang(language) p:lang(it) Selects every element with a lang attribute equal to \"it\" (Italian) :last-child p:last-child Selects every element that is the last child of its parent :last-of-type p:last-of-type Selects every element that is the last element of its parent :link a:link Selects all unvisited links ::marker ::marker Selects the markers of list items :not(selector) :not(p) Selects every element that is not a element :nth-child(n) p:nth-child(2) Selects every element that is the second child of its parent :nth-last-child(n) p:nth-last-child(2) Selects every element that is the second child of its parent, counting from the last child :nth-last-of-type(n) p:nth-last-of-type(2) Selects every element that is the second element of its parent, counting from the last child :nth-of-type(n) p:nth-of-type(2) Selects every element that is the second element of its parent :only-of-type p:only-of-type Selects every element that is the only element of its parent :only-child p:only-child Selects every element that is the only child of its parent :optional input:optional Selects input elements with no \"required\" attribute :out-of-range input:out-of-range Selects input elements with a value outside a specified range ::placeholder input::placeholder Selects input elements with the \"placeholder\" attribute specified :read-only input:read-only Selects input elements with the \"readonly\" attribute specified :read-write input:read-write Selects input elements with the \"readonly\" attribute NOT specified :required input:required Selects input elements with the \"required\" attribute specified :root :root Selects the document's root element ::selection ::selection Selects the portion of an element that is selected by a user :target #news:target Selects the current active #news element (clicked on a URL containing that anchor name) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"tools/atlassian.html":{"url":"tools/atlassian.html","title":"Jira & Confluence","keywords":"","body":" jira check fields check attachment generate OAuth consumer icons confluence get info publish to confluence plugins reference: * Confluence REST API examples * Jira REST API examples Confluence Server REST API ./software/jira/docs/api/REST JIRA Server platform REST API reference Jenkins JIRA Pipeline Steps Configuration Authentication Common Config Jenkins Script Configuration As Code Plugin Issue Steps jiraGetFields jiraGetIssue jiraEditIssue Component Steps jiraGetComponent jiraEditComponent jiraGetComponentIssueCount Comment Steps jiraGetComment jiraGetComments jiraAddComment jiraEditComment jira $ jiraName='my.jira.com' $ jiraID='STORY-1' check fields $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID} | jq --raw-output check attachment check attachment ID $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID}?fields=attachment | jq --raw-output .fields.attachment[].id get attachments download url $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID}?fields=attachment | jq --raw-output .fields.attachment[].content download all attachments in Jira -I replace-str Replace occurrences of replace-str in the initial-arguments with names read from standard in- put. Also, unquoted blanks do not terminate input items; instead the separator is the new- line character. Implies -x and -L 1. $ curl -s \\ -k \\ -X GET https://${jiraName}/rest/api/2/issue/${jiraID}?fields=attachment | jq --raw-output .fields.attachment[].content | xargs -I '{}' curl -sgOJL '{}' generate OAuth consumer $ openssl genrsa -out jira_privatekey.pem 1024 $ openssl req -newkey rsa:1024 -x509 -key jira_privatekey.pem -out jira_publickey.cer -days 365 $ openssl pkcs8 -topk8 -nocrypt -in jira_privatekey.pem -out jira_privatekey.pcks8 $ openssl x509 -pubkey -noout -in jira_publickey.cer > jira_publickey.pem icons priority [!NOTE|label:references:] how do I view ALL icons for priority AlexanderBartash/JIRA-Priority-Icons DevOps Use case: Jira Jenkins Integration $ for _i in \"blocker.png\" \"blocker.svg\" \"critical.png\" \"critical.svg\" \"high.png\" \"high.svg\" \"highest.png\" \"highest.svg\" \"low.png\" \"low.svg\" \"lowest.png\" \"lowest.svg\" \"major.png\" \"major.svg\" \"medium.png\" \"medium.svg\" \"minor.png\" \"minor.svg\" \"trivial.png\" \"trivial.svg\"; do echo \"--> ${_i}\" curl -O https://jira-trigger-plugin.atlassian.net/images/icons/priorities/${_i} done confluence $ confluenceName='my.confluence.com' $ pageID='143765713' get page id: get info $ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq --raw-output get space$ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .space.key get title$ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .title get page history $ curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .version.number get next versioncurrentVer=$(curl -s -X GET https://${confluenceName}/rest/api/content/${pageID} | jq .version.number) newVer=$((currentVer+1)) publish to confluence sample script $ url=\"https://${confluenceName}/rest/api/content/${pageID}\" $ page=$(curl -s ${url}) $ space=$(echo \"${page}\" | jq .space.key) $ title=$(echo \"${page}\" | jq .title) $ currentVer=$(echo \"${page}\" | jq .version.number) $ newVer=$((currentVer+1)) $ cat > a.json Hi confluence\", \"representation\": \"storage\" } }, \"version\": {\"number\":${newVer}} } EOF $ curl -s \\ -i \\ -X PUT \\ -H 'Content-Type: application/json' \\ --data \"$(cat a.json)\" \\ https://${confluenceName}/rest/api/content/${pageID} result plugins Multiexcerpt create excerpt include excerpt result Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"tools/node/node.html":{"url":"tools/node/node.html","title":"node & npm","keywords":"","body":" npm configuration registry completion npm usage upgrade npm packages view details purge macOS tips nvm hogo loveit Q&A empty of npm ls -g env: node: No such file or directory reference: package.json NodeJs Quick Start npm configuration registry $ npm config -g set registry https://registry.npm.taobao.org $ npm config -g get registry https://registry.npm.taobao.org/ default: $ npm config get registry https://registry.npmjs.org/ $ npm config -g get registry https://registry.npmjs.org/ completion via npm $ command -v npm > /dev/null && source /dev/null && eval $(npm completion) via Jephuff/npm-completionhttps://github.com/Jephuff/npm-completion $ npm i -g npm-completion # for windows $ npm i -g npm-completion@windows $ npm-completion-setup $ npm-completion-upgrade config# https://github.com/Jephuff/npm-bash-completion $ NPM_COMPLETION_PATH=\"/usr/local/lib/node_modules/npm-completion\" $ test -f \"${NPM_COMPLETION_PATH}/npm-completion.sh\" && source \"${NPM_COMPLETION_PATH}/npm-completion.sh\" npm usage upgrade $ npm install -g npm-check-updates $ ncu -u or $ npm outdated -g --depth=0 Package Current Wanted Latest Location react-sticky 5.0.8 5.0.8 6.0.3 global $ npm update -g react-sticky npm packages view details $ npm view example $ npm view gitbook-cli gitbook-cli@2.3.2 | Apache-2.0 | deps: 11 | versions: 21 CLI to generate books and documentation using gitbook https://www.gitbook.com bin: gitbook dist .tarball: https://registry.npm.taobao.org/gitbook-cli/download/gitbook-cli-2.3.2.tgz .shasum: 5e893582e1f743f6fa920c3c3eb36b62ea4a31a0 dependencies: bash-color: 0.0.4 fs-extra: 3.0.1 npm: 5.1.0 optimist: 0.6.1 semver: 5.3.0 user-home: 2.0.0 commander: 2.11.0 lodash: 4.17.4 npmi: 1.0.1 q: 1.5.0 tmp: 0.0.31 maintainers: - aymeric-gb - gitbook-bot - jpreynat - samypesse dist-tags: latest: 2.3.2 published over a year ago by aarono purge macOS reference: uninstall node js from mac sudo rm -rf ~/.npm ~/.nvm ~/node_modules ~/.node-gyp ~/.npmrc ~/.node_repl_history sudo rm -rf /usr/local/bin/npm /usr/local/bin/node-debug /usr/local/bin/node /usr/local/bin/node-gyp sudo rm -rf /usr/local/share/man/man1/node* /usr/local/share/man/man1/npm* sudo rm -rf /usr/local/include/node /usr/local/include/node_modules sudo rm -rf /usr/local/lib/node /usr/local/lib/node_modules /usr/local/lib/dtrace/node.d sudo rm -rf /opt/local/include/node /opt/local/bin/node /opt/local/lib/node sudo rm -rf /usr/local/share/doc/node sudo rm -rf /usr/local/share/systemtap/tapset/node.stp brew uninstall node brew doctor brew cleanup --prune-prefix tips nvm $ curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.32.1/install.sh | bash $ nvm install v12 hogo loveit Q&A empty of npm ls -g $ npm ls -g /usr/local/Cellar/node/15.0.1/lib └── (empty) solution $ brew rm node Uninstalling /usr/local/Cellar/node/15.0.1... (3,331 files, 61MB) $ brew install node Updating Homebrew... ==> Auto-updated Homebrew! Updated 2 taps (homebrew/core and homebrew/cask). ==> Updated Formulae Updated 3 formulae. ==> Updated Casks ithoughtsx ==> Downloading https://homebrew.bintray.com/bottles/node-15.0.1.catalina.bottle.tar.gz ==> Downloading from https://d29vzk4ow07wi7.cloudfront.net/9cdf039763f006eef0cc0aaebb13bc8173f017d961ac41c30f26d45a23ecffe0?response-content-dispositio ######################################################################## 100.0% ==> Pouring node-15.0.1.catalina.bottle.tar.gz ==> Caveats Bash completion has been installed to: /usr/local/etc/bash_completion.d ==> Summary ☕️ 🐸 /usr/local/Cellar/node/15.0.1: 3,331 files, 61MB verify $ npm ls -g /usr/local/lib ├── -@0.0.1 ├── commitizen@4.2.1 ├── ... └── verify-junit-xml@0.0.3 how to reproduce $ npm --version 7.0.3 $ npm root -g /usr/local/lib/node_module $ npm i -g npm@latest removed 51 packages, and changed 197 packages in 4s 2 packages are looking for funding run `npm fund` for details $ npm -v 6.14.8 $ npm root -g /usr/local/Cellar/node/15.0.1/lib/node_modules $ npm i -g npm@7.0.3 /usr/local/Cellar/node/15.0.1/bin/npm -> /usr/local/Cellar/node/15.0.1/lib/node_modules/npm/bin/npm-cli.js /usr/local/Cellar/node/15.0.1/bin/npx -> /usr/local/Cellar/node/15.0.1/lib/node_modules/npm/bin/npx-cli.js + npm@7.0.3 updated 248 packages in 6.481s $ npm -v 6.14.8 $ npm root -g /usr/local/Cellar/node/15.0.1/lib/node_modules deep investigation $ npm config -g ls -l | grep prefix ; prefix = \"/usr/local/Cellar/node/15.0.1\" ; overridden by builtin save-prefix = \"^\" tag-version-prefix = \"v\" prefix = \"/usr/local\" $ npm i -g npm@7.0.5 changed 1 package in 6s 10 packages are looking for funding run `npm fund` for details $ npm config -g ls -l | grep prefix prefix = \"/usr/local/Cellar/node/15.0.1\" save-prefix = \"^\" tag-version-prefix = \"v\" $ npm -v 7.0.5 $ npm ls -g /usr/local/Cellar/node/15.0.1/lib └── (empty) $ npm config -g set prefix '/usr/local' $ npm ls -g /usr/local/lib ├── -@0.0.1 ├── commitizen@4.2.1 ├── diff-so-fancy@1.3.0 ├── ... env: node: No such file or directory possible cause ╭─────────────────────────────────────────────────────────────────╮ │ │ │ New patch version of npm available! 6.14.8 → 6.14.10 │ │ Changelog: https://github.com/npm/cli/releases/tag/v6.14.10 │ │ Run npm install -g npm to update! │ │ │ ╰─────────────────────────────────────────────────────────────────╯ $ npm i -g npm /usr/local/bin/npx -> /usr/local/lib/node_modules/npm/bin/npx-cli.js /usr/local/bin/npm -> /usr/local/lib/node_modules/npm/bin/npm-cli.js + npm@6.14.10 added 435 packages from 887 contributors in 4.481s solution $ which node /usr/local/opt/node@12/bin/node $ sudo chown -R $(whoami) $(brew --prefix)/* $ brew link --overwrite node@12 Linking /usr/local/Cellar/node@12/12.20.0... 3808 symlinks created If you need to have this software first in your PATH instead consider running: echo 'export PATH=\"/usr/local/opt/node@12/bin:$PATH\"' >> /Users/marslo/.bash_profile info $ brew info node@12 ==> node@12: stable 12.22.12 (bottled) [pinned at 12.22.12_1, keg-only] Platform built on V8 to build network applications https://nodejs.org/ Disabled because it is not supported upstream! /usr/local/Cellar/node@12/12.22.12_1 (3,875 files, 51.6MB) * Poured from bottle on 2022-09-21 at 05:19:58 From: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/node@12.rb License: MIT ==> Dependencies Build: pkg-config ✔, python@3.9 ✔ Required: brotli ✔, c-ares ✔, icu4c ✔, libnghttp2 ✔, libuv ✔, openssl@1.1 ✔, macos-term-size ✔ ==> Caveats node@12 is keg-only, which means it was not symlinked into /usr/local, because this is an alternate version of another formula. If you need to have node@12 first in your PATH, run: echo 'export PATH=\"/usr/local/opt/node@12/bin:$PATH\"' >> /Users/marslo/.bash_profile For compilers to find node@12 you may need to set: export LDFLAGS=\"-L/usr/local/opt/node@12/lib\" export CPPFLAGS=\"-I/usr/local/opt/node@12/include\" $ brew info node ==> node: stable 20.8.0 (bottled), HEAD Platform built on V8 to build network applications https://nodejs.org/ /usr/local/Cellar/node/20.5.1 (2,356 files, 58MB) Poured from bottle using the formulae.brew.sh API on 2023-08-14 at 23:26:23 /usr/local/Cellar/node/20.6.0 (2,398 files, 58.4MB) Poured from bottle using the formulae.brew.sh API on 2023-09-06 at 22:37:08 /usr/local/Cellar/node/20.7.0 (2,517 files, 59.3MB) Poured from bottle using the formulae.brew.sh API on 2023-09-21 at 23:31:27 /usr/local/Cellar/node/20.8.0 (2,517 files, 59.2MB) Poured from bottle using the formulae.brew.sh API on 2023-10-05 at 13:31:50 From: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/node.rb License: MIT ==> Dependencies Build: pkg-config ✔, python@3.11 ✔ Required: brotli ✔, c-ares ✔, icu4c ✔, libnghttp2 ✔, libuv ✔, openssl@3 ✔ ==> Options --HEAD Install HEAD version ==> Caveats Bash completion has been installed to: /usr/local/etc/bash_completion.d ==> Analytics install: 236,495 (30 days), 613,011 (90 days), 1,316,363 (365 days) install-on-request: 202,391 (30 days), 538,160 (90 days), 1,166,207 (365 days) build-error: 360 (30 days) Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-05 01:04:35 "},"tools/node/hexo.html":{"url":"tools/node/hexo.html","title":"hexo","keywords":"","body":" prepare init add theme clone code install plugin generate new pages diable the default highlight settings prepare $ npm i -g hexo-cli init $ mkdir myblog && cd myblog $ hexo init $ hexo init INFO Cloning hexo-starter https://github.com/hexojs/hexo-starter.git INFO Install dependencies added 183 packages from 421 contributors and audited 189 packages in 22.277s 12 packages are looking for funding run `npm fund` for details found 0 vulnerabilities INFO Start blogging with Hexo! add theme credit belongs to snark clone code In a Git repoIn a folderUpdate theme$ git submodule add https://github.com/imarslo/hexo-theme-snark.git themes/snark$ git clone https://github.com/imarslo/hexo-theme-snark.git themes/snark $ sed '/highlight:/{n;s/^.*$/\\ \\ enable: false/}' -i _config.xml $ sed '/highlight:/{n;n;s/^.*$/\\ \\ line_number: false/}' -i _config.xml$ git submodule sync --recursive $ git submodule update --init --recursive install plugin $ npm install hexo-renderer-pug --save $ npm install hexo-renderer-sass --save $ npm install hexo-generator-feed --save $ npm install hexo-generator-search --save $ npm install hexo-generator-sitemap --save generate new pages $ hexo new page archives $ hexo new page categories $ hexo new page tags $ hexo new page about diable the default highlight settings default settings in _config.xml cmd with sedorresult$ sed '/highlight:/{n;s/^.*$/\\ \\ enable: false/;n;s/^.*$/\\ \\ line_number: false/;}' -i _config.xml$ sed '/highlight:/{n;s/^.*$/\\ \\ enable: false/}' -i _config.xml $ sed '/highlight:/{n;n;s/^.*$/\\ \\ line_number: false/}' -i _config.xml$ grep highlight: _config.yml -A 6 highlight: enable: false line_number: false auto_detect: false tab_replace: '' wrap: true hljs: false Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"tools/node/github.page.html":{"url":"tools/node/github.page.html","title":"github.page","keywords":"","body":" theme jekyll gh-pages Please use a personal access token instead token generation clean previous git credential theme [!NOTE|style:callout|label:references|icon:fa fa-bullhorn] reference: Getting started with GitHub Pages github.com » github.page theme jekyll-themes.com jekyllthemes.io jekyllthemes.org jamstackthemes.dev Solar DevJoural Jamstack Themes jekyll-theme GitHub Pages themes jekyll-gruvbox-theme jekyll-TeXt-theme jekyll [!NOTE|style:callout|label:jekyll|icon:fa fa-bullhorn] jellky usage Jekyll Doc Theme 6.0: Alert install $ gem install github-pages Fetching em-websocket-0.5.1.gem Fetching colorator-1.1.0.gem Fetching eventmachine-1.2.7.gem ... start local service $ jekyll serve Configuration file: /Users/marslo/mywork/tools/git/marslo/marslo.github.io/_config.yml Source: /Users/marslo/mywork/tools/git/marslo/marslo.github.io Destination: /Users/marslo/mywork/tools/git/marslo/marslo.github.io/_site Incremental build: disabled. Enable with --incremental Generating... done in 0.593 seconds. Auto-regeneration: enabled for '/Users/marslo/mywork/tools/git/marslo/marslo.github.io' Server address: http://127.0.0.1:4000/ Server running... press ctrl-c to stop. gh-pages [!NOTE|style:callout|label:gh-pages|icon:fa fa-bullhorn] reference: How to build and deploy a React app to Github pages in less than 5 minutes Please use a personal access token instead [!NOTE|style:callout|icon:fa fa-bullhorn] references: Authentication token format updates are generally available Creating a personal access token Other authentication methods jonjack/add-update-github-access-token-on-mac.md Updating credentials from the macOS Keychain Caching your GitHub credentials in Git Using the OS X Keychain to store and retrieve passwords Get Password from Keychain in Shell Scripts token generation login -> account -> settings -> Developer settings -> Personal access tokens clean previous git credential $ git credential-osxkeychain erase ⏎ host=github.com ⏎ protocol=https ⏎ ⏎ # and clean the previous git credential in keychain Access.app $ security delete-internet-password -l github.com check git credential helper $ git config --get credential.helper osxkeychain find item in keychain $ security find-internet-password -l github.com read password [!NOTE|style:callout|icon:fa fa-bullhorn] * imarslo: read password in osx $ sudo security find-internet-password -ws github.com [-a ] or read all information$ sudo security find-internet-password -gs github.com Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"tools/app/app.html":{"url":"tools/app/app.html","title":"app","keywords":"","body":" recommend apps screenshot keystore gif development system app store program Java recommend apps screenshot jietu snagit snipaste ⇠ for windows keystore Visualize cn us keyCastr captin Carnac ⇠ for windows keyboard customized Karabiner-Elements gif GIF Brewery 3 by Gfycat caches: $HOME/Movies/GIF Brewery 3/*.mp4 cn us LICEcap development macvim RegExRX cn us iTerm2 dash doctoc gnomon Css Scan system psSafe iStat Menus Moon Alfed backup: user path: $HOME/Library/Application Support/Alfred Chrome Canary chrome extension downloader Chromium Karabiner-Elements Saviour of MadCatz R.A.T in MacOS System Color Picker | Just Color Picker Bob Translate | TTime Translate ⇠ for windows app store logout Store -> logout program Java [!NOTE|label:references:] * iMarslo : apps/java Oracle Java Archive bellsoft/Liberica oracle java 21 linux osx windows java 17 linux osx windows java 11 linux osx windows solaris java 8 [!NOTE|label:references:] java 8u391 java 8u211 and later java 8u202 and earlier linux osx windows solaris java archive Java SE 7 Java SE 6 Java SE 5 Java SE 1.4 Java SE 1.3 Java SE 1.2 Java SE 1.1 bellsoft [!NOTE|label:references:] B4J Tutorials Raspberry Pi with Java 11 Liberica JDK.pdf 21.0.1+12 bellsoft-jdk21.0.1+12-linux-arm32-vfp-hflt-full.deb bellsoft-jdk21.0.1+12-linux-aarch64-full.deb bellsoft-jdk21.0.1+12-linux-aarch64.deb bellsoft-jdk21.0.1+12-linux-amd64-full.deb bellsoft-jdk21.0.1+12-linux-amd64.deb 17.0.9+11 bellsoft-jdk17.0.9+11-linux-aarch64-full.deb bellsoft-jdk17.0.9+11-linux-aarch64.deb bellsoft-jdk17.0.9+11-linux-amd64-full.deb bellsoft-jdk17.0.9+11-linux-amd64.deb bellsoft-jdk17.0.9+11-linux-arm32-vfp-hflt-full.deb bellsoft-jdk17.0.9+11-linux-arm32-vfp-hflt.deb 11.0.21+10 bellsoft-jdk11.0.21+10-linux-aarch64-full.deb bellsoft-jdk11.0.21+10-linux-aarch64.deb bellsoft-jdk11.0.21+10-linux-amd64-full.deb bellsoft-jdk11.0.21+10-linux-amd64.deb bellsoft-jdk11.0.21+10-linux-arm32-vfp-hflt-full.deb bellsoft-jdk11.0.21+10-linux-arm32-vfp-hflt.deb Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"tools/app/ms.html":{"url":"tools/app/ms.html","title":"microsoft office","keywords":"","body":" office outlook profiles word logs disable animations excel shortcuts reference: pbowden-msft/Unlicense Rebuild the Office database Outlook 2016 for Mac repeatedly prompts for authentication Office for Mac repeatedly requesting keychain access If your Mac keeps asking for the login keychain password How to remove Office license files on a Mac Troubleshoot install or activation errors for Office for Mac Configure keychain download Microsoft Office 16.45.21011103 Microsoft_Office_16.45.21011103_BusinessPro_Installer.pkg Microsoft_Word_16.45.21011103_Installer.pkg Update history for Office for Mac Release notes for Office for Mac Activate Office 2019 for macOS VoL.md Uninstall Office for Mac Release history for Microsoft Auto Update (MAU) Q&A \"There is a problem with your account. Try again later.\" - Mac (Sierra) Office 365 Business won't activate on Mac How to troubleshoot issues that you encounter when you sign in to Office apps for Mac, iPad, iPhone, or iPod Touch when using Active Directory Federation Services office uninstall completely If you still meet the issue, I suggest you try the following steps and resign into Office to check the result: Navigated to Library folder and open Group Containers. Ctrl+click each of these folders if present, and Move to Trash. UBF8T346G9.ms UBF8T346G9.Office UBF8T346G9.OfficeOsfWebHost Warning: Outlook data will be removed when you move the three folders listed in this step to Trash. You should back up these folders before you delete them. references: pbowden-msft/Unlicense [FIX] Error When Opening Word or Outlook on Mac (EXC_BAD_INSTRUCTION) How to remove Office license files on a Mac Having problems with Office and Outlook for Mac 2016 (Sept/Oct 2017) $ ls -1d ~/Library/Group\\ Containers/UBF8T346G9.*/ /Users/marslo/Library/Group Containers/UBF8T346G9.Office/ /Users/marslo/Library/Group Containers/UBF8T346G9.OfficeOneDriveSyncIntegration/ /Users/marslo/Library/Group Containers/UBF8T346G9.OfficeOsfWebHost/ /Users/marslo/Library/Group Containers/UBF8T346G9.OneDriveStandaloneSuite/ /Users/marslo/Library/Group Containers/UBF8T346G9.com.microsoft.rdc/ /Users/marslo/Library/Group Containers/UBF8T346G9.ms/ outlook profiles profile $ ls ~/Library/Group Containers/UBF8T346G9.Office/Outlook/Outlook 15 Profiles/ reset outlook profile $ open \"/Applications/Microsoft Outlook.app/Contents/SharedSupport/Outlook Profile Manager.app\" word [!TIP|label:references] office软件出现输入字延迟，点击延迟的现象 * Show document content (text animation, drawings and text boxes) in Word How to disable the smooth moving cursor in Office 2016 Typing Animation - Unbelievably annoying and can't turn off How to Disable the Typing Animation Feature in Office 2013 How to Disable the Typing Animation in Office 2016 or Office 2013 logs word: ~/Library/Containers/com.microsoft.Word /Data/Library/Caches/Microsoft/uls/ Com.microsoft.Word /logs$ tail -f ~/Library/Containers/com.microsoft.Word/Data/Library/Caches/Microsoft/uls/com.microsoft.Word/logs/apple-device-log-20210114-2301.log disable animations > cat DisableAnimations.reg Windows Registry Editor Version 5.00 [HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Office\\16.0\\Common\\Graphics] \"DisableAnimations\"=dword:00000001 excel shortcuts [!NOTE|label:references:] Excel Shortcuts “Cheat Sheet” Excel Shortcuts PC Mac 三种方法，教你在Excel里面给字体添加删除线 SHORTCUT PURPOSE control + 5 strikethrough command + 1 Open Format Cells Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"tools/app/vscode.html":{"url":"tools/app/vscode.html","title":"vscode","keywords":"","body":" basic config plugins Settings Sync vim shortcut references: How to Set Up Proxy Settings for Advise for Visual Studio Code Extension Marketplace basic [!TIP|label:settings.json] OS LOCATION windows %APPDATA%\\Code\\User\\settings.json linux $HOME/.config/Code/User/settings.json osx $HOME/Library/Application Support/Code/User/settings.json config proxy{ \"http.proxy\": \"http://user:pass@my.proxy.address:8080\", \"http.proxyStrictSSL\": false, } plugins Settings Sync vim [!NOTE|label:references:] nstalling vim inside visual studio code install mac$ defaults write com.microsoft.VSCode ApplePressAndHoldEnabled -bool false # For VS Code $ defaults write com.microsoft.VSCodeInsiders ApplePressAndHoldEnabled -bool false # For VS Code Insider $ defaults write com.visualstudio.code.oss ApplePressAndHoldEnabled -bool false # For VS Codium $ defaults write com.microsoft.VSCodeExploration ApplePressAndHoldEnabled -bool false # For VS Codium Exploration users $ defaults delete -g ApplePressAndHoldEnabled # If necessary, reset global default confiugre // vim \"vim.changeWordIncludesWhitespace\": true, \"vim.cursorStylePerMode.insert\": \"line\", \"vim.cursorStylePerMode.normal\": \"underline\", \"vim.cursorStylePerMode.visual\": \"underline\", \"vim.cursorStylePerMode.visualblock\": \"line\", \"vim.cursorStylePerMode.visualline\": \"underline\", \"vim.cursorStylePerMode.replace\": \"underline\", \"vim.useSystemClipboard\": true, \"vim.sneakUseIgnorecaseAndSmartcase\": true, \"vim.easymotion\": true, \"vim.incsearch\": true, \"vim.hlsearch\": true, shortcut [!NOTE|label:references:] mac.pdf linux.pdf windows.pdf keys ⌃ : control ⌘ : command ⇧ : shift ⌥ : option accepted keys: PLATFORM MODIFIERS macOS Ctrl+, Shift+, Alt+, Cmd+ Windows Ctrl+, Shift+, Alt+, Win+ Linux Ctrl+, Shift+, Alt+, Meta+ SHORTCUT KEY DESCRIPTION shift + cmd + p ⇧ + ⌘ + p open command palette cmd + p ⌘ + p go to file shift + ctrl + ` ⇧ + ⌘ + ` new terminal ctrl + b ⌃ + b toggle sidebar visibility ctrl + r ⌃ + r open recently cmd + j ⌘ + j toggle terminal panel cmd + , ⌘ + , open settings shift + cmd + e ⇧ + ⌘ + e open explorer view shift + cmd + f ⇧ + ⌘ + f open search view shift + cmd + v ⇧ + ⌘ + v open markdown preview cmd + k, v ⌘ + k, v open markdown preview to side shift + cmd + g ⇧ + ⌘ + g open source control view shift + cmd + x ⇧ + ⌘ + x open extensions view shift + cmd + o ⇧ + ⌘ + o go to symbol shift + cmd + m ⇧ + ⌘ + m show problem panel shift + cmd + y ⇧ + ⌘ + y show debug console panel shift + cmd + u ⇧ + ⌘ + u show output panel ctrl + ^ ⌃ + ^ show terminal panel cmd + k + 0 / cmd + k + j ⌘ + k + 0 / ⌘ + k + j fold/unfold all methods alt + cmd + o ⌥ + ⌘ + o connect to ... alt + cmd + r ⌥ + ⌘ + r reveal in finder alt + cmd + c ⌥ + ⌘ + c copy path Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:25 "},"tools/app/virtualbox.html":{"url":"tools/app/virtualbox.html","title":"virtualbox","keywords":"","body":" install from commandline uninstall install vms Run Windows 10 on Mac with VirtualBox for Mac OS X vboxmanager list run delete vms troubleshooting collect debug report Result Code: NS_ERROR_FAILURE (0x80004005) install from commandline $ hdiutil attach VirtualBox-6.0.24-139119-OSX.dmg $ sudo installer -pkg /Volumes/VirtualBox/VirtualBox.pkg -target / # or $ usr/bin/sudo -E -- /usr/bin/env LOGNAME=marslo USER=marslo USERNAME=marslo \\ /usr/sbin/installer -pkg /usr/local/Caskroom/virtualbox-beta/6.1.0_BETA2,134221/VirtualBox.pkg \\ -target / \\ -applyChoiceChangesXML /var/folders/s3/mg_f3cv54nn7y758j_t46zt40000gn/T/choices20201221-6005-wroatz.xml uninstall VirtualBox_Uninstall.tool) install vms Run Windows 10 on Mac with VirtualBox for Mac OS X vboxmanager setup VboxManager completion $ git clone https://github.com/alexandregz/VBoxManage-completion.git \\ ~/.marslo/completion $ cat >> ~/.marslo/.marslorc list $ VBoxManage list vms run $ VBoxManage startvm ubuntu --type gui delete vms $ VBoxManage unregistervm --delete \"Name of Virtual Machine\" troubleshooting collect debug report $ VBoxBugReport Oracle VM VirtualBox Bug Report Tool 6.1.16 (C) 2020 Oracle Corporation All rights reserved. 0% - collecting VBoxSVC.log... 20% - collecting VBoxSVC.log.1... 40% - collecting VirtualBox.xml... 60% - collecting HostUsbDevices... 80% - collecting HostUsbFilters... 100% - compressing... Report was written to '2020-12-21-11-03-22-bugreport.tgz' Result Code: NS_ERROR_FAILURE (0x80004005) test builds disable System Integrity Protection first macOS$ csrutil status $ csrutil disable solution $ csrutil enable --without debug --without fs $ VBOX_KEXT_DESTINATION=/Library/Apple/System/Library/Extensions $ sudo cp -a \"/Library/Application Support/VirtualBox/VBoxDrv.kext\" \"$VBOX_KEXT_DESTINATION\"/VBoxDrv.kext $ sudo cp -a \"/Library/Application Support/VirtualBox/VBoxNetFlt.kext\" \"$VBOX_KEXT_DESTINATION\"/VBoxNetFlt.kext $ sudo cp -a \"/Library/Application Support/VirtualBox/VBoxNetAdp.kext\" \"$VBOX_KEXT_DESTINATION\"/VBoxNetAdp.kext $ sudo cp -a \"/Library/Application Support/VirtualBox/VBoxUSB.kext\" \"$VBOX_KEXT_DESTINATION\"/VBoxUSB.kext $ sudo kextload -b org.virtualbox.kext.VBoxDrv $ sudo kextload -b org.virtualbox.kext.VBoxNetFlt $ sudo kextload -b org.virtualbox.kext.VBoxNetAdp $ sudo kextload -b org.virtualbox.kext.VBoxUSB and$ sudo kextload -b org.virtualbox.kext.VBoxDrv $ sudo kextload -b org.virtualbox.kext.VBoxNetFlt $ sudo kextload -b org.virtualbox.kext.VBoxNetAdp $ sudo kextload -b org.virtualbox.kext.VBoxUSB other info $ sudo kmutil showloaded | grep org.virtualbox No variant specified, falling back to release 196 3 0xffffff7fa2336000 0xb2000 0xb2000 org.virtualbox.kext.VBoxDrv (6.1.16) DAF044F0-5043-3B8E-8758-5A462567BDAA 197 0 0xffffff7fa2408000 0x2000 0x2000 org.virtualbox.kext.VBoxNetAdp (6.1.16) 76200407-D2F0-3D84-BCCF-7EEA18F16654 199 0 0xffffff7fa2413000 0x5000 0x5000 org.virtualbox.kext.VBoxUSB (6.1.16) CA33FA52-5933-3F0E-9B40-8B1ECF4D6A36 200 0 0xffffff7fa240e000 0x4000 0x4000 org.virtualbox.kext.VBoxNetFlt (6.1.16) C93EAF6A-676F-3370-BAE2-BDFD2BF16582 $ sudo kmutil load -b org.virtualbox.kext.VBoxDrv $ sudo dmesg Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"tools/app/iterm2.html":{"url":"tools/app/iterm2.html","title":"iterm2","keywords":"","body":" tab setup a colorful tab add favor color to a file (~/.marslo/.colors) hidden settings iTerm2 Python REPL theme tab setup a colorful tab pick colors references: Digital Color Meter.app iterm2-tab-set System Color Picker using : tabset --list > $ while read i; do > c=$(echo $i | awk -F':' '{print $1}'); > echo === $c === ; > tabset --add m-$c $c; > done add favor color to a file (~/.marslo/.colors) $ echo \"\" >> ~/.marslo/.colors get color hex (for it2setcolor) [!TIP] download original csscolor.js if necessory: $ curl -fsSL -O https://raw.githubusercontent.com/jonathaneunice/iterm2-tab-set/master/csscolors.js $ while read -r i; do > rgb=$(grep -E \"\\s$i:\" csscolors.js | sed -re \"s:.*\\[(.*)\\],?$:\\1:\";) > hexc=$(for c in $(echo ${rgb} | sed -re 's:,::g'); do printf '%x' $c; done) > echo -e \"\"\"$i :\\t$rgb :\\t$hexc\"\"\" > echo \"$hexc\" >> ~/.marslo/.it2color > done result: $ ./rgb2hex.sh yellowgreen : 154, 205, 50 : 9acd32 wheat : 245, 222, 179 : f5deb3 tomato : 255, 99, 71 : ff6347 steelblue : 70, 130, 180 : 4682b4 tan : 210, 180, 140 : d2b48c sandybrown : 244, 164, 96 : f4a460 plum : 221, 160, 221 : dda0dd palegoldenrod : 238, 232, 170 : eee8aa palegreen : 152, 251, 152 : 98fb98 navajowhite : 255, 222, 173 : ffdead olive : 128, 128, 0 : 80800 moccasin : 255, 228, 181 : ffe4b5 chartreuse : 127, 255, 0 : 7fff0 palegreen : 152, 251, 152 : 98fb98 mediumorchid : 186, 85, 211 : ba55d3 royalblue : 65, 105, 225 : 4169e1 olivedrab : 107, 142, 35 : 6b8e23 khaki : 240, 230, 140 : f0e68c show color in iterm2 $ cat ~/.profile # iTerm2 tab titles function itit { if [ \"$1\" ]; then unset PROMPT_COMMAND echo -ne \"\\\\033]0;${1}\\\\007\" if [ 2 -eq $# ]; then case $2 in [cC] ) it2setcolor tab $(shuf -n 1 ~/.marslo/.it2colors) || echo ;; [bB] ) printf \"\\e]1337;SetBadgeFormat=%s\\a\" $(echo -n \"${1} \\(user.gitBranch)\" | base64) ;; [bB][cC] | [cC][bB] ) printf \"\\e]1337;SetBadgeFormat=%s\\a\" $(echo -n \"${1}\" | base64) it2setcolor tab $(shuf -n 1 ~/.marslo/.it2colors) || echo ;; esac fi else export PROMPT_COMMAND='echo -ne \"\\033]0;${PWD/#$HOME/\\~}\\007\";' printf \"\\e]1337;SetBadgeFormat=%s\\a\" $(echo -n \"\" | base64) it2setcolor tab default fi } EOF usage:$ itit 'title-string-here' [c][b] result: c\"> hidden settings To change the number of entries in the autocomplete menu: $ defaults write com.googlecode.iterm2 AutocompleteMaxOptions -int 10 To change the number of coprocess commands remembered: $ defaults write com.googlecode.iterm2 \"Coprocess MRU\" -int 10 To preserve whitespace in selections copied to the pasteboard: $ defaults write com.googlecode.iterm2 TrimWhitespaceOnCopy -bool false When you open a file from the finder in iTerm2 (e.g., by double-clicking a shell script), it will either open in a window or a tab. By default, it opens in a tab. You can change this with: $ defaults write com.googlecode.iterm2 OpenFileInNewWindows -bool true quite iTerm2 when the last session is closed $ defaults write com.googlecode.iterm2 MinRunningTime -float 10.0 increase the delay before it attempts to reconfigure itself after a change of monitors $ defaults write com.googlecode.iterm2 UpdateScreenParamsDelay -float 1.0 To change the number of paste history entries saved: defaults write com.googlecode.iterm2 MaxPasteHistoryEntries -int 20 Pastes (both regular and slow) are done by splitting the text to paste into chunks. There is a delay between the transmission of each chunk. To change the speed that \"paste\" pastes at: $ defaults write com.googlecode.iterm2 QuickPasteBytesPerCall -int 1024 $ defaults write com.googlecode.iterm2 QuickPasteDelayBetweenCalls -float 0.01 To change the speed that \"paste slowly\" pastes at: $ defaults write com.googlecode.iterm2 SlowPasteBytesPerCall -int 16 $ defaults write com.googlecode.iterm2 SlowPasteDelayBetweenCalls -float 0.125 To disable using the pinch gesture to change font size: $ defaults write com.googlecode.iterm2 PinchToChangeFontSizeDisabled -bool true To keep LC_CTYPE from being set when locale environment variables are set: $ defaults write com.googlecode.iterm2 DoNotSetCtype -bool true To allow Growl notifications to be posted for the current tab: $ defaults write com.googlecode.iterm2 GrowlOnForegroundTabs -bool true To tune smart cursor color settings: $ defaults write com.googlecode.iterm2.plist SmartCursorColorBgThreshold -float 0.5 $ defaults write com.googlecode.iterm2.plist SmartCursorColorFgThreshold -float 0.75 To allow a three-finger tap to act like a three-finger click: $ defaults write com.googlecode.iterm2.plist ThreeFingerTapEmulatesThreeFingerClick \\ -bool true To change the set of characters that are considered part of a URL (besides alphanumerics): $ defaults write com.googlecode.iterm2.plist URLCharacterSet -string \\ \".?\\\\/:;%=&_-,+~#@!*'()|[]\" To use some experimental optimizations that will improve performance (safety not guaranteed): $ defaults write com.googlecode.iterm2.plist ExperimentalOptimizationsEnabled \\ -bool true To tweak tab sizes: $ defaults write com.googlecode.iterm2 UseUnevenTabs -bool false $ defaults write com.googlecode.iterm2 MinTabWidth -int 75 $ defaults write com.googlecode.iterm2 MinCompactTabWidth -int 60 $ defaults write com.googlecode.iterm2 OptimumTabWidth -int 175 To change your search engine: $ defaults write com.googlecode.iterm2 SearchCommand \\ -string \"http://google.com/search?q=%@\" To adjust the speed of the animation of the hotkey window's appearance and disappearance: $ defaults write com.googlecode.iterm2 HotkeyTermAnimationDuration \\ -float 0.25 To adjust the amount of dimming of split panes. Set the value to a floating-point number between 0 (no dimming) and 1 (complete dimming). The default is 0.15: $ defaults write com.googlecode.iterm2 SplitPaneDimmingAmount \\ -float 0.25 iTerm2 Python REPL Welcome to the iTerm2 Python REPL! This is an interactive Python interpreter where you can experiment with scripts. Unlike standard Python interpreters, you can use \"await\" not inside an async function. Here's an example script to try: import iterm2 connection=await iterm2.Connection.async_create() await iterm2.Window.async_create(connection) ⌘-click here for iTerm2 Python API Docs >>> theme [!NOTE|label:references:] Iterm2-color-schemes mbadolato/iTerm2-Color-Schemes Alan/iTerm2-Color-Schemes Gogh: Color Scheme for Gnome Terminal, Pantheon Terminal, Tilix, and XFCE4 Terminal * Gogh-Co/Gogh $ export LS_COLORS='no=00:fi=00:di=01;31:ln=01;36:pi=40;33:so=01;35:bd=40;33;01:cd=40;33;01:or=01;05;37;41:mi=01;05;37;41:ex=01;32:*.cmd=01;32:*.exe=01;32:*.com=01;32:*.btm=01;32:*.bat=01;32:*.sh=01;32:*.csh=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.gz=01;31:*.bz2=01;31:*.bz=01;31:*.tz=01;31:*.rpm=01;31:*.cpio=01;31:*.jpg=01;35:*.gif=01;35:*.bmp=01;35:*.xbm=01;35:*.xpm=01;35:*.png=01;35:*.tif=01;35:' $ echo $LS_COLORS no=00:fi=00:di=32:ow=37:ln=35:pi=30;44:so=35;44:do=35;44:bd=33;44:cd=37;44:or=05;37;41:mi=05;37;41:ex=01;31:*.cmd=01;31:*.exe=01;31:*.com=01;31:*.bat=01;31:*.reg=01;31:*.app=01;31:*.txt=32:*.org=32:*.md=32:*.mkd=32:*.h=32:*.hpp=32:*.c=32:*.C=32:*.cc=32:*.cpp=32:*.cxx=32:*.objc=32:*.cl=32:*.sh=32:*.bash=32:*.csh=32:*.zsh=32:*.el=32:*.vim=32:*.java=32:*.pl=32:*.pm=32:*.py=32:*.rb=32:*.hs=32:*.php=32:*.htm=32:*.html=32:*.shtml=32:*.erb=32:*.haml=32:*.xml=32:*.rdf=32:*.css=32:*.sass=32:*.scss=32:*.less=32:*.js=32:*.coffee=32:*.man=32:*.0=32:*.1=32:*.2=32:*.3=32:*.4=32:*.5=32:*.6=32:*.7=32:*.8=32:*.9=32:*.l=32:*.n=32:*.p=32:*.pod=32:*.tex=32:*.go=32:*.sql=32:*.csv=32:*.bmp=33:*.cgm=33:*.dl=33:*.dvi=33:*.emf=33:*.eps=33:*.gif=33:*.jpeg=33:*.jpg=33:*.JPG=33:*.mng=33:*.pbm=33:*.pcx=33:*.pdf=33:*.pgm=33:*.png=33:*.PNG=33:*.ppm=33:*.pps=33:*.ppsx=33:*.ps=33:*.svg=33:*.svgz=33:*.tga=33:*.tif=33:*.tiff=33:*.xbm=33:*.xcf=33:*.xpm=33:*.xwd=33:*.xwd=33:*.yuv=33:*.aac=33:*.au=33:*.flac=33:*.m4a=33:*.mid=33:*.midi=33:*.mka=33:*.mp3=33:*.mpa=33:*.mpeg=33:*.mpg=33:*.ogg=33:*.opus=33:*.ra=33:*.wav=33:*.anx=33:*.asf=33:*.avi=33:*.axv=33:*.flc=33:*.fli=33:*.flv=33:*.gl=33:*.m2v=33:*.m4v=33:*.mkv=33:*.mov=33:*.MOV=33:*.mp4=33:*.mp4v=33:*.mpeg=33:*.mpg=33:*.nuv=33:*.ogm=33:*.ogv=33:*.ogx=33:*.qt=33:*.rm=33:*.rmvb=33:*.swf=33:*.vob=33:*.webm=33:*.wmv=33:*.doc=31:*.docx=31:*.rtf=31:*.odt=31:*.dot=31:*.dotx=31:*.ott=31:*.xls=31:*.xlsx=31:*.ods=31:*.ots=31:*.ppt=31:*.pptx=31:*.odp=31:*.otp=31:*.fla=31:*.psd=31:*.7z=1;35:*.apk=1;35:*.arj=1;35:*.bin=1;35:*.bz=1;35:*.bz2=1;35:*.cab=1;35:*.deb=1;35:*.dmg=1;35:*.gem=1;35:*.gz=1;35:*.iso=1;35:*.jar=1;35:*.msi=1;35:*.rar=1;35:*.rpm=1;35:*.tar=1;35:*.tbz=1;35:*.tbz2=1;35:*.tgz=1;35:*.tx=1;35:*.war=1;35:*.xpi=1;35:*.xz=1;35:*.z=1;35:*.Z=1;35:*.zip=1;35:*.ANSI-30-black=30:*.ANSI-01;30-brblack=01;30:*.ANSI-31-red=31:*.ANSI-01;31-brred=01;31:*.ANSI-32-green=32:*.ANSI-01;32-brgreen=01;32:*.ANSI-33-yellow=33:*.ANSI-01;33-bryellow=01;33:*.ANSI-34-blue=34:*.ANSI-01;34-brblue=01;34:*.ANSI-35-magenta=35:*.ANSI-01;35-brmagenta=01;35:*.ANSI-36-cyan=36:*.ANSI-01;36-brcyan=01;36:*.ANSI-37-white=37:*.ANSI-01;37-brwhite=01;37:*.log=01;32:*~=01;32:*#=01;32:*.bak=01;33:*.BAK=01;33:*.old=01;33:*.OLD=01;33:*.org_archive=01;33:*.off=01;33:*.OFF=01;33:*.dist=01;33:*.DIST=01;33:*.orig=01;33:*.ORIG=01;33:*.swp=01;33:*.swo=01;33:*,v=01;33:*.gpg=34:*.gpg=34:*.pgp=34:*.asc=34:*.3des=34:*.aes=34:*.enc=34:*.sqlite=34 GruvboxDark Solarized Ciapre Hivacruz Ryuuko Relaxed SeaShells Seafoam Pastel N0tch2k Red Planet SoftServer Neutron Blazer Chester Mirage Jubi Parasio Dark ubuntu Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"tools/app/browser.html":{"url":"tools/app/browser.html","title":"browser","keywords":"","body":" firefox restart firefox customized firefox style chrome shortcut download tips chromium references: CSS Selector Reference CSS Selectors Understand ‘+’, ‘>’ and ‘~’ symbols in CSS Selector 10 CSS3 Properties You Need to Be Familiar With CSS: Cascading Style Sheets :is() A list of Font Awesome icons and their CSS content values firefox restart firefox about:restartrequired customized firefox style userChrome.css Profiles - Where Firefox stores your bookmarks, passwords and other user data How To Customise Firefox 57+ UI with userChrome.css Aris-t2/CustomCSSforFx Steps: open your currently active profile folder create a new folder named chrome create a desktop shortcut (alias) to the chrome folder for easier future access make sure your OS is set to show you file extensions like .txt and .css create a new text file inside the chrome folder named userChrome.css change a preference in Firefox so it looks for your files at startup (in Firefox 69+) Unlock custom CSS usage in Firefox 69 and newer about:config toolkit.legacyUserProfileCustomizations.stylesheets true Where to find Firefox profile folder? The correct location for user styles about:support > Profile Folder > Open Folder or about:profiles > Root Directory > Open Folder User styles belong into \\chrome\\ folder Inspect ui or web content Enable once Tools > WebDeveloper > Toggle Tools > 'Customize Tools and get help button' > Settings > Enable browser chrome and add-on debugging toolboxes Tools > WebDeveloper > Toggle Tools > 'Customize Tools and get help button' > Settings > Enable remote debugging Hit Ctrl+Alt+Shift+I or open Tools > WebDeveloper > Browser Toolbox remove blue line for active tab How to hide or change the color of the blue line over the tab? /* Hide blue stripe on active tab */ .tab-line[selected=\"true\"] { opacity: 0 !important; } take out blue on top of tab .tab-line { display: none !important; } is there any way to disable the blue line on top of the currently selected tab? #TabsToolbar .tabbrowser-tab[selected] .tab-line { display: none !important; } or #TabsToolbar .tabbrowser-tab .tab-line { display: none !important; } [help] The blue line on top of active tab is back in Firefox 60 #tabbrowser-tabs { --tab-line-color: var(--lwt-accent-color) !important; } Change active tab line color in Tree Style Tabs? :root .tab .highlighter::before { } How to remove the thin blue bar on top of active tabs?.tab-line { background-color:#f5f6f7 !important; } or.tabbrowser-tab:not([selected=\"true\"]):hover .tab-line { background-color: #cccdcf !important; } [SOLVED] How to change active tab background color in css? #main-window[lwthemetextcolor=bright] tab[selected=\"true\"] { color: blue !important; } #main-window[lwthemetextcolor=bright] tab[selected=\"true\"] .tab-background { background-color: gold !important; background-image: none !important; } or /* ACTIVE TAB BACKGROUND COLOR */ .tab-content[selected=\"true\"] { background: rgba(65, 85, 145, 0.4) !important; } chrome shortcut [!TIP] references: Keyboard shortcut to pull Google Chrome tab into its own window duplicate tab in same window shift + w : move tab to new windows by using Vimium cmd+l -> shift+enter : duplicate tab to new window cmd+l -> opt+enter : duplicate tab to same window download [!NOTE] references: Google Chrome Older Versions Download How to Download and Install Google Chrome On Mac OS download standalone version via : https://www.google.com/chrome/?standalone=1 download for OSX : https://www.google.com/chrome/?platform=mac standalone for OSX : https://www.google.com/chrome/?platform=mac&standalone=1 download for linux : https://www.google.com/chrome/?platform=linux standalone for linux : https://www.google.com/chrome/?platform=linux&standalone=1 tips [!NOTE|label:references:] Tips & tricks for Chrome Tips and shortcuts for better browsing remove \"All Bookmarks\" [!NOTE|label:references:] How to remove \"All Bookmarks\" (Alle Lesezeichen) ? How do I get rid of the \"All Bookmarks\" tab? open about://flags disable Power bookmarks side panel restart chrome://restart chrome://chrome-urls [!NOTE|label:references:] 我所了解的Chrome(不看你真的错过了) chrome://flags/ 中有哪些值得调整的选项？ chrome默认隐身模式 all in one chrome://about/ or about:about chrome://chrome-urls/ or about:chrome-urls chrome://predictors/ or about:predictors quick open chrome://downloads/ or about:download chrome://version or about:version chrome://settings/ or about:settings chrome://flags/ or about:flags utilities chrome://dino/ or about:dino chrome://translate-internals/ or about:translate-internals chrome://user-actions/ or about:user-actions chrome://whats-new/ or about:whats-new chrome://topics-internals/ or about:topics-internals chrome://quota-internals/ or about:quota-internals chrome://profile-internals/ or about:profile-internals chrome://prefs-internals/ or about:prefs-internals chrome://password-manager-internals/ or about:password-manager-internals chrome://ukm/ or about:ukm chrome://components/ or about:components chrome://sync-internals debug chrome://local-state/ or about:local-state chrome://process-internals/ or about:process-internals chrome://system/ or about:system chrome://history-clusters-internals/ or about:history-clusters-internals chrome://web-app-internals/ or about:web-app-internals chrome://histograms/ or about:histograms chrome://gpu/ or about:gpu chrome://net-internals/ or about:net-internals chrome://net-export/ or about:net-export chrome://device-log/ or about:device-log chrome://badcastcrash/ or about:badcastcrash chrome://inducebrowsercrashforrealz/ or about:inducebrowsercrashforrealz chrome://inducebrowserdcheckforrealz/ or about:inducebrowserdcheckforrealz chrome://crash/ or about:crash chrome://crashdump/ or about:crashdump chrome://kill/ or about:kill chrome://hang/ or about:hang chrome://shorthang/ or about:shorthang chrome://gpuclean/ or about:gpuclean chrome://gpucrash/ or about:gpucrash chrome://gpuhang/ or about:gpuhang chrome://memory-exhaust/ or about:memory-exhaust chrome://memory-pressure-critical/ or about:memory-pressure-critical chrome://memory-pressure-moderate/ or about:memory-pressure-moderate chrome://quit/ or about:quit chrome://restart/ or about:restart incognito mode [HKEY_CLASSES_ROOT\\ChromeHTML\\shell\\open\\command] @=\"\\\"C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\\\" -incognito -- \\\"%1\\\"\" [HKEY_CLASSES_ROOT\\htmlfile\\shell\\open\\command] @=\"\\\"C:\\\\Program Files\\\\Internet Explorer\\\\iexplore.exe\\\" -incognito %1\" \"DelegateExecute\"=\"{17FE9752-0B5A-4665-84CD-569794602F5C}\" chromium download page : https://download-chromium.appspot.com download for OSX : https://download-chromium.appspot.com/?platform=Mac&type=snapshots Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"tools/app/skype.html":{"url":"tools/app/skype.html","title":"skype","keywords":"","body":" Install skype in Ubuntu 64bit Install skype in Ubuntu 64bit Inspired from AskUbuntu Add i386 architecture $ sudo dpkg --add-architecture i386 $ sudo apt-get update Add Repo and install by apt-get $ sudo add-apt-repository \"deb http://archive.canonical.com/ $(lsb_release -sc) partner\" $ sudo apt-get update && sudo apt-get install skype OR Add by dpkg $ wget http://www.skype.com/go/getskype-linux-ubuntu-64/skype-ubuntu-quantal_4.1.0.20-1_amd64.deb $ sudo dpkg -i skype-ubuntu*.deb Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"tools/app/teamviewer.html":{"url":"tools/app/teamviewer.html","title":"teamviewer","keywords":"","body":" teamviewer installation. Inspired from Official Help teamviewer installation. Inspired from Official Help Add i386 architecture$ sudo dpkg --add-architecture i386 $ sudo apt-get update download teamview deb $ wget http://downloadeu2.teamviewer.com/download/teamviewer_linux.deb install the dependency by apt-get $ sudo apt-get install -f install teamviewer by dpkg $ sudo dpkg -i teamviewer_linux.deb Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-12-23 19:57:24 "},"tools/app/others.html":{"url":"tools/app/others.html","title":"others","keywords":"","body":" shadowsocks service CentOS copy artical content from csdn color picker iterm2-tab-set terminal-colors shadowsocks service CentOS basic environment $ sudo yum install python-setuptools && sudo easy_install pip $ sudo yum install epel-release $ sudo yum install libsodium # for aes-256-gcm $ sudo yum -y groupinstall \"Development Tools\" $ sudo yum -y install python3-pip # optional $ sudo -H python3 -m pip install --upgrade pip git $ sudo bash -c \"cat > /etc/yum.repos.d/wandisco-git.repo\" or nhahv/install_git2.x_on_centos.md$ sudo yum install http://opensource.wandisco.com/centos/6/git/x86_64/wandisco-git-release-6-1.noarch.rpm $ sudo yum install -y git copy artical content from csdn download html to local remove auto-switch to homepage function in html or remove all *.js ( and might be all *.css ) open the html in MS Word bingo! color picker references: * imarslo: colors The 5 Best Color Picker Apps for Mac 256 Colors Cheat Sheet iterm2-tab-set installation$ npm i iterm2-tab-set usage $ tabset --pick function cpick() { if test tabset; then rgb=$(tabset -p | sed -nr \"s:.*rgb\\(([^)]+)\\).*$:\\1:p\"); hexc=$(for c in $(echo \"${rgb}\" | sed -re 's:,: :g'); do printf '%02x' \"$c\"; done); echo -e \"\"\"\\t$rgb ~~> $hexc\"\"\"; fi } result$ cpick 125,199,53 ~~> 7dc735 terminal-colors install $ python3 -m pip install terminal-colors usage $ terminal-colors -l Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2024-01-09 19:15:38 "},"english/symbols.html":{"url":"english/symbols.html","title":"english","keywords":"","body":" references: What are these symbols called in English Grammar Rules SYMBOLS NAME PHONETIC COMMENTS ~ tilde /ˈtildə/ - ^ caret, power sign(math) /ˈkerət/ sounds like carrot * asterisk /ˈastəˌrisk/ - - dash, hyphen /ˈhīfən/ - # hashtag, pound /ˈhashˌtaɡ/, /pound/ - {} curly brackets - - [] square, box brackets - - ` backtick, single quote mark, apostrophe /əˈpästrəfē/ - / slash, stroke - - \\ backslash - - ; semi-colon - - : colon - - () parentheses /pəˈrenTHəsəs/ - Copyright © marslo 2020-2023 all right reserved，powered by GitbookLast Modified: 2023-03-31 00:41:38 "}}